/*! v4.7.15 - 2017-05-30 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("underscore"),e=a("./components/notifier/notifier"),f=d.template("<span class='u-errorTextColor'><%- title %></span>"),g="cartocss-notification-",h={track:function(a){this._notificationId=g+a.cid},showSuccessNotification:function(){var a={status:"success",info:_t("notifications.cartocss.success"),closable:!0,delay:e.DEFAULT_DELAY};this._addOrUpdateNotification(this._notificationId,a)},showErrorNotification:function(a){var b={status:"error",info:_t("notifications.cartocss.error.body",{body:f({title:_t("notifications.cartocss.error.title")}),error:this._transformErrors(a)}),closable:!0,delay:e.DEFAULT_DELAY};this._addOrUpdateNotification(this._notificationId,b)},_transformErrors:function(a){return d.map(a,function(a){return a.message},this).join(". ")},_addOrUpdateNotification:function(a,b){var c=this._getNotification(a);c?c.set(b):this._addNotification(a,b)},_addNotification:function(a,b){b=d.extend({id:a},b),e.addNotification(b)},_getNotification:function(a){return e.getNotification(a)}};b.exports=h},{"./components/notifier/notifier":475,underscore:"underscore"}],2:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../components/notifier/notifier"),f=a("../../config/upload-config"),g=a("./error-details-view"),h=a("./warnings-details-view"),i=a("./twitter-import-details-view"),j={loading:a("./delegated-import-views/loading"),error:a("./delegated-import-views/failed"),warning:a("./delegated-import-views/warnings"),success:a("./delegated-import-views/success")};b.exports=d.extend({initialize:function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.modals)throw new Error("modals is required");if(!a.importModel)throw new Error("importModel is required");this._userModel=a.userModel,this._configModel=a.configModel,this._modals=a.modals,this._importModel=a.importModel,this._showSuccessDetailsButton=a.showSuccessDetailsButton,this._notification=e.addNotification({}),this._initBinds()},_initBinds:function(){this._importModel.on("change",this.updateNotification,this),this._importModel.on("remove",this.clean,this),this._notification.on("notification:close",this._closeHandler,this),this._notification.on("notification:action",this._actionHandler,this),this.add_related_model(this._importModel),this.add_related_model(this._notification)},_closeHandler:function(){this.trigger("remove",this._importModel,this),this._importModel.pause(),this.clean()},_actionHandler:function(a){"show_errors"===a?this._showImportError():"show_stats"===a?this._showImportStats():"show_table"===a?this._showImportDataset():"show_warnings"===a&&this._showImportWarnings()},_getStatus:function(){var a="loading",b=this._importModel.hasFailed(),c=this._importModel.hasCompleted(),d=this._importModel.getWarnings();return b?a="error":c&&!d?a="success":c&&d&&(a="warning"),a},_getInfo:function(){var a=this._importModel.get("upload"),b=this._importModel.get("import"),c={name:"",state:this._importModel.get("state"),progress:"",service:"",step:this._importModel.get("step"),failed:this._importModel.hasFailed(),completed:this._importModel.hasCompleted(),warnings:this._importModel.getWarnings(),showSuccessDetailsButton:this._showSuccessDetailsButton,tables_created_count:b.tables_created_count};return a.type?("file"===a.type&&(a.value.length>1?c.name=a.value.length+" files":c.name=a.value.name),"url"!==a.type&&"remote"!==a.type||(c.name=a.value),"service"===a.type&&(c.name=a.value&&a.value.filename||""),"twitter_search"===a.service_name&&(c.name="Twitter import"),"sql"===a.type&&(c.name="SQL"),"duplication"===a.type&&(c.name=a.table_name||a.value)):c.name=b.display_name||b.item_queue_id||"import",c.service=a.service_name,"upload"===this._importModel.get("step")?c.progress=this._importModel.get("upload").progress:c.progress=Math.max(0,f.uploadStates.indexOf(c.state)/f.uploadStates.length*100),c.progress=c.progress.toFixed(0),c},updateNotification:function(){var a=this._getStatus(),b=j[a];b.call(this,this._importModel,this._notification,a,this._getInfo(),this._showSuccessDetailsButton)},_showImportDataset:function(){var a=this._importModel.get("import").table_name;window.location=this._configModel.get("base_url")+"/dataset/"+a},_showImportStats:function(){var a=this;this._modals.create(function(b){return new i({modalModel:b,userModel:a._userModel,model:a._importModel})})},_showImportError:function(){var a=this;this._modals.create(function(b){return new g({configModel:a._configModel,modalModel:b,error:a._importModel.getError(),userModel:a._userModel})})},_showImportWarnings:function(){var a=this;this._modals.create(function(b){return new h({modalModel:b,warnings:a._importModel.getWarnings(),userModel:a._userModel})})}})},{"../../components/notifier/notifier":475,"../../config/upload-config":597,"./delegated-import-views/failed":6,"./delegated-import-views/loading":8,"./delegated-import-views/success":10,"./delegated-import-views/warnings":12,"./error-details-view":14,"./twitter-import-details-view":16,"./warnings-details-view":22,"backbone/core-view":1127}],3:[function(a,b,c){var d=a("backbone/core-view"),e=a("./background-import-limit.tpl"),f=a("../../components/notifier/notifier");b.exports=d.extend({initialize:function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");this._userModel=a.userModel,this._configModel=a.configModel,this._notification=f.addNotification({status:"error",closable:!0,button:!1,info:this._getInfo()}),this._initBinds()},_initBinds:function(){this._notification.on("notification:close",this._closeHandler,this),this.add_related_model(this._notification)},_closeHandler:function(){this.clean()},_getInfo:function(){var a=this._userModel.getMaxConcurrentImports(),b=!this._configModel.get("cartodb_com_hosted")&&1===a;return e({upgradeUrl:window.upgrade_url,isUpgradeable:b,importQuota:a})}})},{"../../components/notifier/notifier":475,"./background-import-limit.tpl":4,"backbone/core-view":1127}],4:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",__p+=isUpgradeable?"\n"+(null==(__t=_t("components.background-importer.background-import-limit.hurry",{upgradeUrl:upgradeUrl}))?"":_.escape(__t))+"\n":"\n"+(null==(__t=_t("components.background-importer.background-import-limit.one-file",{importQuota:importQuota}))?"":_.escape(__t))+"\n",__p+="\n";return __p}},{underscore:"underscore"}],5:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./background-import-item-view"),g=a("./background-import-limit-view"),h=a("../../data/background-importer/imports-model"),i=function(a){this.options=a||{},this._importers={},this.initialize(this.options)};i.prototype={initialize:function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.modals)throw new Error("modals is required");if(!a.pollingModel)throw new Error("pollingModel is required");this._userModel=a.userModel,this._configModel=a.configModel,this._createVis=a.createVis,this._modals=a.modals,this._model=a.pollingModel,this._initBinds()},addView:function(a){this._importers[a.cid]=a},removeView:function(a){delete this._importers[a.cid]},enable:function(){this._model.startPollings()},disable:function(){this._model.stopPollings()},removeImport:function(a){this._model.removeImportItem(a)},destroy:function(){this._model.off(null,null,this)},_initBinds:function(){this._model.on("importAdded",this._addImport,this),this._model.on("importByUploadData",this._addDataset,this)},_addImport:function(a){var b=new f({configModel:this._configModel,showSuccessDetailsButton:this._model.get("showSuccessDetailsButton"),modals:this._modals,importModel:a,userModel:this._userModel});b.on("remove",this._removeImport,this),this.addView(b),this.enable()},_addDataset:function(a){a&&this._addImportsItem(a)},_onDroppedFile:function(a){a&&this._addImportsItem({type:"file",value:a,create_vis:this._createVis})},_addImportsItem:function(a){if(!this._model.canAddImport())return this._addLimitItem(),!1;this._removeLimitItem();var b=new h({},{upload:a,userModel:this._userModel,configModel:this._configModel});this._model.addImportItem(b)},_addLimitItem:function(){if(!this._importLimit){var a=new g({configModel:this._configModel,userModel:this._userModel});this.addView(a),this._importLimit=a}},_removeLimitItem:function(){var a=this._importLimit;a&&(a.clean(),this.removeView(a),delete this._importLimit)},_removeImport:function(a,b){this._model.removeImportItem(a),this.removeView(b)}},e.extend(i.prototype,d.Events,{remove:function(){this.stopListening()}});var j=function(){var a,b=!1;return{init:function(c){return b||(a=new i(c)),a}}}();b.exports=j},{"../../data/background-importer/imports-model":612,"./background-import-item-view":2,"./background-import-limit-view":3,backbone:"backbone",underscore:"underscore"}],6:[function(a,b,c){function d(){return"show_errors"}function e(){return _t("components.background-importer.background-importer-item.show")}function f(){return!0}function g(a){var b={info:a,status:i,closable:f(),button:e(),action:d()};h.update(b)}var h,i,j=a("./failed.tpl");b.exports=function(a,b,c,d,e){h=b,i=c,g(j(d))}},{"./failed.tpl":7}],7:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+(null==(__t=_t("components.background-importer.background-importer-item.error-connecting",{name:name}))?"":__t)+" ",service&&(__p+=" "+(null==(__t=_t("components.background-importer.background-importer-item.from"))?"":_.escape(__t))+" "+(null==(__t=service)?"":_.escape(__t))+" "),__p+="";return __p}},{underscore:"underscore"}],8:[function(a,b,c){function d(){return!1}function e(){return!1}function f(){var a=h.get("state"),b=h.get("step");return"uploading"===a&&"upload"===b}function g(a){var b={info:a,status:j,closable:f(),button:e(),action:d()};i.update(b)}var h,i,j,k=a("./loading.tpl");b.exports=function(a,b,c,d,e){h=a,i=b,j=c,g(k(d))}},{"./loading.tpl":9}],9:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='CDB-Text is-semibold'>"+(null==(__t=progress)?"":_.escape(__t))+"% "+(null==(__t=state)?"":_.escape(__t))+"</span> "+(null==(__t=name)?"":_.escape(__t))+" ",service&&"twitter_search"!=service&&(__p+=" "+(null==(__t=_t("components.background-importer.background-importer-item.from"))?"":_.escape(__t))+" "+(null==(__t=service)?"":_.escape(__t))+" "),__p+="";return __p}},{underscore:"underscore"}],10:[function(a,b,c){function d(){var a=h.get("upload").service_name,b=h.get("import").tables_created_count;if(k){if(a&&"twitter_search"===a)return"show_stats";if(1===b)return"show_table"}return!1}function e(){var a=h.get("upload").service_name,b=h.get("import").tables_created_count;if(k){if(a&&"twitter_search"===a)return _t("components.background-importer.background-importer-item.show");if(1===b)return _t("components.background-importer.background-importer-item.show")}return!1}function f(){return!0}function g(a){var b={info:a,status:j,closable:f(),button:e(),action:d()};i.update(b)}var h,i,j,k,l=a("./success.tpl");b.exports=function(a,b,c,d,e){h=a,i=b,j=c,k=e,g(l(d))}},{"./success.tpl":11}],11:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+(null==(__t=name)?"":_.escape(__t))+" ",service&&"twitter_search"!=service&&(__p+=" "+(null==(__t=_t("components.background-importer.background-importer-item.from"))?"":_.escape(__t))+" "+(null==(__t=service)?"":_.escape(__t))+" "),__p+=" <span class='CDB-Text is-semibold'>"+(null==(__t=_t("components.background-importer.background-importer-item.completed"))?"":_.escape(__t))+"</span>";return __p}},{underscore:"underscore"}],12:[function(a,b,c){function d(){return"show_warnings"}function e(){return _t("components.background-importer.background-importer-item.show")}function f(){return!0}function g(a){var b={info:a,status:i,closable:f(),button:e(),action:d()};h.update(b)}var h,i,j=a("./warnings.tpl");b.exports=function(a,b,c,d,e){h=b,i=c,g(j(d))}},{"./warnings.tpl":13}],13:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='CDB-Text is-semibold'>Some warnings</span> were produced for "+(null==(__t=name)?"":_.escape(__t))+" ",service&&(__p+=" "+(null==(__t=_t("components.background-importer.background-importer-item.from"))?"":_.escape(__t))+" "+(null==(__t=service)?"":_.escape(__t))+" "),__p+="";return __p}},{underscore:"underscore"}],14:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./error-details.tpl"),g=a("./upgrade-errors.tpl"),h=[8001,8005];b.exports=e.extend({initialize:function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.error)throw new Error("error is required");this._userModel=a.userModel,this._configModel=a.configModel,this._error=a.error},render:function(){var a=d.contains(h,this._error.errorCode),b=this._configModel.get("upgrade_url"),c=b&&!this._configModel.get("cartodb_com_hosted")&&(!this._userModel.isInsideOrg()||this._userModel.isOrgOwner()),e=this._getTemplate(a),f=e({errorCode:this._error.errorCode,title:this._error.title,text:this._error.what_about,itemQueueId:this._error.item_queue_id,originalUrl:this._error.originalUrl,httpResponseCode:this._error.httpResponseCode,httpResponseCodeMessage:this._error.httpRresponseCodeMessage,userCanUpgrade:c,showTrial:this._userModel.canStartTrial(),upgradeUrl:b});return this.$el.html(f),this},_getTemplate:function(a){var b=f;return a&&(b=g),b}})},{"./error-details.tpl":15,"./upgrade-errors.tpl":18,"backbone/core-view":1127,underscore:"underscore"}],15:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Dialog-header">\n  <div class="Dialog-headerIcon Dialog-headerIcon--negative u-flex u-alignCenter u-justifyCenter">\n    <i class="CDB-IconFont CDB-IconFont-cloud"></i>\n  </div>\n  <h2 class="CDB-Text CDB-Size-large u-bSpace u-errorTextColor">\n    '+(null==(__t=title)?"":_.escape(__t))+" ",errorCode&&(__p+="("+(null==(__t=errorCode)?"":_.escape(__t))+")"),__p+='\n  </h2>\n  <h3 class="CDB-Text CDB-Size-medium u-secondaryTextColor">\n    ',__p+=itemQueueId?"\n    "+(null==(__t=_t("components.background-importer.error-details.dont-panic"))?"":_.escape(__t))+"\n    ":"\n    "+(null==(__t=_t("components.background-importer.error-details.check-errors"))?"":_.escape(__t))+"\n    ",__p+='\n  </h3>\n</div>\n\n<div class="Dialog-body ErrorDetails-body">\n  <ul class="Modal-containerList">\n    ',httpResponseCode?__p+='\n      <li class="ErrorDetails-item">\n        <div class="ErrorDetails-itemStep CDB-Text CDB-Size-medium is-semibold u-flex u-alignCenter u-justifyCenter">1</div>\n        <div class="ErrorDetails-itemText">\n          <p class="CDB-Text CDB-Size-medium">\n            '+(null==(__t=_t("components.background-importer.error-details.remote-server-code",{httpResponseCode:httpResponseCode}))?"":__t)+" "+(null==(__t=httpResponseCodeMessage)?"":_.escape(__t))+'\n          </p>\n        </div>\n      </li>\n      <li class="ErrorDetails-item">\n        <div class="ErrorDetails-itemStep CDB-Text CDB-Size-medium is-semibold u-flex u-alignCenter u-justifyCenter">2</div>\n        <div class="ErrorDetails-itemText">\n          <p class="CDB-Text CDB-Size-medium">\n            '+(null==(__t=_t("components.background-importer.error-details.check-url"))?"":_.escape(__t))+":<br/>\n          </p>\n          <span class='CDB-Text CDB-Size-medium ErrorDetails-itemTextStrong'><a href=\""+(null==(__t=originalUrl)?"":_.escape(__t))+'">'+(null==(__t=originalUrl)?"":_.escape(__t))+"</a></span>\n        </div>\n      </li>\n    ":(__p+='\n      <li class="ErrorDetails-item">\n        <div class="ErrorDetails-itemStep CDB-Text CDB-Size-medium is-semibold u-flex u-alignCenter u-justifyCenter">1</div>\n        <div class="ErrorDetails-itemText">\n          <p class="CDB-Text CDB-Size-medium">\n            ',__p+=text?"\n            "+(null==(__t=cdb.core.sanitize.html(text))?"":__t)+"\n            ":"\n            "+(null==(__t=_t("components.background-importer.error-details.unknown-error"))?"":_.escape(__t))+"\n            ",__p+="\n          </p>\n        </div>\n      </li>\n    "),__p+="\n    ",itemQueueId&&(__p+='\n      <li class="ErrorDetails-item">\n        <div class="ErrorDetails-itemStep CDB-Text CDB-Size-medium is-semibold u-flex u-alignCenter u-justifyCenter">!</div>\n        <div class="ErrorDetails-itemText">\n          <p class="CDB-Text CDB-Size-medium">\n            '+(null==(__t=_t("components.background-importer.error-details.send-us-the-error-code"))?"":__t)+':<br/>\n          </p>\n          <span class="CDB-Text CDB-Size-medium ErrorDetails-itemTextStrong">'+(null==(__t=itemQueueId)?"":_.escape(__t))+"</span>\n        </div>\n      </li>\n    "),__p+='\n  </ul>\n</div>\n\n\n<div class="Dialog-footer--simple u-inner">\n  <button class="CDB-Button CDB-Button--error u-tSpace--m js-close">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n      '+(null==(__t=_t("components.background-importer.error-details.close"))?"":_.escape(__t))+"\n    </span>\n  </button>\n</div>";return __p}},{underscore:"underscore"}],16:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../helpers/utils"),f=a("./twitter-import-details.tpl");b.exports=d.extend({className:"TwitterImportDetails",events:{"click .js-close":"_onCloseClick"},initialize:function(a){if(!a.modalModel)throw new Error("modalModel is required");if(!a.userModel)throw new Error("userModel is required");this._userModel=a.userModel,this._modalModel=a.modalModel},render:function(){var a=this.model.get("import"),b=this._userModel.get("twitter"),c=b.quota-b.monthly_use;return this.$el.html(f({datasetTotalRows:a.tweets_georeferenced,datasetTotalRowsFormatted:e.formatNumber(a.tweets_georeferenced),tweetsCost:a.tweets_cost,tweetsCostFormatted:e.formatNumber(a.tweets_cost),availableTweets:c,availableTweetsFormatted:e.formatNumber(c),tweetsOverquota:a.tweets_overquota,tweetsOverquotaFormatted:e.formatNumber(a.tweets_overquota),blockSizeFormatted:e.formatNumber(b.block_size),blockPriceFormatted:e.formatNumber(b.block_price)})),this},_onCloseClick:function(){this._modalModel.destroy()}})},{"../../helpers/utils":1102,"./twitter-import-details.tpl":17,"backbone/core-view":1127}],17:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Dialog-header">\n  <div class="Dialog-headerIcon Dialog-headerIcon--twitter u-flex u-alignCenter u-justifyCenter">\n    <i class="CDB-IconFont CDB-IconFont-twitter"></i>\n  </div>\n  <h2 class="CDB-Text CDB-Size-large u-bSpace Dialog-headerIcon--twitter">\n    '+(null==(__t=_t("components.background-importer.twitter-import-details.twitter-import-title"))?"":_.escape(__t))+'\n  </h2>\n  <h3 class="CDB-Text CDB-Size-medium u-altTextColor">\n    ',__p+=0===datasetTotalRows?"\n      "+(null==(__t=_t("components.background-importer.twitter-import-details.errors.no-results"))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.background-importer.twitter-import-details.new-type-created",{datasetTotalRowsFormatted:datasetTotalRowsFormatted,tweetPlural:1!=datasetTotalRows?"s":""}))?"":__t)+"\n    ",__p+='\n  </h3>\n</div>\n\n<div class="Dialog-body ErrorDetails-body">\n  <ul class="Modal-containerList">\n    <li class="ErrorDetails-item">\n      <div class="ErrorDetails-itemIcon ErrorDetails-itemIcon--success CDB-Size-big u-flex u-alignCenter u-justifyCenter u-rSpace--xl">\n        <i class="CDB-IconFont CDB-IconFont-dollar"></i>\n      </div>\n      <div class="ErrorDetails-itemText">\n        <p class="CDB-Text CDB-Size-large u-secondaryTextColor">\n          ',__p+=tweetsCost>0?"\n            "+(null==(__t=_t("components.background-importer.twitter-import-details.tweet-cost.paid",{tweetsCostFormatted:tweetsCostFormatted}))?"":_.escape(__t))+"\n          ":"\n            "+(null==(__t=_t("components.background-importer.twitter-import-details.tweet-cost.free",{tweetsCostFormatted:tweetsCostFormatted}))?"":_.escape(__t))+"\n          ",__p+='\n        </p>\n        <p class="CDB-Text CDB-Size-medium u-altTextColor">\n          ',tweetsCost>0||availableTweets<=0?__p+="\n            "+(null==(__t=_t("components.background-importer.twitter-import-details.no-more-credits",{blockPriceFormatted:blockPriceFormatted,blockSizeFormatted:blockSizeFormatted}))?"":_.escape(__t))+"\n          ":(__p+="\n            ",__p+=1!=availableTweets?"\n              "+(null==(__t=_t("components.background-importer.twitter-import-details.credits-left",{availableTweetsFormatted:availableTweetsFormatted}))?"":_.escape(__t))+"\n            ":"\n              "+(null==(__t=_t("components.background-importer.twitter-import-details.credit-left",{availableTweetsFormatted:availableTweetsFormatted}))?"":_.escape(__t))+"\n            ",__p+="\n          "),__p+='\n        </p>\n      </div>\n    </li>\n  </ul>\n</div>\n\n<div class="Dialog-footer--simple u-inner">\n  <button class="CDB-Button CDB-Button--primary u-tSpace--m">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase js-close">\n      '+(null==(__t=_t("components.background-importer.error-details.close"))?"":_.escape(__t))+"\n    </span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],18:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Dialog-header">\n  <div class="Dialog-headerIcon Dialog-headerIcon--negative u-flex u-alignCenter u-justifyCenter">\n    <i class="CDB-IconFont CDB-IconFont-barometer"></i>\n  </div>\n  <h2 class="CDB-Text CDB-Size-large u-bSpace u-errorTextColor">\n    '+(null==(__t=_t("components.background-importer.upgrade-errors."+errorCode+".title"))?"":_.escape(__t))+'\n  </h2>\n  <h3 class="CDB-Text CDB-Size-medium u-secondaryTextColor">\n    '+(null==(__t=_t("components.background-importer.upgrade-errors."+errorCode+".description"))?"":_.escape(__t))+'\n  </h3>\n</div>\n\n<div class="Dialog-body ErrorDetails-body">\n  <ul class="Modal-containerList">\n    <li class="ErrorDetails-item">\n      <div class="ErrorDetails-itemIcon ErrorDetails-itemIcon--success CDB-Size-big u-flex u-alignCenter u-justifyCenter u-rSpace--xl">\n        <i class="CDB-IconFont CDB-IconFont-rocket"></i>\n      </div>\n      <div class="ErrorDetails-itemText">\n        <p class="CDB-Text CDB-Size-medium">\n          '+(null==(__t=_t("components.background-importer.upgrade-errors."+errorCode+".info"))?"":_.escape(__t))+"\n          ",showTrial&&(__p+='\n            <br/>\n            <a href="'+(null==(__t=upgradeUrl)?"":__t)+'">'+(null==(__t=_t("components.background-importer.free-trial",{days:14}))?"":_.escape(__t))+"</a>\n          "),__p+='\n        </p>\n      </div>\n    </li>\n  </ul>\n</div>\n\n<div class="Dialog-footer--simple u-inner">\n  <a href="'+(null==(__t=upgradeUrl)?"":_.escape(__t))+'" class="CDB-Button CDB-Button--primary u-tSpace--m">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n      '+(null==(__t=_t("components.background-importer.upgrade-errors.upgrade"))?"":_.escape(__t))+"\n    </span>\n  </a>\n</div>\n";return __p}},{underscore:"underscore"}],19:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Dialog-header ErrorDetails-header">\n  <div class="Dialog-headerIcon Dialog-headerIcon--alert">\n    <i class="CDB-IconFont CDB-IconFont-cloud"></i>\n  </div>\n  <p class="Dialog-headerTitle--warning">\n    '+(null==(__t=_t("components.background-importer.partial-import-details.unable-to-import-as-layers"))?"":_.escape(__t))+'\n  </p>\n  <p class="Dialog-headerText">\n    '+(null==(__t=_t("components.background-importer.partial-import-details.find-connected-datasets"))?"":_.escape(__t))+"</br>\n    "+(null==(__t=_t("components.background-importer.partial-import-details.upgrade-your-account",{userMaxLayers:userMaxLayers}))?"":_.escape(__t))+"</br>\n  </p>\n</div>\n",maxTablesPerImport&&(__p+='\n  <div class="Dialog-body ErrorDetails-body">\n    <ul class="ErrorDetails-list">\n      <li class="ErrorDetails-item">\n        <div class="ErrorDetails-itemStep">!</div>\n        <div class="ErrorDetails-itemText">\n          '+(null==(__t=_t("components.background-importer.partial-import-details.too-many-datasets",{maxTablesPerImport:maxTablesPerImport}))?"":_.escape(__t))+"</br>\n        </div>\n      </li>\n    </ul>\n  </div>\n"),__p+='\n<div class="Dialog-footer ErrorDetails-footer">\n  <button class="Button Button--secondary ErrorDetails-footerButton js-close">\n    <span>'+(null==(__t=_t("components.background-importer.partial-import-details.continue-btn"))?"":_.escape(__t))+"</span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],20:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Dialog-header ErrorDetails-header">\n  <div class="Dialog-headerIcon Dialog-headerIcon--alert">\n    <i class="CDB-IconFont CDB-IconFont-cloud"></i>\n  </div>\n  <p class="Dialog-headerTitle--warning">\n    '+(null==(__t=_t("components.background-importer.warnings-details.unable-to-import-datasets"))?"":_.escape(__t))+'\n  </p>\n  <p class="Dialog-headerText">\n    '+(null==(__t=_t("components.background-importer.warnings-details.no-more-datasets",{maxTablesPerImport:maxTablesPerImport}))?"":_.escape(__t))+"<br />\n    "+(null==(__t=_t("components.background-importer.warnings-details.find-connected-datasets"))?"":_.escape(__t))+'\n  </p>\n</div>\n<div class="Dialog-footer ErrorDetails-footer">\n  <button class="Button Button--secondary ErrorDetails-footerButton u-upperCase js-close">\n    <span>'+(null==(__t=_t("components.background-importer.warnings-details.continue-btn"))?"":_.escape(__t))+"</span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],21:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Dialog-header ErrorDetails-header">\n  <div class="Dialog-headerIcon Dialog-headerIcon--alert">\n    <i class="CDB-IconFont CDB-IconFont-cloud"></i>\n  </div>\n  <p class="Dialog-headerTitle--warning">\n    '+(null==(__t=_t("components.background-importer.connector-warning-details.too-many-rows"))?"":_.escape(__t))+'\n  </p>\n  <p class="Dialog-headerText">\n    '+(null==(__t=_t("components.background-importer.connector-warning-details.unable-to-import-all-rows",{maxRowsPerConnectorImport:maxRowsPerConnectorImport}))?"":_.escape(__t))+'<br />\n  </p>\n</div>\n<div class="Dialog-footer ErrorDetails-footer">\n  <button class="Button Button--secondary ErrorDetails-footerButton u-upperCase js-close">\n    <span>'+(null==(__t=_t("components.background-importer.connector-warning-details.continue-btn"))?"":_.escape(__t))+"</span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],22:[function(a,b,c){var d=a("backbone/core-view"),e=a("./warning-partial-import-details.tpl"),f=a("./warning-too-many-files-details.tpl"),g=a("./warning-too-many-rows-connector-details.tpl");b.exports=d.extend({initialize:function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.warnings)throw new Error("warnings is required");this._userModel=this.options.userModel,this._warnings=this.options.warnings},render:function(){var a=this._warnings,b=this._getTemplate(a);return this.$el.html(b({userMaxLayers:a.user_max_layers,maxTablesPerImport:a.max_tables_per_import,maxRowsPerConnectorImport:a.max_rows_per_connection})),this},_getTemplate:function(a){return a.user_max_layers&&a.max_tables_per_import?a.user_max_layers<a.max_tables_per_import?e:f:a.user_max_layers?e:a.max_tables_per_import?f:a.max_rows_per_connection?g:void 0}})},{"./warning-partial-import-details.tpl":19,"./warning-too-many-files-details.tpl":20,"./warning-too-many-rows-connector-details.tpl":21,"backbone/core-view":1127}],23:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./custom-carousel/custom-carousel-view");b.exports=e.extend({initialize:function(a){if(!a.collection)throw new Error("Carousel collection is required");if(!a.template)throw new Error("template is required");this.template=a.template,this._initBinds()},render:function(){var a=this.collection.getSelected(),b=a&&a.getName();return this.$el.html(this.template({name:b})),this._initViews(),this},_initBinds:function(){this.collection.bind("change:highlighted",this._onChangeHighlighted,this)},_initViews:function(){var a=new f(d.extend(this.options,{collection:this.collection}));if(!this.$(".js-selector").length)throw new Error("HTML element with js-selector class is required");this.$(".js-selector").append(a.render().el),a.initScroll(),this.addView(a)},_onChangeHighlighted:function(){var a=this.collection.getHighlighted()||this.collection.getSelected();if(a){var b=this.$(".js-highlight");b&&b.text(a.getName())}}})},{"./custom-carousel/custom-carousel-view":44,"backbone/core-view":1127,underscore:"underscore"}],24:[function(a,b,c){var d=a("../../helpers/color-keywords");b.exports=function(a){a.defineMode("cartocss",function(a){function b(a,b){return k=b,a}function c(a){for(var b=0;b<m.length;b++)if(a===m[b])return!0}function e(a,d){var e=a.next();if("@"===e)return a.eatWhile(/[\w\-]/),b("meta",a.current());if("/"===e&&a.eat("*"))return d.tokenize=h,h(a,d);if("<"===e&&a.eat("!"))return d.tokenize=i,i(a,d);if("="===e)b(null,"compare");else{if("|"===e&&a.eat("="))return b(null,"compare");if("'"===e||"'"===e)return d.tokenize=j(e),d.tokenize(a,d);if("/"===e){if(a.eat("/"))return d.tokenize=g,g(a,d);if("string"===k||"("===k)return b("string","string");if(void 0!==d.stack[d.stack.length-1])return b(null,e);if(a.eatWhile(/[\a-zA-Z0-9\-_.\s]/),/\/|\)|#/.test(a.peek()||a.eatSpace()&&")"===a.peek())||a.eol())return b("string","string")}else{if("!"===e)return a.match(/^\s*\w*/),b("keyword","important");if(/\d/.test(e))return a.eatWhile(/[\w.%]/),b("number","unit");if(/[,+<>*\/]/.test(e))return"="===a.peek()||"a"===k?b("string","string"):b(null,"select-op");if(!/[;{}:\[\]()~\|]/.test(e)){if("."===e)return"("===k||"string"===k?b("string","string"):(a.eatWhile(/[\a-zA-Z0-9\-_]/)," "===a.peek()&&a.eatSpace(),")"===a.peek()?b("number","unit"):b("tag","tag"));
if("#"===e)return a.eatWhile(/[A-Za-z0-9]/),(4===a.current().length||7===a.current().length)&&null!=a.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,!1)?a.current().substring(1)!==a.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,!1)[0]?b("atom","tag"):(a.eatSpace(),/[\/<>.({!$%^&*_\-\\?=+\|#'~`]/.test(a.peek())?b("atom","tag"):"}"===a.peek()?b("color","unit"):/[a-zA-Z\\]/.test(a.peek())?b("color","unit"):a.eol()?b("color","unit"):b("color","unit")):(a.eatWhile(/[\w\\\-]/),b("atom","tag"));if("&"===e)return a.eatWhile(/[\w\-]/),b(null,e);if(a.eatWhile(/[\w\\\-_%.{]/),"string"===k)return b("string","string");if(null!=a.current().match(/(^http$|^https$)/))return a.eatWhile(/[\w\\\-_%.{:\/]/),b("string","string");if("<"===a.peek()||">"===a.peek())return b("tag","tag");if(/\(/.test(a.peek()))return b(null,e);if("/"===a.peek()&&void 0!==d.stack[d.stack.length-1])return b("string","string");if(a.current().match(/\-\d|\-.\d/))return b("number","unit");if(c(a.current().toLowerCase()))return b("tag","tag");if(/\/|[\s\)]/.test(a.peek()||a.eol()||a.eatSpace()&&"/"===a.peek())&&a.current().indexOf(".")!==-1)return"{"===a.current().substring(a.current().length-1,a.current().length)?(a.backUp(1),b("tag","tag")):(a.eatSpace(),/[{<>.a-zA-Z\/]/.test(a.peek())||a.eol()?b("tag","tag"):b("string","string"));if(a.eol()||"["===a.peek()||"#"===a.peek()||"tag"===k)return"{"===a.current().substring(a.current().length-1,a.current().length)&&a.backUp(1),b("tag","tag");if("compare"===k||"a"===k||"("===k)return b("string","string");if("|"===k||"-"===a.current()||"["===k)return b(null,e);if(":"===a.peek()){a.next();var f=":"===a.peek();if(f)a.backUp(1);else{var l=a.pos,m=a.current().length;a.eatWhile(/[a-z\\\-]/);var p=a.pos;if(null!=a.current().substring(m-1).match(o))return a.backUp(p-(l-1)),b("tag","tag");a.backUp(p-(l-1))}return f?b("tag","tag"):b("variable","variable")}return n.hasOwnProperty(a.current())?b("color","unit"):b("variable","variable")}if(":"===e)return a.eatWhile(/[a-z\\\-]/),o.test(a.current())?b("tag","tag"):":"===a.peek()?(a.next(),a.eatWhile(/[a-z\\\-]/),a.current().match(/\:\:\-(o|ms|moz|webkit)\-/)?b("string","string"):o.test(a.current().substring(1))?b("tag","tag"):b(null,e)):b(null,e);if("~"!==e)return b(null,e);if("r"===k)return b("string","string")}}}function f(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=!0;return b}function g(a,c){return a.skipToEnd(),c.tokenize=e,b("comment","comment")}function h(a,c){for(var d,f=!1;null!=(d=a.next());){if(f&&"/"===d){c.tokenize=e;break}f="*"===d}return b("comment","comment")}function i(a,c){for(var d,f=0;null!=(d=a.next());){if(f>=2&&">"===d){c.tokenize=e;break}f="-"===d?f+1:0}return b("comment","comment")}function j(a){return function(c,d){for(var f,g=!1;null!=(f=c.next())&&(f!==a||g);)g=!g&&"\\"===f;return g||(d.tokenize=e),b("string","string")}}var k,l=a.indentUnit,m="a abbr acronym address applet area article aside audio b base basefont bdi bdo big blockquote body br button canvas caption cite code col colgroup command datalist dd del details dfn dir div dl dt em embed fieldset figcaption figure font footer form frame frameset h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins keygen kbd label legend li link map mark menu meta meter nav noframes noscript object ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr track tt u ul var video wbr".split(" "),n=f(d),o=/(^\:root$|^\:nth\-child$|^\:nth\-last\-child$|^\:nth\-of\-type$|^\:nth\-last\-of\-type$|^\:first\-child$|^\:last\-child$|^\:first\-of\-type$|^\:last\-of\-type$|^\:only\-child$|^\:only\-of\-type$|^\:empty$|^\:link|^\:visited$|^\:active$|^\:hover$|^\:focus$|^\:target$|^\:lang$|^\:enabled^\:disabled$|^\:checked$|^\:first\-line$|^\:first\-letter$|^\:before$|^\:after$|^\:not$|^\:required$|^\:invalid$)/;return{startState:function(a){return{tokenize:e,baseIndent:a||0,stack:[]}},token:function(a,b){if(a.eatSpace())return null;var c=b.tokenize(a,b),d=b.stack[b.stack.length-1];return"hash"===k&&"rule"===d?c="atom":"variable"===c&&("rule"===d?c=null:d&&"@media{"!==d||(c="when"===a.current()?"variable":/[\s,|\s\)|\s]/.test(a.peek())?"tag":k)),"rule"===d&&/^[\{\};]$/.test(k)&&b.stack.pop(),"{"===k?"@media"===d?b.stack[b.stack.length-1]="@media{":b.stack.push("{"):"}"===k?b.stack.pop():"@media"===k?b.stack.push("@media"):"{"===d&&"comment"!==k&&b.stack.push("rule"),c},indent:function(a,b){var c=a.stack.length;return/^\}/.test(b)&&(c-="rule"===a.stack[a.stack.length-1]?2:1),a.baseIndent+c*l},electricChars:"}"}}),a.defineMIME("text/x-carto","cartocss")}},{"../../helpers/color-keywords":1089}],25:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<i class="CodeMirror-bullet"></i>';return __p}},{underscore:"underscore"}],26:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="CodeMirror-error">\n  <li class="CodeMirror-errorMessage u-lSpace--xl u-rSpace--xl">\n    '+(null==(__t=_t("components.codemirror.syntax-error"))?"":_.escape(__t))+". "+(null==(__t=_t("components.codemirror.line"))?"":_.escape(__t))+" "+(null==(__t=line)?"":_.escape(__t))+": <span>"+(null==(__t=message)?"":_.escape(__t))+"</span>\n  </li>\n</ul>\n";return __p}},{underscore:"underscore"}],27:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("codemirror"),g=a("./colorpicker.code-mirror"),h=a("./code-mirror.tpl"),i=a("./code-mirror-bullet.tpl"),j=a("./code-mirror-error.tpl");a("./mode/sql")(f),a("./mode/mustache")(f),a("./cartocss.code-mirror")(f),a("./scroll.code-mirror")(f),a("./show-hint.code-mirror")(f),a("./hint/custom-list-hint")(f),a("./searchcursor.code-mirror")(f),a("./placeholder.code-mirror")(f);var k=27,l=13,m=[k,l],n={"color-picker":g};b.exports=d.extend({className:"Editor-content",options:{readonly:!1,lineNumbers:!0,autocompleteChars:3},initialize:function(a){if(!a)throw new Error("options for codemirror are required.");if(!a.model)throw new Error("Model for codemirror is required.");if(void 0===a.model.get("content")&&void 0===a.placeholder)throw new Error("Content property or placeholder for codemirror is required.");if(void 0===a.tip)throw new Error("tip message is required");this._autocompleteChars=a.autocompleteChars||this.options.autocompleteChars,this._mode=a.mode||"cartocss",this._addons=a.addons,this._hints=a.hints,this._autocompletePrefix=a.autocompletePrefix,this._autocompleteTriggers=a.autocompleteTriggers,this._autocompleteSuffix=a.autocompleteSuffix,this._errorTemplate=a.errorTemplate||j,this._tip=a.tip,this._lineWithErrors=[],this._onInputRead=e.bind(this._onKeyUpEditor,this),this._placeholder=a.placeholder},render:function(){return this.$el.html(h({content:this.model.get("content"),tip:this._tip})),this._initViews(),this._bindEvents(),this._showErrors(),this},_initViews:function(){var a=e.defaults(e.extend({},this.model.toJSON()),this.options),b=a.readonly,c=a.lineNumbers,d={"Ctrl-S":this.triggerApplyEvent.bind(this),"Cmd-S":this.triggerApplyEvent.bind(this),"Ctrl-Space":this._completeIfAfterCtrlSpace.bind(this)};this.editor=f.fromTextArea(this.$(".js-editor").get(0),{lineNumbers:c,theme:"material",mode:this._mode,scrollbarStyle:"simple",lineWrapping:!0,readOnly:b,extraKeys:d,placeholder:this._placeholder}),this.editor.on("change",e.debounce(this._onCodeMirrorChange.bind(this),150),this),e.isEmpty(this._addons)||e.each(this._addons,function(a){var b=n[a],c=new b({editor:this.editor});c.bind("codeSaved",this.triggerApplyEvent,this),this.$el.append(c.el),this.addView(c)},this),this._hints&&this.editor.on("keyup",this._onInputRead),this._toggleReadOnly(),setTimeout(function(){this.editor.refresh()}.bind(this),0)},_completeIfAfterCtrlSpace:function(a){var b=this._autocompletePrefix,c={},d=a.getCursor();return b&&a.getRange(f.Pos(d.line,d.ch-b.length),d)!==b&&(c={autocompletePrefix:b}),this._completeAfter(a,c)},updateHints:function(a){this._hints=a},_onKeyUpEditor:function(a,b){var c=b.keyCode,d=this._hints,g=this._autocompleteChars-1,h=this._autocompletePrefix;if(m.indexOf(c)===-1){var i=this;this._autocompleteTimeout&&clearTimeout(this._autocompleteTimeout),this._autocompleteTimeout=setTimeout(function(){var b={},c=a.getCursor(),j=a.getTokenAt(c).string;return j=j.toLowerCase(),h&&a.getRange(f.Pos(c.line,c.ch-h.length),c)!==h&&(b={autocompletePrefix:h}),i._completeAfter(a,b,function(){var a=function(a){var b=e.isObject(a)?a.text:a;return b=b.toLowerCase(),b.indexOf(j)!==-1};if(j.length>g){var b=e.filter(d,a);return b.length>0||h&&h===j}})},150)}},_onCodeMirrorChange:function(){this.trigger("codeChanged")},_completeAfter:function(a,b,c){return c&&!c()||a.state.completionActive||this._showAutocomplete(a,e.extend({},b)),f.Pass},_showAutocomplete:function(a,b){var c=b&&b.autocompletePrefix;f.showHint(a,f.hint["custom-list"],{completeSingle:!1,list:this._hints,autocompletePrefix:c,autocompleteSuffix:this._autocompleteSuffix})},_bindEvents:function(){var a=this;this.editor.on("change",function(b,c){a.model.set("content",a.getContent(),{silent:!0})}),this.model.on("change:content",function(){this.setContent(this.model.get("content"))},this),this.model.on("change:readonly",this._toggleReadOnly,this),this.model.on("change:errors",function(){this._showErrors()},this),this.model.on("undo redo",function(){this.setContent(this.model.get("content"))},this)},_toggleReadOnly:function(){var a=!!this.model.get("readonly");this.editor.setOption("readOnly",a),a?(this.editor.setOption("theme",""),this._getInfo().hide()):(this.editor.setOption("theme","material"),this._getInfo().show())},search:function(a,b){var c=this.editor.getSearchCursor(a,null,!0);return c.find(),c.pos},markReadOnly:function(a,b){var c={readOnly:!0,inclusiveLeft:!0};this.editor.markText(a,b,c);for(var d=a.line;d<=b.line;d++)this.editor.addLineClass(d,"background","CodeMirror-readonlyLine")},setContent:function(a){this.editor.setValue(a)},getContent:function(){return this.editor.getValue()},triggerApplyEvent:function(){this.trigger("codeSaved",this.getContent(),this)},destroyEditor:function(){this.editor.off("change");var a=this.editor.getWrapperElement();a.parentNode.removeChild(a)},_getInfo:function(){return this.$(".js-console")},_getConsole:function(){return this.$(".js-console-error")},_getCode:function(){return this.$(".CodeMirror-code")},_removeErrors:function(){this._getConsole().empty(),e.each(this._lineWithErrors,function(a){a.find(".CodeMirror-bullet").remove(),a.find(".CodeMirror-linenumber").removeClass("has-error")}),this._lineWithErrors=[]},_showErrors:function(){var a=this.model.get("errors");this._removeErrors(),a&&a.length>0&&e.each(a,function(a){this._renderError(a),this._renderBullet(a)},this)},_renderBullet:function(a){var b,c=a.line;c&&(b=this._getCode().children().eq(+c-1),b.append(i),b.find(".CodeMirror-linenumber").addClass("has-error"),this._lineWithErrors.push(b))},_renderError:function(a){this._getConsole().append(this._errorTemplate(a))},clean:function(){this.destroyEditor(),d.prototype.clean.apply(this)}})},{"./cartocss.code-mirror":24,"./code-mirror-bullet.tpl":25,"./code-mirror-error.tpl":26,"./code-mirror.tpl":28,"./colorpicker.code-mirror":29,"./hint/custom-list-hint":30,"./mode/mustache":31,"./mode/sql":32,"./placeholder.code-mirror":33,"./scroll.code-mirror":34,"./searchcursor.code-mirror":35,"./show-hint.code-mirror":36,"backbone/core-view":1127,codemirror:"codemirror",underscore:"underscore"}],28:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CodeMirror-editor">\n  <textarea class="js-editor">'+(null==(__t=content)?"":_.escape(__t))+"</textarea>\n</div>\n\n",tip&&(__p+='\n<div class="CodeMirror-console js-console">\n  '+(null==(__t=tip)?"":_.escape(__t))+'\n  <div class="js-console-error"></div>\n</div>\n'),__p+="";return __p}},{underscore:"underscore"}],29:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("underscore"),g=a("../form-components/editors/fill/color-picker/color-picker.js"),h=a("../../helpers/color-keywords"),i=["editor"],j=f.template("1px solid  <%- color %>"),k=220,l=function(a){a.stopPropagation()};b.exports=d.extend({initialize:function(a){f.each(i,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._updateColors=f.debounce(this._updateColors,5).bind(this),this._onDocumentClick=this._onDocumentClick.bind(this),this._editor=a.editor,this._initBinds()},_initBinds:function(){var a=this,b=function(){this._destroyPicker()}.bind(this);this._enableUpdateBind(),this._editor.on("mousedown",function(b,c){f.delay(a._onClick.bind(a,b,c),50)}),this._editor.on("keydown",b),this._editor.on("viewportChange",b),this._editor.on("scroll",b);var c=this._editor.getWrapperElement();c.addEventListener("click",l)},_disableBinds:function(){var a=this._editor.getWrapperElement();a.removeEventListener("click",l),this._editor.off(null,null,this)},_enableUpdateBind:function(){this._editor.on("update",this._updateColors)},_disableUpdateBind:function(){this._editor.off("update",this._updateColors)},_onClick:function(a,b){var c=this._editor.getCursor(!0),d=this._editor.getTokenAt(c);"color"===d.type?this._createPicker(b,c,d):this._destroyPicker()},_updateColors:function(a){var b=a.getWrapperElement();f.each(b.querySelectorAll(".cm-color"),function(a){this._paintColor(a.textContent,a)},this)},_replaceColor:function(a,b){var c,d,e=this._editor.getCursor(),g=this._getMatch(e,"name"),h=this._getMatch(e,"hex"),i=g||h;if(i){c={line:e.line,ch:i.start},d={line:e.line,ch:i.end},this._editor.replaceRange(a,c,d,"paste");var j=this._editor.getWrapperElement();f.each(j.querySelectorAll(".cm-color"),function(a){var b=a.style,c=a.innerText;b&&b.borderBottom||this._paintColor(c,a)},this)}},_paintColor:function(a,b){b.style.borderBottom=j({color:a})},_getMatch:function(a,b){if(b){var c;switch(b.toLowerCase()){case"name":c=new RegExp(h.join("|"),"g");break;case"hsl":c=/hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)/g;break;case"rgb":c=/rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)/;break;case"hex":c=/#[a-fA-F0-9]{3,6}/g;break;default:return void console.log("Invalid color match selection")}for(var d=this._editor.getLine(a.line),e=c.exec(d);e;){var f=e[0],g=f.length,i=e.index,j=e.index+g;if(a.ch>=i&&a.ch<=j)return e=null,{start:i,end:j,string:f};e=c.exec(d)}}},_createPicker:function(a,b,c){var d=this._editor.cursorCoords();this._destroyPicker(),this._colorPicker=new g({className:"Editor-boxModal ColorPicker--cm Editor-boxModal--darked Editor-FormDialog CDB-Text",value:c.string,disableOpacity:!0}),this._colorPicker.$el.attr("data-colorpicker-cid",this.cid),this._colorPicker.bind("change",f.debounce(this._onColorPickerChange.bind(this,a),5),this);var h=d.top+20,i=e(window).outerHeight();h+k>i&&(h=d.top-k-20),this._colorPicker.$el.css({left:d.left,top:h}),document.body.appendChild(this._colorPicker.render().el),document.addEventListener("click",this._onDocumentClick)},_onDocumentClick:function(a){var b=e(a.target);0===b.closest('[data-colorpicker-cid="'+this.cid+'"]').length&&this._destroyPicker()},_onColorPickerChange:function(a,b){this._disableUpdateBind(),this._replaceColor(b.hex,a.target),this.trigger("codeSaved"),this._enableUpdateBind()},_destroyPicker:function(){this._colorPicker&&(this.removeView(this._colorPicker),this._colorPicker.clean(),delete this._colorPicker),document.removeEventListener("click",this._onDocumentClick)},clean:function(){this._disableBinds(),d.prototype.clean.call(this)}})},{"../../helpers/color-keywords":1089,"../form-components/editors/fill/color-picker/color-picker.js":99,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],30:[function(a,b,c){var d=a("underscore");b.exports=function(a){function b(a,b){return a.indexOf(b)!==-1}function c(b,c,d,e){var h=b.getCursor(),i=d(b,h),j=i;for(i.state=a.innerMode(b.getMode(),i.state).state,/^[\w$_-]*$/.test(i.string)||(i=j={start:h.ch,end:h.ch,string:"",state:i.state,type:"."===i.string?"property":null});"property"===j.type;){if(j=d(b,g(h.line,j.start)),"."!==j.string)return;if(j=d(b,g(h.line,j.start)),")"===j.string){var k=1;do switch(j=d(b,g(h.line,j.start)),j.string){case")":k++;break;case"(":k--}while(k>0);if(j=d(b,g(h.line,j.start)),0!==j.type.indexOf("variable"))return;j.type="function"}if(!l)var l=[];l.push(j)}return{list:f(i,l,c,e),from:g(h.line,i.start),to:g(h.line,i.end)}}function e(a,b){return c(a,[],function(a,b){return a.getTokenAt(b)},b)}function f(a,c,e,f){function g(a){var c=d.isObject(a)?a.text:a;c=c.toLowerCase(),0!==c.indexOf(j)||j===c||b(i,c)||i.push(a)}function h(a){for(var b in a)g(a[b])}var i=[],j=a.string.toLowerCase();return h(f.list),d.each(e,g),i}var g=a.Pos;a.registerHelper("hint","custom-list",e)}},{underscore:"underscore"}],31:[function(a,b,c){b.exports=function(a){a.defineMode("mustache",function(){return{token:function(a,b){var c;if(a.match("{{")){if(c=a.peek(),null==c||null!=c&&c.match(/[{]{1,}/))return a.next(),"mustache-error";if(null!=c&&c.match(/[a-zA-Z\u00C0-\u024F_]+/))return null}if(a.match("}}")){if(c=a.peek(),null!=c&&c.match(/[}]{1,}/))return a.next(),"mustache-error";if(null==c)return null}return a.match("}")&&(c=a.peek(),null==c||null!=c&&c.match(/[}]{1,}/))?(a.next(),"mustache-error"):a.match("{")&&(c=a.peek(),null==c||null!=c&&c.match(/[{]{1,}/))?(a.next(),"mustache-error"):a.match(/[a-zA-Z\u00C0-\u024F_]+/,!0)?"mustache-text":void a.next()}}}),function(){function b(a){for(var b={},c=a.split(" "),d=0;d<c.length;++d)b[c[d]]=!0;return b}var c="{{  }}";a.defineMIME("text/mustache",{name:"mustache",client:b("source"),keywords:b(c)})}()}},{}],32:[function(a,b,c){b.exports=function(a){"use strict";a.defineMode("sql",function(b,c){function d(a,b){var c=a.next();if(o[c]){var d=o[c](a,b);if(d!==!1)return d}if(1==n.hexNumber&&("0"==c&&a.match(/^[xX][0-9a-fA-F]+/)||("x"==c||"X"==c)&&a.match(/^'[0-9a-fA-F]+'/)))return"number";if(1==n.binaryNumber&&(("b"==c||"B"==c)&&a.match(/^'[01]+'/)||"0"==c&&a.match(/^b[01]+/)))return"number";if(c.charCodeAt(0)>47&&c.charCodeAt(0)<58)return a.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/),1==n.decimallessFloat&&a.eat("."),"number";if("?"==c&&(a.eatSpace()||a.eol()||a.eat(";")))return"variable-3";if("'"==c||'"'==c&&n.doubleQuote)return b.tokenize=e(c),b.tokenize(a,b);if((1==n.nCharCast&&("n"==c||"N"==c)||1==n.charsetCast&&"_"==c&&a.match(/[a-z][a-z0-9]*/i))&&("'"==a.peek()||'"'==a.peek()))return"keyword";if(/^[\(\),\;\[\]]/.test(c))return null;if(n.commentSlashSlash&&"/"==c&&a.eat("/"))return a.skipToEnd(),"comment";if(n.commentHash&&"#"==c||"-"==c&&a.eat("-")&&(!n.commentSpaceRequired||a.eat(" ")))return a.skipToEnd(),"comment";if("/"==c&&a.eat("*"))return b.tokenize=f,b.tokenize(a,b);if("."!=c){if(m.test(c))return a.eatWhile(m),null;if("{"==c&&(a.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||a.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";a.eatWhile(/^[_\w\d]/);var g=a.current().toLowerCase();return p.hasOwnProperty(g)&&(a.match(/^( )+'[^']*'/)||a.match(/^( )+"[^"]*"/))?"number":j.hasOwnProperty(g)?"atom":k.hasOwnProperty(g)?"builtin":l.hasOwnProperty(g)?"keyword":i.hasOwnProperty(g)?"string-2":null}return 1==n.zerolessFloat&&a.match(/^(?:\d+(?:e[+-]?\d+)?)/i)?"number":1==n.ODBCdotTable&&a.match(/^[a-zA-Z_]+/)?"variable-2":void 0}function e(a){return function(b,c){for(var e,f=!1;null!=(e=b.next());){if(e==a&&!f){c.tokenize=d;break}f=!f&&"\\"==e}return"string"}}function f(a,b){for(;;){if(!a.skipTo("*")){a.skipToEnd();break}if(a.next(),a.eat("/")){b.tokenize=d;break}}return"comment"}function g(a,b,c){b.context={prev:b.context,indent:a.indentation(),col:a.column(),type:c}}function h(a){a.indent=a.context.indent,a.context=a.context.prev}var i=c.client||{},j=c.atoms||{false:!0,true:!0,null:!0},k=c.builtin||{},l=c.keywords||{},m=c.operatorChars||/^[*+\-%<>!=&|~^]/,n=c.support||{},o=c.hooks||{},p=c.dateSQL||{date:!0,time:!0,timestamp:!0};return{startState:function(){return{tokenize:d,context:null}},token:function(a,b){if(a.sol()&&b.context&&null==b.context.align&&(b.context.align=!1),a.eatSpace())return null;var c=b.tokenize(a,b);if("comment"==c)return c;b.context&&null==b.context.align&&(b.context.align=!0);var d=a.current();return"("==d?g(a,b,")"):"["==d?g(a,b,"]"):b.context&&b.context.type==d&&h(b),c},indent:function(c,d){var e=c.context;if(!e)return a.Pass;var f=d.charAt(0)==e.type;return e.align?e.col+(f?0:1):e.indent+(f?0:b.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:n.commentSlashSlash?"//":n.commentHash?"#":null}}),function(){function b(a){for(var b={},c=a.split(" "),d=0;d<c.length;++d)b[c[d]]=!0;return b}var c="alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit ";a.defineMIME("text/x-pgsql",{name:"sql",client:b("source"),keywords:b(c+"a abort abs absent absolute access according action ada add admin after aggregate all allocate also always analyse analyze any are array array_agg array_max_cardinality asensitive assertion assignment asymmetric at atomic attribute attributes authorization avg backward base64 before begin begin_frame begin_partition bernoulli binary bit_length blob blocked bom both breadth c cache call called cardinality cascade cascaded case cast catalog catalog_name ceil ceiling chain characteristics characters character_length character_set_catalog character_set_name character_set_schema char_length check checkpoint class class_origin clob close cluster coalesce cobol collate collation collation_catalog collation_name collation_schema collect column columns column_name command_function command_function_code comment comments commit committed concurrently condition condition_number configuration conflict connect connection connection_name constraint constraints constraint_catalog constraint_name constraint_schema constructor contains content continue control conversion convert copy corr corresponding cost covar_pop covar_samp cross csv cube cume_dist current current_catalog current_date current_default_transform_group current_path current_role current_row current_schema current_time current_timestamp current_transform_group_for_type current_user cursor cursor_name cycle data database datalink datetime_interval_code datetime_interval_precision day db deallocate dec declare default defaults deferrable deferred defined definer degree delimiter delimiters dense_rank depth deref derived describe descriptor deterministic diagnostics dictionary disable discard disconnect dispatch dlnewcopy dlpreviouscopy dlurlcomplete dlurlcompleteonly dlurlcompletewrite dlurlpath dlurlpathonly dlurlpathwrite dlurlscheme dlurlserver dlvalue do document domain dynamic dynamic_function dynamic_function_code each element else empty enable encoding encrypted end end-exec end_frame end_partition enforced enum equals escape event every except exception exclude excluding exclusive exec execute exists exp explain expression extension external extract false family fetch file filter final first first_value flag float floor following for force foreign fortran forward found frame_row free freeze fs full function functions fusion g general generated get global go goto grant granted greatest grouping groups handler header hex hierarchy hold hour id identity if ignore ilike immediate immediately immutable implementation implicit import including increment indent index indexes indicator inherit inherits initially inline inner inout input insensitive instance instantiable instead integrity intersect intersection invoker isnull isolation k key key_member key_type label lag language large last last_value lateral lead leading leakproof least left length level library like_regex link listen ln load local localtime localtimestamp location locator lock locked logged lower m map mapping match matched materialized max maxvalue max_cardinality member merge message_length message_octet_length message_text method min minute minvalue mod mode modifies module month more move multiset mumps name names namespace national natural nchar nclob nesting new next nfc nfd nfkc nfkd nil no none normalize normalized nothing notify notnull nowait nth_value ntile null nullable nullif nulls number object occurrences_regex octets octet_length of off offset oids old only open operator option options ordering ordinality others out outer output over overlaps overlay overriding owned owner p pad parameter parameter_mode parameter_name parameter_ordinal_position parameter_specific_catalog parameter_specific_name parameter_specific_schema parser partial partition pascal passing passthrough password percent percentile_cont percentile_disc percent_rank period permission placing plans pli policy portion position position_regex power precedes preceding prepare prepared preserve primary prior privileges procedural procedure program public quote range rank read reads reassign recheck recovery recursive ref references referencing refresh regr_avgx regr_avgy regr_count regr_intercept regr_r2 regr_slope regr_sxx regr_sxy regr_syy reindex relative release rename repeatable replace replica requiring reset respect restart restore restrict result return returned_cardinality returned_length returned_octet_length returned_sqlstate returning returns revoke right role rollback rollup routine routine_catalog routine_name routine_schema row rows row_count row_number rule savepoint scale schema schema_name scope scope_catalog scope_name scope_schema scroll search second section security selective self sensitive sequence sequences serializable server server_name session session_user setof sets share show similar simple size skip snapshot some source space specific specifictype specific_name sql sqlcode sqlerror sqlexception sqlstate sqlwarning sqrt stable standalone start state statement static statistics stddev_pop stddev_samp stdin stdout storage strict strip structure style subclass_origin submultiset substring substring_regex succeeds sum symmetric sysid system system_time system_user t tables tablesample tablespace table_name temp template temporary then ties timezone_hour timezone_minute to token top_level_count trailing transaction transactions_committed transactions_rolled_back transaction_active transform transforms translate translate_regex translation treat trigger trigger_catalog trigger_name trigger_schema trim trim_array true truncate trusted type types uescape unbounded uncommitted under unencrypted unique unknown unlink unlisten unlogged unnamed unnest until untyped upper uri usage user user_defined_type_catalog user_defined_type_code user_defined_type_name user_defined_type_schema using vacuum valid validate validator value value_of varbinary variadic var_pop var_samp verbose version versioning view views volatile when whenever whitespace width_bucket window within work wrapper write xmlagg xmlattributes xmlbinary xmlcast xmlcomment xmlconcat xmldeclaration xmldocument xmlelement xmlexists xmlforest xmliterate xmlnamespaces xmlparse xmlpi xmlquery xmlroot xmlschema xmlserialize xmltable xmltext xmlvalidate year yes loop repeat"),builtin:b("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float8 inet integer int int4 interval json jsonb line lseg macaddr money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:b("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:b("date time timestamp"),support:b("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast commentHash commentSpaceRequired")})}()}},{}],33:[function(a,b,c){b.exports=function(a){function b(a){a.state.placeholder&&(a.state.placeholder.parentNode.removeChild(a.state.placeholder),a.state.placeholder=null)}function c(a){b(a);var c=a.state.placeholder=document.createElement("pre");c.style.cssText="height: 0; overflow: visible",c.className="CodeMirror-placeholder";var d=a.getOption("placeholder");"string"==typeof d&&(d=document.createTextNode(d)),c.appendChild(d),a.display.lineSpace.insertBefore(c,a.display.lineSpace.firstChild)}function d(a){f(a)&&c(a)}function e(a){var d=a.getWrapperElement(),e=f(a);d.className=d.className.replace(" CodeMirror-empty","")+(e?" CodeMirror-empty":""),e?c(a):b(a)}function f(a){return 1===a.lineCount()&&""===a.getLine(0)}a.defineOption("placeholder","",function(c,f,g){var h=g&&g!=a.Init;if(f&&!h)c.on("blur",d),c.on("change",e),c.on("swapDoc",e),e(c);else if(!f&&h){c.off("blur",d),c.off("change",e),c.off("swapDoc",e),b(c);var i=c.getWrapperElement();i.className=i.className.replace(" CodeMirror-empty","")}f&&!c.hasFocus()&&d(c)})}},{}],34:[function(a,b,c){b.exports=function(a){function b(b,c,d){function e(b){var c=a.wheelEventPixels(b)["horizontal"===f.orientation?"x":"y"],d=f.pos;f.moveTo(f.pos+c),f.pos!==d&&a.e_preventDefault(b)}this.orientation=c,this.scroll=d,this.screen=this.total=this.size=1,this.pos=0,this.node=document.createElement("div"),this.node.className=b+"-"+c,this.inner=this.node.appendChild(document.createElement("div"));var f=this;a.on(this.inner,"mousedown",function(b){function c(){a.off(document,"mousemove",d),a.off(document,"mouseup",c)}function d(a){return 1!==a.which?c():void f.moveTo(h+(a[e]-g)*(f.total/f.size))}if(1===b.which){a.e_preventDefault(b);var e="horizontal"===f.orientation?"pageX":"pageY",g=b[e],h=f.pos;a.on(document,"mousemove",d),a.on(document,"mouseup",c)}}),a.on(this.node,"click",function(b){a.e_preventDefault(b);var c,d=f.inner.getBoundingClientRect();c="horizontal"===f.orientation?b.clientX<d.left?-1:b.clientX>d.right?1:0:b.clientY<d.top?-1:b.clientY>d.bottom?1:0,f.moveTo(f.pos+c*f.screen)}),a.on(this.node,"mousewheel",e),a.on(this.node,"DOMMouseScroll",e)}function c(a,c,d){this.addClass=a,this.horiz=new b(a,"horizontal",d),c(this.horiz.node),this.vert=new b(a,"vertical",d),c(this.vert.node),this.width=null}b.prototype.setPos=function(a,b){return a<0&&(a=0),a>this.total-this.screen&&(a=this.total-this.screen),!(!b&&a===this.pos)&&(this.pos=a,this.inner.style["horizontal"===this.orientation?"left":"top"]=a*(this.size/this.total)+"px",!0)},b.prototype.moveTo=function(a){this.setPos(a)&&this.scroll(a,this.orientation)};var d=10;b.prototype.update=function(a,b,c){var e=this.screen!==b||this.total!==a||this.size!==c;e&&(this.screen=b,this.total=a,this.size=c);var f=this.screen*(this.size/this.total);f<d&&(this.size-=d-f,f=d),this.inner.style["horizontal"===this.orientation?"width":"height"]=f+"px",this.setPos(this.pos,e)},c.prototype.update=function(a){if(null==this.width){var b=window.getComputedStyle?window.getComputedStyle(this.horiz.node):this.horiz.node.currentStyle;b&&(this.width=parseInt(b.height,10))}var c=this.width||0,d=a.scrollWidth>a.clientWidth+1,e=a.scrollHeight>a.clientHeight+1;return this.vert.node.style.display=e?"block":"none",this.horiz.node.style.display=d?"block":"none",e&&(this.vert.update(a.scrollHeight,a.clientHeight,a.viewHeight-(d?c:0)),this.vert.node.style.bottom=d?c+"px":"0"),d&&(this.horiz.update(a.scrollWidth,a.clientWidth,a.viewWidth-(e?c:0)-a.barLeft),this.horiz.node.style.right=e?c+"px":"0",this.horiz.node.style.left=a.barLeft+"px"),{right:e?c:0,bottom:d?c:0}},c.prototype.setScrollTop=function(a){this.vert.setPos(a)},c.prototype.setScrollLeft=function(a){this.horiz.setPos(a)},c.prototype.clear=function(){var a=this.horiz.node.parentNode;a.removeChild(this.horiz.node),
a.removeChild(this.vert.node)},a.scrollbarModel.simple=function(a,b){return new c("CodeMirror-simplescroll",a,b)},a.scrollbarModel.overlay=function(a,b){return new c("CodeMirror-overlayscroll",a,b)}}},{}],35:[function(a,b,c){b.exports=function(a){function b(a,b,e,f){if(this.atOccurrence=!1,this.doc=a,null==f&&"string"==typeof b&&(f=!1),e=e?a.clipPos(e):d(0,0),this.pos={from:e,to:e},"string"!=typeof b)b.global||(b=new RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(c,e){if(c){b.lastIndex=0;for(var f,g,h=a.getLine(e.line).slice(0,e.ch),i=0;;){b.lastIndex=i;var j=b.exec(h);if(!j)break;if(f=j,g=f.index,i=f.index+(f[0].length||1),i==h.length)break}var k=f&&f[0].length||0;k||(0==g&&0==h.length?f=void 0:g!=a.getLine(e.line).length&&k++)}else{b.lastIndex=e.ch;var h=a.getLine(e.line),f=b.exec(h),k=f&&f[0].length||0,g=f&&f.index;g+k==h.length||k||(k=1)}if(f&&k)return{from:d(e.line,g),to:d(e.line,g+k),match:f}};else{var g=b;f&&(b=b.toLowerCase());var h=f?function(a){return a.toLowerCase()}:function(a){return a},i=b.split("\n");if(1==i.length)b.length?this.matches=function(e,f){if(e){var i=a.getLine(f.line).slice(0,f.ch),j=h(i),k=j.lastIndexOf(b);if(k>-1)return k=c(i,j,k),{from:d(f.line,k),to:d(f.line,k+g.length)}}else{var i=a.getLine(f.line).slice(f.ch),j=h(i),k=j.indexOf(b);if(k>-1)return k=c(i,j,k)+f.ch,{from:d(f.line,k),to:d(f.line,k+g.length)}}}:this.matches=function(){};else{var j=g.split("\n");this.matches=function(b,c){var e=i.length-1;if(b){if(c.line-(i.length-1)<a.firstLine())return;if(h(a.getLine(c.line).slice(0,j[e].length))!=i[i.length-1])return;for(var f=d(c.line,j[e].length),g=c.line-1,k=e-1;k>=1;--k,--g)if(i[k]!=h(a.getLine(g)))return;var l=a.getLine(g),m=l.length-j[0].length;if(h(l.slice(m))!=i[0])return;return{from:d(g,m),to:f}}if(!(c.line+(i.length-1)>a.lastLine())){var l=a.getLine(c.line),m=l.length-j[0].length;if(h(l.slice(m))==i[0]){for(var n=d(c.line,m),g=c.line+1,k=1;k<e;++k,++g)if(i[k]!=h(a.getLine(g)))return;if(h(a.getLine(g).slice(0,j[e].length))==i[e])return{from:n,to:d(g,j[e].length)}}}}}}}function c(a,b,c){if(a.length==b.length)return c;for(var d=Math.min(c,a.length);;){var e=a.slice(0,d).toLowerCase().length;if(e<c)++d;else{if(!(e>c))return d;--d}}}var d=a.Pos;b.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function b(a){var b=d(a,0);return c.pos={from:b,to:b},c.atOccurrence=!1,!1}for(var c=this,e=this.doc.clipPos(a?this.pos.from:this.pos.to);;){if(this.pos=this.matches(a,e))return this.atOccurrence=!0,this.pos.match||!0;if(a){if(!e.line)return b(0);e=d(e.line-1,this.doc.getLine(e.line-1).length)}else{var f=this.doc.lineCount();if(e.line==f-1)return b(f);e=d(e.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(b,c){if(this.atOccurrence){var e=a.splitLines(b);this.doc.replaceRange(e,this.pos.from,this.pos.to,c),this.pos.to=d(this.pos.from.line+e.length-1,e[e.length-1].length+(1==e.length?this.pos.from.ch:0))}}},a.defineExtension("getSearchCursor",function(a,c,d){return new b(this.doc,a,c,d)}),a.defineDocExtension("getSearchCursor",function(a,c,d){return new b(this,a,c,d)}),a.defineExtension("selectMatches",function(b,c){for(var d=[],e=this.getSearchCursor(b,this.getCursor("from"),c);e.findNext()&&!(a.cmpPos(e.to(),this.getCursor("to"))>0);)d.push({anchor:e.from(),head:e.to()});d.length&&this.setSelections(d,0)})}},{}],36:[function(a,b,c){b.exports=function(a){"use strict";function b(a,b){this.cm=a,this.options=b,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var c=this;a.on("cursorActivity",this.activityFunc=function(){c.cursorActivity()})}function c(b,c){var d=a.cmpPos(c.from,b.from);return d>0&&b.to.ch-b.from.ch!=c.to.ch-c.from.ch}function d(a,b,c){var d=a.options.hintOptions,e={};for(var f in r)e[f]=r[f];if(d)for(var f in d)void 0!==d[f]&&(e[f]=d[f]);if(c)for(var f in c)void 0!==c[f]&&(e[f]=c[f]);return e.hint.resolve&&(e.hint=e.hint.resolve(a,b)),e}function e(a,b){var c=b&&b.autocompleteSuffix?b.autocompleteSuffix:"",d=b&&b.autocompletePrefix?b.autocompletePrefix:"";return"string"!=typeof a&&(a=a.text),d+a+c}function f(a){return"string"==typeof a?"":a.type}function g(a,b){function c(a,c){var e;e="string"!=typeof c?function(a){return c(a,b)}:d.hasOwnProperty(c)?d[c]:c,f[a]=e}var d={Up:function(){b.moveFocus(-1)},Down:function(){b.moveFocus(1)},PageUp:function(){b.moveFocus(-b.menuSize()+1,!0)},PageDown:function(){b.moveFocus(b.menuSize()-1,!0)},Home:function(){b.setFocus(0)},End:function(){b.setFocus(b.length-1)},Enter:b.pick,Tab:b.pick,Esc:b.close},e=a.options.customKeys,f=e?{}:d;if(e)for(var g in e)e.hasOwnProperty(g)&&c(g,e[g]);var h=a.options.extraKeys;if(h)for(var g in h)h.hasOwnProperty(g)&&c(g,h[g]);return f}function h(a,b){for(;b&&b!=a;){if("LI"===b.nodeName.toUpperCase()&&b.parentNode==a)return b;b=b.parentNode}}function i(a){var b=document.createElement(a.displayText||e(a));b=document.createElement("span"),b.className="CDB-Size-small has-letter",b.innerHTML=a.displayText||e(a);var c=f(a);return c&&(b.className="CDB-Size-small has-letter",b.dataset.type=c),b}function j(b,c){this.completion=b,this.data=c,this.picked=!1;var d=this,e=b.cm,f=this.hints=document.createElement("ul");f.className="CodeMirror-hints",this.selectedHint=c.selectedHint||0;for(var j,k=c.list,l=0;l<k.length;++l){var m=f.appendChild(document.createElement("li")),p=k[l],q=n+(l!=this.selectedHint?"":" "+o);null!=p.className&&(q=p.className+" "+q),m.className=q,p.render?p.render(m,c,p):(j=i(p),m.appendChild(j)),m.hintId=l}var r=e.cursorCoords(b.options.alignWithWord?c.from:null),s=r.left,t=r.bottom,u=!0;f.style.left=s+"px",f.style.top=t+"px";var v=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),w=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(b.options.container||document.body).appendChild(f);var x=f.getBoundingClientRect(),y=x.bottom-w;if(y>0){var z=x.bottom-x.top,A=r.top-(r.bottom-x.top);if(A-z>0)f.style.top=(t=r.top-z)+"px",u=!1;else if(z>w){f.style.height=w-5+"px",f.style.top=(t=r.bottom-x.top)+"px";var B=e.getCursor();c.from.ch!=B.ch&&(r=e.cursorCoords(B),f.style.left=(s=r.left)+"px",x=f.getBoundingClientRect())}}var C=x.right-v;if(C>0&&(x.right-x.left>v&&(f.style.width=v-5+"px",C-=x.right-x.left-v),f.style.left=(s=r.left-C)+"px"),e.addKeyMap(this.keyMap=g(b,{moveFocus:function(a,b){d.changeActive(d.selectedHint+a,b)},setFocus:function(a){d.changeActive(a)},menuSize:function(){return d.screenAmount()},length:k.length,close:function(){b.close()},pick:function(){d.pick()},data:c})),b.options.closeOnUnfocus){var D;e.on("blur",this.onBlur=function(){D=setTimeout(function(){b.close()},100)}),e.on("focus",this.onFocus=function(){clearTimeout(D)})}var E=e.getScrollInfo();return e.on("scroll",this.onScroll=function(){var a=e.getScrollInfo(),c=e.getWrapperElement().getBoundingClientRect(),d=t+E.top-a.top,g=d-(window.pageYOffset||(document.documentElement||document.body).scrollTop);return u||(g+=f.offsetHeight),g<=c.top||g>=c.bottom?b.close():(f.style.top=d+"px",void(f.style.left=s+E.left-a.left+"px"))}),a.on(f,"dblclick",function(a){var b=h(f,a.target||a.srcElement);b&&null!=b.hintId&&(d.changeActive(b.hintId),d.pick())}),a.on(f,"click",function(a){var c=h(f,a.target||a.srcElement);c&&null!=c.hintId&&(d.changeActive(c.hintId),b.options.completeOnSingleClick&&d.pick())}),a.on(f,"mousedown",function(){setTimeout(function(){e.focus()},20)}),a.signal(c,"select",k[0],f.firstChild),!0}function k(a,b){if(!a.somethingSelected())return b;for(var c=[],d=0;d<b.length;d++)b[d].supportsSelection&&c.push(b[d]);return c}function l(a,b,c,d){if(a.async)a(b,d,c);else{var e=a(b,c);e&&e.then?e.then(d):d(e)}}function m(b,c){var d,e=b.getHelpers(c,"hint");if(e.length){var f=function(a,b,c){function d(e){return e==f.length?b(null):void l(f[e],a,c,function(a){a&&a.list.length>0?b(a):d(e+1)})}var f=k(a,e);d(0)};return f.async=!0,f.supportsSelection=!0,f}return(d=b.getHelper(b.getCursor(),"hintWords"))?function(b){return a.hint.fromList(b,{words:d})}:a.hint.anyword?function(b,c){return a.hint.anyword(b,c)}:function(){}}var n="CodeMirror-hint",o="CodeMirror-hint-active";a.showHint=function(a,b,c){if(!b)return a.showHint(c);c&&c.async&&(b.async=!0);var d={hint:b};if(c)for(var e in c)d[e]=c[e];return a.showHint(d)},a.defineExtension("showHint",function(c){c=d(this,this.getCursor("start"),c);var e=this.listSelections();if(!(e.length>1)){if(this.somethingSelected()){if(!c.hint.supportsSelection)return;for(var f=0;f<e.length;f++)if(e[f].head.line!=e[f].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var g=this.state.completionActive=new b(this,c);g.options.hint&&(a.signal(this,"startCompletion",this),g.update(!0))}});var p=window.requestAnimationFrame||function(a){return setTimeout(a,1e3/60)},q=window.cancelAnimationFrame||clearTimeout;b.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&a.signal(this.data,"close"),this.widget&&this.widget.close(),a.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(b,c){var d=b.list[c];d.hint?d.hint(this.cm,b,d):this.cm.replaceRange(e(d,this.options),d.from||b.from,d.to||b.to,"complete"),a.signal(b,"pick",d),this.close()},cursorActivity:function(){this.debounce&&(q(this.debounce),this.debounce=0);var a=this.cm.getCursor(),b=this.cm.getLine(a.line);if(a.line!=this.startPos.line||b.length-a.ch!=this.startLen-this.startPos.ch||a.ch<this.startPos.ch||this.cm.somethingSelected()||a.ch&&this.options.closeCharacters.test(b.charAt(a.ch-1)))this.close();else{var c=this;this.debounce=p(function(){c.update()}),this.widget&&this.widget.disable()}},update:function(a){if(null!=this.tick){var b=this,c=++this.tick;l(this.options.hint,this.cm,this.options,function(d){b.tick==c&&b.finishUpdate(d,a)})}},finishUpdate:function(b,d){this.data&&a.signal(this.data,"update");var e=this.widget&&this.widget.picked||d&&this.options.completeSingle;this.widget&&this.widget.close(),b&&this.data&&c(this.data,b)||(this.data=b,b&&b.list.length&&(e&&1==b.list.length?this.pick(b,0):(this.widget=new j(this,b),a.signal(b,"shown"))))}},j.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var a=this.completion.cm;this.completion.options.closeOnUnfocus&&(a.off("blur",this.onBlur),a.off("focus",this.onFocus)),a.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var a=this;this.keyMap={Enter:function(){a.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(b,c){if(b>=this.data.list.length?b=c?this.data.list.length-1:0:b<0&&(b=c?0:this.data.list.length-1),this.selectedHint!=b){var d=this.hints.childNodes[this.selectedHint];d.className=d.className.replace(" "+o,""),d=this.hints.childNodes[this.selectedHint=b],d.className+=" "+o,d.offsetTop<this.hints.scrollTop?this.hints.scrollTop=d.offsetTop-3:d.offsetTop+d.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=d.offsetTop+d.offsetHeight-this.hints.clientHeight+3),a.signal(this.data,"select",this.data.list[this.selectedHint],d)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},a.registerHelper("hint","auto",{resolve:m}),a.registerHelper("hint","fromList",function(b,c){var d=b.getCursor(),e=b.getTokenAt(d),f=a.Pos(d.line,e.end);if(e.string&&/\w/.test(e.string[e.string.length-1]))var g=e.string,h=a.Pos(d.line,e.start);else var g="",h=f;for(var i=[],j=0;j<c.words.length;j++){var k=c.words[j];k.slice(0,g.length)==g&&i.push(k)}if(i.length)return{list:i,from:h,to:f}}),a.commands.autocomplete=a.showHint;var r={hint:a.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};a.defineOption("hintOptions",null)}},{}],37:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./context-menu/context-menu-view"),g=a("./custom-list/custom-list-collection"),h=a("./context-menu-factory.tpl"),i=["menuItems"];b.exports=e.extend({events:{"click .js-toggle-menu":"_onToggleContextMenuClicked"},className:"CDB-Shape",initialize:function(a){d.each(i,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this.template=a.template||h,this._initContextMenu(this._menuItems)},render:function(){return this.clearSubViews(),this.$el.html(this.template()),this},_initContextMenu:function(a){this._menuItems=new g(a),this._menuItems.on("change:selected",this._onContextMenuSelect,this),this.add_related_model(this._menuItems)},_onContextMenuSelect:function(a){var b=a.get("action");b&&b.call(this)},_showContextMenu:function(a){var b="context-menu-trigger-"+this.cid;this.$(".js-toggle-menu").attr("id",b);var c=this._menuItems;this._resetContextMenuItems(),this._menuView=new f({collection:c,triggerElementID:b,position:a}),this._menuView.model.on("change:visible",function(a,b){this._hasContextMenu()&&!b&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView)},_resetContextMenuItems:function(){var a=this._menuItems.getSelectedItem();a&&a.set({selected:!1},{silent:!0})},_hasContextMenu:function(){return null!=this._menuView},_hideContextMenu:function(){this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_onToggleContextMenuClicked:function(a){a.preventDefault(),this._hasContextMenu()?this._hideContextMenu():this._showContextMenu({x:a.pageX,y:a.pageY})},getContextMenu:function(){return this._menuView}})},{"./context-menu-factory.tpl":38,"./context-menu/context-menu-view":39,"./custom-list/custom-list-collection":47,"backbone/core-view":1127,underscore:"underscore"}],38:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="CDB-Shape-threePoints is-blue is-small js-toggle-menu">\n  <div class="CDB-Shape-threePointsItem"></div>\n  <div class="CDB-Shape-threePointsItem"></div>\n  <div class="CDB-Shape-threePointsItem"></div>\n</button>';return __p}},{underscore:"underscore"}],39:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("backbone/core-view"),g=a("../custom-list/custom-list-view"),h=a("../custom-list/custom-list-item-view"),i=a("../custom-list/custom-list-item.tpl"),j=a("../../helpers/magic-positioner"),k=27;b.exports=f.extend({options:{position:{x:0,y:0},offset:{x:0,y:15},itemTemplate:i,itemView:h},className:"CDB-Box-modal CDB-SelectItem CustomList CustomList--small",tagName:"div",initialize:function(a){if(a=a||{},!a.collection)throw new Error("collection option is required");if(!a.triggerElementID)throw new Error("element id is required");this._triggerElementID=a.triggerElementID,this.model=new e.Model({visible:!1}),this._onEscapePressed=this._onEscapePressed.bind(this),this._onDocumentElementClicked=this._onDocumentElementClicked.bind(this),this._initBinds()},_initBinds:function(){this.model.on("change:visible",function(a,b){this.render(),b?this._initDocumentBinds():this._destroyDocumentBinds()},this),this.collection.on("change:selected",this.hide,this),this.add_related_model(this.collection)},_initDocumentBinds:function(){d(document).on("keydown",this._onEscapePressed),d(document).on("mousedown",this._onDocumentElementClicked)},_destroyDocumentBinds:function(){d(document).off("keydown",this._onEscapePressed),d(document).off("mousedown",this._onDocumentElementClicked)},render:function(){var a=d("body"),b=(this.options.position.x||0)+this.options.offset.x,c=(this.options.position.y||0)+this.options.offset.y;return this.clearSubViews(),this.$el.empty(),this._renderList(),this.$el.toggle(this.isVisible()),a.append(this.el),this.$el.css(j({parentView:a,posX:b,posY:c})),this},_onEscapePressed:function(a){a.which===k&&this.hide()},_onDocumentElementClicked:function(a){var b=d(a.target);0===b.closest(this.$el).length&&0===b.closest(d("#"+this._triggerElementID)).length&&this.hide()},_renderList:function(){this._listView=new g({model:this.model,collection:this.collection,typeLabel:"",ItemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:5}),this.$el.append(this._listView.render().el),this.addView(this._listView)},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},clean:function(){this._destroyDocumentBinds(),f.prototype.clean.apply(this)}})},{"../../helpers/magic-positioner":1093,"../custom-list/custom-list-item-view":50,"../custom-list/custom-list-item.tpl":52,"../custom-list/custom-list-view":57,backbone:"backbone","backbone/core-view":1127,jquery:"jquery"}],40:[function(a,b,c){var d=a("backbone"),e=a("./custom-carousel-item-model");b.exports=d.Collection.extend({model:function(a,b){var c={};return"string"==typeof a?c.val=a:c=a,new e(c)},initialize:function(){this._initBinds()},_initBinds:function(){this.bind("change:selected",this._onSelectedChange,this)},_onSelectedChange:function(a,b){b&&this.each(function(b){b.cid!==a.cid&&b.get("selected")&&b.set("selected",!1)})},getSelected:function(){return this.findWhere({selected:!0})},getSelectedValue:function(){var a=this.getSelected();return a&&a.get("val")},getHighlighted:function(){return this.findWhere({highlighted:!0})}})},{"./custom-carousel-item-model":41,backbone:"backbone"}],41:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{selected:!1,label:"",template:function(){return""}},getName:function(){return this.get("label")||this.getValue()},getValue:function(){return this.get("val")}})},{backbone:"backbone"}],42:[function(a,b,c){var d=a("backbone/core-view"),e=a("./custom-carousel-item.tpl");b.exports=d.extend({className:"Carousel-item",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function(a){this._itemClassName=a&&a.itemOptions?a.itemOptions.className:"",this._initBinds()},render:function(){return this.$el.html(e({name:this.model.getName(),className:this._itemClassName,template:this.model.get("template")()})),this.model.getValue()&&this.$el.addClass("js-"+this.model.getValue()),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this},_initBinds:function(){this.model.bind("change:selected",this.render,this)},_onMouseEnter:function(){this.model.set("highlighted",!0)},_onMouseLeave:function(){this.model.set("highlighted",!1)},_onClick:function(a){this.killEvent(a),this.model.set("selected",!0)}})},{"./custom-carousel-item.tpl":43,"backbone/core-view":1127}],43:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<button",className&&(__p+=' class="'+(null==(__t=className)?"":_.escape(__t))+'"'),__p+=">\n  "+(null==(__t=template)?"":__t)+"\n</button>\n";return __p}},{underscore:"underscore"}],44:[function(a,b,c){var d=a("backbone/core-view"),e=a("perfect-scrollbar"),f=a("./custom-carousel.tpl"),g=a("./custom-carousel-collection"),h=a("./custom-carousel-item-view"),i=a("underscore");b.exports=d.extend({className:"Carousel",tagName:"div",initialize:function(a){if(!a.collection){if(!a.options)throw new Error("options array {value, label} is required");this.collection=new g(a.options),this.options=a}this._bindedCheckShadows=this._checkShadows.bind(this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(f()),this._renderList(),this._applyCustomScroll(),this},_initBinds:function(){this.collection.bind("change:selected",this._checkScroll,this)},_renderList:function(){this.collection.each(function(a){this._createItem(a)},this)},_createItem:function(a){var b=this.options,c=b&&b.listItemOptions?b.listItemOptions.className:"Carousel-item",d=new h({className:c,model:a,itemOptions:this.options.itemOptions});this._listContainer().append(d.render().el),this.addView(d)},_applyCustomScroll:function(){e.initialize(this._listContainer().get(0),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,suppressScrollY:!0,stopPropagationOnClick:!1,minScrollbarLength:120}),this._checkScroll(),this._bindScroll()},_destroyCustomScroll:function(){this._unbindScroll(),e.destroy(this._listContainer().get(0))},_bindScroll:function(){this._listContainer().on("ps-x-reach-start",this._bindedCheckShadows).on("ps-x-reach-end",this._bindedCheckShadows).on("ps-scroll-x",this._bindedCheckShadows)},_unbindScroll:function(){this._listContainer().off("ps-x-reach-start",this._bindedCheckShadows).off("ps-x-reach-end",this._bindedCheckShadows).off("ps-scroll-x",this._bindedCheckShadows)},_checkScroll:function(){var a=this.$(".is-selected").position();a&&(this._listContainer().scrollLeft(a.left-20),this._bindedCheckShadows())},_listContainer:function(){return this.$(".js-list")},_checkShadows:function(){var a=this._listContainer().scrollLeft(),b=this._listContainer().get(0).scrollWidth,c=this._listContainer().outerWidth(),d=b-c;this.$(".js-leftShadow").toggleClass("is-visible",a>0),this.$(".js-rightShadow").toggleClass("is-visible",a<d)},clean:function(){this._destroyCustomScroll(),d.prototype.clean.apply(this)},initScroll:function(){setTimeout(i.bind(function(){this._checkShadows(),this._checkScroll(),e.update(this._listContainer().get(0))},this),0)}})},{"./custom-carousel-collection":40,"./custom-carousel-item-view":42,"./custom-carousel.tpl":45,"backbone/core-view":1127,"perfect-scrollbar":"perfect-scrollbar",underscore:"underscore"}],45:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Carousel-shadow Carousel-shadow--left js-leftShadow"></div>\n<div class="Carousel-shadow Carousel-shadow--right is-visible js-rightShadow"></div>\n<ul class="Carousel-list js-list"></ul>\n';return __p}},{underscore:"underscore"}],46:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-ListDecoration-item CustomList-item js-listItem">\n  <button type="button" class="CDB-ListDecoration-itemLink CustomList-itemLink js-add-custom-value u-ellipsis" data-val="'+(null==(__t=query)?"":_.escape(__t))+'" title="'+(null==(__t=query)?"":_.escape(__t))+'">\n    <p class="CDB-Text CDB-FontSize-small u-altTextColor">'+(null==(__t=_t("components.custom-list.add-custom-result"))?"":_.escape(__t))+"</p>\n    “"+(null==(__t=query)?"":_.escape(__t))+"”\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],47:[function(a,b,c){var d=a("backbone"),e=a("./custom-list-item-model"),f=a("underscore");b.exports=d.Collection.extend({sort_key:"id",initialize:function(a,b){this.options=f.extend({silent:!0},b),this._initBinds()},comparator:function(a){return a.get(this.sort_key)?a.get(this.sort_key).toLowerCase():a.get(this.sort_key)},model:function(a,b){var c={};return"string"==typeof a?c.val=a:c=a,new e(c,b)},sortByKey:function(a){this.sort_key=a,this.sort()},_initBinds:function(){this.bind("change:selected",this._onSelectedChange,this)},search:function(a){return a?(a=a.toLowerCase(),f(this.filter(function(b){var c=b.getName(),d=f.isString(c)?c.toLowerCase():c;return d?~d.indexOf(a):-1}))):this},_onSelectedChange:function(a,b){b&&this.each(function(b){b.cid!==a.cid&&b.set({selected:!1},{silent:this.options.silent})},this)},getSelectedItem:function(){return f.first(this.where({selected:!0}))},containsValue:function(a){return this.find(function(b){return b.getValue()===a})},setSelected:function(a){var b,c={silent:this.options.silent};return this.each(function(d){d.getValue()===a?(d.set({selected:!0},c),b=d):d.set({selected:!1},c)}),b},removeSelected:function(){this.each(function(a){a.set({selected:!1})})}})},{"./custom-list-item-model":49,backbone:"backbone",underscore:"underscore"}],48:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CustomList-message">\n  <p class="CustomList-messageText CDB-Text CDB-Size-medium u-secondaryTextColor">\n    ',__p+=query&&query.length?"\n      "+(null==(__t=_t("components.custom-list.no-results",{typeLabel:typeLabel,query:query}))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.custom-list.no-items",{typeLabel:typeLabel}))?"":_.escape(__t))+"\n    ",__p+="\n  </p>\n</div>\n";return __p}},{underscore:"underscore"}],49:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{selected:!1},getName:function(){return null==this.get("label")?this.getValue():this.get("label")},getValue:function(){return this.get("val")}})},{backbone:"backbone"}],50:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view");b.exports=e.extend({options:{template:a("./custom-list-item.tpl")},className:"CDB-ListDecoration-item CustomList-item js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function(a){this.options=d.extend({},this.options,a),this.model.on("change",this.render,this)},render:function(){this.$el.empty(),this.clearSubViews();var a=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(d.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:a,val:this.model.getValue(),options:this.model.get("renderOptions")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onMouseLeave:function(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function(){this.$el.addClass("is-highlighted")},_onClick:function(a){this.killEvent(a),this.model.set({selectedClass:a.target.classList,selected:!0})}})},{"./custom-list-item.tpl":52,"backbone/core-view":1127,underscore:"underscore"}],51:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink u-ellipsis\n  ',isSelected&&(__p+=" is-selected "),__p+="\n  ",__p+=isDestructive?"\n  u-errorTextColor\n  ":isDisabled?"\n  u-hintTextColor\n  ":"\n  u-actionTextColor\n  ",__p+='\n  " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n\n  <div class="u-iBlock u-rSpace">\n    <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',isSelected&&(__p+="checked"),__p+=" ",isDisabled&&(__p+="disabled"),__p+=' />\n    <span class="u-iBlock CDB-Checkbox-face"></span>\n  </div>\n  '+(null==(__t=name)?"":_.escape(__t))+"\n</button>\n";return __p}},{underscore:"underscore"}],52:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink u-ellipsis\n    ',isSelected&&(__p+=" is-selected "),__p+="\n    ",__p+=isDestructive?"\n      u-errorTextColor\n    ":isDisabled?"\n      u-hintTextColor\n    ":"\n      u-actionTextColor\n    ",__p+='\n  " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  '+(null==(__t=name)?"":_.escape(__t))+"\n</button>\n";return __p}},{underscore:"underscore"}],53:[function(a,b,c){var d=a("underscore"),e=a("./custom-list-collection");b.exports=e.extend({_initBinds:function(){},setSelected:function(a){var b,c={silent:!0};return d.isArray(a)?this.each(function(e){d.contains(a,e.getValue())?(e.set({selected:!0},c),b=e):e.set({selected:!1},c)}):this.each(function(d){d.getValue()===a?(d.set({selected:!0},c),b=d):d.set({selected:!1},c)}),b}})},{"./custom-list-collection":47,underscore:"underscore"}],54:[function(a,b,c){var d=a("./custom-list-item-view");b.exports=d.extend({_onClick:function(a){this.killEvent(a),this.model.set("selected",!this.model.get("selected"))}})},{"./custom-list-item-view":50}],55:[function(a,b,c){var d=a("backbone/core-view"),e=a("./custom-list-search.tpl");b.exports=d.extend({className:"CustomList-form CDB-Box-modalHeader",tagName:"form",events:{"keyup .js-search":"_onSearchType","click .js-clear":"_onClickClear",submit:"_submit"},initialize:function(){this.template=this.options.template||e,this.searchPlaceholder=this.options.searchPlaceholder||_t("components.custom-list.placeholder",{typeLabel:this.options.typeLabel}),this._initBinds()},render:function(){return this.$el.empty().append(this.template({query:this.model.get("query"),searchPlaceholder:this.searchPlaceholder})),this},_initBinds:function(){this.model.on("change:query",this._checkButtons,this)},_checkButtons:function(){var a=this.model.get("query");this.$(".js-clear").toggle(a.length>0)},_onSearchType:function(a){this._submit()},_onClickClear:function(a){a.stopPropagation(),this.model.set("query",""),this.render(),this.focus()},focus:function(){this.$(".js-search").focus()},_submit:function(a){this.killEvent(a);var b=this.$(".js-search").val();this.model.set("query",b)}})},{"./custom-list-search.tpl":56,"backbone/core-view":1127}],56:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeaderItem">\n  <input type="text" name="text" autocomplete="off" placeholder="'+(null==(__t=searchPlaceholder)?"":_.escape(__t))+'" class="CDB-InputTextPlain CDB-Text js-search">\n  <button type="button" style="display:none" class="u-lSpace--xl js-clear">\n    <div class="CDB-Shape">\n      <div class="CDB-Shape-close is-blue is-large"></div>\n    </div>\n  </button>\n</div>\n';return __p}},{underscore:"underscore"}],57:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("perfect-scrollbar"),g=a("./custom-list-empty.tpl"),h=a("./custom-list-add.tpl"),i=a("./custom-list.tpl"),j=40,k=a("../../helpers/utils"),l=38,m=13;b.exports=d.extend({options:{size:3},className:"CDB-Text CDB-Size-medium CustomList-listWrapper",tagName:"div",events:{"click .js-add-custom-value":"_onClickAddCustomValue"},initialize:function(a){this.options=e.extend({},this.options,a),this._onKeyDownBinded=this._onKeyDown.bind(this),this._needsMaxSize=!0,this._initBinds()},render:function(){this.clearSubViews(),this._removeArrowBinds(),this._destroyCustomScroll(),this.$el.empty();var a=this.model.get("query"),b=this.collection.search(a);this.$el.append(i());var c=this.options.allowFreeTextInput,d=!this.collection.containsValue(a);return c&&a&&!k.isBlank(a)&&d&&this.$el.prepend(h({query:a,typeLabel:this.options.typeLabel})),b.size()>0?(b.each(this._renderItem,this),this._applyArrowBinds(),setTimeout(this._applyCustomScroll.bind(this),0)):c&&!k.isBlank(a)||this.$el.append(g({query:a,typeLabel:this.options.typeLabel})),this},_renderItem:function(a){var b=this.options.ItemView,c=new b({model:a,typeLabel:this.options.typeLabel,template:this.options.itemTemplate});this.$(".js-list").append(c.render().el),this.addView(c),c.bind("customEvent",function(a,b){this.trigger("customEvent",a,b,this);
},this)},_initBinds:function(){this.model.bind("change:query",this.render,this)},_applyArrowBinds:function(){document.addEventListener("keydown",this._onKeyDownBinded)},_removeArrowBinds:function(){document.removeEventListener("keydown",this._onKeyDownBinded)},_getSelected:function(){var a,b=this.collection.getSelectedItem();return b?(a=b.getValue(),this.$("[data-val='"+a+"']")):null},_highlightSelected:function(a){var b=a.outerHeight();a.addClass("is-highlighted"),this.$(".js-list").scrollTop(a.index()*b)},_onClickAddCustomValue:function(a){this.killEvent(a);var b=this.model.get("query"),c=this.collection.add({val:b,label:"“"+b+"”"});this.collection.sortByKey("val"),c.set("selected",!0)},_onKeyDown:function(a){if(this.model.get("visible")!==!1){var b,c,d=a.which,f=this.$(".js-listItem"),g=f.filter(".is-highlighted");if(g.removeClass("is-highlighted"),d===j)b=g.length&&g[0]!==f.last()[0]?g.next():f.eq(0);else if(d===l)b=g.length&&g[0]!==f.first()[0]?g.prev():f.last();else if(d===m&&(a.preventDefault(),g&&g.length))return c=e.first(this.collection.where({val:g.data("val")})),c&&c.set("selected",!0),!1;b&&this._highlightSelected(b)}},_applyCustomScroll:function(){f.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20})},_destroyCustomScroll:function(){this._wrapperContainer().length>0&&f.destroy(this._wrapperContainer().get(0))},_wrapperContainer:function(){return this.$(".js-list")},clean:function(){this._removeArrowBinds(),this._destroyCustomScroll(),d.prototype.clean.apply(this)},highlight:function(){var a=this._getSelected();a&&this._highlightSelected(a)}})},{"../../helpers/utils":1102,"./custom-list-add.tpl":46,"./custom-list-empty.tpl":48,"./custom-list.tpl":58,"backbone/core-view":1127,"perfect-scrollbar":"perfect-scrollbar",underscore:"underscore"}],58:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="CustomList-list js-list"></ul>\n';return __p}},{underscore:"underscore"}],59:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./custom-list-collection"),h=a("./custom-list-search-view"),i=a("./custom-list-view"),j=a("./custom-list-item.tpl"),k=a("./custom-list-item-view");b.exports=f.extend({options:{showSearch:!0,allowFreeTextInput:!1,typeLabel:"column",itemTemplate:j,itemView:k},className:"CDB-Box-modal CustomList",tagName:"div",initialize:function(a){if(!a.collection){if(!a.options)throw new Error("options array {value, label} is required");this.collection=new g(a.options)}a.position&&this.$el.css(a.position),this.options=d.extend({},this.options,a),this.model=new e.Model({query:"",visible:!1}),this._initBinds()},render:function(){return this.$el.empty(),this.clearSubViews(),this.options.showSearch&&this._renderSearch(),this._renderList(),this.options.showSearch&&this._focusSearch(),this},_initBinds:function(){this.model.bind("change:visible",function(a,b){this._resetQuery(),this._toggleVisibility(),b?this.render():this.clearSubViews()},this)},_renderSearch:function(){this._searchView=new h({template:this.options.searchTemplate,typeLabel:this.options.typeLabel,searchPlaceholder:this.options.searchPlaceholder,model:this.model}),this.$el.prepend(this._searchView.render().el),this.addView(this._searchView)},_focusSearch:function(){setTimeout(function(){this._searchView&&this._searchView.focus()}.bind(this),0)},_renderList:function(){this._listView=new i({model:this.model,allowFreeTextInput:this.options.allowFreeTextInput,collection:this.collection,typeLabel:this.options.typeLabel,ItemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:this.options.size}),this.$el.append(this._listView.render().el),this._listView.highlight(),this.addView(this._listView),this._listView.bind("customEvent",function(a,b){this.trigger(a,b,this)},this)},highlight:function(){this._listView.highlight()},_resetQuery:function(){this.model.set("query","")},show:function(){this.model.set("visible",!0)},hide:function(){this.trigger("hidden",this),this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},_toggleVisibility:function(){this.$el.toggleClass("is-visible",!!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},remove:function(){this._listView&&this._listView.clean(),f.prototype.remove.call(this)}})},{"./custom-list-collection":47,"./custom-list-item-view":50,"./custom-list-item.tpl":52,"./custom-list-search-view":55,"./custom-list-view":57,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],60:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../sql-notifications"),g=a("../../helpers/sql-utils"),h=a("../../components/notifier/notifier"),i=a("cartodb.js"),j=a("../../helpers/required-opts"),k=["configModel","editorModel","layerDefinitionModel","querySchemaModel"];b.exports=e.extend({initialize:function(a){j(a,k,this),this._clearSQLModel=new d.Model({visible:!1}),this._sqlModel=this._layerDefinitionModel.sqlModel,this._SQL=new i.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")}),this._codemirrorModel=new d.Model({content:this._querySchemaModel.get("query"),readonly:!1}),f.track(this)},_internalParseSQL:function(a){var b=this._querySchemaModel.get("query"),c=this._codemirrorModel.get("content");c&&";"===c.slice(-1)&&(c=c.slice(0,c.length-1),this._codemirrorModel.set("content",c));var d=g.isSameQuery(c,b),e=g.altersData(c);return""===c||d?(f.removeNotification(),!1):void(e?(f.showNotification({status:"loading",info:_t("notifications.sql.alter-loading"),closable:!1}),this._sqlModel.set("content",c),this._SQL.execute(c,null,{success:function(){f.showNotification({status:"success",info:_t("notifications.sql.alter-success"),closable:!0,delay:h.DEFAULT_DELAY}),this._applyDefaultSQLAfterAlteringData(),"function"==typeof a&&a.call(this)}.bind(this),error:function(a){a=a.responseJSON.error;var b=this._parseErrors(a);this._codemirrorModel.set("errors",b),f.showErrorNotification(b),this._checkClearButton()}.bind(this)})):this._runQuery(c,this._saveSQL.bind(this)))},_checkClearButton:function(){var a=this._codemirrorModel.get("content"),b=g.isSameQuery(a,this._defaultSQL());this._clearSQLModel.set({visible:!b})},_applyDefaultSQLAfterAlteringData:function(){var a=this._defaultSQL();this._codemirrorModel.set({content:a,errors:[]}),this._sqlModel.set("content",a),this._querySchemaModel.set("query_errors",[]),this._clearSQLModel.set({visible:!1}),this._querySchemaModel.resetDueToAlteredData(),this._clearSQL()},_clearSQL:function(){var a=this._defaultSQL();this._codemirrorModel.set({content:a,errors:[]}),this._runQuery(a,this._saveSQL.bind(this))},_showErrors:function(a){var b=this._querySchemaModel.get("query_errors"),c=b&&b.length>0;this._codemirrorModel.set("errors",this._parseErrors(b)),this._editorModel.set("disabled",c),c&&f.showErrorNotification(this._parseErrors(b)),this._checkClearButton()},_parseErrors:function(a){return a.map(function(a){return{message:a}})}})},{"../../components/notifier/notifier":475,"../../helpers/required-opts":1097,"../../helpers/sql-utils":1099,"../../sql-notifications":1118,backbone:"backbone","backbone/core-view":1127,"cartodb.js":"cartodb.js"}],61:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="DatePicker-timers">\n  <div class="DatePicker-timersField u-rSpace--xl">\n    <div class="DatePicker-timersInput" data-fields="fromHour"></div>\n  </div>\n  <div class="DatePicker-timersField u-rSpace--xl">\n    <div class="DatePicker-timersInput" data-fields="fromMin"></div>\n  </div>\n  <div class="DatePicker-timersField DatePicker-timersField--spaced u-rSpace--xl">\n    <div class="DatePicker-timersInput" data-fields="toHour"></div>\n  </div>\n  <div class="DatePicker-timersField">\n    <div class="DatePicker-timersInput" data-fields="toMin"></div>\n  </div>\n</form>\n';return __p}},{underscore:"underscore"}],62:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("underscore"),g=a("moment"),h=a("jquery"),i=a("../../helpers/utils");a("../form-components/index"),a("datepicker");var j=a("./date-picker-range-form.tpl"),k=a("./date-picker-range.tpl"),l=30;b.exports=e.extend({className:"DatePicker",options:{flat:!0,date:["2008-07-31","2008-07-31"],current:"2008-07-31",calendars:2,mode:"range",starts:1},events:{"click .js-dates":"_toggleCalendar","click .js-fourHours":"_setLastFourHours","click .js-oneDay":"_setLastDay","click .js-oneWeek":"_setLastWeek"},initialize:function(a){this.model=new d.Model({fromDate:"",fromHour:0,fromMin:0,toDate:"",toHour:23,toMin:59,user_timezone:0}),this.template=a.template||k,this._initBinds(),this._setDefaultDate()},render:function(){var a=this;return this.clearSubViews(),this.$el.append(this.template(f.extend(this.model.attributes,{max_days:l,pad:i.pad}))),setTimeout(function(){a._initCalendar(),a._hideCalendar(),a._initTimers()},100),this},_initBinds:function(){this.model.bind("change",this._setValues,this),this.model.bind("change",this._onValuesChange,this),h(document).bind("click",this._onDocumentClick.bind(this))},_destroyBinds:function(){h(document).unbind("click",this._onDocumentClick.bind(this))},_setValues:function(a,b){var c=_t("components.datepicker.dates-placeholder"),d=this.model.attributes;d.fromDate&&d.toDate&&(c=_t("components.datepicker.from")+" <strong>"+this.model.get("fromDate")+" "+(i.pad(this.model.get("fromHour"),2)+":"+i.pad(this.model.get("fromMin"),2))+"</strong> "+_t("components.datepicker.to")+" <strong>"+this.model.get("toDate")+" "+(i.pad(this.model.get("toHour"),2)+":"+i.pad(this.model.get("toMin"),2))+'</strong><i class="CDB-IconFont CDB-IconFont-calendar DatePicker-datesIcon"></i>'),this.$(".DatePicker-dates").html(c)},_setDefaultDate:function(){var a=this.model.get("user_timezone"),b=g().utc(a),c=g().utc(a).subtract(l-1,"days");this.options.date=[c.format("YYYY-MM-DD"),b.format("YYYY-MM-DD")],this.options.current=b.format("YYYY-MM-DD"),this._setModelFromPrevious(c)},_initCalendar:function(){var a=".DatePicker-calendar";document.body.contains(this.$(a)[0])&&(this.calendar=this.$(a).DatePicker(f.extend(this.options,{onChange:this._onDatesChange.bind(this),onRender:function(a){var b=a.valueOf(),c=new Date,d=new Date;return d.setDate(c.getDate()-l),b<d||b>c?{disabled:!0}:""}})))},_onDatesChange:function(a,b){var c=g(a[0]),d=g(a[1]);Math.abs(c.diff(d,"days"))>l&&(a[1]=g(a[0]).add("days",l).format("YYYY-MM-DD"),this.$(".DatePicker-calendar").DatePickerSetDate([a[0],a[1]])),this.model.set({fromDate:a[0],toDate:a[1]})},_hideCalendar:function(a){a&&this.killEvent(a),this.$(".DatePicker-dropdown").hide()},_toggleCalendar:function(a){a&&this.killEvent(a),this.$(".DatePicker-dropdown").toggle()},_setLastFourHours:function(){var a=g().utc(0).subtract(4,"hours");this._setModelFromPrevious(a),this._setDatepickerFromPrevious(a),this.closeCalendar()},_setLastDay:function(){var a=g().utc(0).subtract(1,"day");this._setModelFromPrevious(a),this._setDatepickerFromPrevious(a),this.closeCalendar()},_setLastWeek:function(){var a=g().utc(0).subtract(1,"week");this._setModelFromPrevious(a),this._setDatepickerFromPrevious(a),this.closeCalendar()},_setModelFromPrevious:function(a){var b=g().utc(0);this.model.set({fromDate:a.format("YYYY-MM-DD"),fromHour:parseInt(a.format("H"),10),fromMin:parseInt(a.format("m"),10),toDate:b.format("YYYY-MM-DD"),toHour:parseInt(b.format("H"),10),toMin:parseInt(b.format("m"),10)})},_setDatepickerFromPrevious:function(a){var b=g().utc(0);this.$(".DatePicker-calendar").DatePickerSetDate([a.format("YYYY-MM-DD"),b.format("YYYY-MM-DD")])},_initTimers:function(){var a=function(a,b){var c=23===b?_t("components.datepicker.hour"):_t("components.datepicker.min");return{type:"Number",title:c,validators:["required",{type:"interval",min:a,max:b}]}};this.model.schema={fromHour:a(0,23),fromMin:a(0,59),toHour:a(0,23),toMin:a(0,59)},this._datesForm=new d.Form({model:this.model,template:j}),this._datesForm.bind("change",function(){this.commit()}),this.$(".js-timers").append(this._datesForm.render().el)},_onValuesChange:function(){this.trigger("changeDate",this.model.toJSON(),this)},getDates:function(){return this.model.toJSON()},closeCalendar:function(){this.$(".DatePicker-dropdown").hide()},_onDocumentClick:function(a){var b=h(a.target);0===b.closest(".DatePicker").length&&this.closeCalendar()},clean:function(){this._datesForm.remove(),this._destroyBinds(),this.closeCalendar(),this.$(".DatePicker-calendar").DatePickerHide(),e.prototype.clean.call(this)}})},{"../../helpers/utils":1102,"../form-components/index":211,"./date-picker-range-form.tpl":61,"./date-picker-range.tpl":63,backbone:"backbone","backbone/core-view":1127,datepicker:1133,jquery:"jquery",moment:"moment",underscore:"underscore"}],63:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="DatePicker-dates js-dates has-icon CDB-Text CDB-Size-medium">\n  '+(null==(__t=_t("components.datepicker.from"))?"":_.escape(__t))+" <strong>"+(null==(__t=fromDate)?"":_.escape(__t))+" "+(null==(__t=pad(fromHour,2))?"":_.escape(__t))+":"+(null==(__t=pad(fromMin,2))?"":_.escape(__t))+"</strong> "+(null==(__t=_t("components.datepicker.to"))?"":_.escape(__t))+" <strong>"+(null==(__t=toDate)?"":_.escape(__t))+" "+(null==(__t=pad(toHour,2))?"":_.escape(__t))+":"+(null==(__t=pad(toMin,2))?"":_.escape(__t))+'</strong>\n  <i class="CDB-IconFont CDB-IconFont-calendar DatePicker-datesIcon"></i>\n</button>\n<div class="DatePicker-dropdown CDB-Text">\n  <div class="DatePicker-calendar"></div>\n  <div class="DatePicker-timers js-timers"></div>\n  <div class="DatePicker-shortcuts">\n    <p class="DatePicker-shortcutsText">\n      '+(null==(__t=_t("components.datepicker.get-last"))?"":_.escape(__t))+' <button type="button" class="Button--link js-fourHours">'+(null==(__t=_t("components.datepicker.hours-pluralize",{smart_count:4}))?"":_.escape(__t))+'</button>,\n      <button type="button" class="Button--link js-oneDay">'+(null==(__t=_t("components.datepicker.days-pluralize",{smart_count:1}))?"":_.escape(__t))+"</button> "+(null==(__t=_t("components.datepicker.or"))?"":_.escape(__t))+'\n      <button type="button" class="Button--link js-oneWeek">'+(null==(__t=_t("components.datepicker.weeks-pluralize",{smart_count:1}))?"":_.escape(__t))+'</button>\n    </p>\n    <p class="DatePicker-shortcutsText">'+(null==(__t=_t("components.datepicker.gmt-convertion"))?"":_.escape(__t))+"</p>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],64:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("moment"),g=a("jquery");a("../form-components/index"),a("datepicker");var h=a("./date-picker.tpl");b.exports=d.extend({className:"DatePicker",options:{flat:!0,date:"2008-07-31",current:"2008-07-31",calendars:1,starts:1},events:{"click .js-dates":"_toggleCalendar"},initialize:function(a){this.template=a.template||h,this._initBinds(),this._setDefaultDate()},render:function(){return this.clearSubViews(),this.$el.append(this.template({readOnly:this.model.get("readOnly"),date:this.options.date})),this.model.get("readOnly")&&this.undelegateEvents(),this},_initBinds:function(){g(document).bind("click",this._onDocumentClick.bind(this))},_destroyBinds:function(){g(document).unbind("click",this._onDocumentClick.bind(this))},_setDefaultDate:function(){var a=(new Date).getTimezoneOffset(),b=f(new Date).utcOffset(a).format("YYYY-MM-DD");this.options.date=this.model.get("value")&&f(this.model.get("value")).format("YYYY-MM-DD")||b,this.options.current=this.options.date},_$calendar:function(){return this.$(".js-calendar")},_$dropdown:function(){return this.$(".js-DatePicker-simpleDropdown")},_hideCalendar:function(a){a&&this.killEvent(a),this.model.set("visible",!1),this._destroyCalendar(),this._$dropdown().hide()},_showCalendar:function(){this.model.set("visible",!0),this._$calendar().DatePicker(e.extend(this.options,this.model.attributes,{onChange:function(a,b){this.model.set("value",a),this.$(".js-date-str").text(a),this._hideCalendar()}.bind(this),onRender:function(a){var b=a.valueOf(),c=new Date;return b>c?{disabled:!0}:""}})),this._$dropdown().show()},_destroyCalendar:function(){this.$(".DatePicker").length>0&&this._$calendar()&&this._$calendar().DatePickerHide()},_toggleCalendar:function(a){a&&this.killEvent(a),this.model.get("visible")?this._hideCalendar():this._showCalendar()},closeCalendar:function(){this._hideCalendar()},_onDocumentClick:function(a){var b=g(a.target);0===b.closest(".DatePicker").length&&this._hideCalendar()},clean:function(){this._destroyBinds(),this._hideCalendar(),d.prototype.clean.call(this)}})},{"../form-components/index":211,"./date-picker.tpl":65,"backbone/core-view":1127,datepicker:1133,jquery:"jquery",moment:"moment",underscore:"underscore"}],65:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="js-dates DatePicker-dates DatePicker-dates--singleDate js-DatePicker-dates has-icon ',readOnly&&(__p+=" is-disabled "),__p+='">\n  <strong class="js-date-str">'+(null==(__t=date)?"":_.escape(__t))+'</strong>\n  <i class="CDB-IconFont CDB-IconFont-calendar DatePicker-datesIcon"></i>\n</button>\n<div class="DatePicker-simpleDropdown datepickerHidden js-DatePicker-simpleDropdown">\n  <div class="js-calendar DatePicker-calendar DatePicker-calendar--simple"></div>\n</div>\n';return __p}},{underscore:"underscore"}],66:[function(a,b,c){var d=a("backbone"),e=a("moment");b.exports=d.Model.extend({defaults:{attribute:"",value:"",type:"string",readOnly:!1},initialize:function(){this.validationError="",this.bind("valid",function(){this.validationError=""},this),this.bind("error",function(a,b){this.validationError=b})},_validate:function(a,b){var c=d.Model.prototype._validate.apply(this,arguments);return!!c&&(this.trigger("valid"),!0)},validate:function(a){if(a){var b=a.value,c=a.type;if("number"===a.type){var d=/^(\+|-)?(?:[0-9]+|[0-9]*\.[0-9]+)$/;if(b&&!d.test(b))return"Invalid number"}return"boolean"===c&&null!==b&&b!==!0&&b!==!1?"Invalid boolean":"date"===c&&b&&!e(b).isValid()?"Invalid date":void 0}},getError:function(){return this.validationError},isValid:function(){return!this.validate||!this.validate(this.attributes)&&""===this.validationError}})},{backbone:"backbone",moment:"moment"}],67:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("cartodb.js"),h=a("./error.tpl");b.exports=f.extend({className:"IntermediateInfo",initialize:function(a){var b=d.defaults(d.pick(a,["title","desc"]),{title:_t("components.error.default-title"),desc:_t("components.error.default-desc")});this._template=this.options&&this.options.template||h,this.model=new e.Model(b)},render:function(){return this.$el.html(this._html()),this},_html:function(){var a=this.model;return this._template({title:a.get("title"),desc:g.core.sanitize.html(a.get("desc"))})}})},{"./error.tpl":68,backbone:"backbone","backbone/core-view":1127,"cartodb.js":"cartodb.js",underscore:"underscore"}],68:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LayoutIcon LayoutIcon--negative">\n  <i class="CDB-IconFont CDB-IconFont-cockroach"></i>\n</div>\n<h3 class="CDB-Text CDB-Size-large u-mainTextColor u-errorTextColor u-bSpace--m u-tSpace-xl">'+(null==(__t=title)?"":_.escape(__t))+'</h3>\n<p class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=desc)?"":__t)+"</p>\n";return __p}},{underscore:"underscore"}],69:[function(a,b,c){var d=a("backbone"),e=a("jquery"),f=27;d.Form.editors.Base=d.Form.editors.Base.extend({applyESCBind:function(a){this._ESCBindCallback=a,document.addEventListener("keydown",this._onKeyDown.bind(this))},_onKeyDown:function(a){var b;a.which===f&&(b=this._anyModalOpen(),!b&&this._ESCBindCallback())},applyClickOutsideBind:function(a){this._clickBindCallback=a,this.$el.attr("data-cid",this.cid),document.addEventListener("click",this._onDocumentClick.bind(this))},_onDocumentClick:function(a){var b=e(a.target),c=this._anyModalOpen();0!==b.closest('[data-cid="'+this.cid+'"]').length||c||this._clickBindCallback()},_anyModalOpen:function(){var a=this.options.modals;return!!a&&a.isOpen()},remove:function(){this._ESCBindCallback&&document.removeEventListener("keydown",this._onKeyDown.bind(this)),this._clickBindCallback&&document.removeEventListener("click",this._onDocumentClick.bind(this)),d.View.prototype.remove.call(this)}})},{backbone:"backbone",jquery:"jquery"}],70:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("../../../editor/editor-hints/factory-hints"),g=a("../../code-mirror/code-mirror-view");e.Form.editors.CodeEditor=e.Form.editors.TextArea.extend({render:function(){return this.setValue(this.value),this._codemirrorModel=new e.Model({content:this.value,readonly:!1,lineNumbers:!1}),f.init({tokens:this.options.tokens,tableName:!1,columnsName:!1}),this._initViews(),this._toggleDisableState(),this},getValue:function(){var a=this.$el.val();return a=this.codeMirrorView.getContent(),""===a?null:a},_initViews:function(){this._destroyEditor();var a=f.reset().hints;this.codeMirrorView=new g({model:this._codemirrorModel,hints:a,mode:"text/mustache",autocompleteChars:2,autocompletePrefix:"{{",autocompleteSuffix:"}}",placeholder:this.options.placeholder,tip:""}),this.codeMirrorView.bind("codeChanged",function(){this.trigger("change",this.codeMirrorView.getContent())},this);var b=d(this.codeMirrorView.render().el);this.$el.replaceWith(b),this.setElement(b),this.$el.addClass("CodeMirror-formInput"),this._addTrackingClass()},_addTrackingClass:function(){if(this.options.trackingClass){var a=this.options.trackingClass+" track-"+this.options.key+this.options.editorType;this.$el.addClass(a)}},_hasEditor:function(){return this.options.editor&&!!this.codeMirrorView},_destroyEditor:function(){this._hasEditor()&&this.codeMirrorView.remove()},remove:function(){this._destroyEditor(),e.Form.editors.Base.prototype.remove.apply(this)},clean:function(){this.$el.remove()}})},{"../../../editor/editor-hints/factory-hints":700,"../../code-mirror/code-mirror-view":27,backbone:"backbone",jquery:"jquery"}],71:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../../../helpers/required-opts"),g=a("../../../../components/stack-layout/stack-layout-view"),h=a("./measurement-list-view"),i=a("./filter-list-view"),j=["measurementsCollection","filtersCollection"];b.exports=e.extend({className:"CDB-Box-modal CustomList",initialize:function(a){f(a,j,this),this.model=new d.Model({visible:!1}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._generateStackLayoutView(),this},_initBinds:function(){this.listenTo(this.model,"change:visible",function(a,b){b?this.render():this.clearSubViews(),this._toggleVisibility()})},_generateStackLayoutView:function(){var a=this,b=new d.Collection([{createStackView:function(b,c){return a._createListView(b,c).bind(a)}},{createStackView:function(b,c){return a._createFilterView(b,c).bind(a)}}]);this._stackLayoutView=new g({collection:b}),this.addView(this._stackLayoutView),this.$el.append(this._stackLayoutView.render().$el)},_createListView:function(a,b){var c=new h({measurementsCollection:this._measurementsCollection,filtersCollection:this._filtersCollection});return c.bind("filters",function(){a.nextStep()},this),c},_createFilterView:function(a,b){var c=new i({filtersCollection:this._filtersCollection});return c.bind("back",function(){a.prevStep()},this),c},hide:function(){this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},_toggleVisibility:function(){this.$el.toggleClass("is-visible",!!this.isVisible())},clean:function(){e.prototype.clean.apply(this,arguments)}})},{"../../../../components/stack-layout/stack-layout-view":533,"../../../../helpers/required-opts":1097,"./filter-list-view":77,"./measurement-list-view":82,backbone:"backbone","backbone/core-view":1127}],72:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",__p+="undefined"!=typeof isLoading&&isLoading?'\n  <div class="u-flex">\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n    <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n  </div>\n":"\n  "+(null==(__t=label)?"":_.escape(__t))+"\n",__p+="\n";return __p}},{underscore:"underscore"}],73:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("./dropdown.tpl"),g=a("./dropdown-item.tpl"),h=a("./dropdown-dialog-view"),i=a("../../../popup-manager"),j=a("./measurements-collection"),k=a("./measurements-filters-collection"),l=13,m={idle:"idle",loading:"loading",fetching:"fetching",fetched:"fetched",error:"error"};d.Form.editors.DataObservatoryDropdown=d.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},options:{selectedItemTemplate:g},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.template=a.template||f,this.dialogMode=this.options.dialogMode||"nested";var b={configModel:this.options.configModel,layerDefinitionModel:this.options.layerDefinitionModel,country:this.model.get("country")||null};this.measurementsCollection=new j([],b),this.filtersCollection=new k([],b),this._modelView=new d.Model({state:m.idle}),this._initBinds(),this._dialogView=new h({measurementsCollection:this.measurementsCollection,filtersCollection:this.filtersCollection}),this._fetch()},render:function(){var a=this._isLoading(),b=!this._hasItems(),c=!!b||this.options.disabled,d=this.model.get(this.options.keyAttr),e=this.measurementsCollection.getItem(d),f=null===d,g=f?"null":!!e&&e.get("name"),h=this.options.placeholder;return this.$el.html(this.template({label:g,keyAttr:this.options.keyAttr,placeholder:h,isDisabled:c,isLoading:a,isEmpty:b,isNull:f})),this._popupManager=new i(this.cid,this.$el,this._dialogView.$el),this._popupManager.append(this.dialogMode),this},_initBinds:function(){var a=function(){this._dialogView.hide(),this._popupManager.untrack()}.bind(this);this.applyESCBind(a),this.applyClickOutsideBind(a),this.listenTo(this.measurementsCollection,"change:selected",this._onItemSelected),this.listenTo(this._modelView,"change:state",this.render),this.listenTo(this.model,"change:country",this._fetch)},_fetch:function(){var a={success:this._onFetchSuccess.bind(this),error:this._onFetchError.bind(this)};this.measurementsCollection.fetch(a),this.filtersCollection.fetch(a),this._modelView.set({state:m.loading}),this.setValue(this.model.get(this.options.keyAttr))},_onFetchSuccess:function(){var a=this.measurementsCollection.getState()===m.fetched,b=this.filtersCollection.getState()===m.fetched;b&&a&&this._modelView.set({state:m.fetched})},_onFetchError:function(){this._modelView.set({state:m.error})},_hasItems:function(){var a=this.measurementsCollection.getState();return a===m.fetched&&this.measurementsCollection.filter(function(a){var b=a.get("filter");return b.length>0}).length>0},_isLoading:function(){var a=this.measurementsCollection.getState();return a===m.fetching},_onItemSelected:function(a){this._dialogView.hide(),this._popupManager.untrack(),this._renderButton(a).focus(),this.trigger("change",this)},_onButtonClick:function(){this._hasItems()&&(this._dialogView.toggle(),this._dialogView.isVisible()?this._popupManager.track():this._popupManager.untrack())},_onButtonKeyDown:function(a){a.which===l&&(a.preventDefault(),this._dialogView.isVisible()?this._popupManager.track():(a.stopPropagation(),this._onButtonClick()))},getValue:function(){var a=this.measurementsCollection.getSelectedItem();if(a)return a.getName()},setValue:function(a){var b=this.measurementsCollection.setSelected(a);b&&this._renderButton(b),this.value=a},_renderButton:function(a){var b=this.$(".js-button"),c=this.options.selectedItemTemplate({label:a.getName()});return b.removeClass("is-empty").html(c),b},remove:function(){this._popupManager&&this._popupManager.destroy(),this._dialogView&&this._dialogView.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../popup-manager":522,"../editor-helpers-extend":92,"./dropdown-dialog-view":71,"./dropdown-item.tpl":72,"./dropdown.tpl":74,"./measurements-collection":84,"./measurements-filters-collection":85,backbone:"backbone"}],74:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-InputText CDB-Text is-cursor js-button u-ellipsis\n  ',isDisabled&&(__p+=" is-disabled "),__p+="\n  ",label||(__p+=" is-empty "),__p+="\n  ",isNull&&(__p+=" is-empty "),__p+='"\n  tabindex="0">\n  ',isLoading?__p+='\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark u-iBlock">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n    <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n  ":(__p+="\n    ",__p+=isEmpty?"\n      "+(null==(__t=_t("components.backbone-forms.select.empty"))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=placeholder||label||_t("components.backbone-forms.select.placeholder",{keyAttr:keyAttr}))?"":_.escape(__t))+"\n    ",__p+="\n  "),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],75:[function(a,b,c){var d=a("underscore"),e=a("../../../custom-list/custom-list-multi-item-view"),f=d.template("<%-name %> (<%- items %>)");b.exports=e.extend({render:function(){this.clearSubViews(),this.$el.empty();var a=null==this.model.getName()?"null":this.model.getName();return a=a.replace(/"/g,""),this.$el.append(this.options.template(d.extend({isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),name:f({name:a,items:this.model.get("items")}),val:this.model.getValue(),description:this.model.get("description")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},{"../../../custom-list/custom-list-multi-item-view":54,underscore:"underscore"}],76:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink\n  ',isSelected&&(__p+=" is-selected "),__p+='\n  " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  <div class="u-flex">\n    <div class="u-iBlock u-rSpace--m">\n      <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',isSelected&&(__p+="checked"),__p+=" ",
isDisabled&&(__p+="disabled"),__p+=' />\n      <span class="u-iBlock CDB-Checkbox-face"></span>\n    </div>\n    <div>\n      <div class="u-bSpace">'+(null==(__t=name)?"":_.escape(__t))+'</div>\n      <div class="CDB-Size-small u-altTextColor">'+(null==(__t=description)?"":_.escape(__t))+"</div>\n    </div>\n  </div>\n</button>\n";return __p}},{underscore:"underscore"}],77:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../custom-list/custom-view"),f=a("./filter-list-item-view"),g=a("./filter-list-item.tpl"),h=a("./filter-list-view.tpl"),i=a("../../../../helpers/required-opts"),j=["filtersCollection"];b.exports=d.extend({events:{"click .js-back":"_onClickBack"},initialize:function(a){i(a,j,this),this._initBinds(),this._listView=new e({className:"DO-Filters",typeLabel:_t("components.backbone-forms.data-observatory.dropdown.filter.filters"),showSearch:!1,collection:this._filtersCollection,itemTemplate:g,itemView:f}),this.addView(this._listView)},render:function(){return this.$el.append(h({headerTitle:_t("components.backbone-forms.data-observatory.dropdown.filter.header")})),this.$(".js-content").append(this._listView.render().$el),this},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_initBinds:function(){this.listenTo(this._filtersCollection,"change:selected",this._onSelectItem,this)},_onSelectItem:function(a){this.trigger("selectItem",a,this)}})},{"../../../../helpers/required-opts":1097,"../../../custom-list/custom-view":59,"./filter-list-item-view":75,"./filter-list-item.tpl":76,"./filter-list-view.tpl":78,"backbone/core-view":1127}],78:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <button class="u-actionTextColor js-back u-rSpace">\n        <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n      </button>\n      '+(null==(__t=headerTitle)?"":_.escape(__t))+'\n    </li>\n  </ul>\n</div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],79:[function(a,b,c){var d=a("underscore"),e=a("../../../custom-list/custom-list-item-view");b.exports=e.extend({render:function(){this.$el.empty(),this.clearSubViews();var a=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(d.extend({isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),name:a,val:this.model.getValue(),description:this.model.get("description")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},{"../../../custom-list/custom-list-item-view":50,underscore:"underscore"}],80:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink\n    ',isSelected&&(__p+=" is-selected "),__p+='\n  " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  <div class="u-bSpace">'+(null==(__t=name)?"":_.escape(__t))+'</div>\n  <div class="CDB-Size-small u-altTextColor">'+(null==(__t=description)?"":_.escape(__t))+"</div>\n</button>\n";return __p}},{underscore:"underscore"}],81:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeaderItem">\n  <div  class="u-flex u-grow">\n    <div class="u-flex u-grow">\n      <input type="text" name="text" autocomplete="off" placeholder="'+(null==(__t=searchPlaceholder)?"":_.escape(__t))+'" class="CDB-InputTextPlain CDB-Text js-search">\n      <button type="button" style="display:none" class="u-lSpace--xl u-rSpace--xl js-clear">\n        <div class="CDB-Shape">\n          <div class="CDB-Shape-close is-blue is-large"></div>\n        </div>\n      </button>\n    </div>\n\n    <div>\n      <button class="CDB-Text CDB-Size-medium u-actionTextColor js-filters u-rSpace--m">'+(null==(__t=_t("analyses.data-observatory-measure.filters"))?"":_.escape(__t))+"</button>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],82:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../../custom-list/custom-list-collection"),g=a("../../../custom-list/custom-view"),h=a("./measurement-list-item-view"),i=a("./measurement-list-item.tpl"),j=a("../../../../helpers/required-opts"),k=a("./measurement-list-search.tpl"),l=["measurementsCollection","filtersCollection"];b.exports=d.extend({events:{"click .js-filters":"_onClickFilters"},initialize:function(a){j(a,l,this),this._initCollection(),this._initBinds(),this._listView=new g({className:"DO-Measurements",typeLabel:_t("components.backbone-forms.data-observatory.dropdown.measurement.type"),showSearch:!0,itemView:h,searchTemplate:k,collection:this.collection,itemTemplate:i,searchPlaceholder:_t("components.backbone-forms.data-observatory.dropdown.measurement.search")}),this.addView(this._listView)},render:function(){return this.$el.append(this._listView.render().$el),this},_initCollection:function(){var a=e.map(this._filtersCollection.getSelected(),function(a){return a.getValue()}),b=this._measurementsCollection.filter(function(b){var c=b.get("filter");return a.length>0?e.some(c,function(b){return a.indexOf(b.id)>=0}):c.length>0});this.collection=new f(e.map(b,function(a){return a.attributes}))},_onClickFilters:function(a){this.killEvent(a),this.trigger("filters")},_initBinds:function(){this.listenTo(this.collection,"change:selected",this._onSelectItem)},_onSelectItem:function(a){this._measurementsCollection.setSelected(a.getValue())}})},{"../../../../helpers/required-opts":1097,"../../../custom-list/custom-list-collection":47,"../../../custom-list/custom-view":59,"./measurement-list-item-view":79,"./measurement-list-item.tpl":80,"./measurement-list-search.tpl":81,"backbone/core-view":1127,underscore:"underscore"}],83:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("cartodb.js"),g=a("../../../../helpers/error-parser"),h=a("../../../../helpers/required-opts"),i=["configModel","layerDefinitionModel"];b.exports=d.Collection.extend({initialize:function(a,b){h(b,i,this),this._country=b.country||"NULL",this._querySchemaModel=this._layerDefinitionModel.getAnalysisDefinitionNodeModel().querySchemaModel;var c=b.configModel;this.SQL=new f.SQL({user:c.get("user_name"),sql_api_template:c.get("sql_api_template"),api_key:c.get("api_key")}),this._state="unfetched"},fetch:function(a){this._success=a&&a.success,this._error=a&&a.error;var b=this._layerDefinitionModel.getTableName(),c=this._querySchemaModel.get("query"),d=this._queryTemplate({table:b,query:c,country:this._country});this.isFetching()||(this._state="fetching",this.SQL.execute(d,null,{success:function(a){this._state="fetched",this._onFetchSuccess(a),this._success&&this._success()}.bind(this),error:function(a){this._state="error",this._error&&this._error(g(a))}.bind(this)}))},_onFetchSuccess:function(a){var b=a.rows;this.reset(b)},isFetching:function(){return"fetching"===this.getState()},getState:function(){return this._state},getSelectedItem:function(){return e.first(this.getSelected())},getSelected:function(){return this.filter(function(a){return a.get("selected")===!0})},removeSelected:function(){this.each(function(a){a.set({selected:!1})})}})},{"../../../../helpers/error-parser":1090,"../../../../helpers/required-opts":1097,backbone:"backbone","cartodb.js":"cartodb.js",underscore:"underscore"}],84:[function(a,b,c){var d=a("underscore"),e=a("./measurements-base-collection"),f=a("../../../custom-list/custom-list-item-model"),g="SELECT * FROM OBS_GetAvailableNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM (<%- query %>) q), <%- country %>) numers";b.exports=e.extend({initialize:function(a,b){this._queryTemplate=d.template(g),e.prototype.initialize.call(this,a,b)},model:function(a,b){var c={};c.val=a.numer_id,c.label=a.numer_name,c.description=a.numer_description,c.filter=[];var d=JSON.parse(a.numer_tags);for(var e in d)/^subsection/.test(e)&&c.filter.push({id:e,name:d[e]}),/^license/.test(e)&&(c.license=d[e]);return new f(c)},getItem:function(a){return this.findWhere({val:a})},setSelected:function(a){var b,c={silent:!0};return this.each(function(d){d.getValue()===a?(d.set({selected:!0}),b=d):d.set({selected:!1},c)}),b}})},{"../../../custom-list/custom-list-item-model":49,"./measurements-base-collection":83,underscore:"underscore"}],85:[function(a,b,c){var d=a("underscore"),e=a("./measurements-base-collection"),f=a("../../../custom-list/custom-list-item-model"),g="SELECT count(*) num_measurements, tag.key subsection_id, tag.value subsection_name FROM OBS_GetAvailableNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM (<%- query %>) q), <%- country %>) numers, Jsonb_Each(numers.numer_tags) tag WHERE tag.key like 'subsection%' GROUP BY tag.key, tag.value";b.exports=e.extend({initialize:function(a,b){this._queryTemplate=d.template(g),e.prototype.initialize.call(this,a,b)},model:function(a,b){var c={};return c.val=a.subsection_id,c.label=a.subsection_name,c.items=a.num_measurements,new f(c)},setSelected:function(a){var b={silent:!0};d.isArray(a)?this.each(function(c){d.contains(a,c.getValue())?c.set({selected:!0},b):c.set({selected:!1},b)}):this.each(function(c){c.getValue()===a?c.set({selected:!0},b):c.set({selected:!1},b)})},search:function(){return d(this.models)},containsValue:function(a){return this.length>0}})},{"../../../custom-list/custom-list-item-model":49,"./measurements-base-collection":83,underscore:"underscore"}],86:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{show:!1},show:function(){this.set("show",!0)},hide:function(){this.set("show",!1)},isHidden:function(){return!this.get("show")},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone"}],87:[function(a,b,c){var d=a("backbone/core-view"),e=a("./datetime-editor-view");b.exports=d.extend({className:"CDB-Box-modal CustomList CustomList--inputs is-visible has-visibility js-datetimePicker",initialize:function(){this._initBinds()},render:function(){return this.clearSubViews(),this._datetimeEditorView=new e({model:this.model}),this.addView(this._datetimeEditorView),this.$el.append(this._datetimeEditorView.render().el),this},_initBinds:function(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},_onShowChange:function(a,b){b?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this.$el.hide())},show:function(){this.model.show()},hide:function(){this.model.hide()},_onDestroy:function(){this.hide(),this.clean()}})},{"./datetime-editor-view":89,"backbone/core-view":1127}],88:[function(a,b,c){var d=a("backbone"),e=a("../../../../helpers/utils"),f=a("moment"),g=[{val:0,label:_t("months.january")},{val:1,label:_t("months.february")},{val:2,label:_t("months.march")},{val:3,label:_t("months.april")},{val:4,label:_t("months.may")},{val:5,label:_t("months.june")},{val:6,label:_t("months.july")},{val:7,label:_t("months.august")},{val:8,label:_t("months.september")},{val:9,label:_t("months.october")},{val:10,label:_t("months.november")},{val:11,label:_t("months.december")}];b.exports=d.Model.extend({initialize:function(){this.schema={day:{type:"Text",title:"",validators:["required",/^(([0]?[1-9])|([1-2][0-9])|(3[01]))$/,function(a,b){var c=f(e.formatDate(b));if(!c.isValid())return{type:"date",message:_t("components.datepicker.invalid-date")}}]},month:{type:"Select",title:"",position:{left:0,"min-width":"200px"},options:g},year:{title:"",type:"Text",validators:["required",/^([0-9]{0,4})$/]},time:{title:"",type:"Text",validators:["required",/^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/]}}},getFormattedDate:function(){return e.formatDate(this.toJSON())}})},{"../../../../helpers/utils":1102,backbone:"backbone",moment:"moment"}],89:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("moment"),g=a("./datetime-editor-model");b.exports=e.extend({tagName:"div",className:"Table-editorDate",events:{keyup:"_onKeyUp"},initialize:function(){var a=this.model.get("value"),b={};b=a?f(a).utc():f().utc(),this._formModel=new g({day:b.date(),month:b.month(),year:b.year(),time:b.format("HH:mm:ss"),utcOffset:b.utcOffset()}),this._formModel.bind("change",this._setValue,this),this.add_related_model(this._formModel),this._setValue()},render:function(){return this._formView=new d.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.html(this._formView.render().el),this},_setValue:function(){this.model.set("value",this._formModel.getFormattedDate())},_onKeyUp:function(){this._setValue()},clean:function(){this._formView.remove(),e.prototype.clean.apply(this)}})},{"./datetime-editor-model":88,backbone:"backbone","backbone/core-view":1127,moment:"moment"}],90:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("moment"),g=a("./datetime-dialog-model"),h=a("./datetime-dialog-view"),i=a("./datetime.tpl"),j=a("../../../popup-manager");d.Form.editors.DateTime=d.Form.editors.Base.extend({className:"Editor-formInput u-flex u-alignCenter",events:{"click .js-input":"_onInputClick"},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.dialogMode=this.options.dialogMode||"nested",this._initBinds(),this.render()},render:function(){return d.Form.editors.Base.prototype.render.apply(this,arguments),this._removeDateTimeDialog(),this.$el.html(i({value:this._getFormattedDatetime()})),this._initViews(),this},_getFormattedDatetime:function(){if(this.value){var a=new Date(this.value).toUTCString(),b=f(a).utc();return b.format("YYYY-MM-DD")+"T"+b.format("HH:mm:ss")+"Z"}return null},_initViews:function(){this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._datetimeDialogModel=new g({value:this._getFormattedDatetime()}),this._datetimeDialogModel.bind("change:value",this._onInputChanged,this),this._datetimeDialogView=new h({model:this._datetimeDialogModel}),this._popupManager=new j(this.cid,this.$el,this._datetimeDialogView.$el)},_initBinds:function(){var a=function(){this._removeDateTimeDialog()}.bind(this);this.applyESCBind(a),this.applyClickOutsideBind(a)},_onInputClick:function(){this._datetimeDialogView.render(),this._popupManager.append(this.dialogMode),this._popupManager.track()},_removeDateTimeDialog:function(){this._datetimeDialogView&&(this._popupManager.untrack(),this._datetimeDialogView.remove())},_onInputChanged:function(a){var b=this._datetimeDialogModel.get("value");this.setValue(b),this.trigger("change",this)},_updateInput:function(a){this.$(".js-input").toggleClass("is-empty",!a).text(a)},getValue:function(){return this._datetimeDialogModel.get("value")},setValue:function(a){this._updateInput(a),this.value=a},remove:function(){this._removeDateTimeDialog(),this._popupManager&&this._popupManager.destroy(),d.Form.editors.Base.prototype.remove.apply(this)}})},{"../../../popup-manager":522,"../editor-helpers-extend":92,"./datetime-dialog-model":86,"./datetime-dialog-view":87,"./datetime.tpl":91,backbone:"backbone",moment:"moment"}],91:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-InputText\n  ',value||(__p+=" is-empty "),__p+='\n  u-txt-left js-input">'+(null==(__t=value?value:"null")?"":_.escape(__t))+"</button>\n";return __p}},{underscore:"underscore"}],92:[function(a,b,c){var d=a("underscore");b.exports={setOptions:function(a,b){var c=[];if(b.schema&&b.schema.validators&&(c=c.concat(b.schema.validators)),a.options&&a.options.validators&&(c=c.concat(a.options.validators)),a.validators=c,a.options=d.extend({},d.omit(a.options,"validators")||{},b.schema,b.schema&&b.schema.editorAttrs||{},b.editorAttrs,{keyAttr:b.key},{validators:c},d.omit(b,"validators")),a.options.className&&a.$el.addClass(a.options.className),a.options.trackingClass){var e=a.options.trackingClass+" track-"+a.options.key+a.options.editorType;a.$el.addClass(e)}}}},{underscore:"underscore"}],93:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("jquery"),g=a("underscore"),h=a("../../../tipsy-tooltip-view"),i=a("./enabler-editor.tpl");d.Form.editors.EnablerEditor=d.Form.editors.Base.extend({tagName:"div",className:"Editor-checker u-flex u-alignCenter",events:{"click .js-check":"_onCheckClicked"},initialize:function(a){if(d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.validators=null,!this.options.editor)throw new Error("editor options is required");this._editorOptions=this.options.editor,this.value=this.model.get(a.key),this._checkModel=new d.Model({enabled:!!this.value}),this.template=i,this._initBinds()},render:function(){return this.$el.html(this.template({label:this.options.label,isChecked:this._isChecked(),help:this.options.help||""})),this.options.help&&(this._helpTooltip=new h({el:this.$(".js-help"),gravity:"s",offset:0,title:function(){return f(this).data("tooltip")}})),this._renderComponent(),this},_initBinds:function(){this._checkModel.bind("change:enabled",function(a,b){this._manageValue(b),this._renderComponent(),this._triggerChange()},this)},_manageValue:function(a){a?(this.validators=this.options.validators,this.value=this.options.defaultValue||"",this._editorComponent.setValue(this.options.defaultValue||"")):(this.validators=null,this.value="",this._editorComponent.setValue("")),this.model.set(this.options.keyAttr,this.value),this.validate()},_isChecked:function(){return this._checkModel.get("enabled")},_renderComponent:function(){this._editorComponent&&this._removeComponent();var a=d.Form.editors[this._editorOptions.type],b=g.extend(this._editorOptions.editorAttrs||{},{disabled:!this._isChecked()});this._editorComponent=new a(g.extend({model:this.model,key:this.options.keyAttr,editorAttrs:b,trackingClass:this.options.trackingClass,editorType:this._editorOptions.type},g.omit(this._editorOptions,"editorAttrs","type"))),this._editorComponent.bind("change",this._setEditorComponentValue,this),this.$(".js-editor").html(this._editorComponent.render().el);try{this._editorComponent.focus()}catch(a){}},_removeComponent:function(){this._editorComponent.remove(),this._editorComponent.unbind("change",this._setEditorComponentValue,this)},_setEditorComponentValue:function(){this.value=this._editorComponent.getValue(),this._triggerChange()},_triggerChange:function(){this.trigger("change",this)},getValue:function(){return this._checkModel.get("enabled")?this._editorComponent&&this._editorComponent.getValue()||"":""},setValue:function(a){this._checkModel.set("enabled",!!a),this._editorComponent&&this._editorComponent.setValue(a),this.value=a},_onCheckClicked:function(a){this._checkModel.set("enabled",f(a.target).is(":checked"))},remove:function(){this._editorComponent&&this._removeComponent(),this._helpTooltip&&this._helpTooltip.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../tipsy-tooltip-view":589,"../editor-helpers-extend":92,"./enabler-editor.tpl":94,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],94:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex Editor-checkerInput CDB-Text CDB-Size-medium u-rSpace--xl">\n  <input class="CDB-Checkbox js-check" type="checkbox" name="" value="" ',isChecked&&(__p+="checked"),__p+='>\n  <span class="CDB-Checkbox-face u-rSpace--m"></span>\n  <label class="CDB-Text CDB-Size-small u-ellipsis u-upperCase is-semibold u-flex u-alignCenter Editor-formLabel">\n    <span class="u-ellipsis ',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+='  title="'+(null==(__t=label)?"":_.escape(__t))+'">'+(null==(__t=label)?"":_.escape(__t))+'</span>\n  </label>\n</div>\n<div class="Editor-checkerComponent js-editor"></div>\n';return __p}},{underscore:"underscore"}],95:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<label class="CDB-Legend u-upperCase CDB-Text is-semibold CDB-Size-small">\n  <div class="u-flex u-alignCenter">\n    <div class="u-iBlock u-rSpace--m">\n      <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',checked&&(__p+="checked"),__p+=" ",disabled&&(__p+="disabled"),__p+='>\n      <span class="u-iBlock CDB-Checkbox-face"></span>\n    </div>\n    <span class="',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+=" >"+(null==(__t=label)?"":_.escape(__t))+'</span>\n  </div>\n</label>\n<div class="Editor-checkerComponent js-editor"></div>\n';return __p}},{underscore:"underscore"}],96:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("jquery"),g=a("../../../tipsy-tooltip-view"),h=a("./enabler.tpl"),i=a("./enabler-reversed.tpl");d.Form.editors.Enabler=d.Form.editors.Base.extend({tagName:"div",events:{"change .js-input":"_onCheckChange","focus .js-input":function(){this.trigger("focus",this)},"blur .js-input":function(){this.trigger("blur",this)}},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.template=a.schema&&a.schema.editorAttrs&&a.schema.editorAttrs.reversed?i:a.template||h,this._initViews()},_initViews:function(){this.$el.html(this.template({checked:!this.options.disabled&&this.model.get(this.options.key),label:this.options.label,title:this.options.title,help:this.options.help||"",disabled:this.options.disabled})),this.options.help&&(this._removeTooltip(),this._helpTooltip=new g({el:this.$(".js-help"),gravity:"s",title:function(){return f(this).data("tooltip")}})),this.options.disabled&&this.undelegateEvents()},_onCheckChange:function(){var a=this.$(".js-input").is(":checked");this.model.set("enabler",a),this.trigger("change",this)},getValue:function(){return this.$(".js-input").is(":checked")},setValue:function(a){this.$(".js-input")[a?"attr":"removeAttr"]("checked",""),this.model.set(this.key,a)},_removeTooltip:function(){this._helpTooltip&&this._helpTooltip.clean()},remove:function(){this._removeTooltip(),d.Form.editors.Base.prototype.remove.apply(this)}})},{"../../../tipsy-tooltip-view":589,"../editor-helpers-extend":92,"./enabler-reversed.tpl":95,"./enabler.tpl":97,backbone:"backbone",jquery:"jquery"}],97:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<label class="CDB-Legend u-upperCase CDB-Text is-semibold CDB-Size-small">\n  <div class="u-flex u-alignCenter">\n    <div class="u-iBlock u-rSpace--m">\n      <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',checked&&(__p+="checked"),__p+=" ",disabled&&(__p+="disabled"),__p+='>\n      <span class="u-iBlock CDB-Checkbox-face"></span>\n    </div>\n    <span class="',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+=" >"+(null==(__t=title)?"":_.escape(__t))+'</span>\n  </div>\n</label>\n<div class="CDB-Text CDB-Size-medium Editor-formInput js-editor"></div>\n';return __p}},{underscore:"underscore"}],98:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="colorpicker dropdown-menu">\n  <div class="colorpicker-saturation">\n    <i><b></b></i>\n  </div>\n  <div class="colorpicker-hue">\n    <i class="ColorPicker-ball"></i>\n  </div>\n  <div class="colorpicker-alpha js-alpha">\n    <i class="ColorPicker-ball"></i>\n  </div>\n  <div class="ColorPicker-colorWrapper">\n    <div class="ColorPicker-color colorpicker-color js-color"></div>\n  </div>\n</div>';return __p}},{underscore:"underscore"}],99:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("backbone/core-view");a("bootstrap-colorpicker");var h=a("./template.tpl"),i=a("./color-picker-template.tpl"),j=a("../../../../../helpers/utils"),k=27;b.exports=g.extend({events:{"blur .js-hex":"_onChangeHex","blur .js-inputColor":"_onChangeColorValue","blur .js-a":"_onChangeOpacity"},initialize:function(a){var b=null!=a.opacity?a.opacity:1;this.model=new f.Model({hex:a.value,opacity:b}),this._onEscape=this._onEscapePressed.bind(this),this._initBinds()},render:function(){var a=j.hexToRGB(this.model.get("hex")),b=e.extend(a,{hex:this.model.get("hex"),opacity:this.model.get("opacity"),opacityDisabled:this.options.disableOpacity});this.$el.append(h(b));var c=e.template("rgba(<%- r %>, <%- g %>, <%- b %>, <%- opacity %>)");this.$(".js-colorPicker").colorpicker({color:c(b),format:"rgba",container:!0,horizontal:!0,inline:!0,customClass:"ColorPicker",template:i(),slidersHorz:{saturation:{maxLeft:206,maxTop:95,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:180,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:180,maxTop:0,callLeft:"setAlpha",callTop:!1}}}),this.options.disableOpacity&&this.$(".js-colorPicker .js-alpha").addClass("is-hidden");var d=function(a){var b=a.color.toRGB(),c=a.color.toHex();this.model.set({hex:c,r:b.r,g:b.g,b:b.b,opacity:b.a}),this.$(".js-color").css("opacity",b.a)}.bind(this);return this.$(".js-colorPicker").colorpicker().on("changeColor",d),this._initDocumentBinds(),this},_initBinds:function(){this.model.bind("change:hex",this._onChangeColor,this),this.model.bind("change:r",this._onChangeColor,this),this.model.bind("change:g",this._onChangeColor,this),this.model.bind("change:b",this._onChangeColor,this),this.model.bind("change:opacity",this._onChangeColor,this)},_onEscapePressed:function(a){a.which===k&&this.remove()},_initDocumentBinds:function(){d(document).on("keydown",this._onEscape)},_destroyDocumentBinds:function(){d(document).off("keydown",this._onEscape)},_onChangeColor:function(){this.trigger("change",{opacity:this.model.get("opacity"),hex:this.model.get("hex")},this),this.$(".js-hex").val(this.model.get("hex")),this.$(".js-r").val(this.model.get("r")),this.$(".js-g").val(this.model.get("g")),this.$(".js-b").val(this.model.get("b")),this.$(".js-a").val(this.model.get("opacity"))},_onChangeOpacity:function(){var a=+this.$(".js-a").val();e.isNumber(a)&&a>=0&&a<=1&&this.setColor(this.model.get("hex"),a)},_onChangeColorValue:function(a){this.$(a.target).removeClass("has-error");var b=+this.$(".js-r").val(),c=+this.$(".js-g").val(),d=+this.$(".js-b").val(),e=j.rgbToHex(b,c,d);j.isValidHex(e)?this.setColor(e):this.$(a.target).addClass("has-error")},_onChangeHex:function(a){this.$(a.target).removeClass("has-error");var b=this.$(".js-hex").val();j.isValidHex(b)?this.setColor(b):this.$(a.target).addClass("has-error")},setColor:function(a,b){void 0===b&&(b=this.model.get("opacity")||1),this.$(".js-colorPicker").colorpicker("setValue",j.hexToRGBA(a,b))},clean:function(){this._destroyDocumentBinds(),g.prototype.clean.apply(this)}})},{"../../../../../helpers/utils":1102,"./color-picker-template.tpl":98,"./template.tpl":100,backbone:"backbone","backbone/core-view":1127,"bootstrap-colorpicker":"bootstrap-colorpicker",jquery:"jquery",underscore:"underscore"}],100:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-boxModalContent">\n  <div class="ColorPicker-pickerWrapper js-colorPicker"></div>\n  <div class="ColorPicker-inputs">\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input is-color js-hex" value="'+(null==(__t=hex)?"":_.escape(__t))+'"/>\n      <span class="ColorPicker-inputLabel u-upperCase">HEX</span>\n    </div>\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input js-inputColor js-r" value="'+(null==(__t=r)?"":_.escape(__t))+'"/>\n      <span class="ColorPicker-inputLabel u-upperCase">R</span>\n    </div>\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input js-inputColor js-g" value="'+(null==(__t=g)?"":_.escape(__t))+'" />\n      <span class="ColorPicker-inputLabel u-upperCase">G</span>\n    </div>\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input js-inputColor js-b" value="'+(null==(__t=b)?"":_.escape(__t))+'" />\n      <span class="ColorPicker-inputLabel u-upperCase">B</span>\n    </div>\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input js-a',opacityDisabled&&(__p+=" is-disabled"),__p+='" value="'+(null==(__t=opacity)?"":_.escape(__t))+'" ',opacityDisabled&&(__p+="disabled"),__p+=' />\n      <span class="ColorPicker-inputLabel u-upperCase">A</span>\n    </div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],101:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../custom-list/custom-view"),f=a("../../../custom-list/custom-list-collection"),g=a("./column-list-view.tpl");b.exports=d.extend({defaults:{headerTitle:""},events:{"click .js-back":"_onClickBack"},initialize:function(a){if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");if(!a.columns)throw new Error("columns param is required");this._stackLayoutModel=a.stackLayoutModel,this._columns=a.columns,this._showSearch=a.showSearch||!1,this._typeLabel=a.typeLabel,this._itemTemplate=a.itemTemplate,this.collection=new f(this._columns),this.listenTo(this.collection,"change:selected",this._onSelectItem)},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(g({headerTitle:this.options.headerTitle})),this._initViews(),this},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_initViews:function(){this._listView=new e({collection:this.collection,showSearch:this._showSearch,typeLabel:this._typeLabel,itemTemplate:this._itemTemplate}),this.$(".js-content").append(this._listView.render().$el),this.addView(this._listView)},_onSelectItem:function(a){this.trigger("selectItem",a,this)}})},{"../../../custom-list/custom-list-collection":47,"../../../custom-list/custom-view":59,"./column-list-view.tpl":102,"backbone/core-view":1127}],102:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",headerTitle&&(__p+='\n<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <button class="u-actionTextColor js-back u-rSpace">\n        <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n      </button>\n      '+(null==(__t=headerTitle)?"":_.escape(__t))+"\n    </li>\n  </ul>\n</div>\n"),
__p+='\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],103:[function(a,b,c){b.exports={number:{quantifications:{items:["quantiles","jenks","equal","headtails"],defaultIndex:0},bins:{items:["2","3","4","5","6","7"],defaultIndex:3}},color:{quantifications:{items:["jenks","equal","headtails","quantiles","category"],defaultIndex:0}},"color-ramps":{quantifications:{items:["quantiles","jenks","equal","headtails","category"],defaultIndex:0},bins:{items:["2","3","4","5","6","7"],defaultIndex:3}}}},{}],104:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=d.Model.extend({defaults:{visible:!0,createContentView:function(){return new e}},createContentView:function(){return this.get("createContentView")(this)},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},isHidden:function(){return!this.get("visible")},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone","backbone/core-view":1127}],105:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({className:"Editor-boxModal Editor-FormDialog js-formDialog is-opening",initialize:function(){this._initBinds()},render:function(){return this.clearSubViews(),this._renderContentView(),this},_renderContentView:function(){var a=this.model.createContentView();this.addView(a),this.$el.append(a.render().$el)},_initBinds:function(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},_onShowChange:function(a,b){b?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this.$el.hide())},show:function(){this.model.show()},hide:function(){this.model.hide()},_onDestroy:function(){this.hide(),this.clean()}})},{"backbone/core-view":1127}],106:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-boxModalHeader">\n  <nav class="CDB-NavMenu">\n    <ul class="CDB-NavMenu-Inner CDB-NavMenu-inner--no-margin CDB-NavMenu-inner--is-dropdown CDB-Text is-semibold CDB-Size-medium js-menu"></ul>\n  </nav>\n</div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],107:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="CDB-OptionInput-container js-content"></ul>\n';return __p}},{underscore:"underscore"}],108:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../editor-helpers-extend"),g=a("./fill-dialog-model"),h=a("./fill-dialog"),i=a("./input-collection"),j=a("./input-number/input-number"),k=a("./input-color/input-color"),l=a("./fill-template.tpl"),m=a("../../../popup-manager"),n={size:j,color:k,image:k},o={Jenks:"jenks","Equal Interval":"equal","Heads/Tails":"headtails",Quantile:"quantiles"},p=20;e.Form.editors.Fill=e.Form.editors.Base.extend({className:"Form-InputFill CDB-OptionInput CDB-Text js-input",events:{focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(a){e.Form.editors.Base.prototype.initialize.call(this,a),f.setOptions(this,a),this.options=d.extend(this.options,{columns:this.options.options,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,editorAttrs:this.options.editorAttrs,modals:this.options.modals}),this._keyAttr=a.key,this.dialogMode=this.options.dialogMode||"nested",this._initBinds(),this._initViews()},_initViews:function(){this.$el.append(l()),this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._initFillDialog(),this._initInputFields(),this._popupManager=new m(this.cid,this.$el,this._fillDialogView.$el)},_initInputFields:function(){var a;this._inputCollection=new i,d.each(this.model.get(this._keyAttr),function(a,b){this._inputCollection.add(d.extend({type:b},a))},this),this._inputCollection.each(function(b){var c=b.get("type"),d=n[c];if(!d)throw new Error(c+" is not a valid type of constructor");b.get("quantification")&&o[b.get("quantification")]&&b.set("quantification",o[b.get("quantification")],{silent:!0}),a=new d({model:b,columns:this.options.columns,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,modals:this.options.modals,editorAttrs:this.options.editorAttrs?this.options.editorAttrs[c]:{},disabled:this.options.editorAttrs&&this.options.editorAttrs.disabled}),a.bind("click",this._onInputClick,this),this.$(".js-content").append(a.render().$el)},this),this._inputCollection.bind("inputChanged",this._onInputChanged,this)},_initBinds:function(){this.applyESCBind(function(){this._removeDialog()}),this.applyClickOutsideBind(function(){this._removeDialog()})},_onInputClick:function(a){return a.get("selected")?void this._removeDialog():(a.set("selected",!0),this._fillDialogView.model.set("createContentView",a.get("createContentView")),this._fillDialogView.render(),this._fillDialogView.show(),this._popupManager.append(this.dialogMode),void this._popupManager.track())},_onInputChanged:function(a){this._adjustImageSize(a),this.trigger("change",this)},_adjustImageSize:function(a){if("color"===a.get("type")||"marker"===a.get("kind")){var b=a.get("image")&&a.hasChanged("image")&&!a.previous("image"),c=d.isEmpty(d.compact(a.get("images"))),e=d.isEmpty(d.compact(a.previous("images"))),f=!c&&a.hasChanged("images")&&e;if(b||f){var g=this._inputCollection.findWhere({type:"size"});g&&g.get("fixed")<p&&g.set("fixed",p)}}},_initFillDialog:function(){var a=new g;this.listenToOnce(a,"destroy",function(){this._fillDialogView=null,this.stopListening(a)}),this._fillDialogView=new h({model:a})},_removeDialog:function(a){this._inputCollection.unselect(),this._fillDialogView.remove(),this._popupManager.untrack()},focus:function(){this.hasFocus||this.$(".js-fillInput").focus()},blur:function(){this.hasFocus&&this.$(".js-fillInput").blur()},getValue:function(){return this._inputCollection.getValues()},setValue:function(a){},remove:function(){this._removeDialog(),this._popupManager.destroy(),this._inputCollection.unbind("inputChanged",this._onInputChanged,this),e.Form.editors.Base.prototype.remove.apply(this)}})},{"../../../popup-manager":522,"../editor-helpers-extend":92,"./fill-dialog":105,"./fill-dialog-model":104,"./fill-template.tpl":107,"./input-collection":109,"./input-color/input-color":151,"./input-number/input-number":167,backbone:"backbone",underscore:"underscore"}],109:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=["size","color"];b.exports=d.Collection.extend({constructor:function(a,b){b=e.extend(b||{},{silent:!1}),d.Collection.prototype.constructor.call(this,a,b)},comparator:function(a){return f.indexOf(a.get("type"))},initialize:function(){this.bind("change:selected",this._onSelectedChange,this),this.bind("change",this._onModelsChanged,this)},getSelected:function(){return this.find(function(a){return a.get("selected")})},unselect:function(){this.each(function(a){a.set("selected",!1)},this)},_onSelectedChange:function(a,b){b&&this.each(function(b){b!==a&&b.set("selected",!1)},this)},_onModelsChanged:function(a){var b=a.changed;e.isEmpty(b)||1===e.size(b)&&a.changed.hasOwnProperty("selected")||this.trigger("inputChanged",a,this)},getValues:function(){return this.reduce(function(a,b){var c={},d=b.toJSON();return d.fixed?(c.fixed=d.fixed,"color"===d.type&&(d.image&&(c.image=d.image),d.kind&&(c.kind=d.kind),c.opacity=d.opacity)):c=e.omit(d,["createContentView","selected","type"]),a[d.type]=c,a},{})}})},{backbone:"backbone",underscore:"underscore"}],110:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../../helpers/required-opts"),f=a("./asset-header-view.tpl"),g=["title","editable"];b.exports=d.extend({events:{"click .js-remove":"_onClickRemove","click .js-select-all":"_onClickSelectAll","click .js-deselect-all":"_onClickDeselectAll"},initialize:function(a){e(a,g,this),this._assetsCollection=this.options.assetsCollection,this._initBinds()},render:function(){this.clearSubViews();var a=this._getSelectedAssetsCount(),b=this._assetsCollection.size();return this.$el.html(f({title:this._title,editable:this._editable,assetsCount:b,selectedCount:a,allSelected:a===b})),this},_initBinds:function(){this.listenTo(this._assetsCollection,"add change remove",this.render)},_onClickRemove:function(){this.trigger("remove")},_onClickSelectAll:function(){this.trigger("select-all")},_onClickDeselectAll:function(){this.trigger("deselect-all")},_getSelectedAssetsCount:function(){var a=this._assetsCollection.where({state:"selected"});return a?a.length:0}})},{"../../../../../../helpers/required-opts":1097,"./asset-header-view.tpl":111,"backbone/core-view":1127}],111:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul>\n  <li class="CDB-NavSubmenu-item">\n    <h2 class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=title)?"":_.escape(__t))+"</h2>\n  </li>\n  ",editable&&assetsCount>0&&(__p+="\n    ",allSelected?__p+='\n      <li class="CDB-NavSubmenu-item">\n        <button class="CDB-NavSubmenu-itemLink CDB-Text CDB-Size-medium u-actionTextColor js-deselect-all">'+(null==(__t=_t("components.modals.assets-picker.deselect-all"))?"":_.escape(__t))+"</button>\n      </li>\n      ":selectedCount>0&&(__p+='\n      <li class="CDB-NavSubmenu-item">\n        <button class="CDB-NavSubmenu-itemLink CDB-Text CDB-Size-medium u-actionTextColor js-select-all">'+(null==(__t=_t("components.modals.assets-picker.select-all"))?"":_.escape(__t))+"</button>\n      </li>\n    "),__p+="\n\n    ",selectedCount>0&&(__p+='\n      <li class="CDB-NavSubmenu-item">\n          ',__p+=selectedCount>1?'\n        <button class="CDB-NavSubmenu-itemLink CDB-Text CDB-Size-medium u-errorTextColor js-remove">'+(null==(__t=_t("components.modals.assets-picker.delete-images"))?"":_.escape(__t))+"</button>\n        ":'\n        <button class="CDB-NavSubmenu-itemLink CDB-Text CDB-Size-medium u-errorTextColor js-remove">'+(null==(__t=_t("components.modals.assets-picker.delete-image"))?"":_.escape(__t))+"</button>\n        ",__p+="\n      </li>\n    "),__p+="\n  "),__p+="\n</ul>\n";return __p}},{underscore:"underscore"}],112:[function(a,b,c){var d=a("backbone/core-view"),e=a("./asset-item-view.tpl"),f=24;b.exports=d.extend({tagName:"li",className:"AssetsList-item AssetsList-item--medium",events:{"click .js-asset":"_onClick"},initialize:function(a){this.listenTo(this.model,"change:state",this._changeState)},render:function(){this.clearSubViews(),this.$el.attr("id",this.model.get("id"));var a=this.model.get("type")||"icon";return this.$el.append(e({type:a,height:this.options.assetHeight||f,name:this.model.get("name"),public_url:this.model.get("public_url")})),this.$el.addClass("AssetsList-item--"+a),this},_onClick:function(a){this.killEvent(a),this.trigger("selected",this.model)},_changeState:function(){this.$el.toggleClass("is-selected","selected"===this.model.get("state"))}})},{"./asset-item-view.tpl":113,"backbone/core-view":1127}],113:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="AssetItem-label CDB-Text CDB-Size-big ',__p+="icon"===type?"u-mainTextColor":"u-actionTextColor",__p+=' u-upperCase js-asset" title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  ',__p+="icon"===type||"file"===type?'\n    <img height="'+(null==(__t=height)?"":_.escape(__t))+'" src="'+(null==(__t=public_url)?"":_.escape(__t))+'" alt="'+(null==(__t=name)?"":_.escape(__t))+'" />\n  ':"\n    "+(null==(__t=name)?"":_.escape(__t))+"\n  ",__p+="\n</div>\n";return __p}},{underscore:"underscore"}],114:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./static-asset-item-view"),g=a("../../../../../../data/static-assets-collection"),h=a("../../../../../../helpers/required-opts"),i=["icons","selectedAsset"];b.exports=e.extend({tagName:"ul",className:"AssetsList",initialize:function(a){h(a,i,this),this._setupAssets(a)},render:function(){return this.clearSubViews(),this._renderAssets(),this},_renderAssets:function(){this._assetsCollection.each(function(a){var b=new f({model:a});this.model&&b.model.getURLFor(a.get("icon"))===this.model.get("image")&&b.model.set("state","selected"),b.bind("selected",this._selectItem,this),this.$el.append(b.render().el),this.addView(b)},this)},_setupAssets:function(a){d.isEmpty(a)||(this._icons=d.map(this._icons,function(b){return d.extend(b,a)}));var b=this._icons;this.options.limit&&(b=b.slice(0,this.options.limit)),this._assetsCollection=new g(b),this.add_related_model(this._assetsCollection)},_selectItem:function(a){this._selectedAsset.set({url:a.get("public_url"),kind:a.get("kind")}),this._assetsCollection.deselectAll(a)}})},{"../../../../../../data/static-assets-collection":662,"../../../../../../helpers/required-opts":1097,"./static-asset-item-view":123,"backbone/core-view":1127,underscore:"underscore"}],115:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("backbone"),h=a("../../../../../../helpers/utils"),i=a("../assets/maki-icons"),j=a("./user-assets-tab"),k=a("./organization-assets-list-view"),l=a("../../../../../../data/organization-assets-collection"),m=a("./upload-assets-tab"),n=a("../../../../../../helpers/required-opts"),o=a("../../../../../../data/assets-collection"),p=a("../../../../../tab-pane/create-text-labels-tab-pane"),q=a("../../../../../scroll/scroll-view"),r=a("./assets-list-view"),s=a("../../../../../loading/render-loading"),t=a("../../../../../error/error-view"),u=a("./upload-assets-error.tpl"),v=a("../../../../../../helpers/error-parser"),w=a("./assets-view.tpl"),x=a("./tab-pane-template.tpl"),y="custom-marker",z=["modalModel","configModel","userModel"];b.exports=f.extend({className:"Dialog-content Dialog-content--expanded",events:{"click .js-add":"_onSetImage","click .js-upload":"_initUpload","change .js-fileInput":"_onFileSelected","click .js-back":"_onClickBack"},initialize:function(a){n(a,z,this),this._initModels(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(w({disclaimer:i.disclaimer})),this._hasFetchedAllCollections()?this._initTabPane():this._isLoading()?this._renderLoading():this._hasError()&&this._renderError(),this},_hasFetchedAllCollections:function(){return"show"===this._stateModel.get("status")},_initModels:function(){var a=this;this._selectedAsset=new g.Model({url:this.model.get("image")}),this._stateModel=new g.Model({status:"loading",modalEnabled:!1,uploads:0}),this._assetCollections=[],this._userAssetCollection=new o(null,{configModel:this._configModel,userModel:this._userModel}),this._assetCollections.push(this._userAssetCollection),this._userModel.isInsideOrg()&&(this._organizationAssetCollection=new l(null,{configModel:this._configModel,orgId:this._userModel.getOrganization().get("id")}),this._assetCollections.push(this._organizationAssetCollection));var b=e.invoke(this._assetCollections,"fetch");d.when.apply(d,b).then(function(){a._stateModel.set("status","show")},function(b,c){a._setError(c)})},_initBinds:function(){this.listenTo(this._selectedAsset,"change:url",this._onChangeSelectedAsset),this.listenTo(this._stateModel,"change:status",this.render),this.listenTo(this._stateModel,"change:modalEnabled",this._onChangeSetButton)},_onClickBack:function(a){this.killEvent(a),this._stateModel.set("status","show"),this._assetsTabPaneView.setSelectedTabPaneByName("upload-file")},_upload:function(a){this._userAssetCollection.create(a,{beforeSend:this._beforeAssetUpload.bind(this),success:this._onAssetUploaded.bind(this),error:this._onAssetUploadError.bind(this),complete:this._onAssetUploadComplete.bind(this)})},_renderError:function(){this._hideDisclaimer(),this.$(".js-body").html(new t({title:h.capitalize(this._stateModel.get("error_message")),desc:_t("components.modals.assets-picker.error-desc"),template:u}).render().el)},_renderLoading:function(){this._hideDisclaimer(),this.$(".js-body").html(s({title:_t("components.modals.assets-picker.loading")}))},_isLoading:function(){return"loading"===this._stateModel.get("status")},_hasError:function(){return"error"===this._stateModel.get("status")},_initTabPane:function(){var a=[{name:"maki-icons",label:_t("components.modals.add-asset.icons"),createContentView:this._createMakiIconsView.bind(this)},{name:"your-uploads",label:_t("components.modals.add-asset.your-uploads"),createContentView:this._createYourUploadsView.bind(this)}];this._userModel.isInsideOrg()&&this._organizationAssetCollection.length>0&&a.push({name:"organization-uploads",label:_t("components.modals.add-asset.organization-uploads"),createContentView:this._createOrganizationUploadsView.bind(this)}),a.push({name:"upload-file",label:_t("components.modals.add-asset.upload-file"),createContentView:this._createUploadFileView.bind(this)});var b={tabPaneOptions:{template:x,disclaimer:i.disclaimer,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this._assetsTabPaneView=p(a,b),this.listenTo(this._assetsTabPaneView.collection,"change",this._onChangeSelectedTab),this.addView(this._assetsTabPaneView),this.$(".js-body").append(this._assetsTabPaneView.render().el),this._initSetButtonState()},_onChangeSelectedTab:function(){switch(this._assetsTabPaneView.getSelectedTabPaneName()){case"maki-icons":this._setDisclaimer(i.disclaimer),this._toggleSetButton();break;case"upload-file":this._hideDisclaimer(),this._disableSetButton();break;default:this._hideDisclaimer(),this._toggleSetButton()}},_toggleSetButton:function(){this._stateModel.set("modalEnabled",void 0!==this._selectedAsset.get("url"))},_initSetButtonState:function(){if(this.model.get("image")){var a=!1;"marker"===this.model.get("kind")&&(a=!0),a||e.each(this._assetCollections,function(b){a||(a=b.some(function(a){return this.model.get("image")===a.get("public_url")},this))},this),a&&this._enableSetButton()}},_enableSetButton:function(){this._stateModel.set("modalEnabled",!0)},_disableSetButton:function(){this._stateModel.set("modalEnabled",!1)},_createYourUploadsView:function(){var a=new j({model:this.model,selectedAsset:this._selectedAsset,title:_t("components.modals.add-asset.your-uploads"),organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,userModel:this._userModel}).bind(this);return this._userAssetsView=a,a.bind("init-upload",this._initUpload,this),this._hideDisclaimer(),this._userAssetsView},_createOrganizationUploadsView:function(){var a=new q({createContentView:function(){return new k({title:_t("components.modals.add-asset.organization-uploads"),model:this.model,organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,selectedAsset:this._selectedAsset})}.bind(this)});return this._hideDisclaimer(),a},_createUploadFileView:function(){var a=new m({model:this.model,userModel:this._userModel,configModel:this._configModel}).bind(this);return a.bind("upload-complete",this._onUploadComplete,this),a.bind("upload-files",this._uploadFiles,this),a.bind("upload-url",this._uploadURL,this),a},_createMakiIconsView:function(){return new q({createContentView:function(){return new r({model:this.model,selectedAsset:this._selectedAsset,title:_t("components.modals.add-asset.maki-icons"),icons:i.icons,folder:"maki-icons",kind:"marker",size:"18"})}.bind(this)})},_onUploadComplete:function(){this._assetsTabPaneView.setSelectedTabPaneByName("your-uploads")},_onChangeSetButton:function(){this.$(".js-add").toggleClass("is-disabled",!this._stateModel.get("modalEnabled"))},_onChangeSelectedAsset:function(){this._selectedAsset.get("url")||(this.model.unset("image"),this.model.unset("kind")),this._stateModel.set("modalEnabled",!!this._selectedAsset.get("url"))},_initUpload:function(a){this.killEvent(a),this.$(".js-fileInput").click()},_setDisclaimer:function(a){this.$(".js-disclaimer").html(a)},_hideDisclaimer:function(){this.$(".js-disclaimer").html("")},_getSelectedFiles:function(){return this.$(".js-fileInput").prop("files")},_uploadURL:function(a){this._upload({type:"url",kind:y,url:a})},_uploadFiles:function(a){e.each(a,function(a){this._upload({kind:y,type:"file",filename:a})},this)},_onFileSelected:function(){this._uploadFiles(this._getSelectedFiles())},_beforeAssetUpload:function(){this._stateModel.set("uploads",this._stateModel.get("uploads")+1),this._stateModel.get("uploads")>0&&this._stateModel.set("status","loading")},_onAssetUploaded:function(a){this._resetFileSelection()},_setError:function(a){this._stateModel.set({error_message:v(a),status:"error"})},_onAssetUploadError:function(a,b){this._resetFileSelection(),this._setError(b)},_onAssetUploadComplete:function(){this._stateModel.set("uploads",this._stateModel.get("uploads")-1),this._stateModel.get("uploads")<1&&!this._hasError()&&(this._stateModel.set("status","show"),this._onUploadComplete())},_resetFileSelection:function(){this.$(".js-fileInput").val("")},_onSetImage:function(a){this.killEvent(a),this._stateModel.get("modalEnabled")&&(this.model.set({image:this._selectedAsset.get("url"),kind:this._selectedAsset.get("kind")}),this.trigger("change",{url:this._selectedAsset.get("url"),kind:this._selectedAsset.get("kind")},this),this._modalModel.destroy(this.model))}})},{"../../../../../../data/assets-collection":606,"../../../../../../data/organization-assets-collection":650,"../../../../../../helpers/error-parser":1090,"../../../../../../helpers/required-opts":1097,"../../../../../../helpers/utils":1102,"../../../../../error/error-view":67,"../../../../../loading/render-loading":230,"../../../../../scroll/scroll-view":530,"../../../../../tab-pane/create-text-labels-tab-pane":537,"../assets/maki-icons":132,"./assets-list-view":114,"./assets-view.tpl":116,"./organization-assets-list-view":121,"./tab-pane-template.tpl":125,"./upload-assets-error.tpl":126,"./upload-assets-tab":127,"./user-assets-tab":131,backbone:"backbone","backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],116:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal">\n  <div class="Modal-header">\n    <div class="Modal-headerContainer">\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace">'+(null==(__t=_t("components.modals.add-asset.modal-title"))?"":_.escape(__t))+'</h2>\n      <h3 class="CDB-Text CDB-Size-medium u-altTextColor"><button class="u-actionTextColor js-upload">'+(null==(__t=_t("components.modals.add-asset.upload-asset"))?"":_.escape(__t))+"</button> "+(null==(__t=_t("components.modals.add-asset.modal-desc"))?"":_.escape(__t))+'</h3>\n    </div>\n  </div>\n\n  <div class="Modal-container js-body"></div>\n\n  <div class="Modal-footer">\n    <div class="Modal-footerContainer u-flex u-justifySpace">\n      <div class="CDB-Text CDB-Size-medium js-disclaimer">\n        ',disclaimer&&(__p+="\n        "+(null==(__t=disclaimer)?"":__t)+"\n        "),__p+='\n      </div>\n\n      <button class="CDB-Button CDB-Button--primary is-disabled js-add">\n        <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-asset.set-image"))?"":_.escape(__t))+'</span>\n      </button>\n    </div>\n  </div>\n</div>\n\n<form accept-charset="UTF-8" enctype="multipart/form-data" method="post">\n  <input type="file" accept="image/jpeg,image/jpg,image/gif,image/png,image/svg+xml" class="js-fileInput" style="position: absolute; clip: rect(0px 0px 0px 0px); opacity: 0;" multiple="multiple">\n</form>\n';return __p}},{underscore:"underscore"}],117:[function(a,b,c){var d=a("backbone/core-view"),e=a("./input-asset-picker-header.tpl"),f=a("../../../../../img-loader-view");b.exports=d.extend({events:{"click .js-back":"_onClickBack","click .js-colorPicker":"_onClickColorPicker"},initialize:function(a){this._imageEnabled=a.imageEnabled,this._initBinds()},render:function(a,b){this.clearSubViews(),this.$el.empty();var c=this._getRampItem();return this.$el.append(e({index:this.model.get("index")||0,color:c.color||"",label:c.title||_t("form-components.editors.fill.input-categories.others"),image:c.image||"",imageEnabled:this._imageEnabled})),this._loadImages(),this},_initBinds:function(){this.listenTo(this.model,"change:image",this.render)},_getRampItem:function(){var a=this.model.get("ramp");return a?a[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-categories.others"),image:""}},_loadImages:function(){var a=this._getRampItem();this.iconView=new f({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:a.image,color:a.color}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onClickColorPicker:function(a){this.killEvent(a),this.trigger("goToColorPicker",this)}})},{"../../../../../img-loader-view":213,"./input-asset-picker-header.tpl":118,"backbone/core-view":1127}],118:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemDisplay--flex CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <div class=\'CDB-ListDecoration-secondaryContainer\'>\n        <button class="u-rSpace u-actionTextColor js-back">\n          <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n        </button>\n        <span class="label js-label">'+(null==(__t=label)?"":_.escape(__t))+"</span>\n      </div>\n\n      <div class='CDB-ListDecoration-secondaryContainer'>\n        <nav class='CDB-NavMenu'>\n          <ul class='CDB-NavMenu-Inner CDB-NavMenu-inner--no-margin js-menu'>\n            <li class='CDB-NavMenu-item'>\n              <div class='CDB-NavMenu-link CDB-ListDecoration-rampNav-item'>\n                <button class=\"ColorBar CDB-ListDecoration-rampItemBar u-rSpace--xl js-colorPicker\" style=\"background-color: "+(null==(__t=color)?"":__t)+';" type="button"></button>\n              </div>\n            </li>\n\n            ',imageEnabled&&(__p+="\n              <li class='CDB-NavMenu-item is-selected'>\n                <div class='CDB-NavMenu-link CDB-ListDecoration-rampNav-item'>\n                  ",__p+=image?"\n                    <div class='CDB-ListDecoration-rampImg js-image-container'></div>\n                  ":'\n                    <span class="CDB-ListDecoration-rampImg CDB-Text js-assetPicker">'+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":__t)+"</span>\n                  ",__p+="\n                </div>\n              </li>\n            "),__p+="\n          </ul>\n        </nav>\n      </div>\n    </li>\n  </ul>\n</div>\n";return __p}},{underscore:"underscore"}],119:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./input-asset-picker-view.tpl"),h=a("./input-asset-picker-header"),i=a("../input-color-file-view"),j=a("../../../../../../helpers/required-opts"),k=["configModel","modals","ramp","userModel"];b.exports=f.extend({initialize:function(a){j(a,k,this),this._imageEnabled=a.imageEnabled,this.model=new e.Model({index:this.options.index,ramp:a.ramp})},render:function(){return this.clearSubViews(),this.$el.html(g()),this._initViews(),this},_initViews:function(){this._headerView=new h({model:this.model,imageEnabled:this._imageEnabled}),this._headerView.bind("goToColorPicker",this._onGoToColorPicker,this),this._headerView.bind("back",this._onClickBack,this),this.$(".js-header").append(this._headerView.render().el),this.addView(this._headerView),this._assetPicker=new i({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals,imageEnabled:this._imageEnabled}),this._assetPicker.bind("change",d.debounce(this._onChangeImage,50),this),this.$(".js-content").append(this._assetPicker.render().el),this.addView(this._assetPicker)},_getRampItem:function(){var a=this.model.get("ramp");return a?a[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-categories.others"),image:""}},_onChangeImage:function(a){var b=a&&a.url||"",c=a&&a.kind||"";this._getRampItem().image=b,this.model.trigger("change:image"),this.trigger("change:image",{url:b,kind:c,index:this.model.get("index")},this)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onGoToColorPicker:function(a){this.killEvent(a),this.trigger("goToColorPicker",this)}})},{"../../../../../../helpers/required-opts":1097,"../input-color-file-view":143,"./input-asset-picker-header":117,"./input-asset-picker-view.tpl":120,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],120:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-header"></div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],121:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../../helpers/required-opts"),f=a("./asset-item-view"),g=a("./organization-assets-list-view.tpl"),h=["userAssetCollection","organizationAssetCollection","selectedAsset"],i="custom-marker",j=48;b.exports=d.extend({initialize:function(a){e(a,h,this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g),this._organizationAssetCollection.deselectAll(),this._organizationAssetCollection.each(this._renderAsset,this),this},_initBinds:function(){this.listenTo(this._organizationAssetCollection,"reset",this.render),this.listenTo(this._organizationAssetCollection,"change",this._onChangeAssets)},_getSelectedAsset:function(){var a=this._organizationAssetCollection.where({state:"selected"});return a&&a[0]},_renderAsset:function(a){var b=new f({model:a,assetHeight:j,selectedAsset:this._selectedAsset});a.get("public_url")===this.model.get("image")&&a.set("state","selected"),b.bind("selected",this._selectAsset,this),this.$(".js-assets").append(b.render().el),this.addView(b)},_onChangeAssets:function(){var a=this._getSelectedAsset();this._selectedAsset.set({url:a&&a.get("public_url"),kind:i})},_selectAsset:function(a){a.set("state","selected"),this._organizationAssetCollection.deselectAll(a),this._userAssetCollection.deselectAll()}})},{"../../../../../../helpers/required-opts":1097,"./asset-item-view":112,"./organization-assets-list-view.tpl":122,"backbone/core-view":1127}],122:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="AssetsList js-assets"></ul>\n';return __p}},{underscore:"underscore"}],123:[function(a,b,c){var d=a("backbone/core-view"),e=a("./static-asset-item-view.tpl");b.exports=d.extend({tagName:"li",className:"AssetsList-item AssetsList-item--medium",events:{"click .js-asset":"_onClick"},initialize:function(){this.listenTo(this.model,"change:state",this._changeState)},render:function(){return this.clearSubViews(),this.$el.append(e({type:"icon",name:this.model.get("name"),public_url:this.model.get("public_url")
})),this},_onClick:function(a){this.killEvent(a),this.trigger("selected",this.model),this.model.set("state","selected")},_changeState:function(){this.$el.toggleClass("is-selected","selected"===this.model.get("state"))}})},{"./static-asset-item-view.tpl":124,"backbone/core-view":1127}],124:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",__p+="icon"===type?'\n<div class="AssetItem-icon js-asset"><img height="24" src="'+(null==(__t=public_url)?"":_.escape(__t))+'" alt="'+(null==(__t=name)?"":_.escape(__t))+'" crossOrigin="anonymous" /></div>\n':'\n<div class="AssetItem-label CDB-Text CDB-Size-small u-altTextColor u-upperCase js-asset" title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  '+(null==(__t=name)?"":_.escape(__t))+"\n</div>\n",__p+="\n";return __p}},{underscore:"underscore"}],125:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal-navigation">\n  <ul class="Modal-navigationInner CDB-Text is-semibold CDB-Size-medium js-menu"></ul>\n</div>\n<div class="Tab-paneContent Publish-modalContent Modal-inner Modal-inner--with-navigation js-content">\n</div>\n';return __p}},{underscore:"underscore"}],126:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LayoutIcon LayoutIcon--negative">\n  <i class="CDB-IconFont CDB-IconFont-cockroach"></i>\n</div>\n<h3 class="CDB-Text CDB-Size-large u-mainTextColor u-errorTextColor u-bSpace--m u-tSpace-xl">'+(null==(__t=title)?"":_.escape(__t))+'</h3>\n<p class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=desc)?"":__t)+'</p>\n\n<button class="CDB-Button CDB-Button--primary u-tSpace-xl js-back">\n  <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.assets-picker.go-back"))?"":_.escape(__t))+"</span>\n</button>\n";return __p}},{underscore:"underscore"}],127:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("../../../../../../helpers/utils");a("dragster");var g=a("dropzone"),h=a("backbone/core-view"),i=a("../../../../../../helpers/required-opts"),j=a("../../../../../../data/assets-collection"),k=a("./upload-assets-tab.tpl"),l=["configModel","userModel"];b.exports=h.extend({className:"Form-modal",events:{"keyup .js-url":"_onURLChanged","click .js-submit":"_onClickSubmit"},initialize:function(a){i(a,l,this),this._stateModel=new e.Model({status:"show",uploads:0}),this.listenTo(this._stateModel,"change:status",this.render),this._assetCollection=new j(null,{configModel:this._configModel,userModel:this._userModel})},render:function(){return this.clearSubViews(),this.$el.html(k()),this._initDropzone(),this},_initDropzone:function(){var a=d("html")[0],b=this;this.dragster=new Dragster(a),d(a).bind("dragster:enter",function(a){b._showDropzone()}),d(a).bind("dragster:leave",function(a){b._hideDropzone()}),a.dropzone||(this.dropzone=new g(a,{url:":)",autoProcessQueue:!1,previewsContainer:!1}),this.dropzone.on("dragover",function(){b._showDropzone()}),this.dropzone.on("drop",function(a){b.trigger("upload-files",a.dataTransfer.files),b._hideDropzone()}))},_showDropzone:function(){this.$(".Form-upload").addClass("is-dropping")},_hideDropzone:function(){this.$(".Form-upload").removeClass("is-dropping")},_destroyDropzone:function(){var a=d("html")[0];this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),d(a).unbind("dragster:enter dragster:leave")),this.dropzone&&this.dropzone.destroy()},_hasError:function(){return"error"===this._stateModel.get("status")},_onClickSubmit:function(a){this.killEvent(a);var b=this._getURL();return b?f.isURL(b)?(this._hideURLError(),void this.trigger("upload-url",b)):void this._showURLError():void this._hideURLError()},_getURL:function(){return this.$(".js-url").val()},_onURLChanged:function(){var a=this._getURL();a?f.isURL(a)?this._hideURLError():this._showURLError():this._hideURLError()},_showURLError:function(){this.$(".js-url-error").addClass("is-visible")},_hideURLError:function(){this.$(".js-url-error").removeClass("is-visible")},clean:function(){this._destroyDropzone(),h.prototype.clean.apply(this)}})},{"../../../../../../data/assets-collection":606,"../../../../../../helpers/required-opts":1097,"../../../../../../helpers/utils":1102,"./upload-assets-tab.tpl":128,backbone:"backbone","backbone/core-view":1127,dragster:1134,dropzone:1135,jquery:"jquery"}],128:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n    '+(null==(__t=_t("components.modals.assets-picker.upload-file-url"))?"":_.escape(__t))+'\n  </h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=_t("components.modals.assets-picker.upload-desc"))?"":_.escape(__t))+'\n  </p>\n</div>\n<div class="Form-row Form-row--centered">\n  <div class="Form-rowData Form-rowData--med Form-rowData--noMargin js-dropzone">\n    <div class="Form-upload">\n      <label class="Form-fileLabel js-fileLabel CDB-Text CDB-Size-medium">'+(null==(__t=_t("components.modals.assets-picker.drag-and-drop"))?"":_.escape(__t))+'</label>\n      <label class="Form-fileLabel Form-fileLabel--error CDB-Text CDB-Size-small js-fileError"></label>\n      <div class="Form-file">\n        <span class="CDB-Button CDB-Button--primary Form-fileButton CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase js-upload">\n          '+(null==(__t=_t("components.modals.assets-picker.browse"))?"":_.escape(__t))+'\n        </span>\n      </div>\n    </div>\n  </div>\n  <span class="u-lSpace--xl u-rSpace--xl u-flex u-alignCenter CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.assets-picker.or"))?"":_.escape(__t))+'</span>\n  <div class="Form-rowData Form-rowData--noMargin Form-rowData--med">\n    <input type="text" class="Form-input Form-input--med has-submit js-url CDB-Text CDB-Size-medium" value="" placeholder="https://carto.com/markers/pin.png" />\n    <button type="submit" class="CDB-Text CDB-Size-small Form-inputSubmit u-upperCase u-actionTextColor Form-inputSubmit js-submit">\n      <span>'+(null==(__t=_t("components.modals.assets-picker.submit"))?"":_.escape(__t))+'</span>\n    </button>\n    <div class="Form-inputError CDB-Text js-url-error">'+(null==(__t=_t("components.modals.assets-picker.incorrect-url"))?"":_.escape(__t))+"</div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],129:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("./asset-item-view"),h=a("../../../../../../helpers/required-opts"),i=a("backbone"),j=a("../../../../../loading/render-loading"),k=a("./asset-header-view"),l=a("../../../../../error/error-view"),m=a("./upload-assets-error.tpl"),n=a("./user-assets-list-view.tpl"),o=["userModel","userAssetCollection","selectedAsset"],p="custom-marker",q=48;b.exports=f.extend({initialize:function(a){if(h(a,o,this),this._userModel.isInsideOrg()){if(!a.organizationAssetCollection)throw new Error("organizationAssetCollection is required");this._organizationAssetCollection=a.organizationAssetCollection}this._stateModel=new i.Model,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(n),this._isLoading()?this._renderLoading():this._hasError()?this._renderError():this._renderRegularView(),this},_addHeaderView:function(){this._assetHeaderView=new k({editable:!0,title:this.options.title,assetsCollection:this._userAssetCollection}),this.addView(this._assetHeaderView),this.$(".js-nav").append(this._assetHeaderView.render().el),this._assetHeaderView.bind("select-all",this._selectAllAssets,this),this._assetHeaderView.bind("deselect-all",this._deselectAllAssets,this),this._assetHeaderView.bind("remove",this._removeSelectedAssets,this)},_renderRegularView:function(){this._addHeaderView(),this._renderAddButton(),this._userAssetCollection.deselectAll(),this._userAssetCollection.each(this._renderAsset,this)},_renderAddButton:function(){var a=new g({model:new i.Model({type:"text",name:"+"}),assetHeight:q});a.bind("selected",function(){this.trigger("init-upload")},this),this.addView(a),this.$(".js-assets").append(a.render().$el)},_initBinds:function(){this._keyDown=this._onKeyDown.bind(this),d(document).on("keydown",this._keyDown),this._keyUp=this._onKeyUp.bind(this),d(document).on("keyup",this._keyUp),this.listenTo(this._stateModel,"change:status",this.render),this.listenTo(this._userAssetCollection,"change",this._onChangeAssets)},_getSelectedAsset:function(){return this._userAssetCollection.findWhere({state:"selected"})},_getSelectedAssetsCount:function(){var a=this._userAssetCollection.where({state:"selected"});return a?a.length:0},_onKeyDown:function(a){this._shiftKeyPressed=a.shiftKey},_onKeyUp:function(a){this._shiftKeyPressed=a.shiftKey},_onClickBack:function(a){this.killEvent(a),this._stateModel.unset("status")},_renderAsset:function(a){var b=new g({model:a,assetHeight:q,selectedAsset:this._selectedAsset});a.get("public_url")===this.model.get("image")&&a.set("state","selected"),b.bind("selected",this._selectAsset,this),this.$(".js-assets").append(b.render().el),this.addView(b)},_onChangeAssets:function(){if(1===this._getSelectedAssetsCount()){var a=this._getSelectedAsset();this._selectedAsset.set({url:a&&a.get("public_url"),kind:p})}else this._selectedAsset.set({url:"",kind:""})},_selectAllAssets:function(){this._userAssetCollection.selectAll()},_deselectAllAssets:function(){this._userAssetCollection.deselectAll()},_selectAsset:function(a){this._shiftKeyPressed?a.set("state","selected"===a.get("state")?"":"selected"):a.set("state","selected"),this._shiftKeyPressed||(this._userAssetCollection.deselectAll(a),this._userModel.isInsideOrg()&&this._organizationAssetCollection.deselectAll())},_removeSelectedAssetsFromView:function(){var a=this._userAssetCollection.select(function(a){return"selected"===a.get("state")},this);e.each(a,function(a){this.$("#"+a.get("id")).remove()},this)},_removeSelectedAssets:function(){this._stateModel.set("status","loading");var a=this._userAssetCollection.select(function(a){return"selected"===a.get("state")},this);e.each(a,function(a){a.destroy({complete:this._onDestroyFinished.bind(this)})},this)},_onDestroyFinished:function(a){200===a.status?(this._removeSelectedAssetsFromView(),this._stateModel.unset("status"),this._selectedAsset.unset("kind"),this._selectedAsset.unset("url")):this._stateModel.set({error_message:a.statusText,status:"error"})},_isLoading:function(){return"loading"===this._stateModel.get("status")},_hasError:function(){return"error"===this._stateModel.get("status")},_renderLoading:function(){this.$el.html(j({title:_t("components.modals.assets-picker.loading")}))},_renderError:function(){this.$el.html(new l({title:this._stateModel.get("error_message"),desc:_t("components.modals.assets-picker.error-desc"),template:m}).render().el)},_disableBinds:function(){d(document).off("keydown",this._keyDown),d(document).off("keyup",this._keyUp)},clean:function(){this._disableBinds(),f.prototype.clean.apply(this)}})},{"../../../../../../helpers/required-opts":1097,"../../../../../error/error-view":67,"../../../../../loading/render-loading":230,"./asset-header-view":110,"./asset-item-view":112,"./upload-assets-error.tpl":126,"./user-assets-list-view.tpl":130,backbone:"backbone","backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],130:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<nav class="CDB-NavMenu u-bSpace--m u-inner js-nav"></nav>\n<ul class="AssetsList js-assets"></ul>\n';return __p}},{underscore:"underscore"}],131:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../../helpers/required-opts"),f=a("../../../../../scroll/scroll-view"),g=a("./user-assets-list-view"),h=["userModel","userAssetCollection","title","selectedAsset"];b.exports=d.extend({events:{"change .js-uploadInput":"_onFileSelected"},initialize:function(a){if(e(a,h,this),this._userModel.isInsideOrg()){if(!a.organizationAssetCollection)throw new Error("organizationAssetCollection is required");this._organizationAssetCollection=a.organizationAssetCollection}},render:function(){return this.clearSubViews(),this.$el.empty(),this._renderAssets(),this},_renderAssets:function(){var a=new f({createContentView:function(){var a=new g({title:this._title,model:this.model,organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,selectedAsset:this._selectedAsset,userModel:this._userModel});return a.bind("init-upload",function(){this.trigger("init-upload")},this),a}.bind(this)});this.addView(a),this.$el.append(a.render().el)}})},{"../../../../../../helpers/required-opts":1097,"../../../../../scroll/scroll-view":530,"./user-assets-list-view":129,"backbone/core-view":1127}],132:[function(a,b,c){b.exports={disclaimer:_t("assets.maki-icons.disclaimer"),icons:[{name:"Square stroked",icon:"square-stroked"},{name:"Square solid",icon:"square"},{name:"Triangle stroked",icon:"triangle-stroked"},{name:"Triangle solid",icon:"triangle"},{name:"Star stroked",icon:"star-stroked"},{name:"Star solid",icon:"star"},{name:"Cross",icon:"cross"},{name:"Marker Stroke",icon:"marker-stroked"},{name:"Marker Solid",icon:"marker"},{name:"Religious Jewish",icon:"religious-jewish"},{name:"Religious Christian",icon:"religious-christian"},{name:"Religious Muslim",icon:"religious-muslim"},{name:"Cemetery",icon:"cemetery"},{name:"Rocket",icon:"rocket"},{name:"Airport",icon:"airport"},{name:"Heliport",icon:"heliport"},{name:"Rail",icon:"rail"},{name:"Rail Metro",icon:"rail-metro"},{name:"Rail Light",icon:"rail-light"},{name:"Bus",icon:"bus"},{name:"Fuel",icon:"fuel"},{name:"Parking",tags:["parking","transportation"],icon:"parking"},{name:"Parking Garage",tags:["parking","transportation","garage"],icon:"parking-garage"},{name:"Airfield",tags:["airfield","airport","plane","landing strip"],icon:"airfield"},{name:"Roadblock",tags:["roadblock","stop","warning","dead end"],icon:"roadblock"},{name:"Ferry",tags:["ship","boat","water","ferry","transportation"],icon:"ferry"},{name:"Harbor",tags:["marine","dock","water","wharf"],icon:"harbor"},{name:"Bicycle",tags:["cycling","cycle","transportation"],icon:"bicycle"},{name:"Park",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park"},{name:"Park 2",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park2"},{name:"Museum",tags:["recreation","museum","tourism"],icon:"museum"},{name:"Lodging",tags:["lodging","hotel","recreation","motel","tourism"],icon:"lodging"},{name:"Monument",tags:["recreation","statue","monument","tourism"],icon:"monument"},{name:"Zoo",tags:["recreation","zoo","animal","giraffe"],icon:"zoo"},{name:"Garden",tags:["recreation","garden","park","flower","nature"],icon:"garden"},{name:"Campsite",tags:["recreation","campsite","camp","camping","tent","nature"],icon:"campsite"},{name:"Theatre",tags:["recreation","theatre","theater","entertainment","play","performance"],icon:"theatre"},{name:"Art gallery",tags:["art","center","museum","gallery","creative","recreation","entertainment","studio"],icon:"art-gallery"},{name:"Pitch",tags:["pitch","track","athletic","sports","field"],icon:"pitch"},{name:"Soccer",tags:["soccer","sports"],icon:"soccer"},{name:"American Football",tags:["football","sports"],icon:"america-football"},{name:"Tennis",tags:["tennis","court","ball","sports"],icon:"tennis"},{name:"Basketball",tags:["basketball","ball","sports"],icon:"basketball"},{name:"Baseball",tags:["baseball","softball","ball","sports"],icon:"baseball"},{name:"Golf",tags:["golf","sports","course"],icon:"golf"},{name:"Swimming",tags:["swimming","water","swim","sports"],icon:"swimming"},{name:"Cricket",tags:["cricket","sports"],icon:"cricket"},{name:"Skiing",tags:["winter","skiing","ski","sports"],icon:"skiing"},{name:"School",tags:["school","highschool","elementary","children","amenity","middle"],icon:"school"},{name:"College",tags:["college","school","amenity","university"],icon:"college"},{name:"Library",tags:["library","books","amenity"],icon:"library"},{name:"Post",tags:["post","office","amenity","mail","letter"],icon:"post"},{name:"Fire station",tags:["fire","station","amenity"],icon:"fire-station"},{name:"Town hall",tags:["townhall","mayor","building","amenity","government"],icon:"town-hall"},{name:"Police",tags:["police","jail","arrest","amenity","station"],icon:"police"},{name:"Prison",tags:["prison","jail","amenity"],icon:"prison"},{name:"Embassy",tags:["embassy","diplomacy","consulate","amenity","flag"],icon:"embassy"},{name:"Beer",tags:["bar","beer","drink","commercial","biergarten","pub"],icon:"beer"},{name:"Restaurant",tags:["restaurant","commercial"],icon:"restaurant"},{name:"Cafe",tags:["cafe","coffee","commercial","tea"],icon:"cafe"},{name:"Shop",tags:["shop","mall","commercial","store"],icon:"shop"},{name:"Fast Food",tags:["food","fast","commercial","burger","drive-through"],icon:"fast-food"},{name:"Bar",tags:["bar","drink","commercial","club","martini","lounge"],icon:"bar"},{name:"Bank",tags:["bank","atm","commercial","money"],icon:"bank"},{name:"Grocery",tags:["food","grocery","commercial","store","market"],icon:"grocery"},{name:"Cinema",tags:["cinema","theatre","film","movie","commercial","theater","entertainment"],icon:"cinema"},{name:"Pharmacy",tags:["pharmacy","drugs","medication","social","medicine","prescription"],icon:"pharmacy"},{name:"Hospital",tags:["hospital","health","medication","social","medicine","medical","clinic"],icon:"hospital"},{name:"Danger",tags:["minefield","landmine","disaster","dangerous","hazard"],icon:"danger"},{name:"Industrial",tags:["industrial","factory","property","building"],icon:"industrial"},{name:"Warehouse",tags:["warehouse","property","storage","building"],icon:"warehouse"},{name:"Commercial",tags:["commercial","property","business","building"],icon:"commercial"},{name:"Building",tags:["building","property","structure","business","building"],icon:"building"},{name:"Place of worship",tags:["religion","ceremony","religious","nondenominational","church","temple"],icon:"place-of-worship"},{name:"Alcohol shop",tags:["alcohol","liquor","store","shop","beer","wine","vodka"],icon:"alcohol-shop"},{name:"Logging",tags:["logger","chainsaw","woods","industry"],icon:"logging"},{name:"Oil well",tags:["oil","natural","environment","industry","resources"],icon:"oil-well"},{name:"Slaughterhouse",tags:["cows","cattle","food","meat","industry","resources"],icon:"slaughterhouse"},{name:"Dam",tags:["water","natural","hydro","hydroelectric","energy","environment","industry","resources"],icon:"dam"},{name:"Water",tags:["water","natural","hydro","lake","river","ocean","resources"],icon:"water"},{name:"Wetland",tags:["water","swamp","natural"],icon:"wetland"},{name:"Disability",tags:["handicap","wheelchair","access"],icon:"disability"},{name:"Telephone",tags:["payphone","call"],icon:"telephone"},{name:"Emergency Telephone",tags:["payphone","danger","safety","call"],icon:"emergency-telephone"},{name:"Toilets",tags:["bathroom","men","women","sink","washroom","lavatory"],icon:"toilets"},{name:"Waste Basket",tags:["trash","rubbish","bin","garbage"],icon:"waste-basket"},{name:"Music",tags:["stage","performance","band","concert","venue"],icon:"music"},{name:"Land Use",tags:["zoning","usage","area"],icon:"land-use"},{name:"City",tags:["area","point","place","urban"],icon:"city"},{name:"Town",tags:["area","point","place","small"],icon:"town"},{name:"Village",tags:["area","point","place","small","rural"],icon:"village"},{name:"Farm",tags:["building","farming","crops","plants","agriculture","rural"],icon:"farm"},{name:"Bakery",tags:["bakery","pastry","croissant","food","shop","bread"],icon:"bakery"},{name:"Dog Park",tags:["dog","pet"],icon:"dog-park"},{name:"Lighthouse",tags:["building","navigation","nautical","ocean","logistics"],icon:"lighthouse"},{name:"Clothing Store",tags:["clothing","store","shop"],icon:"clothing-store"},{name:"Polling Place",icon:"polling-place"},{name:"Playground",icon:"playground"},{name:"Entrance",icon:"entrance"},{name:"Heart",icon:"heart"},{name:"London Underground",icon:"london-underground"},{name:"Minefield",icon:"minefield"},{name:"Rail Underground",icon:"rail-underground"},{name:"Rail Above",icon:"rail-above"},{name:"Camera",icon:"camera"},{name:"Laundry",icon:"laundry"},{name:"Car",icon:"car"},{name:"Suitcase",icon:"suitcase"},{name:"Hairdresser",icon:"hairdresser"},{name:"Chemist",icon:"chemist"},{name:"Mobile phone",icon:"mobilephone"},{name:"Scooter",icon:"scooter"}]}},{}],133:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../../../../../img-loader-view"),g=a("../../../../../../custom-list/custom-list-item-view");b.exports=g.extend({render:function(){this.clearSubViews(),this.$el.empty();var a=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(d.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:a,val:this.model.getValue(),options:this.model.get("renderOptions"),image:this.model.get("image"),imageEnabled:this.options.imageEnabled}))),this._loadImages(),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_loadImages:function(){this.iconView=new f({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:this.model.get("image"),color:this.model.get("val")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClick:function(a){this.killEvent(a);var b=e(a.target),c=b.closest(".js-image-container").length>0,d=b.closest(".js-assetPicker").length>0;this.model.set({selectedClass:d||c?["js-assetPicker"]:[],selected:!0})}})},{"../../../../../../custom-list/custom-list-item-view":50,"../../../../../../img-loader-view":213,jquery:"jquery",underscore:"underscore"}],134:[function(a,b,c){var d=a("../../../../../../custom-list/custom-list-view");b.exports=d.extend({_renderItem:function(a){var b=this.options.ItemView,c=new b({model:a,typeLabel:this.options.typeLabel,template:this.options.itemTemplate,imageEnabled:this.options.imageEnabled});this.$(".js-list").append(c.render().el),this.addView(c),c.bind("customEvent",function(a,b){this.trigger("customEvent",a,b,this)},this)}})},{"../../../../../../custom-list/custom-list-view":57}],135:[function(a,b,c){var d=a("../../../../../../custom-list/custom-view.js"),e=a("../../../../../../custom-list/custom-list-item.tpl"),f=a("./categories-list-item-view"),g=a("./categories-list-view");b.exports=d.extend({options:{showSearch:!0,allowFreeTextInput:!1,typeLabel:"column",itemTemplate:e,itemView:f},_renderList:function(){this._listView=new g({model:this.model,allowFreeTextInput:this.options.allowFreeTextInput,collection:this.collection,typeLabel:this.options.typeLabel,ItemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:this.options.size,imageEnabled:this.options.imageEnabled}),this.$el.append(this._listView.render().el),this._listView.highlight(),this.addView(this._listView),this._listView.bind("customEvent",function(a,b){this.trigger(a,b,this)},this)}})},{"../../../../../../custom-list/custom-list-item.tpl":52,"../../../../../../custom-list/custom-view.js":59,"./categories-list-item-view":133,"./categories-list-view":134}],136:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-ListDecoration-itemLink u-flex u-justifySpace u-alignCenter ',isSelected&&(__p+=" is-selected "),__p+='">\n  <span class="RampItem-text CDB-Text u-ellipsis u-actionTextColor" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</span>\n\n  <div class=\'RampItem-secondaryContainer\'>\n    <div class="ColorBar RampItem-bar js-colorPicker" style="background-color: '+(null==(__t=val)?"":_.escape(__t))+';"></div>\n\n    ',imageEnabled&&(__p+="\n      <div class='RampItem-img'>\n        ",__p+=image?"\n          <div class='js-image-container u-flex'></div>\n        ":'\n          <button class="CDB-Text u-actionTextColor js-assetPicker">'+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":__t)+"</button>\n        ",__p+="\n      </div>\n    "),__p+="\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],137:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../../../../../helpers/utils"),g=a("backbone/core-view"),h=a("./categories-list/categories-view"),i=a("../../../../../custom-list/custom-list-collection"),j=a("./input-color-categories-list-view.tpl"),k=a("./input-color-categories-list-item.tpl");b.exports=g.extend({events:{"click .js-color":"_onClickColor"},initialize:function(a){this._showSearch=a.showSearch||!1,this._typeLabel=a.typeLabel,this._maxValues=a.maxValues,this._setupCollection(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(j({range:this.model.get("range"),attribute:this.model.get("attribute")})),this._listView=new h({itemTemplate:k,collection:this._collection,showSearch:this._showSearch,typeLabel:this._typeLabel,imageEnabled:this.options.imageEnabled}),this.addView(this._listView),this.$(".js-content").append(this._listView.render().$el),this},_setupCollection:function(){this._collection=new i(null,{silent:!1});var a=this.model.get("range"),b=this.model.get("domain"),c=this.model.get("images");if(a&&a.length&&b&&b.length){var e=d.map(a,function(a,e){var g=null==b[e]||d.isString(b[e])&&f.isBlank(b[e]),h=b[e];e>=this._maxValues?h=_t("form-components.editors.fill.input-categories.others"):g&&(h=_t("form-components.editors.fill.input-categories.null"));var i={label:h,val:a};return c&&c.length&&(i.image=c[e]),i},this);this._collection.reset(e)}},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_initBinds:function(){this.listenTo(this.model,"change:range",this.render),this.listenTo(this.model,"change:domain",this.render),this.listenTo(this._collection,"change:selected",this._onSelectItem)},_onClickColor:function(a){this.killEvent(a);var b=e(a.target).index(),c=this._collection.at(b);c&&this._onSelectItem(c)},_onSelectItem:function(a){var b={index:this._collection.indexOf(a),target:d.contains(a.get("selectedClass"),"js-assetPicker")?"asset":"color"};this.trigger("selectItem",b,this)}})},{"../../../../../../helpers/utils":1102,"../../../../../custom-list/custom-list-collection":47,"./categories-list/categories-view":135,"./input-color-categories-list-item.tpl":136,"./input-color-categories-list-view.tpl":138,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],138:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor u-flex u-alignCenter">\n      <ul class="ColorBarContainer">\n        ',_.each(range,function(a){__p+='\n          <li class="ColorBar ColorBar--spaceless ColorBar--clickable js-color" style="background-color: '+(null==(__t=a)?"":_.escape(__t))+';"></li>\n        '}),__p+='\n      </ul>\n    </li>\n  </ul>\n</div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],139:[function(a,b,c){function d(a){return a&&a!==!0?'"'+a.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':a}var e=a("underscore"),f=a("cartodb.js"),g=a("backbone"),h=a("backbone/core-view"),i=a("./input-color-categories.tpl"),j=a("../../../../../../components/stack-layout/stack-layout-view"),k=a("../input-color-picker/input-color-picker-view"),l=a("./input-color-categories-list-view"),m=a("cartocolor"),n=a("../assets-picker/input-asset-picker-view"),o=10,p=e.clone(m.Prism[o+1]),q=e.template("SELECT <%= column %>, count(<%= column %>) FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY count DESC, <%= column %> ASC LIMIT <%= max_values %>"),r=a("../../../../../../helpers/required-opts"),s=["columns","configModel","modals","query","userModel"];b.exports=h.extend({events:{"click .js-back":"_onClickBack","click .js-quantification":"_onClickQuantification"},initialize:function(a){r(a,s,this),this._imageEnabled=a.imageEnabled,this.listenTo(this.model,"change:attribute",this._fetchColumns),this._viewModel=new g.Model({step:0,status:"idle"}),this.listenTo(this._viewModel,"change:status",this.render),this.model.hasChanged("quantification")&&"category"===this.model.get("quantification")&&this._fetchColumns()},render:function(){this.clearSubViews(),this.$el.empty();var a=this._getColumn(),b=a&&a.type;return this.$el.append(i({status:this._viewModel.get("status"),columnType:b,attribute:this.model.get("attribute"),quantification:this.model.get("quantification")||"category"})),this._generateStackLayoutView(),this},_generateStackLayoutView:function(){var a=this._viewModel.get("step"),b=new g.Collection([{selected:0===a,createStackView:function(a,b){return this._createRangeListView(a,b).bind(this)}.bind(this)},{selected:1===a,createStackView:function(a,b){return this._createColorPickerView(a,b).bind(this)}.bind(this)}]);this._iconStylingEnabled()&&b.add({selected:2===a,createStackView:function(a,b){return this._createImagePickerView(a,b).bind(this)}.bind(this)}),this._stackLayoutView=new j({collection:b}),this._stackLayoutView.bind("positionChanged",this._onStackLayoutPositionChange,this),this.addView(this._stackLayoutView),this.$(".js-content").append(this._stackLayoutView.render().$el)},_onStackLayoutPositionChange:function(){this.$(".js-prevStep").toggle(0===this._stackLayoutView.getCurrentPosition())},_iconStylingEnabled:function(){return this._imageEnabled},_getColumn:function(){return e.find(this._columns,function(a){return a.label===this.model.get("attribute")},this)},_fetchColumns:function(){if(this.model.get("attribute"))if(this._query){this._setViewStatus("loading");var a=new f.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")});a.execute(q({sql:this._query,column:this.model.get("attribute"),max_values:o+1}),null,{success:this._onQueryDone.bind(this),error:function(){this._setViewStatus("error")}.bind(this)})}else this._onQueryDone()},_onQueryDone:function(a){a=a||{},this._updateRangeAndDomain(a.rows),this._setViewStatus("idle")},_updateRangeAndDomain:function(a){a=a||[];var b=e.pluck(a,this.model.get("attribute")),c=e.map(b,function(a,b){return a}).slice(0,o);"number"!==this.model.get("attribute_type")&&(c=c.filter(function(a,b,c){return c.indexOf(a)===b}).map(d));var f=e.map(b,function(a,b){return b<o?p[b]:p[o+1]});if(this._iconStylingEnabled()){var g=e.map(b,function(){return""});this.model.attributes.images=g}this.model.set({range:f,domain:c})},_setViewStatus:function(a){var b={status:a};"loading"===a&&(b.step=0),this._viewModel.set(b)},_getRange:function(){return e.map(this.model.get("range"),function(a,b){var c={val:a,color:a,title:this.model.get("domain")[b]
};return this._iconStylingEnabled()&&(c.image=this.model.get("images")[b]),c},this)},_updateRange:function(a){var b=e.clone(this.model.get("range"));b[this._index]=a[this._index].color,this.model.set("range",b)},_createColorPickerView:function(a,b){var c=this._getRange(),d="undefined"!=typeof this.model.get("opacity")?this.model.get("opacity"):1,e=new k({index:this._index,ramp:c,opacity:d,imageEnabled:this._iconStylingEnabled()});return e.bind("back",function(b){a.prevStep()},this),e.bind("goToAssetPicker",function(){a.nextStep()},this),e.bind("change",this._updateRange,this),e.bind("changeIndex",function(a){this._index=a},this),e.bind("change:opacity",function(a){this.model.set("opacity",a)},this),e},_createRangeListView:function(a,b){var c=new l({maxValues:o,model:this.model,imageEnabled:this._iconStylingEnabled()});return c.bind("back",function(b){a.prevStep()},this),c.bind("selectItem",function(b){this._index=b.index,"asset"===b.target?a.goToStep(2):a.goToStep(1)},this),c},_createImagePickerView:function(a,b){var c=this._getRange(),d=new n({userModel:this._userModel,configModel:this._configModel,index:this._index,ramp:c,modals:this._modals,imageEnabled:this._iconStylingEnabled()});return d.bind("back",function(b){a.goToStep(0)},this),d.bind("goToColorPicker",function(){a.prevStep()},this),this._iconStylingEnabled()&&d.bind("change:image",this._onImageChanged,this),d},_onImageChanged:function(a){var b=e.clone(this.model.get("images"));b[this._index]=a.url,this.model.set("images",b)},_onClickQuantification:function(a){this.killEvent(a),this.trigger("selectQuantification",this)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)}},{MAX_VALUES:o})},{"../../../../../../components/stack-layout/stack-layout-view":533,"../../../../../../helpers/required-opts":1097,"../assets-picker/input-asset-picker-view":119,"../input-color-picker/input-color-picker-view":148,"./input-color-categories-list-view":137,"./input-color-categories.tpl":140,backbone:"backbone","backbone/core-view":1127,cartocolor:"cartocolor","cartodb.js":"cartodb.js",underscore:"underscore"}],140:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader js-prevStep">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <ul class="u-flex u-justifySpace">\n        <li class="u-flex">\n          <button class="u-rSpace u-actionTextColor js-back">\n            <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n          </button>\n          <span class="label js-label">'+(null==(__t=attribute)?"":_.escape(__t))+"</span>\n        </li>\n        ","number"===columnType&&(__p+='\n          <li class="u-flex">\n            '+(null==(__t=_t("form-components.editors.fill.quantification.methods."+quantification))?"":_.escape(__t))+'\n            <button class="CDB-Shape u-lSpace js-quantification">\n              <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n                <div class="CDB-Shape-threePointsItem"></div>\n                <div class="CDB-Shape-threePointsItem"></div>\n                <div class="CDB-Shape-threePointsItem"></div>\n              </div>\n            </button>\n          </li>\n        '),__p+="\n      </ul>\n    </li>\n  </ul>\n</div>\n\n",__p+="loading"===status?'\n  <div class="InputColorCategory-loader js-loader">\n    <div class="CDB-LoaderIcon is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n  </div>\n':"error"===status?'\n  <div class="u-flex u-alignCenter u-justifyCenter CDB-Text CDB-Size-medium u-bSpace--m u-tSpace--m u-errorTextColor">'+(null==(__t=_t("form-components.editors.fill.error"))?"":_.escape(__t))+"</div>\n":'\n  <div class="InputColorCategory-content js-content"></div>\n',__p+="";return __p}},{underscore:"underscore"}],141:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("../fill-tab-pane.tpl"),g=a("../../../../../components/tab-pane/create-text-labels-tab-pane"),h=a("./input-color-fixed-content-view"),i=a("./input-color-value-content-view");b.exports=e.extend({initialize:function(a){if(this.options.editorAttrs){var b=this.options.editorAttrs;if(b.hidePanes&&(this._hidePanes=b.hidePanes,!d.contains(this._hidePanes,"value"))){if(!a.configModel)throw new Error("configModel param is required");if(!a.userModel)throw new Error("userModel param is required");if(!a.modals)throw new Error("modals param is required");if(!a.query)throw new Error("query param is required")}b.categorizeColumns&&(this._categorizeColumns=!0),b.imageEnabled&&(this._imageEnabled=!0)}if(!a.columns)throw new Error("columns is required");this._columns=a.columns,this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals,this._query=a.query,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.model.on("change:fixed",function(){this.model.get("fixed")&&!this.model.get("range")||this.model.unset("image",{silent:!0})},this)},_initViews:function(){var a=this,b={name:"fixed",label:_t("form-components.editors.fill.input-color.solid"),createContentView:function(){return a._generateFixedContentView()}},c={name:"value",label:_t("form-components.editors.fill.input-color.value"),createContentView:function(){return a._generateValueContentView()}};this._tabPaneTabs=[],this._hidePanes?(d.contains(this._hidePanes,"fixed")||this._tabPaneTabs.push(b),d.contains(this._hidePanes,"value")||this._tabPaneTabs.push(c)):this._tabPaneTabs=[b,c];var e={tabPaneOptions:{template:f,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("range")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this._tabPaneView=g(this._tabPaneTabs,e),this._tabPaneView.collection.bind("change:selected",this._onChangeTabPaneViewTab,this),this.$el.append(this._tabPaneView.render().$el),this.addView(this._tabPaneView)},_onChangeTabPaneViewTab:function(){var a=this._tabPaneView.getSelectedTabPaneName(),b=["domain","bins","attribute","quantification"];"fixed"===a&&(d.each(b,function(a){this.model.unset(a,{silent:!0})},this),this.model.get("fixed")||(this.model.get("range")?(this.model.set("fixed",this.model.get("range")[0]),this.model.unset("range")):this.model.set("fixed","#0303FF"))),this.trigger("change",a,this)},_generateFixedContentView:function(){return new h({model:this.model,configModel:this._configModel,userModel:this._userModel,modals:this._modals,editorAttrs:this.options.editorAttrs})},_generateValueContentView:function(){return new i({model:this.model,columns:this._columns,configModel:this._configModel,categorizeColumns:this._categorizeColumns,imageEnabled:this._imageEnabled,userModel:this._userModel,modals:this._modals,hideTabs:this.options.hideTabs,query:this._query})}})},{"../../../../../components/tab-pane/create-text-labels-tab-pane":537,"../fill-tab-pane.tpl":106,"./input-color-fixed-content-view":145,"./input-color-value-content-view":150,"backbone/core-view":1127,underscore:"underscore"}],142:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-selector"></div>\n';return __p}},{underscore:"underscore"}],143:[function(a,b,c){var d=a("backbone/core-view"),e=a("./input-color-file-view.tpl"),f=a("./assets-picker/assets-view"),g=a("../../../../../components/carousel-form-view"),h=a("../../../../../components/custom-carousel/custom-carousel-collection"),i=a("../../../../../data/static-assets-collection"),j=a("../../../../../data/static-asset-model"),k=a("./assets-picker/static-asset-item-view.tpl"),l=a("./input-color-file-carousel.tpl"),m=a("./assets/maki-icons");b.exports=d.extend({events:{"click .js-show-collection":"_onClickShowCollection"},initialize:function(a){if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.modals)throw new Error("modals is required");this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals,this._initCarouselCollection(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(e()),this._renderAssets(),this},_initBinds:function(){this.listenTo(this._carouselCollection,"change:selected",this._onSelectAsset),this.listenTo(this._carouselCollection,"reset",this.render)},_resetCarouselCollection:function(a){this._icons.reset(m.icons);var b=this._carouselCollection.find(function(b){return b.get("url")===a});b&&b.set("selected",!0),this._icons.unshift(this._resetAsset),this._carouselCollection.reset(this._getIcons())},_initCarouselCollection:function(){this._icons=new i(m.icons),this.add_related_model(this._icons),this._resetAsset=new j({type:"none",selected:!this._getIconSelected(),name:_t("form-components.editors.fill.image.none"),action:function(a){this._resetImage(a)}.bind(this)}),this._icons.unshift(this._resetAsset),this._carouselCollection=new h(this._getIcons()),this.add_related_model(this._carouselCollection)},_getIcons:function(){var a=function(a){this._changeIcon(a)}.bind(this);return this._icons.map(function(b){var c=b.get("type")?b.get("type"):"icon",d=b.get("action")?b.get("action"):a,e=this._getIconSelected();return{selected:b.get("selected")||b.getURLFor(b.get("icon"))===e,icon:b,type:c,name:b.get("name"),url:b.get("public_url"),action:d,template:function(){return k({type:c,public_url:b.get("public_url")+"?req=markup",name:b.get("name")})}}},this)},_getIconSelected:function(){if(this.model.get("ramp")){var a=this.model.get("index")||0,b=this.model.get("ramp")[a].image;return b||""}return this.model.get("image")||""},_renderAssets:function(){this.clearSubViews(),this.$el.html(e());var a=new g({collection:this._carouselCollection,template:l,listItemOptions:{className:"Carousel-item AssetListItem"},itemOptions:{className:"AssetItem-button"}});this.addView(a),this.$(".js-assets").append(a.render().el)},_onSelectAsset:function(a){a.get("action")(a)},_changeIcon:function(a){var b=a.get("icon");this.trigger("change",{url:b.get("public_url"),kind:b.get("kind")},this)},_resetImage:function(){this.trigger("change",null,this)},_onClickShowCollection:function(a){this.killEvent(a);var b=this;this._modals.create(function(a){var c=new f({model:b.model,modalModel:a,configModel:b._configModel,userModel:b._userModel});return c.bind("change",function(a){this._resetCarouselCollection(a.url),this.trigger("change",a,this)},b),c})}})},{"../../../../../components/carousel-form-view":23,"../../../../../components/custom-carousel/custom-carousel-collection":40,"../../../../../data/static-asset-model":661,"../../../../../data/static-assets-collection":662,"./assets-picker/assets-view":115,"./assets-picker/static-asset-item-view.tpl":124,"./assets/maki-icons":132,"./input-color-file-carousel.tpl":142,"./input-color-file-view.tpl":144,"backbone/core-view":1127}],144:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-boxModalContent js-assets">\n  <h2 class="CDB-Text CDB-Size-small u-bSpace--m u-upperCase">\n    '+(null==(__t=_t("form-components.editors.fill.image.recently-title"))?"":_.escape(__t))+'\n  </h2>\n</div>\n<div class="CustomRamp-list">\n  <div class="CustomList-item CustomList-item--add">\n    <button class="CDB-ListDecoration-itemLink CDB-Text CDB-Size-medium u-actionTextColor js-show-collection" type="button">\n      '+(null==(__t=_t("form-components.editors.fill.image.show-all"))?"":_.escape(__t))+"\n    </button>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],145:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("../fill-tab-pane.tpl"),g=a("../../../../../components/tab-pane/create-mixed-labels-tab-pane"),h=a("../color-picker/color-picker"),i=a("./input-color-file-view");b.exports=e.extend({initialize:function(a){if(this.options.editorAttrs){var b=this.options.editorAttrs;if(this._imageEnabled=b.imageEnabled,b.hidePanes&&(this._hidePanes=b.hidePanes,this._imageEnabled&&!d.contains(this._hidePanes,"file"))){if(!a.configModel)throw new Error("configModel param is required");if(!a.userModel)throw new Error("userModel param is required");if(!a.modals)throw new Error("modals param is required")}b.disableOpacity&&(this._disableOpacity=!0)}this._userModel=a.userModel,this._configModel=a.configModel,this._modals=a.modals,this._query=a.query},render:function(){return this.clearSubViews(),this._imageEnabled&&this._setupTabPanes(),this._tabPaneView?this.$el.append(this._tabPaneView.render().$el):this.$el.append(this._generateFixedContentView().render().$el),this},_setupTabPanes:function(){var a=this,b={name:"fixed",type:"color",label:this.model.get("fixed"),createContentView:function(){return a._generateFixedContentView()}},c={name:"file",type:this.model.get("image")?"image":"text",label:this.model.get("image")||_t("form-components.editors.fill.input-color.img"),kind:this.model.get("kind")||"marker",color:this.model.get("fixed"),createContentView:function(){return a._generateFileContentView()}};this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes?(this._hidePanes=this.options.editorAttrs.hidePanes,d.contains(this._hidePanes,"fixed")||this._tabPaneTabs.push(b),d.contains(this._hidePanes,"file")||this._tabPaneTabs.push(c)):this._tabPaneTabs=[b,c];var e={tabPaneOptions:{template:f,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("image")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this.listenTo(this.model,"change:image",this._updateImageTabPane),this.listenTo(this.model,"change:fixed",this._updateTextTabPane),this._tabPaneView=g(this._tabPaneTabs,e),this.addView(this._tabPaneView)},_updateTextTabPane:function(){this._updateImageTabPane(),this._tabPaneView.collection.at(0).set("label",this.model.get("fixed"))},_updateImageTabPane:function(){this.model.get("image")?this._tabPaneView.collection.at(1).set({label:this.model.get("image"),color:this.model.get("fixed")}):this._tabPaneView.collection.at(1).set("label",_t("form-components.editors.fill.input-color.img"))},_generateFixedContentView:function(){var a=new h({value:this.model.get("fixed"),opacity:this.model.get("opacity"),disableOpacity:this._disableOpacity});return a.bind("change",this._onChangeValue,this),a},_generateFileContentView:function(){var a=new i({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals});return a.bind("change",this._onChangeFile,this),a},_onChangeFile:function(a){a&&a.url?this.model.set({image:a.url,kind:a.kind}):this.model.unset("image")},_onChangeValue:function(a){this.model.set({fixed:a.hex,opacity:a.opacity})}})},{"../../../../../components/tab-pane/create-mixed-labels-tab-pane":535,"../color-picker/color-picker":99,"../fill-tab-pane.tpl":106,"./input-color-file-view":143,"backbone/core-view":1127,underscore:"underscore"}],146:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("../../../../../img-loader-view"),h=a("./input-color-picker-header.tpl"),i=1;b.exports=f.extend({events:{"click .js-color":"_onClickColor","click .js-assetPicker":"_onClickAssetPicker","keyup .js-a":"_onChangeOpacity"},initialize:function(a){this.listenTo(this.model,"change",this.render)},render:function(a,b){if(a&&a.changed&&"undefined"!=typeof a.changed.opacity)return this._reRenderOpacity(),this;this.clearSubViews(),this.$el.empty();var c=this._getRampItem();return this.$el.append(h({ramp:this.model.get("ramp"),index:this.model.get("index"),opacity:this.model.get("opacity"),label:c.title||_t("form-components.editors.fill.input-categories.others"),color:c.color||"",iconStylingEnabled:this.options.iconStylingEnabled,isCategorized:e.has(c,"image"),image:c.image||"",imageEnabled:this.options.imageEnabled})),this._slider=this.$(".js-slider").slider({range:"min",value:this._inverseSliderValue(this.model.get("opacity")),min:0,max:i,step:.02,orientation:"horizontal",disabled:!1,slide:this._onSlideChange.bind(this)}),this._loadImages(),this},_getRampItem:function(){var a=this.model.get("ramp");return a?a[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-categories.others"),image:""}},_loadImages:function(){var a=this._getRampItem();this.iconView=new g({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:a.image,color:a.color}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClickColor:function(a){this.killEvent(a),this.model.set("index",d(a.target).index())},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onClickAssetPicker:function(a){this.killEvent(a),this.trigger("goToAssetPicker",this)},_onSlideChange:function(a,b){this.model.set("opacity",this._inverseSliderValue(b.value))},_inverseSliderValue:function(a){return parseFloat(Number(i-a).toFixed(2))},_onChangeOpacity:function(){var a=this.$(".js-a"),b=a.val(),c=this._isValidOpacity(b);a.toggleClass("has-error",!c),c&&this.model.set("opacity",parseFloat(b))},_isValidOpacity:function(a){var b=/^((0(\.\d+)?)|(1(\.0)?))$/;return b.test(a)},_reRenderOpacity:function(){var a,b,c=this.$(".js-a"),d=this.$(".js-slider"),e=this.model.get("opacity");c.length>0&&(a=c.val(),(!this._isValidOpacity(a)||this._isValidOpacity(a)&&parseFloat(a)!==e)&&c.val(e)),"undefined"!=typeof d.slider("instance")&&(b=d.slider("value"),"undefined"!=typeof b&&b!==this._inverseSliderValue(e)&&d.slider("value",this._inverseSliderValue(e)))}})},{"../../../../../img-loader-view":213,"./input-color-picker-header.tpl":147,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],147:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemDisplay--flex CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <div class=\'CDB-ListDecoration-secondaryContainer\'>\n        <button class="u-rSpace u-actionTextColor js-back" type="button">\n          <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n        </button>\n        <span class="label js-label">'+(null==(__t=label)?"":_.escape(__t))+"</span>\n      </div>\n\n      ",isCategorized&&imageEnabled&&(__p+="\n        <div class='CDB-ListDecoration-secondaryContainer'>\n          <nav class='CDB-NavMenu'>\n            <ul class='CDB-NavMenu-Inner CDB-NavMenu-inner--no-margin js-menu'>\n              <li class='CDB-NavMenu-item is-selected'>\n                <div class='CDB-NavMenu-link CDB-ListDecoration-rampNav-item'>\n                  <button class='ColorBar CDB-ListDecoration-rampItemBar u-rSpace--xl js-colorPicker' type=\"button\" style=\"background-color: "+(null==(__t=color)?"":__t)+";\"></button>\n                </div>\n              </li>\n              <li class='CDB-NavMenu-item'>\n                <div class='CDB-NavMenu-link CDB-ListDecoration-rampNav-item'>\n                  ",__p+=image?'\n                    <button class="CDB-ListDecoration-rampImg js-image-container" type="button"></button>\n                  ':'\n                    <button class="CDB-ListDecoration-rampImg CDB-Text u-actionTextColor js-assetPicker" type="button">'+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":__t)+"</button>\n                  ",__p+="\n                </div>\n              </li>\n            </ul>\n          </nav>\n        </div>\n      "),__p+='\n    </li>\n  </ul>\n</div>\n\n<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <ul class="ColorBarContainer ColorBarContainer--rampEditing">\n        ',_.each(ramp,function(a,b){__p+='\n        <li class="ColorBar is-link ColorBar--spaceless ColorBar--clickable js-color'+(null==(__t=b===index?" is-selected":"")?"":_.escape(__t))+'" data-label="'+(null==(__t=a.title)?"":_.escape(__t))+'" data-color="'+(null==(__t=a.color)?"":_.escape(__t))+'" style="background-color: '+(null==(__t=a.color)?"":_.escape(__t))+';"></li>\n        '}),__p+='\n      </ul>\n      <div class="OpacityEditor">\n        <div class="OpacityEditor-slider js-slider"></div>\n        <div class="OpacityEditor-inputWrapper">\n          <input type="text" class="CDB-InputText ColorPicker-input js-a" value="'+(null==(__t=opacity)?"":_.escape(__t))+'">\n        </div>\n      </div>\n    </li>\n  </ul>\n</div>\n';return __p}},{underscore:"underscore"}],148:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../color-picker/color-picker"),h=a("./input-color-picker-view.tpl"),i=a("./input-color-picker-header"),j=a("../../../../../../helpers/required-opts"),k=["ramp","opacity"];b.exports=f.extend({events:{"click .js-back":"_onClickBack"},initialize:function(a){j(a,k,this),this.model=new e.Model({index:this.options.index,ramp:a.ramp,opacity:a.opacity}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(h()),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:index",this._onChangeIndex),this.listenTo(this.model,"change:opacity",this._onOpacityChanged)},_initViews:function(){this._headerView=new i({model:this.model,imageEnabled:this.options.imageEnabled}),this.addView(this._headerView),this._headerView.bind("goToAssetPicker",this._onGoToAssetPicker,this),this.$(".js-header").append(this._headerView.render().$el),this._colorPicker=new g({value:this._getColor(),opacity:1,disableOpacity:!0}),this.addView(this._colorPicker),this._colorPicker.bind("change",this._onChangeValue,this),this.$(".js-content").append(this._colorPicker.render().$el)},_setColor:function(a){var b=d.clone(this.model.get("ramp"));b[this.model.get("index")].color=a,this.model.set("ramp",b),this.model.trigger("change",b),this.trigger("change",b)},_getColor:function(){var a=this.model.get("ramp");return a[this.model.get("index")||0].color},_onChangeIndex:function(){this._colorPicker.setColor(this._getColor()),this.trigger("changeIndex",this.model.get("index"),this)},_onChangeValue:function(a){this._setColor(a.hex)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onOpacityChanged:function(){var a=this.model.get("opacity");this.trigger("change:opacity",a)},_onGoToAssetPicker:function(){this.trigger("goToAssetPicker")}})},{"../../../../../../helpers/required-opts":1097,"../../color-picker/color-picker":99,"./input-color-picker-header":146,"./input-color-picker-view.tpl":149,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],149:[function(a,b,c){arguments[4][120][0].apply(c,arguments)},{dup:120,underscore:"underscore"}],150:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../../../components/stack-layout/stack-layout-view"),h=a("../column-list-view"),i=a("./quantification-method-item.tpl"),j=a("./input-ramps/input-color-ramps"),k=a("./input-categories/input-color-categories"),l=a("../default-fill-settings.json"),m=a("../../../../../helpers/required-opts"),n=["the_geom","the_geom_webmercator"],o=["columns","configModel","modals","query","userModel"];b.exports=f.extend({initialize:function(a){m(a,o,this),this._settings=l.color,this._categorizeColumns=a.categorizeColumns,this._imageEnabled=a.imageEnabled,this._column=this._getColumn(),this._columnType=this._column&&this._column.type,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:quantification",function(){"category"===this.model.previous("quantification")&&delete this.model.attributes.range,"category"!==this.model.get("quantification")&&this.model.unset("domain")})},_initViews:function(){var a=this,b=new e.Collection([{createStackView:function(b,c){return a._createColumnListView(b,c).bind(a)}},{createStackView:function(b,c){return a._createInputColorRamps(b,c).bind(a)}},{createStackView:function(b,c){return a._createInputColorCategories(b,c).bind(a)}},{createStackView:function(b,c){return a._createQuantificationListView(b,c).bind(a)}}]);if(this._stackLayoutView=new g({collection:b}),this.model.get("attribute")){var c=this.model.get("domain")&&this.model.get("domain").length,d=this.model.get("range")&&this.model.get("range").length,f="string"===this._columnType||c&&d;f?this._stackLayoutView.model.set("position",2):this._stackLayoutView.model.set("position",1)}this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createInputColorCategories:function(a,b){var c=new k({model:this.model,query:this._query,columns:this._columns,configModel:this._configModel,userModel:this._userModel,modals:this._modals,imageEnabled:this._imageEnabled});return c.bind("selectQuantification",function(b){a.goToStep(3)},this),c.bind("back",function(b){a.goToStep(0)},this),c},_createQuantificationListView:function(a,b){var c=new h({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:a,itemTemplate:i,columns:this._settings.quantifications.items,showSearch:!1});return c.bind("selectItem",function(b){this.model.set("quantification",b.get("val")),a.goToStep(1)},this),c.bind("back",function(b){a.goToStep(0)},this),c},_createInputColorRamps:function(a,b){var c=new j({hideTabs:this.options.hideTabs,model:this.model});return c.bind("switch",function(){a.goToStep(2)},this),c.bind("back",function(b){a.prevStep()},this),c},_getColumn:function(a){return d.find(this._columns,function(b){return b.label===(a||this.model.get("attribute"))},this)},_createColumnListView:function(a,b){var c=d.reject(this._columns,function(a){return"geometry"===a.type||d.contains(n,a.label)},this),e=new h({stackLayoutModel:a,columns:c,showSearch:!0,typeLabel:"column"});return e.bind("selectItem",function(b){this._onChangeAttribute(b.get("val"),a)},this),e},_onChangeAttribute:function(a,b){var c=["string","boolean"],e=["image","fixed","quantification","opacity"],f="category"===this.model.get("quantification");this._column=this._getColumn(a),this._columnType=this._column&&this._column.type,d.each(e,function(a){this.model.unset(a,{silent:!0})},this),d.contains(c,this._columnType)||this._categorizeColumns?(this.model.unset("bins",{silent:!0}),b.goToStep(2)):"number"===this._columnType&&(this.model.unset("images",{silent:!0}),this.model.unset("domain",{silent:!0}),f&&this.model.unset("range",{silent:!0}),b.goToStep(1)),this.model.set({attribute:a,attribute_type:this._columnType})}})},{"../../../../../components/stack-layout/stack-layout-view":533,"../../../../../helpers/required-opts":1097,"../column-list-view":101,"../default-fill-settings.json":103,"./input-categories/input-color-categories":139,"./input-ramps/input-color-ramps":154,"./quantification-method-item.tpl":161,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],151:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./input-color.tpl"),g=a("./input-color-dialog-content"),h=a("../../../../../helpers/utils"),i=a("./input-ramps/ramps"),j=a("../../../../img-loader-view");b.exports=e.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function(a){if(this.options.editorAttrs){this._editorAttrs=this.options.editorAttrs,this._imageEnabled=this._editorAttrs.imageEnabled;var b=this._editorAttrs.hidePanes;if(b&&!d.contains(b,"value")){if(!a.configModel)throw new Error("configModel param is required");if(!a.userModel)throw new Error("userModel param is required");if(!a.modals)throw new Error("modals param is required");if(!a.query)throw new Error("query param is required")}}if(!a.columns)throw new Error("columns is required");this._columns=a.columns,this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals,this._query=a.query,this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty(),this.options.disabled&&this.$el.addClass("is-disabled");var a=this._getColumn(),b=a&&a.type,c=this.model.get("domain")&&this.model.get("domain").length;this.model.get("range")&&d.isString(this.model.get("range"))&&this._migrateRange();var e=this.model.get("range")&&this.model.get("range").length,g="string"===b||c&&e,h=this._getImageURL(),i=this._iconStylingEnabled()&&!this._getImageURL()&&this._categoryImagesPresent();return this.$el.html(f({categoryImagesPresent:i,imageURL:h,kind:this._getKind(),showCategories:g,value:this._getValue(),opacity:this._getOpacity()})),this._loadImages(),this},_loadImages:function(){this.iconView=new j({imageClass:"Editor-fillImageAsset",imageUrl:this._getImageURL(),color:this.model.get("fixed")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_categoryImagesPresent:function(){var a=this.model.get("images");for(var b in a)if(!d.isEmpty(a[b]))return!0;return!1},_iconStylingEnabled:function(){return this._imageEnabled},_getKind:function(){return this.model.get("kind")&&this._iconStylingEnabled()?this.model.get("kind"):""},_getImageURL:function(){return this.model.get("image")&&this._iconStylingEnabled()?this.model.get("image"):""},_migrateRange:function(){var a=this.model.get("range"),b=this.model.get("bins")||3;i[a]&&i[a][b]&&this.model.set("range",i[a][b])},_getColumn:function(){return d.find(this._columns,function(a){return a.label===this.model.get("attribute")},this)},_createContentView:function(){var a=new g({configModel:this._configModel,userModel:this._userModel,modals:this._modals,query:this._query,model:this.model,columns:this._columns,editorAttrs:this._editorAttrs});return a.bind("change",this.render,this),a},_onClick:function(a){this.options.disabled||this.trigger("click",this.model)},_initBinds:function(){var a=this;this.model.set("createContentView",function(){return a._createContentView()}).bind(this),this.model.on("change:images",this.render,this),this.model.on("change:selected",this._onToggleSelected,this),this.model.on("change:opacity",this.render,this),this.model.on("change:fixed",this.render,this),this.model.on("change:fixed",this._updateColor,this),this.model.on("change:image",this.render,this),this.model.on("change:range",this.render,this)},_updateColor:function(){this.iconView&&this.iconView.updateImageColor(this.model.get("fixed"))},_getValue:function(){var a=this.model.get("fixed");return a&&(a=h.hexToRGBA(a,this._getOpacity())),this.model.get("range")&&this.model.get("range").length&&(a=d.map(this.model.get("range"),function(a){return h.hexToRGBA(a,this._getOpacity())},this)),a},_getOpacity:function(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onToggleSelected:function(){this.$el.toggleClass("is-active",this.model.get("selected"))}})},{"../../../../../helpers/utils":1102,"../../../../img-loader-view":213,"./input-color-dialog-content":141,"./input-color.tpl":152,"./input-ramps/ramps":160,
"backbone/core-view":1127,underscore:"underscore"}],152:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",showCategories?(__p+='\n  <ul class="ColorsBar">\n    ',_.each(value,function(a){__p+='\n      <li class="ColorBar '+(null==(__t=categoryImagesPresent?"ColorBar--spaceSmall":"ColorBar--spaceMedium")?"":_.escape(__t))+'" style="background-color: '+(null==(__t=a)?"":_.escape(__t))+'"></li>\n    '}),__p+="\n  </ul>\n"):(__p+='\n  <button type="button" class="Editor-fillContainer">\n    <ul class="ColorBarContainer">\n      ',__p+=_.isArray(value)?'\n        <li class="ColorBar ColorBar-gradient" style="background: linear-gradient(90deg,'+(null==(__t=value.join(","))?"":_.escape(__t))+')"></li>\n      ':'\n        <li class="ColorBar" style="background-color: '+(null==(__t=value)?"":_.escape(__t))+'"></li>\n      ',__p+="\n    </ul>\n  </button>\n"),__p+="\n\n",imageURL&&"custom-marker"!==kind&&(__p+='\n<button type="button" class="Editor-fillImage">\n  <div class="js-image-container"></div>\n</button>\n'),__p+="\n\n",(!imageURL&&categoryImagesPresent||imageURL&&"custom-marker"===kind)&&(__p+='\n<button type="button" class="Editor-fillImage">\n  <div class=\'Editor-categoryImagesTag CDB-Text CDB-FontSize-small u-altTextColor is-semibold u-upperCase\'>'+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":__t)+"</div>\n</button>\n"),__p+="\n";return __p}},{underscore:"underscore"}],153:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",customRamp&&customRamp.length&&(__p+='\n<li class="CDB-ListDecoration-item CustomList-item CustomRamp js-customRampItem">\n  <div class="CustomRamp-listOptions CDB-ListDecoration-itemLink CDB-ListDecoration-itemLink--double js-customRamp js-listItemLink is-selected">\n    <ul class="ColorBarContainer">\n      ',_.each(customRamp,function(a){__p+='\n      <li class="ColorBar ColorBar--spaceless" style="background-color: '+(null==(__t=a)?"":_.escape(__t))+';"></li>\n      '}),__p+='\n    </ul>\n  </div>\n  <button class="CDB-ListDecoration-itemLink CustomRamp-clear js-clear">\n    <div class="CDB-Shape">\n      <div class="CDB-Shape-close is-blue is-large"></div>\n    </div>\n  </button>\n</li>\n'),__p+="\n";return __p}},{underscore:"underscore"}],154:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../../../../components/stack-layout/stack-layout-view"),h=a("../../column-list-view"),i=a("../quantification-method-item.tpl"),j=a("./input-ramp-content-view"),k=a("cartocolor"),l=a("../../default-fill-settings.json");b.exports=f.extend({initialize:function(a){this._settings=l["color-ramps"],this._setupModel(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_setupModel:function(){var a={};this.model.get("quantification")||(a.quantification=this._settings.quantifications.items[this._settings.quantifications.defaultIndex]),this.model.get("bins")||(a.bins=this._settings.bins.items[this._settings.bins.defaultIndex]),+this.model.get("bins")>+this._settings.bins.items[this._settings.bins.items.length-1]&&(a.bins=this._settings.bins.items[this._settings.bins.items.length-1]),this.model.set(a)},_initBinds:function(){var a=this.model.get("range");this.listenTo(this.model,"change:bins",this._updateRange),this.listenTo(this.model,"change:attribute",this.render),this.listenTo(this.model,"change:quantification",this._onChangeQuantification),this.model.unset("fixed"),a&&this._isValidRange(a)||this.model.set("range",this._getDefaultRamp())},_isValidRange:function(a){return a&&a.length>1||!1},_initViews:function(){var a=this,b=[{createStackView:function(b,c){return a._createInputRampContentView(b,c).bind(a)}}];this.options.hideTabs&&d.contains(this.options.hideTabs,"quantification")||b.push({createStackView:function(b,c){return a._createQuantificationListView(b,c).bind(a)}}),this.options.hideTabs&&d.contains(this.options.hideTabs,"bins")||b.push({createStackView:function(b,c){return a._createBinsListView(b,c).bind(a)}});var c=new e.Collection(b);this._stackLayoutView=new g({collection:c}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_updateRange:function(){var a=this.model.previous("bins");if(a){var b=d.find(k,function(b){var c=b[a],d=this.model.get("range");return c&&d&&c.join("").toLowerCase()===d.join("").toLowerCase()},this);if(b){var c=this.model.get("bins");this.model.set("range",b[c])}}},_createInputRampContentView:function(a,b){var c=new j({stackLayoutModel:a,model:this.model});return c.bind("back",function(a){this.trigger("back")},this),c.bind("selectItem",function(a){this.model.unset("domain"),this.model.set("range",a)},this),c.bind("selectQuantification",function(b){a.goToStep(1)},this),c.bind("selectBins",function(b){a.goToStep(2)},this),c},_createBinsListView:function(a,b){var c=new h({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:a,columns:this._settings.bins.items});return c.bind("selectItem",function(b){this.model.set("bins",b.get("val")),a.goToStep(0)},this),c.bind("back",function(b){a.goToStep(0)},this),c},_createQuantificationListView:function(a,b){var c=new h({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:a,itemTemplate:i,columns:this._settings.quantifications.items,showSearch:!1});return c.bind("selectItem",function(b){this.model.set("quantification",b.get("val")),a.prevStep()},this),c.bind("back",function(b){a.goToStep(0)},this),c},_getDefaultRamp:function(){return d.map(k,function(a){return a[this.model.get("bins")]},this)[0]},_onChangeQuantification:function(){"category"===this.model.get("quantification")&&this.trigger("switch",this)},remove:function(){f.prototype.remove.apply(this)}})},{"../../../../../../components/stack-layout/stack-layout-view":533,"../../column-list-view":101,"../../default-fill-settings.json":103,"../quantification-method-item.tpl":161,"./input-ramp-content-view":155,backbone:"backbone","backbone/core-view":1127,cartocolor:"cartocolor",underscore:"underscore"}],155:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("backbone/core-view"),g=a("./input-ramp-list-view"),h=a("../../../../../../components/stack-layout/stack-layout-view"),i=a("../input-color-picker/input-color-picker-view");b.exports=f.extend({events:{"click .js-back":"_onClickBack"},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=this,b=new d.Collection([{createStackView:function(b,c){return a._createInputRampListView(b,c).bind(a)}},{createStackView:function(b,c){return a._createColorPickerView(b,c).bind(a)}}]);this._stackLayoutView=new h({collection:b}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createColorPickerView:function(a,b){var c=e.map(this.model.get("range"),function(a,b){return{val:a,color:a,title:this.model.get("attribute")}},this),d="undefined"!=typeof this.model.get("opacity")?this.model.get("opacity"):1,f=new i({index:0,ramp:c,opacity:d});return f.bind("back",function(b){a.prevStep()},this),f.bind("change",this._updateRange,this),f.bind("change:opacity",function(a){this.model.set("opacity",a)},this),f},_createInputRampListView:function(a,b){var c=new g({model:this.model,showSearch:this.options.showSearch||!1,typeLabel:this.options.typeLabel});return c.bind("customize",function(b){a.nextStep()},this),c.bind("change_ramp",this._updateRamp,this),c.bind("change",this._updateRange,this),c.bind("back",function(a){this.trigger("back",this)},this),c.bind("switch",function(a){this.trigger("switch",this)},this),c.bind("selectItem",function(a){this.trigger("selectItem",a.get("val"),this)},this),c.bind("selectBins",function(a){this.trigger("selectBins",this)},this),c.bind("selectQuantification",function(a){this.trigger("selectQuantification",this)},this),c},_updateRamp:function(a){this.model.set("range",a)},_updateRange:function(a){this.model.set("range",e.pluck(a,"color"))},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)}})},{"../../../../../../components/stack-layout/stack-layout-view":533,"../input-color-picker/input-color-picker-view":148,"./input-ramp-list-view":159,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],156:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="InputColor-modalHeader CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <div class="u-flex u-alignStart u-ellipsis">\n        <button class="u-rSpace u-actionTextColor js-back">\n          <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n        </button>\n        <div class="u-ellipsis">\n          '+(null==(__t=attribute)?"":_.escape(__t))+'\n        </div>\n      </div>\n    </li>\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <ul class="u-flex u-justifySpace">\n        <li class="u-flex">\n          '+(null==(__t=bins)?"":_.escape(__t))+" "+(null==(__t=_t("form-components.editors.fill.input-ramp.buckets",{smart_count:bins}))?"":_.escape(__t))+'\n          <button class="CDB-Shape u-lSpace js-bins">\n            <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n            </div>\n          </button>\n        </li>\n        <li class="u-flex">\n          '+(null==(__t=_t("form-components.editors.fill.quantification.methods."+quantification))?"":_.escape(__t))+'\n          <button class="CDB-Shape u-lSpace js-quantification">\n            <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n            </div>\n          </button>\n        </li>\n      </ul>\n    </li>\n  </ul>\n</div>\n<div class="js-content"></div>\n<div class="CDB-Text CDB-Size-medium CustomRamp-list CustomList-listWrapper">\n  <ul class="CustomList-list js-customList">\n    <li class="CDB-ListDecoration-item CustomList-item CustomList-item--add">\n      <button class="CDB-ListDecoration-itemLink js-listItemLink js-customize u-actionTextColor">'+(null==(__t=_t("form-components.editors.fill.customize"))?"":_.escape(__t))+"</button>\n    </li>\n  </ul>\n</div>\n";return __p}},{underscore:"underscore"}],157:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ColorBarWrapper--withInvertLink CDB-ListDecoration-itemLink CDB-ListDecoration-itemLink--double js-listItemLink ',isSelected&&(__p+=" is-selected "),__p+='">\n  <ul class="ColorBarContainer">\n    ',_.each(name,function(a){__p+='\n    <li class="ColorBar ColorBar--spaceless" style="background-color: '+(null==(__t=a)?"":_.escape(__t))+';"></li>\n    '}),__p+='\n  </ul>\n</div>\n<button class="ColorBar-invertLink js-invert" data-event="invert"></button>\n\n';return __p}},{underscore:"underscore"}],158:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore");b.exports=d.extend({className:"CDB-ListDecoration-item CustomList-item CustomList-item--invert js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","click .js-listItemLink":"_onClick","click .js-invert":"_onClickInvert"},initialize:function(a){this.options=e.extend({},this.options,a),this.listenTo(this.model,"change",this.render)},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.options.template(e.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isInverted:this.model.get("inverted"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:this.model.getName(),val:this.model.getValue(),options:this.model.get("renderOptions")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")).toggleClass("is-selected",!!this.model.get("selected")).toggleClass("is-inverted",!!this.model.get("inverted")),this},_onMouseLeave:function(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function(){this.$el.addClass("is-highlighted")},_onClick:function(a){this.killEvent(a),this.model.get("selected")?this.trigger("customEvent","customize",this.model.get("val"),this):this.model.set("selected",!0)},_onClickInvert:function(a){this.killEvent(a),this.model.set("inverted",!this.model.get("inverted")),this.trigger("customEvent","invert",this.model,this)}})},{"backbone/core-view":1127,underscore:"underscore"}],159:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("backbone/core-view"),g=a("../../../../../custom-list/custom-view"),h=a("../../../../../custom-list/custom-list-collection"),i=a("./input-ramp-list-item-template.tpl"),j=a("./input-ramp-list-item-view"),k=a("./custom-ramp-template.tpl"),l=a("cartocolor"),m=a("./input-ramp-content-view.tpl"),n="#CCCCCC";b.exports=f.extend({events:{"click .js-customize":"_onClickCustomize","click .js-clear":"_onClickClear","click .js-customRamp":"_onClickCustomRamp","click .js-back":"_onClickBack","click .js-switch":"_onClickSwitch","click .js-quantification":"_onClickQuantification","click .js-bins":"_onClickBins"},initialize:function(a){this._showSearch=a.showSearch||!1,this._typeLabel=a.typeLabel,this._initModels(),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty(),this.$el.append(m({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initViews();var a=this._customRamp.get("range");if(this.$(".js-customList").prepend(k({customRamp:a})),a)this.$(".js-customList").addClass("is-customized");else{var b=this.collection.getSelectedItem();b||(b=this.collection.first()),this._selectRamp(b)}return this},_initModels:function(){this._customRamp=new e.core.Model,this._setupCollection()},_initBinds:function(){this.listenTo(this.model,"change:bins",this._onChangeBins),this.listenTo(this.model,"change:attribute_type",this._updateRampOnAttributeChange),this.listenTo(this.collection,"change:selected",this._onSelectItem)},_initViews:function(){this._listView=new g({collection:this.collection,showSearch:this._showSearch,typeLabel:this._typeLabel,itemTemplate:i,itemView:j}),this._listView.bind("invert",this._invertRamp,this),this._listView.bind("customize",function(a){this.trigger("customize",a,this)},this),this.$(".js-content").append(this._listView.render().el),this.addView(this._listView)},_getRamps:function(){var a=this.model.get("attribute_type"),b={number:["quantitative","diverging"],string:["qualitative"]},c=l;return b[a]&&(c=d.filter(c,function(c){return!!c.tags&&d.contains(b[a],c.tags[0])})),c=d.map(c,function(a,b){var c=a[this.model.get("bins")],e=this.model.get("range"),f=!1,g=!1;return c&&c.length&&e&&e.length&&(f=c.join().toLowerCase()===e.join().toLowerCase(),f||(f=d.clone(c).reverse().join().toLowerCase()===e.join().toLowerCase(),g=f)),c?{selected:f,inverted:g,name:b,val:c}:null},this)},_setupCollection:function(){var a=this._getRamps();this.collection=new h(d.compact(a),{silent:!1}),this.collection.getSelectedItem()||this._customRamp.set("range",this.model.get("range"))},_updateRampOnAttributeChange:function(a,b){var c=this._getRamps();this.collection.reset(d.compact(c),{silent:!0}),this._customRamp.set("range",!1);var e=this.collection.first();e&&e.set("selected",!0),this.render()},_invertRamp:function(a){if(a){this._customRamp.set("range",null),a.set("selected",!1);var b=[].concat(a.get("val")).reverse();a.set({val:b,selected:!0}),this.model.set("range",b)}},_selectRamp:function(a){if(a){var b=a.get("val");this.$(".js-listItemLink").removeClass("is-selected"),this.$('.js-listItem[data-val="'+b.join(",")+'"] .js-listItemLink').addClass("is-selected")}},_onClickClear:function(a){this.killEvent(a),this._customRamp.set("range",null),this.collection.getSelectedItem()||this.collection.first().set("selected",!0),this.render(),this._listView.highlight()},_onClickCustomRamp:function(a){this.killEvent(a),this.model.get("range")===this._customRamp.get("range")?this.trigger("customize",this.collection.getSelectedItem(),this):this.model.set("range",this._customRamp.get("range")),this.$(".js-listItemLink").removeClass("is-selected"),this.$(".js-customRamp").addClass("is-selected")},_onClickCustomize:function(a){this.killEvent(a);var b=this.collection.getSelectedItem();this._customRamp.set("range",b),this.trigger("customize",b,this)},_onChangeBins:function(){var a=this._customRamp.get("range");a&&(a=this.model.get("bins")>a.length?d.range(this.model.get("bins")).map(function(b){return b>=a.length?n:a[b]}):a.slice(0,this.model.get("bins")),this.model.set("range",a),this._customRamp.set("range",a))},_onSelectItem:function(a){this._selectRamp(a),this.trigger("selectItem",a,this)},_onClickSwitch:function(a){this.killEvent(a),this.trigger("switch",this)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onClickQuantification:function(a){this.killEvent(a),this.trigger("selectQuantification",this)},_onClickBins:function(a){this.killEvent(a),this.trigger("selectBins",this)}})},{"../../../../../custom-list/custom-list-collection":47,"../../../../../custom-list/custom-view":59,"./custom-ramp-template.tpl":153,"./input-ramp-content-view.tpl":156,"./input-ramp-list-item-template.tpl":157,"./input-ramp-list-item-view":158,"backbone/core-view":1127,cartocolor:"cartocolor","cartodb.js":"cartodb.js",underscore:"underscore"}],160:[function(a,b,c){b.exports={green:{3:["#E5F5F9","#99D8C9","#2CA25F"],4:["#EDF8FB","#B2E2E2","#66C2A4","#238B45"],5:["#EDF8FB","#B2E2E2","#66C2A4","#2CA25F","#006D2C"],6:["#EDF8FB","#CCECE6","#99D8C9","#66C2A4","#2CA25F","#006D2C"],7:["#EDF8FB","#D7FAF4","#CCECE6","#66C2A4","#41AE76","#238B45","#005824"]},blue:{3:["#EDF8B1","#7FCDBB","#2C7FB8"],4:["#FFFFCC","#A1DAB4","#41B6C4","#225EA8"],5:["#FFFFCC","#A1DAB4","#41B6C4","#2C7FB8","#253494"],6:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#2C7FB8","#253494"],7:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#1D91C0","#225EA8","#0C2C84"]},pink:{3:["#E7E1EF","#C994C7","#DD1C77"],4:["#F1EEF6","#D7B5D8","#DF65B0","#CE1256"],5:["#F1EEF6","#D7B5D8","#DF65B0","#DD1C77","#980043"],6:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#DD1C77","#980043"],7:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#E7298A","#CE1256","#91003F"]},black:{3:["#F0F0F0","#BDBDBD","#636363"],4:["#F7F7F7","#CCCCCC","#969696","#525252"],5:["#F7F7F7","#CCCCCC","#969696","#636363","#252525"],6:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#636363","#252525"],7:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#737373","#525252","#252525"]},red:{3:["#FFEDA0","#FEB24C","#F03B20"],4:["#FFFFB2","#FECC5C","#FD8D3C","#E31A1C"],5:["#FFFFB2","#FECC5C","#FD8D3C","#F03B20","#BD0026"],6:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#F03B20","#BD0026"],7:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#B10026"]},inverted_green:{3:["#2CA25F","#99D8C9","#E5F5F9"],4:["#238B45","#66C2A4","#B2E2E2","#EDF8FB"],5:["#006D2C","#2CA25F","#66C2A4","#B2E2E2","#EDF8FB"],6:["#006D2C","#2CA25F","#66C2A4","#99D8C9","#CCECE6","#EDF8FB"],7:["#005824","#238B45","#41AE76","#66C2A4","#CCECE6","#D7FAF4","#EDF8FB"]},inverted_blue:{3:["#2C7FB8","#7FCDBB","#EDF8B1"],4:["#225EA8","#41B6C4","#A1DAB4","#FFFFCC"],5:["#253494","#2C7FB8","#41B6C4","#A1DAB4","#FFFFCC"],6:["#253494","#2C7FB8","#41B6C4","#7FCDBB","#C7E9B4","#FFFFCC"],7:["#0C2C84","#225EA8","#1D91C0","#41B6C4","#7FCDBB","#C7E9B4","#FFFFCC"]},inverted_pink:{3:["#DD1C77","#C994C7","#E7E1EF"],4:["#CE1256","#DF65B0","#D7B5D8","#F1EEF6"],5:["#980043","#DD1C77","#DF65B0","#D7B5D8","#F1EEF6"],6:["#980043","#DD1C77","#DF65B0","#C994C7","#D4B9DA","#F1EEF6"],7:["#91003F","#CE1256","#E7298A","#DF65B0","#C994C7","#D4B9DA","#F1EEF6"]},inverted_black:{3:["#636363","#BDBDBD","#F0F0F0"],4:["#525252","#969696","#CCCCCC","#F7F7F7"],5:["#252525","#636363","#969696","#CCCCCC","#F7F7F7"],6:["#252525","#636363","#969696","#BDBDBD","#D9D9D9","#F7F7F7"],7:["#252525","#525252","#737373","#969696","#BDBDBD","#D9D9D9","#F7F7F7"]},inverted_red:{3:["#F03B20","#FEB24C","#FFEDA0"],4:["#E31A1C","#FD8D3C","#FECC5C","#FFFFB2"],5:["#BD0026","#F03B20","#FD8D3C","#FECC5C","#FFFFB2"],6:["#BD0026","#F03B20","#FD8D3C","#FEB24C","#FED976","#FFFFB2"],7:["#B10026","#E31A1C","#FC4E2A","#FD8D3C","#FEB24C","#FED976","#FFFFB2"]},spectrum1:{3:["#1a9850","#fff2cc","#d73027"],4:["#1a9850","#d2ecb4","#fed6b0","#d73027"],5:["#1a9850","#8cce8a","#fff2cc","#f79272","#d73027"],6:["#1a9850","#8cce8a","#d2ecb4","#fed6b0","#f79272","#d73027"],7:["#1a9850","#8cce8a","#d2ecb4","#fff2cc","#fed6b0","#f79272","#d73027"]},spectrum2:{3:["#0080ff","#fff2cc","#ff4d4d"],4:["#0080ff","#7fbfff","#ffa6a6","#ff4d4d"],5:["#0080ff","#40a0ff","#fff2cc","#ff7a7a","#ff4d4d"],6:["#0080ff","#40a0ff","#7fbfff","#ffa6a6","#ff7a7a","#ff4d4d"],7:["#0080ff","#40a0ff","#7fbfff","#fff2cc","#ffa6a6","#ff7a7a","#ff4d4d"]},purple_states:{3:["#F1E6F1","#B379B3","#8A4E8A"],4:["#F1E6F1","#D8BBD8","#A05AA0","#8A4E8A"],5:["#F1E6F1","#D8BBD8","#B379B3","#A05AA0","#8A4E8A"],6:["#F1E6F1","#D8BBD8","#CCA5CC","#B379B3","#A05AA0","#8A4E8A"],7:["#F1E6F1","#D8BBD8","#CCA5CC","#C08FC0","#B379B3","#A05AA0","#8A4E8A"]},red_states:{3:["#F2D2D3","#D4686C","#C1373C"],4:["#F2D2D3","#EBB7B9","#CC4E52","#C1373C"],5:["#F2D2D3","#EBB7B9","#D4686C","#CC4E52","#C1373C"],6:["#F2D2D3","#EBB7B9","#E39D9F","#D4686C","#CC4E52","#C1373C"],7:["#F2D2D3","#EBB7B9","#E39D9F","#DB8286","#D4686C","#CC4E52","#C1373C"]},blue_states:{3:["#ECF0F6","#6182B5","#43618F"],4:["#ECF0F6","#B2C2DB","#4E71A6","#43618F"],5:["#ECF0F6","#B2C2DB","#6182B5","#4E71A6","#43618F"],6:["#ECF0F6","#B2C2DB","#9BB0D0","#6182B5","#4E71A6","#43618F"],7:["#ECF0F6","#B2C2DB","#9BB0D0","#849EC5","#6182B5","#4E71A6","#43618F"]},inverted_purple_states:{3:["#8A4E8A","#B379B3","#F1E6F1"],4:["#8A4E8A","#A05AA0","#D8BBD8","#F1E6F1"],5:["#8A4E8A","#A05AA0","#B379B3","#D8BBD8","#F1E6F1"],6:["#8A4E8A","#A05AA0","#B379B3","#CCA5CC","#D8BBD8","#F1E6F1"],7:["#8A4E8A","#A05AA0","#B379B3","#C08FC0","#CCA5CC","#D8BBD8","#F1E6F1"]},inverted_red_states:{3:["#C1373C","#D4686C","#F2D2D3"],4:["#C1373C","#CC4E52","#EBB7B9","#F2D2D3"],5:["#C1373C","#CC4E52","#D4686C","#EBB7B9","#F2D2D3"],6:["#C1373C","#CC4E52","#D4686C","#E39D9F","#EBB7B9","#F2D2D3"],7:["#C1373C","#CC4E52","#D4686C","#DB8286","#E39D9F","#EBB7B9","#F2D2D3"]},inverted_blue_states:{3:["#43618F","#6182B5","#ECF0F6"],4:["#43618F","#4E71A6","#B2C2DB","#ECF0F6"],5:["#43618F","#4E71A6","#6182B5","#B2C2DB","#ECF0F6"],6:["#43618F","#4E71A6","#6182B5","#9BB0D0","#B2C2DB","#ECF0F6"],7:["#43618F","#4E71A6","#6182B5","#849EC5","#9BB0D0","#B2C2DB","#ECF0F6"]}}},{}],161:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-ListDecoration-itemLink u-flex u-justifySpace u-alignCenter u-actionTextColor ',isSelected&&(__p+=" is-selected "),__p+='">\n  '+(null==(__t=_t("form-components.editors.fill.quantification.methods."+name))?"":_.escape(__t))+"\n</div>\n\n";return __p}},{underscore:"underscore"}],162:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./input-number-value-content-view.tpl");b.exports=e.extend({events:{"click .js-back":"_onClickBack","click .js-bins":"_onClickBins","click .js-quantification":"_onClickQuantification"},render:function(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this.$el.append(f({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initForm(),this},_calculateRangeFromFixed:function(a,b){b=b||30;var c=this.options.max-this.options.min,d=a/c;return[Math.floor(Math.max(this.options.min,a-b*d)),Math.floor(Math.min(this.options.max,a+b*d))]},_initForm:function(){var a=this;this._formView&&this._formView.remove();var b,c,e=this.model.get("range");if(b=c=this.model.get("fixed"),e&&(b=+e[0],c=+e[1]),b===c){var f=this._calculateRangeFromFixed(b);b=f[0],c=f[1],this.model.set("range",f)}this._formModel=new d.Model({min:b,max:c}),this._formModel.schema={min:{type:"Number",validators:["required",{type:"interval",min:a.options.min,max:a.options.max}]},max:{type:"Number",validators:["required",{type:"interval",min:a.options.min,max:a.options.max}]}},this._formModel.bind("change",function(a){this.model.set("range",[+a.get("min"),+a.get("max")])},this),this._formView=new d.Form({className:"Editor-boxList",model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$(".js-content").append(this._formView.render().$el)},_removeForm:function(){this._formView&&this._formView.remove()},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onClickQuantification:function(a){this.killEvent(a),this.trigger("selectQuantification",this)},_onClickBins:function(a){this.killEvent(a),this.trigger("selectBins",this)},clean:function(){this._removeForm(),e.prototype.clean.call(this)}})},{"./input-number-value-content-view.tpl":166,backbone:"backbone","backbone/core-view":1127}],163:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("../fill-tab-pane.tpl"),g=a("../../../../../components/tab-pane/create-text-labels-tab-pane"),h=a("./input-number-fixed-content-view"),i=a("./input-number-value-content-view"),j=0,k=100,l=1;b.exports=e.extend({initialize:function(a){if(!a.columns)throw new Error("columns param is required");this._columns=a.columns,this.listenTo(this.model,"change:attribute",this._updateRangeValue)},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=this,b={name:"fixed",label:_t("form-components.editors.fill.input-number.fixed"),createContentView:function(){return a._generateFixedContentView()}},c={name:"value",label:_t("form-components.editors.fill.input-number.value"),createContentView:function(){return a._generateValueContentView()}};if(this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes){var e=this.options.editorAttrs.hidePanes;d.contains(e,"fixed")||this._tabPaneTabs.push(b),d.contains(e,"value")||this._tabPaneTabs.push(c)}else this._tabPaneTabs=[b,c];var h={tabPaneOptions:{template:f,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("range")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this._tabPaneView=g(this._tabPaneTabs,h),this.listenTo(this._tabPaneView.collection,"change:selected",this._onChangeTabPaneViewTab),this.addView(this._tabPaneView),this.$el.append(this._tabPaneView.render().$el)},_onChangeTabPaneViewTab:function(){var a=this._tabPaneView.getSelectedTabPaneName();"fixed"===a?this._updateFixedValue():this._updateRangeValue(),this.trigger("change",a,this)},_updateFixedValue:function(){if(this.model.get("range")){var a=this.model.get("range"),b=.5*(+a[0]+ +a[1]);this.model.set("fixed",b),this.model.unset("range")}},_updateRangeValue:function(){null!==this.model.get("fixed")&&void 0!==this.model.get("fixed")&&this.model.get("attribute")&&(this.model.set("range",[this.model.get("fixed"),this.model.get("fixed")]),this.model.unset("fixed"))},_generateFixedContentView:function(){var a=this.options.editorAttrs;return new h({model:this.model,min:a&&a.min||j,max:a&&a.max||k,step:a&&a.step||l})},_generateValueContentView:function(){var a=this.options.editorAttrs;return new i({model:this.model,columns:this._columns,min:a&&a.min||j,max:a&&a.max||k})},_onChangeValue:function(a){this.model.set("fixed",a.value)}})},{"../../../../../components/tab-pane/create-text-labels-tab-pane":537,"../fill-tab-pane.tpl":106,"./input-number-fixed-content-view":164,"./input-number-value-content-view":165,"backbone/core-view":1127,underscore:"underscore"}],164:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=e.extend({render:function(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this._initForm(),this},_initForm:function(){this._formModel=new d.Model({value:this.model.get("fixed")}),this._formModel.schema={value:{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max,step:this.options.step}]}},this._formModel.bind("change",function(a){this.model.set("fixed",a.get("value"))},this),this._formView=new d.Form({className:"CDB-ListDecoration-itemPadding",model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.append(this._formView.render().$el)},_removeForm:function(){this._formView&&this._formView.remove()},clean:function(){this._removeForm(),e.prototype.clean.call(this)}})},{backbone:"backbone","backbone/core-view":1127}],165:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../../../../components/stack-layout/stack-layout-view"),g=a("../column-list-view"),h=a("./quantification-method-item.tpl"),i=a("./input-number-content-view"),j=a("../default-fill-settings.json"),k=0,l=1,m=2;b.exports=e.extend({events:{"click .js-back":"_onClickBack"},initialize:function(a){if(!a.columns)throw new Error("columns param is required");this._columns=a.columns,this._settings=j.number,this._setupModel()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_setupModel:function(){var a={};this.model.get("quantification")||(a.quantification=this._settings.quantifications.items[this._settings.quantifications.defaultIndex]),this.model.get("bins")||(a.bins=this._settings.bins.items[this._settings.bins.defaultIndex]),+this.model.get("bins")>+this._settings.bins.items[this._settings.bins.items.length-1]&&(a.bins=this._settings.bins.items[this._settings.bins.items.length-1]),this.model.set(a)},_initViews:function(){var a=this,b=new d.Collection([{createStackView:function(b,c){return a._createInputRampContentView(b,c).bind(a)}},{createStackView:function(b,c){return a._createInputNumberContentView(b,c).bind(a)}},{createStackView:function(b,c){return a._createQuantificationListView(b,c).bind(a)}},{createStackView:function(b,c){return a._createBinsListView(b,c).bind(a)}}]);this._stackLayoutView=new f({collection:b});var c=l;this.model.get("attribute")?this.model.get("quantification")||(c=m):c=k,this._stackLayoutView.model.set("position",c),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createInputRampContentView:function(a,b){var c=new g({stackLayoutModel:a,columns:this._columns.filter(function(a){return"number"===a.type}),showSearch:!0,typeLabel:"column"});return c.bind("selectItem",function(a){this.model.set("attribute",a.get("val"));var b=l;this.model.get("quantification")||(b=m),this._stackLayoutView.model.goToStep(b)},this),c},_createInputNumberContentView:function(a,b){var c=new i({stackLayoutModel:a,model:this.model,min:this.options.min,max:this.options.max});return c.bind("back",function(b){a.prevStep()},this),c.bind("selectQuantification",function(b){a.goToStep(2)},this),c.bind("selectBins",function(b){a.goToStep(3);
},this),c},_createQuantificationListView:function(a,b){var c=new g({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:a,columns:this._settings.quantifications.items,itemTemplate:h,showSearch:!1});return c.bind("selectItem",function(b){this.model.set("quantification",b.get("val")),a.prevStep()},this),c.bind("back",function(b){a.prevStep()},this),c},_createBinsListView:function(a,b){var c=new g({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:a,columns:this._settings.bins.items});return c.bind("selectItem",function(b){this.model.set("bins",b.get("val")),a.goToStep(1)},this),c.bind("back",function(b){a.goToStep(1)},this),c},_onClickBack:function(a){this.killEvent(a)}})},{"../../../../../components/stack-layout/stack-layout-view":533,"../column-list-view":101,"../default-fill-settings.json":103,"./input-number-content-view":162,"./quantification-method-item.tpl":169,backbone:"backbone","backbone/core-view":1127}],166:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="InputColor-modalHeader CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <div class="u-flex u-alignStart u-ellipsis">\n        <button class="u-rSpace u-actionTextColor js-back">\n          <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n        </button>\n        <div class="u-ellipsis">\n          '+(null==(__t=attribute)?"":_.escape(__t))+'\n        </div>\n      </div>\n    </li>\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <ul class="u-flex u-justifySpace">\n        <li class="u-flex">\n          '+(null==(__t=bins)?"":_.escape(__t))+" "+(null==(__t=_t("form-components.editors.fill.input-ramp.buckets",{smart_count:bins}))?"":_.escape(__t))+'\n          <button class="CDB-Shape u-lSpace js-bins">\n            <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n            </div>\n          </button>\n        </li>\n        <li class="u-flex">\n          '+(null==(__t=_t("form-components.editors.fill.quantification.methods."+quantification))?"":_.escape(__t))+'\n          <button class="CDB-Shape u-lSpace js-quantification">\n            <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n            </div>\n          </button>\n        </li>\n      </ul>\n    </li>\n  </ul>\n</div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],167:[function(a,b,c){var d=a("backbone/core-view"),e=a("./input-number.tpl"),f=a("./input-number-dialog-content");b.exports=d.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function(a){if(!a.columns)throw new Error("columns is required");this._columns=a.columns,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.options.disabled&&this.$el.addClass("is-disabled"),this.$el.html(e({value:this._getValue()})),this},_createContentView:function(){var a=new f({model:this.model,columns:this._columns,editorAttrs:this.options.editorAttrs});return a.bind("change",this.render,this),a},_onClick:function(a){this.options.disabled||this.trigger("click",this.model)},_initBinds:function(){this.model.set("createContentView",function(){return this._createContentView()}.bind(this)),this.listenTo(this.model,"change:selected",this._onToggleSelected),this.listenTo(this.model,"change:fixed",this._onChangeValue),this.listenTo(this.model,"change:range",this._onChangeValue)},_getValue:function(){function a(a){return a.replace(/\.0$/,"")}return this.model.get("range")?this.model.get("range").map(function(b){return a((+b).toFixed(1))}).join(".."):a((+this.model.get("fixed")).toFixed(1))},_onChangeValue:function(){this.$(".js-value").text(this._getValue())},_onToggleSelected:function(){this.$el.toggleClass("is-active",this.model.get("selected"))}})},{"./input-number-dialog-content":163,"./input-number.tpl":168,"backbone/core-view":1127}],168:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-OptionInput-content js-value">'+(null==(__t=value)?"":_.escape(__t))+"</button>\n";return __p}},{underscore:"underscore"}],169:[function(a,b,c){arguments[4][161][0].apply(c,arguments)},{dup:161,underscore:"underscore"}],170:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend");d.Form.editors.List.CategoryModel=d.Form.editors.NestedModel.extend({initialize:function(a){if(d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),!this.form)throw new Error('Missing required option "form"');if(!a.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var a=this.form.constructor,b=this.value||{},c=this.schema.model,d=b.constructor===c?b:new c(b,this.options);return this.nestedForm=new a({model:d,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this}})},{"../editor-helpers-extend":92,backbone:"backbone"}],171:[function(a,b,c){var d=a("backbone"),e=a("jquery"),f=a("underscore");d.Form.editors.List.Item=d.Form.editors.Base.extend({events:{'click [data-action="remove"]':function(a){a.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function(a){13===a.keyCode&&(a.preventDefault(),this.list.addItem(),this.list.$list.find("> li:last input").focus())}},initialize:function(a){this.list=a.list,this.schema=a.schema||this.list.schema,this.value=a.value,this.Editor=a.Editor||d.Form.editors.Text,this.key=a.key,this.template=a.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=a.errorClassName||this.constructor.errorClassName,this.form=a.form,this.userModel=a.userModel,this.configModel=a.configModel,this.modals=a.modals},render:function(){this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form},{userModel:this.userModel,configModel:this.configModel,modals:this.modals}).render();var a=e(e.trim(this.template()));return a.find("[data-editor]").append(this.editor.el),this.setElement(a),this},getValue:function(){return this.editor.getValue()},setValue:function(a){this.editor.setValue(a)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),d.View.prototype.remove.call(this)},validate:function(){var a=this.getValue(),b=this.list.form?this.list.form.getValue():{},c=this.schema.validators,d=this.getValidator;if(!c)return null;var e=null;return f.every(c,function(c){return e=d(c)(a,b),!!e}),e?this.setError(e):this.clearError(),e?e:null},setError:function(a){this.$el.addClass(this.errorClassName),this.$el.attr("title",a.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{template:f.template('      <div>        <span data-editor></span>        <button type="button" data-action="remove">&times;</button>      </div>    ',null,d.Form.templateSettings),errorClassName:"error"})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],172:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("jquery"),g=a("underscore");d.Form.editors.List=d.Form.editors.Base.extend({events:{'click [data-action="add"]':function(a){a.preventDefault(),this.addItem(null,!0)}},initialize:function(a){a=a||{};var b=d.Form.editors;b.Base.prototype.initialize.call(this,a),e.setOptions(this,a);var c=this.schema;if(!c)throw new Error("Missing required option 'schema'");this.template=a.template||c.listTemplate||this.constructor.template,this.Editor=function(){var a=c.itemType;return a?b.List[a]?b.List[a]:b[a]:b.Text}(),this._userModel=this.options.userModel,this._configModel=this.options.configModel,this._modals=this.options.modals,this.items=[]},render:function(){var a=this,b=this.value||[],c=f(f.trim(this.template()));return this.$list=c.is("[data-items]")?c:c.find("[data-items]"),b.length?g.each(b,function(b){a.addItem(b)}):this.Editor.isAsync||this.addItem(),this.setElement(c),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this),this},addItem:function(a,b){var c=this,e=d.Form.editors,f=new e.List.Item({list:this,form:this.form,schema:this.schema,value:a,Editor:this.Editor,key:this.key,userModel:this._userModel,configModel:this._configModel,modals:this._modals}).render(),h=function(){c.items.push(f),c.$list.append(f.el),f.editor.on("all",function(a){if("change"!==a){var b=g.toArray(arguments);b[0]="item:"+a,b.splice(1,0,c),e.List.prototype.trigger.apply(this,b)}},c),f.editor.on("change",function(){f.addEventTriggered||(f.addEventTriggered=!0,this.trigger("add",this,f.editor)),this.trigger("item:change",this,f.editor),this.trigger("change",this)},c),f.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},c),f.editor.on("blur",function(){if(this.hasFocus){var a=this;setTimeout(function(){g.find(a.items,function(a){return a.editor.hasFocus})||a.trigger("blur",a)},0)}},c),(b||a)&&(f.addEventTriggered=!0),b&&(c.trigger("add",c,f.editor),c.trigger("change",c))};return this.Editor.isAsync?f.editor.on("readyToAdd",h,this):(h(),f.editor.focus()),f},removeItem:function(a){var b=this.schema.confirmDelete;if(!b||confirm(b)){var c=g.indexOf(this.items,a);this.items[c].remove(),this.items.splice(c,1),a.addEventTriggered&&(this.trigger("remove",this,a.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem()}},getValue:function(){var a=g.map(this.items,function(a){return a.getValue()});return g.without(a,void 0,"")},setValue:function(a){this.value=a,this.render()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){if(this.hasFocus){var a=g.find(this.items,function(a){return a.editor.hasFocus});a&&a.editor.blur()}},remove:function(){g.invoke(this.items,"remove"),d.Form.editors.Base.prototype.remove.call(this)},validate:function(){if(!this.validators)return null;var a=g.map(this.items,function(a){return a.validate()}),b=!!g.compact(a).length;if(!b)return null;var c={type:"list",message:"Some of the items in the list failed validation",errors:a};return c}},{template:g.template('      <div>        <div data-items></div>        <button type="button" data-action="add">Add</button>      </div>    ',null,d.Form.templateSettings)})},{"../editor-helpers-extend":92,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],173:[function(a,b,c){var d=a("../../../custom-list/custom-list-item-view"),e=a("underscore");b.exports=d.extend({render:function(){return this.$el.empty(),this.clearSubViews(),this.$el.append(this.options.template(e.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),name:this.model.getName(),val:this.model.getValue()},this.model.attributes))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},{"../../../custom-list/custom-list-item-view":50,underscore:"underscore"}],174:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink u-ellipsis u-actionTextColor" title="'+(null==(__t=val)?"":_.escape(__t))+'">\n  ',__p+="undefined"!=typeof type&&"node"===type?'\n    <div class="u-flex">\n      <span\n        class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase"\n        style="background-color: '+(null==(__t=color)?"":_.escape(__t))+';">'+(null==(__t=val)?"":_.escape(__t))+'</span>\n      <p class="CDB-Text CDB-Size-medium u-ellipsis u-flex">\n        '+(null==(__t=nodeTitle)?"":_.escape(__t))+'<span class="u-altTextColor u-lSpace u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</span>\n      </p>\n    </div>\n  ":"\n    "+(null==(__t=val)?"":_.escape(__t))+"\n  ",__p+="\n</button>\n";return __p}},{underscore:"underscore"}],175:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","undefined"!=typeof isLoading&&isLoading?__p+='\n  <div class="u-flex">\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n    <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n  </div>\n":(__p+="\n  ",__p+="undefined"!=typeof type&&"node"===type?'\n    <div class="u-flex">\n      <span\n        class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase"\n        style="background-color: '+(null==(__t=color)?"":_.escape(__t))+';">'+(null==(__t=val)?"":_.escape(__t))+'</span>\n        <p class="CDB-Text CDB-Size-medium u-ellipsis u-flex" title="'+(null==(__t=nodeTitle)?"":_.escape(__t))+" - "+(null==(__t=layerName)?"":_.escape(__t))+'">\n          '+(null==(__t=nodeTitle)?"":_.escape(__t))+' <span class="u-altTextColor u-lSpace u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</span>\n        </p>\n    </div>\n  ":"\n    "+(null==(__t=label)?"":_.escape(__t))+"\n  ",__p+="\n"),__p+="\n";return __p}},{underscore:"underscore"}],176:[function(a,b,c){var d=a("backbone"),e=a("./node-dataset-item-view"),f=a("./node-dataset-selected.tpl"),g=a("./node-dataset-item.tpl");d.Form.editors.NodeDataset=d.Form.editors.Select.extend({options:{selectedItemTemplate:f,itemListTemplate:g,customListItemView:e}})},{"./node-dataset-item-view":173,"./node-dataset-item.tpl":174,"./node-dataset-selected.tpl":175,backbone:"backbone"}],177:[function(a,b,c){var d=a("backbone"),e=a("./number.tpl"),f=a("../editor-helpers-extend");a("jquery"),a("jquery-ui");var g=38,h=40,i=32,j=13,k=1,l=10;d.Form.editors.Number=d.Form.editors.Base.extend({tagName:"ul",className:"CDB-OptionInput-container CDB-OptionInput-container--noMargin u-grow",options:{min:0,max:10,step:1,showSlider:!0,validators:[{type:"regexp",regexp:/^[+-]?((\.\d+)|(\d+(\.\d+)?))$/,message:_t("editor.edit-feature.valid")}]},events:{"keydown .js-input":"_onInputKeyDown","keyup .js-input":"_onInputKeyUp",focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),f.setOptions(this,a),this._validators=a.validators||a.schema&&a.schema.validators,this._validators&&this._validators[1]&&(this.options.min=this._validators[1].min,this.options.max=this._validators[1].max,this.options.step=this._validators[1].step),this._initViews()},_initViews:function(){var a=null===this.value?"null":"";this.$el.html(e({value:this.value,isDisabled:this.options.disabled,hasSlider:this.options.showSlider,isFormatted:this.options.isFormatted,placeholder:a})),this.options.showSlider&&this.$(".js-slider").slider({range:"min",value:this.value,min:this.options.min,max:this.options.max,step:this.options.step,orientation:"horizontal",disabled:this.options.disabled,slide:this._onSlideChange.bind(this),stop:this._onSlideStop.bind(this)}),this.$el.toggleClass("CDB-OptionInput-container--noSlider",!!this.options.showSlider)},_onSlideChange:function(a,b){this.value=b.value,this.$(".js-input").val(this.value)},_onSlideStop:function(a,b){this.trigger("change",this)},_onInputKeyDown:function(a){var b=+this.getValue(),c=k,d=this.$(".js-input");switch(a.shiftKey===!0&&(c=l),a.which){case i:case j:return!1;case g:b+=c,d.val(b);break;case h:b-=c,d.val(b)}},_hasSlider:function(){return this.options.showSlider&&this.$(".js-slider").data("ui-slider")},_onInputKeyUp:function(){var a=this.$(".js-input").val();this._hasSlider()&&this.$(".js-slider").slider("value",a),this.value=a,this.trigger("change",this)},focus:function(){this.hasFocus||this.$(".js-input").focus()},blur:function(){this.hasFocus&&this.$(".js-input").blur()},getValue:function(){var a=this.$(".js-input").val();return""===a?null:+a},setValue:function(a){this._hasSlider()&&this.$(".js-slider").slider("value",a),this.$(".js-input").val(a),this.value=a},_destroySlider:function(){this._hasSlider()&&this.$(".js-slider").slider("destroy")},remove:function(){this._destroySlider(),d.Form.editors.Base.prototype.remove.apply(this)},clean:function(){this.$el.remove()}})},{"../editor-helpers-extend":92,"./number.tpl":178,backbone:"backbone",jquery:"jquery","jquery-ui":1128}],178:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",hasSlider&&(__p+='\n  <li class="CDB-OptionInput-item CDB-OptionInput-item--noSeparator">\n    <div class="UISlider js-slider"></div>\n  </li>\n'),__p+='\n<li class="CDB-OptionInput-item">\n  <input type="text" class="CDB-InputText ',isFormatted&&(__p+="is-number"),__p+=" ",isDisabled&&(__p+="is-disabled"),__p+=' js-input" ',isDisabled&&(__p+="readonly"),__p+=' value="'+(null==(__t=value)?"":_.escape(__t))+'" placeholder="'+(null==(__t=placeholder)?"":_.escape(__t))+'" />\n</li>\n';return __p}},{underscore:"underscore"}],179:[function(a,b,c){var d=a("../../../custom-list/custom-list-collection"),e=a("underscore");b.exports=d.extend({search:function(a){return a=a.toLowerCase(),e(this.filter(function(b){var c=b.getName().toLowerCase(),d=b.get("type").toLowerCase();return~c.indexOf(a)&&"number"===d}))}})},{"../../../custom-list/custom-list-collection":47,underscore:"underscore"}],180:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-medium u-altTextColor Editor-dropDownInfoText">\n  '+(null==(__t=_t("components.backbone-forms.operators.count-message"))?"":_.escape(__t))+"\n</p>\n";return __p}},{underscore:"underscore"}],181:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{visible:!1,operator:"count",attribute:""},isValidOperator:function(){var a=this.get("operator"),b=this.get("attribute");return"count"===a||!(!a||!b)}})},{backbone:"backbone"}],182:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("jquery"),g=a("../../../custom-list/custom-view"),h=a("./operators-list-model"),i=a("./operators-list-count.tpl"),j=a("./operators-list.tpl");b.exports=d.extend({className:"Editor-dropdown Editor-boxModal Editor-dropdownOperators",tagName:"div",events:{'change input[name="operator"]':"_onOperationChange"},initialize:function(a){this.model=new h({operator:a.operator,attribute:a.attribute,visible:!1}),a.attribute&&this.collection.setSelected(a.attribute),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(j({operator:this.model.get("operator")})),this._renderList(),this},_initBinds:function(){this.model.bind("change:operator change:attribute",e.debounce(this._onModelChange.bind(this),10)),this.model.bind("change:visible",function(a,b){this._toggleVisibility(),b?this.render():(this._destroyList(),this.$(".js-list").html(i()))},this),this.collection.bind("change:selected",this._onAttributeSelected,this),this.add_related_model(this.collection)},_hasList:function(){return!!this._listView},_renderList:function(){if("count"!==this.model.get("operator")){if(this._hasList())return;this._listView=new g({className:"CDB-Dropdown-options CDB-Text CDB-Size-medium",collection:this.collection,showSearch:!0,typeLabel:this.options.keyAttr}),this.$(".js-list").html(this._listView.render().el)}else this._destroyList(),this.$(".js-list").html(i())},_destroyList:function(){this._hasList()&&(this.removeView(this._listView),this._listView.clean(),delete this._listView)},_onModelChange:function(){this.model.isValidOperator()&&this.trigger("change",this.model.toJSON(),this)},_onOperationChange:function(a){var b=f(a.target),c=b.val();"count"===c&&(this.model.set("attribute",""),this.collection.removeSelected()),this.model.set("operator",c),this._renderList()},_onAttributeSelected:function(a){a.get("selected")&&this.model.set("attribute",a.getValue())},_toggleVisibility:function(){this.$el.toggleClass("is-visible",!!this.model.get("visible"))},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},remove:function(){this._destroyList(),this.$el.empty(),d.prototype.remove.call(this)}})},{"../../../custom-list/custom-view":59,"./operators-list-count.tpl":180,"./operators-list-model":181,"./operators-list.tpl":183,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],183:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Editor-dropdownCalculations CDB-Text is-semibold">\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="count" ',"count"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.count"))?"":_.escape(__t))+'</label>\n  </li>\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="sum" ',"sum"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.sum"))?"":_.escape(__t))+'</label>\n  </li>\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="avg" ',"avg"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.avg"))?"":_.escape(__t))+'</label>\n  </li>\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="max" ',"max"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.max"))?"":_.escape(__t))+'</label>\n  </li>\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="min" ',"min"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.min"))?"":_.escape(__t))+'</label>\n  </li>\n</ul>\n<div class="js-list"></div>\n';return __p}},{underscore:"underscore"}],184:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("underscore"),g=a("jquery"),h=a("./operators-list-view"),i=a("./operators-list-collection"),j=a("./operators.tpl"),k=13,l=a("../../../popup-manager");d.Form.editors.Operators=d.Form.editors.Base.extend({tagName:"div",className:"Editor-formSelect u-ellipsis",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.collection=new i(this.options.options),this.dialogMode=this.options.dialogMode||"nested",this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},_initViews:function(){var a=this.model.get(this.options.keyAttr);this.$el.append(g("<div>").addClass("js-operator")),this._setOperatorTemplate(),this._operatorsListView=new h({operator:a.operator,attribute:a.attribute,collection:this.collection}),this._operatorsListView.bind("change",this._onOperatorsChange,this),this._popupManager=new l(this.cid,this.$el,this._operatorsListView.$el),this._popupManager.append(this.dialogMode),this.options.disabled&&this.undelegateEvents()},_setOperatorTemplate:function(){this.$(".js-operator").html(j({name:this._getOperatorsTextValue(),disabled:this.options.disabled,keyAttr:this.options.keyAttr}))},_initBinds:function(){var a=function(){this._operatorsListView.hide(),this._popupManager.untrack()}.bind(this);this.applyESCBind(a),this.applyClickOutsideBind(a)},_onOperatorsChange:function(a){this.model.set(this.options.keyAttr,a),this._setOperatorTemplate(),this.$(".js-button").focus(),this.trigger("change",this)},_getOperatorsTextValue:function(){var a=this.model.get(this.options.keyAttr);return a&&a.operator?a.operator.toUpperCase()+(a.attribute?"("+a.attribute+")":""):""},_onButtonClick:function(a){this._operatorsListView.toggle(),this._operatorsListView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function(a){a.which===k&&(a.preventDefault(),this._operatorsListView.isVisible()?this._popupManager.untrack():(a.stopPropagation(),this._operatorsListView.toggle(),this._popupManager.track()))},getValue:function(){var a=this.model.get(this.options.keyAttr);return f.omit(a,"visible")},setValue:function(a){var b=this._getOperatorsTextValue();this.value=b,this._setOperatorTemplate()},remove:function(){this._popupManager&&this._popupManager.destroy(),this._operatorsListView&&this._operatorsListView.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../popup-manager":522,"../editor-helpers-extend":92,"./operators-list-collection":179,"./operators-list-view":182,"./operators.tpl":185,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],185:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-InputText CDB-Text is-cursor js-button u-ellipsis\n  ',disabled&&(__p+=" is-disabled "),__p+="\n  ",name||(__p+=" is-empty "),__p+='"\n  tabindex="0">\n  '+(null==(__t=name||_t("components.backbone-forms.select.placeholder",{keyAttr:keyAttr}))?"":_.escape(__t))+"\n</div>\n";return __p}},{underscore:"underscore"}],186:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("./radio.tpl"),g=a("underscore"),h=a("jquery"),i=a("../../../tipsy-tooltip-view");d.Form.editors.Radio=d.Form.editors.Radio.extend({className:"CDB-Text CDB-Size-medium u-flex u-alignCenter",initialize:function(a){d.Form.editors.Base.prototype.initialize.apply(this,arguments),e.setOptions(this,a)},render:function(){return this.setOptions(this.schema.options),this._setHelp(),this},_setHelp:function(){var a=g.find(this.schema.options,function(a){return a.help});a&&(this._helpTooltip=this._createTooltip({$el:this.$(".js-help")}))},_createTooltip:function(a){return new i({el:a.$el||this.$el,gravity:a.gravity||"s",className:a.className||"",offset:a.offset||0,title:function(){return a.msg||h(this).data("tooltip")}})},getValue:function(){var a=this.$("input[type=radio]:checked").val();return""===a?null:a},_arrayToHtml:function(a){var b=this.form.model.get(this.key),c=g.map(a,function(a,c){var d=a.val,e={name:this.getName(),value:null===d?"":d.toString(),help:a.help,id:this.id,label:a.label,className:a.className};return b===d?e.selected=!0:e.disabled=a.disabled,e},this);return f({items:c})},remove:function(){this._helpTooltip&&this._helpTooltip.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../tipsy-tooltip-view":589,"../editor-helpers-extend":92,"./radio.tpl":187,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],187:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",_.each(items,function(a,b){__p+='\n  <li class="u-flex u-alignCenter '+(null==(__t=b===items.length-1?"":"u-rSpace--xl")?"":_.escape(__t))+'">\n    <input type="radio" class="CDB-Radio u-iBlock',a.className&&(__p+=" "+(null==(__t=a.className)?"":_.escape(__t))+" "),__p+='"\n    name="'+(null==(__t=a.name)?"":_.escape(__t))+'" value="'+(null==(__t=a.value)?"":_.escape(__t))+'" id="'+(null==(__t=a.id)?"":_.escape(__t))+'" \n        ',a.selected?__p+='\n          checked="checked"\n        ':a.disabled&&(__p+='\n          disabled="disabled"\n        '),__p+='\n      />\n    <span class="u-rSpace CDB-Radio-face"></span>\n      ',a.help&&(__p+='\n        <span class="js-help is-underlined u-lSpace" data-tooltip="'+(null==(__t=a.help)?"":_.escape(__t))+'">\n      '),__p+="\n      "+(null==(__t=a.label)?"":_.escape(__t))+"\n      ",a.help&&(__p+="\n        </span>\n      "),__p+="\n  </li>\n"}),__p+="\n";return __p}},{underscore:"underscore"}],188:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("underscore"),g=a("../../../custom-list/custom-view"),h=a("../../../custom-list/custom-list-multi-collection"),i=a("./select-item.tpl"),j=a("../../../custom-list/custom-list-multi-item-view"),k=a("../../../custom-list/custom-list-item-with-checkbox.tpl"),l=a("./select.tpl"),m=a("../../../popup-manager"),n=13;d.Form.editors.MultiSelect=d.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},options:{selectedItemTemplate:i,itemListTemplate:k,customListItemView:j},initialize:function(a){e.setOptions(this,a),this.collection=new h(a.schema.options),this.dialogMode=this.options.dialogMode||"nested",this._initViews(),this.setValue(this.model.get(a.key)),d.Form.editors.Base.prototype.initialize.call(this,a),this._initBinds()},_getLabel:function(){var a=f.compact(this.collection.pluck("selected")).length;return _t("components.backbone-forms.select.selected",{count:a})},_initViews:function(){var a=this.options.loading,b=!this.collection.length,c=!!b||this.options.disabled,d=this._getLabel(),e=null===d,f=e?"null":d;this.$el.html(l({label:f,keyAttr:this.options.keyAttr,isDisabled:c,isLoading:a,isEmpty:b,isNull:e,placeholder:null})),c&&this.undelegateEvents(),this._listView=new g({collection:this.collection,showSearch:this.options.showSearch,typeLabel:this.options.keyAttr,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,searchPlaceholder:null}),this._listView.bind("hidden",this._onHide,this),this._popupManager=new m(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_initBinds:function(){var a=function(){this._listView.hide(),this._popupManager.untrack()}.bind(this);this.collection.bind("change:selected",this._onItemSelected,this),this.applyESCBind(a),this.applyClickOutsideBind(a)},_onItemSelected:function(a){
this._renderButton(a).focus(),this.trigger("change",this)},_onButtonClick:function(a){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function(a){a.which===n&&(a.preventDefault(),this._listView.isVisible()?this._popupManager.untrack():(a.stopPropagation(),this._listView.toggle(),this._popupManager.track()))},_getSelectedValues:function(){return this.collection.chain().map(function(a){return a.get("selected")?a.get("val"):null}).compact().value()},getValue:function(){var a=this._getSelectedValues();if(a.length>0)return a},setValue:function(a){if(a){var b=this.collection.setSelected(a);b&&this._renderButton(b)}},_renderButton:function(a){var b=this.$(".js-button"),c=f.extend({},a.attributes,{label:this._getLabel()}),d=this.options.selectedItemTemplate(c);return b.removeClass("is-empty").html(d),b},_onHide:function(){this._getSelectedValues().length>0&&this.trigger("change",this)},remove:function(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../custom-list/custom-list-item-with-checkbox.tpl":51,"../../../custom-list/custom-list-multi-collection":53,"../../../custom-list/custom-list-multi-item-view":54,"../../../custom-list/custom-view":59,"../../../popup-manager":522,"../editor-helpers-extend":92,"./select-item.tpl":189,"./select.tpl":194,backbone:"backbone",underscore:"underscore"}],189:[function(a,b,c){arguments[4][72][0].apply(c,arguments)},{dup:72,underscore:"underscore"}],190:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink\n  ',isSelected&&(__p+=" is-selected "),__p+=" ",__p+=isDestructive?"  u-alertTextColor ":" u-actionTextColor ",__p+='"\n  title="'+(null==(__t=nodeTitle)?"":_.escape(__t))+" - "+(null==(__t=layerName)?"":_.escape(__t))+'">\n  <div class="u-flex">\n    <span class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase" style="background-color: '+(null==(__t=color)?"":_.escape(__t))+';">'+(null==(__t=layer_id)?"":_.escape(__t))+'</span>\n    <p class="CDB-Text CDB-Size-medium u-ellipsis u-flex">\n      '+(null==(__t=nodeTitle)?"":_.escape(__t))+' <span class="u-altTextColor u-lSpace u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</span>\n    </p>\n  </div>\n</button>\n";return __p}},{underscore:"underscore"}],191:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore");b.exports=d.extend({options:{template:a("./select-layer-list-item.tpl")},className:"CDB-ListDecoration-item CustomList-item js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.options.template(e.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDestructive:this.model.get("destructive"),layerName:this.model.get("layerName"),nodeTitle:this.model.get("nodeTitle"),color:this.model.get("color"),layer_id:this.model.get("layer_id")}))),this.$el.attr("data-val",this.model.getValue()),this},_onMouseLeave:function(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function(){this.$el.addClass("is-highlighted")},_onClick:function(a){a.stopPropagation(),this.model.set("selected",!0)}})},{"./select-layer-list-item.tpl":192,"backbone/core-view":1127,underscore:"underscore"}],192:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex">\n  <span class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase" style="background-color: '+(null==(__t=color)?"":_.escape(__t))+';">'+(null==(__t=layer_id)?"":_.escape(__t))+'</span>\n  <p class="CDB-Text CDB-Size-medium u-ellipsis u-flex" title="'+(null==(__t=nodeTitle)?"":_.escape(__t))+" - "+(null==(__t=layerName)?"":_.escape(__t))+'">\n    '+(null==(__t=nodeTitle)?"":_.escape(__t))+' <span class="u-altTextColor u-lSpace u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</span>\n  </p>\n</div>\n";return __p}},{underscore:"underscore"}],193:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("underscore"),g=a("../../../custom-list/custom-view"),h=a("../../../custom-list/custom-list-collection"),i=a("./select-item.tpl"),j=a("../../../custom-list/custom-list-item-view"),k=a("../../../custom-list/custom-list-item.tpl"),l=a("./select.tpl"),m=a("../../../popup-manager"),n=13;d.Form.editors.Select=d.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},options:{selectedItemTemplate:i,itemListTemplate:k,customListItemView:j},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.template=a.template||l,this.dialogMode=this.options.dialogMode||"nested",this.collection=new h(this.options.options),this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},_initViews:function(){var a=this.options.loading,b=!this.collection.length,c=!!b||this.options.disabled,d=this.model.get(this.options.keyAttr),e=null===d,f=e?"null":d,h=this.options.placeholder,i=this.options.keyAttr;this.$el.html(this.template({label:f,keyAttr:this.options.keyAttr,placeholder:h,isDisabled:c,isLoading:a,isEmpty:b,isNull:e})),c&&this.undelegateEvents(),this._listView=new g({collection:this.collection,showSearch:this.options.showSearch,allowFreeTextInput:this.options.allowFreeTextInput,typeLabel:i,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,position:this.options.position,searchPlaceholder:this.options.searchPlaceholder}),this._popupManager=new m(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_initBinds:function(){var a=function(){this._listView.hide(),this._popupManager.untrack()}.bind(this);this.collection.bind("change:selected",this._onItemSelected,this),this.applyESCBind(a),this.applyClickOutsideBind(a)},_onItemSelected:function(a){this._listView.hide(),this._popupManager.untrack(),this._renderButton(a).focus(),this.trigger("change",this)},_onButtonClick:function(a){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function(a){a.which===n&&(a.preventDefault(),this._listView.isVisible()?this._popupManager.track():(a.stopPropagation(),this._listView.toggle()))},getValue:function(){var a=this.collection.getSelectedItem();if(a)return a.getValue()},setValue:function(a){var b=this.collection.setSelected(a);b&&this._renderButton(b),this.value=a},_renderButton:function(a){var b=this.$(".js-button"),c=f.extend({},{label:a.getName()},a.attributes),d=this.options.selectedItemTemplate(c);return b.removeClass("is-empty").html(d),b},remove:function(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../custom-list/custom-list-collection":47,"../../../custom-list/custom-list-item-view":50,"../../../custom-list/custom-list-item.tpl":52,"../../../custom-list/custom-view":59,"../../../popup-manager":522,"../editor-helpers-extend":92,"./select-item.tpl":189,"./select.tpl":194,backbone:"backbone",underscore:"underscore"}],194:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-InputText CDB-Text is-cursor js-button u-ellipsis\n  ',isDisabled&&(__p+=" is-disabled "),__p+="\n  ",label||(__p+=" is-empty "),__p+="\n  ",isNull&&(__p+=" is-empty "),__p+='"\n  tabindex="0">\n  ',isLoading?__p+='\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n      <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n    </div>\n  ":(__p+="\n    ",__p+=isEmpty?"\n      "+(null==(__t=_t("components.backbone-forms.select.empty"))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=placeholder||label||_t("components.backbone-forms.select.placeholder",{keyAttr:keyAttr}))?"":_.escape(__t))+"\n    ",__p+="\n  "),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],195:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("underscore"),g=a("../../../custom-list/custom-view"),h=a("../../../custom-list/custom-list-collection"),i=a("./select-item.tpl"),j=a("../../../custom-list/custom-list-item-view"),k=a("../../../custom-list/custom-list-item.tpl"),l=a("./select.tpl"),m=a("../../../popup-manager"),n=13;d.Form.editors.Suggest=d.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},options:{selectedItemTemplate:i,itemListTemplate:k,customListItemView:j},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.template=a.template||l,this.dialogMode=this.options.dialogMode||"nested",this._setupCollection(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},render:function(){return this.setValue(this.value),this},_setupCollection:function(){if(this.collection=new h(this.options.options),this.options.editorAttrs&&this.options.editorAttrs.collectionData){var a=f.map(this.options.editorAttrs.collectionData,function(a){return{label:a,val:a}});this.collection.reset(a)}},_initViews:function(){var a=this.options.loading,b=!this.collection.length,c=!!b||this.options.disabled,d=this.model.get(this.options.keyAttr),e=null===d,f=e?"null":d;this.$el.html(this.template({label:f,keyAttr:this.options.keyAttr,isDisabled:c,isLoading:a,isEmpty:b,isNull:e,placeholder:null})),c&&this.undelegateEvents(),this._listView=new g({collection:this.collection,showSearch:this.options.showSearch,allowFreeTextInput:this.options.allowFreeTextInput,typeLabel:this.options.keyAttr,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,position:this.options.position,searchPlaceholder:null}),this._popupManager=new m(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_initBinds:function(){var a=function(){this._listView.hide(),this._popupManager.untrack()}.bind(this);this.collection.bind("change:selected",this._onItemSelected,this),this.collection.bind("reset",this.render,this),this.applyESCBind(a),this.applyClickOutsideBind(a)},_onItemSelected:function(a){this._listView.hide(),this._popupManager.untrack(),this._renderButton(a).focus(),this.trigger("change",this)},_onButtonClick:function(a){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function(a){a.which===n&&(a.preventDefault(),this._listView.isVisible()?this._popupManager.untrack():(a.stopPropagation(),this._listView.toggle(),this._popupManager.track()))},getValue:function(){var a=this.collection.getSelectedItem();if(a)return a.getValue()},setValue:function(a){var b=this.collection.setSelected(a);b||(this.collection.add({label:a,val:a}),b=this.collection.setSelected(a)),this._initViews(),this._renderButton(b),this.value=a},_renderButton:function(a){var b=this.$(".js-button"),c=a.getName(),d=null===c||"null"===c,e=d?"null":c,g=f.extend({},a.attributes,{label:e}),h=this.options.selectedItemTemplate(g);return b.html(h).toggleClass("is-empty",d),b},remove:function(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),d.Form.editors.Base.prototype.remove.call(this)},clean:function(){this._popupManager&&this._popupManager.destroy()}})},{"../../../custom-list/custom-list-collection":47,"../../../custom-list/custom-list-item-view":50,"../../../custom-list/custom-list-item.tpl":52,"../../../custom-list/custom-view":59,"../../../popup-manager":522,"../editor-helpers-extend":92,"./select-item.tpl":189,"./select.tpl":194,backbone:"backbone",underscore:"underscore"}],196:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("../editor-helpers-extend"),h=a("./slider.tpl");a("jquery"),a("jquery-ui"),f.Form.editors.Slider=f.Form.editors.Base.extend({tagName:"ul",className:"CDB-OptionInput-container CDB-OptionInput-container--noMargin",options:{direction:""},events:{focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(a){if(f.Form.editors.Base.prototype.initialize.call(this,a),g.setOptions(this,a),!this.options.labels)throw new Error("labels is required");if(this.options.values&&this.options.labels.length!==this.options.values.length)throw new Error("values and labels should have the same length");this._values=this.options.values,this._labels=this.options.labels,this._initViews()},_initViews:function(){this.$el.html(h({direction:this.options.direction}));var a=this._getStepPercentage();this._ticks=this._getTicks(a);var b=this._getInitialTickID();this.$(".js-slider").slider({range:"min",value:this._ticks[b],step:a,orientation:"horizontal",disabled:this.options.disabled,slide:this._onSlideChange.bind(this),stop:this._onSlideStop.bind(this)}),this._addTicks(a),this._updateUI(b)},_getInitialTickID:function(){var a=this.value;return this._values?(a=this._values.indexOf(this.value),a===-1&&(a=0)):a||(a=0),a},_updateUI:function(a){void 0===a&&(a=0),this._updateLabel(a),this._highlightTick(a)},_getTickID:function(){var a=0;return this.value&&e.isNumber(this.value)&&(a=this._calculateTickValue(this.value)),this._ticks.indexOf(a)},_addTicks:function(a){e.each(this._ticks,function(a){d('<div class="UISlider-tick js-tick"></div>').css("left",a+"%").appendTo(this.$(".js-slider"))},this)},_highlightTick:function(a){this.$(".js-tick").removeClass("is-highlighted"),d(this.$(".js-tick").get(a)).addClass("is-highlighted")},_updateLabel:function(a){this.$(".js-label").text(this._labels[a])},_getTicks:function(a){var b=this;return[0].concat(e(this._labels.length-1).times(function(c){return b._calculateTickValue(a*(c+1))}))},_getStepPercentage:function(){return 100/(this._labels.length-1)},_calculateTickValue:function(a){return+a.toFixed(2)},_onSlideChange:function(a,b){this.value=b.value,this._updateUI(this._getTickID())},_onSlideStop:function(a,b){this.trigger("change",this)},_hasSlider:function(){return this.$(".js-slider").data("ui-slider")},getValue:function(){var a=this._values?this._values[this._getTickID()]:this._getTickID();return""===this.value?null:a},setValue:function(a){this.$(".js-slider").slider("value",a),this.value=a},_destroySlider:function(){this._hasSlider()&&this.$(".js-slider").slider("destroy")},remove:function(){this._destroySlider(),f.Form.editors.Base.prototype.remove.apply(this)},clean:function(){this.$el.remove()}})},{"../editor-helpers-extend":92,"./slider.tpl":197,backbone:"backbone",jquery:"jquery","jquery-ui":1128,underscore:"underscore"}],197:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li class="CDB-OptionInput-item CDB-OptionInput-item--noSeparator">\n  ',"desc"===direction?__p+='\n  <svg class="UISlider-scale" width="160px" height="7px" viewBox="0 0 160 7" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n      <g fill="#EEEEEE">\n        <path d="M0,3.96972188 C0,2.86143684 0.899814069,1.95171147 1.99402962,1.93799103 L158.00597,-0.0182528125 C159.107243,-0.0320617354 160,0.846465216 160,1.95103649 L160,4.98745286 C160,6.08887023 159.100186,6.96483876 158.00597,6.94427947 L1.99402962,4.012961 C0.89275747,3.99226913 0,3.08692473 0,1.96876746 L0,3.96972188 Z" id="Mask" transform="translate(80.000000, 3.458568) scale(-1, 1) translate(-80.000000, -3.458568) "></path>\n      </g>\n    </g>\n  </svg>\n  ':"asc"===direction&&(__p+='\n  <svg class="UISlider-scale" width="160px" height="7px" viewBox="0 0 160 7" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n      <g transform="translate(80.000000, 4.000000) rotate(-180.000000) translate(-80.000000, -4.000000) " fill-rule="nonzero" fill="#EEEEEE">\n        <path d="M0,4.96972188 C0,3.86143684 0.899814069,2.95171147 1.99402962,2.93799103 L158.00597,0.981747188 C159.107243,0.967938265 160,1.84646522 160,2.95103649 L160,5.98745286 C160,7.08887023 159.100186,7.96483876 158.00597,7.94427947 L1.99402962,5.012961 C0.89275747,4.99226913 0,4.08692473 0,2.96876746 L0,4.96972188 Z" id="Mask" transform="translate(80.000000, 4.463110) scale(-1, 1) translate(-80.000000, -4.463110) "></path>\n      </g>\n    </g>\n  </svg>\n  '),__p+='\n  <div class="UISlider is-standalone ',direction&&(__p+="without-line"),__p+=' js-slider"></div>\n  <span class="UISlider-label js-label"></span>\n</li>\n';return __p}},{underscore:"underscore"}],198:[function(a,b,c){var d=a("backbone"),e=a("underscore");a("jquery-ui"),d.Form.editors.SortableList=d.Form.editors.List.extend({initialize:function(){d.Form.editors.List.prototype.initialize.apply(this,arguments)},render:function(){return d.Form.editors.List.prototype.render.apply(this,arguments),this._initSortable(),this},_initSortable:function(){this.$list.sortable({axis:"y",items:".js-sortable",tolerance:"pointer",containment:this.$list,forceHelperSize:!0,forcePlaceholderSize:!0,update:this._onSortableUpdate.bind(this)})},_onSortableUpdate:function(a,b){var c=[];e.each(this.items,function(a){var b=a.$el.index(this.$list);c[b]=a}),this.items=c,this.commit()}})},{backbone:"backbone","jquery-ui":1128,underscore:"underscore"}],199:[function(a,b,c){var d=a("backbone");b.exports=d.Collection.extend({removeTag:function(a){var b=this.findWhere({label:a});b&&this.remove(b)},addTag:function(a){var b=this.findWhere({label:a});!b&&this.add({label:a})},getValue:function(){return this.map(function(a){return a.get("label")})}})},{backbone:"backbone"}],200:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({tagName:"li",initialize:function(a){if(!a.label)throw new Error("label is required");this._label=a.label},render:function(){return this.clearSubViews(),this.$el.html(this._label),this}})},{"backbone/core-view":1127}],201:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./taglist.tpl"),g=a("./taglist-item-view"),h=a("./taglist-collection"),i=a("../editor-helpers-extend");a("jquery"),a("jquery-ui"),a("tagit"),e.Form.editors.Taglist=e.Form.editors.Base.extend({className:"Form-tags CDB-Text",events:{mouseover:"_onMouseOver",mouseout:"_onMouseOut"},initialize:function(a){e.Form.editors.Base.prototype.initialize.call(this,a),i.setOptions(this,a),this._tagCollection=new h(this._normalize(a.schema.options.tags)),this.isEditable=a.schema.options.isEditable||void 0===a.schema.options.isEditable},render:function(){return this._initViews(),this},_initViews:function(){var a=this,b=this.isEditable||0!==this._tagCollection.length?_t("components.taglist.placeholder"):_t("components.taglist.none");this.$el.html(f()),this._tagCollection.each(this._renderTag,this),this.$(".js-tagsList").tagit({allowSpaces:!0,caseSensitive:!1,placeholderText:b,readOnly:!this.isEditable,onBlur:function(){a.isEditable&&a.$el.removeClass("is-focus"),a.trigger("blur",a)},onFocus:function(){a.isEditable&&a.$el.removeClass("is-hover").addClass("is-focus"),a.trigger("focus",a)},afterTagAdded:a._onTagAdded.bind(a),afterTagRemoved:a._onTagRemoved.bind(a)})},_renderTag:function(a){var b=new g({label:a.get("label")});this.$(".js-tagsList").append(b.render().el)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},getValue:function(){return this._tagCollection.getValue()},setValue:function(a){this._tagCollection.reset(this._normalize(a)),this._destroyTagit(),this.render(),this.trigger("change",this)},_onMouseOver:function(){!this.$el.hasClass("is-focus")&&this.$el.addClass("is-hover")},_onMouseOut:function(){!this.$el.hasClass("is-focus")&&this.$el.removeClass("is-hover")},_onTagRemoved:function(a,b){var c=b.tag.find(".tagit-label").text();this._tagCollection.removeTag(c),this.trigger("change",this)},_onTagAdded:function(a,b){var c=b.tag.find(".tagit-label").text();this._tagCollection.addTag(c),this.trigger("change",this)},_normalize:function(a){return d.map(a,function(a){return{label:a.trim()}})},_destroyTagit:function(){this.$(".ui-widget").length>0&&this.$(".js-tagsList").tagit("destroy")},remove:function(){this._destroyTagit(),e.Form.editors.Base.prototype.remove.apply(this)},clean:function(){this.$el.remove()}})},{"../editor-helpers-extend":92,"./taglist-collection":199,"./taglist-item-view":200,"./taglist.tpl":202,backbone:"backbone",jquery:"jquery","jquery-ui":1128,tagit:1138,underscore:"underscore"}],202:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Form-tagsList js-tagsList"></ul>';return __p}},{underscore:"underscore"}],203:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./editor-helpers-extend");e.Form.editors.Text=e.Form.editors.Text.extend({className:"CDB-InputText CDB-Text",initialize:function(a){e.Form.editors.Base.prototype.initialize.call(this,a),f.setOptions(this,a);var b=this.schema,c="text";b&&b.editorAttrs&&b.editorAttrs.type&&(c=b.editorAttrs.type),b&&b.dataType&&(c=b.dataType),this.$el.attr("type",c),this.determineChange=d.debounce(this.determineChange,200)},render:function(){return this.setValue(this.value),this._toggleDisableState(),this._isCopyButtonEnabled()&&this._toggleClipboardState(),this},getValue:function(){var a=this.$el.val();return""===a?null:a},_toggleClipboardState:function(){this.$el.toggleClass("Share-input-field u-ellipsis",this._isCopyButtonEnabled())},_togglePlaceholder:function(){if(this.options.placeholder)this.$el.attr("placeholder",this.options.placeholder);else{var a=null===this.value?"null":"";this.$el.attr("placeholder",a)}},_toggleDisableState:function(){this.options.disabled?(this.$el.attr("readonly",""),this.$el.attr("placeholder",""),this._isCopyButtonEnabled()&&this.$el.removeAttr("disabled")):(this.$el.removeAttr("readonly"),this._togglePlaceholder()),this.$el.toggleClass("is-disabled",!!this.options.disabled)},_isCopyButtonEnabled:function(){return!!this.options.hasCopyButton}})},{"./editor-helpers-extend":92,backbone:"backbone",underscore:"underscore"}],204:[function(a,b,c){var d=a("backbone");d.Form.editors.TextArea=d.Form.editors.Text.extend({tagName:"textarea",className:"CDB-Textarea",render:function(){return this.setValue(this.value),this._toggleDisableState(),this},getValue:function(){var a=this.$el.val();return""===a?null:a},_toggleDisableState:function(){this.options.disabled?(this.$el.attr("readonly",""),this.$el.attr("placeholder","")):(this.$el.removeAttr("readonly"),this._togglePlaceholder()),this.$el.toggleClass("is-disabled",!!this.options.disabled)}})},{backbone:"backbone"}],205:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./toggle.tpl");e.Form.editors.Toggle=e.Form.editors.Radio.extend({className:"Editor-formLabel CDB-Text CDB-Size-medium u-alignCenter",_arrayToHtml:function(a){var b=this.getName(),c=this.id,e=d.map(a,function(a,e){var f=this.form.model.get(this.key),g={name:b,id:c+"-"+e};return d.isObject(a)?(g.value=a.val||0===a.val?a.val:"",g.label=a.label,g.help=a.help,g.labelHTML=a.labelHTML,g.selected=void 0!==f?f===a.val:a.selected):(g.value=a,g.label=a,g.selected=void 0!==f?f===a:a.selected),g}.bind(this));return f({items:e})}})},{"./toggle.tpl":206,backbone:"backbone",underscore:"underscore"}],206:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",_.each(items,function(a,b){__p+="\n  ",a.selected?(__p+='\n    <li class="u-tSpace">\n      <input type="radio" class="Editor-toggleRadio" name="'+(null==(__t=a.name)?"":__t)+'" value="'+(null==(__t=a.value)?"":_.escape(__t))+'" id="'+(null==(__t=a.id)?"":__t)+'" checked="checked" />\n      ',a.help&&(__p+='<p class="Editor-toggleHelp CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=a.help)?"":__t)+"</p>"),__p+="\n    </li>\n  "):(__p+='\n    <li class="u-tSpace u-txt-right">\n      <input type="radio" name="'+(null==(__t=a.name)?"":__t)+'" value="'+(null==(__t=a.value)?"":_.escape(__t))+'" id="'+(null==(__t=a.id)?"":__t)+'" />\n      <label class="u-upperCase u-actionTextColor CDB-Text is-semibold CDB-Size-small u-iBlock" for="'+(null==(__t=a.id)?"":__t)+'">',__p+=a.labelHTML?""+(null==(__t=a.labelHTML)?"":__t):""+(null==(__t=a.label)?"":_.escape(__t)),__p+="</label>\n    </li>\n  "),__p+="\n"}),__p+="\n";return __p}},{underscore:"underscore"}],207:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("jquery"),g=a("../tipsy-tooltip-view.js"),h=a("clipboard");d.Form.Field=d.Form.Field.extend({initialize:function(a){this.trackingClass=a.trackingClass,this.constructor.__super__.initialize.apply(this,arguments)},render:function(){return this.constructor.__super__.render.apply(this,arguments),this.schema.help&&this._setHelp(),this._isCopyButtonEnabled()&&this._initClipboard(),this},createSchema:function(a){var b=a.type;return a=this.constructor.__super__.createSchema.apply(this,arguments),a.editorType=b,a},createEditor:function(){var a=e.extend(e.pick(this,"schema","form","key","model","value","trackingClass"),{id:this.createEditorId()}),b=this.schema.type;return new b(a)},_setHelp:function(){this._helpTooltip=this._createTooltip({$el:this.$(".js-help")})},setError:function(a){this.editor.hasNestedForm||(this.$el.addClass(this.errorClassName),this._destroyErrorTooltip(),this._errorTooltip=this._createTooltip({gravity:"w",className:"is-error",msg:a,offset:5}),this._errorTooltip.showTipsy())},clearError:function(){this.$el.removeClass(this.errorClassName),this._destroyErrorTooltip()},_initClipboard:function(){this._clipboard&&this._clipboard.destroy();var a=this.$(".js-copy");this._clipboard=new h(a.get(0))},_createTooltip:function(a){return new g({el:a.$el||this.$el,gravity:a.gravity||"s",className:a.className||"",offset:a.offset||0,title:function(){return a.msg||f(this).data("tooltip")}})},_destroyErrorTooltip:function(){this._errorTooltip&&(this._errorTooltip.hideTipsy(),this._errorTooltip.destroyTipsy())},_destroyHelpTooltip:function(){this._helpTooltip&&this._helpTooltip.destroyTipsy()},_destroyClipboard:function(){this._clipboard&&this._clipboard.destroy()},templateData:function(){var a,b=this.schema;try{a=this.form.schema[this.key].type}catch(b){a=void 0}return{help:b.help||"",isCopyButtonEnabled:this._isCopyButtonEnabled(),hasNestedForm:this.editor.hasNestedForm,title:b.title,fieldAttrs:b.fieldAttrs,editorAttrs:b.editorAttrs,key:this.key,type:a,editorId:this.editor.id,editorType:this.editor.el.type}},_isCopyButtonEnabled:function(){return!!this.schema.hasCopyButton},remove:function(){this._destroyErrorTooltip(),this._destroyHelpTooltip(),this._destroyClipboard(),this.editor.remove(),d.View.prototype.remove.call(this)}},{template:a("./field.tpl"),errorClassName:"CDB-FieldError"})},{"../tipsy-tooltip-view.js":589,"./field.tpl":208,backbone:"backbone",clipboard:"clipboard",jquery:"jquery",underscore:"underscore"}],208:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Text Editor-formInner',type&&(__p+=" Editor-formInner--"+(null==(__t=type)?"":_.escape(__t))),__p+='">\n  ',title&&(__p+='\n    <label class="CDB-Legend ',editorType&&(__p+=" CDB-Legend--"+(null==(__t=editorType)?"":_.escape(__t))),__p+=' u-upperCase CDB-Text is-semibold CDB-Size-small u-rSpace--m" for="'+(null==(__t=editorId)?"":_.escape(__t))+'" title="'+(null==(__t=title)?"":_.escape(__t))+'">\n      <div class="u-ellipsis ',help&&(__p+="Editor-formHelp"),__p+='">\n        <span class="',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+=" >"+(null==(__t=title)?"":_.escape(__t))+"</span>\n      </div>\n    </label>\n  "),__p+='\n  <div class="Editor-formInput u-flex u-alignCenter" data-editor>\n    ',isCopyButtonEnabled&&(__p+='\n      <button type="button" class="Share-copy CDB-Button CDB-Button--small js-copy" data-clipboard-target="#'+(null==(__t=editorId)?"":_.escape(__t))+'">\n        <span class="CDB-Button-Text CDB-Text CDB-Size-small u-actionTextColor">'+(null==(__t=_t("components.backbone-forms.copy-button"))?"":_.escape(__t))+"</span>\n      </button>\n    "),__p+="\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],209:[function(a,b,c){var d=a("backbone"),e=a("underscore");d.Form.Fieldset.template=e.template('  <div class="Editor-fieldset" data-fields>    <% if (legend) { %>      <legend><%= legend %></legend>    <% } %>  </div>')},{backbone:"backbone",underscore:"underscore"}],210:[function(a,b,c){var d=a("backbone");d.Form=d.Form.extend({initialize:function(a){this.options=a,this.constructor.__super__.initialize.apply(this,arguments)},createField:function(a,b){var c={form:this,key:a,schema:b,idPrefix:this.idPrefix,trackingClass:this.options.trackingClass};this.model?c.model=this.model:this.data?c.value=this.data[a]:c.value=void 0;var d=new this.Field(c);return this.listenTo(d.editor,"all",this.handleEditorEvent),d}})},{backbone:"backbone"}],211:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone");a("backbone-forms"),f.$=d,e.extend(f.Form.validators,{interval:a("./validators/interval.js")}),a("./form.js"),a("./fieldset-template.js"),a("./field.js"),a("./editors/base.js"),a("./editors/text.js"),a("./editors/textarea.js"),a("./editors/number/number.js"),a("./editors/select/select-view.js"),a("./editors/select/multi-select-view.js"),a("./editors/radio/radio.js"),a("./editors/enabler/enabler-view.js"),a("./editors/toggle/toggle.js"),a("./editors/enabler-editor/enabler-editor-view.js"),a("./editors/node-dataset/node-dataset-view.js"),a("./editors/operators/operators-view.js"),a("./editors/list/list.js"),a("./editors/list/list-item.js"),a("./editors/sortable-list.js"),a("./editors/legend/category-item.js"),a("./editors/slider/slider.js"),a("./editors/fill/fill.js"),a("./editors/taglist/taglist.js"),a("./editors/datetime/datetime.js"),a("./editors/select/suggest-view.js"),a("./editors/data-observatory/dropdown-view.js"),a("./editors/code-editor")},{"./editors/base.js":69,"./editors/code-editor":70,"./editors/data-observatory/dropdown-view.js":73,"./editors/datetime/datetime.js":90,"./editors/enabler-editor/enabler-editor-view.js":93,"./editors/enabler/enabler-view.js":96,"./editors/fill/fill.js":108,"./editors/legend/category-item.js":170,"./editors/list/list-item.js":171,"./editors/list/list.js":172,"./editors/node-dataset/node-dataset-view.js":176,"./editors/number/number.js":177,"./editors/operators/operators-view.js":184,"./editors/radio/radio.js":186,
"./editors/select/multi-select-view.js":188,"./editors/select/select-view.js":193,"./editors/select/suggest-view.js":195,"./editors/slider/slider.js":196,"./editors/sortable-list.js":198,"./editors/taglist/taglist.js":201,"./editors/text.js":203,"./editors/textarea.js":204,"./editors/toggle/toggle.js":205,"./field.js":207,"./fieldset-template.js":209,"./form.js":210,"./validators/interval.js":212,backbone:"backbone","backbone-forms":"backbone-forms",jquery:"jquery",underscore:"underscore"}],212:[function(a,b,c){b.exports=function(a){var b=parseFloat(a.min)||0,c=parseFloat(a.max)||0,d={type:a.type,message:_t("components.backbone-forms.interval-error",{minValue:a.min,maxValue:a.max})};return function(a,e){var f=0;return null===a||void 0===a||""===a?d:(!isNaN(parseFloat(a))&&isFinite(a)&&(f=parseFloat(a)),b>f||c<f?d:void 0)}}},{}],213:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("../helpers/utils"),g=a("underscore"),h=18,i={width:"18px",height:"18px"},j=g.template("0 0 <%- w %> <%- h %>");b.exports=e.extend({initialize:function(a){if(!a.imageClass)throw new Error("Image class is mandatory.");this._imageClass=a.imageClass,this._imageURL=a.imageUrl,this._color=a.color,this._lastImage={url:null,content:null}},render:function(){return this.$el.empty(),this._loadImage(),this},_loadImage:function(){if(this._imageURL){var a=this;if(this._isSVG(this._imageURL))this._loadSVG();else{var b=d('<img crossorigin="anonymous"/>');b.attr("class",a._imageClass+" js-image"),b.attr("src",this._imageURL+"?req=markup");for(var c in i)b.attr(c,i[c]);this.$el.append(b)}}},_loadSVG:function(){var a=this;this._requestImageURL(this._imageURL,function(b){var c=b.cloneNode(!0),e=d(c);e=e.removeAttr("xmlns:a"),e.attr("class",a._imageClass+" js-image");var f={w:h,h:h};e.attr("viewBox")||(e.attr("height")&&e.attr("width")&&(f={w:c.width.baseVal.value,h:c.height.baseVal.value}),e.attr("viewBox",j(f)));for(var g in i)e.attr(g,i[g]);a.$el.append(e),e.css("fill",a._color),e.find("g").css("fill","inherit"),e.find("path").css("fill","inherit")})},_requestImageURL:function(a,b){var c=this,e=a+"?req=ajax";this._lastImage.url===e?b&&b(this._lastImage.content):d.ajax(e).done(function(a){c._lastImage.url=e;var d=c._lastImage.content=a.getElementsByTagName("svg")[0];b&&b(d)}).fail(function(){throw new Error("Couldn't get "+e+" file.")})},updateImageColor:function(a){this.$(".js-image").css("fill",a)},_isSVG:function(a){if(!a)return!1;var b=a.split("?")[0];return b&&f.endsWith(b.toUpperCase(),"SVG")}})},{"../helpers/utils":1102,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],214:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","primary"===type?(__p+='\n  <button class="CDB-Button CDB-Button--primary CDB-Button--medium ',disabled&&(__p+="is-disabled"),__p+=" js-"+(null==(__t=action)?"":_.escape(__t))+' js-action">\n    <span class="CDB-Button-Text CDB-Text is-semibold u-upperCase CDB-Size-small">'+(null==(__t=label)?"":__t)+"</span>\n  </button>\n"):(__p+='\n  <button class="Infobox-buttonLink u-upperCase ',disabled&&(__p+="is-disabled"),__p+=" js-"+(null==(__t=action)?"":_.escape(__t))+' js-action CDB-Text is-semibold CDB-Size-small">\n    '+(null==(__t=label)?"":__t)+"\n  </button>\n"),__p+="";return __p}},{underscore:"underscore"}],215:[function(a,b,c){var d=a("backbone"),e=a("./infobox-item-model"),f=a("underscore");b.exports=d.Collection.extend({model:e,initialize:function(){this._initBinds()},reset:function(a,b){this._defaultSelected(a),d.Collection.prototype.reset.call(this,a,b)},_initBinds:function(){this.on("change:selected",this._onSelectedChange,this),this.on("reset",this._defaultSelected,this)},_defaultSelected:function(a){var b=f.first(f.where(a,{selected:!0}));b||(b=f.first(a),this._isModel(b)?b.set({selected:!0},{silent:!0}):b.selected=!0)},_onSelectedChange:function(a,b){b&&this.each(function(b){b.cid!==a.cid&&b.set({selected:!1},{silent:!0})})},getState:function(a){return f.first(this.where({state:a}))},getSelected:function(){var a;return a=f.first(this.where({selected:!0}))},setSelected:function(a){var b;return this.each(function(c){c.get("state")===a?(c.set({selected:!0},{silent:!0}),b=c):c.set({selected:!1},{silent:!0})}),b}})},{"./infobox-item-model":217,backbone:"backbone",underscore:"underscore"}],216:[function(a,b,c){var d=a("./infobox-item-view");b.exports={createInfo:function(a){var b=void 0===a.closable||a.closable;return new d({type:a.type||"default",title:a.title,body:a.body,closable:b})},createWithAction:function(a){var b=void 0===a.closable||a.closable,c={type:a.type||"default",title:a.title,body:a.body,closable:b};return a.mainAction&&(c.mainAction={label:a.mainAction.label,type:a.mainAction.type}),a.secondAction&&(c.secondAction={label:a.secondAction.label,type:a.secondAction.type}),new d(c)},createLoading:function(a){return new d({type:a.type||"default",title:a.title||"",body:a.body,loading:!0})},createQuota:function(a){return void 0===a.closable&&(a.closable=!0),new d(a)}}},{"./infobox-item-view":218}],217:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{selected:!1}})},{backbone:"backbone"}],218:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./infobox.tpl"),g=a("./infobox-button.tpl"),h=a("./infobox-quota.tpl"),i={error:"is-error",alert:"is-alert",code:"is-dark",success:"is-success",default:""};b.exports=d.extend({events:{"click .js-mainAction":"_onMainClick","click .js-secondAction":"_onSecondClick","click .js-close":"_onClose"},initialize:function(a){if(void 0===a.title)throw new Error("Title is required");if(void 0===a.body)throw new Error("Body is required");this._title=a.title,this._body=a.body,this._loading=a.loading,this._isClosable=a.closable,a.quota&&(this._quota=a.quota),a.mainAction&&(this._mainLabel=a.mainAction.label,this._mainType=a.mainAction.type,this._mainDisabled=a.mainAction.disabled),a.secondAction&&(this._secondLabel=a.secondAction.label,this._secondType=a.secondAction.type,this._secondDisabled=a.secondAction.disabled),this._type=i[a.type||"default"]},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=this._mainLabel||this._secondLabel,b=!e.isEmpty(this._quota),c=this._loading,d=f({title:this._title,body:this._body,type:this._type,isLoading:c,hasQuota:b,hasButtons:a,isClosable:this._isClosable});if(this.setElement(d),this._mainLabel&&this.$(".js-leftPosition").html(g({action:"mainAction",label:this._mainLabel,type:this._mainType,disabled:this._mainDisabled})),this._secondLabel&&this.$(".js-rightPosition").html(g({action:"secondAction",label:this._secondLabel,type:this._secondType,disabled:this._secondDisabled})),b){var i=this._quota,j=i.usedQuota/i.totalQuota*100;isNaN(j)&&(j=100);var k="fine";j>75&&j<90?k="alert":j>=90&&(k="caution"),this.$(".js-quota").html(h({quotaMessage:i.quotaMessage||"",progressState:k,quotaPer:j}))}},_onMainClick:function(a){this.trigger("action:main")},_onSecondClick:function(a){this.trigger("action:second")},_onClose:function(a){this.trigger("action:close")}})},{"./infobox-button.tpl":214,"./infobox-quota.tpl":220,"./infobox.tpl":222,"backbone/core-view":1127,underscore:"underscore"}],219:[function(a,b,c){var d=a("backbone"),e="";b.exports=d.Model.extend({defaults:{state:e}})},{backbone:"backbone"}],220:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<label class="CDB-Text CDB-Size CDB-Size-small u-secondaryTextColor">'+(null==(__t=quotaMessage)?"":_.escape(__t))+'</label>\n<div class="Infobox-quotaBar Progress u-tSpace">\n  <div class="Infobox-quotaBarProgress Progress-bar Progress-bar--'+(null==(__t=progressState)?"":_.escape(__t))+'"\n    style="width: '+(null==(__t=quotaPer)?"":_.escape(__t))+'%"\n  ></div>\n</div>\n';return __p}},{underscore:"underscore"}],221:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../helpers/required-opts"),f=["infoboxModel","infoboxCollection"];b.exports=d.extend({initialize:function(a){e(a,f,this),this._initBinds(),this._setSelectedModel()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.listenTo(this._infoboxModel,"change:state",this._onChangeState),this.listenTo(this._infoboxModel,"change:visible",this.render)},_initViews:function(){var a;this._selectedModel&&(a=this._selectedModel.get("createContentView"),this.infoboxView=a(),this.$el.append(this.infoboxView.render().el),this.addView(this.infoboxView),this._initSubviewBinds())},_setSelectedModel:function(){var a=this._infoboxModel.get("state");this._selectedModel=this._infoboxCollection.setSelected(a)},_onChangeState:function(){this._setSelectedModel(),this.render()},_initSubviewBinds:function(){this.listenTo(this.infoboxView,"action:main",this._onMainAction),this.listenTo(this.infoboxView,"action:second",this._onSecondAction),this.listenTo(this.infoboxView,"action:close",this._onClose)},_onMainAction:function(){var a=this._selectedModel.get("mainAction");a&&a()},_onSecondAction:function(){var a=this._selectedModel.get("secondAction");a&&a()},_onClose:function(){var a=this._selectedModel.get("closeAction");a?a():this._infoboxModel.set("state",null)}})},{"../../helpers/required-opts":1097,"backbone/core-view":1127}],222:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Infobox '+(null==(__t=type)?"":_.escape(__t))+'">\n  <div class="u-flex u-justifySpace u-alignCenter u-bSpace--m">\n    <h2 class="CDB-Text is-semibold CDB-Size-small u-upperCase">'+(null==(__t=title)?"":_.escape(__t))+"</h2>\n\n    ",isClosable&&(__p+='\n    <button class="CDB-Shape js-close">\n      <div class="CDB-Shape-close is-large js-theme is-blue"></div>\n    </button>\n    '),__p+='\n  </div>\n\n  <div class="CDB-Text CDB-Size-medium u-bSpace--xl u-flex">\n    ',isLoading&&(__p+='\n      <div class="CDB-LoaderIcon is-dark u-rSpace--m">\n        <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n          <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n        </svg>\n      </div>\n    '),__p+="\n    <div>\n      "+(null==(__t=body)?"":__t)+'\n    </div>\n  </div>\n\n  <div class="u-flex u-justifySpace u-alignCenter">\n    ',hasQuota&&(__p+='\n      <div class="Infobox-quota js-quota"></div>\n    '),__p+="\n    ",hasButtons&&(__p+='\n      <ul class="Infobox-buttons ',hasQuota&&(__p+="Infobox-buttons--quota"),__p+='">\n        <li class="Infobox-button js-leftPosition"></li>\n        <li class="Infobox-button Infobox-button--right js-rightPosition"></li>\n      </ul>\n    '),__p+="\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],223:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../helpers/utils"),g=["template","onEdit","renderOptions"],h=200,i=0,j=27,k=13;b.exports=d.extend({events:{"blur .js-input":"hide","keyup .js-input":"_onKeyUpInput"},initialize:function(a){e.each(g,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._onClickHandler=this._onClickHandler.bind(this),this.edit=this.edit.bind(this),this._timeout=a.timeout||h},render:function(){return this._unbindEvents(),this.clearSubViews(),this.$el.empty(),this._initViews(),this._initBinds(),this},_initBinds:function(){this.options.onClick?(this._onClick=this.options.onClick,this._title().on("click",this._onClickHandler)):this._title().on("dblclick",this.edit)},_unbindEvents:function(){var a=this._title();a&&a.off("click dblclick")},_onClickHandler:function(a){var b=this;i++,1===i&&setTimeout(function(){1===i?b._onClick&&b._onClick(a):b.edit(),i=0},this._timeout)},_initViews:function(){this.$el.append(this._template(this._renderOptions)),this.setElement(this.$(".Inline-editor"))},edit:function(){this.$(".js-input").prop("readonly",!1).show().focus(),this.$(".js-input").get(0).setSelectionRange(0,this.$(".js-input").val().length)},getValue:function(){var a=this.$(".js-input").val();return f.sanitizeHtml(a)},_title:function(){return this.$(".js-title")},hide:function(){this.$(".js-input").prop("readonly",!0).hide()},clean:function(){this._unbindEvents(),d.prototype.clean.call(this)},_onKeyUpInput:function(a){a.which===j&&this.hide(),a.which===k&&this._onEdit&&this._onEdit(this.getValue())}})},{"../../helpers/utils":1102,"backbone/core-view":1127,underscore:"underscore"}],224:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=d.Model.extend({defaults:{likeable:!0},url:function(a){var b=this._configModel.urlVersion("like"),c=this._configModel.get("base_url");return c+"/api/"+b+"/viz/"+this.get("vis_id")+"/like"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!a.vis_id)throw new Error("vis_id attribute is required");this._configModel=b.configModel,this.on("destroy",function(){this.set({liked:!1,likes:this.get("likes")-1})},this)},_onSaveError:function(a,b){this.trigger("error",{status:b.status,statusText:b.statusText})},toggleLiked:function(){this.get("liked")?this.destroy():(this.set({id:null},{silent:!0}),this.save({},{error:this._onSaveError.bind(this)}))}},{newByVisData:function(a){var b=e.defaults({id:a.liked?a.vis_id:null},e.omit(a,"url","configModel")),c=new f(b,{configModel:a.configModel});return a.url&&(c.url=a.url),c}});b.exports=f},{backbone:"backbone",underscore:"underscore"}],225:[function(a,b,c){var d=a("backbone/core-view"),e=a("./likes.tpl");b.exports=d.extend({tagName:"a",events:{click:"_toggleLike"},initialize:function(){this.model.bind("change:likeable change:liked change:likes error",this.render,this)},render:function(){return this.$el.html(e({likes:this.model.get("likes"),size:this.model.get("size"),show_count:this.model.get("show_count"),show_label:this.model.get("show_label")})),this.$el.attr({class:this._classNames(),href:this._hrefLocation()}),this},_hrefLocation:function(){var a="#/like";return this.model.get("likeable")||(a=window.login_url),a},_classNames:function(){var a=["LikesIndicator"];return this.model.get("likeable")&&a.push("is-likeable"),this.model.get("liked")&&a.push("is-liked"),this._animate&&(a.push("is-animated"),this.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){this._animate=!1,this.render()}.bind(this))),a.join(" ")},_toggleLike:function(a){this.model.get("likeable")&&(this.killEvent(a),this._animate=!0,this.model.toggleLiked())}})},{"./likes.tpl":226,"backbone/core-view":1127}],226:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<i class="CDB-IconFont CDB-IconFont-heartFill LikesIndicator-icon ',"undefined"!=typeof size&&"big"===size&&(__p+="LikesIndicator-icon--big Navmenu-icon"),__p+='"></i>\n',(likes>2||show_count)&&(__p+='\n  <span class="CDB-Text CDB-Size-medium LikesIndicator-count">'+(null==(__t=likes)?"":_.escape(__t))+"</span>\n  ",show_label&&likes>3&&(__p+='\n    <span class="CDB-Text CDB-Size-medium LikesIndicator-label">'+(null==(__t=_t("components.likes-pluralize",{smart_count:likes}))?"":_.escape(__t))+"</span>\n  "),__p+="\n"),__p+="\n";return __p}},{underscore:"underscore"}],227:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="CDB-LoaderIcon CDB-LoaderIcon--big is-dark js-loader">\n    <svg class="CDB-LoaderIcon-spinner" viewbox="0 0 50 50">\n      <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"/>\n    </svg>\n  </div>\n  <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m u-tSpace-xl">'+(null==(__t=title)?"":_.escape(__t))+'</h4>\n  <div class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=descHTML)?"":__t)+"</div>\n</div>\n";return __p}},{underscore:"underscore"}],228:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-medium u-altTextColor">\n  "'+(null==(__t=quote)?"":__t)+'"\n</p>\n',author&&(__p+='\n  <p class="CDB-Text CDB-Size-medium u-altTextColor u-tSpace"><i>– '+(null==(__t=author)?"":_.escape(__t))+"</i></p>\n"),__p+="\n";return __p}},{underscore:"underscore"}],229:[function(a,b,c){var d=a("./quote.tpl"),e=[{quote:"Geographers never get lost. They just do accidental field work.",author:"Nicholas Chrisman"},{quote:"Geography is just physics slowed down, with a couple of trees stuck in it.",author:"Terry Pratchett"},{quote:"Not all those who wander are lost.",author:"J. R. R. Tolkien"},{quote:"In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City.",author:"Jorge Luis Borges"},{quote:"X marks the spot",author:"Indiana Jones"},{quote:"It's turtles all the way down.",author:null},{quote:"Remember: no matter where you go, there you are.",author:null},{quote:"Without geography, you're nowhere!",author:"Jimmy Buffett"},{quote:"our earth is a globe / whose surface we probe /<br />no map can replace her / but just try to trace her",author:"Steve Waterman"},{quote:"Everything happens somewhere.",author:"Doctor Who"},{quote:"A map is the greatest of all epic poems. Its lines and colors show the realization of great dreams.",author:"Gilbert H. Grosvenor"},{quote:"Everything is related to everything else,<br />but near things are more related than distant things.",author:"Tobler's first law of geography"},{quote:"Hic Sunt Dracones",author:null},{quote:"Here be dragons",author:null},{quote:"Stand in the place where you live / Now face North /<br/>Think about direction / Wonder why you haven't before",author:"R.E.M"},{quote:"The virtue of maps, they show what can be done with limited space, they foresee that everything can happen therein.",author:"José Saramago"}];b.exports=function(){var a=Math.round(Math.random()*(e.length-1));return d(e[a])}},{"./quote.tpl":228}],230:[function(a,b,c){var d=a("cartodb.js"),e=a("./loading.tpl"),f=a("./random-quote");b.exports=function(a){var b=a.desc&&d.core.sanitize(a.desc);return e({title:a.title||"",descHTML:b||f()})}},{"./loading.tpl":227,"./random-quote":229,"cartodb.js":"cartodb.js"}],231:[function(a,b,c){var d=function(){function a(a,b){if(!a)throw new Error("key is required");if(!e&&!b)throw new Error("userModel is required");!e&&b&&b.userModel&&(e=b.userModel),d=a,h=!0}function b(a){return[f,g,e.get("username"),d,a].join(".")}function c(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var d,e,f="cdb",g="0.1.0",h=!1;return{init:function(b,d){if(!c())throw new Error("localStorage not supported in your browser");a(b,d)},get:function(c){h||a();var d=b(c);return localStorage[d]},set:function(c,d){h||a();var e=b(c);localStorage[e]=d},delete:function(c){h||a();var d=b(c);delete localStorage[d]}}}();b.exports=d},{}],232:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{eventName:"",eventProperties:{}},url:function(){return this._configModel.get("base_url")+"/api/v3/metrics"},initialize:function(a,b){if(!b.userId)throw new Error("userId is required");if(!b.visId)throw new Error("visId is required");if(!b.configModel)throw new Error("configModel is required");this._userId=b.userId,this._visId=b.visId,this._configModel=b.configModel},toJSON:function(){return{name:this.get("eventName"),properties:e.extend({},this.get("eventProperties"),{visualization_id:this._visId,user_id:this._userId})}}})},{backbone:"backbone",underscore:"underscore"}],233:[function(a,b,c){var d=a("./metrics-model");b.exports=function(){return{init:function(a){if(!a)throw new Error("visId, userId and configModel are required");if(!a.userId)throw new Error("userId is required");if(!a.visId)throw new Error("visId is required");if(!a.configModel)throw new Error("configModel is required");this._userId=a.userId,this._visId=a.visId,this._configModel=a.configModel},track:function(a,b){if(!a)throw new Error("eventName is required");var c=new d({eventName:a,eventProperties:b},{userId:this._userId,visId:this._visId,configModel:this._configModel});c.save()}}}()},{"./metrics-model":232}],234:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal">\n  <div class="Modal-header">\n    <div class="Modal-headerContainer">\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace">'+(null==(__t=_t("components.modals.add-analysis.modal-title"))?"":_.escape(__t))+'</h2>\n      <h3 class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.add-analysis.modal-desc"))?"":_.escape(__t))+'</h3>\n    </div>\n  </div>\n  <div class="Modal-container Modal-container--analysis">\n    <div class="Modal-inner js-body">\n    </div>\n  </div>\n  <div class="Modal-footer">\n    <div class="Modal-footerContainer u-flex u-justifyEnd">\n      <button class="CDB-Button CDB-Button--primary is-disabled js-add">\n        <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-analysis.add-btn"))?"":_.escape(__t))+"</span>\n      </button>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],235:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../data/analyses"),h=a("./analysis-options-collection"),i=a("./analysis-options"),j=a("../../../components/stack-layout/stack-layout-view"),k=a("./analysis-view-pane"),l=a("./analysis-info-pane"),m=a("../../../components/loading/render-loading"),n=a("../../../editor/layers/layer-content-views/analyses/analyses-quota/analyses-quota-info");b.exports=f.extend({className:"Dialog-content Dialog-content--expanded",events:{"click .js-add":"_onAddAnalysis"},initialize:function(a){if(!a.modalModel)throw new Error("modalModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");this._modalModel=a.modalModel,this._layerDefinitionModel=a.layerDefinitionModel,this._userModel=a.userModel,this._configModel=a.configModel,this._analysisDefinitionNodeModel=this._layerDefinitionModel.getAnalysisDefinitionNodeModel(),this._analysisOptions=i(g,this._userModel,this._configModel),this._analysisOptionsCollection=new h,this.add_related_model(this._analysisOptionsCollection),this._queryGeometryModel=this._analysisDefinitionNodeModel.queryGeometryModel,this._queryGeometryModel.on("change",this.render,this),this.add_related_model(this._queryGeometryModel),this._dataservicesApiHealth=n.get(),this._isFetchingGeometry()||this._queryGeometryModel.fetch(),this._initOptions()},render:function(){this.clearSubViews();var a=this.render.bind(this),b=this._dataservicesApiHealth.needsCheck();return b&&this._dataservicesApiHealth.fetch({success:a}),this._isFetchingGeometry()||b?this._renderLoadingView():this._renderStackView(),this},_renderLoadingView:function(){this.$el.html(m({title:_t("components.modals.add-widgets.loading-title")}))},_renderStackView:function(){var a=new e.Collection([{createStackView:function(a,b){var c=new k({modalModel:this._modalModel,stackLayoutModel:a,analysisOptions:this._analysisOptions,analysisOptionsCollection:this._analysisOptionsCollection,layerDefinitionModel:this._layerDefinitionModel,queryGeometryModel:this._queryGeometryModel});return this._analysisViewPane=c,c}.bind(this)},{createStackView:function(a,b){var c=new l({stackLayoutModel:a,modalModel:this._modalModel,layerDefinitionModel:this._layerDefinitionModel,collection:this._analysisOptionsCollection});return c.bind("backToCategory",function(b){a.prevStep(),this._analysisViewPane.goToTabItem(b)},this),c}.bind(this)}]);this._stackLayoutView=new j({className:"Editor-content",collection:a}),this.$el.html(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_isFetchingGeometry:function(){return"fetching"===this._queryGeometryModel.get("status")},_initOptions:function(){var a=d.reduce(Object.keys(this._analysisOptions),function(a,b){var c=this._analysisOptions[b];return c.analyses.forEach(function(c){a.push(d.extend({},c,{category:b,type:c.nodeAttrs.type}))}),a},[],this);this._analysisOptionsCollection.reset(a)}})},{"../../../components/loading/render-loading":230,"../../../components/stack-layout/stack-layout-view":533,"../../../data/analyses":599,"../../../editor/layers/layer-content-views/analyses/analyses-quota/analyses-quota-info":796,"./analysis-info-pane":240,"./analysis-options":248,"./analysis-options-collection":247,"./analysis-view-pane":249,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],236:[function(a,b,c){var d=a("underscore"),e=a("./analysis-category-pane-view");b.exports=function(a){return[{type:"create_clean",createTabPaneItem:function(b,c){return{label:_t("analysis-category.create-clean"),name:"create_clean",createContentView:function(){return new e(d.extend({analysisOptions:a,analysisType:"create_clean",collection:b},c))}}}},{type:"analyze_predict",createTabPaneItem:function(b,c){return{label:_t("analysis-category.analyze-predict"),name:"analyze_predict",createContentView:function(){return new e(d.extend({analysisOptions:a,analysisType:"analyze_predict",collection:b},c))}}}},{type:"data_transformation",createTabPaneItem:function(b,c){return{label:_t("analysis-category.data-transformation"),name:"data_transformation",createContentView:function(){return new e(d.extend({analysisOptions:a,analysisType:"data_transformation",collection:b},c))}}}}]}},{"./analysis-category-pane-view":237,underscore:"underscore"}],237:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../scroll/scroll-view"),f=a("./analysis-category-pane");b.exports=d.extend({className:"Dialog-content Dialog-content--expanded",initialize:function(a){if(!a.modalModel)throw new Error("modalModel is required");if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");if(!a.analysisOptionsCollection)throw new Error("analysisOptionsCollection is required");if(!a.analysisType)throw new Error("analysisType is required");if(!a.analysisOptions)throw new Error("analysisOptions is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");this._modalModel=a.modalModel,this._stackLayoutModel=a.stackLayoutModel,this._queryGeometryModel=a.queryGeometryModel,this._analysisOptionsCollection=a.analysisOptionsCollection,this._analysisType=a.analysisType,this._analysisOptions=a.analysisOptions},render:function(){this.clearSubViews();var a=new e({createContentView:function(){return new f({stackLayoutModel:this._stackLayoutModel,collection:this._analysisOptionsCollection,title:this.options.categoryTitle||this.options.category,category:"all"===this._analysisType?null:this._analysisType,categoryTitle:"all"===this._analysisType?null:this._analysisOptions[this._analysisType].label,simpleGeometryType:this._queryGeometryModel.get("simple_geom")})}.bind(this)});return this.addView(a),this.$el.append(a.render().el),this}})},{"../../scroll/scroll-view":530,"./analysis-category-pane":238,"backbone/core-view":1127}],238:[function(a,b,c){var d=a("backbone/core-view"),e=a("./analysis-option-view"),f=a("./analysis-category.tpl");b.exports=d.extend({className:"Modal-analysisContainer",options:{category:"",categoryTitle:"",simpleGeometryType:""},initialize:function(a){if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");this._stackLayoutModel=a.stackLayoutModel},render:function(){return this.clearSubViews(),this.$el.html(this._html()),this.collection.each(this._renderOption,this),this},_html:function(){return f({title:this.options.title})},_renderOption:function(a){if(!this.options.category||a.belongsTo(this.options.category)){var b=new e({model:a,simpleGeometryTypeInput:this.options.simpleGeometryType});b.bind("onClickInfo",function(){this._stackLayoutModel.nextStep()},this),this.addView(b),this._$list().append(b.render().el)}},_$list:function(){return this.$(".js-analyses-list")}})},{"./analysis-category.tpl":239,"./analysis-option-view":245,"backbone/core-view":1127}],239:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="ModalBlockList js-analyses-list"></ul>\n';return __p}},{underscore:"underscore"}],240:[function(a,b,c){var d=a("backbone/core-view"),e=a("./analysis-info-pane.tpl"),f=a("../../../data/analyses");b.exports=d.extend({className:"Modal",events:{"click .js-back":"_onClickBack","click .js-backToCategory":"_onClickBackToCategory","click .js-add":"_onAddAnalysis"},initialize:function(a){if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.modalModel)throw new Error("modalModel is required");if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");this._layerDefinitionModel=a.layerDefinitionModel,this._modalModel=a.modalModel,this._stackLayoutModel=a.stackLayoutModel,this.collection.on("change:selected",this.render,this)},render:function(){this.clearSubViews();var a,b,c=this.collection.find("selected"),d={title:"",category:"",type:"",genericType:"",analysisParams:""};if(c){var g={};a=c.get("type");var h=f.getAnalysisByType(a),i=h&&h.animationTemplate;i&&(b=h.genericType||a,g=h.animationParams||{}),this._analysisCategoryName=c.get("category"),d={type:a,genericType:b,category:this._analysisCategoryName.replace(/_/g,"-"),title:c.get("title"),analysisParams:g}}return this.$el.html(e(d)),i&&this.$(".js-animation").append(i),this},_onClickBackToCategory:function(){this.trigger("backToCategory",this._analysisCategoryName,this)},_onClickBack:function(){this._stackLayoutModel.prevStep()},_isSelected:function(a){return!!a.get("selected")},_onAddAnalysis:function(){var a=this.collection.find(this._isSelected);if(a){var b=a.getFormAttrs(this._layerDefinitionModel);this._modalModel.destroy(b)}}})},{"../../../data/analyses":599,"./analysis-info-pane.tpl":241,"backbone/core-view":1127}],241:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal-header">\n  <div class="Modal-headerContainer">\n    <div class="CDB-HeaderInfo">\n      <button class="u-rSpace--xl CDB-HeaderInfo-back u-actionTextColor js-back">\n        <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n      </button>\n      <div class="CDB-HeaderInfo-inner">\n        <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace">'+(null==(__t=_t("components.modals.add-analysis.modal-title"))?"":_.escape(__t))+'</h2>\n        <h3 class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.add-analysis.modal-desc"))?"":_.escape(__t))+'</h3>\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class="Modal-inner Modal-inner--with-navigation js-content">\n  <div class="Dialog-content Dialog-content--expanded">\n    <div class="ScrollView">\n      <div class="ScrollView-content">\n        <div class="Modal-analysisContainer">\n          <ul class="CDB-NavMenu-inner CDB-Text is-semibold CDB-Size-small SubmenuModal u-flex u-alignCenter">\n            <li class="CDB-NavMenu-item SubmenuModal-item u-flex u-alignCenter">\n              <button class="js-back u-mainTextColor u-upperCase">'+(null==(__t=_t("analysis-category.all"))?"":_.escape(__t))+'</button>\n            </li>\n            <li class="CDB-NavMenu-item SubmenuModal-item u-flex u-alignCenter">\n              <button class="js-backToCategory u-mainTextColor u-upperCase">'+(null==(__t=_t("analysis-category."+category))?"":_.escape(__t))+'</button>\n            </li>\n            <li class="CDB-NavMenu-item u-upperCase SubmenuModal-item u-flex u-alignCenter">\n              '+(null==(__t=title)?"":_.escape(__t))+'\n            </li>\n          </ul>\n          <div class="Modal-inner u-justifyCenter">\n            <div class="Analysis-moreInfo">\n              <div class="Analysis-animation ',
genericType&&(__p+="is-"+(null==(__t=genericType)?"":_.escape(__t))),__p+=' has-autoplay js-animation is-rounded"></div>\n              <h2 class="CDB-Text CDB-Size-huge is-light Analysis-moreInfoTitle">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n              <p class="CDB-Text CDB-Size-medium u-secondaryTextColor">\n                '+(null==(__t=_t("analyses-onboarding."+genericType+".description",analysisParams))?"":_.escape(__t))+'\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="Modal-footer">\n  <div class="Modal-footerContainer u-flex u-justifyEnd">\n    <button class="CDB-Button CDB-Button--primary js-add">\n      <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-analysis.add-btn"))?"":_.escape(__t))+"</span>\n    </button>\n  </div>\n</div>\n\n";return __p}},{underscore:"underscore"}],242:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../../../../data/camshaft-reference"),g=a("../../../../value-objects/analysis-node-ids");b.exports=e.Model.extend({defaults:{title:"",category:"",selected:!1,type_group:"",desc:""},initialize:function(a,b){if(!b.nodeAttrs)throw new Error("nodeAttrs is required");this._nodeAttrs=b.nodeAttrs},belongsTo:function(a){return this.get("category")===a},acceptsGeometryTypeAsInput:function(a){return f.isValidInputGeometryForType(a,this._nodeAttrs.type)},getValidInputGeometries:function(){return f.getValidInputGeometriesForType(this._nodeAttrs.type)},getFormAttrs:function(a){var b=a.get("letter"),c=a.get("source");return d.extend({source:c,id:b===g.letter(c)?g.next(c):b+"1"},this._nodeAttrs)}})},{"../../../../data/camshaft-reference":615,"../../../../value-objects/analysis-node-ids":1119,backbone:"backbone",underscore:"underscore"}],243:[function(a,b,c){var d=a("underscore"),e=a("./analysis-option-model"),f=a("../../../../data/camshaft-reference");b.exports=e.extend({getFormAttrs:function(){var a=e.prototype.getFormAttrs.apply(this,arguments);return this._removeSourceIfThereAreMultipleSources(a),a},_removeSourceIfThereAreMultipleSources:function(a){var b=f.paramsForType(a.type),c=d.reduce(Object.keys(b),function(a,c){return"node"===b[c].type&&a++,a},0);c>1&&delete a.source}})},{"../../../../data/camshaft-reference":615,"./analysis-option-model":242,underscore:"underscore"}],244:[function(a,b,c){var d=a("underscore"),e=a("./analysis-option-model");b.exports=e.extend({getFormAttrs:function(a){var b=e.prototype.getFormAttrs.apply(this,arguments);return delete b.source,d.extend(b,{primary_source_name:"left_source",left_source:a.get("source")}),b}})},{"./analysis-option-model":242,underscore:"underscore"}],245:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone/core-view"),g=a("./analysis-option.tpl"),h=a("../../../data/analyses");b.exports=f.extend({tagName:"li",className:"ModalBlockList-item",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function(a){this._simpleGeometryTypeInput=a.simpleGeometryTypeInput,this.listenTo(this.model,"change:selected",this.render)},render:function(){var a=this.model.pick("title","type_group","desc","selected");a.enabled=this._acceptsInputGeometry(),a.enabled||(a.desc=this._disabledDesc());var b=this.model.get("type"),c=h.getAnalysisByType(b),e=c&&c.animationTemplate,f="";return e&&(f=c.genericType||b),this.$el.html(g(d.extend(a,{type:f}))),e&&this.$(".js-animation").append(e),this.$el.toggleClass("is-selected",this.model.get("selected")),this.$el.toggleClass("is-disabled",!a.enabled),this},_onMouseEnter:function(){this._acceptsInputGeometry()&&this.$(".js-animation").addClass("has-autoplay")},_onMouseLeave:function(){this._acceptsInputGeometry()&&this.$(".js-animation").removeClass("has-autoplay")},_onClick:function(a){a&&a.target&&e(a.target).hasClass("js-more")&&this.trigger("onClickInfo",this),this._acceptsInputGeometry()&&this.model.set("selected",!0)},_disabledDesc:function(a){return _t("components.modals.add-analysis.disabled-option-desc",{simpleGeometryType:this._simpleGeometryTypeInput||_t("components.modals.add-analysis.unknown-geometry-type"),requiredInputGeometries:this.model.getValidInputGeometries()})},_acceptsInputGeometry:function(){return this.model.acceptsGeometryTypeAsInput(this._simpleGeometryTypeInput)}})},{"../../../data/analyses":599,"./analysis-option.tpl":246,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],246:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Analysis-animation ',enabled&&(__p+="is-enabled"),__p+=" ",type&&(__p+="is-"+(null==(__t=type)?"":_.escape(__t))),__p+=' js-animation u-flex u-alignCenter u-justifyCenter"></div>\n<div class="Analysis-info u-flex">\n  <div class="ModalBlockList-itemInput CDB-Size-large">\n    <input class="CDB-Radio" type="radio" value="true"\n        ',selected&&(__p+='checked="checked"'),__p+="\n        ",enabled||(__p+='disabled="disabled"'),__p+='\n      >\n    <span class="u-iBlock CDB-Radio-face"></span>\n  </div>\n  <div class="ModalBlockList-inner">\n    <div class="ModalBlockList-item-header u-bSpace">\n      <h2 class="ModalBlockList-item-headerTitle CDB-Text CDB-Size-large u-rSpace--m u-ellipsis" title="'+(null==(__t=title)?"":_.escape(__t))+'">\n        '+(null==(__t=title)?"":_.escape(__t))+'\n      </h2>\n    </div>\n    <div class="ModalBlockList-item-body">\n      <p class="CDB-Text CDB-Size-small u-altTextColor">\n        '+(null==(__t=desc)?"":_.escape(__t))+'\n      </p>\n      <button class="CDB-Text CDB-Size-small u-tSpace-xl u-actionTextColor js-more">'+(null==(__t=_t("components.modals.add-analysis.info-analysis"))?"":_.escape(__t))+"</button>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],247:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./analysis-option-models/analysis-option-model");b.exports=e.Collection.extend({model:function(a,b){var c=a.Model||f,e=d.omit(a,"Model","nodeAttrs");return new c(e,{nodeAttrs:a.nodeAttrs})},initialize:function(a,b){this.on("change:selected",this._onSelectedChange,this)},_onSelectedChange:function(a,b){b&&this.each(function(b){b!==a&&b.set("selected",!1)})}})},{"./analysis-option-models/analysis-option-model":242,backbone:"backbone",underscore:"underscore"}],248:[function(a,b,c){var d=a("underscore"),e=a("./analysis-option-models/generated-analysis-option-model"),f=a("camshaft-reference"),g=f.getVersion("latest");b.exports=function(a,b,c){var h={create_clean:{title:_t("analysis-category.create-clean"),analyses:a.getAnalysesByModalCategory("create_clean",c,b)},data_transformation:{title:_t("analysis-category.data-transformation"),analyses:a.getAnalysesByModalCategory("data_transformation",c,b)},analyze_predict:{title:_t("analysis-category.analyze-predict"),analyses:a.getAnalysesByModalCategory("analyze_predict",c,b)}},i=b.featureEnabled("generate_analysis_options");if(i){var j=d.reduce(Object.keys(h),function(a,b){return a.concat(h[b].analyses.map(function(a){return a.nodeAttrs.type}))},[]);h.generated={title:"Generated analyses by the Camshaft reference v"+d.last(f.versions),analyses:d.compact(Object.keys(g.analyses).filter(function(a){return"source"!==a&&!d.contains(j,a)}).map(function(d){return!!a.isAnalysisValidByType(d,c,b)&&{Model:e,nodeAttrs:{type:d},title:d,desc:JSON.stringify(g.analyses[d])}}))}}return h}},{"./analysis-option-models/generated-analysis-option-model":243,"camshaft-reference":"camshaft-reference",underscore:"underscore"}],249:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./analysis-category-pane-view"),g=a("../../tab-pane/create-template-tab-pane"),h=a("./add-analyses.tpl"),i=a("./tab-pane-button-template.tpl"),j=a("./tab-pane-template.tpl"),k=a("./analyses-types");b.exports=e.extend({className:"Dialog-content Dialog-content--expanded",events:{"click .js-add":"_onAddAnalysis"},initialize:function(a){if(!a.modalModel)throw new Error("modalModel is required");if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");if(!a.analysisOptionsCollection)throw new Error("analysisOptionsCollection is required");if(!a.analysisOptions)throw new Error("analysisOptions is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");this._modalModel=a.modalModel,this._stackLayoutModel=a.stackLayoutModel,this._analysisOptions=a.analysisOptions,this._analysisOptionsCollection=a.analysisOptionsCollection,this._layerDefinitionModel=a.layerDefinitionModel,this._queryGeometryModel=a.queryGeometryModel,this.listenTo(this._analysisOptionsCollection,"change:selected",this._toggleAddButton),this._generateTabPaneItems()},render:function(){this.clearSubViews(),this.$el.html(h());var a={tabPaneOptions:{template:j,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneTemplateOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase",template:i}};return this._tabPane=g(this._tabPaneItems,a),this.addView(this._tabPane),this._$body().append(this._tabPane.render().el),this},goToTabItem:function(a){var b=d.first(this._tabPane.collection.where({name:a}));b&&(b.set("selected",!0),this._toggleAddButton())},_generateTabPaneItems:function(){var a=d.unique(d.keys(this._analysisOptions));this._tabPaneItems=d.map(k(this._analysisOptions),function(b){if(d.contains(a,b.type))return b.createTabPaneItem(this._analysisOptionsCollection,{modalModel:this._modalModel,stackLayoutModel:this._stackLayoutModel,analysisOptionsCollection:this._analysisOptionsCollection,queryGeometryModel:this._queryGeometryModel})}.bind(this)),this._tabPaneItems.unshift({label:_t("analysis-category.all"),name:"all",createContentView:function(){return new f({analysisType:"all",stackLayoutModel:this._stackLayoutModel,modalModel:this._modalModel,analysisOptions:this._analysisOptions,analysisOptionsCollection:this._analysisOptionsCollection,queryGeometryModel:this._queryGeometryModel})}.bind(this)})},_$body:function(){return this.$(".js-body")},_onAddAnalysis:function(){var a=this._analysisOptionsCollection.find(this._isSelected);if(a){var b=a.getFormAttrs(this._layerDefinitionModel);this._modalModel.destroy(b)}},_toggleAddButton:function(){this.$(".js-add").toggleClass("is-disabled",!this._analysisOptionsCollection.any(this._isSelected))},_isSelected:function(a){return!!a.get("selected")}})},{"../../tab-pane/create-template-tab-pane":536,"./add-analyses.tpl":234,"./analyses-types":236,"./analysis-category-pane-view":237,"./tab-pane-button-template.tpl":266,"./tab-pane-template.tpl":267,"backbone/core-view":1127,underscore:"underscore"}],250:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="308px" height="98px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g fill="#9DE0AD" fill-rule="evenodd" transform="translate(50, 8)">\n    <circle class="aoi-area area01" fill="#5A7E6D" cx="20" cy="36" r="20"></circle>\n    <circle class="aoi-point area-point01" cx="20" cy="36" r="4"></circle>\n    <circle class="aoi-area area02" fill="#5A7E6D" cx="56" cy="28" r="20"></circle>\n    <circle class="aoi-point area-point02"  cx="56" cy="28" r="4"></circle>\n    <circle class="aoi-area area03" fill="#5A7E6D" cx="76" cy="44" r="20"></circle>\n    <circle class="aoi-point area-point03" cx="76" cy="44" r="4"></circle>\n    <circle class="aoi-area area04" fill="#5A7E6D" cx="138" cy="60" r="20"></circle>\n    <circle class="aoi-point area-point04" cx="138" cy="60" r="4"></circle>\n    <circle class="aoi-area area05" fill="#5A7E6D" cx="156" cy="20" r="20"></circle>\n    <circle class="aoi-point area-point05" cx="156" cy="20" r="4"></circle>\n    <circle class="aoi-area area06" fill="#5A7E6D" cx="188" cy="28" r="20"></circle>\n    <circle class="aoi-point area-point06" cx="188" cy="28" r="4"></circle>\n  </g>\n</svg>\n';return __p}},{underscore:"underscore"}],251:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="148px" height="141px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g fill="#636D72" fill-rule="evenodd">\n    <circle class="Centroid-pointsHighlight" fill="#9DE0AD" cx="74" cy="70" r="4"></circle>\n    <circle class="Centroid-line" fill="none" stroke="#9DE0AD" cx="74.5" cy="70" r="70"></circle>\n    <circle class="Centroid-points Centroid-points01" cx="4" cy="65" r="4"></circle>\n    <circle class="Centroid-points Centroid-points02" cx="34" cy="85" r="4"></circle>\n    <circle class="Centroid-points Centroid-points03" cx="103" cy="50" r="4"></circle>\n    <circle class="Centroid-points Centroid-points04" cx="83" cy="40" r="4"></circle>\n    <circle class="Centroid-points Centroid-points05" cx="63" cy="90" r="4"></circle>\n    <circle class="Centroid-points Centroid-points06" cx="144" cy="65" r="4"></circle>\n    <circle class="Centroid-points Centroid-points07" cx="93" cy="96" r="4"></circle>\n    <circle class="Centroid-points Centroid-points08" cx="44" cy="55" r="4"></circle>\n    <circle class="Centroid-points Centroid-points09" cx="112" cy="83" r="4"></circle>\n    <circle class="Centroid-points Centroid-points10" cx="24" cy="45" r="4"></circle>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],252:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="306" height="98" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g transform="translate(30, 16)" fill="#636D72">\n\n    <g>\n      <path class="Line Line-01" d="M109,32 L42,29"></path>\n      <path class="Line Line-02" d="M109,32 L72,49"></path>\n      <path class="Line Line-03" d="M109,32 L101,54"></path>\n      <path class="Line Line-04" d="M109,32 L131,60"></path>\n      <path class="Line Line-05" d="M109,32 L82,19"></path>\n      <path class="Line Line-06" d="M109,32 L150,47"></path>\n      <path class="Line Line-07" d="M109,32 L121,4"></path>\n      <path class="Line Line-08" d="M109,32 L141,14"></path>\n      <path class="Line Line-09" d="M109,32 L159,25"></path>\n    </g>\n\n    <circle class="Dot Dot--withColorChange Dot-01" cx="42" cy="29" r="4"></circle>\n    <circle class="Dot Dot--withColorChange Dot-02" cx="72" cy="49" r="4"></circle>\n    <circle class="Dot Dot--withColorChange Dot-03" cx="101" cy="54" r="4"></circle>\n    <circle class="Dot Dot--withColorChange Dot-04" cx="131" cy="60" r="4"></circle>\n    <circle class="Dot Dot--withColorChange Dot-05" cx="82" cy="19" r="4"></circle>\n    <circle class="Dot Dot--withColorChange Dot-06" cx="150" cy="47" r="4"></circle>\n    <circle class="Dot Dot--withColorChange Dot-07" cx="141" cy="14" r="4"></circle>\n    <circle class="Dot Dot--withColorChange Dot-08" cx="121" cy="4" r="4"></circle>\n    <circle class="Dot Dot--withColorChange Dot-09" cx="159" cy="25" r="4"></circle>\n\n    <circle class="Dot Dot--withFadeOut Dot-10" cx="52" cy="54" r="4"></circle>\n    <circle class="Dot Dot--withFadeOut Dot-11" cx="4" cy="54" r="4"></circle>\n    <circle class="Dot Dot--withFadeOut Dot-12" cx="28" cy="14" r="4"></circle>\n    <circle class="Dot Dot--withFadeOut Dot-13" cx="188" cy="6" r="4"></circle>\n    <circle class="Dot Dot--withFadeOut Dot-14" cx="196" cy="46" r="4"></circle>\n    <circle class="Dot Dot--withFadeOut Dot-15" cx="228" cy="26" r="4"></circle>\n    <circle class="Dot Dot--withFadeOut Dot-16" cx="182" cy="29" r="4"></circle>\n    <circle class="Dot Dot--withFadeOut Dot-17" cx="62" cy="9" r="4"></circle>\n\n    <circle class="Dot" fill="white" cx="109" cy="32" r="4"></circle>\n  </g>\n</svg>\n';return __p}},{underscore:"underscore"}],253:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="148px" height="64px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g stroke="none" fill="#636D72">\n    <polyline class="Line" stroke="#9DE0AD" points="4.08007812 29.7382812 34.2617188 49.4335938 24.2285156 9.83007812 43.7246094 18.7578125 62.9414062 54.7128906 73.6425781 30.9160156 92.3808594 59.359375 83.328125 3.75585938 103.042969 14.6777344 111.734375 47.1640625 144.171875 28.3574219"></polyline>\n    <circle class="Dot Dot-01" cx="4" cy="29" r="4"></circle>\n    <circle class="Dot Dot-02" cx="34" cy="49" r="4"></circle>\n    <circle class="Dot Dot-03" cx="24" cy="9" r="4"></circle>\n    <circle class="Dot Dot-04" cx="44" cy="19" r="4"></circle>\n    <circle class="Dot Dot-05" cx="63" cy="54" r="4"></circle>\n    <circle class="Dot Dot-06" cx="74" cy="32" r="4"></circle>\n    <circle class="Dot Dot-07" cx="93" cy="60" r="4"></circle>\n    <circle class="Dot Dot-08" cx="83" cy="4" r="4"></circle>\n    <circle class="Dot Dot-09" cx="103" cy="14" r="4"></circle>\n    <circle class="Dot Dot-10" cx="112" cy="47" r="4"></circle>\n    <circle class="Dot Dot-11" cx="144" cy="29" r="4"></circle>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],254:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="302px" height="98px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <defs>\n    <rect id="path-1" x="0" y="0" width="304" height="96"></rect>\n    <rect id="path-3" x="48" y="0" width="48" height="64"></rect>\n    <mask id="mask-4" x="0" y="0" width="48" height="64" fill="white">\n      <use xlink:href="#path-3"></use>\n    </mask>\n    <rect id="path-5" x="0" y="31" width="49" height="33"></rect>\n    <mask id="mask-6" x="0" y="0" width="49" height="33" fill="white">\n      <use xlink:href="#path-5"></use>\n    </mask>\n    <rect id="path-7" x="95" y="0" width="57" height="24"></rect>\n    <mask id="mask-8" x="0" y="0" width="57" height="24" fill="white">\n      <use xlink:href="#path-7"></use>\n    </mask>\n    <rect id="path-9" x="151" y="8" width="18" height="16"></rect>\n    <mask id="mask-10" x="0" y="0" width="18" height="16" fill="white">\n      <use xlink:href="#path-9"></use>\n    </mask>\n    <rect id="path-11" x="24" y="16" width="25" height="16"></rect>\n    <mask id="mask-12" x="0" y="0" width="25" height="16" fill="white">\n      <use xlink:href="#path-11"></use>\n    </mask>\n    <rect id="path-13" x="95" y="23" width="25" height="25"></rect>\n    <mask id="mask-14" x="0" y="0" width="25" height="25" fill="white">\n      <use xlink:href="#path-13"></use>\n    </mask>\n    <rect id="path-15" x="119" y="23" width="58" height="33"></rect>\n    <mask id="mask-16" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="58" height="33" fill="white">\n      <use xlink:href="#path-15"></use>\n    </mask>\n  </defs>\n  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g>\n      <g>\n        <g>\n          <mask id="mask-2" fill="white">\n            <use xlink:href="#path-1"></use>\n          </mask>\n          <use id="Rectangle-10" xlink:href="#path-1"></use>\n        </g>\n        <g transform="translate(64, 16)" stroke="#282C2F" stroke-width="2" fill="#9DE0AD">\n          <use class="rect-01" mask="url(#mask-4)" fill-opacity="0.32" xlink:href="#path-3"></use>\n          <use class="rect-02" mask="url(#mask-6)" fill-opacity="0.8" xlink:href="#path-5"></use>\n          <use class="rect-03" mask="url(#mask-8)" fill-opacity="0.639999986" xlink:href="#path-7"></use>\n          <use class="rect-04" mask="url(#mask-10)" fill-opacity="0.160000011" xlink:href="#path-9"></use>\n          <use class="rect-05" mask="url(#mask-12)" fill-opacity="0.48" xlink:href="#path-11"></use>\n          <use class="rect-06" mask="url(#mask-14)" xlink:href="#path-13"></use>\n          <use class="rect-07" mask="url(#mask-16)" fill-opacity="0.800000012" xlink:href="#path-15"></use>\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n';return __p}},{underscore:"underscore"}],255:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="306" height="98" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <circle class="Dot" cx="117" cy="33" r="4"></circle>\n  <circle class="Dot" cx="91" cy="57" r="4"></circle>\n  <circle class="Dot--withSplash Dot--withSplash--01" cx="91" cy="57" r="4"></circle>\n  <circle class="Dot" cx="73" cy="27" r="4"></circle>\n  <circle class="Dot" cx="223" cy="39" r="4"></circle>\n  <circle class="Dot--withSplash Dot--withSplash--02" cx="223" cy="39" r="4"></circle>\n  <circle class="Dot" cx="125" cy="69" r="4"></circle>\n  <circle class="Dot" cx="64" cy="65" r="4"></circle>\n  <circle class="Dot" cx="151" cy="71" r="4"></circle>\n  <circle class="Dot--withSplash Dot--withSplash--03" cx="151" cy="71" r="4"></circle>\n  <circle class="Dot" cx="205" cy="75" r="4"></circle>\n  <circle class="Dot" cx="163" cy="61" r="4"></circle>\n  <circle class="Dot" cx="133" cy="43" r="4"></circle>\n  <circle class="Dot" cx="189" cy="46" r="4"></circle>\n  <circle class="Dot--withSplash Dot--withSplash--04" cx="189" cy="46" r="4"></circle>\n  <circle class="Dot" cx="242" cy="45" r="4"></circle>\n  <circle class="Dot" cx="155" cy="39" r="4"></circle>\n  <circle class="Dot" cx="195" cy="23" r="4"></circle>\n  <circle class="Dot--green Dot-01" cx="91" cy="57" r="4"></circle>\n  <circle class="Dot--green Dot-02" cx="223" cy="39" r="4"></circle>\n  <circle class="Dot--green Dot-03" cx="151" cy="71" r="4"></circle>\n  <circle class="Dot--green Dot-04" cx="189" cy="46" r="4"></circle>\n</svg>';return __p}},{underscore:"underscore"}],256:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="304" height="96" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g fill="#636D72" stroke="none" stroke-width="1">\n    <g stroke="#FFFFFF" stroke-linecap="square">\n      <path class="Line" d="M174.5,58.5 L166.5,35.5" id="Line"></path>\n      <path class="Line" d="M174.5,58.5 L145.5,40.5" id="Line"></path>\n      <path class="Line" d="M128.5,29.5 L145.5,40.5" id="Line"></path>\n      <path class="Line" d="M128.5,29.5 L84.5,24.5" id="Line"></path>\n      <path class="Line--withHighlight" d="M174.5,58.5 L136.5,66.5" id="Line"></path>\n      <path class="Line--withHighlight" d="M103.5,53.5 L136.5,66.5" id="Line"></path>\n      <path class="Line--withHighlight" d="M76.5,61.5 L104.5,53.5" id="Line"></path>\n      <path class="Line" d="M174.5,58.5 L162.5,68.5" id="Line"></path>\n      <path class="Line" d="M174.5,58.5 L217.5,71.5" id="Line"></path>\n      <path class="Line" d="M235.5,35.5 L217.5,71.5" id="Line"></path>\n      <path class="Line" d="M235.5,35.5 L253.5,41.5" id="Line"></path>\n      <path class="Line" d="M202.5,42.5 L166.5,35.5" id="Line"></path>\n      <path class="Line" d="M202.5,42.5 L207.5,18.5" id="Line"></path>\n      <path class="Line--withFade" d="M174.5,58.5 L136.5,66.5" id="Line"></path>\n      <path class="Line--withFade" d="M103.5,53.5 L136.5,66.5" id="Line"></path>\n      <path class="Line--withFade" d="M76.5,61.5 L104.5,53.5" id="Line"></path>\n    </g>\n\n    <circle class="Dot Dot-01" cx="129" cy="30" r="4"></circle>\n    <circle class="Dot Dot-02" cx="85" cy="24" r="4"></circle>\n    <circle class="Dot Dot-03" cx="235" cy="36" r="4"></circle>\n    <circle class="Dot Dot-04" cx="163" cy="68" r="4"></circle>\n    <circle class="Dot Dot-05" cx="217" cy="72" r="4"></circle>\n    <circle class="Dot Dot-06" cx="145" cy="40" r="4"></circle>\n    <circle class="Dot Dot-07" cx="201" cy="43" r="4"></circle>\n    <circle class="Dot Dot-08" cx="254" cy="42" r="4"></circle>\n    <circle class="Dot Dot-09" cx="167" cy="36" r="4"></circle>\n    <circle class="Dot Dot-10" cx="207" cy="20" r="4"></circle>\n\n    <circle class="Dot-11 Dot--withHighlight" cx="103" cy="54" r="4"></circle>\n    <circle class="Dot-12 Dot--withHighlight" cx="137" cy="66" r="4"></circle>\n    <circle class="Dot-13 Dot--withHighlight" cx="76" cy="62" r="4"></circle>\n    <circle class="Dot-14 Dot--withHighlight" cx="175" cy="58" r="4"></circle>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],257:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="306px" height="98px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g fill="#636D72" fill-rule="evenodd" transform="translate(70, 15)">\n    <polygon fill="none" class="Filter-line" stroke="#9DE0AD" points="73.703125 13.6435547 97.5439453 17.5722656 106.554688 42.9824219 92.5517578 55.5849609 63.3261719 53.5224609 54.0126953 15.3515625 59.0839844 11.4414062"></polygon>\n    <circle class="Filter-dotHighlight Filter-dotHighlight--01" cx="95" cy="20" r="4"></circle>\n    <circle class="Filter-dotHighlight Filter-dotHighlight--06" cx="73" cy="24" r="4"></circle>\n    <circle class="Filter-dotHighlight Filter-dotHighlight--02" cx="103" cy="42" r="4"></circle>\n    <circle class="Filter-dotHighlight Filter-dotHighlight--03" cx="91" cy="52" r="4"></circle>\n    <circle class="Filter-dotHighlight Filter-dotHighlight--05" cx="57" cy="14" r="4"></circle>\n    <circle class="Filter-dotHighlight Filter-dotHighlight--04" cx="65" cy="50" r="4"></circle>\n    <circle class="Filter-dot circle08" cx="163" cy="20" r="4"></circle>\n    <circle class="Filter-dot circle07" cx="31" cy="38" r="4"></circle>\n    <circle class="Filter-dot circle06" cx="13" cy="8" r="4"></circle>\n    <circle class="Filter-dot circle05" cx="4" cy="46" r="4"></circle>\n    <circle class="Filter-dot circle04" cx="145" cy="56" r="4"></circle>\n    <circle class="Filter-dot circle03" cx="129" cy="27" r="4"></circle>\n    <circle class="Filter-dot circle02" cx="182" cy="26" r="4"></circle>\n    <circle class="Filter-dot circle01" cx="135" cy="4" r="4"></circle>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],258:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="302px" height="99px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g fill="#9DE0AD" fill-rule="evenodd">\n    <path d="M0.5,41.5 L305.5,24.5" class="Georeference-street00" stroke="#282C2F" stroke-width="8" stroke-linecap="square"></path>\n    <path d="M134,0 L141,91" class="Georeference-street01" stroke="#282C2F" stroke-width="8" stroke-linecap="square"></path>\n    <path d="M258,0 L265,91" class="Georeference-street02" stroke="#282C2F" stroke-width="8" stroke-linecap="square"></path>\n    <text class="Georeference-point02-text" font-family="Open Sans" font-size="10" font-weight="300" fill="#FFFFFF">\n      <tspan x="63" y="62">-63.578373</tspan>\n      <tspan x="63" y="76">44.642619</tspan>\n    </text>\n    <text class="Georeference-point01-text" font-family="Open Sans" font-size="10" font-weight="300" fill="#FFFFFF">\n      <tspan x="198" y="54">IP 214.80.33.47</tspan>\n    </text>\n    <circle class="Dot Dot-01" fill="#9DE0AD" cx="43" cy="40" r="8"></circle>\n    <circle class="Dot Dot-02" fill="#9DE0AD" cx="183" cy="32" r="8"></circle>\n  </g>\n</svg>\n';return __p}},{underscore:"underscore"}],259:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="176" height="64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g fill="#9DE0AD">\n    <polygon fill="none" class="Group-line" stroke="#9EE0AD" points="88.4493047 0.0859375 175.58896 0.0859375 175.58896 23.2574383 135.581141 32.7431641 135.581141 54.9504597 117.092373 54.9504597 101.982508 63.6816406 59.4503976 63.6816406 44.9366094 55.6914063 1 55.6914063 1 24.8914834 44.6201536 24.8914834 56.9346563 0"></polygon>\n    <circle class="Group-point Group-point01" cx="60" cy="60" r="4"></circle>\n    <circle class="Group-point Group-point02" cx="100" cy="4" r="4"></circle>\n    <circle class="Group-point Group-point03" cx="132" cy="52" r="4"></circle>\n    <circle class="Group-point Group-point04" cx="116" cy="52" r="4"></circle>\n    <circle class="Group-point Group-point05" cx="116" cy="36" r="4"></circle>\n    <circle class="Group-point Group-point06" cx="116" cy="20" r="4"></circle>\n    <circle class="Group-point Group-point07" cx="172" cy="20" r="4"></circle>\n    <circle class="Group-point Group-point08" cx="172" cy="4" r="4"></circle>\n    <circle class="Group-point Group-point09" cx="44" cy="28" r="4"></circle>\n    <circle class="Group-point Group-point10" cx="4" cy="28" r="4"></circle>\n    <circle class="Group-point Group-point11" cx="4" cy="52" r="4"></circle>\n    <circle class="Group-point Group-point12" cx="44" cy="52" r="4"></circle>\n    <circle class="Group-point Group-point13" cx="100" cy="60" r="4"></circle>\n    <circle class="Group-point Group-point14" cx="132" cy="36" r="4"></circle>\n    <circle class="Group-point Group-point15" cx="60" cy="4" r="4"></circle>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],260:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="308px" height="98px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g fill="#636D72" fill-rule="evenodd" transform="translate(55, 15)">\n    <circle class="intersect intersect-layer" fill="#5A7E6D" stroke="#9DE0AD" cx="101" cy="32" r="32"></circle>\n    <circle class="intersect intersect-circle1" cx="57" cy="14" r="4"></circle>\n    <circle class="intersect intersect-circle2" cx="31" cy="38" r="4"></circle>\n    <circle class="intersect intersect-circle3" cx="13" cy="8" r="4"></circle>\n    <circle class="intersect intersect-circle4" cx="163" cy="20" r="4"></circle>\n    <circle class="intersect intersect-circle5" cx="65" cy="50" r="4"></circle>\n    <circle class="intersect intersect-circle6" cx="4" cy="46" r="4"></circle>\n    <circle class="intersect intersect-circle1Highlight" cx="91" cy="52" r="4"></circle>\n    <circle class="intersect intersect-circle7" cx="145" cy="56" r="4"></circle>\n    <circle class="intersect intersect-circle2Highlight" cx="103" cy="42" r="4"></circle>\n    <circle class="intersect intersect-circle3Highlight"  cx="73" cy="24" r="4"></circle>\n    <circle class="intersect intersect-circle4Highlight" cx="129" cy="27" r="4"></circle>\n    <circle class="intersect intersect-circle8" cx="182" cy="26" r="4"></circle>\n    <circle class="intersect intersect-circle5Highlight" cx="95" cy="20" r="4"></circle>\n    <circle class="intersect intersect-circle9" cx="135" cy="4" r="4"></circle>\n  </g>\n</svg>';
return __p}},{underscore:"underscore"}],261:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="185px" height="64px" viewBox="512 388 185 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(513.000000, 389.000000)">\n    <polygon class="Path Path-01" stroke="#FFFFFF" points="7.92876627e-08 47 22.7004054 47 22.7004054 62.1132254 0 62.1132254"></polygon>\n    <polygon class="Path Path-03" stroke="#FFFFFF" points="160 24 182.700012 24 182.700012 38.9848139 160 38.9848139"></polygon>\n    <polygon class="Path Path-02" stroke="#FFFFFF" points="87.7216797 0.278320312 110.836973 0.278320312 110.836973 24.2279707 87.8211856 24.2279707"></polygon>\n    <polygon class="Path Path-03Green" stroke="#9DE0AD" points="128 24 182.862039 24 182.862039 55.6141883 128.202651 55.6141883"></polygon>\n    <polygon class="Path Path-01Green" stroke="#9DE0AD" points="0.0502868199 31 47.7467919 31 47.7467919 62.177811 0 62.177811"></polygon>\n    <polygon class="Path Path-02Green" stroke="#9DE0AD" points="63.9970703 0.033203125 110.710209 0.033203125 110.710209 62.0109574 63.8597689 62.0109574"></polygon>\n    <circle class="Dot Dot-01" fill="#FFFFFF" cx="7" cy="55" r="4"></circle>\n    <circle class="Dot Dot-02" fill="#FFFFFF" cx="99" cy="11" r="4"></circle>\n    <circle class="Dot Dot-03"  fill="#FFFFFF" cx="171" cy="31" r="4"></circle>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],262:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="306" height="98" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g transform="translate(50, 20)">\n    <circle class="Dot Dot--01 Dot--gray" cx="4" cy="46" r="4"></circle>\n    <circle class="Dot Dot--02 Dot--gray" cx="31" cy="38" r="4"></circle>\n    <circle class="Dot Dot--03 Dot--gray" cx="13" cy="8" r="4"></circle>\n    <circle class="Dot Dot--04 Dot--green" cx="57" cy="14" r="4"></circle>\n    <circle class="Dot Dot--05 Dot--green" cx="65" cy="50" r="4"></circle>\n    <circle class="Dot Dot--06 Dot--green" cx="91" cy="52" r="4"></circle>\n    <circle class="Dot Dot--07 Dot--green" cx="103" cy="42" r="4"></circle>\n    <circle class="Dot Dot--08 Dot--green" cx="73" cy="24" r="4"></circle>\n    <circle class="Dot Dot--09 Dot--green" cx="95" cy="20" r="4"></circle>\n    <circle class="Dot Dot--10 Dot--darkGray" cx="145" cy="56" r="4"></circle>\n    <circle class="Dot Dot--11 Dot--darkGray" cx="129" cy="27" r="4"></circle>\n    <circle class="Dot Dot--12 Dot--darkGray" cx="135" cy="4" r="4"></circle>\n    <circle class="Dot Dot--13 Dot--white" cx="163" cy="20" r="4"></circle>\n    <circle class="Dot Dot--14 Dot--white" cx="182" cy="26" r="4"></circle>\n  </g>\n</svg>\n';return __p}},{underscore:"underscore"}],263:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="306px" height="98px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g id="Mod-Analysis" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g fill="#9DE0AD">\n      <text x="8" y="19" class="Text Text-LH" font-family="OpenSans, Open Sans" font-size="10" font-weight="normal">\n        '+(null==(__t=_t("components.modals.add-analysis.option-types.moran-cluster.low-high"))?"":_.escape(__t))+'\n      </text>\n      <text x="227" y="19" class="Text Text-HH" font-family="OpenSans, Open Sans" font-size="10" font-weight="normal">\n        '+(null==(__t=_t("components.modals.add-analysis.option-types.moran-cluster.high-high"))?"":_.escape(__t))+'\n      </text>\n      <text x="233" y="85" class="Text Text-HL" font-family="OpenSans, Open Sans" font-size="10" font-weight="normal">\n        '+(null==(__t=_t("components.modals.add-analysis.option-types.moran-cluster.high-low"))?"":_.escape(__t))+'\n      </text>\n      <text x="10" y="85" class="Text Text-LL" font-family="OpenSans, Open Sans" font-size="10" font-weight="normal">\n        '+(null==(__t=_t("components.modals.add-analysis.option-types.moran-cluster.low-low"))?"":_.escape(__t))+'\n      </text>\n    </g>\n    <g fill="#FFF">\n      <circle class="Dot Dot-04" fill-opacity="0.4" cx="106" cy="57" r="4"></circle>\n      <circle class="Dot Dot-04" fill-opacity="0.4" cx="137" cy="66" r="4"></circle>\n      <circle class="Dot Dot-04" fill-opacity="0.4" cx="79" cy="62" r="4"></circle>\n      <circle class="Dot Dot-06" fill-opacity="0.6" cx="193" cy="70" r="4"></circle>\n      <circle class="Dot Dot-06" fill-opacity="0.6" cx="175" cy="58" r="4"></circle>\n      <circle class="Dot Dot-08" fill-opacity="0.8" cx="129" cy="30" r="4"></circle>\n      <circle class="Dot Dot-08" fill-opacity="0.8" cx="145" cy="40" r="4"></circle>\n      <circle class="Dot Dot-1" cx="231" cy="36" r="4"></circle>\n      <circle class="Dot Dot-1" cx="197" cy="40" r="4"></circle>\n      <circle class="Dot Dot-1" cx="250" cy="38" r="4"></circle>\n      <circle class="Dot Dot-1" cx="167" cy="36" r="4"></circle>\n      <circle class="Dot Dot-1" cx="203" cy="20" r="4"></circle>\n    </g>\n    <g stroke="#9DE0AD">\n      <path d="M0,49 L304,49" class="Line Line-horizontal" stroke-dasharray="2,3"></path>\n      <path d="M152,0 L152,98" class="Line Line-vertical" stroke-dasharray="2,3"></path>\n    </g>\n  </g>\n</svg>\n';return __p}},{underscore:"underscore"}],264:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='  <svg width="306px" height="98px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g transform="translate(87, 22)" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="square">\n      <path class="Arrow-04" d="M98.5,45.5 L97.5,40.5" stroke="#9CE0AC"></path>\n      <path class="Arrow-04" d="M98.5,45.5 L92.5,46.5" stroke="#9CE0AC"></path>\n      <path class="Line-04" d="M75.5,34.5 L98.5,45.5" stroke="#9DE0AD"></path>\n\n      <path class="Line-03" d="M0.5,44.5 L3.5,39.5" stroke="#9CE0AC"></path>\n      <path class="Line-03" d="M0.5,44.5 L5.5,47.5" stroke="#9CE0AC"></path>\n      <path class="Line-03" d="M0.5,44.5 L55.5,32.5" stroke="#9DE0AD"></path>\n\n      <g transform="translate(75.000000, 1.000000)">\n        <path class="Arrow-01" d="M31.5,8.5 L32.5,2.5" stroke="#95D6A6"></path>\n        <path class="Arrow-01" d="M26.5,0.5 L32.5,2.5" stroke="#95D6A6"></path>\n        <path class="Line-01" d="M0.5,18.5 L32.5,2.5" stroke="#9DE0AD"></path>\n      </g>\n\n      <g transform="translate(19.000000, 0.000000)" stroke="#979797">\n        <path class="Arrow-02" d="M36.5,19.5 L35.5,14.5"></path>\n        <path class="Arrow-02" d="M36.5,19.5 L31.5,21.5"></path>\n        <path class="Line-02" d="M0.5,0.5 L36.5,19.5"></path>\n      </g>\n    </g>\n  </g>\n  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g stroke="#636D72">\n      <path d="M0,49 L304,49" class="Line Line-horizontal" stroke-dasharray="2,3"></path>\n      <path d="M152,0 L152,98" class="Line Line-vertical" stroke-dasharray="2,3"></path>\n    </g>\n  </g>\n  <g transform="translate(72, 11)">\n    <circle class="Dot Dot--center" cx="80" cy="38" r="4" stroke="#9DE0AD" fill="#2E3C43"></circle>\n    <circle class="Dot Dot-01" fill="#9DE0AD" cx="133" cy="10" r="4"></circle>\n    <circle class="Dot Dot-02" fill="#979EA1" cx="24" cy="4" r="4"></circle>\n    <circle class="Dot Dot-03" fill="#9DE0AD" cx="4" cy="57" r="4"></circle>\n    <circle class="Dot Dot-04" fill="#9DE0AD" cx="122" cy="61" r="4"></circle>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],265:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="306" height="98" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g transform="translate(30, 16)" fill="#9DE0AD">\n    <circle class="Dot" cx="42" cy="29" r="4"></circle>\n    <circle class="Dot--withFadeOut Dot-01" cx="72" cy="49" r="4"></circle>\n    <circle class="Dot" cx="52" cy="54" r="4"></circle>\n    <circle class="Dot--withFadeOut Dot-02" cx="4" cy="54" r="4"></circle>\n    <circle class="Dot--withFadeOut Dot-03" cx="28" cy="14" r="4"></circle>\n    <circle class="Dot" cx="188" cy="6" r="4"></circle>\n    <circle class="Dot" cx="196" cy="46" r="4"></circle>\n    <circle class="Dot--withFadeOut Dot-03" cx="159" cy="25" r="4"></circle>\n    <circle class="Dot" cx="228" cy="26" r="4"></circle>\n    <circle class="Dot" cx="141" cy="14" r="4"></circle>\n    <circle class="Dot--withFadeOut Dot-04" cx="121" cy="4" r="4"></circle>\n    <circle class="Dot" cx="101" cy="54" r="4"></circle>\n    <circle class="Dot" cx="182" cy="29" r="4"></circle>\n    <circle class="Dot--withFadeOut Dot-05" cx="131" cy="60" r="4"></circle>\n    <circle class="Dot" cx="82" cy="19" r="4"></circle>\n    <circle class="Dot" cx="150" cy="47" r="4"></circle>\n    <circle class="Dot--withFadeOut Dot-06" cx="62" cy="9" r="4"></circle>\n    <circle class="Dot" cx="109" cy="32" r="4"></circle>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],266:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+(null==(__t=label)?"":_.escape(__t))+"\n";return __p}},{underscore:"underscore"}],267:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal-navigation">\n  <ul class="Modal-navigationInner CDB-Text is-semibold CDB-Size-medium js-menu"></ul>\n</div>\n<div class="Modal-inner Modal-inner--with-navigation js-content">\n</div>\n';return __p}},{underscore:"underscore"}],268:[function(a,b,c){var d=a("backbone"),e=a("./xyz/xyz-model"),f=a("../../mosaic/mosaic-thumbnail.tpl"),g=a("./mapbox/mapbox-model"),h=a("./wms/wms-model"),i=a("./tilejson/tilejson-model"),j=a("./nasa/nasa-model");b.exports=d.Model.extend({defaults:{tabs:void 0,contentPane:"tabs",currentTab:"xyz"},initialize:function(a,b){if(!b.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!b.basemapsCollection)throw new Error("basemapsCollection is required");if(!b.customBaselayersCollection)throw new Error("customBaselayersCollection is required");this._layerDefinitionsCollection=b.layerDefinitionsCollection,this._basemapsCollection=b.basemapsCollection,this._customBaselayersCollection=b.customBaselayersCollection,this._currentTab=b.currentTab,this._initTabs(),this._initBinds()},activeTabModel:function(){return this.get("tabs").findWhere({name:this.get("currentTab")})},canSaveBasemap:function(){return"tabs"===this.get("contentPane")&&this._layerToSave()},saveBasemap:function(){var a=this;this.set("contentPane","addingBasemap");var b=this._layerToSave(),c=b.getAttributes();this.activeTabModel().hasAlreadyAddedLayer(this._customBaselayersCollection)?(this._basemapsCollection.updateSelected(c.className),this._basemapsCollection.updateCategory(c.className,c.category),this._onBasemapSaved(c)):(this._customBaselayersCollection.add(b),b.save({},{success:function(b,d){var e=d.options,g=e.name?e.name:"Custom basemap "+d.order,h=e.className,i=e.urlTemplate;a._basemapsCollection.add({id:d.id,urlTemplate:i,maxZoom:e.minZoom||21,minZoom:e.minZoom||0,name:g,className:h,attribution:e.attribution,category:e.category,tms:e.tms,type:e.type,val:h,label:g,template:function(a){return f({imgURL:a})}}),a._onBasemapSaved(c)},error:function(){a._customBaselayersCollection.remove(b),a.set("contentPane","addBasemapFailed")}}))},_onBasemapSaved:function(a){this._layerDefinitionsCollection.setBaseLayer(a),this.trigger("saveBasemapDone")},_initTabs:function(){var a=new d.Collection([new e,new g,new h(null,{customBaselayersCollection:this._customBaselayersCollection}),new i,new j]);this.set({tabs:a,currentTab:this._currentTab||a.first().get("name")})},_initBinds:function(){this.get("tabs").each(function(a){a.bind("saveBasemap",this.saveBasemap,this)},this)},_layerToSave:function(){return this.activeTabModel().get("layer")}})},{"../../mosaic/mosaic-thumbnail.tpl":462,"./mapbox/mapbox-model":272,"./nasa/nasa-model":275,"./tilejson/tilejson-model":282,"./wms/wms-model":292,"./xyz/xyz-model":295,backbone:"backbone"}],269:[function(a,b,c){var d=a("backbone/core-view"),e=a("./add-basemap.tpl"),f=a("../../tab-pane/tab-pane-view"),g=a("../../tab-pane/tab-pane-collection"),h=a("../../view-factory"),i=a("../../loading/render-loading"),j=a("../../error/error-view"),k=a("underscore"),l=a("./tabs-view");b.exports=d.extend({className:"Dialog-content Dialog-content--expanded",events:{"click .js-ok":"ok"},initialize:function(a){if(!a.modalModel)throw new TypeError("modalModel is required");if(!a.createModel)throw new TypeError("createModel is required");this._modalModel=a.modalModel,this._createModel=a.createModel,this._initBinds()},render:function(){this.clearSubViews(),this.$el.html(e()),this._initViews()},_initBinds:function(){this._createModel.bind("saveBasemapDone",this._modalModel.destroy.bind(this._modalModel),this),this._createModel.bind("change:contentPane",this._onChangeContentView,this),this.add_related_model(this._createModel)},_onChangeContentView:function(){var a=this._createModel.get("contentPane"),b=k.first(this._tabPaneCollection.where({name:a}));b.set("selected",!0)},_initViews:function(){var a=this;this._submitButtom=this.$(".js-ok"),this._modalFooter=this.$(".js-Modal-footer"),this._tabPaneCollection=new g([{name:"tabs",selected:"tabs"===this._createModel.get("contentPane"),createContentView:function(){return new l({model:a._createModel,submitButton:a._submitButtom,modalFooter:a._modalFooter})}},{name:"addingBasemap",selected:"addingBasemap"===this._createModel.get("contentPane"),createContentView:function(){return a._disableModalFooter(!0),h.createByHTML(i({title:_t("components.modals.add-basemap.adding-basemap")}))}},{name:"addBasemapFailed",selected:"addBasemapFailed"===this._createModel.get("contentPane"),createContentView:function(){return new j({title:_t("components.modals.add-basemap.add-basemap-error")})}}]);var b=new f({collection:this._tabPaneCollection});this.addView(b),this.$(".js-content-container").append(b.render().el)},_disableModalFooter:function(a){this._modalFooter.toggleClass("is-disabled",a)},ok:function(){this._createModel.canSaveBasemap()&&this._createModel.saveBasemap()}})},{"../../error/error-view":67,"../../loading/render-loading":230,"../../tab-pane/tab-pane-collection":538,"../../tab-pane/tab-pane-view":549,"../../view-factory":594,"./add-basemap.tpl":270,"./tabs-view":278,"backbone/core-view":1127,underscore:"underscore"}],270:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal">\n  <div class="Modal-header">\n    <div class="Modal-headerContainer">\n      <h2 class="CDB-Text CDB-Size-huge is-light u-mainTextColor u-bSpace">'+(null==(__t=_t("components.modals.add-basemap.modal-title"))?"":_.escape(__t))+'</h2>\n      <h3 class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.add-basemap.modal-desc"))?"":_.escape(__t))+'</h3>\n    </div>\n  </div>\n  <div class="Modal-container">\n    <div class="Tab-pane js-content-container">\n    </div>\n  </div>\n  <div class="Modal-footer js-Modal-footer">\n    <div class="Modal-footerContainer u-flex u-justifyEnd">\n      <button class="CDB-Button CDB-Button--primary is-disabled js-ok ok">\n        <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-basemap.add-btn"))?"":_.escape(__t))+"</span>\n      </button>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],271:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter Modal-basemapContainer">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor Modal-titleBasemap">'+(null==(__t=_t("components.modals.add-basemap.mapbox.insert"))?"":_.escape(__t))+'</h3>\n  <div class="CDB-Text u-flex u-alignCenter ">\n    <label class="Metadata-label Metadata-label--big CDB-Text CDB-Size-small is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.add-basemap.mapbox.enter"))?"":_.escape(__t))+'</label>\n    <div class="Form-rowData Form-rowData--longer">\n      <input type="text" class="CDB-InputText CDB-Text js-url" value="'+(null==(__t=url)?"":_.escape(__t))+'" placeholder="'+(null==(__t=_t("components.modals.add-basemap.xyz.eg"))?"":_.escape(__t))+' username.ab12cd3">\n    </div>\n  </div>\n  <div class="u-tSpace-xl CDB-Text u-flex u-alignCenter">\n    <label class="Metadata-label Metadata-label--big CDB-Text CDB-Size-small is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.add-basemap.mapbox.enter-token"))?"":_.escape(__t))+'</label>\n    <div class="Form-rowData Form-rowData--longer">\n      <input type="text" class="CDB-InputText CDB-Text js-access-token" value="'+(null==(__t=accessToken)?"":_.escape(__t))+'" placeholder="'+(null==(__t=_t("components.modals.add-basemap.xyz.eg"))?"":_.escape(__t))+' pk.bfg32ewdsadeyJ1Ijoi…">\n      <div class="XYZPanel-error CDB-InfoTooltip CDB-InfoTooltip--left is-error CDB-Text CDB-Size-medium CDB-InfoTooltip-text js-error '+(null==(__t=lastErrorMsg?"is-visible":"")?"":_.escape(__t))+'">'+(null==(__t=lastErrorMsg)?"":_.escape(__t))+"</div>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],272:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./mapbox-view"),g=a("./mapbox-to-tile-layer-factory");b.exports=d.Model.extend({defaults:{name:"mapbox",label:"Mapbox",currentView:"enterURL",lastErrorMsg:"",layer:void 0},createView:function(a){if(!a.submitButton)throw new Error("submitButton is required");if(!a.modalFooter)throw new Error("modalFooter is required");return this._submitButton=a.submitButton,this._modalFooter=a.modalFooter,this.set({currentView:"enterURL",layer:void 0}),new f({model:this,submitButton:this._submitButton,modalFooter:this._modalFooter})},hasAlreadyAddedLayer:function(a){var b=this.get("layer").get("urlTemplate");return e.any(a.isCustomCategory(),function(a){return a.get("urlTemplate")===b})},validateInputs:function(a,b){this.set({currentView:"validatingInputs",url:a,accessToken:b});var c=this,d=new g({url:a,accessToken:b});d.createTileLayer({success:function(a){c.set("layer",a),c.trigger("saveBasemap")},error:function(a){c.set({currentView:"enterURL",lastErrorMsg:a})}})}})},{"./mapbox-to-tile-layer-factory":273,"./mapbox-view":274,backbone:"backbone",underscore:"underscore"}],273:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("../../../../data/custom-baselayer-model");b.exports=f.Model.extend({defaults:{url:"",accessToken:""},_MAPBOX:{version:4,https:"https://dnv9my2eseobd.cloudfront.net",base:"https://a.tiles.mapbox.com/"},createTileLayer:function(a){var b,c=this.get("url"),e=this._lowerXYZ(c),f=this.get("accessToken"),g="json",h=["a","b","c"];e.indexOf("{x}")<0&&e.indexOf("tiles.mapbox.com")!==-1?(b=this._getMapBoxMapID(e),b&&(g="mapbox_id",e=b)):e.indexOf("{x}")!==-1?(g="xyz",e=e.replace(/\{s\}/g,function(){return h[Math.floor(3*Math.random())]}).replace(/\{x\}/g,"0").replace(/\{y\}/g,"0").replace(/\{z\}/g,"0")):e&&e.indexOf("http")<0&&null!=e.match(/(.*?)\.(.*)/)&&3===e.match(/(.*?)\.(.*)/).length?(g="mapbox_id",b=c):e=this._fixHTTPS(e);var i,j=this;if("mapbox"===g)a.success(this._newTileLayer({tiles:[e]}));else if("xyz"===g)i=new Image,i.onload=function(){a.success(j._newTileLayer({tiles:[j._lowerXYZ(c)]}))},i.onerror=function(){a.error(j._errorToMsg())},i.src=e;else if("mapbox_id"===g){var k="?access_token="+f,l=this._MAPBOX.base+"v"+this._MAPBOX.version+"/"+b,m=l+"/{z}/{x}/{y}.png"+k,n=l+".json"+k,o=setTimeout(function(){a.error(j._errorToMsg())},5e3);d.ajax({url:n,success:function(b){clearTimeout(o),a.success(j._newTileLayer({tiles:[m],attribution:b.attribution,minzoom:b.minzoom,maxzoom:b.maxzoom,name:b.name}))},error:function(b){clearTimeout(o),a.error(j._errorToMsg(b))}})}else a.error(this._errorToMsg())},_newTileLayer:function(a){e.isArray(a)&&e.size(a)>0&&(a=e.first(a));var b=a.tiles[0],c=a.attribution||null,d=new g({urlTemplate:b,attribution:c,maxZoom:a.maxzoom||21,minZoom:a.minzoom||0,name:a.name||"",category:"Mapbox",type:"Tiled"});return d.set("className",d._generateClassName(b)),d},_errorToMsg:function(a){return"object"!=typeof a&&a?a:a&&a.status&&401===a.status?_t("components.modals.add-basemap.mapbox.error"):_t("components.modals.add-basemap.mapbox.invalid")},_lowerXYZ:function(a){return a.replace(/\{S\}/g,"{s}").replace(/\{X\}/g,"{x}").replace(/\{Y\}/g,"{y}").replace(/\{Z\}/g,"{z}")},_getMapBoxMapID:function(a){var b=/https?:\/\/[a-z]?\.?tiles\.mapbox.com\/v(\d)\/([^\/.]*)\.([^\/.]*)/,c=/https?:\/\/tiles\.mapbox\.com\/(.*?)\/edit\/(.*?)(\?|#)/,d="";return d=a.match(b),d&&d[1]&&d[2]?d[2]+"."+d[3]:(d=a.match(c),d&&d[1]&&d[2]?d[1]+"."+d[2]:void 0)},_fixHTTPS:function(a,b){if(b=b||location,0!==a.indexOf("https")&&"https:"===b.protocol){var c=a.indexOf("mapbox.com");return c!==-1?this._MAPBOX.https+a.substr(c+"mapbox.com".length):a.replace(/http/,"https")}return a}})},{"../../../../data/custom-baselayer-model":619,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],274:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../view-factory"),f=a("../../../loading/render-loading"),g=a("./enter-url.tpl");b.exports=d.extend({events:{keydown:"_onKeyDown",keyup:"_onKeyUp"},initialize:function(a){if(!a.submitButton)throw new Error("submitButton is required");if(!a.modalFooter)throw new Error("modalFooter is required");this._submitButton=a.submitButton,this._modalFooter=a.modalFooter,this._onClickBinded=this._onClickOK.bind(this),this._bindSubmitButton(),this._initBinds()},render:function(){this.clearSubViews();var a;switch(this.model.get("currentView")){case"validatingInputs":this._disableModalFooter(!0),a=e.createByHTML(f({title:_t("components.modals.add-basemap.validating")}));break;case"enterURL":default:this._disableModalFooter(!1),a=e.createByHTML(g({url:this.model.get("url"),accessToken:this.model.get("accessToken"),lastErrorMsg:this.model.get("lastErrorMsg")}))}return this.addView(a),this.$el.append(a.render().el),this._updateOkBtn(),this._onKeyUp(),this},_initBinds:function(){this.model.bind("change",this.render,this)},_hasValues:function(){return this._urlVal()&&this._accessToken()},_urlVal:function(){return this.$(".js-url").val()},_accessToken:function(){return this.$(".js-access-token").val()},_onClickOK:function(a){if(this.killEvent(a),this._hasValues()){var b=this._urlVal(),c=this._accessToken();this.model.validateInputs(b,c)}},_disableModalFooter:function(a){this._modalFooter.toggleClass("is-disabled",a)},_updateOkBtn:function(){this._submitButton.find("span").text(_t("components.modals.add-basemap.add-btn"))},_onKeyDown:function(a){a.stopPropagation(),this.$(".js-error").removeClass("is-visible")},_onKeyUp:function(a){a&&a.stopPropagation(),this._submitButton.toggleClass("is-disabled",!this._hasValues())},_bindSubmitButton:function(){this._submitButton.on("click",this._onClickBinded)},_unBindSubmitButton:function(){this._submitButton.off("click",this._onClickBinded)},clean:function(){this._unBindSubmitButton(),d.prototype.clean.call(this)}})},{"../../../loading/render-loading":230,"../../../view-factory":594,"./enter-url.tpl":271,"backbone/core-view":1127}],275:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("moment"),g=a("./nasa-view"),h=a("../../../../data/custom-baselayer-model"),i={day:{url:"http://map1.vis.earthdata.nasa.gov/wmts-webmerc/MODIS_Terra_CorrectedReflectance_TrueColor/default/<%- date %>/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpeg",limit:"2012-05-01",default:"2012-05-01",attribution:'<a href="http://earthdata.nasa.gov/gibs" target="_blank">NASA EOSDIS GIBS</a>',name:"NASA Terra",maxZoom:9,minZoom:1},night:{url:"http://map1.vis.earthdata.nasa.gov/wmts-webmerc/VIIRS_CityLights_2012/default/<%- date %>/GoogleMapsCompatible_Level8/{z}/{y}/{x}.jpeg",limit:"2012-05-01",default:"2012-05-02",attribution:'<a href="http://earthdata.nasa.gov/gibs" target="_blank">NASA EOSDIS GIBS</a>',name:"NASA Earth at night",maxZoom:8,minZoom:1}};b.exports=e.Model.extend({defaults:{name:"nasa",label:"NASA",layer:void 0,layerType:"day",date:void 0,current:void 0,format:"Y-m-d"},initialize:function(){this._initBinds()},createView:function(a){if(!a.submitButton)throw new Error("submitButton is required");this._submitButton=a.submitButton;var b=(new Date).getTimezoneOffset(),c=f(new Date).utcOffset(b).format("YYYY-MM-DD"),d=f(new Date).utcOffset(b).subtract(1,"days").format("YYYY-MM-DD");return this.set({current:c,date:d}),new g({model:this,submitButton:this._submitButton})},hasAlreadyAddedLayer:function(a){var b=this.get("layer").get("urlTemplate");return d.any(a.isCustomCategory(),function(a){return a.get("urlTemplate")===b})},_initBinds:function(){this.bind("change:date change:layerType",this._onChange,this)},_onChange:function(){var a=this.get("date"),b=this.get("layerType"),c=d.template(i[b].url)({date:a}),e=i[b].name;"day"===b&&(e=e+" "+a);var f=new h({urlTemplate:c,attribution:i[b].attribution,maxZoom:i[b].maxZoom,minZoom:i[b].minZoom,name:e,category:"NASA",type:"Tiled"});f.set("className",f._generateClassName(c)),this.set("layer",f)}})},{"../../../../data/custom-baselayer-model":619,"./nasa-view":276,backbone:"backbone",moment:"moment",underscore:"underscore"}],276:[function(a,b,c){var d=a("jquery"),e=a("moment"),f=a("backbone/core-view"),g=a("../../../../components/date-picker/date-picker-view"),h=a("../../../../components/date-picker/edit-field-model"),i=a("../../../../components/tipsy-tooltip-view"),j=a("./nasa.tpl");b.exports=f.extend({options:{dateFormat:"YYYY-MM-DD"},events:{"click .js-day":"_onChangeToDay","click .js-night":"_onChangeToNight"},initialize:function(a){if(!a.submitButton)throw new Error("submitButton is required");this._submitButton=a.submitButton,this.dateModel=new h({value:this.model.get("date"),type:"date"}),this._initBinds()},render:function(){return this.clearSubViews(),this._updateOkBtn(),this._disableOkBtn(!1),this.$el.html(j({layerType:this.model.get("layerType")})),this._renderDatePicker(),this},_initBinds:function(){this.model.bind("change:layerType",function(){this.dateModel.set("readOnly","night"===this.model.get("layerType")),this.render()},this),this.dateModel.bind("change:value",function(){var a=e(this.dateModel.get("value")).format(this.options.dateFormat);this.model.set("date",a)},this),this.add_related_model(this.dateModel)},_renderDatePicker:function(){var a=this.datepicker=new g({className:"DatePicker DatePicker--withBorder",model:this.dateModel});if(this._$datePicker().html(a.render().el),this.addView(a),this.dateModel.get("readOnly")){var b=new i({el:this._$datePicker(),title:function(a){return d(this).attr("data-title")}});this.addView(b)}},_onChangeToNight:function(){this.model.set("layerType","night")},_onChangeToDay:function(){this.model.set("layerType","day")},_$datePicker:function(){return this.$(".js-datePicker")},_updateOkBtn:function(){this._submitButton.find("span").text(_t("components.modals.add-basemap.add-btn"))},_disableOkBtn:function(a){this._submitButton.toggleClass("is-disabled",a)}})},{"../../../../components/date-picker/date-picker-view":64,"../../../../components/date-picker/edit-field-model":66,"../../../../components/tipsy-tooltip-view":589,"./nasa.tpl":277,"backbone/core-view":1127,jquery:"jquery",moment:"moment"}],277:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter Modal-basemapContainer">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor Modal-titleBasemap">'+(null==(__t=_t("components.modals.add-basemap.nasa.select"))?"":_.escape(__t))+'</h3>\n  <div class="CDB-Text u-flex u-alignCenter">\n    <div class="Form-rowData Form-rowData--short Form-rowData--alignLeft">\n      <div class="Form-rowData Form-rowData--full">\n        <div class="RadioButton js-day">\n          <button type="button" class="RadioButton-input ',"day"===layerType&&(__p+="is-checked"),__p+='"></button>\n          <label class="Metadata-label Metadata-label--auto CDB-Text CDB-Size-small is-semibold u-upperCase u-ellipsis" for="nasa-type-day">'+(null==(__t=_t("components.modals.add-basemap.nasa.day"))?"":_.escape(__t))+'</label>\n        </div>\n      </div>\n      <div class="Form-rowData Form-rowData--full">\n        <div class="RadioButton js-night">\n          <button type="button" class="RadioButton-input ',"night"===layerType&&(__p+="is-checked"),__p+='"/></button>\n          <label class="Metadata-label Metadata-label--auto CDB-Text CDB-Size-small is-semibold u-upperCase u-ellipsis" for="nasa-type-night">'+(null==(__t=_t("components.modals.add-basemap.nasa.night"))?"":_.escape(__t))+'</label>\n        </div>\n      </div>\n    </div>\n    <div class="Form-rowData Form-rowData--short">\n      <div class="js-datePicker" data-title="'+(null==(__t=_t("components.modals.add-basemap.nasa.cant-select"))?"":_.escape(__t))+'"></div>\n    </div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],278:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../scroll/scroll-view"),f=a("jquery"),g=a("./tabs.tpl");b.exports=d.extend({events:{"click .js-tabs button":"_onClickTab"},attributes:function(){return{class:"Modal-outer"}},initialize:function(a){if(!a.submitButton)throw new Error("submitButton is required");if(!a.modalFooter)throw new Error("modalFooter is required");this._submitButton=a.submitButton,this._modalFooter=a.modalFooter,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g({model:this.model})),this._initViews(),this},_initViews:function(){var a=new e({className:"ScrollView ScrollView--withoutMargins",createContentView:function(){return this._createTabContentView()}.bind(this)});this.addView(a),this.$(".js-tab-content").append(a.render().el)},_initBinds:function(){this.model.bind("change:currentTab",this.render,this)},_createTabContentView:function(){return this._currentTabView&&this._currentTabView.clean(),this._currentTabView=this.model.activeTabModel().createView({submitButton:this._submitButton,modalFooter:this._modalFooter}),this.addView(this._currentTabView),this._currentTabView.render()},_onClickTab:function(a){this.killEvent(a);var b=f(a.target).closest("button").data("name");if(!b)throw new Error("tab name was expected but was empty");this.model.set("currentTab",b)}})},{"../../scroll/scroll-view":530,"./tabs.tpl":279,"backbone/core-view":1127,jquery:"jquery"}],279:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"");
};with(obj||{})__p+='<div class="Modal-navigation">\n  <ul class="Modal-navigationInner CDB-Text is-semibold CDB-Size-medium js-tabs">\n    ',model.get("tabs").each(function(a){__p+='\n      <li class="CDB-NavMenu-item '+(null==(__t=model.get("currentTab")===a.get("name")?"is-selected":"")?"":_.escape(__t))+'">\n        <button data-name="'+(null==(__t=a.get("name"))?"":_.escape(__t))+'" class="CDB-NavMenu-link u-upperCase">\n          '+(null==(__t=a.get("label"))?"":_.escape(__t))+"\n        </button>\n      </li>\n    "}),__p+='\n  </ul>\n</div>\n<div class="Modal-inner Modal-inner--with-navigation js-tab-content"></div>\n';return __p}},{underscore:"underscore"}],280:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter Modal-basemapContainer">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor Modal-titleBasemap">'+(null==(__t=_t("components.modals.add-basemap.tilejson.insert"))?"":_.escape(__t))+'</h3>\n  <div class="CDB-Text u-flex u-alignCenter">\n    <label class="Metadata-label Metadata-label--auto  CDB-Text CDB-Size-small is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.add-basemap.xyz.enter"))?"":_.escape(__t))+'</label>\n    <div class="Form-rowData Form-rowData--longer">\n      <input type="text" class="has-icon CDB-InputText CDB-Text js-url" value="" placeholder="'+(null==(__t=_t("components.modals.add-basemap.xyz.eg"))?"":_.escape(__t))+' http://domain.com/tiles.json?foo=bar">\n      <i class="CDB-IconFont CDB-IconFont-dribbble Form-inputIcon js-idle"></i>\n      <i class="Spinner XYZPanel-inputIcon Spinner--formIcon Form-inputIcon js-validating" style="display: none;"></i>\n      <div class="XYZPanel-error CDB-InfoTooltip CDB-InfoTooltip--left is-error CDB-Text CDB-Size-medium CDB-InfoTooltip-text js-error"></div>\n    </div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],281:[function(a,b,c){var d=a("backbone"),e=a("../../../../data/custom-baselayer-model");b.exports=d.Model.extend({url:function(){return this.get("tilejson_url")},newTileLayer:function(){if(!this._isFetched())throw new Error("no tiles, have fetch been called and returned a successful resultset?");var a=this._urlTemplate(),b=new e({urlTemplate:a,attribution:this.get("attribution"),maxZoom:this.get("maxzoom"),minZoom:this.get("minzoom"),name:this._name(),bounding_boxes:this.get("bounds"),tms:"tms"===this.get("scheme"),category:"TileJSON",type:"Tiled"});return b.set("className",b._generateClassName(a)),b},setUrl:function(a){this.set("tilejson_url",a)},_isFetched:function(){return this.get("tiles").length>0},_urlTemplate:function(){return this.get("tiles")[0]},_name:function(){return this.get("name")||this.get("description")}})},{"../../../../data/custom-baselayer-model":619,backbone:"backbone"}],282:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./tilejson-view"),g=a("./tilejson-layer-model");b.exports=e.Model.extend({defaults:{name:"tilejson",label:"TileJSON",layer:void 0},createView:function(a){if(!a.submitButton)throw new Error("submitButton is required");this._submitButton=a.submitButton;var b=new g;return new f({model:this,submitButton:this._submitButton,tileJSONLayerModel:b})},hasAlreadyAddedLayer:function(a){var b=this.get("layer").get("urlTemplate");return d.any(a.isCustomCategory(),function(a){return a.get("urlTemplate")===b})}})},{"./tilejson-layer-model":281,"./tilejson-view":283,backbone:"backbone",underscore:"underscore"}],283:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./enter-url.tpl");b.exports=e.extend({events:{"keydown .js-url":"_onKeydown","paste .js-url":"_onPaste"},initialize:function(a){if(!a.submitButton)throw new Error("submitButton is required");if(!a.tileJSONLayerModel)throw new Error("tileJSONLayerModel is required");this._submitButton=a.submitButton,this._tileJSONLayerModel=a.tileJSONLayerModel,this._lastURL="",this._debouncedUpdate=d.debounce(this._update.bind(this),150)},render:function(){return this._updateOkBtn(),this._disableOkBtn(!0),this.$el.html(f()),this},_onKeydown:function(a){a.stopPropagation(),this._debouncedUpdate()},_onPaste:function(a){a.stopPropagation(),this._debouncedUpdate()},_update:function(){var a=this;this._disableOkBtn(!0),this._indicateIsValidating(!0);var b=this._urlWithHTTP();return b===this._lastURL?(this._indicateIsValidating(!1),void this._updateError()):(this._lastURL=b,this._indicateIsValidating(!0),this._tileJSONLayerModel.setUrl(b),void this._tileJSONLayerModel.fetch({success:function(c){b===a._lastURL&&(a.model.set("layer",c.newTileLayer()),a._disableOkBtn(!1),a._indicateIsValidating(!1),a._updateError())},error:function(){b===a._lastURL&&(a._indicateIsValidating(!1),a._updateError(_t("components.modals.add-basemap.tilejson.invalid")))}}))},_updateOkBtn:function(){this._submitButton.find("span").text(_t("components.modals.add-basemap.add-btn"))},_disableOkBtn:function(a){this._submitButton.toggleClass("is-disabled",a)},_updateError:function(a){this.$(".js-error").text(a)[a?"addClass":"removeClass"]("is-visible")},_indicateIsValidating:function(a){a?(this.$(".js-idle").hide(),this.$(".js-validating").show()):(this.$(".js-validating").hide(),this.$(".js-idle").show())},_urlWithHTTP:function(){var a=this.$(".js-url").val();return a.indexOf("http://")===-1&&a.indexOf("https://")===-1?"http://"+a:a}})},{"./enter-url.tpl":280,"backbone/core-view":1127,underscore:"underscore"}],284:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter Modal-basemapContainer">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor Modal-titleBasemap">'+(null==(__t=_t("components.modals.add-basemap.wms.insert"))?"":_.escape(__t))+'</h3>\n  <div class="CDB-Text u-flex u-alignCenter">\n    <label class="Metadata-label Metadata-label--auto  CDB-Text CDB-Size-small is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.add-basemap.xyz.enter"))?"":_.escape(__t))+'</label>\n    <div class="Form-rowData Form-rowData--longer">\n      <input type="text" class="has-icon CDB-InputText CDB-Text js-url" value="" placeholder="'+(null==(__t=_t("components.modals.add-basemap.xyz.eg"))?"":_.escape(__t))+' http://openlayers.org/en/v3.5.0/examples/data/ogcsample.xml">\n      <i class="CDB-IconFont CDB-IconFont-dribbble Form-inputIcon js-idle"></i>\n      <i class="Spinner XYZPanel-inputIcon XYZPanel-inputIcon--loader Spinner--formIcon Form-inputIcon js-validating" style="display: none;"></i>\n      <div class="XYZPanel-error CDB-InfoTooltip CDB-InfoTooltip--left is-error CDB-Text CDB-Size-medium CDB-InfoTooltip-text js-error '+(null==(__t=layersFetched&&0===layers.length?"is-visible":"")?"":_.escape(__t))+'">\n        ',layersFetched&&0===layers.length&&(__p+="\n          "+(null==(__t=_t("components.modals.add-basemap.wms.invalid"))?"":_.escape(__t))+"\n        "),__p+="\n      </div>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],285:[function(a,b,c){var d=a("backbone/core-view"),e=a("./select-layer.tpl"),f=a("./wms-layers-view");b.exports=d.extend({events:{"click .js-back":"_onClickBack"},initialize:function(a){if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");this._customBaselayersCollection=a.customBaselayersCollection},render:function(){return this.clearSubViews(),this.$el.html(e({searchQuery:this.model.get("searchQuery"),layersFound:this.model.getLayers(),layersAvailableCount:this.model.layersAvailableCount()})),this._initViews(),this},_initViews:function(){var a=new f({model:this.model,customBaselayersCollection:this._customBaselayersCollection});this.addView(a),this.$(".js-layers").append(a.render().el)},_onClickBack:function(a){this.killEvent(a),this.model.set("currentView","enterURL")}})},{"./select-layer.tpl":286,"./wms-layers-view":291,"backbone/core-view":1127}],286:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-inner">\n  <div class="Filters WMSSSelectLayer-Filter is-relative">\n    <div class="Filters-inner">\n      <div class="Filters-row">\n        <div class="Filters-group">\n          <div class="Filters-typeItem Filters-typeItem--searchEnabler">\n            <button class="Filters-searchLink CDB-Text is-semibold u-upperCase CDB-Size-medium js-search-link">\n              <i class="Filters-searchLinkIcon CDB-IconFont CDB-IconFont-lens"></i>'+(null==(__t=_t("components.modals.add-layer.navigation.search"))?"":_.escape(__t))+'\n            </button>\n          </div>\n        </div>\n\n        <div class="Filters-typeItem Filters-typeItem--searchField">\n          <form class="Filters-searchForm js-search-form" action="#">\n            <input class="Filters-searchInput CDB-Text CDB-Size-medium js-search-input" type="text" value="'+(null==(__t=searchQuery)?"":_.escape(__t))+'" placeholder="'+(null==(__t=_t("components.modals.add-basemap.wms.placeholder",{layersFoundCount:layersFound.length,layersFoundCountPluralize:_t("components.modals.add-basemap.wms.tables-pluralize",{smart_count:layersFound.length}),layersAvailableCount:layersAvailableCount,layersAvailableCountPluralize:_t("components.modals.add-basemap.wms.tables-pluralize",{smart_count:layersAvailableCount})}))?"":_.escape(__t))+'" />\n            <button type="button" class="Filters-cleanSearch js-clean-search u-actionTextColor">\n              <i class="CDB-IconFont CDB-IconFont-close"></i>\n            </button>\n          </form>\n        </div>\n\n        <span class="Filters-separator"></span>\n      </div>\n    </div>\n  </div>\n\n  ',__p+=searchQuery&&0==layersFound.length?'\n    <div class="IntermediateInfo">\n      <div class="LayoutIcon">\n        <i class="CDB-IconFont CDB-IconFont-defaultUser"></i>\n      </div>\n      <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-bSpace u-secondaryTextColor u-tSpace-xl">'+(null==(__t=_t("components.modals.add-basemap.wms.oh-no"))?"":_.escape(__t))+'</h4>\n      <p class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.add-basemap.wms.unfortunately"))?"":_.escape(__t))+"</p>\n    </div>\n  ":'\n    <div class="js-layers"></div>\n  ',__p+='\n</div>\n\n<button class="NavButton Dialog-backBtn js-back">\n  <i class="CDB-IconFont CDB-IconFont-arrowPrev"></i>\n</button>\n';return __p}},{underscore:"underscore"}],287:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../../../../data/custom-baselayer-model");b.exports=e.Model.extend({defaults:{state:"idle"},url:function(){return this._wmsService.saveLayerURL({title:this.get("title"),name:this.get("name"),layer:this.get("name"),srs:this.get("srs"),bounding_boxes:this.get("llbbox"),type:this.get("type"),matrix_sets:this.get("matrix_sets")})},sync:function(a,b,c){return c=c||{},c.url=this.url(a.toLowerCase()),c.dataType="jsonp",a="READ",e.sync.apply(this,arguments)},initialize:function(a,b){if(!b.wmsService)throw new Error("wmsService is required");this._wmsService=b.wmsService},canSave:function(a){return!d.any(a.isCustomCategory(),function(a){return a.get("name")===this.get("title")},this)},createProxiedLayerOrCustomBaselayerModel:function(){this.set("state","saving"),this._shouldBeProxied()?this._createProxiedLayer():this._newCustomBaselayerModel()},_shouldBeProxied:function(){if("wmts"===this.get("type")){var a=this._wmsService.supportedMatrixSets(this.get("matrix_sets")||[]);return a.length>0}return!0},_createProxiedLayer:function(){var a=this;this.save({},{success:function(){var b;try{b=a._newProxiedBaselayerModel()}catch(a){}b?a._setCustomBaselayerModel(b):a.set("state","saveFail")},error:function(b){a.set("state","saveFail")}})},_newCustomBaselayerModel:function(){var a=this._byCustomURL(this._xyzURLTemplate());return a.set({name:this.get("title")||this.get("name"),attribution:this.get("attribution"),bounding_boxes:this.get("llbbox")}),this._setCustomBaselayerModel(a),a},_newProxiedBaselayerModel:function(){if(!this.get("mapproxy_id"))throw new Error("mapproxy_id must be set");var a=this._wmsService.getProxyTilesURL()+"/"+this.get("mapproxy_id")+"/wmts/map/webmercator/{z}/{x}/{y}.png",b=this._generateCustomBaselayerModel(a);return b.set({name:this.get("title")||this.get("name"),attribution:this.get("attribution"),proxy:!0,bounding_boxes:this.get("bounding_boxes")}),b},_generateCustomBaselayerModel:function(a){var b=new f({urlTemplate:a,attribution:null,maxZoom:21,minZoom:0,name:"",category:"WMS",tms:!1,type:"Tiled"});return b.set("className",b._generateClassName(a)),b},_byCustomURL:function(a){if(a&&a.indexOf("/")===-1)throw new TypeError("invalid URL");a=a.replace(/\{S\}/g,"{s}").replace(/\{X\}/g,"{x}").replace(/\{Y\}/g,"{y}").replace(/\{Z\}/g,"{z}");var b=this._generateCustomBaselayerModel(a);return b},_xyzURLTemplate:function(){var a=this.get("url_template")||"";return a.replace(/%%\((\w)\)s/g,"{$1}")},_setCustomBaselayerModel:function(a){this.set({state:"saveDone",customBaselayerModel:a})}})},{"../../../../data/custom-baselayer-model":619,backbone:"backbone",underscore:"underscore"}],288:[function(a,b,c){var d=a("backbone/core-view"),e=a("./wms-layer.tpl");b.exports=d.extend({tagName:"li",className:"List-row",events:{"click .js-add":"_onClickAdd"},initialize:function(a){if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");this._customBaselayersCollection=a.customBaselayersCollection},render:function(){return this.$el.html(e({model:this.model,canSave:this.model.canSave(this._customBaselayersCollection)})),this},_onClickAdd:function(a){this.killEvent(a),this.model.canSave(this._customBaselayersCollection)&&this.model.createProxiedLayerOrCustomBaselayerModel()}})},{"./wms-layer.tpl":289,"backbone/core-view":1127}],289:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="List-rowItem">\n  <div class="DefaultTitle '+(null==(__t=canSave?"":"is-disabled")?"":_.escape(__t))+'">'+(null==(__t=model.get("title")||model.get("name"))?"":_.escape(__t))+'</div>\n  <button class="js-add Button Button--secondary Button--secondaryTransparentBkg '+(null==(__t=canSave?"":"is-disabled")?"":_.escape(__t))+'">\n    <span>Add this</span>\n  </button>\n</div>\n';return __p}},{underscore:"underscore"}],290:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./wms-layer-model");b.exports=e.Collection.extend({model:function(a,b){var c=b.collection;return new f(a,{wmsService:c._wmsService})},parse:function(a){var b=[];return a.layers&&(b=d.map(a.layers,function(b){return d.extend({type:a.type||"wms"},b)})),b},sync:function(a,b,c){return c=c||{},c.url=this.url(a.toLowerCase()),c.dataType="jsonp",a="READ",e.sync.apply(this,arguments)},url:function(){return this._wmsService.getFetchLayersURL()},initialize:function(a,b){if(!b.wmsService)throw new Error("wmsService is required");this._wmsService=b.wmsService}})},{"./wms-layer-model":287,backbone:"backbone",underscore:"underscore"}],291:[function(a,b,c){var d=a("./wms-layer-view"),e=a("backbone/core-view");b.exports=e.extend({className:"List",tagName:"ul",initialize:function(a){if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");if(!this.model)throw new Error("model is required");this._customBaselayersCollection=a.customBaselayersCollection},render:function(){return this.clearSubViews(),this.$el.append.apply(this.$el,this._renderedLayers()),this},_renderedLayers:function(){return this.model.getLayers().map(function(a){var b=new d({model:a,customBaselayersCollection:this._customBaselayersCollection});return this.addView(b),b.render().el},this)}})},{"./wms-layer-view":288,"backbone/core-view":1127}],292:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./wms-view"),g=a("./wms-layers-collection"),h=a("../../../../data/wms-service");b.exports=d.Model.extend({defaults:{name:"wms",label:"WMS/WMTS",currentView:"enterURL",layersFetched:!1,layer:void 0},initialize:function(a,b){if(!b.customBaselayersCollection)throw new Error("customBaselayersCollection is required");this._customBaselayersCollection=b.customBaselayersCollection,this.wmsService=new h,this.wmsLayersCollection=new g(null,{wmsService:this.wmsService}),this._initBinds()},_initBinds:function(){this.wmsLayersCollection.bind("change:state",this._onLayerStateChange,this),this.wmsLayersCollection.bind("reset",function(){this.set({currentView:this.wmsLayersCollection.length>0?"selectLayer":"enterURL",layersFetched:!0}),this.trigger("layersFetched")},this)},createView:function(a){if(!a.submitButton)throw new Error("submitButton is required");if(!a.modalFooter)throw new Error("modalFooter is required");return this._submitButton=a.submitButton,this._modalFooter=a.modalFooter,this.set({currentView:"enterURL",layersFetched:!1}),new f({model:this,customBaselayersCollection:this._customBaselayersCollection,submitButton:this._submitButton,modalFooter:this._modalFooter})},fetchLayers:function(a){this.set("currentView","fetchingLayers"),this.wmsService.setUrl(a),this.wmsLayersCollection.fetch({reset:!0})},layersAvailableCount:function(){return e.difference(this.wmsLayersCollection.pluck("title"),this._customBaselayersCollection.pluck("name")).length},get:function(a){if("layer"===a){var b=this.wmsLayersCollection.find(function(a){return"saveDone"===a.get("state")});return b&&b.get("customBaselayerModel")}return d.Model.prototype.get.apply(this,arguments)},getLayers:function(){if(this.get("searchQuery")){var a=new RegExp(this.get("searchQuery"),"i");return this.wmsLayersCollection.filter(function(b){return b.get("name").match(a)},this)}return this.wmsLayersCollection},hasAlreadyAddedLayer:function(){return!1},_onLayerStateChange:function(a,b){switch(b){case"saving":this.set("currentView","savingLayer");break;case"saveDone":this.set("layer",a.get("customBaselayerModel")),this.trigger("saveBasemap");break;case"saveFail":this.set("currentView","saveFail");break;default:this.set("currentView","selectLayer")}}})},{"../../../../data/wms-service":682,"./wms-layers-collection":290,"./wms-view":293,backbone:"backbone",underscore:"underscore"}],293:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./select-layer-view"),g=a("../../../view-factory"),h=a("../../../error/error-view"),i=a("../../../loading/render-loading"),j=a("./enter-url.tpl"),k=a("jquery");b.exports=d.extend({events:{"keydown .js-search-input":"_onKeyDown","submit .js-search-form":"killEvent","keydown .js-url":"_onKeydown","paste .js-url":"_onPaste","click .js-clean-search":"_onCleanSearchClick","click .js-search-link":"_submitSearch"},initialize:function(a){if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");if(!a.submitButton)throw new Error("submitButton is required");if(!a.modalFooter)throw new Error("modalFooter is required");this._customBaselayersCollection=a.customBaselayersCollection,this._submitButton=a.submitButton,this._modalFooter=a.modalFooter,this._debouncedUpdate=e.debounce(this._update.bind(this),150),this._onClickBinded=this._onClickOK.bind(this),this._bindSubmitButton(),this._initBinds()},render:function(){this.clearSubViews(),this._updateOkBtn(),this._disableOkBtn(!0);var a;switch(this.model.get("currentView")){case"savingLayer":this._disableModalFooter(!0),a=g.createByHTML(i({title:_t("components.modals.add-basemap.saving")}));break;case"selectLayer":this._disableModalFooter(!0),a=new f({model:this.model,customBaselayersCollection:this._customBaselayersCollection});break;case"saveFail":this._disableModalFooter(!0),a=new h({title:_t("components.modals.add-basemap.add-basemap-error")});break;case"fetchingLayers":this._disableModalFooter(!0),a=g.createByHTML(i({title:_t("components.modals.add-basemap.fetching")}));break;case"enterURL":default:this._disableModalFooter(!1),a=g.createByHTML(j({layersFetched:this.model.get("layersFetched"),layers:this.model.wmsLayersCollection}))}return this.addView(a),this.$el.append(a.render().el),this.$(".js-search-input").focus(),this},_showCleanSearchButton:function(){this.$(".js-clean-search").show()},_hideCleanSearchButton:function(){this.$(".js-clean-search").hide()},_initBinds:function(){this.model.bind("change",this.render,this),this.model.bind("change",this._onChangeSearchQuery,this),this.model.bind("layersFetched",this.render,this)},_onKeydown:function(a){a.stopPropagation(),this._debouncedUpdate()},_onPaste:function(a){a.stopPropagation(),this._debouncedUpdate()},_update:function(a){this._disableOkBtn(!this.$(".js-url").val()),this.$(".js-error").removeClass("is-visible")},_disableOkBtn:function(a){this._submitButton.toggleClass("is-disabled",a)},_onKeyDown:function(a){var b=a.keyCode===k.ui.keyCode.ENTER;b&&(this.killEvent(a),this._submitSearch())},_submitSearch:function(a){this.killEvent(a),this.model.set("searchQuery",this.$(".js-search-input").val())},_onChangeSearchQuery:function(){var a=this.model.get("searchQuery");a||this._hideCleanSearchButton()},_onCleanSearchClick:function(a){this.killEvent(a),this.model.set("searchQuery","")},_onClickOK:function(a){this.killEvent(a);var b=this.$(".js-url").val();b&&this.model.fetchLayers(b)},_disableModalFooter:function(a){this._modalFooter.toggleClass("is-disabled",a)},_updateOkBtn:function(){this._submitButton.find("span").text(_t("components.modals.add-basemap.get-layers"))},_bindSubmitButton:function(){this._submitButton.on("click",this._onClickBinded)},_unBindSubmitButton:function(){this._submitButton.off("click",this._onClickBinded)},clean:function(){this._unBindSubmitButton(),d.prototype.clean.call(this)}})},{"../../../error/error-view":67,"../../../loading/render-loading":230,"../../../view-factory":594,"./enter-url.tpl":284,"./select-layer-view":285,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],294:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter Modal-basemapContainer">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor Modal-titleBasemap">'+(null==(__t=_t("components.modals.add-basemap.xyz.insert"))?"":_.escape(__t))+'</h3>\n  <div class="CDB-Text u-flex u-alignCenter">\n    <label class="Metadata-label Metadata-label--auto  CDB-Text CDB-Size-small is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.add-basemap.xyz.enter"))?"":_.escape(__t))+'</label>\n    <div class="Form-rowData Form-rowData--longer">\n      <input type="text" class="has-icon CDB-InputText CDB-Text js-url" value="" placeholder="E.g. https://{s}.carto.com/foobar/{z}/{x}/{y}.png">\n      <i class="Spinner XYZPanel-inputIcon XYZPanel-inputIcon--loader Spinner--formIcon Form-inputIcon js-validating" style="display: none;"></i>\n      <div class="Checkbox XYZPanel-inputCheckbox js-tms" data-title="Inverts Y axis numbering for tiles">\n        <button class="Checkbox-input u-rSpace--m"></button>\n        <label class="CDB-Text CDB-Size-small is-semibold u-upperCase">'+(null==(__t=_t("components.modals.add-basemap.xyz.tms"))?"":_.escape(__t))+'</label>\n      </div>\n      <div class="XYZPanel-error CDB-InfoTooltip CDB-InfoTooltip--left is-error CDB-Text CDB-Size-medium CDB-InfoTooltip-text js-error"></div>\n    </div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],295:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./xyz-view");b.exports=e.Model.extend({defaults:{name:"xyz",label:"XYZ",tms:!1,layer:void 0},createView:function(a){if(!a.submitButton)throw new Error("submitButton is required");if(!a.modalFooter)throw new Error("modalFooter is required");return this._submitButton=a.submitButton,this._modalFooter=a.modalFooter,new f({model:this,submitButton:this._submitButton,modalFooter:this._modalFooter})},hasAlreadyAddedLayer:function(a){var b=this.get("layer").get("urlTemplate");return d.any(a.isCustomCategory(),function(a){return a.get("urlTemplate")===b})}})},{"./xyz-view":296,backbone:"backbone",underscore:"underscore"}],296:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("./enter-url.tpl"),h=a("../../../../data/custom-baselayer-model"),i=a("../../../../components/tipsy-tooltip-view");b.exports=f.extend({className:"XYZPanel",events:{"click .js-tms":"_changeTMS","keydown .js-url":"_onKeydown","paste .js-url":"_onPaste"},initialize:function(a){if(!a.submitButton)throw new Error("submitButton is required");this._submitButton=a.submitButton,this._lastCallSeq=0,this._debouncedUpdate=e.debounce(this._update.bind(this),150),this._initBinds()},render:function(){return this.clearSubViews(),this._updateOkBtn(),this._disableOkBtn(!0),this.$el.html(g()),this._initViews(),this},_initViews:function(){var a=new i({el:this.$(".js-tms"),title:function(){return d(this).data("title")}});this.addView(a)},_onKeydown:function(a){a.stopPropagation(),this._debouncedUpdate()},_onPaste:function(a){a.stopPropagation(),this._debouncedUpdate()},_initBinds:function(){this.model.bind("change:tms",this._setTMSCheckbox,this)},_update:function(){this._disableOkBtn(!0),this._indicateIsValidating(!0);var a,b,c=this.$(".js-url").val(),d=this.model.get("tms");if(c)try{a=this._byCustomURL(c,d)}catch(a){b=_t("components.modals.add-basemap.xyz.not-valid")}if(this.model.set("layer",a),a){var e=this,f=++this._lastCallSeq;a.validateTemplateURL({success:function(){f===e._lastCallSeq&&(e._disableOkBtn(!1),e._indicateIsValidating(!1),e._updateError())},error:function(){f===e._lastCallSeq&&(e._disableOkBtn(!1),e._indicateIsValidating(!1),e._updateError(_t("components.modals.add-basemap.xyz.couldnt-validate")))}})}else c?(this._indicateIsValidating(!1),this._updateError(b)):(this._indicateIsValidating(!1),this._updateError())},_changeTMS:function(a){this.model.set("tms",!this.model.get("tms")),this._onKeydown(a)},_setTMSCheckbox:function(a){this.$(".js-tms .Checkbox-input").toggleClass("is-checked",this.model.get("tms"))},_byCustomURL:function(a,b){if(a&&a.indexOf("/")===-1)throw new TypeError("invalid URL");a=a.replace(/\{S\}/g,"{s}").replace(/\{X\}/g,"{x}").replace(/\{Y\}/g,"{y}").replace(/\{Z\}/g,"{z}");var c=new h({urlTemplate:a,attribution:null,maxZoom:21,minZoom:0,name:"",tms:b,category:"Custom",type:"Tiled"});return c.set("className",c._generateClassName(a)),c},_setTMS:function(a){var b=d(a.target).closest(".Checkbox");b.find(".Checkbox-input").toggleClass("is-checked"),this._update(a)},_updateOkBtn:function(){this._submitButton.find("span").text(_t("components.modals.add-basemap.add-btn"))},_disableOkBtn:function(a){this._submitButton.toggleClass("is-disabled",a)},_updateError:function(a){this.$(".js-error").text(a)[a?"addClass":"removeClass"]("is-visible")},_indicateIsValidating:function(a){this.$(".js-validating").toggle(!!a)}})},{"../../../../components/tipsy-tooltip-view":589,"../../../../data/custom-baselayer-model":619,"./enter-url.tpl":294,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],297:[function(a,b,c){var d=a("backbone"),e=a("../../../data/upload-model"),f=a("../../../data/visualizations-fetch-model"),g=a("../../../data/visualizations-collection"),h=a("../../../data/table-model");b.exports=d.Model.extend({defaults:{type:"addLayer",contentPane:"listing",listing:"datasets",collectionFetched:!1,activeImportPane:"file"},initialize:function(a,b){if(!b.userModel)throw new Error("userModel is required");if(!b.configModel)throw new Error("configModel is required");if(!b.userActions)throw new Error("userActions is required");if(!b.pollingModel)throw new Error("pollingModel is required");this._userModel=b.userModel,this._userActions=b.userActions,this._configModel=b.configModel,this._pollingModel=b.pollingModel,this._uploadModel=new e({create_vis:!1},{userModel:this._userModel,configModel:this._configModel}),this._selectedDatasetsCollection=new d.Collection,this._tablesCollection=new g([],{configModel:this._configModel}),this._visualizationFetchModel=new f({content_type:"datasets",library:this.showLibrary()}),this._initBinds(),this._fetchCollection()},getTablesCollection:function(){return this._tablesCollection},getSelectedDatasetsCollection:function(){return this._selectedDatasetsCollection},getVisualizationFetchModel:function(){return this._visualizationFetchModel},getUploadModel:function(){return this._uploadModel},canSelect:function(a){return a.get("selected")||this._selectedDatasetsCollection.length<1},showLibrary:function(){return!1},showDatasets:function(){return!0},setActiveImportPane:function(a){this.set("activeImportPane",a)},canFinish:function(){return"import"===this.get("listing")?this._uploadModel.isValidToUpload():"datasets"===this.get("listing")?this._selectedDatasetsCollection.length>0:void 0},finish:function(){if("import"===this.get("listing"))this._pollingModel.trigger("importByUploadData",this._uploadModel.toJSON(),this);else if("datasets"===this.get("listing")){var a=this._selectedDatasetsCollection.at(0);if("remote"===a.get("type")){var b={create_vis:!1,type:"remote",value:a.get("name"),remote_visualization_id:a.get("id"),size:a.get("external_source")?a.get("external_source").size:void 0};this._pollingModel.trigger("importByUploadData",b,this)}else this._addNewLayer(a.getTableModel())}},getImportState:function(){return this.get("activeImportPane")},showGuessingToggler:function(){return"import"===this.get("listing")},showPrivacyToggler:function(){return"import"===this.get("listing")},createFromScratch:function(){var a=this;this.set("contentPane","creatingFromScratch");var b=new h({},{configModel:this._configModel});b.save({},{success:function(){a._addNewLayer(b)},error:function(){a.set("contentPane","addLayerFailed")}})},_initBinds:function(){this._uploadModel.bind("change",function(){this.trigger("change:upload",this)},this),this._visualizationFetchModel.bind("change",this._fetchCollection,this),this.bind("change:listing",this._fetchCollection,this),this._tablesCollection.bind("change:selected",function(a,b){this._selectedDatasetsCollection[b?"add":"remove"](a)},this),this._tablesCollection.bind("sync",function(){this._selectedDatasetsCollection.each(function(a){var b=this._tablesCollection.get(a.id);b&&b.set("selected",!0)},this)},this)},_fetchCollection:function(){var a,b=this._visualizationFetchModel.attributes;a=this._visualizationFetchModel.isSearching()?"table,remote":b.library?"remote":"table",this._tablesCollection.fetch({data:{locked:"",q:b.q,page:b.page,tags:b.tag,shared:b.shared,only_liked:b.liked,type:"",types:a}})},_onCollectionChange:function(){this._selectedDatasetsCollection.reset(this._tablesCollection.where({selected:!0}))},_addNewLayer:function(a){this.set("contentPane","addingNewLayer"),this._userActions.createLayerFromTable(a,{success:function(){this.trigger("addLayerDone")}.bind(this),error:function(){this.set("contentPane","addLayerFailed")}.bind(this)})}})},{"../../../data/table-model":665,"../../../data/upload-model":668,"../../../data/visualizations-collection":678,"../../../data/visualizations-fetch-model":679,backbone:"backbone"}],298:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./add-layer.tpl"),g=a("./footer/footer-view"),h=a("./content/navigation-view"),i=a("./content/listing-view"),j=a("../../tab-pane/tab-pane-view"),k=a("../../tab-pane/tab-pane-collection"),l=a("../../view-factory"),m=a("../../loading/render-loading"),n=a("../../error/error-view");b.exports=d.extend({className:"Dialog-content Dialog-content--expanded",initialize:function(a){if(!a.modalModel)throw new TypeError("model is required");
if(!a.createModel)throw new TypeError("createModel is required");if(!a.configModel)throw new TypeError("configModel is required");if(!a.userModel)throw new TypeError("userModel is required");if(!a.pollingModel)throw new TypeError("pollingModel is required");this._modalModel=a.modalModel,this._createModel=a.createModel,this._userModel=a.userModel,this._configModel=a.configModel,this._pollingModel=a.pollingModel,this._initBinds()},render:function(){this.clearSubViews(),this.$el.html(f()),this._initViews()},_initBinds:function(){this._createModel.bind("addLayerDone",this._modalModel.destroy.bind(this._modalModel),this),this._createModel.bind("change:contentPane",this._onChangeContentView,this),this._pollingModel.bind("importByUploadData",this._modalModel.destroy.bind(this._modalModel),this),this.add_related_model(this._pollingModel),this.add_related_model(this._createModel)},_initViews:function(){var a=this;this._navigationView=new h({el:this.$(".js-navigation"),userModel:this._userModel,routerModel:this._createModel.getVisualizationFetchModel(),createModel:this._createModel,tablesCollection:this._createModel.getTablesCollection()}),this._navigationView.render(),this.addView(this._navigationView),this._tabPaneCollection=new k([{name:"listing",selected:"listing"===this._createModel.get("contentPane"),createContentView:function(){return new i({createModel:a._createModel,configModel:a._configModel,userModel:a._userModel})}},{name:"creatingFromScratch",selected:"creatingFromScratch"===this._createModel.get("contentPane"),createContentView:function(){return l.createByHTML(m({title:_t("components.modals.add-layer.create-loading-title")}))}},{name:"addingNewLayer",selected:"addingNewLayer"===this._createModel.get("contentPane"),createContentView:function(){return l.createByHTML(m({title:_t("components.modals.add-layer.adding-new-layer")}))}},{name:"addLayerFailed",selected:"addLayerFailed"===this._createModel.get("contentPane"),createContentView:function(){return new n({title:_t("components.modals.add-layer.add-layer-error")})}}]);var b=new j({collection:this._tabPaneCollection});this.addView(b),this.$(".js-content-container").append(b.render().el),this._footerView=new g({configModel:this._configModel,createModel:this._createModel,userModel:this._userModel}),this.addView(this._footerView),this.$(".js-footer").append(this._footerView.render().el)},_onChangeContentView:function(){var a=this._createModel.get("contentPane"),b=e.first(this._tabPaneCollection.where({name:a})),c=b.get("name");b.set("selected",!0),"loading"===c&&this._footerView.hide(),"listing"!==c&&this._navigationView.hide()}})},{"../../error/error-view":67,"../../loading/render-loading":230,"../../tab-pane/tab-pane-collection":538,"../../tab-pane/tab-pane-view":549,"../../view-factory":594,"./add-layer.tpl":299,"./content/listing-view":362,"./content/navigation-view":363,"./footer/footer-view":365,"backbone/core-view":1127,underscore:"underscore"}],299:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Dialog-header Dialog-header--expanded CreateDialog-header with-separator">\n  <div class="Dialog-headerIcon Dialog-headerIcon--neutral">\n    <i class="CDB-IconFont CDB-IconFont-add"></i>\n  </div>\n  <h2 class="CDB-Text CDB-Size-large u-mainTextColor u-bSpace">'+(null==(__t=_t("components.modals.add-layer.modal-title"))?"":_.escape(__t))+'</h2>\n  <h3 class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.add-layer.modal-desc"))?"":_.escape(__t))+'</h3>\n</div>\n<div class="Filters Filters--navListing Filters--static js-navigation"></div>\n<div class="js-content-container Dialog-body Dialog-body--expanded Dialog-body--create Dialog-body--noPaddingTop Dialog-body--withoutBorder"></div>\n<div class="Dialog-footer Dialog-footer--expanded CreateDialog-footer js-footer"></div>\n';return __p}},{underscore:"underscore"}],300:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../loading/random-quote");b.exports=d.extend({events:{"click .js-connect":"_onConnectClick"},initialize:function(a){if(!a.routerModel)throw new Error("routerModel is required");if(!a.tablesCollection)throw new Error("tablesCollection is required");if(!a.userModel)throw new Error("userModel is required");if(!a.template)throw new Error("template is required");this._userModel=a.userModel,this._routerModel=a.routerModel,this._tablesCollection=a.tablesCollection,this.template=a.template,this._initBinds()},render:function(){var a=this._routerModel.get("content_type");return this.$el.html(this.template({page:this._routerModel.get("page"),tag:this._routerModel.get("tag"),q:this._routerModel.get("q"),shared:this._routerModel.get("shared"),locked:this._routerModel.get("locked"),library:this._routerModel.get("library"),quote:e(),type:a,totalItems:this._tablesCollection.size(),totalEntries:this._tablesCollection.getTotalStat("total_entries")})),this},_initBinds:function(){this._routerModel.bind("change",this.render,this),this._tablesCollection.bind("sync",this.render,this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection)},_onConnectClick:function(){this.trigger("connectDataset",this)}})},{"../../../../loading/random-quote":229,"backbone/core-view":1127}],301:[function(a,b,c){var d=a("cartodb.js"),e=a("backbone/core-view"),f=a("jquery"),g=a("underscore"),h=a("moment"),i=a("../../../../../helpers/utils"),j=a("../../../../tipsy-tooltip-view"),k=a("./dataset-item.tpl"),l=a("../../../../likes/likes-view");b.exports=e.extend({tagName:"li",className:"ModalBlockList-item ModalBlockList-item--full",events:{"click .js-tag-link":"_onTagClick",click:"_toggleSelected"},initialize:function(a){if(!a.createModel)throw new Error("createModel is required");if(!a.userModel)throw new Error("userModel is required");this._createModel=a.createModel,this._userModel=a.userModel,this._routerModel=this._createModel.getVisualizationFetchModel(),this.model.on("change",this.render,this)},render:function(){var a=this.model.getTableModel(),b=this.model.getPermissionModel(),c=this.model.getSynchronizationModel(),e=this.model.get("tags")||[],f=d.core.sanitize.html(this.model.get("description")),j=a.getGeometryType()||[],l={isRaster:this.model.isRaster(),geometryType:j.length>0?j[0]:"",title:this.model.get("name"),isOwner:b.isOwner(this._userModel),owner:b.getOwner().renderData(this._userModel),showPermissionIndicator:!b.hasWriteAccess(this._userModel),description:f,privacy:this.model.get("privacy").toLowerCase(),likes:this.model.get("likes")||0,timeDiff:h(this.model.get("updated_at")).fromNow(),tags:e,tagsCount:e.length,maxTagsToShow:3,rowCount:void 0,datasetSize:void 0,syncStatus:void 0,syncRanAt:void 0},m=a.get("row_count");m>=0&&(l.rowCount=m,l.rowCountFormatted=m<1e4?i.formatNumber(m):i.readizableNumber(m));var n=a.get("size");return n>=0&&(l.datasetSize=i.readablizeBytes(n,!0)),g.isEmpty(c)||(l.syncRanAt=h(c.get("ran_at")||new Date).fromNow(),l.syncStatus=c.get("state")),this.$el.html(k(l)),this._renderLikesIndicator(),this._renderTooltips(),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this},_renderLikesIndicator:function(){var a=new l({model:this.model.getLikesModel()});this.$(".js-likes-indicator").replaceWith(a.render().el),this.addView(a)},_renderTooltips:function(){g.isEmpty(this.model.get("synchronization"))||this.addView(new j({el:this.$(".DatasetsList-itemStatus"),title:function(a){return f(this).attr("data-title")}}))},_onTagClick:function(a){var b=f(a.target).val();b&&this._routerModel.set("tag",b)},_toggleSelected:function(a){"A"!==a.target.tagName&&(this.killEvent(a),this._createModel.canSelect(this.model)&&this.model.set("selected",!this.model.get("selected")))}})},{"../../../../../helpers/utils":1102,"../../../../likes/likes-view":225,"../../../../tipsy-tooltip-view":589,"./dataset-item.tpl":302,"backbone/core-view":1127,"cartodb.js":"cartodb.js",jquery:"jquery",moment:"moment",underscore:"underscore"}],302:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){if(__p+='<div class="DatasetsList-itemCategory is--'+(null==(__t=isRaster?"raster":geometryType)?"":_.escape(__t))+'Dataset">\n  ',syncStatus&&(__p+="\n    <i\n    ",__p+="failure"===syncStatus?'\n      data-title="'+(null==(__t=_t("components.modals.add-layer.datasets.item.sync-failed"))?"":_.escape(__t))+" "+(null==(__t=syncRanAt)?"":_.escape(__t))+'"\n    ':"syncing"===syncStatus?'\n      data-title="'+(null==(__t=_t("components.modals.add-layer.datasets.item.syncing"))?"":_.escape(__t))+'"\n    ':'\n      data-title="'+(null==(__t=_t("components.modals.add-layer.datasets.item.synced"))?"":_.escape(__t))+" "+(null==(__t=syncRanAt)?"":_.escape(__t))+'"\n    ',__p+='\n    class="CDB-IconFont CDB-IconFont-wifi DatasetsList-itemStatus is-'+(null==(__t=syncStatus)?"":_.escape(__t))+'"></i>\n  '),__p+='\n</div>\n<div class="ModalDataset-itemInfo">\n  <div class="ModalDataset-itemInfoTitle">\n    <h3 class="CDB-Text CDB-Size-large u-bSpace u-ellipsis">\n      '+(null==(__t=title)?"":_.escape(__t))+"\n      ",showPermissionIndicator&&(__p+='\n        <span class="Tag Tag--outline Tag-outline--grey CDB-Text CDB-Size-small u-upperCase">\n          '+(null==(__t=_t("components.modals.add-layer.datasets.item.read"))?"":_.escape(__t))+"\n        </span>\n      "),__p+="\n    </h3>\n    ",__p+=description&&description.length>0?'\n      <p class="u-ellipsis CDB-Text CDB-Size-medium u-altTextColor" title="'+(null==(__t=description)?"":_.escape(__t))+'">'+(null==(__t=description)?"":_.escape(__t))+"</p>\n    ":'\n      <span class="NoResults CDB-Text CDB-Size-medium">'+(null==(__t=_t("components.modals.add-layer.datasets.item.no-description"))?"":_.escape(__t))+"</span>\n    ",__p+='\n  </div>\n  <div>\n    <div class="DatasetsList-itemMeta">\n\n      <span class="CDB-Tag is-'+(null==(__t=privacy)?"":_.escape(__t))+' CDB-Text is-semibold CDB-Size-small u-upperCase">\n        '+(null==(__t=privacy)?"":_.escape(__t))+"\n      </span>\n      ",rowCount&&(__p+='\n        <span class="RowsIndicator">\n          <span class="CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=rowCountFormatted)?"":_.escape(__t))+" "+(null==(__t=_t("components.modals.add-layer.datasets.item.rows-pluralize",{smart_count:rowCount}))?"":_.escape(__t))+"</span>\n        </span>\n      "),__p+="\n      ",datasetSize&&(__p+='\n        <span class="SizeIndicator">\n          <span class="CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=datasetSize)?"":_.escape(__t))+"</span>\n        </span>\n      "),__p+='\n      <span class="DatasetsList-itemTimeDiff DefaultTimeDiff">\n        <span class="CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=timeDiff)?"":_.escape(__t))+"</span>\n        ",isOwner||(__p+='\n          <span class="CDB-Text CDB-Size-small u-altTextColor u-lSpace--xl u-rSpace">\n            '+(null==(__t=_t("components.modals.add-layer.datasets.item.by"))?"":_.escape(__t))+'\n          </span>\n          <span class="DatasetsList-avatar">\n            <img class="DatasetsList-avatarImg" src="'+(null==(__t=owner.avatar_url)?"":_.escape(__t))+'" alt="'+(null==(__t=owner.name||owner.username)?"":_.escape(__t))+'" title="'+(null==(__t=owner.name||owner.username)?"":_.escape(__t))+'" />\n          </span>\n        '),__p+='\n      </span>\n    </div>\n    <div class="DatasetsList-itemMeta DatasetsList-itemTags">\n      ',tagsCount>0){__p+='\n        <div class="DefaultTags CDB-Text CDB-Size-small">\n          ';for(var i=0,l=Math.min(maxTagsToShow,tags.length);i<l;++i)__p+='\n            <button class="CDB-Text CDB-Size-small u-upperCase DefaultTags-item js-tag-link u-actionTextColor" value="'+(null==(__t=tags[i])?"":_.escape(__t))+'">'+(null==(__t=tags[i])?"":_.escape(__t))+"</button>",i!==l-1&&(__p+=""),__p+="\n          ";__p+="\n          ",tagsCount>maxTagsToShow&&(__p+="\n            "+(null==(__t=_t("components.modals.add-layer.datasets.item.tags-more",{tagsCount:tagsCount-maxTagsToShow}))?"":_.escape(__t))+"\n          "),__p+="\n        </div>\n      "}else __p+='\n        <span class="NoResults CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=_t("components.modals.add-layer.datasets.item.no-tags"))?"":_.escape(__t))+"</span>\n      ";__p+="\n    </div>\n  </div>\n</div>\n"}return __p}},{underscore:"underscore"}],303:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="LayoutIcon LayoutIcon--negative">\n    <i class="CDB-IconFont CDB-IconFont-cockroach"></i>\n  </div>\n  <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n    '+(null==(__t=_t("components.modals.add-layer.datasets.error.title"))?"":_.escape(__t))+'\n  </h4>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.add-layer.datasets.error.desc"))?"":_.escape(__t))+' <a class="js-mail-link" href="mailto:support@carto.com">support@carto.com</a>.</p>\n</div>\n';return __p}},{underscore:"underscore"}],304:[function(a,b,c){var d=a("backbone/core-view"),e={datasets:a("./dataset-item-view"),remotes:a("./remote-dataset-item-view")};b.exports=d.extend({tagName:"ul",className:"DatasetsList",initialize:function(a){if(!a.createModel)throw new Error("createModel is required");if(!a.userModel)throw new Error("userModel is required");this._createModel=a.createModel,this._userModel=a.userModel,this._tablesCollection=this._createModel.getTablesCollection(),this._initBinds()},render:function(){return this.clearSubViews(),this._tablesCollection.each(this._addItem,this),this},_initBinds:function(){this._tablesCollection.bind("sync",this.render,this),this.add_related_model(this._tablesCollection)},_addItem:function(a,b){var c="remote"===a.get("type")?"remotes":"datasets",d=new e[c]({model:a,createModel:this._createModel,userModel:this._userModel});this.addView(d),this.$el.append(d.render().el)},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},{"./dataset-item-view":301,"./remote-dataset-item-view":310,"backbone/core-view":1127}],305:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="CDB-LoaderIcon CDB-LoaderIcon--big is-dark js-loader">\n    <svg class="CDB-LoaderIcon-spinner" viewbox="0 0 50 50">\n      <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"/>\n    </svg>\n  </div>\n  <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-bSpace u-secondaryTextColor u-tSpace-xl">\n    '+(null==(__t=_t("components.modals.add-layer.datasets."+(q||tag?"searching":"loading")))?"":_.escape(__t))+'...\n  </h4>\n  <div class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=quote)?"":__t)+"</div>\n</div>\n";return __p}},{underscore:"underscore"}],306:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="LayoutIcon ',q||tag?"LayoutIcon--negative":"",__p+='">\n    <i class="CDB-IconFont\n      ',__p+=shared?" CDB-IconFont-defaultUser\n      ":locked?" CDB-IconFont-lock\n      ":library?" CDB-IconFont-dribbble\n      ":" CDB-IconFont-lens ",__p+='" />\n  </div>\n  <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-bSpace u-secondaryTextColor u-tSpace-xl">\n    ',(page>1||0===totalItems&&totalEntries>0)&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.datasets.no-results.desc"))?"":_.escape(__t))+"\n    "),__p+="\n\n    ",(tag||q)&&0===totalItems&&0===totalEntries&&(__p+="\n      0 "+(null==(__t=tag||q)?"":_.escape(__t))+" "+(null==(__t=type)?"":_.escape(__t))+" "+(null==(__t=_t("components.modals.add-layer.datasets.no-results.found"))?"":_.escape(__t))+"\n    "),__p+="\n\n    ",1!==page||tag||q||0!==totalItems||0!==totalEntries||(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.datasets.no-results.there-are-no"))?"":_.escape(__t))+" "+(null==(__t="only"===shared?"shared":"")?"":_.escape(__t))+" "+(null==(__t=locked?"locked":"")?"":_.escape(__t))+" "+(null==(__t=library?"library":"")?"":_.escape(__t))+" "+(null==(__t=type)?"":_.escape(__t))+"\n    "),__p+='\n  </h4>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">\n    ',tag||q||0!==totalItems||0!==totalEntries||(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.datasets.no-results.no-fun",{type:type}))?"":_.escape(__t))+"\n    "),__p+="\n  </p>\n</div>\n";return __p}},{underscore:"underscore"}],307:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../pagination/pagination-model"),f=a("../../../../pagination/pagination-view");b.exports=d.extend({className:"DatasetsPaginator",initialize:function(a){if(!a.routerModel)throw new TypeError("routerModel is required");if(!a.tablesCollection)throw new TypeError("tablesCollection is required");this._routerModel=a.routerModel,this._tablesCollection=a.tablesCollection,this.model=new e({current_page:this._routerModel.get("page")}),this._initBinds(),this._initViews()},render:function(){return this.clearSubViews(),this.$el.append(this.paginationView.render().el),this},_initBinds:function(){this.model.bind("change",this.render,this),this.model.bind("change:current_page",function(){this._routerModel.set("page",this.model.get("current_page"))},this),this._tablesCollection.bind("sync",this._updatePaginationModelByCollection,this),this._routerModel.bind("change:page",this._updatePaginationModelByRouterModel,this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection),this.add_related_model(this.model)},_initViews:function(){this.paginationView=new f({model:this.model}),this.addView(this.paginationView)},_updatePaginationModelByCollection:function(){this.model.set({per_page:this._tablesCollection.getDefaultParam("per_page"),total_count:this._tablesCollection.getTotalStat("total_entries")})},_updatePaginationModelByRouterModel:function(){this.model.set("current_page",this._routerModel.get("page"))}})},{"../../../../pagination/pagination-model":519,"../../../../pagination/pagination-view":520,"backbone/core-view":1127}],308:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./content-result-view"),g=a("./datasets-list-view"),h=a("./datasets-pagination-view"),i=a("./no-datasets.tpl"),j=a("./datasets-no-result.tpl"),k=a("./datasets-error.tpl"),l=a("./datasets-loader.tpl");b.exports=d.extend({initialize:function(a){if(!a.createModel)throw new Error("createModel is required");if(!a.userModel)throw new Error("userModel is required");this._createModel=a.createModel,this._userModel=a.userModel,this._routerModel=this._createModel.getVisualizationFetchModel(),this._tablesCollection=this._createModel.getTablesCollection(),this._initViews(),this._initBinds(),this._onDataLoading()},_initBinds:function(){this._routerModel.bind("change",this._onRouterChange,this),this._tablesCollection.bind("loading",this._onDataLoading,this),this._tablesCollection.bind("sync",this._onDataFetched,this),this._tablesCollection.bind("error",function(a){(!a||a&&"abort"!==a.statusText)&&this._onDataError()},this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection)},_initViews:function(){this.controlledViews={},this.enabledViews=[];var a=new f({className:"ContentResult no-datasets",userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:i});a.bind("connectDataset",function(){this._userModel.canCreateDatasets()&&this._createModel.set("listing","import")},this),a.render().hide(),this.controlledViews.no_datasets=a,this.$el.append(a.el),this.addView(a);var b=new g({userModel:this._userModel,createModel:this._createModel});this.controlledViews.list=b,this.$el.append(b.render().el),this.addView(b);var c=new f({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:j});c.render().hide(),this.controlledViews.no_results=c,this.$el.append(c.el),this.addView(c);var d=new f({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:k});d.render().hide(),this.controlledViews.error=d,this.$el.append(d.el),this.addView(d);var e=new f({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:l});this.controlledViews.main_loader=e,this.$el.append(e.render().el),this.addView(e);var m=new h({routerModel:this._routerModel,tablesCollection:this._tablesCollection});this.controlledViews.content_footer=m,this.$el.append(m.render().el),this.addView(m)},_onRouterChange:function(){this._hideBlocks(),this._showBlocks(["main_loader"])},_onDataFetched:function(){var a=["content_footer"],b=this._routerModel.get("tag"),c=this._routerModel.get("q"),d=this._routerModel.get("shared"),e=this._routerModel.get("locked"),f=this._routerModel.get("library");if(f&&0===this._tablesCollection.getTotalStat("total_user_entries")&&a.push("no_datasets"),0===this._tablesCollection.size())if(b||c||"no"!==d||e)a.push("no_results");else{if(!f)return void this._goToLibrary();a.push("no_results")}else a.push("list");this._hideBlocks(),this._showBlocks(a)},_onDataLoading:function(){this._hideBlocks(),this._showBlocks(["main_loader"])},_onDataError:function(a){this._hideBlocks(),this._showBlocks(["error"])},_showBlocks:function(a){var b=this;a?e.each(a,function(a){b.controlledViews[a]&&(b.controlledViews[a].show(),b.enabledViews.push(a))}):(b.enabledViews=[],e.each(this.controlledViews,function(a){a.show(),b.enabledViews.push(a)}))},_goToLibrary:function(){this._routerModel.set({shared:"no",library:!0,page:1})},_hideBlocks:function(a){var b=this;a?e.each(a,function(a){b.controlledViews[a]&&(b.controlledViews[a].hide(),b.enabledViews=e.without(b.enabledViews,a))}):(e.each(this.controlledViews,function(a){a.hide()}),b.enabledViews=[])},_isBlockEnabled:function(a){return!!a&&e.contains(this.enabledViews,a)}})},{"./content-result-view":300,"./datasets-error.tpl":303,"./datasets-list-view":304,"./datasets-loader.tpl":305,"./datasets-no-result.tpl":306,"./datasets-pagination-view":307,"./no-datasets.tpl":309,"backbone/core-view":1127,underscore:"underscore"}],309:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<h4 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m u-tSpace-xl">\n  '+(null==(__t=_t("components.modals.add-layer.datasets.no-datasets.title"))?"":_.escape(__t))+'\n</h4>\n<p class="CDB-Text CDB-Size-medium u-altTextColor">\n  ';var connectDatasetHTML='<button class="Button--link js-connect">'+_t("components.modals.add-layer.datasets.no-datasets.connect-datasets")+"</button>";__p+="\n  ";var searchHTML="<strong>"+_t("components.modals.add-layer.datasets.no-datasets.search")+"</strong>";__p+="\n  "+(null==(__t=_t("components.modals.add-layer.datasets.no-datasets.desc",{connectDataset:connectDatasetHTML,search:searchHTML}))?"":_.escape(__t))+'\n</p>\n<div class="NoDatasets-illustration"></div>\n'}return __p}},{underscore:"underscore"}],310:[function(a,b,c){var d=a("cartodb.js"),e=a("jquery"),f=a("./dataset-item-view"),g=a("moment"),h=a("markdown"),i=a("../../../../../helpers/utils"),j=a("../../../../tipsy-tooltip-view"),k=a("../../../../../config/upload-config"),l=a("./remote-dataset-item.tpl");b.exports=f.extend({tagName:"li",className:"ModalBlockList-item ModalBlockList-item--full",events:{"click .js-tag-link":"_onTagClick",click:"_toggleSelected"},render:function(){var a=this.model.getTableModel(),b=this.model.get("tags")||[],c=d.core.sanitize.html(this.model.get("description")||""),e=h.toHTML(this.model.get("source")||""),f=a.getGeometryType()||[],j={isRaster:this.model.isRaster(),geometryType:f.length>0?f[0]:"",title:this.model.get("display_name")||this.model.get("name"),source:e,description:c,timeDiff:g(this.model.get("updated_at")).fromNow(),tags:b,tagsCount:b.length,routerModel:this._routerModel,maxTagsToShow:3,canImportDataset:this._canImportDataset(),rowCount:void 0,datasetSize:void 0},k=a.get("row_count");k>=0&&(j.rowCount=k,j.rowCountFormatted=k<1e4?i.formatNumber(k):i.readizableNumber(k));var m=a.get("size");return m>=0&&(j.datasetSize=i.readablizeBytes(m,m.toString().length>9)),this.$el.html(l(j)),this._setItemClasses(),this._renderTooltips(),this},_setItemClasses:function(){this.$el.toggleClass("is-selected",!!this.model.get("selected")),this.$el.toggleClass("is-selectable",!!this._canImportDataset()),this.$el.toggleClass("is-banned",!this._canImportDataset())},_renderTooltips:function(){this.addView(new j({el:this.$(".DatasetsList-itemStatus"),title:function(a){return e(this).attr("data-title")}}))},_onTagClick:function(a){a&&this.killEvent(a);var b=e(a.target).val();b&&this._routerModel.set({tag:b,library:!0})},_canImportDataset:function(){var a=this.model.getTableModel(),b=a.get("size")||0;return this._userModel.get("remaining_byte_quota")*k.fileTimesBigger>=b&&this._userModel.get("limits").import_file_size>b},_toggleSelected:function(a){"A"!==a.target.tagName&&(this.killEvent(a),this._canImportDataset()&&this._createModel.canSelect(this.model)&&this.model.set("selected",!this.model.get("selected")))}})},{"../../../../../config/upload-config":597,"../../../../../helpers/utils":1102,"../../../../tipsy-tooltip-view":589,"./dataset-item-view":301,"./remote-dataset-item.tpl":311,"cartodb.js":"cartodb.js",jquery:"jquery",markdown:1137,moment:"moment"}],311:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){if(__p+='<div class="DatasetsList-itemCategory is--'+(null==(__t=isRaster?"raster":geometryType)?"":_.escape(__t))+'Dataset">\n  <i data-title="Public dataset" class="CDB-IconFont CDB-IconFont-book DatasetsList-itemStatus '+(null==(__t=canImportDataset?"is-public":"is-banned")?"":_.escape(__t))+'"></i>\n</div>\n<div class="ModalDataset-itemInfo">\n  <div class="ModalDataset-itemInfoTitle">\n    <h3 class="CDB-Text CDB-Size-large u-bSpace u-ellipsis">'+(null==(__t=title)?"":_.escape(__t))+"</h3>\n    ",__p+=description&&description.length>0?'\n      <p class="u-ellipsis CDB-Text CDB-Size-medium u-altTextColor" title="'+(null==(__t=description)?"":_.escape(__t))+'">'+(null==(__t=description)?"":_.escape(__t))+"</p>\n    ":'\n      <span class="NoResults CDB-Text CDB-Size-medium">'+(null==(__t=_t("components.modals.add-layer.datasets.item.no-description"))?"":_.escape(__t))+"</span>\n    ",__p+='\n  </div>\n  <div>\n    <ul class="DatasetsList-itemMeta CDB-Text CDB-Size-small u-altTextColor">\n      ',rowCount&&(__p+='\n        <li class="RowsIndicator">\n          '+(null==(__t=rowCountFormatted)?"":_.escape(__t))+" "+(null==(__t=_t("components.modals.add-layer.datasets.item.rows-pluralize",{smart_count:rowCount}))?"":_.escape(__t))+"\n        </li>\n      "),__p+="\n      ",datasetSize&&(__p+='\n        <li class="SizeIndicator">\n          '+(null==(__t=datasetSize)?"":_.escape(__t))+"\n        </li>\n      "),__p+='\n      <li class="DatasetsList-itemTimeDiff DefaultTimeDiff CDB-Text CDB-Size-small u-altTextColor">\n        '+(null==(__t=timeDiff)?"":_.escape(__t))+' <span class="DatasetsList-itemSource js-source">',source&&(__p+=""+(null==(__t=_t("components.modals.add-layer.datasets.item.from"))?"":_.escape(__t))+" "+(null==(__t=cdb.core.sanitize.html(source))?"":__t)),__p+='</span>\n      </li>\n    </ul>\n    <div class="DatasetsList-itemMeta DatasetsList-itemTags">\n      ',tagsCount>0){__p+='\n        <div class="DefaultTags CDB-Text CDB-Size-small">\n          ';for(var i=0,l=Math.min(maxTagsToShow,tags.length);i<l;++i)__p+='\n            <button class="CDB-Text CDB-Size-small u-upperCase DefaultTags-item js-tag-link u-actionTextColor" value="'+(null==(__t=tags[i])?"":_.escape(__t))+'">'+(null==(__t=tags[i])?"":_.escape(__t))+"</button>",i!==l-1&&(__p+=""),__p+="\n          ";__p+="\n          ",tagsCount>maxTagsToShow&&(__p+="\n            "+(null==(__t=_t("components.modals.add-layer.datasets.item.tags-more",{tagsCount:tagsCount-maxTagsToShow}))?"":_.escape(__t))+"\n          "),__p+="\n        </div>\n      "}else __p+='\n        <span class="NoResults CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=_t("components.modals.add-layer.datasets.item.no-tags"))?"":_.escape(__t))+"</span>\n      ";__p+="\n    </div>\n  </div>\n</div>\n"}return __p}},{underscore:"underscore"}],312:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <div class="LayoutIcon u-bSpace--xl">\n    <i class="CDB-IconFont CDB-IconFont-gift"></i>\n  </div>\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">ArcGIS<sup>&trade;</sup> '+(null==(__t=_t("components.modals.add-layer.imports.connector"))?"":_.escape(__t))+'</h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor u-bSpace--xl">\n    '+(null==(__t=_t("components.modals.add-layer.imports.arcgis.fallback-desc",{brand:"ArcGIS<sup>&trade;</sup>"}))?"":__t)+'\n  </p>\n  <a href="mailto:sales@carto.com?subject='+(null==(__t=_t("components.modals.add-layer.imports.demo-email-title",{name:"ArcGIS"}))?"":_.escape(__t))+"&body="+(null==(__t=_t("components.modals.add-layer.imports.demo-email-desc",{name:"ArcGIS"}))?"":_.escape(__t))+'" class="CDB-Button CDB-Button--primary CDB-Button--medium">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-layer.imports.ask-for-demo"))?"":_.escape(__t))+"</span>\n  </a>\n</div>\n";return __p}},{underscore:"underscore"}],313:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <div class="LayoutIcon u-bSpace--xl">\n    <i class="CDB-IconFont CDB-IconFont-gift"></i>\n  </div>\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">Box '+(null==(__t=_t("components.modals.add-layer.imports.connector"))?"":_.escape(__t))+'</h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor u-bSpace--xl">\n    '+(null==(__t=_t("components.modals.add-layer.imports.box.fallback-desc",{brand:"Box"}))?"":_.escape(__t))+'\n  </p>\n  <a href="mailto:sales@carto.com?subject='+(null==(__t=_t("components.modals.add-layer.imports.demo-email-title",{name:"Box"}))?"":_.escape(__t))+"&body="+(null==(__t=_t("components.modals.add-layer.imports.demo-email-desc",{name:"Box"}))?"":_.escape(__t))+'" class="CDB-Button CDB-Button--primary CDB-Button--medium">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-layer.imports.ask-for-demo"))?"":_.escape(__t))+"</span>\n  </a>\n</div>\n";return __p}},{underscore:"underscore"}],314:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <div class="LayoutIcon u-bSpace--xl">\n    <i class="CDB-IconFont CDB-IconFont-gift"></i>\n  </div>\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">MailChimp '+(null==(__t=_t("components.modals.add-layer.imports.connector"))?"":_.escape(__t))+'</h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor u-bSpace--xl">'+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.fallback-desc",{
brand:"Mailchimp"}))?"":_.escape(__t))+'</p>\n  <a href="mailto:sales@carto.com?subject='+(null==(__t=_t("components.modals.add-layer.imports.demo-email-title",{name:"MailChimp"}))?"":_.escape(__t))+"&body="+(null==(__t=_t("components.modals.add-layer.imports.demo-email-desc",{name:"MailChimp"}))?"":_.escape(__t))+'" class="CDB-Button CDB-Button--primary CDB-Button--medium">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-layer.imports.ask-for-demo"))?"":_.escape(__t))+"</span>\n  </a>\n</div>\n";return __p}},{underscore:"underscore"}],315:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <div class="LayoutIcon u-bSpace--xl">\n    <i class="CDB-IconFont CDB-IconFont-gift"></i>\n  </div>\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">Salesforce '+(null==(__t=_t("components.modals.add-layer.imports.connector"))?"":_.escape(__t))+'</h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor u-bSpace--xl">\n    '+(null==(__t=_t("components.modals.add-layer.imports.salesforce.fallback-desc",{brand:"Salesforce"}))?"":_.escape(__t))+'\n  </p>\n  <a href="mailto:sales@carto.com?subject='+(null==(__t=_t("components.modals.add-layer.imports.demo-email-title",{name:"Salesforce"}))?"":_.escape(__t))+"&body="+(null==(__t=_t("components.modals.add-layer.imports.demo-email-desc",{name:"Salesforce"}))?"":_.escape(__t))+'" class="CDB-Button CDB-Button--primary CDB-Button--medium">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-layer.imports.ask-for-demo"))?"":_.escape(__t))+"</span>\n  </a>\n</div>\n";return __p}},{underscore:"underscore"}],316:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <div class="LayoutIcon u-bSpace--xl">\n    <i class="CDB-IconFont CDB-IconFont-gift"></i>\n  </div>\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">'+(null==(__t=_t("components.modals.add-layer.imports.twitter.fallback-title",{brand:"Twitter"}))?"":_.escape(__t))+'</h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor u-bSpace--xl">\n    '+(null==(__t=_t("components.modals.add-layer.imports.twitter.fallback-desc",{brand:"Twitter"}))?"":_.escape(__t))+'\n  </p>\n  <a href="mailto:sales@carto.com?subject='+(null==(__t=_t("components.modals.add-layer.imports.demo-email-title",{name:"Twitter"}))?"":_.escape(__t))+"&body="+(null==(__t=_t("components.modals.add-layer.imports.demo-email-desc",{name:"Twitter"}))?"":_.escape(__t))+'" class="CDB-Button CDB-Button--primary CDB-Button--medium">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">ask for a demo</span>\n  </a>\n</div>\n';return __p}},{underscore:"underscore"}],317:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="Form js-form">\n  <div class="Form-row">\n    <div class="Form-rowLabel">\n      <label class="CDB-Text CDB-Size-medium">'+(null==(__t=_t("components.modals.add-layer.imports.form-import.title"))?"":_.escape(__t))+'</label>\n    </div>\n    <div class="Form-rowData Form-rowData--longer">\n      <input type="text" class="CDB-Text CDB-Size-medium Form-input Form-input--longer has-submit js-textInput" value="" placeholder="'+(null==(__t=_t("components.modals.add-layer.imports.arcgis.input-placeholder",{brand:"ArcGIS Server&trade;"}))?"":__t)+'" />\n      <button type="submit" class="CDB-Text CDB-Size-small Form-inputSubmit u-upperCase u-actionTextColor Form-inputSubmit">\n        <span>'+(null==(__t=_t("components.modals.add-layer.imports.form-import.submit"))?"":_.escape(__t))+'</span>\n      </button>\n      <div class="Form-inputError CDB-Text">'+(null==(__t=_t("components.modals.add-layer.imports.form-import.error-desc"))?"":_.escape(__t))+'</div>\n    </div>\n  </div>\n  <div class="Form-row">\n    <div class="Form-rowLabel"></div>\n    <div class="Form-rowData Form-rowData--longer">\n      <p class="CDB-Text CDB-Size-small Form-rowInfoText--centered Form-rowInfoText--block u-altTextColor">\n        '+(null==(__t=_t("components.modals.add-layer.imports.form-import.format"))?"":_.escape(__t))+": http://&#60;host&#62;/arcgis/rest/services/&#60;folder&#62;/&#60;serviceName&#62;/&#60;serviceType&#62;<br/>\n        "+(null==(__t=_t("components.modals.add-layer.imports.arcgis.url-desc"))?"":_.escape(__t))+"\n      </p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],318:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n  ',__p+="selected"===state?"\n    "+(null==(__t=_t("components.modals.add-layer.imports.header-import.type-selected",{brand:"ArcGIS<sup>&trade;</sup>"}))?"":__t)+"\n  ":"\n    "+(null==(__t=_t("components.modals.add-layer.imports.header-import.type-import",{brand:"ArcGIS<sup>&trade;</sup>"}))?"":__t)+"\n  ",__p+='\n</h3>\n<p class="CDB-Text CDB-Size-medium u-altTextColor">\n  ',__p+="selected"!==state?"\n    "+(null==(__t=_t("components.modals.add-layer.imports.arcgis.import-data",{brand:"ArcGIS<sup>&trade;</sup>"}))?"":__t)+"\n  ":"\n    "+(null==(__t=_t("components.modals.add-layer.imports.arcgis.sync-options"))?"":_.escape(__t))+"\n  ",__p+="\n</p>\n","selected"===state&&(__p+='\n  <button class="NavButton NavButton--back ImportPanel-headerButton js-back">\n    <i class="CDB-IconFont CDB-IconFont-arrowPrev"></i>\n  </button>\n'),__p+="\n";return __p}},{underscore:"underscore"}],319:[function(a,b,c){var d=a("../../../../../../helpers/utils"),e=a("../import-selected-dataset-view"),f=a("../import-selected-dataset.tpl");b.exports=e.extend({render:function(){var a=this.options.fileAttrs.title&&this.model.get("value")[this.options.fileAttrs.title]||this.model.get("value"),b=this._genDescription(),c=this.options.fileAttrs.ext?d.getFileExtension(a):"";this.options.fileAttrs.ext&&(a=a&&a.replace("."+c,""));var e=window.upgrade_url,g=this._userModel.isActionEnabled("sync_tables"),h=this._configModel.get("cartodb_com_hosted");return this.$el.html(f({title:a,description:b,ext:c,interval:this.model.get("interval"),importCanSync:this.options.acceptSync&&this._isArcGISLayer(a),userCanSync:g,showTrial:this._userModel.canStartTrial(),showUpgrade:!g&&!h&&e&&!this._userModel.isInsideOrg(),upgradeUrl:e})),this},_isArcGISLayer:function(a){return a.search(/([0-9]+\/|[0-9]+)/)!==-1}})},{"../../../../../../helpers/utils":1102,"../import-selected-dataset-view":331,"../import-selected-dataset.tpl":332}],320:[function(a,b,c){var d=a("../import-data/import-data-form-view"),e=a("../import-data/import-data-header-view"),f=a("./import-arcgis-selected-dataset-view"),g=a("../import-data/import-data-view"),h=a("./import-arcgis-header.tpl"),i=a("./import-arcgis-form.tpl");b.exports=g.extend({options:{fileExtensions:[],type:"service",service:"arcgis",acceptSync:!0,fileEnabled:!1,fileAttrs:{ext:!1,title:"",description:""}},_initViews:function(){var a=new e({el:this.$(".ImportPanel-header"),model:this.model,userModel:this._userModel,collection:this.collection,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:h});a.render(),this.addView(a);var b=new f({el:this.$(".DatasetSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});b.render(),this.addView(b);var c=new d({el:this.$(".ImportPanel-form"),userModel:this._userModel,model:this.model,template:i,fileEnabled:this.options.fileEnabled});c.render(),this.addView(c)}})},{"../import-data/import-data-form-view":321,"../import-data/import-data-header-view":323,"../import-data/import-data-view":325,"./import-arcgis-form.tpl":317,"./import-arcgis-header.tpl":318,"./import-arcgis-selected-dataset-view":319}],321:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery");a("dragster");var f=a("dropzone"),g=a("./import-data-form.tpl");b.exports=d.extend({options:{template:"",fileEnabled:!1},events:{"keyup .js-textInput":"_onTextChanged","submit .js-form":"_onSubmitForm"},initialize:function(a){if(!a.userModel)throw new Error("userModel is required");this._userModel=a.userModel,this.template=a.template||g,this._initBinds(),this._checkVisibility()},render:function(){return this.$el.html(this.template(this.options)),this._initViews(),this},_initBinds:function(){this.model.bind("change:state",this._checkVisibility,this)},_initViews:function(){if(this.options.fileEnabled){var a=this;this.$(".js-fileInput").bind("change",function(b){this.files&&this.files.length>0&&a._onFileChanged(this.files),this.value=""}),this._initDropzone()}},_initDropzone:function(){var a=e("html")[0],b=this;this.dragster=new Dragster(a),e(a).bind("dragster:enter",function(a){b._showDropzone()}),e(a).bind("dragster:leave",function(a){b._hideDropzone()}),a.dropzone||(this.dropzone=new f(a,{url:":)",autoProcessQueue:!1,previewsContainer:!1}),this.dropzone.on("dragover",function(){b._showDropzone()}),this.dropzone.on("drop",function(a){var c=a.dataTransfer.files;b._onFileChanged(c),b._hideDropzone()}))},_destroyDropzone:function(){var a=e("html")[0];this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),e(a).unbind("dragster:enter dragster:leave")),this.dropzone&&this.dropzone.destroy()},_setValidFileExtensions:function(a){return RegExp("(.|/)("+a.join("|")+")$","i")},_onTextChanged:function(){var a=this.$(".js-textInput").val();a||this._hideTextError()},_onFileChanged:function(a){this.trigger("fileSelected",this),a&&1===a.length&&(a=a[0]),this.model.setUpload({type:"file",value:a}),"error"!==this.model.get("state")?(this._hideFileError(),this.model.set("state","selected")):this._showFileError()},_showTextError:function(){this.$(".Form-inputError").addClass("is-visible")},_hideTextError:function(){this.$(".Form-inputError").removeClass("is-visible")},_showDropzone:function(){this.$(".Form-upload").addClass("is-dropping"),this._hideFileError()},_hideDropzone:function(){this.$(".Form-upload").removeClass("is-dropping")},_showFileError:function(){"error"===this.model.get("state")&&(this.$(".js-fileError").text(this.model.get("get_error_text").what_about).show(),this.$(".js-fileLabel").hide(),this.$(".js-fileButton").addClass("Button--negative"))},_hideFileError:function(){this.$(".js-fileError").hide(),this.$(".js-fileLabel").show(),this.$(".js-fileButton").removeClass("Button--negative")},_onSubmitForm:function(a){a&&this.killEvent(a);var b=this.$(".js-textInput").val();if(!b)return void this._hideTextError();this.trigger("urlSelected",this);var c=this.model.get("service_name")?"service":"url";this.model.setUpload({type:c,value:b,service_item_id:b,state:"idle"}),"error"!==this.model.get("state")?(this._hideFileError(),this._hideTextError(),this.model.set("state","selected")):this._showTextError()},_checkVisibility:function(){var a=this.model.get("state");this["selected"!==a?"show":"hide"]()},clean:function(){this._destroyDropzone(),this.$(".js-fileInput").unbind("change"),d.prototype.clean.apply(this)}})},{"./import-data-form.tpl":322,"backbone/core-view":1127,dragster:1134,dropzone:1135,jquery:"jquery"}],322:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="Form js-form">\n  <div class="Form-row Form-row--centered">\n    ',fileEnabled&&(__p+='\n      <div class="Form-rowData Form-rowData--med Form-rowData--noMargin js-dropzone">\n        <div class="Form-upload">\n          <label class="Form-fileLabel js-fileLabel CDB-Text CDB-Size-medium">'+(null==(__t=_t("components.modals.add-layer.imports.form-import.drag-and-drop"))?"":_.escape(__t))+'</label>\n          <label class="Form-fileLabel Form-fileLabel--error CDB-Text CDB-Size-small js-fileError"></label>\n          <div class="Form-file">\n            <input type="file" class="js-fileInput" />\n            <span class="CDB-Button CDB-Button--primary Form-fileButton CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase js-fileButton">\n              '+(null==(__t=_t("components.modals.add-layer.imports.form-import.browse"))?"":_.escape(__t))+'\n            </span>\n          </div>\n        </div>\n      </div>\n      <span class="u-lSpace--xl u-rSpace--xl u-flex u-alignCenter CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.add-layer.imports.form-import.or"))?"":_.escape(__t))+"</span>\n    "),__p+='\n    <div class="Form-rowData Form-rowData--noMargin Form-rowData--med">\n      <input type="text" class="Form-input Form-input--med has-submit js-textInput CDB-Text CDB-Size-medium" value="" placeholder="https://carto.com/data-library" />\n      <button type="submit" class="CDB-Text CDB-Size-small Form-inputSubmit u-upperCase u-actionTextColor Form-inputSubmit">\n        <span>'+(null==(__t=_t("components.modals.add-layer.imports.form-import.submit"))?"":_.escape(__t))+'</span>\n      </button>\n      <div class="Form-inputError CDB-Text">'+(null==(__t=_t("components.modals.add-layer.imports.form-import.error-desc"))?"":_.escape(__t))+"</div>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],323:[function(a,b,c){var d=a("backbone/core-view"),e=a("./import-data-header.tpl");b.exports=d.extend({events:{"click .js-back":"_goToStart"},options:{fileEnabled:!1,acceptSync:!1},initialize:function(a){if(!a.userModel)throw new Error("userModel is required");this._userModel=a.userModel,this.template=a.template||e,this._initBinds(),this._checkVisibility()},render:function(){var a=this.options.acceptSync&&this._userModel.get("actions")&&this._userModel.isActionEnabled("sync_tables")&&"file"!==this.model.get("type");return this.$el.html(this.template({type:this.model.get("type"),fileEnabled:this.options.fileEnabled,acceptSync:a,state:this.model.get("state")})),this._checkVisibility(),this},_initBinds:function(){this.model.bind("change:state",this.render,this)},_checkVisibility:function(){this.show()},_goToStart:function(){this.model.set("state","idle")}})},{"./import-data-header.tpl":324,"backbone/core-view":1127}],324:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n  ',__p+="selected"===state?"\n    "+(null==(__t=_t("components.modals.add-layer.imports.header-import.file-selected"))?"":_.escape(__t))+"\n  ":"\n    "+(null==(__t=_t("components.modals.add-layer.imports.header-import.upload-file-url",{smart_count:fileEnabled?1:0}))?"":_.escape(__t))+"\n  ",__p+='\n</h3>\n<p class="CDB-Text CDB-Size-medium u-altTextColor">\n  ',"selected"!==state&&(__p+="\n    ",fileEnabledText=_t("components.modals.add-layer.imports.header-import.select-a-file")+' <a href="https://carto.com/docs/carto-engine/import-api/importing-geospatial-data/#supported-geospatial-data-formats">'+_t("components.modals.add-layer.imports.header-import.see-all-formats")+"</a>",__p+="\n    "+(null==(__t=_t("components.modals.add-layer.imports.header-import.paste-url",{fileEnabled:fileEnabled?fileEnabledText:""}))?"":__t)+"\n  "),__p+="\n  ","selected"===state&&(__p+="\n    ",__p+=acceptSync?"\n      "+(null==(__t=_t("components.modals.add-layer.imports.header-import.sync-enabled"))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.modals.add-layer.imports.header-import.sync-disabled"))?"":_.escape(__t))+"\n    ",__p+="\n  "),__p+="\n</p>\n","selected"===state&&(__p+='\n  <button class="NavButton NavButton--back ImportPanel-headerButton js-back">\n    <i class="CDB-IconFont CDB-IconFont-arrowPrev"></i>\n  </button>\n'),__p+="\n";return __p}},{underscore:"underscore"}],325:[function(a,b,c){var d=a("../import-view"),e=a("../../../../../../data/upload-model"),f=a("./import-data-form-view"),g=a("./import-data-header-view"),h=a("../import-selected-dataset-view"),i=a("./import-data.tpl");b.exports=d.extend({options:{fileExtensions:[],type:"url",service:"",acceptSync:!1,fileEnabled:!1,formTemplate:"",headerTemplate:"",fileAttrs:{}},className:"ImportPanel ImportDataPanel",initialize:function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");this._userModel=a.userModel,this._configModel=a.configModel,this.model=new e({type:this.options.type,service_name:this.options.service},{userModel:this._userModel,configModel:this._configModel}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(i()),this._initViews(),this},_initViews:function(){var a=new g({el:this.$(".ImportPanel-header"),model:this.model,userModel:this._userModel,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:this.options.headerTemplate});a.render(),this.addView(a);var b=new h({el:this.$(".DatasetSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});b.render(),this.addView(b);var c=new f({el:this.$(".ImportPanel-form"),userModel:this._userModel,model:this.model,template:this.options.formTemplate,fileEnabled:this.options.fileEnabled});c.bind("fileSelected",function(){b.setOptions({acceptSync:!1,fileAttrs:{ext:!0,title:"name",description:{content:[{name:"size",format:"size"}]}}})}),c.bind("urlSelected",function(){b.setOptions({acceptSync:!0,fileAttrs:{ext:!1,title:"",description:""}})}),c.render(),this.addView(c)},_initBinds:function(){this.model.bind("change:state",this._checkState,this),this.model.bind("change",this._triggerChange,this)},_checkState:function(){"selected"===this.model.previous("state")&&this.model.set({type:void 0,value:"",service_name:"",service_item_id:"",interval:0})}})},{"../../../../../../data/upload-model":668,"../import-selected-dataset-view":331,"../import-view":359,"./import-data-form-view":321,"./import-data-header-view":323,"./import-data.tpl":326}],326:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">'+(null==(__t=_t("components.modals.add-layer.imports.form-import.title"))?"":_.escape(__t))+'</h3>\n  <p class="ImportPanel-headerDescription">'+(null==(__t=_t("components.modals.add-layer.imports.form-import.desc"))?"":_.escape(__t))+'</p>\n</div>\n<div class="ImportPanel-body">\n  <div class="ImportPanel-bodyWrapper">\n    <div class="ImportPanel-state ImportPanel-form is-idle"></div>\n    <div class="ImportPanel-state is-selected DatasetSelected"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],327:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","list"!==state&&(__p+='\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n    ',__p+="selected"===state?"\n      "+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.campaign-selected",{brand:"MailChimp"}))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.map-campaign",{brand:"MailChimp"}))?"":_.escape(__t))+"\n    ",__p+='\n  </h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor ',"error"===state&&(__p+="ImportPanel-headerDescription--negative"),__p+='">\n    ',"idle"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.state-idle",{brand:"MailChimp"}))?"":_.escape(__t))+"\n    "),__p+="\n    ","error"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.state-error",{brand:"MailChimp"}))?"":_.escape(__t))+"\n    "),__p+="\n    ","token"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.state-token",{brand:"MailChimp"}))?"":_.escape(__t))+"\n    "),__p+="\n    ","oauth"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.state-oauth",{brand:"MailChimp"}))?"":_.escape(__t))+"\n    "),__p+="\n    ","retrieving"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.state-retrieving",{brand:"MailChimp"}))?"":_.escape(__t))+"\n    "),__p+="\n    ","selected"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.mailchimp.state-selected",{brand:"MailChimp"}))?"":_.escape(__t))+"\n    "),__p+="\n  </p>\n  ","selected"===state&&(__p+='\n    <button class="NavButton NavButton--back ImportPanel-headerButton js-back">\n      <i class="CDB-IconFont CDB-IconFont-arrowPrev"></i>\n    </button>\n  '),__p+="\n"),__p+="\n";return __p}},{underscore:"underscore"}],328:[function(a,b,c){var d=a("./import-data/import-data-view"),e=a("./import-service/import-service-view"),f=a("./import-arcgis/import-arcgis-view"),g=a("./import-twitter/import-twitter-view");b.exports={File:{view:d,enabled:function(a,b){return!0},name:"file",title:"Data file",options:{type:"url",fileEnabled:!0,acceptSync:!0}},GDrive:{view:e,enabled:function(a,b){return!!a.get("oauth_gdrive")},name:"gdrive",title:"Google Drive",options:{service:"gdrive",fileExtensions:["Google SpreadSheet","CSV"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"size",format:"size",key:!0}]}}}},Dropbox:{view:e,enabled:function(a,b){return!!a.get("oauth_dropbox")},name:"dropbox",title:"Dropbox",options:{service:"dropbox",fileExtensions:["CSV","XLS"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"id",format:""},{name:"size",format:"size",key:!0}],separator:"-"}}}},Box:{view:e,enabled:function(a,b){return!!a.get("oauth_box")},name:"box",title:"Box",fallback:a("./fallbacks/import-box-fallback.tpl"),options:{service:"box",fileExtensions:["CSV","XLS"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"size",format:"size",key:!0}],separator:"-"}}}},Twitter:{view:g,enabled:function(a,b){return b.get("twitter").enabled&&!!a.get("datasource_search_twitter")},fallback:a("./fallbacks/import-twitter-fallback.tpl"),name:"twitter",title:"Twitter"},Mailchimp:{view:e,enabled:function(a,b){return b.get("mailchimp").enabled&&!!a.get("oauth_mailchimp")},fallback:a("./fallbacks/import-mailchimp-fallback.tpl"),name:"mailchimp",title:"MailChimp",options:{service:"mailchimp",fileExtensions:[],acceptSync:!0,showAvailableFormats:!1,headerTemplate:a("./import-mailchimp/import-data-header-mailchimp.tpl"),fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"member_count",format:"number",key:!0}],itemName:"member",separator:""}}}},Arcgis:{view:f,enabled:function(a,b){return a.get("arcgis_enabled")},fallback:a("./fallbacks/import-arcgis-fallback.tpl"),name:"arcgis",title:"ArcGIS Server&trade;"},Salesforce:{view:d,enabled:function(a,b){return a.get("salesforce_enabled")},fallback:a("./fallbacks/import-salesforce-fallback.tpl"),name:"salesforce",title:"Salesforce",options:{type:"service",service_name:"salesforce",acceptSync:!0,formTemplate:a("./import-salesforce/import-data-form-salesforce.tpl"),headerTemplate:a("./import-salesforce/import-data-header-salesforce.tpl")}}}},{"./fallbacks/import-arcgis-fallback.tpl":312,"./fallbacks/import-box-fallback.tpl":313,"./fallbacks/import-mailchimp-fallback.tpl":314,"./fallbacks/import-salesforce-fallback.tpl":315,"./fallbacks/import-twitter-fallback.tpl":316,"./import-arcgis/import-arcgis-view":320,"./import-data/import-data-view":325,"./import-mailchimp/import-data-header-mailchimp.tpl":327,"./import-salesforce/import-data-form-salesforce.tpl":329,"./import-salesforce/import-data-header-salesforce.tpl":330,"./import-service/import-service-view":346,"./import-twitter/import-twitter-view":352}],329:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="Form js-form">\n  <div class="Form-row">\n    <div class="Form-rowLabel">\n      <label class="CDB-Text CDB-Size-medium"><span>'+(null==(__t=_t("components.modals.add-layer.imports.form-import.title"))?"":_.escape(__t))+'</span></label>\n    </div>\n    <div class="Form-rowData Form-rowData--longer">\n      <input type="text" class="CDB-Text CDB-Size-medium Form-input Form-input--longer has-submit js-textInput" value="" placeholder="'+(null==(__t=_t("components.modals.add-layer.imports.salesforce.salesforce.input-placeholder",{brand:"Salesforce"}))?"":_.escape(__t))+'" />\n      <button type="submit" class="CDB-Text CDB-Size-small Form-inputSubmit u-upperCase u-actionTextColor Form-inputSubmit">\n        <span>'+(null==(__t=_t("components.modals.add-layer.imports.form-import.submit"))?"":_.escape(__t))+'</span>\n      </button>\n      <div class="Form-inputError CDB-Text">\n        <span>'+(null==(__t=_t("components.modals.add-layer.imports.form-import.error-desc"))?"":_.escape(__t))+"</span>\n      </div>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],330:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n  ',__p+="selected"===state?"\n    "+(null==(__t=_t("components.modals.add-layer.imports.header-import.type-selected",{brand:"Salesforce"}))?"":_.escape(__t))+"\n  ":"\n    "+(null==(__t=_t("components.modals.add-layer.imports.header-import.type-import",{brand:"Salesforce"}))?"":_.escape(__t))+"\n  ",__p+='\n</h3>\n<p class="CDB-Text CDB-Size-medium u-altTextColor">\n  ',"selected"!==state?__p+="\n    "+(null==(__t=_t("components.modals.add-layer.imports.header-import.import-url",{brand:"Salesforce"}))?"":_.escape(__t))+"\n  ":(__p+="\n    ",__p+=acceptSync?"\n      "+(null==(__t=_t("components.modals.add-layer.imports.header-import.sync-enabled",{brand:"Salesforce"}))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.modals.add-layer.imports.header-import.sync-disabled",{brand:"Salesforce"}))?"":_.escape(__t))+"\n    ",__p+="\n  "),__p+="\n</p>\n","selected"===state&&(__p+='\n  <button class="NavButton NavButton--back ImportPanel-headerButton js-back">\n    <i class="CDB-IconFont CDB-IconFont-arrowPrev"></i>\n  </button>\n'),__p+="\n";return __p}},{underscore:"underscore"}],331:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../../../../helpers/utils"),g=a("./import-selected-dataset.tpl");b.exports=d.extend({className:"DatasetSelected",_FORMATTERS:{size:f.readablizeBytes,number:f.formatNumber},options:{acceptSync:!1,fileAttrs:{ext:!1,title:"",description:{content:[{name:"id",format:""}],itemName:"",separator:""}}},events:{"click .js-interval-0":"_onIntervalZero","click .js-interval-1":"_onIntervalHour","click .js-interval-2":"_onIntervalDay","click .js-interval-3":"_onIntervalWeek","click .js-interval-4":"_onIntervalMonth"},initialize:function(a){if(!a.userModel)throw new TypeError("userModel is required");if(!a.configModel)throw new TypeError("configModel is required");this._configModel=a.configModel,this._userModel=a.userModel,this._initBinds(),this._checkVisibility()},render:function(){var a=this.options.fileAttrs.title&&this.model.get("value")[this.options.fileAttrs.title]||this.model.get("value"),b=this._genDescription(),c=this.options.fileAttrs.ext?f.getFileExtension(a):"";this.options.fileAttrs.ext&&(a=a&&a.replace("."+c,""));var d=window.upgrade_url,e=this._userModel.isActionEnabled("sync_tables"),h=this._configModel.get("cartodb_com_hosted");return this.$el.html(g({title:a,description:b,ext:c,interval:this.model.get("interval"),importCanSync:this.options.acceptSync,userCanSync:e,showTrial:this._userModel.canStartTrial(),showUpgrade:!e&&!h&&d&&!this._userModel.isInsideOrg(),upgradeUrl:d})),this},_initBinds:function(){this.model.bind("change:value",this.render,this),this.model.bind("change:interval",this.render,this),this.model.bind("change:state",this._checkVisibility,this)},_genDescription:function(){if(this.options.fileAttrs&&this.options.fileAttrs.description){var a=this.options.fileAttrs.description,b="",c="",d=this;return a.content&&a.content.length>0&&e.each(a.content,function(e,f){f>0&&a.separator&&(c+=" "+a.separator+" ");var g=d.model.get("value")[e.name],h=e.format&&d._FORMATTERS[e.format];c+=h&&h(g)||g,e.key&&(b=e.name)}),a.itemName&&b&&(c+=" "+(a.itemName&&_t("components.modals.add-layer.imports."+a.itemName+"-pluralize",{smart_count:b})||"")),c}return""},_onIntervalZero:function(){this.model.set("interval",0)},_onIntervalHour:function(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",3600)},_onIntervalDay:function(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",86400)},_onIntervalWeek:function(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",604800)},_onIntervalMonth:function(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",2592e3)},setOptions:function(a){a&&!e.isEmpty(a)&&e.extend(this.options,a)},_checkVisibility:function(){var a=this.model.get("state");"selected"===a?this.show():this.hide()}})},{"../../../../../helpers/utils":1102,"./import-selected-dataset.tpl":332,"backbone/core-view":1127,underscore:"underscore"}],332:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="DatasetSelected-item">\n  <div class="DatasetSelected-itemExt CDB-Text u-ellipsis">\n    '+(null==(__t=ext||"?")?"":_.escape(__t))+'\n  </div>\n  <div class="DatasetSelected-itemInfo u-ellipsis">\n    <h6 class="CDB-Text CDB-Size-large u-ellipsis" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</h6>\n    <p class="CDB-Text CDB-Size-small u-ellipsis u-altTextColor">'+(null==(__t=description)?"":_.escape(__t))+"</p>\n  </div>\n</div>\n",importCanSync&&(__p+='\n  <div class="DatasetSelected-sync">\n    <div class="DatasetSelected-syncOptions">\n      <label class="DatasetSelected-syncLabel CDB-Text CDB-Size-medium u-mainTextColor">\n        '+(null==(__t=_t("components.modals.add-layer.imports.selected-state.sync-my-data"))?"":_.escape(__t))+'\n      </label>\n      <ul class="DatasetSelected-syncOptionsList">\n        <li class="DatasetSelected-syncOptionsItem">\n          <div class="RadioButton">\n            <button class="RadioButton-input js-interval-0 '+(null==(__t=0===interval?"is-checked":"")?"":_.escape(__t))+'"></button>\n            <label class="CDB-Text CDB-Size-medium u-altTextColor u-lSpace">'+(null==(__t=_t("components.modals.add-layer.imports.selected-state.never"))?"":_.escape(__t))+'</label>\n          </div>\n        </li>\n        <li class="DatasetSelected-syncOptionsItem">\n          <div class="RadioButton '+(null==(__t=userCanSync?"":"is-disabled")?"":_.escape(__t))+'">\n            <button class="RadioButton-input js-interval-1 '+(null==(__t=3600===interval?"is-checked":"")?"":_.escape(__t))+'"></button>\n            <label class="CDB-Text CDB-Size-medium u-altTextColor u-lSpace">'+(null==(__t=_t("components.modals.add-layer.imports.selected-state.every-hour"))?"":_.escape(__t))+'</label>\n          </div>\n        </li>\n        <li class="DatasetSelected-syncOptionsItem">\n          <div class="RadioButton '+(null==(__t=userCanSync?"":"is-disabled")?"":_.escape(__t))+'">\n            <button class="RadioButton-input js-interval-2 '+(null==(__t=86400===interval?"is-checked":"")?"":_.escape(__t))+'"></button>\n            <label class="CDB-Text CDB-Size-medium u-altTextColor u-lSpace">'+(null==(__t=_t("components.modals.add-layer.imports.selected-state.every-day"))?"":_.escape(__t))+'</label>\n          </div>\n        </li>\n        <li class="DatasetSelected-syncOptionsItem">\n          <div class="RadioButton '+(null==(__t=userCanSync?"":"is-disabled")?"":_.escape(__t))+'">\n            <button class="RadioButton-input js-interval-3 '+(null==(__t=604800===interval?"is-checked":"")?"":_.escape(__t))+'"></button>\n            <label class="CDB-Text CDB-Size-medium u-altTextColor u-lSpace">'+(null==(__t=_t("components.modals.add-layer.imports.selected-state.every-week"))?"":_.escape(__t))+'</label>\n          </div>\n        </li>\n        <li class="DatasetSelected-syncOptionsItem">\n          <div class="RadioButton '+(null==(__t=userCanSync?"":"is-disabled")?"":_.escape(__t))+'">\n            <button class="RadioButton-input js-interval-4 '+(null==(__t=2592e3===interval?"is-checked":"")?"":_.escape(__t))+'"></button>\n            <label class="CDB-Text CDB-Size-medium u-altTextColor u-lSpace">'+(null==(__t=_t("components.modals.add-layer.imports.selected-state.every-month"))?"":_.escape(__t))+"</label>\n          </div>\n        </li>\n      </ul>\n    </div>\n    ",
showUpgrade&&(__p+='\n      <div class="Upgrade-info">\n        <p class="CDB-Text CDB-Size-medium u-ellipsis u-secondaryTextColor">\n         ',featuresLink='<a href="https://carto.com/pricing">'+_t("components.modals.add-layer.imports.selected-state.more-features")+"</a>",__p+="\n          "+(null==(__t=_t("components.modals.add-layer.imports.selected-state.upgrade-desc",{features:featuresLink}))?"":_.escape(__t))+'\n        </p>\n        <div class="Upgrade-infoActions">\n          ',showTrial&&(__p+='\n            <p class="CDB-Text CDB-Size-medium u-ellipsis is-semibold u-rSpace--xl">'+(null==(__t=_t("components.modals.add-layer.imports.selected-state.free-trial",{days:14}))?"":_.escape(__t))+"</p>\n          "),__p+='\n          <a href="'+(null==(__t=upgradeUrl)?"":_.escape(__t))+'" class="CDB-Button CDB-Button--secondary">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-layer.imports.selected-state.upgrade"))?"":_.escape(__t))+"</span>\n          </a>\n        </div>\n      </div>\n    "),__p+="\n  </div>\n"),__p+="\n";return __p}},{underscore:"underscore"}],333:[function(a,b,c){var d=a("backbone/core-view"),e=a("./import-service-header.tpl");b.exports=d.extend({events:{"click .js-back":"_goToList"},options:{title:"Service",showAvailableFormats:!1,acceptSync:!1,fileExtensions:[],template:""},initialize:function(a){if(!a.userModel)throw new Error("userModel is required");this._userModel=a.userModel,this.template=a.template||e,this._initBinds()},render:function(){return this.$el.html(this.template({items:this.collection.size(),service_name:this.model.get("service_name"),showAvailableFormats:this.options.showAvailableFormats,fileExtensions:this.options.fileExtensions,acceptSync:this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables"),state:this.model.get("state"),title:this.options.title})),this._checkVisibility(),this},_initBinds:function(){this.model.bind("change:state",this.render,this)},_checkVisibility:function(){var a=this.model.get("state");this["list"!==a?"show":"hide"]()},_goToList:function(){this.model.set("state","list")}})},{"./import-service-header.tpl":334,"backbone/core-view":1127}],334:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","list"!==state&&(__p+='\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n    ',"selected"===state?(__p+="\n      ",__p+="instagram"===service_name?"\n        "+(null==(__t=_t("components.modals.add-layer.imports.service-import.account-connected"))?"":_.escape(__t))+"\n        ":"\n        "+(null==(__t=_t("components.modals.add-layer.imports.service-import.item-selected"))?"":_.escape(__t))+"\n      ",__p+="\n    "):__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.service-import.connect-with",{title:title}))?"":_.escape(__t))+"\n    ",__p+='\n  </h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor ',"error"===state&&(__p+="ImportPanel-headerDescription--negative"),__p+='">\n    ',"idle"===state&&(__p+="\n      ",fileExtensions.length>0?(__p+="\n        ",formatsLink=_t("components.modals.add-layer.imports.service-import.and")+' <a target="_blank" href="https://docs.carto.com/cartodb-editor/datasets/#supported-file-formats" class="ImportPanel-headerDescriptionLink">'+_t("components.modals.add-layer.imports.service-import.many-more-formats")+"</a>",__p+="\n        "+(null==(__t=fileExtensions.join(", "))?"":_.escape(__t)),showAvailableFormats&&(__p+=" "+(null==(__t=formatsLink)?"":_.escape(__t))+" "),__p+=" "+(null==(__t=_t("components.modals.add-layer.imports.service-import.supported"))?"":_.escape(__t))+".\n      "):__p+="\n        "+(null==(__t=_t("components.modals.add-layer.imports.service-import.state-idle-login"))?"":_.escape(__t))+"\n      ",__p+="\n    "),__p+="\n    ","error"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.service-import.state-error"))?"":_.escape(__t))+"\n    "),__p+="\n    ","token"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.service-import.state-token"))?"":_.escape(__t))+"\n    "),__p+="\n    ","oauth"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.service-import.state-oauth"))?"":_.escape(__t))+"\n    "),__p+="\n    ","retrieving"===state&&(__p+="\n      "+(null==(__t=_t("components.modals.add-layer.imports.service-import.state-retrieving",{title:title}))?"":_.escape(__t))+"\n    "),__p+="\n    ","selected"===state&&(__p+="\n      ",acceptSync?__p+="\n        "+(null==(__t=_t("components.modals.add-layer.imports.service-import.state-selected-sync"))?"":_.escape(__t))+"\n      ":(__p+="\n        ",__p+="instagram"===service_name?"\n          "+(null==(__t=_t("components.modals.add-layer.imports.service-import.state-selected-instagram"))?"":_.escape(__t))+"\n        ":"\n          "+(null==(__t=_t("components.modals.add-layer.imports.service-import.state-selected-no-sync"))?"":_.escape(__t))+"\n        ",__p+="\n      "),__p+="\n    "),__p+="\n  </p>\n  ","selected"===state&&items>1&&(__p+='\n    <button class="CDB-Size-large ImportPanel-headerButton js-back">\n      <i class="CDB-IconFont CDB-IconFont-arrowPrev u-actionTextColor"></i>\n    </button>\n  '),__p+="\n"),__p+="\n";return __p}},{underscore:"underscore"}],335:[function(a,b,c){var d=a("../../../../../../helpers/utils");b.exports={formatSize:function(a){return a&&a>0?d.readablizeBytes(a):"Unknown"}}},{"../../../../../../helpers/utils":1102}],336:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{id:"",filename:"",checksum:"",service:"",size:"",title:""}})},{backbone:"backbone"}],337:[function(a,b,c){var d=a("./import-service-item-model"),e=a("backbone");b.exports=e.Collection.extend({_DATASOURCE_NAME:"dropbox",model:d,url:function(a){var b=this._configModel.urlVersion("imports_service"),c=this._configModel.get("base_url");return c+"/api/"+b+"/imports/service/"+this._DATASOURCE_NAME+"/list_files"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.datasourceName)throw new Error("datasourceName is required");this._configModel=b.configModel,this._DATASOURCE_NAME=b.datasourceName},fetch:function(){return this.trigger("fetch",this),e.Collection.prototype.fetch.apply(this,arguments)},parse:function(a){return a.files}})},{"./import-service-item-model":336,backbone:"backbone"}],338:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../../helpers/utils"),f=a("./import-service-item-description-format"),g=a("./import-service-list-item.tpl"),h=a("underscore");b.exports=d.extend({options:{title:"",fileAttrs:{ext:!1,title:"filename",description:"size",itemName:"file",formatDescription:""}},_FORMATTERS:{size:f.formatSize,number:e.formatNumber},className:"ServiceList-item",tagName:"li",events:{"click .js-choose":"_onSelectItem"},render:function(){var a=this.model.get(this.options.fileAttrs.title),b=this._genDescription(),c=this.options.fileAttrs.ext?e.getFileExtension(a):"";return this.options.fileAttrs.ext&&(a=a&&a.replace("."+c,"")),this.$el.html(g({name:this.options.title,ext:c,title:a,description:b})),this},_genDescription:function(){if(this.options.fileAttrs&&this.options.fileAttrs.description){var a=this.options.fileAttrs.description,b="",c="",d=this;return a.content&&a.content.length>0&&h.each(a.content,function(e,f){f>0&&a.separator&&(c+=" "+a.separator+" ");var g=d.model.get(e.name),h=e.format&&d._FORMATTERS[e.format];c+=h&&h(g)||g,e.key&&(b=e.name)}),a.itemName&&b&&(c+=" "+(a.itemName&&_t("components.modals.add-layer.imports."+a.itemName+"-pluralize",{smart_count:b})||"")),c}return""},_onSelectItem:function(){this.trigger("selected",this.model,this)}})},{"../../../../../../helpers/utils":1102,"./import-service-item-description-format":335,"./import-service-list-item.tpl":339,"backbone/core-view":1127,underscore:"underscore"}],339:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ServiceList-itemExt u-ellipsLongText CDB-Text CDB-Size-medium u-rSpace--xl">\n  '+(null==(__t=ext||"?")?"":_.escape(__t))+'\n</div>\n<div class="ServiceList-itemInfo u-flex u-alignCenter u-justifySpace">\n  <div class="ServiceList-itemInfoTitle">\n    <h6 class="CDB-Text CDB-Size-large u-bSpace u-ellipsis" >'+(null==(__t=title)?"":_.escape(__t))+'</h6>\n    <p class="CDB-Text CDB-Size-medium u-altTextColor u-ellipsis">'+(null==(__t=description)?"":_.escape(__t))+'</p>\n  </div>\n  <div class="ServiceList-itemActions">\n    <button class="CDB-Button CDB-Button--secondary js-choose">\n      <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">'+(null==(__t=_t("components.modals.add-layer.imports.service-import.choose"))?"":_.escape(__t))+"</span>\n    </button>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],340:[function(a,b,c){var d=a("backbone/core-view"),e=a("./import-service-list-item-view"),f=a("./import-service-list.tpl");b.exports=d.extend({options:{title:"service",fileAttrs:{}},initialize:function(){this._initBinds(),this._checkVisibility()},render:function(){this.clearSubViews();var a=this.collection.size();return this.$el.html(f({size:a,title:this.options.title,pluralize:_t("components.modals.add-layer.imports.item-pluralize",{smart_count:a})})),this.collection.size()>0&&this.collection.each(this._addItem,this),this},_initBinds:function(){this.collection.bind("sync",this.render,this),this.model.bind("change:state",this._checkVisibility,this),this.add_related_model(this.collection)},_addItem:function(a){var b=new e({model:a,title:this.options.title,fileAttrs:this.options.fileAttrs});b.bind("selected",this._onSelectedItem,this),this.$(".ServiceList-items").append(b.render().el),this.addView(b)},_onSelectedItem:function(a){this.model.setUpload({state:"selected",value:a.toJSON(),service_item_id:a.get("id")})},_checkVisibility:function(){var a=this.model.get("state");"list"===a?this.show():this.hide()}})},{"./import-service-list-item-view":338,"./import-service-list.tpl":341,"backbone/core-view":1127}],341:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ConnectDataset-header">\n  <h2 class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=_t("components.modals.add-layer.imports.service-import.found-in",{size:size,pluralize:pluralize,title:title}))?"":_.escape(__t))+'\n  </h2>\n</div>\n<div class="ServiceList-body">\n  ',__p+=size>0?'\n    <ul class="ServiceList-items"></ul>\n  ':'\n    <div class="IntermediateInfo ServiceList-empty">\n      <div class="LayoutIcon">\n        <i class="CDB-IconFont CDB-IconFont-lens"></i>\n      </div>\n      <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n        '+(null==(__t=_t("components.modals.add-layer.imports.service-import.no-results-title"))?"":_.escape(__t))+'\n      </h4>\n      <p class="CDB-Text CDB-Size-medium u-altTextColor">\n        '+(null==(__t=_t("components.modals.add-layer.imports.service-import.no-results-desc"))?"":_.escape(__t))+"\n      </p>\n    </div>\n  ",__p+="\n</div>\n";return __p}},{underscore:"underscore"}],342:[function(a,b,c){var d=a("backbone/core-view"),e=a("./import-service-loader.tpl");b.exports=d.extend({events:{"click .js-connect":"_checkToken"},initialize:function(a){if(!a.serviceTokenModel)throw new Error("serviceTokenModel prodiver is required");if(!a.serviceOauthModel)throw new Error("serviceOauthModel is required");this._serviceTokenModel=a.serviceTokenModel,this._serviceOauthModel=a.serviceOauthModel,this._initBinds(),this._checkVisibility()},render:function(){return this.$el.html(e({state:this.model.get("state")})),this},_initBinds:function(){this.model.bind("change:state",function(){this.render(),this._checkVisibility()},this)},_checkToken:function(){var a=this;this.model.set("state","token"),this._serviceTokenModel.fetch({success:function(b){b.get("oauth_valid")||a._getOauthURL()},error:function(b){a._getOauthURL()}})},_checkVisibility:function(){var a=this.model.get("state");"list"!==a&&"selected"!==a?this.show():this.hide()},_getOauthURL:function(){var a=this;this.model.set("state","oauth"),this._serviceOauthModel.set({url:""},{silent:!0}),this._serviceOauthModel.fetch({error:function(){a.model.set("state","error")}})}})},{"./import-service-loader.tpl":343,"backbone/core-view":1127}],343:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-actions">\n  ',__p+="idle"===state?'\n    <button class="CDB-Button CDB-Button--primary js-connect">\n      <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">\n        '+(null==(__t=_t("components.modals.add-layer.imports.service-import.connect"))?"":_.escape(__t))+"\n      </span>\n    </button>\n  ":"error"===state?'\n    <button class="CDB-Button CDB-Button--primary js-connect">\n      <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">\n        '+(null==(__t=_t("components.modals.add-layer.imports.service-import.try-again"))?"":_.escape(__t))+"\n      </span>\n    </button>\n  ":'\n    <div class="Spinner ImportPanel-actionsLoader"></div>\n  ',__p+="\n</div>\n";return __p}},{underscore:"underscore"}],344:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({_DATASOURCE_NAME:"dropbox",url:function(a){var b=this._configModel.urlVersion("imports_service"),c=this._configModel.get("base_url");return c+"/api/"+b+"/imports/service/"+this._DATASOURCE_NAME+"/auth_url"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.datasourceName)throw new Error("datasource_name is required");this._configModel=b.configModel,this._DATASOURCE_NAME=b.datasourceName}})},{backbone:"backbone"}],345:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({_DATASOURCE_NAME:"dropbox",url:function(a){var b=this._configModel.urlVersion("imports_service"),c=this._configModel.get("base_url");return c+"/api/"+b+"/imports/service/"+this._DATASOURCE_NAME+"/token_valid"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.datasourceName)throw new Error("datasource_name is required");this._configModel=b.configModel,this._DATASOURCE_NAME=b.datasourceName}})},{backbone:"backbone"}],346:[function(a,b,c){var d=a("../import-view"),e=a("../../../../../../data/upload-model"),f=a("./import-service-header-view"),g=a("./import-service-loader-view"),h=a("./import-service-list-view"),i=a("../import-selected-dataset-view"),j=a("./import-service-token-model"),k=a("./import-service-oauth-model"),l=a("./import-service-items-collection"),m=a("./import-service.tpl"),n=1e3;b.exports=d.extend({_DATASOURCE_NAME:"dropbox",className:"ImportPanel ImportPanelService",options:{service:"",showAvailableFormats:!1,fileExtensions:[],acceptSync:!1,fileAttrs:{ext:!1,title:"filename",description:"<%- size %>",formatDescription:"size",headerTemplate:""}},initialize:function(a){if(!a.service)throw new Error("service prodiver is required");if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");this._userModel=a.userModel,this._configModel=a.configModel,this._DATASOURCE_NAME=this.options.service,this.model=new e({type:"service",service_name:this._DATASOURCE_NAME},{userModel:this._userModel,configModel:this._configModel}),this._initModels(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(m(this.options)),this._initViews(),this},_initModels:function(){this._serviceTokenModel=new j(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel}),this._serviceOauthModel=new k(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel}),this.collection=new l(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel})},_initBinds:function(){this.model.bind("change",this._triggerChange,this),this.model.bind("change:state",this._checkState,this),this._serviceTokenModel.bind("change:oauth_valid",this._onOauthChange,this),this._serviceOauthModel.bind("change:url",this._openWindow,this),this.add_related_model(this._serviceOauthModel),this.add_related_model(this._serviceTokenModel)},_initViews:function(){var a=new f({el:this.$(".ImportPanel-header"),userModel:this._userModel,model:this.model,collection:this.collection,title:this.options.title,showAvailableFormats:this.options.showAvailableFormats,fileExtensions:this.options.fileExtensions,acceptSync:this.options.acceptSync,template:this.options.headerTemplate});a.render(),this.addView(a);var b=new g({el:this.$(".ServiceLoader"),model:this.model,serviceTokenModel:this._serviceTokenModel,serviceOauthModel:this._serviceOauthModel});b.render(),this.addView(b);var c=new h({el:this.$(".ServiceList"),model:this.model,collection:this.collection,title:this.options.title,fileAttrs:this.options.fileAttrs});c.render(),this.addView(c);var d=new i({el:this.$(".ServiceSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});d.render(),this.addView(d)},_onOauthChange:function(){this._serviceTokenModel.get("oauth_valid")&&this._getFiles()},_getFiles:function(){var a=this;this.model.set("state","retrieving"),this.collection.fetch({error:function(){a.model.set("state","error")},success:function(){a.model.set("state","list")}})},_checkState:function(){if("list"===this.model.get("state")&&1===this.collection.size()){var a=this.collection.at(0);this.model.setUpload({state:"selected",value:a.toJSON(),service_item_id:a.get("id")})}"selected"!==this.model.get("state")&&this.model.set({value:"",service_item_id:"",interval:0})},_openWindow:function(){var a=this._serviceOauthModel.get("url"),b=this,c=window.open(a,null,"menubar=no,toolbar=no,width=600,height=495"),d=window.setInterval(function(){c&&c.closed?(b._getFiles(),clearInterval(d)):c||(b.model.set("state","error"),clearInterval(d))},n)}})},{"../../../../../../data/upload-model":668,"../import-selected-dataset-view":331,"../import-view":359,"./import-service-header-view":333,"./import-service-items-collection":337,"./import-service-list-view":340,"./import-service-loader-view":342,"./import-service-oauth-model":344,"./import-service-token-model":345,"./import-service.tpl":347}],347:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header"></div>\n<div class="ImportPanel-body">\n  <div class="ImportPanel-bodyWrapper">\n    <div class="ImportPanel-state ServiceLoader is-idle is-token is-oauth is-retrieving is-error"></div>\n    <div class="ImportPanel-state ServiceList is-list"></div>\n    <div class="ImportPanel-state ServiceSelected DatasetSelected is-selected"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],348:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<i class='TabIcon is-"+(null==(__t=name)?"":_.escape(__t))+"'></i>\n<span>"+(null==(__t=cdb.core.sanitize.html(title||name))?"":__t)+"</span>\n";return __p}},{underscore:"underscore"}],349:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../../helpers/utils"),f=a("./credits-info.tpl");b.exports=d.extend({initialize:function(a){this._userModel=a.userModel,this._initBinds()},render:function(){var a=this._userModel.get("twitter"),b=a.quota-a.monthly_use,c=Math.min(100,Math.ceil(100*this.model.get("value")/b));return this.$el.html(f({value:this.model.get("value"),remaining:b,per:c,hardLimit:a.hard_limit,remainingFormatted:e.formatNumber(b),quota:a.quota,block_price:a.block_price,block_size:e.readizableNumber(a.block_size)})),this},_initBinds:function(){this.model.bind("change",this.render,this)}})},{"../../../../../../helpers/utils":1102,"./credits-info.tpl":350,"backbone/core-view":1127}],350:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",extraTweets="<strong>$"+block_price/100+"/"+block_size+" "+_t("components.modals.add-layer.imports.twitter.extra-tweets")+"</strong>",__p+="\n",__p+=value<=remaining?"\n  "+(null==(__t=_t("components.modals.add-layer.imports.twitter.credits-left",{per:per,remainingFormatted:remainingFormatted}))?"":_.escape(__t))+"\n":remaining<=0&&!hardLimit?"\n  "+(null==(__t=_t("components.modals.add-layer.imports.twitter.credits-consumed",{extraTweets:extraTweets}))?"":__t)+"\n":"\n  "+(null==(__t=_t("components.modals.add-layer.imports.twitter.credits-no-limit",{extraTweets:extraTweets}))?"":__t)+"\n",__p+="\n";return __p}},{underscore:"underscore"}],351:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("underscore");a("jquery-ui");var g=a("./credits-info-view"),h=80,i=1;b.exports=e.extend({initialize:function(a){if(!a.userModel)throw new Error("userModel is required");this._userModel=a.userModel,this.model=new d.Model,this._initBinds(),this._setModel()},render:function(){return this.clearSubViews(),this._destroySlider(),this._initViews(),this},_initBinds:function(){this.model.bind("change:value",this._onValueChange,this)},_setModel:function(){var a=this._userModel.get("twitter"),b=a.quota-a.monthly_use,c=i*b/100,d=b*h/100,e=b>0?d:b+1;this.model.set({max:a.hard_limit?b:b+1,min:c,step:c,value:b>0?e:a.quota,disabled:b<=0})},_initViews:function(){this.$(".js-slider").slider(f.extend({range:"min",orientation:"horizontal",slide:this._onSlideChange.bind(this),change:this._onSlideChange.bind(this)},this.model.attributes));var a=new g({el:this.$(".js-info"),userModel:this._userModel,model:this.model});a.render(),this.addView(a)},_onSlideChange:function(a,b){this.model.set("value",b.value)},_onValueChange:function(){this.trigger("maxCreditsChange",this.getMaxCredits(),this)},getMaxCredits:function(){var a=this._userModel.get("twitter"),b=a.quota-a.monthly_use,c=this.model.get("value");return c>b?0:c},_destroySlider:function(){this.$(".js-slider").data("ui-slider")&&this.$(".js-slider").slider("destroy")},clean:function(){this._destroySlider(),e.prototype.clean.call(this)}})},{"./credits-info-view":349,backbone:"backbone","backbone/core-view":1127,"jquery-ui":1128,underscore:"underscore"}],352:[function(a,b,c){var d=a("underscore"),e=a("moment"),f=a("../import-view"),g=a("../../../../../../data/upload-model"),h=a("../../../../../date-picker-range/date-picker-range-view"),i=a("./twitter-categories/twitter-categories-view"),j=a("./credits-usage-view.js"),k=a("./import-twitter.tpl");b.exports=f.extend({options:{acceptSync:!1,type:"service",service:"twitter_search"},className:"ImportPanel ImportTwitterPanel",initialize:function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");this._userModel=a.userModel,this._configModel=a.configModel,this.model=new g({type:this.options.type,service_name:this.options.service},{userModel:this._userModel,configModel:this._configModel}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(k({currentGMT:e().format("Z")})),this._initViews(),this},_initViews:function(){var a=this.categories=new i;a.bind("changeCategory",this._setModel,this),this.$(".ImportTwitterPanel-cagetories").append(a.render().el),this.addView(a);var b=this.datepicker=new h({className:"DatePicker DatePicker--withBorder"});b.bind("changeDate",this._setModel,this),this.$(".js-picker").append(b.render().el),this.addView(b);var c=this.creditsUsage=new j({el:this.$(".CreditsUsage"),userModel:this._userModel});c.bind("maxCreditsChange",this._setModel,this),c.render(),this.addView(c),this._setModel()},_initBinds:function(){this.model.bind("change",this._triggerChange,this)},_getCategories:function(){var a=this.categories.getCategories();return d.filter(a,function(a){return a.category&&a.terms.length>0})},_getDates:function(){return this.datepicker.getDates()},_getMaxCredits:function(){return this.creditsUsage.getMaxCredits()},_setModel:function(){var a=this._getCategories(),b=this._getDates(),c=this._getMaxCredits(),d={categories:a,dates:b};this.model.setUpload({value:d,service_item_id:d,user_defined_limits:{twitter_credits_limit:c}})}})},{"../../../../../../data/upload-model":668,"../../../../../date-picker-range/date-picker-range-view":62,"../import-view":359,"./credits-usage-view.js":351,"./import-twitter.tpl":353,"./twitter-categories/twitter-categories-view":355,moment:"moment",underscore:"underscore"}],353:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n    '+(null==(__t=_t("components.modals.add-layer.imports.twitter.title"))?"":_.escape(__t))+'\n  </h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=_t("components.modals.add-layer.imports.twitter.terms-desc"))?"":_.escape(__t))+'\n  </p>\n</div>\n<div class="ImportPanel-body">\n  <form class="Form">\n    <div class="ImportTwitterPanel-cagetories"></div>\n    <div class="ImportTwitterPanel-datePicker">\n      <div class="Form-row">\n        <div class="Form-rowLabel">\n          <label class="CDB-Text CDB-Size-medium js-category">'+(null==(__t=_t("components.modals.add-layer.imports.twitter.from-to"))?"":_.escape(__t))+'</label>\n        </div>\n        <div class="Form-rowData Form-rowData--longer js-picker CDB-Text CDB-Size-medium"></div>\n        <div class="Form-rowInfo DatePicker-info">\n          <p class="CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=_t("components.modals.add-layer.imports.twitter.twitter-gmt"))?"":_.escape(__t))+" <br/>("+(null==(__t=_t("components.modals.add-layer.imports.twitter.your-gmt"))?"":_.escape(__t))+(null==(__t=currentGMT)?"":_.escape(__t))+')</p>\n        </div>\n      </div>\n    </div>\n    <div class="ImportTwitterPanel-creditsUsage">\n      <div class="Form-row">\n        <div class="Form-rowLabel">\n          <label class="CDB-Text CDB-Size-medium js-category">'+(null==(__t=_t("components.modals.add-layer.imports.twitter.use"))?"":_.escape(__t))+'</label>\n        </div>\n        <div class="Form-rowData Form-rowData--longer CreditsUsage">\n          <div class="UISlider CreditsUsage-slider js-slider"></div>\n          <div class="CreditsUsage-info CDB-Text CDB-Size-medium js-info"></div>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n';return __p}},{underscore:"underscore"}],354:[function(a,b,c){var d=a("backbone"),e=a("./twitter-category-model");b.exports=d.Collection.extend({model:e})},{"./twitter-category-model":356,backbone:"backbone"}],355:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("jquery"),g=a("./twitter-categories-collection"),h=a("./twitter-category-model"),i=a("./twitter-category-view");b.exports=d.extend({_MAX_CATEGORIES:4,_MAX_TERMS:29,initialize:function(){var a=this._generateCategory();this.collection=new g([a]),this._initBinds()},render:function(){return this.clearSubViews(),this.collection.each(this._addCategory,this),this},_initBinds:function(){this.collection.bind("change",this._manageCategories,this),this.collection.bind("change",this._onCategoryChange,this),this.add_related_model(this.collection)},_manageCategories:function(){var a=this.collection.size(),b=this.collection.filter(function(a){return 0===a.get("terms").length});if(0===b.length&&a<this._MAX_CATEGORIES){var c=this._generateCategory();return this.collection.add(c),this._addCategory(c),!1}if(b.length>0){var d=e.first(b),f=e.find(this._subviews,function(a){return d.cid===a.model.cid}),g=f.$el.index();if(1===a)return!1;if(g===a-1)return!1;g!==a-1&&b.length>1&&(d=b[1],f=e.find(this._subviews,function(a){return d.cid===a.model.cid}),this._removeCategory(f)),this._sortCategoryIndex()}},_sortCategoryIndex:function(){var a=this;this.$(".twitter-category").each(function(b,c){var d=f(c).find(".js-category").text().replace(_t("components.modals.add-layer.imports.twitter.category")+" ","");if(d!==b+1){var e=a.collection.find(function(a){return a.get("category")===d});e.set("category",(b+1).toString())}})},_generateCategory:function(){return new h({terms:[],category:(this.collection?this.collection.size()+1:1).toString()})},_addCategory:function(a){var b=new i({model:a});b.bind("submit",this._onCategorySubmit,this),b.bind("limit",this._onCategoryLimit,this),b.bind("nolimit",this._onCategoryNoLimit,this),this.$el.append(b.render().el),this.addView(b),this.trigger("addCategory")},_removeCategory:function(a){a.hide(),a.clean(),a.model.destroy(),this.trigger("removeCategory")},_onCategorySubmit:function(){this.trigger("submitCategory",this.collection.toJSON(),this)},_onCategoryLimit:function(){this.trigger("limitCategory",this.collection.toJSON(),this)},_onCategoryNoLimit:function(){this.trigger("noLimitCategory",this.collection.toJSON(),this)},_onCategoryChange:function(){this.trigger("changeCategory",this.collection.toJSON(),this)},getCategories:function(){return this.collection.toJSON()}})},{"./twitter-categories-collection":354,"./twitter-category-model":356,"./twitter-category-view":357,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],356:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=4;b.exports=d.Model.extend({_MAX_COUNTER:1014,_CHAR_MAP:{" ":2,"-":2,_:2,".":2},defaults:{terms:[],category:"",counter:1014},initialize:function(){this._initBinds()},_initBinds:function(){this.bind("change:terms",this._setCounter,this)},_setCounter:function(){var a=this._MAX_COUNTER,b=this;this.get("terms").length>1&&(a-=(this.get("terms").length-1)*f),e.each(this.get("terms"),function(c){e.each(c,function(c){void 0!==b._CHAR_MAP[c]?a-=b._CHAR_MAP[c]:a--})}),this.set("counter",Math.max(0,a))}})},{backbone:"backbone",underscore:"underscore"}],357:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("jquery"),g=a("./twitter-category.tpl");b.exports=d.extend({className:"TwitterCategory",_MAX_CATEGORIES:4,_MAX_TERMS:29,events:{"keydown .js-terms":"_onInputChange","keypress .js-terms":"_onInputChange","keyup .js-terms":"_onInputChange"},initialize:function(){this._initBinds()},render:function(){return this.$el.append(g({terms:this.model.get("terms"),category:this.model.get("category"),counter:this.model.get("counter")})),this.show(),this},_initBinds:function(){e.bindAll(this,"_onInputChange"),this.model.bind("change:category",this._onCategoryChange,this)},_onCategoryChange:function(){this.$(".js-category").text(_t("components.modals.add-layer.imports.twitter.category")+" "+this.model.get("category"))},_onInputChange:function(a){var b=f(a.target).val(),c={};return 13===a.keyCode?(a.preventDefault(),this.trigger("submit",this.model,this),!1):(this.$(".CDB-IconFont-twitter").toggleClass("is-highlighted",b.length>0),(0===this.model.get("counter")||this.model.get("terms").length>this._MAX_TERMS)&&37!==a.keyCode&&39!==a.keyCode&&8!==a.keyCode&&b.length>0?(this.killEvent(a),this.trigger("limit",this.model,this),!1):(this.trigger("nolimit",this.model,this),b=b?b.split(","):[],
c.terms=b,void this.model.set(c)))},show:function(){this.$el.addClass("enabled")},hide:function(){this.$el.removeClass("enabled")}})},{"./twitter-category.tpl":358,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],358:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Form-row">\n  <div class="Form-rowLabel">\n    <label class="CDB-Text CDB-Size-medium js-category">'+(null==(__t=_t("components.modals.add-layer.imports.twitter.category"))?"":_.escape(__t))+" "+(null==(__t=category)?"":_.escape(__t))+'</label>\n  </div>\n  <div class="Form-rowData Form-rowData--longer">\n    <input type="text" class="CDB-Text CDB-Size-medium Form-input Form-input--longer has-icon js-terms" value="'+(null==(__t=terms.join(","))?"":_.escape(__t))+'" placeholder="'+(null==(__t=_t("components.modals.add-layer.imports.twitter.terms-placeholder"))?"":_.escape(__t))+'" />\n    <i class="CDB-IconFont CDB-IconFont-twitter Form-inputIcon"></i>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],359:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../data/upload-model");b.exports=d.extend({initialize:function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");this._configModel=a.configModel,this._userModel=a.userModel,this.model=new e(null,{configModel:this._configModel,userModel:this._userModel}),this._initBinds()},_initBinds:function(){this.model.bind("change",this._triggerChange,this)},_triggerChange:function(){this.trigger("change",this.model.toJSON(),this)},getModelData:function(){return this.model?this.model.toJSON():{}}})},{"../../../../../data/upload-model":668,"backbone/core-view":1127}],360:[function(a,b,c){var d=a("cartodb.js"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../../view-factory"),h=a("./imports.tpl"),i=a("./import-tab.tpl"),j=a("../../../../tipsy-tooltip-view"),k=a("../../../../tab-pane/tab-pane-view"),l=a("../../../../tab-pane/tab-pane-collection"),m=a("underscore"),n=a("./import-options"),o=5,p="file",q=800;b.exports=f.extend({className:"ImportOptions",events:{"click .js-goNext":"_moveToNextTabs","click .js-goPrev":"_moveToPrevTabs"},initialize:function(a){if(!a.createModel)throw new Error("createModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");this._userModel=a.userModel,this._configModel=a.configModel,this._createModel=a.createModel,this.model=new e.Model({page:1,maxPages:0})},render:function(){return this._destroyBinds(),this.clearSubViews(),this.$el.empty(),this._generateContent(),this._generateNavigationTabs(),this._initBinds(),this._setOption(),this},_generateContent:function(){var a=[];m.each(n,function(b,c){var e={};if(!m.isEmpty(b)&&b.enabled(this._configModel,this._userModel)){e={name:b.name,selected:"file"===b.name},e.createButtonView=function(){return g.createByTemplate(i,{title:d.core.sanitize.html(b.title||b.name),name:b.name},{tagName:"button",className:"TabLink js-"+b.name+"Tab"})};var f,h,j=this["_check"+c+"Import"];if(j&&(h=j.bind(this)()),!h&&void 0!==h||m.isEmpty(b))b.fallback&&(f=g.createByTemplate(b.fallback));else{var k=b.view;f=new k(m.extend(b.options||{},{userModel:this._userModel,configModel:this._configModel,title:b.title}))}f&&(f.render(),f.bind("change",this._setUploadModel,this),e.createContentView=function(){return f}),a.push(e)}},this),this._tabPaneCollection=new l(a),this._tabPaneView=new k({template:h,collection:this._tabPaneCollection,tabPaneItemOptions:{tagName:"li",className:"ImportOptions-tab"}}),this.$el.append(this._tabPaneView.render().el)},_generateNavigationTabs:function(){var a=this.$(".ImportOptions-tab").size();a<=1&&this.$(".AddLayer-tabs").hide(),this.model.set("maxPages",Math.ceil(a/o)),this._checkNavigationTabs(),this.model.get("maxPages")<=1&&this.$(".ImportOptions-navigation").hide()},_moveToNextTabs:function(){var a=this.model.get("page"),b=this.model.get("maxPages");a<b&&this.model.set("page",a+1)},_moveToPrevTabs:function(){var a=this.model.get("page");a>1&&this.model.set("page",a-1)},_moveNavigationTabs:function(){var a=this.model.get("page"),b=q;this.$(".js-menu").css("margin-left","-"+b*(a-1)+"px"),this._checkNavigationTabs()},_checkNavigationTabs:function(){var a=this.model.get("page"),b=this.model.get("maxPages");this.$(".js-goPrev").toggleClass("is-disabled",a<2),this.$(".js-goNext").toggleClass("is-disabled",a>=b)},_checkGDriveImport:function(){return!!this._configModel.get("oauth_gdrive")||(this._setFailedTab("gdrive","key"),!1)},_checkDropboxImport:function(){return!!this._configModel.get("oauth_dropbox")||(this._setFailedTab("dropbox","key"),!1)},_checkBoxImport:function(){return!!this._configModel.get("oauth_box")||(this._setFailedTab("box","key"),!1)},_checkTwitterImport:function(){return this._configModel.get("datasource_search_twitter")?!!this._userModel.get("twitter").enabled&&(!!this._userModel.canCreateTwitterDataset()||(this._setFailedTab("twitter","credits"),!1)):(this._setFailedTab("twitter","key"),!1)},_checkInstagramImport:function(){return!!this._userModel.featureEnabled("instagram_import")&&(!!this._configModel.get("oauth_instagram")||(this._setFailedTab("instagram","key"),!1))},_checkSalesforceImport:function(){return!!this._userModel.get("salesforce").enabled},_checkMailchimpImport:function(){return this._configModel.get("oauth_mailchimp")?!!this._userModel.featureEnabled("mailchimp_import"):(this._setFailedTab("mailchimp","key"),!1)},_setFailedTab:function(a,b){var c=this.$(".js-"+a+"Tab");c.addClass("disabled");var d=new j({el:c,title:function(){return _t("components.modals.add-layer.imports.tab-options-error."+b,{name:a})}});this.addView(d)},_setUploadModel:function(a){var b=this._createModel.getUploadModel();b.setFresh(a)},_initBinds:function(){this.model.bind("change:page",this._moveNavigationTabs,this),this._tabPaneCollection&&this._tabPaneCollection.bind("change:selected",this._onTabChange,this)},_destroyBinds:function(){this._tabPaneCollection&&this._tabPaneCollection.bind("change:selected",null,this)},_setOption:function(){var a=m.first(this._tabPaneCollection.where({name:p}));a&&(a.set("selected",!0),this._updateImportOption())},_updateImportOption:function(){this._createModel.setActiveImportPane(this._tabPaneView.getSelectedTabPaneName())},_onTabChange:function(a){this._updateImportOption()},clean:function(){this._destroyBinds(),f.prototype.clean.call(this)}})},{"../../../../tab-pane/tab-pane-collection":538,"../../../../tab-pane/tab-pane-view":549,"../../../../tipsy-tooltip-view":589,"../../../../view-factory":594,"./import-options":328,"./import-tab.tpl":348,"./imports.tpl":361,backbone:"backbone","backbone/core-view":1127,"cartodb.js":"cartodb.js",underscore:"underscore"}],361:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportOptions-navigation">\n  <button class="Carousel-Navigation CDB-Size-large ImportOptions-navigationButton ImportOptions-navigationButton--prev js-goPrev">\n    <i class="CDB-IconFont CDB-IconFont-arrowPrev u-actionTextColor"></i>\n  </button>\n  <button class="Carousel-Navigation CDB-Size-large ImportOptions-navigationButton ImportOptions-navigationButton--next js-goNext">\n    <i class="CDB-IconFont CDB-IconFont-arrowNext u-actionTextColor"></i>\n  </button>\n</div>\n<div class="AddLayer-tabs">\n  <ul class="ImportOptions-tabsList js-menu CDB-Text CDB-Size-medium u-altTextColor"></ul>\n</div>\n<div class="ImportOptions-panes js-content"></div>\n';return __p}},{underscore:"underscore"}],362:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./datasets/datasets-view"),g=a("./imports/imports-view"),h=a("../../../tab-pane/tab-pane-view"),i=a("../../../tab-pane/tab-pane-collection");b.exports=d.extend({className:"CreateDialog-listing CreateDialog-listing--noPaddingTop",initialize:function(a){if(!a.createModel)throw new Error("createModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new Error("configModel is required");this._userModel=a.userModel,this._createModel=a.createModel,this._configModel=a.configModel,this._initBinds(),this._onChangeListing()},render:function(){return this.clearSubViews(),this._initViews(),this},_initBinds:function(){this._createModel.bind("change:listing",this._onChangeListing.bind(this)),this.add_related_model(this._createModel)},_initViews:function(){var a=this,b=[{name:"datasets",selected:!1,createContentView:function(){return new f({userModel:a._userModel,createModel:a._createModel})}}];this._userModel.canCreateDatasets()&&b.push({name:"import",selected:!1,createContentView:function(){return new g({userModel:a._userModel,configModel:a._configModel,createModel:a._createModel})}}),this._tabPaneCollection=new i(b);var c=new h({collection:this._tabPaneCollection});this.addView(c),this.$el.append(c.render().el)},_onChangeListing:function(){if(this._tabPaneCollection){var a=this._createModel.get("listing"),b=e.first(this._tabPaneCollection.where({name:a}));b.set("selected",!0)}}})},{"../../../tab-pane/tab-pane-collection":538,"../../../tab-pane/tab-pane-view":549,"./datasets/datasets-view":308,"./imports/imports-view":360,"backbone/core-view":1127,underscore:"underscore"}],363:[function(a,b,c){var d=a("cartodb.js"),e=a("backbone"),f=a("backbone/core-view"),g=a("jquery"),h=a("underscore"),i=a("./navigation.tpl");b.exports=f.extend({events:{"submit .js-search-form":"_submitSearch","keydown .js-search-form":"_onSearchKeyDown","click .js-search-form":"killEvent","click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","click .js-shared":"_onSharedClick","click .js-library":"_onLibraryClick","click .js-connect":"_onConnectClick","click .js-datasets":"_onDatasetsClick","click .js-create-empty":"_onCreateEmptyClick"},initialize:function(a){if(!a.createModel)throw new Error("createModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.routerModel)throw new Error("routerModel is required");if(!a.tablesCollection)throw new Error("tablesCollection is required");this._routerModel=a.routerModel,this._createModel=a.createModel,this._userModel=a.userModel,this._tablesCollection=a.tablesCollection,this.model=new e.Model,this._preRender(),this._initBinds()},_preRender:function(){var a=g("<div>").addClass("u-inner"),b=g("<div>").addClass("Filters-inner");this.$el.append(a.append(b))},render:function(a,b){this.clearSubViews();var c=this._selectedItems().length,d=b&&b.changes&&b.changes.content_type;return this.$(".Filters-inner").html(i(h.extend({showDatasets:this._createModel.showDatasets(),createModelType:this._createModel.get("type"),canCreateDataset:this._userModel.canCreateDatasets(),listingType:this._createModel.get("listing"),isInsideOrg:this._userModel.isInsideOrg(),totalShared:this._tablesCollection.getTotalStat("total_shared"),totalItems:d?0:this._tablesCollection.getTotalStat("total_user_entries"),selectedItemsCount:c},this._routerModel.attributes))),this._animate(),this._routerModel.isSearching()&&this._focusSearchInput(),this},_initBinds:function(){this.model.on("change:isSearchEnabled",this._onChangeIsSearchEnabled,this),this._createModel.bind("change:listing",this.render,this),this._routerModel.bind("change",this.render,this),this._tablesCollection.bind("sync",this.render,this),this.add_related_model(this._createModel),this.add_related_model(this._tablesCollection),this.add_related_model(this._routerModel)},_onChangeIsSearchEnabled:function(a,b){this._enableSearchUI(b),this._routerModel.isSearching()?this._cleanSearch():b&&(this._$searchInput().val(""),this._focusSearchInput())},_$searchInput:function(){return this.$(".js-search-input")},_focusSearchInput:function(){this._$searchInput().select().focus()},_onSearchKeyDown:function(a){27===a.keyCode&&(this.killEvent(a),this._cleanSearch())},_selectedItems:function(){return this._tablesCollection.where({selected:!0})},_animate:function(){this._enableSearchUI(!!this._routerModel.isSearching());var a=this._routerModel.get("library"),b="datasets"===this._createModel.get("listing"),c=this._tablesCollection.getTotalStat("total_user_entries")>0;this.$el.toggleClass("no-shadow",a&&!c&&b)},_enableSearchUI:function(a){this.$(".js-search-field").toggle(a),this.$(".js-links-list").toggleClass("is-hidden",a),this.$(".js-order-list").toggleClass("is-hidden",a)},_onDatasetsClick:function(){this._routerModel.set({shared:"no",library:!1,page:1}),this._createModel.set("listing","datasets")},_onSharedClick:function(){this._routerModel.set({shared:"only",library:!1,page:1}),this._createModel.set("listing","datasets")},_onLibraryClick:function(){this._routerModel.set({shared:"no",library:!0,page:1}),this._createModel.set("listing","datasets")},_onConnectClick:function(){this._userModel.canCreateDatasets()&&this._createModel.set("listing","import")},_onCreateEmptyClick:function(){this._userModel.canCreateDatasets()&&this._createModel.createFromScratch()},_onSearchClick:function(a){this.killEvent(a),this.model.set("isSearchEnabled",!this.model.get("isSearchEnabled"))},_onCleanSearchClick:function(a){a&&a.preventDefault(),this._cleanSearch()},_cleanSearch:function(){this._routerModel.set({q:"",tag:"",shared:"no",library:this._createModel.showLibrary()}),this.model.set("isSearchEnabled",!1)},_submitSearch:function(a){this.killEvent(a);var b=d.core.sanitize.html(this.$(".js-search-input").val().trim()),c=0===b.search(":")?b.replace(":",""):"",e=0!==b.search(":")?b:"";this._routerModel.set({page:1,tag:c,q:e,shared:"yes"}),this._createModel.set("listing","datasets")}})},{"./navigation.tpl":364,backbone:"backbone","backbone/core-view":1127,"cartodb.js":"cartodb.js",jquery:"jquery",underscore:"underscore"}],364:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="Filters-separator"></span>\n\n<div class="Filters-row">\n  <div class="Filters-group">\n    <div class="Filters-typeItem Filters-typeItem--searchEnabler js-search-enabler">\n      <button class="Filters-searchLink CDB-Text is-semibold u-upperCase CDB-Size-medium js-search-link">\n        <i class="Filters-searchLinkIcon CDB-IconFont CDB-IconFont-lens"></i>'+(null==(__t=_t("components.modals.add-layer.navigation.search"))?"":_.escape(__t))+'\n      </button>\n    </div>\n\n    <ul class="Filters-group js-links-list">\n      <li class="Filters-typeItem js-filter-type">\n        <button class="Filters-typeLink js-typeItem u-actionTextColor CDB-Text is-semibold u-upperCase CDB-Size-medium js-connect '+(null==(__t="import"===listingType?"is-selected":"")?"":_.escape(__t))+" "+(null==(__t=canCreateDataset?"":"is-disabled")?"":_.escape(__t))+'">\n          '+(null==(__t=_t("components.modals.add-layer.navigation.connect-dataset"))?"":_.escape(__t))+"\n        </button>\n      </li>\n      ",showDatasets&&(__p+='\n        <li class="Filters-typeItem js-filter-type">\n          <button class="Filters-typeLink js-typeItem u-actionTextColor CDB-Text is-semibold u-upperCase CDB-Size-medium js-datasets '+(null==(__t="datasets"!==listingType||"only"===shared||library?"":"is-selected")?"":_.escape(__t))+'">\n            ',totalItems&&(__p+="\n              <strong>"+(null==(__t=totalItems)?"":_.escape(__t))+"</strong>\n            "),__p+="\n            "+(null==(__t=_t("components.modals.add-layer.navigation.dataset-pluralize",{smart_count:totalItems}))?"":_.escape(__t))+"\n          </button>\n        </li>\n        ",isInsideOrg&&(__p+='\n          <li class="Filters-typeItem js-filter-type">\n            <button class="Filters-typeLink js-typeItem u-actionTextColor CDB-Text is-semibold u-upperCase CDB-Size-medium js-shared '+(null==(__t="datasets"===listingType&&"only"===shared?"is-selected":"")?"":_.escape(__t))+'">\n              ',totalShared&&(__p+="\n                <strong>"+(null==(__t=totalShared)?"":_.escape(__t))+"</strong>\n              "),__p+="\n              "+(null==(__t=_t("components.modals.add-layer.navigation.shared-with-you"))?"":_.escape(__t))+"\n            </button>\n          </li>\n        "),__p+="\n      "),__p+='\n      <li class="Filters-typeItem js-filter-type">\n        <button class="Filters-typeLink js-typeItem u-actionTextColor CDB-Text is-semibold u-upperCase CDB-Size-medium js-library '+(null==(__t="datasets"===listingType&&library?"is-selected":"")?"":_.escape(__t))+'">\n          '+(null==(__t=_t("components.modals.add-layer.navigation.data-library"))?"":_.escape(__t))+'\n        </button>\n      </li>\n    </ul>\n  </div>\n\n  <div class="Filters-typeItem Filters-typeItem--searchField js-search-field">\n    <form class="Filters-searchForm js-search-form">\n      <input class="Filters-searchInput CDB-Text CDB-Size-medium js-search-input" type="text" value="'+(null==(__t=tag&&":"+tag||q)?"":_.escape(__t))+'" placeholder="'+(null==(__t=_t("components.modals.add-layer.navigation.search-placeholder"))?"":_.escape(__t))+'" />\n      ',(tag||q)&&(__p+='\n        <button type="button" class="Filters-cleanSearch js-clean-search u-actionTextColor">\n          <i class="CDB-IconFont CDB-IconFont-close"></i>\n        </button>\n      '),__p+='\n    </form>\n  </div>\n\n  <div class="Filters-addLayer js-order-list">\n    <button class="Filters-typeLink js-typeItem u-actionTextColor CDB-Text is-semibold u-upperCase CDB-Size-medium js-create-empty '+(null==(__t="scratch"===listingType?"is-selected":"")?"":_.escape(__t))+" "+(null==(__t=canCreateDataset?"":"is-disabled")?"":_.escape(__t))+'">\n      '+(null==(__t=_t("components.modals.add-layer.navigation.create-empty-"+createModelType))?"":_.escape(__t))+"\n    </button>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],365:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./guessing-toggler-view"),g=a("./privacy-toggler-view"),h=a("./footer.tpl");b.exports=e.extend({events:{"click .js-ok":"_finish"},initialize:function(a){if(!a.createModel)throw new TypeError("createModel is required");if(!a.userModel)throw new TypeError("userModel is required");if(!a.configModel)throw new TypeError("configModel is required");this._createModel=a.createModel,this._userModel=a.userModel,this._configModel=a.configModel,this._guessingModel=new d.Model({guessing:!0}),this._privacyModel=new d.Model({privacy:this._userModel.canCreatePrivateDatasets()?"PRIVATE":"PUBLIC"}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(h({canFinish:this._createModel.canFinish(),listing:this._createModel.get("listing")})),this._initViews(),this},_initViews:function(){var a=new f({guessingModel:this._guessingModel,createModel:this._createModel,configModel:this._configModel});this.$(".js-footer-info").append(a.render().el),this.addView(a);var b=new g({privacyModel:this._privacyModel,userModel:this._userModel,createModel:this._createModel,configModel:this._configModel});this.$(".js-footerActions").prepend(b.render().el),this.addView(b)},_initBinds:function(){var a=this._createModel.getUploadModel();a.bind("change",this.render,this);var b=this._createModel.getSelectedDatasetsCollection();b.bind("all",this._update,this),this._createModel.bind("change",this._update,this),this.add_related_model(a),this.add_related_model(b),this.add_related_model(this._createModel)},_update:function(){var a=this._createModel.get("contentPane"),b=this._createModel.get("listing");"listing"===a&&"scratch"!==b?this.render().show():this.hide()},_finish:function(a){if(this.killEvent(a),this._createModel.canFinish()){if("import"===this._createModel.get("listing")){var b=this._createModel.getUploadModel();b.setPrivacy(this._privacyModel.get("privacy")),b.setGuessing(this._guessingModel.get("guessing"))}this._createModel.finish()}}})},{"./footer.tpl":366,"./guessing-toggler-view":367,"./privacy-toggler-view":369,backbone:"backbone","backbone/core-view":1127}],366:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CreateDialog-footerShadow"></div>\n<div class="CreateDialog-footerLine"></div>\n<div class="CreateDialog-footerInner u-flex u-justifySpace u-alignCenter">\n  <div class="js-footer-info CreateDialog-footerInfo u-secondaryTextColor">\n  </div>\n  <div class="CreateDialog-footerActions js-footerActions">\n    <button class="js-ok CDB-Button CDB-Button--primary '+(null==(__t=canFinish?"":"is-disabled")?"":_.escape(__t))+'">\n      <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">'+(null==(__t=_t("components.modals.add-layer.footer.add-layer"))?"":_.escape(__t))+"</span>\n    </button>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],367:[function(a,b,c){var d=a("backbone/core-view"),e=a("./guessing-toggler.tpl");b.exports=d.extend({events:{"click .js-toggle":"_toggle"},initialize:function(a){if(!a.createModel)throw new Error("createModel is required");if(!a.guessingModel)throw new Error("guessingModel is required");if(!a.configModel)throw new TypeError("configModel is required");this._configModel=a.configModel,this._createModel=a.createModel,this.model=a.guessingModel,this._initBinds()},render:function(){var a="";if(this._createModel.showGuessingToggler()){var b=this._createModel.getUploadModel();a=e({isGuessingEnabled:this.model.get("guessing"),importState:this._createModel.getImportState(),isUploadValid:b.isValidToUpload(),customHosted:this._configModel.get("cartodb_com_hosted")})}return this.$el.html(a),this},_initBinds:function(){this._createModel.bind("change",this.render,this),this.model.bind("change",this.render,this),this.add_related_model(this._createModel)},_toggle:function(){var a=!this.model.get("guessing");this.model.set("guessing",a)}})},{"./guessing-toggler.tpl":368,"backbone/core-view":1127}],368:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","twitter"!==importState?__p+='\n  <div class="u-iBlock CDB-Text CDB-Size-medium u-rSpace--xl js-toggle">\n    <input class="CDB-Checkbox" type="checkbox" '+(null==(__t=isGuessingEnabled?"checked":"")?"":_.escape(__t))+'>\n    <span class="u-iBlock CDB-Checkbox-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("components.modals.add-layer.footer.guessing-desc"))?"":_.escape(__t))+"</label>\n  </div>\n":customHosted||(__p+='\n  <span class="CDB-Text CDB-Size-medium">\n    '+(null==(__t=_t("components.modals.add-layer.footer.twitter-desc"))?"":_.escape(__t))+'\n    <a href="mailto:support@carto.com">'+(null==(__t=_t("components.modals.add-layer.footer.contact-team"))?"":_.escape(__t))+"</a>\n  </span>\n"),__p+="\n";return __p}},{underscore:"underscore"}],369:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("./privacy-toggler.tpl"),g=a("../../../tipsy-tooltip-view"),h="PUBLIC",i="PRIVATE";b.exports=d.extend({events:{click:"_onClick"},initialize:function(a){if(!a.createModel)throw new Error("createModel is required");if(!a.privacyModel)throw new Error("privacyModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.configModel)throw new TypeError("configModel is required");this._configModel=a.configModel,this.model=a.privacyModel,this._userModel=a.userModel,this._createModel=a.createModel,this._initBinds()},render:function(){if(this.clearSubViews(),this.$el.empty(),this._createModel.showPrivacyToggler()){var a=this._userModel.canCreatePrivateDatasets(),b=this.model.get("privacy"),c=b===h,d=c?i:h,e=c?"unlock":"lock",g=this._configModel.get("upgrade_url")||window.upgrade_url,j=!this._configModel.get("cartodb_com_hosted")&&!a&&g;this.$el.html(f({privacy:b,isDisabled:!a,canUpgrade:j,nextPrivacy:d,upgradeUrl:g,icon:e})),this._initViews()}return this},_initBinds:function(){this.model.bind("change:privacy",this.render,this)},_initViews:function(){this.addView(new g({el:this.$(".js-toggler"),html:!0,title:function(){return e(this).attr("data-title")}}))},_onClick:function(){if(this._userModel.canCreatePrivateDatasets()){var a=this.model.get("privacy");return void this.model.set("privacy",a===h?i:h)}}})},{"../../../tipsy-tooltip-view":589,"./privacy-toggler.tpl":370,"backbone/core-view":1127,jquery:"jquery"}],370:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",canUpgrade?__p+='\n  <a href="'+(null==(__t=upgradeUrl)?"":_.escape(__t))+'" class="PrivacyToggler js-toggler PrivacyToggler--'+(null==(__t=privacy)?"":_.escape(__t))+' is-disabled"\n    data-title="'+(null==(__t=_t("components.modals.add-layer.footer.privacy-change-not-allowed"))?"":_.escape(__t))+'">\n    <i class="CDB-IconFont CDB-IconFont-'+(null==(__t=icon)?"":_.escape(__t))+'"></i>\n  </a>\n':(__p+='\n  <button type="button" class="PrivacyToggler js-toggler PrivacyToggler--'+(null==(__t=privacy)?"":_.escape(__t))+" "+(null==(__t=isDisabled?"is-disabled":"")?"":_.escape(__t))+'"\n    data-title="\n      ',__p+=isDisabled?"\n        "+(null==(__t=_t("components.modals.add-layer.footer.privacy-change-banned"))?"":_.escape(__t))+"\n      ":"\n        "+(null==(__t=_t("components.modals.add-layer.footer.privacy-change",{privacy:privacy.toLowerCase()}))?"":_.escape(__t))+".<br />"+(null==(__t=_t("components.modals.add-layer.footer.privacy-click",{nextPrivacy:nextPrivacy.toLowerCase()}))?"":_.escape(__t))+".\n      ",__p+='\n    ">\n    <i class="CDB-IconFont CDB-IconFont-'+(null==(__t=icon)?"":_.escape(__t))+'"></i>\n  </button>\n'),__p+="\n";return __p}},{underscore:"underscore"}],371:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./create-tuples-items"),h=a("./widgets-types"),i=a("./body-view"),j=a("./add-widgets.tpl"),k=a("../../../components/loading/render-loading"),l=a("./tablestats.js");b.exports=f.extend({className:"Dialog-content Dialog-content--expanded",events:{"click .js-continue":"_onContinue"},initialize:function(a){if(!a.userActions)throw new Error("userActions is required");if(!a.modalModel)throw new Error("modalModel is required");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.widgetDefinitionsCollection)throw new Error("widgetDefinitionsCollection is required");if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");this._userActions=a.userActions,this._modalModel=a.modalModel,this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._widgetDefinitionsCollection=a.widgetDefinitionsCollection,this._analysisDefinitionNodesCollection=a.analysisDefinitionNodesCollection,this._optionsCollection=new e.Collection,this.tableStats=new l({configModel:a.configModel,userModel:a.userModel}),this._analysisDefinitionNodesCollection.each(function(a){a=a.querySchemaModel,a.on("change",this._onQuerySchemaChange,this),this.add_related_model(a),a.fetch()},this),this.listenTo(this._optionsCollection,"change:selected",this._updateContinueButtonState),this.add_related_model(this._optionsCollection)},render:function(){return this.clearSubViews(),this.$el.html(j()),this._hasFetchedAllQuerySchemas()?this._renderBodyView():this._renderLoadingView(),this._updateContinueButtonState(),this},_onQuerySchemaChange:function(){this._hasFetchedAllQuerySchemas()&&this.render()},_hasFetchedAllQuerySchemas:function(){return this._analysisDefinitionNodesCollection.all(function(a){return"fetching"!==a.querySchemaModel.get("status")})},_onContinue:function(){var a=this._optionsCollection.filter(this._isSelected);a.length>0&&(d.map(a,function(a){this._userActions.saveWidgetOption(a)},this),this._modalModel.destroy())},_renderBodyView:function(){this._createOptionsModels();var a=new i({el:this._$body(),optionsCollection:this._optionsCollection,widgetsTypes:h});this.addView(a.render())},_renderLoadingView:function(){this._$body().html(k({title:_t("components.modals.add-widgets.loading-title")}))},_$body:function(){return this.$(".js-body")},_updateContinueButtonState:function(){this.$(".js-continue").toggleClass("is-disabled",!this._optionsCollection.any(this._isSelected))},_isSelected:function(a){return!!a.get("selected")},_createOptionsModels:function(){var a=this;this._optionsCollection.reset();var b=g(this._analysisDefinitionNodesCollection,this._layerDefinitionsCollection);d.each(h,function(c){var d=c.createOptionModels(b,this._widgetDefinitionsCollection);d=d.map(function(b){return b.stats=a.tableStats,b}),this._optionsCollection.add(d)},this)}})},{"../../../components/loading/render-loading":230,"./add-widgets.tpl":372,"./body-view":373,"./create-tuples-items":379,"./tablestats.js":394,"./widgets-types":403,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],372:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal">\n  <div class="Modal-header">\n    <div class="Modal-headerContainer">\n      <h2 class="CDB-Text CDB-Size-huge is-light u-mainTextColor u-bSpace">'+(null==(__t=_t("components.modals.add-widgets.modal-title"))?"":_.escape(__t))+'</h2>\n      <h3 class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.add-widgets.modal-desc"))?"":_.escape(__t))+'</h3>\n    </div>\n  </div>\n  <div class="Modal-container js-body">\n    \n  </div>\n  <div class="Modal-footer">\n    <div class="Modal-footerContainer u-flex u-justifyEnd">\n      <button class="CDB-Button CDB-Button--primary is-disabled js-continue">\n        <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-widgets.continue-btn"))?"":_.escape(__t))+"</span>\n      </button>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],373:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("../../tab-pane/create-template-tab-pane"),g=a("./tab-pane-button-template.tpl"),h=a("./tab-pane-template.tpl");b.exports=e.extend({initialize:function(a){if(!a.optionsCollection)throw new Error("optionsCollection is required");if(!a.widgetsTypes)throw new Error("widgetsTypes is required");var b=d.unique(a.optionsCollection.pluck("type"));this._tabPaneItems=d.reduce(a.widgetsTypes,function(c,e){if(d.contains(b,e.type)){var f=e.createTabPaneItem(a.optionsCollection);c.push(f)}return c},[])},render:function(){this.clearSubViews();var a={tabPaneOptions:{template:h,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneTemplateOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase",template:g}},b=f(this._tabPaneItems,a);return this.addView(b),this.$el.append(b.render().el),this}})},{"../../tab-pane/create-template-tab-pane":536,"./tab-pane-button-template.tpl":392,"./tab-pane-template.tpl":393,"backbone/core-view":1127,underscore:"underscore"}],374:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="Widget-categoryFakeText"></p>\n<div class="Widget-categoryFake"></div>';return __p}},{underscore:"underscore"}],375:[function(a,b,c){var d=a("underscore"),e=a("../widget-option-model"),f=a("../../../../data/widget-definition-model");b.exports=e.extend({
defaults:d.defaults({type:"category"},e.defaults),save:function(a){var b=this.columnName(),c=this,d=this.layerDefinitionModel()&&this.layerDefinitionModel().styleModel,e=d&&d.canApplyAutoStyle()||!1;a.trigger("loading",c);var g={type:"category",layer_id:this.layerDefinitionModel().id,source:{id:this.analysisDefinitionNodeModel().id},options:{column:b,aggregation_column:b,aggregation:this.get("aggregation"),title:this.get("title")},style:{widget_style:{definition:f.getDefaultWidgetStyle("category")},auto_style:{allowed:e,custom:!1}}};return a.create(g,{wait:!0,success:function(b,d){a.trigger("success",c)},error:function(b,d){a.trigger("error",c,d)}})}})},{"../../../../data/widget-definition-model":680,"../widget-option-model":402,underscore:"underscore"}],376:[function(a,b,c){var d=a("backbone/core-view"),e=a("../layer-selector-view"),f=a("./category-option.tpl"),g=a("./category-fake.tpl");b.exports=d.extend({events:{"click .js-checkbox":"_onSelect"},initialize:function(a){this.listenTo(this.model,"change:layer_index",this.render),this.listenTo(this.model,"change:selected",this.render)},render:function(){this.clearSubViews(),this.$el.html(this._html()),this._renderLayerSelector();var a=this.options.model.stats;return a&&this._drawGraph(),this},_html:function(){return f({columnName:this.model.columnName(),isSelected:!!this.model.get("selected")})},_renderLayerSelector:function(){var a=new e({model:this.model});this.addView(a),this.$(".js-inner").append(a.render().el)},_onSelect:function(){this.model.set("selected",!this.model.get("selected"))},_drawGraph:function(){var a=this;this.options.model.stats.graphFor(this.model.analysisDefinitionNodeModel().get("table_name"),this.model.get("name"),function(b){if(b.stats&&b.stats.freqs){a.$(".js-Category-bar").append(b.getCategory({color:"#9DE0AD",width:240,height:10}));var c=a.$(".js-catstats").children();a.$(c[0]).text(b.getNullsPercentage()+"% null"),a.$(c[1]).text((100*b.getPercentageInTopCategories()).toFixed(2)+_t("components.modals.add-widgets.percentage-in-top-cats")),a.$(".js-catstats").css("display","flex")}else a.$(".js-Category-bar").append(g())})}})},{"../layer-selector-view":390,"./category-fake.tpl":374,"./category-option.tpl":377,"backbone/core-view":1127}],377:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="WidgetList-option">\n  <input class="CDB-Checkbox js-checkbox" type="checkbox" ',isSelected&&(__p+='checked="checked"'),__p+=' />\n  <span class="u-iBlock CDB-Checkbox-face"></span>\n</div>\n\n<div class="WidgetList-inner js-inner">\n  <h3 class="u-ellipsis CDB-Text CDB-Size-large u-bSpace--m">'+(null==(__t=columnName)?"":_.escape(__t))+"</h3>\n  <ul class=\"js-catstats u-flex CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase\">\n    <li class='u-rSpace--m'></li>\n    <li class='u-rSpace--m'></li>\n  </ul>\n  <div class=\"u-bSpace--m js-Category-bar\">\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],378:[function(a,b,c){var d=a("backbone/core-view"),e=a("./category-option-view.js");b.exports=d.extend({tagName:"ul",className:"WidgetList",render:function(){return this.clearSubViews(),this.$el.empty(),this.collection.chain().filter(this._isCategory).each(this._renderOption,this),this},_renderOption:function(a){var b=new e({tagName:"li",className:"WidgetList-item",model:a});this.addView(b),this.$el.append(b.render().el)},_isCategory:function(a){return"category"===a.get("type")}})},{"./category-option-view.js":376,"backbone/core-view":1127}],379:[function(a,b,c){var d=a("underscore"),e=["created_at","the_geom","the_geom_webmercator","updated_at"];b.exports=function(a,b){return a.reduce(function(a,c){var f=b.find(function(a){return a.isOwnerOfAnalysisNode(c)});if(!f)return a;var g=c.querySchemaModel,h=c.queryGeometryModel;return g&&h&&h.hasValue()?(g.columnsCollection.each(function(b){var g=b.get("name");if(!d.contains(e,g)){var h=g+"-"+b.get("type"),i=a[h]=a[h]||[];i.push({analysisDefinitionNodeModel:c,layerDefinitionModel:f,columnModel:b})}}),a):a},{})}},{underscore:"underscore"}],380:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='Widget-formulaFakeContainer'>\n  <p class='Widget-categoryFakeText'></p>\n  <div class='Widget-formulaFake'></div>\n</div>";return __p}},{underscore:"underscore"}],381:[function(a,b,c){var d=a("underscore"),e=a("../widget-option-model");b.exports=e.extend({defaults:d.defaults({type:"formula"},e.defaults),save:function(a){var b=this;a.trigger("loading",b);var c={type:"formula",layer_id:this.layerDefinitionModel().id,source:{id:this.analysisDefinitionNodeModel().id},options:{column:this.columnName(),title:this.get("title"),operation:this.get("operation")}};return a.create(c,{wait:!0,success:function(c,d){a.trigger("success",b)},error:function(c,d){a.trigger("error",b,d)}})}})},{"../widget-option-model":402,underscore:"underscore"}],382:[function(a,b,c){var d=a("backbone/core-view"),e=a("../layer-selector-view"),f=a("./formula-option.tpl"),g=a("./formula-fake.tpl"),h=a("underscore");b.exports=d.extend({events:{"click .js-checkbox":"_onSelect"},initialize:function(a){this.listenTo(this.model,"change:layer_index",this.render),this.listenTo(this.model,"change:selected",this.render),this.aggregation=this.model.get("operation")},render:function(){this.clearSubViews(),this.$el.html(this._html()),this._renderLayerSelector();var a=this.options.model.stats;return a&&this._drawGraph(),this},_html:function(){return f({columnName:this.model.get("title"),isSelected:!!this.model.get("selected")})},_renderLayerSelector:function(){var a=new e({model:this.model});this.addView(a),this.$(".js-inner").append(a.render().el)},_onSelect:function(){this.model.set("selected",!this.model.get("selected"))},_drawGraph:function(){var a=this;this.options.model.stats.graphFor(this.model.analysisDefinitionNodeModel().get("table_name"),this.model.get("name"),function(b){if(b.stats){var c=a.$(".js-formulastats").children(),d=b[{avg:"getAverage",sum:"getSum",min:"getMin",max:"getMax",count:"getCount"}[a.aggregation]]();h.isNumber(d)?(a.$(c[0]).text(b.getNullsPercentage()+"% null"),"count"===a.aggregation?a.$(c[1]).text(d.toFixed().toString()):a.$(c[1]).text(d.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),a.$(".js-formulastats").show()):(a.$(".js-formulastats").append(g()),a.$(".js-formulastats").show())}else a.$(".js-formulastats").append(g()),a.$(".js-formulastats").show()})}})},{"../layer-selector-view":390,"./formula-fake.tpl":380,"./formula-option.tpl":383,"backbone/core-view":1127,underscore:"underscore"}],383:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="WidgetList-option">\n  <input class="CDB-Checkbox js-checkbox" type="checkbox" ',isSelected&&(__p+='checked="checked"'),__p+=' />\n  <span class="u-iBlock CDB-Checkbox-face"></span>\n</div>\n\n<div class="WidgetList-inner js-inner">\n  <h3 class="u-ellipsis CDB-Text CDB-Size-large u-bSpace--m">'+(null==(__t=columnName)?"":_.escape(__t))+'</h3>\n  <div class="js-formulastats" style="display: none;">\n    <ul class="u-flex CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase">\n      <li class=\'u-rSpace\'></li>\n    </ul>\n  \t<h4 class="CDB-Text CDB-Size-huge u-bSpace--m"></h4>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],384:[function(a,b,c){var d=a("backbone/core-view"),e=a("./formula-option-view.js");b.exports=d.extend({className:"WidgetList",render:function(){return this.clearSubViews(),this.$el.empty(),this.collection.chain().filter(this._isFormula).each(this._renderOption,this),this},_renderOption:function(a){var b=new e({className:"WidgetList-item",model:a});this.addView(b),this.$el.append(b.render().el)},_isFormula:function(a){return"formula"===a.get("type")}})},{"./formula-option-view.js":382,"backbone/core-view":1127}],385:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Widget-histogramFakeContainer">\n  <p class="Widget-categoryFakeText"></p>\n  <div class="Widget-histogramFake"></div>\n</div>';return __p}},{underscore:"underscore"}],386:[function(a,b,c){var d=a("underscore"),e=a("../widget-option-model"),f=a("../../../../data/widget-definition-model");b.exports=e.extend({defaults:d.defaults({type:"histogram"},e.defaults),save:function(a){var b=this.layerDefinitionModel()&&this.layerDefinitionModel().styleModel,c=b&&b.canApplyAutoStyle()||!1,d={type:"histogram",layer_id:this.layerDefinitionModel().id,source:{id:this.analysisDefinitionNodeModel().id},options:{column:this.columnName(),title:this.get("title"),bins:this.get("bins")},style:{widget_style:{definition:f.getDefaultWidgetStyle("histogram")},auto_style:{allowed:c,custom:!1}}},e=this;return a.trigger("loading",e),a.create(d,{wait:!0,success:function(b,c){a.trigger("success",e)},error:function(b,c){a.trigger("error",e,c)}})}})},{"../../../../data/widget-definition-model":680,"../widget-option-model":402,underscore:"underscore"}],387:[function(a,b,c){var d=a("backbone/core-view"),e=a("../layer-selector-view"),f=a("./histogram-option.tpl"),g=a("./histogram-fake.tpl");b.exports=d.extend({events:{"click .js-checkbox":"_onSelect"},initialize:function(a){this.listenTo(this.model,"change:layer_index",this.render),this.listenTo(this.model,"change:selected",this.render)},render:function(){this.clearSubViews(),this.$el.html(this._html()),this._renderLayerSelector();var a=this.options.model.stats;return a&&this._drawGraph(),this},_html:function(){return f({columnName:this.model.columnName(),isSelected:!!this.model.get("selected")})},_renderLayerSelector:function(){var a=new e({model:this.model});this.addView(a),this.$(".js-inner").append(a.render().el)},_onSelect:function(){this.model.set("selected",!this.model.get("selected"))},_drawGraph:function(){var a=this;this.options.model.stats.graphFor(this.model.analysisDefinitionNodeModel().get("table_name"),this.model.get("name"),function(b){if(b.stats){a.$(".js-Histogram").append(b.getHistogram({color:"#9DE0AD",width:240,height:20,bins:20}));var c=a.$(".js-histstats").children();a.$(c[0]).text(b.getNullsPercentage()+"% null"),a.$(".js-histstats").css("display","flex")}else a.$(".js-Histogram").append(g())})}})},{"../layer-selector-view":390,"./histogram-fake.tpl":385,"./histogram-option.tpl":388,"backbone/core-view":1127}],388:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="WidgetList-option">\n  <input class="CDB-Checkbox js-checkbox" type="checkbox" ',isSelected&&(__p+='checked="checked"'),__p+=' />\n  <span class="u-iBlock CDB-Checkbox-face"></span>\n</div>\n\n<div class="WidgetList-inner js-inner">\n  <h3 class="u-ellipsis CDB-Text CDB-Size-large u-bSpace--m">'+(null==(__t=columnName)?"":_.escape(__t))+'</h3>\n  <ul class="js-histstats u-flex CDB-Text CDB-Size-small u-upperCase" style="display: none;">\n    <li class=\'u-rSpace\'></li>\n  </ul>\n  <div class="u-tSpace--m u-bSpace--m js-Histogram"></div>\n</div>\n';return __p}},{underscore:"underscore"}],389:[function(a,b,c){var d=a("backbone/core-view"),e=a("./histogram-option-view.js");b.exports=d.extend({className:"WidgetList",render:function(){return this.clearSubViews(),this.$el.empty(),this.collection.chain().filter(this._isHistogram).each(this._renderOption,this),this},_renderOption:function(a){var b=new e({className:"WidgetList-item",model:a});this.addView(b),this.$el.append(b.render().el)},_isHistogram:function(a){return"histogram"===a.get("type")}})},{"./histogram-option-view.js":387,"backbone/core-view":1127}],390:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../data/analyses");a("../../form-components/index");var h=a("../../form-components/editors/select/select-layer-list-item-view"),i=a("../../form-components/editors/select/select-layer-item.tpl"),j=a("../../form-components/editors/select/select-layer-list-item.tpl");b.exports=f.extend({className:"SelectorLayer",events:{change:"_onChange"},initialize:function(a){this.listenTo(this.model,"change:layer_index",this.render)},render:function(){return this._unbindEvents(),this._initViews(),this._bindEvents(),this},_initViews:function(){var b=this,c=this._buildOptions();this._selectView=new e.Form.editors.Select({className:"Widget-select u-flex u-alignCenter",key:"name",schema:{options:c},model:b.model,showSearch:!1,template:a("./select.tpl"),selectedItemTemplate:j,customListItemView:h,itemListTemplate:i}),this._selectView.setValue(this.model.get("layer_index")||0),this.$el.html(this._selectView.render().el)},_buildOptions:function(){return d.map(this.model.get("tuples"),function(a,b){var c=a.layerDefinitionModel,d=a.analysisDefinitionNodeModel;return{val:b,layerName:c.getName(),nodeTitle:g.title(d),layer_id:d.id,color:a.layerDefinitionModel.get("color")}})},_bindEvents:function(){this._selectView&&this._selectView.on("change",this._onChange,this)},_unbindEvents:function(){this._selectView&&this._selectView.off("change",this._onChange,this)},_onChange:function(){this.model.set("layer_index",this._selectView.getValue())}})},{"../../../data/analyses":599,"../../form-components/editors/select/select-layer-item.tpl":190,"../../form-components/editors/select/select-layer-list-item-view":191,"../../form-components/editors/select/select-layer-list-item.tpl":192,"../../form-components/index":211,"./select.tpl":391,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],391:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-upperCase u-altTextColor Widget-selectTitle">Select Layer</p>\n<div class="CDB-InputText CDB-Text is-cursor js-button u-ellipsis\n  ',isDisabled&&(__p+=" is-disabled "),__p+="\n  ",label||(__p+=" is-empty "),__p+='"\n  tabindex="0">\n  ',isLoading?__p+='\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n    <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n  ":(__p+="\n    ",__p+=isEmpty?"\n      "+(null==(__t=_t("components.backbone-forms.select.empty"))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=label||_t("components.backbone-forms.select.placeholder",{keyAttr:keyAttr}))?"":_.escape(__t))+"\n    ",__p+="\n  "),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],392:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+(null==(__t=label)?"":_.escape(__t));return __p}},{underscore:"underscore"}],393:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal-navigation">\n  <ul class="Modal-navigationInner CDB-Text is-semibold CDB-Size-medium js-menu"></ul>\n</div>\n<div class="Modal-inner Modal-inner--with-navigation js-content">\n</div>\n\n';return __p}},{underscore:"underscore"}],394:[function(a,b,c){function d(a){a.user&&a.api_key?(this.user=a.username,this.api_key=a.api_key):a.configModel&&(this.configModel=a.configModel,this.userModel=a.userModel),this.tables={},this.queue={}}function e(a,b){b=b||{},this.stats=a,this.normalize="undefined"==typeof b.normalize||b.normalize}var f=a("cartodb.js"),g=a("underscore");d.prototype={graphFor:function(a,b,c){this._getPgStats(a,function(a){var d=new e(a[b]);c(d)})},_getPgStats:function(a,b){var c=this.userModel,d=this;if(this.tables[a])g.isEmpty(this.tables[a])?this.queue[a].push(b):b(this.tables[a]);else{this.tables[a]={},this.queue[a]=[b];var e=c.getSchemaName(),h=new f.SQL({user:this.configModel.get("user_name"),sql_api_template:this.configModel.get("sql_api_template"),api_key:this.configModel.get("api_key")});h.execute("with a as (select reltuples from pg_class where relname = '"+a+"'), b as (select * from pg_stats where tablename = '"+a+"' and schemaname = '"+e+"') select * from a,b",null,{rows_per_page:40,page:0}).done(function(b){b=b||{};var c=b.rows.map(function(a){var b=a.reltuples,c=d._reformatToJSON(a.histogram_bounds);if(c)var e=c.reduce(function(a,b,d){return d<c.length-1&&a.push((c[d+1]+b)/2),a},[]),f=b/(c.length-1),h=e.reduce(function(a,b){return a+b*f},0),i=h/b,j=c[0],k=g.last(c);var l,m=d._reformatToJSON(a.most_common_vals);if(m){var n=m.indexOf("t"),o=m.indexOf("f");n>-1&&o>-1&&(l=a.most_common_freqs[n])}return{column:a.attname,histogram_bounds:c,freqs:a.most_common_freqs,mostcommon:m,nulls:a.null_frac,count:b,sum:h,min:j,max:k,avg:i,trues:l}}),e=c.reduce(function(a,b){var c=b.column;return delete b.column,a[c]=b,a},{});d.tables[a]=e,d._processQueue(a)})}},_processQueue:function(a){var b=this;this.queue[a].forEach(function(c){c(b.tables[a])})},_reformatToJSON:function(a){return a?(a=a.replace("{","").replace("}","").split(","),a.some(isNaN)||(a=a.map(function(a){return parseInt(a,10)})),a):null}},e.prototype={getNullsPercentage:function(){return this.stats.nulls},getPercentageInTopCategories:function(a){return this.stats.freqs.slice(0,a||10).reduce(function(a,b){return a+b})},getTrues:function(){return this.stats.trues},getHistogram:function(a){return this._generateHistogram(a.width,a.height,a.color,a.bins)},getCategory:function(a){return this._generateCategory(a.width,a.height,a.color)},getMin:function(){return this.stats.min},getMax:function(){return this.stats.max},getAverage:function(){return this.stats.avg},getCount:function(){return this.stats.count},getSum:function(){return this.stats.sum},_generateCategory:function(a,b,c){if(this.stats.freqs){var d,e=document.createElement("canvas"),f=e.getContext("2d");d=g.isNumber(this.getTrues())?this.getTrues():this.getPercentageInTopCategories(),e.height=b||10,e.width=a||400;var h=2,i=h,j=e.width-2*h,k=(j-i)*d+i;return f.lineCap="round",f.strokeStyle="#EDEDED",f.lineWidth=4,f.beginPath(),f.moveTo(i,e.height/2),f.lineTo(j,e.height/2),f.stroke(),f.strokeStyle=c,f.beginPath(),f.moveTo(i,e.height/2),f.lineTo(k,e.height/2),f.stroke(),e}},_generateHistogram:function(a,b,c,d){var e;if(!g.isEmpty(this.stats)&&(this.stats.freqs&&this.stats.freqs.length<60?e=this._getHistogramFromFreqs(d):this.stats.histogram_bounds&&(e=this._getHistogramFromBounds(d)),e&&!g.isEmpty(e))){if(this.normalize){var f=g.max(e);e=e.map(function(a){return a/f})}d=e.length;var h=document.createElement("canvas"),i=h.getContext("2d");h.height=b||90,h.width=a||400;var j=2,k=(h.width-j*(d-1))/d;return i.strokeStyle="#EDEDED",i.lineWidth=1,i.beginPath(),i.moveTo(0,0),i.lineTo(h.width,0),i.stroke(),i.beginPath(),i.moveTo(0,h.height/2),i.lineTo(h.width,h.height/2),i.stroke(),e.forEach(function(a,b){var d=b*(k+j),e=h.height*a;i.beginPath(),i.fillStyle=c,i.fillRect(d,h.height-e,k,e)}),i.strokeStyle="#A1BBA7",i.lineWidth=2,i.beginPath(),i.moveTo(0,h.height),i.lineTo(h.width,h.height),i.stroke(),h}},_getHistogramFromBounds:function(a){function b(b){return e===d?d:Math.floor((a-1)*(b-d)/(e-d))}var c=this.stats.histogram_bounds;c=c.sort(function(a,b){return a-b});for(var d=c[0],e=c[c.length-1],f=(e-d)/a,h=new Array(a+1).join("0").split("").map(parseFloat),i=1/(c.length-1),j=0;j<c.length-1;++j){var k=b(c[j]),l=b(c[j+1]);if(k===l)h[k]+=i;else{var m=(d+f*(k+1)-c[j])/(c[j+1]-c[j]);h[k]+=m*i;var n=(c[j+1]-(d+f*l))/(c[j+1]-c[j]);h[l]+=n*i;var o=i-m-n;g.range(k+1,l).forEach(function(a,b,c){h[a]=o/c.length})}}return h},_getHistogramFromFreqs:function(a){function b(b){return f===e?e:(a-1)*(b-e)/(f-e)}var c=this.stats.mostcommon,d=this.stats.freqs;a=Math.min(a,c.length);var e=g.min(c),f=g.max(c);if(e===f)return[];var h=new Array(a+1).join("0").split("").map(parseFloat);return c.forEach(function(a,c){h[Math.floor(b(a))]+=d[c]}),h}},b.exports=d},{"cartodb.js":"cartodb.js",underscore:"underscore"}],395:[function(a,b,c){var d=a("underscore"),e=a("../widget-option-model");b.exports=e.extend({defaults:d.defaults({type:"time-series"},e.defaults),save:function(a){var b=a.find(this._isTimesSeries);b&&b.destroy({wait:!0})},_isTimesSeries:function(a){return"time-series"===a.get("type")}})},{"../widget-option-model":402,underscore:"underscore"}],396:[function(a,b,c){var d=a("backbone/core-view"),e=a("./time-series-none-option.tpl");b.exports=d.extend({events:{"click .js-radio":"_onSelect"},initialize:function(a){this.listenTo(this.model,"change:selected",this.render)},render:function(){return this.$el.html(this._html()),this},_html:function(){return e({isSelected:!!this.model.get("selected")})},_onSelect:function(){this.model.set("selected",!this.model.get("selected"))}})},{"./time-series-none-option.tpl":397,"backbone/core-view":1127}],397:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="WidgetList-option">\n  <input class="CDB-Radio u-iBlock js-radio" type="radio" ',isSelected&&(__p+='checked="checked"'),__p+=' />\n  <span class="u-iBlock CDB-Radio-face"></span>\n</div>\n\n<div class="WidgetList-inner js-inner">\n  <h3 class="WidgetList-title CDB-Text CDB-Size-large u-bSpace--xl">'+(null==(__t=_t("components.modals.add-widgets.time-series-no-option-title"))?"":_.escape(__t))+'</h3>\n  <p class="CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=_t("components.modals.add-widgets.time-series-no-option-desc"))?"":_.escape(__t))+"</p>\n</div>\n";return __p}},{underscore:"underscore"}],398:[function(a,b,c){var d=a("underscore"),e=a("../widget-option-model"),f=a("../../../../data/widget-definition-model");b.exports=e.extend({defaults:d.defaults({type:"time-series"},e.defaults),save:function(a){var b=this.columnName(),c=this.layerDefinitionModel().id,d=this,e={type:"time-series",layer_id:c,source:{id:this.analysisDefinitionNodeModel().id},options:{column:b,title:this.get("title"),bins:this.get("bins")},style:{widget_style:{definition:f.getDefaultWidgetStyle("time-series")}}},g={type:"time-series",layer_id:c,source:this.analysisDefinitionNodeModel().id,column:b,title:this.get("title"),bins:this.get("bins"),widget_style_definition:f.getDefaultWidgetStyle("time-series")},h=function(b,c){a.trigger("success",d)},i=function(b,c){a.trigger("error",d,c)},j=function(b){"create"===b?a.trigger("loading",d):a.trigger("updating",d)},k=a.find(this._isTimesSeries);return k?k.get("column")!==b||k.get("layer_id")!==c?(j("update"),k.save(g,{wait:!0,success:h,error:i})):void 0:(j("create"),a.create(e,{wait:!0,success:h,error:i}))},_isTimesSeries:function(a){return"time-series"===a.get("type")}})},{"../../../../data/widget-definition-model":680,"../widget-option-model":402,underscore:"underscore"}],399:[function(a,b,c){var d=a("backbone/core-view"),e=a("../layer-selector-view"),f=a("./time-series-option.tpl");b.exports=d.extend({events:{"click .js-radio":"_onSelect"},initialize:function(a){this.listenTo(this.model,"change:layer_index",this.render),this.listenTo(this.model,"change:selected",this.render)},render:function(){return this.clearSubViews(),this.$el.html(this._html()),this._renderLayerSelector(),this},_html:function(){return f({columnName:this.model.columnName(),isSelected:!!this.model.get("selected")})},_renderLayerSelector:function(){var a=new e({model:this.model});this.addView(a),this.$(".js-inner").append(a.render().el)},_onSelect:function(){this.model.set("selected",!this.model.get("selected"))}})},{"../layer-selector-view":390,"./time-series-option.tpl":400,"backbone/core-view":1127}],400:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="WidgetList-option">\n  <input class="CDB-Radio u-iBlock js-radio" type="radio" ',isSelected&&(__p+='checked="checked"'),__p+=' />\n  <span class="u-iBlock CDB-Radio-face"></span>\n</div>\n\n<div class="WidgetList-inner js-inner">\n  <h3 class="u-ellipsis CDB-Text CDB-Size-large u-bSpace--m">'+(null==(__t=columnName)?"":_.escape(__t))+"</h3>\n</div>\n";return __p}},{underscore:"underscore"}],401:[function(a,b,c){var d=a("backbone/core-view"),e=a("./time-series-option-view.js"),f=a("./time-series-none-option-view.js");b.exports=d.extend({className:"WidgetList",initialize:function(){this.listenTo(this.collection,"change:selected",this._onSelectedChange)},render:function(){return this.clearSubViews(),this.$el.empty(),this.collection.chain().filter(this._isTimeSeries).each(this._renderOption,this),this},_renderOption:function(a){var b=a.has("tuples")?e:f,c=new b({className:"WidgetList-item",model:a});this.addView(c),this.$el.append(c.render().el)},_isTimeSeries:function(a){return"time-series"===a.get("type")},_onSelectedChange:function(a,b){b&&this.collection.each(function(b){this._isTimeSeries(b)&&b!==a&&b.set("selected",!1)},this)}})},{"./time-series-none-option-view.js":396,"./time-series-option-view.js":399,"backbone/core-view":1127}],402:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{layer_index:0,tuples:[]},analysisDefinitionNodeModel:function(){return this._selectedItem().analysisDefinitionNodeModel},layerDefinitionModel:function(){return this._selectedItem().layerDefinitionModel},columnName:function(){return this._selectedItem().columnModel.get("name")},save:function(){throw new Error("save should be implemented by child")},_selectedItem:function(){var a=this.get("layer_index")||0,b=this.get("tuples")||[];return b[a]||{}}})},{backbone:"backbone"}],403:[function(a,b,c){var d=a("underscore"),e=a("./category/category-option-model"),f=a("./category/category-options-view"),g=a("./histogram/histogram-option-model"),h=a("./histogram/histogram-options-view"),i=a("./formula/formula-option-model"),j=a("./formula/formula-options-view"),k=a("./time-series/time-series-option-model"),l=a("./time-series/time-series-none-option-model"),m=a("./time-series/time-series-options-view"),n=a("../../scroll/scroll-view"),o="cartodb_id";b.exports=[{type:"category",createOptionModels:function(a){return d.reduce(a,function(a,b){var c,d=b[0].columnModel,f=d.get("type");return"string"!==f&&"boolean"!==f||(c=new e({tuples:b,title:d.get("name"),name:d.get("name"),aggregation:"count"}),a.push(c)),a},[])},createTabPaneItem:function(a){return{label:_t("components.modals.add-widgets.tab-pane.category-label"),name:"category",createContentView:function(){return new n({createContentView:function(){return new f({collection:a})}})}}}},{type:"histogram",createOptionModels:function(a){return d.reduce(a,function(a,b){var c=b[0].columnModel;if("number"===c.get("type")){var d=new g({tuples:b,title:c.get("name"),name:c.get("name"),bins:10});a.push(d)}return a},[])},createTabPaneItem:function(a){return{label:_t("components.modals.add-widgets.tab-pane.histogram-label"),name:"histogram",createContentView:function(){return new n({createContentView:function(){return new h({collection:a})}})}}}},{type:"formula",createOptionModels:function(a){return d.reduce(a,function(a,b){var c,d,e=b[0].columnModel,f=e.get("name"),g=b[0].layerDefinitionModel,h="avg",j=f;if("number"===e.get("type")){f===o&&(c=g.getAnalysisDefinitionNodeModel(),c&&c.queryGeometryModel&&(d=c.queryGeometryModel.get("simple_geom")),h="count",j=_t("editor.data.stats.number-of",{geometry:d}));var k=new i({tuples:b,title:j,operation:h,name:e.get("name")});a.push(k)}return a},[])},createTabPaneItem:function(a){return{label:_t("components.modals.add-widgets.tab-pane.formula-label"),name:"formula",createContentView:function(){return new n({createContentView:function(){return new j({collection:a})}})}}}},{type:"time-series",createOptionModels:function(a,b){var c=b.find(function(a){return"time-series"===a.get("type")}),e=d.reduce(a,function(a,b){var e=b[0].columnModel,f=e.get("name");if("date"===e.get("type")||"number"===e.get("type")){var g={tuples:b,title:f,bins:256};c&&c.get("column")===f&&d.find(b,function(a,b){if(a.layerDefinitionModel.id===c.get("layer_id"))return g.selected=!0,g.layer_index=b,!0});var h=new k(g);a.push(h)}return a},[]),f=new l;return[f].concat(e)},createTabPaneItem:function(a){return{label:_t("components.modals.add-widgets.tab-pane.time-series-label"),name:"time-series",createContentView:function(){return new n({createContentView:function(){return new m({collection:a})}})}}}}]},{"../../scroll/scroll-view":530,"./category/category-option-model":375,"./category/category-options-view":378,"./formula/formula-option-model":381,"./formula/formula-options-view":384,"./histogram/histogram-option-model":386,"./histogram/histogram-options-view":389,"./time-series/time-series-none-option-model":395,"./time-series/time-series-option-model":398,"./time-series/time-series-options-view":401,underscore:"underscore"}],404:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("underscore"),g=a("../../loading/render-loading"),h=13,i=["template","runAction","modalModel"];b.exports=d.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function(a){f.each(i,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),a.loadingTitle&&(this._hasLoading=!0,this._loadingTitle=a.loadingTitle),a.renderOpts&&(this._hasRenderOpts=!0,this._renderOpts=a.renderOpts),this._onKeyDown=this._onKeyDown.bind(this),this._initBinds()},render:function(){this.clearSubViews();var a=this._hasRenderOpts?this._template(this._renderOpts):this._template();return this.$el.html(a),this},_initBinds:function(){e(document).bind("keydown",this._onKeyDown)},_disableBinds:function(){e(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function(a){var b=a.which;b===h&&this._onConfirm()},_renderLoadingView:function(){this.$el.html(g({title:this._loadingTitle}))},_$content:function(){return this.$(".js-content")},_onConfirm:function(){this._hasLoading?this._renderLoadingView():this._modalModel.destroy(),this._runAction()},_onCancel:function(){this._modalModel.destroy()},clean:function(){this._disableBinds(),d.prototype.clean.apply(this)}})},{"../../loading/render-loading":230,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],405:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../loading/render-loading"),g=a("../../error/error-view"),h=["errorTitle","loadingTitle","runAction","modalModel"];b.exports=d.extend({className:"Dialog-content",initialize:function(a){e.each(h,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(f({title:this._loadingTitle})),this._runAction({error:this._renderErrorView.bind(this)}),this},_renderErrorView:function(a){var b=new g({title:this._errorTitle,desc:a});this.$el.html(b.render().el),this.addView(b)}})},{"../../error/error-view":67,"../../loading/render-loading":230,"backbone/core-view":1127,underscore:"underscore"}],406:[function(a,b,c){var d=a("backbone/core-view"),e=a("./editor-visualization-warning.tpl"),f=a("../../../data/vis-definition-model"),g=a("../../loading/render-loading"),h=a("../../error/error-view"),i=a("../../../helpers/error-parser"),j=3;
b.exports=d.extend({className:"Dialog-content",events:{"click .js-open":"_onOpen","click .js-duplicate":"_onDuplicate","click .js-cancel":"_onCancel"},initialize:function(a){if(!a.visDefinitionModel)throw new Error("visDefinitionModel is required");if(!a.modalModel)throw new Error("modalModel is required");this._visDefinitionModel=a.visDefinitionModel,this._modalModel=a.modalModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(e()),this},_initBinds:function(){this._modalModel.bind("change:show",this._goToDashboard,this),this.add_related_model(this._modalModel)},_disableBinds:function(){this._modalModel.unbind("change:show",this._goToDashboard,this)},_onOpen:function(){this._disableBinds(),this._renderLoading("open"),this._visDefinitionModel.save({version:j},{wait:!0,success:function(){this._modalModel.destroy()}.bind(this),error:function(a,b){this._renderError(i(b))}.bind(this)})},_onDuplicate:function(){this._renderLoading("duplicate");var a=new f({name:this._visDefinitionModel.get("name")},{configModel:this._visDefinitionModel._configModel});a.save({source_visualization_id:this._visDefinitionModel.get("id")},{success:function(a){this._redirectToBuilder(a.builderURL())}.bind(this),error:function(a,b){this._renderError(i(b))}.bind(this)})},_redirectToBuilder:function(a){window.location=a},_renderLoading:function(a){var b=this._visDefinitionModel.get("name"),c="";"duplicate"===a?c=_t("editor.maps.duplicate.loading",{name:b}):"open"===a&&(c=_t("components.modals.editor-vis-warning.opening-title",{name:b})),this.$el.html(g({title:c}))},_renderError:function(a){var b=this._visDefinitionModel.get("name"),c=new h({title:_t("editor.maps.duplicate.error",{name:b}),desc:a});this.$el.html(c.render().el),this.addView(c)},_goToDashboard:function(a){window.location=a},_onCancel:function(){this._goToDashboard(this._visDefinitionModel._configModel.get("base_url"))},clean:function(){this._disableBinds(),d.prototype.clean.apply(this)}})},{"../../../data/vis-definition-model":675,"../../../helpers/error-parser":1090,"../../error/error-view":67,"../../loading/render-loading":230,"./editor-visualization-warning.tpl":407,"backbone/core-view":1127}],407:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--medium u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="32px" height="32px" viewbox="459 348 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Editor-vis-warning" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(459.000000, 348.000000)">\n        \t<path d="M15.081,7.19c0.472,0.473,1.1,0.732,1.768,0.732c0.667,0,1.295-0.26,1.768-0.732s0.732-1.101,0.732-1.768\n        \t\tc0-0.668-0.26-1.296-0.732-1.768c-0.945-0.946-2.592-0.944-3.536,0c-0.472,0.472-0.732,1.1-0.732,1.768S14.608,6.719,15.081,7.19z\n        \t\t M15.788,4.362c0.283-0.283,0.66-0.439,1.061-0.439c0.4,0,0.777,0.156,1.061,0.439c0.284,0.283,0.439,0.659,0.439,1.061\n        \t\tc0,0.4-0.156,0.777-0.439,1.061c-0.567,0.566-1.556,0.566-2.122,0c-0.283-0.283-0.439-0.659-0.439-1.061S15.504,4.646,15.788,4.362\n        \t\tz" fill="#FFA500"/>\n        \t<path d="M13.676,12.131c0.094-0.094,0.146-0.221,0.146-0.354s-0.053-0.26-0.146-0.354l-2.829-2.828\n        \t\tc-0.195-0.195-0.512-0.195-0.707,0l-2.828,2.828c-0.195,0.195-0.195,0.512,0,0.707l2.828,2.828\n        \t\tc0.098,0.098,0.226,0.146,0.354,0.146s0.256-0.049,0.354-0.146L13.676,12.131z M8.373,11.777l2.121-2.121l2.122,2.121l-2.122,2.121\n        \t\tL8.373,11.777z" fill="#FFA500"/>\n        \t<path d="M23.375,17.965c-0.182-0.205-0.499-0.227-0.706-0.044c-2.704,2.385-6.065,3.678-8.77,3.367\n        \t\tc-1.699-0.194-3.106-0.991-4.199-2.354l0.989-0.989c0.087,0.331,0.252,0.646,0.511,0.904c0.39,0.39,0.902,0.584,1.414,0.584\n        \t\tc0.512,0,1.024-0.194,1.415-0.584l2.122-2.122c0.081-0.08,0.139-0.175,0.213-0.26c0.05-0.023,0.099-0.052,0.14-0.093l4.596-4.597\n        \t\tc0.755-0.755,1.171-1.76,1.171-2.828c0-0.983-0.367-1.904-1.012-2.635c0.059-0.29,0.089-0.588,0.089-0.892\n        \t\tc0-1.202-0.468-2.332-1.318-3.183c-0.85-0.85-1.98-1.317-3.182-1.317c-0.304,0-0.602,0.03-0.893,0.089\n        \t\tc-1.569-1.381-3.963-1.339-5.462,0.159L5.897,5.768C5.856,5.809,5.829,5.856,5.806,5.906C5.72,5.98,5.625,6.04,5.544,6.121\n        \t\tL3.423,8.242c-0.78,0.779-0.78,2.049,0,2.828c0.255,0.255,0.576,0.416,0.915,0.499l-3.744,3.743\n        \t\tc-0.377,0.378-0.585,0.88-0.585,1.414c0,0.535,0.208,1.037,0.585,1.414c0.756,0.756,2.073,0.756,2.829,0l3.182-3.182\n        \t\tc0.196-0.195,0.513-0.194,0.708,0c0.195,0.195,0.195,0.513,0,0.708L4.13,18.849c-0.378,0.377-0.586,0.879-0.586,1.414\n        \t\tS3.752,21.3,4.13,21.677c0.39,0.39,0.902,0.585,1.414,0.585s1.025-0.195,1.415-0.585l2.032-2.032\n        \t\tc1.244,1.506,2.888,2.419,4.796,2.637c0.298,0.034,0.603,0.051,0.914,0.051c2.789,0,6.012-1.352,8.63-3.661\n        \t\tC23.538,18.488,23.558,18.172,23.375,17.965z M21.272,8.949c0,0.802-0.312,1.555-0.878,2.121l-2.85,2.85\n        \t\tc0.035-0.24,0.071-0.48,0.071-0.729c0-1.24-0.466-2.402-1.287-3.319c0.173,0.021,0.344,0.051,0.521,0.051\n        \t\tc1.202,0,2.332-0.468,3.182-1.318c0.345-0.345,0.608-0.743,0.821-1.166C21.119,7.894,21.272,8.407,21.272,8.949z M19.323,2.947\n        \t\tc0.661,0.661,1.025,1.54,1.025,2.476c0,0.935-0.364,1.813-1.025,2.475c-1.294,1.292-3.521,1.312-4.855,0.076l-0.176-0.176\n        \t\tc-1.273-1.37-1.252-3.517,0.082-4.851c0.661-0.661,1.54-1.024,2.475-1.024C17.783,1.923,18.662,2.286,19.323,2.947z M11.201,1.878\n        \t\tc0.984-0.982,2.482-1.128,3.631-0.458c-0.422,0.213-0.821,0.477-1.165,0.82c-1.01,1.011-1.419,2.385-1.266,3.704\n        \t\tc-0.918-0.822-2.079-1.288-3.321-1.288c-0.248,0-0.488,0.036-0.728,0.071L11.201,1.878z M6.251,20.97\n        \t\tc-0.391,0.391-1.025,0.39-1.415,0c-0.188-0.188-0.292-0.439-0.292-0.707s0.104-0.519,0.293-0.707l3.183-3.182\n        \t\tc0.584-0.586,0.584-1.538,0-2.122c-0.585-0.586-1.537-0.586-2.122,0l-3.182,3.182c-0.378,0.378-1.037,0.376-1.415,0\n        \t\tc-0.189-0.188-0.292-0.439-0.292-0.707c0-0.267,0.104-0.519,0.292-0.707l5.186-5.185l0.472-0.472l0,0L9.08,8.242\n        \t\tc0.195-0.195,0.195-0.512,0-0.707s-0.512-0.195-0.707,0L5.78,10.128l-0.236,0.235c-0.378,0.379-1.036,0.377-1.414,0\n        \t\tc-0.39-0.39-0.39-1.024,0-1.414l2.121-2.121c1.511-1.512,4.146-1.512,5.657,0l1.677,1.677c0.03,0.031,0.051,0.068,0.082,0.1\n        \t\tc0.032,0.032,0.071,0.054,0.103,0.085l1.674,1.674c0.755,0.756,1.171,1.76,1.171,2.828s-0.416,2.073-1.171,2.828l-2.121,2.122\n        \t\tc-0.39,0.389-1.024,0.389-1.415,0c-0.189-0.189-0.293-0.44-0.293-0.708c0-0.267,0.104-0.518,0.292-0.707l2.829-2.828\n        \t\tc0.195-0.195,0.195-0.512,0-0.707s-0.512-0.195-0.707,0l-2.121,2.121l0,0l-0.707,0.707c0,0,0,0.001-0.001,0.001L6.251,20.97z" fill="#FFA500"/>\n        </g>\n      </svg>\n    </div>\n\n    <div>\n      <h2 class="Dialog-headerTitle--warning CDB-Text CDB-Size-huge is-light u-bSpace--m">'+(null==(__t=_t("components.modals.editor-vis-warning.title"))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-medium u-secondaryTextColor u-bSpace--xl">'+(null==(__t=_t("components.modals.editor-vis-warning.explanation"))?"":_.escape(__t))+'</p>\n      <p class="CDB-Text CDB-Size-medium is-semibold u-secondaryTextColor">'+(null==(__t=_t("components.modals.editor-vis-warning.question"))?"":_.escape(__t))+'</p>\n\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">\n              '+(null==(__t=_t("components.modals.editor-vis-warning.go-back"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-open">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">\n              '+(null==(__t=_t("components.modals.editor-vis-warning.open"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n      </ul>\n\n      <p class="CDB-Text CDB-Size-medium u-secondaryTextColor u-tSpace-xl">or <button class="CDB-Text is-semibold u-actionTextColor js-duplicate">'+(null==(__t=_t("components.modals.editor-vis-warning.duplicate"))?"":_.escape(__t))+"</button>.</p>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],408:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("../../loading/render-loading"),g=a("../../error/error-view"),h=a("./modal-export-data.tpl"),i=1e3,j="SELECT * FROM (%%sql%%) as subq ",k=[{format:"csv",fetcher:"fetchCSV",geomRequired:!1},{format:"shp",fetcher:"fetch",geomRequired:!0},{format:"kml",fetcher:"fetch",geomRequired:!0},{format:"geojson",label:"geo json",fetcher:"fetch",geomRequired:!0},{format:"svg",fetcher:"fetchSVG",geomRequired:!0}];b.exports=e.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_close"},options:{autoClose:!0},initialize:function(a){if(!a.fileName)throw new Error("name is required");if(!a.configModel)throw new Error("configModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.modalModel)throw new Error("modalModel is required");this._configModel=a.configModel,this._fileName=a.fileName,this._queryGeometryModel=a.queryGeometryModel,this._modalModel=a.modalModel,this._initBinds(),"unfetched"===this._queryGeometryModel.get("status")&&this._queryGeometryModel.fetch()},render:function(){var a=this._queryGeometryModel.get("simple_geom");return"fetched"===this._queryGeometryModel.get("status")||"unavailable"===this._queryGeometryModel.get("status")?this.$el.html(h({formats:k,url:this._configModel.getSqlApiUrl(),isGeoreferenced:!!a})):this._renderLoadingContent(_t("components.modals.export-data.loading.geometry")),this},_initBinds:function(){this._queryGeometryModel.bind("change:status",function(){"unavailable"!==this._queryGeometryModel.get("status")?this.render():this.showError(_t("components.modals.export-data.error.geometry-error"))},this),this.add_related_model(this._queryGeometryModel)},_getFormat:function(a){for(var b in k)if(k[b].format===a)return k[b]},_onConfirm:function(){this._form=this.$(".js-form");var a=d(".js-format[name=format]:checked",this._form).data("format"),b=this._getFormat(a);this[b.fetcher](a)},getBaseOptions:function(){return{filename:this._fileName,apiKey:this._configModel.get("api_key")}},getGeomFilteredSql:function(){var a=this._queryGeometryModel.get("query"),b=this._queryGeometryModel.get("simple_geom");return b?j.replace(/%%sql%%/g,a):a},_fetch:function(a,b){this.$(".js-format").val(a.format),this.$(".js-q").val(b),this.$(".js-filename").val(a.filename),this.$(".js-apiKey").val(a.apiKey);var c=["the_geom_webmercator"];if("csv"!==a.format&&c.push("the_geom"),this.$(".js-skipfields").val(c.join(",")),b.length<i){var d=this.$(".js-form").attr("action")+"?"+this.$(".js-form").serialize();this._fetchGET(d)}else this.submit();this.$(".js-skipfields").attr("disabled","disabled"),this.options.autoClose?this._close():this._renderLoadingContent(_t("components.modals.export-data.loading.preparing"))},showError:function(a){var b=new g({title:_t("hello"),desc:a});this.$el.html(b.render().el),this.addView(b)},_fetchGET:function(a){function b(a){var b=null;try{var c=JSON.parse(a);b=c.error[0]}catch(c){a&&a.indexOf("error")!==-1&&(b=_t("components.modals.export-data.error.unknown"))}return b}var c,d=this,e=window.open(a);e.onload=function(){clearInterval(c);var a=b(e.document.body.textContent);a?d.showError(a):d._close(),e.close()},window.focus(),c=setInterval(function(){(e.closed||e.document&&0===e.document.body.textContent.length)&&(d._close(),clearInterval(c))},100)},fetch:function(a){var b=this.getBaseOptions();b.format=a;var c=this._queryGeometryModel.get("query");this._fetch(b,c)},fetchCSV:function(){var a=this.getBaseOptions();a.format="csv";var b=this.getGeomFilteredSql();this.$(".js-skipfields").removeAttr("disabled"),this._fetch(a,b)},fetchSVG:function(){this.fetch("svg")},submit:function(){this.$(".js-form").submit()},_renderLoadingContent:function(a){this.$el.html(f({title:a}))},_close:function(){this._modalModel.destroy()}})},{"../../error/error-view":67,"../../loading/render-loading":230,"./modal-export-data.tpl":409,"backbone/core-view":1127,jquery:"jquery"}],409:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="24px" viewbox="459 348 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Export-dataset" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(459.000000, 348.000000)">\n          <path d="M1,1 L11,1 L11,5.5 C11,5.776 11.224,6 11.5,6 L16,6 L16,9.5 L17,9.5 L17,5.502 C17,5.502 17,5.502 17,5.501 C17,5.5 17,5.501 17,5.5 C17,5.447 16.985,5.398 16.97,5.35 C16.966,5.337 16.967,5.323 16.962,5.311 C16.936,5.247 16.896,5.19 16.847,5.142 L11.854,0.147 C11.808,0.101 11.753,0.064 11.692,0.039 C11.632,0.014 11.567,0 11.5,0 L0.5,0 C0.224,0 0,0.224 0,0.5 L0,21.5 C0,21.776 0.224,22 0.5,22 L10.5,22 L10.5,21 L1,21 L1,1 L1,1 Z M12,1.708 L15.291,5 L12,5 L12,1.708 L12,1.708 Z" id="Shape" fill="#2E3C43"/>\n          <path d="M17.5,11 C13.916,11 11,13.916 11,17.5 C11,21.084 13.916,24 17.5,24 C21.084,24 24,21.084 24,17.5 C24,13.916 21.084,11 17.5,11 L17.5,11 Z M17.5,23 C14.467,23 12,20.533 12,17.5 C12,14.467 14.467,12 17.5,12 C20.533,12 23,14.467 23,17.5 C23,20.533 20.533,23 17.5,23 L17.5,23 Z" id="Shape" fill="#2E3C43"/>\n          <path d="M17.858,14.425 C17.767,14.331 17.641,14.272 17.5,14.272 C17.359,14.272 17.232,14.331 17.142,14.425 L14.965,16.602 C14.77,16.797 14.77,17.114 14.965,17.309 C15.16,17.504 15.477,17.504 15.672,17.309 L17,15.981 L17,20.226 C17,20.502 17.224,20.726 17.5,20.726 C17.776,20.726 18,20.502 18,20.226 L18,15.981 L19.328,17.309 C19.426,17.407 19.554,17.455 19.682,17.455 C19.81,17.455 19.938,17.406 20.036,17.309 C20.231,17.114 20.231,16.797 20.036,16.602 L17.858,14.425 L17.858,14.425 Z" id="Shape" fill="#2E3C43" transform="translate(17.500500, 17.499000) scale(1, -1) translate(-17.500500, -17.499000) "/>\n        </g>\n      </svg>\n    </div>\n\n    <div>\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace--xl">'+(null==(__t=_t("components.modals.export-data.title"))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("components.modals.export-data.desc"))?"":_.escape(__t))+".</p>\n      ",isGeoreferenced||(__p+='\n        <p class="CDB-Text CDB-Size-large u-altTextColor u-tSpace-xl">'+(null==(__t=_t("components.modals.export-data.no-geometry"))?"":_.escape(__t))+"</p>\n      "),__p+='\n\n      <div class="Modal-listTextItem u-flex u-alignCenter">\n        <h3 class="CDB-Text CDB-Size-medium is-semibold u-upperCase">Select format</h3>\n\n        <form class="js-form" method="POST" action="'+(null==(__t=url)?"":_.escape(__t))+'">\n          <input type="hidden" class="js-filename" name="filename" />\n          <input type="hidden" class="js-q" name="q" />\n          <input type="hidden" class="js-apiKey" name="api_key" />\n          <input type="hidden" class="js-skipfields" name="skipfields" disabled="disabled" value="" />\n          <input type="hidden" class="js-dp" name="dp" value="4" disabled="disabled" />\n\n          <ul class="Modal-listForm u-flex u-alignCenter CDB-Text CDB-Size-medium">\n            ',_.each(formats,function(a){__p+='\n            <li class="Modal-listFormItem\n              ',isGeoreferenced===!1&&a.geomRequired===!0&&(__p+="\n                is-disabled\n              "),__p+='"\n            >\n              <input class="CDB-Radio js-format" type="radio" name="format" data-format="'+(null==(__t=a.format)?"":_.escape(__t))+'"\n                ',isGeoreferenced===!1&&a.geomRequired===!0&&(__p+="\n                  disabled\n                "),__p+="\n\n                ","csv"===a.format&&(__p+="\n                  checked\n                "),__p+='\n              >\n              <span class="u-iBlock CDB-Radio-face"></span>\n              <label class="u-iBlock u-lSpace u-upperCase">'+(null==(__t=a.label||a.format)?"":_.escape(__t))+"</label>\n            </li>\n            "}),__p+='\n          </ul>\n        </form>\n\n      </div>\n\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.export-data.cancel"))?"":_.escape(__t))+'</span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.export-data.download"))?"":_.escape(__t))+"</span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],410:[function(a,b,c){var d=a("backbone/core-view"),e=a("./footer.tpl");b.exports=d.extend({tagName:"ul",className:"Modal-listActions u-flex u-alignCenter ",events:{"click .js-save":"_save"},initialize:function(a){if(!a.visMetadataModel)throw new Error("visMetadataModel is required");if(!a.onSaveAction)throw new Error("onSaveAction is required");this._visMetadataModel=a.visMetadataModel,this._onSaveAction=a.onSaveAction,this._initBinds()},_initBinds:function(){this._visMetadataModel.on("change",this.render,this)},render:function(){return this.$el.html(e({canFinish:this._visMetadataModel.isValid()})),this},_save:function(){this._visMetadataModel.isValid()&&this._onSaveAction()}})},{"./footer.tpl":411,"backbone/core-view":1127}],411:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li class="Modal-listActionsitem">\n  <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-close">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n      '+(null==(__t=_t("components.modals.maps-metadata.cancel-btn"))?"":_.escape(__t))+'\n    </span>\n  </button>\n</li>\n<li class="Modal-listActionsitem">\n  <button class="CDB-Button CDB-Button--primary CDB-Button--big js-save '+(null==(__t=canFinish?"":"is-disabled")?"":_.escape(__t))+'">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase ">\n      '+(null==(__t=_t("components.modals.maps-metadata.save-btn"))?"":_.escape(__t))+"\n    </span>\n  </button>\n</li>\n\n";return __p}},{underscore:"underscore"}],412:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./form.tpl");a("../../../form-components/index");var h=a("../../../tipsy-tooltip-view"),i=a("../../../../helpers/utils"),j=["visDefinitionModel","visMetadataModel"];b.exports=f.extend({className:"Metadata-form",initialize:function(a){d.each(j,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(g()),this._initViews(),this},_initViews:function(){this._addInputView(),this._addTextareaView(),this._addTagsView(),this._addTooltip()},_addInputView:function(){this._inputView=new e.Form.editors.Text({key:"name",model:this._visMetadataModel,schema:{options:this._visDefinitionModel.get("name"),editorAttrs:{placeholder:_t("components.modals.maps-metadata.form.name-placeholder")}}}),this._inputView.on("change",this._commitView,this),this.$(".js-name-field").append(this._inputView.render().$el)},_addTextareaView:function(){this._textareaView=new e.Form.editors.TextArea({className:"CDB-Textarea Metadata-textarea",key:"description",model:this._visMetadataModel,schema:{options:this._visDefinitionModel.get("description"),editorAttrs:{placeholder:_t("components.modals.maps-metadata.form.description-placeholder")}}}),this._textareaView.on("change",this._commitView,this),this.$(".js-description-field").append(this._textareaView.render().$el)},_addTagsView:function(){this._taglistView=new e.Form.editors.Taglist({key:"tags",model:this._visMetadataModel,schema:{options:{tags:this._visDefinitionModel.get("tags")||[]}}}),this._taglistView.on("change",this._commitView,this),this.$(".js-tags-field").append(this._taglistView.render().$el),this.addView(this._taglistView)},_addTooltip:function(){var a=this.$(".js-markdown").data("tooltip");this._removeTooltip(),this._tooltip=new h({el:this.$(".js-markdown"),html:!0,title:function(){return a}})},_commitView:function(a){a.commit(),a.model.changed.hasOwnProperty("name")&&this._sanitizeName(a.model.get("name"))},_sanitizeName:function(a){this._visMetadataModel.set("name",i.sanitizeHtml(a))},_removeTooltip:function(){this._tooltip&&this._tooltip.clean()},_removeBinds:function(){this._inputView&&this._inputView.off("change",this._commitView,this),this._textareaView&&this._textareaView.off("change",this._commitView,this),this._taglistView&&this._taglistView.off("change",this._commitView,this)},clean:function(){this._removeBinds(),f.prototype.clean.call(this)}})},{"../../../../helpers/utils":1102,"../../../form-components/index":211,"../../../tipsy-tooltip-view":589,"./form.tpl":413,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],413:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-tSpace-xl CDB-Text u-flex js-name-field">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.maps-metadata.form.name"))?"":_.escape(__t))+'</label>\n</div>\n\n<div class="u-tSpace-xl CDB-Text u-flex">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.maps-metadata.form.description"))?"":_.escape(__t))+'</label>\n  <div class="u-grow">\n    <div class="js-description-field u-bSpace"></div>\n    <div class="Markdown">\n      <span class="Markdown-tooltip js-markdown" data-tooltip="<em>_italics_</em><br/><b>*bold*</b><br/>[link](http://link.com)">\n        <span class="Markdown-icon">\n          <i class="Markdown-icon-text">M</i>\n          <i class="Markdown-icon-char">￬</i>\n        </span>\n        '+(null==(__t=_t("components.modals.maps-metadata.form.markdown"))?"":_.escape(__t))+'\n      </span>\n    </div>\n  </div>\n\n</div>\n\n<div class="u-tSpace-xl CDB-Text u-flex u-alignCenter js-tags-field">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.maps-metadata.form.tags"))?"":_.escape(__t))+"</label>\n</div>";return __p}},{underscore:"underscore"}],414:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="Dialog-header Modal-header js-header">\n    <div class="Dialog-headerIcon Dialog-headerIcon--negative">\n      <i class="CDB-IconFont CDB-IconFont-cockroach"></i>\n    </div>\n    <h2 class="CDB-Text CDB-Size-large u-bSpace u-errorTextColor">'+(null==(__t=_t("components.modals.maps-metadata.error.title"))?"":_.escape(__t))+'</h2>\n    <h3 class="CDB-Text CDB-Size-medium u-secondaryTextColor">'+(null==(__t=error)?"":__t)+'</h3>\n  </div>\n\n  <div class="Modal-body">\n    <div class="Modal-body-inner">\n\n      <div class="js-footer">\n        <ul class="Modal-actions is-narrow">\n          <li class="Modal-actions-button">\n            <button class="CDB-Button CDB-Button--primary js-back">\n              <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.maps-metadata.back-btn"))?"":_.escape(__t))+"</span>\n            </button>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],415:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("underscore"),g=a("../../../data/vis-metadata-model"),h=a("./map-metadata.tpl"),i=a("./footer/footer-view"),j=a("./map-metadata-error.tpl"),k=a("../../loading/render-loading"),l=a("./form/form-view"),m=a("./save-metadata-map"),n=a("../../../helpers/error-parser"),o=a("../../../components/notifier/notifier"),p=a("../../../helpers/utils");b.exports=e.extend({events:{"click .js-back":"_onBackFromError"},className:"Dialog-content Dialog-content--expanded",initialize:function(a){if(!a.modalModel)throw new TypeError("modalModel is required");if(!a.visDefinitionModel)throw new TypeError("visDefinitionModel is required");this._modalModel=a.modalModel,this._visDefinitionModel=a.visDefinitionModel,this._visMetadataModel=new g({name:this._visDefinitionModel.get("name"),description:this._visDefinitionModel.get("description"),tags:this._visDefinitionModel.get("tags")}),this._stateModel=new d.Model({status:"show"}),this._initBinds()},render:function(){return this.clearSubViews(),this._hasError()?this._renderError():this._isLoading()?this._renderLoading():(this.$el.html(h()),this._initViews()),this},_initViews:function(){var a=new l({visDefinitionModel:this._visDefinitionModel,visMetadataModel:this._visMetadataModel});this.$(".js-content").append(a.render().el),this.addView(a);var b=new i({visMetadataModel:this._visMetadataModel,onSaveAction:this._onSave.bind(this)});this.$(".js-footer").append(b.render().el),this.addView(b)},_renderError:function(){var a=this._stateModel.get("error");this.$el.html(j({error:_t("components.modals.maps-metadata.error.subtitle",{error:a})}))},_renderLoading:function(){this.$el.html(k({title:_t("components.modals.maps-metadata.loading")}))},_initBinds:function(){this._stateModel.on("change:status",this.render,this),this.add_related_model(this._stateModel)},_hasError:function(){return"error"===this._stateModel.get("status")},_isLoading:function(){return"loading"===this._stateModel.get("status")},_onSave:function(){this._stateModel.set({status:"loading"}),m({onSuccess:this._onSuccessSave.bind(this),onError:this._onErrorSave.bind(this),visDefinitionModel:this._visDefinitionModel,name:this._getMetadataName(),description:this._getMetadataDescription(),tags:this._getMetadataTags()})},_onSuccessSave:function(){var a=this;o.addNotification({status:"success",info:_t("components.modals.maps-metadata.success",{name:a._getMetadataName()}),closable:!0,delay:o.DEFAULT_DELAY}),this._modalModel.destroy()},_onErrorSave:function(a){this._stateModel.set({status:"error",error:n(a)})},_onBackFromError:function(){this._stateModel.set({status:"show"})},_getMetadataName:function(){return p.sanitizeHtml(this._visMetadataModel.get("name"))},_getMetadataDescription:function(){return p.sanitizeHtml(this._visMetadataModel.get("description"))},_getMetadataTags:function(){return f.map(this._visMetadataModel.get("tags"),function(a){return p.sanitizeHtml(a)})}})},{"../../../components/notifier/notifier":475,"../../../data/vis-metadata-model":676,"../../../helpers/error-parser":1090,"../../../helpers/utils":1102,"../../loading/render-loading":230,"./footer/footer-view":410,"./form/form-view":412,"./map-metadata-error.tpl":414,"./map-metadata.tpl":416,"./save-metadata-map":417,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],416:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="25px" height="25px" viewBox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <path d="M16,13 L17,13 L17,5.5 C17,5.433 16.986,5.368 16.961,5.308 C16.936,5.247 16.899,5.192 16.853,5.146 L11.854,0.147 C11.808,0.101 11.753,0.064 11.692,0.039 C11.632,0.014 11.567,0 11.5,0 L0.5,0 C0.224,0 0,0.224 0,0.5 L0,21.5 C0,21.776 0.224,22 0.5,22 L9.5,22 L9.5,21 L1,21 L1,1 L11,1 L11,5.5 C11,5.776 11.224,6 11.5,6 L16,6 L16,13 L16,13 Z M12,1.707 L15.293,5 L12,5 L12,1.707 L12,1.707 Z" id="Shape" fill="#2E3C43"></path>\n              <path d="M23.854,14.646 L21.354,12.146 C21.166,11.958 20.834,11.958 20.647,12.146 L13.146,19.648 C13.089,19.705 13.054,19.773 13.03,19.845 C13.028,19.852 13.021,19.857 13.019,19.865 L12.019,23.365 C11.969,23.539 12.018,23.727 12.146,23.856 C12.241,23.951 12.369,24.002 12.5,24.002 C12.546,24.002 12.592,23.996 12.637,23.983 L16.137,22.983 C16.144,22.981 16.149,22.974 16.157,22.972 C16.229,22.948 16.297,22.913 16.354,22.856 L23.855,15.354 C24.05,15.158 24.05,14.842 23.854,14.646 L23.854,14.646 Z M16,21.795 L14.207,20.002 L19.001,15.207 L20.794,17 L16,21.795 L16,21.795 Z M13.747,20.957 L15.045,22.255 L13.228,22.775 L13.747,20.957 L13.747,20.957 Z M21.501,16.293 L19.708,14.5 L21.001,13.207 L22.794,15 L21.501,16.293 L21.501,16.293 Z" id="Shape" fill="#2E3C43"></path>\n          </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("components.modals.maps-metadata.modal-title"))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">\n        '+(null==(__t=_t("components.modals.maps-metadata.modal-desc"))?"":_.escape(__t))+'\n      </p>\n      <div class="Modal-listTextItem js-content"></div>\n      <div class="js-footer"></div>\n    </div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],417:[function(a,b,c){var d=a("../visualization-title-suffix-metadata");b.exports=function(a){if(!a.visDefinitionModel)throw new Error("visDefinitionModel is required");if(!a.name)throw new Error("name is required");var b=a.visDefinitionModel,c=a.onSuccess,e=a.onError,f=a.name,g=a.description,h=a.tags,i=b.get("name");b.save({name:f,description:g,tags:h},{wait:!0,success:function(a,b){document.title=f+d,c&&c()},error:function(a,b){document.title=i+d,e&&e(b)}})}},{"../visualization-title-suffix-metadata":456}],418:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=d.Model.extend({defaults:{show:!0,createContentView:function(){return new e}},createContentView:function(){return this.get("createContentView")(this)},show:function(){this.set("show",!0)},hide:function(){this.set("show",!1)},isHidden:function(){return!this.get("show")},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone","backbone/core-view":1127}],419:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./modal.tpl"),g=120;b.exports=e.extend({className:function(){return this.options.escapeOptionsDisabled?"Dialog is-white":"Dialog is-opening is-white"},events:{"click .js-close":"_onClose"},initialize:function(){
this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy),this._escapeOptionsDisabled=this.options.escapeOptionsDisabled},render:function(){this.clearSubViews(),this.$el.html(f({escapeOptionsDisabled:this.options.escapeOptionsDisabled||!1}));var a=this.model.createContentView();return this.addView(a),a.render(),this.$(".js-content").append(a.el),this},show:function(){this.model.show()},hide:function(){this.model.hide()},destroy:function(){this.model.destroy()},_onShowChange:function(a,b){b?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this._delayDueToAnimation(function(){this.$el.hide()}))},_onClose:function(a){a.stopPropagation(),this.destroy()},_onDestroy:function(){this.hide(),d.invoke(this._subviews,"allOff"),this._delayDueToAnimation(function(){this.clean()})},_delayDueToAnimation:function(a){setTimeout(a.bind(this),g)}})},{"./modal.tpl":420,"backbone/core-view":1127,underscore:"underscore"}],420:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",escapeOptionsDisabled||(__p+='\n  <button class="CDB-Shape js-close Dialog-closeBtn">\n    <div class="CDB-Shape-close is-blue is-huge"></div>\n  </button>\n'),__p+='\n<div class="Dialog-contentWrapper js-content"></div>\n';return __p}},{underscore:"underscore"}],421:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./modal-view"),g=a("./modal-view-model"),h="destroyedModal";b.exports=e.Model.extend({create:function(a,b){if(!d.isFunction(a))throw new Error("createContentView is required");return b&&(this._escapeOptionsDisabled=b),this._modalView||(this.trigger("willCreateModal"),this._modalView=this._newModalView(),this.trigger("didCreateModal",this._modalView),document.body.appendChild(this._modalView.el)),this._modalView.model.set("createContentView",a),this._modalView.render(),this._modalView},onDestroyOnce:function(a,b){this.once(h,a,b)},destroy:function(){this._modalView&&this._modalView.model.destroy()},_newModalView:function(){var a=this,b=new g;return this._handleBodyClass(b),this._escapeOptionsDisabled||this._destroyOnEsc(b),this.listenToOnce(b,"destroy",function(){this._modalView=null,this.trigger.apply(this,[h].concat(Array.prototype.slice.call(arguments))),this.stopListening(b)}),new f({model:b,escapeOptionsDisabled:a._escapeOptionsDisabled})},_destroyOnEsc:function(a){var b=function(b){27===b.keyCode&&(b.stopPropagation(),a.destroy())};document.addEventListener("keydown",b),this.listenToOnce(a,"destroy",function(){document.removeEventListener("keydown",b)})},_handleBodyClass:function(a){var b="is-inDialog";document.body.classList.add(b),this.set("open",!0),this.listenTo(a,"change:show",function(a,c){document.body.classList[c?"add":"remove"](b),this.set("open",c)}),this.listenToOnce(a,"destroy",function(){document.body.classList.remove(b),this.set("open",!1)})},isOpen:function(){return this.get("open")===!0}})},{"./modal-view":419,"./modal-view-model":418,backbone:"backbone",underscore:"underscore"}],422:[function(a,b,c){var d=a("underscore"),e=[{privacy:"PUBLIC",title:_t("components.modals.publish.privacy.public.title"),desc:_t("components.modals.publish.privacy.public.body"),alwaysEnabled:!0,cssClass:"green"},{privacy:"LINK",title:_t("components.modals.publish.privacy.link.title"),desc:_t("components.modals.publish.privacy.link.body"),cssClass:"orange"},{privacy:"PASSWORD",title:_t("components.modals.publish.privacy.password.title"),desc:_t("components.modals.publish.privacy.password.body"),cssClass:"orange-dark"},{privacy:"PRIVATE",title:_t("components.modals.publish.privacy.private.title"),desc:_t("components.modals.publish.privacy.private.body"),cssClass:"red"}];b.exports=function(a,b){var c=a.isVisualization(),f=b.get("actions"),g=f[c?"private_maps":"private_tables"],h=a.get("privacy"),i=a.privacyOptions();return d.chain(e).filter(function(a){return d.contains(i,a.privacy)}).map(function(a){return d.defaults({selected:a.privacy===h,disabled:!(a.alwaysEnabled||g)},a)}).value()}},{underscore:"underscore"}],423:[function(a,b,c){var d=a("backbone"),e=a("./privacy-model"),f=a("./privacy-password-model");b.exports=d.Collection.extend({model:function(a,b){return"PASSWORD"===a.privacy?new f(a,b):new e(a,b)},initialize:function(){this.bind("change:selected",this._deselectLastSelected,this)},searchByPrivacy:function(a){return this.findWhere({privacy:a})},selectedOption:function(){return this.find(function(a){return a.get("selected")})},passwordOption:function(){return this.find(function(a){return"PASSWORD"===a.get("privacy")})},_deselectLastSelected:function(a,b){b&&this.each(function(b){b!==a&&b.set({selected:!1})})}})},{"./privacy-model":424,"./privacy-password-model":425,backbone:"backbone"}],424:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{privacy:"PUBLIC",disabled:!1,selected:!1,password:void 0},validate:function(a){if(a.disabled&&a.selected)return"Option can not be disabled and selected at the same time"},classNames:function(){return e.chain(["disabled","selected"]).map(function(a){return void 0!==this.attributes[a]?"is-"+a:void 0},this).compact().value().join(" ")},canSave:function(){return!this.get("disabled")},isPassword:function(){return!1},isSelected:function(){return this.get("selected")===!0},saveToVis:function(a,b){return a.save(this._attrsToSave(),e.extend({wait:!0},b))},_attrsToSave:function(){return e.pick(this.attributes,"privacy","password")}})},{backbone:"backbone",underscore:"underscore"}],425:[function(a,b,c){var d=a("underscore"),e=a("./privacy-model"),f="!@#!@#";b.exports=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.set("password",f)},_attrsToSave:function(){var a=e.prototype._attrsToSave.call(this);return a.password===f&&delete a.password,a},canSave:function(){return!this.get("disabled")&&!d.isEmpty(this.get("password"))},isPassword:function(){return!0}})},{"./privacy-model":424,underscore:"underscore"}],426:[function(a,b,c){var d=a("jquery"),e=a("moment"),f=a("backbone"),g=a("backbone/core-view"),h=a("underscore"),i=a("./publish-button.tpl"),j=["visDefinitionModel","mapcapsCollection","configModel"];b.exports=g.extend({events:{"click .js-button":"_onUpdate"},initialize:function(a){h.each(j,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this.model=new f.Model({status:"idle"}),this._initBinds()},render:function(){var a=this._mapcapsCollection.length>0?_t("components.modals.publish.share.last-published",{date:"updated"===this.model.get("status")?e(this._mapcapsCollection.first().get("created_at")).fromNow():e(this._mapcapsCollection.first().get("created_at")).format("Do MMMM YYYY, HH:mm")}):_t("components.modals.publish.share.unpublished");return this.clearSubViews(),this.$el.html(i({isPublished:this._mapcapsCollection.length>0,isLoading:this._isLoading(),isDisabled:this._isDisabled(),publishedOn:a})),this},_initBinds:function(){this._mapcapsCollection.on("reset",this.render,this),this.add_related_model(this._mapcapsCollection),this.model.on("change:status",this.render,this)},_isLoading:function(){return"loading"===this.model.get("status")},_isDisabled:function(){return"updated"===this.model.get("status")},_onUpdate:function(){var a=this,b=this._visDefinitionModel.mapcapsURL(),c={api_key:this._configModel.get("api_key")};return!this._isDisabled()&&(a.model.set({status:"loading"}),void d.post(b,c).done(function(b){a._visDefinitionModel.set("visChanges",0),a._mapcapsCollection.add(b,{at:0}),a.model.set({status:"updated"})}).fail(function(){a.model.set({status:"error"})}))}})},{"./publish-button.tpl":427,backbone:"backbone","backbone/core-view":1127,jquery:"jquery",moment:"moment",underscore:"underscore"}],427:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="Publish-modalButton CDB-Button CDB-Button--primary CDB-Button--small u-rSpace js-button ',isDisabled&&(__p+="is-disabled"),__p+='">\n  <div class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase u-flex">\n    ',isLoading?(__p+='\n      <div class="CDB-LoaderIcon CDB-LoaderIcon--small u-iBlock">\n        <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n          <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n        </svg>\n      </div>\n      ',__p+=isPublished?"\n      "+(null==(__t=_t("components.modals.publish.updating-btn"))?"":_.escape(__t))+"\n      ":"\n      "+(null==(__t=_t("components.modals.publish.publishing-btn"))?"":_.escape(__t))+"\n      ",__p+="\n    "):(__p+="\n      ",__p+=isPublished?"\n      "+(null==(__t=_t("components.modals.publish.update-btn"))?"":_.escape(__t))+"\n      ":"\n      "+(null==(__t=_t("components.modals.publish.publish-btn"))?"":_.escape(__t))+"\n      ",__p+="\n    "),__p+="\n  </div>\n</button> "+(null==(__t=publishedOn)?"":_.escape(__t));return __p}},{underscore:"underscore"}],428:[function(a,b,c){var d=a("underscore"),e=a("moment"),f=a("backbone/core-view"),g=a("./publish.tpl"),h=a("./tab-pane-submenu.tpl"),i=a("../../tab-pane/create-text-labels-tab-pane"),j=a("./publish/publish-view"),k=a("./share/share-view"),l=a("../../privacy-dropdown/privacy-dropdown-view"),m=a("./publish-button-view"),n=a("./share-with-view"),o=a("./upgrade-view"),p=["modalModel","visDefinitionModel","privacyCollection","userModel","configModel"],q="full",r="share",s="publish";b.exports=f.extend({className:"Publish-modal",events:{"click .js-done":"_onDone"},initialize:function(a){d.each(p,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._mapcapsCollection=a.mapcapsCollection,this.mode=a.mode||q},render:function(){return this.clearSubViews(),this.$el.html(g({name:this._visDefinitionModel.get("name"),isSimple:!this._hasTabs(),hasShareStats:this._hasShareStats()})),this._initViews(),this.mode===q?this._hasOrganization()?this._initTabsViews():this._makePublishView():this.mode===r?this._makeShareView():this.mode===s&&this._makePublishView(),this},_hasShareStats:function(){return this.mode!==s&&this._hasOrganization()},_hasOrganization:function(){return this._userModel.isInsideOrg()},_hasTabs:function(){var a=this._hasOrganization();return a&&this.mode===q},_makePublishView:function(){var a=this._createPublishView();this.$(".js-panes").append(a.render().el),this.addView(a)},_makeShareView:function(){var a=this._createShareView();this.$(".js-panes").append(a.render().el),this.addView(a)},_initViews:function(){var a,b,c,d,f;a=new l({privacyCollection:this._privacyCollection,visDefinitionModel:this._visDefinitionModel,userModel:this._userModel,configModel:this._configModel}),this.$(".js-dropdown").append(a.render().el),this.addView(a),void 0!==this._mapcapsCollection?(b=new m({visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,configModel:this._configModel}),this.$(".js-update").append(b.render().el),this.addView(b)):(f=_t("components.modals.publish.share.last-published",{date:e(this._visDefinitionModel.get("updated_at")).format("Do MMMM YYYY, HH:mm")}),this.$(".js-update").html(f)),this._hasShareStats()&&(c=new n({visDefinitionModel:this._visDefinitionModel,userModel:this._userModel,avatarClass:"Share-user--big",separationClass:"u-rSpace--xl"}),this.$(".js-share-users").append(c.render().el),this.addView(c)),this._hasOrganization()||(d=new o,this.$(".js-upgrade").append(d.render().el),this.addView(d))},_initTabsViews:function(){var a=this,b=[{name:"share",label:_t("components.modals.publish.menu.share"),createContentView:a._createShareView.bind(a)},{name:"publish",label:_t("components.modals.publish.menu.publish"),createContentView:a._createPublishView.bind(a)}],c={tabPaneOptions:{template:h,tabPaneItemOptions:{tagName:"li",className:"CDB-NavSubmenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavSubmenu-link u-upperCase Publish-modalLink"}};this._layerTabPaneView=i(b,c),this.$(".js-panes").append(this._layerTabPaneView.render().$el),this.addView(this._layerTabPaneView)},_createShareView:function(){return new k({className:"Share-wrapper",currentUserId:this._userModel.id,visDefinitionModel:this._visDefinitionModel,organization:this._userModel._organizationModel,configModel:this._configModel})},_createPublishView:function(){return new j({visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,userModel:this._userModel})},_onDone:function(){this._modalModel.destroy()}})},{"../../privacy-dropdown/privacy-dropdown-view":527,"../../tab-pane/create-text-labels-tab-pane":537,"./publish-button-view":426,"./publish.tpl":429,"./publish/publish-view":433,"./share-with-view":439,"./share/share-view":444,"./tab-pane-submenu.tpl":450,"./upgrade-view":451,"backbone/core-view":1127,moment:"moment",underscore:"underscore"}],429:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Publish-modalHeader">\n  <div class="u-inner">\n    <div class="CDB-Text CDB-Size-huge is-light u-ellipsis u-bSpace--m">'+(null==(__t=name)?"":_.escape(__t))+'</div>\n    <ul class="u-flex u-alignCenter">\n      <li class="js-dropdown u-rSpace--xl"></li>\n      ',hasShareStats&&(__p+='\n      <li class="js-share-users">\n      </li>\n      '),__p+='\n      <li class="CDB-Text CDB-Size-medium u-altTextColor js-update">\n      </li>\n  </div>\n</div>\n\n<div class="Publish-modalBody js-panes\n',isSimple&&(__p+="is-simple"),__p+='\n">\n  ',isSimple&&(__p+='\n    <div class="Publish-modalShadow"></div>\n  '),__p+='\n\n</div>\n\n<div class="Dialog-footer Dialog-footer--expanded CreateDialog-footer Publish-modalFooter">\n  <div>\n    <div class="CreateDialog-footerShadow"></div>\n    <div class="CreateDialog-footerLine"></div>\n    <div class="CreateDialog-footerInner ">\n      <div class="CreateDialog-footerInfo"></div>\n      <div class="CreateDialog-footerActions js-footerActions u-flex u-justifySpace u-grow">\n        <div class="js-upgrade"></div>\n        <button class="CDB-Button CDB-Button--secondary js-done">\n          <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.publish.done-btn"))?"":_.escape(__t))+"</span>\n        </button>\n      </div>\n    </div>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],430:[function(a,b,c){var d=a("./icon-link.tpl"),e=a("./icon-embed.tpl");b.exports=function(a){return[{createIcon:function(){return d()},type:"get-link",content:a.embedURL(),private:"PRIVATE"===a.get("privacy")},{createIcon:function(){return e()},type:"embed",content:'<iframe width="100%" height="520" frameborder="0" src="'+encodeURI(a.embedURL())+'" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>',url:encodeURI(a.embedURL()),private:"PRIVATE"===a.get("privacy")}]}},{"./icon-embed.tpl":431,"./icon-link.tpl":432}],431:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<svg width="25px" height="25px" viewBox="682 469 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <path d="M697.141667,478.48556 C695.774797,477.117815 695.774797,474.90231 697.141553,473.535553 L697.495051,473.182056 L697.141609,472.828502 L693.960609,469.646502 L693.607124,469.292907 L693.253515,469.646378 L690.685515,472.213378 L691.039,472.567 L691.469343,472.312431 C691.271611,471.978171 691.043454,471.678347 690.778553,471.413447 C689.020272,469.655166 686.171603,469.655166 684.414333,471.41356 C682.657184,473.170709 682.657184,476.020291 684.414447,477.777553 C684.682252,478.044267 684.982655,478.273359 685.314094,478.468734 L685.568,478.038 L685.214447,477.684447 L682.646447,480.252447 L682.292893,480.606 L682.646447,480.959553 L685.828447,484.141553 L686.181887,484.494994 L686.53544,484.141667 C687.903185,482.774797 690.11869,482.774797 691.485447,484.141553 C692.852184,485.508291 692.852184,487.724709 691.485447,489.091447 L691.131893,489.445 L691.485447,489.798553 L694.667447,492.980553 L695.021,493.334107 L695.374553,492.980553 L697.941553,490.413553 L697.588,490.06 L697.157928,490.315025 C697.3561,490.649221 697.584149,490.948256 697.849447,491.213553 C699.60664,492.971872 702.456485,492.971872 704.21278,491.213327 C705.970872,489.45636 705.970872,486.606515 704.212327,484.85022 C703.948015,484.584823 703.647051,484.355236 703.312906,484.158266 L703.059,484.589 L703.412553,484.942553 L705.979553,482.375553 L706.333107,482.022 L705.979553,481.668447 L702.797553,478.486447 L702.444,478.132893 L702.090447,478.486447 C700.725536,479.851357 698.508943,479.851087 697.141327,478.48522 L697.141667,478.48556 Z M696.434673,479.19278 C698.192747,480.948604 701.042155,480.948952 702.797553,479.193553 L702.090447,479.193553 L705.272447,482.375553 L705.272447,481.668447 L702.705447,484.235447 L702.248976,484.691917 L702.805094,485.019734 C703.068228,485.174844 703.301587,485.35286 703.504724,485.55683 C704.873128,486.923485 704.873128,489.13964 703.50556,490.506333 C702.139515,491.874128 699.92336,491.874128 698.556667,490.50656 C698.35252,490.302414 698.175052,490.069704 698.018072,489.804975 L697.689693,489.2512 L697.234447,489.706447 L694.667447,492.273447 L695.374553,492.273447 L692.192553,489.091447 L692.192553,489.798553 C693.949816,488.041291 693.949816,485.191709 692.192553,483.434447 C690.43531,481.677203 687.586815,481.677203 685.82856,483.434333 L686.535553,483.434447 L683.353553,480.252447 L683.353553,480.959553 L685.921553,478.391553 L686.378024,477.935083 L685.821906,477.607266 C685.560783,477.453341 685.327004,477.275057 685.12083,477.069724 C683.754816,475.703709 683.754816,473.487291 685.121553,472.120553 C686.488397,470.752834 688.703728,470.752834 690.071447,472.120553 C690.274695,472.323801 690.452152,472.557 690.608657,472.821569 L690.936742,473.376188 L691.392485,472.920622 L693.960485,470.353622 L693.253391,470.353498 L696.434391,473.535498 L696.434447,472.828447 C694.677203,474.58569 694.677203,477.434185 696.434333,479.19244 L696.434673,479.19278 Z" id="Embed-it" stroke="none" fill="#AAAAAA" fill-rule="evenodd"></path>\n</svg>';return __p}},{underscore:"underscore"}],432:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='  <svg width="23px" height="23px" viewBox="683 470 23 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <path d="M696.399947,482.106803 L696.485947,482.192803 C697.462209,483.169066 699.044791,483.169066 700.021053,482.192803 L703.986009,478.228848 C705.34724,476.86645 705.34724,474.642218 703.986356,473.279 L702.227953,471.521596 C700.866908,470.159384 698.640092,470.159384 697.278795,471.521848 L693.313991,475.485652 C692.337722,476.461921 692.337722,478.044329 693.31372,479.021577 L693.40202,479.108865 L694.10498,478.397635 L694.01898,478.312635 C693.435278,477.728171 693.435278,476.778579 694.021053,476.192803 L697.986009,472.228848 C698.956908,471.257116 700.550092,471.257116 701.520795,472.228652 L703.279047,473.985904 C704.24976,474.958282 704.24976,476.55005 703.278795,477.521848 L699.313991,481.485652 C698.728209,482.071434 697.778791,482.071434 697.193053,481.485697 L697.107053,481.399697 L696.399947,482.106803 L696.399947,482.106803 Z M692.10498,480.397635 L692.01898,480.312635 C691.044791,479.338434 689.462209,479.338434 688.485947,480.314697 L684.520991,484.278652 C683.159735,485.641076 683.159735,487.866424 684.520795,489.228652 L686.279047,490.985904 C687.640092,492.348116 689.866908,492.348116 691.228205,490.985652 L695.193009,487.021848 C696.169278,486.045579 696.169278,484.463171 695.19328,483.485923 L695.107053,483.399697 L694.399947,484.106803 L694.485947,484.192803 C695.071722,484.779329 695.071722,485.728921 694.485947,486.314697 L690.520991,490.278652 C689.550092,491.250384 687.956908,491.250384 686.986205,490.278848 L685.227953,488.521596 C684.257265,487.550076 684.257265,485.957424 685.228205,484.985652 L689.193009,481.021848 C689.778791,480.436066 690.728209,480.436066 691.313947,481.021803 L691.40202,481.108865 L692.10498,480.397635 L692.10498,480.397635 Z M690.718053,485.495803 L698.496053,477.717803 L697.788947,477.010697 L690.010947,484.788697 L690.718053,485.495803 L690.718053,485.495803 Z" id="Get-link" stroke="none" fill="#AAAAAA" fill-rule="evenodd"></path>\n  </svg>';return __p}},{underscore:"underscore"}],433:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./create-share-options"),g=a("./share-collection"),h=a("./share-item-view"),i=a("./publish.tpl"),j=["visDefinitionModel","mapcapsCollection","userModel"];b.exports=e.extend({className:"Publish-modalShare u-inner",initialize:function(a){d.each(j,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this.hasOrganization=this._userModel.isInsideOrg();var b=f(this._visDefinitionModel);this._shareCollection=new g(b),this._initBinds()},render:function(){var a=this._mapcapsCollection.length>0;return this.clearSubViews(),this.$el.html(i({isPublished:a})),this._initViews(),this},_initViews:function(){var a=this._renderItemView.bind(this);this._shareCollection.each(a)},_renderItemView:function(a){var b=this,c=this._mapcapsCollection.length>0,d=new h({model:a,isPublished:c,hasOrganization:b.hasOrganization});this.$(".js-list").append(d.render().el),this.addView(d)},_revampPrivacyOptions:function(){var a=f(this._visDefinitionModel);this._shareCollection.reset(a)},_initBinds:function(){this._visDefinitionModel.on("sync",this._revampPrivacyOptions,this),this.add_related_model(this._visDefinitionModel),this._shareCollection.on("reset",this.render,this),this.add_related_model(this._shareCollection),this._mapcapsCollection.on("reset add",this.render,this),this.add_related_model(this._mapcapsCollection)}})},{"./create-share-options":430,"./publish.tpl":434,"./share-collection":435,"./share-item-view":436,"backbone/core-view":1127,underscore:"underscore"}],434:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Publish-optionsList u-flex u-justifySpace js-list"></ul>\n',isPublished||(__p+='\n<div class="Share-info">\n  <div>\n    <h2 class="CDB-Text CDB-Size-large u-secondaryTextColor u-bSpace is-light">'+(null==(__t=_t("components.modals.publish.share.unpublished-header"))?"":_.escape(__t))+'</h2>\n    <p class="CDB-Text CDB-Size-medium is-light">'+(null==(__t=_t("components.modals.publish.share.unpublished-subheader"))?"":_.escape(__t))+"</p>\n  </div>\n</div>\n"),__p+="\n";return __p}},{underscore:"underscore"}],435:[function(a,b,c){var d=a("backbone"),e=a("./share-model");b.exports=d.Collection.extend({model:e})},{"./share-model":438,backbone:"backbone"}],436:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("clipboard"),g=a("./share-item.tpl"),h=a("../../../../helpers/browser-detect"),i=d.template("<span class='CDB-Text CDB-Size-small is-semibold u-errorTextColor'><%- private %></span>.<br>")({private:_t("components.modals.publish.share.private")});b.exports=e.extend({className:"Card",tagName:"li",events:{"click .js-change-privacy":"_onChangePrivacyClick"},initialize:function(a){if(!a.model)throw new Error("model is required");if(null==a.isPublished)throw new Error("isPublished is required");this._isPublished=a.isPublished,this._type=this.model.type(),this._hasOrganization=a.hasOrganization,this._title=_t("components.modals.publish.share."+this._type+".title"),this.model.isPrivate()?this._body=_t("components.modals.publish.share."+this._type+".private.body",{private:i}):this._body=_t("components.modals.publish.share."+this._type+".body"),this._link=_t("components.modals.publish.share."+this._type+".link"),this._copy=this._getButtonLabel(),this.$el.toggleClass("is-disabled",this.model.isPrivate())},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),!this.model.isPrivate()&&this._isPublished&&this._initClipboard(),this},_getButtonLabel:function(){var a=h(),b=_t("components.modals.publish.share."+this._type+".copy");return"Safari"===a.name&&(b=_t("components.modals.publish.share."+this._type+".select")),b},getValue:function(){return this.$(".js-input").val()},_initViews:function(){var a=g({id:this.cid,isPrivate:this.model.isPrivate(),type:this._type,title:this._title,body:this._body,content:this.model.content(),link:this._link,copy:this._copy,url:this.model.url(),isPublished:this._isPublished});this.$el.append(a);var b=this.model.createIcon();this.$(".js-icon").append(b())},_initClipboard:function(){this._clipboard&&this._clipboard.destroy();var a=this.$(".js-copy");this._clipboard=new f(a.get(0))},_onChangePrivacyClick:function(a){this.killEvent(a),this.options.onChangePrivacy&&this.options.onChangePrivacy()},clean:function(){this._clipboard&&this._clipboard.destroy(),e.prototype.clean.call(this)}})},{"../../../../helpers/browser-detect":1088,"./share-item.tpl":437,"backbone/core-view":1127,clipboard:"clipboard",underscore:"underscore"}],437:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Card-icon u-bSpace--xl js-icon"></div>\n\n<div class="Card-body u-bSpace--xl">\n  ',__p+=isPrivate?'\n    <h3 class="CDB-Text CDB-Size-large u-altTextColor u-bSpace--m">'+(null==(__t=title)?"":_.escape(__t))+"</h3>\n  ":'\n    <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-bSpace--m">'+(null==(__t=title)?"":_.escape(__t))+"</h3>\n  ",__p+='\n  <div class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=body)?"":__t)+"\n    <br/>\n    ",url&&!isPrivate&&(__p+='\n    <a href="'+(null==(__t=url)?"":_.escape(__t))+'" class="Share-link js-link">'+(null==(__t=link)?"":_.escape(__t))+"</a>\n    "),__p+="\n  </div>\n</div>\n\n",!isPrivate&&isPublished&&(__p+='\n  <div class="Share-input">\n    <input type="text" id="'+(null==(__t=id)?"":_.escape(__t))+'" value="'+(null==(__t=content)?"":_.escape(__t))+'" class="Share-input-field CDB-InputText is-disabled CDB-Text CDB-Size-medium u-ellipsis js-input" readonly>\n    <button class="Share-copy CDB-Button CDB-Button--small js-copy" data-clipboard-target="#'+(null==(__t=id)?"":_.escape(__t))+'">\n      <span class="CDB-Button-Text CDB-Text CDB-Size-small u-actionTextColor">'+(null==(__t=copy)?"":_.escape(__t))+"</span>\n    </button>\n  </div>\n"),__p+="\n";return __p}},{underscore:"underscore"}],438:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({createIcon:function(){return this.get("createIcon")},type:function(){return this.get("type")},content:function(){return this.get("content")},url:function(){return this.get("url")},isPrivate:function(){return this.get("private")}})},{backbone:"backbone"}],439:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./share-with.tpl"),g=["visDefinitionModel","userModel"];b.exports=d.extend({className:"Share-with u-flex u-alignCenter",events:{"click .js-action":"_onAction"},initialize:function(a){e.each(g,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this.separationClass=a.separationClass||"",this.avatarClass=a.avatarClass||"",this._acl=this._visDefinitionModel._permissionModel.acl,this._initBinds()},render:function(){var a=this._getPeople(),b=void 0!==this.options.action&&this._hasOrganization();return this.clearSubViews(),this.$el.html(f({avatar:this._userModel.get("avatar_url"),people:a,avatarClass:this.avatarClass,separationClass:this.separationClass,hasAction:b})),this},_getPeople:function(){var a=this._acl.pluck("type");if(a.indexOf("org")>-1)return this._userModel.getOrganization().get("user_count")-1;var b=[];return e.each(this._acl.where({type:"group"}),function(a){var c=a.get("entity");Array.prototype.push.apply(b,c.users.pluck("id"))},this),e.each(this._acl.where({type:"user"}),function(a){var c=a.get("entity");b.push(c.get("id"))},this),b=e.without(b,this._userModel.id),e.unique(b).length},_hasOrganization:function(){return this._userModel.isInsideOrg()},_initBinds:function(){this._acl.on("fetch",this.render,this),this.add_related_model(this._acl)},_onAction:function(){this.options.action&&this.options.action()}})},{"./share-with.tpl":440,"backbone/core-view":1127,underscore:"underscore"}],440:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",people>0?__p+='\n<div class="Share-user '+(null==(__t=avatarClass)?"":_.escape(__t))+' u-rSpace u-iBlock" style="background-image: url('+(null==(__t=avatar)?"":_.escape(__t))+')"></div>\n<span class="u-secondaryTextColor CDB-Text CDB-Size-small '+(null==(__t=separationClass)?"":_.escape(__t))+'">+ '+(null==(__t=people)?"":_.escape(__t))+"</span>\n":(__p+="\n  ",hasAction&&(__p+='\n  <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor js-action '+(null==(__t=separationClass)?"":_.escape(__t))+'">'+(null==(__t=_t("components.modals.publish.share.add-people"))?"":_.escape(__t))+"</button>\n  "),__p+="\n"),__p+="\n";return __p}},{underscore:"underscore"}],441:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./share-permission-view"),g=["collection","currentUserId","organization","hasOrganization","sharePermissionModel","isVisualization"];b.exports=d.extend({className:"Share-list",initialize:function(a){e.each(g,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._sortedCollection=this._sortCollection(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this._sharePermissionModel.acl.on("add remove reset change",this.render,this),this.add_related_model(this._sharePermissionModel)},_initViews:function(){this._hasOrganization&&this._renderOrganization(),e.each(this._sortedCollection,this._renderItem,this)},_sortCollection:function(){var a=this._collection.filter(function(a){var b=this._sharePermissionModel,c=b.hasWriteAccess(a),d=b.hasReadAccess(a);return c||d},this),b=this._collection.filter(function(a){var b=this._sharePermissionModel,c=b.hasWriteAccess(a),d=b.hasReadAccess(a);return!c&&!d},this);return a.concat(b)},_renderOrganization:function(){var a=this,b=this._organization,c=this._sharePermissionModel,d=!a._isVisualization,e=c.canChangeWriteAccess(b),g=c.hasWriteAccess(b),h=c.canChangeReadAccess(b),i=c.hasReadAccess(b),j=new f({model:b,permission:c,avatar:b.get("avatar_url"),description:_t("components.modals.publish.share.organization.desc"),name:_t("components.modals.publish.share.organization.title"),canChangeReadAccess:h,hasReadAccess:i,hasWriteAccessAvailable:d,canChangeWriteAccess:e,hasWriteAccess:g,isSelected:i||g});this.$el.append(j.render().$el),this.addView(j)},_renderItem:function(a){var b,c=this,d=a.get("model"),e=this._sharePermissionModel,g=!c._isVisualization,h=e.canChangeWriteAccess(a),i=e.hasWriteAccess(a),j=e.canChangeReadAccess(a),k=e.hasReadAccess(a),l=this._getRole(d);a.id!==this._currentUserId&&(b=new f({model:a,permission:e,name:a.get("name"),avatar:a.get("avatar_url"),
role:l,users:d.users,canChangeReadAccess:j,hasReadAccess:k,hasWriteAccessAvailable:g,canChangeWriteAccess:h,hasWriteAccess:i,isSelected:k||i}),this.$el.append(b.render().$el),this.addView(b))},_getRole:function(a){return void 0!==a.viewer&&(a.viewer===!0?_t("components.modals.publish.share.role.viewer"):_t("components.modals.publish.share.role.builder"))}})},{"./share-permission-view":442,"backbone/core-view":1127,underscore:"underscore"}],442:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./share-permission.tpl"),g=a("../../../tipsy-tooltip-view.js"),h=a("jquery"),i=a("./users-group-view"),j=["model","permission","name","canChangeReadAccess","hasReadAccess","hasWriteAccessAvailable","canChangeWriteAccess","hasWriteAccess","isSelected"],k=["description","role","avatar","users"];b.exports=e.extend({className:"Share-permission",events:{"change .js-read":"_onChangeRead","change .js-write":"_onChangeWrite","mouseover .js-toggler.is-disabled":"_onHoverDisabledToggler","mouseout .js-toggler":"_destroyTooltip","mouseleave .js-toggler":"_destroyTooltip"},initialize:function(a){d.each(j,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),d.each(k,function(b){this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(f({name:this._name,avatar:this._avatar,role:this._role,users:this._users,description:this._description,canChangeReadAccess:this._canChangeReadAccess,hasReadAccess:this._hasReadAccess,hasWriteAccessAvailable:this._hasWriteAccessAvailable,canChangeWriteAccess:this._canChangeWriteAccess,hasWriteAccess:this._hasWriteAccess})),this._users&&this._renderUsers(),this.$el.toggleClass("is-selected",this._isSelected),this},_renderUsers:function(){var a=new i({className:"u-flex u-alignCenter",users:this._users});this.$(".js-users").append(a.render().el),this.addView(a)},_onChangeWrite:function(){var a=this._permission;a.canChangeWriteAccess(this._model)&&(a.hasWriteAccess(this._model)?a.revokeWriteAccess(this._model):a.grantWriteAccess(this._model))},_onChangeRead:function(){var a=this._permission;a.canChangeReadAccess(this._model)&&(a.hasReadAccess(this._model)?a.revokeAccess(this._model):a.grantReadAccess(this._model))},_onHoverDisabledToggler:function(a){var b,c,d=this._permission.findRepresentableAclItem(this._model);d&&!d.isOwn(this._model)&&(b=this._inheritedAccessTooltipText(d),c=h(a.currentTarget),this._tooltip=this._createTooltip({$el:c,msg:b}),this._tooltip.showTipsy())},_createTooltip:function(a){return new g({el:a.$el,title:function(){return a.msg}})},_destroyTooltip:function(){this._tooltip&&(this._tooltip.hideTipsy(),this._tooltip.destroyTipsy())},_inheritedAccessTooltipText:function(a){var b=a.get("type");switch(b){case"group":return _t("components.modals.publish.share.tooltip.group",{name:a.get("entity").get("name")});case"org":return _t("components.modals.publish.share.tooltip.org");default:return console.error("Trying to display inherited access for an unrecognized type "+b),""}}})},{"../../../tipsy-tooltip-view.js":589,"./share-permission.tpl":443,"./users-group-view":448,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],443:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Share-permissionInfo">\n  <div class="Share-permissionIcon">\n    ',__p+=avatar?'\n      <div class="Share-user Share-user--huge" style="background-image: url('+(null==(__t=avatar)?"":_.escape(__t))+')"></div>\n    ':'\n        <i class="CDB-IconFont CDB-IconFont-people"></i>\n    ',__p+='\n  </div>\n  <div>\n    <div class="CDB-Text u-mainTextColor CDB-Size-medium is-semibold u-ellipsis">\n      '+(null==(__t=name)?"":_.escape(__t))+'\n    </div>\n\n\n    <div class="CDB-Text u-mainTextColor u-tSpace CDB-Size-medium u-ellipsis">\n      ',role&&(__p+='\n        <i class="Tag Tag--outline Tag--'+(null==(__t=role)?"":_.escape(__t))+' CDB-Text CDB-Size-small u-upperCase">'+(null==(__t=role)?"":_.escape(__t))+"</i>\n      "),__p+="\n\n      ",users&&(__p+='\n        <div class="js-users"></div>\n      '),__p+="\n    </div>\n\n\n    ",description&&(__p+='\n    <div class="CDB-Text u-mainTextColor u-tSpace CDB-Size-medium u-ellipsis">\n      '+(null==(__t=description)?"":_.escape(__t))+"\n    </div>\n    "),__p+='\n  </div>\n</div>\n<div class="Share-togglers">\n  ',hasWriteAccessAvailable&&(__p+='\n    <div class="CDB-Text CDB-Size-medium u-rSpace--xl Share-toggler js-toggler ',canChangeWriteAccess||(__p+="is-disabled"),__p+='">\n      <input class="CDB-Toggle u-iBlock js-write" type="checkbox"\n        ',canChangeWriteAccess||(__p+='disabled="disabled"'),__p+="\n        ",hasWriteAccess&&(__p+=" checked "),__p+='\n      />\n      <span class="u-iBlock CDB-ToggleFace"></span>\n      <label class="u-iBlock u-altTextColor ">'+(null==(__t=_t("components.modals.publish.share.toggle.write"))?"":_.escape(__t))+"</label>\n    </div>\n  "),__p+='\n  <div class="CDB-Text CDB-Size-medium Share-toggler js-toggler ',canChangeReadAccess||(__p+="is-disabled"),__p+='">\n    <input class="CDB-Toggle u-iBlock js-read" type="checkbox"\n      ',hasReadAccess&&(__p+=" checked "),__p+="\n      ",canChangeReadAccess||(__p+='disabled="disabled"'),__p+='\n    />\n    <span class="u-iBlock CDB-ToggleFace"></span>\n    <label class="u-iBlock u-altTextColor ">'+(null==(__t=_t("components.modals.publish.share.toggle.read"))?"":_.escape(__t))+"</label>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],444:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./share.tpl"),g=a("../../../../data/grantables-collection"),h=a("../../../../components/pagination-search/pagination-search-view"),i=a("./share-list-view"),j=["configModel","currentUserId","organization","visDefinitionModel"];b.exports=e.extend({initialize:function(a){d.each(j,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._grantablesCollection=new g([],{currentUserId:this._currentUserId,organization:this._organization,configModel:this._configModel}),this._sharePermissionModel=this._visDefinitionModel.getPermissionModel().clone(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(f({name:this._visDefinitionModel.get("name")})),this._initViews(),this},_initBinds:function(){this._sharePermissionModel.acl.on("add remove reset change",this._onSave,this),this.add_related_model(this._sharePermissionModel.acl)},_initViews:function(){var a=this;this._searchPaginationView=new h({className:"u-inner",listCollection:this._grantablesCollection,createContentView:function(b){return new i(d.extend({},b,{collection:a._grantablesCollection,currentUserId:a._currentUserId,sharePermissionModel:a._sharePermissionModel,organization:a._organization,isVisualization:a._visDefinitionModel.isVisualization()}))}}),this.addView(this._searchPaginationView),this.$(".js-body").html(this._searchPaginationView.render().el)},_onCancel:function(){this._modalModel.destroy()},_onBack:function(){this._modalModel.destroy(),this._onBack()},_onSave:function(){var a=this._visDefinitionModel.getPermissionModel();a.overwriteAcl(this._sharePermissionModel),a.save().fail(this._searchPaginationView.showError.bind(this._searchPaginationView))}})},{"../../../../components/pagination-search/pagination-search-view":516,"../../../../data/grantables-collection":628,"./share-list-view":441,"./share.tpl":445,"backbone/core-view":1127,underscore:"underscore"}],445:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-body">\n\n</div>';return __p}},{underscore:"underscore"}],446:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("./user.tpl"),h=a("../../../tipsy-tooltip-view"),i=["username","avatar"];b.exports=f.extend({initialize:function(a){e.each(i,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(g({avatar:this._avatar,username:this._username})),this._initViews(),this},_initViews:function(){var a=new h({el:this.$(".js-avatar"),title:function(){return d(this).attr("data-title")}});this.addView(a)}})},{"../../../tipsy-tooltip-view":589,"./user.tpl":447,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],447:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Share-user u-rSpace js-avatar" style="background-image: url('+(null==(__t=avatar)?"":_.escape(__t))+')" data-title="'+(null==(__t=username)?"":_.escape(__t))+'"></div>\n';return __p}},{underscore:"underscore"}],448:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./users-group.tpl"),g=a("./user-view"),h=["users"],i=3;b.exports=d.extend({initialize:function(a){e.each(h,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(f({people:this._getRemainsPeople()})),this._renderUsers(),this},_getRemainsPeople:function(){return Math.max(0,this._users.length-i)},_renderUsers:function(){e.each(this._users.slice(0,i),this._renderUser,this)},_renderUser:function(a){var b=new g({username:a.username,avatar:a.avatar_url});this.$(".js-content").append(b.render().el),this.addView(b)}})},{"./user-view":446,"./users-group.tpl":449,"backbone/core-view":1127,underscore:"underscore"}],449:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex js-content"></div>\n',people>0&&(__p+='\n  <div class="u-secondaryTextColor CDB-Text CDB-Size-small u-lSpace">+ '+(null==(__t=people)?"":_.escape(__t))+"</div>\n"),__p+="";return __p}},{underscore:"underscore"}],450:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Publish-modalMenu u-tSpace-xl">\n  <nav class="CDB-NavMenu u-inner">\n    <ul class="CDB-Size-medium CDB-Text is-semibold js-menu"></ul>\n  </nav>\n</div>\n\n<div class="Tab-paneContent Publish-modalContent js-content"></div>\n';return __p}},{underscore:"underscore"}],451:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./upgrade.tpl"),g=d.template("<a href='mailto:<%- mail %>'><%- contact %></a>")({contact:_t("components.modals.publish.privacy.upgrade.contact"),mail:_t("components.modals.publish.privacy.upgrade.mail")});b.exports=e.extend({render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=f({title:_t("components.modals.publish.privacy.upgrade.title"),desc:_t("components.modals.publish.privacy.upgrade.desc",{contact:g})});this.$el.html(a)}})},{"./upgrade.tpl":452,"backbone/core-view":1127,underscore:"underscore"}],452:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter">\n  <div class="Upgrade-icon u-rSpace--xl">\n    <svg width="16px" height="16px" viewBox="578 456 16 16">\n      <g id="present" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(578.000000, 456.000000)">\n        <path d="M10.0946667,4.4109223 C10.8886667,4.1368747 11.6846667,3.80147316 12.0073333,3.4715253 C12.7866667,2.67392407 12.7866667,1.37662907 12.0073333,0.579027844 C11.2513333,-0.193350099 9.934,-0.192668389 9.17866667,0.579027844 C8.74133333,1.0262299 8.29266667,2.36033726 8,3.37608583 C7.70666667,2.36033726 7.25866667,1.0262299 6.82133333,0.579027844 C6.066,-0.193350099 4.748,-0.192668389 3.99266667,0.579027844 C3.21266667,1.37662907 3.21266667,2.67392407 3.99266667,3.4715253 C4.316,3.80147316 5.11133333,4.1368747 5.90533333,4.4109223 L0.333333333,4.4109223 C0.149333333,4.4109223 0,4.56362544 0,4.75177753 L0,7.47861934 C0,7.66677142 0.149333333,7.81947456 0.333333333,7.81947456 L0.666666667,7.81947456 L0.666666667,15.6591448 C0.666666667,15.8472969 0.816,16 1,16 L15,16 C15.184,16 15.3333333,15.8472969 15.3333333,15.6591448 L15.3333333,7.81947456 L15.6666667,7.81947456 C15.8506667,7.81947456 16,7.66677142 16,7.47861934 L16,4.75177753 C16,4.56362544 15.8506667,4.4109223 15.6666667,4.4109223 L10.0946667,4.4109223 Z M6,6.95652174 L6,4.86956522 L10,4.86956522 L10,6.95652174 L6,6.95652174 L6,6.95652174 Z M10,7.65217391 L10,15.3043478 L6,15.3043478 L6,7.65217391 L10,7.65217391 L10,7.65217391 Z M9.80833133,1.08822938 C10.0510474,0.834996985 10.3727426,0.695652174 10.7169115,0.695652174 C11.0597961,0.695652174 11.3821334,0.834996985 11.6248495,1.08755946 C12.1250502,1.6101025 12.1250502,2.46023983 11.6248495,2.98278288 C11.2729754,3.34990286 9.79227867,3.85636766 8.66666667,4.17391304 C8.97102496,2.99953105 9.45581507,1.45534937 9.80833133,1.08822938 L9.80833133,1.08822938 Z M4.37515049,1.08822938 C4.6178666,0.834996985 4.94020387,0.695652174 5.28373064,0.695652174 C5.6266153,0.695652174 5.94895256,0.834996985 6.19166867,1.08755946 C6.54354282,1.45467944 7.02833293,2.99886112 7.33333333,4.17391304 C6.20707922,3.85569773 4.72638253,3.34990286 4.37515049,2.98278288 C3.87494984,2.46090976 3.87494984,1.61077243 4.37515049,1.08822938 L4.37515049,1.08822938 Z M0.666666667,4.86956522 L5.33333333,4.86956522 L5.33333333,6.95652174 L1,6.95652174 L0.666666667,6.95652174 L0.666666667,4.86956522 L0.666666667,4.86956522 Z M1.33333333,7.65217391 L5.33333333,7.65217391 L5.33333333,15.3043478 L1.33333333,15.3043478 L1.33333333,7.65217391 L1.33333333,7.65217391 Z M14.6666667,15.3043478 L10.6666667,15.3043478 L10.6666667,7.65217391 L14.6666667,7.65217391 L14.6666667,15.3043478 L14.6666667,15.3043478 Z M15.3333333,6.95652174 L15,6.95652174 L10.6666667,6.95652174 L10.6666667,4.86956522 L15.3333333,4.86956522 L15.3333333,6.95652174 L15.3333333,6.95652174 Z" id="Shape" fill="#9BC63B"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="Upgrade-body">\n    <h2 class="CDB-Text CDB-Size-large">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n    <p class="CDB-Text CDB-Size-medium u-altTextColor ">'+(null==(__t=desc)?"":__t)+"</p>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],453:[function(a,b,c){var d=a("underscore"),e=a("../confirmation/modal-confirmation-view"),f=a("../../../editor/components/modals/export-map/modal-export-map-view.js"),g=a("../../../data/export-map-definition-model.js"),h=a("../../../editor/layers/delete-layer-confirmation.tpl"),i=a("../../../editor/layers/operations/remove-layer"),j=["modalModel","layerModel","modals","widgetDefinitionsCollection","visDefinitionModel","userActions"];b.exports=e.extend({className:"Dialog-content",events:function(){return d.extend({},e.prototype.events,{"click [data-event=exportMapAction]":"_exportMap"})},initialize:function(a){d.each(j,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),a.loadingTitle&&(this._hasLoading=!0,this._loadingTitle=a.loadingTitle)},render:function(){return this.clearSubViews(),this.$el.html(h({layerName:this._layerModel.getTableName(),layerVisName:this._visDefinitionModel.get("name"),affectedItemsMessages:this._getAffectedItemsMessages()})),this},_getAffectedItemsByLayer:function(){var a=this._layerModel,b=this._widgetDefinitionsCollection;return[{widgets:b.widgetsOwnedByLayer(a.get("id"))},{analyses:a.getNumberOfAnalyses()},{layers:a.getAllDependentLayers()}]},_getAffectedItemsMessages:function(){for(var a=this._getAffectedItemsByLayer(),b=[],c=0;c<a.length;c++)for(var d in a[c])if(a[c][d]>0){var e=_t("editor.layers.delete."+d,{smart_count:a[c][d]});b.push(e)}return b},_exportMap:function(){var a=this;this._modals.create(function(){var b=new g({visualization_id:a._visDefinitionModel.get("id")},{configModel:this.configModel});return new f({modalModel:a._modalModel,exportMapModel:b,renderOpts:{name:a._visDefinitionModel.get("name")}})})},_runAction:function(){i({userActions:this._userActions,layerDefinitionModel:this._layerModel}),this._modalModel.destroy()}})},{"../../../data/export-map-definition-model.js":625,"../../../editor/components/modals/export-map/modal-export-map-view.js":693,"../../../editor/layers/delete-layer-confirmation.tpl":769,"../../../editor/layers/operations/remove-layer":994,"../confirmation/modal-confirmation-view":404,underscore:"underscore"}],454:[function(a,b,c){var d=a("backbone/core-view"),e=a("./sync-options-modal.tpl"),f=a("../../loading/render-loading"),g=a("../../error/error-view"),h=a("../../../helpers/error-parser");b.exports=d.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function(a){if(!a.modalModel)throw new Error("modalModel is required");if(!a.syncModel)throw new Error("syncModel is required");if(!a.tableName)throw new Error("tableName is required");this._syncModel=a.syncModel,this._modalModel=a.modalModel,this._tableName=a.tableName},render:function(){this.clearSubViews(),this.$el.html(e({interval:this._syncModel.get("interval"),service:this._syncModel.get("service_name")||"",isExternalSource:this._syncModel.get("from_external_source"),url:this._getServiceURL()}))},_renderErrorView:function(a){var b=new g({title:_t("dataset.sync.error"),desc:a});this.$el.html(b.render().el),this.addView(b)},_renderLoadingView:function(){this.$el.html(f({title:_t("dataset.sync.loading",{tableName:this._tableName})}))},_getServiceURL:function(){return this._syncModel.get("service_name")||this._syncModel.get("service_item_id")?this._syncModel.get("service_item_id"):this._syncModel.get("url")},_onConfirm:function(){var a=parseInt(this.$('[name="interval"]:checked').val(),10),b={wait:!0,success:function(){this._modalModel.destroy()}.bind(this),error:function(a,b){this._renderErrorView(h(b))}.bind(this)};this._renderLoadingView(),this._syncModel.get("interval")!==a?a?this._syncModel.save({interval:a},b):this._syncModel.destroy(b):this._modalModel.destroy()},_onCancel:function(){this._modalModel.destroy()}})},{"../../../helpers/error-parser":1090,"../../error/error-view":67,"../../loading/render-loading":230,"./sync-options-modal.tpl":455,"backbone/core-view":1127}],455:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--full u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="20px" viewBox="0 8 24 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Icon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(0.000000, 8.000000)">\n              <path d="M19.591513,9.26858726 C19.7142261,9.39218837 19.8745043,9.45462604 20.0347826,9.45462604 C20.1950609,9.45462604 20.3553391,9.39218837 20.4780522,9.26858726 C20.7222261,9.0201108 20.7222261,8.61617729 20.4780522,8.36770083 C20.1988174,8.08354571 19.908313,7.81468144 19.6065391,7.56365651 C19.5652174,7.52925208 19.5201391,7.4999446 19.4775652,7.46554017 C17.3914435,5.76952909 14.824487,4.84060942 12.1147826,4.84060942 L12.1122783,4.84060942 L12.1097739,4.84060942 C8.95053913,4.84060942 5.98038261,6.0931856 3.74775652,8.36770083 C3.50358261,8.61617729 3.50358261,9.0201108 3.74775652,9.26858726 C3.87046957,9.3934626 4.03074783,9.45462604 4.19102609,9.45462604 C4.35130435,9.45462604 4.51158261,9.39218837 4.63304348,9.26858726 C6.63151304,7.23490305 9.28737391,6.11484765 12.1122783,6.11484765 C14.9371826,6.11484765 17.5930435,7.23490305 19.591513,9.26858726 L19.591513,9.26858726 Z" id="Shape" fill="#2E3C43"></path>\n              <path d="M22.7607652,5.95695291 C22.8834783,6.08182825 23.0437565,6.14299169 23.2040348,6.14299169 C23.364313,6.14299169 23.5245913,6.08055402 23.6473043,5.95695291 C23.8914783,5.70847645 23.8914783,5.30454294 23.6473043,5.05606648 C17.2862609,-1.41706371 6.93704348,-1.41451524 0.578504348,5.05606648 C0.334330435,5.30454294 0.334330435,5.70847645 0.578504348,5.95695291 C0.822678261,6.20542936 1.21961739,6.20542936 1.4637913,5.95695291 C7.33398261,-0.0179501385 16.8905739,-0.0166759003 22.7607652,5.95695291 L22.7607652,5.95695291 Z" id="Shape" fill="#2E3C43"></path>\n              <path d="M9.58789565,9.966759 C8.61495652,10.3273684 7.69586087,10.8854848 6.91575652,11.6793352 C6.67158261,11.9278116 6.67158261,12.3317452 6.91575652,12.5802216 C7.03846957,12.705097 7.19874783,12.7662604 7.35902609,12.7662604 C7.51930435,12.7662604 7.67958261,12.7038227 7.80229565,12.5802216 C10.1789217,10.1642659 14.046887,10.1642659 16.4247652,12.5802216 C16.5474783,12.705097 16.7077565,12.7662604 16.8680348,12.7662604 C17.028313,12.7662604 17.1885913,12.7038227 17.3113043,12.5802216 C17.5554783,12.3317452 17.5554783,11.9278116 17.3113043,11.6793352 C15.2239304,9.55645429 12.1924174,8.99961219 9.58789565,9.966759 L9.58789565,9.966759 Z" id="Shape" fill="#2E3C43"></path>\n              <path d="M12.1122783,14.1359557 C10.5307826,14.1359557 9.2448,15.4445983 9.2448,17.052687 C9.2448,18.6620499 10.5307826,19.9706925 12.1122783,19.9706925 C13.6925217,19.9706925 14.9785043,18.6620499 14.9785043,17.052687 C14.9785043,15.4458726 13.6925217,14.1359557 12.1122783,14.1359557 L12.1122783,14.1359557 Z M12.1122783,18.6977285 C11.2219826,18.6977285 10.4969739,17.9599446 10.4969739,17.0539612 C10.4969739,16.1479778 11.2219826,15.4114681 12.1122783,15.4114681 C13.0025739,15.4114681 13.7263304,16.1479778 13.7263304,17.0539612 C13.7263304,17.9599446 13.0025739,18.6977285 12.1122783,18.6977285 L12.1122783,18.6977285 Z" id="Shape" fill="#2E3C43"></path>\n          </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace--m">\n        '+(null==(__t=_t("dataset.sync.title"))?"":_.escape(__t))+'\n     </h2>\n      <p class="CDB-Text CDB-Size-medium u-altTextColor">\n        '+(null==(__t=_t("dataset.sync.desc",{service:service,url:url}))?"":__t)+'\n      </p>\n      <div class="Modal-listTextItem u-flex u-alignCenter">\n        <h3 class="CDB-Text CDB-Size-small is-semibold u-upperCase">'+(null==(__t=_t("dataset.sync.label"))?"":_.escape(__t))+'</h3>\n        <ul class="Modal-listForm u-flex u-alignCenter CDB-Text CDB-Size-small js-intervals">\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="3600"\n              ',3600===interval&&(__p+="\n                checked\n              "),__p+="\n\n              ",isExternalSource&&(__p+="\n                disabled\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Every hour</label>\n          </li>\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="86400"\n              ',86400===interval&&(__p+="\n                checked\n              "),__p+="\n\n              ",isExternalSource&&(__p+="\n                disabled\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Every day</label>\n          </li>\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="604800"\n              ',604800===interval&&(__p+="\n                checked\n              "),__p+="\n\n              ",isExternalSource&&(__p+="\n                disabled\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Every week</label>\n          </li>\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="2592000"\n              ',2592e3===interval&&(__p+="\n                checked\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Every month</label>\n          </li>\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="0"\n              ',0===interval&&(__p+="\n                checked\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Never</label>\n          </li>\n        </ul>\n      </div>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("dataset.sync.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("dataset.sync.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n\n\n";return __p}},{underscore:"underscore"}],456:[function(a,b,c){b.exports=" | CARTO"},{}],457:[function(a,b,c){var d=a("backbone/core-view"),e=a("./mosaic/mosaic-view");b.exports=d.extend({initialize:function(a){if(!a.collection)throw new Error("Mosaic collection is required");if(!a.template)throw new Error("template is required");this.template=a.template,this._disabled=a.disabled,this._initBinds()},render:function(){var a=this.collection.getSelected(),b=a&&a.getName();return this.$el.html(this.template({name:b})),this._initViews(),this},_initBinds:function(){this.collection.bind("change:highlighted",this._onChangeHighlighted,this)},_initViews:function(){var a=new e({collection:this.collection,disabled:this._disabled});if(!this.$(".js-selector").length)throw new Error("HTML element with js-selector class is required");this.$(".js-selector").append(a.render().el),this.addView(a)},_onChangeHighlighted:function(){var a=this.collection.getHighlighted()||this.collection.getSelected();if(a){var b=this.$(".js-highlight");b&&b.text(a.getName())}}})},{"./mosaic/mosaic-view":463,"backbone/core-view":1127}],458:[function(a,b,c){var d=a("backbone"),e=a("./mosaic-item-model");b.exports=d.Collection.extend({model:function(a,b){var c={};return"string"==typeof a?c.val=a:c=a,new e(c)},initialize:function(){this._initBinds()},_initBinds:function(){this.bind("change:selected",this._onSelectedChange,this)},_onSelectedChange:function(a,b){b&&this.each(function(b){b.cid!==a.cid&&b.get("selected")&&b.set("selected",!1)})},getSelected:function(){return this.findWhere({selected:!0})},getHighlighted:function(){return this.findWhere({highlighted:!0})}})},{"./mosaic-item-model":459,backbone:"backbone"}],459:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{disabled:!1,selected:!1,label:"",template:function(){return""}},getName:function(){return this.get("label")||this.getValue()},getValue:function(){return this.get("val")}})},{backbone:"backbone"}],460:[function(a,b,c){var d=a("backbone/core-view"),e=a("./mosaic-item.tpl");b.exports=d.extend({className:"Mosaic-item",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function(a){this._disabled=a.disabled,this._initBinds()},render:function(){return this.$el.html(e({name:this.model.getName(),template:this.model.get("template")()})),this.$el.addClass("js-"+this.model.getValue()),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this},_initBinds:function(){this.model.bind("change:selected",this.render,this)},_onMouseEnter:function(){this.model.set("highlighted",!0)},_onMouseLeave:function(){this.model.set("highlighted",!1)},_onClick:function(){return!this._disabled&&void this.model.set("selected",!0)}})},{"./mosaic-item.tpl":461,"backbone/core-view":1127}],461:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="Mosaic-inner">\n  '+(null==(__t=template)?"":__t)+"\n</button>\n";return __p}},{underscore:"underscore"}],462:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<img src="'+(null==(__t=imgURL)?"":__t)+'" class="Mosaic-image js-thumbnailImg" />\n';return __p}},{underscore:"underscore"}],463:[function(a,b,c){var d=a("backbone/core-view"),e=a("./mosaic.tpl"),f=a("./mosaic-collection"),g=a("./mosaic-item-view");b.exports=d.extend({className:"Mosaic",tagName:"div",initialize:function(a){if(!a.collection){if(!a.options)throw new Error("options array {value, label} is required");this.collection=new f(a.options)}this._disabled=a.disabled},render:function(){return this.clearSubViews(),this.$el.html(e()),this._renderList(),this},_renderList:function(){this.collection.each(function(a){this._createItem(a)},this)},_createItem:function(a){var b=new g({model:a,disabled:this._disabled});this.$(".js-mosaic").append(b.render().el),this.addView(b)}})},{"./mosaic-collection":458,"./mosaic-item-view":460,"./mosaic.tpl":464,"backbone/core-view":1127}],464:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Mosaic-list js-mosaic"></ul>\n';return __p}},{underscore:"underscore"}],465:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="LayoutIcon">\n    <i class="CDB-IconFont '+(null==(__t=icon)?"":_.escape(__t))+'"></i>\n  </div>\n  <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m u-tSpace-xl">'+(null==(__t=title)?"":_.escape(__t))+'</h4>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=desc)?"":_.escape(__t))+"\n  </p>\n</div>\n";return __p}},{underscore:"underscore"}],466:[function(a,b,c){var d=a("./no-results.tpl");b.exports=function(a){return d({icon:a.icon||"CDB-IconFont-cockroach",title:a.title||"",desc:a.desc})}},{"./no-results.tpl":465}],467:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({tagName:"button",initialize:function(a){if(!a.template)throw new Error("template is required");if(!a.editorModel)throw new Error("editorModel is required");this.template=a.template,this._editorModel=a.editorModel,this._data={},a.model&&(this._data=a.model.toJSON()),this._initBinds()},_initBinds:function(){this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.template(this._data)),this},_changeStyle:function(){this.$(".js-theme").toggleClass("is-white",this._editorModel.isEditing())}})},{"backbone/core-view":1127}],468:[function(require,module,exports){var _=require("underscore");
module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span data-action="'+(null==(__t=button)?"":_.escape(__t))+'" class="CDB-Text is-semibold u-lSpace u-actionTextColor u-upperCase">'+(null==(__t=button)?"":_.escape(__t))+"</span>";return __p}},{underscore:"underscore"}],469:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Shape-close is-blue is-large js-theme"></div>';return __p}},{underscore:"underscore"}],470:[function(a,b,c){var d=a("backbone"),e=a("./notifier-model");b.exports=d.Collection.extend({model:function(a,b){return new e(a,b)},findById:function(a){return this.findWhere({id:a})}})},{"./notifier-model":473,backbone:"backbone"}],471:[function(a,b,c){var d=a("backbone/core-view"),e=a("./notifier-item.tpl"),f=a("./notifier-action-view"),g=a("./notifier-close.tpl"),h=a("./notifier-action.tpl");b.exports=d.extend({className:"Notifier-inner",tagName:"li",events:{"click .js-close":"_closeHandler","click .js-action":"_actionHandler"},initialize:function(a){if(!a.notifierModel)throw new Error("notifierModel is required");if(!a.editorModel)throw new Error("editorModel is required");this._editorModel=a.editorModel,this.template=this.options.template||e,this._notifierModel=a.notifierModel,this.$el.attr("id",this._notifierModel.get("id")),this._delay=this._notifierModel.get("delay")||this._notifierModel.get("defaultDelay"),this._notifierModel.get("delay")&&this._notifierModel.get("closable")!==!1&&(this._timeout=setTimeout(this._autoClose.bind(this),this._delay)),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this._changeStyle(),this},_initBinds:function(){this.listenTo(this._notifierModel,"change",this.render),this.listenTo(this._notifierModel,"change:status",this._onChangeStatus),this.add_related_model(this._notifierModel),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},_initViews:function(){var a=this._notifierModel.getButton(),b=this._notifierModel.isClosable(),c=this.template({status:this._notifierModel.getStatus(),info:this._notifierModel.getInfo(),isActionable:a,isClosable:b});this.$el.append(c),a&&this._createActionView(a),b&&this._createCloseView()},_createActionView:function(a){var b=new f({template:h,className:"js-action",model:this._notifierModel,editorModel:this._editorModel});this.$(".js-actionButton").append(b.render().el),this.addView(b)},_createCloseView:function(){var a=new f({template:g,className:"CDB-Shape js-close",editorModel:this._editorModel});this.$(".js-closeButton").append(a.render().el),this.addView(a)},_closeHandler:function(){var a=this._notifierModel.getStatus(),b=this._notifierModel.getAction();this._notifierModel.trigger("notification:close",b||a),clearTimeout(this._timeout),this._notifierModel&&this._notifierModel.collection&&this._notifierModel.collection.remove(this._notifierModel)},_actionHandler:function(){var a=this._notifierModel.getStatus(),b=this._notifierModel.getAction();this._notifierModel.trigger("notification:action",b||a)},_changeStyle:function(){this.$(".Notifier-info").toggleClass("u-whiteTextColor",this._editorModel.isEditing()),this.$(".Notifier-actions .CDB-Shape-close").toggleClass("is-blue",!this._editorModel.isEditing()),this.$(".Notifier-actions .CDB-Shape-close").toggleClass("is-white",this._editorModel.isEditing())},_autoClose:function(){this._notifierModel.set({action:"autoclose"},{silent:!0}),this._closeHandler()},_onChangeStatus:function(a,b){"success"!==b&&"error"!==b||this._notifierModel.get("closable")===!1||this._notifierModel.get("autoclosable")===!1||(this._timeout=setTimeout(this._autoClose.bind(this),this._delay))}})},{"./notifier-action-view":467,"./notifier-action.tpl":468,"./notifier-close.tpl":469,"./notifier-item.tpl":472,"backbone/core-view":1127}],472:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Notifier-item Notifier-item--'+(null==(__t=status)?"":_.escape(__t))+'">\n\n  ',"loading"===status&&(__p+='\n  <div class="Notifier-icon CDB-LoaderIcon is-blue js-theme u-rSpace--m">\n    <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n      <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n    </svg>\n  </div>\n  '),__p+="\n\n  ","success"===status&&(__p+='\n  <div class="Notifier-icon CDB-Shape u-rSpace--m">\n    <div class="CDB-Shape-CircleItem CDB-Shape-CircleItem--fill is-green">\n      <div class="CDB-Shape-tick is-medium is-white"></div>\n    </div>\n  </div>\n  '),__p+="\n\n  ","error"!==status&&"warning"!==status||(__p+='\n  <div class="Notifier-icon CDB-Shape u-rSpace--m">\n    <div class="CDB-Shape-CircleItem CDB-Shape-CircleItem--fill is-red">\n      <div class="CDB-Shape-close is-medium is-white"></div>\n    </div>\n  </div>\n  '),__p+='\n\n  <div class="Notifier-info">\n    <p class="CDB-Text CDB-Size-medium">'+(null==(__t=info)?"":__t)+" ",isActionable&&(__p+=' <span class="js-actionButton"></span> '),__p+="</p>\n  </div>\n\n  ",isClosable&&(__p+='\n    <div class="Notifier-actions js-closeButton"></div>\n  '),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],473:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{status:"idle",info:"",closable:!0},initialize:function(a,b){void 0===a.id&&this.set("id","notifier"+this.cid),this.set("defaultDelay",b.delay),b.visDefinitionModel&&(this._retriggerEvent(b.visDefinitionModel,"vis:reload"),this._retriggerEvent(b.visDefinitionModel,"vis:error"))},isClosable:function(){return this.get("closable")===!0},updateClosable:function(a){this.set({closable:a})},getButton:function(){return this.get("button")},updateButton:function(a){this.set({button:a})},getStatus:function(){return this.get("status")},updateStatus:function(a){this.set({status:a})},getInfo:function(){return this.get("info")},getAction:function(){return this.get("action")},setAction:function(a){this.set({action:a})},updateInfo:function(a){this.set({info:a})},update:function(a){this.set(a)},_retriggerEvent:function(a,b){a.on(b,function(){this.trigger(b,arguments)},this)}})},{backbone:"backbone"}],474:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./notifier-item-view"),g=a("./notifier.tpl");b.exports=d.extend({className:"Notifier",initialize:function(a){if(!a.collection)throw new Error("collection is mandatory");if(!a.editorModel)throw new Error("editorModel is mandatory");this._editorModel=a.editorModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g()),this._renderAllSubviews(),this._renderLoading(),this},rebindEvents:function(){return this.stopListening(this.collection),this.stopListening(this._editorModel),this._initBinds(),this},_initBinds:function(){this.listenTo(this.collection,"reset update change:status",this.render),this.add_related_model(this.collection),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},_renderAllSubviews:function(){this.collection.each(this._renderSubview,this)},_renderSubview:function(a){var b=new f({notifierModel:a,editorModel:this._editorModel}),c=a.get("status"),d="success"===c||"error"===c?this._getDoneContainer():this._getLoadingContainer();d.append(b.render().el),this.addView(b)},_removeSubview:function(a){var b=a.get("id"),c=e.first(e.filter(this._subviews,function(a){return a._notifierModel.get("id")===b}));c&&(this.removeView(c),c.remove())},_renderLoading:function(){this._getLoader().toggleClass("is-visible",this._anyNotificationLoading())},_anyNotificationLoading:function(){return this.collection.any(function(a){return!e.contains(["success","error","warning"],a.get("status"))})},_changeStyle:function(){this.$el.toggleClass("is-dark",this._editorModel.isEditing())},_getDoneContainer:function(){return this.$(".js-status-done")},_getLoadingContainer:function(){return this.$(".js-status-loading")},_getLoader:function(){return this.$(".js-loader")}})},{"./notifier-item-view":471,"./notifier.tpl":476,"backbone/core-view":1127,underscore:"underscore"}],475:[function(a,b,c){var d=a("./notifier-view"),e=a("./notifier-collection"),f=function(){function a(a){if(!c&&!a)throw new Error("editorModel is required");!c&&a&&a.editorModel&&(c=a.editorModel),f=!0,b=new d({collection:g,editorModel:c})}var b,c,f=!1,g=new e;return{DEFAULT_DELAY:5e3,init:function(b){b.visDefinitionModel&&(this._visDefinitionModel=b.visDefinitionModel),a(b)},getView:function(){return f||a(),b.rebindEvents()},getCollection:function(){return g},getNotification:function(a){var b;return b="string"==typeof a?g.findById(a):g.findById(a.id)},addNotification:function(a){return g.add(a,{visDefinitionModel:this._visDefinitionModel,delay:this.DEFAULT_DELAY})},removeNotification:function(a){var b;return b="string"==typeof a?g.findById(a):g.findById(a.id),g.remove(b)}}}();b.exports=f},{"./notifier-collection":470,"./notifier-view":474}],476:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Loader js-loader"></div>\n<ul class="Notifier-list js-status-loading"></ul>\n<ul class="Notifier-list js-status-done"></ul>';return __p}},{underscore:"underscore"}],477:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-column-included"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  ',__p+="count"===aggregate_function?'\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">count_vals</div>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">count_vals_density</div>\n  </li>\n  ':'\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">'+(null==(__t=aggregate_function)?"":_.escape(__t))+"_"+(null==(__t=aggregate_column)?"":_.escape(__t))+"</div>\n  </li>\n  ",__p+='\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.aggregate-intersection.description"))?"":_.escape(__t))+"\n</p>\n";return __p}},{underscore:"underscore"}],478:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.geometries-updated"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">the_geom</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.area-of-influence.the-geom"))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.area-of-influence.description"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="https://carto.com/learn/guides/analysis/areas-of-influence" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.learn-more"))?"":_.escape(__t))+"</a>\n</p>\n";return __p}},{underscore:"underscore"}],479:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-columns-created"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">the_geom</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.centroid.the-geom"))?"":_.escape(__t))+'</p>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">value</div>\n    <p class="CDB-Text Onboarding-description">\n      ',__p+=aggregation?"\n      "+(null==(__t=_t("analyses-onboarding.centroid.aggregated-value"))?"":_.escape(__t))+"\n      ":"\n      "+(null==(__t=_t("analyses-onboarding.centroid.non-aggregated-value"))?"":_.escape(__t))+"\n      ",__p+="\n    </p>\n  </li>\n  ",category_column&&(__p+='\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">category</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.centroid.category"))?"":_.escape(__t))+"</p>\n  </li>\n  "),__p+='\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.centroid.description"))?"":_.escape(__t))+"\n</p>";return __p}},{underscore:"underscore"}],480:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-columns-created"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">the_geom</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.closest.the-geom"))?"":_.escape(__t))+'</p>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">source_cdb_id</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.closest.source_cdb_id"))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.closest.description"))?"":_.escape(__t))+"\n</p>";return __p}},{underscore:"underscore"}],481:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.geometries-updated"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">the_geom</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.connect-with-lines.the-geom"))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.connect-with-lines."+type))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="https://carto.com/learn/guides/analysis/connect-with-lines" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.learn-more"))?"":_.escape(__t))+"</a>\n</p>\n";return __p}},{underscore:"underscore"}],482:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-column-included"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">'+(null==(__t=final_column)?"":_.escape(__t))+'</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.data-observatory-measure.custom-column"))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.data-observatory-measure.description"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="https://carto.com/learn/guides/analysis/enrich-from-data-observatory" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.learn-more"))?"":_.escape(__t))+"</a>\n</p>";return __p}},{underscore:"underscore"}],483:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.filter-by-node-column.description"))?"":_.escape(__t))+"\n</p>\n";return __p}},{underscore:"underscore"}],484:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-columns-created"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.filter.description"))?"":_.escape(__t))+"\n</p>\n";return __p}},{underscore:"underscore"}],485:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.geometries-updated"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">the_geom</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.georeference.the-geom"))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.georeference.description"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="https://carto.com/learn/guides/analysis/georeference" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.learn-more"))?"":_.escape(__t))+"</a>\n</p>";return __p}},{underscore:"underscore"}],486:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.geometries-updated"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">the_geom</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.group-points.the-geom"))?"":_.escape(__t))+"</p>\n  </li>\n  ",category_column&&(__p+='\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">'+(null==(__t=category_column)?"":_.escape(__t))+'</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.group-points.category"))?"":_.escape(__t))+"</p>\n  </li>\n  "),__p+='\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.group-points.description",{method:_t("analyses."+type+".title")}))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="http://postgis.net/docs/manual-2.2/" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.read-more"))?"":_.escape(__t))+"</a>\n</p>\n";return __p}},{underscore:"underscore"}],487:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-column-included"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">source_cartodb_id</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.intersection.source-cartodb-id"))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.intersection.description"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="https://carto.com/learn/guides/analysis/intersect-second-layer" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.learn-more"))?"":_.escape(__t))+"</a>\n</p>\n";return __p}},{underscore:"underscore"}],488:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-column-added"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">cluster_no</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.kmeans.cluster-no",{clusters:clusters}))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.kmeans.description"))?"":_.escape(__t))+"\n</p>\n";return __p}},{underscore:"underscore"}],489:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-columns-included-based-on-input"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.merge.description"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="https://carto.com/learn/guides/analysis/join-column-from-second-layer" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.learn-more"))?"":_.escape(__t))+"</a>\n</p>\n";return __p}},{underscore:"underscore"}],490:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-columns-included"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">quads</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.moran.quads"))?"":_.escape(__t))+'</p>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">significance</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.moran.significance"))?"":_.escape(__t))+'</p>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">moran</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.moran.moran"))?"":_.escape(__t))+'</p>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">rowid</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.moran.rowid"))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.moran.description"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="https://carto.com/learn/guides/analysis/detect-outliers-and-clusters" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.learn-more"))?"":_.escape(__t))+"</a>\n</p>";return __p}},{underscore:"underscore"}],491:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.no-new-columns"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.sampling.description",{percentage:Math.round(100*sampling)}))?"":_.escape(__t))+"\n</p>\n";return __p}},{underscore:"underscore"}],492:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text Onboarding-headerDescription">\n  '+(null==(__t=_t("analyses-onboarding.new-columns-included"))?"":_.escape(__t))+'\n</p>\n\n<ul class="Onboarding-list">\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">trend</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.spatial-markov-trend.trend"))?"":_.escape(__t))+'</p>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">trend_up</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.spatial-markov-trend.trend_up"))?"":_.escape(__t))+'</p>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">trend_down</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.spatial-markov-trend.trend_down"))?"":_.escape(__t))+'</p>\n  </li>\n  <li class="Onboarding-listItem">\n    <div class="Onboarding-listItemValue">volatility</div>\n    <p class="CDB-Text Onboarding-description">'+(null==(__t=_t("analyses-onboarding.spatial-markov-trend.volatility"))?"":_.escape(__t))+'</p>\n  </li>\n</ul>\n\n<p class="CDB-Text Onboarding-description">\n  '+(null==(__t=_t("analyses-onboarding.spatial-markov-trend.description"))?"":_.escape(__t))+'\n</p>\n\n<p class="CDB-Text Onboarding-description">\n  <a href="https://carto.com/learn/guides/analysis/predict-trends-and-volatility" class="Onboarding-readMore" target="_blank">'+(null==(__t=_t("analyses-onboarding.learn-more"))?"":_.escape(__t))+"</a>\n</p>\n";return __p}},{underscore:"underscore"}],493:[function(a,b,c){var d=a("../../../components/local-storage/local-storage"),e=a("../../../components/onboardings/analysis/analysis-view"),f=a("../../../data/analyses"),g="onboarding",h=function(){function a(a){if(!b&&!a)throw new Error("onboardings is required");if(!c&&!a)throw new Error("userModel is required");!b&&a&&a.onboardings&&(b=a.onboardings),!c&&a&&a.userModel&&(c=a.userModel),h=b.editorModel}var b,c,h;return{init:function(b){a(b),d.init(g,{userModel:c})},launch:function(a,g){var i=f.getAnalysisByType(a).genericType||a;!d.get(i)&&i&&b.create(function(a){return new e({modalModel:a,userModel:c,editorModel:h,model:g})})}}}();b.exports=h},{"../../../components/local-storage/local-storage":231,"../../../components/onboardings/analysis/analysis-view":494,"../../../data/analyses":599}],494:[function(a,b,c){var d=a("../../../components/local-storage/local-storage"),e=a("backbone/core-view"),f=a("./analysis-view.tpl"),g=a("../../../data/analyses"),h="onboarding";b.exports=e.extend({className:"AnalysisCompletionDetails is-opening",events:{"click .js-close":"_close","click .js-style":"_onStyle"},initialize:function(a){if(!a.modalModel)throw new Error("modalModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.editorModel)throw new Error("editorModel is required");this._modalModel=a.modalModel,this._userModel=a.userModel,this._editorModel=a.editorModel,d.init(h,{userModel:this._userModel}),this._initBinds()},render:function(){this.$el.html(f({type:this._getGenericAnalysisType()}));var a=this._typeDef().onboardingTemplate,b=a&&a(this.model.attributes);return this.$(".js-content").html(b),this._onChangeEditorModelEdition(this._editorModel),this},_initBinds:function(){this.listenTo(this.model,"destroy",this._close),this.listenTo(this._editorModel,"change:edition",this._onChangeEditorModelEdition),this.add_related_model(this._editorModel)},_onChangeEditorModelEdition:function(a){var b=!!a.get("edition");this.$el.toggleClass("is-editing",b)},_close:function(){this._checkForgetStatus(),this.trigger("close",this)},_onStyle:function(){this._checkForgetStatus(),this.trigger("customEvent","style",this)},_checkForgetStatus:function(){this.$(".js-forget:checked").val()&&this._forget()},_forget:function(){d.set(this._getGenericAnalysisType(),!0)},_typeDef:function(a){return a=a||this.model.get("type"),g.getAnalysisByType(a)},_getGenericAnalysisType:function(){var a=this._typeDef();return a&&a.genericType||this.model.get("type")}})},{"../../../components/local-storage/local-storage":231,"../../../data/analyses":599,"./analysis-view.tpl":495,"backbone/core-view":1127}],495:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Onboarding-fake"></div>\n<div class="Onboarding-contentWrapper">\n  <div class="Onboarding-body">\n    <p class="CDB-Text Onboarding-headerTitle">'+(null==(__t=_t("analyses-onboarding."+type+".title"))?"":_.escape(__t))+'</p>\n    <p class="CDB-Text Onboarding-headerText">'+(null==(__t=_t("analyses-onboarding.finished"))?"":_.escape(__t))+'</p>\n\n    <div class="js-content"></div>\n\n    <div class="Onboarding-footer">\n      <div class="Onboarding-footerButtons">\n        <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-close">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("analyses-onboarding.done"))?"":_.escape(__t))+'</span>\n        </button>\n\n        <button class="CDB-Button CDB-Button--primary CDB-Button--big js-style">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("analyses-onboarding.style-analysis"))?"":_.escape(__t))+'</span>\n        </button>\n      </div>\n\n      <div class="u-iBlock">\n        <input class="CDB-Checkbox js-forget" type="checkbox" id="forget-me" name="forget-me" value="true">\n        <span class="u-iBlock CDB-Checkbox-face"></span>\n        <label for="forget-me" class="Onboarding-forgetLabel Checkbox-label CDB-Text CDB-Size-small u-altTextColor u-lSpace">'+(null==(__t=_t("analyses-onboarding.never-show-message"))?"":_.escape(__t))+"</label>\n      </div>\n    </div>\n  </div>\n</div>\n\n";return __p}},{underscore:"underscore"}],496:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("./builder-activated-notification.tpl"),g="builder_activated";b.exports=d.extend({className:"js-builderNotification",events:{"click .js-close":"_onClose"},initialize:function(){if(!this.options.builderActivatedNotification)throw new Error("builderActivatedNotification is required");this._notification=this.options.builderActivatedNotification,this.render()},render:function(){return this.$el.html(f()),e("body").prepend(this.$el),this},_onClose:function(){this._notification.setKey(g,!0),this._notification.save(),this.clean()},clean:function(){this.constructor.__super__.clean.apply(this)}})},{"./builder-activated-notification.tpl":497,"backbone/core-view":1127,jquery:"jquery"}],497:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="onboardingNotification Color-MainDark CDB-Text CDB-Size-medium u-flex u-justifyCenter">\n  <p>'+(null==(__t=_t("builder-activated-notification.message"))?"":__t)+'</p>\n\n  <button class="onboardingNotification-closeButton js-close">\n    <div class="CDB-Shape-close is-large is-white"></div>\n  </button>\n</div>\n';
return __p}},{underscore:"underscore"}],498:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("backbone/core-view"),g=a("./builder-view.tpl"),h=a("../../../helpers/required-opts"),i="onboarding",j=37,k=39,l=["userModel","onboardingNotification","editorModel"];b.exports=f.extend({className:"BuilderOnboarding is-step0 is-opening",events:{"click .js-start":"_onClickNext","click .js-next":"_onClickNext","click .js-close":"_close"},initialize:function(a){h(a,l,this),this._initModels(),this._initBinds()},render:function(){return this.$el.html(g({name:this._userModel.get("name")||this._userModel.get("username")})),this},_initModels:function(){this.model=new e.Model({step:0})},_initBinds:function(){this._keyDown=this._onKeyDown.bind(this),d(document).on("keydown",this._keyDown),this.listenTo(this.model,"change:step",this._onChangeStep),this.listenTo(this.model,"destroy",this._close),this.listenTo(this._editorModel,"change:edition",this._changeEdition)},_changeEdition:function(a){var b=!!a.get("edition");this.$el.toggleClass("is-editing",b)},_prev:function(){this._currentStep()>=1&&this.model.set("step",this._currentStep()-1)},_next:function(){this._currentStep()<=3&&this.model.set("step",this._currentStep()+1)},_currentStep:function(){return this.model.get("step")},_onClickNext:function(){this._next()},_onChangeStep:function(){var a=this;this.$el.removeClass("is-step"+this.model.previous("step"),function(){a.$el.addClass("is-step"+a._currentStep())}),this.$(".js-step").removeClass("is-step"+this.model.previous("step"),function(){a.$(".js-step").addClass("is-step"+a._currentStep())})},_close:function(){this._checkForgetStatus(),this.trigger("close",this)},_onKeyDown:function(a){a.stopPropagation(),a.which===j?this._prev():a.which===k&&this._next()},_checkForgetStatus:function(){this.$(".js-forget:checked").val()&&this._forget()},_forget:function(){this._onboardingNotification.setKey(i,!0),this._onboardingNotification.save()},clean:function(){d(document).off("keydown",this._keyDown),f.prototype.clean.apply(this)}})},{"../../../helpers/required-opts":1097,"./builder-view.tpl":499,backbone:"backbone","backbone/core-view":1127,jquery:"jquery"}],499:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="BuilderOnboarding-pad"></div>\n<div class="BuilderOnboarding-pad2"></div>\n<div class="BuilderOnboarding-contentWrapper is-step0 js-step">\n  <div class="BuilderOnboarding-body">\n    <div class="BuilderOnboarding-header is-step0">\n      <p class="CDB-Text Onboarding-headerTitle">'+(null==(__t=_t("builder-onboarding.title"))?"":_.escape(__t))+'</p>\n      <p class="CDB-Text Onboarding-headerText">'+(null==(__t=name)?"":_.escape(__t))+'</p>\n\n      <p class="CDB-Text BuilderOnboarding-description">\n        '+(null==(__t=_t("builder-onboarding.description"))?"":_.escape(__t))+'\n      </p>\n    </div>\n\n    <div class="BuilderOnboarding-footer is-step0">\n      <div class="BuilderOnboarding-footerButtons">\n        <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-start">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("builder-onboarding.take-tour"))?"":_.escape(__t))+'</span>\n        </button>\n\n        <button class="CDB-Button CDB-Button--primary CDB-Button--big js-close">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("builder-onboarding.edit-map"))?"":_.escape(__t))+'</span>\n        </button>\n      </div>\n\n      <div class="u-iBlock is-step1">\n        <input class="CDB-Checkbox js-forget" type="checkbox" id="forget-me" name="forget-me" value="true">\n        <span class="u-iBlock CDB-Checkbox-face"></span>\n        <label for="forget-me" class="BuilderOnboarding-forgetLabel Checkbox-label CDB-Text CDB-Size-small u-altTextColor u-lSpace">'+(null==(__t=_t("analyses-onboarding.never-show-message"))?"":_.escape(__t))+'</label>\n      </div>\n    </div>\n\n    <div class="BuilderOnboarding-step is-step1">\n      <p class="CDB-Text Onboarding-headerTitle">1/4</p>\n      <p class="CDB-Text Onboarding-headerText">'+(null==(__t=_t("builder-onboarding.toolbar.title"))?"":_.escape(__t))+'</p>\n      <p class="CDB-Text BuilderOnboarding-description">\n        '+(null==(__t=_t("builder-onboarding.toolbar.description"))?"":_.escape(__t))+'\n      </p>\n    </div>\n\n    <div class="BuilderOnboarding-step is-step2">\n      <p class="CDB-Text Onboarding-headerTitle">2/4</p>\n      <p class="CDB-Text Onboarding-headerText">'+(null==(__t=_t("builder-onboarding.configurator.title"))?"":_.escape(__t))+'</p>\n      <p class="CDB-Text BuilderOnboarding-description">\n        '+(null==(__t=_t("builder-onboarding.configurator.description"))?"":_.escape(__t))+'\n      </p>\n    </div>\n\n    <div class="BuilderOnboarding-step is-step3">\n      <p class="CDB-Text Onboarding-headerTitle">3/4</p>\n      <p class="CDB-Text Onboarding-headerText">'+(null==(__t=_t("builder-onboarding.map.title"))?"":_.escape(__t))+'</p>\n      <p class="CDB-Text BuilderOnboarding-description">\n        '+(null==(__t=_t("builder-onboarding.map.description"))?"":_.escape(__t))+'\n      </p>\n    </div>\n\n    <div class="BuilderOnboarding-step is-step4">\n      <p class="CDB-Text Onboarding-headerTitle">4/4</p>\n      <p class="CDB-Text Onboarding-headerText">'+(null==(__t=_t("builder-onboarding.widgets.title"))?"":_.escape(__t))+'</p>\n      <p class="CDB-Text BuilderOnboarding-description">\n        '+(null==(__t=_t("builder-onboarding.widgets.description"))?"":_.escape(__t))+'\n      </p>\n    </div>\n\n    <div class="BuilderOnboarding-footer is-step1 is-step2 is-step3">\n      <div class="BuilderOnboarding-footerButtons">\n        <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-close">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("builder-onboarding.skip"))?"":_.escape(__t))+'</span>\n        </button>\n\n        <button class="CDB-Button CDB-Button--primary CDB-Button--big js-next">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("builder-onboarding.next"))?"":_.escape(__t))+'</span>\n        </button>\n      </div>\n    </div>\n\n    <div class="BuilderOnboarding-footer is-step4">\n      <div class="BuilderOnboarding-footerButtons">\n        <button class="CDB-Button CDB-Button--primary CDB-Button--big js-close">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("builder-onboarding.edit-map"))?"":_.escape(__t))+'</span>\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class="BuilderOnboarding-pad3"></div>\n<div class="BuilderOnboarding-pad4"></div>\n<div class="BuilderOnboarding-pad5"></div>\n<div class="BuilderOnboarding-shadow"></div>\n';return __p}},{underscore:"underscore"}],500:[function(a,b,c){var d=a("./builder-view"),e=a("../../../helpers/required-opts"),f="onboarding",g=["onboardings","userModel","onboardingNotification","editorModel"];b.exports=function(){return{init:function(a){e(a,g,this)},launch:function(){this._onboardingNotification.getKey(f)||this._onboardings.create(function(){return new d({userModel:this._userModel,editorModel:this._editorModel,onboardingNotification:this._onboardingNotification})}.bind(this))}}}()},{"../../../helpers/required-opts":1097,"./builder-view":498}],501:[function(a,b,c){var d=a("underscore"),e=function(a,b){var c,e,f,g,h;if(!a||!a.view)throw new Error("view is required");if(!a.onboardingNotification)throw new Error("onboardingNotification is required");if(!a.notificationKey)throw new Error("notificationKey is required");if(!a.onboardings)throw new Error("onboardings is required");if(!b)throw new Error("viewOpts is required");return c=a.view,e=a.onboardingNotification,f=a.notificationKey,g=a.onboardings,h=b,{launch:function(a){e.getKey(f)||g.create(function(){var b=d.extend(h,{onboardingNotification:e,notificationKey:f});return new c(d.extend(b,a))})}}};b.exports=e},{underscore:"underscore"}],502:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("underscore"),g=a("backbone/core-view"),h=a("../../../helpers/required-opts"),i=["onboardingNotification","editorModel","template","numberOfSteps","selector","modifier","notificationKey"],j=37,k=39;b.exports=g.extend({className:"is-step0 is-opening",events:{"click .js-start":"_onClickNext","click .js-next":"_onClickNext","click .js-close":"_close","click .js-highlight":"_close"},initialize:function(a){h(a,i,this),this.$el.addClass(this._selector),this.model=new e.Model({step:-1}),this._defaultBodyPos={top:32,left:380},this._keyDown=this._onKeyDown.bind(this),this._initBinds()},render:function(){return this.$el.addClass(this._selector+this._modifier),this.$el.html(this._template()),this.model.get("step")===-1&&this._next(),this},_initBinds:function(){this.listenTo(this.model,"destroy",this._close),this.listenTo(this.model,"change:step",this._onChangeStep),this.listenTo(this._editorModel,"change:edition",this._changeEdition),d(document).on("keydown",this._keyDown)},_changeEdition:function(a){var b=!!a.get("edition");this.$el.toggleClass("is-editing",b)},_prev:function(){this._currentStep()>=1&&this.model.set("step",this._currentStep()-1)},_next:function(){this._currentStep()<this._numberOfSteps&&this.model.set("step",this._currentStep()+1)},_currentStep:function(){return this.model.get("step")},_onClickNext:function(){this._next()},_onChangeStep:function(){var a=this.model.previous("step"),b=this.model.get("step");this.$el.removeClass("is-step"+a,function(){this.$el.addClass("is-step"+b)}.bind(this)),this.$(".js-step").removeClass("is-step"+a).addClass("is-step"+b),this.$("."+this._selector+"-body").fadeOut(0).delay(200).fadeIn(100),this.$("."+this._selector+"-step.is-step"+a).css("display","none"),this.$("."+this._selector+"-footer.is-step"+a).css("display","none"),this.$("."+this._selector+"-step.is-step"+b).css("display","block"),this.$("."+this._selector+"-footer.is-step"+b).css("display","block"),this.$("."+this._selector+"-contentBody").css("display",0===b?"block":"none")},_close:function(){this._checkForgetStatus(),this.trigger("close",this)},_onKeyDown:function(a){a.stopPropagation(),a.which===j?this._prev():a.which===k&&this._next()},_checkForgetStatus:function(){this.$(".js-forget:checked").val()&&this._forget()},_forget:function(){this._onboardingNotification.setKey(this._notificationKey,!0),this._onboardingNotification.save()},clean:function(){d(document).off("keydown",this._keyDown),g.prototype.clean.apply(this)},_setMiddlePad:function(a,b,c){var e,g=d(window),h=this.$("."+this._selector+"-pads--left ."+this._selector+"-padTop"),i=this.$("."+this._selector+"-pads--left ."+this._selector+"-padMiddle"),j=this.$("."+this._selector+"-pads--left ."+this._selector+"-padBottom"),k=g.height(),l=g.width(),m=f.isString(a),n=0,o=0,p=0,q=0;m?(e=d(a),n=e.outerWidth(),o=e.outerHeight(),p=e.offset().left,q=e.offset().top):(n=a.width,o=a.height,p=a.left,q=a.top);var r=this._buildPadding(b);q-=r.top,p-=r.left,n+=r.left+r.right,o+=r.top+r.bottom,l-p>0&&l-p<n?n=l-p:l-p<=0&&(n=0),this.$("."+this._selector+"-toolbarOverlay").outerWidth(p),this.$("."+this._selector+"-contentWrapper").outerWidth(l-(p+n)),this.$("."+this._selector+"-pads--left").outerWidth(n),h.outerWidth(n),i.outerWidth(n),j.outerWidth(n);var s=q,t=o,u=k-(s+t);h.outerHeight(s),i.outerHeight(t),j.outerHeight(u),this.$("."+this._selector+"-body").css("top",c&&c.top?c.top:this._defaultBodyPos.top),this.$("."+this._selector+"-body").css("left",c&&c.left?c.left:this._defaultBodyPos.left)},_buildPadding:function(a){var b={top:0,right:0,bottom:0,left:0};return a&&(b.top=this._calculatePadding(a.top),b.right=this._calculatePadding(a.right),b.bottom=this._calculatePadding(a.bottom),b.left=this._calculatePadding(a.left)),b},_calculatePadding:function(a){return a&&f.isFinite(a)?a:0}})},{"../../../helpers/required-opts":1097,backbone:"backbone","backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],503:[function(a,b,c){var d=a("underscore"),e=a("../../generic/generic-onboarding-view"),f=a("../../../../editor/layers/layer-content-views/analyses/analyses-service"),g=a("./analysis-onboarding.tpl");b.exports=e.extend({events:e.extendEvents({"click .js-add-analysis":"_onAddAnalysisClicked"}),initialize:function(a){e.prototype.initialize.call(this,d.extend(a,{template:g,numberOfSteps:0,modifier:"--analysis"}))},_onAddAnalysisClicked:function(){this._checkForgetStatus(),this.clean(),f.addAnalysis()},_onChangeStep:function(){e.prototype._onChangeStep.call(this);var a=this.model.get("step");0===a&&this._setMiddlePad(".js-editorPanel")}})},{"../../../../editor/layers/layer-content-views/analyses/analyses-service":800,"../../generic/generic-onboarding-view":502,"./analysis-onboarding.tpl":504,underscore:"underscore"}],504:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LayerOnboarding-toolbarOverlay"></div>\n\n<div class="LayerOnboarding-pads LayerOnboarding-pads--left">\n  <div class="LayerOnboarding-padTop"></div>\n  <div class="LayerOnboarding-padMiddle js-highlight"></div>\n</div>\n\n<div class="LayerOnboarding-contentWrapper LayerOnboarding-contentWrapper--analysis is-step0 js-step">\n  <div class="LayerOnboarding-contentBody LayerOnboarding-contentBody--analysis is-step0 js-step">\n    <div class="Onboarding-body">\n      <p class="CDB-Text LayerOnboarding-headerTitle">'+(null==(__t=_t("analysis-onboarding.title"))?"":_.escape(__t))+'</p>\n\n      <p class="CDB-Text Onboarding-headerDescription">'+(null==(__t=_t("analysis-onboarding.description"))?"":_.escape(__t))+'</p>\n\n      <ul class="Onboarding-list">\n        <li class="Onboarding-listItem">\n          <p class="CDB-Text LayerOnboarding-description">'+(null==(__t=_t("analysis-onboarding.description-list.item1"))?"":_.escape(__t))+'</p>\n        </li>\n\n        <li class="Onboarding-listItem">\n          <p class="CDB-Text LayerOnboarding-description">'+(null==(__t=_t("analysis-onboarding.description-list.item2"))?"":__t)+'</p>\n        </li>\n\n        <li class="Onboarding-listItem">\n          <p class="CDB-Text LayerOnboarding-description">'+(null==(__t=_t("analysis-onboarding.description-list.item3"))?"":_.escape(__t))+'</p>\n        </li>\n\n        <li class="Onboarding-listItem">\n          <p class="CDB-Text LayerOnboarding-description">'+(null==(__t=_t("analysis-onboarding.description-list.item4"))?"":_.escape(__t))+'</p>\n        </li>\n      </ul>\n    </div>\n\n    <div class="LayerOnboarding-footer">\n      <div class="LayerOnboarding-footerButtons">\n        <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-close">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("analysis-onboarding.done"))?"":_.escape(__t))+'</span>\n        </button>\n\n        <button class="CDB-Button CDB-Button--primary CDB-Button--big js-add-analysis">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("analysis-onboarding.add-analysis"))?"":_.escape(__t))+'</span>\n        </button>\n      </div>\n\n      <div class="u-iBlock">\n        <input class="CDB-Checkbox js-forget" type="checkbox" id="forget-me" name="forget-me" value="true">\n        <span class="u-iBlock CDB-Checkbox-face"></span>\n        <label for="forget-me" class="Onboarding-forgetLabel Checkbox-label CDB-Text CDB-Size-small u-whiteTextColor is-light u-lSpace">'+(null==(__t=_t("analyses-onboarding.never-show-message"))?"":_.escape(__t))+"</label>\n      </div>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],505:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../generic/generic-onboarding-view"),g=a("./data-onboarding.tpl");b.exports=f.extend({initialize:function(a){f.prototype.initialize.call(this,d.extend(a,{template:g,numberOfSteps:4,modifier:"--data"}))},_onChangeStep:function(){f.prototype._onChangeStep.call(this);var a=this.model.get("step");if(0===a)this._setMiddlePad(".js-editorPanel");else if(1===a)this._setMiddlePad(".js-editorPanelHeader",{top:16,right:24,left:24});else if(2===a)this._setMiddlePad(".js-editorPanelContent",{top:8,right:24,left:24,bottom:-e(".js-optionsBar").outerHeight()});else if(3===a)this._setMiddlePad(".js-optionsBar",null,{top:-190});else if(4===a){var b=this._getFeatureEditionPosition();this._setMiddlePad(b,{top:8,right:8,bottom:8,left:8},{top:-270,left:-330})}},_getFeatureEditionPosition:function(){var a=e(".js-mapTableView").first(),b=e(".js-newGeometryView").first(),c=Math.min(a.length>0?a.offset().left:Number.MAX_VALUE,b.length>0?b.offset().left:Number.MAX_VALUE),d=Math.min(a.length>0?a.offset().top:Number.MAX_VALUE,b.length>0?b.offset().top:Number.MAX_VALUE),f=Math.max(a.length>0?a.offset().left+a.outerWidth():Number.MIN_VALUE,b.length>0?b.offset().left+b.outerWidth():Number.MIN_VALUE),g=Math.max(a.length>0?a.offset().top+a.outerHeight():Number.MIN_VALUE,b.length>0?b.offset().top+b.outerHeight():Number.MIN_VALUE);return{left:c,top:d,width:f-c,height:g-d}}})},{"../../generic/generic-onboarding-view":502,"./data-onboarding.tpl":506,jquery:"jquery",underscore:"underscore"}],506:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LayerOnboarding-toolbarOverlay"></div>\n\n<div class="LayerOnboarding-pads LayerOnboarding-pads--left">\n  <div class="LayerOnboarding-padTop"></div>\n  <div class="LayerOnboarding-padMiddle js-highlight">\n    <div class="LayerOnboarding-body is-step0 js-step">\n      <div class="LayerOnboarding-step is-step1">\n        <p class="CDB-Text LayerOnboarding-headerTitle">1/4</p>\n        <p class="CDB-Text LayerOnboarding-headerText">'+(null==(__t=_t("data-onboarding.layer-options.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description">\n          '+(null==(__t=_t("data-onboarding.layer-options.description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n      <div class="LayerOnboarding-step is-step2">\n        <p class="CDB-Text LayerOnboarding-headerTitle">2/4</p>\n        <p class="CDB-Text LayerOnboarding-headerText">'+(null==(__t=_t("data-onboarding.data-tab.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description">\n          '+(null==(__t=_t("data-onboarding.data-tab.description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n\n      <div class="LayerOnboarding-step is-step3">\n        <p class="CDB-Text LayerOnboarding-headerTitle">3/4</p>\n        <p class="CDB-Text LayerOnboarding-headerText">'+(null==(__t=_t("data-onboarding.sql-editor.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description">\n          '+(null==(__t=_t("data-onboarding.sql-editor.description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n\n      <div class="LayerOnboarding-step is-step4">\n        <p class="CDB-Text LayerOnboarding-headerTitle">4/4</p>\n        <p class="CDB-Text LayerOnboarding-headerText is-step4">'+(null==(__t=_t("data-onboarding.add-geometry.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description is-step4">\n          '+(null==(__t=_t("data-onboarding.add-geometry.description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n\n      <div class="LayerOnboarding-footer is-step1 is-step2 is-step3">\n        <div class="LayerOnboarding-footerButtons">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-close">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("data-onboarding.exit"))?"":_.escape(__t))+'</span>\n          </button>\n\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-next">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("data-onboarding.next"))?"":_.escape(__t))+'</span>\n          </button>\n        </div>\n      </div>\n\n      <div class="LayerOnboarding-footer is-step4">\n        <div class="LayerOnboarding-footerButtons">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-close">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("data-onboarding.add-geometry.edit-layer"))?"":_.escape(__t))+'</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="LayerOnboarding-padBottom"></div>\n</div>\n\n<div class="LayerOnboarding-contentWrapper is-step0 js-step">\n  <div class="LayerOnboarding-contentBody is-step0 js-step">\n    <div class="LayerOnboarding-header is-step0">\n      <p class="CDB-Text LayerOnboarding-headerTitle">'+(null==(__t=_t("data-onboarding.title"))?"":_.escape(__t))+'</p>\n\n      <p class="CDB-Text LayerOnboarding-description">\n        '+(null==(__t=_t("data-onboarding.description"))?"":__t)+'\n      </p>\n    </div>\n\n    <div class="LayerOnboarding-footer is-step0">\n      <div class="LayerOnboarding-footerButtons">\n        <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-start">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("data-onboarding.take-tour"))?"":_.escape(__t))+'</span>\n        </button>\n\n        <button class="CDB-Button CDB-Button--primary CDB-Button--big js-close">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("data-onboarding.edit-layer"))?"":_.escape(__t))+'</span>\n        </button>\n      </div>\n\n      <div class="u-iBlock is-step1">\n        <input class="CDB-Checkbox js-forget" type="checkbox" id="forget-me" name="forget-me" value="true">\n        <span class="u-iBlock CDB-Checkbox-face"></span>\n        <label for="forget-me" class="BuilderOnboarding-forgetLabel Checkbox-label CDB-Text CDB-Size-small u-whiteTextColor is-light u-lSpace">'+(null==(__t=_t("style-onboarding.never-show-message"))?"":_.escape(__t))+"</label>\n      </div>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],507:[function(a,b,c){b.exports="layer-onboarding"},{}],508:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../generic/generic-onboarding-view"),g=a("./style-onboarding.tpl"),h=a("./style-points-onboarding.tpl"),i=a("../../../../helpers/required-opts"),j=["geom"];b.exports=f.extend({initialize:function(a){i(a,j,this);var b=g,c="--style",e=2;"point"===this._geom&&(b=h,e=3),f.prototype.initialize.call(this,d.extend(a,{template:b,numberOfSteps:e,modifier:c}))},_onChangeStep:function(){f.prototype._onChangeStep.call(this);var a=this.model.get("step");switch(a){case 0:this._setMiddlePad(".js-editorPanel");break;case 1:this._setStepOne();break;case 2:this._setStepTwo();break;case 3:this._highlightOptionsBar()}},_setStepOne:function(){var a=e(".js-styleNoGeom");if(a.length>0)this._setMiddlePad(".js-styleNoGeom",{top:8,right:24,left:24,bottom:8});else if(3===this._numberOfSteps){var b=this._getAggregationPositionAndPadding();this._setMiddlePad(b.position,b.padding)}else this._highlightStyleProperties()},_setStepTwo:function(){2===this._numberOfSteps?this._highlightOptionsBar():this._highlightStyleProperties()},_highlightStyleProperties:function(){this._setMiddlePad(".js-styleProperties",{top:8,right:24,left:24,bottom:8})},_highlightOptionsBar:function(){this._setMiddlePad(".js-optionsBar",null,{top:-190})},_getAggregationPositionAndPadding:function(){var a=e(".js-aggregationTypes"),b=e(".js-aggregationOptions"),c=a.offset().left,d=a.offset().top,f=a.outerWidth(),g=a.outerHeight(),h=0;return b.length>0&&(g+=b.outerHeight(),h=8),{position:{top:d,left:c,width:f,height:g},padding:{top:8,right:24,left:24,bottom:h}}}})},{"../../../../helpers/required-opts":1097,"../../generic/generic-onboarding-view":502,"./style-onboarding.tpl":509,"./style-points-onboarding.tpl":510,jquery:"jquery",underscore:"underscore"}],509:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LayerOnboarding-toolbarOverlay"></div>\n\n<div class="LayerOnboarding-pads LayerOnboarding-pads--left">\n  <div class="LayerOnboarding-padTop"></div>\n  <div class="LayerOnboarding-padMiddle js-highlight">\n    <div class="LayerOnboarding-body is-step0 js-step">\n      <div class="LayerOnboarding-step is-step1">\n        <p class="CDB-Text LayerOnboarding-headerTitle">1/2</p>\n        <p class="CDB-Text LayerOnboarding-headerText">'+(null==(__t=_t("style-onboarding.style.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description LayerOnboarding-description--style">\n          '+(null==(__t=_t("style-onboarding.style.short-description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n\n      <div class="LayerOnboarding-step is-step2">\n        <p class="CDB-Text LayerOnboarding-headerTitle">2/2</p>\n        <p class="CDB-Text LayerOnboarding-headerText">'+(null==(__t=_t("style-onboarding.cartocss.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description">\n          '+(null==(__t=_t("style-onboarding.cartocss.description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n\n      <div class="LayerOnboarding-footer is-step1">\n        <div class="LayerOnboarding-footerButtons">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-close">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.exit"))?"":_.escape(__t))+'</span>\n          </button>\n\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-next">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.next"))?"":_.escape(__t))+'</span>\n          </button>\n        </div>\n      </div>\n\n      <div class="LayerOnboarding-footer is-step2">\n        <div class="LayerOnboarding-footerButtons">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-close">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.style-layer"))?"":_.escape(__t))+'</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="LayerOnboarding-padBottom"></div>\n</div>\n\n<div class="LayerOnboarding-contentWrapper is-step0 js-step">\n  <div class="LayerOnboarding-contentBody is-step0 js-step">\n    <div class="LayerOnboarding-header is-step0">\n      <p class="CDB-Text LayerOnboarding-headerTitle">'+(null==(__t=_t("style-onboarding.title"))?"":_.escape(__t))+'</p>\n\n      <p class="CDB-Text LayerOnboarding-description">\n        '+(null==(__t=_t("style-onboarding.description"))?"":_.escape(__t))+'\n      </p>\n    </div>\n\n    <div class="LayerOnboarding-footer is-step0">\n      <div class="LayerOnboarding-footerButtons">\n        <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-start">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.take-tour"))?"":_.escape(__t))+'</span>\n        </button>\n\n        <button class="CDB-Button CDB-Button--primary CDB-Button--big js-close">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.style-layer"))?"":_.escape(__t))+'</span>\n        </button>\n      </div>\n\n      <div class="u-iBlock is-step1">\n        <input class="CDB-Checkbox js-forget" type="checkbox" id="forget-me" name="forget-me" value="true">\n        <span class="u-iBlock CDB-Checkbox-face"></span>\n        <label for="forget-me" class="BuilderOnboarding-forgetLabel Checkbox-label CDB-Text CDB-Size-small u-whiteTextColor is-light u-lSpace">'+(null==(__t=_t("style-onboarding.never-show-message"))?"":_.escape(__t))+"</label>\n      </div>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],510:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LayerOnboarding-toolbarOverlay"></div>\n\n<div class="LayerOnboarding-pads LayerOnboarding-pads--left">\n  <div class="LayerOnboarding-padTop"></div>\n  <div class="LayerOnboarding-padMiddle js-highlight">\n    <div class="LayerOnboarding-body is-step0 js-step">\n      <div class="LayerOnboarding-step is-step1">\n        <p class="CDB-Text LayerOnboarding-headerTitle">1/3</p>\n        <p class="CDB-Text LayerOnboarding-headerText">'+(null==(__t=_t("style-onboarding.aggregation.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description">\n          '+(null==(__t=_t("style-onboarding.aggregation.description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n      <div class="LayerOnboarding-step is-step2">\n        <p class="CDB-Text LayerOnboarding-headerTitle">2/3</p>\n        <p class="CDB-Text LayerOnboarding-headerText">'+(null==(__t=_t("style-onboarding.style.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description LayerOnboarding-description--style">\n          '+(null==(__t=_t("style-onboarding.style.description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n\n      <div class="LayerOnboarding-step is-step3">\n        <p class="CDB-Text LayerOnboarding-headerTitle">3/3</p>\n        <p class="CDB-Text LayerOnboarding-headerText">'+(null==(__t=_t("style-onboarding.cartocss.title"))?"":_.escape(__t))+'</p>\n        <p class="CDB-Text LayerOnboarding-description">\n          '+(null==(__t=_t("style-onboarding.cartocss.description"))?"":_.escape(__t))+'\n        </p>\n      </div>\n\n      <div class="LayerOnboarding-footer is-step1 is-step2">\n        <div class="LayerOnboarding-footerButtons">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-close">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.exit"))?"":_.escape(__t))+'</span>\n          </button>\n\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-next">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.next"))?"":_.escape(__t))+'</span>\n          </button>\n        </div>\n      </div>\n\n      <div class="LayerOnboarding-footer is-step3">\n        <div class="LayerOnboarding-footerButtons">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-close">\n            <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.style-layer"))?"":_.escape(__t))+'</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="LayerOnboarding-padBottom"></div>\n</div>\n\n<div class="LayerOnboarding-contentWrapper is-step0 js-step">\n  <div class="LayerOnboarding-contentBody is-step0 js-step">\n    <div class="LayerOnboarding-header is-step0">\n      <p class="CDB-Text LayerOnboarding-headerTitle">'+(null==(__t=_t("style-onboarding.title"))?"":_.escape(__t))+'</p>\n\n      <p class="CDB-Text LayerOnboarding-description">\n        '+(null==(__t=_t("style-onboarding.description"))?"":_.escape(__t))+'\n      </p>\n    </div>\n\n    <div class="LayerOnboarding-footer is-step0">\n      <div class="LayerOnboarding-footerButtons">\n        <button class="CDB-Button CDB-Button--secondary CDB-Button--white CDB-Button--big Onboarding-footer--marginRight js-start">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.take-tour"))?"":_.escape(__t))+'</span>\n        </button>\n\n        <button class="CDB-Button CDB-Button--primary CDB-Button--big js-close">\n          <span class="CDB-Button-Text CDB-Text u-upperCase is-semibold CDB-Size-medium">'+(null==(__t=_t("style-onboarding.style-layer"))?"":_.escape(__t))+'</span>\n        </button>\n      </div>\n\n      <div class="u-iBlock is-step1">\n        <input class="CDB-Checkbox js-forget" type="checkbox" id="forget-me" name="forget-me" value="true">\n        <span class="u-iBlock CDB-Checkbox-face"></span>\n        <label for="forget-me" class="BuilderOnboarding-forgetLabel Checkbox-label CDB-Text CDB-Size-small u-whiteTextColor is-light u-lSpace">'+(null==(__t=_t("style-onboarding.never-show-message"))?"":_.escape(__t))+"</label>\n      </div>\n    </div>\n  </div>\n</div>\n";
return __p}},{underscore:"underscore"}],511:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=d.Model.extend({defaults:{show:!0,createContentView:function(){return new e},getContentClasses:function(){return null}},createContentView:function(){return this.get("createContentView")(this)},getContentClasses:function(){return this.get("contentClasses")},show:function(){this.set("show",!0)},hide:function(){this.set("show",!1)},isHidden:function(){return!this.get("show")},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone","backbone/core-view":1127}],512:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./onboarding.tpl"),g=120;b.exports=e.extend({className:"Onboarding is-opening",initialize:function(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},render:function(){this.clearSubViews(),this.$el.html(f());var a=this.model.createContentView();return this.$el.addClass(this.model.getContentClasses()),this.addView(a),a.bind("customEvent",this._onCustomEvent,this),a.bind("close",this._onClose,this),a.render(),this.$(".js-content").append(a.el),this},show:function(){this.model.show()},hide:function(){this.model.hide()},destroy:function(){this.model.destroy()},_onShowChange:function(a,b){b?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this._delayDueToAnimation(function(){this.$el.hide()}))},_onClose:function(){this.destroy()},_onCustomEvent:function(a){this.destroy(),this.trigger("customEvent",a,this)},_onDestroy:function(){this.hide(),d.invoke(this._subviews,"allOff"),this._delayDueToAnimation(function(){this.clean()})},_delayDueToAnimation:function(a){setTimeout(a.bind(this),g)}})},{"./onboarding.tpl":513,"backbone/core-view":1127,underscore:"underscore"}],513:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Onboarding js-content"></div>\n';return __p}},{underscore:"underscore"}],514:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./onboarding-view"),g=a("./onboarding-view-model"),h="destroyedOnboarding";b.exports=e.Model.extend({create:function(a,b){if(!d.isFunction(a))throw new Error("createContentView is required");return this._onboardingView||(this.trigger("willCreateOnboarding"),this._onboardingView=this._newOnboardingView(),this.trigger("didCreateOnboarding",this._onboardingView),document.body.appendChild(this._onboardingView.el)),this._onboardingView.model.set("createContentView",a),this._onboardingView.model.set("contentClasses",b),this._onboardingView.render(),this._onboardingView},onDestroyOnce:function(a,b){this.once(h,a,b)},destroy:function(){this._onboardingView&&this._onboardingView.model.destroy()},_newOnboardingView:function(){var a=new g;this._handleBodyClass(a),this._destroyOnEsc(a),this.listenToOnce(a,"destroy",function(){this._onboardingView=null,this.trigger.apply(this,[h].concat(Array.prototype.slice.call(arguments))),this.stopListening(a)});var b=new f({model:a});return b.bind("customEvent",function(a){this.trigger(a)},this),b},_destroyOnEsc:function(a){var b=function(b){27===b.keyCode&&a.destroy()};document.addEventListener("keydown",b),this.listenToOnce(a,"destroy",function(){document.removeEventListener("keydown",b)})},_handleBodyClass:function(a){var b="is-inDialog";document.body.classList.add(b),this.listenTo(a,"change:show",function(a,c){document.body.classList[c?"add":"remove"](b)}),this.listenToOnce(a,"destroy",function(){document.body.classList.remove(b)})}})},{"./onboarding-view":512,"./onboarding-view-model":511,backbone:"backbone",underscore:"underscore"}],515:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{per_page:20,page:1,q:""},initialize:function(a,b){if(!b.collection)throw new Error("collection is required");if(!b.collection.totalCount)throw new Error("collection requires to implement totalCount method");this.collection=b.collection,this._initBinds()},_initBinds:function(){this.collection.on("sync",this._updateStateFetched,this),this.collection.on("error",this._updateStateError,this)},fetch:function(){return this.trigger("fetching",this),this.collection.fetch({data:this.attributes},{reset:!0})},_updateStateFetched:function(){this.trigger("fetched",this)},_updateStateError:function(){this.trigger("error",this)}})},{backbone:"backbone"}],516:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("underscore"),g=a("../pagination/pagination-model"),h=a("./pagination-search-model"),i=a("../loading/render-loading"),j=a("../no-results/render-no-results"),k=a("../error/error-view"),l=a("./pagination-search.tpl"),m=a("../../helpers/utils"),n=a("../pagination/pagination-view"),o=a("./pagination.tpl"),p=["listCollection","createContentView"],q=13,r=27;b.exports=e.extend({events:{"click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","keydown .js-search-input":"_onKeyDown"},initialize:function(a){f.each(p,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._paginationModel=new g({current_page:1}),this._paginationSearchModel=new h({},{collection:this._listCollection}),this._stateModel=new d.Model({state:"idle"}),this._initBinds(),this._initPagination(),this._paginationSearchModel.fetch()},render:function(){return this.clearSubViews(),this.$el.html(l({q:this._paginationSearchModel.get("q")})),this._initViews(),this},_initBinds:function(){this._paginationSearchModel.on("fetching",this.showLoading,this),this._paginationSearchModel.on("fetched",this._updateStateFetched,this),this._paginationSearchModel.on("error",this.showError,this),this._paginationModel.bind("change:current_page",this._fetchByPagination,this),this._stateModel.on("change:state",this.render,this),this.add_related_model(this._paginationModel),this.add_related_model(this._stateModel),this.add_related_model(this._stateModel)},_fetchByPagination:function(){this._paginationSearchModel.set("page",this._paginationModel.get("current_page")),this._paginationSearchModel.fetch()},showError:function(){this._stateModel.set("state","error")},showLoading:function(){this._stateModel.set("state","loading")},_updateStateFetched:function(){this._paginationModel.set({per_page:this._paginationSearchModel.get("per_page"),total_count:this._listCollection.totalCount()}),this._listCollection.length>0?this._stateModel.set("state","show"):this._stateModel.set("state","no-results")},_initPagination:function(){this._paginationView=new n({className:"Pagination Pagination--search Pagination--searchShare",model:this._paginationModel,template:o}),this.addView(this._paginationView)},_initViews:function(){var a,b=this._stateModel.get("state");if(this.$el.append(this._paginationView.render().el),"loading"===b&&this._content().html(i({title:_t("components.pagination-search.loading.title")})),"error"===b){var c=new k({title:_t("components.pagination-search.error.title"),desc:_t("components.pagination-search.error.desc")});this._content().html(c.render().el),this.addView(c)}"show"===b&&(a=this._createContentView({hasOrganization:""===this._paginationSearchModel.get("q")}),this._content().html(a.render().el),this.addView(a)),"no-results"===b&&this._content().html(j({icon:"CDB-IconFont-defaultUser",title:_t("components.pagination-search.no-results.title"),desc:_t("components.pagination-search.no-results.desc")}))},_focusSearchInput:function(){this._searchInput().focus().val()},_onSearchClick:function(a){this.killEvent(a),this._searchInput().focus()},_onCleanSearchClick:function(a){this.killEvent(a),this._cleanSearch()},_onKeyDown:function(a){a.which===q?(this.killEvent(a),this._submitSearch()):a.which===r&&this._paginationSearchModel.get("q")&&(this.killEvent(a),this._cleanSearch())},_submitSearch:function(a){this._makeNewSearch(m.stripHTML(this._searchInput().val().trim()))},_cleanSearch:function(){this._searchInput().val(""),this._makeNewSearch("")},_makeNewSearch:function(a){this._paginationSearchModel.set({q:a,page:1}),this._paginationSearchModel.fetch()},_searchInput:function(){return this.$(".js-search-input")},_cleanSearchBtn:function(){return this.$(".js-clean-search")},_content:function(){return this.$(".js-content")}})},{"../../helpers/utils":1102,"../error/error-view":67,"../loading/render-loading":230,"../no-results/render-no-results":466,"../pagination/pagination-model":519,"../pagination/pagination-view":520,"./pagination-search-model":515,"./pagination-search.tpl":517,"./pagination.tpl":518,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],517:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Filters is-relative">\n  <div class="Filters-inner">\n    <div class="Filters-row Share-filtersRow js-filters">\n      <div class="Filters-typeItem Filters-typeItem--searchEnabler">\n        <p class="Filters-searchLink js-search-link u-alignCenter CDB-Text CDB-Size-medium u-upperCase">\n          <i class="Filters-searchLinkIcon CDB-IconFont CDB-IconFont-lens u-rSpace--xl"></i> '+(null==(__t=_t("components.pagination-search.filter.search"))?"":_.escape(__t))+'\n        </p>\n      </div>\n      <div class="Filters-typeItem Filters-typeItem--searchField">\n        <input class="Filters-searchInput CDB-Text CDB-Size-medium js-search-input" type="text" value="'+(null==(__t=q)?"":_.escape(__t))+'" placeholder="'+(null==(__t=_t("components.pagination-search.filter.placeholder"))?"":_.escape(__t))+'" />\n        ',""!==q&&(__p+='\n        <button type="button" class="CDB-Shape Filters-cleanSearch js-clean-search u-actionTextColor">\n          <div class="CDB-Shape-close is-blue is-large"></div>\n        </button>\n        '),__p+='\n      </div>\n    </div>\n  </div>\n</div>\n<div class="js-content"></div>';return __p}},{underscore:"underscore"}],518:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="CDB-Text CDB-Size-medium u-altTextColor Pagination-label">\n  Page '+(null==(__t=currentPage)?"":_.escape(__t))+" of "+(null==(__t=pagesCount)?"":_.escape(__t))+'\n</span>\n<ul class="Pagination-list CDB-Text CDB-Size-medium">\n  ',m.pagesToDisplay().forEach(function(a){__p+="\n    ",__p+=a>0?'\n      <li class="Pagination-listItem '+(null==(__t=m.isCurrentPage(a)?"is-current":"")?"":_.escape(__t))+'">\n        <button class="Pagination-listItemInner Pagination-listItemInner--link u-actionTextColor js-listItem" data-page="'+(null==(__t=a)?"":_.escape(__t))+'">'+(null==(__t=a)?"":_.escape(__t))+"</button>\n      </li>\n    ":'\n      <li class="Pagination-listItem Pagination-listItem">\n        <span class="Pagination-listItemInner Pagination-listItemInner--more">&hellip;</span>\n      </li>\n    ',__p+="\n  "}),__p+="\n</ul>\n";return __p}},{underscore:"underscore"}],519:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{total_count:0,per_page:10,current_page:1,display_count:5,extras_display_count:1,url_to:void 0},pagesCount:function(){return Math.max(Math.ceil(this.get("total_count")/this.get("per_page")),1)},isCurrentPage:function(a){return this.get("current_page")===a},shouldBeVisible:function(){var a=this.pagesCount();return this.get("total_count")>0&&a>1&&this.get("current_page")<=a},urlTo:function(a){if(this.hasUrl())return this.get("url_to")(a)},hasUrl:function(){return"function"==typeof this.get("url_to")},pagesToDisplay:function(){var a;return a=this._inLowRange()?1:this._inHighRange()?this.get("current_page")-this._startOffset():this.pagesCount()-this.get("display_count")+1,a=Math.max(a,1),this._withExtraPages(e.range(a,this._rangeEnd(a)))},_withExtraPages:function(a){var b=this.pagesCount(),c=this.get("extras_display_count"),d=e.range(1,c+1),f=e.range(b-c+1,b+1),g=a[0]-d.slice(-1)[0];2===g?d.push(a[0]-1):g>2&&d.push(-1);var h=f[0]-a.slice(-1);return 2===h&&f.unshift(f[0]-1),h>2&&f.unshift(-2),e.union(d,a,f)},_inLowRange:function(){return this.get("current_page")<this._startOffset()},_inHighRange:function(){return this.get("current_page")<this._highBoundary()},_highBoundary:function(){return this.pagesCount()-this._startOffset()},_startOffset:function(){return Math.floor(this.get("display_count")/2)},_rangeEnd:function(a){return Math.min(a+this.get("display_count"),this.pagesCount()+1)}})},{backbone:"backbone",underscore:"underscore"}],520:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("../../helpers/navigate-through-router"),g=a("./pagination.tpl");b.exports=d.extend({className:"Pagination",events:{"click .js-listItem":"_paginate"},initialize:function(a){if(this._routerModel=a.routerModel,this.router&&!this.model.hasUrl())throw new Error("since router is set the model must have a url method set too");this.template=a.template||g,this.model.bind("change",this.render,this)},render:function(){return this.model.shouldBeVisible()?(this.$el.html(this.template({m:this.model,pagesCount:this.model.pagesCount(),currentPage:this.model.get("current_page")})),this.$el.addClass(this.className),this.delegateEvents()):this.$el.html(""),this},_paginate:function(a){this._routerModel?f.apply(this,arguments):this.model.hasUrl()||this.killEvent(a);var b=e(a.target).data("page");this.model.set("current_page",b)}})},{"../../helpers/navigate-through-router":1094,"./pagination.tpl":521,"backbone/core-view":1127,jquery:"jquery"}],521:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="CDB-Text CDB-Size-medium u-altTextColor Pagination-label">\n  Page '+(null==(__t=currentPage)?"":_.escape(__t))+" of "+(null==(__t=pagesCount)?"":_.escape(__t))+'\n</span>\n<ul class="Pagination-list CDB-Text CDB-Size-medium">\n  ',m.pagesToDisplay().forEach(function(a){__p+="\n    ",__p+=a>0?'\n      <li class="Pagination-listItem '+(null==(__t=m.isCurrentPage(a)?"is-current":"")?"":_.escape(__t))+'">\n        <a class="Pagination-listItemInner Pagination-listItemInner--link js-listItem" href="'+(null==(__t=m.urlTo(a))?"":_.escape(__t))+'" data-page="'+(null==(__t=a)?"":_.escape(__t))+'">'+(null==(__t=a)?"":_.escape(__t))+"</a>\n      </li>\n    ":'\n      <li class="Pagination-listItem Pagination-listItem">\n        <span class="Pagination-listItemInner Pagination-listItemInner--more">&hellip;</span>\n      </li>\n    ',__p+="\n  "}),__p+="\n</ul>\n";return __p}},{underscore:"underscore"}],522:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=window.MutationObserver,g={top:8,bottom:8},h=function(a,b){var c={childList:!0,subtree:!0};if(f){var d=new f(b);return d.observe(a.get?a.get(0):a,c),d}},i=function(a){return a.closest(".js-perfect-scroll")},j=function(a,b,c){this.id=a,this.reference=b,this.popup=c,this.state={position:"bottom",scroll:0},c.attr("data-cid",a),c.attr("data-dialog",a)};j.prototype={append:function(a){this.mode=a;var b=this.popup.get(0),c=this.reference.get(0);"float"===a?document.body.appendChild(b):c.appendChild(b)},track:function(){"float"===this.mode&&(this.observer=h(this.popup,this.onChangeMutation.bind(this)),this.emitter=i(this.reference),this.repositionBinded=d.throttle(this.reposition.bind(this),15),this.emitter&&this.emitter.on("ps-scroll-x",this.repositionBinded).on("ps-scroll-y",this.repositionBinded),this.reposition())},onChangeMutation:function(a){d.each(a,function(a){var b=e(a.target),c=b.attr("data-cid");c||(c=b.closest("[data-cid]").attr("data-cid")),c===this.id&&this.repositionBinded()},this)},reposition:function(){if("float"===this.mode&&this.emitter){var a,b=this.emitter.get(0).scrollTop,c=e(window).height(),d=this.reference,f=this.popup,h=this.state,i=d.offset(),j=f.outerHeight(),k=i.top+d.outerHeight()+g.top,l=i.top-j-g.bottom;h.scroll===b?"top"===h.position?l<=0?(a=k,h.position="bottom"):a=l:k+j+g.bottom>=c?(a=l,h.position="top"):a=k:k+j+g.bottom>=c?(a=l,h.position="top"):(a=k,h.position="bottom"),a=a<0?g.top:Math.min(a,c-j-g.bottom),f.css({top:a,left:i.left}),h.scroll=b}},untrack:function(){this.observer&&this.observer.disconnect(),this.emitter&&this.emitter.off("ps-scroll-x",this.repositionBinded).off("ps-scroll-y",this.repositionBinded)},destroy:function(){this.untrack();var a=document.querySelector("[data-dialog="+this.id+"]");a&&a.parentNode.removeChild(a),this.emitter=null,this.reference=null,this.popup=null}},b.exports=j},{jquery:"jquery",underscore:"underscore"}],523:[function(a,b,c){var d=a("backbone/core-view"),e=a("./password-dialog.tpl"),f=a("underscore"),g=["onBack","onEdit"],h=27,i=13;b.exports=d.extend({className:"Editor-boxModal Editor-PrivacyDialog",events:{"click .js-back":"_onClickBack","keyup .js-input":"_onKeyUpInput"},initialize:function(a){f.each(g,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.$el.empty(),this.$el.html(e()),this},_onKeyUpInput:function(a){a.which===h&&this._onBack(),a.which===i&&this._onEdit&&this._onEdit(this.getValue())},_onClickBack:function(){this._onBack()},getValue:function(){return this.$(".js-input").val()}})},{"./password-dialog.tpl":524,"backbone/core-view":1127,underscore:"underscore"}],524:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical">\n      <button class="u-actionTextColor js-back CDB-Size-medium u-rSpace">\n        <i class="CDB-IconFont CDB-IconFont-arrowPrev"></i>\n      </button>\n      <span class="CDB-Text CDB-Size-medium">\n        '+(null==(__t=_t("components.modals.publish.privacy.password.title"))?"":_.escape(__t))+'\n      </span>\n    </li>\n  </ul>\n</div>\n<ul class="CustomList-list js-customList">\n  <li class="Privacy-passwordField CustomList-item">\n    <input type="password" class="CDB-Text CDB-InputText js-input" placeholder="'+(null==(__t=_t("components.modals.publish.privacy.password.placeholder"))?"":_.escape(__t))+'">\n  </li>\n</ul>\n';return __p}},{underscore:"underscore"}],525:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Privacy-cta u-flex">\n  <svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n      <path d="M10.0946667,4.4109223 C10.8886667,4.1368747 11.6846667,3.80147316 12.0073333,3.4715253 C12.7866667,2.67392407 12.7866667,1.37662907 12.0073333,0.579027844 C11.2513333,-0.193350099 9.934,-0.192668389 9.17866667,0.579027844 C8.74133333,1.0262299 8.29266667,2.36033726 8,3.37608583 C7.70666667,2.36033726 7.25866667,1.0262299 6.82133333,0.579027844 C6.066,-0.193350099 4.748,-0.192668389 3.99266667,0.579027844 C3.21266667,1.37662907 3.21266667,2.67392407 3.99266667,3.4715253 C4.316,3.80147316 5.11133333,4.1368747 5.90533333,4.4109223 L0.333333333,4.4109223 C0.149333333,4.4109223 0,4.56362544 0,4.75177753 L0,7.47861934 C0,7.66677142 0.149333333,7.81947456 0.333333333,7.81947456 L0.666666667,7.81947456 L0.666666667,15.6591448 C0.666666667,15.8472969 0.816,16 1,16 L15,16 C15.184,16 15.3333333,15.8472969 15.3333333,15.6591448 L15.3333333,7.81947456 L15.6666667,7.81947456 C15.8506667,7.81947456 16,7.66677142 16,7.47861934 L16,4.75177753 C16,4.56362544 15.8506667,4.4109223 15.6666667,4.4109223 L10.0946667,4.4109223 Z M6,6.95652174 L6,4.86956522 L10,4.86956522 L10,6.95652174 L6,6.95652174 L6,6.95652174 Z M10,7.65217391 L10,15.3043478 L6,15.3043478 L6,7.65217391 L10,7.65217391 L10,7.65217391 Z M9.80833133,1.08822938 C10.0510474,0.834996985 10.3727426,0.695652174 10.7169115,0.695652174 C11.0597961,0.695652174 11.3821334,0.834996985 11.6248495,1.08755946 C12.1250502,1.6101025 12.1250502,2.46023983 11.6248495,2.98278288 C11.2729754,3.34990286 9.79227867,3.85636766 8.66666667,4.17391304 C8.97102496,2.99953105 9.45581507,1.45534937 9.80833133,1.08822938 L9.80833133,1.08822938 Z M4.37515049,1.08822938 C4.6178666,0.834996985 4.94020387,0.695652174 5.28373064,0.695652174 C5.6266153,0.695652174 5.94895256,0.834996985 6.19166867,1.08755946 C6.54354282,1.45467944 7.02833293,2.99886112 7.33333333,4.17391304 C6.20707922,3.85569773 4.72638253,3.34990286 4.37515049,2.98278288 C3.87494984,2.46090976 3.87494984,1.61077243 4.37515049,1.08822938 L4.37515049,1.08822938 Z M0.666666667,4.86956522 L5.33333333,4.86956522 L5.33333333,6.95652174 L1,6.95652174 L0.666666667,6.95652174 L0.666666667,4.86956522 L0.666666667,4.86956522 Z M1.33333333,7.65217391 L5.33333333,7.65217391 L5.33333333,15.3043478 L1.33333333,15.3043478 L1.33333333,7.65217391 L1.33333333,7.65217391 Z M14.6666667,15.3043478 L10.6666667,15.3043478 L10.6666667,7.65217391 L14.6666667,7.65217391 L14.6666667,15.3043478 L14.6666667,15.3043478 Z M15.3333333,6.95652174 L15,6.95652174 L10.6666667,6.95652174 L10.6666667,4.86956522 L15.3333333,4.86956522 L15.3333333,6.95652174 L15.3333333,6.95652174 Z" id="Shape" fill="#9BC63B"></path>\n    </g>\n  </svg>\n  <div class="CDB-Text CDB-Size CDB-Size-small u-lSpace--xl">\n    <h3 class="u-secondaryTextColor">'+(null==(__t=_t("components.modals.publish.privacy.cta.title"))?"":_.escape(__t))+'</h3>\n    <a href="'+(null==(__t=upgradeURL)?"":_.escape(__t))+'">\n      '+(null==(__t=_t("components.modals.publish.privacy.cta.desc-"+(showTrial?"trial":"notrial")))?"":_.escape(__t))+"\n    </a>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],526:[function(a,b,c){var d=a("backbone/core-view"),e=a("../custom-list/custom-list-view"),f=a("../custom-list/custom-list-item-view"),g=a("./privacy-cta.tpl"),h=a("underscore"),i=["model","collection","userModel","configModel"];b.exports=d.extend({className:"Editor-boxModal Privacy-dialog",initialize:function(a){h.each(i,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.$el.empty(),this.clearSubViews(),this._renderList(),this},_renderList:function(){var a=this._collection.where({disabled:!0}),b=this._configModel.get("cartodb_com_hosted"),c=this._configModel.get("upgrade_url"),d=new e({model:this._model,collection:this._collection,ItemView:f});this.$el.append(d.render().el),this.addView(d),a.length>0&&!b&&c&&this.$el.append(g({upgradeURL:c,showTrial:this._userModel.canStartTrial()}))}})},{"../custom-list/custom-list-item-view":50,"../custom-list/custom-list-view":57,"./privacy-cta.tpl":525,"backbone/core-view":1127,underscore:"underscore"}],527:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("backbone/core-view"),g=a("./privacy-dialog-view"),h=a("./password-dialog-view"),i=a("../tab-pane/tab-pane-view"),j=a("../tab-pane/tab-pane-collection"),k=a("../custom-list/custom-list-collection"),l=a("./privacy-dropdown.tpl"),m=a("./tab-pane.tpl"),n=a("underscore"),o=27,p=["visDefinitionModel","userModel","privacyCollection","configModel"],q={public:"green",link:"orange",password:"orange-dark",private:"red"};b.exports=f.extend({events:{"click .js-toggle":"_onToggleDialogClicked"},initialize:function(a){n.each(p,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._triggerElementID="toggle"+this.cid,this.model=new e.Model({privacy:a.visDefinitionModel.get("privacy"),state:"show"}),this._onEscapePressed=this._onEscapePressed.bind(this),this._onDocumentElementClicked=this._onDocumentElementClicked.bind(this),this._configPrivacyCollection(),this._configPanes(),this._initBinds()},render:function(){var a=this.model.get("privacy"),b=q[a.toLowerCase()];return this.clearSubViews(),this._hideDialog(),this.$el.html(l({privacy:a,cssClass:b,isLoading:"loading"===this.model.get("state")})),this._initViews(),this},_initBinds:function(){this._customCollection.on("change:selected",function(a){a.get("disabled")||("password"===a.get("val")?this._showPasswordDialog():(this._onToggleDialogClicked(),this._setPrivacy(a.get("val"))))},this),this.add_related_model(this._customCollection),this.model.on("change:privacy",this._savePrivacy,this),this.model.on("change:state",this.render,this),this.add_related_model(this.model)},_makePrivacyDialog:function(){return new g({model:this.model,collection:this._customCollection,userModel:this._userModel,configModel:this._configModel})},_makePasswordDialog:function(){return new h({onBack:this._showPrivacyDialog.bind(this),onEdit:this._setPassword.bind(this)})},_setPrivacy:function(a){this.model.set({privacy:a})},_setPassword:function(a){""!==a&&(this._privacyCollection.passwordOption().set({password:a}),this.model.set({privacy:"password",password:a}))},_savePrivacy:function(){var a=this,b=this.model.get("privacy").toUpperCase(),c=this._visDefinitionModel;this.model.set({state:"loading"}),this._privacyCollection.searchByPrivacy(b).saveToVis(c,{success:function(){a.model.set({state:"show"})},error:function(){a.model.set({state:"error"})}})},_transformPrivacyOptions:function(){return this._privacyCollection.map(function(a){return{label:a.get("title"),val:a.get("privacy").toLowerCase(),disabled:a.get("disabled"),selected:a.get("selected"),renderOptions:{cssClass:a.get("cssClass")}}}).filter(Boolean)},_configPrivacyCollection:function(){var a=this._transformPrivacyOptions();this._customCollection=new k(a)},_configPanes:function(){var a=this,b=[{createContentView:a._showNoneDialog},{createContentView:a._makePrivacyDialog.bind(a)},{createContentView:a._makePasswordDialog.bind(a)}];this._collectionPane=new j(b)},_showNoneDialog:function(){return!1},_showPasswordDialog:function(){this._collectionPane.at(2).set({selected:!0})},_showPrivacyDialog:function(){this._customCollection.each(function(a){a.set({selected:!1},{silent:!0})}),this._collectionPane.at(1).set({selected:!0})},_onToggleDialogClicked:function(){this._isDialogVisible()?this._hideDialog():(this._initDocumentBinds(),this._showPrivacyDialog())},_isDialogVisible:function(){return this._collectionPane.at(0).get("selected")===!1},_hideDialog:function(){this._destroyDocumentBinds(),this._collectionPane.at(0).set({selected:!0})},_showDialog:function(){this._showPrivacyDialog()},_initViews:function(){var a=new i({collection:this._collectionPane,template:m});this.$(".js-dialog").append(a.render().$el),this.addView(a)},_initDocumentBinds:function(){d(document).on("keydown",this._onEscapePressed),d(document).on("mousedown",this._onDocumentElementClicked)},_destroyDocumentBinds:function(){d(document).off("keydown",this._onEscapePressed),d(document).off("mousedown",this._onDocumentElementClicked)},_onEscapePressed:function(a){a.which===o&&this._hideDialog()},_onDocumentElementClicked:function(a){var b=d(a.target);0===b.closest(this.$el).length&&0===b.closest(d("#"+this._triggerElementID)).length&&this._hideDialog()},clean:function(){this._destroyDocumentBinds(),f.prototype.clean.apply(this)}})},{"../custom-list/custom-list-collection":47,"../tab-pane/tab-pane-collection":538,"../tab-pane/tab-pane-view":549,"./password-dialog-view":523,"./privacy-dialog-view":526,"./privacy-dropdown.tpl":528,"./tab-pane.tpl":529,backbone:"backbone","backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],528:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Privacy-dropdown">\n  <button class="Privacy-dropdownTrigger Tag Tag-fill Tag-fill--'+(null==(__t=cssClass)?"":_.escape(__t))+' CDB-Text CDB-Size-small u-upperCase js-toggle">\n    ',__p+=isLoading?'\n      <div class="CDB-LoaderIcon CDB-LoaderIcon--small u-flex">\n        <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n          <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n        </svg>\n      </div>\n    ':"\n      "+(null==(__t=privacy)?"":_.escape(__t))+"\n    ",__p+='\n  </button>\n\n  <div class="js-dialog"></div>\n</div>\n';return __p}},{underscore:"underscore"}],529:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Tab-paneContent js-content"></div>\n';return __p}},{underscore:"underscore"}],530:[function(a,b,c){var d=a("backbone/core-view"),e=a("perfect-scrollbar"),f=a("./scroll.tpl"),g=window.MutationObserver;b.exports=d.extend({tagName:"div",className:"ScrollView",initialize:function(a){if(!a.createContentView)throw new Error("A factory createContentView function is required");this.options=a||{},this._type=a.type||"vertical",this._maxScroll=0,this._bindedCheckShadows=this._checkShadows.bind(this)},render:function(){this.clearSubViews(),this._html();var a=this.options.createContentView.call(this);return this._contentContainer().append(a.render().el),this.addView(a),this._applyScroll(),this._updateScrollWhenExist(),this},_html:function(){this.$el.html(f({type:this._type})),"horizontal"===this._type&&this.$el.addClass("ScrollView--horizontal")},_contentContainer:function(){return this.$(".js-content")},_wrapperContainer:function(){return this.$(".js-wrapper")},_updateScrollWhenExist:function(){if(g){var a=document.body,b=this._wrapperContainer().get(0),c=function(){a.contains(b)&&(e.update(b),d.disconnect())},d=new g(c);c();var f={subtree:!0,childList:!0};d.observe(a,f)}},_applyScroll:function(){e.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,suppressScrollX:"vertical"===this._type,suppressScrollY:"horizontal"===this._type}),this._bindScroll()},_bindScroll:function(){this._wrapperContainer().on("ps-dom-change",this._bindedCheckShadows).on("ps-x-reach-start",this._bindedCheckShadows).on("ps-x-reach-end",this._bindedCheckShadows).on("ps-y-reach-start",this._bindedCheckShadows).on("ps-y-reach-end",this._bindedCheckShadows).on("ps-scroll-x",this._bindedCheckShadows).on("ps-scroll-y",this._bindedCheckShadows)},_unbindScroll:function(){this._wrapperContainer().off("ps-dom-change",this._bindedCheckShadows).off("ps-x-reach-start",this._bindedCheckShadows).off("ps-x-reach-end",this._bindedCheckShadows).off("ps-y-reach-start",this._bindedCheckShadows).off("ps-y-reach-end",this._bindedCheckShadows).off("ps-scroll-x",this._bindedCheckShadows).off("ps-scroll-y",this._bindedCheckShadows)},_checkShadows:function(){var a,b,c,d,e;"horizontal"===this._type?(a=this._wrapperContainer().scrollLeft(),b=this._wrapperContainer().get(0).scrollWidth,c=this._wrapperContainer().outerWidth(),e=b-c,this.$("> .js-leftShadow").toggleClass("is-visible",a>0),this.$("> .js-rightShadow").toggleClass("is-visible",a<e)):(a=this._wrapperContainer().scrollTop(),b=this._wrapperContainer().get(0).scrollHeight,d=this._wrapperContainer().outerHeight(),e=b-d,this.$("> .js-topShadow").toggleClass("is-visible",a>0),this.$("> .js-bottomShadow").toggleClass("is-visible",a<e))},destroyScroll:function(){this._unbindScroll(),e.destroy(this._wrapperContainer().get(0))},clean:function(){this.destroyScroll(),d.prototype.clean.apply(this,arguments)}})},{"./scroll.tpl":531,"backbone/core-view":1127,
"perfect-scrollbar":"perfect-scrollbar"}],531:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",__p+="vertical"===type?'\n<div class="ScrollView-shadow ScrollView-shadow--top js-topShadow"></div>\n<div class="ScrollView-shadow ScrollView-shadow--bottom js-bottomShadow"></div>\n':'\n<div class="Carousel-shadow Carousel-shadow--left js-leftShadow"></div>\n<div class="Carousel-shadow Carousel-shadow--right js-rightShadow"></div>\n',__p+='\n<div class="ScrollView-wrapper js-wrapper js-perfect-scroll">\n  <div class="ScrollView-content js-content"></div>\n</div>\n';return __p}},{underscore:"underscore"}],532:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{position:0},initialize:function(a,b){this.stackLayoutItems=b.stackLayoutItems},goToStep:function(a){var b=this.stackLayoutItems.size();if(a>=b)throw new Error("There is no "+a+" stack view in the collection");this.set({position:a},{silent:!0}),this._rememberStep.apply(this,arguments),this._triggerPositionChanged(a,Array.prototype.slice.call(arguments,1))},nextStep:function(){var a=this.get("position"),b=++a;this.goToStep.apply(this,Array.prototype.concat.apply([b],arguments))},prevStep:function(){var a=this.get("position"),b=--a;this.goToStep.apply(this,Array.prototype.concat.apply([b],arguments))},goBack:function(){this._goBackToArguments&&this.goToStep.apply(this,this._goBackToArguments)},_triggerPositionChanged:function(a,b){this.trigger("positionChanged",a,Array.prototype.slice.call(b))},_rememberStep:function(){this._goBackToArguments=this._lastStepArguments||[0],this._lastStepArguments=arguments}})},{backbone:"backbone"}],533:[function(a,b,c){var d=a("backbone/core-view"),e=a("./stack-layout-model"),f=a("underscore");b.exports=d.extend({initialize:function(a){if(!this.collection||!this.collection.size())throw new Error("A collection of stack views should be provided");this.model=new e({},{stackLayoutItems:this.collection}),this.model.bind("positionChanged",this._onPositionChange,this)},render:function(){return this.clearSubViews(),this._genNewStackView(),this},_onPositionChange:function(a,b){this._removeOldStackView(),this._genNewStackView(f.flatten(b)),this.trigger("positionChanged",this)},getCurrentPosition:function(){return this.model.get("position")},_removeOldStackView:function(){var a=this._getCurrentView();a&&(a.clean(),this.removeView(a))},_getCurrentView:function(){for(var a in this._subviews)break;return this._subviews[a]},_genNewStackView:function(){var a=[this.model].concat([f.flatten(arguments)]),b=this.collection.at(this.model.get("position")).get("createStackView").apply(this,a);this.$el.html(b.render().el),this.addView(b)}})},{"./stack-layout-model":532,"backbone/core-view":1127,underscore:"underscore"}],534:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./tab-pane-view.js"),g=a("./tab-pane-collection"),h=a("./tab-pane-icon-view");b.exports=function(a,b){b=b||{};var c=b.tabPaneItemIconOptions,i=a.map(function(a){return["icon","createContentView"].forEach(function(b){if(!a[b])throw new Error(b+" should be provided")}),{selected:a.selected,icon:a.icon,createButtonView:function(){return new h(d.extend({model:this},c))},createContentView:function(){return a.createContentView&&a.createContentView()||new e}}}),j=new g(i),k=b.tabPaneOptions;return new f(d.extend({collection:j},k))}},{"./tab-pane-collection":538,"./tab-pane-icon-view":542,"./tab-pane-view.js":549,"backbone/core-view":1127,underscore:"underscore"}],535:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./tab-pane-view.js"),g=a("./tab-pane-collection"),h=a("./tab-pane-mixed-view"),i=a("./tab-pane-color-view");b.exports=function(a,b){b=b||{};var c=b.tabPaneItemLabelOptions,j=a.map(function(a){return["label","createContentView"].forEach(function(b){if(!a[b])throw new Error(b+" should be provided")}),{name:a.name,selected:a.selected,label:a.label,color:a.color,kind:a.kind,selectedChild:a.selectedChild,createButtonView:function(){return"color"===a.type?new i(d.extend({model:this},c)):new h(d.extend({model:this,type:a.type},c))},createContentView:function(){return a.createContentView&&a.createContentView()||new e}}});this.collection=new g(j);var k=b.tabPaneOptions;return new f(d.extend({collection:this.collection},k))}},{"./tab-pane-collection":538,"./tab-pane-color-view":539,"./tab-pane-mixed-view":547,"./tab-pane-view.js":549,"backbone/core-view":1127,underscore:"underscore"}],536:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./tab-pane-view.js"),g=a("./tab-pane-collection"),h=a("./tab-pane-template-view");b.exports=function(a,b){b=b||{};var c=b.tabPaneTemplateOptions,i=a.map(function(a){return["label","name","createContentView"].forEach(function(b){if(!a[b])throw new Error(b+" should be provided")}),{name:a.name,selected:a.selected,label:a.label,createButtonView:function(){return new h(d.extend({model:this},c))},createContentView:function(){return a.createContentView&&a.createContentView()||new e.core.View}}}),j=new g(i),k=b.tabPaneOptions;return new f(d.extend({collection:j},k))}},{"./tab-pane-collection":538,"./tab-pane-template-view":548,"./tab-pane-view.js":549,"cartodb.js":"cartodb.js",underscore:"underscore"}],537:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./tab-pane-view.js"),g=a("./tab-pane-collection"),h=a("./tab-pane-label-view");b.exports=function(a,b){b=b||{};var c=b.tabPaneItemLabelOptions,i=a.map(function(a){return["label","createContentView"].forEach(function(b){if(!a[b])throw new Error(b+" should be provided")}),{name:a.name,selected:a.selected,label:a.label,selectedChild:a.selectedChild,createButtonView:function(){return new h(d.extend({model:this},c))},createContentView:function(){return a.createContentView&&a.createContentView()||new e}}});this.collection=new g(i);var j=b.tabPaneOptions;return new f(d.extend({collection:this.collection},j))}},{"./tab-pane-collection":538,"./tab-pane-label-view":545,"./tab-pane-view.js":549,"backbone/core-view":1127,underscore:"underscore"}],538:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Collection.extend({constructor:function(a,b){b=e.extend(b||{},{silent:!1}),d.Collection.prototype.constructor.call(this,a,b)},initialize:function(){this.bind("reset",this._setSelected,this),this.bind("change:selected",this._onSelectedChange,this),this._setSelected()},getSelected:function(){return this.find(function(a){return a.get("selected")})},_setSelected:function(){var a=this.getSelected();!a&&this.size()>0&&this.at(0).set("selected",!0)},_onSelectedChange:function(a,b){b&&this.each(function(b){b!==a&&b.set("selected",!1)},this)},select:function(a,b){var c=this.find(function(c){return c.get(a)===b},this);c&&c.set("selected",!0)}})},{backbone:"backbone",underscore:"underscore"}],539:[function(a,b,c){var d=a("backbone/core-view"),e=a("./tab-pane-color.tpl");b.exports=d.extend({className:"Label",initialize:function(){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:label",this.render,this)},render:function(){return this.clearSubViews(),this.$el.html(e({color:this.model.get("label"),selectedChild:this.model.get("selectedChild")||""})),this}})},{"./tab-pane-color.tpl":540,"backbone/core-view":1127}],540:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ColorBar ColorBar--inline" style="background-color: '+(null==(__t=color)?"":_.escape(__t))+';"></div> ',selectedChild&&(__p+=' <span class="CDB-NavSubmenu-status js-NavSubmenu-status u-hintTextColor">'+(null==(__t=selectedChild)?"":_.escape(__t))+"</span>"),__p+="\n";return __p}},{underscore:"underscore"}],541:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","text"===type?(__p+="\n"+(null==(__t=label)?"":_.escape(__t)),selectedChild&&(__p+=' <span class="CDB-NavSubmenu-status js-NavSubmenu-status u-hintTextColor">'+(null==(__t=selectedChild)?"":_.escape(__t))+"</span>"),__p+="\n"):__p+="custom-marker"===kind?"\n<div class='Editor-categoryImagesTag CDB-Text CDB-FontSize-small u-altTextColor is-semibold u-upperCase'>"+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":_.escape(__t))+"</div>\n":'\n<div class="Tab-paneLabelImageContainer js-image-container"></div>\n',__p+="\n";return __p}},{underscore:"underscore"}],542:[function(a,b,c){var d=a("backbone/core-view"),e=a("./tab-pane-icon.tpl");b.exports=d.extend({tagName:"i",className:"CDB-IconFont",initialize:function(a){if(!this.model)throw new Error("A model should be provided");this.template=this.options.template||e},render:function(){return this.$el.html(this.template({icon:this.model.get("icon")})),this}})},{"./tab-pane-icon.tpl":543,"backbone/core-view":1127}],543:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<i class="CDB-IconFont CDB-IconFont-'+(null==(__t=icon)?"":_.escape(__t))+'"></i>\n';return __p}},{underscore:"underscore"}],544:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({tagName:"button",events:{click:"_onButtonClicked"},initialize:function(){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:selected",this._onChangeSelected,this)},render:function(){var a=this.model.get("createButtonView").call(this.model);return this.addView(a),this.$el.append(a.render().$el),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this},_onChangeSelected:function(){this.$el.toggleClass("is-selected",!!this.model.get("selected"))},_onButtonClicked:function(a){a.preventDefault(),this.model.set("selected",!0)}})},{"backbone/core-view":1127}],545:[function(a,b,c){var d=a("backbone/core-view"),e=a("./tab-pane-label.tpl");b.exports=d.extend({className:"Label",initialize:function(){if(!this.model)throw new Error("A model should be provided")},render:function(){return this.$el.html(e({label:this.model.get("label"),selectedChild:this.model.get("selectedChild")||""})),this}})},{"./tab-pane-label.tpl":546,"backbone/core-view":1127}],546:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+(null==(__t=label)?"":_.escape(__t)),selectedChild&&(__p+=' <span class="CDB-NavSubmenu-status js-NavSubmenu-status u-hintTextColor">'+(null==(__t=selectedChild)?"":_.escape(__t))+"</span>"),__p+="\n";return __p}},{underscore:"underscore"}],547:[function(a,b,c){var d=a("./tab-pane-file.tpl"),e=a("backbone/core-view"),f=a("../img-loader-view");b.exports=e.extend({tagName:"i",className:"CDB-IconFont",initialize:function(a){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:label",this.render,this),this.model.bind("change:color",this._updateColor,this)},render:function(){this.clearSubViews();var a=this._getLabelType();return this.$el.html(d({type:a,label:this.model.get("label"),kind:this.model.get("kind"),selectedChild:this.model.get("selectedChild")||""})),"file"===a&&this._loadImages(),this},_loadImages:function(){this.iconView=new f({imageClass:"Tab-paneLabelImage",imageUrl:this._getImageURL(),color:this.model.get("color")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_updateColor:function(){this.iconView&&this.iconView.updateImageColor(this.model.get("color"))},_getLabelType:function(){var a=this.model.get("label");return a&&a.match(/^http/)?"file":"text"},_getImageURL:function(){return this.model.get("label")}})},{"../img-loader-view":213,"./tab-pane-file.tpl":541,"backbone/core-view":1127}],548:[function(a,b,c){var d=a("cartodb.js");b.exports=d.core.View.extend({initialize:function(a){if(!this.model)throw new Error("A model should be provided");if(!a.template)throw new Error("A template should be provided");this.template=a.template},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})},{"cartodb.js":"cartodb.js"}],549:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./tab-pane-item-view.js"),g=a("./tab-pane.tpl");b.exports=e.extend({className:"Tab-pane",initialize:function(a){if(!this.collection)throw new Error("A TabPaneCollection should be provided");this._tabPaneItemOptions=this.options.tabPaneItemOptions,this._createContentKey=this.options.createContentKey||"createContentView",this.template=this.options.template||g,this.collection.bind("change:selected",this._renderSelected,this)},render:function(){this.clearSubViews(),this.$el.empty(),this.$el.html(this.template(this.options)),this._renderCollection();var a=this.getSelectedTabPane();return a&&this._renderSelected(a,!0),this},getSelectedTabPane:function(){return this.collection.getSelected()},getTabPane:function(a){return d.first(this.collection.where({name:a}))},getSelectedTabPaneName:function(){var a=this.getSelectedTabPane();return a?a.get("name"):null},setSelectedTabPaneByName:function(a){return this.collection.select("name",a)},_renderSelected:function(a,b){b&&(this._selectedView&&(this._selectedView.clean(),this.removeView(this._selectedView)),this._selectedView=this._renderTabPaneContentView(a))},_renderCollection:function(){this.collection.each(function(a){a.get("createButtonView")&&this._renderTabPaneItemView(a)},this)},_renderTabPaneItemView:function(a){var b=new f(d.extend({model:a},this._tabPaneItemOptions));this.addView(b),this.$(".js-menu").append(b.render().el)},_renderTabPaneContentView:function(a){var b=a.get(this._createContentKey).call(a);return b&&(this.addView(b),this.$(".js-content").append(b.render().el)),b},changeStyleMenu:function(a){this.$(".js-theme").toggleClass("is-dark",a.isEditing())}})},{"./tab-pane-item-view.js":544,"./tab-pane.tpl":550,"backbone/core-view":1127,underscore:"underscore"}],550:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-menu"></div>\n<div class="Tab-paneContent js-content"></div>\n';return __p}},{underscore:"underscore"}],551:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("components.table.rows.destroy.title",{cartodb_id:cartodb_id}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("components.table.rows.destroy.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.rows.destroy.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.rows.destroy.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],552:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<td class="Table-cellItem" data-attribute="'+(null==(__t=columnName)?"":_.escape(__t))+'" title="'+(null==(__t=value)?"":_.escape(__t))+"\" data-clipboard-text='"+(null==(__t=value)?"":_.escape(__t))+"'>\n  <div class=\"\n      Table-cell u-flex u-justifySpace\n      "+(null==(__t="cartodb_id"===columnName||"geometry"===type&&"point"!==geometry?"Table-cell--short":"")?"":_.escape(__t))+'\n    ">\n    <p class="\n      CDB-Text CDB-Size-medium\n      u-ellipsis u-rSpace--xl\n      '+(null==(__t="number"===type&&"cartodb_id"!==columnName?"is-number":"")?"":_.escape(__t))+"\n      "+(null==(__t=null===value?"is-null":"")?"":_.escape(__t))+"\n      "+(null==(__t="cartodb_id"===columnName?"is-cartodbId":"")?"":_.escape(__t))+'\n      js-value\n    ">\n      '+(null==(__t=null===value?"null":formattedValue)?"":_.escape(__t))+"\n    </p>\n\n    ","cartodb_id"!==columnName&&(__p+='\n      <button class="CDB-Shape-threePoints is-blue is-small Table-cellItemOptions js-cellOptions">\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n      </button>\n    '),__p+="\n  </div>\n</td>\n";return __p}},{underscore:"underscore"}],553:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./table-body-cell.tpl"),g=a("../../../helpers/point-geojson-parser"),h={geometry:g};b.exports=d.extend({className:"Table-row",tagName:"tr",options:{simpleGeometry:""},initialize:function(a){if(!a.columnsCollection)throw new Error("columnsCollection is required");if(!a.tableViewModel)throw new Error("tableViewModel is required");this._columnsCollection=a.columnsCollection,this._tableViewModel=a.tableViewModel,this.el.setAttribute("data-model",this.model.cid),this._initBinds()},render:function(){return this.$el.empty(),this._generateRowsHTML(),this},_initBinds:function(){this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this)},_generateRowsHTML:function(){for(var a=[],b=0,c=this._columnsCollection.size();b<c;b++){var d=this._columnsCollection.at(b),e=d.get("name");("the_geom_webmercator"!==e||this._tableViewModel.isDisabled()&&"the_geom_webmercator"===e)&&(a[b]=this._generateCellHTML(e))}this.el.innerHTML=a.join("")},_generateCellHTML:function(a){var b=this.options.simpleGeometry,c=e.first(this._columnsCollection.where({name:a})),d=c.get("type"),g=this.model.get(a),i=g;return"geometry"===d?i="point"===b?h[d](g):b&&b.charAt(0).toUpperCase()+b.slice(1):h[d]&&(i=h[d](g)),f({value:g,formattedValue:i,type:d,columnName:a,geometry:b})}})},{"../../../helpers/point-geojson-parser":1096,"./table-body-cell.tpl":552,"backbone/core-view":1127,underscore:"underscore"}],554:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("underscore"),g=a("clipboard"),h=a("./table-body-row-view"),i=a("../../context-menu/context-menu-view"),j=a("../../custom-list/custom-list-collection"),k=a("../operations/table-add-row"),l=a("../operations/table-remove-row"),m=a("../operations/table-edit-cell"),n=a("../../modals/confirmation/modal-confirmation-view"),o=a("../paginator/table-paginator-view"),p=a("./table-body.tpl"),q=a("../../loading/render-loading"),r=a("../../error/error-view"),s=a("./table-no-rows.tpl"),t=a("../editors/editors-service-model"),u=a("../editors/types/editor-model"),v=a("../../../helpers/error-parser"),w=a("../../../helpers/magic-positioner"),x=a("../../../helpers/required-opts"),y={string:a("../editors/types/editor-string-view"),number:a("../editors/types/editor-base-view"),boolean:a("../editors/types/editor-boolean-view"),date:a("../editors/types/editor-date-view"),default:a("../editors/types/editor-string-view")},z=["columnsCollection","modals","queryGeometryModel","querySchemaModel","rowsCollection","tableViewModel"];b.exports=d.extend({className:"Table-body",tagName:"div",events:{click:"_onClick",dblclick:"_onDblClick"},initialize:function(a){x(a,z,this),this._editors=new t,this._closeEditor=this._closeEditor.bind(this),this._hideContextMenu=this._hideContextMenu.bind(this),this._initBinds()},render:function(){return this.clearSubViews(),this._destroyScrollBinding(),this.$el.empty(),!this._querySchemaModel.isFetched()||this._queryGeometryModel.isFetching()||this._rowsCollection.isFetching()?this._renderQueryState():this._rowsCollection.size()?(this.$el.html(p()),this._rowsCollection.each(this._renderBodyRow,this),this._initPaginator()):this._renderNoRows(),this.$el.toggleClass("Table-body--relative",!!this._tableViewModel.get("relativePositionated")),this},_initBinds:function(){this._queryGeometryModel.bind("change:status",this.render,this),this._querySchemaModel.bind("change:status",this.render,this),this._rowsCollection.bind("reset",f.debounce(this.render.bind(this),20),this),this._rowsCollection.bind("add",function(a){1===this._rowsCollection.size()?this.render():(this._renderBodyRow(a),this._scrollToBottom())},this),this._rowsCollection.bind("remove",this._onRemoveRow,this),this._rowsCollection.bind("fail",function(a,b){(!b||b&&"abort"!==b.statusText)&&this._renderError(v(b))},this),this.add_related_model(this._queryGeometryModel),this.add_related_model(this._querySchemaModel),this.add_related_model(this._rowsCollection)},_renderQueryState:function(){var a=this._querySchemaModel.get("status"),b=this._querySchemaModel.get("ready"),c=this._queryGeometryModel.get("status");b&&"unavailable"===a&&"unavailable"===c?this._renderError(this._querySchemaModel.get("query_errors")):this._renderLoading()},_renderLoading:function(){this.$el.html(q({title:_t("components.table.rows.loading.title")}))},_renderError:function(a){var b=new r({title:_t("components.table.rows.error.title"),desc:a||_t("components.table.rows.error.desc")});this.addView(b),this.$el.html(b.render().el)},_renderNoRows:function(){this.$el.html(s({page:this._tableViewModel.get("page"),customQuery:this._tableViewModel.isCustomQueryApplied()}))},_initPaginator:function(){var a=new o({rowsCollection:this._rowsCollection,tableViewModel:this._tableViewModel}),b=e("body");this._tableViewModel.get("relativePositionated")&&(b=this.$el.closest(".Table").parent()),b.append(a.render().el),this.addView(a)},_initScrollBinding:function(){e(".Table").scroll(this._hideContextMenu),this.$(".js-tbody").scroll(this._hideContextMenu)},_destroyScrollBinding:function(){e(".Table").off("scroll",this._hideContextMenu),this.$(".js-tbody").off("scroll",this._hideContextMenu)},_renderBodyRow:function(a){var b=new h({model:a,columnsCollection:this._columnsCollection,simpleGeometry:this._queryGeometryModel.get("simple_geom"),tableViewModel:this._tableViewModel});this.addView(b),this.$(".js-tbody").append(b.render().el)},_onRemoveRow:function(){if(!this._rowsCollection.size()){this._rowsCollection.resetFetch();var a=this._tableViewModel.get("page");a>0?this._tableViewModel.set("page",a-1):this.render()}},_hasContextMenu:function(){return this._menuView},_hideContextMenu:function(){this._unhighlightCell(),this._destroyScrollBinding(),this._menuView.collection.unbind(null,null,this),this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_highlightCell:function(a,b){a.addClass("is-highlighted"),b.addClass("is-highlighted")},_unhighlightCell:function(){this.$(".Table-cellItem.is-highlighted, .Table-row.is-highlighted").removeClass("is-highlighted")},_showContextMenu:function(a){var b=this,c={x:a.clientX,y:a.clientY},d=e(a.target).closest(".Table-row"),f=e(a.target).closest(".Table-cellItem"),g=d.data("model"),h=f.data("attribute"),k=b._rowsCollection.get({cid:g}),l=[];if(l.push({label:_t("components.table.rows.options.copy"),val:"copy",action:function(){b._copyValue(f)}}),this._tableViewModel.isDisabled()||(l=[{label:_t("components.table.rows.options.edit"),val:"edit",action:function(){b._editCell(k,h)}},{label:_t("components.table.rows.options.create"),val:"create",action:function(){b._addRow()}}].concat(l),l.push({label:_t("components.table.rows.options.delete"),val:"delete",destructive:!0,action:function(){b._removeRow(k)}})),!l.length)return!1;var m=new j(l);this._menuView=new i({className:"Table-rowMenu "+i.prototype.className,collection:m,triggerElementID:g,position:c}),this._menuView.$el.css(w({parentView:e("body"),posX:c.x,posY:c.y})),m.bind("change:selected",function(a){var b=a.get("action");b&&b()},this),this._menuView.model.bind("change:visible",function(a,b){this._hasContextMenu()&&!b&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView),this._highlightCell(f,d),this._initScrollBinding()},_onClick:function(a){var b=e(a.target).hasClass("js-cellOptions");b&&(this._hasContextMenu()?this._hideContextMenu():this._showContextMenu(a))},_onDblClick:function(a){var b=e(a.target).closest(".Table-cellItem"),c=e(a.target).hasClass("js-cellOptions");if(b&&!c){var d=b.closest(".Table-row"),f=d.data("model"),g=b.data("attribute"),h=this._rowsCollection.get({cid:f});!this._tableViewModel.isDisabled()&&h&&g&&"cartodb_id"!==g&&this._editCell(h,g)}},_copyValue:function(a){this._clipboard=new g(a.get(0)),a.click(),this._clipboard.destroy()},_addRow:function(){k({rowsCollection:this._rowsCollection})},_initEditorScrollBinding:function(){e(".Table").scroll(this._closeEditor),this.$(".js-tbody").scroll(this._closeEditor)},_destroyEditorScrollBinding:function(){e(".Table").unbind("scroll",this._closeEditor),this.$(".js-tbody").unbind("scroll",this._closeEditor)},_closeEditor:function(){this._unhighlightCell(),this._destroyEditorScrollBinding(),this._editors.unbind(null,null,this),this._editors.destroy()},_saveValue:function(a,b,c){a.get(b)!==c&&m({rowModel:a,attribute:b,newValue:c})},_doCellEdition:function(a,b){var c=this.$('[data-model="'+a.cid+'"]'),d=c.find('[data-attribute="'+b+'"]'),e=d.find(".js-cellOptions"),g=f.first(this._columnsCollection.where({name:b})),h=g.get("type");this._highlightCell(d,c),this._initEditorScrollBinding();var i=new u({type:h,value:a.get(b)});this._editors.bind("destroyedEditor",this._closeEditor,this),this._editors.bind("confirmedEditor",function(){i.isValid()&&this._saveValue(a,b,i.get("value"))},this);var j=e.offset();d.index()>1&&(j.right=window.innerWidth-j.left,delete j.left),this._rowsCollection.size()>4&&c.index()+2>=this._rowsCollection.size()-1?(j.bottom=window.innerHeight-j.top,delete j.top):j.top=j.top+20;var k=y[h];k||(k=y.default),this._editors.create(function(a){return new k({editorModel:a,model:i})},j)},_editCell:function(a,b){var c=this._doCellEdition.bind(this,a,b);a.fetchRowIfGeomIsNotLoaded(c)},_removeRow:function(b){var c=this;this._modals.create(function(d){return new n({modalModel:d,template:a("./modals-templates/remove-table-row.tpl"),renderOpts:{cartodb_id:b.get("cartodb_id")},loadingTitle:_t("components.table.rows.destroy.loading",{cartodb_id:b.get("cartodb_id")}),runAction:function(){l({tableViewModel:c._tableViewModel,rowModel:b,onSuccess:function(){d.destroy()},onError:function(a){d.destroy()}})}})})},_scrollToBottom:function(){var a=this.$(".js-tbody").get(0).scrollHeight;this.$(".js-tbody").animate({scrollTop:a},"slow")},clean:function(){this._destroyScrollBinding(),d.prototype.clean.apply(this)}})},{"../../../helpers/error-parser":1090,"../../../helpers/magic-positioner":1093,"../../../helpers/required-opts":1097,"../../context-menu/context-menu-view":39,"../../custom-list/custom-list-collection":47,"../../error/error-view":67,"../../loading/render-loading":230,"../../modals/confirmation/modal-confirmation-view":404,"../editors/editors-service-model":559,"../editors/types/editor-base-view":560,"../editors/types/editor-boolean-view":561,"../editors/types/editor-date-view":564,"../editors/types/editor-model":565,"../editors/types/editor-string-view":566,"../operations/table-add-row":577,"../operations/table-edit-cell":579,"../operations/table-remove-row":581,"../paginator/table-paginator-view":584,"./modals-templates/remove-table-row.tpl":551,"./table-body-row-view":553,"./table-body.tpl":555,"./table-no-rows.tpl":556,"backbone/core-view":1127,clipboard:"clipboard",jquery:"jquery",underscore:"underscore"}],555:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<table>\n  <tbody class="js-tbody"></tbody>\n</table>\n';return __p}},{underscore:"underscore"}],556:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="LayoutIcon">\n    <i class="CDB-IconFont CDB-IconFont-rows"></i>\n  </div>\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m u-tSpace-xl">\n    ',__p+=0!==page?"\n      "+(null==(__t=_t("components.table.rows.result.no-page-title",{page:page}))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.table.rows.result.no-results-title"))?"":_.escape(__t))+"\n    ",__p+='\n  </h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">\n    ',__p+=0!==page?"\n      "+(null==(__t=_t("components.table.rows.result.no-page-desc",{page:page}))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.table.rows.result.no-results-desc",{addRow:_t("components.table.rows.result.no-results-button")}))?"":_.escape(__t))+"\n    ",__p+="\n  </p>\n</div>\n";return __p}},{underscore:"underscore"}],557:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=d.Model.extend({defaults:{show:!0,createContentView:function(){return new e}},createContentView:function(){return this.get("createContentView")(this)},show:function(){this.set("show",!0)},hide:function(){this.set("show",!1)},isHidden:function(){return!this.get("show")},confirm:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["confirm"].concat(a))},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone","backbone/core-view":1127}],558:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({className:"CDB-Box-modal Table-editor",initialize:function(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},render:function(){this.clearSubViews();var a=this.model.createContentView();return this.addView(a),a.render(),this.$el.append(a.el),this.$el.css(this.options.position),this},show:function(){this.model.show()},hide:function(){this.model.hide()},destroy:function(){this.model.destroy()},_onShowChange:function(a,b){this.$el[b?"show":"hide"]()},_onClose:function(){this.destroy()},_onDestroy:function(){this.hide(),this.clean()}})},{"backbone/core-view":1127}],559:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone"),g=a("./editor-view"),h=a("./editor-view-model"),i=27,j="destroyedEditor",k="confirmedEditor";b.exports=f.Model.extend({create:function(a,b){if(!d.isFunction(a))throw new Error("createContentView is required");return b=b||{left:"50%",
top:"50%"},this._editorView||(this._editorView=this._newEditorView(b),document.body.appendChild(this._editorView.el)),this._editorView.model.set("createContentView",a),this._editorView.render(),this._editorView},confirm:function(){this._editorView&&this._editorView.model.confirm()},destroy:function(){this._editorView&&this._editorView.model.destroy()},_newEditorView:function(a){var b=new h;this._destroyOnEsc(b),this.listenToOnce(b,"destroy",function(){this._editorView=null,this.trigger.apply(this,[j].concat(Array.prototype.slice.call(arguments))),this.stopListening(b)}),this.listenToOnce(b,"confirm",function(){this.trigger.apply(this,[k].concat(Array.prototype.slice.call(arguments))),this.destroy()});var c=new g({model:b,position:a});return this._destroyOnClickOutside(c),c},_destroyOnClickOutside:function(a){var b=function(b){0===e(b.target).closest(a.el).length&&a.model.confirm()};document.addEventListener("click",b),this.listenToOnce(a.model,"destroy",function(){document.removeEventListener("click",b)})},_destroyOnEsc:function(a){var b=function(b){b.which===i&&a.destroy()};document.addEventListener("keydown",b),this.listenToOnce(a,"destroy",function(){document.removeEventListener("keydown",b)})}})},{"./editor-view":558,"./editor-view-model":557,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],560:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=13;b.exports=d.extend({tagName:"input",className:"CDB-InputText CDB-Text",events:{keyup:"_onValueChange",change:"_onValueChange"},initialize:function(a){if(!a.editorModel)throw new Error("editorModel is required");this._editorModel=a.editorModel,this._onKeyPressed=this._onKeyPressed.bind(this),this._onValueChange=this._onValueChange.bind(this)},render:function(){return this.$el.val(this.model.get("value")),this._setFocus(),this._initDocumentBind(),this},_setFocus:function(){setTimeout(function(){this.$el.focus()}.bind(this),100)},_initDocumentBind:function(){e(document).bind("keydown",this._onKeyPressed)},_destroyDocumentBind:function(){e(document).unbind("keydown",this._onKeyPressed)},_onKeyPressed:function(a){if(a.which===f){if(!this.model.isValid())return!1;this._editorModel.confirm()}},_onValueChange:function(){this._setValue(),this._checkValidity()},_setValue:function(){this.model.set("value",this.$el.val())},_checkValidity:function(){this.$el.toggleClass("has-error",!this.model.isValid())},clean:function(){this._destroyDocumentBind(),d.prototype.clean.apply(this)}})},{"backbone/core-view":1127,jquery:"jquery"}],561:[function(a,b,c){var d=a("./editor-base-view"),e=a("jquery"),f=a("./editor-boolean.tpl");b.exports=d.extend({tagName:"div",className:"u-flex",events:{"change input:radio":"_onRadioChanged"},render:function(){var a=this.model.get("value");return this.$el.html(f({value:null!==a?a.toString():"null"})),this},_onRadioChanged:function(a){var b=e(a.target).val();switch(b){case"true":b=!0;break;case"false":b=!1;break;default:b=null}this.model.set("value",b),this._editorModel.confirm()}})},{"./editor-base-view":560,"./editor-boolean.tpl":562,jquery:"jquery"}],562:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-iBlock CDB-Text CDB-Size-medium u-rSpace--xl">\n  <input class="CDB-Radio" type="radio" name="value" value="true" ',"true"===value&&(__p+="checked"),__p+='>\n  <span class="u-iBlock CDB-Radio-face"></span>\n  <label class="u-iBlock u-lSpace">True</label>\n</div>\n<div class="u-iBlock CDB-Text CDB-Size-medium u-rSpace--xl">\n  <input class="CDB-Radio" type="radio" name="value" value="false" ',"false"===value&&(__p+="checked"),__p+='>\n  <span class="u-iBlock CDB-Radio-face"></span>\n  <label class="u-iBlock u-lSpace">False</label>\n</div>\n<div class="u-iBlock CDB-Text CDB-Size-medium u-rSpace--xl">\n  <input class="CDB-Radio" type="radio" name="value" value="null" ',"null"===value&&(__p+="checked"),__p+='>\n  <span class="u-iBlock CDB-Radio-face"></span>\n  <label class="u-iBlock u-lSpace">Null</label>\n</div>\n';return __p}},{underscore:"underscore"}],563:[function(a,b,c){var d=a("backbone"),e=a("moment"),f=a("../../../../helpers/utils"),g=[{val:0,label:_t("months.january")},{val:1,label:_t("months.february")},{val:2,label:_t("months.march")},{val:3,label:_t("months.april")},{val:4,label:_t("months.may")},{val:5,label:_t("months.june")},{val:6,label:_t("months.july")},{val:7,label:_t("months.august")},{val:8,label:_t("months.september")},{val:9,label:_t("months.october")},{val:10,label:_t("months.november")},{val:11,label:_t("months.december")}];b.exports=d.Model.extend({parse:function(a){var b;return b=a.date?e(a.date).utc():e().utc(),{day:b.date(),month:b.month(),year:b.year(),time:b.format("HH:mm:ss"),utcOffset:b.utcOffset()}},initialize:function(){this.schema={day:{title:"",type:"Text",validators:["required",/^([12]?\d{0,1}|3[01]{0,2})$/,function(a,b){var c=e(f.formatDate(b));if(!c.isValid())return{type:"date",message:_t("components.datepicker.invalid-date")}}]},month:{type:"Select",title:"",options:g},year:{title:"",type:"Text",validators:["required",/^([0-9]{0,4})$/]},time:{title:"",type:"Text",validators:["required",/^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/]}}},getFormattedDate:function(){return f.formatDate(this.toJSON())}})},{"../../../../helpers/utils":1102,backbone:"backbone",moment:"moment"}],564:[function(a,b,c){var d=a("backbone"),e=a("./editor-base-view"),f=a("./editor-date-form-model");a("../../../form-components/index"),b.exports=e.extend({tagName:"div",className:"Table-editorDate",initialize:function(a){e.prototype.initialize.apply(this,arguments),this._formModel=new f({date:this.model.get("value")},{parse:!0}),this._setValue(),this._formModel.bind("change",this._setValue,this),this.add_related_model(this._formModel)},render:function(){return this._formView=new d.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.html(this._formView.render().el),this},_setValue:function(){this.model.set("value",this._formModel.getFormattedDate())},clean:function(){this._formView.remove(),e.prototype.clean.apply(this)}})},{"../../../form-components/index":211,"./editor-base-view":560,"./editor-date-form-model":563,backbone:"backbone"}],565:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({validate:function(a,b){return"number"===a.type&&isNaN(a.value)?"Number not valid":"boolean"!==a.type||e.isBoolean(a.value)||null===a.value?void 0:"Boolean not valid"}})},{backbone:"backbone",underscore:"underscore"}],566:[function(a,b,c){var d=a("./editor-base-view"),e=13;b.exports=d.extend({tagName:"textarea",className:"Table-editorTextarea CDB-Textarea CDB-Text",_onKeyPressed:function(a){a.shiftKey||a.which!==e||(this._onValueChange(),this._editorModel.confirm())}})},{"./editor-base-view":560}],567:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="25px" height="25px" viewBox="-1 4 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Outline_Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(-1.000000, 4.000000)">\n          <path d="M1.9477838,21.5 C1.6977511,21.5 1.5,21.3016354 1.5,21.0431048 L1.5,1.95689523 C1.5,1.70555616 1.70315066,1.5 1.94113901,1.5 L16.058861,1.5 C16.2975949,1.5 16.5,1.70783627 16.5,1.96250326 L16.5,13.2661378 L17.5,13.2661378 L17.5,1.96250326 C17.5,1.16139088 16.8558926,0.5 16.058861,0.5 L1.94113901,0.5 C1.14821378,0.5 0.5,1.15588925 0.5,1.95689523 L0.5,21.0431048 C0.5,21.8532278 1.1447717,22.5 1.9477838,22.5 L10.0155676,22.5 L10.0155676,21.5 L1.9477838,21.5 Z" id="path-1" fill="#F19243"></path>\n          <rect id="Rectangle-2" fill="#F19243" x="1" y="5" width="16" height="1"></rect>\n          <path d="M23.854,14.646 L21.354,12.146 C21.166,11.958 20.834,11.958 20.647,12.146 L13.146,19.648 C13.089,19.705 13.054,19.773 13.03,19.845 C13.028,19.852 13.021,19.857 13.019,19.865 L12.019,23.365 C11.969,23.539 12.018,23.727 12.146,23.856 C12.241,23.951 12.369,24.002 12.5,24.002 C12.546,24.002 12.592,23.996 12.637,23.983 L16.137,22.983 C16.144,22.981 16.149,22.974 16.157,22.972 C16.229,22.948 16.297,22.913 16.354,22.856 L23.855,15.354 C24.05,15.158 24.05,14.842 23.854,14.646 L23.854,14.646 L23.854,14.646 Z M16,21.795 L14.207,20.002 L19.001,15.207 L20.794,17 L16,21.795 L16,21.795 L16,21.795 Z M13.747,20.957 L15.045,22.255 L13.228,22.775 L13.747,20.957 L13.747,20.957 L13.747,20.957 Z M21.501,16.293 L19.708,14.5 L21.001,13.207 L22.794,15 L21.501,16.293 L21.501,16.293 L21.501,16.293 Z" id="Shape" fill="#F19243"></path>\n        </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("components.table.columns.change-type.title",{columnName:columnName,newType:newType}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">\n        '+(null==(__t=_t("components.table.columns.change-type.desc"))?"":_.escape(__t))+'\n      </p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.change-type.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.change-type.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],568:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("components.table.columns.destroy.title",{columnName:name}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("components.table.columns.destroy.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.destroy.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.destroy.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],569:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="25px" height="25px" viewBox="67 153 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Group-Copy" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(67.000000, 153.000000)">\n          <path d="M16,13 L17,13 L17,5.5 C17,5.433 16.986,5.368 16.961,5.308 C16.936,5.247 16.899,5.192 16.853,5.146 L11.854,0.147 C11.808,0.101 11.753,0.064 11.692,0.039 C11.632,0.014 11.567,0 11.5,0 L0.5,0 C0.224,0 0,0.224 0,0.5 L0,21.5 C0,21.776 0.224,22 0.5,22 L9.5,22 L9.5,21 L1,21 L1,1 L11,1 L11,5.5 C11,5.776 11.224,6 11.5,6 L16,6 L16,13 L16,13 Z M12,1.707 L15.293,5 L12,5 L12,1.707 L12,1.707 Z" id="Shape" fill="#F19243"></path>\n          <path d="M23.854,14.646 L21.354,12.146 C21.166,11.958 20.834,11.958 20.647,12.146 L13.146,19.648 C13.089,19.705 13.054,19.773 13.03,19.845 C13.028,19.852 13.021,19.857 13.019,19.865 L12.019,23.365 C11.969,23.539 12.018,23.727 12.146,23.856 C12.241,23.951 12.369,24.002 12.5,24.002 C12.546,24.002 12.592,23.996 12.637,23.983 L16.137,22.983 C16.144,22.981 16.149,22.974 16.157,22.972 C16.229,22.948 16.297,22.913 16.354,22.856 L23.855,15.354 C24.05,15.158 24.05,14.842 23.854,14.646 L23.854,14.646 Z M16,21.795 L14.207,20.002 L19.001,15.207 L20.794,17 L16,21.795 L16,21.795 Z M13.747,20.957 L15.045,22.255 L13.228,22.775 L13.747,20.957 L13.747,20.957 Z M21.501,16.293 L19.708,14.5 L21.001,13.207 L22.794,15 L21.501,16.293 L21.501,16.293 Z" id="Shape" fill="#F19243"></path>\n        </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--m">\n        '+(null==(__t=_t("components.table.columns.rename.title",{columnName:columnName,newName:newName}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-medium u-altTextColor">\n        '+(null==(__t=_t("components.table.columns.rename.desc",{columnName:columnName,newName:newName}))?"":_.escape(__t))+'\n      </p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.rename.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.rename.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],570:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("./table-head-item.tpl"),g=a("../../context-menu/context-menu-view"),h=a("../../custom-list/custom-list-collection"),i=a("./table-head-options-item-view"),j=a("./table-head-options-item.tpl"),k=a("../../modals/confirmation/modal-confirmation-view"),l=a("../../../data/query-column-model"),m=a("../operations/table-add-column"),n=a("../operations/table-rename-column"),o=a("../operations/table-change-column-type"),p=a("../operations/table-remove-column"),q=13,r=27;b.exports=e.extend({className:"Table-headItem",tagName:"th",events:{"dblclick .js-attribute":"_onAttributeDblClicked","focusout .js-attribute":"_saveNewName","click .js-columnOptions":"_showContextMenu"},initialize:function(a){if(!a.tableViewModel)throw new Error("tableViewModel is required");if(!a.columnsCollection)throw new Error("columnsCollection is required");if(!a.modals)throw new Error("modals is required");this._tableViewModel=a.tableViewModel,this._columnsCollection=a.columnsCollection,this._modals=a.modals,this._hideContextMenu=this._hideContextMenu.bind(this),this._onKeyDown=this._onKeyDown.bind(this)},render:function(){this.clearSubViews();var a=this.model.get("name");return this.$el.html(f({name:a,type:this.model.get("type"),isOrderBy:this._tableViewModel.get("order_by")===a,sortBy:this._tableViewModel.get("sort_order"),geometry:this.options.simpleGeometry})),this},_hasContextMenu:function(){return this._menuView},_hideContextMenu:function(){this._unhighlightHead(),this._destroyScrollBinding(),this._menuView.collection.unbind(null,null,this),this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_highlightHead:function(){this.$el.addClass("is-highlighted")},_unhighlightHead:function(){this.$el.removeClass("is-highlighted")},_initScrollBinding:function(){d(".Table").scroll(this._hideContextMenu)},_destroyScrollBinding:function(){d(".Table").off("scroll",this._hideContextMenu)},_showContextMenu:function(a){var b=this,c={x:a.clientX,y:a.clientY},d=this.$el.index(),e=this.model.cid,f=this.model.get("name");this._highlightHead();var k=[{label:_t("components.table.columns.options.order"),val:"order",isOrderBy:this._tableViewModel.get("order_by")===f,sortBy:this._tableViewModel.get("sort_order"),action:function(a){b._tableViewModel.set({sort_order:a.get("sort"),order_by:f})}}];this._tableViewModel.isDisabled()||(this.model.isCartoDBIDColumn()||this.model.isGeometryColumn()||(k=k.concat([{label:_t("components.table.columns.options.rename"),val:"rename",action:function(){b._startEditing()}},{label:_t("components.table.columns.options.change"),type:this.model.get("type"),isLastColumns:this._columnsCollection.size()-d<3,val:"change",action:function(a){b._changeColumnType(a.get("type"))}}])),k.push({label:_t("components.table.columns.options.create"),val:"create",action:function(){b._addColumn()}}),this.model.isCartoDBIDColumn()||this.model.isGeometryColumn()||k.push({label:_t("components.table.columns.options.delete"),val:"delete",destructive:!0,action:function(){b._removeColumn()}}));var l=new h(k);this._menuView=new g({className:g.prototype.className+" Table-columnMenu",collection:l,itemTemplate:j,itemView:i,triggerElementID:e,position:c}),l.bind("change:selected",function(a){var b=a.get("action");b&&b(a)},this),this._menuView.model.bind("change:visible",function(a,b){this._hasContextMenu()&&!b&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView),this._initScrollBinding()},_addColumn:function(){m({tableViewModel:this._tableViewModel,columnsCollection:this._columnsCollection})},_changeColumnType:function(b){var c=this,d=this.model.get("type"),e=l.isTypeChangeDestructive(d,b);e?this._modals.create(function(d){return new k({modalModel:d,template:a("./modals-templates/change-table-column-type.tpl"),renderOpts:{columnName:c.model.get("name"),newType:b},loadingTitle:_t("components.table.columns.change-type.loading",{columnName:c.model.get("name")}),runAction:function(){o({columnModel:c.model,newType:b,onSuccess:function(){d.destroy()},onError:function(a){d.destroy()}})}})}):o({columnModel:this.model,newType:b})},_removeColumn:function(){var b=this;this._modals.create(function(c){return new k({modalModel:c,template:a("./modals-templates/remove-table-column.tpl"),renderOpts:{name:b.model.get("name")},loadingTitle:_t("components.table.columns.destroy.loading",{columnName:b.model.get("name")}),runAction:function(){p({columnModel:b.model,onSuccess:function(){c.destroy()},onError:function(a){c.destroy()}})}})})},_onAttributeDblClicked:function(){this.model.isEditable()&&!this._tableViewModel.isDisabled()&&this._startEditing()},_initRenameBinds:function(){d(document).bind("keydown",this._onKeyDown)},_destroyRenameBinds:function(){d(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function(a){var b=a.which;b===q?this._saveNewName():b===r&&this._finishEditing()},_startEditing:function(){this.$(".js-attribute").addClass("is-active").removeAttr("readonly"),this._initRenameBinds()},_finishEditing:function(){this.$(".js-attribute").val(this.model.get("name")).removeClass("is-active").attr("readonly",""),this._destroyRenameBinds()},_saveNewName:function(){if(this.model.isEditable()){var b=this.$(".js-attribute").val(),c=this.model,d=c.get("name");d!==b&&""!==b&&this._modals.create(function(e){return new k({modalModel:e,template:a("./modals-templates/rename-table-column.tpl"),renderOpts:{columnName:d,newName:b},loadingTitle:_t("components.table.columns.rename.loading",{columnName:d,newName:b}),runAction:function(){n({columnModel:c,newName:b,onSuccess:function(){e.destroy()},onError:function(a){e.destroy()}})}})})}this._finishEditing()},clean:function(){this._destroyRenameBinds(),this._destroyScrollBinding(),e.prototype.clean.apply(this)}})},{"../../../data/query-column-model":654,"../../context-menu/context-menu-view":39,"../../custom-list/custom-list-collection":47,"../../modals/confirmation/modal-confirmation-view":404,"../operations/table-add-column":576,"../operations/table-change-column-type":578,"../operations/table-remove-column":580,"../operations/table-rename-column":582,"./modals-templates/change-table-column-type.tpl":567,"./modals-templates/remove-table-column.tpl":568,"./modals-templates/rename-table-column.tpl":569,"./table-head-item.tpl":571,"./table-head-options-item-view":572,"./table-head-options-item.tpl":573,"backbone/core-view":1127,jquery:"jquery"}],571:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="\n    Table-headItemWrapper\n    '+(null==(__t="cartodb_id"===name||"geometry"===type&&"point"!==geometry?"Table-headItemWrapper--short":"")?"":_.escape(__t))+'\n  ">\n  <div class="u-flex u-justifySpace">\n    <input class="Table-headItemName CDB-Text CDB-Size-medium is-semibold u-ellipsis js-attribute" value="'+(null==(__t=name)?"":_.escape(__t))+'" title="'+(null==(__t=name)?"":_.escape(__t))+'" readonly />\n\n    ',isOrderBy&&(__p+='\n      <i class="CDB-Size CDB-Size-small CDB-IconFont CDB-IconFont-arrowNext\n        Table-columnSorted\n        Table-columnSorted--',__p+="asc"===sortBy?"asc":"desc",__p+='\n        u-rSpace u-altTextColor\n      "></i>\n    '),__p+='\n\n    <button class="CDB-Shape-threePoints is-blue is-small js-columnOptions">\n      <div class="CDB-Shape-threePointsItem"></div>\n      <div class="CDB-Shape-threePointsItem"></div>\n      <div class="CDB-Shape-threePointsItem"></div>\n    </button>\n  </div>\n  <p class="CDB-Size-small Table-headItemInfo u-altTextColor">'+(null==(__t=type)?"":_.escape(__t))+"</p>\n</div>\n";return __p}},{underscore:"underscore"}],572:[function(a,b,c){var d=a("underscore"),e=a("../../custom-list/custom-list-item-view"),f=a("../../custom-list/custom-view"),g=a("../../../data/query-column-model");b.exports=e.extend({events:d.extend(e.prototype.events,{"click .js-desc":"_onDescClick","click .js-asc":"_onAscClick","click .js-order":"killEvent"}),render:function(){return this.$el.empty(),this.clearSubViews(),this.$el.append(this.options.template({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),isOrderBy:this.model.get("isOrderBy"),sortBy:this.model.get("sortBy"),name:this.model.getName(),val:this.model.getValue()})),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onClick:function(a){this.killEvent(a),"change"===this.model.getValue()?this._openSubContextMenu(a):this.model.set("selected",!0)},_hideSubContextMenu:function(){this._subContextMenu&&(this._subContextMenu.clean(),this.removeView(this._subContextMenu),delete this.collection,delete this._subContextMenu)},_openSubContextMenu:function(a){this._subContextMenu&&this._hideSubContextMenu();var b="Table-columnTypeMenu ";this.model.get("isLastColumns")&&(b+=" Table-columnTypeMenu--toLeft "),this._subContextMenu=new f({className:b+f.prototype.className,options:[{label:_t("components.table.columns.types.number"),disabled:!g.isTypeChangeAllowed(this.model.get("type"),"number"),val:"number"},{label:_t("components.table.columns.types.string"),disabled:!g.isTypeChangeAllowed(this.model.get("type"),"string"),val:"string"},{label:_t("components.table.columns.types.date"),disabled:!g.isTypeChangeAllowed(this.model.get("type"),"date"),val:"date"},{label:_t("components.table.columns.types.boolean"),disabled:!g.isTypeChangeAllowed(this.model.get("type"),"boolean"),val:"boolean"}],showSearch:!1,typeLabel:""}),this._subContextMenu.collection.bind("change:selected",function(a){a.get("disabled")||this.model.set({type:a.getValue(),selected:!0})},this),this.$el.closest(".Table-columnMenu").append(this._subContextMenu.render().el),this._subContextMenu.show(),this.addView(this._subContextMenu)},_onAscClick:function(a){this.killEvent(a),this.model.set({sort:"asc",selected:!0})},_onDescClick:function(a){this.killEvent(a),this.model.set({sort:"desc",selected:!0})}})},{"../../../data/query-column-model":654,"../../custom-list/custom-list-item-view":50,"../../custom-list/custom-view":59,underscore:"underscore"}],573:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","order"===val?(__p+='\n  <div class="u-flex u-justifySpace CDB-ListDecoration-itemLink js-order">\n    <p class="CDB-Text CDB-Size-medium">'+(null==(__t=name)?"":_.escape(__t))+'</p>\n    <ul class="u-flex">\n      <li class="js-asc">\n        <i class="CDB-Text CDB-IconFont\n          CDB-IconFont-arrowNext u-actionTextColor\n          Table-columnSorted\n          Table-columnSorted--asc\n           ',isOrderBy&&"asc"===sortBy&&(__p+="is-disabled"),__p+="\n           ",isOrderBy&&"desc"===sortBy&&(__p+="is-semibold"),__p+='\n        "></i>\n      </li>\n      <li class="js-desc u-lSpace--xl">\n        <i class="CDB-Text CDB-IconFont\n          CDB-IconFont-arrowNext u-actionTextColor\n          Table-columnSorted\n          Table-columnSorted--desc\n           ',isOrderBy&&"desc"===sortBy&&(__p+="is-disabled"),__p+="\n           ",isOrderBy&&"asc"===sortBy&&(__p+="is-semibold"),__p+='\n        "></i>\n      </li>\n    </ul>\n  </div>\n'):"change"===val?__p+='\n  <div class="CDB-ListDecoration-itemLink u-actionTextColor u-flex u-justifySpace u-alignCenter" title="'+(null==(__t=name)?"":_.escape(__t))+'">\n    <span>'+(null==(__t=name)?"":_.escape(__t))+'</span>\n    <i class="CDB-Text CDB-Size-small is-semibold CDB-IconFont CDB-IconFont-rArrowLight"></i>\n  </div>\n':(__p+='\n  <div class="CDB-ListDecoration-itemLink\n    ',__p+=isDestructive?"  u-errorTextColor ":" u-actionTextColor ",__p+="\n    ","change"===val&&(__p+=" u-flex "),__p+='\n    " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n    '+(null==(__t=name)?"":_.escape(__t))+"\n    ","change"===val&&(__p+='\n      <span>\n        <i class="CDB-Text CDB-Size-small is-semibold CDB-IconFont CDB-IconFont-rArrowLight"></i>\n      </span>\n    '),__p+="\n  </div>\n"),__p+="\n";return __p}},{underscore:"underscore"}],574:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("./table-head-item-view"),g=a("./table-head.tpl");b.exports=e.extend({className:"Table-head",tagName:"table",initialize:function(a){if(!a.columnsCollection)throw new Error("columnsCollection is required");if(!a.tableViewModel)throw new Error("tableViewModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.modals)throw new Error("modals is required");this._columnsCollection=a.columnsCollection,this._tableViewModel=a.tableViewModel,this._queryGeometryModel=a.queryGeometryModel,this._modals=a.modals,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(g()),this._columnsCollection.each(this._renderColumnHead,this),this},_initBinds:function(){this._queryGeometryModel.bind("change:simple_geom",this.render,this),this.add_related_model(this._queryGeometryModel),this._tableViewModel.bind("change:sort_order change:order_by",this.render,this),this.add_related_model(this._tableViewModel),this._columnsCollection.bind("reset",function(){if(this.render(),this._newColumn){var a=this.$el.get(0).scrollWidth;setTimeout(function(){this._scrollToLeft({pos:a})}.bind(this),500),delete this._newColumn}},this),this._columnsCollection.bind("add",function(a){this._newColumn=a},this),this.add_related_model(this._columnsCollection)},_renderColumnHead:function(a){if(this._tableViewModel.isDisabled()||"the_geom_webmercator"!==a.get("name")){var b=new f({model:a,modals:this._modals,columnsCollection:this._columnsCollection,tableViewModel:this._tableViewModel,simpleGeometry:this._queryGeometryModel.get("simple_geom")});this.$(".js-headRow").append(b.render().el),this.addView(b)}},_scrollToLeft:function(a){a=a||{},d(".Table").animate({scrollLeft:a.pos||0},a.speed||"slow")}})},{"./table-head-item-view":570,"./table-head.tpl":575,"backbone/core-view":1127,jquery:"jquery"}],575:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<thead>\n  <tr class="js-headRow"></tr>\n</thead>\n';return __p}},{underscore:"underscore"}],576:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.columnsCollection)throw new Error("columnsCollection is required");var b=a.columnsCollection,c=a.onSuccess,f=a.onError,g=d.addNotification({status:"loading",info:_t("components.table.columns.create.loading"),closable:!1});b.addColumn({success:function(a,b){c&&c(a,b),g.set({status:"success",info:_t("components.table.columns.create.success",{columnName:b.name}),closable:!0})},error:function(a,b){f&&f(a,b),g.set({status:"error",info:_t("components.table.columns.create.error",{error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],577:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.rowsCollection)throw new Error("rowsCollection is required");var b=a.rowsCollection,c=a.onSuccess,f=a.onError,g=d.addNotification({status:"loading",info:_t("components.table.rows.create.loading"),closable:!1});b.addRow({success:function(a,b){c&&c(a,b),g.set({status:"success",info:_t("components.table.rows.create.success"),closable:!0})},error:function(a,b){f&&f(a,b),g.set({status:"error",info:_t("components.table.rows.create.error",{error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],578:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.columnModel)throw new Error("columnModel is required");if(!a.newType)throw new Error("newType is required");var b=a.columnModel,c=a.newType,f=a.onSuccess,g=a.onError,h=d.addNotification({status:"loading",info:_t("components.table.columns.change-type.loading",{columnName:b.get("name")}),closable:!1
});b.save({type:c},{wait:!0,success:function(a,d){f&&f(a,d),h.set({status:"success",info:_t("components.table.columns.change-type.success",{columnName:b.get("name"),newType:c}),closable:!0})},error:function(a,d){g&&g(a,d),h.set({status:"error",info:_t("components.table.columns.change-type.error",{columnName:b.get("name"),newType:c,error:e(d)}),closable:!0})}})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],579:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.rowModel)throw new Error("rowModel is required");if(void 0===a.newValue)throw new Error("newValue is required");if(!a.attribute)throw new Error("attribute is required");var b=a.rowModel,c=a.newValue,f=a.attribute,g=b.get("cartodb_id"),h=a.onSuccess,i=a.onError,j=d.addNotification({status:"loading",info:_t("components.table.rows.edit.loading",{attribute:f,cartodbId:g}),closable:!1});b.set(f,c),b.save(null,{success:function(a,b){h&&h(a,b),j.set({status:"success",info:_t("components.table.rows.edit.success",{attribute:f,cartodbId:g}),closable:!0})},error:function(a,b){i&&i(a,b),j.set({status:"error",info:_t("components.table.rows.edit.error",{attribute:f,cartodbId:g,error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],580:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.columnModel)throw new Error("columnModel is required");var b=a.columnModel,c=a.onSuccess,f=a.onError,g=d.addNotification({status:"loading",info:_t("components.table.columns.destroy.loading",{columnName:b.get("name")}),closable:!1});b.destroy({wait:!0,success:function(a,d){c&&c(a,d),g.set({status:"success",info:_t("components.table.columns.destroy.success",{columnName:b.get("name")}),closable:!0})},error:function(a,c){f&&f(a,c),g.set({status:"error",info:_t("components.table.columns.destroy.error",{columnName:b.get("name"),error:e(c)}),closable:!0})}})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],581:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.rowModel)throw new Error("rowModel is required");var b=a.rowModel,c=a.onSuccess,f=a.onError,g=b.get("cartodb_id"),h=d.addNotification({status:"loading",info:_t("components.table.rows.destroy.loading",{cartodb_id:g}),closable:!1});b.destroy({wait:!0,success:function(a,b){c&&c(a,b),h.set({status:"success",info:_t("components.table.rows.destroy.success",{cartodb_id:g}),closable:!0})},error:function(a,b){f&&f(a,b),h.set({status:"error",info:_t("components.table.rows.destroy.error",{cartodb_id:g,error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],582:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.columnModel)throw new Error("columnModel is required");if(!a.newName)throw new Error("newName is required");var b=a.columnModel,c=b.get("name"),f=a.newName,g=a.onSuccess,h=a.onError,i=d.addNotification({status:"loading",info:_t("components.table.columns.rename.loading",{oldName:c,newName:f}),closable:!1});b.save({new_name:f,old_name:b.get("name")},{wait:!0,success:function(a,b){g&&g(a,b),i.set({status:"success",info:_t("components.table.columns.rename.success",{columnName:c,newName:f}),closable:!0})},error:function(a,b){h&&h(a,b),i.set({status:"error",info:_t("components.table.columns.rename.error",{columnName:c,newName:f,error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],583:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-LoaderIcon is-dark">\n  <svg class="CDB-LoaderIcon-spinner" viewbox="0 0 50 50">\n    <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"/>\n  </svg>\n</div>\n';return __p}},{underscore:"underscore"}],584:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./table-paginator.tpl"),g=a("./table-paginator-loader.tpl"),h=a("../../../components/notifier/notifier"),i=a("../../../helpers/error-parser");b.exports=e.extend({tagName:"div",className:"Table-paginator js-tablePaginator",events:{"click .js-prev":"_onPrevPage","click .js-next":"_onNextPage"},initialize:function(a){if(!a.rowsCollection)throw new Error("rowsCollection is required");if(!a.tableViewModel)throw new Error("tableViewModel is required");this._tableViewModel=a.tableViewModel,this._rowsCollection=a.rowsCollection,this._rowsCollection.bind("loading",function(a){a.models&&(this._isLoading=!0)},this),this._rowsCollection.bind("add remove",this.render,this),this._tableViewModel.bind("change:page",this._onTablePageChange,this),this.add_related_model(this._tableViewModel),this.add_related_model(this._rowsCollection)},render:function(){var a=this._rowsCollection.size(),b=this._tableViewModel.get("page"),c=this._rowsCollection.DEFAULT_FETCH_OPTIONS.rows_per_page;return this.$el.html(f({page:this._tableViewModel.get("page"),size:a,isNextAvailable:a>=c,isPrevAvailable:b>0})),this.$el.toggleClass("Table-paginator--relative",!!this._tableViewModel.get("relativePositionated")),this},_onTablePageChange:function(){this._rowsCollection.fetch({data:d.extend(this._tableViewModel.pick("page","order_by","sort_order"),{exclude:this._tableViewModel.isCustomQueryApplied()?[]:["the_geom_webmercator"]}),error:function(a,b){this._isLoading=!1,this.render(),h.addNotification({status:"error",info:_t("components.table.rows.paginator.error",{error:i(b)}),closable:!0})}.bind(this)})},_onPrevPage:function(a){this._isLoading||(this.$(".js-prev").html(g()),this._tableViewModel.set("page",this._tableViewModel.get("page")-1))},_onNextPage:function(a){this._isLoading||(this.$(".js-next").html(g()),this._tableViewModel.set("page",this._tableViewModel.get("page")+1))}})},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090,"./table-paginator-loader.tpl":583,"./table-paginator.tpl":585,"backbone/core-view":1127,underscore:"underscore"}],585:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="Table-paginatorButton Table-paginatorButton--prev\n  ',isPrevAvailable&&(__p+="\n    js-prev\n  "),__p+='\n">\n  <i class="CDB-Text is-semibold CDB-IconFont CDB-IconFont-lArrowLight CDB-Size-small\n  ',__p+=isPrevAvailable?"\n    u-actionTextColor\n  ":"\n    u-hintTextColor\n  ",__p+='\n  "></i>\n</button>\n<p class="Table-paginatorText CDB-Text CDB-Size-small is-semibold u-upperCase">\n  ',__p+=size?'\n    <span class="u-mainTextColor">'+(null==(__t=40*page+1)?"":_.escape(__t))+'</span>\n    <span class="u-altTextColor u-lSpace u-rSpace">'+(null==(__t=_t("components.table.rows.paginator.to"))?"":_.escape(__t))+'</span>\n    <span class="u-mainTextColor">'+(null==(__t=40*page+size)?"":_.escape(__t))+"</span>\n  ":'\n   <span class="u-mainTextColor">…</span>\n  ',__p+='\n</p>\n<button class="Table-paginatorButton Table-paginatorButton--next\n  ',isNextAvailable&&(__p+="\n    js-next\n  "),__p+='\n">\n  <i class="CDB-Text is-semibold CDB-IconFont CDB-IconFont-rArrowLight CDB-Size-small\n  ',__p+=isNextAvailable?"\n    u-actionTextColor\n  ":"\n    u-hintTextColor\n  ",__p+='\n  "></i>\n</button>\n';return __p}},{underscore:"underscore"}],586:[function(a,b,c){var d=a("./table-view"),e=a("../../data/query-columns-collection"),f=a("../../helpers/table-name-utils"),g=a("../../helpers/required-opts"),h=["analysisDefinitionNodeModel","configModel","modals","userModel"];b.exports={create:function(a){g(a,h,this);var b=this._analysisDefinitionNodeModel.get("table_name"),c=f.getUsername(b)||this._userModel.get("username");b=f.getQualifiedTableName(b,c,this._userModel.isInsideOrg());var i=this._analysisDefinitionNodeModel.querySchemaModel,j=new e(i.columnsCollection.toJSON(),{configModel:this._configModel,tableName:b,querySchemaModel:i});return new d({relativePositionated:a.relativePositionated,modals:this._modals,analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,columnsCollection:j,tableName:b})},destroy:function(a){if(!a)throw new Error("tableView object is needed");a.clean()}}},{"../../data/query-columns-collection":655,"../../helpers/required-opts":1097,"../../helpers/table-name-utils":1101,"./table-view":588}],587:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{page:0,order_by:"",sort_order:"",readonly:!1,tableName:""},initialize:function(a,b){if(!b.analysisDefinitionNodeModel)throw new Error("analysisDefinitionNodeModel is required");if(!b.columnsCollection)throw new Error("columnsCollection is required");this._analysisDefinitionNodeModel=b.analysisDefinitionNodeModel,this._columnsCollection=b.columnsCollection,this._setOrderAndSort(),this.listenTo(this._columnsCollection,"reset",this._setOrderAndSort)},_setOrderAndSort:function(){var a=this._columnsCollection.where({name:"cartodb_id"}).length;a&&!this.isCustomQueryApplied()&&this.set({order_by:"cartodb_id",sort_order:"asc"},{silent:!0})},resetFetchDefaults:function(){this.set({page:this.defaults.page,order_by:"",sort_order:""},{silent:!0})},isDisabled:function(){return this._analysisDefinitionNodeModel.isReadOnly()},isCustomQueryApplied:function(){return this._analysisDefinitionNodeModel.isCustomQueryApplied()}})},{backbone:"backbone"}],588:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("jquery"),g=a("./table-view-model.js"),h=a("./head/table-head-view"),i=a("./body/table-body-view"),j=a("./operations/table-add-row"),k=a("./operations/table-add-column"),l=a("../../helpers/sql-utils"),m=a("../../helpers/required-opts"),n=["analysisDefinitionNodeModel","columnsCollection","modals"];b.exports=d.extend({className:"Table-wrapper",tagName:"div",initialize:function(a){m(a,n,this),this._rowsCollection=this._analysisDefinitionNodeModel.queryRowsCollection,this._queryGeometryModel=this._analysisDefinitionNodeModel.queryGeometryModel,this._querySchemaModel=this._analysisDefinitionNodeModel.querySchemaModel,this._tableModel=this._analysisDefinitionNodeModel.isSourceType()&&this._analysisDefinitionNodeModel.getTableModel(),this._tableViewModel=new g({relativePositionated:a.relativePositionated,tableName:a.tableName},{analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,columnsCollection:this._columnsCollection}),this._initBinds(),this._queryGeometryModel.shouldFetch()&&this._queryGeometryModel.fetch(),this._querySchemaModel.shouldFetch()?this._querySchemaModel.fetch():this._rowsCollection.shouldFetch()&&this._fetchRowsData()},render:function(){this.clearSubViews(),this.$el.empty();var a=f("<div>").addClass("Table js-table");return this.$el.append(a),this._initViews(),this.$(".js-table").toggleClass("Table--relative",!!this._tableViewModel.get("relativePositionated")),this._setDisableState(),this},_initBinds:function(){if(this._onChangeQueryOrStatus=this._onChangeQueryOrStatus.bind(this),this.listenTo(this._querySchemaModel,"change:query change:status",e.debounce(this._onChangeQueryOrStatus,100)),this.listenTo(this._querySchemaModel,"change:status",this._setDisableState),this.listenTo(this._querySchemaModel,"change:query",this._onQueryChanged),this.listenTo(this._querySchemaModel,"change:status",this._fetchRowsData),this.listenTo(this._tableViewModel,"change:sort_order change:order_by",this._fetchRowsData),this._tableModel&&this._tableModel.isSync()){var a=this._tableModel.getSyncModel();this.listenTo(a,"destroy",this.render)}},_setDisableState:function(){this.$(".js-table").toggleClass("is-disabled",!!this._tableViewModel.isDisabled())},_fetchRowsData:function(a){var b=a&&e.keys(a.changed),c=l.altersData(this._querySchemaModel.get("query")),d=this._tableViewModel.isCustomQueryApplied(),f=!1;b&&(e.contains(b,"sort_order")||e.contains(b,"order_by"))&&(f=!0),this._querySchemaModel.isFetched()&&!c&&this._rowsCollection.fetch({data:{page:this._tableViewModel.get("page"),order_by:!d||f?this._tableViewModel.get("order_by"):"",sort_order:!d||f?this._tableViewModel.get("sort_order"):"",exclude:!d||f?["the_geom_webmercator"]:[]}})},_initViews:function(){var a=new h({modals:this._modals,queryGeometryModel:this._queryGeometryModel,columnsCollection:this._columnsCollection,tableViewModel:this._tableViewModel});this.addView(a),this.$(".js-table").append(a.render().el);var b=new i({modals:this._modals,columnsCollection:this._columnsCollection,rowsCollection:this._rowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,tableViewModel:this._tableViewModel});this.addView(b),this.$(".js-table").append(b.render().el)},_onChangeQueryOrStatus:function(){var a=this._querySchemaModel.get("status"),b=this._queryGeometryModel.get("status");"unfetched"===a&&this._querySchemaModel.canFetch()&&this._querySchemaModel.fetch(),"unfetched"===b&&this._queryGeometryModel.canFetch()&&this._queryGeometryModel.fetch()},addRow:function(){j({tableViewModel:this._tableViewModel,rowsCollection:this._rowsCollection})},addColumn:function(){k({tableViewModel:this._tableViewModel,columnsCollection:this._columnsCollection})},getColumnsCollection:function(){return this._columnsCollection},_onQueryChanged:function(){this._tableViewModel.resetFetchDefaults()},remove:function(){f(".Table-paginator").remove(),d.prototype.remove.apply(this)}})},{"../../helpers/required-opts":1097,"../../helpers/sql-utils":1099,"./body/table-body-view":554,"./head/table-head-view":574,"./operations/table-add-column":576,"./operations/table-add-row":577,"./table-view-model.js":587,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],589:[function(a,b,c){var d=a("backbone/core-view");a("tipsy"),b.exports=d.extend({options:{gravity:"s",opacity:1,fade:!0},initialize:function(a){if(!a.el)throw new Error("Element is needed to have tipsy tooltip working");this._tipsyOpenedManually="manual"===a.trigger,this._initTipsy()},_initTipsy:function(){this.$el.tipsy(this.options),this.tipsy=this.$el.data("tipsy")},showTipsy:function(){this.$el.tipsy("show")},hideTipsy:function(){this.$el.tipsy("hide")},destroyTipsy:function(){this.tipsy&&(this.tipsy.hide(),this.$el.unbind("mouseleave mouseenter")),this._tipsyOpenedManually&&this.$el.tipsy("hide"),this.$el.removeData("tipsy"),delete this.tipsy},clean:function(){this.destroyTipsy()}})},{"backbone/core-view":1127,tipsy:1136}],590:[function(a,b,c){var d=a("backbone/core-view"),e=a("./toggler.tpl");b.exports=d.extend({className:"Toggle",events:{"click .js-input":"_onClick"},initialize:function(a){if(!a.editorModel)throw new Error("editorModel should be provided");this._editorModel=a.editorModel,this._labelsArray=a.labels,this._isDisableable=a.isDisableable,this.listenTo(this._editorModel,"change:edition",this.render),this.listenTo(this._editorModel,"change:disabled",this.render),this.add_related_model(this._editorModel)},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=this._editorModel.get("edition"),b=this._editorModel.get("disabled")&&this._isDisableable,c=e({labels:this._labelsArray,checked:a,disabled:b});return this.$el.append(c),this},_onClick:function(){var a=this._editorModel.get("edition");this._editorModel.set({edition:!a})}})},{"./toggler.tpl":591,"backbone/core-view":1127}],591:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Text CDB-Size-small is-semibold u-rSpace--xl',disabled&&(__p+=" is-disabled"),__p+='">\n  <label class="u-iBlock u-upperCase">'+(null==(__t=labels[0])?"":_.escape(__t))+'</label>\n  <input class="CDB-Toggle u-iBlock js-input" type="checkbox"\n    ',disabled&&(__p+=" disabled"),__p+="\n    ",checked&&(__p+=" checked "),__p+=' >\n  <span class="u-iBlock CDB-ToggleFace"></span>\n  <label class="u-iBlock u-upperCase">'+(null==(__t=labels[1])?"":_.escape(__t))+"</label>\n</div>";return __p}},{underscore:"underscore"}],592:[function(a,b,c){var d=a("backbone/core-view"),e=a("./undo-redo.tpl");b.exports=d.extend({events:{"click .js-redo":"_onRedoClick","click .js-undo":"_onUndoClick","click .js-apply":"_onApplyClick","click .js-clear":"_onClearClick"},options:{applyButton:!1,cancelButton:!1},initialize:function(a){if(!a.editorModel)throw new Error("editorModel is required");if(!a.trackModel)throw new Error("trackModel is required");this._trackModel=a.trackModel,this._editorModel=a.editorModel,this._clearModel=a.clearModel,this._initBinds()},render:function(){var a=!1;return this._clearModel&&(a=this._clearModel.get("visible")===!0),this.$el.html(e({canUndo:this._trackModel.canUndo(),canRedo:this._trackModel.canRedo(),canApply:this.options.applyButton&&this._editorModel.isEditing(),canClear:a})),this._checkButtonsStyle(),this},_initBinds:function(){this._trackModel.bind("undo redo",this.render,this),this._trackModel.bind("unredoChanged",this.render,this),this._editorModel.bind("change:edition",this._checkButtonsStyle,this),this.add_related_model(this._trackModel),this.add_related_model(this._editorModel),this._clearModel&&(this._clearModel.bind("change",this.render,this),this.add_related_model(this._clearModel))},_onUndoClick:function(){this._trackModel.canUndo()&&this._trackModel.undo()},_onRedoClick:function(){this._trackModel.canRedo()&&this._trackModel.redo()},_onApplyClick:function(){this.options.applyButton&&this.options.onApplyClick&&this.options.onApplyClick()},_onClearClick:function(){this.options.clearButton&&this.options.onClearClick&&this.options.onClearClick()},_checkButtonsStyle:function(a){var b=this._editorModel.isEditing();this._getIcons().toggleClass("u-whiteTextColor",b)},_getIcons:function(){return this.$(".js-theme")}})},{"./undo-redo.tpl":593,"backbone/core-view":1127}],593:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter">\n  <button class="js-undo">\n    <i class="CDB-IconFont CDB-IconFont-undo Size-large u-actionTextColor js-theme ',canUndo||(__p+="is-disabled"),__p+='"></i>\n  </button>\n  <button class="u-lSpace--xl js-redo">\n    <i class="CDB-IconFont CDB-IconFont-redo Size-large u-actionTextColor js-theme ',canRedo||(__p+="is-disabled"),__p+='"></i>\n  </button>\n  ',canClear&&(__p+='\n  <button class="u-lSpace--xl CDB-Button CDB-Button--secondary CDB-Button--white js-clear">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small">'+(null==(__t=_t("components.undo-redo.clear"))?"":_.escape(__t))+"</span>\n  </button>\n  "),__p+="\n  ",canApply&&(__p+='\n  <button class="u-lSpace--xl CDB-Button CDB-Button--primary js-apply">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small">'+(null==(__t=_t("components.undo-redo.apply"))?"":_.escape(__t))+"</span>\n  </button>\n  "),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],594:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view");b.exports={createByHTML:function(a,b){var c=new e(b);return c.render=function(){return this.$el.html(a),this},c},createByTemplate:function(a,b,c){var d=new e(c);return d.render=function(){return this.$el.html(a(b)),this},d},createListView:function(a,b){if(!a||!a.forEach)throw new Error("createViewFns is required as an iterable list");if(!d.all(a,d.isFunction))throw new Error("createViewFns must only contain functions");var c=new e(b);return c.render=function(){return this.clearSubViews(),a.forEach(function(a){var b=a();this.addView(b),this.$el.append(b.render().el)},this),this},c}}},{"backbone/core-view":1127,underscore:"underscore"}],595:[function(a,b,c){var d=a("backbone/core-view"),e=a("./panel-with-options.tpl"),f=a("../../components/infobox/infobox-view");b.exports=d.extend({initialize:function(a){if(!a.createContentView)throw new Error("createContentView factory function is mandatory");if(!a.editorModel)throw new Error("editorModel is required");this.template=this.options.template||e,this._createContentView=a.createContentView,this._editorModel=a.editorModel,this._createControlView=a.createControlView,this._createActionView=a.createActionView,this._infoboxModel=a.infoboxModel,this._infoboxCollection=a.infoboxCollection,this._editorModel.on("change:edition",this._setStyleMenu,this),this.add_related_model(this._editorModel)},render:function(){var a,b,c,d;return this.clearSubViews(),this.$el.empty(),this.$el.html(this.template()),a=this._createContentView(),this._content().html(a.render().el),this.addView(a),this._infoboxModel&&(d=new f({infoboxModel:this._infoboxModel,infoboxCollection:this._infoboxCollection}),this._info().html(d.render().el),this.addView(d)),this._createControlView&&(b=this._createControlView(),this._controls().html(b.render().el),this.addView(b)),this._createActionView&&(c=this._createActionView(),this._actions().html(c.render().el),this.addView(c)),this._setStyleMenu(),this},_content:function(){return this.$(".js-content")},_controls:function(){return this.$(".js-controls")},_actions:function(){return this.$(".js-actions")},_info:function(){return this.$(".js-info")},_setStyleMenu:function(){this.$(".js-theme").toggleClass("is-dark",this._editorModel.isEditing())}})},{"../../components/infobox/infobox-view":221,"./panel-with-options.tpl":596,"backbone/core-view":1127}],596:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-content js-content"></div>\n<div class="js-info"></div>\n<ul class="Options-bar u-flex u-justifySpace js-theme js-optionsBar">\n  <li class="CDB-InfoBox-footerItem js-controls"></li>\n  <li class="CDB-InfoBox-footerItem CDB-InfoBox-footerItem--right js-actions"></li>\n</ul>';return __p}},{underscore:"underscore"}],597:[function(a,b,c){b.exports={uploadStates:["pending","enqueued","uploading","unpacking","importing","guessing","complete"],fileExtensions:["csv","xls","xlsx","zip","kml","geojson","json","ods","kmz","tsv","gpx","tar","gz","tgz","osm","bz2","tif","tiff","txt","rar"],fileTimesBigger:3}},{}],598:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./permission-model"),g=["id","username","avatar_url","name"];b.exports=d.Model.extend({defaults:{access:"r"},isOwn:function(a){return a.id===this.get("entity").id},validate:function(a,b){if(a.access!==f.READ_ONLY&&a.access!==f.READ_WRITE)return"access can't take 'r' or 'rw' values"},toJSON:function(){var a=e.pick(this.get("entity").toJSON(),g);return a.username||(a.username=a.name,delete a.name),{type:this.get("type")||"user",entity:a,access:this.get("access")}}})},{"./permission-model":653,backbone:"backbone",underscore:"underscore"}],599:[function(a,b,c){var d=a("underscore"),e=a("./camshaft-reference"),f=a("../editor/layers/layer-content-views/analyses/analysis-form-models/area-of-influence-form-model"),g=a("../editor/layers/layer-content-views/analyses/analysis-form-models/aggregate-intersection-form-model"),h=a("../editor/layers/layer-content-views/analyses/analysis-form-models/filter-intersection-form-model"),i=a("../editor/layers/layer-content-views/analyses/analysis-form-models/fallback-form-model"),j=a("../editor/layers/layer-content-views/analyses/analysis-form-models/unknown-type-form-model"),k=a("../components/modals/add-analysis/analysis-option-models/merge-analysis-option-model"),l=a("../editor/layers/layer-content-views/analyses/analyses-quota/analyses-quota-info"),m=["age-and-gender","boundaries","education","employment","families","housing","income","language","migration","nationality","population-segments","race-and-ethnicity","religion","transportation"],n={"aggregate-intersection":{title:_t("analyses.aggregate-intersection.short-title"),FormModel:g,modalTitle:_t("components.modals.add-analysis.option-types.aggregate-intersection.title"),modalDesc:_t("components.modals.add-analysis.option-types.aggregate-intersection.desc"),modalCategory:"data_transformation",onboardingTemplate:a("../components/onboardings/analysis/analyses/aggregate-intersection.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/intersect.tpl")},"bounding-box":{title:_t("analyses.bounding-box.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/group-points-form-model"),onboardingTemplate:a("../components/onboardings/analysis/analyses/group-points.tpl"),genericType:"group-points"},"bounding-circle":{title:_t("analyses.bounding-circle.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/group-points-form-model"),onboardingTemplate:a("../components/onboardings/analysis/analyses/group-points.tpl"),genericType:"group-points"},buffer:{title:_t("analyses.area-of-influence.short-title"),FormModel:f,modalTitle:_t("components.modals.add-analysis.option-types.area-of-influence.title"),modalDesc:_t("components.modals.add-analysis.option-types.area-of-influence.desc"),modalCategory:"data_transformation",onboardingTemplate:a("../components/onboardings/analysis/analyses/area-of-influence.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/aoi.tpl"),genericType:"area-of-influence"},centroid:{title:_t("analyses.centroid.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/centroid-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.centroid.title"),modalDesc:_t("components.modals.add-analysis.option-types.centroid.desc"),modalCategory:"data_transformation",onboardingTemplate:a("../components/onboardings/analysis/analyses/centroid.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/centroid.tpl"),genericType:"centroid"},"convex-hull":{title:_t("analyses.convex-hull.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/group-points-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.group-points.title"),modalDesc:_t("components.modals.add-analysis.option-types.group-points.desc"),modalCategory:"data_transformation",onboardingTemplate:a("../components/onboardings/analysis/analyses//group-points.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/group-points.tpl"),animationParams:{method:_t("analyses-onboarding.placeholders.method")},genericType:"group-points"},"concave-hull":{title:_t("analyses.concave-hull.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/group-points-form-model"),onboardingTemplate:a("../components/onboardings/analysis/analyses/group-points.tpl"),genericType:"group-points"},"data-observatory-measure":{title:_t("analyses.data-observatory-measure.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/data-observatory-measure-model"),modalTitle:_t("components.modals.add-analysis.option-types.data-observatory-measure.title"),modalDesc:_t("components.modals.add-analysis.option-types.data-observatory-measure.desc"),modalCategory:"create_clean",checkIfEnabled:function(a){return r(a)},onboardingTemplate:a("../components/onboardings/analysis/analyses/data-observatory-measure.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/data-observatory-measure.tpl"),genericType:"data-observatory-measure"},"filter-by-node-column":{title:_t("analyses.filter-by-node-column.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/filter-by-node-column"),modalTitle:_t("components.modals.add-analysis.option-types.filter-by-node-column.title"),modalDesc:_t("components.modals.add-analysis.option-types.filter-by-node-column.desc"),modalCategory:"create_clean",onboardingTemplate:a("../components/onboardings/analysis/analyses/filter-by-node-column.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/filter-by-layer.tpl"),animationParams:{name_of_the_layer:_t("analyses-onboarding.placeholders.layer-name")}},"filter-category":{title:_t("analyses.filter.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/filter-form-model"),onboardingTemplate:a("../components/onboardings/analysis/analyses/filter.tpl"),genericType:"filter"},"filter-range":{title:_t("analyses.filter.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/filter-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.filter.title"),modalDesc:_t("components.modals.add-analysis.option-types.filter.desc"),modalCategory:"data_transformation",onboardingTemplate:a("../components/onboardings/analysis/analyses/filter.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/filter-by-column-value.tpl"),genericType:"filter"},"georeference-city":{title:_t("analyses.georeference.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/georeference-form-model"),checkIfEnabled:function(a){return o(a)},onboardingTemplate:a("../components/onboardings/analysis/analyses/georeference.tpl"),genericType:"georeference"},"georeference-ip-address":{title:_t("analyses.georeference.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/georeference-form-model"),checkIfEnabled:function(a){return o(a)},onboardingTemplate:a("../components/onboardings/analysis/analyses/georeference.tpl"),genericType:"georeference"},"georeference-country":{title:_t("analyses.georeference.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/georeference-form-model"),checkIfEnabled:function(a){return o(a)},onboardingTemplate:a("../components/onboardings/analysis/analyses/georeference.tpl"),genericType:"georeference"},"georeference-long-lat":{title:_t("analyses.georeference.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/georeference-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.georeference.title"),modalDesc:_t("components.modals.add-analysis.option-types.georeference.desc"),modalCategory:"create_clean",onboardingTemplate:a("../components/onboardings/analysis/analyses/georeference.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/georeference.tpl"),genericType:"georeference"},"georeference-postal-code":{title:_t("analyses.georeference.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/georeference-form-model"),checkIfEnabled:function(a){return o(a)},onboardingTemplate:a("../components/onboardings/analysis/analyses/georeference.tpl"),genericType:"georeference"},"georeference-street-address":{title:_t("analyses.georeference.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/georeference-form-model"),checkIfEnabled:function(a){return q(a)},onboardingTemplate:a("../components/onboardings/analysis/analyses/georeference.tpl"),genericType:"georeference"},"georeference-admin-region":{title:_t("analyses.georeference.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/georeference-form-model"),checkIfEnabled:function(a){return o(a)},onboardingTemplate:a("../components/onboardings/analysis/analyses/georeference.tpl"),genericType:"georeference"},intersection:{title:_t("analyses.filter-intersection.short-title"),
FormModel:h,modalTitle:_t("components.modals.add-analysis.option-types.filter-intersection.title"),modalDesc:_t("components.modals.add-analysis.option-types.filter-intersection.desc"),modalCategory:"data_transformation",onboardingTemplate:a("../components/onboardings/analysis/analyses/intersection.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/filter-by-polygon.tpl")},kmeans:{title:_t("analyses.kmeans.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/kmeans-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.kmeans.title"),modalDesc:_t("components.modals.add-analysis.option-types.kmeans.desc"),modalCategory:"analyze_predict",onboardingTemplate:a("../components/onboardings/analysis/analyses/kmeans.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/kmeans.tpl"),animationParams:{method:_t("analyses-onboarding.placeholders.clusters")}},"line-to-column":{title:_t("analyses.connect-with-lines.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/connect-with-lines-form-model"),onboardingTemplate:a("../components/onboardings/analysis/analyses/connect-with-lines.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/connect-with-lines.tpl"),genericType:"connect-with-lines"},"line-to-single-point":{title:_t("analyses.connect-with-lines.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/connect-with-lines-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.connect-with-lines.title"),modalDesc:_t("components.modals.add-analysis.option-types.connect-with-lines.desc"),modalCategory:"data_transformation",onboardingTemplate:a("../components/onboardings/analysis/analyses/connect-with-lines.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/connect-with-lines.tpl"),genericType:"connect-with-lines"},"line-source-to-target":{title:_t("analyses.connect-with-lines.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/connect-with-lines-form-model"),onboardingTemplate:a("../components/onboardings/analysis/analyses/connect-with-lines.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/connect-with-lines.tpl"),genericType:"connect-with-lines"},"line-sequential":{title:_t("analyses.connect-with-lines.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/connect-with-lines-form-model"),onboardingTemplate:a("../components/onboardings/analysis/analyses/connect-with-lines.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/connect-with-lines.tpl"),genericType:"connect-with-lines"},merge:{title:_t("analyses.merge.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/merge-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.merge.title"),modalDesc:_t("components.modals.add-analysis.option-types.merge.desc"),ModalModel:k,modalCategory:"create_clean",onboardingTemplate:a("../components/onboardings/analysis/analyses/merge.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/join-two-columns.tpl")},moran:{title:_t("analyses.moran-cluster.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/moran-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.moran-cluster.title"),modalDesc:_t("components.modals.add-analysis.option-types.moran-cluster.desc"),modalCategory:"analyze_predict",onboardingTemplate:a("../components/onboardings/analysis/analyses/moran.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/outliers.tpl")},"routing-sequential":{title:_t("analyses.routing.short-title"),FormModel:i,checkIfEnabled:function(a){return p(a)}},"routing-to-layer-all-to-all":{title:_t("analyses.routing.short-title"),FormModel:i,checkIfEnabled:function(a){return p(a)}},"routing-to-single-point":{title:_t("analyses.routing.short-title"),FormModel:i,checkIfEnabled:function(a){return p(a)}},sampling:{title:_t("analyses.sampling.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/sampling-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.sampling.title"),modalDesc:_t("components.modals.add-analysis.option-types.sampling.desc"),modalCategory:"data_transformation",onboardingTemplate:a("../components/onboardings/analysis/analyses/sampling.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/sampling.tpl"),animationParams:{percentage:_t("analyses-onboarding.placeholders.percentage")},genericType:"sampling"},"spatial-markov-trend":{title:_t("analyses.spatial-markov-trend.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/spatial-markov-trend-model"),modalTitle:_t("components.modals.add-analysis.option-types.spatial-markov-trend.title"),modalDesc:_t("components.modals.add-analysis.option-types.spatial-markov-trend.desc"),modalCategory:"analyze_predict",onboardingTemplate:a("../components/onboardings/analysis/analyses/spatial-markov-trend.tpl"),animationTemplate:a("../components/modals/add-analysis/animation-templates/predict-trends.tpl")},"trade-area":{title:_t("analyses.area-of-influence.short-title"),FormModel:f,checkIfEnabled:function(a){if(!a)throw new Error("configModel is required");return!!a.dataServiceEnabled("isolines")},onboardingTemplate:a("../components/onboardings/analysis/analyses/area-of-influence.tpl"),genericType:"area-of-influence"},"weighted-centroid":{title:_t("analyses.centroid.short-title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/centroid-form-model"),onboardingTemplate:a("../components/onboardings/analysis/analyses/centroid.tpl"),genericType:"centroid"},closest:{title:_t("editor.layers.analysis-form.find-nearest.title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/closest-form-model"),modalTitle:_t("editor.layers.analysis-form.find-nearest.modal-title"),modalDesc:_t("editor.layers.analysis-form.find-nearest.modal-desc"),modalCategory:"analyze_predict",animationTemplate:a("../components/modals/add-analysis/animation-templates/closest.tpl"),onboardingTemplate:a("../components/onboardings/analysis/analyses/closest.tpl")},"deprecated-sql-function":{title:_t("editor.layers.analysis-form.deprecated-sql-function.title"),FormModel:a("../editor/layers/layer-content-views/analyses/analysis-form-models/deprecated-sql-function-form-model"),modalTitle:_t("components.modals.add-analysis.option-types.deprecated-sql-function.title"),modalDesc:_t("components.modals.add-analysis.option-types.deprecated-sql-function.desc"),modalCategory:"data_transformation",checkIfEnabled:function(a,b){return b.featureEnabled("deprecated-sql-function")}}},o=function(a){if(!a)throw new Error("configModel is required");return t(a)&&!!a.dataServiceEnabled("geocoder_internal")},p=function(a){if(!a)throw new Error("configModel is required");return t(a)&&!!a.dataServiceEnabled("routing")},q=function(a){if(!a)throw new Error("configModel is required");return t(a)&&!!a.dataServiceEnabled("hires_geocoder")},r=function(a){if(!a)throw new Error("configModel is required");return t(a)&&!!a.dataServiceEnabled("data_observatory")},s=function(a){var b="unknown";if("string"==typeof a&&""!==a)b=a;else if(a&&a.get&&(b=a.get("type"),"data-observatory-measure"===b&&a.has("measurement"))){var c=a.get("measurement").toLowerCase().split(" ").join("-");if(d.contains(m,c)){var e=d.clone(n[b]);return e.title=_t("analyses.data-observatory-measure."+c),e}}return n[b]||{title:_t("analyses."+b),FormModel:i}},t=function(a){return l.get(a).isReady()},u=function(a,b,c){var d=n[a];return!d||!d.checkIfEnabled||d.checkIfEnabled(b,c)};b.exports={MAP:n,findFormModelByType:function(a){return e.hasType(a)?s(a).FormModel:j},getAnalysesByModalCategory:function(a,b,c){return d.reduce(n,function(d,e,f){if(e.modalCategory===a&&u(f,b,c)){var g={nodeAttrs:{type:f},title:e.modalTitle,desc:e.modalDesc};e.ModalModel&&(g.Model=e.ModalModel),d.push(g)}return d},[])},isAnalysisValidByType:function(a,b,c){return u(a,b,c)},getAnalysisByType:function(a){return n[a]},title:function(a){return s(a).title}}},{"../components/modals/add-analysis/analysis-option-models/merge-analysis-option-model":244,"../components/modals/add-analysis/animation-templates/aoi.tpl":250,"../components/modals/add-analysis/animation-templates/centroid.tpl":251,"../components/modals/add-analysis/animation-templates/closest.tpl":252,"../components/modals/add-analysis/animation-templates/connect-with-lines.tpl":253,"../components/modals/add-analysis/animation-templates/data-observatory-measure.tpl":254,"../components/modals/add-analysis/animation-templates/filter-by-column-value.tpl":255,"../components/modals/add-analysis/animation-templates/filter-by-layer.tpl":256,"../components/modals/add-analysis/animation-templates/filter-by-polygon.tpl":257,"../components/modals/add-analysis/animation-templates/georeference.tpl":258,"../components/modals/add-analysis/animation-templates/group-points.tpl":259,"../components/modals/add-analysis/animation-templates/intersect.tpl":260,"../components/modals/add-analysis/animation-templates/join-two-columns.tpl":261,"../components/modals/add-analysis/animation-templates/kmeans.tpl":262,"../components/modals/add-analysis/animation-templates/outliers.tpl":263,"../components/modals/add-analysis/animation-templates/predict-trends.tpl":264,"../components/modals/add-analysis/animation-templates/sampling.tpl":265,"../components/onboardings/analysis/analyses//group-points.tpl":486,"../components/onboardings/analysis/analyses/aggregate-intersection.tpl":477,"../components/onboardings/analysis/analyses/area-of-influence.tpl":478,"../components/onboardings/analysis/analyses/centroid.tpl":479,"../components/onboardings/analysis/analyses/closest.tpl":480,"../components/onboardings/analysis/analyses/connect-with-lines.tpl":481,"../components/onboardings/analysis/analyses/data-observatory-measure.tpl":482,"../components/onboardings/analysis/analyses/filter-by-node-column.tpl":483,"../components/onboardings/analysis/analyses/filter.tpl":484,"../components/onboardings/analysis/analyses/georeference.tpl":485,"../components/onboardings/analysis/analyses/group-points.tpl":486,"../components/onboardings/analysis/analyses/intersection.tpl":487,"../components/onboardings/analysis/analyses/kmeans.tpl":488,"../components/onboardings/analysis/analyses/merge.tpl":489,"../components/onboardings/analysis/analyses/moran.tpl":490,"../components/onboardings/analysis/analyses/sampling.tpl":491,"../components/onboardings/analysis/analyses/spatial-markov-trend.tpl":492,"../editor/layers/layer-content-views/analyses/analyses-quota/analyses-quota-info":796,"../editor/layers/layer-content-views/analyses/analysis-form-models/aggregate-intersection-form-model":812,"../editor/layers/layer-content-views/analyses/analysis-form-models/area-of-influence-form-model":815,"../editor/layers/layer-content-views/analyses/analysis-form-models/centroid-form-model":821,"../editor/layers/layer-content-views/analyses/analysis-form-models/closest-form-model":823,"../editor/layers/layer-content-views/analyses/analysis-form-models/connect-with-lines-form-model":825,"../editor/layers/layer-content-views/analyses/analysis-form-models/data-observatory-measure-model":832,"../editor/layers/layer-content-views/analyses/analysis-form-models/deprecated-sql-function-form-model":834,"../editor/layers/layer-content-views/analyses/analysis-form-models/fallback-form-model":836,"../editor/layers/layer-content-views/analyses/analysis-form-models/filter-by-node-column":837,"../editor/layers/layer-content-views/analyses/analysis-form-models/filter-form-model":840,"../editor/layers/layer-content-views/analyses/analysis-form-models/filter-intersection-form-model":842,"../editor/layers/layer-content-views/analyses/analysis-form-models/georeference-form-model":849,"../editor/layers/layer-content-views/analyses/analysis-form-models/group-points-form-model":856,"../editor/layers/layer-content-views/analyses/analysis-form-models/kmeans-form-model":863,"../editor/layers/layer-content-views/analyses/analysis-form-models/merge-form-model":865,"../editor/layers/layer-content-views/analyses/analysis-form-models/moran-form-model":867,"../editor/layers/layer-content-views/analyses/analysis-form-models/sampling-form-model":869,"../editor/layers/layer-content-views/analyses/analysis-form-models/spatial-markov-trend-model":871,"../editor/layers/layer-content-views/analyses/analysis-form-models/unknown-type-form-model":873,"./camshaft-reference":615,underscore:"underscore"}],600:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./backbone/sync-abort");b.exports=e.Model.extend({sync:f,initialize:function(a,b){if(!b.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");this.USER_SAVED=!1,this._analysisDefinitionNodesCollection=b.analysisDefinitionNodesCollection},parse:function(a,b){var c=this._analysisDefinitionNodesCollection||b.analysisDefinitionNodesCollection;c.add(a.analysis_definition,{silent:!0,merge:!0,parse:!0});var e=d.omit(a,"analysis_definition");return e.node_id=a.analysis_definition.id,e},toJSON:function(){return{id:this.id,analysis_definition:this.getNodeDefinitionModel().toJSON()}},containsNode:function(a){var b=this.getNodeDefinitionModel();return!(!b||!b.containsNode(a))},getNodeDefinitionModel:function(){return this._analysisDefinitionNodesCollection.get(this.get("node_id"))}})},{"./backbone/sync-abort":607,backbone:"backbone",underscore:"underscore"}],601:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./camshaft-reference"),g=a("./query-geometry-model"),h=a("./query-schema-model"),i=a("../value-objects/analysis-node-ids"),j=a("../helpers/required-opts"),k=a("./query-rows-collection"),l=a("../helpers/fetch-all-query-objects"),m=["configModel"];b.exports=e.Model.extend({initialize:function(a,b){if(!this.id)throw new Error("id is required");j(b,m,this);var c={configModel:this._configModel,userModel:b.userModel},d=this.get("simple_geom");this.querySchemaModel=new h(void 0,c),this.queryGeometryModel=new g({simple_geom:d,status:d?"fetched":"unfetched"},c),this.queryRowsCollection=new k([],{configModel:this._configModel,userModel:b.userModel,tableName:"",querySchemaModel:this.querySchemaModel}),this.listenTo(this.queryGeometryModel,"change:simple_geom",this._onGeometryTypeChanged)},fetchQueryObjects:function(){"ready"!==this.get("status")||this.get("error")||l({queryGeometryModel:this.queryGeometryModel,querySchemaModel:this.querySchemaModel,queryRowsCollection:this.queryRowsCollection})},parse:function(a,b){var c=!a.type&&b.merge?[]:f.getSourceNamesForAnalysisType(a.type),e=d.reduce(a.params,function(a,d,e){var f=c[c.indexOf(e)];return f?(this.collection.add(d,b),a[e]=d.id):a[e]=d,a},{},this),g=d.reduce(a.options,function(a,b,c){return a[c]=b,a},{},this);return d.defaults(d.omit(a,"params","options"),g,e)},toJSON:function(a){a=a||{};var b=[],c={},e=f.paramsForType(this.get("type"));for(var g in e){var h=e[g],i=this.get(g),j=!0;if("node"===h.type){var k=this.collection.get(i);if(k)i=k.toJSON(a);else{if(!h.optional)throw new Error('no node found for param "'+g+'" with id "'+i+'" in node '+JSON.stringify(this.attributes));j=!1}}j&&(c[g]=i,b.push(g))}var l={id:this.get("id"),type:this.get("type"),params:c},m=d.omit(this.attributes,b.concat("id","type","status","style_history"));return a.skipOptions||d.isEmpty(m)||(l.options=m),l},isNew:function(){return!0},isReadOnly:function(){return!0},isCustomQueryApplied:function(){return!1},canBeDeletedByUser:function(){return this.hasPrimarySource()},hasFailed:function(){return"failed"===this.get("status")},isDone:function(){return"ready"===this.get("status")},destroy:function(){return this.querySchemaModel&&(this.querySchemaModel.destroy(),this.querySchemaModel=null),e.Model.prototype.destroy.apply(this,arguments)},clone:function(a){if(!a)throw new Error("newId is required");if(!d.isString(a)||a.length<2)throw new Error("newId is required as a non-empty string");if(a===this.id)throw new Error("newId must be different from current id, "+this.id);var b=this.toJSON();return b.id=a,this.collection.add(b)},linkedListBySameLetter:function(){for(var a=[this],b=this,c=this.letter();;){var d=b.getPrimarySource();if(!d||d.letter()!==c)break;a.push(d),b=d}return a},isValidAsInputForType:function(a){if("source"===a)return!1;var b=this.queryGeometryModel.get("simple_geom");return b?f.isValidInputGeometryForType(b,a):null},containsNode:function(a){return!!a&&(this.id===a.id||this._sourcesContains(a))},hasPrimarySource:function(){return!!this.getPrimarySource()},hasSecondarySource:function(){return!!this.getSecondarySource()},getPrimarySource:function(){return this.collection.get(this._getPrimarySourceId())},getSecondarySource:function(){var a=this._getPrimarySourceId(),b=d.find(this.sourceIds(),function(b){return b!==a});return this.collection.get(b)},getDefaultQuery:function(){return this.get("query")},sourceIds:function(){return d.map(this._sourceNames(),function(a){return this.get(a)},this)},changeSourceIds:function(a,b,c){this._sourceNames().forEach(function(d){this.get(d)===a&&this.set(d,b,{silent:c})},this)},isSourceType:function(){return"source"===this.get("type")},letter:function(){return i.letter(this.id)},getStyleHistoryForLayer:function(a){var b=this.get("style_history");return b&&b[a]},_sourcesContains:function(a){var b=this.getPrimarySource(),c=this.getSecondarySource();return!!(b&&b.containsNode(a)||c&&c.containsNode(a))},_getPrimarySourceId:function(){var a=this.get("primary_source_name")||this._sourceNames()[0];return this.get(a)},_sourceNames:function(){return f.getSourceNamesForAnalysisType(this.get("type"))},_onGeometryTypeChanged:function(a,b){this.set("simple_geom",b)}})},{"../helpers/fetch-all-query-objects":1092,"../helpers/required-opts":1097,"../value-objects/analysis-node-ids":1119,"./camshaft-reference":615,"./query-geometry-model":656,"./query-rows-collection":658,"./query-schema-model":659,backbone:"backbone",underscore:"underscore"}],602:[function(a,b,c){var d=a("./analysis-definition-node-model"),e=a("./table-model"),f=a("../helpers/sql-utils");b.exports=d.extend({defaults:{status:"ready"},initialize:function(a,b){if(!b.userModel)throw new Error("userModel is required");this._userModel=b.userModel,d.prototype.initialize.apply(this,arguments);var c=this.get("query");this.querySchemaModel.set({query:c,ready:!0},{silent:!0}),this.queryGeometryModel.set({query:c,ready:!0},{silent:!0}),this.queryRowsCollection._tableName=this.get("table_name");var f=b.tableData||{name:this.get("table_name")};this.tableModel=new e(f,{configModel:b.configModel,parse:!0})},getDefaultQuery:function(){return f.getDefaultSQL(this.get("table_name"),this.tableModel.getOwnerName(),this._userModel.isInsideOrg())},isCustomQueryApplied:function(){return!f.isSameQuery(this.querySchemaModel.get("query"),this.getDefaultQuery())},isReadOnly:function(){var a=this.tableModel.isReadOnly(this._userModel),b=this.isCustomQueryApplied();return a||b},getTableModel:function(){return this.tableModel},fetchTable:function(){this.tableModel.get("id")||this.tableModel.fetch()},setTableName:function(a){if(!a)throw new Error("name is required");this.set("table_name",a),this.tableModel.set("name",a),this.queryRowsCollection.setTableName(a),this.querySchemaModel.set({status:"unfetched",query:this.getDefaultQuery()})}})},{"../helpers/sql-utils":1099,"./analysis-definition-node-model":601,"./table-model":665}],603:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./analysis-definition-node-source-model"),g=a("./analysis-definition-node-model"),h=a("../helpers/sql-utils"),i=a("../helpers/table-name-utils"),j=a("../helpers/required-opts"),k=["userModel","configModel"];b.exports=e.Collection.extend({initialize:function(a,b){j(b,k,this),this._relatedTableData=b.relatedTableData||[],this._initBinds()},_initBinds:function(){this.on("queryObjectsUpdated",this._onQueryObjectsUpdated)},addRelatedTableData:function(a){this._relatedTableData.push(a)},model:function(a,b){var c=b.collection;if(b=d.extend({parse:!0,configModel:c._configModel,userModel:c._userModel},b),"source"===a.type){var e=d.find(c._relatedTableData,function(b){return i.isSameTableName(a.options.table_name,b.name,c._configModel.get("user_name"))});return e&&(b.tableData=e),new f(a,b)}return new g(a,b)},createSourceNode:function(a){if(a=a||{},!a.id)throw new Error("id is required");if(!a.tableName)throw new Error("tableName is required");return this.add({id:a.id,type:"source",params:{query:a.query||h.getDefaultSQL(a.tableName,i.getUsername(a.tableName),!0)},options:{table_name:a.tableName}})},_onQueryObjectsUpdated:function(a){this._fetchQueryObjectsIfOnTop(a)},_fetchQueryObjectsIfOnTop:function(a){this._isNodeOnTop(a)&&a.fetchQueryObjects()},_isNodeOnTop:function(a){var b=this.indexOf(a);return b===this._getTopNodeIndex()},_getTopNodeIndex:function(){var a=this._getNodeOnTop(),b=this.indexOf(a);return b},_getNodeOnTop:function(){return this.last()}})},{"../helpers/required-opts":1097,"../helpers/sql-utils":1099,"../helpers/table-name-utils":1101,"./analysis-definition-node-model":601,"./analysis-definition-node-source-model":602,backbone:"backbone",underscore:"underscore"}],604:[function(a,b,c){var d=a("backbone"),e=a("../value-objects/analysis-node-ids"),f=a("./analysis-definition-model");b.exports=d.Collection.extend({model:function(a,b){var c=b.collection,d=new f(a,{parse:!0,collection:c,analysisDefinitionNodesCollection:c._analysisDefinitionNodesCollection});return d},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.vizId)throw new Error("vizId is required");if(!b.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");this._configModel=b.configModel,this._vizId=b.vizId,this._analysisDefinitionNodesCollection=b.analysisDefinitionNodesCollection},url:function(){var a=this._configModel.get("base_url");return a+"/api/v3/viz/"+this._vizId+"/analyses"},findAnalysisThatContainsNode:function(a){return this.findWhere({node_id:a.id})||this.find(function(b){return b.containsNode(a)})},findAnalysisForLayer:function(a){var b=a.get("letter");return this.find(function(a){var c=e.letter(a.get("node_id"));return c===b})},newAnalysisForNode:function(a){return this.add({analysis_definition:a.toJSON()})},saveAnalysisForLayer:function(a){if(!a)throw new Error("layerDefModel is required");var b=a.getAnalysisDefinitionNodeModel(),c=this.findAnalysisForLayer(a);return a.isOwnerOfAnalysisNode(b)?c?c.set("node_id",b.id):c=this.add({analysis_definition:b.toJSON()}):c&&c.destroy(),this.each(function(a){a.containsNode(b)&&a.save()}),c}})},{"../value-objects/analysis-node-ids":1119,"./analysis-definition-model":600,backbone:"backbone"}],605:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../helpers/utils");a("backbone-model-file-upload"),b.exports=e.Model.extend({fileAttribute:"filename",defaults:{type:"",filename:"",interval:0,progress:0,state:"idle",option:""},_initBinds:function(){this.bind("progress",function(a){this.set({progress:100*a,state:"uploading"})},this),this.bind("change:filename change:url",function(){"error"===this.get("state")&&(this.set({state:"idle"}),this.unset("get_error_text",{silent:!0}))},this),this.bind("error invalid",function(a,b){this.set({state:"error",error_code:b&&b.error_code||"",get_error_text:{title:_t("componentes.data.asset-model.invalid-import"),what_about:b&&b.msg||""}},{silent:!0}),this.trigger("change")},this)},validate:function(a){if(a){if("filename"===a.type){if(a.filename&&a.filename.length)return{msg:_t("componentes.data.asset-model.one-file-per-upload")};var b=a.filename.name,c=b.substr(b.lastIndexOf(".")+1);if(c&&(c=c.toLowerCase()),!d.contains(["jpg","png","gif","svg"],c))return{msg:_t("componentes.data.asset-model.invalid-extension")}}return"url"!==a.type||f.isURL(a.url)?void 0:{msg:_t("componentes.data.asset-model.invalid-url")}}},isValid:function(){return(this.get("filename")||this.get("url"))&&"error"!==this.get("state")},upload:function(){var a=this,b={kind:this.get("kind")};"file"===this.get("type")?b.filename=this.get("filename"):"url"===this.get("type")&&(b.filename=this.get("filename")),this.xhr=this.save(b,{success:function(a){a.set("state","uploaded")},error:function(b,c){var d,e=_t("componentes.data.asset-model.connection-error");c&&429===c.status?(d=JSON.parse(c.responseText),e=d.error):c&&400===c.status&&(d=JSON.parse(c.responseText),e=d.error),a.set({state:"error",get_error_text:{title:_t("componentes.data.asset-model.error"),what_about:e}})},complete:function(){delete a.xhr}})},stopUpload:function(){this.xhr&&this.xhr.abort()}})},{"../helpers/utils":1102,backbone:"backbone","backbone-model-file-upload":"backbone-model-file-upload",underscore:"underscore"}],606:[function(a,b,c){var d=a("backbone"),e=a("./asset-model"),f=a("../helpers/required-opts"),g=["configModel","userModel"];b.exports=d.Collection.extend({model:e,url:function(a){var b=this._configModel.get("base_url"),c=this._configModel.urlVersion("asset",a);return b+"/api/"+c+"/users/"+this._userModel.get("id")+"/assets"},initialize:function(a,b){f(b,g,this)},parse:function(a,b){return a.assets},selectAll:function(){this.each(function(a){a.set("state","selected")})},deselectAll:function(a){this.each(function(b){b!==a&&"selected"===b.get("state")&&b.set("state","")})}})},{"../helpers/required-opts":1097,"./asset-model":605,backbone:"backbone"}],607:[function(a,b,c){var d=a("backbone");b.exports=function(a,b,c){this._xhr&&this._xhr.abort();var e=this._xhr=d.Model.prototype.sync.apply(this,arguments);return e.always(function(){b._xhr=null}),e}},{backbone:"backbone"}],608:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./imports-model"),g=3e4;b.exports=e.Collection.extend({initialize:function(a,b){if(!b.userModel)throw new Error("userModel is required");if(!b.configModel)throw new Error("configModel is required");this._userModel=b.userModel,this._configModel=b.configModel},model:function(a,b){return new f(a,{userModel:b.collection._userModel,configModel:b.collection._configModel})},url:function(a){var b=this._configModel.urlVersion("import"),c=this._configModel.get("base_url");return c+"/api/"+b+"/imports"},parse:function(a){var b=this;return 0===a.imports.length?this.destroyCheck():d.each(a.imports,function(a){var c=b.filter(function(b){return b._importModel.get("item_queue_id")===a});if(0===c.length){var d=new f({id:a},{userModel:b._userModel,configModel:b._configModel});b.add(d)}}),this.models},canImport:function(){var a=this._userModel.getMaxConcurrentImports(),b=this.size(),c=0;return this.each(function(a){(a.hasFailed()||a.hasCompleted())&&++c}),b-c<a},pollCheck:function(a){if(!this.pollTimer){var b=this;this.pollTimer=setInterval(function(){b.fetch()},g||2e3),this.fetch()}},destroyCheck:function(){clearInterval(this.pollTimer),delete this.pollTimer},failedItems:function(){return this.filter(function(a){return a.hasFailed()})}})},{"./imports-model":612,backbone:"backbone",underscore:"underscore"}],609:[function(a,b,c){var d=a("backbone"),e=a("./background-importer-imports-collection"),f=3e3;b.exports=d.Model.extend({defaults:{showSuccessDetailsButton:!0,importsPolling:!1},initialize:function(a,b){if(!b.userModel)throw new Error("userModel is required");if(!b.configModel)throw new Error("configModel is required");this._userModel=b.userModel,this._configModel=b.configModel,this.importsCollection=b.importsCollection||new e(null,{userModel:this._userModel,configModel:this._configModel}),this._initBinds(),this.startPollings()},_initBinds:function(){this.importsCollection.bind("change:state",function(a){this.trigger("change",a,this),this._onImportsStateChange(a)},this),this.importsCollection.bind("remove",function(a){this.trigger("importRemoved",a,this)},this),this.importsCollection.bind("add",function(a){this.trigger("importAdded",a,this)},this)},getTotalFailedItems:function(){return this.importsCollection.failedItems().length},removeImportItem:function(a){return!!a&&void this.importsCollection.remove(a)},addImportItem:function(a){return!!a&&void this.importsCollection.add(a)},canAddImport:function(){return this.importsCollection.canImport()},getTotalImports:function(){return this.importsCollection.size()},getTotalPollings:function(){return this.importsCollection.size()},stopPollings:function(){this.get("importsPolling")&&this.importsCollection.destroyCheck()},startPollings:function(){var a=this;setTimeout(function(){a.get("importsPolling")&&a.importsCollection.pollCheck()},f)},_onImportsStateChange:function(){},clean:function(){this.importsCollection.unbind(null,null,this)}})},{"./background-importer-imports-collection":608,backbone:"backbone"}],610:[function(a,b,c){var d=a("underscore"),e=a("./poller"),f=function(a){var b=2e3,c=2.5,d=30,f={interval:function(a){return a>=d?b*c:b},stopWhen:function(a){var b=a.get("state");return"complete"===b||"failure"===b}};e.call(this,a,f)};f.prototype=d.extend({},e.prototype),b.exports=f},{"./poller":613,underscore:"underscore"}],611:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./import-model-poller"),g=a("../synchronization-model");b.exports=e.Model.extend({idAttribute:"item_queue_id",initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this._initBinds(),this.poller=new f(this)},urlRoot:function(){var a=this._configModel.urlVersion("import"),b=this._configModel.get("base_url");return b+"/api/"+a+"/imports"},_initBinds:function(){this.bind("change:item_queue_id",this._checkQueueId,this)},createImport:function(a){var b=this._prepareData(a);this[0===b.interval?"_createRegularImport":"_createSyncImport"](b)},_checkQueueId:function(){this.get("item_queue_id")&&this.pollCheck()},_prepareData:function(a){var b={create_vis:a.create_vis,privacy:a.privacy},c=a.type;"remote"!==c&&d.extend(b,{type_guessing:a.type_guessing,content_guessing:a.content_guessing,interval:a.interval});var e=a.service_name;if("url"===c&&d.extend(b,{url:a.value}),"remote"===c&&d.extend(b,{type:"remote",interval:null,remote_visualization_id:a.remote_visualization_id,create_vis:!1,value:a.value}),"sql"===c&&d.extend(b,{table_name:a.table_name,sql:a.value}),"duplication"===c&&d.extend(b,{table_name:a.table_name,table_copy:a.value}),"service"===c){var f="twitter_search"===e?JSON.stringify(a.service_item_id):a.service_item_id;a.user_defined_limits&&(b.user_defined_limits=a.user_defined_limits),d.extend(b,{value:a.value,service_name:a.service_name,service_item_id:f})}return b},_createSyncImport:function(a){var b=this;this._synchronizationModel=new g(a,{configModel:this._configModel}),this._synchronizationModel.save(null,{success:function(a){b.set("item_queue_id",a.get("data_import").item_queue_id)},error:function(a,c,d){b._setErrorState(c)}})},_createRegularImport:function(a){var b=this;this.save(a,{error:function(a,c,d){b._setErrorState(c)}})},_setErrorState:function(a){var b;try{b=a&&JSON.parse(a.responseText).errors.imports}catch(a){b=_t("data.import-model.error-starting-import")}this.set({state:"failure",get_error_text:{title:_t("data.import-model.error-title"),what_about:b}})},pollCheck:function(){this.poller.start()},destroyCheck:function(){this.poller.stop()}})},{"../synchronization-model":663,"./import-model-poller":610,backbone:"backbone",underscore:"underscore"}],612:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./import-model"),g=a("../upload-model"),h=a("../vis-definition-model"),i=a("../permission-model");b.exports=e.Model.extend({defaults:{step:"upload",state:""
},initialize:function(a,b){if(!b.userModel)throw new Error("userModel is required");if(!b.configModel)throw new Error("configModel is required");this._userModel=b.userModel,this._configModel=b.configModel,this._uploadModel=new g(b.upload,{userModel:this._userModel,configModel:this._configModel}),d.isEmpty(b)&&(b={}),this._importModel=new f(b.import,{configModel:this._configModel}),this._initBinds(),this._checkStatus()},_initBinds:function(){this.bind("change:import",this._onImportChange,this),this.bind("change:upload",this._onUploadChange,this),this.bind("change:id",this._onIdChange,this),this._importModel.bind("change",function(){this.trigger("change:import",this),this.trigger("change",this)},this),this._uploadModel.bind("change",function(){this.trigger("change:upload",this),this.trigger("change",this)},this)},_destroyBinds:function(){this._uploadModel.unbind(null,null,this),this._importModel.unbind(null,null,this)},_onIdChange:function(){var a=this.get("id");a&&this._importModel.set("item_queue_id",a),this.set("step","import")},_onUploadChange:function(a,b){if("upload"===this.get("step")){var c=this._uploadModel.get("item_queue_id"),d=this._uploadModel.get("state");c&&this.set("id",c),d&&this.set("state",d)}},_onImportChange:function(){if("import"===this.get("step")){var a=this._importModel.get("state");a&&this.set("state",a)}},_checkStatus:function(){return this.get("id")||this._uploadModel.isValid()?void("file"===this._uploadModel.get("type")?this._uploadModel.upload():this.get("id")?(this.set("step","import"),this._importModel.set("item_queue_id",this.get("id"))):this._importModel.get("item_queue_id")||""===this._uploadModel.get("type")||(this.set("step","import"),this._importModel.createImport(this._uploadModel.toJSON()))):void this.trigger("change:upload")},pause:function(){this.stopUpload(),this.stopImport()},hasFailed:function(){var a=this.get("state"),b=this.get("step");return"import"===b&&"failure"===a||"upload"===b&&"error"===a},hasCompleted:function(){return"import"===this.get("step")&&this._importModel&&"complete"===this._importModel.get("state")},getWarnings:function(){return"import"===this.get("step")?this._importModel.get("warnings"):""},getError:function(){if(this.hasFailed()){var a=this.get("step");return d.extend({errorCode:this["upload"===a?"_uploadModel":"_importModel"].get("error_code"),itemQueueId:"import"===a?this._importModel.get("id"):"",originalUrl:"import"===a?this._importModel.get("original_url"):"",dataType:"import"===a?this._importModel.get("data_type"):"",httpResponseCode:"import"===a?this._importModel.get("http_response_code"):"",httpResponseCodeMessage:"import"===a?this._importModel.get("http_response_code_message"):""},this["upload"===a?"_uploadModel":"_importModel"].get("get_error_text"))}return{title:"",what_about:"",error_code:""}},importedVis:function(){return this.get("import").derived_visualization_id?this._getMapVis():this._getDatasetVis()},_getMapVis:function(){var a=this._importModel.get("derived_visualization_id");return!!a&&this._createVis({type:"derived",id:a})},_getDatasetVis:function(){var a=this._importModel.get("table_name");return!!a&&this._createVis({type:"table",table:{name:a}})},_createVis:function(a){var b=new h(a,{configModel:this._configModel});return b.permission=new i(null,{configModel:this._configModel,userModel:this._userModel}),b},setError:function(a){var b=this["upload"===this.get("step")?"_uploadModel":"_importModel"];this.stopUpload(),this.stopImport(),b.set(a),this.set("state","error")},stopUpload:function(){this._uploadModel.stopUpload()},stopImport:function(){this._importModel.destroyCheck()},get:function(a){return"upload"===a?this._uploadModel.toJSON():"import"===a?this._importModel.toJSON():e.Model.prototype.get.call(this,a)},toJSON:function(){return{step:this.get("step"),id:this.get("id"),state:this.get("state"),upload:this._uploadModel.toJSON(),import:this._importModel.toJSON()}}})},{"../permission-model":653,"../upload-model":668,"../vis-definition-model":675,"./import-model":611,backbone:"backbone",underscore:"underscore"}],613:[function(a,b,c){var d=a("underscore"),e=function(a,b){this.model=a,this.numberOfRequests=0,this.polling=!1,this.interval=b.interval,"function"!=typeof this.interval&&(this.interval=function(){return b.interval}),this.stopWhen=b.stopWhen,this.error=b.error,this.autoStart=b.autoStart,this.autoStart&&this.start()};e.prototype.start=function(){this.timeout||this._scheduleFetch()},e.prototype._scheduleFetch=function(){this.timeout=setTimeout(this._fetch.bind(this),this.interval(this.numberOfRequests))},e.prototype._fetch=function(){var a=this;a.polling||(a.polling=!0,a.model.fetch({success:function(){a.polling=!1,a.numberOfRequests++,a._continuePolling()&&a._scheduleFetch()},error:function(b){d.isFunction(a.error)&&a.error(a.model)}}))},e.prototype._continuePolling=function(){return!this.stopWhen||d.isFunction(this.stopWhen)&&!this.stopWhen(this.model)},e.prototype.stop=function(){this.polling=!1,clearTimeout(this.timeout),delete this.timeout},b.exports=e},{underscore:"underscore"}],614:[function(a,b,c){var d="leaflet",e="googlemaps",f="GMaps",g="GMapsBase",h="Tiled";b.exports={getProvider:function(a){return a===g?e:d},getLayerType:function(a){return this.isGoogleMapsCategory(a)?g:h},isGoogleMapsCategory:function(a){return a===f}}},{}],615:[function(a,b,c){var d=a("underscore"),e=a("camshaft-reference").getVersion("latest"),f=a("./default-cartography.json"),g={},h=[void 0,null,"",NaN];b.exports={hasType:function(a){return!!e.analyses[a]},paramsForType:function(a){if(!this.hasType(a))throw new Error("no analysis params found for type: "+a);return d.clone(e.analyses[a].params)},validate:function(a){var b={},c=this.parse(a),e=this.paramsForType(a.type);for(var f in e){var g=e[f],h=c[f];if(!g.optional||void 0!==h)switch(g.type){case"node":h||(b[f]=_t("data.analysis-definition-node-model.validation.invalid-source"));break;case"number":isNaN(h)&&(b[f]=_t("data.analysis-definition-node-model.validation.invalid-value"));break;case"enum":d.contains(g.values,h)||(b[f]=_t("data.analysis-definition-node-model.validation.invalid-enum",{expectedValues:JSON.stringify(g.values)}));break;default:null===h&&(b[f]=_t("data.analysis-definition-node-model.validation.missing-required"))}}if(!d.isEmpty(b))return b},parse:function(a){var b=d.extend({},a),c=this.paramsForType(a.type);for(var e in c){var f=c[e],g=b[e];if(f.optional&&d.contains(h,g))delete b[e];else switch(f.type){case"node":b[e]=(g||"").trim();break;case"number":b[e]=parseFloat(g,10);break;case"boolean":b[e]="true"===g||g===!0;break;default:d.contains(h,g)?b[e]=null:d.isString(g)&&(b[e]=g.trim())}}return b},getSourceNamesForAnalysisType:function(a){if(!g[a]){var b=[],c=this.paramsForType(a);for(var d in c){var e=c[d];"node"===e.type&&b.push(d)}g[a]=b}return g[a]},getDefaultCartoCSSForType:function(){return d.template(["#layer['mapnik::geometry_type'=1] {","  marker-width: <%= point.fill.size.fixed %>;","  marker-fill: <%= point.fill.color.fixed %>;","  marker-fill-opacity: <%= point.fill.color.opacity %>;","  marker-line-color: <%= point.stroke.color.fixed %>;","  marker-line-width: <%= point.stroke.size.fixed %>;","  marker-line-opacity: <%= point.stroke.color.opacity %>;","  marker-placement: point;","  marker-type: ellipse;","  marker-allow-overlap: true;","}","#layer['mapnik::geometry_type'=2] {","  line-color: <%= line.stroke.color.fixed %>;","  line-width: <%= line.stroke.size.fixed %>;","  line-opacity: 1;","}","#layer['mapnik::geometry_type'=3] {","  polygon-fill: <%= polygon.fill.color.fixed %>;","  polygon-opacity: <%= polygon.fill.color.opacity %>;","  polygon-gamma: 0.5;","  line-color: <%= polygon.stroke.color.fixed%>;","  line-width: <%= polygon.stroke.size.fixed %>;","  line-opacity: <%= polygon.stroke.color.opacity %>;","  line-comp-op: soft-light;","}"].join("\n"))(f.simple)},isValidInputGeometryForType:function(a,b){var c=this.getValidInputGeometriesForType(b);return d.contains(c,a)||d.contains(c,"*")},getValidInputGeometriesForType:function(a){var b=this.paramsForType(a),c=[];for(var e in b){var f=b[e];"node"===f.type&&(c=d.union(c,f.geometry))}return c}}},{"./default-cartography.json":621,"camshaft-reference":"camshaft-reference",underscore:"underscore"}],616:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({idAttribute:"name"})},{backbone:"backbone"}],617:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("cartodb.js"),g=d.template("SELECT <%= column %> FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY <%= column %> ASC"),h=100;b.exports=e.Model.extend({initialize:function(a,b){if(!b.configModel)throw new Error("configModel param is required");if(!b.nodeDefModel)throw new Error("nodeDefModel param is required");this._query=b.nodeDefModel.querySchemaModel.get("query"),this._rowData=[],this._SQL=new f.SQL({user:b.configModel.get("user_name"),sql_api_template:b.configModel.get("sql_api_template"),api_key:b.configModel.get("api_key")}),this.on("change:column",this.fetch,this)},_onQueryDone:function(a){var b=d.size(a.rows);b&&b<h&&(this._rowData=d.pluck(a.rows,this.get("column")),this.trigger("columnsFetched",this._rowData))},fetch:function(){this.get("column")&&this._query&&this._SQL.execute(g({sql:this._query,column:this.get("column")}),null,{extra_params:["page","rows_per_page"],page:0,rows_per_page:40,success:this._onQueryDone.bind(this),error:function(){}})},getRows:function(){var a=d.size(this._rowData);return a>0&&(!!(a&&a<h)&&d.reject(this._rowData,d.isNull))}})},{backbone:"backbone","cartodb.js":"cartodb.js",underscore:"underscore"}],618:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{base_url:"/CHANGEME"},urlVersion:function(a,b,c){b=b||"";var d=this.get(a+"_"+b+"_url_version");return d||c||"v1"},getSqlApiUrl:function(a){return a=a||"v2",this._getSqlApiBaseUrl()+"/api/"+a+"/sql"},_getSqlApiBaseUrl:function(){var a;return a=this.get("sql_api_template")?this.get("sql_api_template").replace("{user}",this.get("user_name")):this.get("sql_api_protocol")+"://"+this.get("user_name")+"."+this.get("sql_api_domain")+":"+this.get("sql_api_port")},dataServiceEnabled:function(a){var b=this.get("dataservices_enabled");return!!(b&&e.size(b)&&a)&&!!b[a]}})},{backbone:"backbone",underscore:"underscore"}],619:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({getAttributes:function(){return JSON.parse(JSON.stringify(this.attributes))},_generateClassName:function(a){return a?a.replace(/\s+/g,"").replace(/[^a-zA-Z_0-9 ]/g,"").toLowerCase():""},parse:function(a){var b={};return e.extend(b,a.options,{id:a.id,className:this._generateClassName(a.options.urlTemplate),type:"Tiled",order:a.order,parent_id:a.parent_id}),b},toJSON:function(){var a=e.clone(e.omit(this.attributes,["order","id"])),b={kind:"tiled",options:a,order:this.get("order"),id:this.id};return b},getValue:function(){return this.get("val")},validateTemplateURL:function(a){var b=["a","b","c"],c=new Image;c.onload=a.success,c.onerror=a.error,c.src=this.get("urlTemplate").replace(/\{s\}/g,function(){return b[Math.floor(3*Math.random())]}).replace(/\{x\}/g,"0").replace(/\{y\}/g,"0").replace(/\{z\}/g,"0")}})},{backbone:"backbone",underscore:"underscore"}],620:[function(a,b,c){var d=a("backbone"),e=a("./custom-baselayer-model"),f=a("../helpers/required-opts"),g=["configModel","currentUserId"];b.exports=d.Collection.extend({model:function(a,b){var c=b.collection,d=new e(a,{parse:!0,collection:c});return d},url:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("user");return a+"/api/"+b+"/users/"+this._currentUserId+"/layers"},initialize:function(a,b){f(b,g,this)},isCustomCategory:function(){var a=this.where(function(a){return["NASA","TileJSON","WMS","Mapbox","Custom",void 0].some(function(b){return a.get("category")===b})});return a},getSelected:function(){return this.findWhere({selected:!0})},hasCustomBaseLayer:function(a){if(a){var b=this.where({className:a});return b.length>0}}})},{"../helpers/required-opts":1097,"./custom-baselayer-model":619,backbone:"backbone"}],621:[function(a,b,c){b.exports={simple:{point:{fill:{size:{fixed:7},color:{fixed:"#FFB927",opacity:.9}},stroke:{size:{fixed:1},color:{fixed:"#FFF",opacity:1}}},line:{fill:{},stroke:{size:{fixed:1.5},color:{fixed:"#3EBCAE",opacity:1}}},polygon:{fill:{color:{fixed:"#374C70",opacity:.9}},stroke:{size:{fixed:1},color:{fixed:"#FFF",opacity:.5}}}}}},{}],622:[function(a,b,c){b.exports={fill:{size:{fixed:7},color:{fixed:"#FFB927",opacity:.9}},stroke:{size:{fixed:1},color:{fixed:"#FFF",opacity:1}},blending:"none",aggregation:{},labels:{enabled:!1,attribute:null,font:"DejaVu Sans Book",fill:{size:{fixed:10},color:{fixed:"#FFFFFF",opacity:1}},halo:{size:{fixed:1},color:{fixed:"#6F808D",opacity:1}},offset:-10,overlap:!0,placement:"point"}}},{}],623:[function(a,b,c){var d=a("./background-importer/background-polling-model"),e=a("./table-model");b.exports=d.extend({initialize:function(a,b){if(d.prototype.initialize.apply(this,arguments),!b.userActions)throw new Error("userActions is required");this._userActions=b.userActions},_onImportsStateChange:function(a){if(a.hasCompleted()){var b=a.importedVis().get("table").name,c=new e({name:b},{configModel:this._configModel}),d=function(){this._userActions.createLayerFromTable(c),this.trigger("importCompleted",a,this)}.bind(this);c.fetch().always(d)}}})},{"./background-importer/background-polling-model":609,"./table-model":665}],624:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{edition:!1,disabled:!1},isEditing:function(){return!!this.get("edition")},isDisabled:function(){return!!this.get("disabled")}})},{backbone:"backbone"}],625:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({initialize:function(a,b){if(!a.visualization_id)throw new Error("visualization_id is required");if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel},urlRoot:function(){var a=this._configModel.get("base_url");return a+"/api/v3/visualization_exports"},requestExport:function(){this.save(null,{success:this._requestExportSuccessHandler.bind(this)})},cancelExport:function(){this._interrupt()},_requestExportSuccessHandler:function(){this._pollPID=setInterval(function(){this.fetch({success:this._checkState.bind(this),error:this._errorHandler.bind(this)})}.bind(this),2e3)},_checkState:function(){"complete"===this.get("state")?this._finishExport():"failure"===this.get("state")&&this._errorHandler()},_finishExport:function(){clearInterval(this._pollPID)},_errorHandler:function(){throw this._interrupt(),new Error("There is a problem with your export. Please try again.")},_interrupt:function(){clearInterval(this._pollPID),this.set("state","failure")}})},{backbone:"backbone"}],626:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./query-row-model"),g="point",h="line",i="polygon",j={Point:g,MultiPoint:g,LineString:h,MultiLineString:h,Polygon:i,MultiPolygon:i},k=function(a){var b=null;try{b=JSON.parse(a)}catch(a){}var c=b&&b.type,d=j[c];if(!d)throw new Error("unsupported geometry type: '"+c+"'");return d},l=["cartodb_id","created_at","the_geom_webmercator","updated_at"],m=e.Model.extend({initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!b.userModel)throw new Error("userModel is required");this._configModel=b.configModel,this._layerDefinitionModel=b.layerDefinitionModel,this._userModel=b.userModel,this._featureType=b.featureType,this._firstNode=this._getAnalysisDefinitionNodeModel(),this._changesHistory=[],this._firstNode.isSourceType()&&(this._tableNodeModel=this._firstNode.getTableModel()),this._onChange=d.debounce(this._onChange.bind(this),500),this.isNew()&&this._bindChangeEvent()},isNew:function(){return!this.has("cartodb_id")},isPoint:function(){return this._isType(g)},isPolygon:function(){return this._isType(i)},isLine:function(){return this._isType(h)},_isType:function(a){return this._getType()===a},isEditable:function(){var a=this._getAnalysisDefinitionNodeModel();return!a.isReadOnly()},_getPermissionModel:function(){return this._tableNodeModel&&this._tableNodeModel.getPermissionModel()},isReadOnly:function(){return this._tableNodeModel&&this._tableNodeModel.isReadOnly(this._userModel)},hasAnalyses:function(){return this._layerDefinitionModel.hasAnalyses()},isCustomQueryApplied:function(){var a=this._getAnalysisDefinitionNodeModel();return a.isCustomQueryApplied()},_getAnalysisDefinitionNodeModel:function(){return this._layerDefinitionModel.getAnalysisDefinitionNodeModel()},isEqual:function(a){return this.get("cartodb_id")===a.get("cartodb_id")&&this.getLayerId()===a.getLayerId()},getLayerId:function(){return this._layerDefinitionModel.id},getLayerDefinition:function(){return this._layerDefinitionModel},_cleanChangesHistory:function(){this._changesHistory=[]},_bindChangeEvent:function(){this.on("change",this._onChange,this)},_unbindChangeEvent:function(){this.off("change",this._onChange,this)},_onChange:function(){d.each(this.changed,function(a,b){d.contains(this._changesHistory,b)||this._changesHistory.push(b)},this)},hasBeenChangedAfterLastSaved:function(a){return d.contains(this._changesHistory,a)},getFeatureType:function(){return this.isPoint()?"point":this.isLine()?"line":this.isPolygon()?"polygon":void 0},fetch:function(a){a=a||{},this._unbindChangeEvent(),this._getQueryRowModel().fetch({success:function(b){this.set(b.toJSON()),this._bindChangeEvent(),a.success&&a.success()}.bind(this)})},save:function(a){a=a||{};var b=this._layerDefinitionModel.getColumnNamesFromSchema(),c=d.pick(this.toJSON(),d.difference(b,l));this._getQueryRowModel().save(c,{success:function(b){this.isNew()&&this.set("cartodb_id",b.get("cartodb_id")),this.trigger("save",this,a),a.success&&a.success(),this._cleanChangesHistory()}.bind(this),error:function(){a.error&&a.error()}})},destroy:function(a){a=a||{},this._getQueryRowModel().destroy({success:function(){this.trigger("remove",this,a),a.success&&a.success()}.bind(this),error:function(){a.error&&a.error()}})},_getQueryRowModel:function(){var a={};return this.has("cartodb_id")&&(a.cartodb_id=this.get("cartodb_id")),this._queryRowModel=this._queryRowModel||new f(a,{tableName:this._layerDefinitionModel.getTableName(),configModel:this._configModel,permissionModel:this._getPermissionModel(),userModel:this._userModel}),this._queryRowModel},_getType:function(){var a=this.get("the_geom"),b=a&&k(a)||this._featureType;return b}});b.exports=m},{"./query-row-model":657,backbone:"backbone",underscore:"underscore"}],627:[function(a,b,c){var d={st_multipolygon:"polygon",st_polygon:"polygon",st_multilinestring:"line",st_linestring:"line",st_multipoint:"point",st_point:"point"};b.exports=function(a){return d[a.toLowerCase()]}},{}],628:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./backbone/sync-abort"),g=a("./user-model"),h=a("./group-model");b.exports=d.Collection.extend({model:function(a,b){var c=a.type,d=a.configModel;return b=e.extend(b,{configModel:d}),a.model&&(a=e.extend({},a,a.model)),"user"===c?new g(e.omit(a,"configModel"),b):"group"===c?new h(e.omit(a,"configModel"),b):void 0},sync:f,url:function(a){var b=this.configModel.get("base_url"),c=this.configModel.urlVersion("organizationGrantables",a);return b+"/api/"+c+"/organization/"+this.organization.id+"/grantables"},initialize:function(a,b){if(!b.organization)throw new Error("Organization is required");if(!b.currentUserId)throw new Error("currentUserId is required");if(!b.configModel)throw new Error("configModel is required");this.configModel=b.configModel,this.organization=b.organization,this.currentUserId=b.currentUserId},parse:function(a){return this.trigger("fetched",this),this.total_entries=a.total_entries,e.reduce(a.grantables,function(a,b){return b.id===this.currentUserId?this.total_entries--:(b.organization=this.organization,b.configModel=this.configModel,a.push(b)),a},[],this)},fetch:function(a){return a=a||{},this.trigger("fetching",this),a.error=function(a,b){this.trigger("error",this)}.bind(this),d.Collection.prototype.fetch.call(this,a)},totalCount:function(){return this.total_entries}})},{"./backbone/sync-abort":607,"./group-model":629,"./user-model":671,backbone:"backbone",underscore:"underscore"}],629:[function(a,b,c){var d=a("backbone"),e=a("./users-group-collection");b.exports=d.Model.extend({defaults:{display_name:""},initialize:function(a,b){this.parse(a||{},b)},parse:function(a,b){return this.users=new e(a.users,{group:this,configModel:b.configModel,organization:b.organization}),a}})},{"./users-group-collection":673,backbone:"backbone"}],630:[function(a,b,c){var d=a("./infowindow-definition-model");b.exports=d.extend({defaults:{template_name:"",latlng:[0,0],offset:[28,0],maxHeight:180,autoPan:!0,template:"",content:"",visibility:!1,alternative_names:{},fields:null,width:226,headerColor:{color:{fixed:"#35AAE5",opacity:1}}},TEMPLATES:{infowindow_light:a("../mustache-templates/infowindows/infowindow_light.jst.mustache"),infowindow_dark:a("../mustache-templates/infowindows/infowindow_dark.jst.mustache"),infowindow_color:a("../mustache-templates/infowindows/infowindow_color.jst.mustache"),infowindow_header_with_image:a("../mustache-templates/infowindows/infowindow_header_with_image.jst.mustache"),custom_infowindow_light:a("../mustache-templates/infowindows_custom/infowindow_light.jst.mustache"),custom_infowindow_dark:a("../mustache-templates/infowindows_custom/infowindow_dark.jst.mustache"),custom_infowindow_color:a("../mustache-templates/infowindows_custom/infowindow_color.jst.mustache"),custom_infowindow_header_with_image:a("../mustache-templates/infowindows_custom/infowindow_header_with_image.jst.mustache")},_transformTemplate:function(a){var b=this.get("headerColor").color.fixed;return a.replace("background: #35AAE5","background: "+b)},setTemplate:function(a){var b="undefined"==typeof this.TEMPLATES[a]?"":this.TEMPLATES[a];"infowindow_color"===a&&(b=this._transformTemplate(b));var c={template_name:a,template:b,template_type:"mustache"};""===a&&(c.fields=[]),this.set(c)},isEmptyTemplate:function(){var a=0===this.fieldCount();return this.hasTemplate()&&a},setDefault:function(){this.setTemplate(this.defaults.template_name)}})},{"../mustache-templates/infowindows/infowindow_color.jst.mustache":1104,"../mustache-templates/infowindows/infowindow_dark.jst.mustache":1105,"../mustache-templates/infowindows/infowindow_header_with_image.jst.mustache":1106,"../mustache-templates/infowindows/infowindow_light.jst.mustache":1107,"../mustache-templates/infowindows_custom/infowindow_color.jst.mustache":1109,"../mustache-templates/infowindows_custom/infowindow_dark.jst.mustache":1110,"../mustache-templates/infowindows_custom/infowindow_header_with_image.jst.mustache":1111,"../mustache-templates/infowindows_custom/infowindow_light.jst.mustache":1112,"./infowindow-definition-model":631}],631:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("jquery");b.exports=d.Model.extend({SYSTEM_COLUMNS:["the_geom","the_geom_webmercator","created_at","updated_at","cartodb_id","cartodb_georef_status"],TEMPLATES:{},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel},clearFields:function(){this.set({fields:[]})},saveFields:function(a){a=a||"old_fields",this.set(a,e.clone(this.get("fields")))},fieldCount:function(){var a=this.get("fields");return a?a.length:0},restoreFields:function(a,b){b=b||"old_fields";var c=this.get(b);a&&(c=c.filter(function(b){return e.contains(a,b.name)})),c&&c.length&&this._setFields(c),this.unset(b)},containsField:function(a){var b=this.get("fields")||[];return e.contains(e(b).pluck("name"),a)},getFieldProperty:function(a,b){if(this.containsField(a)){var c=this.get("fields")||[],d=e.indexOf(e(c).pluck("name"),a);return c[d][b]}return null},setFieldProperty:function(a,b,c){if(this.containsField(a)){var d=this._cloneFields()||[],f=e.indexOf(e(d).pluck("name"),a);d[f][b]=c,this._setFields(d)}return this},_cloneFields:function(){return e(this.get("fields")).map(function(a){return e.clone(a)})},_setFields:function(a){a.sort(function(a,b){return a.position-b.position}),this.set({fields:a})},sortFields:function(){this.get("fields").sort(function(a,b){return a.position-b.position})},_addField:function(a,b){var c=f.Deferred();if(!this.containsField(a)){var d=this.get("fields");d?(b=void 0===b?d.length:b,d.push({name:a,title:!0,position:b})):(b=void 0===b?0:b,this.set("fields",[{name:a,title:!0,position:b}],{silent:!0}))}return c.resolve(),c.promise()},addField:function(a,b){var c=this;return f.when(this._addField(a,b)).then(function(){c.sortFields(),c.trigger("add:fields"),c.trigger("change:fields",c,c.get("fields")),c.trigger("change",c)}),this},removeField:function(a){if(this.containsField(a)){var b=this._cloneFields()||[],c=e.indexOf(e(b).pluck("name"),a);c>=0&&b.splice(c,1),this._setFields(b),this.trigger("remove:fields")}return this},getAlternativeName:function(a){return this.get("alternative_names")&&this.get("alternative_names")[a]},setAlternativeName:function(a,b){var c=e.clone(this.get("alternative_names")||{});c[a]=b,this.set({alternative_names:c}),this.trigger("change:alternative_names")},getFieldPos:function(a){var b=this.getFieldProperty(a,"position");return void 0===b?Number.MAX_VALUE:b},unsetTemplate:function(){this.setTemplate("")},setTemplate:function(a){var b="undefined"==typeof this.TEMPLATES[a]?"":this.TEMPLATES[a],c={template_name:a,template:b,template_type:"mustache"};""===a&&(c.fields=[]),this.set(c)},getTemplate:function(){var a=this.get("template_name");return""!==a?this.TEMPLATES["custom_"+a]:this.get("template")},hasTemplate:function(){return!!this.get("template_name")&&this.TEMPLATES[this.get("template_name")]},isCustomTemplate:function(){return""===this.get("template_name")&&""!==this.get("template")}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],632:[function(a,b,c){var d=a("./infowindow-definition-model");b.exports=d.extend({defaults:{vertical_offset:0,horizontal_offset:0,position:"top|center",template_name:"",template:""},TEMPLATES:{tooltip_dark:a("../mustache-templates/tooltips/tooltip_dark.jst.mustache"),tooltip_light:a("../mustache-templates/tooltips/tooltip_light.jst.mustache"),custom_tooltip_dark:a("../mustache-templates/tooltips_custom/tooltip_dark.jst.mustache"),custom_tooltip_light:a("../mustache-templates/tooltips_custom/tooltip_light.jst.mustache")},setDefault:function(){this.setTemplate(this.defaults.template_name)}})},{"../mustache-templates/tooltips/tooltip_dark.jst.mustache":1113,"../mustache-templates/tooltips/tooltip_light.jst.mustache":1114,"../mustache-templates/tooltips_custom/tooltip_dark.jst.mustache":1115,"../mustache-templates/tooltips_custom/tooltip_light.jst.mustache":1116,"./infowindow-definition-model":631}],633:[function(a,b,c){b.exports={COLORS:["#66B79E","#E65176","#528995","#FF710F","#305482","#CCD859","#565175","#FFB927","#3EBCAE","#E54C1F"],getColorForLetter:function(a){if(!a)return this.COLORS[0];var b=a.charCodeAt(0)-97,c=(b/this.COLORS.length%1*10).toFixed();return this.COLORS[c]||this.COLORS[0]}}},{}],634:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./backbone/sync-abort"),g=a("../editor/style/style-definition-model"),h=a("../editor/style/style-cartocss-model"),i=a("../editor/layers/layer-content-views/data/data-sql-model"),j=a("./layer-types-and-kinds"),k=a("./infowindow-click-model"),l=a("./infowindow-hover-model"),m=a("../helpers/table-name-utils"),n=["id","order","infowindow","tooltip","error","from_layer_id","from_letter"];b.exports=d.Model.extend({sync:f,parse:function(a,b){a.options=a.options||{};var c=e.defaults(e.pick(a,n),e.omit(a.options,["query","tile_style"]));return c.type=c.type||j.getType(a.kind),a.options.tile_style&&(c.cartocss=a.options.tile_style),a.options.query&&(c.sql=a.options.query),a.infowindow&&(this.infowindowModel||(this.infowindowModel=new k(a.infowindow,{configModel:b.configModel||this._configModel}))),a.tooltip&&(this.tooltipModel||(this.tooltipModel=new l(a.tooltip,{configModel:b.configModel||this._configModel}))),a.options.table_name&&(c.autoStyle=c.autoStyle||!1,this.styleModel||(this.styleModel=new g(a.options.style_properties,{parse:!0}),this.cartocssModel=new h({content:c.cartocss},{history:a.options.cartocss_history||a.options.tile_style_history})),this.sqlModel||(this.sqlModel=new i({content:c.sql},{history:a.options.sql_history}))),c},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.on("change:source change:sql",this._onPosibleLayerSchemaChanged,this),this.styleModel&&this.styleModel.bind("change:type change:animated",function(){(this.styleModel.isAggregatedType()||this.styleModel.isAnimation())&&(this.infowindowModel&&this.infowindowModel.unsetTemplate(),this.tooltipModel&&this.tooltipModel.unsetTemplate())},this)},save:function(a,b){var c={autoStyle:!1};return b&&b.shouldPreserveAutoStyle?delete c.autoStyle:this.get("autoStyle")&&this.styleModel&&this.styleModel.resetPropertiesFromAutoStyle(),a=e.extend({},c,a),d.Model.prototype.save.apply(this,[a,b])},toJSON:function(){var a=e.omit(this.attributes,n.concat(["cartocss","sql","autoStyle"])),b=this.get("cartocss");b&&(a.tile_style=b);var c=this.get("sql");c&&(a.query=c);var d={kind:j.getKind(this.get("type")),options:a},f=this.infowindowModel&&this.infowindowModel.toJSON();e.isEmpty(f)||(d.infowindow=this.infowindowModel.toJSON());var g=this.tooltipModel&&this.tooltipModel.toJSON();e.isEmpty(g)||(d.tooltip=this.tooltipModel.toJSON()),this.styleModel&&!this.styleModel.isAutogenerated()&&(d.options.style_properties=this.styleModel.toJSON()),this.cartocssModel&&(d.options.cartocss_history=this.cartocssModel.getHistory()),this.sqlModel&&(d.options.sql_history=this.sqlModel.getHistory());var h=e.omit(this.attributes,"infowindow","tooltip","options","error","autoStyle");return e.defaults(d,e.pick(h,n))},canBeDeletedByUser:function(){return this.collection.getNumberOfDataLayers()>1&&this.isDataLayer()&&(this._canBeFoldedUnderAnotherLayer()||!this._isAllDataLayersDependingOnAnyAnalysisOfThisLayer())},isOwnerOfAnalysisNode:function(a){return a&&a.letter()===this.get("letter")},ownedPrimaryAnalysisNodes:function(){var a=this.getAnalysisDefinitionNodeModel();return this.isOwnerOfAnalysisNode(a)?a.linkedListBySameLetter():[]},getName:function(){return this.get("name")||this.get("table_name_alias")||this.get("table_name")},getTableName:function(){return this.get("table_name")||""},containsNode:function(a){var b=this.getAnalysisDefinitionNodeModel();return b&&b.containsNode(a)},getAnalysisDefinitionNodeModel:function(){return this.findAnalysisDefinitionNodeModel(this.get("source"))},findAnalysisDefinitionNodeModel:function(a){return this.collection&&this.collection.findAnalysisDefinitionNodeModel(a)},_onPosibleLayerSchemaChanged:function(a,b,c){c&&c.ignoreSchemaChange||(this.infowindowModel&&this.infowindowModel.clearFields(),this.tooltipModel&&this.tooltipModel.clearFields(),this.styleModel&&this.styleModel.resetStyles())},toggleVisible:function(){this.set("visible",!this.get("visible"))},toggleCollapse:function(){this.set("collapsed",!this.get("collapsed"))},hasAnalyses:function(){return this.getNumberOfAnalyses()>0},getNumberOfAnalyses:function(){for(var a=this.getAnalysisDefinitionNodeModel(),b=0;a&&this.isOwnerOfAnalysisNode(a);)a=a.getPrimarySource(),a&&(b+=1);return b},getQualifiedTableName:function(){var a=this.get("user_name")||this.collection.userModel.get("username");return m.getQualifiedTableName(this.getTableName(),a,this.collection.userModel.isInsideOrg())},getColumnNamesFromSchema:function(){return this._getQuerySchemaModel().getColumnNames()},_getQuerySchemaModel:function(){var a=this.getAnalysisDefinitionNodeModel();return a.querySchemaModel},isDataLayer:function(){
var a=this.get("type");return j.isCartoDBType(a)||j.isTorqueType(a)},isTorqueLayer:function(){return"torque"===this.get("type")},_canBeFoldedUnderAnotherLayer:function(){var a=this.getAnalysisDefinitionNodeModel();return this.collection.any(function(b){if(b!==this&&b.isDataLayer()){var c=b.getAnalysisDefinitionNodeModel();if(c===a)return!0;var d=e.last(c.linkedListBySameLetter());return d.getPrimarySource()===a}},this)},_isAllDataLayersDependingOnAnyAnalysisOfThisLayer:function(){var a=this.getAnalysisDefinitionNodeModel();if(!a)return!1;if(!this.isOwnerOfAnalysisNode(a))return!1;var b=a.linkedListBySameLetter();return this.collection.chain().filter(function(a){return a!==this&&!!a.get("source")},this).all(function(a){return e.any(b,function(b){return a.containsNode(b)})},this).value()},getAllDependentLayers:function(){for(var a=this,b=0,c=a.collection.models,d=0;d<c.length;d++){var e=c[d],f=!1;if(e!==a){for(var g=e.getAnalysisDefinitionNodeModel();g;)a.isOwnerOfAnalysisNode(g)&&(f=!0),g=g.getPrimarySource();f&&(b+=1)}}return b},matchesAttrs:function(a){return this.get("type")===a.type&&(j.isTiledType(a.type)?this.get("name")===a.name&&this.get("urlTemplate")===a.urlTemplate:j.isGMapsBase(a.type)?this.get("name")===a.name&&this.get("baseType")===a.baseType&&this.get("style")===a.style:!!j.isPlainType(a.type)&&this.get("color")===a.color)},canBeGeoreferenced:function(){var a=function(){var a=this.getAnalysisDefinitionNodeModel();if(a&&"geocoding"===a.get("type"))return!0;for(;a&&this.isOwnerOfAnalysisNode(a);)if(a=a.getPrimarySource(),a&&"geocoding"===a.get("type"))return!0;return!1}.bind(this),b=this.getAnalysisDefinitionNodeModel();return!(a()||b.queryGeometryModel.hasValue()||b.isCustomQueryApplied()||b.queryRowsCollection.isEmpty())}})},{"../editor/layers/layer-content-views/data/data-sql-model":889,"../editor/style/style-cartocss-model":1013,"../editor/style/style-definition-model":1025,"../helpers/table-name-utils":1101,"./backbone/sync-abort":607,"./infowindow-click-model":630,"./infowindow-hover-model":632,"./layer-types-and-kinds":637,backbone:"backbone",underscore:"underscore"}],635:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("./layer-definition-model"),h=a("./layer-letters"),i=a("./layer-colors"),j=a("../value-objects/analysis-node-ids"),k=a("./layer-types-and-kinds"),l=a("../helpers/sql-utils"),m=a("../helpers/table-name-utils"),n=a("../helpers/required-opts"),o=["analysisDefinitionNodesCollection","configModel","mapId","stateDefinitionModel","userModel"],p=function(a){return a+" Labels"};b.exports=f.Collection.extend({initialize:function(a,b){n(b,o,this)},url:function(){var a=this._configModel.get("base_url");return a+"/api/v1/maps/"+this._mapId+"/layers"},parse:function(a){return a.layers},save:function(a){this.each(function(a,b){a.set("order",b,{silent:!0})}),f.sync("update",this,a)},toJSON:function(){return{layers:f.Collection.prototype.toJSON.apply(this,arguments)}},resetByLayersData:function(a){this.reset(a,{silent:!0,initialLetters:e.chain(a).pluck("options").pluck("letter").compact().value()})},comparator:function(a){return a.get("order")},model:function(a,b){var c=b.collection,d=e.clone(a.options)||{},f=e.defaults({options:d},e.omit(a,["options"]));if(isNaN(b.at)||(f.options.order=b.at),k.isKindDataLayer(f.kind)){d.letter=d.letter||h.next(c._takenLetters(b.initialLetters)),d.color=d.color||i.getColorForLetter(d.letter);var n=j.next(d.letter);if(d.table_name&&(!d.source||d.source===n)){var o=m.getUnqualifiedName(d.table_name),p=d.user_name||m.getUsername(d.table_name),q=p&&c._configModel.get("user_name")!==p||c._userModel.isInsideOrg();o=m.getQualifiedTableName(d.table_name,p,q),d.source=d.source||n,d.query=d.query||l.getDefaultSQLFromTableName(o),c._analysisDefinitionNodesCollection.createSourceNode({id:n,tableName:o,query:d.query})}}var r="boolean"!=typeof b.parse||b.parse,s=new g(f,{parse:r,collection:c,configModel:c._configModel});return s},nextLetter:function(){return h.next(this._takenLetters())},findAnalysisDefinitionNodeModel:function(a){return this._analysisDefinitionNodesCollection.get(a)},findOwnerOfAnalysisNode:function(a){return this.find(function(b){return b.isOwnerOfAnalysisNode(a)})},findPrimaryParentLayerToAnalysisNode:function(a,b){if(a){b=b||{},e.isArray(b.exclude)||(b.exclude=[b.exclude]);var c=this.findOwnerOfAnalysisNode(a);return this.find(function(d){if(d!==c&&!e.contains(b.exclude,d)){var f=d.getAnalysisDefinitionNodeModel();if(a===f)return!0;if(f){var g=e.last(f.linkedListBySameLetter()).getPrimarySource();return a===g}}})}},isThereAnyGeometryData:function(){return this.filter(function(a){return a.isDataLayer()}).some(function(a){var b=a.getAnalysisDefinitionNodeModel().queryGeometryModel;return b&&b.hasValue()})},loadAllQueryGeometryModels:function(a){var b=this.filter(function(a){return a.isDataLayer()}).map(function(a){var b=a.getAnalysisDefinitionNodeModel().queryGeometryModel,c=b.get("status"),e=new d.Deferred;return b.isFetched()?e.resolve():b.canFetch()?"fetching"!==c?b.fetch({success:function(){e.resolve()},error:function(){e.reject()}}):e.resolve():e.reject(),e.promise()},this);d.when.apply(d,b).done(a)},isThereAnyTorqueLayer:function(){return this.any(function(a){return k.isTorqueType(a.get("type"))})},isThereAnyCartoDBLayer:function(){return this.any(function(a){return k.isCartoDBType(a.get("type"))})},anyContainsNode:function(a){return this.any(function(b){return b.containsNode(a)})},isDataLayerOnTop:function(a){var b=this.indexOf(a);return b===this.getTopDataLayerIndex()},getTopDataLayerIndex:function(){var a=this.getLayerOnTop(),b=this.indexOf(a),c=a&&!k.isCartoDBType(a.get("type"))&&!k.isTorqueType(a.get("type"));return c&&b--,b},getNumberOfDataLayers:function(){return this.select(function(a){return k.isCartoDBType(a.get("type"))||k.isTorqueType(a.get("type"))}).length},_takenLetters:function(a){var b=e.compact(this.pluck("letter")),c=e.chain(this._byId).values().invoke("get","letter").value();return e.union(b,c,a)},setBaseLayer:function(a){if(this.trigger("changingBaseLayer"),a=e.clone(a),this.isBaseLayerAdded(a))return this.trigger("baseLayerChanged"),!1;var b=a.labels&&a.labels.url,c={silent:!0,wait:!0,success:function(){this.trigger("baseLayerChanged")}.bind(this),error:function(){this.trigger("baseLayerFailed")}.bind(this)},d={silent:!0,wait:!0,success:function(){var d=this.getLabelsLayer();b?d?this._updateLabelsLayer(a,c):this._addLabelsLayer(a,c):d?this._destroyLabelsLayer(c):this.trigger("baseLayerChanged")}.bind(this),error:function(){this.trigger("baseLayerFailed")}.bind(this)};this.getBaseLayer()?this._updateBaseLayer(a,d):this._createBaseLayer(a,d)},isBaseLayerAdded:function(a){var b=this.getBaseLayer();return b.matchesAttrs(a)},_updateBaseLayer:function(a,b){var c=this.getBaseLayer(),d=e.omit(a,["id","order","labels","template"]);c.attributes=e.extend({order:0},e.pick(c.attributes,["id","type","category"])),c.save(d,b)},_createBaseLayer:function(a,b){return a=e.extend(a,{order:0}),this.create(a,e.extend({at:0},b))},_updateLabelsLayer:function(a,b){var c=this.getLabelsLayer(),d=e.omit(a,"labels");d=e.pick(d,e.identity),d=e.extend(d,{name:p(a.name),urlTemplate:a.labels.url}),c.save(d,b)},_addLabelsLayer:function(a,b){var c=e.pick(a,["type","subdomains","minZoom","maxZoom","name","className","attribution","category"]);c=e.extend(c,{urlTemplate:a.labels.url,name:p(a.name)});var d={order:this.getLayerOnTop().get("order")+1,options:c};this.create(d,b)},_destroyLabelsLayer:function(a){this.getLayerOnTop().destroy(a)},getBaseLayer:function(){return this.first()},getLabelsLayer:function(){var a=this.getLayerOnTop();if(this.size()>1&&k.isTiledType(a.get("type")))return a},getLayerOnTop:function(){return this.last()}})},{"../helpers/required-opts":1097,"../helpers/sql-utils":1099,"../helpers/table-name-utils":1101,"../value-objects/analysis-node-ids":1119,"./layer-colors":633,"./layer-definition-model":634,"./layer-letters":636,"./layer-types-and-kinds":637,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],636:[function(a,b,c){var d=a("underscore");b.exports={next:function(a){return d.chain(a).sort().reduce(function(a,b){return b===a?String.fromCharCode(b.charCodeAt()+1):a},"a").value()}}},{underscore:"underscore"}],637:[function(a,b,c){var d="Plain",e="CartoDB",f="Tiled",g="torque",h="GMapsBase",i="WMS",j={background:d,carto:e,gmapsbase:h,tiled:f,torque:g,wms:i};b.exports={getType:function(a){var b=j[a];if(!b)throw new Error("no type found for given kind "+a);return b},getKind:function(a){if(!a)throw new Error("no kind found for given type "+a);var b;for(b in j)if(j[b]===a)break;return b},isKindDataLayer:function(a){var b=j[a];return this.isTypeDataLayer(b)},isTypeDataLayer:function(a){return this.isCartoDBType(a)||this.isTorqueType(a)},isCartoDBType:function(a){return a===e},isTorqueType:function(a){return a===g},isTiledType:function(a){return a===f},isPlainType:function(a){return a===d},isGMapsBase:function(a){return a===h}}},{}],638:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../backbone/sync-abort"),g=a("./legends-state");b.exports=d.Model.extend({defaults:{type:"none",title:"",postHTMLSnippet:"",preHTMLSnippet:""},sync:f,parse:function(a){var b=e.extend({},e.omit(a,"created_at","updated_at","definition","pre_html","post_html"));return a.conf&&a.conf.columns&&(b.customState=a.conf.columns),b.preHTMLSnippet=a.pre_html,b.postHTMLSnippet=a.post_html,b},urlRoot:function(){var a=this.configModel.get("base_url");return a+"/api/v3/viz/"+this.vizId+"/layer/"+this.layerDefinitionModel.id+"/legends"},initialize:function(a,b){if(!b.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!b.configModel)throw new Error("configModel is required");if(!b.vizId)throw new Error("vizId is required");this.layerDefinitionModel=b.layerDefinitionModel,this.configModel=b.configModel,this.vizId=b.vizId},getStyles:function(){return this.layerDefinitionModel&&this.layerDefinitionModel.styleModel||null},fetch:function(){throw new Error("This model should not make any fetch calls. It should be created from the vizJSON.")},getType:function(){return this.get("type")},toJSON:function(){return e.extend(this.attributes,{type:this.getType()})},getAttributes:function(){return e.extend({},e.pick(this.attributes,e.keys(this.defaults)),e.omit(this.attributes,"pre_html","post_html","customState"))},setAttributes:function(a){g.set(this.layerDefinitionModel,this.get("type")||a.type,a),this.set(a)},set:function(a,b,c){var f;"object"==typeof a?(f=a,c=b):(f={})[a]=b,c||(c={});var h=this.layerDefinitionModel||c.layerDefinitionModel,i=this.get("type")||f.type,j=g.get(h,i),k=e.extend(f,{customState:e.keys(j)},j);return d.Model.prototype.set.call(this,k,c)},hasCustomHtml:function(){return!1}})},{"../backbone/sync-abort":607,"./legends-state":646,backbone:"backbone",underscore:"underscore"}],639:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-model"),f=a("../../editor/layers/layer-content-views/legend/form/legend-color-helper"),g="#999999";b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"bubble",fillColor:g,topLabel:"",bottomLabel:""}),parse:function(a,b){var c=e.prototype.parse.call(this,a);return b.layerDefinitionModel&&(a.definition?(c.fillColor=a.definition.color,c.topLabel=a.definition.top_label,c.bottomLabel=a.definition.bottom_label):c.fillColor=this._inheritStyleColor(b.layerDefinitionModel.styleModel)),c},toJSON:function(){return d.extend({},d.omit(this.attributes,"fill","fillColor","topLabel","bottomLabel","postHTMLSnippet","preHTMLSnippet","customState"),{pre_html:this.get("preHTMLSnippet"),post_html:this.get("postHTMLSnippet")},{conf:{columns:this.get("customState")}},{definition:{color:this.get("fillColor"),top_label:this.get("topLabel"),bottom_label:this.get("bottomLabel")}})},_inheritStyleColor:function(a){var b=a.get("fill"),c=a.get("stroke"),d=b&&b.color||c&&c.color;return d&&(d.fixed||d.range)?f.getBubbles(d).color.fixed:g}})},{"../../editor/layers/layer-content-views/legend/form/legend-color-helper":947,"./legend-base-definition-model":638,underscore:"underscore"}],640:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-model");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"category"}),toJSON:function(){return d.extend({},d.omit(this.attributes,"postHTMLSnippet","preHTMLSnippet","customState"),{pre_html:this.get("preHTMLSnippet"),post_html:this.get("postHTMLSnippet")},{conf:{columns:this.get("customState")}})}})},{"./legend-base-definition-model":638,underscore:"underscore"}],641:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-model");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"choropleth",prefix:"",suffix:"",leftLabel:"",rightLabel:""}),parse:function(a,b){var c=e.prototype.parse.call(this,a);return a.definition&&(c.prefix=a.definition.prefix,c.suffix=a.definition.suffix,c.leftLabel=a.definition.left_label,c.rightLabel=a.definition.right_label),c},toJSON:function(){var a={prefix:this.get("prefix"),suffix:this.get("suffix"),left_label:this.get("leftLabel"),right_label:this.get("rightLabel")};return d.extend({},d.omit(this.attributes,"prefix","suffix","leftLabel","rightLabel","postHTMLSnippet","preHTMLSnippet","customState"),{pre_html:this.get("preHTMLSnippet"),post_html:this.get("postHTMLSnippet")},{conf:{columns:this.get("customState")}},{definition:d.pick(a,d.identity)})}})},{"./legend-base-definition-model":638,underscore:"underscore"}],642:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-model");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"custom_choropleth",prefix:"",suffix:"",colors:[],leftLabel:"",rightLabel:""}),parse:function(a,b){var c,d,f,g=e.prototype.parse.call(this,a);return a.definition?(g.colors=a.definition.colors,g.prefix=a.definition.prefix,g.suffix=a.definition.suffix,g.leftLabel=a.definition.left_label,g.rightLabel=a.definition.right_label):(c=b.layerDefinitionModel.styleModel.get("fill"),d=b.layerDefinitionModel.styleModel.get("stroke"),f=c.color||d.color,g.colors=this._inheritStyleColors(f)),g},toJSON:function(){var a={prefix:this.get("prefix"),suffix:this.get("suffix"),left_label:this.get("leftLabel"),right_label:this.get("rightLabel"),colors:this.get("colors").map(function(a){return{color:a.color}})};return d.extend({},d.omit(this.attributes,"prefix","suffix","leftLabel","rightLabel","colors","postHTMLSnippet","preHTMLSnippet","customState"),{pre_html:this.get("preHTMLSnippet"),post_html:this.get("postHTMLSnippet")},{conf:{columns:this.get("customState")}},{definition:d.pick(a,d.identity)})},_inheritStyleColors:function(a){var b=0,c=[];return a.range&&(b=a.range.length,c=d.range(b).map(function(b,c){return{color:a.range[c]}})),c}})},{"./legend-base-definition-model":638,underscore:"underscore"}],643:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-model"),f=a("../../editor/layers/layer-content-views/legend/form/legend-color-helper");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"custom",items:[],html:""}),parse:function(a,b){var c,d,f,g=e.prototype.parse.call(this,a);return a.definition?(g.items=a.definition.categories,g.html=a.definition.html||""):(c=b.layerDefinitionModel.styleModel.get("fill"),d=b.layerDefinitionModel.styleModel.get("stroke"),f=c.color||d.color,g.items=this.inheritStyleCategories(f)),g.type="custom",g},toJSON:function(){var a={categories:this.get("items").map(function(a){return{title:a.title||_t("editor.legend.legend-form.untitled"),color:a.color,icon:a.image||a.icon}})};return this.hasCustomHtml()&&(a.html=this.get("html")),d.extend({},d.omit(this.attributes,"items","html","postHTMLSnippet","preHTMLSnippet","customState"),{pre_html:this.get("preHTMLSnippet"),post_html:this.get("postHTMLSnippet")},{conf:{columns:this.get("customState")}},{definition:a})},inheritStyleCategories:function(a){var b=0,c=[];return a.range?(b=a.range.length,c=d.range(b).map(function(b,c){return{color:a.range[c],title:a.domain&&f.unquoteColor(a.domain[c])||"",icon:a.images&&a.images[c]||""}})):a.fixed&&(c=[{color:a.fixed,icon:a.image,title:""}]),c},hasCustomHtml:function(){return""!==this.get("html")}})},{"../../editor/layers/layer-content-views/legend/form/legend-color-helper":947,"./legend-base-definition-model":638,underscore:"underscore"}],644:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./legend-base-definition-model"),g=a("../layer-types-and-kinds"),h=a("./legend-category-definition-model"),i=a("./legend-bubble-definition-model"),j=a("./legend-choropleth-definition-model"),k=a("./legend-custom-choropleth-definition-model"),l=a("./legend-custom-definition-model"),m={bubble:i,category:h,choropleth:j,custom_choropleth:k,custom:l,html:l};b.exports=d.Collection.extend({model:f,initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!b.vizId)throw new Error("vizId is required");this.configModel=b.configModel,this.layerDefinitionsCollection=b.layerDefinitionsCollection,this.vizId=b.vizId},resetByData:function(a){var b=[],c=e.filter(a.layers,function(a){return this._isDataLayer(a.type)},this);e.each(c,function(a){var c=this._findLayerDefinitionModel(a.id),d=[];a.legends&&(d=a.legends.map(function(a){var b=m[a.type];return new b(a,{layerDefinitionModel:c,configModel:this.configModel,vizId:this.vizId,parse:!0})},this)),b.push(d)},this),this.reset(e.flatten(b))},fetch:function(){throw new Error("This collection should not make any fetch calls. It should be populated from the vizJSON.")},_isDataLayer:function(a){return g.isCartoDBType(a)||g.isTorqueType(a)},_findLayerDefinitionModel:function(a){return this.layerDefinitionsCollection.findWhere({id:a})},findByLayerDefModel:function(a){var b=a.id;return this.filter(function(a){var c=a.layerDefinitionModel;return c.id===b})},findByLayerDefModelAndType:function(a,b){var c=a.id;return this.find(function(a){var d=a.layerDefinitionModel;return d.id===c&&a.get("type")===b})},findByLayerDefModelAndTypes:function(a,b){var c=a.id;return this.filter(function(a){var d=a.layerDefinitionModel,e=a.get("type");return d.id===c&&b.indexOf(e)!==-1})}})},{"../layer-types-and-kinds":637,"./legend-base-definition-model":638,"./legend-bubble-definition-model":639,"./legend-category-definition-model":640,"./legend-choropleth-definition-model":641,"./legend-custom-choropleth-definition-model":642,"./legend-custom-definition-model":643,backbone:"backbone",underscore:"underscore"}],645:[function(a,b,c){var d={bubble:{legendType:"size"},category:{legendType:"color"},choropleth:{legendType:"color"},custom:{legendType:"color"},custom_choropleth:{legendType:"color"}};b.exports=d},{}],646:[function(a,b,c){var d,e,f=a("underscore"),g=a("./legends-metadata"),h=["title"],i=function(){var a=function(a){var b=g[a];return b&&b.legendType},b=function(a){d[a.id]={}},c=function(a){delete d[a.id]};return{init:function(a,f){d||(d={},a.on("add",b),a.on("remove",c),e=f,this.reset())},reset:function(){e.each(function(b){var c=b.layerDefinitionModel;d[c.id]||(d[c.id]={});var e=a(b.get("type"));d[c.id][e]||(d[c.id][e]={});var g=f.pick(b.attributes,b.attributes.conf.columns);d[c.id][e]=g})},set:function(b,c,e){var g=f.pick(e,h),i=a(c);d&&i&&(d[b.id]||(d[b.id]={}),d[b.id][i]=g)},get:function(b,c){var e=a(c);return d&&e&&d[b.id]&&d[b.id][e]},getInstance:function(){return d}}}();b.exports=i},{"./legends-metadata":645,underscore:"underscore"}],647:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=["drag","id","keyboard"],g=["legends","scrollwheel","layer_selector","dashboard_menu"],h=a("./basemap-providers-and-categories");b.exports=d.Model.extend({defaults:{drag:!0,keyboard:!0,cartodb_logo:!1,legends:!0,layer_selector:!1,dashboard_menu:!0,scrollwheel:!0},parse:function(a){return e.extend({provider:a.map_provider},e.pick(a,f),e.pick(a.options,g))},urlRoot:function(){var a=this._configModel.get("base_url");return a+"/api/v2/maps/"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!b.userModel)throw new Error("userModel is required");this._configModel=b.configModel,this._userModel=b.userModel,this._layerDefinitionsCollection=b.layerDefinitionsCollection,this._layerDefinitionsCollection.bind("baseLayerChanged",this._onBaseLayerChanged,this)},_onBaseLayerChanged:function(){var a=this._layerDefinitionsCollection.getBaseLayer(),b=h.getProvider(a.get("type"));this.save({provider:b,minZoom:a.get("minZoom"),maxZoom:a.get("maxZoom")})},toJSON:function(){return e.extend({},e.omit(this.attributes,g),{attribution:e.unique(this._layerDefinitionsCollection.pluck("attribution")),user_id:this._userModel.get("id")},{options:e.pick(this.attributes,g)})},setMapViewSize:function(a){this._mapViewSize=a},getMapViewSize:function(){return this._mapViewSize},setStaticImageURLTemplate:function(a){this._staticImageURLTemplate=a},getStaticImageURLTemplate:function(){return this._staticImageURLTemplate},setImageExportMetadata:function(a){this._imageExportMetadata=a},getImageExportMetadata:function(){return this._imageExportMetadata},setConverters:function(a){e.each(a,function(a,b){this[b]=a},this)}})},{"./basemap-providers-and-categories":614,backbone:"backbone",underscore:"underscore"}],648:[function(a,b,c){b.exports=function(a,b,c){var d=a.pluck("type"),e=c.get("actions").remove_logo;return[{setting:"search",label:_t("editor.settings.preview.options.elements.search"),related:"overlays",disabled:!1,active:d.indexOf("search")>0},{setting:"zoom",label:_t("editor.settings.preview.options.elements.zoom"),related:"overlays",disabled:!1,active:d.indexOf("zoom")>0},{setting:"logo",label:_t("editor.settings.preview.options.elements.logo"),related:"overlays",disabled:!e,active:d.indexOf("logo")>0},{setting:"legends",label:_t("editor.settings.preview.options.elements.legends"),related:"map",disabled:!1,active:b.get("legends")===!0},{setting:"layer_selector",label:_t("editor.settings.preview.options.elements.layer_selector"),related:"map",disabled:!1,active:b.get("layer_selector")===!0},{setting:"dashboard_menu",label:_t("editor.settings.preview.options.elements.dashboard_menu"),related:"map",disabled:!1,active:b.get("dashboard_menu")===!0},{setting:"scrollwheel",label:_t("editor.settings.preview.options.elements.scrollwheel"),related:"map",disabled:!1,active:b.get("scrollwheel")===!0}]}},{}],649:[function(a,b,c){var d=a("backbone");b.exports=d.Collection.extend({initialize:function(a,b){if(!b.visDefinitionModel)throw new Error("visDefinitionModel is required");this.url=b.visDefinitionModel.mapcapsURL()}})},{backbone:"backbone"}],650:[function(a,b,c){var d=a("backbone"),e=a("./asset-model"),f=a("../helpers/required-opts"),g=["configModel","orgId"];b.exports=d.Collection.extend({model:e,url:function(a){var b=this._configModel.get("base_url"),c=this._configModel.urlVersion("organization-assets",a);return b+"/api/"+c+"/organization/"+this._orgId+"/assets"},initialize:function(a,b){f(b,g,this)},deselectAll:function(a){this.each(function(b){b!==a&&"selected"===b.get("state")&&b.set("state","")})}})},{"../helpers/required-opts":1097,"./asset-model":605,backbone:"backbone"}],651:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({url:function(){var a=this._configModel.get("base_url");return a+"/api/v1/org"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,e.isEmpty(this.get("owner"))||(this._ownerModel=new d.Model(e.omit(this.get("owner"),"organization")))},getOwnerId:function(){return this._ownerModel&&this._ownerModel.get("id")},getOwnerEmail:function(){return this._ownerModel&&this._ownerModel.get("email")},isOrgAdmin:function(a){return this.getOwnerId()===a.get("id")||!!e.find(this.get("admins"),function(b){return b.id===a.get("id")})}})},{backbone:"backbone",underscore:"underscore"}],652:[function(a,b,c){var d=a("backbone");b.exports=d.Collection.extend({initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.visId)throw new Error("visId is required");this._configModel=b.configModel,this._visId=b.visId},url:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("overlays");return a+"/api/"+b+"/viz/"+this._visId+"/overlays"},hasFetched:function(){return this.length>0},removeOverlay:function(a){var b=this.findWhere({type:a});b&&b.destroy()},createOverlay:function(a){var b={fullscreen:this._createFullScreenOverlay,layer_selector:this._createLayerSelectorOverlay,search:this._createSearchOverlay,zoom:this._createZoomOverlay,logo:this._createLogoOverlay},c=b[a];c&&c.call(this)},_createZoomOverlay:function(){var a={type:"zoom",order:6,display:!0,x:20,y:20};this.create(a)},_createLogoOverlay:function(){var a={type:"logo",order:10,display:!0,x:10,y:40};this.create(a)},_createSearchOverlay:function(){var a={type:"search",order:3,display:!0,x:60,y:20};this.create(a)},_createFullScreenOverlay:function(){var a={type:"fullscreen",order:7,display:!0,x:20,y:172};this.create(a)}})},{backbone:"backbone"}],653:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../helpers/utils"),g=a("./user-model"),h=a("./organization-model"),i=a("./group-model"),j=a("./acl-item-model"),k="r",l="rw",m=b.exports=d.Model.extend({urlRoot:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("perm");return a+"/api/"+b+"/perm"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.acl=new d.Collection,this.owner=b._userModel,this._generateOwner(),this._generateAcl(),this._initBinds()},_initBinds:function(){this.bind("change:owner",this._generateOwner,this),this.bind("change:acl",this._generateAcl,this)},_generateOwner:function(){this.owner||(this.owner=new g(null,{configModel:this._configModel})),this.owner.set(this.get("owner"))},getOwner:function(){return this.owner},_generateAcl:function(){var a=this;this.acl.reset([],{silent:!0}),e.each(this.get("acl"),function(b){var c;switch(b.type){case"user":c=new g(b.entity,{configModel:a._configModel});break;case"org":c=new h(b.entity,{configModel:a._configModel});break;case"group":c=new i(b.entity,{configModel:a._configModel});break;default:throw new Error("Unknown ACL item type: "+b.type)}this._grantAccess(c,b.access)},this)},cleanPermissions:function(){this.acl.reset()},hasAccess:function(a){return this.hasReadAccess(a)},hasReadAccess:function(a){return!!this.findRepresentableAclItem(a)},hasWriteAccess:function(a){var b=f.result(this.findRepresentableAclItem(a),"get","access");return b===l},canChangeReadAccess:function(a){return this._canChangeAccess(a)},canChangeWriteAccess:function(a){return(!a.isBuilder||a.isBuilder())&&this._canChangeAccess(a,function(a){return f.result(a,"get","access")!==l})},_canChangeAccess:function(a){var b=this.findRepresentableAclItem(a);return this.isOwner(a)||!b||b===this._ownAclItem(a)||f.result(arguments,1,b)||!1},grantWriteAccess:function(a){this._grantAccess(a,l)},grantReadAccess:function(a){this._grantAccess(a,k)},revokeWriteAccess:function(a){this.grantReadAccess(a)},revokeAccess:function(a){var b=this._ownAclItem(a);b&&this.acl.remove(b)},isOwner:function(a){return e.result(this.owner,"id")===e.result(a,"id")},toJSON:function(){return{entity:this.get("entity"),acl:this.acl.toJSON()}},getUsersWithAnyPermission:function(){return this.acl.chain().filter(this._hasTypeUser).map(this._getEntity).value()},isSharedWithOrganization:function(){return this.acl.any(this._hasTypeOrg)},clone:function(){var a=e.clone(this.attributes);return delete a.id,new m(a,{configModel:this._configModel})},overwriteAcl:function(a){this.acl.reset(a.acl.models)},findRepresentableAclItem:function(a){if(this.isOwner(a))return this._newAclItem(a,l);var b=["_ownAclItem","_organizationAclItem","_mostPrivilegedGroupAclItem"];return this._findMostPrivilegedAclItem(b,function(b){return this[b](a)})},_hasTypeUser:function(a){return"user"===a.get("type")},_getEntity:function(a){return a.get("entity")},_hasTypeOrg:function(a){return"org"===a.get("type")},_isOrganization:function(a){return a instanceof h},_ownAclItem:function(a){if(a&&e.isFunction(a.isNew)||console.log("model is required to find an ACL item"),!a.isNew())return this.acl.find(function(b){return b.get("entity").id===a.id})},_organizationAclItem:function(a){var b=e.result(a.collection,"organization")||a.organization;if(b)return this._ownAclItem(b)},_mostPrivilegedGroupAclItem:function(a){var b=e.result(a.groups,"models");if(b)return this._findMostPrivilegedAclItem(b,this._ownAclItem)},_findMostPrivilegedAclItem:function(a,b){for(var c,d=0,e=a[d];e&&f.result(c,"get","access")!==l;e=a[++d])c=b.call(this,e)||c;return c},_grantAccess:function(a,b){var c=this._ownAclItem(a);if(c)c.set("access",b);else{if(c=this._newAclItem(a,b),!c.isValid())throw new Error(b+" is not a valid ACL access");this.acl.add(c)}},_newAclItem:function(a,b){var c;if(a instanceof g)c="user";else if(a instanceof i)c="group";else{if(!this._isOrganization(a))throw new Error("model not recognized as a valid ACL entity "+a);c="org"}return new j({type:c,entity:a,access:b})}});c.READ_ONLY=k,c.READ_WRITE=l},{"../helpers/utils":1102,"./acl-item-model":598,"./group-model":629,"./organization-model":651,"./user-model":671,backbone:"backbone",underscore:"underscore"}],654:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f={number:["date"],boolean:["date"],date:["boolean"]},g={string:{string:!1,number:!0,date:!0,boolean:!0},number:{string:!1,number:!1,date:!0,boolean:!0},date:{string:!1,number:!0,date:!1,boolean:!0},boolean:{string:!1,number:!1,date:!0,boolean:!1}},h=["the_geom_webmercator","cartodb_id","the_geom"];b.exports=e.Model.extend({url:function(){if(this._tableName){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("column"),c=a+"/api/"+b+"/tables/"+this._tableName+"/columns/";return this.isNew()||(c+=this.previous("name")||this.get("name")),c}return!1},parse:function(a){return{name:a.name,type:a.cartodb_type||a.type,isNew:!1}},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._tableName=b.tableName,this._configModel=b.configModel},isNew:function(){return this.get("isNew")},isEditable:function(){return!d.contains(h,this.get("name"))},isCartoDBIDColumn:function(){return"cartodb_id"===this.get("name")&&"number"===this.get("type")},isGeometryColumn:function(){return"geometry"===this.get("type")}},{isTypeChangeDestructive:function(a,b){return g[a][b]},isTypeChangeAllowed:function(a,b){var c=f[a]||[];return c=c.concat([a]),!d.contains(c,b)}})},{backbone:"backbone",underscore:"underscore"}],655:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./query-column-model");b.exports=d.Collection.extend({model:function(a,b){var c=b.collection;return new f(a,{configModel:c._configModel,tableName:c._tableName})},url:function(){if(this._tableName){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("column");return a+"/api/"+b+"/tables/"+this._tableName+"/columns"}return!1},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.querySchemaModel)throw new Error("querySchemaModel is required");this._tableName=b.tableName,this._querySchemaModel=b.querySchemaModel,this._configModel=b.configModel,this._initBinds()},_initBinds:function(){this.bind("add remove change:type change:name",function(){this.reset(),this._querySchemaModel.set("status","unfetched"),this._querySchemaModel.fetch()},this),this._querySchemaModel.bind("change:status",function(a,b){"fetched"===b&&this.reset(this._querySchemaModel.columnsCollection.toJSON())},this)},setTableName:function(a){a&&this._tableName&&(this._tableName=a,this.each(function(b){b._tableName=a;
}))},addColumn:function(a){a=a||{},this.create({name:"column_"+(new Date).getTime(),type:"string",isNew:!0},e.extend(a,{wait:!0,parse:!1}))}})},{"./query-column-model":654,backbone:"backbone",underscore:"underscore"}],656:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./backbone/sync-abort"),g=d.template("SELECT CASE LOWER(ST_GeometryType(<%= geom_column %>))      WHEN 'st_polygon' THEN 'polygon'      WHEN 'st_multipolygon' THEN 'polygon'      WHEN 'st_multilinestring' THEN 'line'      WHEN 'st_linestring' THEN 'line'      WHEN 'st_multipoint' THEN 'point'      WHEN 'st_point' THEN 'point'      ELSE ''   END AS the_geom FROM (<%= sql %>) __wrapped WHERE <%= geom_column %> IS NOT NULL"),h='column "the_geom" does not exist',i=1024,j={sort_order:"asc",rows_per_page:40,page:0},k={unavailable:"unavailable",unfetched:"unfetched",fetching:"fetching",fetched:"fetched"};b.exports=e.Model.extend({defaults:{query:"",status:k.unavailable,simple_geom:"",ready:!1},sync:f,initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this._addChangeListener()},url:function(){return this._configModel.getSqlApiUrl()},_addChangeListener:function(){this.bind("change",this._onChange,this)},_removeChangeListener:function(){this.unbind("change",this._onChange,this)},isFetched:function(){return this.get("status")===k.fetched},isFetching:function(){return this.get("status")===k.fetching},canFetch:function(){return this.hasQuery()&&this.get("ready")},hasQuery:function(){return!!this.get("query")},shouldFetch:function(){return this.canFetch()&&!this.isFetched()&&!this.isFetching()},resetFetch:function(){this.set("status",k.unfetched)},fetch:function(a){if(this.canFetch()){this.set("status",k.fetching),a=a||{};var b=a&&a.error;return a.data=d.extend(a.data||{},{api_key:this._configModel.get("api_key"),q:this._getSqlApiQueryParam(a.geomColumnName)},j),a.method=this._httpMethod(),a.error=function(c,e){if(e&&"abort"!==e.statusText){var f=e.responseText?JSON.parse(e.responseText).error:[];1===f.length&&f[0]===h?this.fetch(d.extend({},a,{geomColumnName:"the_geom_webmercator"})):(b&&b(f),this.set({simple_geom:"",query_errors:f,status:k.unavailable}))}}.bind(this),e.Model.prototype.fetch.call(this,a)}},parse:function(a){var b;return d.some(a.rows,function(a){return!!(b=a.the_geom)}),{status:k.fetched,simple_geom:b||""}},isNew:function(){return!0},hasValue:function(){return!!this.get("simple_geom")},_onChange:function(){this._removeChangeListener(),this.hasChanged("status")||this.get("status")!==k.fetching?(this.hasChanged("query")||this.hasChanged("ready"))&&this.set("status",this.get("query")?k.unfetched:k.unavailable):this.hasChanged("query")&&this.fetch(),this._addChangeListener()},_getSqlApiQueryParam:function(a){return g({geom_column:a||"the_geom",sql:this.get("query")})},_httpMethod:function(){return this._getSqlApiQueryParam().length>i?"POST":"GET"}})},{"./backbone/sync-abort":607,backbone:"backbone",underscore:"underscore"}],657:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({idAttribute:"__id",url:function(){if(this._tableName&&this._configModel){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("record"),c=a+"/api/"+b+"/tables/";if(this.hasWriteAccess(this._userModel)&&!this.isOwner(this._userModel)){var d=this._permissionModel.getOwner(),e=d.get("username");c+=e+"."+this._tableName+"/records"}else c+=this._tableName+"/records";return this.isNew()||(c+="/"+this.get("cartodb_id")),c}return!1},initialize:function(a,b){this.collection=this.collection||{},this._tableName=b.tableName||this.collection._tableName,this._configModel=b.configModel||this.collection._configModel,this._permissionModel=b.permissionModel||this.collection._permissionModel,this._userModel=b.userModel||this.collection._userModel,this._initBinds()},_initBinds:function(){this.bind("error",this._onError,this)},hasWriteAccess:function(a){return!(!a||!this._permissionModel)&&this._permissionModel.hasWriteAccess(a)},isOwner:function(a){return!(!a||!this._permissionModel)&&this._permissionModel.isOwner(a)},isNew:function(){return!this.has("cartodb_id")},isGeomLoaded:function(){try{return JSON.parse(this.get("the_geom")),!0}catch(a){return!1}},fetchRowIfGeomIsNotLoaded:function(a){return this.isGeomLoaded()?void a():void this.fetch({success:a})},_onError:function(){this.set(this.previousAttributes())},sync:function(){this.trigger("loading",this),d.Model.prototype.sync.apply(this,arguments)},parse:function(a){return a.__id||(a.__id=e.uniqueId()),a},toJSON:function(){return e.omit(this.attributes,"__id","the_geom_webmercator")}})},{backbone:"backbone",underscore:"underscore"}],658:[function(a,b,c){var d=a("backbone"),e=a("./query-row-model"),f=a("./backbone/sync-abort"),g=a("underscore"),h=1024,i="select <%= selectedColumns %> from (<%= sql %>) __wrapped",j={unavailable:"unavailable",unfetched:"unfetched",fetching:"fetching",fetched:"fetched"};b.exports=d.Collection.extend({DEFAULT_FETCH_OPTIONS:{rows_per_page:40,sort_order:"asc",page:0},model:e,sync:f,url:function(){return this._configModel.getSqlApiUrl()},initialize:function(a,b){b=b||{},this._tableName=b.tableName,this._querySchemaModel=b.querySchemaModel,this._configModel=b.configModel,this.statusModel=new d.Model({status:j.unavailable}),this._initBinds()},_initBinds:function(){this.listenTo(this._querySchemaModel,"change:query",this._onQuerySchemaQueryChange)},isFetched:function(){return this.statusModel.get("status")===j.fetched},isFetching:function(){return this.statusModel.get("status")===j.fetching},shouldFetch:function(){return!this.isFetched()&&!this.isFetching()&&this.canFetch()},resetFetch:function(){this.statusModel.set("status",j.unfetched)},isEmpty:function(){return 0===this.size()},canFetch:function(){return!!this._querySchemaModel.get("query")&&this._querySchemaModel.get("ready")&&this._querySchemaModel.isFetched()},_onQuerySchemaQueryChange:function(){this.statusModel.set("status","unfetched"),this.reset([],{silent:!0})},_geometryColumnSQL:function(a){return["CASE","WHEN GeometryType("+a+") = 'POINT' THEN","ST_AsGeoJSON("+a+",8)","WHEN ("+a+" IS NULL) THEN","NULL","ELSE","GeometryType("+a+")","END "+a].join(" ")},_getWrappedSQL:function(a){var b=this,c=this._querySchemaModel.columnsCollection.toJSON(),d=g.chain(c).omit(function(b){return g.contains(a,b.name)}).map(function(a,c){return"geometry"===a.type?b._geometryColumnSQL(a.name):'"'+a.name+'"'}).value();return g.template(i)({selectedColumns:d.join(","),sql:this._querySchemaModel.get("query")})},_httpMethod:function(){return this._querySchemaModel.get("query").length>h?"POST":"GET"},fetch:function(a){a=a||{},this.statusModel.set("status",j.fetching);var b=a.data&&a.data.exclude||[];a=a||{},a.data=g.extend({},this.DEFAULT_FETCH_OPTIONS,a.data&&g.omit(a.data,"exclude")||{},{api_key:this._configModel.get("api_key"),q:this._getWrappedSQL(b)}),a.method=this._httpMethod();var c=a.error;a.error=function(a,b){this.trigger("fail",a,b),this.statusModel.set("status",j.unavailable),c&&c(a,b)}.bind(this);var e=a.success;return a.success=function(a,b){this.statusModel.set("status",j.fetched),e&&e(a,b)}.bind(this),a.reset=!0,d.Collection.prototype.fetch.call(this,a)},parse:function(a){return this._parseWithID(a.rows)},reset:function(a,b){var c=[];c=a&&a.rows?a.rows:a,d.Collection.prototype.reset.apply(this,[this._parseWithID(c)])},_parseWithID:function(a){return g.map(a,function(a){return a.__id=g.uniqueId(),a})},addRow:function(a){a=a||{},this.create({__id:g.uniqueId()},g.extend(a,{wait:!0,parse:!0}))},setTableName:function(a){a&&this._tableName&&(this._tableName=a,this.each(function(b){b._tableName=a}))}})},{"./backbone/sync-abort":607,"./query-row-model":657,backbone:"backbone",underscore:"underscore"}],659:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./backbone/sync-abort"),g=a("./query-rows-collection"),h=a("../helpers/sql-utils"),i=d.template("SELECT * FROM <%= tableName %>"),j=d.template("SELECT * FROM (<%= sql %>) __wrapped"),k=1024,l={unavailable:"unavailable",unfetched:"unfetched",fetching:"fetching",fetched:"fetched"};b.exports=e.Model.extend({defaults:{query:"",sort_order:"asc",rows_per_page:0,page:0,status:l.unavailable,ready:!1},sync:f,initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.columnsCollection=new e.Collection([]),this.rowsCollection=new g([]),this.get("status")===l.unavailable&&this._setStatusPerQueryValue(),this._addChangeListener()},url:function(){return this._configModel.getSqlApiUrl()},_addChangeListener:function(){this.bind("change",this._onChange,this)},_removeChangeListener:function(){this.unbind("change",this._onChange,this)},isFetched:function(){return this.get("status")===l.fetched},isFetching:function(){return this.get("status")===l.fetching},canFetch:function(){return this.hasQuery()&&this.get("ready")},hasQuery:function(){return!!this.get("query")},shouldFetch:function(){return this.canFetch()&&!this.isFetched()&&!this.isFetching()},fetch:function(a){if(this.canFetch()){this.set("status",l.fetching),a=a||{};var b=a&&a.error;return a.data=d.extend(a.data||{},{sort_order:this.get("sort_order"),rows_per_page:this.get("rows_per_page"),page:this.get("page"),api_key:this._configModel.get("api_key"),q:this._getSqlApiQueryParam()}),a.method=this._httpMethod(),a.error=function(a,c){if(c&&"abort"!==c.statusText){var d=c.responseText?JSON.parse(c.responseText).error:[];b&&b(d),this.set({query_errors:d,status:l.unavailable})}}.bind(this),e.Model.prototype.fetch.call(this,a)}},parse:function(a){return this.rowsCollection.reset(a.rows),this.columnsCollection.reset(d.map(a.fields,function(a,b){return{name:b,type:a.type}})),{status:l.fetched}},isNew:function(){return!0},hasDefaultQueryFor:function(a){if(!this.hasQuery())return!1;var b=i({tableName:a});return h.isSameQuery(this.get("query"),b)},getColumnNames:function(){return this.columnsCollection.pluck("name")},_onChange:function(){this._removeChangeListener(),this.hasChanged("status")||this.get("status")!==l.fetching?this.hasChanged("query")&&(this.columnsCollection.reset(),this._setStatusPerQueryValue()):this.fetch(),this._addChangeListener()},_setStatusPerQueryValue:function(){this.set("status",this.get("query")?l.unfetched:l.unavailable)},hasDifferentSchemaThan:function(a){return!d.every(a,function(a){var b=this.columnsCollection.findWhere({name:a.name});return b&&(b.get("type")===a.type||null==a.type)},this)},resetDueToAlteredData:function(){this.set("status",l.unfetched),this.trigger("resetDueToAlteredData"),this.fetch()},_getSqlApiQueryParam:function(){return j({sql:this.get("query")})},_httpMethod:function(){return this._getSqlApiQueryParam().length>k?"POST":"GET"},resetFetch:function(){this.set("status",l.unfetched)}})},{"../helpers/sql-utils":1099,"./backbone/sync-abort":607,"./query-rows-collection":658,backbone:"backbone",underscore:"underscore"}],660:[function(a,b,c){var d=a("backbone"),e=a("./backbone/sync-abort");b.exports=d.Model.extend({sync:e,url:function(){return this._visDefinitionModel.stateURL()},isNew:function(){return!1},initialize:function(a,b){if(!a.json)throw new Error("state json is required");if(!b.visDefinitionModel)throw new Error("visDefinitionModel is required");this._visDefinitionModel=b.visDefinitionModel},toJSON:function(){return{json:this.get("json")}},updateState:function(a){this.save({json:a})},setBounds:function(a){this.trigger("boundsSet",a)},getZoom:function(){return this.get("json").map.zoom},getCenter:function(){return this.get("json").map.center}})},{"./backbone/sync-abort":607,backbone:"backbone"}],661:[function(a,b,c){var d=a("underscore"),e=a("./asset-model");b.exports=e.extend({defaults:{ext:"svg",folder:"maki-icons",host:"https://s3.amazonaws.com",bucket:"com.cartodb.users-assets.production",kind:"marker",name:"",public_url:"",size:"18",state:"idle"},getURLFor:function(a){var b=this.get("host")+"/"+this.get("bucket")+"/"+this.get("folder")+"/"+a,c=this.get("size")?"-"+this.get("size"):"";return b+c+"."+this.get("ext")},toJSON:function(){var a=d.clone(this.attributes);return a.public_url=this.getURLFor(a.icon),a},get:function(a){var b=this.attributes[a];return"public_url"===a&&(b=this.getURLFor(this.attributes.icon)),b}})},{"./asset-model":605,underscore:"underscore"}],662:[function(a,b,c){var d=a("./static-asset-model"),e=a("./assets-collection");b.exports=e.extend({model:d,url:function(){return""},initialize:function(a,b){},parse:function(a,b){return[]}})},{"./assets-collection":606,"./static-asset-model":661}],663:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("jquery"),g=1.2,h=1500,i=9e5,j=15e3;b.exports=d.Model.extend({defaults:{name:"",url:"",state:"",run_at:0,ran_at:0,retried_times:0,interval:0,error_code:0,error_message:"",service_name:"",service_item_id:"",content_guessing:!0,type_guessing:!0},urlRoot:function(){var a=this._configModel.urlVersion("synchronizations"),b=this._configModel.get("base_url");return b+"/api/"+a+"/synchronizations/"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.bind("destroy",function(){this.unset("id")}),this._checkState(),this.bind("change:error_code change:error_message change:state",this._checkState,this)},toJSON:function(){var a=e.clone(this.attributes),b={url:a.url,interval:a.interval,content_guessing:a.content_guessing,type_guessing:a.type_guessing,create_vis:a.create_vis};return"remote"===a.type&&e.extend(b,{remote_visualization_id:a.remote_visualization_id,create_vis:!1,value:a.value}),void 0!==a.id&&(b.id=a.id),a.service_name&&(b.service_name=a.service_name,b.service_item_id=a.service_item_id),b},_checkState:function(){(this.get("error_code")||this.get("error_message"))&&this.set("state","failure")},syncNow:function(a){if(!a)throw new Error("callback is required");f.ajax({url:this.url()+"/sync_now",type:"PUT"}).always(a)},pollCheck:function(a){function b(){c.destroyCheck(),c.fetch({error:function(a,b){c.set({error_message:b.statusText||"",state:"failure"})}}),d*=g,c.pollTimer=setInterval(b,d)}var c=this,d=h;this.pollTimer=setInterval(b,d)},destroyCheck:function(){clearInterval(this.pollTimer)},isSync:function(){return!this.isNew()&&this.get("interval")>0},isSyncing:function(){return"syncing"===this.get("state")||"queued"===this.get("state")},canSyncNow:function(){var a=new Date(this.get("ran_at")),b=new Date,c=i;return!this.isSyncing()&&b.getTime()-a.getTime()>c},linkToTable:function(a){var b=this;a.has("synchronization")&&this.set(a.get("synchronization")),a.bind("change:synchronization",function(){b.set(a.get("synchronization"))},a),a.bind("destroy",function(){b.unbind(null,null,a),b.destroy()},a)}},{SYNC_GAP:i,POLLING_GAP:j})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],664:[function(a,b,c){var d=a("backbone"),e=a("./column-model");b.exports=d.Collection.extend({model:e,initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.tableModel)throw new Error("tableModel is required");this._configModel=b.configModel,this._tableModel=b.tableModel},url:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("column");return a+"/api/"+b+"/tables/"+this._tableModel.get("name")+"/columns"}})},{"./column-model":616,backbone:"backbone"}],665:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./table-columns-collection"),g=a("./get-simple-geometry-type"),h=a("./permission-model"),i=a("./synchronization-model"),j=a("../helpers/table-name-utils");b.exports=e.Model.extend({idAttribute:"name",defaults:{fetched:!1,schema:[]},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel},urlRoot:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("table");return a+"/api/"+b+"/tables"},parse:function(a,b){var c=b&&b.configModel||this._configModel;a.table_visualization&&!d.isEmpty(a.table_visualization)&&(a=d.extend({},a.table_visualization,{geometry_types:a.geometry_types})),a.synchronization&&(this._syncModel?this._syncModel.set(a.synchronization):this._syncModel=new i(a.synchronization,{configModel:c})),a.permission&&(this._permissionModel?this._permissionModel.set(a.permission):this._permissionModel=new h(a.permission,{configModel:c}));var e=d.defaults({fetched:!0},a),g=d.map(a.schema,function(a){return{name:a[0],type:a[1]}},this);return this.columnsCollection?this.columnsCollection.reset(g):this.columnsCollection=new f(g,{configModel:c,tableModel:this}),e},isOwner:function(a){return!(!a||!this._permissionModel)&&this._permissionModel.isOwner(a)},getUnqualifiedName:function(){return j.getUnqualifiedName(this.get("name"))},getOwnerName:function(){var a=this.get("name");if(!a)return null;var b=a.split(".");if(2===b.length)return b[0].replace(/"/g,"");if(this._permissionModel){var c=this._permissionModel.getOwner();return c.get("username")}return""},getUnquotedName:function(){var a=this.get("name");return a&&a.replace(/"/g,"")},getGeometryType:function(){var a=this.get("geometry_types"),b=[];if(!d.isArray(a))return[];for(var c in a){var e=a[c];if(e){var f=g(e.toLowerCase());f&&b.push(f)}}return d.uniq(b)},getPermissionModel:function(){return this._permissionModel},isReadOnly:function(a){return this.isSync()||!this.hasWriteAccess(a)},isSync:function(){var a=this.getSyncModel(),b=a&&a.get("id");return!!b},hasWriteAccess:function(a){return!(!a||!this._permissionModel)&&this._permissionModel.hasWriteAccess(a)},getSyncModel:function(){return this._syncModel}})},{"../helpers/table-name-utils":1101,"./get-simple-geometry-type":627,"./permission-model":653,"./synchronization-model":663,"./table-columns-collection":664,backbone:"backbone",underscore:"underscore"}],666:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./table-model"),g={type:"table",order:"updated_at",page:1,per_page:20,exclude_shared:!1,exclude_raster:!0,tags:"",q:""};b.exports=e.Collection.extend({model:function(a,b){var c=b.collection._configModel;return new f(a,{configModel:c,parse:!0})},modelId:function(a){return a.name},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this._stats={}},url:function(){var a=this._configModel.urlVersion("visualization"),b=this._configModel.get("base_url");return b+"/api/"+a+"/viz"},fetch:function(a){return a=a||{data:{per_page:1e3}},a.data=d.extend({},g,a.data),e.Collection.prototype.fetch.call(this,a)},getTotalStat:function(a){return this._stats[a]||0},parse:function(a){return this._stats=d.omit(a,"visualizations"),d.map(a.visualizations,function(a){var b=a.table;return{id:b.id,geometry_types:b.geometry_types,name:b.name,privacy:b.privacy,rows_counted:b.row_count,table_size:b.size,table_type:a.type}},this)}})},{"./table-model":665,backbone:"backbone",underscore:"underscore"}],667:[function(a,b,c){var d=a("underscore"),e=a("backbone-undo"),f=30;b.exports={init:function(a,b){if(!a)throw new Error("model is required to initialize undoManager");b=b||{},this.model=a,this.model._undoManager=this.undoManager=new e({maximumStackLength:b.maximumStackLength||f,register:this.model,track:b.track}),this._trackEvents(),this._addMethods(),d.isEmpty(b.history)||(b.track&&this.undoManager.stopTracking(),this._addHistory(b.history),b.track&&this.undoManager.startTracking())},_trackEvents:function(){d.each(["undo","redo"],function(a){this.undoManager.bind(a,function(){this.trigger(a,this.changed,this)},this.model)},this),this.undoManager.stack.bind("add remove reset",function(){this.trigger("unredoChanged",this.changed,this)},this.model)},_addHistory:function(a){var b=this.undoManager.stack;d.each(a,function(c,d){a[d+1]&&b.add({after:a[d+1],before:c,type:"change",undoTypes:this.undoManager.undoTypes,object:this.model,magicFusionIndex:0})},this),b.pointer=b.length-1},_addMethods:function(){d.extend(this.model,{undo:function(){this._undoManager.undo()},redo:function(){this._undoManager.redo()},canUndo:function(){return this._undoManager.isAvailable("undo")},canRedo:function(){return this._undoManager.isAvailable("redo")},getUndoHistory:function(){var a=this._undoManager.stack.toJSON(),b=d.reduce(a,function(a,b,c){return a.push(b.before),a},[],this);return b.push(this.attributes),b}})}}},{"backbone-undo":"backbone-undo",underscore:"underscore"}],668:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../config/upload-config"),g=a("../helpers/utils.js"),h=a("moment");a("backbone-model-file-upload"),b.exports=e.Model.extend({url:function(){var a=this._configModel.get("base_url");return a+"/api/v1/imports"},fileAttribute:"filename",defaults:{type:"",value:"",interval:0,privacy:"",progress:0,state:"idle",service_item_id:"",service_name:"",option:"",content_guessing:!0,type_guessing:!0,create_vis:!0},initialize:function(a,b){if(!b.userModel)throw new Error("userModel is required");if(!b.configModel)throw new Error("configModel is required");this._userModel=b.userModel,this._configModel=b.configModel,this._initBinds(),this._validate(this.attributes,{validate:!0})},setUpload:function(a){this.set(a,{validate:!0})},isValidToUpload:function(){return this.get("value")&&"error"!==this.get("state")},setFresh:function(a){a&&!d.isEmpty(a)?this.set(d.omit(a,"create_vis")):this.clear()},_initBinds:function(){this.bind("progress",function(a){this.set({progress:100*a,state:"uploading"})},this),this.bind("change:value",function(){"error"===this.get("state")&&(this.set({state:"idle"}),this.unset("get_error_text",{silent:!0}))},this),this.bind("error invalid",function(a,b){this.set({state:"error",error_code:b&&b.error_code||"",get_error_text:{title:_t("data.upload-model.invalid-import"),what_about:b&&b.msg||""}})},this)},validate:function(a){if(a){if("file"===a.type){if(a.value&&a.value.length)return{msg:_t("data.upload-model.one-file")};var b=a.value.name;if(!b)return{msg:_t("data.upload-model.file-defined")};var c=b.substr(b.lastIndexOf(".")+1);if(c&&(c=c.toLowerCase()),!d.contains(f.fileExtensions,c))return{msg:_t("data.upload-model.file-extension")};if(this._userModel.get("remaining_byte_quota")*f.fileTimesBigger<a.value.size)return{msg:_t("data.upload-model.file-size"),error_code:8001}}if("remote"===a.type){if(!a.remote_visualization_id)return{msg:_t("data.upload-model.visualization-id")};if(a.size&&this._userModel.get("remaining_byte_quota")*f.fileTimesBigger<a.size)return{msg:_t("data.upload-model.remote-file-size"),error_code:8001}}if("url"===a.type&&!g.isURL(a.value))return{msg:_t("data.upload-model.url-invalid")};if("sql"===a.type&&!a.value)return{msg:_t("data.upload-model.query-undefined")};if("duplication"===a.type&&!a.value)return{msg:_t("data.upload-model.dataset-copy-undefined")};if("service"===a.type&&"twitter_search"===a.service_name){var e=a.service_item_id;if(!e||d.isEmpty(e))return{msg:_t("data.upload-model.twitter-data")};if(d.isEmpty(e.categories))return{msg:_t("data.upload-model.twitter-categories-invalid")};var i=e.dates;if(!i||d.isEmpty(i))return{msg:_t("data.upload-model.twitter-dates-empty")};var j=h(i.fromDate)<=h(new Date);if(!i.fromDate||!i.toDate||!j)return{msg:_t("data.upload-model.twitter-dates-invalid")}}}},isValid:function(){return this.get("value")&&"error"!==this.get("state")},upload:function(){if("file"===this.get("type")){var a=this;this.xhr=this.save({filename:this.get("value")},{success:function(a){a.set("state","uploaded")},error:function(b,c){var d=_t("data.upload-model.connection-error");if(c&&429===c.status){var e=JSON.parse(c.responseText);d=e.errors.imports}a.set({state:"error",get_error_text:{title:_t("data.upload-model.error-happened"),what_about:d}})},complete:function(){delete a.xhr}})}},stopUpload:function(){this.xhr&&this.xhr.abort()},setGuessing:function(a){this.set({type_guessing:a,content_guessing:a})},setPrivacy:function(a){this.set("privacy",a)}})},{"../config/upload-config":597,"../helpers/utils.js":1102,backbone:"backbone","backbone-model-file-upload":"backbone-model-file-upload",moment:"moment",underscore:"underscore"}],669:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("../value-objects/analysis-node-ids"),g=a("../components/metrics/metrics-tracker"),h=a("../editor/style/style-defaults/simple-style-defaults"),i=a("./camshaft-reference"),j=a("./layer-types-and-kinds"),k=a("./layer-colors"),l=a("../components/notifier/notifier"),m=a("../helpers/reset-style-per-node");b.exports=function(a){if(!a.userModel)throw new Error("userModel is required");if(!a.analysisDefinitionsCollection)throw new Error("analysisDefinitionsCollection is required");if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.widgetDefinitionsCollection)throw new Error("widgetDefinitionsCollection is required");var b=a.userModel,c=a.analysisDefinitionsCollection,n=a.analysisDefinitionNodesCollection,o=a.layerDefinitionsCollection,p=a.widgetDefinitionsCollection,q=function(a){return{kind:"carto",options:{interactivity:"",tile_style:a&&a.options.tile_style||i.getDefaultCartoCSSForType(),cartocss:a&&a.options.tile_style||i.getDefaultCartoCSSForType(),style_version:"2.1.1",visible:!0,style_properties:a&&a.options.style_properties,sql_wrap:a&&a.options.sql_wrap},tooltip:a?a.tooltip:{},infowindow:a?a.infowindow:{}}},r=function(){n.toArray().forEach(function(a){o.anyContainsNode(a)||a.destroy()}),c.toArray().forEach(function(a){a.getNodeDefinitionModel()||a.destroy()})},s=function(a,b,c,d){if(!a||!e.isArray(a))throw new Error("affectedWidgets is required");if(!b)throw new Error("layerDefModel is required");if(!c)throw new Error("callback is required");var f,g,h=e.after(a.length,function(){g?l.removeNotification(f):f.set({status:"success",info:_t("notifications.widgets.restored"),closable:!0}),c(b,d)});a.length>0?(f=l.addNotification({status:"loading",info:_t("notifications.widgets.restoring"),closable:!1}),e.each(a,function(a){a.layer_id=a.layer_id||b.id,p.create(a,{wait:!0,success:h,error:function(a,b){f=l.addNotification({status:"error",info:_t("notifications.widgets.error.title")+_t("notifications.widgets.error.body",{body:"",error:b&&b.get("title")}),closable:!0}),g=!0,h()}})})):c(b,d)};return{_resetStylePerNode:function(a,b,c,d){m(a,b,c,d)},saveAnalysis:function(a){if(a.isValid()){var b=n.get(a.id);if(b){a.updateNodeDefinition(b);var d=o.findOwnerOfAnalysisNode(b);c.saveAnalysisForLayer(d),g.track("Modified analysis",{analysis:{id:a.attributes.id,natural_id:a.attributes.id,type:a.attributes.type}}),this._resetStylePerNode(b,d,!1,!0)}else b=a.createNodeDefinition(this);b.USER_SAVED=!0}},createAnalysisNode:function(a,b){var d=n.add(a,{parse:!1});return b.save({cartocss:i.getDefaultCartoCSSForType(),source:d.id}),c.saveAnalysisForLayer(b),g.track("Created analysis",{analysis:{id:d.attributes.id,natural_id:d.attributes.id,type:d.attributes.type}}),this._resetStylePerNode(d,b),d},saveAnalysisSourceQuery:function(a,b,d){if(!b)throw new Error("nodeDefModel is required");if("source"!==b.get("type"))throw new Error("nodeDefModel must be a source node");b.set("query",a||""),c.saveAnalysisForLayer(d),this._resetStylePerNode(b,d),d.save()},saveWidgetOption:function(a){if(!a)throw new Error("widgetOptionModel is required");if(a.analysisDefinitionNodeModel()){var b=a.layerDefinitionModel();c.saveAnalysisForLayer(b)}return a.save(p)},saveWidget:function(a){if(!a)throw new Error("widgetDefModel is required");var b=a.get("layer_id");o.some(function(a){if(a.id===b)return c.saveAnalysisForLayer(a),!0}),a.save()},deleteAnalysisNode:function(a){var b=n.get(a);if(!b)return!1;if(!b.canBeDeletedByUser())return!1;var d=o.findOwnerOfAnalysisNode(b),f=b.getPrimarySource(),h=function(a){return a!==d&&a!==b&&a.containsNode(b)};e.flatten([p.filter(h),o.filter(h),c.filter(h),n.filter(h),b],!0).forEach(function(a){a.destroy()});var i=f.getStyleHistoryForLayer(d.id);i?(d.set({source:f.id},{ignoreSchemaChange:!0}),d.styleModel.set(d.styleModel.parse(i.options.style_properties)),d.set({cartocss:i.options.tile_style,infowindow:i.infowindow,tooltip:i.tooltip,sql_wrap:i.options.sql_wrap})):d.set({source:f.id}),d.save(),c.saveAnalysisForLayer(d),g.track("Deleted analysis",{analysis:{id:b.attributes.id,natural_id:b.attributes.id,type:b.attributes.type}}),this._resetStylePerNode(f,d),r()},createLayerFromTable:function(a,d){d=d||{};var e=a.getUnqualifiedName(),f=a.getOwnerName()||b.get("username"),g=a.getGeometryType()&&a.getGeometryType()[0],i=d.at||o.length,k=o.getLayerOnTop(),l=o.indexOf(k),m=o.isThereAnyTorqueLayer(),p=k&&!j.isCartoDBType(k.get("type"))&&!j.isTorqueType(k.get("type"));(m||p)&&(k.set("order",l+1),p&&i--,m&&i--);var r=o.nextLetter(),s=q();return s.letter=r,s.options.table_name=e,f&&(s.options.user_name=f),g&&(s.options.style_properties={type:"simple",properties:h.generateAttributes(g)}),n.addRelatedTableData(a.toJSON()),o.create(s,{wait:!0,at:i,error:d.error,success:function(){o.each(function(a){a.isDataLayer()&&(c.findAnalysisForLayer(a)||c.saveAnalysisForLayer(a))}),o.save(),d.success&&d.success()}})},createLayerForAnalysisNode:function(a,d){var g=b.get("limits").max_layers;if(o.getNumberOfDataLayers()>=g){var h=new Error("max layers reached");throw h.userMaxLayers=g,h}var i=n.get(a);if(!i)throw new Error("node with id "+a+" does not exist");if(!d)throw new Error("cfg is required");if(isNaN(d.at)||d.at<=0)throw new Error("cfg.at must be on top of the base layer");var j,m,t,u,v,w=d.at,x=o.nextLetter(),y=[],z=function(a,b){this._resetStylePerNode(a.getAnalysisDefinitionNodeModel(),a,b),o.save()}.bind(this),A=o.findWhere({source:a});if(A)if(i.hasPrimarySource()){var B=o.indexOf(A),C=A.get("letter"),D=x+"1",E=i.clone(D);n.invoke("changeSourceIds",a,D);var F=e.pluck(A.ownedPrimaryAnalysisNodes(),"id"),G=p.filter(function(a){return e.contains(F,a.get("source"))});e.each(G,function(b){var c,d=b.get("source");c=d!==a?e.extend(e.omit(b.toJSON(),"id","layer_id","order"),{avoidNotification:!0}):e.extend(e.omit(b.toJSON(),"id","source","order"),{source:{id:D},avoidNotification:!0}),y.push(c),b.attributes.avoidNotification=!0,b.destroy()}),A.save({letter:x,color:k.getColorForLetter(x),source:D},{ignoreSchemaChange:!0}),c.newAnalysisForNode(E),o.remove(A,{silent:!0}),v=i.getPrimarySource().getStyleHistoryForLayer(A.id),m=A.get("table_name"),t=A.get("table_name_alias"),u=A.get("user_name")||b.get("username"),j=q(v),j.options=e.extend({},j.options,{sql:"SELECT * FROM "+m,table_name:m,table_name_alias:t,letter:C,color:k.getColorForLetter(C),source:i.getPrimarySource().id}),u&&(j.options.user_name=u),j.from_layer_id=A.get("id"),j.from_letter=C;var H=o.add(j,{at:B});c.saveAnalysisForLayer(H),o.add(A,{at:w}),this._resetStylePerNode(A.getAnalysisDefinitionNodeModel(),A),H.save(null,{success:function(){s(y,H,z,!v)},error:function(){l.addNotification({status:"error",info:_t("notifications.layer.error"),closable:!0})}}),i.destroy()}else v={options:{tile_style:A.get("cartocss"),sql_wrap:A.get("sql_wrap"),style_properties:A.get("style_properties")},infowindow:A.get("infowindow"),tooltip:A.get("tooltip")},m=A.get("table_name"),t=A.get("table_name_alias"),u=A.get("user_name")||b.get("username"),j=q(v),j.options=e.extend({},j.options,{sql:"SELECT * FROM "+m,table_name:m,table_name_alias:t,letter:x,color:k.getColorForLetter(x),source:a}),u&&(j.options.user_name=u),H=o.create(j,{at:w,success:function(){z(H,!1)},error:function(){l.addNotification({status:"error",info:_t("notifications.layer.error"),closable:!0})}});else{var I=i.linkedListBySameLetter(),J=function(a){var b=f.changeLetter(a.id,x),c=a.clone(b),d=p.where({source:a.id});return n.invoke("changeSourceIds",a.id,b),e.each(d,function(a){y.push(e.extend(e.omit(a.toJSON(),"id","layer_id","source","order"),{avoidNotification:!0,source:{id:b}})),a.attributes.avoidNotification=!0,a.destroy()}),c},K=J(I[0]);e.rest(I).forEach(J);
var L=o.findOwnerOfAnalysisNode(i);v=i.getStyleHistoryForLayer(L.id),m=L.get("table_name"),t=L.get("table_name_alias"),u=L.get("user_name")||b.get("username"),j=q(v),j.options=e.extend({},j.options,{sql:"SELECT * FROM "+m,table_name:m,table_name_alias:t,letter:x,color:k.getColorForLetter(x),source:K.id}),u&&(j.options.user_name=u),j.from_layer_id=L.get("id"),j.from_letter=L.get("letter"),H=o.create(j,{at:w,success:function(){s(y,H,z,!v)},error:function(){l.addNotification({status:"error",info:_t("notifications.layer.error"),closable:!0})}}),c.saveAnalysisForLayer(H),i.destroy()}r()},moveLayer:function(a){var b=a.from,e=a.to,f=o.at(b);o.remove(f,{silent:!0}),o.add(f,{at:e,parse:!1,silent:!0});var g=o.chain().map(function(a){var b=a.getAnalysisDefinitionNodeModel();if(b)return c.saveAnalysisForLayer(a)}).compact().value();d.when.apply(d,g).done(function(){o.save({success:function(){o.trigger("layerMoved",f,b,e)}})})},deleteLayer:function(a){var b=o.get(a);if(b.canBeDeletedByUser()){for(var g,h,i=[],j=b.ownedPrimaryAnalysisNodes(),k=0;k<j.length;k++){if(h=j[k],g=o.findPrimaryParentLayerToAnalysisNode(h,{exclude:i})){var l=g.ownedPrimaryAnalysisNodes().concat(h.linkedListBySameLetter()),m=l.length,q=f.sequence(l[0].id);m<=q&&(m=q);var s=e.last(l);"source"!==s.get("type")&&m++;var t=g.get("letter")+m,u=function(a){var b=a.id,c=f.prev(t);a.set("id",c),n.each(function(a){e.contains(i,a)||a.changeSourceIds(b,c,!0)});var d=function(a){a.get("source")!==b||e.contains(i,a)||a.save({source:c},{silent:!0})};return o.each(d),p.each(d),t=c,a},v=u(l[0]);e.rest(l).forEach(u),g.save({source:v.id});break}i.push(h),o.each(function(a){a.containsNode(h)&&(e.contains(i,a)||i.push(a),p.each(function(a){!e.contains(i,a)&&a.containsNode(h)&&i.unshift(a)}))})}e.contains(i,b)||i.push(b);var w=d.when.apply(d,e.chain(i).reduce(function(a,b){a.push(b);var d=o.get(b.id);if(d){var e=c.findAnalysisForLayer(d);e&&a.push(e)}return a},[]).unique().map(function(a){return a.set({avoidNotification:!0},{silent:!0}),a.destroy()}).value());return g&&c.saveAnalysisForLayer(g),r(),w}},saveLayer:function(a,b){if(!a)throw new Error("layerDefModel is required");a.isDataLayer()&&c.saveAnalysisForLayer(a),r();var d={shouldPreserveAutoStyle:!1};return b=e.extend({},d,b),a.save(null,b)}}}},{"../components/metrics/metrics-tracker":233,"../components/notifier/notifier":475,"../editor/style/style-defaults/simple-style-defaults":1022,"../helpers/reset-style-per-node":1098,"../value-objects/analysis-node-ids":1119,"./camshaft-reference":615,"./layer-colors":633,"./layer-types-and-kinds":637,jquery:"jquery",underscore:"underscore"}],670:[function(a,b,c){var d=a("backbone"),e=a("./group-model");b.exports=d.Collection.extend({model:e,initialize:function(a,b){this.organization=b.organization}})},{"./group-model":629,backbone:"backbone"}],671:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./organization-model"),g=a("./user-groups-collection"),h=a("./custom-baselayers-collection"),i=d.Model.extend({urlRoot:function(){var a=this._configModel.get("base_url");return a+"/api/v1/users"},defaults:{avatar_url:"http://cartodb.s3.amazonaws.com/static/public_dashboard_default_avatar.png",username:"",email:""},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,a=a||{},e.isEmpty(this.get("organization"))||(this._organizationModel=new f(this.get("organization"),{configModel:this._configModel,currentUserId:this.id})),this.get("layers")&&(this.layers=new h(this.get("layers"),{configModel:this._configModel,currentUserId:this.id})),this.groups=new g(a.groups,{organization:this._organizationModel})},isViewer:function(){return this.get("viewer")===!0},isBuilder:function(){return!this.isViewer()},canCreateDatasets:function(){return!(!this.get("remaining_byte_quota")||this.get("remaining_byte_quota")<=0)},hasCreateMapsFeature:function(){return this.isBuilder()},canCreateTwitterDataset:function(){return!(this.get("twitter").quota-this.get("twitter").monthly_use<=0&&this.get("twitter").hard_limit)},canStartTrial:function(){return!this.isInsideOrg()&&"FREE"===this.get("account_type")&&this.get("table_count")>0},isActionEnabled:function(a){return this.get("actions")&&this.get("actions")[a]},canCreatePrivateDatasets:function(){var a=this.get("actions");return a&&a.private_tables},isInsideOrg:function(){return!!this._organizationModel&&(!!this._organizationModel.id||this.isOrgOwner())},isOrgOwner:function(){return!!this._organizationModel&&this._organizationModel.getOwnerId()===this.get("id")},isOrgAdmin:function(){return!!this._organizationModel&&this._organizationModel.isOrgAdmin(this)},featureEnabled:function(a){var b=this.get("feature_flags");return!(!b||0===b.length||!a)&&e.contains(b,a)},upgradeContactEmail:function(){return this.isInsideOrg()?this.isOrgOwner()?"enterprise-support@carto.com":this._organizationModel.getOwnerEmail():"support@carto.com"},nameOrUsername:function(){return this.get("name")||this.get("username")},getMaxConcurrentImports:function(){return this.get("limits")&&this.get("limits").concurrent_imports||1},getSchemaName:function(){return this.isInsideOrg()?this.get("username"):"public"},renderData:function(a){var b=this.get("username");return a&&a.id===this.id&&(b=_t("user.you")),{username:b,avatar_url:this.get("avatar_url")}},clone:function(){var a=e.clone(this.attributes);return delete a.id,new i(a,{configModel:this._configModel})},getOrganization:function(){return this._organizationModel}});b.exports=i},{"./custom-baselayers-collection":620,"./organization-model":651,"./user-groups-collection":670,backbone:"backbone",underscore:"underscore"}],672:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=e.Model.extend({sync:function(a,b,c){return e.sync("update",b,c)},url:function(){var a=this._configModel.get("base_url");return a+"/api/v3/notifications/"+this.get("key")},initialize:function(a,b){if(!b.key)throw new Error("key is required");if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.attributes=d.extend({notifications:a},{key:b.key})},getKey:function(a){var b=this.get("notifications")||{};return b[a]},setKey:function(a,b){var c=this.get("notifications")||{};c[a]=b,this.set("notifications",c)}});b.exports=f},{backbone:"backbone",underscore:"underscore"}],673:[function(a,b,c){var d=a("backbone"),e=a("./backbone/sync-abort");b.exports=d.Collection.extend({sync:e,initialize:function(a,b){if(!b.group)throw new Error("group is required");this.group=b.group,this.configModel=b.configModel,this.organization=b.organization},url:function(a){var b=this.configModel.get("base_url"),c=this.configModel.urlVersion("organizationGroups",a);return b+"/api/"+c+"/organization/"+this.organization.id+"/groups/"+this.group.id+"/users"},parse:function(a){return this.total_entries=a.total_entries,this.total_user_entries=a.total_user_entries,a.users},totalCount:function(){return this.total_user_entries}})},{"./backbone/sync-abort":607,backbone:"backbone"}],674:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("./users-group-collection");b.exports={track:function(a){this.acl=a.acl,this.configModel=a.configModel,this.userModel=a.userModel,this.acl.on("reset",this.fetchUsers,this),this.fetchUsers()},fetchUsers:function(){var a=this,b=[];b=e.map(this.acl.where({type:"group"}),function(b){var c=b.get("entity"),e=new d.Deferred;return c.users&&0!==c.users.length?e.resolve():(c.users=new f([],{group:c,configModel:a.configModel,organization:a.userModel.getOrganization()}),c.users.fetch({success:function(){e.resolve()}})),e.promise()},this),d.when.apply(d,b).done(function(){a.acl.trigger("fetch")})}}},{"./users-group-collection":673,jquery:"jquery",underscore:"underscore"}],675:[function(a,b,c){var d=a("backbone"),e=a("./permission-model"),f=["PUBLIC","LINK","PRIVATE","PASSWORD"];b.exports=d.Model.extend({defaults:{visChanges:0},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.get("permission")&&(this._permissionModel=new e(this.get("permission"),{configModel:b.configModel}),this.unset("permission"))},urlRoot:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("visualization");return a+"/api/"+b+"/viz"},mapcapsURL:function(){var a=this._configModel.get("base_url");return a+"/api/v3/viz/"+this.id+"/mapcaps"},embedURL:function(){var a=this._configModel.get("base_url");return a+"/builder/"+this.id+"/embed"},builderURL:function(){var a=this._configModel.get("base_url");return a+"/builder/"+this.id+"/"},vizjsonURL:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("vizjson","read","v3");return a+"/api/"+b+"/viz/"+this.id+"/viz.json"},stateURL:function(){var a=this._configModel.get("base_url");return a+"/api/v3/viz/"+this.id+"/state"},isVisualization:function(){return"derived"===this.get("type")},privacyOptions:function(){return f},recordChange:function(){var a=this.get("visChanges");this.set("visChanges",a+1)},resetChanges:function(){this.set("visChanges",0)},getPermissionModel:function(){return this._permissionModel}})},{"./permission-model":653,backbone:"backbone"}],676:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{name:""},validate:function(a){if(a)return a.name?void 0:_t("components.modals.maps-metadata.validation.error.name")}})},{backbone:"backbone"}],677:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./table-model"),g=a("./permission-model"),h=a("./synchronization-model"),i=a("../components/likes/likes-model"),j=["PUBLIC","LINK","PRIVATE"];b.exports=d.Model.extend({urlRoot:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("visualization");return a+"/api/"+b+"/viz"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this._initModels()},_initModels:function(){var a=this.get("table");e.isEmpty(this.get("external_source"))||(a=this.get("external_source")),this._tableModel=new f(a,{configModel:this._configModel,parse:!0}),this.get("permission")&&(this._permissionModel=new g(this.get("permission"),{configModel:this._configModel}),this.unset("permission")),this._likesModel=i.newByVisData({vis_id:this.id,liked:this.get("liked"),likes:this.get("likes"),configModel:this._configModel}),this.get("synchronization")&&(this._synchronizationModel=new h(this.get("synchronization"),{configModel:this._configModel}),this._synchronizationModel.linkToTable(this._tableModel))},isVisualization:function(){return!1},getTableModel:function(){return this._tableModel},getLikesModel:function(){return this._likesModel},getPermissionModel:function(){return this._permissionModel},getSynchronizationModel:function(){return this._synchronizationModel},vizjsonURL:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("vizjson","read","v3");return a+"/api/"+b+"/viz/"+this.id+"/viz.json"},isRaster:function(){return"raster"===this.get("kind")},datasetURL:function(){var a=this._configModel.get("base_url"),b=this.getTableModel().getUnquotedName();return a+"/dataset/"+b},privacyOptions:function(){return j},toJSON:function(){return e.omit(this.attributes,"synchronization","stats","table")}})},{"../components/likes/likes-model":224,"./permission-model":653,"./synchronization-model":663,"./table-model":665,backbone:"backbone",underscore:"underscore"}],678:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./visualization-table-model"),g=a("./vis-definition-model");b.exports=e.Collection.extend({DEFAULT_FETCH_OPTIONS:{type:"table",order:"updated_at",page:1,per_page:20,exclude_shared:!1,exclude_raster:!0,tags:"",q:""},model:function(a,b){var c,d=b.collection._configModel;return new(c="derived"!==a.type?f:g)(a,{configModel:d})},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this._stats={}},url:function(){var a=this._configModel.urlVersion("visualization"),b=this._configModel.get("base_url");return b+"/api/"+a+"/viz"},fetch:function(a){return this.trigger("loading",this),a=a||{data:{per_page:1e3}},a.data=d.extend({},this.DEFAULT_FETCH_OPTIONS,a.data),e.Collection.prototype.fetch.call(this,a)},getDefaultParam:function(a){return this.DEFAULT_FETCH_OPTIONS[a]},getTotalStat:function(a){return this._stats[a]||0},parse:function(a){return this._stats=d.omit(a,"visualizations"),a.visualizations}})},{"./vis-definition-model":675,"./visualization-table-model":677,backbone:"backbone",underscore:"underscore"}],679:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{content_type:"",page:1,q:"",tag:"",category:"",shared:"no",locked:!1,liked:!1,library:!1,order:"updated_at",deepInsights:!1},isSearching:function(){return this.get("q")||this.get("tag")},isDatasets:function(){return"datasets"===this.get("content_type")},isMaps:function(){return"maps"===this.get("content_type")},isDeepInsights:function(){return this.isMaps()&&this.get("deepInsights")}})},{backbone:"backbone"}],680:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./backbone/sync-abort"),g=a("cartocolor"),h=["id","layer_id","source","title","type","order"],i=["widget_style_definition","auto_style_definition","auto_style_allowed"],j="#9DE0AD",k="#F2CC8F",l={color:{fixed:j,opacity:1}},m=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(_t("form-components.editors.fill.quantification.methods.category")+" #"+(c+1));return b};b.exports=e.Model.extend({defaults:{sync_on_data_change:!0,sync_on_bbox_change:!0,auto_style_allowed:!0,widget_style_definition:l},sync:f,initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.mapId)throw new Error("mapId is required");this._configModel=b.configModel,this._mapId=b.mapId},urlRoot:function(){var a=this._configModel.get("base_url"),b=this.get("layer_id");return a+"/api/v3/maps/"+this._mapId+"/layers/"+b+"/widgets"},parse:function(a){var b=d.defaults(d.pick(a,h),a.options);if(!d.isEmpty(a.style)){var c=JSON.parse(JSON.stringify(a.style));if(c.auto_style){var e=c.auto_style,f=e.definition;f&&f.color&&"category"===f.color.quantification&&(e.definition.color.domain=m(f.color.range)),b.auto_style_definition=e.definition,b.auto_style_allowed=e.allowed}b.widget_style_definition=a.style.widget_style.definition}return b.source=b.source&&b.source.id,b},toJSON:function(){var a=d.pick(this.attributes,h);if(a.source={id:this.get("source")},a.options=d.omit(this.attributes,h,i),this.get("widget_style_definition")&&(a.style={widget_style:{definition:this.get("widget_style_definition")}},a.style.auto_style={custom:!!this.get("auto_style_definition"),allowed:this.get("auto_style_allowed")},this.get("auto_style_definition"))){var b=JSON.parse(JSON.stringify(this.get("auto_style_definition")));b.color=d.omit(b.color,"domain","bins"),a.style.auto_style.definition=b}return a},changeType:function(a){var b=d.defaults({type:a},this.collection.attrsForThisType(a,this));d.chain(this.attributes).keys().difference(["sync_on_data_change","sync_on_bbox_change"].concat(h,i),d.keys(b)).each(function(a){this.unset(a,{silent:!0})},this),this.set(b)},containsNode:function(a){if(!a)return!1;var b=this.get("source"),c=a.collection.get(b);return!!(b===a.id||c&&c.containsNode(a))}},{getDefaultWidgetStyle:function(a){var b="time-series"===a?k:j,c=l;return c.color.fixed=b,c},getDefaultAutoStyle:function(a,b){var c=10,e=7,f=d.first(d.compact(d.map(g,function(a){return d.clone(a[e])},this))),h=d.clone(g.Prism[c]),i="category"===a?h:f,j="category"===a?"category":"quantiles",k={color:{attribute:b,quantification:j,range:i}};return"category"===a?k.color.domain=m(h):k.color.bins="time-series"===a?256:e,k}})},{"./backbone/sync-abort":607,backbone:"backbone",cartocolor:"cartocolor",underscore:"underscore"}],681:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./widget-definition-model");b.exports=d.Collection.extend({comparator:"order",model:function(a,b){var c=b.collection;a.order=e.isUndefined(a.order)?c._getNextOrder():a.order;var d=new f(a,{parse:!0,collection:c,configModel:c._configModel,mapId:c._mapId});return d},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.mapId)throw new Error("mapId is required");if(!b.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");this._configModel=b.configModel,this._mapId=b.mapId,this._layerDefinitionsCollection=b.layerDefinitionsCollection,this._bindLayerStyleChanges(),this._attrsForThisTypeMap={formula:function(a){return{column:a.get("column"),operation:a.get("operation")||"max"}},category:function(a){var b=a.get("column");return{aggregation:a.get("aggregation")||"count",aggregation_column:a.get("aggregation_column")||b,column:b,widget_style_definition:a.get("widget_style_definition")||f.getDefaultWidgetStyle("category"),auto_style_definition:void 0}},histogram:function(a){return{column:a.get("column"),bins:a.get("bins")||10,widget_style_definition:a.get("widget_style_definition")||f.getDefaultWidgetStyle("histogram"),auto_style_definition:void 0}},"time-series":function(a){return{column:a.get("column"),bins:a.get("bins")||256,widget_style_definition:a.get("widget_style_definition")||f.getDefaultWidgetStyle("time-series")}}}},url:function(){throw new Error("Not possible, see WidgetDefinitionModel.urlRoot")},_bindLayerStyleChanges:function(){this._layerDefinitionsCollection.bind("change:style_properties",this._onLayerStyleChanged,this)},_onLayerStyleChanged:function(a){var b=a.styleModel,c=b&&b.canApplyAutoStyle(),d=this.where({layer_id:a.id});e.each(d,function(a){var b=a.get("auto_style_allowed"),d=c,f={auto_style_allowed:d};b!==d&&(d===!1&&(f=e.extend(f,{auto_style_definition:""})),a.save(f))})},attrsForThisType:function(a,b){return this._attrsForThisTypeMap[a](b)},isThereTimeSeries:function(a){a=a||{};var b=a.animated?this.findWhere({type:"time-series",animated:a.animated}):this.findWhere({type:"time-series"});return!!b},isThereOtherWidgets:function(){return!!this.find(function(a){return"time-series"!==a.get("type")})},_getNextOrder:function(){if(this.isEmpty())return 0;var a=this.max(function(a){return a.get("order")});return a.get("order")+1},widgetsOwnedByLayer:function(a){var b=this.where({layer_id:a});return b.length}})},{"./widget-definition-model":680,backbone:"backbone",underscore:"underscore"}],682:[function(a,b,c){function d(){this._wms_url=null}var e=a("underscore"),f="https://cartodb-wms.global.ssl.fastly.net/api",g="https://cartodb-wms.global.ssl.fastly.net/mapproxy",h={read:"/check",create:"/add"},i=["EPSG:4326","EPSG:4258"];d.prototype.generateURL=function(a){var b=f+h[a.method],c=this._wms_url,d=document.createElement("a");d.href=c;var g=d.search.substr(1).split("&"),i=e.find(g,function(a){return a.toLowerCase().indexOf("request=getcapabilities")!==-1}),j=e.find(g,function(a){return a.toLowerCase().indexOf("service=wms")!==-1});i||g.push("request=GetCapabilities"),j||g.push("service=WMS"),c+="?"+g.join("&"),b+="?url="+encodeURIComponent(c);var k="wmts"===a.type;return b+="&type="+(k?"wmts":"wms"),"create"===a.method&&(a.layer&&a.srs?(b+="&layer="+a.layer,b+="&srs=EPSG:"+a.srs[0].split(":")[1]):k&&a.layer&&a.matrix_sets.length>0&&(b+="&layer="+a.layer,b+="&matrix_set="+this.supportedMatrixSets(a.matrix_sets||[])[0])),b},d.prototype.getFetchLayersURL=function(){return this.generateURL({method:"read"})},d.prototype.saveLayerURL=function(a){var b=e.extend({method:"create"},a);return this.generateURL(b)},d.prototype.supportedMatrixSets=function(a){return e.intersection(a,i)},d.prototype.getProxyTilesURL=function(){return g},d.prototype.setUrl=function(a){this._wms_url=a},b.exports=d},{underscore:"underscore"}],683:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("../components/modals/confirmation/modal-confirmation-view"),h=a("./start-edition-confirmation.tpl"),i=a("./edit-geometry.tpl"),j=a("../components/tipsy-tooltip-view"),k=a("../components/notifier/notifier"),l=f.extend({MAX_VERTEXES:1e3,className:"CDB-Overlay",type:"custom",events:{"click .js-edit-feature":"_onEditButtonClicked"},initialize:function(a){if(!a.map)throw new Error("map is required");if(!a.mapModeModel)throw new Error("mapModeModel is required");if(!a.modals)throw new Error("modals is required");this._map=a.map,this._mapModeModel=a.mapModeModel,this._modals=a.modals,this._onEditButtonClicked=this._onEditButtonClicked.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this._map.on("change:center",this.hide,this),this._map.on("change:zoom",this.hide,this),this._position={x:0,y:0}},render:function(){this.clearSubViews();var a=this._isEditable();if(this.$el.html(i({isEditable:a,hasAnalyses:this._hasAnalyses(),isCustomQueryApplied:this._isCustomQueryApplied(),isReadOnly:this._isReadOnly(),disabled:this._disabledTooltip()})),a)this.delegateEvents();else{var b=new j({el:this.$(".js-edit-feature"),gravity:"s",offset:0,title:function(){return d(this).data("tooltip")}});this.addView(b),this.undelegateEvents()}return this},_disabledTooltip:function(){var a;return this._hasAnalyses()?a=_t("editor.edit-feature.analysis"):this._isCustomQueryApplied()?a=_t("editor.edit-feature.custom-sql"):this._isReadOnly()&&(a=_t("editor.edit-feature.sync")),_t("editor.edit-feature.disabled",{disabledLayerType:a})},_isEditable:function(){return this._featureDefinition&&this._featureDefinition.isEditable()},_hasAnalyses:function(){return this._featureDefinition&&this._featureDefinition.hasAnalyses()},_isCustomQueryApplied:function(){return this._featureDefinition&&this._featureDefinition.isCustomQueryApplied()},_isReadOnly:function(){return this._featureDefinition&&this._featureDefinition.isReadOnly()},hide:function(a){this.killEvent(a),this.$el.hide(),d(document).off("click",this.hide)},show:function(){this.$el.css({width:"20px",top:this._position.y,left:this._position.x,position:"absolute"}),this.$el.show(),d(document).on("click",this.hide)},setPosition:function(a){this._position=a},setFeatureDefinition:function(a){this._featureDefinition=a},getFeatureDefinition:function(){return this._featureDefinition},_getGeomCount:function(a){var b=0;return e.each(a.coordinates,function(a,c){e.each(a,function(a,c){b+=a.length})}),b},_confirmStopEdition:function(){var a=this;this._modals.create(function(b){return new g({modalModel:b,template:h,runAction:a._startEdition.bind(a)})})},_startEdition:function(){this._mapModeModel.isEditingFeatureMode()&&this._mapModeModel.enterViewingMode(),this._mapModeModel.enterEditingFeatureMode(this._featureDefinition)},_onEditButtonClicked:function(a){if(this.killEvent(a),this.hide(),!this._isEditable())return!1;var b=k.addNotification({status:"loading",info:_t("notifications.edit-feature.edit.loading"),closable:!1});this._featureDefinition&&this._featureDefinition.fetch({success:function(){k.removeNotification(b);var a=JSON.parse(this._featureDefinition.get("the_geom"));this._getGeomCount(a)>this.MAX_VERTEXES?this._confirmStopEdition():this._startEdition()}.bind(this),error:function(){b.set({status:"error",info:_t("notifications.edit-feature.edit.error"),closable:!0,delay:k.DEFAULT_DELAY})}})}});b.exports=l},{"../components/modals/confirmation/modal-confirmation-view":404,"../components/notifier/notifier":475,"../components/tipsy-tooltip-view":589,"./edit-geometry.tpl":684,"./start-edition-confirmation.tpl":688,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],684:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="CDB-Attribution-button js-edit-feature\n  ',isEditable||(__p+="is-disabled"),__p+="\n  ",hasAnalyses&&(__p+="t-hasAnalyses"),__p+="\n  ",isCustomQueryApplied&&(__p+="t-isCustomQueryApplied"),__p+="\n  ",isReadOnly&&(__p+="t-isReadOnly"),__p+='" data-tooltip="'+(null==(__t=disabled)?"":_.escape(__t))+'">\n  <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M10 22.91l1.217-3.65 8.924-8.924c.448-.448 1.177-.448 1.624 0l.81.81c.448.448.448 1.175 0 1.623l-8.923 8.924L10 22.91zm10.952-8.518l-2.434-2.434 2.434 2.434zm-7.3 7.302l-2.435-2.434 2.434 2.434z" stroke="#636D72" fill="none" fill-rule="evenodd"/></svg>\n</button>\n';return __p}},{underscore:"underscore"}],685:[function(a,b,c){var d=a("underscore"),e=a("../editor/layers/layer-content-views/legend/legend-factory"),f=a("../editor/layers/layer-content-views/legend/form/legend-color-helper"),g="#999999",h=function(a){function b(a,b){var c=a.styleModel;"animation"===c.get("type")?e.removeLegend(a,"choropleth",function(){e.removeLegend(a,"custom_choropleth",function(){e.createLegend(a,"category",{title:b.attribute})})}):"heatmap"===c.get("type")?e.removeLegend(a,"category",function(){e.removeLegend(a,"choropleth",function(){e.createLegend(a,"custom_choropleth",{title:_t("editor.legend.pixel-title")})})}):b.attribute_type&&"string"===b.attribute_type||"category"===b.quantification?e.removeLegend(a,"choropleth",function(){e.removeLegend(a,"custom_choropleth",function(){m?e.removeLegend(a,"category"):e.createLegend(a,"category",{title:b.attribute})})}):e.removeLegend(a,"category",function(){e.removeLegend(a,"custom_choropleth",function(){m?e.removeLegend(a,"choropleth"):e.createLegend(a,"choropleth",{title:b.attribute})})})}var c,h,i,j,k=a.styleModel,l=a.get("autoStyle"),m=null!=l&&l!==!1;if(k&&(c=k.get("fill"),h=k.get("stroke"),!(!c&&!h||d.isEmpty(c)&&d.isEmpty(h)))){if(i=c&&c.color||h&&h.color,j=c&&c.size||h&&h.size,e.isEnabledType("size"))if(j&&void 0!==j.attribute){var n={title:j.attribute};m||(n.fillColor=i&&(i.fixed||i.range)?f.getBubbles(i).color.fixed:g),e.createLegend(a,"bubble",n)}else e.removeLegend(a,"bubble");if(e.isEnabledType("color"))if(i&&void 0!==i.attribute){var o=e.find(a,"custom");o||b(a,i)}else e.removeLegend(a,"category"),e.removeLegend(a,"choropleth"),e.removeLegend(a,"custom_choropleth")}};b.exports={track:function(a){var b=function(){h(a)},c=a.styleModel;a.on("change:cartocss",h),c&&c.on("style:update",b),a.on("destroy",function(){a.off("change:cartocss",h),c&&c.off("style:update",b)})}}},{"../editor/layers/layer-content-views/legend/form/legend-color-helper":947,"../editor/layers/layer-content-views/legend/legend-factory":961,underscore:"underscore"}],686:[function(a,b,c){var d=a("../mustache-templates/infowindows/infowindow_none.tpl");b.exports=function(a,b){function c(c){var e=JSON.parse(JSON.stringify(c.attributes));if(c.isEmptyTemplate()){var f=a.getAnalysisDefinitionNodeModel(),g=f&&f.querySchemaModel.columnsCollection.find(function(a){return"cartodb_id"===a.get("name")});g&&(e.fields=[{name:"cartodb_id",title:!0,position:0}],e.template=d({title:_t("editor.layers.infowindow.no-fields"),subtitle:_t("editor.layers.infowindow.select-fields")}))}var h=b.getLayerById(a.id).infowindow;h&&h.update(e)}function e(a){c(a)}a.infowindowModel&&(c(a.infowindowModel),a.infowindowModel.bind("change",e),a.bind("destroy",function(){a.infowindowModel.unbind("change",e)}))}},{"../mustache-templates/infowindows/infowindow_none.tpl":1108}],687:[function(a,b,c){b.exports=function(a,b){function c(c){var d=JSON.parse(JSON.stringify(c.attributes)),e=b.getLayerById(a.id).tooltip;e&&e.update(d)}if(a.tooltipModel){var d=a.tooltipModel;d.get("template_name")&&d.setTemplate(d.get("template_name")),d.bind("change",c),a.bind("destroy",function(){d.unbind("change",c)})}}},{}],688:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg">\n        <path d="M1 25l2.262-6.787 16.59-16.59c.832-.83 2.185-.83 3.016 0l1.508 1.51c.83.83.83 2.182 0 3.015l-16.59 16.59L1 25zM21.36 9.165L16.835 4.64l4.525 4.525zM7.787 22.738l-4.525-4.525 4.525 4.525z" stroke="#F19243" fill="none" fill-rule="evenodd"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--m">'+(null==(__t=_t("components.modals.edit-feature.confirmation.title"))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.edit-feature.confirmation.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.modals.edit-feature.confirmation.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.edit-feature.confirmation.continue"))?"":_.escape(__t))+"</span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],689:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("./deep-insights-integration/link-layer-infowindow"),g=a("./deep-insights-integration/link-layer-tooltip"),h=a("./deep-insights-integration/legend-manager"),i=a("./editor/layers/analysis-views/analysis-notifications"),j=a("./widgets-notifications"),k=a("./components/onboardings/analysis/analysis-launcher"),l=a("./editor/layers/notification-error-message-handler"),m=a("./vis-notifications"),n=a("./editor/widgets/widgets-service"),o=a("./data/widget-definition-model"),p=a("./data/feature-definition-model"),q=a("./components/notifier/notifier"),r=a("./data/layer-types-and-kinds"),s=a("./data/basemap-providers-and-categories"),t=a("./helpers/styles-without-autostyle"),u=function(a){if(!a.deepInsightsDashboard)throw new Error("deepInsightsDashboard is required");if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");if(!a.analysisDefinitionsCollection)throw new Error("analysisDefinitionsCollection is required");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.widgetDefinitionsCollection)throw new Error("widgetDefinitionsCollection is required");if(!a.legendDefinitionsCollection)throw new Error("legendDefinitionsCollection is required");if(!a.visDefinitionModel)throw new Error("visDefinitionModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.onboardings)throw new Error("onboardings is required");if(!a.mapDefinitionModel)throw new Error("mapDefinitionModel is required");if(!a.stateDefinitionModel)throw new Error("stateDefinitionModel is required");if(!a.overlayDefinitionsCollection)throw new Error("overlayDefinitionsCollection is required");if(!a.mapModeModel)throw new Error("mapModeModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.editorModel)throw new Error("editorModel is required");if(!a.editFeatureOverlay)throw new Error("editFeatureOverlay is required");this._diDashboard=a.deepInsightsDashboard,this._analysisDefinitionNodesCollection=a.analysisDefinitionNodesCollection,this._analysisDefinitionsCollection=a.analysisDefinitionsCollection,this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._visDefinitionModel=a.visDefinitionModel,this._stateDefinitionModel=a.stateDefinitionModel,this._userModel=a.userModel,this._mapDefinitionModel=a.mapDefinitionModel,this._onboardings=a.onboardings,this._overlayDefinitionsCollection=a.overlayDefinitionsCollection,
this._mapModeModel=a.mapModeModel,this._configModel=a.configModel,this._widgetDefinitionsCollection=a.widgetDefinitionsCollection,this._editorModel=a.editorModel,this._editFeatureOverlay=a.editFeatureOverlay,this._legendsDefinitionCollection=a.legendDefinitionsCollection,this._getStylesWithoutAutostyles=t(),this._layerDefinitionsCollection.each(this._linkLayerErrors,this),a.analysisDefinitionNodesCollection.each(function(a){a.queryRowsCollection.on("remove",this._invalidateMap,this)},this),this._analysisDefinitionNodesCollection.on("add",this._analyseDefinitionNodeAdded,this),this._analysisDefinitionNodesCollection.on("change",this._analyseDefinitionNode,this),this._analysisDefinitionNodesCollection.on("change:id",this._onAnalysisDefinitionNodeIdChanged,this),this._analysisDefinitionNodesCollection.on("remove",this._onAnalysisDefinitionNodeRemoved,this),this._analysisDefinitionsCollection.on("add change:node_id sync",this._analyseDefinition,this),a.layerDefinitionsCollection.on("add",this._onLayerDefinitionAdded,this),a.layerDefinitionsCollection.on("sync",this._onLayerDefinitionSynced,this),a.layerDefinitionsCollection.on("change",this._onLayerDefinitionChanged,this),a.layerDefinitionsCollection.on("remove",this._onLayerDefinitionRemoved,this),a.layerDefinitionsCollection.on("layerMoved",this._onLayerDefinitionMoved,this),a.layerDefinitionsCollection.on("baseLayerChanged",this._onBaseLayerChanged,this),a.layerDefinitionsCollection.each(function(a){h.track(a),f(a,this.visMap()),g(a,this.visMap()),a.has("source")&&this._resetStylesIfNoneApplied(a)},this),a.legendDefinitionsCollection.on("add",this._onLegendDefinitionAdded,this),a.legendDefinitionsCollection.on("change",this._onLegendDefinitionChanged,this),a.legendDefinitionsCollection.on("remove",this._onLegendDefinitionRemoved,this),a.widgetDefinitionsCollection.on("add",this._onWidgetDefinitionAdded,this),a.widgetDefinitionsCollection.on("sync",this._onWidgetDefinitionSynced,this),a.widgetDefinitionsCollection.on("change",this._onWidgetDefinitionChanged,this),a.widgetDefinitionsCollection.on("destroy",this._onWidgetDefinitionDestroyed,this),a.widgetDefinitionsCollection.on("add remove reset",this._invalidateSize,this),a.widgetDefinitionsCollection.each(this._onWidgetDefinitionAdded,this),a.overlayDefinitionsCollection.on("add",this._onOverlayDefinitionAdded,this),a.overlayDefinitionsCollection.on("remove",this._onOverlayDefinitionRemoved,this),a.mapDefinitionModel.on("change:minZoom change:maxZoom",d.debounce(this._onMinMaxZoomChanged.bind(this),300),this),a.mapDefinitionModel.on("change:scrollwheel",this._onScrollWheelChanged,this),a.mapDefinitionModel.on("change:legends",this._onLegendsChanged,this),a.mapDefinitionModel.on("change:layer_selector",this._onLayerSelectorChanged,this),this._onScrollWheelChanged(),j.track(this._widgetDefinitionsCollection),a.editorModel.on("change:settingsView",this._onEditorSettingsChanged,this),this._analysisDefinitionsCollection.each(this._analyseDefinition,this),this._vis().on("reload",this._visReload,this),this._vis().on("change:error",this._visErrorChange,this);var b=d.debounce(this._saveStateDefinition.bind(this),500);this._diDashboard.onStateChanged(b),this._stateDefinitionModel.on("boundsSet",this._onBoundsSet,this),this._getLayers().on("change:visible",function(b,c){var d=a.layerDefinitionsCollection.findWhere({id:b.id});d&&d.get("visible")!==c&&d.save({visible:c})},this),m.track(this._vis()),a.mapModeModel.on("change:mode",this._onMapModeChanged,this),this.visMap().on("featureClick",this._onFeatureClicked,this),this.visMap().on("mapViewSizeChanged",this._setMapViewSize,this),this._getVisMetadata(),this._setMapConverters(),this._setMapViewSize()};u.prototype._onFeatureClicked=function(a){var b=a.layer.id,c=a.feature.cartodb_id,d=a.position,e=this._layerDefinitionsCollection.get(b),f=!1,g=new p({cartodb_id:c},{configModel:this._configModel,layerDefinitionModel:e,userModel:this._userModel});if(this._mapModeModel.isEditingFeatureMode()){var h=this._mapModeModel.getFeatureDefinition();f=g.isEqual(h)}f||(this._editFeatureOverlay.setPosition(d),this._editFeatureOverlay.setFeatureDefinition(g),this._editFeatureOverlay.render().show())},u.prototype._onMapModeChanged=function(a){var b,c,d=this.visMap();if(a.isViewingMode()&&(d.stopDrawingGeometry(),d.stopEditingGeometry()),a.isDrawingFeatureMode()&&(b=a.getFeatureDefinition(),b.isPoint()?c=d.drawPoint():b.isLine()?c=d.drawPolyline():b.isPolygon()&&(c=d.drawPolygon()),!c))throw new Error("couldn't get geometry for feature of type "+b.get("type"));if(a.isEditingFeatureMode()){b=a.getFeatureDefinition();var e=JSON.parse(b.get("the_geom"));c=d.editGeometry(e)}b&&c&&(this._bindGeometryToFeatureDefinition(c,b),b.on("save",function(){(b.hasBeenChangedAfterLastSaved("the_geom")||b.hasBeenChangedAfterLastSaved("cartodb_id"))&&(this._invalidateMap(),c.setCoordinatesFromGeoJSON(JSON.parse(b.get("the_geom"))))},this),b.on("remove",function(){this._invalidateMap()},this))},u.prototype._bindGeometryToFeatureDefinition=function(a,b){a.on("change",function(){if(a.isComplete()){e(".js-editOverlay").fadeOut(200,function(){e(".js-editOverlay").remove()});var c=a.toGeoJSON();c=c.geometry||c,b.set({the_geom:JSON.stringify(c)}),b.trigger("updateFeature")}})},u.prototype._resetStylesIfNoneApplied=function(a){var b=a.getAnalysisDefinitionNodeModel(),c=this._analysis(),d=c&&c.findNodeById(a.get("source")),e=d&&"source"!==d.get("type"),f=d&&d.isDone(),g=b.queryGeometryModel,h=a.styleModel;if(e&&h.hasNoneStyles()&&f){var i=g.get("simple_geom"),j=function(){i=g.get("simple_geom"),h.setDefaultPropertiesByType("simple",i)};i?j():(g.once("change:simple_geom",j,this),g.fetch())}},u.prototype._visReload=function(){this._getVisMetadata(),this._visDefinitionModel.trigger("vis:reload"),this._visDefinitionModel.recordChange()},u.prototype._getVisMetadata=function(){var a=this._vis(),b=this.visMap(),c=this._getLayers(),d={zoom:b.get("zoom"),mapType:b.getBaseLayer().get("baseType"),style:c.at(0).get("style"),attribution:b.get("attribution"),provider:b.get("provider")};this._mapDefinitionModel.setImageExportMetadata(d),this._mapDefinitionModel.setStaticImageURLTemplate(a.getStaticImageURL.bind(a))},u.prototype._setMapConverters=function(){var a=this.visMap();this._mapDefinitionModel.setConverters({pixelToLatLng:a.pixelToLatLng(),latLngToPixel:a.latLngToPixel()})},u.prototype._setMapViewSize=function(){this._mapDefinitionModel.setMapViewSize(this.visMap().getMapViewSize())},u.prototype._visErrorChange=function(){this._visDefinitionModel&&this._visDefinitionModel.trigger("vis:error",this._vis().get("error"))},u.prototype._analyseDefinition=function(a){var b=a.get("node_id"),c=this._analysisDefinitionNodesCollection.get(b);this._analyseDefinitionNode(c)},u.prototype._analyseDefinitionNodeAdded=function(a){a.queryRowsCollection.on("remove",this._invalidateMap,this),this._analyseDefinitionNode(a)},u.prototype._analyseDefinitionNode=function(a){if(!this._hasUpdateOnlyNodeAnalysisId(a)){var b=a.toJSON({skipOptions:!0});this._analysis().analyse(b),this._analysisDefinitionNodesCollection.each(this._tryToSetupDefinitionNodeSync,this)}},u.prototype._onAnalysisDefinitionNodeIdChanged=function(a,b){if(this._hasUpdateOnlyNodeAnalysisId(a)){var c=this._analysis().findNodeById(a.previous("id"));c&&c.set("id",a.id)}},u.prototype._onAnalysisDefinitionNodeRemoved=function(a){a.queryRowsCollection.off("remove",this._invalidateMap,this);var b=this._analysis().findNodeById(a.id);b&&(b.set({avoidNotification:a&&!!a.get("avoidNotification")},{silent:!0}),b.remove())},u.prototype._hasUpdateOnlyNodeAnalysisId=function(a){return a.hasChanged("id")&&1===d.size(a.changed)},u.prototype._tryToSetupDefinitionNodeSync=function(a){if(!a.__syncSetup){var b=this._analysis().findNodeById(a.id),c=this._layerDefinitionsCollection.findOwnerOfAnalysisNode(a);if(b)if(a.__syncSetup=!0,a.__initialization=!0,"source"!==b.get("type")){i.track(b,c);var d=function(){var c=b.get("query"),d=b.get("status"),e=b.get("error");a.querySchemaModel.set({status:"unfetched",query:c,ready:"ready"===d}),a.queryGeometryModel.set({status:"unfetched",query:c,ready:"ready"===d}),a.set({status:d,error:e}),"ready"===d&&(a.__initialization||a.trigger("queryObjectsUpdated",a),a.__initialization=!1)};k.init({onboardings:this._onboardings,userModel:this._userModel}),a.listenTo(b,"change:status",function(c,d){"ready"===d&&a.USER_SAVED&&(k.launch(b.get("type"),c),a.USER_SAVED=!1)}),d(),a.listenTo(b,"change:query change:status change:error",d),a.listenToOnce(b,"destroy",a.stopListening)}else a.listenTo(a.querySchemaModel,"resetDueToAlteredData",this._invalidateMap.bind(this))}},u.prototype._onWidgetDefinitionAdded=function(a){var b=this._diDashboard.getWidget(a.id);b&&(b.set({show_stats:!0,show_options:!0}),this._bindWidgetChanges(b))},u.prototype._onWidgetDefinitionSynced=function(a){var b=this._diDashboard.getWidget(a.id);b||this._createWidgetModel(a)},u.prototype._onWidgetAutoStyleColorChanged=function(a){var b=a.isAutoStyle(),c=a.getAutoStyle(),d=a.dataviewModel.layer.id,e=this._layerDefinitionsCollection.findWhere({id:d}),f=e&&e.getAnalysisDefinitionNodeModel(),g=e&&e.styleModel,h=f&&f.get("simple_geom");e&&e.set({autoStyle:!!b&&a.id,cartocss:c.cartocss}),b&&g&&h&&g.setPropertiesFromAutoStyle({definition:c.definition,geometryType:h,widgetId:a.id})},u.prototype._onWidgetAutoStyleChanged=function(a){var b=a.isAutoStyle(),c=a.getAutoStyle(),e=a.dataviewModel.layer.id,f=this._layerDefinitionsCollection.findWhere({id:e}),g=f&&f.getAnalysisDefinitionNodeModel(),h=f&&f.styleModel,i=d.debounce(function(){var b=!0;a.cancelAutoStyle(b)},10),j=this._getStylesWithoutAutostyles(f);if(f&&g)if(b&&f.set({autoStyle:a.id}),b){var k=g.get("simple_geom");h.setPropertiesFromAutoStyle({definition:c.definition,geometryType:k,widgetId:a.id}),f.set(d.extend({cartocss:c.cartocss,cartocss_custom:!1},j)),f.once("change:autoStyle change:cartocss",i,this)}else{f.unbind("change:autoStyle change:cartocss",i,this);var l=f.get("autoStyle");l&&l===a.id&&(h.resetPropertiesFromAutoStyle(),f.set({autoStyle:!1,cartocss_custom:f.get("previousCartoCSSCustom"),cartocss:f.get("previousCartoCSS")}),f.save())}},u.prototype._onWidgetCustomAutoStyleColorChanged=function(a){var b=a.isAutoStyle(),c=a.getAutoStyle(),d=a.dataviewModel.layer.id,e=this._layerDefinitionsCollection.findWhere({id:d}),f=e&&e.getAnalysisDefinitionNodeModel(),g=e&&e.styleModel;if(b){var h=f.get("simple_geom");g.setPropertiesFromAutoStyle({definition:c.definition,geometryType:h,widgetId:a.id}),e.set({cartocss:c.cartocss,cartocss_custom:!1},{silent:!0}),g.trigger("style:update")}},u.prototype._onWidgetDefinitionChanged=function(a){var b=this._diDashboard.getWidget(a.id);if(b)if(a.hasChanged("type"))b.remove(),this._createWidgetModel(a);else{var c=this._formatWidgetAttrs(a.changedAttributes(),a);b.update(c)}},u.prototype._onWidgetDefinitionDestroyed=function(a){var b=this._diDashboard.getWidget(a.id);b&&(b.isAutoStyle()&&b.cancelAutoStyle(),this._unbindWidgetChanges(b),b.remove())},u.prototype._onEditWidget=function(a){var b=this._widgetDefinitionsCollection.get(a.id);b&&n.editWidget(b)},u.prototype._onRemoveWidget=function(a){var b=this._widgetDefinitionsCollection.get(a.id);b&&n.removeWidget(b)},u.prototype._bindWidgetChanges=function(a){a.bind("editWidget",this._onEditWidget,this),a.bind("removeWidget",this._onRemoveWidget,this),a.bind("customAutoStyle",this._onWidgetCustomAutoStyleColorChanged,this),a.bind("change:autoStyle",this._onWidgetAutoStyleChanged,this),a.bind("change:color",this._onWidgetAutoStyleColorChanged,this)},u.prototype._unbindWidgetChanges=function(a){a.unbind("editWidget",this._onEditWidget,this),a.unbind("removeWidget",this._onRemoveWidget,this),a.unbind("customAutoStyle",this._onWidgetCustomAutoStyleColorChanged,this),a.unbind("change:autoStyle",this._onWidgetAutoStyleChanged,this),a.unbind("change:color",this._onWidgetAutoStyleColorChanged,this)},u.prototype._createWidgetModel=function(a){var b=a.get("type").replace(/(^\w|-\w)/g,function(a){return a.toUpperCase().replace("-","")}),c="create"+b+"Widget",d=this.visMap().getLayerById(a.get("layer_id")),e=this._formatWidgetAttrs(a.attributes,a),f=this._diDashboard[c](e,d);f&&(f.set({show_stats:!0,show_options:!0}),this._bindWidgetChanges(f))},u.prototype._formatWidgetAttrs=function(a,b){var c=["widget_style_definition","auto_style_definition","auto_style_allowed"],e=a;d.isString(e.source)&&(e=d.omit(e,"source"),e.source={id:a.source});var f=d.find(e,function(a,b){return d.contains(c,b)});return d.isUndefined(f)||(e=d.omit(e,c),e.style=b.toJSON().style),e},u.prototype._onLayerDefinitionAdded=function(a,b,c){r.isTypeDataLayer(a.get("type"))&&(a.isNew()||(this._getLayer(a)?this._tryUpdateLayerPosition(a):this._createLayer(a)))},u.prototype._tryUpdateLayerPosition=function(a){var b,c=this._layerDefinitionsCollection.indexOf(a),d=this._getLayer(a);d&&(b=this._getLayers().indexOf(d));var e=a.isDataLayer()&&b>0&&c>0&&c!==b;e&&this.visMap().moveCartoDBLayer(b,c)},u.prototype._onLayerDefinitionSynced=function(a){r.isTypeDataLayer(a.get("type"))&&(this._getLayer(a)||this._createLayer(a))},u.prototype._onLayerDefinitionChanged=function(a,b){var c=a.changedAttributes(),e=d.keys(c);if(r.isTypeDataLayer(a.get("type"))&&(1!==e.length||"error"!==e[0])){var f=this._getLayer(a);if(!a.isNew()){if(!f)return void this._createLayer(a);c.type?(f.remove(),this._createLayer(a)):(a.get("source")&&!f.get("source")&&(c.source=a.get("source")),c=this._adaptAttrsToCDBjs(a.get("type"),c),f.update(c)),this._manageTimeSeriesForTorque(a)}}},u.prototype._onBaseLayerChanged=function(){var a=this._layerDefinitionsCollection.getBaseLayer(),b=a.changedAttributes(),c=a.get("type"),d=s.getProvider(c),e=!1;if(a.hasChanged("type")){var f=a.previous("type"),g=s.getProvider(f);e=g!==d}var h=e,i=this._getLayer(a);b.type?(i.remove({silent:h}),this._createLayer(a,{silent:h})):i.update(this._adaptAttrsToCDBjs(a.get("type"),b),{silent:h});var j=this._layerDefinitionsCollection.getLabelsLayer(),k=this._getLayers().last(),l="Tiled"===k.get("type");if(j)if(l){var m=j.changedAttributes();m&&k.update(this._adaptAttrsToCDBjs(j.get("type"),m),{silent:h})}else this._createLayer(j,{silent:h});else l&&k.remove({silent:h});this.visMap().set("provider",d),h&&this._diDashboard.reloadMap(),this._editFeatureOverlay.render(),this._setMapConverters()};var v={layer_name:["table_name_alias","table_name"]},w={all:["letter","kind"],Tiled:["category","selected","highlighted"],CartoDB:["color","letter"],torque:["color","letter"]};u.prototype._adaptAttrsToCDBjs=function(a,b){return b=d.omit(b,w.all,w[a]),d.each(v,function(a,c){d.each(a,function(a){b[a]&&!b[c]&&(b[c]=b[a])})}),b},u.prototype._onLegendDefinitionAdded=function(a){var b,c=a.layerDefinitionModel,d=this._getLayer(c),e=a.get("type");d&&d.legends&&(b=d.legends[e],b&&(b.reset(),b.set(a.getAttributes()),b.show()))},u.prototype._onLegendDefinitionRemoved=function(a){var b,c=a.layerDefinitionModel,d=this._getLayer(c),e=a.get("type");d&&d.legends&&(b=d.legends[e],b&&b.hide())},u.prototype._onLegendDefinitionChanged=function(a){var b,c=a.layerDefinitionModel,d=this._getLayer(c),e=a.get("type");d&&d.legends&&(b=d.legends[e],b&&(b.reset(),b.set(a.getAttributes())))},u.prototype._manageTimeSeriesForTorque=function(a){function b(a,b,c){var d=a&&a.get("title");this._createTimeseries(b,c,d)}if(a.styleModel){var c,e=a.styleModel.changedAttributes().animated;e&&(c=e.attribute);var f=a.styleModel.changedAttributes().type,g=a.styleModel.get("animated")&&a.styleModel.get("animated").attribute,h=a.styleModel.previous("type");if(f||c){var i=a.styleModel.get("type"),j=this._diDashboard.getWidgets().filter(function(a){return"time-series"===a.get("type")})[0],k=this._getTimeseriesDefinition(),l=!!k&&"time_date__t"!==k.get("title"),m=this._getLayer(a);"animation"!==i&&"animation"===h&&this._lastType!==i&&(j&&this._removeTimeseries(),l&&b.call(this,k,m,d.extend({animated:!1},e,{attribute:g})),this._lastType=i,this._lastTSAnimateChange=""),"animation"!==i||this._lastTSAnimateChange===c&&"animation"===this._lastType||(j&&this._removeTimeseries(),("torque"===m.get("type")||"torque"===a.get("type")||l)&&b.call(this,k,m,d.extend({animated:!0},e,{attribute:g})),this._lastType=i,this._lastTSAnimateChange=c)}}},u.prototype._removeTimeseries=function(){this._widgetDefinitionsCollection.models.forEach(function(a){"time-series"===a.get("type")&&(a.set({avoidNotification:!0},{silent:!0}),a.destroy())})},u.prototype._getTimeseriesDefinition=function(){return this._widgetDefinitionsCollection.where({type:"time-series"})[0]},u.prototype._createTimeseries=function(a,b,c){this._removeTimeseries();var d=b&&b.attribute||"",e=b&&b.animated;if(d){var f={type:"time-series",layer_id:a.get("id"),source:{id:a.get("source")},options:{column:d,title:c||"time_date__t",bins:256,animated:e},style:{widget_style:o.getDefaultWidgetStyle("time-series")}};this._widgetDefinitionsCollection.create(f,{wait:!0})}},u.prototype._onLayerDefinitionRemoved=function(a){if(!a.isNew()){var b=this._getLayer(a);b&&b.remove()}},u.prototype._onLayerDefinitionMoved=function(a,b,c){this.visMap().moveCartoDBLayer(b,c)};var x={cartodb:"createCartoDBLayer",gmapsbase:"createGMapsBaseLayer",plain:"createPlainLayer",tiled:"createTileLayer",torque:"createTorqueLayer",wms:"createWMSLayer"};u.prototype._createLayer=function(a,b){b=b||{};var c=JSON.parse(JSON.stringify(a.attributes));c=this._adaptAttrsToCDBjs(a.get("type"),c);var e=this._legendsDefinitionCollection.findByLayerDefModel(a);e.length>0&&(c.legends=d.map(e,function(a){return a.toJSON()}));var i=x[c.type.toLowerCase()];if(!i)throw new Error("no create method name found for type "+c.type);if(c.source){var j=this._analysisDefinitionNodesCollection.get(c.source);this._analyseDefinitionNode(j)}var k=this.visMap(),l=this._layerDefinitionsCollection.indexOf(a);k[i](c,d.extend({at:l},b)),f(a,k),g(a,k),h.track(a),this._linkLayerErrors(a)},u.prototype._linkLayerErrors=function(a){var b=this._getLayer(a);b&&(b.get("error")&&this._setLayerError(a,b.get("error")),b.on("change:error",function(b,c){this._setLayerError(a,c)},this))},u.prototype._setLayerError=function(a,b){var c=q.getNotification(a.id),d=a.getName()+": "+(b&&b.message);if(!b)return a.unset("error"),void(c&&q.removeNotification(c));var e=l.extractError(d);if(c?c.update({status:e.type,info:e.message}):q.addNotification({id:a.id,status:e.type,closable:!0,button:!1,info:e.message}),"turbo-carto"===b.type){var f;try{f=b.context.source.start.line}catch(a){}a.set("error",{type:b.type,line:f,message:b.message})}else e&&a.set("error",{type:e.type,message:e.message})},u.prototype._onOverlayDefinitionAdded=function(a){this._vis().overlaysCollection.add(a.toJSON())},u.prototype._onOverlayDefinitionRemoved=function(a){var b=this._vis().overlaysCollection,c=b.findWhere({type:a.get("type")});c&&b.remove(c)},u.prototype._onMinMaxZoomChanged=function(){var a=this.visMap().get("zoom"),b=this._mapDefinitionModel.get("maxZoom"),c=this._mapDefinitionModel.get("minZoom");this.visMap().set({minZoom:c,maxZoom:b,zoom:Math.min(a,b)})},u.prototype._saveStateDefinition=function(){var a=this._diDashboard.getState();this._stateDefinitionModel.updateState(a),this._getVisMetadata()},u.prototype._onScrollWheelChanged=function(){var a=this._mapDefinitionModel.get("scrollwheel"),b=a?"enableScrollWheel":"disableScrollWheel",c=this.visMap();c&&c[b]&&c[b]()},u.prototype._onLegendsChanged=function(){var a=this._mapDefinitionModel.get("legends");this._vis().settings.set("showLegends",a)},u.prototype._onLayerSelectorChanged=function(){var a=this._mapDefinitionModel.get("layer_selector");this._vis().settings.set("showLayerSelector",a)},u.prototype._onEditorSettingsChanged=function(){var a=this._editorModel.get("settingsView");this._vis().settings.set("layerSelectorEnabled",a)},u.prototype._getLayer=function(a){return this.visMap().getLayerById(a.id)},u.prototype._getLayers=function(a){return this.visMap().layers},u.prototype.visMap=function(){return this._vis().map},u.prototype._analysis=function(){return this._vis().analysis},u.prototype._vis=function(){return this._diDashboard.getMap()},u.prototype._invalidateSize=function(){this._vis().invalidateSize()},u.prototype._invalidateMap=function(){this._vis().reload()},u.prototype._onBoundsSet=function(a){this._diDashboard._dashboard.vis.map.setBounds(a)},b.exports=u},{"./components/notifier/notifier":475,"./components/onboardings/analysis/analysis-launcher":493,"./data/basemap-providers-and-categories":614,"./data/feature-definition-model":626,"./data/layer-types-and-kinds":637,"./data/widget-definition-model":680,"./deep-insights-integration/legend-manager":685,"./deep-insights-integration/link-layer-infowindow":686,"./deep-insights-integration/link-layer-tooltip":687,"./editor/layers/analysis-views/analysis-notifications":724,"./editor/layers/notification-error-message-handler":992,"./editor/widgets/widgets-service":1085,"./helpers/styles-without-autostyle":1100,"./vis-notifications":1121,"./widgets-notifications":1122,jquery:"jquery",underscore:"underscore"}],690:[function(a,b,c){var d=window.ACTIVE_LOCALE;"en"!==d&&a("moment/locale/"+d);var e=a("../../locale/index"),f=a("node-polyglot"),g=new f({locale:d,phrases:e[d]});window._t=g.t.bind(g);var h=a("jquery"),i=a("underscore"),j=a("backbone"),k=a("cartodb-deep-insights.js"),l=a("./data/config-model"),m=a("./editor/editor-map-view"),n=a("./data/map-definition-model"),o=a("./data/analysis-definition-nodes-collection"),p=a("./data/analysis-definitions-collection"),q=a("./data/layer-definitions-collection"),r=a("./data/widget-definitions-collection"),s=a("./data/vis-definition-model"),t=a("./components/tab-pane/create-editor-menu-tab-pane"),u=a("./editor/editor-pane.tpl"),v=a("./editor/editor-pane-icon.tpl"),w=a("./components/modals/modals-service-model"),x=a("./editor/layers/layer-content-views/analyses/analyses-service.js"),y=a("./components/onboardings/onboardings-service-model"),z=a("./components/onboardings/builder/launcher"),A=a("./components/view-factory"),B=a("./data/user-model"),C=a("./data/user-notifications"),D=a("./data/editor-model"),E=a("./data/user-actions"),F=a("./components/background-importer/background-importer"),G=a("./data/editor-background-polling-model"),H=a("./editor/style/style-manager"),I=a("./deep-insights-integrations"),J=a("./deep-insights-integration/edit-feature-overlay"),K=a("./components/notifier/notifier"),L=a("./components/metrics/metrics-tracker"),M=a("./editor/feedback/feedback-button-view"),N=a("./data/map-settings"),O=a("./editor/editor-settings-view"),P=a("./data/overlays-definition-collection"),Q=a("./data/mapcaps-collection"),R=a("./components/modals/publish/privacy-collection"),S=a("./components/modals/publish/create-privacy-options"),T=a("./data/users-group-fetcher"),U=a("./data/state-definition-model"),V=a("./data/legends/legend-definitions-collection"),W=a("./data/legends/legends-state"),X=a("./editor/layers/layer-content-views/legend/legend-factory"),Y=a("./components/modals/editor-visualization-warning/editor-visualization-warning-view"),Z=a("./map-mode-model"),$=a("./components/onboardings/builder-activated/builder-activated-notification-view"),_=a("./node-geometry-tracker"),aa=a("./editor/widgets/widgets-service"),ba=a("./editor/layers/layer-content-views/analyses/analyses-quota/analyses-quota-info"),ca=window.vizJSON,da=window.stateJSON,ea=window.userData,fa=window.frontendConfig,ga=window.visualizationData,ha=window.layersData,ia=window.analysesData,ja=window.builderNotifications,ka=window.dashboardNotifications,la=window.mapcapsData,ma=window.overlaysData,na=window.basemaps,oa=new l(i.defaults({base_url:ea.base_url,api_key:ea.api_key},fa));ba.get(oa).fetch();var pa=new C(ja,{key:"builder",configModel:oa}),qa=new B(ea,{configModel:oa}),ra=new D,sa=new s(ga,{configModel:oa}),ta=new w,ua=new y;ua.editorModel=ra,T.track({userModel:qa,configModel:oa,acl:sa.getPermissionModel().acl});var va=new U({json:da},{visDefinitionModel:sa}),wa=ga.map_id,xa=new o(null,{userModel:qa,configModel:oa,relatedTableData:ga.related_tables}),ya=new q(null,{configModel:oa,userModel:qa,analysisDefinitionNodesCollection:xa,mapId:wa,stateDefinitionModel:va}),za=new p(ia,{configModel:oa,analysisDefinitionNodesCollection:xa,layerDefinitionsCollection:ya,vizId:sa.id});ya.resetByLayersData(ha),_.track({analysisDefinitionsCollection:za,analysisDefinitionNodesCollection:xa,layerDefinitionsCollection:ya});var Aa=new r(null,{configModel:oa,mapId:wa,layerDefinitionsCollection:ya});ca.widgets.forEach(function(a){Aa.add(a)});var Ba=new V(null,{configModel:oa,layerDefinitionsCollection:ya,vizId:sa.id});Ba.resetByData(ca),X.init(Ba),W.init(ya,Ba),K.init({editorModel:ra,visDefinitionModel:sa}),L.init({userId:qa.get("id"),visId:sa.get("id"),configModel:oa}),z.init({onboardings:ua,userModel:qa,editorModel:ra,onboardingNotification:pa}),x.init({onboardings:ua,layerDefinitionsCollection:ya,modals:ta,userModel:qa,configModel:oa});var Ca=E({userModel:qa,analysisDefinitionsCollection:za,analysisDefinitionNodesCollection:xa,layerDefinitionsCollection:ya,widgetDefinitionsCollection:Aa}),Da=S(sa,qa),Ea=new R(Da),Fa=new Q(la,{visDefinitionModel:sa}),Ga=new G({importsPolling:!1},{configModel:oa,userModel:qa,userActions:Ca});F.init({pollingModel:Ga,createVis:!1,userModel:qa,configModel:oa,modals:ta});var Ha=new n(i.extend(ca,{id:ga.map_id}),{parse:!0,configModel:oa,userModel:qa,layerDefinitionsCollection:ya}),Ia=new P(ma,{configModel:oa,visId:sa.id}),Ja=new Z;aa.init({widgetDefinitionsCollection:Aa,analysisDefinitionNodesCollection:xa,layerDefinitionsCollection:ya,userActions:Ca,modals:ta});var Ka=function(){if(z.launch(),!oa.get("cartodb_com_hosted")&&qa.get("actions").builder_enabled&&qa.get("show_builder_activated_message")&&i.isEmpty(ka)){var a=new C(ka,{key:"dashboard",configModel:oa}),b=new $({builderActivatedNotification:a});h(".js-editor").addClass("Editor--topBar"),b.bind("clean",function(){h(".js-editor").removeClass("Editor--topBar")},this)}k.createDashboard("#dashboard",ca,{apiKey:oa.get("api_key"),no_cdn:!1,cartodb_logo:!1,renderMenu:!1,show_empty_infowindow_fields:!0,state:da,interactiveFeatures:!0,layerSelectorEnabled:!1},function(a,b){a&&console.error("Dashboard has some errors:\n",a);var c=b.getMap(),d=b.getView();d.listenTo(ra,"change:edition",function(a){d.$el.toggleClass("is-dark",a.isEditing())});var e=new H(ya,c.map,oa),f=new J({map:c.map,mapModeModel:Ja,modals:ta});f.hide(),c.addCustomOverlay(f);var g=new I({onboardings:ua,userModel:qa,deepInsightsDashboard:b,analysisDefinitionsCollection:za,analysisDefinitionNodesCollection:xa,layerDefinitionsCollection:ya,legendDefinitionsCollection:Ba,widgetDefinitionsCollection:Aa,overlayDefinitionsCollection:Ia,overlaysCollection:Ia,visDefinitionModel:sa,mapDefinitionModel:Ha,stateDefinitionModel:va,mapModeModel:Ja,configModel:oa,editorModel:ra,editFeatureOverlay:f});window.deepInsightsIntegrations=g,window.styleManager=e,window.dashboard=b,window.vis=c})};2===sa.get("version")&&ta?(sa.bind("change:version",function(){Fa.fetch(),Ka()},this),ta.create(function(a){return new Y({modalModel:a,visDefinitionModel:sa})},!0)):Ka();var La=t([{icon:"pencil",selected:!0,createContentView:function(){return ra.set({settingsView:!1}),new m({basemaps:na,userActions:Ca,configModel:oa,userModel:qa,editorModel:ra,pollingModel:Ga,mapDefinitionModel:Ha,onboardings:ua,modals:ta,visDefinitionModel:sa,layerDefinitionsCollection:ya,analysisDefinitionNodesCollection:xa,widgetDefinitionsCollection:Aa,mapcapsCollection:Fa,privacyCollection:Ea,legendDefinitionsCollection:Ba,mapModeModel:Ja,stateDefinitionModel:va,onboardingNotification:pa})}},{icon:"settings",createContentView:function(){return ra.set({settingsView:!0}),new O({mapDefinitionModel:Ha,overlaysCollection:Ia,mapcapsCollection:Fa,visDefinitionModel:sa,privacyCollection:Ea,configModel:oa,userModel:qa,modals:ta,editorModel:ra,settingsCollection:new j.Collection(N(Ia,Ha,qa)),stateDefinitionModel:va})}}],{tabPaneOptions:{className:"Editor-wrapper",template:u,url:qa.get("base_url"),avatar_url:qa.get("avatar_url"),tabPaneItemOptions:{tagName:"li",className:"EditorMenu-navigationItem"}},tabPaneItemIconOptions:{tagName:"button",template:v,className:"EditorMenu-navigationLink"}});if(h(".js-editor").prepend(La.render().$el),La.listenTo(ra,"change:edition",function(a){La.$(".Editor-panelWrapper").toggleClass("is-larger",a.isEditing())}),La.add_related_model(ra),!oa.get("cartodb_com_hosted")){var Ma=new M({modals:ta});h(".js-editorMenu").append(Ma.render().el)}document.title=sa.get("name")+" | CARTO",window.__backboneAgent&&window.__backboneAgent.handleBackbone(j),window.configModel=oa,window.modals=ta,window.onboardings=ua,window.userActions=Ca,window.userModel=qa,window.viewFactory=A,window.visDefinitionModel=sa,window.layerDefinitionsCollection=ya,window.widgetDefinitionsCollection=Aa,window.analysisDefinitionsCollection=za,window.analysisDefinitionNodesCollection=xa,window.legendDefinitionsCollection=Ba,window.editorModel=ra,window.mapDefModel=Ha,window.overlaysCollection=Ia,window.mapcapsCollection=Fa,window.stateDefModel=va},{"../../locale/index":1125,"./components/background-importer/background-importer":5,"./components/metrics/metrics-tracker":233,"./components/modals/editor-visualization-warning/editor-visualization-warning-view":406,"./components/modals/modals-service-model":421,"./components/modals/publish/create-privacy-options":422,"./components/modals/publish/privacy-collection":423,"./components/notifier/notifier":475,"./components/onboardings/builder-activated/builder-activated-notification-view":496,"./components/onboardings/builder/launcher":500,"./components/onboardings/onboardings-service-model":514,"./components/tab-pane/create-editor-menu-tab-pane":534,"./components/view-factory":594,"./data/analysis-definition-nodes-collection":603,"./data/analysis-definitions-collection":604,"./data/config-model":618,"./data/editor-background-polling-model":623,"./data/editor-model":624,"./data/layer-definitions-collection":635,"./data/legends/legend-definitions-collection":644,"./data/legends/legends-state":646,"./data/map-definition-model":647,"./data/map-settings":648,"./data/mapcaps-collection":649,"./data/overlays-definition-collection":652,"./data/state-definition-model":660,"./data/user-actions":669,"./data/user-model":671,"./data/user-notifications":672,"./data/users-group-fetcher":674,"./data/vis-definition-model":675,"./data/widget-definitions-collection":681,"./deep-insights-integration/edit-feature-overlay":683,"./deep-insights-integrations":689,"./editor/editor-map-view":702,"./editor/editor-pane-icon.tpl":703,"./editor/editor-pane.tpl":705,"./editor/editor-settings-view":707,"./editor/feedback/feedback-button-view":719,"./editor/layers/layer-content-views/analyses/analyses-quota/analyses-quota-info":796,"./editor/layers/layer-content-views/analyses/analyses-service.js":800,"./editor/layers/layer-content-views/legend/legend-factory":961,"./editor/style/style-manager":1051,"./editor/widgets/widgets-service":1085,"./map-mode-model":1103,"./node-geometry-tracker":1117,backbone:"backbone","cartodb-deep-insights.js":"cartodb-deep-insights.js",jquery:"jquery","node-polyglot":"node-polyglot",underscore:"underscore"}],691:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="24px" viewbox="459 348 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Export-dataset" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(459.000000, 348.000000)">\n          <path d="M1,1 L11,1 L11,5.5 C11,5.776 11.224,6 11.5,6 L16,6 L16,9.5 L17,9.5 L17,5.502 C17,5.502 17,5.502 17,5.501 C17,5.5 17,5.501 17,5.5 C17,5.447 16.985,5.398 16.97,5.35 C16.966,5.337 16.967,5.323 16.962,5.311 C16.936,5.247 16.896,5.19 16.847,5.142 L11.854,0.147 C11.808,0.101 11.753,0.064 11.692,0.039 C11.632,0.014 11.567,0 11.5,0 L0.5,0 C0.224,0 0,0.224 0,0.5 L0,21.5 C0,21.776 0.224,22 0.5,22 L10.5,22 L10.5,21 L1,21 L1,1 L1,1 Z M12,1.708 L15.291,5 L12,5 L12,1.708 L12,1.708 Z" id="Shape" fill="#2E3C43"/>\n          <path d="M17.5,11 C13.916,11 11,13.916 11,17.5 C11,21.084 13.916,24 17.5,24 C21.084,24 24,21.084 24,17.5 C24,13.916 21.084,11 17.5,11 L17.5,11 Z M17.5,23 C14.467,23 12,20.533 12,17.5 C12,14.467 14.467,12 17.5,12 C20.533,12 23,14.467 23,17.5 C23,20.533 20.533,23 17.5,23 L17.5,23 Z" id="Shape" fill="#2E3C43"/>\n          <path d="M17.858,14.425 C17.767,14.331 17.641,14.272 17.5,14.272 C17.359,14.272 17.232,14.331 17.142,14.425 L14.965,16.602 C14.77,16.797 14.77,17.114 14.965,17.309 C15.16,17.504 15.477,17.504 15.672,17.309 L17,15.981 L17,20.226 C17,20.502 17.224,20.726 17.5,20.726 C17.776,20.726 18,20.502 18,20.226 L18,15.981 L19.328,17.309 C19.426,17.407 19.554,17.455 19.682,17.455 C19.81,17.455 19.938,17.406 20.036,17.309 C20.231,17.114 20.231,16.797 20.036,16.602 L17.858,14.425 L17.858,14.425 Z" id="Shape" fill="#2E3C43" transform="translate(17.500500, 17.499000) scale(1, -1) translate(-17.500500, -17.499000) "/>\n        </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">'+(null==(__t=_t("editor.maps.export.confirmation.title",{
name:name}))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("editor.maps.export.confirmation.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n               '+(null==(__t=_t("editor.maps.export.confirmation.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("editor.maps.export.confirmation.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],692:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Dialog-header">\n  <div class="Dialog-headerIcon Dialog-headerIcon--neutral">\n    <i class="CDB-IconFont CDB-IconFont-download"></i>\n  </div>\n  <h2 class="CDB-Text CDB-Size-large u-bSpace">\n    '+(null==(__t=_t("editor.maps.export.download.title"))?"":_.escape(__t))+'\n  </h2>\n  <h3 class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=_t("editor.maps.export.download.tip"))?"":_.escape(__t))+"</br>\n    "+(null==(__t=_t("editor.maps.export.download.desc"))?"":_.escape(__t))+'\n  </h3>\n</div>\n<div class="Dialog-footer--simple u-inner">\n  <button class="CDB-Button CDB-Button--primary u-tSpace--m js-download">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n      '+(null==(__t=_t("editor.maps.export.download.confirm"))?"":_.escape(__t))+"\n    </span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],693:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("underscore"),g=a("../../../../components/loading/render-loading.js"),h=a("../../../components/modals/export-map/export-map-confirmation.tpl"),i=a("../../../components/modals/export-map/export-map-download.tpl"),j=a("../../../../components/error/error-view.js"),k=13,l=["renderOpts","modalModel","exportMapModel"];b.exports=d.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel","click .js-download":"_download"},initialize:function(a){f.each(l,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._onKeyDown=this._onKeyDown.bind(this),this._initBinds()},render:function(){this.clearSubViews();var a=this._exportMapModel.get("state");"complete"===a?this._renderCompleteView():"pending"===a||"exporting"===a||"uploading"===a?this._renderLoadingView(a):"failure"===a?this._renderFailureView():this._renderConfirmationView()},_renderCompleteView:function(){var a=window.open(this._exportMapModel.get("url"));null==a?this.$el.html(i()):(a.focus(),this._modalModel.destroy())},_renderLoadingView:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1)+" ...";this.$el.html(g({title:b}))},_renderFailureView:function(){var a=new j({title:_t("editor.maps.export.error.title"),desc:_t("editor.maps.export.error.desc")});this.$el.html(a.render().el)},_renderConfirmationView:function(){this.$el.html(h({name:this._renderOpts.name}))},_initBinds:function(){e(document).bind("keydown",this._onKeyDown),this._exportMapModel.bind("change:state",function(){this.render()},this)},_disableBinds:function(){e(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function(a){var b=a.which;b===k&&this._onConfirm()},_onConfirm:function(){this._exportMapModel.requestExport()},_onCancel:function(){this._exportMapModel.cancelExport(),this._modalModel.destroy()},_download:function(){window.open(this._exportMapModel.get("url")),window.focus(),this._modalModel.destroy()},clean:function(){this._disableBinds(),d.prototype.clean.apply(this)}})},{"../../../../components/error/error-view.js":67,"../../../../components/loading/render-loading.js":230,"../../../components/modals/export-map/export-map-confirmation.tpl":691,"../../../components/modals/export-map/export-map-download.tpl":692,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],694:[function(a,b,c){var d=a("backbone/core-view"),e=a("./overlay.tpl");b.exports=d.extend({initialize:function(a){if(!a.overlayModel)throw new Error("overlayModel is required");this.overlayModel=a.overlayModel,this._initBinds()},render:function(){return this.$el.empty(),this.$el.append(e({visible:this.overlayModel.get("visible")?"":"is-hidden"})),this},_initBinds:function(){this.listenTo(this.overlayModel,"change:visible",this.render),this.add_related_model(this.overlayModel)}})},{"./overlay.tpl":695,"backbone/core-view":1127}],695:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Disable-overlay '+(null==(__t=visible)?"":_.escape(__t))+'"></div>';return __p}},{underscore:"underscore"}],696:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n     '+(null==(__t=_t("editor.maps.delete.title",{name:name}))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("editor.maps.delete.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("editor.maps.delete.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("editor.maps.delete.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],697:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./editor-header.tpl"),g=a("moment"),h=a("../components/modals/confirmation/modal-confirmation-view"),i=a("../components/modals/map-metadata/map-metadata-view"),j=a("./delete-map-confirmation.tpl"),k=a("./components/modals/export-map/modal-export-map-view"),l=a("../data/export-map-definition-model.js"),m=a("./map-operations/remove-map"),n=a("./map-operations/rename-map"),o=a("../components/inline-editor/inline-editor-view"),p=a("./inline-editor.tpl"),q=a("../components/modals/creation/modal-creation-view"),r=a("../data/vis-definition-model"),s=a("../helpers/error-parser"),t=a("../components/modals/publish/share-with-view"),u=a("../components/context-menu-factory-view");b.exports=d.extend({events:{"click .js-privacy":"_onClickPrivacy"},initialize:function(a){if(!a.editorModel)throw new Error("editorModel is required");if(!a.modals)throw new Error("modals is required");if(!a.visDefinitionModel)throw new Error("visDefinitionModel is required");if(!a.privacyCollection)throw new Error("privacyCollection is required");if(!a.onClickPrivacy)throw new Error("onClickPrivacy is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");this._userModel=a.userModel,this._editorModel=a.editorModel,this._configModel=a.configModel,this._modals=a.modals,this._visDefinitionModel=a.visDefinitionModel,this._title=this._visDefinitionModel.get("name"),this._privacyCollection=a.privacyCollection,this._mapcapsCollection=a.mapcapsCollection,e.bind(this._changeStyle,this),this._bindEvents()},render:function(){var a=this._privacyCollection.searchByPrivacy(this._visDefinitionModel.get("privacy")),b=this._mapcapsCollection.length>0?_t("editor.published",{when:g(this._mapcapsCollection.first().get("created_at")).fromNow()}):_t("editor.unpublished");return this.$el.html(f({title:this._title,privacy:a.get("privacy"),cssClass:a.get("cssClass"),avatar:this._userModel.get("avatar_url"),isSimple:!this._userModel.isInsideOrg(),published:b})),this._initViews(),this},_initViews:function(){var a=this;this._inlineEditor=new o({template:p,renderOptions:{name:a._visDefinitionModel.get("name")},onEdit:a._renameMap.bind(a)}),this.$(".js-header").append(this._inlineEditor.render().el),this.addView(this._inlineEditor);var b=new t({visDefinitionModel:this._visDefinitionModel,userModel:this._userModel,action:this._onClickPrivacy.bind(this),separationClass:"u-rSpace--m"});this.$(".js-share-users").append(b.render().el),this.addView(b);var c=[{label:_t("editor.maps.options.rename"),val:"rename-map",action:this._onRenameMap.bind(this)},{label:_t("editor.maps.options.duplicate"),val:"duplicate-map",action:this._duplicateMap.bind(this)},{label:_t("editor.maps.options.edit-metadata"),val:"metadata-map",action:this._editMetadata.bind(this)},{label:_t("editor.maps.options.export-map"),val:"export-map",action:this._exportMap.bind(this)},{label:_t("editor.maps.options.export-image"),val:"export-image",action:this._exportImage.bind(this)},{label:_t("editor.maps.options.remove"),val:"delete-map",destructive:!0,action:this._confirmDeleteLayer.bind(this)}];this._contextMenuFactory=new u({menuItems:c}),this.$(".js-context-menu").append(this._contextMenuFactory.render().el),this.addView(this._contextMenuFactory)},_bindEvents:function(){this.listenTo(this._visDefinitionModel,"change:privacy change:name",this.render),this.add_related_model(this._visDefinitionModel),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel),this._mapcapsCollection.on("add reset",this.render,this),this._mapcapsCollection.on("change:status",this.render,this),this.add_related_model(this._mapcapsCollection)},_renameMap:function(){var a=this._inlineEditor.getValue();""!==a&&a!==this._visDefinitionModel.get("name")&&(this._onRenameSuccess(a),n({newName:a,visDefinitionModel:this._visDefinitionModel,onError:this._onRenameError.bind(this)}))},_onRenameMap:function(){this._inlineEditor.edit()},_duplicateMap:function(){var a=this,b=this._visDefinitionModel.get("name");this._modals.create(function(c){return new q({modalModel:c,loadingTitle:_t("editor.maps.duplicate.loading",{name:b}),errorTitle:_t("editor.maps.duplicate.error",{name:b}),runAction:function(c){var d=new r({name:b},{configModel:a._configModel});d.save({source_visualization_id:a._visDefinitionModel.get("id")},{success:function(a){window.location=a.builderURL()},error:function(a,b){c.error&&c.error(s(b))}})}})})},_confirmDeleteLayer:function(){var a=this,b=this._visDefinitionModel.get("name");this._modals.create(function(c){return new h({modalModel:c,template:j,loadingTitle:_t("editor.maps.delete.loading",{name:b}),renderOpts:{name:b},runAction:function(){m({onSuccess:a._onSuccessDestroyMap.bind(a,c),onError:a._onErrorDestroyMap.bind(a,c),visDefinitionModel:a._visDefinitionModel})}})})},_exportMap:function(){var a=this._visDefinitionModel.get("name"),b=this._visDefinitionModel.get("id"),c=new l({visualization_id:b},{configModel:this._configModel});this._modals.create(function(b){return new k({modalModel:b,exportMapModel:c,renderOpts:{name:a}})})},_exportImage:function(){this.trigger("export-image",this)},_editMetadata:function(){var a=this;this._modals.create(function(b){return new i({modalModel:b,visDefinitionModel:a._visDefinitionModel})})},_onSuccessDestroyMap:function(a){this.options.onRemoveMap&&this.options.onRemoveMap()},_onErrorDestroyMap:function(a){a.destroy()},_onRenameSuccess:function(a){this.$(".js-title").text(a).show(),this._inlineEditor.hide()},_onRenameError:function(a){this.$(".js-title").text(a).show(),this._inlineEditor.hide()},_changeStyle:function(a){this._getTitle().toggleClass("is-dark",a.isEditing())},_getTitle:function(){return this.$(".Editor-HeaderInfo")},_onClickPrivacy:function(){this.options.onClickPrivacy&&this.options.onClickPrivacy()}})},{"../components/context-menu-factory-view":37,"../components/inline-editor/inline-editor-view":223,"../components/modals/confirmation/modal-confirmation-view":404,"../components/modals/creation/modal-creation-view":405,"../components/modals/map-metadata/map-metadata-view":415,"../components/modals/publish/share-with-view":439,"../data/export-map-definition-model.js":625,"../data/vis-definition-model":675,"../helpers/error-parser":1090,"./components/modals/export-map/modal-export-map-view":693,"./delete-map-confirmation.tpl":696,"./editor-header.tpl":698,"./inline-editor.tpl":722,"./map-operations/remove-map":1003,"./map-operations/rename-map":1004,"backbone/core-view":1127,moment:"moment",underscore:"underscore"}],698:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfoEditor">\n  <div class="Editor-HeaderInfo-inner Editor-HeaderInfo-inner--wide">\n    <div class="Editor-HeaderInfo-title u-bSpace--m js-context-menu">\n      <div class="Editor-HeaderInfo-titleText u-bSpace js-header">\n      </div>\n    </div>\n    <div class="u-bSpace--xl u-flex u-alignCenter">\n      <button class="u-rSpace--m u-actionTextColor js-privacy">\n        <i class="Tag Tag-fill Tag-fill--'+(null==(__t=cssClass)?"":_.escape(__t))+' CDB-Text CDB-Size-small u-upperCase">'+(null==(__t=privacy)?"":_.escape(__t))+"</i>\n      </button>\n      ",isSimple||(__p+='\n      <div class="js-share-users"></div>\n      '),__p+='\n      <p class="Editor-HeaderInfo-publishDate u-ellipsis CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=published)?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],699:[function(a,b,c){b.exports=[{keywords:"buffer-size",type:"Map"},{keywords:"marker-fill marker-width marker-fill-opacity marker-opacity marker-line-color marker-line-width marker-line-opacity marker-comp-op marker-allow-overlap marker-file marker-type marker-height marker-width marker-transform marker-placement marker-ignore-placement marker-spacing marker-avoid-edges point-file point-opacity point-comp-op point-allow-overlap point-placement point-ignore-placement point-transform",type:"Points"},{keywords:"line-color line-width line-opacity line-comp-op line-pattern-file line-join line-cap line-dasharray line-dash-offset line-offset line-simplify line-simplify-algorithm line-smooth line-clip",type:"Lines"},{keywords:"polygon-fill polygon-opacity polygon-comp-op polygon-pattern-file polygon-pattern-alignment polygon-pattern-opacity polygon-smooth polygon-simplify polygon-simplify-algorithm polygon-gamma polygon-gamma-method polygon-geometry-transform polygon-clip",type:"Polygons"},{keywords:"text-name text-face-name text-size text-fill text-opacity text-comp-op text-halo-radius text-halo-fill text-halo-rasterizer text-allow-overlap text-transform text-placement text-placement-type text-dx text-dy text-wrap-width text-wrap-before text-character-spacing text-line-spacing text-min-distance text-avoid-edges text-orientation text-vertical-alignment",type:"Text"},{keywords:"building-fill building-fill-opacity building-height",type:"Building"},{keywords:"shield-name shield-face-name shield-size shield-file shield-fill shield-opacity shield-text-opacity shield-allow-overlap shield-placements shield-placement-type shield-dy shield-dx shield-text-dx shield-text-dy shield-min-distance shield-avoid-edges",type:"Shield"},{keywords:"image-filters comp-op opacity",type:""}]},{}],700:[function(a,b,c){var d=a("underscore"),e=a("../../helpers/table-name-utils"),f={},g=["querySchemaModel","layerDefinitionModel","tokens"],h={tableName:!0,columnsName:!0,keywords:!0};b.exports={init:function(a){if(!a)throw new Error("options are required for hints");this.options=d.defaults(d.pick(a,["tableName","columnsName","keywords"]),h),d.each(g,function(b){this["_"+b]=a[b]},this)},hints:function(){return this.hints},reset:function(){return this.hints=d.union(this._getTableName(),this._getColumns(),this._getKeywords()),this},_getKeywords:function(){return this.options.keywords?this._tokens&&this._memo(this._tokens):[]},_getColumns:function(){if(!this.options.columnsName)return[];var a=this._querySchemaModel.columnsCollection;return a.map(function(a){var b=a.get("name");return{text:b,type:"Column_name"}})},_getTableName:function(){if(!this.options.tableName)return[];var a=this._layerDefinitionModel.getTableName();return a=e.getUnqualifiedName(a),[{text:a,type:"Table_name"}]},_memo:function(a,b){return a in f?f[a]:f[a]=this._make(a,b)},_make:function(a,b){return d.chain(a).map(function(a){return a.keywords.split(" ").map(function(b){return{text:b,type:a.type}})}).flatten().value()}}},{"../../helpers/table-name-utils":1101,underscore:"underscore"}],701:[function(a,b,c){b.exports=[{keywords:"alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit",type:"Sql"},{keywords:"ST_GeometryType ST_polygon ST_multipolygon ST_multilinestring ST_linestring ST_multipoint ST_point",type:"Postgis"}]},{}],702:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../helpers/required-opts"),g=a("./editor-view"),h=a("./layers/layer-content-views/analyses/analyses-service"),i=a("../components/stack-layout/stack-layout-view"),j=a("./layers/basemap-content-view"),k=a("./layers/layer-content-view"),l=a("./layers/edit-feature-content-view"),m=a("./widgets/widgets-form/widgets-form-content-view"),n=a("../components/notifier/notifier"),o=a("./widgets/widgets-service"),p=["userActions","basemaps","visDefinitionModel","layerDefinitionsCollection","analysisDefinitionNodesCollection","legendDefinitionsCollection","widgetDefinitionsCollection","mapcapsCollection","privacyCollection","modals","onboardings","userModel","configModel","editorModel","pollingModel","mapDefinitionModel","mapModeModel","stateDefinitionModel","onboardingNotification"];b.exports=e.extend({className:"MapEditor Editor-panel",events:{"click .js-add-analysis":"_onAddAnalysisClicked","click .js-georeference":"_onGeoreferenceClicked"},initialize:function(a){f(a,p,this),this._initBinds()},render:function(){var a=this,b=new d.Collection([{createStackView:function(b,c){var d=c[0]||"layers";return new g({className:"Editor-content",modals:a._modals,userModel:a._userModel,userActions:a._userActions,configModel:a._configModel,editorModel:a._editorModel,pollingModel:a._pollingModel,mapDefinitionModel:a._mapDefinitionModel,visDefinitionModel:a._visDefinitionModel,layerDefinitionsCollection:a._layerDefinitionsCollection,analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,widgetDefinitionsCollection:a._widgetDefinitionsCollection,mapcapsCollection:a._mapcapsCollection,privacyCollection:a._privacyCollection,mapStackLayoutModel:b,selectedTabItem:d,mapModeModel:a._mapModeModel,stateDefinitionModel:a._stateDefinitionModel})}},{createStackView:function(b,c){var d=c[1];switch(d){case"basemaps":return new j({className:"Editor-content",basemaps:a._basemaps,layerDefinitionsCollection:a._layerDefinitionsCollection,stackLayoutModel:b,customBaselayersCollection:a._userModel.layers,modals:a._modals,configModel:a._configModel});case"layer-content":var e=c[0],f=c[2],g=c[3];return new k({className:"Editor-content",userActions:a._userActions,userModel:a._userModel,layerDefinitionModel:e,mapDefinitionModel:a._mapDefinitionModel,widgetDefinitionsCollection:a._widgetDefinitionsCollection,layerDefinitionsCollection:a._layerDefinitionsCollection,analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,legendDefinitionsCollection:a._legendDefinitionsCollection,analysis:a._analysis,modals:a._modals,onboardings:a._onboardings,stackLayoutModel:b,analysisPayload:g,configModel:a._configModel,editorModel:a._editorModel,mapModeModel:a._mapModeModel,stateDefinitionModel:a._stateDefinitionModel,onboardingNotification:a._onboardingNotification,visDefinitionModel:a._visDefinitionModel,selectedTabItem:f});case"widget-content":var h=c[0],i=c[1];return new m({className:"Editor-content",modals:a._modals,userModel:a._userModel,configModel:a._configModel,userActions:a._userActions,widgetDefinitionModel:h,layerDefinitionsCollection:a._layerDefinitionsCollection,analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,stackLayoutPrevStep:i,stackLayoutModel:b});case"element-content":console.log(d+"view is not implemented yet");break;default:console.log(d+"view doesn't exist")}}},{createStackView:function(b,c){var e=c[0],f=c[1];return new l({layerDefinitionModel:e,configModel:a._configModel,stackLayoutModel:b,mapModeModel:a._mapModeModel,editorModel:a._editorModel,model:new d.Model({hasChanges:!1,isValidAttributes:!0,isValidGeometry:f}),modals:a._modals})}}]);this._stackLayoutView=new i({className:"Editor-content",collection:b}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView);var c=n.getView();return this.$el.append(c.render().el),this.addView(c),this._setServices(),this},_setServices:function(){h.setStackLayoutView(this._stackLayoutView),o.setStackLayoutBehaviour(this._stackLayoutView.model,{position:1,arguments:"widget-content"},{position:0,arguments:"widgets"})},_initBinds:function(){this._editorModel.on("change:edition",this._changeStyle,this),this.add_related_model(this._editorModel),this._mapModeModel.on("change:mode",this._onMapModeChanged,this),this.add_related_model(this._mapModeModel)},_onMapModeChanged:function(a){var b=this._stackLayoutView.model;if(a.isEditingFeatureMode()||a.isDrawingFeatureMode()){var c=a.getFeatureDefinition();b.goToStep(2,c.getLayerDefinition(),!c.isNew())}else b.goBack()},_changeStyle:function(){this.$el.toggleClass("is-dark",this._editorModel.isEditing())},_onAddAnalysisClicked:function(){h.addAnalysis()},_onGeoreferenceClicked:function(){h.addGeoreferenceAnalysis()}})},{"../components/notifier/notifier":475,"../components/stack-layout/stack-layout-view":533,"../helpers/required-opts":1097,"./editor-view":709,"./layers/basemap-content-view":733,"./layers/edit-feature-content-view":770,"./layers/layer-content-view":792,"./layers/layer-content-views/analyses/analyses-service":800,"./widgets/widgets-form/widgets-form-content-view":1078,"./widgets/widgets-service":1085,backbone:"backbone","backbone/core-view":1127}],703:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<i class="CDB-IconFont CDB-IconFont-'+(null==(__t=icon)?"":_.escape(__t))+' EditorMenu-navigationIcon"></i>\n';return __p}},{underscore:"underscore"}],704:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("backbone/core-view"),g=a("../components/tab-pane/create-text-labels-tab-pane"),h=a("../components/modals/add-widgets/add-widgets-view"),i=a("../components/modals/add-layer/add-layer-view"),j=a("../components/modals/add-layer/add-layer-model"),k=a("../components/stack-layout/stack-layout-view"),l=a("./editor-header.js"),m=a("./editor-tab-pane.tpl"),n=a("./widgets/widgets-view"),o=a("./layers/layers-view"),p=a("../components/scroll/scroll-view"),q=a("../components/view-options/panel-with-options-view"),r=a("./layers/share-button-view"),s=a("../components/modals/publish/publish-view"),t=a("../helpers/required-opts"),u=["userActions","modals","configModel","userModel","editorModel","pollingModel","analysisDefinitionNodesCollection","layerDefinitionsCollection","privacyCollection","widgetDefinitionsCollection","mapcapsCollection","visDefinitionModel","mapStackLayoutModel","stateDefinitionModel","selectedTabItem"];b.exports=f.extend({className:"Editor-content",events:{"click .js-add":"_addItem"},initialize:function(a){t(a,u,this),this._initModels(),this._initBinds()},render:function(){var a=this;this.clearSubViews(),this.$el.empty();var b=[{name:"layers",label:_t("editor.tab-pane.layers.title-label"),selected:"layers"===this._selectedTabItem,createContentView:function(){var b=new e.Collection([{createStackView:function(b,c){return new q({className:"Editor-content js-editorPanelContent",editorModel:a._editorModel,createContentView:function(){return new p({createContentView:function(){return new o({modals:a._modals,userModel:a._userModel,editorModel:a._editorModel,configModel:a._configModel,userActions:a._userActions,layerDefinitionsCollection:a._layerDefinitionsCollection,analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,stackLayoutModel:a._mapStackLayoutModel,stateDefinitionModel:a._stateDefinitionModel,widgetDefinitionsCollection:a._widgetDefinitionsCollection,visDefinitionModel:a._visDefinitionModel})}})},createActionView:function(){return new r({visDefinitionModel:a._visDefinitionModel,onClickAction:a._share.bind(a)})}})}}]);return new k({className:"Editor-content",collection:b})}},{name:"widgets",label:_t("editor.tab-pane.widgets.title-label"),selected:"widgets"===this._selectedTabItem,createContentView:function(){var b=new e.Collection([{createStackView:function(b,c){return new q({className:"Editor-content",editorModel:a._editorModel,createContentView:function(){return new p({createContentView:function(){return new n({userActions:a._userActions,modals:a._modals,layerDefinitionsCollection:a._layerDefinitionsCollection,widgetDefinitionsCollection:a._widgetDefinitionsCollection,stackLayoutModel:a._mapStackLayoutModel})}})},createActionView:function(){return new r({visDefinitionModel:a._visDefinitionModel,onClickAction:a._share.bind(a)})}})}}]);return new k({className:"Editor-content",collection:b})}}],c=new l({editorModel:a._editorModel,mapcapsCollection:a._mapcapsCollection,modals:a._modals,visDefinitionModel:a._visDefinitionModel,privacyCollection:a._privacyCollection,onClickPrivacy:a._share.bind(a),onRemoveMap:a._onRemoveMap.bind(a),configModel:a._configModel,userModel:a._userModel});c.bind("export-image",this._onExportImage,this),this.$el.append(c.render().$el),this.addView(c);var d={tabPaneOptions:{template:m,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};return this._mapTabPaneView=g(b,d),this._mapTabPaneView.collection.bind("change:selected",this._updateAddButtonState,this),this.$el.append(this._mapTabPaneView.render().$el),this.addView(this._mapTabPaneView),this._updateAddButtonState(),this},_initModels:function(){this._updatedModel=new e.Model({date:""})},_initBinds:function(){this.listenTo(this._widgetDefinitionsCollection,"reset remove add",this._updateAddButtonState),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.listenTo(this._layerDefinitionsCollection,"reset remove add",this._updateAddButtonState),this.listenTo(this._layerDefinitionsCollection,"add",function(){this._visDefinitionModel.fetch()})},_onExportImage:function(){this.trigger("export-image",this)},_onRemoveMap:function(){window.location=this._userModel.get("base_url")},_hideAddButton:function(){this.$(".js-add").addClass("is-hidden")},_showAddButton:function(){this.$(".js-add").removeClass("is-hidden")},_updateAddButtonState:function(){switch(this._hideAddButton(),this._mapTabPaneView.getSelectedTabPaneName()){case"widgets":this._widgetDefinitionsCollection.size()&&this._showAddButton();break;case"layers":this._layerDefinitionsCollection.size()&&this._showAddButton();break;case"elements":}},_addItem:function(){switch(this._mapTabPaneView.getSelectedTabPaneName()){case"layers":return this._addLayer();case"widgets":return this._addWidget()}},_addLayer:function(){var a=this,b=this._modals.create(function(b){var c=new j({},{userModel:a._userModel,userActions:a._userActions,configModel:a._configModel,pollingModel:a._pollingModel});return new i({modalModel:b,configModel:a._configModel,userModel:a._userModel,createModel:c,pollingModel:a._pollingModel})});b.show()},_addWidget:function(){var a=this;this._modals.create(function(b){return new h({modalModel:b,userModel:a._userModel,userActions:a._userActions,configModel:a._configModel,analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,layerDefinitionsCollection:a._layerDefinitionsCollection,widgetDefinitionsCollection:a._widgetDefinitionsCollection})})},_share:function(){var a=this;this._modals.create(function(b){return new s({mapcapsCollection:a._mapcapsCollection,modalModel:b,visDefinitionModel:a._visDefinitionModel,privacyCollection:a._privacyCollection,userModel:a._userModel,configModel:a._configModel})})},_changeStyle:function(a){this.$el.toggleClass("is-dark"),this._mapTabPaneView.changeStyleMenu(a)},_setUpdateFromCreation:function(){this._updatedModel.set({date:this._visDefinitionModel.get("created_at")})},_setUpdateFromMapcap:function(a){this._updatedModel.set({date:a[0].created_at})},_getMapcaps:function(){var a=this._setUpdateFromCreation.bind(this),b=this._setUpdateFromMapcap.bind(this),c=this._visDefinitionModel.mapcapsURL(),e={api_key:this._configModel.get("api_key")};d.get(c,e).done(function(c){c.length>0?b(c):a()}).fail(function(){a()})}})},{"../components/modals/add-layer/add-layer-model":297,"../components/modals/add-layer/add-layer-view":298,"../components/modals/add-widgets/add-widgets-view":371,"../components/modals/publish/publish-view":428,"../components/scroll/scroll-view":530,"../components/stack-layout/stack-layout-view":533,"../components/tab-pane/create-text-labels-tab-pane":537,"../components/view-options/panel-with-options-view":595,"../helpers/required-opts":1097,"./editor-header.js":697,"./editor-tab-pane.tpl":708,"./layers/layers-view":990,"./layers/share-button-view":998,"./widgets/widgets-view":1086,backbone:"backbone","backbone/core-view":1127,jquery:"jquery"}],705:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="EditorMenu js-editorMenu">\n  <a class="EditorMenu-logo" href="'+(null==(__t=url)?"":_.escape(__t))+'">\n    <svg width="32px" height="32px" viewBox="762 -58 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <g class="imago" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(762.000000, -58.000000)">\n        <circle class="Halo" fill="#FFFFFF" opacity="0.2" cx="16" cy="16" r="16"></circle>\n        <circle class="point" fill="#FFFFFF" cx="16" cy="16" r="5"></circle>\n        <g class="arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(11.000000, 16.000000)">\n          <rect id="Rectangle-32" fill="#1181FB" x="0" y="0" width="10" height="1"></rect>\n          <rect class="arrowTop" fill="#1181FB" x="0" y="0" width="6" height="1"></rect>\n          <rect class="arrowBottom" fill="#1181FB" x="0" y="0" width="6" height="1"></rect>\n        </g>\n      </g>\n    </svg>\n  </a>\n  <ul class="EditorMenu-navigation js-menu"></ul>\n</div>\n<div class="Editor-panelWrapper js-editorPanel">\n  <div class="js-content"></div>\n</div>\n';
return __p}},{underscore:"underscore"}],706:[function(a,b,c){var d=a("backbone/core-view"),e=a("./settings/preview/preview-view"),f=a("../components/scroll/scroll-view"),g=a("./editor-header.js"),h=a("../components/modals/publish/publish-view"),i=a("./layers/share-button-view"),j=a("../components/view-options/panel-with-options-view"),k=a("../helpers/required-opts"),l=["configModel","editorModel","mapDefinitionModel","mapcapsCollection","modals","overlaysCollection","privacyCollection","settingsCollection","userModel","visDefinitionModel"];b.exports=d.extend({initialize:function(a){k(a,l,this),this._editorModel.set("edition",!1)},render:function(){this.clearSubViews(),this.$el.empty();var a=new g({userModel:this._userModel,editorModel:this._editorModel,configModel:this._configModel,mapcapsCollection:this._mapcapsCollection,modals:this._modals,visDefinitionModel:this._visDefinitionModel,privacyCollection:this._privacyCollection,onClickPrivacy:this._share.bind(this),onRemoveMap:this._onRemoveMap.bind(this)});a.bind("export-image",function(){this.trigger("export-image",this)},this),this.$el.append(a.render().$el),this.addView(a);var b=new j({className:"Editor-content",editorModel:this._editorModel,createContentView:function(){return new f({createContentView:function(){return new e({mapDefinitionModel:this._mapDefinitionModel,settingsCollection:this._settingsCollection,overlaysCollection:this._overlaysCollection})}.bind(this)})}.bind(this),createActionView:function(){return new i({visDefinitionModel:this._visDefinitionModel,onClickAction:this._share.bind(this)})}.bind(this)});return this.$el.append(b.render().$el),this.addView(b),this},_share:function(){this._modals.create(function(a){return new h({mapcapsCollection:this._mapcapsCollection,modalModel:a,visDefinitionModel:this._visDefinitionModel,privacyCollection:this._privacyCollection,userModel:this._userModel,configModel:this._configModel})}.bind(this))},_onRemoveMap:function(){window.location=this._userModel.get("base_url")}})},{"../components/modals/publish/publish-view":428,"../components/scroll/scroll-view":530,"../components/view-options/panel-with-options-view":595,"../helpers/required-opts":1097,"./editor-header.js":697,"./layers/share-button-view":998,"./settings/preview/preview-view":1011,"backbone/core-view":1127}],707:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./editor-settings-pane"),g=a("./export-image-pane/export-image-pane"),h=a("../components/stack-layout/stack-layout-view"),i=a("../components/notifier/notifier"),j=a("../helpers/required-opts"),k=["configModel","editorModel","mapcapsCollection","mapDefinitionModel","modals","overlaysCollection","privacyCollection","settingsCollection","visDefinitionModel","userModel","stateDefinitionModel"];b.exports=e.extend({className:"Editor-panel",initialize:function(a){j(a,k,this),this._editorModel.set("edition",!1)},render:function(){this.clearSubViews(),this._generateStackLayoutView();var a=i.getView();return this.$el.append(a.render().el),this.addView(a),this},_generateStackLayoutView:function(){var a=new d.Collection([{createStackView:function(a,b){return this._createEditorSettingsView(a,b).bind(this)}.bind(this)}]);a.push({createStackView:function(a,b){return this._createExportImageView(a,b).bind(this)}.bind(this)}),this._stackLayoutView=new h({className:"Editor-content",collection:a}),this.addView(this._stackLayoutView),this.$el.append(this._stackLayoutView.render().$el)},_createEditorSettingsView:function(a,b){var c=new f({className:"Editor-content",configModel:this._configModel,editorModel:this._editorModel,mapcapsCollection:this._mapcapsCollection,mapDefinitionModel:this._mapDefinitionModel,modals:this._modals,overlaysCollection:this._overlaysCollection,privacyCollection:this._privacyCollection,settingsCollection:this._settingsCollection,userModel:this._userModel,visDefinitionModel:this._visDefinitionModel});return c.bind("export-image",function(){this._stackLayoutView.model.goToStep(1)},this),c},_createExportImageView:function(a,b){var c=new g({className:"Editor-content",canvasClassName:"CDB-Map",configModel:this._configModel,stackLayoutModel:a,userModel:this._userModel,visDefinitionModel:this._visDefinitionModel,stateDefinitionModel:this._stateDefinitionModel,mapDefinitionModel:this._mapDefinitionModel,editorModel:this._editorModel});return c}})},{"../components/notifier/notifier":475,"../components/stack-layout/stack-layout-view":533,"../helpers/required-opts":1097,"./editor-settings-pane":706,"./export-image-pane/export-image-pane":713,backbone:"backbone","backbone/core-view":1127}],708:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<nav class="CDB-NavMenu js-theme">\n  <ul class="CDB-NavMenu-inner CDB-Text is-semibold CDB-Size-medium js-menu"></ul>\n  <button class="Editor-buttonNavigation CDB-Button CDB-Button--small CDB-Button--primary js-add">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">\n      '+(null==(__t=_t("editor.button_add"))?"":_.escape(__t))+'\n    </span>\n  </button>\n</nav>\n<div class="Editor-content js-content"></div>\n';return __p}},{underscore:"underscore"}],709:[function(a,b,c){var d=a("backbone/core-view"),e=a("backbone"),f=a("./editor-pane"),g=a("./export-image-pane/export-image-pane"),h=a("../helpers/required-opts"),i=a("../components/stack-layout/stack-layout-view"),j=["userActions","modals","configModel","userModel","editorModel","pollingModel","analysisDefinitionNodesCollection","layerDefinitionsCollection","privacyCollection","widgetDefinitionsCollection","mapcapsCollection","mapDefinitionModel","visDefinitionModel","mapStackLayoutModel","stateDefinitionModel","selectedTabItem"];b.exports=d.extend({className:"Editor-content",events:{"click .js-add":"_addItem"},initialize:function(a){h(a,j,this)},render:function(){return this.clearSubViews(),this._generateStackLayoutView(),this},_generateStackLayoutView:function(){var a=new e.Collection([{createStackView:function(a,b){return this._createEditorView(a,b).bind(this)}.bind(this)}]);a.push({createStackView:function(a,b){return this._createExportImageView(a,b).bind(this)}.bind(this)}),this._stackLayoutView=new i({className:"Editor-content",collection:a}),this.addView(this._stackLayoutView),this.$el.append(this._stackLayoutView.render().$el)},_createEditorView:function(a,b){var c=new f({analysisDefinitionNodesCollection:this._analysisDefinitionNodesCollection,configModel:this._configModel,editorModel:this._editorModel,layerDefinitionsCollection:this._layerDefinitionsCollection,mapStackLayoutModel:this._mapStackLayoutModel,mapcapsCollection:this._mapcapsCollection,modals:this._modals,pollingModel:this._pollingModel,privacyCollection:this._privacyCollection,stateDefinitionModel:this._stateDefinitionModel,userActions:this._userActions,userModel:this._userModel,visDefinitionModel:this._visDefinitionModel,widgetDefinitionsCollection:this._widgetDefinitionsCollection,selectedTabItem:this._selectedTabItem});return c.bind("export-image",function(){this._stackLayoutView.model.goToStep(1)},this),c},_createExportImageView:function(a,b){var c=new g({visDefinitionModel:this._visDefinitionModel,canvasClassName:"CDB-Map",configModel:this._configModel,stackLayoutModel:a,userModel:this._userModel,mapDefinitionModel:this._mapDefinitionModel,stateDefinitionModel:this._stateDefinitionModel,editorModel:this._editorModel});return c}})},{"../components/stack-layout/stack-layout-view":533,"../helpers/required-opts":1097,"./editor-pane":704,"./export-image-pane/export-image-pane":713,backbone:"backbone","backbone/core-view":1127}],710:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../../helpers/required-opts"),g=["userModel","hasGoogleBasemap"],h=8192,i=640,j=2048,k=[{type:"png",label:".png",className:"track-ImageExport track-typePNG"},{type:"jpg",label:".jpg",className:"track-ImageExport track-typeJPG"}];b.exports=d.Model.extend({defaults:{type:"none",title:""},initialize:function(a,b){f(a,g,this),this.schema=this._generateSchema(),this._setSchema(),this.on("change:format change:width change:height",this._setSchema,this)},_setSchema:function(){this.schema=this._generateSchema()},_generateSchema:function(){return{width:{type:"Number",title:_t("editor.export-image.properties.width")+" (px)",validators:["required",this._validateDimension.bind(this)],showSlider:!1,editorAttrs:{className:"track-ImageExport track-inputWidth",placeholder:_t("editor.export-image.properties.width")}},height:{type:"Number",title:_t("editor.export-image.properties.height")+" (px)",validators:["required",this._validateDimension.bind(this)],showSlider:!1,editorAttrs:{className:"track-ImageExport track-inputHeight",placeholder:_t("editor.export-image.properties.height")}},format:{type:"Radio",title:_t("editor.export-image.properties.format"),options:e.map(k,function(a){return{val:a.type,label:a.label,className:a.className}},this)}}},_validateDimension:function(a,b){var c,d=+a,f=h;return this._hasGoogleBasemap&&(f=i,c=this._userModel.get("google_maps_key"),c.indexOf("signature")!==-1&&(f=j)),e.isNumber(d)&&d>=1&&d<=f?null:{message:_t("editor.export-image.invalid-dimension",{limit:f})}},setErrors:function(a){var b=a!==this._validationErrors;this._validationErrors=a,b&&this.trigger("change:errors")},canExport:function(){return e.isUndefined(this._validationErrors)},toJSON:function(){return e.extend(this.attributes,{type:this.get("type")})}})},{"../../helpers/required-opts":1097,backbone:"backbone",underscore:"underscore"}],711:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./export-image-form.tpl");a("../../components/form-components/index");var g=a("../../helpers/required-opts"),h=["formModel"];b.exports=e.extend({initialize:function(a){g(a,h,this)},render:function(){return this.clearSubViews(),this._removeFormView(),this._renderForm(),this._initBinds(),this},_renderForm:function(){this.clearSubViews(),this._removeFormView(),this._formView=new d.Form({template:f,model:this._formModel}),this.$("form").on("submit",function(a){a.preventDefault()}),this.$el.append(this._formView.render().$el)},_initBinds:function(){this.listenTo(this._formView,"change",this._updateChanges),this.listenTo(this._formModel,"change:width change:height",this._updateSchema)},_updateSchema:function(){this._formView.fields.width.setValue(this._formModel.get("width")),this._formView.fields.height.setValue(this._formModel.get("height")),this._updateChanges()},_updateChanges:function(){var a=this._formView.commit({validate:!0});this._formView.model.setErrors(a)},_removeFormView:function(){this._formView&&this._formView.remove()},clean:function(){this.$("form").off("submit"),this._removeFormView(),e.prototype.clean.call(this)}})},{"../../components/form-components/index":211,"../../helpers/required-opts":1097,"./export-image-form.tpl":712,backbone:"backbone","backbone/core-view":1127}],712:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-bSpace--xl">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">1</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="width,height">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.export-image.properties.size"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.export-image.properties.size-subtitle"))?"":_.escape(__t))+'</p>\n  </div>\n</div>\n<div class="u-flex u-bSpace--xl">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="format">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.export-image.properties.format"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.export-image.properties.format-subtitle"))?"":_.escape(__t))+"</p>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],713:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("backbone/core-view"),h=a("./footer/footer-view"),i=a("./export-image-form-view.js"),j=a("./export-image-form-model"),k=a("./export-image-widget"),l=a("./export-image-pane.tpl"),m=a("../../helpers/utils"),n=a("../../components/notifier/notifier"),o=a("../../helpers/browser-detect"),p=a("../../components/infobox/infobox-factory"),q=a("../../components/infobox/infobox-view"),r=a("../../components/infobox/infobox-model"),s=a("../../components/infobox/infobox-collection"),t="png",u=300,v=200,w="@CARTO",x=15,y=16,z="exportImageNotification",A="/unversioned/images/carto.png",B="https://maps.googleapis.com/maps/api/staticmap",C=a("../../helpers/required-opts"),D=["canvasClassName","configModel","stackLayoutModel","userModel","visDefinitionModel","stateDefinitionModel","mapDefinitionModel","editorModel"];b.exports=g.extend({className:"Editor-content",events:{"click .js-back":"_goStepBack"},initialize:function(a){C(a,D,this),this._canvasModel=new f.Model,this._$map=d("."+this._canvasClassName);var b=u,c=v,e=Math.ceil(this._$map.width()/2-b/2),g=Math.ceil(this._$map.height()/2-c/2);this._exportImageFormModel=new j({userModel:this._userModel,hasGoogleBasemap:this._hasGoogleMapsBasemap(),format:t,x:e,y:g,width:b,height:c})},_addErrorNotification:function(a){n.addNotification({id:z,status:"error",closable:!0,button:!1,delay:n.DEFAULT_DELAY,info:a+" "+_t("editor.maps.export-image.errors.try-again")})},render:function(){return this.clearSubViews(),this.$el.append(l({title:_t("editor.maps.export-image.title")})),this._createWidget(),this._createForm(),this._createDisclaimer(),this._createFooter(),this},_createForm:function(){this._exportImageFormView=new i({formModel:this._exportImageFormModel,canvasModel:this._exportImageFormModel}),this.$(".js-content").append(this._exportImageFormView.render().$el),this.addView(this._exportImageFormView)},_createDisclaimer:function(){var a=[{state:"disclaimer",createContentView:function(){return p.createWithAction({type:"warning",title:_t("editor.maps.export-image.disclaimer.title"),body:_t("editor.maps.export-image.disclaimer.body")})}}];this._infoboxModel=new r({state:"disclaimer"}),this._infoboxCollection=new s(a),this._infoboxView=new q({infoboxModel:this._infoboxModel,infoboxCollection:this._infoboxCollection}),this.$(".js-disclaimer").append(this._infoboxView.render().el),this.addView(this._infoboxView)},_createFooter:function(){this._footerView=new h({configModel:this._configModel,userModel:this._userModel,formModel:this._exportImageFormModel}),this.addView(this._footerView),this._footerView.bind("finish",this._exportImage,this),this.$(".js-footer").append(this._footerView.render().el)},_createWidget:function(){this._exportImageWidget=new k({mapViewClass:"CDB-Map-wrapper",dashboardCanvasClass:"CDB-Dashboard-canvas",model:this._exportImageFormModel,stateDefinitionModel:this._stateDefinitionModel,mapDefinitionModel:this._mapDefinitionModel}),this.addView(this._exportImageWidget),this._$map.prepend(this._exportImageWidget.render().$el)},_getStaticMapURL:function(){var a=this._mapDefinitionModel.getStaticImageURLTemplate(),b=this._mapDefinitionModel.getImageExportMetadata();return a({zoom:b.zoom,width:this._exportImageFormModel.get("width"),height:this._exportImageFormModel.get("height"),lat:this._exportImageFormModel.get("lat"),lng:this._exportImageFormModel.get("lng"),format:"png"})},_getStaticStyles:function(a){if(a){var b,c,d=[],e="";return JSON.parse(a).forEach(function(a){e="",a.stylers&&a.stylers.length>0&&(e+=(a.hasOwnProperty("featureType")?"feature:"+a.featureType:"feature:all")+"|",e+=(a.hasOwnProperty("elementType")?"element:"+a.elementType:"element:all")+"|",a.stylers.forEach(function(a){b=Object.keys(a)[0],c=a[b].toString().replace("#","0x"),e+=b+":"+c+"|"})),e&&d.push("style="+e)}),d.join("&")}},_removeNotification:function(){n.getNotification(z)&&n.removeNotification(z)},_exportImage:function(){var a=this;this._removeNotification();var b=d.Deferred(),c=function(){return a._loadLogo()},e=function(){if(a._hasGoogleMapsBasemap())return a._loadBasemap(a._getGMapBasemapURL())},f=function(){return a._onLoadImage(a._downloadImage.bind(a))},g=function(){return a._loadAttribution()};b.then(c).then(e).then(g).then(f).fail(this._onFail.bind(this)),b.resolve()},_onFail:function(a){this._footerView.stopLoader(),this._addErrorNotification(a)},_downloadImage:function(a){var b=o(),c=this._exportImageFormModel.get("format"),d=this._visDefinitionModel.get("name")+"."+c;if(a.msToBlob){var e=a.msToBlob();window.navigator.msSaveBlob(new Blob([e],{type:"image/"+c}),d)}else{var f=a.toDataURL("image/"+c),g=document.createElement("a");document.body.appendChild(g),g.download=d,g.href=f,"Safari"!==b.name?g.target="_blank":f.replace(/^data:image\/[^;]/,"data:application/octet-stream"),g.click(),document.body.removeChild(g)}this._footerView.stopLoader()},_hasGoogleMapsBasemap:function(){var a=this._mapDefinitionModel.getImageExportMetadata();return"googlemaps"===a.provider},_onLoadImage:function(a){var b=this,c=this._getStaticMapURL(),d=this._basemap,e=+this._exportImageFormModel.get("width"),f=+this._exportImageFormModel.get("height"),g=new Image;g.setAttribute("crossOrigin","anonymous"),g.onload=function(){var c=document.createElement("canvas"),g=c.getContext("2d");c.width=this.naturalWidth,c.height=this.naturalHeight,d&&g.drawImage(d,0,0),g.drawImage(this,0,0),b._drawLogo(g,e,f),b._drawAttribution(g,e,f),a(c)},g.onerror=function(a){b._onFail(_t("editor.maps.export-image.errors.error-image"))},g.src=c},_drawLogo:function(a,b,c){if(this._logo){var d=b/2-this._logo.width/2,e=c-this._logo.height-5;a.drawImage(this._logo,d,e)}},_drawAttribution:function(a,b,c){if(this._attribution){var d=b-this._attribution.width-3,e=c-this._attribution.height;if(this._hasGoogleMapsBasemap()){var f=this._$map.find(".gm-style-cc").width();f>=b/2&&(e-=y/2),e=c-this._attribution.height-y}a.drawImage(this._attribution,d,e)}},_getDimensionString:function(){var a=this._exportImageFormModel.get("width"),b=this._exportImageFormModel.get("height");return a+"x"+b},_getCenterString:function(){var a=+this._exportImageFormModel.get("lat").toFixed(6),b=+this._exportImageFormModel.get("lng").toFixed(6);return a+","+b},_getGMapBasemapURL:function(){var a=this._mapDefinitionModel.getImageExportMetadata(),b={center:this._getCenterString().replace(",",";"),zoom:a.zoom,size:this._getDimensionString(),mapType:a.mapType,rnd:Math.random(1e3)},c=e.pairs(b).join("&").replace(/,/g,"=").replace(/;/g,","),d=this._getStaticStyles(a.style),f=this._userModel.get("google_maps_key");return B+"?"+c+"&style="+d+"&"+f},_loadAttribution:function(){var a=this,b=this._mapDefinitionModel.getImageExportMetadata(),c=d.Deferred(),e=new Image,f=document.createElement("canvas"),g=f.getContext("2d"),h=this._hasGoogleMapsBasemap()?w:m.stripHTML(b.attribution.join(" ")),i=g.measureText(h),j=i.width;return g.font="11px",g.fillStyle="rgba(255, 255, 255, 0.7)",g.fillRect(-x,0,j+x+2,y-3),g.fillStyle="#333",g.fillText(h,0,10),e.onload=function(){a._attribution=this,c.resolve()},e.onerror=function(){c.reject(_t("editor.maps.export-image.errors.error-attribution"))},e.width=j,e.height=y-3,e.src=f.toDataURL(),c.promise()},_loadLogo:function(){var a=this,b=new Image;b.setAttribute("crossOrigin","anonymous");var c=d.Deferred();return b.onload=function(){a._logo=this,c.resolve()},b.onerror=function(){c.reject(_t("editor.maps.export-image.errors.error-image"))},b.src=this._configModel.get("app_assets_base_url")+A,c.promise()},_loadBasemap:function(a){var b=this,c=d.Deferred(),e=new Image;return e.setAttribute("crossOrigin","anonymous"),e.onload=function(){b._basemap=this,c.resolve()},e.onerror=function(){c.reject(_t("editor.maps.export-image.errors.error-basemap"))},e.src=a,c.promise()},_goStepBack:function(){this._stackLayoutModel.prevStep()}})},{"../../components/infobox/infobox-collection":215,"../../components/infobox/infobox-factory":216,"../../components/infobox/infobox-model":219,"../../components/infobox/infobox-view":221,"../../components/notifier/notifier":475,"../../helpers/browser-detect":1088,"../../helpers/required-opts":1097,"../../helpers/utils":1102,"./export-image-form-model":710,"./export-image-form-view.js":711,"./export-image-pane.tpl":714,"./export-image-widget":715,"./footer/footer-view":717,backbone:"backbone","backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],714:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfoEditor Editor-HeaderInfo--noMargin">\n  <div class="u-rSpace--xl u-actionTextColor Editor-HeaderInfoEditorShape">\n    <button class="js-back">\n      <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n    </button>\n  </div>\n  <div class="CDB-Text CDB-Size-huge is-light u-ellipsis">'+(null==(__t=title)?"":_.escape(__t))+'</div>\n</div>\n\n<div class="Editor-content js-content"></div>\n<div class="js-disclaimer"></div>\n<div class="Options-bar Options-bar--right u-flex js-footer"></div>\n';return __p}},{underscore:"underscore"}],715:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone/core-view"),g=a("./export-image-widget.tpl"),h=a("../../helpers/required-opts"),i="track-ImageExport",j=["mapViewClass","dashboardCanvasClass","stateDefinitionModel","mapDefinitionModel"];b.exports=f.extend({className:"ExportImageView",events:{"mouseenter .js-canvas":"_onEnter","mouseleave .js-canvas":"_onLeave"},initialize:function(a){h(a,j,this),this._$dashBoardCanvas=e("."+this._dashboardCanvasClass),this._initBinds()},render:function(){return this.$el.append(g(this.model.attributes)),this._initViews(),this},_initViews:function(){this._setupCanvas(),this._updateHelpers();var a=+this.model.get("x"),b=+this.model.get("y"),c=+this.model.get("width"),d=+this.model.get("height");this._updateCoordinates(a,b,c,d)},_initBinds:function(){this.listenTo(this.model,"change:x change:y change:width change:height",this._updateHelpers),this.listenTo(this._stateDefinitionModel,"change:json",this._onChangeMap),this._resize=d.debounce(this._onResizeWindow.bind(this),20),e(window).on("resize",this._resize),this.listenTo(this._stateDefinitionModel,"change",this._updateCanvasCoordinates)},_onEnter:function(){d.debounce(this.$el.addClass("is-top"),50)},_onLeave:function(){d.debounce(this.$el.removeClass("is-top"),50)},_onResizeWindow:function(a){if(a.target===window){var b=this._mapDefinitionModel.latLngToPixel,c=b({lat:this.model.get("lat"),lng:this.model.get("lng")}),d=this.model.get("width"),e=this.model.get("height");this.model.set({x:c.x-d/2,y:c.y-e/2}),this._updateCanvasCoordinates(),this._updateHelpers()}},_setupCanvas:function(){this.$(".js-canvas").resizable({resize:this._onResize.bind(this),handles:"n, e, s, w, ne, se, sw, nw",containment:this._$dashBoardCanvas}),this.$(".js-canvas").draggable({drag:this._updateCanvasCoordinates.bind(this),stop:this._updateCanvasCoordinates.bind(this),containment:this._$dashBoardCanvas}),this._setupTracks(),this.$(".js-canvas").css({top:+this.model.get("x"),left:+this.model.get("y"),width:+this.model.get("width"),height:+this.model.get("height")})},_updateHelpers:function(){var a=+this.model.get("x"),b=+this.model.get("y"),c=+this.model.get("width"),d=+this.model.get("height"),e=this._mapDefinitionModel.getMapViewSize(),f=e.x,g=e.y,h=b+d+1,i=a+c+1;this.$(".js-canvas").css({top:b,left:a,height:d,width:c}),a>=0&&b>=0&&(this.$(".js-helper-north").css({top:0,width:i,height:b+1}),this.$(".js-helper-west").css({left:0,top:b+1,width:a+1,height:d}),this.$(".js-helper-south").css({top:h,left:0,width:f,height:g-d-b}),this.$(".js-helper-east").css({left:i,top:0,width:f-c-a-1,height:h})),i+1>=f&&this.$(".js-helper-east").css("width",0),a<=0&&this.$(".js-helper-west").css("width",0),h+1>=g&&this.$(".js-helper-south").css("height",0),b<=0&&this.$(".js-helper-north").css("height",0)},_updateCanvasCoordinates:function(){var a=this.$(".js-canvas").width(),b=this.$(".js-canvas").height(),c=this.$(".js-canvas").position().left,d=this.$(".js-canvas").position().top;this._updateCoordinates(c,d,a,b)},_onChangeMap:function(){var a=this._calcCenter();this.model.set({lat:a.lat,lng:a.lng})},_onResize:function(a,b){var c=b.helper.width(),d=b.helper.height(),e=b.helper.position().left,f=b.helper.position().top;this._updateCoordinates(e,f,c,d)},_updateCoordinates:function(a,b,c,d){var e=this._calcCenter();this.model.set({x:a,y:b,width:c,height:d,lat:e.lat,lng:e.lng})},_calcCenter:function(){var a=this.model.get("x")+this.model.get("width")/2,b=this.model.get("y")+this.model.get("height")/2,c=this._mapDefinitionModel.pixelToLatLng;return c({x:a,y:b})},_setupTracks:function(){this.$(".js-canvas .ui-resizable-nw").addClass(i+" track-nodeTopLeft"),this.$(".js-canvas .ui-resizable-n").addClass(i+" track-nodeTopCenter"),this.$(".js-canvas .ui-resizable-ne").addClass(i+" track-nodeTopRight"),this.$(".js-canvas .ui-resizable-w").addClass(i+" track-nodeMiddleLeft"),this.$(".js-canvas .ui-resizable-e").addClass(i+" track-nodeMiddleCenter"),this.$(".js-canvas .ui-resizable-sw").addClass(i+" track-nodeBottomLeft"),this.$(".js-canvas .ui-resizable-s").addClass(i+" track-nodeBottomCenter"),this.$(".js-canvas .ui-resizable-se").addClass(i+" track-nodeBottomRight")},clean:function(){e(window).off("resize",this._resize),f.prototype.clean.apply(this)}})},{"../../helpers/required-opts":1097,"./export-image-widget.tpl":716,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],716:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ExportHelper ExportHelper--north js-export-helper js-helper-north"></div>\n<div class="ExportHelper ExportHelper--west  js-export-helper js-helper-west"></div>\n<div class="ExportHelper ExportHelper--south js-export-helper js-helper-south"></div>\n<div class="ExportHelper ExportHelper--east  js-export-helper js-helper-east"></div>\n<div class="CanvasExport js-canvas"></div>\n';return __p}},{underscore:"underscore"}],717:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./footer.tpl"),g=a("../../../helpers/required-opts"),h="loading",i=["userModel","configModel","formModel"];b.exports=e.extend({className:"Editor-FooterInfoEditor",events:{"click .js-ok":"_finish"},initialize:function(a){g(a,i,this),this.model=new d.Model({state:""}),this.listenTo(this.model,"change:state",this.render),this.listenTo(this._formModel,"change:errors",this.render)},render:function(){return this.clearSubViews(),this.$el.html(f({isLoading:this._isLoading(),isDisabled:!(this._formModel.canExport()&&!this._isLoading())})),this},stopLoader:function(a){this.model.unset("state")},_isLoading:function(){return this.model.get("state")===h},_finish:function(a){this.killEvent(a),this.model.set("state",h),this.trigger("finish",this)}})},{"../../../helpers/required-opts":1097,"./footer.tpl":718,backbone:"backbone","backbone/core-view":1127}],718:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="CDB-Button CDB-Button--primary js-ok track-ImageExport track-export\n  ',(isLoading||isDisabled)&&(__p+=" is-disabled "),__p+='\n  "\n  ',isDisabled&&(__p+=" disabled "),__p+='>\n  <div class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase u-flex">\n    ',__p+=isLoading?'\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small u-iBlock">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n     '+(null==(__t=_t("editor.maps.export-image.generating"))?"":_.escape(__t))+"\n    ":"\n     "+(null==(__t=_t("editor.maps.export-image.export"))?"":_.escape(__t))+"\n    ",__p+="\n  </div>\n</button>\n";return __p}},{underscore:"underscore"}],719:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../components/view-factory"),f=a("./feedback-button.tpl"),g=a("../../components/tipsy-tooltip-view"),h=a("./feedback-modal.tpl");b.exports=d.extend({tagName:"button",className:"EditorMenu-feedback typeform-share button js-feedback",events:{click:"_onClick"},initialize:function(a){if(!a.modals)throw new Error("modals is required");this._modals=a.modals},render:function(){this.clearSubViews(),this.el.setAttribute("data-mode","1"),this.el.setAttribute("target","_blank"),this.$el.append(f());var a=new g({el:this.el,gravity:"w",title:function(){return _t("feedback")}});return this.addView(a),this},_onClick:function(){this._modals.once("destroyedModal",this.clean,this),this._modals.create(function(a){return e.createByTemplate(h,null,{className:"Editor-feedbackModal"})})}})},{"../../components/tipsy-tooltip-view":589,"../../components/view-factory":594,"./feedback-button.tpl":720,"./feedback-modal.tpl":721,"backbone/core-view":1127}],720:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="18px" height="16px" viewBox="-1 -1 18 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n <g id="feedback" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n   <path d="M16,11 L8,11 L5,14 L5,11 L0,11 L0,0 L16,0 L16,11 Z M7.29289322,10.2928932 L7.58578644,10 L8,10 L15,10.0047607 L15.0084229,1 L1,0.993103027 L1,10 L5,10 L6,10 L6,11 L6,11.5374756 L7.29289322,10.2928932 Z" id="Combined-Shape" fill="#FFFFFF "></path>\n   <rect id="Rectangle-25" fill="#FFFFFF " x="4" y="3" width="8" height="1"></rect>\n   <rect id="Rectangle-25" fill="#FFFFFF " x="4" y="5" width="8" height="1"></rect>\n   <rect id="Rectangle-25" fill="#FFFFFF " x="4" y="7" width="5" height="1"></rect>\n </g>\n</svg>\n';return __p}},{underscore:"underscore"}],721:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class=\"typeform-widget\" data-url=\"https://cartohq.typeform.com/to/t7Dk8K\" data-text=\"CARTO Builder\" style=\"width:100%;height:100%;\"></div>\n<script>(function(){var qs,js,q,s,d=document,gi=d.getElementById,ce=d.createElement,gt=d.getElementsByTagName,id='typef_orm',b='https://s3-eu-west-1.amazonaws.com/share.typeform.com/';if(!gi.call(d,id)){js=ce.call(d,'script');js.id=id;js.src=b+'widget.js';q=gt.call(d,'script')[0];q.parentNode.insertBefore(js,q)}})()</script>\n";return __p}},{underscore:"underscore"}],722:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="Inline-editor">\n  <div class="CDB-Text CDB-Size-huge is-light u-ellipsis js-title Inline-editor-text">'+(null==(__t=name)?"":_.escape(__t))+'</div>\n  <input type="text" name="text" class="Inline-editor-input Inline-editor-input--small CDB-Text CDB-InputText js-input" value="'+(null==(__t=name)?"":_.escape(__t))+'" readonly>\n</h2>';return __p}},{underscore:"underscore"
}],723:[function(a,b,c){var d=a("jquery"),e=a("cartodb.js"),f=a("backbone/core-view"),g=a("../../../components/tipsy-tooltip-view.js"),h=a("../notification-error-message-handler");b.exports=f.extend({initialize:function(a){if(!a.analysisNode)throw new Error("analysisNode is required");if(!a.element)throw new Error("element is required");if(!a.triggerSelector)throw new Error("triggerSelector is required");this.analysisNode=a.analysisNode,this.$el=a.element,this.selector=a.triggerSelector,this.$el.on("mouseover",this.selector,this._showTooltip.bind(this)),this.$el.on("mouseout",this.selector,this._destroyTooltip.bind(this)),this.$el.on("mouseleave",this.selector,this._destroyTooltip.bind(this))},_showTooltip:function(a){var b=this.analysisNode.get("status");if("failed"===b){var c=h.extractErrorFromAnalysisNode(this.analysisNode);this.tooltip=this._createTooltip({$el:d(a.target),msg:c.message}),this.tooltip.showTipsy()}},_createTooltip:function(a){return new g({el:a.$el,title:function(){return a.msg}})},_destroyTooltip:function(){this.tooltip&&(this.tooltip.hideTipsy(),this.tooltip.destroyTipsy(),delete this.tooltip)},clean:function(){this.$el.off("mouseover",this.selector),this.$el.off("mouseout",this.selector),this.$el.off("mouseleave",this.selector),this._destroyTooltip(),e.core.View.prototype.clean.call(this)}})},{"../../../components/tipsy-tooltip-view.js":589,"../notification-error-message-handler":992,"backbone/core-view":1127,"cartodb.js":"cartodb.js",jquery:"jquery"}],724:[function(a,b,c){var d=a("underscore"),e=a("../../../components/notifier/notifier"),f=a("../notification-error-message-handler"),g=e.DEFAULT_DELAY,h="ready",i="pending",j="running",k="waiting",l="failed",m={track:function(a,b){a.on("change:status",this._addStatusChangedNotification,this),a.on("change:error",this._onErrorChanged,this),a.once("destroy",this._addRemovedNotification,this),this._layerDefModel=b,a.get("status")&&a.get("status")!==h&&this._addStatusChangedNotification(a)},_addRemovedNotification:function(a){if(a.get("avoidNotification")!==!0){var b=a.get("id"),c={status:"success",info:_t("notifications.analysis.removed",{nodeId:b.toUpperCase()}),closable:!0,delay:g};this._addOrUpdateNotification(a.cid,c)}},_addStatusChangedNotification:function(a){var b=a.get("status");b!==k&&b!==i||this._addAnalysisWaitingNotification(a),b===j&&this._addAnalysisRunningNotification(a),b===h&&this._addAnalysisReadyNotification(a),b===l&&this._addAnalysisFailedNotification(a)},_addAnalysisWaitingNotification:function(a){var b={status:"loading",info:_t("notifications.analysis.waiting",{nodeId:a.get("id").toUpperCase()})};this._addOrUpdateNotification(a.cid,b)},_addAnalysisRunningNotification:function(a){var b={status:"loading",info:_t("notifications.analysis.running",{nodeId:a.get("id").toUpperCase()})};this._addOrUpdateNotification(a.cid,b)},_addAnalysisReadyNotification:function(a){var b={status:"success",info:_t("notifications.analysis.completed",{nodeId:a.get("id").toUpperCase()}),closable:!0,delay:g};this._addOrUpdateNotification(a.cid,b)},_addAnalysisFailedNotification:function(a){var b=f.extractErrorFromAnalysisNode(a,this._layerDefModel),c={status:b.type,info:b.message,closable:!0,autoclosable:!1};this._addOrUpdateNotification(a.cid,c)},_addOrUpdateNotification:function(a,b){var c=this._getNotification(a);c?c.set(b):this._addNotification(a,b)},_addNotification:function(a,b){b=d.extend({id:a},b),e.addNotification(b)},_getNotification:function(a){return e.getNotification(a)},_onErrorChanged:function(a,b){b&&this._addAnalysisFailedNotification(a)}};b.exports=m},{"../../../components/notifier/notifier":475,"../notification-error-message-handler":992,underscore:"underscore"}],725:[function(a,b,c){var d=a("backbone/core-view"),e=a("./source-layer-analysis-view"),f=a("./default-layer-analysis-view"),g=a("./composite-layer-analysis-view.tpl");b.exports=d.extend({tagName:"li",className:"Editor-ListAnalysis-item",initialize:function(a){if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");this._analysisDefinitionNodesCollection=a.analysisDefinitionNodesCollection,this._layerDefinitionModel=a.layerDefinitionModel},render:function(){return this.clearSubViews(),this.$el.html(g()),this._renderOwnNode(),this._renderSecondaryNode(),this},_renderOwnNode:function(){var a=new f({tagName:"div",model:this.model,analysisNode:this._analysisDefinitionNodesCollection.get(this.model.id),layerDefinitionModel:this._layerDefinitionModel});this.addView(a),this.$(".js-primary-source").append(a.render().el)},_renderSecondaryNode:function(){var a=this.model.getSecondarySource(),b=this._layerDefinitionModel.collection.findOwnerOfAnalysisNode(a);if(a){var c="source"===a.get("type")?new e({model:a,analysisNode:this._analysisDefinitionNodesCollection.get(a.id),layerDefinitionModel:this._layerDefinitionModel,showId:!(!b||!this._isOwnedByOtherLayer(b))}):new f({tagName:"div",model:a,analysisNode:this._analysisDefinitionNodesCollection.get(a.id),layerDefinitionModel:b});this.addView(c),this.$(".js-secondary-source").append(c.render().el)}},_isOwnedByOtherLayer:function(a){return a!==this._layerDefinitionModel}})},{"./composite-layer-analysis-view.tpl":726,"./default-layer-analysis-view":727,"./source-layer-analysis-view":731,"backbone/core-view":1127}],726:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Editor-ListAnalysis-inner">\n  <li class="Editor-ListAnalysis-innerItem js-primary-source"></li>\n  <li class="Editor-ListAnalysis-innerItem js-secondary-source"></li>\n</ul>\n';return __p}},{underscore:"underscore"}],727:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../../value-objects/analysis-node-ids"),g=a("../../../data/layer-colors"),h=a("./default-layer-analysis-view.tpl"),i=a("../../../data/analyses"),j=a("./analyses-tooltip-error");b.exports=e.extend({tagName:"li",className:"Editor-ListAnalysis-item Editor-ListAnalysis-layer CDB-Text is-semibold CDB-Size-small js-analysis-node",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},initialize:function(a){if(!a.analysisNode)throw new Error("analysisNode is required");this._analysisNode=a.analysisNode,this._analysisNode.on("change:status",this.render,this),this.add_related_model(this._analysisNode),this._analysisTooltip=new j({analysisNode:this._analysisNode,element:this.$el,triggerSelector:".Editor-ListAnalysis-itemError"}),this.addView(this._analysisTooltip),this._stateModel=new d.Model({highlighted:!1}),this._initBinds()},_initBinds:function(){this._stateModel.on("change:highlighted",this._toggleHover,this),this.add_related_model(this._stateModel)},render:function(){var a=this._analysisNode.get("status");return this.$el.html(h({id:this.model.id,bgColor:this._bgColor(),isDone:"ready"===a||"failed"===a,title:i.title(this.model),hasError:"failed"===a})),this.$el.toggleClass("has-error","failed"===a),this.el.dataset.analysisNodeId=this.model.id,this},_bgColor:function(){var a=f.letter(this._analysisNode.id);return g.getColorForLetter(a)},_onMouseEnter:function(){this._stateModel.set("highlighted",!0)},_onMouseLeave:function(){this._stateModel.set("highlighted",!1)},_toggleHover:function(){var a=this.$el.closest(".js-layer"),b=a.find(".js-Editor-ListLayer-titleText");b.toggleClass("is-hover",this._stateModel.get("highlighted"))}})},{"../../../data/analyses":599,"../../../data/layer-colors":633,"../../../value-objects/analysis-node-ids":1119,"./analyses-tooltip-error":723,"./default-layer-analysis-view.tpl":728,backbone:"backbone","backbone/core-view":1127}],728:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-ListAnalysis-itemInfo u-rSpace--m CDB-Text is-semibold CDB-Size-small u-upperCase" style="background: '+(null==(__t=bgColor)?"":_.escape(__t))+'; color: #fff">\n  ',__p+=isDone?'\n    <span class="CDB-Text u-rSpace">\n      '+(null==(__t=id)?"":_.escape(__t))+'\n    </span>\n    <i class="CDB-IconFont CDB-IconFont-ray CDB-Size-medium"></i>\n  ':'\n    <div class="CDB-LoaderIcon">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n  ',__p+='\n</div>\n<p class="Editor-ListAnalysis-title CDB-Text CDB-Size-small u-secondaryTextColor u-ellipsis" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+"</p>\n\n",hasError&&(__p+='\n<div class="Editor-ListAnalysis-itemError"></div>\n'),__p+="\n";return __p}},{underscore:"underscore"}],729:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../../value-objects/analysis-node-ids"),g=a("../../../data/layer-colors"),h=a("../../../data/analyses"),i=a("./ref-layer-analysis-view.tpl");b.exports=e.extend({tagName:"li",className:"Editor-ListAnalysis-item Editor-ListAnalysis-layer CDB-Text is-semibold CDB-Size-small js-analysis-node",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},initialize:function(a){if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.analysisNode)throw new Error("analysisNode is required");this._layerDefinitionModel=a.layerDefinitionModel,this._analysisNode=a.analysisNode,this._stateModel=new d.Model({highlighted:!1}),this._initBinds()},_initBinds:function(){this.listenTo(this._analysisNode,"change:status",this.render),this.add_related_model(this._analysisNode),this.listenTo(this._layerDefinitionModel,"change",this.render),this.add_related_model(this._layerDefinitionModel),this.listenTo(this._stateModel,"change:highlighted",this._toggleHover),this.add_related_model(this._stateModel)},render:function(){var a=this._analysisNode.get("status");return this.$el.html(i({id:this.model.id,layerName:this._layerDefinitionModel.getName(),bgColor:this._bgColor(),isDone:"ready"===a||"failed"===a,title:h.title(this.model)})),this.$el.toggleClass("has-error","failed"===a),this.el.dataset.analysisNodeId=this.model.id,this},_bgColor:function(){var a=f.letter(this._analysisNode.id);return g.getColorForLetter(a)},_onMouseEnter:function(){this._stateModel.set("highlighted",!0)},_onMouseLeave:function(){this._stateModel.set("highlighted",!1)},_toggleHover:function(){var a=this.$el.closest(".js-layer"),b=a.find(".js-Editor-ListLayer-titleText");b.toggleClass("is-hover",this._stateModel.get("highlighted"))}})},{"../../../data/analyses":599,"../../../data/layer-colors":633,"../../../value-objects/analysis-node-ids":1119,"./ref-layer-analysis-view.tpl":730,backbone:"backbone","backbone/core-view":1127}],730:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-ListAnalysis-itemInfo u-rSpace--m CDB-Text is-semibold CDB-Size-small u-upperCase" style="background: '+(null==(__t=bgColor)?"":_.escape(__t))+'; color: #fff">\n  ',__p+=isDone?'\n    <span class="CDB-Text u-rSpace">\n      '+(null==(__t=id)?"":_.escape(__t))+'\n    </span>\n    <i class="CDB-IconFont CDB-IconFont-ray CDB-Size-medium"></i>\n  ':'\n    <div class="CDB-LoaderIcon">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n  ',__p+='\n</div>\n<p class="Editor-ListAnalysis-title CDB-Text CDB-Size-small u-secondaryTextColor u-ellipsis u-flex" title="'+(null==(__t=title)?"":_.escape(__t))+'">\n  '+(null==(__t=title)?"":_.escape(__t))+' <span class="u-altTextColor u-lSpace u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</span>\n</p>\n";return __p}},{underscore:"underscore"}],731:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("backbone/core-view"),h=a("./source-layer-analysis-view.tpl"),i=a("../../../components/tipsy-tooltip-view"),j=a("moment");b.exports=g.extend({tagName:"li",className:"Editor-ListAnalysis-item Editor-ListAnalysis-layer js-base is-base",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},initialize:function(a){if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.analysisNode)throw new Error("analysisNode is required");this._layerDefinitionModel=a.layerDefinitionModel,this._analysisNode=a.analysisNode,this._tableNodeModel=this._analysisNode.getTableModel(),this._stateModel=new f.Model({highlighted:!1}),this._initBinds()},options:{showId:!0},render:function(){var a=this._tableNodeModel&&this._tableNodeModel.isSync(),b={};if(a){var c=this._tableNodeModel.getSyncModel(),f=c.get("run_at");b={ranAt:j(c.get("ran_at")||new Date).fromNow(),runAt:j(f).fromNow(),state:c.get("state"),errorCode:c.get("error_code"),errorMessage:c.get("error_message")},(!f||new Date(f)<=new Date)&&(b.runAt=_t("dataset.sync.in-a-moment"))}var g=this._analysisNode.isCustomQueryApplied();if(this.$el.html(h(e.extend({id:this.options.showId?this.model.id:"",tableName:this.model.get("table_name"),customQueryApplied:g,isSync:a},b))),a){var k=new i({el:this.$(".js-sync"),gravity:"s",offset:0,title:function(){return b.errorCode||b.errorMessage?_t("dataset.sync.error-code",{errorCode:b.errorCode})+":"+b.errorMessage:d(this).data("tooltip")}});this.addView(k)}return this},_initBinds:function(){this._stateModel.on("change:highlighted",this._toggleHover,this),this.add_related_model(this._stateModel),this._tableNodeModel.on("change:synchronization",this.render,this),this.add_related_model(this._tableNodeModel)},_onMouseEnter:function(){this._stateModel.set("highlighted",!0)},_onMouseLeave:function(){this._stateModel.set("highlighted",!1)},_toggleHover:function(){var a=this.$el.closest(".js-layer"),b=a.find(".js-Editor-ListLayer-titleText");b.toggleClass("is-hover",this._stateModel.get("highlighted"))}})},{"../../../components/tipsy-tooltip-view":589,"./source-layer-analysis-view.tpl":732,backbone:"backbone","backbone/core-view":1127,jquery:"jquery",moment:"moment",underscore:"underscore"}],732:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-ListAnalysis-itemInfo u-rSpace--m CDB-Text is-semibold CDB-Size-small u-altTextColor">\n  '+(null==(__t=id)?"":_.escape(__t))+'\n  <div class="CDB-Shape Editor-ListAnalysis-itemInfoIcon">\n    <ul class="CDB-Shape-Dataset is-small is-grey">\n      <li class="CDB-Shape-DatasetItem"></li>\n      <li class="CDB-Shape-DatasetItem"></li>\n    </ul>\n  </div>\n</div>\n<p class="CDB-Text CDB-Size-small u-secondaryTextColor Editor-ListAnalysis-itemInfoDataset u-ellipsis">\n  '+(null==(__t=tableName)?"":_.escape(__t))+"\n</p>\n",isSync&&(__p+='\n  <span class="Editor-ListAnalysis-itemInfoIcon">\n    <div class="u-flex u-alignCenter CDB-Text CDB-Size-small u-altTextColor SyncInfo-message--'+(null==(__t=state)?"":_.escape(__t))+' js-sync" data-tooltip="',__p+=errorCode||errorMessage?""+(null==(__t=_t("dataset.sync.sync-failed"))?"":_.escape(__t)):""+(null==(__t=ranAt)?"":_.escape(__t)),__p+='">\n      <i class="CDB-IconFont CDB-IconFont-wifi"></i>\n    </div>\n  </span>\n'),__p+="\n",customQueryApplied&&(__p+='\n  <span class="Editor-ListAnalysis-itemInfoIcon Tag Tag--outline Tag-outline--dark CDB-Text CDB-Size-small">\n    SQL\n  </span>\n'),__p+="\n";return __p}},{underscore:"underscore"}],733:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("backbone/core-view"),g=a("../../components/custom-carousel/custom-carousel-collection"),h=a("./basemap-content.tpl"),i=a("./basemap-content-views/basemap-header-view"),j=a("./basemap-content-views/basemap-model-factory"),k=a("./basemap-content-views/basemaps-collection"),l=a("./basemap-content-views/basemap-inner-view"),m=a("../../components/scroll/scroll-view"),n=a("../../components/notifier/notifier"),o="basemapNotification",p={gmaps:a("./basemap-content-views/basemap-icons/basemap-gmaps.tpl"),carto:a("./basemap-content-views/basemap-icons/basemap-carto.tpl"),stamen:a("./basemap-content-views/basemap-icons/basemap-stamen.tpl"),color:a("./basemap-content-views/basemap-icons/basemap-color.tpl"),mapbox:a("./basemap-content-views/basemap-icons/basemap-mapbox.tpl"),custom:a("./basemap-content-views/basemap-icons/basemap-custom.tpl"),here:a("./basemap-content-views/basemap-icons/basemap-here.tpl"),wms:a("./basemap-content-views/basemap-icons/basemap-wms.tpl"),tilejson:a("./basemap-content-views/basemap-icons/basemap-tilejson.tpl"),nasa:a("./basemap-content-views/basemap-icons/basemap-nasa.tpl")};b.exports=f.extend({events:{"click .js-back":"_onClickBack"},initialize:function(a){if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.stackLayoutModel)throw new Error("StackLayoutModel is required");if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");if(!a.basemaps)throw new Error("basemaps is required");if(!a.modals)throw new Error("modals is required");if(!a.configModel)throw new Error("configModel is required");this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._stackLayoutModel=a.stackLayoutModel,this._customBaselayersCollection=a.customBaselayersCollection,this._modals=a.modals,this._configModel=a.configModel,this._baseLayer=this._layerDefinitionsCollection.getBaseLayer(),this.model=new d.Model({disabled:!1}),this._basemapModelFactory=new j(this._layerDefinitionsCollection,this._configModel),this._initCollections(a.basemaps),this._initBinds()},_initCollections:function(a){this._basemapsCollection=new k;var b;e(a).each(function(a,c){e.map(a,function(a){b=this._basemapModelFactory.createBasemapModel(c,a),this._basemapsCollection.add(b)},this)},this),this._customBaselayersCollection.each(function(a){var c=a.get("category")||"Custom";b=this._basemapModelFactory.createBasemapModel(c,a.attributes),this._basemapsCollection.add(b)},this),b=this._basemapModelFactory.createBasemapModel("Color",{color:this._baseLayer.get("color")||"",image:this._baseLayer.get("image")||"",selected:"plain"===this._baseLayer.get("className")}),this._basemapsCollection.add(b),this._categoriesCollection=new g(e.map(this._basemapsCollection.getCategories(),function(a){return{selected:this._getBaseLayerCategory()===a,val:a,label:a,template:function(){var b=this._getTemplateForCategory(a.toLowerCase());return b()}.bind(this)}},this))},_getTemplateForCategory:function(a){var b=p[a.toLowerCase()];return b||(b=function(){return a}),b},_onChangingBaseLayer:function(){this.model.set("disabled",!0),n.getNotification(o)&&n.removeNotification(o),this.notification=n.addNotification({id:o,status:"loading",info:_t("editor.layers.basemap.saving.loading"),closable:!1})},_onBaseLayerChanged:function(){this.model.set("disabled",!1),this.notification.set({status:"success",info:_t("editor.layers.basemap.saving.success"),closable:!0})},_onBaseLayerFailed:function(){this.model.set("disabled",!1),this.notification.set({status:"error",info:_t("editor.layers.basemap.saving.error"),closable:!0})},_initBinds:function(){this.model.bind("change:disabled",function(){this.$(".js-basemapContent").toggleClass("is-disabled",this.model.get("disabled"))},this),this._basemapsCollection.bind("change:category",function(a){var b=this._customBaselayersCollection.get(a.get("id"));b.set("category",a.get("category")),b.save()},this),this._basemapsCollection.bind("remove",function(a){var b=this._customBaselayersCollection.get(a.get("id"));b.destroy()},this),this._basemapsCollection.bind("add",this._onAddBasemap,this),this.add_related_model(this._basemapsCollection),this._layerDefinitionsCollection.bind("changingBaseLayer",this._onChangingBaseLayer,this),this._layerDefinitionsCollection.bind("baseLayerChanged",this._onBaseLayerChanged,this),this._layerDefinitionsCollection.bind("baseLayerFailed",this._onBaseLayerFailed,this),this._layerDefinitionsCollection.bind("change",function(){this._renderHeader(),this._baseLayer=this._layerDefinitionsCollection.getBaseLayer(),this._updateSelectedCategory(this._baseLayer.get("category"))},this),this.add_related_model(this._layerDefinitionsCollection)},render:function(){return this.clearSubViews(),this.$el.html(h()),this._initViews(),this},_updateSelectedCategory:function(a){var b=this._categoriesCollection.findWhere({val:a});b&&b.set({selected:!0})},_onChangeSelectedCategory:function(a,b){b&&this._renderContent()},_getBaseLayerCategory:function(){var a=this._basemapsCollection.getDefaultCategory();return this._baseLayer.get("category")?a=this._baseLayer.get("category"):"Plain"===this._baseLayer.get("type")?a="Color":this._customBaselayersCollection.hasCustomBaseLayer(this._baseLayer.get("className"))&&(a="Custom"),a},_initViews:function(){this._renderHeader(),this._renderContent()},_renderContent:function(){var a=this;this._contentView&&(this.removeView(this._contentView),this._contentView.clean()),this._contentView=new m({createContentView:function(){return new l({model:a.model,categoriesCollection:a._categoriesCollection,layerDefinitionsCollection:a._layerDefinitionsCollection,basemapsCollection:a._basemapsCollection,customBaselayersCollection:a._customBaselayersCollection,modals:a._modals})}}),this.addView(this._contentView),this.$(".js-basemapContent").html(this._contentView.render().el)},_renderHeader:function(){this._headerView&&(this.removeView(this._headerView),this._headerView.clean()),this._headerView=new i({model:this._layerDefinitionsCollection.getBaseLayer(),category:this._getBaseLayerCategory()}),this.addView(this._headerView),this.$(".js-basemapHeader").html(this._headerView.render().el)},_onAddBasemap:function(a){this._basemapsCollection.updateSelected(a.getValue())},_onClickBack:function(){this._stackLayoutModel.prevStep("layers")}})},{"../../components/custom-carousel/custom-carousel-collection":40,"../../components/notifier/notifier":475,"../../components/scroll/scroll-view":530,"./basemap-content-views/basemap-header-view":740,"./basemap-content-views/basemap-icons/basemap-carto.tpl":742,"./basemap-content-views/basemap-icons/basemap-color.tpl":743,"./basemap-content-views/basemap-icons/basemap-custom.tpl":744,"./basemap-content-views/basemap-icons/basemap-gmaps.tpl":745,"./basemap-content-views/basemap-icons/basemap-here.tpl":746,"./basemap-content-views/basemap-icons/basemap-mapbox.tpl":747,"./basemap-content-views/basemap-icons/basemap-nasa.tpl":748,"./basemap-content-views/basemap-icons/basemap-stamen.tpl":749,"./basemap-content-views/basemap-icons/basemap-tilejson.tpl":750,"./basemap-content-views/basemap-icons/basemap-wms.tpl":751,"./basemap-content-views/basemap-inner-view":752,"./basemap-content-views/basemap-model-factory":754,"./basemap-content-views/basemaps-collection":766,"./basemap-content.tpl":767,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],734:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-selector">\n  <div class="Editor-HeaderInfo-title u-bSpace--m">\n    <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.basemap.category.title-label"))?"":_.escape(__t))+'</h2>\n  </div>\n  <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=_t("editor.layers.basemap.category.select-category"))?"":_.escape(__t))+"</p>\n</div>\n";return __p}},{underscore:"underscore"}],735:[function(a,b,c){var d=a("backbone/core-view"),e=a("./basemap-categories.tpl"),f=a("../../../components/carousel-form-view");b.exports=d.extend({initialize:function(a){if(!a.categoriesCollection)throw new Error("categoriesCollection is required");this._categoriesCollection=a.categoriesCollection},render:function(){return this.clearSubViews(),this.$el.html(e()),this._renderCarousel(),this},_renderCarousel:function(){var b=new f({collection:this._categoriesCollection,template:a("./basemap-carousel.tpl")});this.addView(b),this.$(".js-select").append(b.render().el)}})},{"../../../components/carousel-form-view":23,"./basemap-carousel.tpl":734,"./basemap-categories.tpl":736,"backbone/core-view":1127}],736:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">1</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text js-select"></div>\n</div>\n';return __p}},{underscore:"underscore"}],737:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=650;b.exports=e.Model.extend({initialize:function(a,b){if(!b.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!b.basemapsCollection)throw new Error("basemapsCollection is required");this._layerDefinitionsCollection=b.layerDefinitionsCollection,this._basemapsCollection=b.basemapsCollection,this._disabled=b.disabled,this._generateSchema(),this._initBinds()},_initBinds:function(){this._onChange=this._onChange.bind(this),this.bind("change",d.debounce(this._onChange,f),this)},_onChange:function(){if(this.hasChanged("color")){var a=this.get("color").color.fixed;this._updatePlainBasemap(a)}},_updatePlainBasemap:function(a){var b=this._basemapsCollection.find(function(a){return"plain"===a.get("className")}),c=b.get("selected");b.set({color:a,image:"",maxZoom:32}),c?this._layerDefinitionsCollection.setBaseLayer(b.toJSON()):this._basemapsCollection.updateSelected(b.getValue())},_generateSchema:function(){this.schema={color:{type:"Fill",title:_t("editor.layers.basemap.style.color"),options:[],editorAttrs:{color:{hidePanes:["value"],disableOpacity:!0},disabled:this._disabled},validators:["required"]}}}})},{backbone:"backbone",underscore:"underscore"}],738:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./basemap-form.tpl"),g=a("./basemap-form-model");b.exports=e.extend({initialize:function(a){if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.basemapsCollection)throw new Error("basemapsCollection is required");this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._basemapsCollection=a.basemapsCollection,this._disabled=a.disabled},render:function(){return this.clearSubViews(),this.$el.html(f()),this._generateForms(),this},_generateForms:function(){this._formView&&this._formView.remove();var a={color:{fixed:"",opacity:1}};"string"==typeof this.model.get("color")&&(a.color.fixed=this.model.get("color")),this._formModel=new g({color:a,image:this.model.get("image")||""},{basemapsCollection:this._basemapsCollection,layerDefinitionsCollection:this._layerDefinitionsCollection,disabled:this._disabled}),this._formView=new d.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$(".js-form").append(this._formView.render().$el)},clean:function(){this._formView&&this._formView.remove()}})},{"./basemap-form-model":737,"./basemap-form.tpl":739,backbone:"backbone","backbone/core-view":1127}],739:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-selector">\n  <div class="Editor-HeaderInfo-title u-bSpace--m">\n    <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.infowindow.style.title-label"))?"":_.escape(__t))+'</h2>\n  </div>\n  <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=_t("editor.layers.infowindow.style.select-style"))?"":_.escape(__t))+'</p>\n</div>\n\n<div class="js-form"></div>\n';return __p}},{underscore:"underscore"}],740:[function(a,b,c){var d=a("backbone/core-view"),e=a("./basemap-header.tpl"),f=_t("editor.layers.basemap.custom-basemap");b.exports=d.extend({initialize:function(a){if(!a.category)throw new Error("category is required");this.category=a.category},render:function(){return this.$el.html(e({title:_t("editor.layers.basemap.title-label"),description:this._getName()})),this},_getName:function(){var a=this.model.getName();return a=a?this.model.getName().replace(/_/g,"")+" "+_t("editor.layers.basemap.by")+" "+this.category:f}})},{"./basemap-header.tpl":741,"backbone/core-view":1127}],741:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo u-alignStart">\n  <button class="u-rSpace--xl u-actionTextColor js-back Editor-HeaderInfoEditorShape">\n    <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n  </button>\n  <div class="Editor-HeaderInfo-inner">\n    <div class="Editor-HeaderInfo-title u-bSpace">\n      <h2 class="Editor-HeaderInfo-titleText CDB-Text CDB-Size-huge is-light u-ellipsis">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="Editor-HeaderInfo-description CDB-Text CDB-Size-medium u-altTextColor u-iBlock">'+(null==(__t=description)?"":_.escape(__t))+"</p>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],742:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAA4CAYAAAB5YT9uAAAAAXNSR0IArs4c6QAAB51JREFUeAHtW+tv21QUP3HeTtykTdt1a9d1GxNIwBAggRD/O1+RkPgAQhogNq2dlnVdm+Yd23lxfm5v5zqO48dtfTX1SpGvr69Pzv35+ryd+f3Pv+akYGuevKfPHx/Q7s62NO6mpkVjy6JSbS0xTXs8ppFpUrVcpsl0Ru1ej3IZjcp6mfRy6Yp+7qqnWKdULEoFF8vLloo0nUxp0O5QpV5LtOIJ08lqWRrwQ0O7t9lg2hPK5q5Dev0s0V/Ku3kyndJGrS6PoItSoaqTeXziGonXBY8VfmBuQN19QVUTHZWO/eGA9h/cU4mlBV5mDLAfoN6JSgIMJt1yzMt0knO8xrlCMQkJ514tm6X3p2cr6SgHMF697cb6SsbjThictkjfSCZ/8d9r1QrlsznqD4aOslvGj3IAdwd92ttRWzwIMMvlImmaRqPhhaIT4+6jckoun9WokM+7eYzchxjATvW2DGv9yuaGdzj2ebl0YY6Zl5aEHyH1AM4nZ0konzWJNrQfeBizLJsKheUbQikRcd7p0MGDB8vWEmkcdm5Xgjm26k+LxQLZ1tixgf3mKgNwq9Nm02yH6hK8LCwUTsVtgbzBSrPTHRC8O9GGI9PpJn8fBcWYx5OzU+fO/d37tCNRPoIoQL6tBpBbrQ6bgDma2BMa2ZZjaqYOsFGt0nrNoINdOaLBCygUm58L650n4xwgQyaXWGxow4xDMnURUS6W6LzTlbE+XxrGdsPXovCdLGEQMjmbuQAX5FIHGEwUJFgOoBPU7P4w6LK0a3hbII8HLIPRTx3gdq9LTx7uSVugHyGYa2a/T4Oz86Xa3u++OGOd3oAgKkSYNXWAs1qGhMHuXtAqF9Q9N0wfIJdY1vs5IGHuDzMHPNuTsSOHMR/2eOpKTmMl5G0IZMN4T+rReekKB8Q7LvO8qusEOSxa6jt4NltMqHR6fengYsEQEUkD7QI4v2O1orPsHV2zh1MF2LJt2mpcD6y3zjv07+sjP/4TjUHhTNkRuEnbuNsfOOLO/ealCnCn31uwf9+dfqAJg+H2ihIhyzdbrNWH522pgR4/nuBgIIzpbqnLYAStNzluMGID3bbH1O0NnWSnexe4GY7Tt60RGVubcW5deQ/ejHanxwotS9m8tuDUZNLMKk9nYzI5UGJaphO4/vn7b6UrNwAwZu0uI5PsRRu0YfNWDd3RGfDi+iwm6mytCIWa6g7OanmqlPHTWXbp1B8OaadyfadhEYJZ7wLDnI/Z4Nc48yC7IZhjjiyqrVWu+IP1kON4do8fKJT3xnotfUdDLFzn4HWbd4Nor982nZzX4btjMRTraPNikUmW2aAfEGSHQ+F9+DhHRLBmVOiMrRb5jzbmSs7aLVZ4uwRgm+8/UI89r7379xwR0qp2nN0Qk7TU2+BMQAljdwa1C6ANSlUGuxlEshPp+qpe4dfswvlAAP6n7567p0XuQ8TAe5OV3YAZuQpcN5OpmmluRgBq3Vi7AhfXZvOpe0qsPnZSiUOipqSIXY4DU1FMSGUA9kMvw7Ve2IFJG2SwfZlhQH0atH3chmoeuPJhmzIyOCzDcechmyxydJpRdcypRoj6C2GKzeczyrOVgIoev+DUMr7U3sGUWdDSyxayahyiQshhxAyQ2oE8xS+oweSCKQZwx7zzda6edAdzgu7FNWV3MJTeei1YU69anLiOXWiyt4VYROGytLRmGM5lXIM5RRw2ZaFP7l0NUYBqTOfhVBkqjxss6AcdlQUYydAfnn8VxHvoa7AiEEXzC/QAPAEqlJd7R6NyR1wL/WeeicqYaR6+uKh56tjCMsy0m3KVvTz7nSsrg2G2ZS/tYT/Gw45h995EHCLs/ysLMBYwntiJzDRYDTJr0cKC6p6nNMAWhy+n88WMh3sBy/pQXlBokLFpNqUBbtTXY6eOhlxlk2dzLO2mNMBDzm/FbfNZuBL/uPTD3qc0wBnYpjEbzLLbKjYJYlFpgEvF5XW3QYvCNdi81jD+G7CKftjrygKMip/He7th1+E7D2Ii7aYswPCq8BXlTbQOf5V5Wy1dGyZglQZbAElMLDwgwNh8eUimPaLpdO4kV/FFZo5NNxGLCGBByiUlAe4NBlwQ+LFeuM3BclQrbnF4EaWhq4AXaScgtFY1qFS4eBOQXEUu7bD5mgacYP3i8cFKWklRVjIWgUDPj998TW+Oj+kEiUPOCussLpCnE1kOBOPzXIvw9OHDqxQOdu0fL/7hHZon1B0HNcQ6ulz48uWzJze6m5UEGF/aF7n4r2bUrqWQ/AA7ar6lCsdoSwwo6isa9WifaUGZbnIC87NH+37kE48pCXDUVb08OqT6mhEZXPE/qJErFgr07NGu8/U8PgGQVVmkpAwWCw97fLr/yAlvhp3vnQdw8ZXTyNpaqC3zzo16rqyZFnUhItUf9T73fJTNym6fDMAygBFl/zJoCRp3AF8iATHx3+FRpJS8ADHoeAfwJTqwkbv9Ef3y62+RCkuCwD3jmuRPQskFLTLKNVgO+DByyEGiQi16oAmAvnrTpDzXCc/nGcepuQPY9QSEooQrHaX9ze44ihcL+SIZlY8V7nB27kSEB8ntjQa9ePnKM7r8FG457Gg4OG5wxR3/AwJZx54EdH2PAAAAAElFTkSuQmCC" />';
return __p}},{underscore:"underscore"}],743:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="23px" height="25px" viewBox="1383 664 23 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="color" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(1383.000000, 664.000000)">\n        <path d="M19.04725,12.691 C19.12525,12.504 19.08225,12.289 18.93925,12.146 L9.93925,3.146 C9.84125,3.049 9.71325,3 9.58525,3 L9.58525,2.5 C9.58525,1.122 8.46325,0 7.08525,0 C5.70725,0 4.58525,1.122 4.58525,2.5 L4.58525,7.793 L0.73125,11.647 C-0.24375,12.622 -0.24375,14.208 0.73125,15.183 L5.40325,19.854 C5.87525,20.326 6.50325,20.586 7.17125,20.586 C7.83925,20.586 8.46625,20.326 8.93925,19.854 L15.79225,13 L18.58525,13 C18.78725,13 18.97025,12.878 19.04725,12.691 L19.04725,12.691 Z M5.58525,2.5 C5.58525,1.673 6.25825,1 7.08525,1 C7.91225,1 8.58525,1.673 8.58525,2.5 L8.58525,3.793 L5.58525,6.793 L5.58525,2.5 L5.58525,2.5 Z M15.58525,12 C15.45225,12 15.32525,12.053 15.23125,12.146 L8.23125,19.146 C7.66525,19.712 6.67625,19.712 6.11025,19.146 L1.43825,14.475 C0.85325,13.89 0.85325,12.938 1.43825,12.353 L5.38925,8.401 C5.42025,8.377 5.44725,8.351 5.47125,8.32 L8.58525,5.207 L8.58525,10.5 C8.58525,10.776 8.80925,11 9.08525,11 C9.36125,11 9.58525,10.776 9.58525,10.5 L9.58525,4.207 L17.37825,12 L15.58525,12 L15.58525,12 Z" id="Shape" fill="#AAAAAA"></path>\n        <path d="M20.01225,15.241 C19.83125,14.942 19.33825,14.942 19.15825,15.241 C18.89425,15.674 16.58525,19.522 16.58525,21 C16.58525,22.654 17.93125,24 19.58525,24 C21.23925,24 22.58525,22.654 22.58525,21 C22.58525,19.522 20.27625,15.674 20.01225,15.241 L20.01225,15.241 Z M19.58525,23 C18.48225,23 17.58525,22.103 17.58525,21 C17.58525,20.225 18.68125,18.061 19.58525,16.485 C20.48925,18.061 21.58525,20.225 21.58525,21 C21.58525,22.103 20.68825,23 19.58525,23 L19.58525,23 Z" id="Shape" fill="#AAAAAA"></path>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],744:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="22px" height="24px" viewBox="966 769 22 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <path d="M973.5,791.5 L966.5,786.5 L966.5,770.5 L973.5,775.5 L980.5,770.5 L987.5,775.5 L987.5,791.5 L980.5,786.5 L973.5,791.5 Z M973.5,775.5 L973.5,791.5 L973.5,775.5 Z M980.5,786.5 L980.5,770.531 L980.5,786.5 Z" id="Shape" stroke="#AAAAAA" stroke-width="1" fill="none"></path>\n</svg>';return __p}},{underscore:"underscore"}],745:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-upperCase u-altTextColor">Google maps</p>';return __p}},{underscore:"underscore"}],746:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAA4CAYAAAB5YT9uAAAAAXNSR0IArs4c6QAAFuFJREFUeAHVnHlw3dV1x89bJD3tq/Uky5YxAowx2BgabKCFEJhQpswAmWb6R5tJykySJm3TpNOmZdopkE6bTDvTkK0kKdmmnZBOoaFpAw5tEnANttm8ETBxjFfZkqztaX3v6emp53N+78hXwisQoZ6Z97u/u/zu8r3nnnvOuVeKfW5LYUYWiBqqEufV0oeuKMyWn57Xy2w2J6lUhRTyOSkURcYzwxKvqLDyjQ0NkoiJ8A3lCoWCjI6NyY7tr8n6DauktqZGpgpTVrYyVWn1zDakL/4taWNj41a2tqpS9h3fL6lYo5TLlMTLK2Q4NyDlVUmpKqY0rcLapxz9gSazk5KMXhfXs6I0D7lcTpI6EEBKxsXeC4VpyQz022AYAFTUchBgAebQ8LDFAbq6skLGtRigdl2yzEC+4earrSwT5GD6hHmcCnhnIvLa5ujEpKxMd0kymZTsxJjVn0otlbJ4TFJVNdrHrNTUVFtfyaRu2l6UAOemRa6u6ZPMYE7qm5qMO21EpQecOj05IbEy5djpglRUphT8lOUCSFmyzIAgAS5mcjRBVqzskNGRMek+0mvvnk8IIGGc9/HJaOLqdXKYOACDMpNZqW9skPrSiiGtoqza2uI9nLhFCTCdzFY0S2v7jHUaAKGcDszBHFeuTcxMS6q+YRZMuAiCkyDnRlZBQVcB1NczLCu7OiLQgzLkeXnenVgFEc2dAOqEXHTxLRROFGmLFuA1LQXtfCQrnDtr6uptEAO9vSYiampqFdzE7LKEexETIVAsfSdESkWqXOrrlCNVTlaUQPF8wEKmSzxp9cKxuSldTkoVZSf3D1bQ8Ik+aVjSankObtguGbZ6rMQifFSVJ6yDYyMZyY6PSyye0MGn7D1RWaUytdaWLQAjF0fHRiPRoOIA2Q2AhXzWRAcigvhL2/fK9Teul2EZkoZ4o9UfggMMWf9O65wsH5bGZNrQcU4lAlczySO2F1TaipkPrn2kD6TToiPf5AZ6jstUcUZa2pcaxwJ0qrraNjVkIprDQP+AAR1XuQsHZ/MFA9N28JJcZoDjqkXksnkTDTXFRqlQLnRwLV/l7eDouGGBiLENKhaT/nyPpc1/wMXl1bWSG482vFnuLxVk5VD/gomI8rJ563F+j4P42nQke5vb2o1TyIJjk8o5dBxZPEu6yQEmomFSAc4MjcjP9hyQwpQCPT0tRR05IbT6ss453EsaWgmrwHb9WCRXTSxoWm2sVWrLxUBmUlgplEWMwMWsLq9DitHEOqDUZ1qQlViAR1zmKbJnaPOiurzmJmYHQFFkIFxCxxEVrvcCLO8obKhrqfK4gYu+W6zS3V4aJKOwlmt9sVRScjIhQzPKycUKaUmkJaH1AqjLWNoAxJBayttsYmfTVUYz0awuOJn0bDbS2V3mm+ailZyziKiIzwi/N0vZSK8/58+dU6tVS0DZZ+BObHbN6bRxLeBCAI3qRPn33LpBnnlqt4wMjRu4zQpQpehyVlDS0iFLKjoNXK8PgKifH8s6FB3+jsiA253jAZA2mVT6Stw1CFfn0DTigHbiZ9t0Rk/utt5wGOYnRmTzV+87a7nwmzf7jiI/NjQgeeU3liWylYGFg+edTQwOQnVjcK46Mdg733eDHNs7Iql8jXWDSemoWyGTZdGydkAdVApRp6c7sMQhQudgAHVrrb65xUQUZUhHXPX19JomYsCPD/fJ9n/5B7nxY/dLbedqyp2WThx4VWaQZ+fM93OrGp6YlrOZy3d1DthHuWrdsHTh904ctfZayhpmOYwCDBjQ2M1TOkgIUCIREjFLorwo2cm8zNQNSTKvMlQ5qiynqp6q1SGAIYie7vV5HnEDDDms4+/tHZTnX9ghQ5kRqdANNpGIS9fKZbJyZadWHll7z7+wS5I1zWn59Xu+JIQsYzg6FrRyqqWdKqM5UbBnJFfUUZWI9PpUJL9UPKmM8hxRk1JxOllUPB+NoaNyXK5uUw7RMpnBCaluaJKO1IpZjqI74UA93n/8mKSXLp0FnjLkIQ3hsPql6j/4xQHZuORqS2MDYvliofly9qH6t95jb8/bcu70/K1bn5Ply1bIjTddZ+ohm2vfRI/MpIoSU3lcX98sIyq+koB06MUfyyW/eqfa1FXSf/A1OfLcT2VKd8r69k5Z/q6bJV4ZKfhUPnz8kBx98Slrp33dddK2ap0BTcJxTX9x/x4pT9XKqg03yZIVXYLZG5vKykubfyida66Vnz/zuFpVWblow7tl2arLrZ7yYl5FwqjpuvqInCSskpK1ZIX0EYKBCof65kCEIZyK5VbXVC0Dh4Zl39G9srLtIpXlBdNZATesy+snpB7Pc3BJ9wlBZGXU1zE9XZR1V622dMqlUmquM6twkSo51FOtalx8upCXV598TIqTo5JR8J596LNS075C2i/fKHkFYmo82kRoBNr56NelRtWnZHW9bPmnv5Ge13YZxz//8Bdk75YnZWnXFQpwpWz60r3Su/9V49ypXFZ2/eC7svkbn5OG9FL7/keaP9LfZxOwd6LR9NvWtrQg03CgZIaGZwfq4NE+74iF1vZ2onMoBIbV0FTWKkn1VwwcUf1W1SjAMUut9FUIZlgRHA7Heuh5phvrhhjXX2EqLwMnBj3LwoQaQ7EhBViJ7yFX2ywy0ntcKuuaZOU1N0tSN4/lV2609FBMXHHHh4xrLWM6Jwef2ySNLW1yeOez8v77HpS6lsh8zKuw3/mT78utXSfl+jV3fVA6r7jaPj26Y7sce223rNx4i8WRpwwYAwJi43IACCFCA1cnIqSQ0/wdLq7VQhuvvVq2bH5WNv90l1x741pbzng2Ejq+cEJc9yUNbsUjh9OovvakE8f706LayuVXrJUtW7ZJc3ODLFveIcs6tE8zMzLTKKoYRvJ+ulicu121r16v1kmdPP7XH5Gnv3Kv7Nv8mBRUDQmpcekFJqtJq13aJaPHeyQ7qBNT22jgIhKgTq1r9PCBKFJ6pi+81DiWaFlVSsFE351LDA6wMSacCxi0/yjNQFHiXdEnzcHiHY3DQl2xcPLGjVeZH/jV3a+bIcJKpg5+cCmhawjEIQwJB/dUba9bv1ree9tN0rykWY4e6Zb/eGyT7N11aBZc788sB6OmYj7e+Pv3y9hArwwdOSB7n/xXGVNZt/quj1mjPBJqfkY8ppvY5JhNSIXK7mmVsw4u5SZGhhTFSl5nKZZImLnBBhfSBy73GqNUuAcOdn3SywIEei5cPFNUjaS52UBmQiAGBfCIF9OJcdZoHPmYUxN6eGhMrtnY5NVZedqgXojvpyoyMqkdbIxHq8SB8nybjNLewCS0XBVpN3t27JLde/bKmrWXSqPme51xNXyMUAxyo1r50AnTKBAPbWveJZMTc2Xw8Vd3CNoCZQ9u/W9ZesV6aevssjr2bXlc0AqQ3cjjzis3mLYQtXD6p3Ocl0AGh0RnvcOu+6I9uC4K4HBz77FjyvWRrxYH+ew3yrEH9nfL6vUXz1Y7HziPF3SZn468Pi/r5ZDrKy++SCa0zWHVJsj31TfLwRQeOnZQXvzeP9p35eqxyqtTe8MHP+X1WPj6M0/IjkceVBAnFcDrZOWG22SmrFxu+vCfy+ZvPyC7N/27cXPrqstk3W/89hxVbU5FQWTfJ74mk+oEh2LLl0jnve8XNjy4D8Bsh1aucJEwo5smecZ9KlLIh+rrIznOe1G5mJWApQXXZ4Yn1A+sjgUlN0gsMu+B+QyQgOSAUiQElfR9r+2T9g7dsNUxxETvffkVqdLjoiXNUR9c64g9sP2NZ3KICKi6odU0BDY5131Jh3sRFWyEvgGma9WmV9GXG+qTWEWN1NZWzdF1+Q6iTKgTE19zz19IvjtaKeUdDbLioY+bPhnPxrSulIGESKhpbDZQsZQQIQA6nxwUJsPkuAK8a8dBVakulnQ6Eg+IwpD8G9IcyDDN0z2NiXvxuR0yMHBydaNVvPumG6Szs90mhlW56fH/kaQDFDaYrIvkT05nRvgpzSmXqo+UeQR3iXpHo40lVdNsjpNQHofvFA8NkAtrIheh10OIsg7VNUZuxUwmMm9dJuOHgHzAvM/nOHPSq1Nm584DtsEtaWqg2Bu4lzocVPLDOokDFBugO4TIR/be8t6bTAx0Hz6uKyguKZ00Vop/zze3vPfdc9U0KnyrxERkS6cAXteZzOPXx6pleVNa6kqFK5enJd1wUsdFFJhPWFUj77zXSzgf2DCeU/ECAQjkomF+PR4PgbYP+EaBcvJyxHFA4QtecUG7KQf0k801Gde2dGJ7i4fUKq56+wH2zoQhgKeCI5cwj/cjf/oJS0KbCAHifXhgwLQFCrCZOEj2gT7CQYcAoZ5B7mSPYiefbEIuJz01rMs3KdcyANrrZ0UhftBU6A/fERIHZKiiscrCUjfs/Zf2mCNeztBKCK4Xwxym00P9/Rb6wAlZvh738oRurR0+0KOnx5E4CfN5ZwKsDp00uNHJQSTuExCmubhCTM2fbOKkA7QMFGVa940FAZjO4knjdyZ66nDUnd5st3HLcLFPhoq91unGlhbrOP5fgIWzcJIThgA4F7KzDw6OStvSlll1LmwbMIzLdTmbJqB1hhPs4Hp95Dm4rndTH+lh+6SxicIYyUxSYgt5s4fGzySPyQ8pvNlDOoNF5438v5FqNp+LGCzyEELF2/T4c3L7nTdYnIcDx7vf2nEZ7UA5qJQhjTgh2gvc6VpIWC4sG74vOMA0/lZBHhsaVMtsShJqkEyr1WWA6+0a5CTLHhBRpSZGRuT48UgmXr5ulXGsGyf0IwSbuAPMu4MXpsHBfoXAZbNrGd4u3zrx7RxDwzMWfagmtyp7s/cS0Hkz6pnDZGcHHxvJSkIPQ9NqrFTV1cnWp3fL/sqDNqy2dHSsFDmV5urD4bgBx0FmRbBS0GbUwjKQyXNwCX2yABrwnRYc4PPhXjrpg/QBu4hgM3HuQibyM8uNYyTl5EZ1e7LZcRlv3foL5NDBfpnU041Jdea0t+ekuTVtAPlh6qnaAiw/82OVYBVOqXx10PgW5xDgOgczcZnRyDVKnQu2ydEYNF9HjlJP/4Q76DxAA67t0mrBObh86e+4EZtbmu0wMqwRTl57pTr/9V5Ex4q0nuOpWyDTa5cIfQJpw8lclxoBXGQu536oZYBMuW1bX1QX6DbpV+0GcOkjhEzH5xxtmgXL88mwAgvxQGULze6ztYlcdWUfSwmuxJfrBEAOsKfZoLUcdGJwWF7ZdcDeGxrVhNeLfJmiggUwkwWbNMvUB9cBkLEsceQt5jkyOxMbkK62LnnggW/Ik0/+r1y6aoXeJJqUo4e75b77/0x+ZcPakvyP5DoriZVDuKAAn694cMPDAWDgeMzwpDnNB9fTAYYT3j0v7ZeOZc2y6tIL7NYPHKbH1RHpPGVjkbVXVZOS0RNqkk9k9fhq2m5uZqpHJBfPqtc1Ji/s3SE/euIn8pmv/Yl0pFulEFdHVIaztzrjakQDnJtRLmZCqmIXmAW5YACfL7gg8M8vJwVVDS5laeKq5I6aL+sIpYiDQ6Api447MTqpg04ZuMaJxX41Xyvs+J5vu0cOKcdGEEyMKVc3qijAvIa7lcuZiKpktZDX09ujjq8ySTc2aT8KMqVuzVR90oyJntxRmc5Pyw8e2yMHXj8kra1N8r7fVHVOxdWCy2AH5VxC7gizgyN7ARcyK6n0MaCGwJLsVhx31LY+87I62NfYMgfwzvoVpS9VBuvynZopyFh+1H5wMBdTADyR1IqVUnpdBXDJW3vlZXprKCYP3PdN2b3zFamp1CuyWa5RFaQx0SZf//x3ZcdLu+X6X9soWfVufeqP/sqYYsH04DfDwU1lU7Kxoc9ADQ0KQD2V7O2f7pW8Dljvq8jL247YTUqz1hQsODjckFxnJp+6qbM31zMLbmW+wcqzcWWU87kddKB3vzzy8H/J7u2vmkZy623vkQ9/9HdU1+6VP/zYPfK9R/RAGP+wyv+7f/eP5SMf/cDCyODz2dSMdUqPwaky0xqcS+eLhrAs79Pq2uZk98RwdNrr4GJ5JVXMQMhKgIYIqdtVLe6gOalL3ziwTP3RVQm1GlVc1DVWy90f/y1p/mSbcusuefAr31FpktBLhZfaZ5/8g7/0z2VQfcU9x0YXCuCTLr/ZHpzjy+hMn1QWIh9z+Ml80Ilzmsvd3+HuMWlqjbxZzvnkM0EOLnU5uP5OPvI7NBSyenpSmYy4ObwMc+1118jhQ92yddvzqkVcJZWV5fLlr37OJpD62Ez5LYgMPl/dlw46cUY2Gu9/w8bm+WHIOdzUUF7vAo9La5ceCqhYQEcFuLNyf4nDmQA/Wea9QkEiBHh0X/dzIAZeeH6nHtcvl9WrV1k3Nj3xYzuJRkzY6tG7GIteBl93sXKwykO4isG5LHVg4ULSM4ODEtcLL9Bgn/KxHj52reo0fRQRcSaAmYTIdI44/Jvf+r709+upuFJLS6N8+O675OevHZTP/u0XpKenTze9Ot38RuQi1Yfvvf/TgoGzfdtu+bu/f1BvOSnHq8lerueUD3378wsjIuho6Ko81w3vssoekRG9/5sbVqsquoxCXYXSxgQXDZSArdcLL2xcpGXr9EKM+oK5XgpNqArlf5LAhEAOuKl0JS6NcvTCtYKb0b9GcqJs1yUXyLe+83mz3jg5rtMLKViNXt+GjWvl0UcflKO64UHL2qPD0wXTg72zhOdyy5JyW0aWy11NGb0zV6lLVE+X1WOG/Y+VlVNgucfGLXhAda2A72r1UsvoyES0TDXu4JI3n1j+DhJA+ntYjjSfELiVX0j+HSGuT+r08u8IwGHnzvSOJZfNJmVcVa96debAbRCOHcBmWXsacrdeZR/6LVeeIGQyJqsDQBpO/IZ4qwEZpjsglEEsOPl7CHxY1suR5j4JTyNc1ADTQbghpX+mCvnuzmDgZPdRkJfTm5MONhe22zua9L6fngirjguhI3PnISTnTEJ+XgaZGxLthQB73nzZTX/4eb2Ue0cAfrN6sQ/sVIOFe21Aph4l5Lrrr7T4t/f4EDtKny8187sUeQNwzuGeT3iq9kh3QHkPKZwQbz3M/6W/n+mE+VSNhwP0zhM6xyIqzImjH8Px6M4N+hdCJ8GdW6un335ZtyT1T7UQGXCvv88tPTdGu05wcLiKPO4cTPi2qGmhVhBqC96R+WFYfn7em4mHZ3cO3vnU40D7NwAeUjipng54+I0dYJ9sJhhi44XeEsCnAupsAJ/qG+vJO/y4c82xOT0IQXaudRAp6Ho5Mt5UQ92IMTAg4q6vv2lLbrECZSN8Gx8OLhxr5q8iBpdi7QEuoAOm/ZWpvls5QFex1at/hXreAAPs6cD9/8q9zMdjPzvpxId7AdZFA6BBgAaY3NtwR1KUE/3NHMBzjAToTEb6fP3BpwOWRt6Kv8E7+U6HgOyiAVD5OQcTunzFY9ebVSszoBzg66bnRFlON86bg72C+eG5Xo+a/91ijzv30k9/xzEP2YmIIgg34xTiL/6d4GLSzklNOxPnUuHZRIM3GpZDFz5fdc3rWejQufjYZLc1zakHJxlZnE96pxvRcWT8kNTpKQeOeQgRYeqjxU7xOBuofBICdooqzpjk11zPpZ0zVvQ2Z6LmoVG4qKB6OJdNjeOl/FBRl35GuTMldfoPkg71d+vfnRT0PkpMkstr9O87JmdN9X2jlafm4HOxtN4KuCEm1LPYuDkEl77CwWbI6KnG0088LT/8z+02BP6MoqxML/jpYSj0xS9/Rv94My3/9otIXSPtDXrw2Qb7dgFL46ejxcDVfppNH32z83/Owb9E6Ci/UH7vI5+W22+/We6441Z5+JVI2nK7Kvwbnv8DhIvVBPHl9tUAAAAASUVORK5CYII=" />';return __p}},{underscore:"underscore"}],747:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-upperCase u-altTextColor">Mapbox</p>';return __p}},{underscore:"underscore"}],748:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-upperCase u-altTextColor">nasa</p>';return __p}},{underscore:"underscore"}],749:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAA3CAYAAACIN427AAAAAXNSR0IArs4c6QAALs1JREFUeAFNnFmMrel1ltee56HmqjN3t9t92u223Z3YcQgWYFBsUIhCCLmIUC7ghgskkAL3RtxwgSIFReQiIMQFFyChKCiRAIGQCDgeSLvb7bZjd58+Q52h5trzPPA8X3UFdndpn9r7/79hfWu9613DX5l/+MHz9WK9isl8FqPpLKazWcz48T0iG5VKNRr1ehSLRX7LRCaTiXqjEsvlKsbjUcwnsyjkclGt1iKzjpjMprFYzKNSa3B/xGgyiWK5FI1Gg/En8ez0LBa5YgynoyitljFajON5fxin60wMSszDvJ/LLOLtGMdv/sJXY/zOf4tH//sPo11bRX1vIwqspdNdRjZTjGqjGYVCKZbcWyiXWW6eNY1jnclGPp+PUiEfOda2WsxiwjpW83lks9lYThdpP363WCz4mbGfZSx9Z/5sJqJRKaf95JBNOVeIOZ8Pe91YzhdRypeiubUTC+Y6Pz+NfKmY5usN+jEaDWK1WjF3MUqlUuQVgpMquOl0Gp1eL24c3EDg05gvVnyXixED9Rh8vVxHvpCJ3mUg+FJstreivrXJwhcMPOLafOxutINzQLBzBs5wXSvOLjrx4Ucfxng6j3J7I1q3ttOG+oPLGM/ZOKtolqqRY+GZxTSWLPJLX/5slGIaH3/8o6gyZ4F1HF90o7LOsfhGnJ92YrHMxEuv7ESwmX5/EGs21m63EXYlZuyl3+2kddVYa7PZjAWHf3l5GdusWyGoSL67f4U9Wy9joZKgCGuUZDmbhwJu1Rtp/ut7psNhsOkY8j4cDaPMfJPpMAb8riLl8tko5laRW04UfCGGEzSR03WSaqMepWqFzVUU/dVCxpMYrdexYNBAcx1gNupHj8VllmiwWjGZxozf16sFcs0z4RhtZsGBpiPYLNpUXGdjyqE9PbmMyWoWVU5isVqHJ3/OIa7y1cgO+7HZPYtXb/98zAdPY3RxEu2Yp8OeZHJRzBcjk8vHwc2bUSqW0+ExRNRYd5a9nJ+fx2yxjI2NDayqmjRUxVEBivlc1LC0sdqMxqq9Cq1QYFwsNJ/LJGFHfxlsJGn9YjKODBNUEeIaGWS5pnt6gfb22dk6KqVClIvrGPWxnNk4cqtS5JAb+pve8yvMFAuLXLEQjVKZTa/j8OlhMutivsykTM6GNjc3k9oXssu4ubsZ/d5FTIYTFoQ2YyJ1Fr5AeGqFp6rmaxVrPlOrDu7ciuFgHA/PL+Kj0/Moo1Wlcg7zXsclm1ixWfAhVgiiXspHA+EfHz6JGptv5WuRr3D427uRa7RieNSLvYOtyJWr8ezZYQwGoyijFIVSjkOdR7fbTea5tYW1tFox6F1p8qIobKjt/bQvzoXdBgcyT4LGRJMQt7a22TOWWixF9xxIY22DwSCmQ8wfK8hlEe1ilMaoAEXF/DrqrC+W2cguxzEdTSPLvTmharZcJM3NoRkrNExoeP3+60zLxGNweYA58CrlOBXBiRU9+OhBtBs1Bi4kzJtwTS5bYHGZGLOAFe8TFl1Eg7Z2tsHbWYKIbm8YC4TS2m3EAOyeDVksi7rZ2o0xMHCCpkXnNN68eSs2Yxn950+iXa9FGS2pNtDuGzfRRDC+UI7j49N06Ddv30OA3RiMxpFHo++9/hkWfoWXFxcXkeegtcgcQppxeGL0BockPvoa8ll/0I3heHCFwcjjgms3W200V+0uoIlotifBPRnGy+bU2A7z9tPcWkoeBW3WqkkZx+I5FjxALvmtnS0mmYBNF5hxMXbaOwlbOh0H6KUFbrZbUUa46+U8ZkDBGqSYDJdMLnazAMz/GsdrTPTw8GlUmFTL6IOnCjPPQvcO9mPVrkd/3onbxVasfjiOWq4VTy9OY9nk+0YpVtlJ/O2ffStKhx/FORqca7DJzXYc9y9j4/gsHvzkUTRYY6WxgQnjiDNDrKfJIVRxzNOYnp0kOFghjwoWqSCFvzkOzAPfAU+PHj2PBZ9Vq+XY3N5KB3hycpIwWKwuYpYLDlv4KBXBVyBsiAYXgai2++LzcrMYszJkAJ+BouLoS0BlBuiZRx6IzGLpNeSW2//rv/INGUEFr7nCgSjYDGa75BSxhCjkM1EGu3I6Aj7H6qPd3Ig6C63VwGs2UAIiKpVKFPm3HvXOnbvR3Ny4Mn/NE0HkELCw0WdB75w8jFG3H+WzSezWNnFlGcbI4Tyfx9c+dSd+/bVXovz04yj2zgIgjn7mCsMXnTHYh3bt3ACHizFlXL27h8viY4bQxMkaWs8yExNSuNcsJofFTdD07fbmldMCRcXiGQzKVw0NTJqLmWbZKCqVtDeP4ErApHCZZXwF6NyD4ZjDg5HAkgoolvP3UcrVGrhjXNeUV0BrAD2peb6S8EkzKkN7GghNx1eEf2kaed493ZkwwClqNjNYwBxYkerNXSwmpkOpQKEYnEXX0BLoFIs4O7+MixdP4tObu7GeLuNgvxo3dvehHGjJAuc2KcavfeUvBEcT73//nVgc/hg8O42Nl27EG5/9bFwOTpOm1qFqE9YvJVzrQ9i0rwVzq8VajuuTmilgX2Uw8Zop1dA2NIYbGINrpGleN2HeMZpakfIhuAXQtuY9j7BVoBm+YsYBSQ212hzQBcdFjpkrJ8wYI3zAAnmgoZFHJnlvHMMSBPF8nkmAADmhHreC5ywBA57EAtVfzpdpIfVqHcHn0XT4KNiuF/Y1Z7MzNF+qssJJLFb8SI59MYYLv4GjWtSLyUFuVZocHBCAVufHw/jC3dvxOh54fPwgilCcV+6/HINLHFnvNB4/eBTZaTa2NvfShgps0MNTe1WOJGTY0AyhjKFZKo7K4eceuALXulQcFUhtdO8yjDX78LWAhs4RUGaJk2bdOt4FWLpmrwXgpsKYXMT/yIdD3kDjjQUcY8i1KmEZiMmh8VPm1Gnm9ZACuZAwGkzA3wELrsUSKuaipGrpxcAThDBhsAKgo1NTuL683x/sCaEidBxmn4VNoWlZzEyzPMfhwO+ixeEMIfqFNZutIOgJBzvpxW5hHb/69hdiYzWIx+9+O8qZSbQ3dqN957NRe/oEmFlHC9jJgolHR0dpg86tALUe1zpg7bKYRquJgLJJmAp5zJrV1CLXVDj87mUnabT3+/lsNkmHUUWI2VIFOeB7uG8FO1iivWr3Ao0XJioItd/tcbAZ7oHacRBLvhNO/LdWUoQFDeHlGkleerUSv/D6ZcxY83PRBQYrIuQCVwlx2RWUCpqTQYBXQcWV4D19oyYFvMoAE3x/Cb5yYzRbGwhp48qJ6iiYtDAGeqotZi5EBuvIMfdWJRNv7e7Eawx59t57MXn2KBaj4/h+93G8fPcOVlRmsfmob+zEZacfW7t7ia8rVAWaLxfT/HLfLOudY54Kzn24tgobUJEUlGv3HkXidzkszUMw2hvIedmPXB6poS3zpJ1TaOeoT1TLAZThyyuEOwa3V/NPBGrsgHUwHWMTDzB+oAiVOuxCiRvartDQEjglEfeCxGG5Q43NIjTVvYRQyg3NrJ6+956VgQUbyCEsNcmDqnFIU75j/sRJR2M9rY4Uh6iwgMUpVOQQ09+pZWNvPYk3dzdigWPrvv+9qGemsbHfiimbPCPaG/WALuBh7xaWwtzSMoAsCU1zFw6qhPQ5nTHCKuGw/exaqAq6hAIs3CtBj0xByFK4lQohPQdliDuEH8+xLvFzRVAlI3CPjjMBeuZo+gL5FBH0GiEnT8qYmAtOFweIEsgkMh4qPw3oYH7NAK26TkivvEhOTgHn0EajmRUnZYwu8U4nCIb1OpcpmmIFf2YSWRxHjskk133w3BPuAQ1yYBlEuUq4CU8VR3ILokfg6MX5i9isbEazsIr7G63of/Ct2IYxlFocRBVsztQ5MAOVA4RBLmNZhMtrOWge+LTGy+axtLKahVCvX2KiNLGEYA0q/N1ILTl0GBOqHF0CJUNdLc9QWo02YKoUyU+gEApTCpqp52BSxAdDAwtggnnmjCvuO55jTzm0JVQ3RcAc9JrPCszH0iPz9999tB5+EgnVagA0J7HRbkaPaMhw11hc7dV0agzewuzHozngbgJlmMxQWpKSJbyvEfLO3j6JnWkM+DG2z2MZK063zzyd7gANgS4tCL+Lg5gfP4x//qt/M94c9eL7v/vbaHMvDl7G+dW4rJJH0cDSNYyk2I5pTsswiiJIwaG5Vh2qFpSUgt91fHL1MYfrmkrAXhIsQhFStMwJQi+jUPrfYZ8gA+hSWfKMo3PLMMfcvaMsVwmgOVDXSof0HPzf3ttjHVcRo9qtpnqACVo5sOnsKgTfhSHla5z+ZrOdBDPBPEbkGEqY2giHNgY3xeEtBm/CLefgyzlEvtXciUw1w2bKCdDVHB2Fp7nkQHqdLtkDcX1BngOuKCXk9I30FEYBR+KhTufjaMF/N9n0Bg767s5G7LOeVWGKFlejw/fHZxexVS3F3s1dwlSiyD/9MPYIPBSujEDhKTSh4vyMPASWk0JUfQibFoulbgrbw9gEHjpkq9rRgtUU0zUzhLKENibsRZPVaLhFgoj1isMDBo0KZR1q7vW/G8CFc2sFarH47u9q8iWJKZ1hXo3sYPInJEmKaNr29hZ0bB4tgog6JjNG0HNozwyn5QnJmU9PjxHpJylBuKCDTuHDVwIm9IYn1iu1qGHGRRxEB2Gi2wiEcBcMXZE1w+VFebCOOxtN0kpYw/kJ6cDT6BQIZcl76PkrzUZ8emM/Jp11vHj0MDJkwT7301+IJenNBWtK2AicmS5V0C0iJwVqeCzdWrFWIaRF6jQDNsos/P727dsps2Z0NiQwWDKXTr1MJOvhJMrKGApO2NDRn5wc408uookjzbO/AkrovpPlsgYjPyQEXOEP+JlxX89I+IwQ0QvrnIzRy5QFbEBzSghuhSnjumIK1xuS5apxgqbuxlNMCLXUwSWPSUTkRDqNAgmiqSoLPopdaqxONFElTjnDYiYssA81q2CW92/eCtI2sUCr1jiWOT/vvf9eVHfamJdhKUmo4k5sHdyNJc7TkH6TdWT43ANVa8T+a+3yXQELEbIGsbnBYbPJFO72gYQCOKvimNI0313f2EwBRefiLDpnp0nY9Ro5bwS2xgqEnTZp1gE5izrXm3f2QNbseUEgItQYgGVxbE20+vT0FKeKn+D7vILRlNokNzwxX2WckYPNMe8cXLAG3ciIxbw0TbNUCtgITlxT0L7LJEx6rInZjXRmeOqxThTTLGLOXBFThJ5hg/VWPQ7mq/jiSy+TOVuBz710QFKg3d2DqGxyT4kM3ZyFr8kn4ERGBAJjYKfEXGbFNHk1V0GqJFqY6xDr1dg82rggpL3AaSEqHLZsaJ2c2wQM14Gbf5kzx5rv1jjAROuAKaPULmzF8fb2OGD23MY3eYAvXjy/8k1cb0KoKMTw77nY7/ogFtscWh255m/sHUQPgu7gOdKH4tqw30uLdrIyGLlUA9GUucykwUa4foHzAVmT0N2Y5mpu10BDPJpCdQYwiCHYbI4jh8kUCU4k5aMVkRtVixxCaxHtzQYXcfTwEXlhHCvJnu32Tor0ytlGbNU34vSkEz/88ffQ4FrceuVVuHAHMzSyQhBqDj8qSsJ3NrsqoFnMr3UpfJWiyPzux9xuhSSPGjYDZoy4TvAZS3C6inLs7eymgMoiwvXLcRxbnD89PUF7yTvw7xEsZAEUVQzDkYWMbMX8E76zcDDlAPMuQILuAoeYTR/hmoYUIkrg7grhOoFCNCPmYlcchhrhKftSuFOSzUtOMws2qVVZDsAN1Qo1TBLCjTdnKARP7pcIzw22sZTbhSrR0SLu33sl1ttQrVU/fvz4Q7QTp0pq8mJwRhpwI75CjkI/cAquDQg2TBWmXDVaoom6frmu5mzAVABCFliSVilkaKVq4wRndnx8nLC1SYDQBnbGlV5ckP4c4JQGl100kuoG6YMyh9JoN3DcCxL5ZyhiD8zux639g6SQYxRtDszgtVkL/FeoQB4ZZHoBZpeA3bwUK+VTYQwFBLO/S64ArdP8ZQMmLhos5NaNfU4xgA5ibDQxURkk5gENoWuerkkWoaGIM8uThStiok7qS496hid+0r2MDydEYyxoSX74+Rd+OmqX/Th68DTyQ0Li3mHs3NpKQYs4V29uUYFYxsMPfxKrZjm22Fw5S6rSpDYLus5DJL7LWjJopB58H7NuHuzFmvWeneA80XqFbRg76PRwskveL2EVUCwEqulbvRjDd6Vm3cvz2N7cToo2GBCdQdsa4O8mDvMEiJBBmGVslBq8w8/R1hlzzdHio2dPEgzdvH0TDZ5JoMkDU1tTE0+eP7vyxGhfidC4DjfOogmn553EIDSx6RjvqPD4PGkt2pqzMIhZTqnFnRHrl3AsWaxADLzE+/bw2KBBbOFAZ5j66dFJHMIini1ycbe+Hw+eXsTtdTdutitEjuPoYr69BdhINaNU3ow2+d5JFW9NzquMRUgvh6QLDRbqBErbJJGuw+BStQCVAj8p7ZgsL2v6cNcSjguJJWzsXp7FJcypu+wk3i+GZxBYHeYiXbsKecmeoTxtaFd2BrVkrhyYXcWKKzo5LKJzchQrILEB66qgXDKSg+2NGEEtx52zyMtvTVx3OxeYmeEjHh1N8GZPrdMxsc6A3KDJrzmEKhtUewwNF1yXwUmYPcvOwVihmcWmMgynqVZbtmlSNnITEzS78+I4bh3cJPO0jMfDVfzsQS52738+Dv/oB2TbNqPbP4tchWwVGlTduIVj4vDg54vVBAghUc4cMysb4J/cfLDsQZ/aOKLtP2MLphp1OkKZNE5LHQMvFg2q7KNdb5E1WyWlEjpMs/rufxXgRJgbYm0PH5CXBmKEyjlWKlxukXRa4CSdf4ns1lj5BBKwRh6G11eQCrtgvITBbtzBWV0aOJ0mnwkTUiEzRwo3CV9nxmAW8YUMvqIOpQZf5QHWOLFNStpd8RwN0+ll+MygQzO+4PMmkU8Gjc+WV/FfvvvN+PTPfTn+4l/9+Xh3/JN41HnIZuCfDFwcCQFgDNraLOM8cYBTsLZcIxDAiZTKTfDRaGwsCklxEh+Vz874XGtzL5a6lhyMTmkGL++hoVVgTMjwe1OfCtTyVB6WY05mb2cnUbbu+SkWBb/lszl0tQPMNYGJlYIln1InaCIPis9hnyyhgP+yGq1wjGpzX/w7f+8bBhiJP/KlzswipQJ1YrNrZvoVso6EC/hB4JyqJuUC/ch3naA43gVvryq3nCCfufgiZirPduJLBHIIRBj2Pnz4AKUkF/zKnXj99VciU4avciij8Souj4j2qGJUdZhlvH4BdsKhtxDsuD/CeTIua7bImvkkSjTKQl3RTDbJupAXU6LHaKg4Kb7KX6vwY9estq0QjtVyrWHONT24tvGAWutYhtCOlWADq6giVBPzExQIU0+CtV9iyX4U8op37x+C57mv/oN//A3r+jqLDLiqs1Ko4tmSRSl4hTtiE2pzEcEX8ZpyPx2ai3T2FCmBS35mKamOY6zCn7Ps0LKKAtchKuAcC3Qp5EqjtdVi4WNKSaNobjdif+dONA4OSDtSY7vEgZ5TjCTvkSUbNy+zCbymZaPTo+NEhyYIyI3kOWxL60ahKVWJYIzcFIDCNqgQ9kCoJBiFphDGZNH+LGOGhk5wdGqp2i73r0Jb3eOY36fwaeGmhYNbIGgVroCDM1oEAphLOVBaQkacR1K8vBQtoYPqjdCSN8WchYxr4m547CRqol0+NqAAEOmahFtca1hqXlmMHk1JSLOQJbhsUmRGjkOYaFFGKmKGh6fd+NIXX4qnsAc1qgm2/vjyKGrPzmJ+62bcqr8at9++HXe278fF938YYxyv4WuuVSDqIuF9hgP7ZE1VqJTZtGJSBPIc7OEK1lwja0JJDPVlRmouS2KdcnW1FaEjFOEtw8EZieYRWBV4kE3IEloEYIbBExTOspcphBKkYFm3Gm9xE9/Df3OEqsBV9iU0tIasaqQh8joC+xkm66vOHM1YrlcC6IskjX25mevEhoJeskAXLhanF2wiaTK/+12K9PjeYueYhM2Ikrh55dNTDo1F9VhAkCgaEs6qgUV7Gpq78ZjUW/fRs7jdLMXPUBr69J1XYqdYi+n7ZOK6zwmjMVs8dgHI2ATGalRHagjAFOgUAY4I55c4ViSJ44GfAw0GAL5YNvuwmLuEfm0mQY+n5Cy0Kq6xVGaK0kDLiz2AKTCloxI+RvSAGECIr1MsODlYFCqDAmXxJ+5/zUGtmHNBWV/j8ZU3bpZuiUXYbyLkmtiNGzfSZP7bk5E/SuMuKVw20MSkuQjU0zf3KR77mZknD02vrAcy2lKr7JeQ5vT5boMw8sMf/TjKhJ/2Y3z3ne8DAwNaBihVjS9JyPfib/3M2/Hr9z8XN2grKN2gDrfqxOV0EL3xGXkTwnqwV7ZjY4jrN6lvtq5OOLvkENYZsmquDcsxI7jOkp9lh4BM6iczqZO0l/De9XltCevc2qKNgVStghZuLAsVSlkCjhbaafoSuFNTwRod9XoNTAqbyMAxHNN7tThhljqgiXYIOqDhRVY0NtCKGqQ6RUBpIwjHnCkvb/Z00+L5zpNb0D7l5qzTuVizSAMGLzFGhkUZ8YjN+4ShDRY9InTeJWs3ZJwiFOynXn2DKJLGwIuTOIEDZ2hF+o/fez/eoly0DZ8ubpKBe05NDvN88OgIujWloWWPtRi1WbiELsES5OxrxrdRRc3U8WBmqYwlPXOtOsUywYXVcBXimh2ZB1aRUrMKeq8SWUVOVR72MaIraUaetwaXtgvKl8L0pdzsLLItQfjRsR/Aux0vv0vklnrJBHy0wA+VvkIUl9RaF++/fTmAm3IDfpc0GUg3iOArjG2dio46ypSeRLPllRqqaT5DSdSbcnYVbKRziNRj5+Q8OiM8PNx3994mHT5HQMcl3ZZ0S3L5khzF8xeH+AA6LJm73iL/xsH1ic5cg+uxtmhgZK+Ce0A/sQ7slEWlijgC1jGbAhjCclLegOukfeKmwldpFLidSh6EyqJlykW1UjF4lTQ/UqdRhfVKQ5XFlM8dP0+McMn4c6ii96eanIOqmZpaEiiT+m6/gAI0vWdRz5c0xpyx0DHE615hGLjMhtyYJW2rviWcDn1QSXuEHsfzlQU3l2jeCLzLoV0NFlLf3o7MJdVk4Ofk2ZOIO7SxgqsE5STuYQGkNge0Kq3INt2+c5NghmSLcIQWZqdsgvVnwXbfDXutl7Fn2AG1Re5P36Mg6ogBiDmUDMLXqaU1M5bm717dz7Vm6mJGcnksZAF2G/GqZjJeKpFksdkzWjzlPn3PGOzP4jiLKM8SbU73iIvEV+kEFbCnKGVzsuUSusEA4q8nn+AAUHdRvq6iOReGtjBKzlPmc8NWy9tiUJ/x9cxmluYIuQpreYjGmiYsFzkQHMfZaT9eXJJztpuWe+lOoReFxg02AMoRxfkN1yZyv06JnhJwIYx5+HMO22p2AQHLdBTkko3O3CyCFzJWmJjtAz3WRGdputY9uD/DfnO57kv/UUU5lMMMiBnIsXFySQmBAS20jYJ58O6HDloCH+iogQh+R8VLKQIgE4HB39moIXI6SU5JwTqp6m0rlL/jH1kxq+IGnaNc+dqkrg5CBwkEAPrec9XQfBW0uNAipmt535So4yS+ygITXaL/YUHOOVdDk0mcFOrl6Bx1Ypcoby9LM926E104bx2t7IOBtqcaOZVRQw89z6FO4MlCmsrioSsw16VQLI76b72+c+tXpG12BGlVhvQeSpPgxR7kIde5N1/KwJ/FkoNingr5EIVqZ88ChXGfOvNUTWbv1h512spvidJ5D3isICjo8CFqmBaYkhoIxjL4/9NaTMyJUQ+rxC7e2p0m5edpQ3wuDj0/O0vaa7+u418J+eogPWF/H0DwxxPMHmHk2+R261gI5t5h87XN3djLDWPfLmU49Jyqyx4aW6zZ3ILXB860mClzO5ZaXJwR6cGEtBoFZVGzBjZbDLAz3QqGnTmpZG9QxXb7ON/RhQGVfgW2g3Dci07acVUErXmkhfK7exYCOxd0oANF8L6E5bblqjvVViNdXwUGbfSecVh5HZoanDwhk/hyoQ7oTxIqBqqTuxbwxNwvxpuDDbi4dGK8m0m6wm6Lp1CUT0LwZDZols1xlyTZkSYeH6fUyMXJxXl89OJJPJ9gTgevxufvvhydpw+iQopww8WA02tytPUb8F1yACME7FqMMoUAN+1B5q2mAAd24BjVudakoWC9FueejEJ1fmhRCk50Xu7fViuvWdI+oCV4nzldqybCDjekYKlAQ4c0LdXuZBIcpDkWo0stKW+Z37AeH7HA2kZ96oOeliaSnBxmp8BKZTXPRgoBQQegFsL71FRM3Q4e4Dp9ltqHWMT8E5jhUOPeyy/FGVpM/JIEoJab5lOjBlwwgpUUGLNKmnGfGt+a/uDsBc9qLDJxRDK8iVOZkYtGXZi/EF0cTa9PHQ1cG2aIxkjUlOiTWLMOUBPnZycoTdAJZniOAwgZkBy3/dZqt/Bkr90SOtmFkUjFDihLmW9OSsNC18wp1cwgsA1CeJWiyPav8hgwHL5bU7pSDjk4cMJ47lNGshijuTEdTfaEdCrnrBcmotDr5gu4yBqVA0ivqlYfmChhMVrthUKAWqmjGJM30BVLWzSHGqxAE7EWZjNcAe0qkExJURWtntbjdKBMFLv0CH909BRW0I3qqgn37UUPLtyo70SWPPKS/ogmGjEl8zbDgoi10exb8Xz4DDyeASF0YXKAg0UvNje2wU6E0Z0QYGyRtH+c6FofTFZJDijvn5ENKzSIGglkrJJMwc2tg5149Pxp1KmmTKFkhx99TJp0h07PnXj80U+IDun6pMBQwDGOx9C7PAwBB3t6yt5QlCGPD6iUVSrkfn7Sox8avq5zr9fa8fTFixRP2IWUv64IKGRPc0oOWByVOfiZ2meaUQHLDbehVLbzu+BLsM2nbBSuz01wtokPv2ACvXwF4WuaZ2fnyRSLJHmalGBMovggybAziSPqbXPal/Yb2/EZhL9FKjJ/9Czqo33WgxJjiuc0CO6zngrdPi2CFXYXK/jmArh5+uKMFOSSam83jp4/J9LskK/djFdeeSm6Jm0ogT350aO4efuGHC0pS6paoOGPz56khr6b+9uUsWZxfPI07t29RSUaDKc3YkLwY6IqT7tXk2rKwmQ3EHRK37K1xhkbbxPcmH1s8e7+u2hxk70zEesHLqxhCQtqqe86uGsuqAaLTeKUGi2MlCkYrkdXCWpzGHpQJWEyR56IDRG2XhUbuZmDwcrBJZx2old2aH7+82/EBRDQ7cCjB1Q8uGhydgJ8cJjradzKLuIGXT1SvnyF/CwVimaTlll4tSFu53kX6GENMIAJWGcDdIf8SWt3mzJ7Pk4RbHtIuIsPqAFDm3TDV7PQtynMA9hpkalr0oCYe3WThr9BPKfPo7nVIAd8kGqSJyhUQ63BxxD7kf2DtrLHGdoP94i9l17CNTAv+8XYCP9pRWC+HNYqv09PNLGnFRaXMFhB6ix8Tw4OzRXsFXhiBzqHT7R5gtb1WZR5XzNvRfvNcBbiF26Qd+J2yukKXwg1jXmdKHJMQ9Z3vvPtNC75uajT0+aTTZkmJRme51pRlMzSI7HB4wR0IMScsku7Tj9GzQSO9TUoW+k21WCwF4bQJGkkVP0Y07770p24dXMH6Ciz4QtKO/Q7gM0v37gZTz5+iFMmVWnICbedYeaNGxsEC9C7MQLexSp4JODF4UmUslgaOF6rbLAjLJM8hhy3BtSUm3QczfrsQyy+enYQ20evzJ9zD1V4nwcUw6ccUv6S007OC4lLqdRStdDPzH0q2Gv48ACM2GpzYn4Ep/A9EDvNTTbrzU2AmHfQ0ZhosXlvgmDsSahwGBWep9jYrLFAcG0EBeNAptwzxQFRh8CMJ/Hq/l68XIMGoi0fvvcu9TAiSvIlLQ7i2fBRcBZ8Y/YLTCRYKRdZ+4p62YQ0Jti8Cx6edoax6hLKU86iRSjKaHoLrRWz/U5KdvYUiKDL/q23PxMXYPtPHr5P0NDmuTy6L2mgGWGpZtiyWebndMoKGPpXtrfOQ2JvbXIWZX6UkQ+9nEPhXnvtM4mZqGS0Tl1liYQAYULt88kb/y1NU4A6N7X5CiLonAEXVYREZzBZWCKpQUJhHJkTcULpBG1OMdIxf+wJG/F5uuUqnBKMY5lgIO/QG58x87k3g+MCWl5GmzNAxgUYu8cgUxI8wUaKmuG4i8+WJgJFcNACD9S8efcGs9LWdXwU52jU9sYOAsCmwO7Hx895jGEPFgKMkd1bAxkNYKdW4YHICpZAR2eFiskeWJxZ85DOOdo3JM8xJLBCe03wLMh/dvonFH8PwfdPUSbEiSMTK8k9hGofiJg8IkFk15IBiYqaV6AKRe305XvSVG72XSH6kzSV6CUPSzBcVFMVtGZSRUhOJglHqRNlM/Nkl6G9BTXIuqGseD6Cu0p5rH1BoOCO1NRIQ56DyQU2mcH5UIqLDAewprC209qJ0sWMTV9ifvYqUDyFXBTgrBvQoyVV30z3JPHq08PHMTzlGTxqfoHTCVjCHDYzJIUZW+3osb78nGMgasvyKG+ZyQddKNVHj+MOB7S1tReHj08QMlFdrpagq8k4NaLLAZBzQSV6yaNngyfPUlKdi8hDkP7kQR+0BHZyI7EPyeMCOml2LW+/gC8xWCHKGOxKvw4OpCM+hGhIqLMz+vF5tDUmPSZxIkxcH4o1BP89JCsnO9nc3UqHYBlmTrbMpjhbZNdGbQQGy9FVZSRPOchs2O7BdlQWO1GlmrvBZuW77Rv3UtPHKU9fjgsz1rIfhzxeW+H+W9tbRGf1uED4yyEN3U/Po0oP2Shbjvee8sDMrZdoGGzGza/95VjyZNHt7bsgKrQRx3r8wfvxrf/xezEFRt585XNAyzDe+eP/I0LFvTufQ7uBKHIdPv0EaQTLeUASp9Cmn3kFtC3sy0DBKpVC7MIiqOOzZ/mwqQWSWyiSzCTzLx5frq8xVmflS4iQSVju8SU2+5OwmunqtLvOMQcF7o95YPmzmi2cWAnxWqMtm/6ux/B9hPkvLWDyXZ6+h/QwDdxypoaziRxQkYHWffWVl+Lrt/diE4uY8czc0wc/iKdHDxHIUewADahePHv8MN64fz+1pH744U+A2lasEcphfxTnjLn75tvx2l/6KzEqbcX7/VP6kSvxaRzkJuvYBu+3aD/pf/xuvPeH/yHuIKDx6YvYarThtrIkODAWVN8goOHaLF34jz/+Qexv3wDLoXLkTS54du+UAmkRDd9AmXIWUvE7DVoIXtjscsYjcb97MqG6/EmUxlBqoAljtblLt48xtULTcYnXdRpHfAhbfPYQNHtpmPiM5Sf2IVu4OhBsGbHncXh5NMH/xKqHTw7h0zSCgL1aENmMqEKTZqS5urCGGodwj/G+BOd9a78ZsEruXER3RY5g1osaCZ8+Duq73/lWokRa2YdPHkUW5zYEo3v83P2pn4n1/o341uNn8b3D4xiYeWvTN4Ef2MVvfOXVe/Hl3Xa8BRTlLx7H6oN34uk734kiDrlPRaNAoLIFL7/oU2EGTqo18h1wMv3NcFwCUj4Fx+VxBr7vEDTJMooIuImMLgmYbGBEfSLz248u12boFZjN02KpVQiFbs0t4S+arJYrRCnRk8MXiaJdO8FrKocc0vVe64+Cn0PulzgbHyRf0k3pg4P7bcwfjlkGuz3xLlp7ztPqrJuyDT0GsJIsiz5AC9+4dStutBO/CHrRYRqUrb7/w7hLU0qHQGcBlp/S5vTh46exybUNhPrRER07GN/HFFcfn9NETsP43t1XOdxcPCaKHC3OaDocxFs4r9/4a1+Lt8nmZX3o8YPvxX/+3d9ifTzAAjt57UtvUT05BU8xIyJXqxznPajimHbZJg8zsj7ElvrsDNCsUhfgxvsId00EOoCtpIT7dfLCU1ArU55Tp4WAUxmeNlI1+vjsNGF0GU2Zz694sxrvSyFfv6vBOjF5oTmNMtqQg9wblBB1Rhaln3VIMtFI0qA8NUGrJpaZSFEW6nQ3iutCDJHa5YOPsRJ62C6O4/m0iwNaxAFBw80t/lwBDnfJDoWdY7qKVs/JPTyDrpXpYYaeFes349VX7pLf5fkPMHrSn2I59+Ix1xZqmfiD//VNei/+fXzjl38pvszTo7FzGjkw/qJzGLnpRbQ+MNeLUsHDO1jxCVEnni8qW/vJsfnQeRuScJMeOH2Y3aQj+u56J1BflKtVhUf/zmGPHmOiOJRfiqFzq3OT7+nBbo1C7eZdwfljdJTwGsEo4GuNVchqvIXD1DOM5qrB1vx8V6N9xi5PRFU3gcTZjAlFR2jIDKfSxRMPdZ6wlTqH04KKZeXRBBRGeR346BgB14Ec2wdOoEeXOGUMg/UBc9I88honZxexS8qzVWoiVB6yvESTeBSgybrzrXJcNBdxfEmbAHmVGtm8rxAB/qOv/bm4RxT54Pf+bVz+yX+P7eUFHfpTghZwnSxen+LmI8a5c/8NWrXIA2PVC5TOP2dgd48huW2//oWCRr1NugEWQgqApz39yyUkcDBLHVYqAyEkYUNss+bkd74Mq7fIRXQpgCb2YDj5/72EFzNXh9AlX6b6UjoRuLBLyKxTTazGfCy/+9dSgEsyazg9zNTM2AJO6qYUyHJgfZCoiJBwANM4RfBHhKQDNHpnCw7L9Ke0sk7JEfgUaZsngpokdN544w7Y2I8nz56TXzjlAcSgIQ+Oizauipk4fE60BiU4Y60P0OzbuUr8waPj+PpeJT71i78Yf/hHvx+trFm6HulPCl9UWxbA2nkP6sWfUsjgjGv06jURbq1ANMvhesg+D+B+//jbf0zTIo5v71Zk/vURlSSErFcXBtLJICjLIArYKO2CvxySSksISm23gipGmxdQexX2NUT4eRMLsFnFlxruuGbrfIg6B4PQ6xpB2t9lCnPBGMfQvx7amSMQGNLWWlzkeeqTyA9NyKMhY7C6g6b7PPEMR2Q1wV4F593BZA3bTxDmBRRvc28LBiSNws3ADgZEaU/PT7CMCVSRKnVmMz56RmUEk4YOxBZPxn+2tIh/+ktfjT8Pzv/pv/lncfk//1PcouR6CyH1skDi5r049kknPHl5DB2kgdxHHnTmZuks42OYBDYl/nrARfzXP/pmTKGZmd98cLoWZ5OmAQUKzGjLl7QrRSsI/xoKdIDitAmW6w5zf1eI3pvaALgfn5Cgxc/8zuaTDFqZhzcSZKaqbJH8r7zbR2+bO5sxQYgmgYYkgYo8artLUNHE+4ufj8lBXCLUHMmmyYxQl6SOOYARZm6C25eMJEWYaLuhbYZe/gycO0fURoWOZD89c30aztdbOOuN+BPYDHgYDa3nyY/id379V+Lr3LN7+N34V3/3l2OHAOZNHkTPt2/Gans/tt/8clzgK5qwigKRnZ3xF4TMYEGqNba4pu1TqK+9AR/F0dy8F5nfOuojuyssvdZEE9IGCmqjJ2Q6ThwWSsRYHwdQqNdaa5ZfzPYzBavmS4f8zPuMFq0ycHxkxngYG0FpKXCbNMdcmMJStCJDjy26M8cQeTvZndMch1azInqUL6+gc1YhtKAabagqx5jyjMpgZGmE+e4HP+B5tt1Udn/49FGaUz+yS8m/vML7E/C8AP/f/SGeDOioo5FfwgP/y7/x9XhtPYiz3/930f8Wf5DpO78fb7z5ZjzH8S1xyK995gsxPRnE1s2X4wGQ+u2PH8XdL/1clHdukWx6PbZf8g+CgHs4YsK3yPzTj4+A4U86dFioAlFQCje11DOIAtMELaG4UTXcsNiX1/k3FxRmevyfw2qiFR6QyT5fKYHEu9cpDEtHjqHDdG6x1EO2B8ED7dMXZpuTuQyFbp9bCYw1T52OgH/rK7QMgcjalwdk+F4F2sbjqxyIHUQeRJfqguOavz56wYOECGqOZU1xxifAxJIETvfF03gZfP/NX/sFYIK0x/AkvvlPfiOyL35IgmhMA3eVbN8oHj7+EY87fCVWBC9nJK6Kr96PG1/8OTJz91mb+T/+DA8OkeWlhyn/L2wDeLbycE5IAAAAAElFTkSuQmCC" />';return __p}},{underscore:"underscore"}],750:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-upperCase u-altTextColor">tilejson</p>';return __p}},{underscore:"underscore"}],751:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-upperCase u-altTextColor">wms/wmts</p>';return __p}},{underscore:"underscore"}],752:[function(a,b,c){var d=a("backbone/core-view"),e=a("./basemap-categories-view"),f=a("./basemap-select-view"),g=a("./basemap-inner.tpl");b.exports=d.extend({className:"Editor-inner",initialize:function(a){if(!a.categoriesCollection)throw new Error("categoriesCollection is required");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.basemapsCollection)throw new Error("basemapsCollection is required");if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");if(!a.modals)throw new Error("modals is required");this._categoriesCollection=a.categoriesCollection,this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._basemapsCollection=a.basemapsCollection,this._customBaselayersCollection=a.customBaselayersCollection,this._modals=a.modals,this._initBinds()},_initBinds:function(){this.model.bind("change:disabled",function(){this._renderSelect()},this),this._basemapsCollection.bind("add remove",function(){this._renderSelect()},this),this.add_related_model(this._basemapsCollection),this._categoriesCollection.bind("change:selected",this._renderSelect,this),this.add_related_model(this._categoriesCollection)},render:function(){return this.clearSubViews(),this.$el.html(g()),this._initViews(),this},_initViews:function(){this._renderCategories(),this._renderSelect()},_renderCategories:function(){this._categoriesView&&(this.removeView(this._categoriesView),this._categoriesView.clean()),this._categoriesView=new e({categoriesCollection:this._categoriesCollection}),this.addView(this._categoriesView),this.$(".js-basemapCategory").html(this._categoriesView.render().el)},_renderSelect:function(){this._selectView&&(this.removeView(this._selectView),this._selectView.clean()),this._selectView=new f({layerDefinitionsCollection:this._layerDefinitionsCollection,basemapsCollection:this._basemapsCollection,customBaselayersCollection:this._customBaselayersCollection,selectedCategoryVal:this._categoriesCollection.getSelectedValue(),modals:this._modals,disabled:this.model.get("disabled")}),this.addView(this._selectView),this.$(".js-basemapSelect").html(this._selectView.render().el)}})},{"./basemap-categories-view":735,"./basemap-inner.tpl":753,"./basemap-select-view":764,"backbone/core-view":1127}],753:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-basemapCategory"></div>\n<div class="js-basemapSelect"></div>\n';return __p}},{underscore:"underscore"}],754:[function(a,b,c){var d=a("underscore"),e=a("../../../data/basemap-providers-and-categories"),f=a("../../../components/mosaic/mosaic-thumbnail.tpl"),g=a("./basemap-model"),h="a",i=30,j=24,k=6,l={url:"urlTemplate"},m=function(a,b,c,h){var i,j,k,m,o={};d.each(b,function(a,b){b=l[b]||b,o[b]=a});var p=e.getLayerType(a);return i=b.className,j=c.get("className"),k=b.name,m=n(b.url,b.subdomains),d.extend(o,{type:p,name:b.name,
category:a,selected:j===i,val:i,label:k,template:function(){return f({imgURL:m})}}),new g(o)},n=function(a,b){return a.replace("{s}",o(b)).replace("{z}",k).replace("{x}",i).replace("{y}",j)},o=function(a){return a&&a.length?a[0]:h},p=function(a,b,c,h){var i,j,k,l,m=e.getLayerType(a),n=function(a,b){var c=a;return b&&(c=c+"_"+b),c};return i=n(b.baseType,b.baseName),j=n(c.get("baseType"),c.get("baseName")),k=b.name.replace("GMaps ",""),l=[h,"unversioned/images/google-maps-basemap-icons",i+".jpg"].join("/"),d.extend(b,{type:m,name:b.name,category:a,selected:j===i,val:i,label:k,template:function(){return f({imgURL:l})}}),new g(b)},q=function(a,b,c,d){var e=b.name?b.name:"Custom basemap "+b.order,h=b.className,i=b.urlTemplate;return new g({id:b.id,urlTemplate:i,minZoom:b.minZoom||0,maxZoom:b.maxZoom||21,name:e,className:h,attribution:b.attribution,category:a||"Custom",tms:b.tms,selected:c.get("className")===h,val:h,label:e,template:function(a){return f({imgURL:a})}})},r=function(a,b,c,d){return new g({default:!1,color:b.color||"",image:b.image||"",maxZoom:32,className:"plain",category:"Color",type:"Plain",selected:"plain"===c.get("className"),val:"plain",label:"plain",template:function(){return"plain"}})},s="CARTO",t="Stamen",u="Here",v="GMaps",w="Custom",x="NASA",y="TileJSON",z="Mapbox",A="WMS",B="Color",C={};C[s]=m,C[t]=m,C[u]=m,C[v]=p,C[w]=q,C[x]=q,C[y]=q,C[z]=q,C[A]=q,C[B]=r;var D=function(a,b){if(!a)throw new Error("layerDefinitionsCollection is required");if(!b)throw new Error("configModel is required");this._layerDefinitionsCollection=a,this._configModel=b};D.prototype.createBasemapModel=function(a,b){var c=this._layerDefinitionsCollection.getBaseLayer(),d=this._configModel.get("app_assets_base_url"),e=C[a];if(!e)throw new Error("Can't create basemapModel for basemap of type: "+a);return e(a,b,c,d)},b.exports=D},{"../../../components/mosaic/mosaic-thumbnail.tpl":462,"../../../data/basemap-providers-and-categories":614,"./basemap-model":755,underscore:"underscore"}],755:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{default:!1,minZoom:0,maxZoom:21,name:"",category:"Custom",type:"Tiled",selected:!1,val:"",label:"",template:function(){return""}},getName:function(){return this.get("label")||this.getValue()},getValue:function(){return this.get("val")}})},{backbone:"backbone"}],756:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../components/mosaic/mosaic-item.tpl"),f=a("../../../components/modals/add-basemap/add-basemap-view"),g=a("../../../components/modals/add-basemap/add-basemap-model");b.exports=d.extend({className:"Mosaic-item Mosaic-item--dashed",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function(a){if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.modals)throw new Error("modals is required");if(!a.basemapsCollection)throw new Error("basemapsCollection is required");if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");if(!a.mosaicModel)throw new Error("mosaicModel is required");this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._basemapsCollection=a.basemapsCollection,this._customBaselayersCollection=a.customBaselayersCollection,this._modals=a.modals,this._currentTab=a.currentTab,this._mosaicModel=a.mosaicModel,this.add_related_model(this._mosaicModel)},render:function(){return this.$el.html(e({name:this.model.getName(),template:this.model.get("template")()})),this},_onMouseEnter:function(){this._mosaicModel.set("highlightedAdd",!0)},_onMouseLeave:function(){this._mosaicModel.set("highlightedAdd",!1)},_onClick:function(){var a=this,b=this._modals.create(function(b){var c=new g({},{layerDefinitionsCollection:a._layerDefinitionsCollection,basemapsCollection:a._basemapsCollection,customBaselayersCollection:a._customBaselayersCollection,currentTab:a._currentTab});return new f({modalModel:b,createModel:c})});b.show()}})},{"../../../components/modals/add-basemap/add-basemap-model":268,"../../../components/modals/add-basemap/add-basemap-view":269,"../../../components/mosaic/mosaic-item.tpl":461,"backbone/core-view":1127}],757:[function(a,b,c){var d=a("./basemap-mosaic-view"),e=a("./basemap-mosaic-model"),f=a("../../../components/mosaic-form-view");b.exports=f.extend({initialize:function(a){if(!a.collection)throw new Error("Mosaic collection is required");if(!a.template)throw new Error("template is required");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.basemapsCollection)throw new Error("basemapsCollection is required");if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");if(!a.modals)throw new Error("modals is required");this.template=a.template,this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._basemapsCollection=a.basemapsCollection,this._customBaselayersCollection=a.customBaselayersCollection,this._modals=a.modals,this._disabled=a.disabled,this._currentTab=a.currentTab,this._initBinds()},_initViews:function(){if(this.mosaic=new d({model:new e,collection:this.collection,layerDefinitionsCollection:this._layerDefinitionsCollection,basemapsCollection:this._basemapsCollection,customBaselayersCollection:this._customBaselayersCollection,modals:this._modals,disabled:this._disabled,currentTab:this._currentTab}),this.mosaic.model.bind("change:highlightedAdd",this._onChangeHighlighted,this),!this.$(".js-selector").length)throw new Error("HTML element with js-selector class is required");this.$(".js-selector").append(this.mosaic.render().el),this.addView(this.mosaic)},_onChangeHighlighted:function(){var a=this.collection.getHighlighted()||this.mosaic.model.getHighlighted()||this.collection.getSelected();if(a){var b=this.$(".js-highlight");b&&b.text(a.getName())}}})},{"../../../components/mosaic-form-view":457,"./basemap-mosaic-model":759,"./basemap-mosaic-view":762}],758:[function(a,b,c){var d=a("../../../components/mosaic/mosaic-item.tpl"),e=a("../../../components/mosaic/mosaic-item-view"),f=a("./basemap-mosaic-remove-view"),g="a",h=30,i=24,j=6,k="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAZ9JREFUWAntWUtugzAUNKbAJl1EYtcz9Ba5UE6SC+UWPUN3SNlkw78zVhJRCeIXbCup6ic5gP08Ho/x40ESBauq6iNJkgPKDpdb1j3RTuM4HlH2ZVl+JySXpukXygaksiViRVEsNd3qu65Tfd/frpdO8jxXEGO2GcTUMAxtXddnYH1qKqe1fof3IrlZpECVJA6xMgiyMdzws0N5CzTealiIlpGbBsKz77nZSYAc67ck+NIWCbouj1cFL/eNK6df/UW7FztKMT7ZTOJDDMQ5RUyJGYK2IMyBm6ax4nFQGxZBEIStWFcH2TSu3pZjiCX2StDCf1VzJLhKtkmnqOBEjFWn/0tBaaB+REoTqJkJ2wxJpM3FtPvGMgQlabrkCUEcCcF7Kf9UBT5xvN6DIZbYK8Hp7H2dR4KuSkYFo4KPKBAiYTWBmoHznvEdQpKm82ljw+I4DObElJghaJu59AWHA9qw6CMlR9+4i6mCi0UFXdRj3z+hIL8Ju040VP+TBrkjtn0bagQH3JbcSHB/+WDNCgc8r11bZOdncjPfWV/5b4gfOaaYLUG/QVoAAAAASUVORK5CYII=",l=_t("editor.layers.basemap.custom-basemap");b.exports=e.extend({initialize:function(a){if(!a.basemapsCollection)throw new Error("basemapsCollection is required");this._basemapsCollection=a.basemapsCollection,this._disabled=a.disabled,this._initBinds()},render:function(){return this.$el.html(d({name:this._getName(),template:this.model.get("template")(this._getImageURL())})),this.$el.addClass("js-"+this.model.getValue()),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this._initViews(),this},_initViews:function(){var a=new f({model:this.model,basemapsCollection:this._basemapsCollection});this.addView(a),this.$el.append(a.render().el)},_getImageURL:function(){var a=this,b=this._lowerXYZ(),c=new Image;return c.onerror=function(){a.$(".js-thumbnailImg").attr("src",k)},c.src=b,b},_getSubdomain:function(){var a=this.model.get("subdomains");return a&&a.length?a[0]:g},_lowerXYZ:function(){return this.model.get("urlTemplate").replace("{s}",this._getSubdomain()).replace("{z}",j).replace("{x}",h).replace("{y}",i)},_getName:function(){var a=this.model.getName();return a?a.replace(/_/g,""):a=this.model.get("order")?l+" "+this.model.get("order"):l,a}})},{"../../../components/mosaic/mosaic-item-view":460,"../../../components/mosaic/mosaic-item.tpl":461,"./basemap-mosaic-remove-view":760}],759:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{highlightedAdd:!1},getHighlighted:function(){return this.get("highlightedAdd")&&this},getName:function(){return"Add"}})},{backbone:"backbone"}],760:[function(a,b,c){var d=a("backbone/core-view"),e=a("./basemap-mosaic-remove.tpl"),f=a("../../../components/custom-list/custom-list-collection"),g=a("../../../components/context-menu/context-menu-view");b.exports=d.extend({tagName:"span",className:"Mosaic-remove CDB-Shape-threePoints is-white is-small js-Mosaic-remove",events:{click:"_onToggleContextMenuClicked"},initialize:function(a){if(!a.basemapsCollection)throw new Error("basemapsCollection is required");this._basemapsCollection=a.basemapsCollection},render:function(){return this.$el.html(e()),this},_hasContextMenu:function(){return this._menuView},_hideContextMenu:function(){this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_showContextMenu:function(a){this._menuItems=new f([{label:_t("editor.layers.basemap.remove-baselayer"),val:"remove-baselayer",destructive:!0}]);var b="context-menu-trigger-"+this.model.cid;this.$(".js-Mosaic-remove").attr("id",b),this._menuView=new g({collection:this._menuItems,triggerElementID:b,position:a}),this._menuItems.bind("change:selected",function(a){"remove-baselayer"===a.get("val")&&this._deleteBaselayer()},this),this.add_related_model(this._menuItems),this._menuView.model.bind("change:visible",function(a,b){this._hasContextMenu()&&!b&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView)},_deleteBaselayer:function(){this._basemapsCollection.remove(this.model)},_onToggleContextMenuClicked:function(a){this.killEvent(a),this._hasContextMenu()?this._hideContextMenu():this._showContextMenu({x:a.pageX+215,y:a.pageY})}})},{"../../../components/context-menu/context-menu-view":39,"../../../components/custom-list/custom-list-collection":47,"./basemap-mosaic-remove.tpl":761,"backbone/core-view":1127}],761:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Shape-threePointsItem"></div>\n<div class="CDB-Shape-threePointsItem"></div>\n<div class="CDB-Shape-threePointsItem"></div>\n';return __p}},{underscore:"underscore"}],762:[function(a,b,c){var d=a("../../../components/mosaic/mosaic.tpl"),e=a("../../../components/mosaic/mosaic-view"),f=a("../../../components/mosaic/mosaic-item-model"),g=a("./basemap-mosaic-item-view"),h=a("./basemap-mosaic-add-item-view");b.exports=e.extend({initialize:function(a){if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.basemapsCollection)throw new Error("basemapsCollection is required");if(!a.customBaselayersCollection)throw new Error("customBaselayersCollection is required");if(!a.modals)throw new Error("modals is required");this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._basemapsCollection=a.basemapsCollection,this._customBaselayersCollection=a.customBaselayersCollection,this._modals=a.modals,this._disabled=a.disabled,this._currentTab=a.currentTab},render:function(){return this.clearSubViews(),this.$el.html(d()),this._renderList(),this._createAddItem(),this},_createItem:function(a){var b=new g({model:a,disabled:this._disabled,basemapsCollection:this._basemapsCollection});this.$(".js-mosaic").append(b.render().el),this.addView(b)},_createAddItem:function(){var a=new h({model:new f({label:"Add",val:"add",template:function(){return'<div class="Mosaic-button">+</div>'}}),layerDefinitionsCollection:this._layerDefinitionsCollection,basemapsCollection:this._basemapsCollection,customBaselayersCollection:this._customBaselayersCollection,mosaicModel:this.model,modals:this._modals,currentTab:this._currentTab});this.$(".js-mosaic").append(a.render().el),this.addView(a)}})},{"../../../components/mosaic/mosaic-item-model":459,"../../../components/mosaic/mosaic-view":463,"../../../components/mosaic/mosaic.tpl":464,"./basemap-mosaic-add-item-view":756,"./basemap-mosaic-item-view":758}],763:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-selector">\n  <div class="Editor-HeaderInfo-title u-bSpace--m">\n    <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.basemap.style.title-label"))?"":_.escape(__t))+'</h2>\n  </div>\n  <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=_t("editor.layers.basemap.style.select-style"))?"":_.escape(__t))+"</p>\n</div>\n";return __p}},{underscore:"underscore"}],764:[function(a,b,c){var d=a("backbone/core-view"),e=a("./basemap-select.tpl"),f=a("../../../components/mosaic-form-view"),g=a("./basemap-form-view"),h=a("../../../components/mosaic/mosaic-collection"),i=a("./basemap-mosaic-form-view"),j=a("../../../helpers/required-opts"),k=["layerDefinitionsCollection","basemapsCollection","customBaselayersCollection","selectedCategoryVal","modals"];b.exports=d.extend({initialize:function(a){j(a,k,this),this._baseLayer=this._layerDefinitionsCollection.getBaseLayer(),this._disabled=a.disabled,this._initCollection(),this._initBinds()},render:function(){this.clearSubViews(),this.$el.html(e());var a=this._selectedCategoryVal.toLowerCase();switch(a){case"color":this._renderForm();break;case"custom":this._renderCustomMosaic();break;case"nasa":case"tilejson":case"mapbox":case"wms":this._renderCustomMosaic(a);break;default:this._renderMosaic()}return this},_initCollection:function(){this._filteredBasemapsCollection=new h(this._basemapsCollection.findByCategory(this._selectedCategoryVal))},_initBinds:function(){this._filteredBasemapsCollection.bind("change:selected",function(a){if(a.get("selected")){var b=a.getValue();this._changeBasemap(b)}},this),this.add_related_model(this._filteredBasemapsCollection)},_changeBasemap:function(a){var b=this._basemapsCollection.getByValue(a);this._layerDefinitionsCollection.setBaseLayer(b.toJSON())},_renderMosaic:function(){var b=new f({collection:this._filteredBasemapsCollection,template:a("./basemap-mosaic.tpl"),disabled:this._disabled});this.addView(b),this.$(".js-select").append(b.render().el)},_renderCustomMosaic:function(b){var c=new i({collection:this._filteredBasemapsCollection,template:a("./basemap-mosaic.tpl"),layerDefinitionsCollection:this._layerDefinitionsCollection,basemapsCollection:this._basemapsCollection,customBaselayersCollection:this._customBaselayersCollection,modals:this._modals,disabled:this._disabled,currentTab:b});this.addView(c),this.$(".js-select").append(c.render().el)},_renderForm:function(){var a=new g({model:this._baseLayer,basemapsCollection:this._basemapsCollection,layerDefinitionsCollection:this._layerDefinitionsCollection,disabled:this._disabled});this.addView(a),this.$(".js-select").append(a.render().el)}})},{"../../../components/mosaic-form-view":457,"../../../components/mosaic/mosaic-collection":458,"../../../helpers/required-opts":1097,"./basemap-form-view":738,"./basemap-mosaic-form-view":757,"./basemap-mosaic.tpl":763,"./basemap-select.tpl":765,"backbone/core-view":1127}],765:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text js-select"></div>\n</div>\n';return __p}},{underscore:"underscore"}],766:[function(a,b,c){var d=a("backbone"),e=a("./basemap-model"),f=a("underscore");b.exports=d.Collection.extend({model:e,initialize:function(){this._initBinds()},_initBinds:function(){this.bind("change:selected",this._onSelectedChange,this)},_onSelectedChange:function(a,b){b&&this.each(function(b){b.cid!==a.cid&&b.get("selected")&&b.set("selected",!1)})},findByCategory:function(a){return this.where({category:a})},getDefaultCategory:function(){var a=this.findWhere({default:!0});return a=a||this.first(),a.get("category")},getCategories:function(){var a=this.chain().map(function(a){return a.get("category")}).concat("Custom").concat("NASA").concat("TileJSON").concat("Mapbox").concat("WMS").uniq().value();return a},getSelected:function(){return this.findWhere({selected:!0})},updateSelected:function(a){var b=this.getByValue(a);b.set({selected:!0})},updateCategory:function(a,b){var c=this.getByValue(a);c.set({category:b})},getByValue:function(a){return f.first(this.where({val:a}))},getThumbnailImage:function(a,b){return this._lowerXYZ(a,b)}})},{"./basemap-model":755,backbone:"backbone",underscore:"underscore"}],767:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-basemapHeader"></div>\n<div class="js-basemapContent Editor-content"></div>\n';return __p}},{underscore:"underscore"}],768:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="u-flex u-alignCenter Editor-contextSwitcher js-mapTableView\n  ',"table"===context&&(__p+="in-table"),__p+="\n  ",isThereOtherWidgets&&"map"===context&&(__p+="is-moved"),__p+="\n  ",isThereTimeSeries&&"map"===context&&(__p+="\n    has-timeSeries\n    ",isThereAnimatedTimeSeries&&(__p+="\n      has-timeSeries--animated\n    "),__p+="\n  "),__p+='\n  ">\n  <li class="Editor-contextSwitcherItem">\n    <div class="Editor-contextSwitcherButton js-showTable\n        ',"table"===context&&(__p+="is-selected"),__p+='\n      ">\n      <svg width="11px" height="10px" viewBox="505 436 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(505.000000, 436.000000)">\n          <path d="M3,0 L3,10 L0,10 L0,0 L3,0 Z M1,1 L1,9 L2,9 L2,1 L1,1 Z" id="Combined-Shape" class="Editor-contextSwitcherMedia" ></path>\n          <path d="M7,0 L7,10 L4,10 L4,0 L7,0 Z M5,1 L5,9 L6,9 L6,1 L5,1 Z" id="Combined-Shape-Copy" class="Editor-contextSwitcherMedia" ></path>\n          <path d="M11,0 L11,10 L8,10 L8,0 L11,0 Z M9,1 L9,9 L10,9 L10,1 L9,1 Z" id="Combined-Shape-Copy-2" class="Editor-contextSwitcherMedia" ></path>\n        </g>\n      </svg>\n    </div>\n  </li>\n  <li class="Editor-contextSwitcherItem">\n    <div class="Editor-contextSwitcherButton js-showMap\n        ',"map"===context&&(__p+="is-selected"),__p+='\n      ">\n      <svg width="9px" height="12px" viewBox="538 435 9 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M547,438.913043 C547,441.07513 542.5,447 542.5,447 C542.5,447 538,441.07513 538,438.913043 C538,436.752 540.0142,435 542.5,435 C544.9852,435 547,436.752 547,438.913043 Z M543.908614,443.22687 C544.16716,442.824347 544.408524,442.43401 544.629457,442.059548 C545.498835,440.586034 546,439.426635 546,438.913043 C546,437.337768 544.461567,436 542.5,436 C540.538058,436 539,437.337565 539,438.913043 C539,439.426635 539.501165,440.586034 540.370543,442.059548 C540.591476,442.43401 540.83284,442.824347 541.091386,443.22687 C541.539951,443.925227 542.019537,444.628807 542.501367,445.306148 C542.537557,445.357022 543.426358,443.97768 543.908614,443.22687 Z" id="Combined-Shape" stroke="none" class="Editor-contextSwitcherMedia" fill-rule="evenodd"></path>\n      </svg>\n    </div>\n  </li>\n</ul>\n\n<div class="EditOverlay js-editOverlay is-hidden"><p class="EditOverlay-inner CDB-Text CDB-Size-medium u-whiteTextColor js-editOverlay-text"></p></div>\n\n<ul class="u-flex u-alignRight Editor-contextSwitcher Editor-contextSwitcher--geom js-mapTableView js-newGeometryView\n',"table"===context&&(__p+="in-table"),__p+="\n",isThereOtherWidgets&&"map"===context&&(__p+="is-moved"),__p+="\n",isThereTimeSeries&&"map"===context&&(__p+="\n  has-timeSeries\n  ",isThereAnimatedTimeSeries&&(__p+="\n    has-timeSeries--animated\n  "),__p+="\n"),__p+='\n"\n',!isReadOnly&&isVisible||(__p+='data-tooltip="'+(null==(__t=_t("editor.edit-feature.geometry-disabled"))?"":_.escape(__t))+'"'),__p+="\n>\n  ","point"!==queryGeometryModel&&queryGeometryModel||(__p+='\n    <li class="Editor-contextSwitcherItem js-newGeometryItem ',!isReadOnly&&isVisible||(__p+="is-disabled"),__p+='">\n      <div class="Editor-contextSwitcherButton js-newGeometry" data-feature-type=\'point\'>\n        <svg width="12" height="12" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <defs>\n            <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" id="a"/>\n            <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" id="c"/>\n            <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" id="e"/>\n          </defs>\n          <g fill="none" fill-rule="evenodd">\n            <path fill="#FFF" d="M4 3h3v1H4v3H3V4H0V3h3V0h1"/>\n            <g transform="rotate(180 2.5 6)">\n              <mask id="b" fill="#fff">\n                <use xlink:href="#a"/>\n              </mask>\n              <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" mask="url(#b)" stroke="#FFF" stroke-width="2"/>\n            </g>\n            <g transform="rotate(180 6 6)">\n              <mask id="d" fill="#fff">\n                <use xlink:href="#c"/>\n              </mask>\n              <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" mask="url(#d)" stroke="#FFF" stroke-width="2"/>\n            </g>\n            <g transform="rotate(180 6 2.5)">\n              <mask id="f" fill="#fff">\n                <use xlink:href="#e"/>\n              </mask>\n              <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" mask="url(#f)" stroke="#FFF" stroke-width="2"/>\n            </g>\n          </g>\n        </svg>\n      </div>\n    </li>\n  '),__p+="\n  ","line"!==queryGeometryModel&&queryGeometryModel||(__p+='\n    <li class="Editor-contextSwitcherItem js-newGeometryItem ',!isReadOnly&&isVisible||(__p+="is-disabled"),__p+='">\n      <div class="Editor-contextSwitcherButton js-newGeometry" data-feature-type=\'line\'>\n        <svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <defs>\n            <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" id="a"/>\n            <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" id="c"/>\n          </defs>\n          <g fill="none" fill-rule="evenodd">\n            <path fill="#FFF" d="M11.5 5l-.707-.707-6.354 6.853.705.708"/>\n            <g transform="translate(11 2)">\n              <mask id="b" fill="#fff">\n                <use xlink:href="#a"/>\n              </mask>\n              <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" mask="url(#b)" stroke="#FFF" stroke-width="2"/>\n            </g>\n            <g transform="translate(2 11)">\n              <mask id="d" fill="#fff">\n                <use xlink:href="#c"/>\n              </mask>\n              <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" mask="url(#d)" stroke="#FFF" stroke-width="2"/>\n            </g>\n            <path fill="#FFF" d="M3 4H0V3h3V0h1v3h3v1H4v3H3"/>\n          </g>\n        </svg>\n      </div>\n    </li>\n  '),__p+="\n  ","polygon"!==queryGeometryModel&&queryGeometryModel||(__p+='\n    <li class="Editor-contextSwitcherItem js-newGeometryItem ',!isReadOnly&&isVisible||(__p+="is-disabled"),__p+='">\n      <div class="Editor-contextSwitcherButton js-newGeometry" data-feature-type=\'polygon\'>\n        <svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <defs>\n            <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" id="a"/>\n            <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" id="c"/>\n            <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" id="e"/>\n          </defs>\n          <g fill="none" fill-rule="evenodd">\n            <path d="M13 11.5V5h-1v7h1m-.5-7.5l-.707-.707-7.647 7.353-.353.354.707.707.354-.353M4 3h3v1H4v3H3V4H0V3h3V0h1" fill="#FFF"/>\n            <path fill="#FFF" d="M4.5 13H12v-1H4v1"/>\n            <g transform="rotate(180 7 7)">\n              <mask id="b" fill="#fff">\n                <use xlink:href="#a"/>\n              </mask>\n              <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" stroke="#FFF" stroke-width="2" mask="url(#b)"/>\n            </g>\n            <g transform="rotate(180 7 2.5)">\n              <mask id="d" fill="#fff">\n                <use xlink:href="#c"/>\n              </mask>\n              <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" stroke="#FFF" stroke-width="2" mask="url(#d)"/>\n            </g>\n            <g transform="rotate(180 2.5 7)">\n              <mask id="f" fill="#fff">\n                <use xlink:href="#e"/>\n              </mask>\n              <path d="M0 2h3v1H0V2zm0-2h3v1H0V0zm2 1h1v1H2V1zM0 1h1v1H0V1z" stroke="#FFF" stroke-width="2" mask="url(#f)"/>\n            </g>\n          </g>\n        </svg>\n      </div>\n    </li>\n  '),__p+="\n</ul>\n";return __p}},{underscore:"underscore"}],769:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){if(__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n            <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">'+(null==(__t=_t("editor.layers.delete.title",{layerName:layerName}))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("editor.layers.delete.desc",{layerVisName:layerVisName}))?"":__t)+'</p>\n      <ul class="Modal-listText">\n        ',affectedItemsMessages.length>0){__p+='\n          <li class="Modal-listTextItem">\n            <p class="CDB-Text CDB-Size-large">\n              '+(null==(__t=_t("editor.layers.delete.affected-items"))?"":__t)+"\n              ";for(var i=0;i<affectedItemsMessages.length;i++)__p+='\n                  <span class="CDB-Text is-semibold">'+(null==(__t=affectedItemsMessages[i])?"":_.escape(__t))+"</span>\n                  ",i<affectedItemsMessages.length-2?__p+="\n                    ,\n                  ":i==affectedItemsMessages.length-2&&(__p+="\n                    "+(null==(__t=_t("editor.layers.delete.and"))?"":__t)+"\n                  "),__p+="\n              ";__p+="\n              .</p>\n          </li>\n        "}__p+='\n        <li class="Modal-listTextItem">\n          <p class="CDB-Text CDB-Size-large">'+(null==(__t=_t("editor.layers.delete.link-to-export"))?"":__t)+'</p>\n        </li>\n      </ul>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("editor.layers.delete.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("editor.layers.delete.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n"}return __p}},{underscore:"underscore"}],770:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone/core-view"),g=a("./edit-feature-content.tpl"),h=a("./edit-feature-content-views/edit-feature-action-view"),i=a("./edit-feature-content-views/edit-feature-control-view"),j=a("./edit-feature-content-views/edit-feature-header-view"),k=a("../../data/visualization-table-model"),l=a("./edit-feature-content-views/edit-feature-inner-view"),m=a("../../components/view-options/panel-with-options-view"),n=a("../../components/scroll/scroll-view"),o=a("../../components/notifier/notifier"),p=a("./edit-feature-content-views/edit-feature-geometry-form-model"),q=a("./edit-feature-content-views/edit-feature-geometry-point-form-model"),r=a("./edit-feature-content-views/edit-feature-attributes-form-model"),s="editFeatureNotification",t=d.template("<span class='u-errorTextColor'><%- title %></span>"),u=["stackLayoutModel","layerDefinitionModel","configModel","mapModeModel","editorModel","modals"];b.exports=f.extend({className:"Editor-content",events:{"click .js-back":"clean"},initialize:function(a){d.each(u,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._featureModel=this._mapModeModel.getFeatureDefinition(),this._tableName="",this._url="",this._editorModel.set({edition:!1}),this._getTable(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g()),this._initViews(),this},_initBinds:function(){"fetched"!==this._querySchemaModel.get("status")&&(this._querySchemaModel.bind("change:status",this.render,this),this._querySchemaModel.fetch()),this._featureModel.bind("updateFeature",this._updateForms,this),this._featureModel.bind("destroyFeature",this._onDestroyFeature,this),this._featureModel.bind("destroyFeatureSuccess",this._onDestroyFeatureSuccess,this),this._featureModel.bind("destroyFeatureFailed",this._onDestroyFeatureFailed,this),this._featureModel.bind("addFeature",this._onAddFeature,this),this._featureModel.bind("saveFeature",this._onSaveFeature,this),this._featureModel.bind("saveFeatureSuccess",this._onSaveFeatureSuccess,this),this._featureModel.bind("saveFeatureFailed",this._onSaveFeatureFailed,this),this.add_related_model(this._featureModel)},_initViews:function(){this._featureModel.isNew()?this._addRow():this._renderInfo()},_updateForms:function(){this._updateGeometry(),this._attributesFormModel.trigger("updateFeature")},_updateGeometry:function(){var a=null;try{a=JSON.parse(this._featureModel.get("the_geom"))}catch(a){}var b;b=this._featureModel.isPoint()?{lng:a&&a.coordinates[0],lat:a&&a.coordinates[1]}:{the_geom:this._featureModel.get("the_geom")},this._geometryFormModel.set(b),this._geometryFormModel.trigger("updateFeature",b)},_addRow:function(){this._renderInfo()},_renderInfo:function(){this._renderHeader(),this._renderContent()},_renderHeader:function(){this._headerView&&(this.removeView(this._headerView),this._headerView.clean()),this._headerView=new j({url:this._url,tableName:this._tableName,model:this._featureModel,modals:this._modals,isNew:this._featureModel.isNew(),backAction:this.clean.bind(this)
}),this.addView(this._headerView),this.$(".js-editFeatureHeader").html(this._headerView.render().el)},_renderContent:function(){var a=this;this._contentView&&(this.removeView(this._contentView),this._contentView.clean());var b=null;try{b=JSON.parse(this._featureModel.get("the_geom"))}catch(a){}this._featureModel.isPoint()?this._geometryFormModel=new q({lng:b&&b.coordinates[0],lat:b&&b.coordinates[1]},{featureModel:this._featureModel}):this._geometryFormModel=new p({the_geom:this._featureModel.get("the_geom")},{featureModel:this._featureModel}),this._attributesFormModel=new r(this._featureModel.toJSON(),{featureModel:this._featureModel,columnsCollection:this._sourceNode.querySchemaModel.columnsCollection,configModel:this._configModel,nodeDefModel:this._layerDefinitionModel.getAnalysisDefinitionNodeModel()}),this._contentView=new m({className:"Editor-content",editorModel:a._editorModel,createContentView:function(){return new n({createContentView:function(){return new l({featureModel:a._featureModel,geometryFormModel:a._geometryFormModel,attributesFormModel:a._attributesFormModel})}})},createControlView:function(){return new i},createActionView:function(){return new h({model:a.model,featureModel:a._featureModel,geometryFormModel:a._geometryFormModel,attributesFormModel:a._attributesFormModel})}}),this.addView(this._contentView),this.$(".js-editFeatureContent").html(this._contentView.render().el)},_onDestroyFeature:function(){o.getNotification(s)&&o.removeNotification(s),this.notification=o.addNotification({id:s,status:"loading",info:_t("notifications.edit-feature.destroy.loading"),closable:!1})},_onDestroyFeatureSuccess:function(){this._onUpdateFeature("destroy"),this.notification.set({status:"success",info:_t("notifications.edit-feature.destroy.success"),closable:!0})},_onDestroyFeatureFailed:function(a,b){this.notification.set({status:"error",info:t({title:_t("notifications.edit-feature.destroy.error")}),closable:!0})},_onAddFeature:function(){o.getNotification(s)&&o.removeNotification(s),this.notification=o.addNotification({id:s,status:"loading",info:_t("notifications.edit-feature.adding"),closable:!1})},_onSaveFeature:function(){o.getNotification(s)&&o.removeNotification(s),this.notification=o.addNotification({id:s,status:"loading",info:_t("notifications.edit-feature.save.loading"),closable:!1})},_onSaveFeatureSuccess:function(a){this._onUpdateFeature(a),this.render(),this.notification.set({status:"success",info:_t("notifications.edit-feature.save.success"),closable:!0})},_onSaveFeatureFailed:function(a,b){this.notification.set({status:"error",info:t({title:_t("notifications.edit-feature.save.error")}),closable:!0})},_onUpdateFeature:function(a){"save"===a&&this._queryGeometryModel.hasValue()||this._queryGeometryModel.resetFetch(),"add"!==a&&"destroy"!==a||this._rowsCollection.resetFetch()},_getTable:function(){if(this._sourceNode=this._getSourceNode(),this._sourceNode){var a=this._sourceNode.get("table_name");this._visTableModel=new k({id:a,table:{name:a}},{configModel:this._configModel}),this._querySchemaModel=this._sourceNode.querySchemaModel,this._queryGeometryModel=this._sourceNode.queryGeometryModel,this._rowsCollection=this._sourceNode.queryRowsCollection}if(this._visTableModel){var b=this._visTableModel.getTableModel();this._tableName=b.getUnquotedName(),this._url=this._visTableModel&&this._visTableModel.datasetURL()}},_getSourceNode:function(){var a,b=this._layerDefinitionModel.getAnalysisDefinitionNodeModel();if("source"===b.get("type"))a=b;else{var c=b.getPrimarySource();c&&"source"===c.get("type")&&(a=c)}return a},_destroyContextOverlay:function(){e(".js-editOverlay").fadeOut(200,function(){e(".js-editOverlay").remove()})},clean:function(){this._destroyContextOverlay(),this._mapModeModel.enterViewingMode(),f.prototype.clean.apply(this)}})},{"../../components/notifier/notifier":475,"../../components/scroll/scroll-view":530,"../../components/view-options/panel-with-options-view":595,"../../data/visualization-table-model":677,"./edit-feature-content-views/edit-feature-action-view":772,"./edit-feature-content-views/edit-feature-attributes-form-model":774,"./edit-feature-content-views/edit-feature-control-view":777,"./edit-feature-content-views/edit-feature-geometry-form-model":779,"./edit-feature-content-views/edit-feature-geometry-point-form-model":782,"./edit-feature-content-views/edit-feature-header-view":783,"./edit-feature-content-views/edit-feature-inner-view":785,"./edit-feature-content.tpl":786,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],771:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">'+(null==(__t=_t("components.modals.edit-feature.delete.title"))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("components.modals.edit-feature.delete.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.modals.edit-feature.delete.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.modals.edit-feature.delete.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],772:[function(a,b,c){var d=a("backbone/core-view"),e=a("./edit-feature-action.tpl");b.exports=d.extend({events:{"click .js-save":"_onSaveClicked"},initialize:function(a){if(!a.featureModel)throw new Error("featureModel is required");if(!a.geometryFormModel)throw new Error("geometryFormModel is required");if(!a.attributesFormModel)throw new Error("attributesFormModel is required");this._featureModel=a.featureModel,this._geometryFormModel=a.geometryFormModel,this._attributesFormModel=a.attributesFormModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(e({label:this._featureModel.isNew()?_t("editor.edit-feature.add"):_t("editor.edit-feature.save"),isDisabled:!this._canSave()})),this},_initBinds:function(){this.model.on("change",this.render,this),this._featureModel.on("change",function(){this.model.set("hasChanges",!0)},this),this.add_related_model(this._featureModel),this._geometryFormModel.bind("validate",function(a){this.model.set("isValidGeometry",!a)},this),this.add_related_model(this._geometryFormModel),this._attributesFormModel.bind("validate",function(a){this.model.set("isValidAttributes",!a)},this),this.add_related_model(this._attributesFormModel)},_canSave:function(){var a=this.model.get("hasChanges"),b=this.model.get("isValidGeometry"),c=this.model.get("isValidAttributes");return b&&c&&a},_onSaveClicked:function(){this._canSave()&&this._saveFeature()},_saveFeature:function(){var a=this,b=this._featureModel.isNew()?"add":"save",c=b+"Feature";this._featureModel.trigger(c),this._featureModel.save({success:function(){a._featureModel.trigger("saveFeatureSuccess",b),a.model.set("hasChanges",!1)},error:function(){a._featureModel.trigger("saveFeatureFailed")}})}})},{"./edit-feature-action.tpl":773,"backbone/core-view":1127}],773:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="CDB-Button CDB-Button--primary js-save ',isDisabled&&(__p+="is-disabled"),__p+='">\n  <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">\n    '+(null==(__t=label)?"":_.escape(__t))+"\n  </span>\n</button>";return __p}},{underscore:"underscore"}],774:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../../../data/column-row-data"),g={string:"Text",boolean:"Radio",number:"Number",date:"DateTime",geometry:"Text"},h=["created_at","the_geom","the_geom_webmercator","updated_at"];b.exports=d.Model.extend({initialize:function(a,b){if(!b.featureModel)throw new Error("featureModel is required");if(!b.columnsCollection)throw new Error("columnsCollection is required");if(!b.configModel)throw new Error("configModel is required");if(!b.nodeDefModel)throw new Error("nodeDefModel is required");this._featureModel=b.featureModel,this._columnsCollection=b.columnsCollection,this._configModel=b.configModel,this._nodeDefModel=b.nodeDefModel,this._generateSchema(),this._initBinds()},_initBinds:function(){this.bind("change",this._onChange,this)},_onChange:function(){e.each(this.changed,function(a,b){this._featureModel.set(b,a)},this)},_getInputType:function(a){var b=a.getRows();return b&&b.length?"Suggest":"Text"},_getSupportedColumnType:function(a){var b=e.find(e.keys(g),function(b){return b===a});return b||"string"},_generateSchema:function(){var a=this;this.schema={},this._columnsCollection.each(function(b){var c=b.get("name"),d=this._getSupportedColumnType(b.get("type"));if(!e.contains(h,c)){if(this.schema[c]={type:g[d]},"date"===d&&(this.schema[c].dialogMode="float"),"string"===d){var i=new f({column:c},{nodeDefModel:this._nodeDefModel,configModel:this._configModel});i.bind("columnsFetched",function(b){var d=a._getInputType(this);a.schema[c].type!==d&&(a.schema[c].type=d,"Suggest"===d&&(a.schema[c].dialogMode="float"),a.schema[c].editorAttrs={showSearch:!0,allowFreeTextInput:!0,collectionData:b},a._onChangeSchema())}),i.fetch()}"number"===d&&(this.schema[c].isFormatted=!0,this.schema[c].showSlider=!1),"boolean"===d&&(this.schema[c].options=[{label:_t("form-components.editors.radio.true"),val:!0},{label:_t("form-components.editors.radio.false"),val:!1},{label:_t("form-components.editors.radio.null"),val:null}]),"cartodb_id"===c&&(this.schema[c].isFormatted=!1,this.schema[c].editorAttrs={disabled:!0})}},this)},_onChangeSchema:function(){this.trigger("changeSchema")}})},{"../../../data/column-row-data":617,backbone:"backbone",underscore:"underscore"}],775:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./edit-feature-attributes-form.tpl");b.exports=e.extend({render:function(){return this.clearSubViews(),this.$el.html(f()),this._generateForms(),this.model.bind("changeSchema",this._generateForms,this),this},_generateForms:function(){var a=this;this._formView&&this._formView.remove(),this._formView=new d.Form({model:this.model}),this._formView.bind("change",function(){var b=this.validate();a.model.trigger("validate",!!b),b||this.commit()}),this.$(".js-form").append(this._formView.render().$el)},clean:function(){this._formView&&this._formView.remove()}})},{"./edit-feature-attributes-form.tpl":776,backbone:"backbone","backbone/core-view":1127}],776:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n\n  <div class="Editor-HeaderInfo-inner CDB-Text">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.edit-feature.attributes"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.edit-feature.attributes-columns"))?"":_.escape(__t))+'</p>\n    <div class="js-form"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],777:[function(a,b,c){var d=a("backbone/core-view"),e=a("./edit-feature-control.tpl");b.exports=d.extend({render:function(){return this.$el.html(e()),this}})},{"./edit-feature-control.tpl":778,"backbone/core-view":1127}],778:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="CDB-Button u-upperCase js-back">\n  <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-actionTextColor">'+(null==(__t=_t("editor.edit-feature.cancel"))?"":_.escape(__t))+"</span>\n</button>\n";return __p}},{underscore:"underscore"}],779:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({initialize:function(a,b){if(!b.featureModel)throw new Error("featureModel is required");this._featureModel=b.featureModel,this._generateSchema()},_generateSchema:function(){this.schema={},this.schema.the_geom={type:"Text",validators:["required"],editorAttrs:{disabled:!0},hasCopyButton:this._featureModel.has("the_geom")}}})},{backbone:"backbone"}],780:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("backbone/core-view"),g=a("./edit-feature-geometry-form.tpl");b.exports=f.extend({render:function(){return this.clearSubViews(),this.$el.html(g()),this._generateForms(),this},_generateForms:function(){this._formView&&this._formView.remove(),this._formView=new d.Form({model:this.model}),this._formView.bind("change",this._validateForm,this),this.model.bind("updateFeature",function(a){e.each(a,function(a,b){this._formView.fields[b].editor.setValue(a)},this),this._validateForm()},this),this.$(".js-form").append(this._formView.render().$el)},_validateForm:function(){var a=this._formView.validate();this.model.trigger("validate",!!a),a||this._formView.commit()},clean:function(){this._formView&&this._formView.remove()}})},{"./edit-feature-geometry-form.tpl":781,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],781:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">1</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.edit-feature.geometry"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.edit-feature.geometry-edit"))?"":_.escape(__t))+'</p>\n    <div class="js-form"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],782:[function(a,b,c){var d=a("underscore"),e=a("./edit-feature-geometry-form-model"),f=function(a){if(g(a))return parseFloat(parseFloat(a).toFixed(8))},g=function(a){return d.isNumber(a)||d.isString(a)},h=function(a){if(a&&a.coordinates&&2===a.coordinates.length)return a.coordinates},i=-90,j=90,k=-180,l=180;b.exports=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this._initBinds()},_initBinds:function(){this.bind("change:lat",this._onLatLngChange,this),this.bind("change:lng",this._onLatLngChange,this)},_onLatLngChange:function(){var a=this._toGeoJSON(),b={};this._featureModel.get("the_geom")&&(b=JSON.parse(this._featureModel.get("the_geom"))),d.isEqual(a,b)||this._featureModel.set("the_geom",JSON.stringify(a))},_toGeoJSON:function(){var a=this._getLatitude(),b=this._getLongitude();if(g(a)&&g(b))return{type:"Point",coordinates:[b,a]}},_getLatitude:function(){if(this.has("lat"))return f(this.get("lat"));var a=JSON.parse(this._featureModel.get("the_geom")),b=h(a),c=b&&b[1];return c?f(c):void 0},_getLongitude:function(){if(this.has("lng"))return f(this.get("lng"));var a=JSON.parse(this._featureModel.get("the_geom")),b=h(a),c=b&&b[1];return c?f(c):void 0},_validateLatitude:function(a,b){var c=+a,e={type:"lat",message:_t("editor.edit-feature.valid-lat")};return d.isNumber(c)&&c>=i&&c<=j?null:(d.isNumber(c)&&(c>j||c<i)&&(e.message=_t("editor.edit-feature.out-of-bounds-lat")),e)},_validateLongitude:function(a,b){var c=+a,e={type:"lng",message:_t("editor.edit-feature.valid-lng")};return d.isNumber(c)&&c>=k&&c<=l?null:(d.isNumber(c)&&(c>l||c<k)&&(e.message=_t("editor.edit-feature.out-of-bounds-lng")),e)},_generateSchema:function(){this.schema={},this.schema.lng={type:"Number",validators:["required",this._validateLongitude],showSlider:!1},this.schema.lat={type:"Number",validators:["required",this._validateLatitude],showSlider:!1}}})},{"./edit-feature-geometry-form-model":779,underscore:"underscore"}],783:[function(a,b,c){var d=a("backbone/core-view"),e=a("./edit-feature-header.tpl"),f=a("../../../components/context-menu-factory-view"),g=a("../../../components/modals/confirmation/modal-confirmation-view"),h=a("./delete-feature-confirmation.tpl");b.exports=d.extend({initialize:function(a){if(!a.url)throw new Error("url is required");if(!a.tableName)throw new Error("tableName is required");if(!a.modals)throw new Error("modals is required");if(void 0===a.isNew)throw new Error("isNew is required");if(!a.backAction)throw new Error("backAction is required");this._url=a.url,this._tableName=a.tableName,this._modals=a.modals,this._isNew=a.isNew,this._backAction=a.backAction},render:function(){this.clearSubViews();var a=this.model.getFeatureType();return this.$el.html(e({url:this._url,tableName:this._tableName,featureType:a?_t("editor.edit-feature.features."+a):_t("editor.edit-feature.features.geometry")})),this._isNew||this._initViews(),this},_initViews:function(){var a=[{label:_t("editor.edit-feature.delete",{featureType:_t("editor.edit-feature.features."+this.model.getFeatureType())}),val:"delete-feature",destructive:!0,action:this._confirmDeleteFeature.bind(this)}];this._contextMenuFactory=new f({menuItems:a}),this.$(".js-context-menu").append(this._contextMenuFactory.render().el),this.addView(this._contextMenuFactory)},_confirmDeleteFeature:function(){var a=this;this._modals.create(function(b){return new g({modalModel:b,template:h,runAction:a._destroyFeature.bind(a)})})},_destroyFeature:function(){var a=this;this.model.trigger("destroyFeature"),this.model.destroy({success:function(){a.model.trigger("destroyFeatureSuccess"),a._backAction()},error:function(){a.model.trigger("destroyFeatureFailed")}})}})},{"../../../components/context-menu-factory-view":37,"../../../components/modals/confirmation/modal-confirmation-view":404,"./delete-feature-confirmation.tpl":771,"./edit-feature-header.tpl":784,"backbone/core-view":1127}],784:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfoEditor">\n  <div class="u-rSpace--xl u-actionTextColor js-back Editor-HeaderInfoEditorShape">\n    <button>\n      <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n    </button>\n  </div>\n\n  <div class="Editor-HeaderInfo-inner u-ellipsis">\n    <div class="Editor-HeaderInfo-title u-bSpace">\n      <h2 class="Inline-editor">\n        <div class="CDB-Text CDB-Size-huge is-light u-ellipsis">'+(null==(__t=_t("editor.edit-feature.edit",{featureType:featureType}))?"":_.escape(__t))+'</div>\n      </h2>\n    </div>\n    <div class="u-flex u-ellipsis">\n      <p class="Editor-headerLayerName CDB-Text CDB-Size-medium u-ellipsis">\n        <a href="'+(null==(__t=url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=tableName)?"":_.escape(__t))+'" class="Editor-headerLayerName">'+(null==(__t=tableName)?"":_.escape(__t))+'</a>\n      </p>\n    </div>\n  </div>\n  <div class="u-flex u-tSpace-xl js-context-menu"></div>\n</div>\n';return __p}},{underscore:"underscore"}],785:[function(a,b,c){var d=a("backbone/core-view"),e=a("./edit-feature-geometry-form-view"),f=a("./edit-feature-attributes-form-view");b.exports=d.extend({initialize:function(a){if(!a.featureModel)throw new Error("featureModel is required");if(!a.geometryFormModel)throw new Error("geometryFormModel is required");if(!a.attributesFormModel)throw new Error("attributesFormModel is required");this._featureModel=a.featureModel,this._geometryFormModel=a.geometryFormModel,this._attributesFormModel=a.attributesFormModel},render:function(){return this._editFeatureGeometryFormView&&this._editFeatureGeometryFormView.clean(),this._editFeatureAttributesFormView&&this._editFeatureAttributesFormView.clean(),this.clearSubViews(),this.$el.empty(),this._editFeatureGeometryFormView=new e({model:this._geometryFormModel}),this.addView(this._editFeatureGeometryFormView),this.$el.append(this._editFeatureGeometryFormView.render().el),this._editFeatureAttributesFormView=new f({model:this._attributesFormModel}),this.addView(this._editFeatureAttributesFormView),this.$el.append(this._editFeatureAttributesFormView.render().el),this}})},{"./edit-feature-attributes-form-view":775,"./edit-feature-geometry-form-view":780,"backbone/core-view":1127}],786:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-editFeatureHeader"></div>\n<div class="Editor-content js-editFeatureContent"></div>\n';return __p}},{underscore:"underscore"}],787:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="Editor-HeaderInfo-titleText Inline-editor" title="'+(null==(__t=alias)?"":_.escape(__t))+'">\n  <div class="CDB-Text CDB-Size-huge is-light u-ellipsis js-title Inline-editor-text">'+(null==(__t=alias)?"":_.escape(__t))+'</div>\n  <input type="text" name="text" class="Inline-editor-input Inline-editor-input--small CDB-Text CDB-InputText js-input" value="'+(null==(__t=alias)?"":_.escape(__t))+'" readonly>\n</h2>';return __p}},{underscore:"underscore"}],788:[function(a,b,c){var d=a("backbone/core-view"),e=a("./layer-analysis-draggable-view");b.exports=d.extend({tagName:"ul",options:{sortableSelector:""},initialize:function(a){if(!this.options.sortableSelector)throw new Error("sortableSelector is required");if(!a.layerAnalysisViewFactory)throw new Error("layerAnalysisViewFactory is required");this._layerAnalysisViewFactory=a.layerAnalysisViewFactory},render:function(){this.clearSubViews();var a=this.model.getAnalysisDefinitionNodeModel();return this._renderNode(a),this},_renderNode:function(a){this._createNodeView(a);var b=a.getPrimarySource();b&&this.model.isOwnerOfAnalysisNode(a)&&this._renderNode(b)},_createNodeView:function(a){var b=this._layerAnalysisViewFactory.createView(a,this.model);this.addView(b),this.$el.append(b.render().el),this._attachDraggableToNodeView(b,a)},_attachDraggableToNodeView:function(a,b){if(this.model.isOwnerOfAnalysisNode(b)){var c=new e({model:b,getNextLetter:this.model.collection.nextLetter.bind(this.model.collection),$nodeViewElement:a.$el,sortableSelector:this.options.sortableSelector});this.addView(c)}}})},{"./layer-analysis-draggable-view":789,"backbone/core-view":1127}],789:[function(a,b,c){a("jquery-ui");var d=a("backbone/core-view"),e=a("./layer-analysis-draggable.tpl"),f=a("../../data/analyses"),g=a("../../data/layer-colors");b.exports=d.extend({options:{getNextLetter:function(){return"x"},sortableSelector:"",$nodeViewElement:null},initialize:function(){if(!this.options.sortableSelector)throw new Error("sortableSelector is required");if(!this.options.$nodeViewElement)throw new Error("$nodeViewElement is required");this.options.$nodeViewElement.draggable({appendTo:this.options.sortableSelector,connectToSortable:this.options.sortableSelector,cursor:"move",axis:"y",cursorAt:{top:40},helper:this._createHelper.bind(this)})},_createHelper:function(){var a=this.options.getNextLetter();return e({nodeId:this.model.id,nextLetter:a,nextBgColor:g.getColorForLetter(a),title:f.title(this.model)})},clean:function(){this.options.$nodeViewElement&&this.options.$nodeViewElement.data("ui-draggable")&&this.options.$nodeViewElement.draggable("destroy"),this.options.$nodeViewElement=null,d.prototype.clean.apply(this,arguments)}})},{"../../data/analyses":599,"../../data/layer-colors":633,"./layer-analysis-draggable.tpl":790,"backbone/core-view":1127,"jquery-ui":1128}],790:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li class="Editor-newLayerContainer" data-analysis-node-id="'+(null==(__t=nodeId)?"":_.escape(__t))+'" style="width: 294px;">\n  <div class="Editor-ListLayer-item">\n    <div class="Editor-ListLayer-itemHeader">\n      <div class="Editor-ListLayer-media u-rSpace--m" style="background: '+(null==(__t=nextBgColor)?"":_.escape(__t))+'; color: #fff">\n        <p class="CDB-Text CDB-Size-large is-semibold u-upperCase">'+(null==(__t=nextLetter)?"":_.escape(__t))+'</p>\n      </div>\n      <div class="Editor-ListLayer-inner">\n        <div class="Editor-ListLayer-title">\n          <h2 class="Editor-ListLayer-titleText CDB-Text CDB-Size-large u-ellipsis">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n        </div>\n        <button class="CDB-Text CDB-Size-small u-actionTextColor u-upperCase">'+(null==(__t=_t("editor.layers.layer.add-analysis"))?"":_.escape(__t))+'</button>\n      </div>\n    </div>\n  </div>\n  <div class="Editor-layerInfo CDB-Text CDB-Size-small u-whiteTextColor">\n    Created new layer based on ['+(null==(__t=nodeId)?"":_.escape(__t))+"]\n  </div>\n</li>\n";return __p}},{underscore:"underscore"}],791:[function(a,b,c){var d=a("./analysis-views/ref-layer-analysis-view"),e=a("./analysis-views/default-layer-analysis-view"),f=a("./analysis-views/source-layer-analysis-view"),g=a("./analysis-views/composite-layer-analysis-view"),h=function(a){this._analysisDefinitionNodesCollection=a};h.prototype.createView=function(a,b){if(!a)throw new Error("nodeDefModel is required");if(!b)throw new Error("layerDefinitionModel is required");var c=this._analysisDefinitionNodesCollection.get(a.id),h=a.sourceIds().length,i=b.collection.findOwnerOfAnalysisNode(a);switch(i!==b&&(h=null),h){case 2:return new g({model:a,analysisDefinitionNodesCollection:this._analysisDefinitionNodesCollection,layerDefinitionModel:b});case 0:return new f({model:a,analysisNode:c,layerDefinitionModel:b});case 1:return new e({model:a,analysisNode:c,layerDefinitionModel:b});default:return new d({model:a,analysisNode:c,layerDefinitionModel:i||b})}},b.exports=h},{"./analysis-views/composite-layer-analysis-view":725,"./analysis-views/default-layer-analysis-view":727,"./analysis-views/ref-layer-analysis-view":729,"./analysis-views/source-layer-analysis-view":731}],792:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone"),g=a("backbone/core-view"),h=a("../../components/tab-pane/create-text-labels-tab-pane"),i=a("./layer-tab-pane.tpl"),j=a("./layer-header-view.js"),k=a("./layer-content-views/analyses/analyses-view"),l=a("../style/style-view"),m=a("./layer-content-views/infowindow/infowindows-view"),n=a("../../data/tables-collection"),o=a("./layer-content-views/analyses/analysis-source-options-model"),p=a("./layer-content-views/analyses/analysis-forms-collection"),q=a("../../components/table/table-manager"),r=a("./change-view-buttons.tpl"),s=a("./layer-content-views/data/data-view"),t=a("./layer-content-views/legend/legends-view"),u=a("../../data/feature-definition-model"),v=a("./layer-content-views/analyses/analyses-service"),w=a("../../helpers/required-opts"),x=a("../../components/tipsy-tooltip-view"),y=["userActions","analysisDefinitionNodesCollection","layerDefinitionsCollection","layerDefinitionModel","widgetDefinitionsCollection","legendDefinitionsCollection","stackLayoutModel","modals","onboardings","configModel","editorModel","userModel","mapDefinitionModel","mapModeModel","visDefinitionModel","stateDefinitionModel","onboardingNotification"];b.exports=g.extend({events:{"click .js-back":"_onClickBack","click .js-fix-sql":"_onClickFixSQL"},options:{selectedTabItem:null,analysisPayload:null},initialize:function(a){w(a,y,this),this.model=new f.Model({context:"map"}),this._styleViewId=null,v.setLayerId(this._layerDefinitionModel.get("id")),this._initBinds()},render:function(){this._unbindEvents(),this.clearSubViews(),this._destroyTable(),this.$el.empty();var a=this,b=this.options.selectedTabItem,c=this.options.analysisPayload,e=this._getAnalysisDefinitionNodeModel(),f=e.isSourceType()&&e.getTableModel(),g=[{label:_t("editor.layers.menu-tab-pane-labels.data"),name:"data",selected:!b||"data"===b,createContentView:function(){return new s({className:"Editor-content",widgetDefinitionsCollection:a._widgetDefinitionsCollection,layerDefinitionModel:a._layerDefinitionModel,stackLayoutModel:a._stackLayoutModel,userActions:a._userActions,configModel:a._configModel,editorModel:a._editorModel,userModel:a._userModel,onboardings:a._onboardings,onboardingNotification:a._onboardingNotification})}},{label:_t("editor.layers.menu-tab-pane-labels.analyses"),name:"analyses",selected:b&&"analyses"===b&&!!c,createContentView:function(){var e=new o(null,{analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,layerDefinitionsCollection:a._layerDefinitionsCollection,tablesCollection:new n(null,{configModel:a._configModel})});e.fetch();var f=new p(null,{userActions:a._userActions,configModel:a._configModel,layerDefinitionModel:a._layerDefinitionModel,analysisSourceOptionsModel:e});f.resetByLayerDefinition();var g;return d.isString(c)?g=c:d.isObject(c)?(g=c.id,f.addHead(c)):g=a._layerDefinitionModel.get("source"),b=null,c=null,new k({className:"Editor-content",userActions:a._userActions,analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,editorModel:a._editorModel,userModel:a._userModel,analysisFormsCollection:f,configModel:a._configModel,layerDefinitionModel:a._layerDefinitionModel,stackLayoutModel:a._stackLayoutModel,selectedNodeId:g,onboardings:a._onboardings,onboardingNotification:a._onboardingNotification})}},{label:_t("editor.layers.menu-tab-pane-labels.style"),name:"style",selected:b&&"style"===b,createContentView:function(){b=null;var c=new l({className:"Editor-content",configModel:a._configModel,userModel:a._userModel,userActions:a._userActions,analysisDefinitionsCollection:a.analysisDefinitionsCollection,queryGeometryModel:a._getQueryGeometryModel(),querySchemaModel:a._getQuerySchemaModel(),queryRowsCollection:a._getQueryRowsCollection(),layerDefinitionsCollection:a._layerDefinitionsCollection,layerDefinitionModel:a._layerDefinitionModel,editorModel:a._editorModel,modals:a._modals,onboardings:a._onboardings,onboardingNotification:a._onboardingNotification});return a._styleViewId=c.cid,c}},{label:_t("editor.layers.menu-tab-pane-labels.infowindow"),name:"infowindow",createContentView:function(){var b=a._layerDefinitionModel.getAnalysisDefinitionNodeModel();return new m({className:"Editor-content",
userActions:a._userActions,layerDefinitionModel:a._layerDefinitionModel,queryGeometryModel:b.queryGeometryModel,querySchemaModel:b.querySchemaModel,queryRowsCollection:b.queryRowsCollection,configModel:a._configModel,editorModel:a._editorModel})}},{label:_t("editor.layers.menu-tab-pane-labels.legends"),name:"legends",createContentView:function(){var b=a._layerDefinitionModel.getAnalysisDefinitionNodeModel();return new t({className:"Editor-content",mapDefinitionModel:a._mapDefinitionModel,userActions:a._userActions,layerDefinitionModel:a._layerDefinitionModel,queryGeometryModel:b.queryGeometryModel,querySchemaModel:b.querySchemaModel,queryRowsCollection:b.queryRowsCollection,legendDefinitionsCollection:a._legendDefinitionsCollection,editorModel:a._editorModel,userModel:a._userModel,configModel:a._configModel,modals:a._modals})}}],q=new j({layerDefinitionsCollection:this._layerDefinitionsCollection,layerDefinitionModel:this._layerDefinitionModel,userActions:this._userActions,configModel:this._configModel,modals:this._modals,tableNodeModel:f,editorModel:this._editorModel,stateDefinitionModel:this._stateDefinitionModel,visDefinitionModel:this._visDefinitionModel,userModel:this._userModel,widgetDefinitionsCollection:this._widgetDefinitionsCollection});this.addView(q),this.$el.append(q.render().$el);var r={tabPaneOptions:{template:i,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};return this._layerTabPaneView=h(g,r),this._bindEvents(),this.$el.append(this._layerTabPaneView.render().el),this.addView(this._layerTabPaneView),this._layerTabPaneView.$el.addClass("js-editorPanelContent"),this._renderContextButtons(),this},_initBinds:function(){this.listenTo(this.model,"change:context",this._renderContextButtons),this.listenTo(this._layerDefinitionModel,"remove",this._onClickBack),this.listenTo(this._layerDefinitionModel,"change:source",function(){"table"===this.model.get("context")&&this._initTable(),this._renderContextButtons()}.bind(this)),this.listenTo(this._layerDefinitionModel,"change:visible",this._renderContextButtons),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.listenTo(this._widgetDefinitionsCollection,"add remove",this._renderContextButtons),this.listenTo(this._getQuerySchemaModel(),"change:query",this._renderContextButtons),this.listenTo(this._onboardings,"style",function(){this._layerTabPaneView.collection.select("name","style")});var a=this._getQueryGeometryModel();a.shouldFetch()&&(a.once("change:simple_geom",function(a,b){a.hasValue()&&(this._layerDefinitionModel.styleModel.setDefaultPropertiesByType("simple",b,!0),this.render()),this._renderContextButtons()},this),this.add_related_model(a),a.fetch())},_destroyTable:function(){this._tableView&&(q.destroy(this._tableView),delete this._tableView)},_initTable:function(){this._tableView&&this._destroyTable(),this._tableView=q.create({analysisDefinitionNodeModel:this._getAnalysisDefinitionNodeModel(),configModel:this._configModel,modals:this._modals,userModel:this._userModel}),e(".js-editor .CDB-Dashboard-canvas").append(this._tableView.render().el)},_renderContextButtons:function(){this._destroyContextButtons();var a=this._getAnalysisDefinitionNodeModel(),b=a.isReadOnly(),c=this._layerDefinitionModel.get("visible"),d=this._getQueryGeometryModel();if(e(".CDB-Dashboard-canvas").append(r({context:this.model.get("context"),isThereOtherWidgets:this._widgetDefinitionsCollection.isThereOtherWidgets(),isThereTimeSeries:this._widgetDefinitionsCollection.isThereTimeSeries(),isThereAnimatedTimeSeries:this._widgetDefinitionsCollection.isThereTimeSeries({animated:!0}),queryGeometryModel:d.get("simple_geom"),isSourceType:a.isSourceType(),isVisible:c,isReadOnly:b})),e(".js-showMap").bind("click",this._onMapClick.bind(this)),e(".js-showTable").bind("click",this._onTableClick.bind(this)),e(".js-newGeometry").bind("click",this._onClickNewGeometry.bind(this)),b||!c){var f=new x({el:e(".js-newGeometryView"),title:function(){return e(this).data("tooltip")}});this.addView(f)}},_destroyContextButtons:function(){e(".js-mapTableView").remove(),e(".js-newGeometryView").remove()},_onMapClick:function(a){var b=this.model.get("context");"map"!==b&&(this._destroyTable(),this.model.set("context","map"))},_onTableClick:function(a){var b=this.model.get("context");"table"!==b&&(this._initTable(),this.model.set("context","table"))},_unbindEvents:function(){this._layerTabPaneView&&this._layerTabPaneView.collection&&this._layerTabPaneView.collection.off("change:selected",this._quitEditing,this)},_bindEvents:function(){this._layerTabPaneView.collection.on("change:selected",this._quitEditing,this),this.add_related_model(this._layerTabPaneView.collection)},_onClickBack:function(){this._editorModel.set({edition:!1}),this._stackLayoutModel.prevStep("layers")},_onClickNewGeometry:function(a){var b=e(a.target).closest(".js-newGeometry"),c=b.data("feature-type");if(b.closest(".js-newGeometryItem").hasClass("is-disabled"))return!1;var d=_t("editor.edit-feature.overlay-text",{featureType:_t("editor.edit-feature.features."+c)});e(".js-editOverlay-text").html(d),e(".js-editOverlay").fadeIn(200,function(){e(".js-editOverlay").removeClass("is-hidden")});var f=this._newFeatureDefinitionModel({featureType:c});this._mapModeModel.enterDrawingFeatureMode(f)},_newFeatureDefinitionModel:function(a){return new u({},{configModel:this._configModel,layerDefinitionModel:this._layerDefinitionModel,userModel:this._userModel,featureType:a.featureType})},_onClickFixSQL:function(){this._editorModel.set({edition:!1},{silent:!0}),this._layerTabPaneView.getTabPane("data").set({selected:!0})},_changeStyle:function(){this._layerTabPaneView.changeStyleMenu(this._editorModel)},_quitEditing:function(){"style"!==this._layerTabPaneView.getSelectedTabPaneName()&&"infowindow"!==this._layerTabPaneView.getSelectedTabPaneName()&&"legends"!==this._layerTabPaneView.getSelectedTabPaneName()&&this._editorModel.set({edition:!1})},_getAnalysisDefinitionNodeModel:function(){return this._layerDefinitionModel.getAnalysisDefinitionNodeModel()},_getQueryGeometryModel:function(){return this._getAnalysisDefinitionNodeModel().queryGeometryModel},_getQuerySchemaModel:function(){return this._getAnalysisDefinitionNodeModel().querySchemaModel},_getQueryRowsCollection:function(){return this._getAnalysisDefinitionNodeModel().queryRowsCollection},clean:function(){this._destroyContextButtons(),this._destroyTable(),g.prototype.clean.apply(this)}})},{"../../components/tab-pane/create-text-labels-tab-pane":537,"../../components/table/table-manager":586,"../../components/tipsy-tooltip-view":589,"../../data/feature-definition-model":626,"../../data/tables-collection":666,"../../helpers/required-opts":1097,"../style/style-view":1052,"./change-view-buttons.tpl":768,"./layer-content-views/analyses/analyses-service":800,"./layer-content-views/analyses/analyses-view":802,"./layer-content-views/analyses/analysis-forms-collection":875,"./layer-content-views/analyses/analysis-source-options-model":877,"./layer-content-views/data/data-view":891,"./layer-content-views/infowindow/infowindows-view":926,"./layer-content-views/legend/legends-view":967,"./layer-header-view.js":971,"./layer-tab-pane.tpl":973,backbone:"backbone","backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],793:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">'+(null==(__t=_t("editor.layers.analysis-form.placeholder-text"))?"":_.escape(__t))+'</h2>\n<div class="BlockList-item is-dashed no-hover is-space u-tSpace-xl">\n  <ul class="HorizontalBlockList">\n    <li class="HorizontalBlockList-item"></li>\n    <li class="HorizontalBlockList-item"></li>\n  </ul>\n\n  <button class="CDB-Button CDB-Button--primary js-add-analysis">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("editor.layers.layer.add-analysis"))?"":_.escape(__t))+"</span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],794:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("cartodb.js"),g=a("../../../../../helpers/error-parser"),h=d.template("select cdb_dataservices_client.cdb_enough_quota('<%= analysis %>', <%= rows %>);");b.exports={init:function(a){this.SQL=new f.SQL({user:a.get("user_name"),sql_api_template:a.get("sql_api_template"),api_key:a.get("api_key")})},fetch:function(a,b){var c=h({analysis:a,rows:b});if(!this.deferred||"pending"!==this.deferred.state()){var d=e.Deferred();this.deferred=d;var f=function(a){d.reject(g(a))},i=function(a){d.resolve(a.rows[0].cdb_enough_quota)};this.SQL.execute(c,null,{success:i,error:f})}return this.deferred.promise()}}},{"../../../../../helpers/error-parser":1090,"cartodb.js":"cartodb.js",jquery:"jquery",underscore:"underscore"}],795:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("cartodb.js"),g=a("../../../../../helpers/error-parser"),h=d.template("SELECT CDB_EstimateRowCount($$<%= query %>;$$)  AS row_count;");b.exports={init:function(a){this.SQL=new f.SQL({user:a.get("user_name"),sql_api_template:a.get("sql_api_template"),api_key:a.get("api_key")})},fetch:function(a){var b=h({query:a});if(!this.deferred||"pending"!==this.deferred.state()){var c=e.Deferred();this.deferred=c;var d=function(a){return a.rows[0].row_count},f=function(a){c.reject(g(a))},i=function(a){c.resolve(d(a))};this.SQL.execute(b,null,{success:i,error:f})}return this.deferred.promise()}}},{"../../../../../helpers/error-parser":1090,"cartodb.js":"cartodb.js",jquery:"jquery",underscore:"underscore"}],796:[function(a,b,c){var d,e=a("underscore"),f=a("backbone"),g=a("cartodb.js"),h=a("../../../../../helpers/error-parser"),i="select * from cdb_dataservices_client.cdb_service_quota_info();",j=f.Collection.extend({initialize:function(a,b){if(!b||!b.configModel)throw new Error("configModel is required");var c=b.configModel;this.SQL=new g.SQL({user:c.get("user_name"),sql_api_template:c.get("sql_api_template"),api_key:c.get("api_key")}),this._state="unfetched",this._ready="notready"},fetch:function(a){this._success=a&&a.success,this._error=a&&a.error,this.isFetching()||(this._state="fetching",this.SQL.execute(i,null,{success:function(a){this._state="fetched",this._ready="ready",this._onFetchSuccess(a),this._success&&this._success()}.bind(this),error:function(a){this._state="error",this._error&&this._error(h(a))}.bind(this)}))},_onFetchSuccess:function(a){var b=a.rows;e.each(b,function(a){var b=this.getService(a.service);b?b.set(a):this.add(a)},this)},getService:function(a){return this.findWhere({service:a})},isFetching:function(){return"fetching"===this.getState()},isReady:function(){return"ready"===this._ready},needsCheck:function(){var a=this.getState();return"unfetched"===a||"fetching"===a},getState:function(){return this._state}});b.exports={get:function(a){return void 0===d&&(d=new j([],{configModel:a})),d}}},{"../../../../../helpers/error-parser":1090,backbone:"backbone","cartodb.js":"cartodb.js",underscore:"underscore"}],797:[function(a,b,c){var d=a("underscore"),e=function(a){return a},f={name:_t("editor.layers.analysis-form.quota.analysis-type.routing"),api:"routing",user:"mapzen_routing",needsQuota:!0,transform:e},g={"trade-area":{name:_t("editor.layers.analysis-form.quota.analysis-type.trade-area"),api:"isolines",user:"here_isolines",transform:function(a,b){return a*b.get("isolines")},needsQuota:function(a){var b=a.getService("isolines"),c=b&&b.get("provider");return!!c}},"georeference-street-address":{name:_t("editor.layers.analysis-form.quota.analysis-type.georeference-street-address"),api:"hires_geocoder",user:"geocoding",transform:e,needsQuota:function(a){var b=a.getService("hires_geocoder"),c=b&&b.get("provider");return"google"!==c}},"data-observatory-measure":{name:_t("editor.layers.analysis-form.quota.analysis-type.data-observatory-measure"),api:"observatory",user:"obs_general",needsQuota:!0,transform:e},"routing-sequential":f,"routing-to-layer-all-to-all":f,"routing-to-single-point":f};b.exports={requiresQuota:function(a,b){if(void 0!==g[a]){var c=g[a].needsQuota;return d.isFunction(c)?c(b):c}return!1},transformInput:function(a,b,c){if(void 0!==g[a]){var d=g[a].transform;return d(b,c)}return b},getAnalysisName:function(a){return g[a]?g[a].name:null},getServiceName:function(a){return g[a]?g[a].api:null},getUserDataName:function(a){return g[a]?g[a].user:null}}},{underscore:"underscore"}],798:[function(a,b,c){function d(a){return a._organizationModel&&a._organizationModel.get("admin_email")}function e(a,b){var c=a.get("cartodb_com_hosted")===!1,e=b.isInsideOrg(),f=b.isOrgOwner(),g=_t("editor.layers.analysis-form.quota.emails.support");return c&&(g=e?f?_t("editor.layers.analysis-form.quota.emails.support"):d(b):_t("editor.layers.analysis-form.quota.emails.saas")),g}function f(a,b,c){var d,e=b.isInsideOrg(),f=b.isOrgOwner();return d=c?e&&!f?_t("editor.layers.analysis-form.quota.contact-message.no-quota-assigned.organization"):_t("editor.layers.analysis-form.quota.contact-message.no-quota-assigned.regular"):e&&!f?_t("editor.layers.analysis-form.quota.contact-message.no-credits.organization"):_t("editor.layers.analysis-form.quota.contact-message.no-credits.regular")}var g=a("underscore"),h=a("./analyses-quota-options"),i=g.template("<a href='mailto:<%- mail %>'><%- contact %></a>"),j=function(a,b,c,d){var g,j;return g=i({mail:e(c,d),contact:f(c,d,0===a.totalQuota)}),j=0===a.totalQuota?_t("editor.layers.analysis-form.quota.no-quota-assigned-body",{analysis:h.getAnalysisName(b),contact:g}):_t("editor.layers.analysis-form.quota.no-credits-body",{contact:g})};b.exports={make:function(a,b,c){var d,g=a.quotaInfo.blockPrice/100,h=a.estimation,k=a.quotaInfo.blockSize,l="",m="";return a.quotaInfo.hardLimit?a.creditsLeft>0?a.quotaInfo.enoughQuota?(l=_t("editor.layers.analysis-form.quota.enough-quota",{credits:h}),m="success"):(d=i({mail:e(b,c),contact:f(b,c,!1)}),l=_t("editor.layers.analysis-form.quota.hard-limit-not-enough-quota",{contact:d}),m="alert"):(l=j(a.quotaInfo,a.type,b,c),m="alert"):a.creditsLeft>0?a.creditsLeft>=h?(l=_t("editor.layers.analysis-form.quota.enough-quota",{credits:h}),m="success"):(l=_t("editor.layers.analysis-form.quota.soft-limit-enough-quota",{credits:h,blockSize:k,blockPrice:g}),m="alert"):(l=0===a.quotaInfo.totalQuota?j(a.quotaInfo,a.type,b,c):_t("editor.layers.analysis-form.quota.soft-limit-enough-quota",{credits:h,blockSize:k,blockPrice:g}),m="alert"),{type:m,body:l}}}},{"./analyses-quota-options":797,underscore:"underscore"}],799:[function(a,b,c){var d=a("underscore"),e=a("./analyses-quota-options"),f={totalQuota:0,usedQuota:0,blockSize:1e3,blockPrice:0,enoughQuota:!0};b.exports=function(a,b,c,g){var h=c.getService(e.getServiceName(a))||{},i=b.get(e.getUserDataName(a))||{};return i=d.pick(i,d.identity),d.defaults({blockSize:i.block_size,blockPrice:i.block_price},{totalQuota:h.get("monthly_quota"),usedQuota:h.get("used_quota"),hardLimit:!h.get("soft_limit")},{enoughQuota:g},f)}},{"./analyses-quota-options":797,underscore:"underscore"}],800:[function(a,b,c){var d=a("../../../../helpers/required-opts"),e=a("../../../../components/modals/add-analysis/add-analysis-view"),f=a("../../../../value-objects/analysis-node-ids"),g=["onboardings","layerDefinitionsCollection","modals","userModel","configModel"];b.exports=function(){return{init:function(a){d(a,g,this)},setLayerId:function(a){var b=this._layerDefinitionsCollection.get(a);if(!b)throw new Error("no layer-definition found for id"+a+", available layer ids are: "+this._layerDefinitionsCollection.pluck("id")+")");this._layerId=a},setStackLayoutView:function(a){if(!a)throw new Error("stackLayoutView is required");this._stackLayoutView=a},addGeoreferenceAnalysis:function(){var a=this._layerDefinitionsCollection.get(this._layerId),b=a.get("letter"),c=a.get("source");this._stackLayoutView.model.goToStep(1,a,"layer-content","analyses",{source:c,id:b===f.letter(c)?f.next(c):b+"1",type:"georeference-long-lat"})},addAnalysis:function(){this._onboardings.destroy();var a=this._layerDefinitionsCollection.get(this._layerId);this._modals.create(function(b){return new e({userModel:this._userModel,configModel:this._configModel,modalModel:b,layerDefinitionModel:a})}.bind(this)),this._modals.onDestroyOnce(function(b){b&&this._stackLayoutView.model.goToStep(1,a,"layer-content","analyses",b)},this)}}}()},{"../../../../components/modals/add-analysis/add-analysis-view":235,"../../../../helpers/required-opts":1097,"../../../../value-objects/analysis-node-ids":1119}],801:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">\n  '+(null==(__t=body)?"":__t)+"\n</h2>\n";return __p}},{underscore:"underscore"}],802:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../../../components/infobox/infobox-factory"),g=a("../../../../components/infobox/infobox-model"),h=a("../../../../components/infobox/infobox-collection"),i=a("../../../../components/view-options/panel-with-options-view"),j=a("./panel-with-options.tpl"),k=a("./layer-content-analyses-view"),l=a("../../../../components/onboardings/generic/generic-onboarding-launcher"),m=a("../../../../components/onboardings/layers/analysis-onboarding/analysis-onboarding-view"),n=a("../../../../components/onboardings/layers/layer-onboarding-key"),o=a("../../../../helpers/required-opts"),p=a("../../../../helpers/fetch-all-query-objects"),q=a("./analyses-service.js"),r=["userActions","analysisFormsCollection","layerDefinitionModel","analysisDefinitionNodesCollection","configModel","userModel","editorModel","stackLayoutModel","onboardings","onboardingNotification"];b.exports=e.extend({initialize:function(a){o(a,r,this),this._selectedNodeId=a.selectedNodeId,this._infoboxModel=new g({state:""}),this._overlayModel=new d.Model({visible:this._isLayerHidden()}),this._onboardingLauncher=new l({view:m,onboardingNotification:this._onboardingNotification,notificationKey:n,onboardings:this._onboardings},{editorModel:this._editorModel,selector:"LayerOnboarding"}),this._getQueryAndCheckState(),this._initBinds()},render:function(){this._launchOnboarding(),this.clearSubViews(),this.$el.empty();var a=this,b=[{state:"georeference",createContentView:function(){var a=this._layerDefinitionModel?this._layerDefinitionModel.getTableName():"",b=[_t("editor.tab-pane.layers.georeference.body",{name:a}),_t("editor.layers.georeference.manually-add")].join(" ");return f.createWithAction({type:"alert",title:_t("editor.tab-pane.layers.georeference.title"),body:b,mainAction:{label:_t("editor.layers.georeference.georeference-button")}})},mainAction:a._onGeoreferenceClicked.bind(a)},{state:"layer-hidden",createContentView:function(){return f.createWithAction({type:"alert",title:_t("editor.style.messages.layer-hidden.title"),body:_t("editor.style.messages.layer-hidden.body"),mainAction:{label:_t("editor.style.messages.layer-hidden.show")}})},mainAction:a._showHiddenLayer.bind(a)}],c=new h(b),d=new i({template:j,className:"Editor-content",editorModel:a._editorModel,infoboxModel:a._infoboxModel,infoboxCollection:c,createContentView:function(){return new k({className:"Editor-content",userActions:a._userActions,analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,userModel:a._userModel,analysisFormsCollection:a._analysisFormsCollection,configModel:a._configModel,layerDefinitionModel:a._layerDefinitionModel,stackLayoutModel:a._stackLayoutModel,selectedNodeId:a._selectedNodeId,overlayModel:a._overlayModel})}});return this.$el.append(d.render().el),this.addView(d),this},_initBinds:function(){this.listenTo(this._analysisFormsCollection,"reset remove",this._getQueryAndCheckState)},_getQueryAndCheckState:function(){var a=function(){this._infoboxState(),this.render()}.bind(this);if(!this._analysisFormsCollection.isEmpty())return void a();var b=this._layerDefinitionModel.getAnalysisDefinitionNodeModel();p({queryRowsCollection:b.queryRowsCollection,queryGeometryModel:b.queryGeometryModel,querySchemaModel:b.querySchemaModel},a)},_launchOnboarding:function(){this._onboardingNotification.getKey(n)||this._analysisFormsCollection.isEmpty()&&this._onboardingLauncher.launch()},_infoboxState:function(){this._isLayerHidden()?(this._infoboxModel.set({state:"layer-hidden"}),this._overlayModel.set({visible:!0})):this._layerDefinitionModel.canBeGeoreferenced()&&this._analysisFormsCollection.isEmpty()?(this._infoboxModel.set({state:"georeference"}),this._overlayModel.set({visible:!1})):(this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1}))},_showHiddenLayer:function(){this._layerDefinitionModel.toggleVisible(),this._userActions.saveLayer(this._layerDefinitionModel),this._infoboxState()},_isLayerHidden:function(){return this._layerDefinitionModel.get("visible")===!1},_onGeoreferenceClicked:function(){q.addGeoreferenceAnalysis()}})},{"../../../../components/infobox/infobox-collection":215,"../../../../components/infobox/infobox-factory":216,"../../../../components/infobox/infobox-model":219,"../../../../components/onboardings/generic/generic-onboarding-launcher":501,"../../../../components/onboardings/layers/analysis-onboarding/analysis-onboarding-view":503,"../../../../components/onboardings/layers/layer-onboarding-key":507,"../../../../components/view-options/panel-with-options-view":595,"../../../../helpers/fetch-all-query-objects":1092,"../../../../helpers/required-opts":1097,"./analyses-service.js":800,"./layer-content-analyses-view":881,"./panel-with-options.tpl":882,backbone:"backbone","backbone/core-view":1127}],803:[function(a,b,c){var d=a("backbone/core-view"),e=a("./analyses-workflow-item.tpl"),f=a("../../../../value-objects/analysis-node-ids"),g=a("../../../../data/layer-colors"),h=a("../../analysis-views/analyses-tooltip-error");b.exports=d.extend({tagName:"li",className:"HorizontalBlockList-item",events:{click:"_onNodeClick"},initialize:function(a){if(!a.analysisNode&&!a.formModel)throw new Error("analysisNode or formModel is required");if(!a.viewModel)throw new Error("viewModel is required");this._isNew=!a.analysisNode,this._analysisNode=a.analysisNode||a.formModel,this._viewModel=a.viewModel,this._analysisNode.on("change:status",this.render,this),this.add_related_model(this._analysisNode),this._analysisTooltip=new h({analysisNode:this._analysisNode,element:this.$el,triggerSelector:".Editor-ListAnalysis-itemError"}),this.addView(this._analysisTooltip)},render:function(){var a=this._analysisNode.get("status"),b=this._isNew||"ready"===a||"failed"===a,c=this._analysisNode.id===this._viewModel.get("selectedNodeId"),d=f.letter(this._analysisNode.id),h=g.getColorForLetter(d);return this.$el.html(e({isNew:this._isNew,isDone:b,bgColor:h,isSelected:c,nodeId:this._analysisNode.id,hasError:"failed"===a})),this.$el.css({background:c?h:"",border:c?"1px solid "+h:""}),this.$el.toggleClass("is-selected",c),this.$el.toggleClass("has-error","failed"===a),this},_onNodeClick:function(){this._viewModel.set("selectedNodeId",this._analysisNode.id)}})},{"../../../../data/layer-colors":633,"../../../../value-objects/analysis-node-ids":1119,"../../analysis-views/analyses-tooltip-error":723,"./analyses-workflow-item.tpl":804,"backbone/core-view":1127}],804:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",isDone?(__p+='\n  <div class="HorizontalBlockList-item-actionBlock CDB-Text CDB-Size-small u-upperCase">\n    <span class="HorizontalBlockList-item-text">\n      '+(null==(__t=nodeId)?"":_.escape(__t))+"\n    </span>\n    ",isNew||(__p+='\n      <i class="CDB-IconFont CDB-IconFont-ray CDB-Size-medium HorizontalBlockList-item-icon"></i>\n    '),__p+="\n  </div>\n"):(__p+="\n  ",__p+=isSelected?'\n    <div class="CDB-LoaderIcon">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n  ':'\n    <div class="CDB-LoaderIcon is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n  ',__p+="\n"),__p+="\n\n",hasError&&(__p+='\n<div class="Editor-ListAnalysis-itemError"></div>\n'),__p+="\n";return __p}},{underscore:"underscore"}],805:[function(a,b,c){var d=a("backbone/core-view"),e=a("./analyses-workflow-item-view"),f=a("./analyses-workflow-list.tpl");b.exports=d.extend({className:"HorizontalBlockList u-tSpace",tagName:"ul",initialize:function(a){if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");if(!a.analysisFormsCollection)throw new Error("analysisFormsCollection is required");if(!a.model)throw new Error("model is required");if(!a.layerId)throw new Error("layerId is required");this._analysisDefinitionNodesCollection=a.analysisDefinitionNodesCollection,this.analysis=a.analysis,this.analysisFormsCollection=a.analysisFormsCollection,this._layerId=a.layerId},render:function(){return this.clearSubViews(),this.$el.html(f({layerId:this._layerId})),this.analysisFormsCollection.each(this._renderWorkflowItem,this),this},_renderWorkflowItem:function(a){var b=new e({analysisNode:this._analysisDefinitionNodesCollection.get(a.id),formModel:a,viewModel:this.model,layerId:this._layerId});this.$el.append(b.render().el),this.addView(b)}})},{"./analyses-workflow-item-view":803,"./analyses-workflow-list.tpl":806,"backbone/core-view":1127}],806:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li class="HorizontalBlockList-item is-add">\n  <div class="HorizontalBlockList-item-actionBlock js-add-analysis" data-layer-id="'+(null==(__t=layerId)?"":_.escape(__t))+'">\n    <div class="CDB-Shape">\n      <div class="CDB-Shape-add is-blue is-small"></div>\n    </div>\n  </div>\n</li>\n';return __p}},{underscore:"underscore"}],807:[function(a,b,c){var d=a("backbone/core-view"),e=a("./analyses-workflow.tpl"),f=a("./analyses-workflow-list-view"),g=a("../../../../components/scroll/scroll-view");b.exports=d.extend({events:{"click .js-delete":"_deleteAnalysis"},initialize:function(a){if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");if(!a.analysisFormsCollection)throw new Error("analysisFormsCollection is required");if(!a.viewModel)throw new Error("viewModel is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");this._analysisDefinitionNodesCollection=a.analysisDefinitionNodesCollection,this.analysisFormsCollection=a.analysisFormsCollection,this.viewModel=a.viewModel,this._layerDefinitionModel=a.layerDefinitionModel},render:function(){return this.clearSubViews(),this.$el.html(this._html()),this._renderAnalysesView(),this},_html:function(){return e({canDelete:this._canDeleteSelectedNode(),deleteLabel:this._nodeDefModel()?_t("editor.layers.layer.delete"):_t("editor.layers.layer.cancel-delete-analysis"),selectedNodeId:this.viewModel.get("selectedNodeId"),layerAnalysisCount:this._layerDefinitionModel.getNumberOfAnalyses()})},_renderAnalysesView:function(){var a=this,b=new g({type:"horizontal",createContentView:function(){return new f({analysisDefinitionNodesCollection:a._analysisDefinitionNodesCollection,analysisFormsCollection:a.analysisFormsCollection,model:a.viewModel,layerId:a._layerDefinitionModel.id})}});this.$(".js-content").append(b.render().el),this.addView(b)},_deleteAnalysis:function(){this._canDeleteSelectedNode()&&this.analysisFormsCollection.deleteNode(this.viewModel.get("selectedNodeId"))},_canDeleteSelectedNode:function(){var a=this._nodeDefModel();return!a||a.canBeDeletedByUser()},_nodeDefModel:function(){var a=this.viewModel.get("selectedNodeId");return this._layerDefinitionModel.findAnalysisDefinitionNodeModel(a)}})},{"../../../../components/scroll/scroll-view":530,"./analyses-workflow-list-view":805,"./analyses-workflow.tpl":808,"backbone/core-view":1127}],808:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">1</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text js-content">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">\n        '+(null==(__t=_t("editor.layers.analysis-form.workflow"))?"":_.escape(__t))+'\n        <span class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large u-altTextColor">('+(null==(__t=layerAnalysisCount)?"":_.escape(__t))+')</span>\n      </h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">\n      '+(null==(__t=_t("editor.layers.layer.analysis"))?"":_.escape(__t))+" "+(null==(__t=selectedNodeId)?"":_.escape(__t))+"\n      ",canDelete&&(__p+='\n        <button class="js-delete u-actionTextColor u-upperCase">'+(null==(__t=deleteLabel)?"":_.escape(__t))+"</button>\n      "),__p+="\n    </p>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],809:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({initialize:function(a){this.template=a.template,this.model=a.model,this._initBinds()},render:function(){var a=this.template(this.model.attributes);return this.clearSubViews(),this.$el.empty(),this.$el.append(a),this},_initBinds:function(){this.listenTo(this.model,"change:isDisabled",this.render)}})},{"backbone/core-view":1127}],810:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./analysis-controls.tpl"),h=a("../../../../components/infobox/infobox-factory"),i=a("../../../../components/infobox/infobox-model"),j=a("../../../../components/infobox/infobox-collection"),k=a("./analyses-quota/analyses-quota-presenter"),l=a("./analyses-quota/analyses-quota-options"),m=a("./analyses-quota/analyses-quota-provider"),n=a("./analyses-quota/analyses-quota-estimation-input"),o=a("./analyses-quota/analyses-quota-enough"),p=a("../../../../helpers/required-opts"),q=a("./analysis-button-view"),r=a("./analysis-quota-view"),s=["formModel","userActions","userModel","stackLayoutModel","configModel","querySchemaModel","quotaInfo"];b.exports=f.extend({className:"Options-bar Options-bar--right u-flex",events:{"click .js-save":"_onSaveClicked"},initialize:function(a){p(a,s,this),this._analysisNode=a.analysisNode,n.init(a.configModel),o.init(a.configModel),this._viewModel=new e.Model({isNewAnalysis:!a.analysisNode,hasChanges:!a.analysisNode,type:this._formModel.get("type")}),this._infoboxModel=new i({state:this._quotaInfo.getState(),visible:!0}),this._initBinds(),a.analysisNode||this._fetchQuotaIfNeeded(),this.render=this.render.bind(this),this._onFormModelChanged=this._onFormModelChanged.bind(this)},render:function(){this.clearSubViews(),this.$el.empty();var a,b=this._formModel.get("type"),c=this._formModel.isValid(),d=l.requiresQuota(b,this._quotaInfo);return a=this._isAnalysisDone()&&!this._hasChanges()?this._createButtonView():d&&c?this._createQuotaView():this._createButtonView(),this.addView(a),this.$el.append(a.render().el),this._setTrackingClass(),this},_setTrackingClass:function(){this.$(".js-save").addClass("track-"+this._formModel.get("type")+"-analysis track-apply")},_initBinds:function(){this.listenTo(this._formModel,"change",this._onFormModelChanged),
this._analysisNode&&this.listenTo(this._analysisNode,"change:status",function(){var a=this._isAnalysisDone();a&&this.render()})},_onFormModelChanged:function(){var a=this._isAnalysisDone(),b=this._viewModel.get("isNewAnalysis")||a,c=this._formModel.isValid()&&b;this._viewModel.set({hasChanges:!0,type:this._formModel.get("type"),isDisabled:!c}),this.render(),this._fetchQuotaIfNeeded()},_fetchQuotaIfNeeded:function(){var a=this._formModel.get("type"),b=this._formModel.isValid(),c=this._quotaInfo;(c.needsCheck()||l.requiresQuota(a,c))&&b&&this._fetchQuota()},_fetchQuota:function(){this._infoboxModel.set("state","fetching"),this._quotaInfo.fetch({success:function(){this._buildQuotaViewInfo()}.bind(this),error:function(a){this._viewModel.set({error:a}),this._infoboxModel.set("state","error")}.bind(this)})},_createButtonView:function(){var a=this._formModel.get("persisted")?_t("editor.layers.analysis-form.apply-btn"):_t("editor.layers.analysis-form.create-btn");return this._viewModel.set({label:a,isDisabled:!this._canSave()}),new q({template:g,model:this._viewModel})},_buildQuotaViewInfo:function(){var a=this._formModel,b=this._userModel,c=a.get("type"),d=l.getServiceName(c),e=this._querySchemaModel.get("query"),f=this._quotaInfo;this.payload={},this.payload.type=c;var g=function(a){this._viewModel.set("error",a),this._infoboxModel.set("state","error")}.bind(this),h=function(b){var e=l.transformInput(c,b,a);return this.payload.estimation=e,o.fetch(d,e)}.bind(this),i=function(a){var d=this.payload;d.quotaInfo=m(c,b,f,a),d.creditsLeft=d.quotaInfo.totalQuota-d.quotaInfo.usedQuota,d.canRunAnalysis=a&&d.quotaInfo.totalQuota>0||d.quotaInfo.hardLimit===!1&&d.quotaInfo.totalQuota>0,this._infoboxModel.set("state","ready")}.bind(this),j=f.isReady();null!==d&&j?a.isValid()?n.fetch(e).then(h,g).then(i,g):this.render():j||g(_t("editor.layers.analysis-form.quota.quota-dataservice-down"))},_createQuotaView:function(){var a=[{state:"fetching",createContentView:function(){return h.createLoading({body:_t("editor.layers.analysis-form.quota.loading")})}},{state:"ready",createContentView:function(){var a=this.payload,b=_t("editor.layers.analysis-form.confirm-analysis"),c="";c=a.creditsLeft>0?_t("editor.layers.analysis-form.quota.credits-left-message",{smart_count:a.creditsLeft}):_t("editor.layers.analysis-form.quota.no-credits-message"),a.quotaInfo.quotaMessage=c;var e=d.extend(k.make(a,this._configModel,this._userModel),{title:_t("editor.layers.analysis-form.quota.title"),mainAction:{label:b,type:"primary",disabled:!this._canSave()||!a.canRunAnalysis},quota:a.quotaInfo});return h.createQuota(e)}.bind(this),mainAction:function(){var a=this.payload;this._canSave()&&a.canRunAnalysis&&this._saveAnalysis()}.bind(this),closeAction:function(){this._stackLayoutModel.prevStep("layers")}.bind(this)},{state:"error",createContentView:function(){return h.createWithAction({title:_t("editor.layers.analysis-form.quota.title"),type:"error",body:_t("editor.layers.analysis-form.quota.quota-fetch-error",{error:this._viewModel.get("error")}),mainAction:{label:_t("editor.layers.analysis-form.quota.cancel")}})}.bind(this),mainAction:function(){this._stackLayoutModel.prevStep("layers")}.bind(this)}];return new r({className:"Infobox-wrapper",infoboxModel:this._infoboxModel,infoboxCollection:new j(a)})},_canSave:function(){var a=this._isAnalysisDone(),b=this._viewModel.get("isNewAnalysis")||a,c=this._viewModel.get("hasChanges");return this._formModel.isValid()&&b&&c},_onSaveClicked:function(){this._canSave()&&this._saveAnalysis()},_hasChanges:function(){return this._viewModel.get("hasChanges")===!0},_isAnalysisDone:function(){return this._analysisNode&&(this._analysisNode.isDone()||this._analysisNode.hasFailed())},_saveAnalysis:function(){this._infoboxModel.set("state","idle"),this._userActions.saveAnalysis(this._formModel),this._viewModel.set("hasChanges",!1),this.render()}})},{"../../../../components/infobox/infobox-collection":215,"../../../../components/infobox/infobox-factory":216,"../../../../components/infobox/infobox-model":219,"../../../../helpers/required-opts":1097,"./analyses-quota/analyses-quota-enough":794,"./analyses-quota/analyses-quota-estimation-input":795,"./analyses-quota/analyses-quota-options":797,"./analyses-quota/analyses-quota-presenter":798,"./analyses-quota/analyses-quota-provider":799,"./analysis-button-view":809,"./analysis-controls.tpl":811,"./analysis-quota-view":876,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],811:[function(a,b,c){arguments[4][773][0].apply(c,arguments)},{dup:773,underscore:"underscore"}],812:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./aggregate-intersection-form.tpl"),g=a("../column-options"),h=["type","aggregate_column","aggregate_function"];b.exports=e.extend({parse:function(a){return a.aggregate_column||(a.aggregate_column="cartodb_id"),a.aggregate_function||(a.aggregate_function="count"),a.aggregate={operator:a.aggregate_function,attribute:"count"===a.aggregate_function?"":a.aggregate_column},a},initialize:function(){e.prototype.initialize.apply(this,arguments),this._columnOptions=new g({},{configModel:this._configModel}),this.listenTo(this._analysisSourceOptionsModel,"change:fetching",this._setSchema),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this.on("change:aggregate",this._onChangeAggregate,this),this.on("change:target",this._onChangeTarget,this),this._setSchema(),this._fetchColumns()},_formatAttrs:function(a){var b=d.pick(a,["id","source","target"].concat(h));return e.prototype._formatAttrs.call(this,b)},getTemplate:function(){return f},getTemplateData:function(){return{dataFields:"aggregate"}},_filterSchemaFieldsByType:function(a){return d.pick(a,["source","target","aggregate"])},_setSchema:function(){e.prototype._setSchema.call(this,this._filterSchemaFieldsByType({source:this._primarySourceSchemaItem(_t("editor.layers.analysis-form.base-layer")),target:{type:"NodeDataset",title:_t("editor.layers.analysis-form.intersection-layer"),options:this._getSourceOptionsForSource({sourceAttrName:"target"}),validators:["required"],dialogMode:"float",editorAttrs:{disabled:this._isSourceDisabled("target")}},aggregate:{type:"Operators",title:_t("editor.layers.analysis-form.operation"),dialogMode:"float",options:this._columnOptions.filterByType("number")}}))},_onChangeAggregate:function(){var a=this.get("aggregate");this.set({aggregate_column:a.attribute||"cartodb_id",aggregate_function:a.operator})},_onChangeTarget:function(){this.set("aggregate",{operator:"count",attribute:""}),this._analysisSourceOptionsModel.createSourceNodeUnlessExisting(this.get("target")),this._fetchColumns()},_fetchColumns:function(){var a=this.get("target"),b=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(a);b?this._columnOptions.setNode(b):a&&this._columnOptions.setDataset(a)},_isSourceDisabled:function(a){return this._isPrimarySource(a)||this._isFetchingOptions()}})},{"../column-options":879,"./aggregate-intersection-form.tpl":813,"./base-analysis-form-model":820,underscore:"underscore"}],813:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source,target">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.aggregate-intersection.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input-layer"))?"":_.escape(__t))+'</p>\n    </div>\n  </div>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="'+(null==(__t=dataFields)?"":_.escape(__t))+'">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.measure-by"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.filter-aggregate"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],814:[function(a,b,c){var d=a("underscore"),e=a("../../../../../value-objects/distance-converter"),f="meters";b.exports={type:"buffer",label:_t("editor.layers.analysis-form.distance"),parametersDataFields:"type,distance,radius,isolines,dissolved",parse:function(a){var b=d.extend({},a);try{b.radius=e.toDistance(a.radius,a.distance),b.distance=a.distance||f,b.dissolved=void 0!==a.dissolved&&a.dissolved,b.isolines=a.isolines||1}catch(a){b.radius=100,b.isolines=1,b.distance=f,b.dissolved=!1}return b},formatAttrs:function(a){return d.defaults({radius:e.toMeters(a.radius,a.distance)},a)}}},{"../../../../../value-objects/distance-converter":1120,underscore:"underscore"}],815:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./area-of-influence-form.tpl"),g=a("../../../../../value-objects/distance-converter"),h=a("./area-of-influence-types"),i={};h.map(function(a){i[a.type]=a}),b.exports=e.extend({parse:function(a){return d.defaults(d.pick(a,"id","source"),this._typeDef(a.type).parse(a))},initialize:function(){e.prototype.initialize.apply(this,arguments),this._setSchema(),this.on("change:type",this._onTypeChanged,this),this.on("change:distance",this._onDistanceChanged,this),this.on("change:kind",this._onKindChanged,this)},getTemplate:function(){return f},getTemplateData:function(){return{parametersDataFields:this._typeDef().parametersDataFields}},updateNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);a.clear({silent:!0}),a.set(b)},_formatAttrs:function(a){var b=this._typeDef().formatAttrs(a);return e.prototype._formatAttrs.call(this,b)},_setSchema:function(){e.prototype._setSchema.call(this,this._filterSchemaFieldsByType({source:this._primarySourceSchemaItem(),type:{type:"Radio",text:_t("editor.layers.analysis-form.type"),options:h.map(function(a){var b=this._analyses.isAnalysisValidByType(a.type,this._configModel),c=this._canChangeToType(a.type),d=!b||!c,e=b?_t("editor.layers.analysis-form.valid-type"):_t("editor.layers.analysis-form.disabled-by-config");return{val:a.type,label:a.label,disabled:d,help:d?e:""}},this)},distance:{type:"Radio",title:_t("editor.layers.analysis-form.units"),options:d.map(g.OPTIONS,function(a){return{val:a.distance,label:this._distanceLabel(a.distance)}},this)},radius:{type:"Number",label:_t("editor.layers.analysis-form.radius"),validators:["required",this._radiusInterval()]},kind:{type:"Select",title:_t("editor.layers.analysis-form.by"),dialogMode:"float",options:[{val:"walk",label:_t("editor.layers.analysis-form.by-walk")},{val:"car",label:_t("editor.layers.analysis-form.by-car")}]},isolines:{type:"Number",title:_t("editor.layers.analysis-form.tracts"),help:_t("editor.layers.analysis-form.tracts-help"),validators:["required",{type:"interval",min:1,max:4}]},time:{type:"Number",title:_t("editor.layers.analysis-form.time-seconds"),validators:["required",this._timeInterval()]},dissolved:{type:"Radio",title:_t("editor.layers.analysis-form.boundaries"),options:[{val:"false",label:_t("editor.layers.analysis-form.intact"),help:_t("editor.layers.analysis-form.intact-help")},{val:"true",label:_t("editor.layers.analysis-form.dissolved"),help:_t("editor.layers.analysis-form.dissolved-help")}]}}))},_canChangeToType:function(a){if(a===this.get("type"))return!0;var b=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"));return b.isValidAsInputForType(a)},_filterSchemaFieldsByType:function(a){var b=["source"].concat(this._typeDef().parametersDataFields.split(","));return d.pick(a,b)},_onTypeChanged:function(){this._replaceAttrs(),this._setSchema()},_onDistanceChanged:function(){this._fitParamToRange("radius",this._radiusInterval()),this._setSchema()},_onKindChanged:function(){this._fitParamToRange("time",this._timeInterval()),this._setSchema()},_fitParamToRange:function(a,b){var c=this.get(a);c<b.min?c=b.min:c>b.max&&(c=b.max),this.set(a,c,{silent:!0})},_replaceAttrs:function(){var a=this.parse(this.attributes);this.clear({silent:!0}),this.set("type",a.type,{silent:!0}),this.set(a)},_typeDef:function(a){return a=a||this.get("type"),i[a]},_radiusInterval:function(){switch(this.get("distance")){case"meters":return{type:"interval",min:10,max:1e4};case"kilometers":case"miles":return{type:"interval",min:.5,max:100,step:.5};default:return{type:"interval",min:1,max:100}}},_timeInterval:function(){switch(this.get("kind")){case"car":return{type:"interval",min:60,max:14400,step:10};case"walk":default:return{type:"interval",min:60,max:3600}}},_distanceLabel:function(a){switch(a){case"meters":return _t("editor.layers.analysis-form.meters");case"kilometers":return _t("editor.layers.analysis-form.kilometers");case"miles":return _t("editor.layers.analysis-form.miles");default:return""}}})},{"../../../../../value-objects/distance-converter":1120,"./area-of-influence-form.tpl":816,"./area-of-influence-types":818,"./base-analysis-form-model":820,underscore:"underscore"}],816:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.area-of-influence.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.reference-layer-pluralize",{smart_count:1}))?"":_.escape(__t))+'</p>\n      <div class="u-tSpace-xl CDB-Text CDB-Fieldset">\n        <p class="CDB-Legend u-upperCase u-iBlock CDB-Text is-semibold CDB-Size-small u-rSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input"))?"":_.escape(__t))+'</p>\n        <div class="Editor-formInput u-ellipsis" data-editors="source"></div>\n      </div>\n    </div>\n  </div>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="'+(null==(__t=parametersDataFields)?"":_.escape(__t))+'">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.parameters"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.parameters-description"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],817:[function(a,b,c){b.exports={type:"trade-area",label:_t("editor.layers.analysis-form.time"),parametersDataFields:"type,kind,time,isolines,dissolved",parse:function(a){return{type:"trade-area",kind:a.kind||"walk",isolines:a.isolines||1,time:a.time||100,dissolved:"true"===a.dissolved||a.dissolved===!0}},formatAttrs:function(a){return a}}},{}],818:[function(a,b,c){b.exports=[a("./area-of-influence-buffer"),a("./area-of-influence-trade-area")]},{"./area-of-influence-buffer":814,"./area-of-influence-trade-area":817}],819:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="WITH dep_fns AS (\n    SELECT oid, proname, proargnames, proargtypes FROM pg_catalog.pg_proc WHERE proname ~* '^dep_ext_'\n),\nfns_argstypes AS (SELECT oid, array_agg((\n        SELECT\n        CASE\n            WHEN typcategory = 'A' THEN 'array'\n            WHEN typcategory = 'N' THEN 'number'\n            WHEN typcategory = 'S' THEN 'string'\n            WHEN typcategory = 'B' THEN 'boolean'\n        ELSE 'unknown' END\n        FROM pg_catalog.pg_type\n        WHERE argtype = pg_catalog.pg_type.oid\n    )) as argtypes\n    FROM (\n        SELECT pg_proc.oid, unnest(pg_proc.proargtypes) as argtype\n        FROM pg_catalog.pg_proc, dep_fns\n        WHERE pg_proc.oid = dep_fns.oid\n    ) _q\n    group by oid\n),\nfns_meta AS (\n    SELECT\n        dep_fns.proname,\n        dep_fns.proargnames,\n        fns_argstypes.argtypes,\n        CASE WHEN fns_argstypes.argtypes[6] = 'array' THEN\n            -- [whether it has a secondary node or not, where the extra parameters start, where to stop]\n            ARRAY[1,7,array_length(argtypes,1)]\n        ELSE\n            ARRAY[0,5,array_length(argtypes,1)]\n        END as p\n    FROM dep_fns, fns_argstypes\n    WHERE dep_fns.oid = fns_argstypes.oid\n)\nSELECT\n    proname as fn_name,\n    proargnames[p[2]:p[3]] as params_names,\n    argtypes[p[2]:p[3]] as params_types,\n    p[1]::boolean as has_secondary_node\nFROM fns_meta\n";return __p}},{underscore:"underscore"}],820:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../../../../../data/camshaft-reference"),g=a("../../../../../data/layer-colors");b.exports=e.Model.extend({initialize:function(a,b){if(!b.analyses)throw new Error("analyses is required");if(!b.configModel)throw new Error("configModel is required");if(!b.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!b.analysisSourceOptionsModel)throw new Error("analysisSourceOptionsModel is required");this._analyses=b.analyses,this._configModel=b.configModel,this._layerDefinitionModel=b.layerDefinitionModel,this._analysisSourceOptionsModel=b.analysisSourceOptionsModel,this.schema={}},isNew:function(){return!0},getTemplate:function(){},getTemplateData:function(){},_getSourceOption:function(){var a=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"));return a&&[{val:a.id,type:"node",nodeTitle:this._analyses.title(a),layerName:this._layerDefinitionModel.getName(),color:g.getColorForLetter(a.letter())}]},_primarySourceSchemaItem:function(a){return{type:"NodeDataset",title:a||_t("editor.layers.analysis-form.source"),dialogMode:"float",options:this._getSourceOption(),editorAttrs:{disabled:!0}}},setFormValidationErrors:function(a){this._formValidationErrors=a,this.trigger("change",this)},validate:function(){var a=d.extend({},f.validate(this.attributes),this._formValidationErrors);if(!d.isEmpty(a))return a},set:function(a,b,c){if(null==a)return this;var d;"object"==typeof a?(d=a,c=b):(d={})[a]=b,c||(c={});var f=d.persisted||this.get("persisted");return e.Model.prototype.set.call(this,d,c),void 0!==f&&e.Model.prototype.set.call(this,"persisted",f,{silent:!0}),this},updateNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);a.set(b)},_updateNodeDefinition:function(){this.updateNodeDefinition.apply(this,arguments)},createNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);return this.set("persisted",!0),a.createAnalysisNode(b,this._layerDefinitionModel)},_formatAttrs:function(a){return d.omit(f.parse(a),"persisted")},_setSchema:function(a){this.schema=a,this.trigger("changeSchema",this)},_isPrimarySource:function(a){return a===this.get("primary_source_name")},_isFetchingOptions:function(){return this._analysisSourceOptionsModel.get("fetching")},_getSourceOptionsForSource:function(a){a=a||{};var b=null,c="*",d=!1,e=a.includeSourceNode||!1;if(void 0===a.sourceAttrName)throw new Error("sourceAttrName is required.");b=a.sourceAttrName,void 0!==a.requiredSimpleGeometryType&&(c=a.requiredSimpleGeometryType),a.ignorePrimarySource&&(d=!0);var f=this.get(b);if(!d&&this._isPrimarySource(b))return[f];if(this._isFetchingOptions())return[{val:f,label:_t("editor.layers.analysis-form.loading"),isLoading:!0}];var g=this._layerDefinitionModel.get("source");return this._analysisSourceOptionsModel.getSelectOptions(c).filter(function(b){return!(!e&&b.val===g||a.onlyNodes&&"node"!==b.type)})}})},{"../../../../../data/camshaft-reference":615,"../../../../../data/layer-colors":633,backbone:"backbone",underscore:"underscore"}],821:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./centroid-form.tpl"),g=a("../column-options"),h="category_column,aggregation,aggregation_column,weight_column",i="source,category,weight";b.exports=e.extend({parse:function(a){var b={operator:a.aggregation||"count",attribute:"count"===a.aggregation?"":a.aggregation_column},c=a.aggregation_column||a.aggregation?b:"";return d.extend(a,{category:a.category_column||"",weight:a.weight_column||"",aggregate:c})},initialize:function(){e.prototype.initialize.apply(this,arguments),this._columnOptions=new g({},{configModel:this._configModel,nodeDefModel:this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"))}),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this.on("change:category",this._onChangeCategory,this),this.on("change:aggregate",this._updateAggregation,this),this.on("change:weight",this._onChangeWeight,this),this.on("change:type",this._setSchema,this),this._updateAggregation(),this._setSchema()},updateNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);a.clear({silent:!0}),a.set(b)},_getFormatFieldNames:function(){var a=h.split(",");return""===this.get("aggregate")&&(a=d.difference(a,["aggregation","aggregation_column"])),a.join(",")},_formatAttrs:function(a){var b=d.pick(a,["id","source","type"].concat(this._getFormatFieldNames().split(",")));return e.prototype._formatAttrs.call(this,b)},getTemplate:function(){return f},getTemplateData:function(){return{parametersDataFields:i}},_setSchema:function(){var a={operator:this.get("aggregation"),attribute:this.get("aggregation_column")};e.prototype._setSchema.call(this,{source:this._primarySourceSchemaItem(),category:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.categorize-by"),help:_t("editor.layers.analysis-form.categorize-by-help"),editor:{type:"Select",options:this._columnOptions.all(),dialogMode:"float",label:_t("editor.layers.analysis-form.column")}},weight:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.weighted-by"),help:_t("editor.layers.analysis-form.weighted-by-help"),validators:["required"],editor:{type:"Select",options:this._columnOptions.filterByType("number"),dialogMode:"float",label:_t("editor.layers.analysis-form.column")}},aggregate:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.aggregate-by"),help:_t("editor.layers.analysis-form.aggregate-by-help"),defaultValue:a,editor:{type:"Operators",options:this._columnOptions.filterByType("number"),dialogMode:"float",label:_t("editor.layers.analysis-form.column")}}})},_onChangeWeight:function(){""!==this.get("weight")?(this.set("type","weighted-centroid"),this.set("weight_column",this.get("weight"))):(this.set("type","centroid"),this.unset("weight_column")),this._setSchema()},_onChangeCategory:function(){""===this.get("category")?this.unset("category_column"):this.set("category_column",this.get("category")),this._setSchema()},_updateAggregation:function(){var a=this.get("aggregate");""===a?this.set({aggregation:"count",aggregation_column:""}):this.set({aggregation_column:a.attribute,aggregation:a.operator}),this._setSchema()}})},{"../column-options":879,"./base-analysis-form-model":820,"./centroid-form.tpl":822,underscore:"underscore"}],822:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="'+(null==(__t=parametersDataFields)?"":__t)+'">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.centroid.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input-layer"))?"":_.escape(__t))+'</p>\n    </div>\n  </div>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="aggregate">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.value-aggregation"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.value-aggregation-centroids"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],823:[function(a,b,c){var d=a("./base-analysis-form-model"),e=a("../column-options"),f=a("./closest-form.tpl"),g=32;b.exports=d.extend({parse:function(a){return a.responses||(a.responses=1),a},initialize:function(){d.prototype.initialize.apply(this,arguments),this._resetColumnOptions(),this._initBinds(),this._setSchema(),this._fetchColumns()},_initBinds:function(){this.listenTo(this._analysisSourceOptionsModel,"change:fetching",this._onSourceOptionsFetched),this.on("change:target",this._onChangeTarget,this)},getTemplate:function(){return f},getTemplateData:function(){return{}},_resetColumnOptions:function(){this._columnOptions=new e({},{configModel:this._configModel}),this.listenTo(this._columnOptions,"columnsFetched",this._onColumnsFetched)},_onSourceOptionsFetched:function(){this._setSchema()},_setSchema:function(){d.prototype._setSchema.call(this,{source:this._primarySourceSchemaItem(_t("editor.layers.analysis-form.find-nearest.input")),target:{type:"NodeDataset",title:_t("editor.layers.analysis-form.find-nearest.target"),options:this._getSourceOptionsForSource({sourceAttrName:"target",includeSourceNode:!0}),dialogMode:"float",validators:["required"],editorAttrs:{disabled:this._isSourceDisabled("target")}},category:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.find-nearest.categorized"),help:_t("editor.layers.analysis-form.find-nearest.categorized-help"),editor:{type:"Select",options:this._columnOptions.filterByType("string"),dialogMode:"float",editorAttrs:{showLabel:!1}}},responses:{type:"Number",title:_t("editor.layers.analysis-form.find-nearest.max-results"),value:1,validators:["required",{type:"interval",min:1,max:g}]}})},_isSourceDisabled:function(a){return this._isPrimarySource(a)||this._isFetchingOptions()},_onChangeTarget:function(){this.set("category",""),this._setSchema(),this._analysisSourceOptionsModel.createSourceNodeUnlessExisting(this.get("target")),this._fetchColumns()},_fetchColumns:function(){var a=this.get("target"),b=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(a);b?this._columnOptions.setNode(b):a&&this._columnOptions.setDataset(a)},_onColumnsFetched:function(){this._setSchema()}})},{"../column-options":879,"./base-analysis-form-model":820,"./closest-form.tpl":824}],824:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source,target">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.find-nearest.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.find-nearest.criteria"))?"":_.escape(__t))+'</p>\n    </div>\n  </div>\n\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="responses,category">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.find-nearest.define-params"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.find-nearest.define-params-desc"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],825:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./connect-with-lines.tpl"),g=a("../column-options"),h=a("./connect-with-lines-types"),i={};h.map(function(a){i[a.type]=a}),b.exports=e.extend({defaults:{closest:!0,order_type:"asc"},parse:function(a){return d.defaults(d.pick(a,"id","source"),this._typeDef(a.type).parse(a))},validate:function(){var a=e.prototype.validate.apply(this,arguments);return a&&a.target_column&&(this._hasSecondGeometry()||(a.target_column=_t("editor.layers.analysis-form.second-geom-required"))),a},initialize:function(){e.prototype.initialize.apply(this,arguments),this._columnOptions=new g({},{configModel:this._configModel,nodeDefModel:this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"))}),this._targetColumnOptions=new g({},{configModel:this._configModel,nodeDefModel:this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"))}),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this.listenTo(this._targetColumnOptions,"columnsFetched",this._setSchema),this.listenTo(this._analysisSourceOptionsModel,"change:fetching",this._setSchema),this.on("change:target",this._onChangeTarget,this),this.on("change:type",this._onTypeChanged,this),this.on("change:group",this._setSchema,this),this._setSchema(),this._fetchColumns()},_onTypeChanged:function(){this._replaceAttrs(),this._setSchema()},_replaceAttrs:function(){var a=this.parse(this.attributes);this.clear({silent:!0}),this.set("type",a.type,{silent:!0}),this.set(d.extend(a,this.defaults))},updateNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);a.clear({silent:!0}),a.set(b)},_formatAttrs:function(a){var b=this._typeDef().formatAttrs(a,this._columnOptions);return e.prototype._formatAttrs.call(this,b)},getTemplate:function(){return f},getTemplateData:function(){return{type:this.get("type"),group:this.get("group"),parametersDataFields:this._typeDef().parametersDataFields}},_filterSchemaFieldsByType:function(a){var b=["source","type"].concat(this._typeDef().parametersDataSchema.split(","));return d.pick(a,b)},_setSchema:function(){e.prototype._setSchema.call(this,this._filterSchemaFieldsByType({source:this._primarySourceSchemaItem(),type:{type:"Select",title:_t("editor.layers.analysis-form.type"),dialogMode:"float",options:h.map(function(a){return{val:a.type,label:a.label}},this)},source_column:{type:"Select",title:_t("editor.layers.analysis-form.source"),dialogMode:"float",options:this._getColumnOptions("source_column",["string","number"])},target:{type:"NodeDataset",title:_t("editor.layers.analysis-form.target"),options:this._getSourceOptionsForSource("target","point"),dialogMode:"float",editorAttrs:{
disabled:this._isSourceDisabled("target")},validators:["required"]},target_column:{type:"Select",title:_t("editor.layers.analysis-form.target-column"),dialogMode:"float",options:this._getColumnOptionsForTarget()},target_source_column:{type:"Select",title:_t("editor.layers.analysis-form.target-column"),options:this._getTargetSourceColumnOptions("target_source_column"),dialogMode:"float",editorAttrs:{disabled:this._isTargetColumnDisabled()}},destination_longitude:{type:"Text",title:_t("editor.layers.analysis-form.longitude"),validators:["required"],editorAttrs:{placeholder:_t("editor.layers.analysis-form.enter-longitude")}},destination_latitude:{type:"Text",title:_t("editor.layers.analysis-form.latitude"),validators:["required"],editorAttrs:{placeholder:_t("editor.layers.analysis-form.enter-latitude")}},closest:{type:"Radio",title:"closest",options:[{label:_t("editor.layers.analysis-form.to-closest"),val:"true"},{label:_t("editor.layers.analysis-form.all-to-all"),val:"false"}]},group:{type:"Enabler",label:_t("editor.layers.analysis-form.group-by"),title:"",editorAttrs:{reversed:!0}},category_column:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.group-by"),editor:{type:"Select",options:this._columnOptions.all(),dialogMode:"float",editorAttrs:{showLabel:!1}}},order_column:{type:"Select",title:_t("editor.layers.analysis-form.order-by"),options:this._columnOptions.filterByType(["date","number"]),dialogMode:"float",validators:["required"]},order_type:{type:"Radio",title:_t("editor.layers.analysis-form.order"),options:[{label:_t("editor.layers.analysis-form.asc"),val:"asc"},{label:_t("editor.layers.analysis-form.desc"),val:"desc"}]}}))},_onChangeTarget:function(){this.set("target_source_column",""),this._analysisSourceOptionsModel.createSourceNodeUnlessExisting(this.get("target")),this._fetchColumns()},_fetchColumns:function(){var a=this.get("target"),b=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(a);b?this._targetColumnOptions.setNode(b):a&&this._targetColumnOptions.setDataset(a)},_getColumnOptionsForTarget:function(){var a=this._getColumnOptions("target_column","geometry");return d.reject(a,function(a){return"the_geom"===a.val||"the_geom_webmercator"===a.val},this)},_getColumnOptions:function(a,b){var c=this._columnOptions.filterByType(b);if(this._columnOptions.get("columnsFetched")&&this.get(a)){var e=!1,f=this.get(a),g={val:f,label:'"'+f+'"'};c&&c.length&&(e=d.find(c,function(a){return a.val===g.val})),e||(c.push(g),c=d.sortBy(c,function(a){return a.val}))}return c},_getTargetSourceColumnOptions:function(a){var b=this._targetColumnOptions.all();if(this._targetColumnOptions.get("columnsFetched")&&this.get(a)){var c=!1,e=this.get(a),f={val:e,label:'"'+e+'"'};b&&b.length&&(c=d.find(b,function(a){return a.val===f.val})),c||(b.push(f),b=d.sortBy(b,function(a){return a.val}))}return b},_typeDef:function(a){return a=a||this.get("type"),i[a]},_getSourceOptionsForSource:function(a,b){var c=this.get(a);if(this._isFetchingOptions())return[{val:c,label:_t("editor.layers.analysis-form.loading"),isLoading:!0}];var d=this._getSourceOption()[0];return this._analysisSourceOptionsModel.getSelectOptions(b).filter(function(a){return a.val!==d.val&&a.val!==d.layerName})},_hasSecondGeometry:function(){return this._getColumnOptionsForTarget().length},_isTargetColumnDisabled:function(){return!this._targetColumnOptions.get("columnsFetched")},_isSourceDisabled:function(a){return this._isPrimarySource(a)||this._isFetchingOptions()}})},{"../column-options":879,"./base-analysis-form-model":820,"./connect-with-lines-types":826,"./connect-with-lines.tpl":827,underscore:"underscore"}],826:[function(a,b,c){b.exports=[a("./connect-with-lines/line-to-single-point"),a("./connect-with-lines/line-to-column"),a("./connect-with-lines/line-source-to-target"),a("./connect-with-lines/line-sequential")]},{"./connect-with-lines/line-sequential":828,"./connect-with-lines/line-source-to-target":829,"./connect-with-lines/line-to-column":830,"./connect-with-lines/line-to-single-point":831}],827:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo Editor-HeaderInfo--noMargin">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="'+(null==(__t=parametersDataFields)?"":__t)+'">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.connect-with-lines.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.define-reference-and-target"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n\n  ","line-sequential"==type&&(__p+='\n    <div class="Editor-HeaderInfo">\n      <div class="Editor-HeaderPad u-rSpace--m"></div>\n        <div class="Editor-checker" data-fields="category_column"></div>\n      </div>\n    </div>\n  '),__p+="\n\n  ","line-source-to-target"==type&&(__p+='\n    <div class="Editor-HeaderInfo">\n      <div class="Editor-HeaderPad u-rSpace--m"></div>\n      <div class="Editor-HeaderInfo-inner CDB-Text">\n\n        <div class="Editor-checker Editor-checker--slim u-flex u-alignCenter" data-fields="group"></div>\n\n        ',group&&(__p+='\n          <div class="Editor-formInner--nested">\n            <div class="CDB-Text Editor-formInner Editor-formInner--noMargin">\n              <p class="CDB-Legend u-upperCase u-iBlock CDB-Text is-semibold CDB-Size-small u-rSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.source-col"))?"":_.escape(__t))+'</p>\n              <div class="Editor-formInput" data-editors="source_column"></div>\n            </div>\n\n            <div class="CDB-Text Editor-formInner">\n              <p class="CDB-Legend u-upperCase u-iBlock CDB-Text is-semibold CDB-Size-small u-rSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.target-col"))?"":_.escape(__t))+'</p>\n              <div class="Editor-formInput" data-editors="target_source_column"></div>\n            </div>\n          </div>\n        '),__p+="\n      </div>\n    </div>\n  "),__p+="\n</form>\n";return __p}},{underscore:"underscore"}],828:[function(a,b,c){var d=a("underscore");b.exports={type:"line-sequential",label:_t("editor.layers.analysis-form.line-sequential"),parametersDataFields:"source,type,order_column,order_type",parametersDataSchema:"order_column,order_type,category_column",parse:function(a){return{type:"line-sequential",order_column:a.order_column,category_column:a.category_column,order_type:a.order_type}},formatAttrs:function(a,b){return a.category_column||(a=d.omit(a,"category_column")),a}}},{underscore:"underscore"}],829:[function(a,b,c){var d=a("underscore");b.exports={type:"line-source-to-target",label:_t("editor.layers.analysis-form.line-source-to-target"),parametersDataFields:"source,type,target,closest",parametersDataSchema:"target,closest,group,source_column,target_source_column",parse:function(a){return{type:"line-source-to-target",target:a.target,closest:a.closest,source_column:a.source_column,group:a.target_column&&a.source_column,target_source_column:a.target_column}},formatAttrs:function(a,b){return a.target_column=a.target_source_column,a.group||(a=d.omit(a,["source_column","target_column"])),a=d.omit(a,["target_source_column","group"])}}},{underscore:"underscore"}],830:[function(a,b,c){b.exports={type:"line-to-column",label:_t("editor.layers.analysis-form.line-to-column"),parametersDataFields:"source,type,target_column",parametersDataSchema:"target_column",parse:function(a,b){return{type:"line-to-column",target_column:a.target_column}},formatAttrs:function(a,b){return a}}},{}],831:[function(a,b,c){b.exports={type:"line-to-single-point",label:_t("editor.layers.analysis-form.line-to-single-point"),parametersDataFields:"source,type,destination_longitude,destination_latitude",parametersDataSchema:"destination_longitude,destination_latitude",parse:function(a){return{type:"line-to-single-point",destination_longitude:a.destination_longitude,destination_latitude:a.destination_latitude}},formatAttrs:function(a,b){return a}}},{}],832:[function(a,b,c){var d=a("./base-analysis-form-model"),e=a("./data-observatory-measure.tpl"),f=a("../data-observatory-metadata"),g=a("../../../../../helpers/utils");b.exports=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments),this.nodeDefModel=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source")),this.doMetadata=new f(null,{configModel:this._configModel,geometryType:null}),this.nodeDefModel.queryGeometryModel.isFetched()?this._fetchDOMetadata():this.nodeDefModel.queryGeometryModel.once("change:status",this._fetchDOMetadata,this),this._setSchema()},_formatAttrs:function(a){return a.final_column=g.sanitizeString(a.final_column),d.prototype._formatAttrs.call(this,a)},_fetchDOMetadata:function(){var a=this.nodeDefModel.queryGeometryModel.get("simple_geom")||"point";this.doMetadata.setGeometryType(a),this.listenTo(this.doMetadata,"sync",this._setSchema),this.on("change:area",this._areaChanged,this),this.on("change:measurement",this._measurementChanged,this),this.on("change:segments",this._setSegment,this),this.doMetadata.fetch()},_areaChanged:function(){this.set({measurement:"",segments:""},{silent:!0}),this._setSchema()},_measurementChanged:function(){this.set({segments:""},{silent:!0}),this._setSchema()},_normalizeSegment:function(a){return a.replace(/\./g,"_",/\-/g,"_")},_setSegment:function(){var a=this.doMetadata.segment(this.get("area"),this.get("measurement"),this.get("segments"));a&&this.set("segment_name",a)},getTemplate:function(){return e},_setSchema:function(){var a=this.doMetadata.areas(),b={source:this._primarySourceSchemaItem(),area:{type:"Select",title:_t("editor.layers.analysis-form.data-observatory-measurement-area"),options:0===a.length?_t("editor.layers.analysis-form.loading"):a.filter(function(a){return"Global"!==a}).sort(),dialogMode:"float",editorAttrs:{disabled:0===a.length}},final_column:{title:_t("editor.layers.analysis-form.data-observatory-measurement-column"),type:"Text",help:_t("editor.layers.analysis-form.data-observatory-measurement-column-help"),validators:["required"]},measurement:{type:"Select",title:_t("editor.layers.analysis-form.data-observatory-measurement-measurement"),options:this.doMetadata.measurement(this.get("area")).sort(),dialogMode:"float"},segments:{type:"Select",title:_t("editor.layers.analysis-form.data-observatory-measurement-segments"),options:this.doMetadata.columns(this.get("area"),this.get("measurement")).sort(),dialogMode:"float"}};d.prototype._setSchema.call(this,b)}})},{"../../../../../helpers/utils":1102,"../data-observatory-metadata":880,"./base-analysis-form-model":820,"./data-observatory-measure.tpl":833}],833:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source,final_column">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.data-observatory-measure.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.data-observatory-measurement-desc"))?"":_.escape(__t))+'</p>\n    </div>\n  </div>\n\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n        <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="area,measurement,segments">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.parameters"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.data-observatory-measurement-refine"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n\n</form>\n";return __p}},{underscore:"underscore"}],834:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./base-analysis-form-model"),g=a("../../../../../helpers/required-opts"),h=a("./available-functions.tpl"),i=a("./deprecated-sql-function.tpl"),j=a("../../../../../helpers/errorTracking.js"),k=["configModel"];b.exports=f.extend({initialize:function(a,b){g(b,k,this),this._SQL=new e.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")}),f.prototype.initialize.apply(this,arguments),this.set("fetchStatus","unfetched"),this._functionsInfo=[],this._setSchema(),this._initBinds(),this._fetchAvailableFunctions()},_initBinds:function(){this.listenTo(this,"change:fetchStatus",this._onFetchStatusChanged),this.listenTo(this,"change:function_name",this._onFunctionSelected),this.listenTo(this._analysisSourceOptionsModel,"change:fetching",this._onSourceOptionsFetched)},validate:function(a,b){return this.set("primary_source",this.get("source")),this._serializeFunctionArgs(),f.prototype.validate.call(this,a,b)},getTemplate:function(){return i},getTemplateData:function(){var a=[],b={fields:""},c=this._getSelectedFunction();return c&&(c.hasSecondaryNode&&a.push("secondary_source"),d.reduce(c.params,function(a,b,c){return a.push(c),a},a,this)),b.fields=a.join(","),b},_buildSchema:function(){var a={},b=this._getSelectedFunction();return a.source=this._primarySourceSchemaItem(_t("editor.layers.analysis-form.deprecated-sql-function.input")),a.function_name={type:"Select",title:_t("editor.layers.analysis-form.deprecated-sql-function.function"),options:this._parseFunctionOptions(),dialogMode:"float",editorAttrs:this._getSelectFunctionAttrs()},b&&(b.hasSecondaryNode&&(a.secondary_source={type:"NodeDataset",title:_t("editor.layers.analysis-form.deprecated-sql-function.target"),options:this._getSourceOptionsForSource({sourceAttrName:"secondary_source"}),dialogMode:"float",editorAttrs:{disabled:this._isSourceDisabled("secondary_source")},validators:["required"]}),d.each(b.params,function(c,d){this._addParamToSchema(d,b.params[d],a)},this)),a},_setSchema:function(){f.prototype._setSchema.call(this,this._buildSchema())},_addParamToSchema:function(a,b,c){var d=null,e=null;switch(b){case"string":d={type:"Text",title:a,validators:["required"]},e="";break;case"number":d={type:"Number",title:a,showSlider:!1,validators:["required"]},e=0;break;case"boolean":d={type:"Radio",title:a,options:[{val:"true",label:"true"},{val:"false",label:"false"}]},e=!0}d&&(c[a]=d,this.has(a)||this.set(a,e))},_onSourceOptionsFetched:function(){this._setSchema()},_onFetchStatusChanged:function(){this._setSchema()},_onFunctionSelected:function(){this._setSchema()},_getSelectedFunction:function(){var a=this.get("function_name");return a?d.first(d.filter(this._functionsInfo,function(b){return b.functionName===a},this)):null},_fetchAvailableFunctions:function(){var a=h();this.set("fetchStatus","fetching"),this._SQL.execute(a,null,{success:function(a){this._functionsInfo=this._parseFunctionsMetadata(a),this.set("fetchStatus","fetched")}.bind(this),error:function(a){this.set("fetchStatus","error"),a&&a.responseJSON&&j(a.responseJSON)}.bind(this)})},_parseFunctionsMetadata:function(a){return a&&a.rows?d.map(a.rows,function(a){var b={};b.functionName=this._capitalizeFunctionName(a.fn_name),b.hasSecondaryNode=a.has_secondary_node,b.params={};for(var c=0;c<a.params_names.length;c++)b.params[a.params_names[c]]=a.params_types[c];return b},this):[]},_capitalizeFunctionName:function(a){var b=/^dep_ext/i;return a&&a.replace(b,"DEP_EXT")},_getSelectFunctionAttrs:function(){var a=this.get("fetchStatus"),b={disabled:!0};switch(a){case"unfetched":break;case"fetching":b={disabled:!0,loading:!0};break;case"fetched":b={},this._functionsInfo.length>0&&(b.placeholder=_t("editor.layers.analysis-form.deprecated-sql-function.choose-function-small"));break;case"error":b={disabled:!0,placeholder:"error"}}return b},_parseFunctionOptions:function(){return d.map(this._functionsInfo,function(a){return{val:a.functionName,label:a.functionName}},this)},_serializeFunctionArgs:function(){var a=[],b=this._getSelectedFunction();b&&(a=d.reduce(b.params,function(a,b,c){return a.push(this.get(c)),a},[],this),this.set("function_args",a))},_isPrimarySource:function(a){return a===this.get("source")},_isSourceDisabled:function(a){return this._isPrimarySource(a)||this._isFetchingOptions()}})},{"../../../../../helpers/errorTracking.js":1091,"../../../../../helpers/required-opts":1097,"./available-functions.tpl":819,"./base-analysis-form-model":820,"./deprecated-sql-function.tpl":835,"cartodb.js":"cartodb.js",underscore:"underscore"}],835:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source,function_name">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.deprecated-sql-function.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.deprecated-sql-function.choose-function"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n\n  ",fields&&(__p+='\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="'+(null==(__t=fields)?"":__t)+'">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.deprecated-sql-function.params"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.deprecated-sql-function.define-params"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n  "),__p+="\n\n</form>\n";return __p}},{underscore:"underscore"}],836:[function(a,b,c){var d=a("underscore"),e=a("../../../../../data/camshaft-reference"),f=a("./base-analysis-form-model"),g=",";b.exports=f.extend({initialize:function(){f.prototype.initialize.apply(this,arguments),this.listenTo(this._analysisSourceOptionsModel,"change:fetching",this._updateSchema),this._updateSchema()},getTemplate:function(){},getTemplateData:function(){return{}},_formatAttrs:function(){var a=f.prototype._formatAttrs.apply(this,arguments),b=e.paramsForType(this.get("type"));for(var c in b){var h=b[c];"array"===h.type&&(d.isString(a[c])&&""!==a[c].trim()?a[c]=a[c].split(g).map(function(a){return a.trim()}):a[c]=null)}return a},_updateSchema:function(){var a={type:{type:"Text",title:"Type",editorAttrs:{disabled:!0}}},b=e.paramsForType(this.get("type")),c=d.reduce(Object.keys(b),function(a,c){return"node"===b[c].type&&a++,a},0);Object.keys(b).forEach(function(d){var e=b[d],f=d+" ("+e.type+")",h=[],i=!e.optional;switch(i&&(f+="*",h.push("required")),e.type){case"node":a[d]=1===c?{type:"Select",text:f,options:[this.get("source")],dialogMode:"float",editorAttrs:{disabled:!0}}:{type:"Select",dialogMode:"float",title:f,options:this._getSourceOptionsForSource({sourceAttrName:"target",ignorePrimarySource:!0})};break;case"string":var j;if(/column/.test(d)&&1===c){var k=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"));k&&k.querySchemaModel.columnsCollection.length>0&&(j={type:"Text",title:f,validators:h})}j||(j={type:"Text",title:f,validators:h}),a[d]=j;break;case"enum":a[d]={type:"Select",title:f,options:e.values.map(function(a){return{val:a,label:a}}),dialogMode:"float",validators:h};break;case"number":a[d]={type:"Text",label:f,validators:h};break;case"boolean":a[d]={type:"Radio",text:f,options:[{val:"true",label:"true"},{val:"false",label:"false"}],validators:h};break;case"array":a[d]={type:"Text",title:f,validators:h,help:'Separate values by "'+g+'"'};break;default:return null}},this),this._setSchema(a)}})},{"../../../../../data/camshaft-reference":615,"./base-analysis-form-model":820,underscore:"underscore"}],837:[function(a,b,c){var d=a("./base-analysis-form-model"),e=a("./filter-by-node-column.tpl"),f=a("../column-options");b.exports=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments);var a=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"));this._columnOptions=new f({},{configModel:this._configModel,nodeDefModel:a}),this._filterColumnOptions=new f({},{configModel:this._configModel}),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this.listenTo(this._filterColumnOptions,"columnsFetched",this._setSchema),this.listenTo(this._analysisSourceOptionsModel,"change:fetching",this._setSchema),this.on("change:filter_source",this._onFilterSourceChange,this),this._onFilterSourceChange(),this._setSchema()},_onFilterSourceChange:function(){var a=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("filter_source"));a&&(this._filterColumnOptions.setNode(a),this._setSchema())},getTemplate:function(){return e},_setSchema:function(){var a={source:this._primarySourceSchemaItem(),filter_source:{type:"NodeDataset",title:_t("editor.layers.analysis-form.linked-layer"),dialogMode:"float",editorAttrs:{disabled:this._isFetchingOptions()},options:this._getSourceOptionsForSource({sourceAttrName:"filter_source",ignorePrimarySource:!0,onlyNodes:!0})},column:{type:"Select",title:_t("editor.layers.analysis-form.source-column"),dialogMode:"float",options:this._columnOptions.all()},filter_column:{type:"Select",title:_t("editor.layers.analysis-form.filter-column"),dialogMode:"float",validators:["required",this._validateFilterColumn.bind(this)],options:this._filterColumnOptions.all()}};d.prototype._setSchema.call(this,a)},_validateFilterColumn:function(a,b){var c=b.filter_column,d=b.column;if(void 0===c||void 0===d)return null;var e={message:_t("editor.layers.analysis-form.should-match")},f=this._filterColumnOptions.findColumn(c),g=f&&f.type,h=this._columnOptions.findColumn(d),i=h&&h.type;return g===i?null:e}})},{"../column-options":879,"./base-analysis-form-model":820,"./filter-by-node-column.tpl":838}],838:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source,filter_source">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.filter-by-node-column.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.link-layer-desc"))?"":_.escape(__t))+'</p>\n    </div>\n  </div>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n        <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="column,filter_column">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.key-columns"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.key-columns-desc"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n\n";return __p}},{underscore:"underscore"}],839:[function(a,b,c){var d=a("underscore"),e="kind,text";b.exports={type:"filter-category",label:"Filter category",parametersDataFields:"text,accept_reject",filterDataFields:"accept,reject",parse:function(a){var b=d.extend({},a);return b.type="filter-category",b.column=a.column||"",a.accept?b.text=a.accept.join(","):a.reject&&(b.text=a.reject.join(",")),b.accept_reject=a.accept||!a.accept&&!a.reject?"accept":"reject",b},formatAttrs:function(a){var b,c=["id","type","source","column"],e="is-equal-to"===a.kind;return e?b=[+a.text]:a.text&&(b=a.text.split(",")),"accept"===a.accept_reject||e?a.accept=b:"reject"===a.accept_reject&&(a.reject=b),e?d.pick(a,c.concat(["kind","accept"])):d.pick(a,c.concat(a.accept_reject))},getParameters:function(a){var b=this.parametersDataFields;return"is-equal-to"===a&&(b=e),b}}},{underscore:"underscore"}],840:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./filter-form.tpl"),g=a("../column-data"),h=a("../../../../../data/column-row-data"),i=a("../column-options"),j=a("./filter-types"),k={};j.map(function(a){k[a.type]=a});var l=[{val:"between",label:_t("editor.layers.filter-options.between")},{val:"is-equal-to",label:_t("editor.layers.filter-options.is-equal-to")},{val:"is-greater-than",label:_t("editor.layers.filter-options.is-greater-than")},{val:"is-less-than",label:_t("editor.layers.filter-options.is-less-than")}],m=["is-greater-than","is-less-than"];b.exports=e.extend({defaults:{accept_reject:"accept"},parse:function(a){return d.defaults(d.pick(a,"id","source","column"),this._typeDef(a.type).parse(a))},initialize:function(){e.prototype.initialize.apply(this,arguments);var a=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"));this._columnData=new g({column:this.get("column")},{nodeDefModel:a,configModel:this._configModel}),this._columnRowData=new h({column:this.get("column")},{nodeDefModel:a,configModel:this._configModel}),this._columnOptions=new i({},{configModel:this._configModel,nodeDefModel:a}),this.on("change:kind change:column",this._updateSchema,this),this.on("change:histogram_stats",this._setSchema,this),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this.listenTo(this._columnRowData,"columnsFetched",this._setSchema),this.listenTo(this._columnData,"columnsFetched",this._storeHistogramStats),this._columnData.fetch(),this._columnRowData.fetch(),this._setSchema()},getTemplate:function(){return f},getTemplateData:function(){return{column:this.get("column"),histogram_stats:this.get("histogram_stats"),parametersDataFields:this._typeDef().getParameters(this.get("kind"))}},_formatAttrs:function(a){var b=this._typeDef().formatAttrs(a);return e.prototype._formatAttrs.call(this,b)},updateNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);a.clear({silent:!0}),a.set(b)},_setSchema:function(){e.prototype._setSchema.call(this,this._filterSchemaFieldsByType({source:this._primarySourceSchemaItem(_t("editor.layers.analysis-form.input")),column:{type:"Select",text:_t("editor.layers.analysis-form.column"),options:this._columnOptions.filterByType(["string","number"]),dialogMode:"float",validators:["required"]},kind:{type:"Select",title:_t("editor.layers.analysis-form.filter"),dialogMode:"float",options:this._getKindOptions(),editorAttrs:{showSearch:!1}},min:{type:"Text",title:this._getMinLabel(),validators:["required"],editorAttrs:{placeholder:"Write min value"}},max:{type:"Text",title:this._getMaxLabel(),validators:["required"],editorAttrs:{placeholder:"Write max value"}},text:{type:this._getInputType(),title:_t("editor.layers.analysis-form.input"),validators:["required"],options:d.map(this._columnRowData.getRows(),function(a){return{label:a,val:a}}),dialogMode:"float",editorAttrs:{showSearch:!0,allowFreeTextInput:!0}},accept_reject:{type:"Radio",title:_t("editor.layers.analysis-form.result"),options:[{label:_t("editor.layers.analysis-form.show"),val:"accept"},{label:_t("editor.layers.analysis-form.hide"),val:"reject"}],validators:["required"]}})),this._generateHistogram(),this._generateHistogramStats()},_getInputType:function(){var a=this._columnRowData.getRows();return a&&a.length?"Select":"Text"},_getMinLabel:function(){return d.contains(m,this.get("kind"))?_t("editor.layers.analysis-form.value"):_t("editor.layers.analysis-form.min")},_getMaxLabel:function(){return d.contains(m,this.get("kind"))?_t("editor.layers.analysis-form.value"):_t("editor.layers.analysis-form.max")},_getSourceColumns:function(){var a=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source")),b=a.querySchemaModel.columnsCollection.map(function(a){var b=a.get("name");return{val:b,label:b,type:a.get("type")}});return b},_filterSchemaFieldsByType:function(a){var b=this.get("kind"),c=["source","column"].concat(this._typeDef().getParameters(b).split(","));return d.pick(a,c)},_updateSchema:function(){this._columnData.set("column",this.get("column")),this._columnRowData.set("column",this.get("column")),this._setType(),this._setSchema()},_getSelectedColumnType:function(){var a=this._getSourceColumns(),b=null;for(var c in a)a[c].label===this.get("column")&&(b=a[c].type);return b},_getKindOptions:function(){if("filter-category"!==this.get("type")||"is-equal-to"===this.get("kind"))return l},_setType:function(){var a=this._getSelectedColumnType(),b=this.get("kind"),c={type:"filter-range"};"number"===a&&"is-equal-to"===b?(c.type="filter-category",c.accept_reject="accept"):"string"===a&&(c.kind=null,c.type="filter-category"),this.set(c)},_getColumnType:function(a){var b=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source")),c=b.querySchemaModel.columnsCollection.find(function(b){return b.get("name")===a},this);return c&&c.get("type")},_generateHistogramStats:function(a){a&&this.trigger("onColData",this)},_storeHistogramStats:function(a){a&&"number"===this._getSelectedColumnType()?this.set("histogram_stats",a.attributes):this.set("histogram_stats",null)},_generateHistogram:function(){var a,b=this._getSourceOption()[0].layerName,c=this.get("column");c&&(a=this._getColumnType(c)),b&&c&&"number"===a&&this.trigger("generateHistogram",{columnName:c,tableName:b})},_typeDef:function(a){return a=a||this.get("type"),k[a]}})},{"../../../../../data/column-row-data":617,"../column-data":878,"../column-options":879,"./base-analysis-form-model":820,"./filter-form.tpl":841,"./filter-types":845,underscore:"underscore"}],841:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.filter.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.select-column"))?"":_.escape(__t))+'</p>\n      <div class="u-tSpace-xl CDB-Text CDB-Fieldset">\n        <p class="CDB-Legend u-upperCase u-iBlock CDB-Text is-semibold CDB-Size-small u-rSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input"))?"":_.escape(__t))+'</p>\n        <div class="Editor-formInput u-ellipsis" data-editors="source"></div>\n      </div>\n      <div class="u-tSpace-xl CDB-Text CDB-Fieldset">\n        <p class="CDB-Legend u-upperCase u-iBlock CDB-Text is-semibold CDB-Size-small u-rSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.column"))?"":_.escape(__t))+'</p>\n        <div class="Editor-formInput" data-editors="column"></div>\n      </div>\n      ',
histogram_stats&&(__p+='\n      <div class="u-tSpace-xl CDB-Text CDB-Fieldset ">\n        <p class="CDB-Legend u-upperCase u-iBlock CDB-Text is-semibold CDB-Size-small u-rSpace--m"></p>\n        <div class="Analysis-Histogram js-histogram">\n          <ul class="Analysis-HistogramInfo u-flex CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase">\n            <li class="u-rSpace"><span class="js-min"></span> '+(null==(__t=_t("editor.layers.analysis-form.min"))?"":_.escape(__t))+'</li>\n            <li><span class="js-max"></span> '+(null==(__t=_t("editor.layers.analysis-form.max"))?"":_.escape(__t))+'</li>\n          </ul>\n          <div class="Analysis-HistogramChart js-histogramChart"></div>\n        </div>\n      </div>\n      '),__p+="\n    </div>\n  </div>\n  ",column&&(__p+='\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="'+(null==(__t=parametersDataFields)?"":_.escape(__t))+'">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.parameters"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.parameters-description"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n  "),__p+="\n</form>\n";return __p}},{underscore:"underscore"}],842:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./filter-intersection-form.tpl"),g=a("../column-options");b.exports=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this._columnOptions=new g({},{configModel:this._configModel}),this.listenTo(this._analysisSourceOptionsModel,"change:fetching",this._setSchema),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this.on("change:target",this._onChangeTarget,this),this._setSchema(),this._fetchColumns()},_formatAttrs:function(a){var b=d.pick(a,["id","source","target","type"]);return e.prototype._formatAttrs.call(this,b)},getTemplate:function(){return f},getTemplateData:function(){return{}},_filterSchemaFieldsByType:function(a){return d.pick(a,["source","target","type"])},_setSchema:function(){e.prototype._setSchema.call(this,this._filterSchemaFieldsByType({source:this._primarySourceSchemaItem(_t("editor.layers.analysis-form.base-layer")),target:{type:"NodeDataset",title:_t("editor.layers.analysis-form.filtering-layer"),options:this._getSourceOptionsForSource({sourceAttrName:"target",requiredSimpleGeometryType:"point"}),dialogMode:"float",validators:["required"],editorAttrs:{disabled:this._isSourceDisabled("target")}}}))},_onChangeTarget:function(){this._analysisSourceOptionsModel.createSourceNodeUnlessExisting(this.get("target")),this._fetchColumns()},_fetchColumns:function(){var a=this.get("target"),b=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(a);b?this._columnOptions.setNode(b):a&&this._columnOptions.setDataset(a)},_isSourceDisabled:function(a){return this._isPrimarySource(a)||this._isFetchingOptions()}})},{"../column-options":879,"./base-analysis-form-model":820,"./filter-intersection-form.tpl":843,underscore:"underscore"}],843:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source,target">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.filter-intersection.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input-layer"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],844:[function(a,b,c){var d=a("underscore"),e={between:"kind,min,max","is-equal-to":"kind,text","is-less-than":"kind,max","is-greater-than":"kind,min"};b.exports={type:"filter-range",label:"Filter range",parse:function(a){var b=d.extend({},a);return b.type="filter-range",b.kind=a.kind||"between",b.column=a.column||"",b.min=null!=a.min?a.min:0,b.max=null!=a.max?a.max:50,b},getParameters:function(a){return a||(a="is-equal-to"),e[a]},formatAttrs:function(a){var b=this.getParameters(a.kind);return d.pick(a,["id","type","source","column"].concat(b.split(",")))}}},{underscore:"underscore"}],845:[function(a,b,c){b.exports=[a("./filter-category"),a("./filter-range")]},{"./filter-category":839,"./filter-range":844}],846:[function(a,b,c){b.exports={type:"georeference-admin-region",label:_t("editor.layers.analysis-form.georeference.admin-region"),fieldAttrs:{admin_region_column:{showSearch:!0},country:{showSearch:!0,allowFreeTextInput:!0}},validatorFor:{admin_region_column:["required"]},parametersDataFields:"admin_region_column,country",getParameters:function(){var a=this.parametersDataFields;return a},parse:function(a){return{type:"georeference-admin-region",admin_region_column:a.admin_region_column,country:a.country||a.country_column}},formatAttrs:function(a,b){return a.country&&b.findColumn(a.country,"string")?(a.country_column=a.country,delete a.country):delete a.country_column,a}}},{}],847:[function(a,b,c){var d=a("underscore");b.exports={type:"georeference-city",label:_t("editor.layers.analysis-form.georeference.city"),fieldAttrs:{city_column:{showSearch:!0},admin_region:{showSearch:!0,allowFreeTextInput:!0},country:{showSearch:!0,allowFreeTextInput:!0}},validatorFor:{city_column:["required"]},parametersDataFields:"city_column,admin_region,country",getParameters:function(){var a=this.parametersDataFields;return a},parse:function(a){return{type:"georeference-city",city_column:a.city_column,admin_region:a.admin_region||a.admin_region_column,country:a.country||a.country_column}},formatAttrs:function(a,b){return d.each(["country","admin_region"],function(c){a[c]&&b.findColumn(a[c],"string")?(a[c+"_column"]=a[c],delete a[c]):delete a[c+"_column"]},this),a}}},{underscore:"underscore"}],848:[function(a,b,c){b.exports={type:"georeference-country",label:_t("editor.layers.analysis-form.georeference.country"),fieldAttrs:{country_column:{showSearch:!0}},validatorFor:{country_column:["required"]},parametersDataFields:"country_column",getParameters:function(){var a=this.parametersDataFields;return a},parse:function(a){return{type:"georeference-country",country_column:a.country_column||a.country}},formatAttrs:function(a){return a}}},{}],849:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./georeference-form.tpl"),g=a("../column-options"),h=a("./georeference-types"),i={};h.map(function(a){i[a.type]=a}),b.exports=e.extend({parse:function(a){return d.defaults(d.pick(a,"id","source","context"),this._typeDef(a.type).parse(a))},initialize:function(){e.prototype.initialize.apply(this,arguments),this._columnOptions=new g({},{configModel:this._configModel,nodeDefModel:this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"))}),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this.on("change:type change:context",this._onTypeChanged,this),this._setSchema()},updateNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);a.clear({silent:!0}),a.set(b)},_formatAttrs:function(a){var b=this._typeDef().formatAttrs(a,this._columnOptions);return e.prototype._formatAttrs.call(this,b)},getTemplate:function(){return f},getTemplateData:function(){return{parametersDataFields:this._typeDef().getParameters(this.get("context"))}},_filterSchemaFieldsByType:function(a){var b=this.get("context"),c=["source","type"].concat(this._typeDef().getParameters(b).split(","));return d.pick(a,c)},_setSchema:function(){e.prototype._setSchema.call(this,this._filterSchemaFieldsByType({type:{type:"Select",title:_t("editor.layers.analysis-form.type"),options:d.compact(h.map(function(a){return!!this._analyses.isAnalysisValidByType(a.type,this._configModel)&&{val:a.type,label:a.label}},this)),dialogMode:"float"},context:{type:"Toggle",title:"",label:"",options:[{val:"advance",label:_t("editor.layers.analysis-form.georeference.advance"),help:_t("editor.layers.analysis-form.georeference.street-address-help"),selected:!1},{val:"normal",label:_t("editor.layers.analysis-form.georeference.normal"),selected:!0}]},source:{type:"NodeDataset",text:_t("editor.layers.analysis-form.source"),options:this._getSourceOption(),dialogMode:"float",editorAttrs:{disabled:!0}},latitude:{type:"Select",title:_t("editor.layers.analysis-form.latitude"),options:this._columnOptions.filterByType(["string","number"]),dialogMode:"float",validators:this._getFieldValidator("latitude"),placeholder:_t("editor.layers.analysis-form.georeference.select-latitude"),searchPlaceholder:_t("editor.layers.analysis-form.search-by-column-name")},longitude:{type:"Select",title:_t("editor.layers.analysis-form.longitude"),options:this._columnOptions.filterByType(["string","number"]),dialogMode:"float",validators:this._getFieldValidator("longitude"),placeholder:_t("editor.layers.analysis-form.georeference.select-longitude"),searchPlaceholder:_t("editor.layers.analysis-form.search-by-column-name")},admin_region:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.admin-region"),help:_t("editor.layers.analysis-form.georeference.admin-region-extended-help"),validators:this._getFieldValidator("admin_region"),editor:{type:"Select",options:this._getColumnOptions("admin_region","string"),dialogMode:"float",editorAttrs:this._getFieldAttrs("admin_region"),placeholder:_t("editor.layers.analysis-form.georeference.select-admin"),searchPlaceholder:_t("editor.layers.analysis-form.georeference.enter-region-name")}},admin_region_column:{type:"Select",title:_t("editor.layers.analysis-form.admin-region"),options:this._columnOptions.filterByType("string"),dialogMode:"float",help:_t("editor.layers.analysis-form.georeference.admin-region-help"),validators:this._getFieldValidator("admin_region"),editorAttrs:this._getFieldAttrs("admin_region"),placeholder:_t("editor.layers.analysis-form.georeference.select-admin"),searchPlaceholder:_t("editor.layers.analysis-form.search-by-column-name")},country_column:{type:"Select",title:_t("editor.layers.analysis-form.country"),options:this._columnOptions.filterByType("string"),dialogMode:"float",help:_t("editor.layers.analysis-form.georeference.country-help"),validators:this._getFieldValidator("country_column"),editorAttrs:this._getFieldAttrs("country_column"),placeholder:_t("editor.layers.analysis-form.georeference.select-a-country"),searchPlaceholder:_t("editor.layers.analysis-form.search-by-column-name")},city:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.city"),help:_t("editor.layers.analysis-form.georeference.city-extended-help"),validators:this._getFieldValidator("city"),editor:{type:"Select",options:this._getColumnOptions("city","string"),dialogMode:"float",editorAttrs:this._getFieldAttrs("city"),placeholder:_t("editor.layers.analysis-form.georeference.select-city"),searchPlaceholder:_t("editor.layers.analysis-form.georeference.enter-city-name")}},city_column:{type:"Select",title:_t("editor.layers.analysis-form.city"),options:this._columnOptions.filterByType("string"),dialogMode:"float",help:_t("editor.layers.analysis-form.georeference.city-help"),validators:this._getFieldValidator("city_column"),editorAttrs:this._getFieldAttrs("city_column"),placeholder:_t("editor.layers.analysis-form.georeference.select-city"),searchPlaceholder:_t("editor.layers.analysis-form.search-by-column-name")},postal_code_column:{type:"Select",title:_t("editor.layers.analysis-form.postal-code"),options:this._columnOptions.filterByType(["string","number"]),dialogMode:"float",help:_t("editor.layers.analysis-form.georeference.postal-code-help"),validators:this._getFieldValidator("postal_code_column"),placeholder:_t("editor.layers.analysis-form.georeference.select-postal-code"),searchPlaceholder:_t("editor.layers.analysis-form.search-by-column-name")},ip_address:{type:"Select",title:_t("editor.layers.analysis-form.georeference.ip-address-column"),options:this._columnOptions.filterByType("string"),dialogMode:"float",help:_t("editor.layers.analysis-form.georeference.ip-address-help"),validators:this._getFieldValidator("ip_address"),placeholder:_t("editor.layers.analysis-form.georeference.select-ip"),searchPlaceholder:_t("editor.layers.analysis-form.search-by-column-name")},street_address_template:{type:"CodeEditor",title:"",label:"",tokens:this._getColumnHints(this._columnOptions.filterByType(["string","number"])),validators:this._getFieldValidator("street_address_template"),placeholder:"{{street_number}} {{street_name}}, {{postal_code}} {{country}}"},street_address_column:{type:"Select",title:_t("editor.layers.analysis-form.georeference.street-address-column"),options:this._columnOptions.filterByType("string"),dialogMode:"float",help:_t("editor.layers.analysis-form.georeference.street-address-column-help"),validators:this._getFieldValidator("street_address_column"),placeholder:_t("editor.layers.analysis-form.georeference.select-street-address"),searchPlaceholder:_t("editor.layers.analysis-form.search-by-column-name")},state:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.state"),help:_t("editor.layers.analysis-form.georeference.state-help"),validators:this._getFieldValidator("state"),editor:{type:"Select",options:this._getColumnOptions("state","string"),dialogMode:"float",editorAttrs:this._getFieldAttrs("state"),placeholder:_t("editor.layers.analysis-form.georeference.select-state"),searchPlaceholder:_t("editor.layers.analysis-form.georeference.enter-state-name")}},country:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.country"),help:_t("editor.layers.analysis-form.georeference.country-extended-help"),validators:this._getFieldValidator("country"),editor:{type:"Select",options:this._getColumnOptions("country","string"),dialogMode:"float",editorAttrs:this._getFieldAttrs("country"),placeholder:_t("editor.layers.analysis-form.georeference.select-country"),searchPlaceholder:_t("editor.layers.analysis-form.georeference.enter-country-name")}}}))},_onTypeChanged:function(){this._replaceAttrs(),this._setSchema()},_replaceAttrs:function(){var a=this.parse(this.attributes);this.clear({silent:!0}),this.set({type:a.type,context:a.context},{silent:!0}),this.set(a)},_typeDef:function(a){return a=a||this.get("type"),i[a]},_getFieldAttrs:function(a){return this._typeDef()&&this._typeDef().fieldAttrs[a]},_getFieldValidator:function(a){return this._typeDef()&&this._typeDef().validatorFor[a]||null},_getColumnHints:function(a){return a?[{keywords:a.map(function(a){return a.val}).join(" "),type:"Column_name"}]:[]},_getColumnOptions:function(a,b){var c=this._columnOptions.filterByType(b);if(this._columnOptions.get("columnsFetched")&&this.get(a)){var e=!1,f=this.get(a),g={val:f,label:'"'+f+'"'};c&&c.length&&(e=d.find(c,function(a){return a.val===g.val})),e||(c.push(g),c=d.sortBy(c,function(a){return a.val}))}return c}})},{"../column-options":879,"./base-analysis-form-model":820,"./georeference-form.tpl":850,"./georeference-types":855,underscore:"underscore"}],850:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.georeference.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.select-type"))?"":_.escape(__t))+'</p>\n      <div class="u-tSpace-xl CDB-Text CDB-Fieldset">\n        <p class="CDB-Legend u-upperCase u-iBlock CDB-Text is-semibold CDB-Size-small u-rSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input"))?"":_.escape(__t))+'</p>\n        <div class="Editor-formInput u-ellipsis" data-editors="source"></div>\n      </div>\n      <div class="u-tSpace-xl CDB-Text CDB-Fieldset">\n        <p class="CDB-Legend u-upperCase u-iBlock CDB-Text is-semibold CDB-Size-small u-rSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.type"))?"":_.escape(__t))+'</p>\n        <div class="Editor-formInput" data-editors="type"></div>\n      </div>\n    </div>\n  </div>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="'+(null==(__t=parametersDataFields)?"":__t)+'">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.parameters"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.tune-analysis"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],851:[function(a,b,c){b.exports={type:"georeference-ip-address",label:_t("editor.layers.analysis-form.georeference.ip-address"),fieldAttrs:{ip_address:{showSearch:!0}},validatorFor:{ip_address:["required"]},parametersDataFields:"ip_address",getParameters:function(){var a=this.parametersDataFields;return a},parse:function(a){return{type:"georeference-ip-address",ip_address:a.ip_address}},formatAttrs:function(a){return a}}},{}],852:[function(a,b,c){b.exports={type:"georeference-long-lat",label:_t("editor.layers.analysis-form.georeference.long-lat"),parametersDataFields:"latitude,longitude",fieldAttrs:{latitude:{showSearch:!0},longitude:{showSearch:!0}},validatorFor:{latitudde:["required"],longitude:["required"]},parse:function(a){return{type:"georeference-long-lat",latitude:a.latitude,longitude:a.longitude}},getParameters:function(){var a=this.parametersDataFields;return a},formatAttrs:function(a){return a}}},{}],853:[function(a,b,c){b.exports={type:"georeference-postal-code",label:_t("editor.layers.analysis-form.georeference.postal-code"),fieldAttrs:{postal_code_column:{showSearch:!0},country:{showSearch:!0,allowFreeTextInput:!0}},validatorFor:{city_column:["required"]},parametersDataFields:"postal_code_column,country",getParameters:function(){var a=this.parametersDataFields;return a},parse:function(a){return{type:"georeference-postal-code",postal_code_column:a.postal_code_column,country:a.country||a.country_column}},formatAttrs:function(a,b){return a.country&&b.findColumn(a.country,"string")?(a.country_column=a.country,delete a.country):delete a.country_column,a}}},{}],854:[function(a,b,c){var d=a("underscore"),e={normal:"street_address_column,context,city,state,country",advance:"street_address_template,context,city,state,country"};b.exports={type:"georeference-street-address",label:_t("editor.layers.analysis-form.georeference.street-address"),fieldAttrs:{street_address_column:{showSearch:!0},city:{showSearch:!0,allowFreeTextInput:!0},state:{showSearch:!0,allowFreeTextInput:!0},country:{showSearch:!0,allowFreeTextInput:!0}},validatorFor:{street_address_column:["required"],street_address_template:["required"]},parse:function(a){var b={type:"georeference-street-address",city:a.city||a.city_column||"",state:a.state||a.state_column||"",country:a.country||a.country_column||""};return"advance"===a.context?b.street_address_template=a.street_address_column&&this._wrapInBraces(a.street_address_column)||a.street_address_template||"":b.street_address_column=a.street_address_column||"",b},_wrapInBraces:function(a){return["{{",a,"}}"].join("")},getParameters:function(a){return a||(a="normal"),e[a]},formatAttrs:function(a,b){return d.each(["city","state","country"],function(c){a[c]&&b.findColumn(a[c],"string")?(a[c+"_column"]=a[c],delete a[c]):delete a[c+"_column"]},this),a}}},{underscore:"underscore"}],855:[function(a,b,c){b.exports=[a("./georeference-long-lat-model"),a("./georeference-city-model"),a("./georeference-country-model"),a("./georeference-admin-region-model"),a("./georeference-postal-code-model"),a("./georeference-ip-address-model"),a("./georeference-street-address-model")]},{"./georeference-admin-region-model":846,"./georeference-city-model":847,"./georeference-country-model":848,"./georeference-ip-address-model":851,"./georeference-long-lat-model":852,"./georeference-postal-code-model":853,"./georeference-street-address-model":854}],856:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./group-points.tpl"),g=a("../column-options"),h=a("./group-points-types"),i={};h.map(function(a){i[a.type]=a}),b.exports=e.extend({parse:function(a){return d.defaults(d.pick(a,"id","source"),this._typeDef(a.type).parse(a))},initialize:function(){e.prototype.initialize.apply(this,arguments),this._columnOptions=new g({},{configModel:this._configModel,nodeDefModel:this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"))}),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this.on("change:aggregate",this._updateAggregation,this),this.on("change:type",this._onTypeChanged,this),this._updateAggregation(),this._setSchema()},_updateAggregation:function(){var a=this.get("aggregate");""===a?this.set({aggregation:"count",aggregation_column:""}):this.set({aggregation_column:a.attribute,aggregation:a.operator}),this._setSchema()},_onTypeChanged:function(){this._replaceAttrs(),this._setSchema()},_replaceAttrs:function(){var a=this.parse(this.attributes);this.clear({silent:!0}),this.set("type",a.type,{silent:!0}),this.set(d.extend(a,this.defaults))},updateNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);a.clear({silent:!0}),a.set(b)},_formatAttrs:function(a){var b=this._typeDef().formatAttrs(a,this._columnOptions);return e.prototype._formatAttrs.call(this,b)},getTemplate:function(){return f},getTemplateData:function(){return{parametersDataFields:this._typeDef().parametersDataFields}},_filterSchemaFieldsByType:function(a){var b=["source","type","aggregate"].concat(this._typeDef().parametersDataFields.split(","));return d.pick(a,b)},_setSchema:function(){e.prototype._setSchema.call(this,this._filterSchemaFieldsByType({source:this._primarySourceSchemaItem(),type:{type:"Select",title:_t("editor.layers.analysis-form.method"),options:h.map(function(a){return{val:a.type,label:a.label}},this),dialogMode:"float"},target_percentage:{type:"Number",title:_t("editor.layers.analysis-form.target-percent"),help:_t("editor.layers.analysis-form.target-percent-help"),validators:["required",{type:"interval",min:0,max:100}]},allow_holes:{type:"Radio",title:_t("editor.layers.analysis-form.allow-holes"),options:[{val:!1,label:_t("editor.layers.analysis-form.no")},{val:!0,label:_t("editor.layers.analysis-form.yes")}]},category_column:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.group-by"),editor:{type:"Select",options:this._columnOptions.all(),dialogMode:"float",editorAttrs:{showLabel:!1}}},aggregate:{type:"Operators",title:_t("editor.layers.analysis-form.operation"),options:this._columnOptions.filterByType("number"),dialogMode:"float"}}))},_getColumnOptions:function(a,b){var c=this._columnOptions.filterByType(b);if(this._columnOptions.get("columnsFetched")&&this.get(a)){var e=!1,f=this.get(a),g={val:f,label:'"'+f+'"'};c&&c.length&&(e=d.find(c,function(a){return a.val===g.val})),e||(c.push(g),c=d.sortBy(c,function(a){return a.val}))}return c},_typeDef:function(a){return a=a||this.get("type"),i[a]}})},{"../column-options":879,"./base-analysis-form-model":820,"./group-points-types":857,"./group-points.tpl":858,underscore:"underscore"}],857:[function(a,b,c){b.exports=[a("./group-points/convex-hull"),a("./group-points/concave-hull"),a("./group-points/bounding-circle"),a("./group-points/bounding-box")]},{"./group-points/bounding-box":859,"./group-points/bounding-circle":860,"./group-points/concave-hull":861,"./group-points/convex-hull":862}],858:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="'+(null==(__t=parametersDataFields)?"":__t)+'">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.group-points.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input-layer"))?"":_.escape(__t))+'</p>\n    </div>\n  </div>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="aggregate">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.value-aggregation"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.value-aggregation-desc"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],859:[function(a,b,c){var d=a("underscore");b.exports={type:"bounding-box",label:_t("editor.layers.analysis-form.bounding-box"),parametersDataFields:"source,type,category_column",parse:function(a){a.aggregation_column||(a.aggregation_column="cartodb_id"),a.aggregation||(a.aggregation="count");var b={operator:a.aggregation,attribute:"count"===a.aggregation?"":a.aggregation_column};return{type:"bounding-box",category_column:a.category_column,aggregate:b}},formatAttrs:function(a){return a=d.omit(a,"aggregate"),a.aggregation_column||(a=d.omit(a,"aggregation_column")),a.category_column||(a=d.omit(a,"category_column")),a}}},{underscore:"underscore"}],860:[function(a,b,c){var d=a("underscore");b.exports={type:"bounding-circle",label:_t("editor.layers.analysis-form.bounding-circle"),parametersDataFields:"source,type,category_column",parse:function(a){a.aggregation_column||(a.aggregation_column="cartodb_id"),a.aggregation||(a.aggregation="count");var b={operator:a.aggregation,attribute:"count"===a.aggregation?"":a.aggregation_column};return{type:"bounding-circle",category_column:a.category_column,aggregate:b}},formatAttrs:function(a){return a=d.omit(a,"aggregate"),a.aggregation_column||(a=d.omit(a,"aggregation_column")),a.category_column||(a=d.omit(a,"category_column")),a}}},{underscore:"underscore"}],861:[function(a,b,c){var d=a("underscore");b.exports={type:"concave-hull",label:_t("editor.layers.analysis-form.concave-hull"),parametersDataFields:"source,type,target_percentage,allow_holes,category_column",parse:function(a){a.aggregation_column||(a.aggregation_column="cartodb_id"),a.aggregation||(a.aggregation="count");var b={operator:a.aggregation,attribute:"count"===a.aggregation?"":a.aggregation_column},c=70;return 0===a.target_percent?c=0:a.target_percent&&(c=100*a.target_percent),{type:"concave-hull",target_percentage:c,category_column:a.category_column,aggregate:b}},formatAttrs:function(a){return a=d.omit(a,"aggregate"),a.target_percent=a.target_percentage/100,a=d.omit(a,"target_percentage"),a.aggregation_column||(a=d.omit(a,"aggregation_column")),a.allow_holes||(a=d.omit(a,"allow_holes")),a.category_column||(a=d.omit(a,"category_column")),a}}},{underscore:"underscore"}],862:[function(a,b,c){var d=a("underscore");b.exports={type:"convex-hull",label:_t("editor.layers.analysis-form.convex-hull"),parametersDataFields:"source,type,category_column",parse:function(a){a.aggregation_column||(a.aggregation_column="cartodb_id"),a.aggregation||(a.aggregation="count");var b={operator:a.aggregation,attribute:"count"===a.aggregation?"":a.aggregation_column};return{type:"convex-hull",category_column:a.category_column,aggregate:b}},formatAttrs:function(a){return a=d.omit(a,"aggregate"),a.aggregation_column||(a=d.omit(a,"aggregation_column")),a.category_column||(a=d.omit(a,"category_column")),a}}},{underscore:"underscore"}],863:[function(a,b,c){var d=a("./base-analysis-form-model"),e=a("./kmeans-form.tpl");b.exports=d.extend({defaults:{clusters:2},initialize:function(){d.prototype.initialize.apply(this,arguments),this._setSchema()},getTemplate:function(){return e},_setSchema:function(){d.prototype._setSchema.call(this,{source:this._primarySourceSchemaItem(),clusters:{type:"Number",title:_t("editor.layers.analysis-form.clusters-num"),validators:["required",{type:"interval",min:2,max:16}]}})}})},{"./base-analysis-form-model":820,"./kmeans-form.tpl":864}],864:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.kmeans.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input-layer"))?"":_.escape(__t))+'</p>\n    </div>\n  </div>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="clusters">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.parameters"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.tune-clusters"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],865:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model"),f=a("./merge-form.tpl"),g=a("../column-options"),h="join_operator,left_source_column,right_source_column,source_geometry_selector,left_source_columns,right_source_columns";b.exports=e.extend({defaults:{join_operator:"inner",source_geometry:"left_source",right_source_columns:[]},parse:function(a){return"left_source"!==a.source_geometry&&a.source_geometry?a.source_geometry_selector=a.right_source:a.source_geometry_selector=a.left_source,a},initialize:function(){e.prototype.initialize.apply(this,arguments),this.on("change",this._onChange,this),this._leftColumnOptions=new g({},{configModel:this._configModel}),this._rightColumnOptions=new g({},{configModel:this._configModel}),this.listenTo(this._analysisSourceOptionsModel,"change:fetching",this._setSchema),this.listenTo(this._leftColumnOptions,"columnsFetched",this._setSchema),this.listenTo(this._rightColumnOptions,"columnsFetched",this._setSchema),this.on("change:type",this._setSchema,this),
this.on("change:right_source",this._onChangeRightSource,this),this.on("change:join_operator, change:right_source, change:left_source_column, change:right_source_column",this._setSchema,this),this._setSchema(),this._fetchLeftColumns(),this._fetchRightColumns()},_getFormFieldNames:function(){return h},_getFormatFieldNames:function(){return h},_formatAttrs:function(a){var b=d.pick(a,["id","type","left_source","right_source"].concat(this._getFormatFieldNames().split(",")));return this.get("left_source")===this.get("source_geometry_selector")?b.source_geometry="left_source":b.source_geometry="right_source",a.left_source_columns||(b.left_source_columns=[]),a.right_source_columns||(b.right_source_columns=[]),e.prototype._formatAttrs.call(this,b)},getTemplate:function(){return f},getTemplateData:function(){return{right_source:this.get("right_source"),hasLeftAndRightSourceColumns:this.get("left_source_column")&&this.get("right_source_column")}},_filterSchemaFieldsByType:function(a){return d.pick(a,["left_source","right_source"].concat(this._getFormFieldNames().split(",")))},_onChangeRightSource:function(){this._fetchRightColumns(),this.unset("right_source_column"),this.set("right_source_columns",[])},_getLeftSourceLabel:function(){var a=this._getSourceOption()[0];if(a)return a.layerName},_getRightSourceLabel:function(){var a=this._getSourceOptionsForSourceId(this.get("right_source"),"right_source","*");if(a)return a.label},_setSchema:function(){e.prototype._setSchema.call(this,this._filterSchemaFieldsByType({left_source:this._primarySourceSchemaItem(_t("editor.layers.analysis-form.input-num",{num:1})),right_source:{type:"NodeDataset",title:_t("editor.layers.analysis-form.input-num",{num:2}),options:this._getSourceOptionsForSource("right_source","*"),dialogMode:"float",validators:["required"],editorAttrs:{disabled:this._isSourceDisabled("right_source")}},join_operator:{type:"Radio",title:_t("editor.layers.analysis-form.join-type"),options:[{label:_t("editor.layers.analysis-form.left"),val:"left",help:_t("editor.layers.analysis-form.merge-type.left")},{label:_t("editor.layers.analysis-form.inner"),val:"inner",help:_t("editor.layers.analysis-form.merge-type.inner")}],validators:["required"]},left_source_column:{type:"Select",title:this._getLeftSourceLabel(),options:this._leftColumnOptions.all(),dialogMode:"float",validators:["required"]},right_source_column:{type:"Select",title:this._getRightSourceLabel(),options:this._rightColumnOptions.all(),dialogMode:"float",validators:["required",this._validateRightSourceColumn.bind(this)]},source_geometry_selector:{type:"NodeDataset",title:_t("editor.layers.analysis-form.geometry-from"),options:this._getSourcesSelector(),dialogMode:"float",editorAttrs:{disabled:this._isSourceDisabled("right_source")}},left_source_columns:{type:"MultiSelect",title:this._getLeftSourceLabel(),options:this._leftColumnOptions.filterByType(["string","number","date","boolean"]),dialogMode:"float"},right_source_columns:{type:"MultiSelect",title:this._getRightSourceLabel(),options:this._rightColumnOptions.filterByType(["string","number","date","boolean"]),dialogMode:"float"}}))},_validateRightSourceColumn:function(a,b){var c=b.left_source_column,d=b.right_source_column;if(void 0===c||void 0===d)return null;var e={message:_t("editor.layers.analysis-form.should-match")},f=this._leftColumnOptions.findColumn(c),g=f&&f.type,h=this._rightColumnOptions.findColumn(d),i=h&&h.type;return g===i?null:e},_fetchColumns:function(a,b){var c=this.get(a),d=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(c);d?b.setNode(d):c&&b.setDataset(c)},_fetchLeftColumns:function(){this._fetchColumns("left_source",this._leftColumnOptions)},_fetchRightColumns:function(){this._fetchColumns("right_source",this._rightColumnOptions)},_isSourceDisabled:function(a){return this._isPrimarySource(a)||this._isFetchingOptions()},_getSourcesSelector:function(){return d.compact([this._getSourceOption()[0],this._getRightSource()])},_getRightSource:function(){if(this.get("right_source")){var a=this._getSourceOptionsForSourceId(this.get("right_source"),"right_source","*");if(a)return{val:this.get("right_source"),type:a.type,nodeTitle:this._analyses.title(a),layerName:a.layerName,color:a.color}}},_getSourceOptionsForSourceId:function(a,b,c){return this._analysisSourceOptionsModel.getSelectOptions(c).find(function(b){return b.val===a})},_getSourceOptionsForSource:function(a,b){var c=this.get(a);if(this._isFetchingOptions())return[{val:c,label:_t("editor.layers.analysis-form.loading"),isLoading:!0}];var d=this._getSourceOption()[0];return this._analysisSourceOptionsModel.getSelectOptions(b).filter(function(a){return a.val!==d.val&&a.val!==d.layerName})},_getSourceOption:function(){var a=this.get("left_source"),b=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(a);return[{val:a,type:"node",nodeTitle:this._analyses.title(b),layerName:this._layerDefinitionModel.getName(),color:this._layerDefinitionModel.get("color")}]},_onChange:function(){var a=this.changed.left_source||this.changed.right_source;a&&this._analysisSourceOptionsModel.createSourceNodeUnlessExisting(a)}})},{"../column-options":879,"./base-analysis-form-model":820,"./merge-form.tpl":866,underscore:"underscore"}],866:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="left_source,right_source,join_operator">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.merge.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.define-two-layers"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n  ",right_source&&(__p+='\n    <div class="Editor-HeaderInfo">\n      <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n      <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="left_source_column,right_source_column">\n        <div class="Editor-HeaderInfo-title u-bSpace--m">\n          <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.foreign-keys"))?"":_.escape(__t))+'</h2>\n        </div>\n        <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.no-coincidence"))?"":_.escape(__t))+"</p>\n      </div>\n    </div>\n    ",hasLeftAndRightSourceColumns&&(__p+='\n      <div class="Editor-HeaderInfo">\n        <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">4</div>\n        <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source_geometry_selector,left_source_columns,right_source_columns">\n          <div class="Editor-HeaderInfo-title u-bSpace--m">\n            <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.columns"))?"":_.escape(__t))+'</h2>\n          </div>\n          <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.keep-columns"))?"":_.escape(__t))+"</p>\n        </div>\n      </div>\n    "),__p+="\n  "),__p+="\n</form>\n";return __p}},{underscore:"underscore"}],867:[function(a,b,c){var d=a("./base-analysis-form-model"),e=a("./moran-form.tpl"),f=a("../column-options");b.exports=d.extend({defaults:{significance:.05,neighbours:5,permutations:99,w_type:"knn"},initialize:function(){d.prototype.initialize.apply(this,arguments),this._columnOptions=new f({},{configModel:this._configModel,nodeDefModel:this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"))}),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this._setSchema()},getTemplate:function(){return e},_setSchema:function(){var a={source:this._primarySourceSchemaItem(),numerator_column:{type:"Select",title:_t("editor.layers.analysis-form.numerator"),options:this._columnOptions.filterByType("number"),dialogMode:"float",help:_t("editor.layers.analysis-form.numerator-help")},denominator_column:{type:"EnablerEditor",title:"",label:_t("editor.layers.analysis-form.denominator"),help:_t("editor.layers.analysis-form.denominator-help"),editor:{type:"Select",title:_t("editor.layers.analysis-form.denominator"),options:this._columnOptions.filterByType("number"),dialogMode:"float"}},significance:{type:"Number",title:_t("editor.layers.analysis-form.significance"),help:_t("editor.layers.analysis-form.significance-help"),validators:["required",{type:"interval",min:0,max:1,step:.05}]},neighbours:{type:"Number",title:_t("editor.layers.analysis-form.neighbors"),help:_t("editor.layers.analysis-form.neighbors-help"),validators:["required",{type:"interval",min:1,max:100}]}};d.prototype._setSchema.call(this,a)},updateNodeDefinition:function(a){var b=this._formatAttrs(this.attributes);a.attributes=b}})},{"../column-options":879,"./base-analysis-form-model":820,"./moran-form.tpl":868}],868:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.moran-cluster.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.input-layer"))?"":_.escape(__t))+'</p>\n    </div>\n  </div>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="numerator_column,denominator_column,significance,neighbours">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.analysis-form.parameters"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.layers.analysis-form.define-columns"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n";return __p}},{underscore:"underscore"}],869:[function(a,b,c){var d=a("./base-analysis-form-model"),e=a("./sampling-form.tpl"),f=a("underscore"),g=10;b.exports=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments),this.bind("change:percent",function(){this.set("sampling",+this.get("percent")/100)},this),this._setSchema()},parse:function(a){return f.defaults(a,{percent:g,sampling:g/100})},getTemplate:function(){return e},_setSchema:function(){var a={source:this._primarySourceSchemaItem(),percent:{type:"Number",title:_t("editor.layers.analysis-form.sampling-rate"),validators:["required",{type:"interval",min:0,max:100,step:1}]}};d.prototype._setSchema.call(this,a)}})},{"./base-analysis-form-model":820,"./sampling-form.tpl":870,underscore:"underscore"}],870:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source,percent">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.sampling.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.sampling-desc"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n\n";return __p}},{underscore:"underscore"}],871:[function(a,b,c){var d=a("./base-analysis-form-model"),e=a("./spatial-markov-trend.tpl"),f=a("../column-options");b.exports=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments);var a=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(this.get("source"));this._columnOptions=new f({},{configModel:this._configModel,nodeDefModel:a}),this.listenTo(this._columnOptions,"columnsFetched",this._setSchema),this._setSchema()},getTemplate:function(){return e},_setSchema:function(){var a={source:this._primarySourceSchemaItem(),time_columns:{type:"MultiSelect",title:_t("editor.layers.analysis-form.spatial-markov-trend-time-columns"),options:this._columnOptions.filterByType(["string","number"]),dialogMode:"float",help:_t("editor.layers.analysis-form.spatial-markov-trend-time-columns-help"),editorAttrs:{showSearch:!0}}};d.prototype._setSchema.call(this,a)}})},{"../column-options":879,"./base-analysis-form-model":820,"./spatial-markov-trend.tpl":872}],872:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form>\n  <div class="Editor-HeaderInfo">\n    <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n    <div class="Editor-HeaderInfo-inner CDB-Text" data-fields="source,time_columns">\n      <div class="Editor-HeaderInfo-title u-bSpace--m">\n        <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("analyses.spatial-markov-trend.title"))?"":_.escape(__t))+'</h2>\n      </div>\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.layers.analysis-form.spatial-markov-trend-desc"))?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</form>\n\n";return __p}},{underscore:"underscore"}],873:[function(a,b,c){var d=a("underscore"),e=a("./base-analysis-form-model");b.exports=e.extend({validate:function(){return!0},getTemplate:function(){return d.template("<form>Unknown analysis type <%- type %></form>")},getTemplateData:function(){return{type:this.get("type")||""}},updateNodeDefinition:function(){},createNodeDefinition:function(){}})},{"./base-analysis-form-model":820,underscore:"underscore"}],874:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../../components/modals/add-widgets/tablestats"),h=a("../../../../helpers/utils");a("../../../../components/form-components/index");var i={validate:!0};b.exports=f.extend({initialize:function(a){if(!a.formModel)throw new Error("formModel is required");if(!a.configModel)throw new Error("configModel is required");this._configModel=a.configModel,this._userModel=a.userModel,this._formModel=a.formModel,this.tableStats=new g({configModel:this._configModel,userModel:this._userModel}),this._formModel.on("changeSchema",this.render,this),this._formModel.on("generateHistogram",this._generateHistogram,this),this._formModel.on("change:histogram_stats",this._showHistogramStats,this),this.add_related_model(this._formModel)},render:function(){return this.clearSubViews(),this.$el.empty(),this._formView=new e.Form({model:this._formModel,trackingClass:"track-"+this._formModel.get("type")+"-analysis",template:this._formModel.getTemplate(),templateData:this._formModel.getTemplateData()}),this._formView.bind("change",this._onChangeAnalysisFormView,this),this.$el.append(this._formView.render().el),this},_onChangeAnalysisFormView:function(a){var b=this._formView.cid;this._formView.model.setFormValidationErrors(void 0);var c=this._formView.getValue();this._formView.model.set(c),this._showAnalysisFormErrors(b)},_showAnalysisFormErrors:function(a){if(this._formView.cid===a&&this._formView.$el){var b=this._formView.commit(i);this._formView.model.setFormValidationErrors(b)}},_generateHistogram:function(a){this.tableStats.graphFor(a.tableName,a.columnName,this._drawHistogram.bind(this))},_showHistogramStats:function(){var a=this._formModel.get("histogram_stats");if(!a||!d.isNumber(a.max)||!d.isNumber(a.min))return void this.$(".js-histogram").hide();var b=a.max<1e4?h.formatNumber(a.max):h.readizableNumber(a.max),c=a.min<1e4?h.formatNumber(a.min):h.readizableNumber(a.min);this.$(".js-max").html(b),this.$(".js-min").html(c),this.$(".js-histogram").show()},_drawHistogram:function(a){var b=this._formModel.get("histogram_stats");b&&d.isNumber(b.max)&&d.isNumber(b.min)&&(this.$(".js-histogramChart").html(a.getHistogram({color:"#9DE0AD",width:158,height:20,bins:20})),this._showHistogramStats())},clearSubViews:function(){return this._formView&&this._formView.remove(),f.prototype.clearSubViews.apply(this,arguments)}})},{"../../../../components/form-components/index":211,"../../../../components/modals/add-widgets/tablestats":394,"../../../../helpers/utils":1102,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],875:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../../../../data/analyses");b.exports=e.Collection.extend({initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!b.analysisSourceOptionsModel)throw new Error("analysisSourceOptionsModel is required");if(!b.userActions)throw new Error("userActions is required");this._configModel=b.configModel,this._layerDefinitionModel=b.layerDefinitionModel,this._analysisSourceOptionsModel=b.analysisSourceOptionsModel,this._userActions=b.userActions},model:function(a,b){var c=b.collection,d=f.findFormModelByType(a.type);return new d(a,{configModel:c._configModel,analyses:f,layerDefinitionModel:c._layerDefinitionModel,analysisSourceOptionsModel:c._analysisSourceOptionsModel,collection:c,parse:!0})},resetByLayerDefinition:function(){var a=this._layerDefinitionModel.getAnalysisDefinitionNodeModel();if(a){var b=[];this._walkAnalysisChain(a,this._layerDefinitionModel,function(a){var c=d.extend({persisted:!0},a.attributes);b.push(c)}),this.reset(b)}},addHead:function(a){return this.remove(a.id),this.add(a,{at:0})},deleteNode:function(a){var b=this._layerDefinitionModel.findAnalysisDefinitionNodeModel(a);b?this._userActions.deleteAnalysisNode(a):this.remove(a)},_walkAnalysisChain:function(a,b,c){if(a.hasPrimarySource()){c.call(this,a);var d=a.getPrimarySource();b.isOwnerOfAnalysisNode(d)&&this._walkAnalysisChain(d,b,c)}}})},{"../../../../data/analyses":599,backbone:"backbone",underscore:"underscore"}],876:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../components/infobox/infobox-view"),f=a("../../../../helpers/required-opts"),g=["infoboxModel","infoboxCollection"];b.exports=d.extend({initialize:function(a){f(a,g,this)},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=new e({infoboxModel:this._infoboxModel,infoboxCollection:this._infoboxCollection});this.addView(a),this.$el.append(a.render().el)}})},{"../../../../components/infobox/infobox-view":221,"../../../../helpers/required-opts":1097,"backbone/core-view":1127}],877:[function(a,b,c){var d=a("underscore"),e=a("queue-async"),f=a("backbone"),g=a("../../../../data/analyses");b.exports=f.Model.extend({defaults:{fetching:!1,nodes_options:[]},initialize:function(a,b){if(!b.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");if(!b.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!b.tablesCollection)throw new Error("tablesCollection is required");this._analysisDefinitionNodesCollection=b.analysisDefinitionNodesCollection,this._layerDefinitionsCollection=b.layerDefinitionsCollection,this._tablesCollection=b.tablesCollection},fetch:function(){this.set({fetching:!0,nodes_options:[]});var a=e();this._fetchTables(a),this._createOptionsFromNodes(a),a.awaitAll(function(){this.set("fetching",!1)}.bind(this))},getSelectOptions:function(a){return this.get("fetching")?[]:(d.isString(a)&&(a=[a]),d.flatten([this.get("nodes_options").filter(function(b){return this._isValidGeometry(a,b.simpleGeometryType)},this).map(function(a){var b=this._analysisDefinitionNodesCollection.get(a.val),c=this._layerDefinitionsCollection.findOwnerOfAnalysisNode(b);return d.extend({layerName:c&&c.getName(),nodeTitle:g.title(b),color:c&&c.get("color"),type:"node"},a)},this),this._getTablesSelectOptions(a)]))},createSourceNodeUnlessExisting:function(a){var b=this._tablesCollection.get(a);if(b){var c=b.get("name");this._analysisDefinitionNodesCollection.createSourceNode({id:c,tableName:c})}},_isValidGeometry:function(a,b){return d.contains(a,b)||"*"===a[0]},_fetchTables:function(a){a.defer(function(a){this._tablesCollection.fetch({data:{show_likes:!1,show_liked:!1,show_stats:!1,show_table_size_and_row_count:!1,show_permission:!1,show_synchronization:!1,show_uses_builder_features:!1,load_totals:!1,per_page:1e3}}),this._tablesCollection.once("sync error",function(){a()})}.bind(this))},_createOptionsFromNodes:function(a){var b=this;this._analysisDefinitionNodesCollection.each(function(c){var d=c.queryGeometryModel;a.defer(function(a){if(d.isFetched())return b._appendNodeOption(c),a();if(!d.canFetch())return a();var e=function(){"fetching"!==d.get("status")&&(d.off("change:status",e),b._appendNodeOption(c),a())};d.on("change:status",e),d.fetch()})})},_appendNodeOption:function(a){var b=a.queryGeometryModel.get("simple_geom"),c=this._layerDefinitionsCollection.findOwnerOfAnalysisNode(a);b&&c&&this.get("nodes_options").push({simpleGeometryType:b,val:a.id,label:a.id})},_getTablesSelectOptions:function(a){return this._tablesCollection.reduce(function(b,c){var d=c.getGeometryType()[0];return this._isValidGeometry(a,d)&&b.push({val:c.id,label:c.get("name"),type:"dataset"}),b},[],this)}})},{"../../../../data/analyses":599,backbone:"backbone","queue-async":"queue-async",underscore:"underscore"}],878:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("cartodb.js"),g=d.template("SELECT min(<%= column %>) as min, max(<%= column %>) as max FROM (<%= sql %>) _table_sql");b.exports=e.Model.extend({initialize:function(a,b){if(!b.configModel)throw new Error("configModel param is required");if(!b.nodeDefModel)throw new Error("nodeDefModel param is required");this._nodeDefModel=b.nodeDefModel,this._SQL=new f.SQL({user:b.configModel.get("user_name"),sql_api_template:b.configModel.get("sql_api_template"),api_key:b.configModel.get("api_key")}),this._query=b.nodeDefModel.querySchemaModel.get("query"),this.on("change:column",this.fetch,this)},_onQueryDone:function(a){d.size(a.rows)>0&&this.trigger("columnsFetched",d.first(a.rows))},fetch:function(){this.get("column")&&this._query&&this._SQL.execute(g({sql:this._query,column:this.get("column")}),null,{extra_params:["page","rows_per_page"],page:0,rows_per_page:40,success:this._onQueryDone.bind(this),error:function(){}})}})},{backbone:"backbone","cartodb.js":"cartodb.js",underscore:"underscore"}],879:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("backbone"),g=d.template("SELECT * FROM <%= tableName %>");b.exports=f.Model.extend({defaults:{columnsFetched:!1},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._columnOptions=[],this._SQL=new e.SQL({user:b.configModel.get("user_name"),sql_api_template:b.configModel.get("sql_api_template"),api_key:b.configModel.get("api_key")}),b.nodeDefModel&&this.setNode(b.nodeDefModel)},_fetch:function(){this._query&&(this.set("columnsFetched",!1),this._SQL.execute(this._query,null,{extra_params:["page","rows_per_page"],page:0,rows_per_page:40,success:this._onQueryDone.bind(this),error:function(){}}))},setDataset:function(a){this._columnOptions=[],this._query=g({tableName:a}),this._fetch()},setNode:function(a){this._columnOptions=[],this._query=a.querySchemaModel.get("query"),this._fetch()},findColumn:function(a,b){return d.find(this.filterByType(b),function(b){return b.val===a},this)},all:function(){return this.filterByType()},filterByType:function(a){if(!d.size(this._columnOptions))return[];var b=d.map(this._columnOptions,function(a,b){var c=b;return{val:c,label:c,type:a.type}});return d.isArray(a)?b=b.filter(function(b){return d.contains(a,b.type)}):a&&(b=b.filter(function(b){return b.type===a})),b},_onQueryDone:function(a){this._columnOptions=a.fields,this.set("columnsFetched",!0),this.trigger("columnsFetched")}})},{backbone:"backbone","cartodb.js":"cartodb.js",underscore:"underscore"}],880:[function(a,b,c){function d(a){return"polygon"===a?"select * from obs_legacybuildermetadata('sum')":"select * from obs_legacybuildermetadata()"}var e=a("underscore"),f=a("backbone"),g=a("cartodb.js");b.exports=f.Model.extend({initialize:function(a,b){this._configModel=b.configModel,this._geometryType=b.geometryType},sync:function(a,b,c){var e=new g.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")});e.execute(d(this._geometryType)).done(function(a){c.success&&c.success(a)}).error(function(a){})},setGeometryType:function(a){this._geometryType=a},parse:function(a){var b={};return e.each(a.rows,function(a){var c={};e.each(a.subsection,function(a){var b={};e.each(a.f1.columns,function(a){b[a.f1.name]=a.f1.id}),c[a.f1.name]=b}),b[a.name]=c}),b},measurement:function(a){var b=this.get(a);return b?e.keys(b):[]},columns:function(a,b){var c=this.get(a);return c?e.keys(c[b]||{}):[]},segment:function(a,b,c){var d=this.get(a);return d?d[b][c]:null},areas:function(){return e.keys(this.attributes)}})},{backbone:"backbone","cartodb.js":"cartodb.js",underscore:"underscore"}],881:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../../../components/scroll/scroll-view"),g=a("../../../../components/view-factory"),h=a("../analyses/analyses-placeholder.tpl"),i=a("../analyses/analyses-sql-error.tpl"),j=a("../analyses/analysis-form-view"),k=a("../analyses/analyses-workflow-view"),l=a("../analyses/analysis-controls-view"),m=a("../../query-sanity-check"),n=a("../../sql-error-action.tpl"),o=a("../../../components/overlay/overlay-view"),p=a("./analyses-quota/analyses-quota-info"),q={ready:"ready",loading:"loading",fetched:"fetched",error:"error"};b.exports=e.extend({options:{selectedNodeId:!1},initialize:function(a){if(!a.userActions)throw new Error("userActions is required");if(!a.analysisFormsCollection)throw new Error("analysisFormsCollection is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");if(!a.overlayModel)throw new Error("overlayModel is required");this._userActions=a.userActions,this._stackLayoutModel=a.stackLayoutModel,this._userModel=a.userModel,this._analysisFormsCollection=a.analysisFormsCollection,this._layerDefinitionModel=a.layerDefinitionModel,this._analysisDefinitionNodesCollection=a.analysisDefinitionNodesCollection,this._configModel=a.configModel,this._overlayModel=a.overlayModel,this._viewModel=new d.Model({selectedNodeId:this.options.selectedNodeId}),this._querySchemaModel=this._layerDefinitionModel.getAnalysisDefinitionNodeModel().querySchemaModel,this._quotaInfo=p.get(a.configModel),this.modelView=new d.Model({state:this._getInitialState()}),this._initBinds(),m.track(this,this.render.bind(this))},render:function(){if(this.clearSubViews(),this.$el.empty(),this._hasError())this.$el.html(i({body:_t("editor.error-query.body",{action:n({label:_t("editor.error-query.label")})})}));else if(this._analysisFormsCollection.isEmpty())this.$el.html(h());else{var a=this._formModel();this._renderScrollableListView(a),this._renderControlsView(a)}return this._renderOverlay(),this},clean:function(){e.prototype.clean.apply(this),this._selectedNodeId(null,{silent:!0})},_renderOverlay:function(){var a=new o({overlayModel:this._overlayModel});this.addView(a),this.$el.append(a.render().el)},_getInitialState:function(){return q.loading},_hasError:function(){return this.modelView.get("state")===q.error},_initBinds:function(){this._viewModel.on("change:selectedNodeId",this.render,this),this.add_related_model(this._viewModel),this._layerDefinitionModel.on("change:source",this._onLayerDefSourceChanged,this),this.add_related_model(this._layerDefinitionModel),this._analysisFormsCollection.on("add",this._onFormModelAdded,this),this._analysisFormsCollection.on("remove",this._onFormModelRemoved,this),this.add_related_model(this._analysisFormsCollection)},_renderScrollableListView:function(a){var b=this,c=new f({createContentView:function(){return g.createListView([function(){return new k({analysisDefinitionNodesCollection:b._analysisDefinitionNodesCollection,layerDefinitionModel:b._layerDefinitionModel,analysisFormsCollection:b._analysisFormsCollection,viewModel:b._viewModel})},function(){return new j({formModel:a,configModel:b._configModel,userModel:b._userModel})}])}});this.$el.append(c.render().el),this.addView(c)},_renderControlsView:function(a){var b=this._analysisDefinitionNodesCollection.get(a.id),c=new l({configModel:this._configModel,analysisNode:b,userActions:this._userActions,userModel:this._userModel,stackLayoutModel:this._stackLayoutModel,formModel:a,quotaInfo:this._quotaInfo,querySchemaModel:this._getQuerySchemaModelForEstimation()});this.addView(c),this.$el.append(c.render().el)},_formModel:function(){return this._analysisFormsCollection.get(this._selectedNodeId())||this._analysisFormsCollection.first()},_getQuerySchemaModelForEstimation:function(){var a,b=this._analysisDefinitionNodesCollection.get(this._selectedNodeId());return b?(a=this._analysisDefinitionNodesCollection.indexOf(b),b=this._analysisDefinitionNodesCollection.at(a-1)):b=this._layerDefinitionModel.getAnalysisDefinitionNodeModel(),b.querySchemaModel},_selectedNodeId:function(a,b){if(this._viewModel)return void 0===a?this._viewModel.get("selectedNodeId"):void this._viewModel.set("selectedNodeId",a,b)},_onLayerDefSourceChanged:function(){this._analysisFormsCollection.resetByLayerDefinition()},_onFormModelAdded:function(){this._renderWithDefaultNodeSelected()},_onFormModelRemoved:function(){this._renderWithDefaultNodeSelected()},_renderWithDefaultNodeSelected:function(){var a=this._analysisFormsCollection.pluck("id")[0];this._selectedNodeId(a,{silent:!0}),this.render()}})},{"../../../../components/scroll/scroll-view":530,"../../../../components/view-factory":594,"../../../components/overlay/overlay-view":694,"../../query-sanity-check":997,"../../sql-error-action.tpl":1e3,"../analyses/analyses-placeholder.tpl":793,"../analyses/analyses-sql-error.tpl":801,"../analyses/analyses-workflow-view":807,"../analyses/analysis-controls-view":810,"../analyses/analysis-form-view":874,"./analyses-quota/analyses-quota-info":796,backbone:"backbone","backbone/core-view":1127}],882:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-content js-content"></div>\n<div class="js-info"></div>';return __p}},{underscore:"underscore"}],883:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"");
};with(obj||{})__p+='<ul class="CodeMirror-error">\n  <li class="CodeMirror-errorMessage u-lSpace--xl u-rSpace--xl">\n    '+(null==(__t=_t("components.codemirror.syntax-error"))?"":_.escape(__t))+": <span>"+(null==(__t=message)?"":_.escape(__t))+'</span>\n  </li>\n  <li class="CodeMirror-errorDocs">\n    <a href="https://carto.com/docs/carto-engine/sql-api/" target="_black">'+(null==(__t=_t("components.codemirror.docs"))?"":_.escape(__t))+"</a>\n  </li>\n</ul>\n";return __p}},{underscore:"underscore"}],884:[function(a,b,c){var d=a("underscore"),e=["created_at","the_geom","the_geom_webmercator","updated_at"];b.exports=function(a,b){var c={};if(!b)return c;var f=a.querySchemaModel;return f?(f.columnsCollection.each(function(f){var g=f.get("name");if(!d.contains(e,g)){var h=g+"-"+f.get("type"),i=c[h]=c[h]||[];i.push({analysisDefinitionNodeModel:a,layerDefinitionModel:b,columnModel:f})}}),c):c}},{underscore:"underscore"}],885:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("./create-tuples-items"),g=a("./widgets-types");b.exports=e.Model.extend({defaults:{render:!1},initialize:function(a,b){if(!b.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!b.widgetDefinitionsCollection)throw new Error("widgetDefinitionsCollection is required");if(!b.tableStats)throw new Error("tablestats is required");this._layerDefinitionModel=b.layerDefinitionModel,this._analysisDefinitionNode=this._layerDefinitionModel.getAnalysisDefinitionNodeModel(),this._widgetDefinitionsCollection=b.widgetDefinitionsCollection,this._tableStats=b.tableStats,this._columnsCollection=new e.Collection},getCollection:function(){return this._columnsCollection},createColumnCollection:function(){var a=f(this._analysisDefinitionNode,this._layerDefinitionModel),b=g(a);this._columnsCollection.reset(b),this._generateGraphs()},_generateGraphs:function(){var a=this,b=this._columnsCollection.map(function(b){var c=b.get("table"),e=b.get("name"),f=new d.Deferred;return a._locateWidget(b),a._tableStats.graphFor(c,e,function(a){a.stats&&b.set({graph:a}),f.resolve()}),f.promise()},this);d.when.apply(d,b).done(function(){a.set({render:a._columnsCollection.length>0})})},findWidget:function(a){var b=a.get("type"),c=a.get("name");return this._widgetDefinitionsCollection.findWhere({type:b,source:a.analysisDefinitionNodeModel().id,column:c})},_locateWidget:function(a){var b=this.findWidget(a);b&&a.set({selected:!0,widget:b},{silent:!0})},getColumnsWithWidgetAndGraph:function(){return this._columnsCollection.filter(function(a){return!!a.get("widget")&&!!a.get("graph")})},getColumnsWithWidget:function(){return this._columnsCollection.filter(function(a){return!!a.get("widget")&&!a.get("graph")})},getColumnsWithGraph:function(){return this._columnsCollection.filter(function(a){return!!a.get("graph")&&!a.get("widget")})},getColumnsWithoutGraph:function(){return this._columnsCollection.filter(function(a){return!a.get("graph")&&!a.get("widget")})}})},{"./create-tuples-items":884,"./widgets-types":897,backbone:"backbone",jquery:"jquery"}],886:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">\n  '+(null==(__t=body)?"":__t)+"\n</h2>";return __p}},{underscore:"underscore"}],887:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",renderLoading&&(__p+='\n<div class="Data-loaderContainer">\n  <div class="CDB-Loader is-visible"></div>\n</div>\n'),__p+='\n\n<div class="FormPlaceholder-paragraph u-tSpace-m u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-label FormPlaceholder-size--med u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-label FormPlaceholder-size--short u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long"></span>\n  </div>\n</div>\n\n<div class="FormPlaceholder-paragraph u-tSpace-m u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-label FormPlaceholder-size--med u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-label FormPlaceholder-size--short u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long"></span>\n  </div>\n</div>\n\n<div class="FormPlaceholder-paragraph u-tSpace-m u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-label FormPlaceholder-size--med u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-label FormPlaceholder-size--short u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long"></span>\n  </div>\n</div>\n\n<div class="FormPlaceholder-paragraph u-tSpace-m u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-label FormPlaceholder-size--med u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-label FormPlaceholder-size--short u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long u-tSpace-xl"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long"></span>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],888:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./stat-view"),h=a("./data-content-not-ready.tpl"),i=a("./data-content-error.tpl"),j=a("../../sql-error-action.tpl"),k=a("../../query-sanity-check"),l=a("../../../components/overlay/overlay-view"),m=a("../../../../helpers/required-opts"),n={ready:"ready",loading:"loading",nogeometry:"no-geometry",error:"error"},o=["columnsModel","infoboxModel","overlayModel","queryGeometryModel","querySchemaModel","stackLayoutModel","userActions","widgetDefinitionsCollection"];b.exports=f.extend({initialize:function(a){m(a,o,this),this._columnsCollection=this._columnsModel.getCollection(),this.modelView=new e.Model({state:this._getInitialState(),renderLoading:!0}),this._initBinds(),k.track(this,this.render.bind(this))},render:function(){return this.clearSubViews(),this.$el.empty(),this._hasError()?this._showError():this._hasNoGeometryData()?this._showNoGeometryData():this._isLoading()?this._showLoading():this._isReady()&&this._renderStats(),this._renderOverlay(),this},_renderOverlay:function(){var a=new l({overlayModel:this._overlayModel});this.addView(a),this.$el.append(a.render().el)},_showLoading:function(){this.$el.empty(),this.$el.append(h({renderLoading:this.modelView.get("renderLoading")}))},_showError:function(){this.$el.append(i({body:_t("editor.error-query.body",{action:j({label:_t("editor.error-query.label")})})}))},_showNoGeometryData:function(){this.$el.append(i({body:_t("editor.data.no-geometry-data")}))},_getInitialState:function(){return this._columnsReady()?n.ready:n.loading},_hasError:function(){return this.modelView.get("state")===n.error},_isLoading:function(){return this.modelView.get("state")===n.loading},_isReady:function(){return this.modelView.get("state")===n.ready},_columnsReady:function(){return this._columnsModel.get("render")===!0},_hasNoGeometryData:function(){return this.modelView.get("state")===n.nogeometry},_initBinds:function(){this.listenTo(this.modelView,"change:state",this.render),this.listenTo(this._queryGeometryModel,"change:status",this._checkGeometry),this.listenTo(this._queryGeometryModel,"change:simple_geom",this.render),this.listenTo(this._columnsModel,"change:render",this._handleStats),this.listenTo(this._columnsCollection,"change:selected",this._handleWidget)},_checkGeometry:function(a,b){var c;"fetched"===b&&(c=this._queryGeometryModel.hasValue(),!c&&this.modelView.set({state:n.nogeometry}))},_handleWidget:function(a){var b,c;a.get("selected")===!0?(c=this._columnsModel.findWidget(a),c?a.set({widget:c}):(b=this._userActions.saveWidgetOption(a),a.set({widget:b}),"time-series"===a.get("type")&&this._normalizeTimeSeriesColumn(a))):(b=a.get("widget"),b&&b.destroy())},_normalizeTimeSeriesColumn:function(a){var b=this._columnsCollection.findWhere(function(b){return"time-series"===b.get("type")&&b.get("selected")===!0&&b.cid!==a.cid});b&&b.set({selected:!1,widget:null})},_handleStats:function(){this._columnsReady()?(this.modelView.set({state:n.ready,renderLoading:!0},{silent:!0}),this.render()):this.modelView.set({state:n.loading,renderLoading:!1})},_renderStats:function(){if(this._columnsReady()){var a,b=this._columnsModel.getColumnsWithWidgetAndGraph(),c=this._columnsModel.getColumnsWithWidget(),e=this._columnsModel.getColumnsWithGraph(),f=this._columnsModel.getColumnsWithoutGraph();0===b.length&&0===c.length&&0===e.length&&0===f.length?(this._infoboxModel.set({state:"no-data",renderLoading:!1}),this._showLoading()):(this.$el.empty(),a=d.union(b,c,e,f),this._renderColumns(a))}},_renderColumns:function(a){d.each(a,function(a,b){var c=new g({stackLayoutModel:this._stackLayoutModel,statModel:a});this.addView(c),this.$el.append(c.render().el)},this)}})},{"../../../../helpers/required-opts":1097,"../../../components/overlay/overlay-view":694,"../../query-sanity-check":997,"../../sql-error-action.tpl":1e3,"./data-content-error.tpl":886,"./data-content-not-ready.tpl":887,"./stat-view":895,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],889:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../../../../data/undo-manager.js");b.exports=d.Model.extend({defaults:{content:""},initialize:function(a,b){this._history=this._generateHistory(b&&b.history),f.init(this,{track:!0,history:this._history})},_generateHistory:function(a){if(a&&a.length){var b=e.reduce(a,function(a,b){return a.push({content:b}),a},[],this);return b}return!1},getHistory:function(){return e.pluck(this.getUndoHistory(),"content")}})},{"../../../../data/undo-manager.js":667,backbone:"backbone",underscore:"underscore"}],890:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../components/code-mirror/code-mirror-view"),f=a("./code-mirror-error.tpl"),g=a("../../../editor-hints/factory-hints"),h=a("../../../editor-hints/sql-hints");b.exports=d.extend({className:"Editor-dataContentSQL Editor-content",initialize:function(a){if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.codemirrorModel)throw new Error("codemirrorModel is required");if(!a.onApplyEvent)throw new Error("onApplyEvent");this._layerDefinitionModel=a.layerDefinitionModel,this._querySchemaModel=a.querySchemaModel,this._codemirrorModel=a.codemirrorModel,this._initBinds(),g.init({querySchemaModel:this._querySchemaModel,layerDefinitionModel:this._layerDefinitionModel,tokens:h})},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this._querySchemaModel.on("change:query",this._onQueryChanged,this),this.add_related_model(this._querySchemaModel)},_onQueryChanged:function(a,b){"fetched"===b&&this.codeMirrorView.updateHints(h.reset().hints)},_initViews:function(){var a=g.reset().hints;this.codeMirrorView=new e({model:this._codemirrorModel,hints:a,mode:"text/x-pgsql",tip:_t("editor.data.code-mirror.tip"),errorTemplate:f}),this.codeMirrorView.bind("codeSaved",this._triggerCodeSaved,this),this.addView(this.codeMirrorView),this.$el.append(this.codeMirrorView.render().el)},_updateEditorContent:function(){this.codeMirrorView.setContent(this._layerDefinitionModel.get("sql"))},_triggerCodeSaved:function(a,b){this.options.onApplyEvent&&this.options.onApplyEvent()}})},{"../../../../components/code-mirror/code-mirror-view":27,"../../../editor-hints/factory-hints":700,"../../../editor-hints/sql-hints":701,"./code-mirror-error.tpl":883,"backbone/core-view":1127}],891:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../../components/view-options/panel-with-options-view"),h=a("../../../../components/scroll/scroll-view"),i=a("../../../../components/dataset/dataset-base-view"),j=a("./data-content-view"),k=a("./data-sql-view"),l=a("../../../../components/tab-pane/tab-pane-view"),m=a("../../../../components/tab-pane/tab-pane-collection"),n=a("../../../../components/toggler/toggler-view"),o=a("../../../../components/undo-redo/undo-redo-view"),p=a("../../../../components/infobox/infobox-factory"),q=a("../../../../components/infobox/infobox-model"),r=a("../../../../components/infobox/infobox-collection"),s=a("../../../../components/modals/add-widgets/tablestats"),t=a("./data-columns-model"),u=a("../../../../sql-notifications"),v=a("../../../../components/metrics/metrics-tracker"),w=a("../../../../components/onboardings/generic/generic-onboarding-launcher"),x=a("../../../../components/onboardings/layers/data-onboarding/data-onboarding-view"),y=a("../../../../components/onboardings/layers/layer-onboarding-key"),z=a("../../../../helpers/required-opts"),A=a("../analyses/analyses-service.js"),B=["widgetDefinitionsCollection","stackLayoutModel","userActions","layerDefinitionModel","userModel","onboardings","onboardingNotification"];b.exports=i.extend({initialize:function(a){z(a,B,this),this._nodeModel=a.layerDefinitionModel.getAnalysisDefinitionNodeModel(),this._querySchemaModel=this._nodeModel.querySchemaModel,this._queryGeometryModel=this._nodeModel.queryGeometryModel,i.prototype.initialize.call(this,{layerDefinitionModel:a.layerDefinitionModel,editorModel:a.editorModel,configModel:a.configModel,querySchemaModel:this._querySchemaModel});var b=this._layerDefinitionModel.canBeGeoreferenced()?"georeference":"";this._infoboxModel=new q({state:this._isLayerHidden()?"layer-hidden":b}),this._overlayModel=new e.Model({visible:this._isLayerHidden()}),this._tableStats=new s({configModel:this._configModel,userModel:this._userModel}),this._columnsModel=new t({},{layerDefinitionModel:this._layerDefinitionModel,widgetDefinitionsCollection:this._widgetDefinitionsCollection,tableStats:this._tableStats}),u.track(this),this._parseSQL=this._internalParseSQL.bind(this,this._afterAlterDataSuccess),this._onboardingLauncher=new w({view:x,onboardingNotification:this._onboardingNotification,notificationKey:y,onboardings:this._onboardings},{editorModel:this._editorModel,selector:"LayerOnboarding"}),this._configPanes(),this._initBinds(),this._initData()},render:function(){return this._launchOnboarding(),this.clearSubViews(),this.$el.empty(),this._initViews(),this},_launchOnboarding:function(){this._onboardingNotification.getKey(y)||this._editorModel.isEditing()||this._onboardingLauncher.launch({numberOfWidgets:this._widgetDefinitionsCollection.length,hasTimeSeries:this._widgetDefinitionsCollection.isThereTimeSeries(),hasAnimatedTimeSeries:this._widgetDefinitionsCollection.isThereTimeSeries({animated:!0})})},_initData:function(){this._hasFetchedQuerySchema()&&this._onQuerySchemaStatusChange()},_redirectIfErrors:function(){var a=this._querySchemaModel.get("query_errors");a&&a.length>0&&(this._showErrors(),this._editorModel.set({edition:!0}))},_onQuerySchemaChange:function(){this._hasFetchedQuerySchema()&&this._codemirrorModel.set({content:this._querySchemaModel.get("query")})},_onQuerySchemaStatusChange:function(){this._hasFetchedQuerySchema()&&this._columnsModel.createColumnCollection()},_hasFetchedQuerySchema:function(){return this._querySchemaModel.isFetched()},_initBinds:function(){this.listenTo(this._editorModel,"change:edition",this._onChangeEdition),this.listenTo(this._querySchemaModel,"change:query",this._onQuerySchemaChange),this.listenTo(this._querySchemaModel,"change:status",this._onQuerySchemaStatusChange),this.listenTo(this._querySchemaModel,"change:query_errors",this._showErrors),this.listenTo(this._sqlModel,"undo redo",function(){this._codemirrorModel.set("content",this._sqlModel.get("content"))}.bind(this)),this.listenTo(this._layerDefinitionModel,"change:visible",this._infoboxState)},_runQuery:function(a,b){this._querySchemaModel.set({query:a,status:"unfetched"}),this._queryGeometryModel.set({query:a}),u.showNotification({status:"loading",info:_t("notifications.sql.applying"),closable:!1});var c=d.after(2,b);this._querySchemaModel.fetch({success:c}),this._queryGeometryModel.fetch({complete:c})},_saveSQL:function(){var a=this._codemirrorModel.get("content");this._sqlModel.set("content",a),this._userActions.saveAnalysisSourceQuery(a,this._nodeModel,this._layerDefinitionModel),this._querySchemaModel.set("query_errors",[]),u.showNotification({status:"success",info:_t("notifications.sql.success"),closable:!0}),this._checkClearButton(),v.track("Applied sql",{node_id:this._nodeModel.get("id"),sql:this._nodeModel.get("query")})},_isQueryAlreadyApplied:function(a){var b=this._sqlModel.getUndoHistory(),c=d.last(b);return c&&c.content&&c.content.toLowerCase()===a.toLowerCase()},_updateVisNotification:function(){u.showNotification({status:"success",info:_t("notifications.sql.success"),closable:!0})},_defaultSQL:function(){return this._nodeModel.getDefaultQuery()},_afterAlterDataSuccess:function(){var a=this._defaultSQL();this._userActions.saveAnalysisSourceQuery(a,this._nodeModel,this._layerDefinitionModel)},_hasAnalysisApplied:function(){return"source"!==this._nodeModel.get("type")},_onChangeEdition:function(){this._infoboxState();var a=this._editorModel.get("edition"),b=a?1:0;this._collectionPane.at(b).set({selected:!0})},_configPanes:function(){var a=this,b=[{selected:!this._editorModel.get("edition"),createContentView:function(){return new h({createContentView:function(){return new j({className:"Editor-content",stackLayoutModel:a._stackLayoutModel,widgetDefinitionsCollection:a._widgetDefinitionsCollection,columnsModel:a._columnsModel,querySchemaModel:a._querySchemaModel,queryGeometryModel:a._queryGeometryModel,userActions:a._userActions,infoboxModel:a._infoboxModel,overlayModel:a._overlayModel})}})},createActionView:function(){return new f}},{selected:this._editorModel.get("edition"),createContentView:function(){return new k({layerDefinitionModel:a._layerDefinitionModel,querySchemaModel:a._querySchemaModel,codemirrorModel:a._codemirrorModel,onApplyEvent:a._parseSQL})},createActionView:function(){var b=a._hasAnalysisApplied();if(!b)return a._checkClearButton(),new o({trackModel:a._sqlModel,editorModel:a._editorModel,clearModel:a._clearSQLModel,applyButton:!0,clearButton:!0,onApplyClick:a._parseSQL,onClearClick:a._clearSQL.bind(a)})}}];this._collectionPane=new m(b)},_confirmReadOnly:function(){this._infoboxModel.set({state:""})},_initViews:function(){var a=this,b=[{state:"georeference",createContentView:function(){var a=this._layerDefinitionModel?this._layerDefinitionModel.getTableName():"",b=[_t("editor.tab-pane.layers.georeference.body",{name:a}),_t("editor.layers.georeference.manually-add")].join(" ");return p.createWithAction({type:"alert",title:_t("editor.tab-pane.layers.georeference.title"),body:b,mainAction:{label:_t("editor.layers.georeference.georeference-button")}})},mainAction:a._onGeoreferenceClicked.bind(a)},{state:"readonly",createContentView:function(){return p.createWithAction({type:"code",title:_t("editor.data.messages.sql-readonly.title"),body:_t("editor.data.messages.sql-readonly.body"),mainAction:{label:_t("editor.data.messages.sql-readonly.accept")}})},mainAction:a._confirmReadOnly.bind(a)},{state:"layer-hidden",createContentView:function(){return p.createWithAction({type:"alert",title:_t("editor.style.messages.layer-hidden.title"),body:_t("editor.style.messages.layer-hidden.body"),mainAction:{label:_t("editor.style.messages.layer-hidden.show")}})},mainAction:a._showHiddenLayer.bind(a)},{state:"no-data",createContentView:function(){return p.createInfo({type:"alert",title:_t("editor.data.messages.empty-data.title"),body:_t("editor.data.messages.empty-data.body")})}}],c=new r(b),d=new g({className:"Editor-content",editorModel:a._editorModel,infoboxModel:a._infoboxModel,infoboxCollection:c,createContentView:function(){return new l({collection:a._collectionPane})},createControlView:function(){return new n({editorModel:a._editorModel,labels:[_t("editor.data.data-toggle.values"),_t("editor.data.data-toggle.cartocss")]})},createActionView:function(){return new l({collection:a._collectionPane,createContentKey:"createActionView"})}});this.$el.append(d.render().el),this.addView(d),setTimeout(this._redirectIfErrors.bind(this),0)},_infoboxState:function(){var a=this._editorModel.get("edition"),b=this._hasAnalysisApplied();a&&b?(this._codemirrorModel.set({readonly:!0}),this._infoboxModel.set({state:"readonly"})):!a&&this._isLayerHidden()?(this._infoboxModel.set({state:"layer-hidden"}),this._overlayModel.set({visible:!0})):!a&&this._layerDefinitionModel.canBeGeoreferenced()?(this._infoboxModel.set({state:"georeference"}),this._overlayModel.set({visible:!1})):(this._codemirrorModel.set({readonly:!1}),this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1}))},_showHiddenLayer:function(){var a={shouldPreserveAutoStyle:!0};this._layerDefinitionModel.toggleVisible(),this._userActions.saveLayer(this._layerDefinitionModel,a)},_isLayerHidden:function(){return this._layerDefinitionModel.get("visible")===!1},_onGeoreferenceClicked:function(){A.addGeoreferenceAnalysis()}})},{"../../../../components/dataset/dataset-base-view":60,"../../../../components/infobox/infobox-collection":215,"../../../../components/infobox/infobox-factory":216,"../../../../components/infobox/infobox-model":219,"../../../../components/metrics/metrics-tracker":233,"../../../../components/modals/add-widgets/tablestats":394,"../../../../components/onboardings/generic/generic-onboarding-launcher":501,"../../../../components/onboardings/layers/data-onboarding/data-onboarding-view":505,"../../../../components/onboardings/layers/layer-onboarding-key":507,"../../../../components/scroll/scroll-view":530,"../../../../components/tab-pane/tab-pane-collection":538,"../../../../components/tab-pane/tab-pane-view":549,"../../../../components/toggler/toggler-view":590,"../../../../components/undo-redo/undo-redo-view":592,"../../../../components/view-options/panel-with-options-view":595,"../../../../helpers/required-opts":1097,"../../../../sql-notifications":1118,"../analyses/analyses-service.js":800,"./data-columns-model":885,"./data-content-view":888,"./data-sql-view":890,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],892:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<ul class=\"u-flex CDB-Text CDB-Size-small u-upperCase u-bSpace u-secondaryTextColor\">\n  <li class='u-rSpace--m js-null'></li>\n  <li class='js-percent'></li>\n</ul>\n<div class=\"js-category-stat\"></div>";return __p}},{underscore:"underscore"}],893:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h4 class="CDB-Text CDB-Size-huge js-formula-stat"></h4>';return __p}},{underscore:"underscore"}],894:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Text CDB-Size-small u-upperCase u-bSpace u-secondaryTextColor js-histogram-numbers"></div>\n<div class="js-histogram-stat"></div>';return __p}},{underscore:"underscore"}],895:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./stat.tpl"),g=a("../../../../helpers/utils"),h=a("./stat-category.tpl"),i=a("./stat-histogram.tpl"),j=a("./stat-formula.tpl");b.exports=e.extend({className:"StatsList",events:{"click .js-checkbox":"_onSelect","click .js-style":"_onEdit"},initialize:function(a){if(!a.statModel)throw new Error("statModel is required");if(!a.stackLayoutModel)throw new Error("StackLayoutModel is required");this._statModel=a.statModel,this._stackLayoutModel=a.stackLayoutModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this._statModel.on("change:selected",this.render,this),this.add_related_model(this._statModel)},_initViews:function(){var a=this._statModel.get("graph"),b=this._statModel.get("type");this._renderTemplate(),a&&("histogram"===b?this._showHistogram(a):"category"===b?this._showCategory(a):"formula"===b&&this._showFormula(a))},_renderTemplate:function(){this.$el.append(f({column:this._statModel.get("title"),type:this._statModel.get("column"),graph:this._statModel.get("type"),isSelected:this._statModel.get("selected")}))},_onSelect:function(){this._statModel.set("selected",!this._statModel.get("selected"))},_onEdit:function(a){a.preventDefault(),this._stackLayoutModel.goToStep(1,this._statModel.get("widget"),"widget-content")},_showCategory:function(a){if(a.stats&&a.stats.freqs)if(this.$(".js-stat").append(h()),this.$(".js-category-stat").append(a.getCategory({color:"#9DE0AD",width:262,height:10})),this.$(".js-null").text(g.formatDecimalPositions(100*a.getNullsPercentage())+_t("editor.data.stats.null")),"boolean"!==this.options.statModel.attributes.column)this.$(".js-percent").text(g.formatDecimalPositions(100*a.getPercentageInTopCategories())+_t("editor.data.stats.top-cat"));else{var b=a.getTrues();g.isNumeric(b)&&this.$(".js-percent").text(g.formatDecimalPositions(100*b)+_t("editor.data.stats.trues"))}},_showHistogram:function(a){a.stats&&(this.$(".js-stat").append(i()),this.$(".js-histogram-stat").append(a.getHistogram({color:"#9DE0AD",width:262,height:20,bins:20})),this.$(".js-histogram-numbers").text(a.getNullsPercentage()+_t("editor.data.stats.null")))},_showFormula:function(a){var b;a.stats&&(b=a.getCount(),d.isNumber(b)&&(this.$(".js-stat").append(j()),this.$(".js-formula-stat").text(b.toFixed().toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))))}})},{"../../../../helpers/utils":1102,"./stat-category.tpl":892,"./stat-formula.tpl":893,"./stat-histogram.tpl":894,"./stat.tpl":896,"backbone/core-view":1127,underscore:"underscore"}],896:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="StatsList-item">\n  <div class="u-rSpace--m">\n    <input class="CDB-Checkbox js-checkbox" type="checkbox" ',isSelected&&(__p+='checked="checked"'),__p+=' />\n    <span class="u-iBlock CDB-Checkbox-face"></span>\n  </div>\n\n  <div class="WidgetList-inner js-inner">\n    <div class="StatsList-header u-flex u-justifySpace u-alignCenter u-bSpace--m">\n      <h3 class="u-ellipsis CDB-Text CDB-Size-medium">'+(null==(__t=_t("editor.data.stats.add-widget"))?"":_.escape(__t))+"</h3>\n      ",isSelected&&(__p+='\n      <button class="StatsList-style CDB-Text CDB-Size-small js-style u-actionTextColor">\n        <div class="StatsList-arrow CDB-Shape-Arrow is-blue u-iBlock  u-rSpace--m"></div> '+(null==(__t=_t("editor.data.stats.edit"))?"":_.escape(__t))+"\n      </button>\n      "),__p+='\n    </div>\n    <div class="u-flex u-alignCenter u-bSpace">\n      <h2 class="js-title u-ellipsis CDB-Text CDB-Size-large u-rSpace--m">'+(null==(__t=column)?"":_.escape(__t))+'</h2>\n      <div class="StatsList-tag Tag Tag--outline Tag-outline--grey CDB-Text CDB-Size-small u-upperCase">'+(null==(__t=type)?"":_.escape(__t))+'</div>\n    </div>\n    <div class="js-stat"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],897:[function(a,b,c){var d=a("underscore"),e=a("../../../../components/modals/add-widgets/formula/formula-option-model"),f=a("../../../../components/modals/add-widgets/category/category-option-model"),g=a("../../../../components/modals/add-widgets/histogram/histogram-option-model"),h=a("../../../../components/modals/add-widgets/time-series/time-series-option-model"),i="cartodb_id";b.exports=function(a){return d.reduce(a,function(a,b){var c,d,j=b[0].columnModel,k=b[0].layerDefinitionModel,l=k.getTableName(),m=j.get("type"),n=j.get("name"),o=_t("editor.data.stats.geometry-fallback");return n===i?(d=k.getAnalysisDefinitionNodeModel(),d&&d.queryGeometryModel&&(o=d.queryGeometryModel.get("simple_geom")),c=new e({tuples:b,table:l,title:_t("editor.data.stats.number-of",{geometry:o}),column:j.get("type"),operation:"count",name:n}),a.push(c)):"string"===m||"boolean"===m?(c=new f({tuples:b,table:l,title:n,name:n,column:j.get("type"),aggregation:"count"}),a.push(c)):"number"===j.get("type")?(c=new g({tuples:b,table:l,title:n,name:n,column:j.get("type"),bins:10}),a.push(c)):"date"===j.get("type")&&(c=new h({tuples:b,table:l,title:n,name:n,column:j.get("type"),bins:256}),a.push(c)),a},[])}},{"../../../../components/modals/add-widgets/category/category-option-model":375,"../../../../components/modals/add-widgets/formula/formula-option-model":381,"../../../../components/modals/add-widgets/histogram/histogram-option-model":386,"../../../../components/modals/add-widgets/time-series/time-series-option-model":398,underscore:"underscore"}],898:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="CodeMirror-error">\n  <li class="CodeMirror-errorMessage u-lSpace--xl u-rSpace--xl">\n    '+(null==(__t=_t("components.codemirror.syntax-error"))?"":_.escape(__t))+". "+(null==(__t=_t("components.codemirror.line"))?"":_.escape(__t))+" "+(null==(__t=line)?"":_.escape(__t))+": <span>"+(null==(__t=message)?"":_.escape(__t))+"</span>\n  </li>\n</ul>";return __p}},{underscore:"underscore"}],899:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">'+(null==(__t=_t("editor.layers.infowindow.placeholder-geometry"))?"":_.escape(__t))+" "+(null==(__t=_t("editor.layers.georeference.manually-add"))?"":_.escape(__t))+'</h2>\n<div class="BlockList-item is-dashed no-hover is-space u-tSpace-xl">\n  <ul class="HorizontalBlockList">\n    <li class="HorizontalBlockList-item"></li>\n    <li class="HorizontalBlockList-item"></li>\n  </ul>\n\n  <button class="CDB-Button CDB-Button--primary js-georeference">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("editor.layers.georeference.georeference-button"))?"":_.escape(__t))+"</span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],900:[function(a,b,c){var d=a("backbone/core-view"),e=a("./infowindow-apply-button.tpl");b.exports=d.extend({events:{"click .js-apply":"_onApplyClick"},initialize:function(a){
if(!a.onApplyClick)throw new Error("onApplyClick is required")},render:function(){return this.$el.html(e()),this},_onApplyClick:function(){this.options.onApplyClick()}})},{"./infowindow-apply-button.tpl":901,"backbone/core-view":1127}],901:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="u-lSpace--xl CDB-Button CDB-Button--primary CDB-Button--small js-apply">\n  <span class="CDB-Text is-semibold CDB-Size-small">'+(null==(__t=_t("editor.infowindow.apply"))?"":_.escape(__t))+"</span>\n</button>\n";return __p}},{underscore:"underscore"}],902:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-selector">\n  <div class="Editor-HeaderInfo-title u-bSpace--m">\n    <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.layers.infowindow.style.title-label"))?"":_.escape(__t))+'</h2>\n  </div>\n  <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=_t("editor.layers.infowindow.style.select-style"))?"":_.escape(__t))+"</p>\n</div>\n";return __p}},{underscore:"underscore"}],903:[function(a,b,c){var d=a("./infowindow-view");b.exports=d.extend({_initTemplates:function(){this._templates=[{value:"",infowindowIcon:a("./infowindow-icons/infowindow-none.tpl"),label:_t("editor.layers.infowindow.style.none")},{value:"infowindow_light",infowindowIcon:a("./infowindow-icons/infowindow-light.tpl"),label:_t("editor.layers.infowindow.style.infowindow_light")},{value:"infowindow_dark",infowindowIcon:a("./infowindow-icons/infowindow-dark.tpl"),label:_t("editor.layers.infowindow.style.infowindow_dark")},{value:"infowindow_color",infowindowIcon:a("./infowindow-icons/infowindow-color.tpl"),label:_t("editor.layers.infowindow.style.infowindow_color")},{value:"infowindow_header_with_image",infowindowIcon:a("./infowindow-icons/infowindow-image.tpl"),label:_t("editor.layers.infowindow.style.infowindow_header_with_image")}]}})},{"./infowindow-icons/infowindow-color.tpl":916,"./infowindow-icons/infowindow-dark.tpl":917,"./infowindow-icons/infowindow-image.tpl":918,"./infowindow-icons/infowindow-light.tpl":919,"./infowindow-icons/infowindow-none.tpl":920,"./infowindow-view":925}],904:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./infowindow-select-view"),g=a("./infowindow-items-view"),h=a("../../../../components/custom-carousel/custom-carousel-collection"),i=a("../../panel-loading-template.tpl"),j=a("../../../components/overlay/overlay-view");b.exports=e.extend({initialize:function(a){if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.templates)throw new Error("templates is required");if(!a.overlayModel)throw new Error("overlayModel is required");if(!a.editorModel)throw new Error("editorModel is required");this._querySchemaModel=a.querySchemaModel,this._layerDefinitionModel=a.layerDefinitionModel,this._overlayModel=a.overlayModel,this._templates=a.templates,this._editorModel=a.editorModel,this._initCollection(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),"fetched"===this._querySchemaModel.get("status")?this._initViews():this._renderStateless(),this._renderOverlay(),this},_renderStateless:function(){this.$el.append(i())},_renderOverlay:function(){var a=new j({overlayModel:this._overlayModel});this.addView(a),this.$el.append(a.render().el)},_initCollection:function(){this._templatesCollection=new h(d.map(this._templates,function(a){return{selected:this.model.get("template_name")===a.value,val:a.value,label:a.label,template:function(){return a.infowindowIcon&&a.infowindowIcon()||a.value}}},this))},_initBinds:function(){this.model.bind("change:template_name",this._renderItems,this),this.model.bind("change:template",this._updateEditor,this),"fetched"!==this._querySchemaModel.get("status")&&(this._querySchemaModel.bind("change:status",this.render,this),this._querySchemaModel.fetch())},_updateEditor:function(){this._editorModel.set("disabled",!this.model.hasTemplate())},_initViews:function(){var a=new f({model:this.model,templatesCollection:this._templatesCollection});this.addView(a),this.$el.append(a.render().el),this._renderItems()},_renderItems:function(){this._itemsView&&(this.removeView(this._itemsView),this._itemsView.clean()),this._itemsView=new g({model:this.model,querySchemaModel:this._querySchemaModel,layerDefinitionModel:this._layerDefinitionModel,hasValidTemplate:!!this._checkValidTemplate()}),this.addView(this._itemsView),this.$el.append(this._itemsView.render().el)},_checkValidTemplate:function(){var a=this._templatesCollection.find(function(a){return this.model.get("template_name")===a.get("val")},this);return a&&""!==a.get("val")}})},{"../../../../components/custom-carousel/custom-carousel-collection":40,"../../../components/overlay/overlay-view":694,"../../panel-loading-template.tpl":996,"./infowindow-items-view":921,"./infowindow-select-view":923,"backbone/core-view":1127,underscore:"underscore"}],905:[function(a,b,c){var d=a("./infowindow-description.tpl"),e=a("backbone/core-view");b.exports=e.extend({events:{"click .js-toggle":"_toggle"},initialize:function(a){if("undefined"==typeof a.namesCount)throw new Error("namesCount has to be defined");this._namesCount=a.namesCount},render:function(){var a=this._namesCount,b=this.model.fieldCount();return this.$el.html(d({allSelected:b&&b===a,noneSelected:!b,selectedFields:b})),this},_toggle:function(){this.trigger("toggle")}})},{"./infowindow-description.tpl":906,"backbone/core-view":1127}],906:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifySpace u-alignCenter">\n  <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-textInfo">\n    ',__p+=noneSelected?"\n      None selected\n    ":"\n      "+(null==(__t=allSelected?"All selected":selectedFields+" selected")?"":_.escape(__t))+"\n    ",__p+='\n  </p>\n \n  <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor js-toggle">',__p+=allSelected?"none":"all",__p+="</button>\n</div>";return __p}},{underscore:"underscore"}],907:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./infowindow-field.tpl");b.exports=e.extend({tagName:"li",className:"js-field Infowindow-listFieldItem",events:{"click .js-checkbox":"toggle","keyup .js-input":"_onKeyUp","blur .js-input":"_onBlur"},initialize:function(a){if(!a.layerInfowindowModel)throw new Error("layerInfowindowModel is required");this._layerInfowindowModel=a.layerInfowindowModel,this.fieldName=a.field.name,this.fieldTitle=a.field.title,this.position=a.position,this._layerInfowindowModel.bind("change:fields",this.render,this),this.model=new d.Model({title:this._layerInfowindowModel.getAlternativeName(this.fieldName)||this.fieldName,selected:!!this._layerInfowindowModel.containsField(this.fieldName)}),this.model.bind("change:title",this._updateTitle,this),this.model.bind("change:selected",this._updateSelected,this)},_onBlur:function(a){var b=this.$el.find(".js-input").val();b=this._stripHTML(b),this.model.set("title",b)},_updateTitle:function(){var a=this.model.get("title");a=this._stripHTML(a),this._layerInfowindowModel.setAlternativeName(this.fieldName,a);var b=this._isBlank(a);this._layerInfowindowModel.setFieldProperty(this.fieldName,"title",!b)},_onKeyUp:function(a){if(13===a.keyCode){var b=this.$el.find(".js-input").val();b=this._stripHTML(b),this.model.set("title",b)}},_isBlank:function(a){return!a||/^\s*$/.test(a)},_stripHTML:function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a&&"string"==typeof a?a.replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""}):""},render:function(){return this.$el.html(f({name:this.fieldName,title:this._layerInfowindowModel.getFieldProperty(this.fieldName,"title"),alternativeName:this._layerInfowindowModel.getAlternativeName(this.fieldName),isSelected:!!this._layerInfowindowModel.containsField(this.fieldName)})),this.$el.attr("data-view-cid",this.cid),this},toggle:function(a){return a&&a.preventDefault(),this.model.set("selected",!this.model.get("selected")),!1},_updateSelected:function(a){this._layerInfowindowModel.containsField(this.fieldName)?(this.model.set("title",null),this._layerInfowindowModel.removeField(this.fieldName)):this._layerInfowindowModel.addField(this.fieldName,this.position)}})},{"./infowindow-field.tpl":908,backbone:"backbone","backbone/core-view":1127}],908:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Text CDB-Fieldset u-tSpace--m">\n  <div class="CDB-Legend CDB-Legend--big u-ellipsis CDB-Text CDB-Size-medium u-rSpace--m">\n    <div class="Infowindow-listFieldsOrder CDB-Shape u-iblock u-malign">\n      <div class="CDB-Shape-rectsHandle is-small">\n        <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-first"></div>\n        <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-second"></div>\n        <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-third"></div>\n      </div>\n    </div>\n    <input class="CDB-Checkbox js-checkbox" type="checkbox" ',isSelected&&(__p+='checked="checked"'),__p+='">\n    <span class="u-iBlock CDB-Checkbox-face u-rSpace"></span>\n    <label class="u-rSpace--m" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</label>\n  </div>\n  <input type="text" name="text" placeholder=\'"'+(null==(__t=name)?"":_.escape(__t))+'"\' value="',isSelected?(__p+="",title&&(__p+="",__p+=alternativeName?""+(null==(__t=alternativeName)?"":_.escape(__t)):""+(null==(__t=name)?"":_.escape(__t)),__p+=""),__p+=""):__p+=""+(null==(__t=name)?"":_.escape(__t)),__p+='" class="CDB-InputText js-input" ',isSelected||(__p+="disabled"),__p+=">\n</div>\n";return __p}},{underscore:"underscore"}],909:[function(a,b,c){var d=a("./infowindow-field-view.js"),e=a("./infowindow-description-view.js"),f=a("./infowindow-fields.tpl"),g=a("backbone"),h=a("backbone/core-view"),i=a("underscore"),j=a("jquery");a("jquery-ui"),b.exports=h.extend({initialize:function(a){if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");this._querySchemaModel=a.querySchemaModel,this._layerDefinitionModel=a.layerDefinitionModel,this._sortedFields=new g.Collection,this._sortedFields.comparator=function(a){return a.get("position")},this._initBinds()},_initBinds:function(){this.model.bind("remove:fields",this._renderDescription,this),this.model.bind("add:fields",this._renderDescription,this)},render:function(){return this._destroySortable(),this.clearSubViews(),this.$el.html(f()),this._renderDescription(),this._renderFields(),this._initSortable(),this._renderSelectAll(),this._storeSortedFields(),this},_renderDescription:function(){this._fieldsDescriptionView&&(this.removeView(this._fieldsDescriptionView),this._fieldsDescriptionView.clean()),this._fieldsDescriptionView=new e({model:this.model,namesCount:this._getColumnNames().length}),this._fieldsDescriptionView.bind("toggle",this.manageAll,this),this.addView(this._fieldsDescriptionView),this.$(".js-description").append(this._fieldsDescriptionView.render().el),this._renderSelectAll()},_renderSelectAll:function(){this.selectedAll=this._allFieldsSelected()},_allFieldsSelected:function(){var a=this,b=!0;return i.each(this._getColumnNames(),function(c){a.model.containsField(c)||(b=!1)}),b},manageAll:function(a){this.selectedAll?this._unselectAll():this._selectAll()},_selectAll:function(){var a=this,b=this._sortedFields.map(function(a){return a.get("name")}),c=[];i.each(b,function(b){a.model.containsField(b)||c.push(a.model._addField(b))}),j.when.apply(j,c).then(function(){a.model.sortFields(),a.model.trigger("add:fields"),a.model.trigger("change:fields",a.model,a.model.get("fields")),a.model.trigger("change",a.model),a._toggleSelectAll()})},_unselectAll:function(){this.model.clearFields(),this.model.trigger("change:fields"),this._toggleSelectAll()},_toggleSelectAll:function(){this.selectedAll=!this.selectedAll,this._renderDescription()},_initSortable:function(){this.$(".js-fields").sortable({axis:"y",items:"> li",opacity:.8,update:this._onSortableFinish.bind(this),forcePlaceholderSize:!1})},_destroySortable:function(){this.$(".js-fields").data("ui-sortable")&&this.$(".js-fields").sortable("destroy")},_onSortableFinish:function(){var a=this;this._sortedFields.reset([]),this.$(".js-fields > .js-field").each(function(b,c){var d=a._subviews[j(c).data("view-cid")];a.model.setFieldProperty(d.fieldName,"position",b),d.position=b,a._sortedFields.add({name:d.fieldName,position:b})})},_getSortedColumnNames:function(){var a=this,b=this._getColumnNames();return a.model.fieldCount()>0&&b.sort(function(b,c){var d=a.model.getFieldPos(b),e=a.model.getFieldPos(c);return d-e}),b},_storeSortedFields:function(){var a=this;this._sortedFields.reset([]);var b=this._getSortedColumnNames();i(b).each(function(b,c){a._sortedFields.add({name:b,position:c})})},_getColumnNames:function(){var a=this,b=this._querySchemaModel.columnsCollection.filter(function(b){return!i.contains(a.model.SYSTEM_COLUMNS,b.get("name"))}),c=[];return i.each(b,function(a){c.push(a.get("name"))}),c},_renderFields:function(){var a=this,b=this._getSortedColumnNames();i(b).each(function(b,c){var e=a.model.getFieldProperty(b,"title"),f=new d({layerInfowindowModel:a.model,field:{name:b,title:e},position:a.model.getFieldPos(b)});a.addView(f),a.$(".js-fields").append(f.render().el)})},clean:function(){this._destroySortable(),h.prototype.clean.apply(this)}})},{"./infowindow-description-view.js":905,"./infowindow-field-view.js":907,"./infowindow-fields.tpl":910,backbone:"backbone","backbone/core-view":1127,jquery:"jquery","jquery-ui":1128,underscore:"underscore"}],910:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-description"></div>\n<ul class="js-fields Infowindow-listFields"></ul>\n';return __p}},{underscore:"underscore"}],911:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=350;b.exports=d.Model.extend({initialize:function(a,b){if(!b.layerInfowindowModel)throw new Error("layerInfowindowModel is required");this._layerInfowindowModel=b.layerInfowindowModel,this._generateSchema(),this._initBinds()},_initBinds:function(){this.bind("change",e.debounce(this._onChange.bind(this),f),this)},_onChange:function(){var a=this;e.each(this.changed,function(b,c){a._layerInfowindowModel.set(c,b)})},_generateSchema:function(){this.schema={};var a=this._layerInfowindowModel.get("template_name");""!==a&&"none"!==a&&this._layerInfowindowModel.has("width")&&(this.schema.width={type:"Number",title:_t("editor.layers.infowindow.style.window-size"),validators:["required",{type:"interval",min:200,max:400}]}),"infowindow_color"===a&&(this.schema.headerColor={type:"Fill",title:_t("editor.layers.infowindow.style.header-color"),options:[],dialogMode:"float",editorAttrs:{color:{hidePanes:["value"]}},validators:["required"]})}})},{backbone:"backbone",underscore:"underscore"}],912:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./infowindow-form.tpl"),g=a("./infowindow-form-model");b.exports=e.extend({render:function(){return this.clearSubViews(),this.$el.html(f()),this._generateForms(),this._initBinds(),this},_initBinds:function(){this.model.bind("change:template_name",this._generateForms,this)},_generateForms:function(){this._formView&&this._formView.remove(),this._formModel=new g({width:this.model.get("width"),headerColor:this.model.get("headerColor")},{layerInfowindowModel:this.model}),this._formView=new d.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$(".js-form").append(this._formView.render().$el)},clean:function(){this._formView&&this._formView.remove()}})},{"./infowindow-form-model":911,"./infowindow-form.tpl":913,backbone:"backbone","backbone/core-view":1127}],913:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-form"></div>\n';return __p}},{underscore:"underscore"}],914:[function(a,b,c){var d=a("./infowindow-view");b.exports=d.extend({_initTemplates:function(){this._templates=[{value:"",infowindowIcon:a("./tooltip-icons/tooltip-none.tpl"),label:_t("editor.layers.infowindow.style.none")},{value:"tooltip_light",infowindowIcon:a("./tooltip-icons/tooltip-light.tpl"),label:_t("editor.layers.infowindow.style.infowindow_light")},{value:"tooltip_dark",infowindowIcon:a("./tooltip-icons/tooltip-dark.tpl"),label:_t("editor.layers.infowindow.style.infowindow_dark")}]}})},{"./infowindow-view":925,"./tooltip-icons/tooltip-dark.tpl":929,"./tooltip-icons/tooltip-light.tpl":930,"./tooltip-icons/tooltip-none.tpl":931}],915:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../components/code-mirror/code-mirror-view"),f=a("./code-mirror-error.tpl");b.exports=d.extend({className:"Editor-content",initialize:function(a){if(!a.codemirrorModel)throw new Error("codemirrorModel is required");if(!a.onApplyEvent)throw new Error("onApplyEvent");this._codemirrorModel=a.codemirrorModel},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){this.codeMirrorView=new e({model:this._codemirrorModel,tip:_t("editor.infowindow.code-mirror.save"),errorTemplate:f}),this.codeMirrorView.bind("codeSaved",this._triggerCodeSaved,this),this.addView(this.codeMirrorView),this.$el.append(this.codeMirrorView.render().el)},_triggerCodeSaved:function(a,b){this.options.onApplyEvent&&this.options.onApplyEvent()}})},{"../../../../components/code-mirror/code-mirror-view":27,"./code-mirror-error.tpl":898,"backbone/core-view":1127}],916:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="58px" height="38px" viewBox="608 430 58 38" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="PopUp" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(608.000000, 431.000000)">\n        <path d="M1,2.00174332 C1,0.89621101 1.90230818,0 2.99306965,0 L55.0069304,0 C56.1076723,0 57,0.889261723 57,2.00174332 L57,29.9982567 C57,31.103789 56.1032859,32 55.0073354,32 L18.4262695,32 L9,36 L9,32 L2.99810135,32 C1.89458045,32 1,31.1107383 1,29.9982567 L1,2.00174332 L1,2.00174332 Z" id="Rectangle-2087" stroke="#EEEEEE" fill="#FFFFFF"></path>\n        <path d="M15,4.35207426e-14 L10.3214747,12 L1,12 L1,3.48144531 C1,3.48144531 0.787841764,1.33203125 1.49902344,0.666015625 C2.21020511,4.35207426e-14 3.82543945,4.35207426e-14 3.82543945,4.35207426e-14 L15,4.35207426e-14 Z" id="Rectangle-678" fill="#9AE0AA"></path>\n        <polygon id="Rectangle-678" fill="#F4F1DE" points="27 0 22.3214747 12 9 12 13.6785253 0"></polygon>\n        <polygon id="Rectangle-678" fill="#E37E62" points="39 0 34.3214747 12 21 12 25.6785253 0"></polygon>\n        <polygon id="Rectangle-678" fill="#3D3D5B" points="51 0 46.3214747 12 33 12 37.6785253 0"></polygon>\n        <path d="M54.2199707,0 C54.2199707,0 56.0734097,0.047231609 56.5109863,0.508300759 C57.0344286,1.05984554 57.1030273,3.0378418 57.1030273,3.0378418 L57.1030273,12 L46,12 L50.6785253,0 L54.2199707,0 Z" id="Rectangle-678" fill="#F2CF8F"></path>\n        <rect id="Rectangle-678" fill="#FFFFFF" opacity="0.32" x="7" y="4" width="36" height="4"></rect>\n        <rect id="Rectangle-679" fill="#DDDDDD" x="6" y="17" width="45" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="6" y="21" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="6" y="25" width="19" height="2"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],917:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="36px" viewBox="512 431 56 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="PopUp" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(512.000000, 431.000000)">\n        <path d="M0,2.00174332 C0,0.89621101 0.902308181,0 1.99306965,0 L54.0069304,0 C55.1076723,0 56,0.889261723 56,2.00174332 L56,29.9982567 C56,31.103789 55.1032859,32 54.0073354,32 L17.4262695,32 L8,36 L8,32 L1.99810135,32 C0.894580447,32 0,31.1107383 0,29.9982567 L0,2.00174332 L0,2.00174332 Z" id="Rectangle-2087" fill="#2E3C43"></path>\n        <rect id="Rectangle-679" fill="#636D72" x="5" y="15" width="45" height="2"></rect>\n        <rect id="Rectangle-680" fill="#636D72" x="5" y="19" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#636D72" x="5" y="23" width="19" height="2"></rect>\n        <rect id="Rectangle-680" fill="#636D72" x="5" y="11" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#636D72" x="5" y="7" width="36" height="2"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],918:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="58px" height="38px" viewBox="688 430 58 38" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="IMG" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(689.000000, 431.000000)">\n        <path d="M0,2.00174332 C0,0.89621101 0.902308181,0 1.99306965,0 L54.0069304,0 C55.1076723,0 56,0.889261723 56,2.00174332 L56,29.9982567 C56,31.103789 55.1032859,32 54.0073354,32 L17.4262695,32 L8,36 L8,32 L1.99810135,32 C0.894580447,32 0,31.1107383 0,29.9982567 L0,2.00174332 L0,2.00174332 Z" id="Rectangle-2087" stroke="#EEEEEE" fill="#FFFFFF"></path>\n        <path d="M54.0069304,0 C55.1076723,0 56,0.901950359 56,2.0085302 L56,12 L0,12 L0,2.0085302 C0,0.899249601 0.902308181,0 1.99306965,0 L54.0069304,0 Z" id="Rectangle-678" fill="#CBCED0"></path>\n        <rect id="Rectangle-678" fill="#FFFFFF" opacity="0.32" x="6" y="4" width="28" height="4"></rect>\n        <rect id="Rectangle-679" fill="#DDDDDD" x="5" y="17" width="45" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="5" y="21" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="5" y="25" width="19" height="2"></rect>\n        <path d="M43.6,6 L46,8 L49.6,2 L52,10 L40,10 L43.6,6 Z M41,4 C41.5522847,4 42,3.55228475 42,3 C42,2.44771525 41.5522847,2 41,2 C40.4477153,2 40,2.44771525 40,3 C40,3.55228475 40.4477153,4 41,4 Z" id="Rectangle-5896" fill="#FFFFFF"></path>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],919:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="58px" height="38px" viewBox="429 431 58 38" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="PopUp-Copy" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(430.000000, 432.000000)">\n        <path d="M0,2.00174332 C0,0.89621101 0.902308181,0 1.99306965,0 L54.0069304,0 C55.1076723,0 56,0.889261723 56,2.00174332 L56,29.9982567 C56,31.103789 55.1032859,32 54.0073354,32 L17.4262695,32 L8,36 L8,32 L1.99810135,32 C0.894580447,32 0,31.1107383 0,29.9982567 L0,2.00174332 L0,2.00174332 Z" id="Rectangle-2087" stroke="#EEEEEE" fill="#FFFFFF"></path>\n        <rect id="Rectangle-679" fill="#DDDDDD" x="4" y="14" width="45" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="4" y="18" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="4" y="22" width="19" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="4" y="10" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="4" y="6" width="36" height="2"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],920:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-altTextColor u-upperCase">None</p>';return __p}},{underscore:"underscore"}],921:[function(a,b,c){var d=a("backbone/core-view"),e=a("./infowindow-items.tpl"),f=a("./infowindow-fields-view");b.exports=d.extend({initialize:function(a){if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if("undefined"==typeof a.hasValidTemplate)throw new Error("hasValidTemplate has to be defined");this._querySchemaModel=a.querySchemaModel,this._layerDefinitionModel=a.layerDefinitionModel,this._hasValidTemplate=a.hasValidTemplate},render:function(){return this.clearSubViews(),this.$el.empty(),this._hasValidTemplate&&this._initViews(),this},_initViews:function(){return this.$el.html(e({title:_t("editor.layers.infowindow.items.title-label")})),this._infowindowFieldsView&&(this.removeView(this._infowindowFieldsView),this._infowindowFieldsView.clean()),this._infowindowFieldsView=new f({model:this.model,querySchemaModel:this._querySchemaModel,layerDefinitionModel:this._layerDefinitionModel}),this.$(".js-content").append(this._infowindowFieldsView.render().$el),this.addView(this._infowindowFieldsView),this}})},{"./infowindow-fields-view":909,"./infowindow-items.tpl":922,"backbone/core-view":1127}],922:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n\n  <div class="Editor-HeaderInfo-Inner CDB-Text">\n    <div class="Editor-HeaderInfo-Title u-bSpace--m">\n      <h2 class="Editor-HeaderInfo-TitleText CDB-Text CDB-Size-large">'+(null==(__t=_t("editor.layers.infowindow.items.title-label"))?"":_.escape(__t))+'</h2>\n    </div>\n\n    <div class="js-content"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],923:[function(a,b,c){var d=a("backbone/core-view"),e=a("./infowindow-select.tpl"),f=a("../../../../components/carousel-form-view"),g=a("./infowindow-form-view");b.exports=d.extend({initialize:function(a){if(!a.templatesCollection)throw new Error("templatesCollection is required");this._templatesCollection=a.templatesCollection,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(e()),this._renderCarousel(),this._renderForm(),this},_initBinds:function(){this.model.bind("change:headerColor",this._onColorChange,this)},_onColorChange:function(){this._setTemplate(this.model.get("template_name"))},_checkValidTemplate:function(){var a=this._templatesCollection.find(function(a){return this.model.get("template_name")===a.get("val")},this);return a&&""!==a.get("val")},_setNoneTemplate:function(){var a=this._templatesCollection.find(function(a){return""===a.get("val")},this);a.set("selected",!0)},_setTemplate:function(a){this.model.setTemplate(a)},_renderCarousel:function(){this._checkValidTemplate()||this._setNoneTemplate(),this._templatesCollection.bind("change:selected",function(a){if(a.get("selected")){var b=a.getValue();this._setTemplate(b)}},this),this.add_related_model(this._templatesCollection);var b=new f({collection:this._templatesCollection,template:a("./infowindow-carousel.tpl")});this.addView(b),this.$(".js-select").append(b.render().el)},_renderForm:function(){this._infowindowFormView&&(this.removeView(this._infowindowFormView),this._infowindowFormView.clean()),this._infowindowFormView=new g({model:this.model}),this.addView(this._infowindowFormView),this.$(".js-select").append(this._infowindowFormView.render().el)}})},{"../../../../components/carousel-form-view":23,"./infowindow-carousel.tpl":902,"./infowindow-form-view":912,"./infowindow-select.tpl":924,"backbone/core-view":1127}],924:[function(a,b,c){arguments[4][736][0].apply(c,arguments)},{dup:736,underscore:"underscore"}],925:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("underscore"),g=a("../../../../components/view-options/panel-with-options-view"),h=a("./infowindow-html-view"),i=a("./infowindow-content-view"),j=a("../../../../components/scroll/scroll-view"),k=a("../../../../components/tab-pane/tab-pane-view"),l=a("../../../../components/tab-pane/tab-pane-collection"),m=a("../../../../components/toggler/toggler-view"),n=a("./infowindow-apply-button-view"),o=a("../../../../components/infobox/infobox-factory"),p=a("../../../../components/infobox/infobox-model"),q=a("../../../../components/infobox/infobox-collection"),r=a("cartodb.js");b.exports=e.extend({initialize:function(a){if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.userActions)throw new Error("userActions is required");if(!a.editorModel)throw new Error("editorModel is required");this._layerDefinitionModel=a.layerDefinitionModel,this._userActions=a.userActions,this._editorModel=a.editorModel,this._initModels(),this._initBinds(),this._configPanes(),this._initTemplates()},_initModels:function(){var a;a=this.model.isCustomTemplate()?this.model.get("template"):this._getTemplateContent(),this._codemirrorModel=new d.Model({content:a}),this._infoboxModel=new p({state:this._isLayerHidden()?"layer-hidden":""}),this._overlayModel=new d.Model({visible:this._isLayerHidden()}),this._editorModel.set({edition:this.model.isCustomTemplate(),disabled:!this.model.hasTemplate()&&!this.model.isCustomTemplate()})},_setContent:function(){if(!this._editorModel.get("edition")){var a=this._getTemplateContent();this._codemirrorModel.set({content:a})}},_initBinds:function(){this.model.bind("change",this._onChange.bind(this),this.model),this.listenTo(this._editorModel,"change:edition",this._onChangeEdition),this.add_related_model(this._editorModel),this.listenTo(this._layerDefinitionModel,"change:visible",this._infoboxState),this.add_related_model(this._layerDefinitionModel)},_saveInfowindowHTML:function(){var a=this._codemirrorModel.get("content"),b=this._getErrors(a);0===b.length?(this._clearErrors(),this.model.get("old_fields")||this.model.saveFields(),this.model.get("old_template_name")||this.model.set("old_template_name",this.model.get("template_name")),this.model.set({template:a,template_name:""}),this._userActions.saveLayer(this._layerDefinitionModel)):this._parseErrors(b)},_getErrors:function(a){try{var b=new r.core.Template({template:a,type:"mustache"});return b.compile()(),""===a?[{line:1,message:_t("editor.infowindow.code-mirror.errors.empty")}]:[]}catch(a){return a}},_showErrors:function(a){var b=this._querySchemaModel.get("query_errors");this._codemirrorModel.set("errors",this._parseErrors(b));
},_parseErrors:function(a){return a.map(function(a){return{line:a.line,message:a.message.split("\n\n")[1]}})},_clearErrors:function(){this._codemirrorModel.set({errors:[]})},_getTemplateContent:function(){var a=[],b=this.model.get("alternative_names");f.each(this.model.get("fields"),function(c,d){var e=f.clone(c);e.position=d,b&&b[e.name]&&(e.alternative_name=b[e.name]),a.push(e)});var c=new r.core.Template({template:this.model.getTemplate(),type:"mustache"});return c.render({content:{fields:a}})},_configPanes:function(){var a=this,b=[{selected:!a.model.isCustomTemplate(),createContentView:function(){return new j({createContentView:function(){return new i(f.extend(a.options,{templates:a._templates,overlayModel:a._overlayModel}))}})},createActionView:function(){return new e}},{selected:a.model.isCustomTemplate(),createContentView:function(){return new h({onApplyEvent:a._saveInfowindowHTML.bind(a),codemirrorModel:a._codemirrorModel})},createActionView:function(){return new n({onApplyClick:a._saveInfowindowHTML.bind(a)})}}];this._collectionPane=new l(b)},_onChange:function(){this._userActions.saveLayer(this._layerDefinitionModel),this._setContent()},_onChangeEdition:function(){this._infoboxState();var a=this._editorModel.get("edition"),b=a?1:0;this._collectionPane.at(b).set({selected:!0})},_cancelHTML:function(){this.model.setDefault(),this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1})},_isLayerHidden:function(){return this._layerDefinitionModel.get("visible")===!1},_infoboxState:function(){var a=this._editorModel.get("edition"),b=this.model.isCustomTemplate();!a&&b?(this._infoboxModel.set({state:"confirm"}),this._overlayModel.set({visible:!0})):!a&&this._isLayerHidden()?(this._infoboxModel.set({state:"layer-hidden"}),this._overlayModel.set({visible:!0})):(this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1}))},_showHiddenLayer:function(){var a={shouldPreserveAutoStyle:!0};this._layerDefinitionModel.toggleVisible(),this._userActions.saveLayer(this._layerDefinitionModel,a)},render:function(){this.clearSubViews();var a=this,b=[{state:"confirm",createContentView:function(){return o.createWithAction({type:"alert",title:_t("editor.infowindow.messages.custom-html-applied.title"),body:_t("editor.infowindow.messages.custom-html-applied.body"),mainAction:{label:_t("editor.infowindow.messages.custom-html-applied.accept")}})},mainAction:a._cancelHTML.bind(a)},{state:"layer-hidden",createContentView:function(){return o.createWithAction({type:"alert",title:_t("editor.infowindow.messages.layer-hidden.title"),body:_t("editor.infowindow.messages.layer-hidden.body"),mainAction:{label:_t("editor.infowindow.messages.layer-hidden.show")}})},mainAction:a._showHiddenLayer.bind(a)}],c=new q(b),d=new g({className:"Editor-content",editorModel:a._editorModel,infoboxModel:a._infoboxModel,infoboxCollection:c,createContentView:function(){return new k({collection:a._collectionPane})},createControlView:function(){return new m({editorModel:a._editorModel,labels:[_t("editor.infowindow.html-toggle.values"),_t("editor.infowindow.html-toggle.html")],isDisableable:!0})},createActionView:function(){return new k({collection:a._collectionPane,createContentKey:"createActionView"})}});return this.$el.append(d.render().el),this.addView(d),this},clean:function(){this.model.unbind("change",null,this.model),e.prototype.clean.apply(this)}})},{"../../../../components/infobox/infobox-collection":215,"../../../../components/infobox/infobox-factory":216,"../../../../components/infobox/infobox-model":219,"../../../../components/scroll/scroll-view":530,"../../../../components/tab-pane/tab-pane-collection":538,"../../../../components/tab-pane/tab-pane-view":549,"../../../../components/toggler/toggler-view":590,"../../../../components/view-options/panel-with-options-view":595,"./infowindow-apply-button-view":900,"./infowindow-content-view":904,"./infowindow-html-view":915,backbone:"backbone","backbone/core-view":1127,"cartodb.js":"cartodb.js",underscore:"underscore"}],926:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./infowindow-click-view"),h=a("./infowindow-hover-view"),i=a("../../../../components/tab-pane/create-text-labels-tab-pane"),j=a("../../../tab-pane-submenu.tpl"),k=a("./popups-placeholder.tpl"),l=a("./georeference-placeholder.tpl"),m=a("../../panel-loading-template.tpl"),n=a("../../../../helpers/required-opts"),o=a("../../../../components/infobox/infobox-factory"),p=a("../../../../components/infobox/infobox-model"),q=a("../../../../components/infobox/infobox-collection"),r=a("../../../../components/view-options/panel-with-options-view"),s=a("../../../../components/view-factory"),t=a("./panel-with-options.tpl"),u=a("../../../components/overlay/overlay-view"),v=a("../../../../helpers/fetch-all-query-objects"),w=["configModel","userActions","layerDefinitionModel","queryGeometryModel","querySchemaModel","queryRowsCollection","editorModel"];b.exports=f.extend({initialize:function(a){n(a,w,this),this.render=this.render.bind(this),this._layerInfowindowModel=this._layerDefinitionModel.infowindowModel,this._layerTooltipModel=this._layerDefinitionModel.tooltipModel,this._initModels(),this._initBinds(),this._fetchAllQueryObjectsIfNecessary()},render:function(){return this.clearSubViews(),this.$el.empty(),this._queryGeometryModel.isFetching()?this._renderLoading():this._layerInfowindowModel&&this._hasColumns()&&this._canAddInfowindow()&&this._queryGeometryModel.hasValue()?(this._initViews(),this._bindEvents()):this._renderPlaceholder(),this._renderOverlay(),this},_renderOverlay:function(){var a=new u({overlayModel:this._overlayModel});this.addView(a),this.$(".js-content").append(a.render().el)},_initModels:function(){this._infoboxModel=new p({state:this._isLayerHidden()?"layer-hidden":""}),this._overlayModel=new e.Model({visible:this._isLayerHidden()}),this._editorModel.set({edition:!1})},_isLayerHidden:function(){return this._layerDefinitionModel.get("visible")===!1},_initBinds:function(){this.listenTo(this._querySchemaModel,"change:status",this._onStatusChanged),this.listenTo(this._queryGeometryModel,"change:status",this._onStatusChanged),this.listenTo(this._queryRowsCollection.statusModel,"change:status",this._onStatusChanged),this.listenTo(this._editorModel,"change:edition",this._changeStyle)},_fetchAllQueryObjectsIfNecessary:function(){v({queryRowsCollection:this._queryRowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel})},_onStatusChanged:function(){v({queryRowsCollection:this._queryRowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel},this.render)},_hasColumns:function(){if(!this._querySchemaModel.isFetched())return!1;var a=this._querySchemaModel.columnsCollection.models,b=d(a).filter(function(a){return!d.contains(this._layerInfowindowModel.SYSTEM_COLUMNS,a.get("name"))},this);return b.length},_canAddInfowindow:function(){var a=this._layerDefinitionModel.styleModel;return a&&!a.isAggregatedType()&&!a.isAnimation()},_renderPlaceholder:function(){this._layerInfowindowModel&&!this._hasColumns()?this.$el.append(k({placeholder:_t("editor.layers.infowindow.placeholder-columns-text")})):this._queryGeometryModel.hasValue()?this.$el.append(k({placeholder:_t("editor.layers.infowindow.placeholder-interactivity-text")})):this._layerDefinitionModel.canBeGeoreferenced()?this._renderGeoreferencePlaceholder():this.$el.append(k({placeholder:_t("editor.layers.infowindow.placeholder-geometry")}))},_renderGeoreferencePlaceholder:function(){var a=this,b=[{state:"layer-hidden",createContentView:function(){return o.createWithAction({type:"alert",title:_t("editor.infowindow.messages.layer-hidden.title"),body:_t("editor.infowindow.messages.layer-hidden.body"),mainAction:{label:_t("editor.infowindow.messages.layer-hidden.show")}})},mainAction:a._showHiddenLayer.bind(a)}],c=new q(b),d=new r({template:t,className:"Editor-content",editorModel:a._editorModel,infoboxModel:a._infoboxModel,infoboxCollection:c,createContentView:function(){return s.createByHTML(l())}});this.$el.append(d.render().el),this.addView(d)},_renderLoading:function(){this.$el.append(m())},_initViews:function(){var a=this,b=_t("editor.layers.infowindow.style.none"),c=_t("editor.layers.tooltip.style.none");this._layerInfowindowModel.isCustomTemplate()?b=_t("editor.layers.infowindow.style.custom"):this._layerInfowindowModel.hasTemplate()&&(b=_t("editor.layers.infowindow.style."+this._layerInfowindowModel.get("template_name"))),this._layerTooltipModel.isCustomTemplate()?c=_t("editor.layers.tooltip.style.custom"):this._layerTooltipModel.hasTemplate()&&(c=_t("editor.layers.tooltip.style."+this._layerTooltipModel.get("template_name")));var d=[{name:"click",label:_t("editor.layers.infowindow-menu-tab-pane-labels.click"),createContentView:function(){return new g({model:a._layerInfowindowModel,className:"Editor-content",querySchemaModel:a._querySchemaModel,userActions:a._userActions,editorModel:a._editorModel,layerDefinitionModel:a._layerDefinitionModel})},selectedChild:b},{name:"hover",label:_t("editor.layers.infowindow-menu-tab-pane-labels.hover"),createContentView:function(){return new h({className:"Editor-content",querySchemaModel:a._querySchemaModel,userActions:a._userActions,editorModel:a._editorModel,model:a._layerTooltipModel,layerDefinitionModel:a._layerDefinitionModel})},selectedChild:c}],e={tabPaneOptions:{template:j,tabPaneItemOptions:{tagName:"li",className:"CDB-NavSubmenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavSubmenu-link u-upperCase"}};this._layerTabPaneView=i(d,e),this.$el.append(this._layerTabPaneView.render().$el),this.addView(this._layerTabPaneView)},_changeStyle:function(a){this._layerTabPaneView&&this._layerTabPaneView.changeStyleMenu(a)},_updateSelectedChild:function(){var a,b;switch(this._layerTabPaneView.getSelectedTabPaneName()){case"click":a=this._layerInfowindowModel.get("template_name"),b=_t("editor.layers.infowindow.style.none"),this._layerInfowindowModel.isCustomTemplate()?b=_t("editor.layers.infowindow.style.custom"):this._layerInfowindowModel.hasTemplate()&&(b=_t("editor.layers.infowindow.style."+a));break;case"hover":a=this._layerTooltipModel.get("template_name"),b=_t("editor.layers.tooltip.style.none"),this._layerTooltipModel.isCustomTemplate()?b=_t("editor.layers.tooltip.style.custom"):this._layerTooltipModel.hasTemplate()&&(b=_t("editor.layers.tooltip.style."+a))}this._layerTabPaneView.$(".js-menu .CDB-NavSubmenu-item.is-selected .js-NavSubmenu-status").html(b),this._layerTabPaneView.$(".js-list .Carousel-item").removeClass("is-selected"),this._layerTabPaneView.$(".js-list .Carousel-item.js-"+a).addClass("is-selected")},_bindEvents:function(){this._layerInfowindowModel.on("change:template",this._onChangeTemplate,this),this.add_related_model(this._layerInfowindowModel),this._layerTooltipModel.on("change:template",this._onChangeTemplate,this),this.add_related_model(this._layerTooltipModel)},_onChangeTemplate:function(){this._updateSelectedChild()},_showHiddenLayer:function(){var a={shouldPreserveAutoStyle:!0};this._layerDefinitionModel.toggleVisible(),this._userActions.saveLayer(this._layerDefinitionModel,a)}})},{"../../../../components/infobox/infobox-collection":215,"../../../../components/infobox/infobox-factory":216,"../../../../components/infobox/infobox-model":219,"../../../../components/tab-pane/create-text-labels-tab-pane":537,"../../../../components/view-factory":594,"../../../../components/view-options/panel-with-options-view":595,"../../../../helpers/fetch-all-query-objects":1092,"../../../../helpers/required-opts":1097,"../../../components/overlay/overlay-view":694,"../../../tab-pane-submenu.tpl":1054,"../../panel-loading-template.tpl":996,"./georeference-placeholder.tpl":899,"./infowindow-click-view":903,"./infowindow-hover-view":914,"./panel-with-options.tpl":927,"./popups-placeholder.tpl":928,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],927:[function(a,b,c){arguments[4][882][0].apply(c,arguments)},{dup:882,underscore:"underscore"}],928:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">'+(null==(__t=placeholder)?"":_.escape(__t))+"</h2>\n";return __p}},{underscore:"underscore"}],929:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="58px" height="32px" viewBox="494 496 58 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="PopUp-Copy-3" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(494.000000, 496.000000)">\n        <path d="M2.99306965,0 L55.0069304,0 C56.1076723,0 57,0.889261723 57,2.00174332 L57,29.9982567 C57,31.103789 56.1032859,32 55.0073354,32 L18.4262695,32 L9,32 L0.998101354,32 L1,2.00174332 C1,0.89621101 1.90230818,0 2.99306965,0 Z" id="Rectangle-2087" fill="#2E3C43"></path>\n        <rect id="Rectangle-679" fill="#636D72" x="6" y="15" width="45" height="2"></rect>\n        <rect id="Rectangle-680" fill="#636D72" x="6" y="19" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#636D72" x="6" y="23" width="19" height="2"></rect>\n        <rect id="Rectangle-680" fill="#636D72" x="6" y="11" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#636D72" x="6" y="7" width="36" height="2"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],930:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="58px" height="34px" viewBox="429 496 58 34" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="PopUp-Copy-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(429.000000, 497.000000)">\n        <path d="M2.99306965,0 L55.0069304,0 C56.1076723,0 57,0.889261723 57,2.00174332 L57,29.9982567 C57,31.103789 56.1032859,32 55.0073354,32 L18.4262695,32 L9,32 L0.998101354,32 L1,2.00174332 C1,0.89621101 1.90230818,0 2.99306965,0 Z" id="Rectangle-2087" stroke="#EEEEEE" fill="#FFFFFF"></path>\n        <rect id="Rectangle-679" fill="#DDDDDD" x="5" y="14" width="45" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="5" y="18" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="5" y="22" width="19" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="5" y="10" width="26" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="5" y="6" width="36" height="2"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],931:[function(a,b,c){arguments[4][920][0].apply(c,arguments)},{dup:920,underscore:"underscore"}],932:[function(a,b,c){var d=a("backbone/core-view"),e=a("./apply-button.tpl");b.exports=d.extend({events:{"click .js-apply":"_onApplyClick"},initialize:function(a){if(!a.onApplyClick)throw new Error("onApplyClick is required")},render:function(){return this.$el.html(e()),this},_onApplyClick:function(){this.options.onApplyClick()}})},{"./apply-button.tpl":933,"backbone/core-view":1127}],933:[function(a,b,c){arguments[4][901][0].apply(c,arguments)},{dup:901,underscore:"underscore"}],934:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="42px" height="18px" viewBox="7 7 42 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(7.000000, 7.000000)">\n        <rect id="Rectangle-680" fill="#DDDDDD" x="0" y="0" width="11" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="0" y="4" width="9" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="0" y="8" width="16" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="0" y="12" width="13" height="2"></rect>\n        <rect id="Rectangle-680" fill="#DDDDDD" x="0" y="16" width="16" height="2"></rect>\n        <ellipse id="Oval-1585" fill-opacity="0.2" fill="#9DE0AD" cx="33" cy="9" rx="9" ry="9"></ellipse>\n        <ellipse id="Oval-1585" fill-opacity="0.4" fill="#9DE0AD" cx="33" cy="11" rx="7" ry="7"></ellipse>\n        <ellipse id="Oval-1585" fill-opacity="0.5" fill="#9DE0AD" cx="33" cy="13" rx="5" ry="5"></ellipse>\n        <ellipse id="Oval-1585" fill-opacity="0.8" fill="#9DE0AD" cx="33" cy="15" rx="3" ry="3"></ellipse>\n        <ellipse id="Oval-1585" fill="#9DE0AD" cx="33" cy="17" rx="1" ry="1"></ellipse>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],935:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="32px" viewBox="529 429 56 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <defs>\n    <rect id="path-1" x="0" y="0" width="56" height="32" rx="2"></rect>\n    <mask id="mask-2" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="56" height="32" fill="white">\n        <use xlink:href="#path-1"></use>\n    </mask>\n  </defs>\n  <g id="category" transform="translate(529.000000, 429.000000)">\n    <use id="Rectangle-2" stroke="#EEEEEE" mask="url(#mask-2)" stroke-width="2" fill="#FFFFFF" xlink:href="#path-1"></use>\n    <rect id="Rectangle-679" fill="#DDDDDD" x="7" y="15" width="23" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="7" y="19" width="13" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="7" y="23" width="10" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="7" y="11" width="13" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="7" y="7" width="19" height="2"></rect>\n    <rect id="Rectangle-680" fill="#9CE0AC" x="45" y="7" width="3" height="2"></rect>\n    <rect id="Rectangle-680" fill="#F4F1DE" x="45" y="11" width="3" height="2"></rect>\n    <rect id="Rectangle-680" fill="#E17C60" x="45" y="15" width="3" height="2"></rect>\n    <rect id="Rectangle-680" fill="#3D3F5B" x="45" y="19" width="3" height="2"></rect>\n    <rect id="Rectangle-680" fill="#F2CD8F" x="45" y="23" width="3" height="2"></rect>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],936:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="32px" viewBox="529 429 56 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <defs>\n    <rect id="path-1" x="0" y="0" width="56" height="32" rx="2"></rect>\n    <mask id="mask-2" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="56" height="32" fill="white">\n        <use xlink:href="#path-1"></use>\n    </mask>\n  </defs>\n  <g id="category" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(529.000000, 429.000000)">\n    <use id="Rectangle-2" stroke="#EEEEEE" mask="url(#mask-2)" stroke-width="2" fill="#FFFFFF" xlink:href="#path-1"></use>\n    <rect id="Rectangle-679" fill="#DDDDDD" x="14" y="15" width="23" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="14" y="19" width="13" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="14" y="23" width="10" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="14" y="11" width="13" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="14" y="7" width="19" height="2"></rect>\n    <rect id="Rectangle-680" fill="#9CE0AC" x="7" y="7" width="3" height="2"></rect>\n    <rect id="Rectangle-680" fill="#F4F1DE" x="7" y="11" width="3" height="2"></rect>\n    <rect id="Rectangle-680" fill="#E17C60" x="7" y="15" width="3" height="2"></rect>\n    <rect id="Rectangle-680" fill="#3D3F5B" x="7" y="19" width="3" height="2"></rect>\n    <rect id="Rectangle-680" fill="#F2CD8F" x="7" y="23" width="3" height="2"></rect>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],937:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="54px" height="24px" viewBox="519 458 54 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <defs>\n    <linearGradient x1="90.736547%" y1="49.7500002%" x2="9.63471511%" y2="49.7500002%" id="linearGradient-1">\n      <stop stop-color="#C11F22" offset="0%"></stop>\n      <stop stop-color="#F53F15" offset="23.9588524%"></stop>\n      <stop stop-color="#FF9030" offset="49.5142003%"></stop>\n      <stop stop-color="#FFCF52" offset="75.4982561%"></stop>\n      <stop stop-color="#FFFEAE" offset="100%"></stop>\n    </linearGradient>\n  </defs>\n  <g id="color" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(519.000000, 458.000000)">\n    <rect id="bg" fill="#FFFFFF" x="0" y="0" width="54" height="23" rx="2"></rect>\n    <path d="M1,20.9991358 C1,21.5484057 1.45096651,22 2.00209026,22 L51.9979097,22 C52.5538814,22 53,21.5535154 53,20.9991358 L53,2.00086422 C53,1.45159429 52.5490335,1 51.9979097,1 L2.00209026,1 C1.44611861,1 1,1.44648455 1,2.00086422 L1,20.9991358 Z M2.00209026,0 L51.9979097,0 C53.1036337,0 54,0.901627257 54,2.00086422 L54,20.9991358 C54,22.1041826 53.1077828,23 51.9979097,23 L2.00209026,23 C0.896366344,23 0,22.0983727 0,20.9991358 L0,2.00086422 C0,0.895817426 0.892217249,0 2.00209026,0 Z" id="Rectangle-2087-Copy" fill="#EEEEEE"></path>\n    <rect id="Rectangle-680" fill="url(#linearGradient-1)" x="6" y="12" width="42" height="5"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="6" y="6" width="6" height="2"></rect>\n    <rect id="Rectangle-680" fill="#DDDDDD" x="42" y="6" width="6" height="2"></rect>\n  </g>\n</svg>';return __p}},{underscore:"underscore"}],938:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-upperCase u-altTextColor">None</p>';return __p}},{underscore:"underscore"}],939:[function(a,b,c){arguments[4][898][0].apply(c,arguments)},{dup:898,underscore:"underscore"}],940:[function(a,b,c){var d=a("underscore");b.exports=[{value:"none",legendIcon:a("../carousel-icons/none.tpl"),label:_t("editor.legend.types.none")},{value:"category",legendIcon:a("../carousel-icons/category.tpl"),label:_t("editor.legend.types.category"),isStyleCompatible:function(a){var b,c=a.get("type"),e=a.get("fill"),f=a.get("stroke");return!(!e&&!f||d.isEmpty(e)&&d.isEmpty(f))&&(b=e&&e.color||f&&f.color,"animation"===c||b&&"category"===b.quantification||b&&b.attribute&&b.attribute_type&&"string"===b.attribute_type)}},{value:"choropleth",legendIcon:a("../carousel-icons/gradient.tpl"),label:_t("editor.legend.types.gradient"),isStyleCompatible:function(a){var b,c=a.get("type"),e=a.get("fill"),f=a.get("stroke");return"animation"!==c&&"heatmap"!==c&&(!(!e&&!f||d.isEmpty(e)&&d.isEmpty(f))&&(b=e&&e.color||f&&f.color,(!b||"category"!==b.quantification)&&(b&&b.attribute&&(void 0===b.attribute_type||b.attribute_type&&"string"!==b.attribute_type))))}},{value:"custom_choropleth",legendIcon:a("../carousel-icons/gradient.tpl"),label:_t("editor.legend.types.gradient"),isStyleCompatible:function(a){var b,c=a.get("type"),e=a.get("fill"),f=a.get("stroke");return!(!e&&!f||d.isEmpty(e)&&d.isEmpty(f))&&(b=e&&e.color||f&&f.color,"heatmap"===c&&b&&b.attribute&&(void 0===b.attribute_type||b.attribute_type&&"string"!==b.attribute_type))}},{value:"custom",legendIcon:a("../carousel-icons/custom.tpl"),label:_t("editor.legend.types.custom")}]},{"../carousel-icons/category.tpl":935,"../carousel-icons/custom.tpl":936,"../carousel-icons/gradient.tpl":937,"../carousel-icons/none.tpl":938,underscore:"underscore"}],941:[function(a,b,c){var d=a("./legend-color-types"),e=a("../legend-base-type-view");b.exports=e.extend({initialize:function(a){this.legendTypes=d,e.prototype.initialize.call(this,a)}})},{"../legend-base-type-view":955,"./legend-color-types":940}],942:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="<ul>\n  ";for(var i in items)__p+='\n    <li class="Legend-categoryListItem u-flex u-justifySpace u-alignCenter">\n      <p class="Legend-categoryTitle CDB-Text CDB-Size-small u-upperCase u-ellipsis" title="'+(null==(__t=items[i].title)?"":__t)+'">'+(null==(__t=items[i].title)?"":__t)+"</p>\n      ",items[i].color?__p+='\n        <span class="Legend-categoryCircle" style="opacity:1; background: '+(null==(__t=items[i].color)?"":__t)+';"></span>\n      ':items[i].icon&&(__p+='\n        <span class="Legend-categoryIcon js-image-container" data-icon="'+(null==(__t=items[i].icon)?"":__t)+'" ',items[i].color&&(__p+='data-color="'+(null==(__t=items[i].color)?"":__t)+'"'),__p+="></span>\n      "),__p+="\n    </li>\n  ";__p+="\n</ul>\n"}return __p}},{underscore:"underscore"}],943:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{type:"none",title:""},initialize:function(a,b){if(!b.legendDefinitionModel)throw new Error("legendDefinitionModel is required");this.legendDefinitionModel=b.legendDefinitionModel,this.schema=this._generateSchema()},_generateSchema:function(){return{title:{type:"EnablerEditor",title:"",label:_t("editor.legend.legend-form.title"),defaultValue:this._titlePlaceholder,editor:{type:"Text",editorAttrs:{placeholder:this._titlePlaceholder}}}}},toJSON:function(){return e.extend(this.attributes,{type:this.get("type")})}})},{backbone:"backbone",underscore:"underscore"}],944:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-form-model"),f=a("./legend-color-helper");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"bubble",fillColor:null}),initialize:function(a,b){this._titlePlaceholder=_t("editor.legend.legend-form.by-size"),e.prototype.initialize.call(this,a,b),this.on("change:fill",function(){this.set("fillColor",this.get("fill").color.fixed)},this),this._initialColor()},toJSON:function(){return d.extend({},d.omit(this.attributes,"fill"))},_initialColor:function(){var a=this.legendDefinitionModel.get("fillColor"),b=f.getBubbles(a);this.set({fill:b})},_generateSchema:function(){var a=e.prototype._generateSchema.call(this);return d.extend(a,{fill:{type:"Fill",title:_t("editor.legend.legend-form.fill"),options:[],dialogMode:"float",editorAttrs:{color:{hidePanes:["value"]}}},topLabel:{type:"EnablerEditor",title:"",label:_t("editor.legend.legend-form.top-label"),editor:{type:"Text",editorAttrs:{placeholder:_t("editor.legend.legend-form.custom-label-placeholder")}}},bottomLabel:{type:"EnablerEditor",title:"",label:_t("editor.legend.legend-form.bottom-label"),editor:{type:"Text",editorAttrs:{placeholder:_t("editor.legend.legend-form.custom-label-placeholder")}}}})}})},{"./legend-base-definition-form-model":943,"./legend-color-helper":947,underscore:"underscore"}],945:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-form-model");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"category"}),initialize:function(a,b){this._titlePlaceholder=_t("editor.legend.legend-form.by-color"),e.prototype.initialize.call(this,a,b)}})},{"./legend-base-definition-form-model":943,underscore:"underscore"}],946:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-form-model");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"choropleth",prefix:"",suffix:"",leftLabel:"",rightLabel:""}),initialize:function(a,b){this._titlePlaceholder=_t("editor.legend.legend-form.by-color"),e.prototype.initialize.call(this,a,b)},_generateSchema:function(){var a=e.prototype._generateSchema.call(this);return d.extend(a,{leftLabel:{type:"EnablerEditor",title:"",label:_t("editor.legend.legend-form.left-label"),editor:{type:"Text",editorAttrs:{placeholder:_t("editor.legend.legend-form.custom-label-placeholder")}}},rightLabel:{type:"EnablerEditor",title:"",label:_t("editor.legend.legend-form.right-label"),editor:{type:"Text",editorAttrs:{placeholder:_t("editor.legend.legend-form.custom-label-placeholder")}}},suffix:{type:"EnablerEditor",title:"",label:_t("editor.legend.legend-form.suffix"),editor:{type:"Text"}},prefix:{type:"EnablerEditor",title:"",label:_t("editor.legend.legend-form.prefix"),editor:{type:"Text"}}})}})},{"./legend-base-definition-form-model":943,underscore:"underscore"}],947:[function(a,b,c){function d(a,b,c){return h.isString(a)&&(a={fixed:a,opacity:1,image:c}),{fill:{color:a},title:b}}function e(a){return a&&a.replace&&a.replace(/^"(.+(?="$))"$/,"$1")}function f(a){return[d(a,"",a.image||"")]}function g(a){var b=a.range.length;return h.range(b).map(function(b,c){return d(a.range[c],a.domain&&e(a.domain[c])||"",a.images&&a.images[c])})}var h=a("underscore");b.exports={buildSwatch:d,getCategories:function(a){return void 0!==a.fixed?f(a):a.attribute?g(a):void 0},unquoteColor:e,getBubbles:function(a){return h.omit(h.first(this.getCategories(a)),"title").fill}}},{underscore:"underscore"}],948:[function(a,b,c){function d(a){var b=e.first(a);return a=e.rest(a),a.concat([b])}var e=a("underscore"),f=["#66B79E","#E65176","#528995","#FF710F","#305482","#CCD859","#565175","#FFB927","#3EBCAE","#E54C1F"];b.exports={getNextColor:function(){return f=d(f),e.first(f)},getColors:function(){return f},setColors:function(a){f=a}}},{underscore:"underscore"}],949:[function(a,b,c){var d=a("underscore"),e=a("./legend-choropleth-definition-form-model");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"custom_choropleth"})})},{"./legend-choropleth-definition-form-model":946,underscore:"underscore"}],950:[function(a,b,c){var d=a("underscore"),e=a("./legend-base-definition-form-model"),f=a("./legend-nested-category-definition-form-model"),g=a("./legend-list-item.tpl"),h=a("./legend-list.tpl"),i=a("./legend-color-helper");b.exports=e.extend({defaults:d.extend({},e.prototype.defaults,{type:"custom",items:[]}),initialize:function(a,b){if(!b.userModel)throw new Error("userModel is required");if(!b.configModel)throw new Error("configModel is required");if(!b.modals)throw new Error("configModel is required");this._userModel=b.userModel,this._configModel=b.configModel,this._modals=b.modals,this._titlePlaceholder=_t("editor.legend.legend-form.by-color"),e.prototype.initialize.call(this,a,b),this._initialItems()},_initialItems:function(){var a,b=this.legendDefinitionModel.get("items");a=b.map(function(a,b){return i.buildSwatch(a.color,a.title,a.icon)}),this.set({items:a})},_generateSchema:function(){var a=e.prototype._generateSchema.call(this);return d.extend(a,{items:{type:"SortableList",itemType:"CategoryModel",model:f,title:"",itemTemplate:g,listTemplate:h,editorAttrs:{className:"u-flex",userModel:this._userModel,configModel:this._configModel,modals:this._modals}}})},toJSON:function(){return d.extend({},d.omit(this.attributes,"items"),{items:this.get("items").map(function(a){return{title:a.title,color:a.fill.color.fixed,image:a.fill.color.image}})})}})},{"./legend-base-definition-form-model":943,
"./legend-color-helper":947,"./legend-list-item.tpl":951,"./legend-list.tpl":952,"./legend-nested-category-definition-form-model":953,underscore:"underscore"}],951:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LegendItem js-sortable">\n  <div class="LegendItem-listFieldsOrder CDB-Shape">\n    <div class="CDB-Shape-rectsHandle is-small">\n      <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-first"></div>\n      <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-second"></div>\n      <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-third"></div>\n    </div>\n  </div>\n  <div data-editor class="u-grow">\n  </div>\n  <button class="LegendItem-deteleButton" type="button" data-action="remove">\n    <svg width="8px" height="8px" viewBox="435 377 8 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <path d="M436,380 L442,380 L442,384.000193 C442,384.552371 441.549025,385 441.009222,385 L436.990778,385 C436.443586,385 436,384.556283 436,384.000193 L436,380 Z M435,378 L443,378 L443,379 L435,379 L435,378 Z M437,377 L441,377 L441,378 L437,378 L437,377 Z" id="Delete" stroke="none" fill="#AAAAAA" fill-rule="evenodd"></path>\n    </svg>\n  </button>\n</div>';return __p}},{underscore:"underscore"}],952:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-grow  LegendItems-container">\n  <div data-items class="u-bSpace--xl">\n\n  </div>\n  <div class="u-flex u-justifyEnd" style="width: 100%;"> <!-- We need a fucking u-full helper -->\n    <button class="CDB-Text CDB-Size-small u-actionTextColor u-upperCase" type="button" data-action="add">\n      '+(null==(__t=_t("editor.legend.legend-form.add"))?"":_.escape(__t))+"\n    </button>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],953:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./legend-color-range"),g={color:{fixed:"#fabada",opacity:.9}};b.exports=e.Model.extend({schema:{fill:{type:"Fill",title:"",options:[],dialogMode:"float",editorAttrs:{color:{hidePanes:["value"],imageEnabled:!0},className:"LegendItem-inner"}},title:{type:"Text",title:"",editorAttrs:{className:"LegendItem-inner",placeholder:_t("editor.legend.legend-form.untitled")}}},initialize:function(a,b){this._userModel=b.userModel,this._configModel=b.configModel,this._modals=b.modals,this._setOptions();var c=d.clone(g);void 0===a.fill&&(c.color.fixed=f.getNextColor(),this.set({fill:c},{silent:!0}))},_setOptions:function(){this.schema.fill.editorAttrs.userModel=this._userModel,this.schema.fill.editorAttrs.configModel=this._configModel,this.schema.fill.editorAttrs.modals=this._modals}})},{"./legend-color-range":948,backbone:"backbone",underscore:"underscore"}],954:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">'+(null==(__t=_t("editor.legend.no-geometry-data"))?"":_.escape(__t))+" "+(null==(__t=_t("editor.layers.georeference.manually-add"))?"":_.escape(__t))+'</h2>\n<div class="BlockList-item is-dashed no-hover is-space u-tSpace-xl">\n  <ul class="HorizontalBlockList">\n    <li class="HorizontalBlockList-item"></li>\n    <li class="HorizontalBlockList-item"></li>\n  </ul>\n\n  <button class="CDB-Button CDB-Button--primary js-georeference">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("editor.layers.georeference.georeference-button"))?"":_.escape(__t))+"</span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],955:[function(a,b,c){var d=a("cartodb.js"),e=a("backbone"),f=a("backbone/core-view"),g=a("underscore"),h=a("../../../../components/view-options/panel-with-options-view"),i=a("./legend-content-view"),j=a("./legend-editor-view"),k=a("../../../../components/scroll/scroll-view"),l=a("../../../../components/tab-pane/tab-pane-view"),m=a("../../../../components/tab-pane/tab-pane-collection"),n=a("../../../../components/toggler/toggler-view"),o=a("./apply-button-view"),p=a("../../../../components/infobox/infobox-factory"),q=a("../../../../components/infobox/infobox-model"),r=a("../../../../components/infobox/infobox-collection"),s=a("../../../../data/legends/legend-base-definition-model"),t=a("./legend-factory"),u=a("./color/legend-custom-template.tpl"),v=["mapDefinitionModel","layerDefinitionModel","editorModel","modelView","legendDefinitionsCollection","type","userActions","userModel","configModel","modals"],w="[[Legend]]",x=g.template("<%= preSnippet %>\r\n<%- placeholder %>\r\n<%= postSnippet %>");b.exports=f.extend({initialize:function(a){g.each(v,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._legendDefinitionModel=this._getUserLegend(this.legendTypes),this._codemirrorModel=new e.Model({content:this._getEditorContent()}),this._editorModel.set({edition:this._legendDefinitionModel.hasCustomHtml(),disabled:this._isToggleDisable()}),this._infoboxModel=new q({state:""}),this._overlayModel=new e.Model({visible:this._isLayerHidden()||this._legendDefinitionModel.hasCustomHtml()}),this._infoboxState(),this._configPanes(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_getEditorContent:function(){var a,b=this._legendDefinitionModel.get("type");return a="custom"===b?this._legendDefinitionModel.hasCustomHtml()?this._legendDefinitionModel.get("html"):"":this._getReadOnlyContent()},_getReadOnlyContent:function(){var a=x({preSnippet:this._legendDefinitionModel.get("preHTMLSnippet")||_t("editor.legend.code-mirror.pre-html"),placeholder:w,postSnippet:this._legendDefinitionModel.get("postHTMLSnippet")||_t("editor.legend.code-mirror.post-html")});return a},_getCustomContent:function(){var a,b=this._legendDefinitionModel.get("html");return""===b&&(a=this._legendDefinitionModel.get("items"),b=u({items:a})),b},_handleEditorContent:function(a){var b=this._legendDefinitionModel.get("type");a&&this._codemirrorModel.set({content:"custom"===b?this._getCustomContent():this._getReadOnlyContent()})},_getUserLegend:function(a){var b=this,c=g.map(a,function(a){return a.value}),d=this._legendDefinitionsCollection.find(function(a){return c.indexOf(a.get("type"))!==-1&&a.layerDefinitionModel.id===b._layerDefinitionModel.id});return void 0===d&&(d=new s(null,{layerDefinitionModel:this._layerDefinitionModel,configModel:this._legendDefinitionsCollection.configModel,vizId:this._legendDefinitionsCollection.vizId})),d},_isToggleDisable:function(){return"error"===this._modelView.get("state")||"none"===this._legendDefinitionModel.get("type")||this._areLegendsDisabled()},_isLayerHidden:function(){return this._layerDefinitionModel.get("visible")===!1},_initBinds:function(){this.listenTo(this._editorModel,"change:edition",this._onChangeEdition),this.add_related_model(this._editorModel),this.listenTo(this._modelView,"change:state",this._infoboxState),this.add_related_model(this._modelView),this.listenTo(this._layerDefinitionModel,"change:visible",this._infoboxState),this.add_related_model(this._layerDefinitionModel),this.listenTo(this._mapDefinitionModel,"change:legends",this._infoboxState),this.add_related_model(this._mapDefinitionModel)},_onChangeState:function(){var a="error"===this._modelView.get("state");this._editorModel.set({disabled:a})},_onChangeEdition:function(){this._infoboxState();var a=this._editorModel.get("edition");this._handleEditorContent(a);var b=a?1:0;this._collectionPane.at(b).set({selected:!0})},_initViews:function(){var a=this,b=[{state:"html-legend",createContentView:function(){return p.createWithAction({type:"alert",title:_t("editor.legend.messages.custom-legend.title"),body:_t("editor.legend.messages.custom-legend.body"),mainAction:{label:_t("editor.legend.messages.custom-legend.accept")}})},mainAction:a._deleteCustomHtmlLegend.bind(a)},{state:"layer-hidden",createContentView:function(){return p.createWithAction({type:"alert",title:_t("editor.legend.messages.layer-hidden.title"),body:_t("editor.legend.messages.layer-hidden.body"),mainAction:{label:_t("editor.legend.messages.layer-hidden.show")}})},mainAction:a._showHiddenLayer.bind(a)},{state:"legends-disabled",createContentView:function(){return p.createWithAction({type:"alert",title:_t("editor.legend.messages.legends-disabled.title"),body:_t("editor.legend.messages.legends-disabled.body"),mainAction:{label:_t("editor.legend.messages.legends-disabled.show")}})},mainAction:a._enableLegends.bind(a)}],c=new r(b),d=new h({className:"Editor-content",editorModel:a._editorModel,infoboxModel:a._infoboxModel,infoboxCollection:c,createContentView:function(){return new l({collection:a._collectionPane})},createControlView:function(){return new n({editorModel:a._editorModel,labels:[_t("editor.legend.data-toggle.values"),_t("editor.legend.data-toggle.html")],isDisableable:!0})},createActionView:function(){return new l({collection:a._collectionPane,createContentKey:"createActionView"})}});this.$el.append(d.render().el),this.addView(d)},_showHiddenLayer:function(){var a={shouldPreserveAutoStyle:!0};this._layerDefinitionModel.toggleVisible(),this._userActions.saveLayer(this._layerDefinitionModel,a)},_deleteCustomHtmlLegend:function(){var a=this._legendDefinitionModel.get("type");this._legendDefinitionModel&&this._legendDefinitionModel.set({html:""}),t.createLegend(this._layerDefinitionModel,a),this._infoboxState()},_saveLegendHTML:function(){var a,b=this._codemirrorModel.get("content"),c=this._legendDefinitionModel.get("type");"custom"===c?this._legendDefinitionModel&&this._legendDefinitionModel.set({html:b}):(a=b.split(w).map(function(a){return d.core.sanitize.html(a)}),this._legendDefinitionModel&&this._legendDefinitionModel.set({preHTMLSnippet:a[0],postHTMLSnippet:a[1]})),t.createLegend(this._layerDefinitionModel,c)},_infoboxState:function(){var a=this._editorModel.get("edition");!a&&this._areLegendsDisabled()?(this._infoboxModel.set({state:"legends-disabled"}),this._overlayModel.set({visible:!0})):!a&&this._legendDefinitionModel.hasCustomHtml()?(this._infoboxModel.set({state:"html-legend"}),this._overlayModel.set({visible:!0})):!a&&this._isLayerHidden()?(this._infoboxModel.set({state:"layer-hidden"}),this._overlayModel.set({visible:!0})):(this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1}))},_areLegendsDisabled:function(){return this._mapDefinitionModel.get("legends")===!1},_enableLegends:function(){this._mapDefinitionModel.save({legends:!0})},_updateLegend:function(a){this._legendDefinitionModel=a},_configPanes:function(){var a=this,b=[{selected:!a._legendDefinitionModel.hasCustomHtml(),createContentView:function(){return new k({createContentView:function(){return new i({className:"Editor-content",overlayModel:a._overlayModel,editorModel:a._editorModel,legendTypes:a.legendTypes,layerDefinitionModel:a._layerDefinitionModel,legendDefinitionModel:a._getUserLegend(a.legendTypes),legendDefinitionsCollection:a._legendDefinitionsCollection,updateLegend:a._updateLegend.bind(a),type:a._type,userModel:a._userModel,configModel:a._configModel,modals:a._modals})}})},createActionView:function(){return new f}},{selected:a._legendDefinitionModel.hasCustomHtml(),createContentView:function(){return new j({isCustom:"custom"===a._legendDefinitionModel.get("type"),codemirrorModel:a._codemirrorModel,onApplyEvent:a._saveLegendHTML.bind(a)})},createActionView:function(){return new o({onApplyClick:a._saveLegendHTML.bind(a)})}}];this._collectionPane=new m(b)}})},{"../../../../components/infobox/infobox-collection":215,"../../../../components/infobox/infobox-factory":216,"../../../../components/infobox/infobox-model":219,"../../../../components/scroll/scroll-view":530,"../../../../components/tab-pane/tab-pane-collection":538,"../../../../components/tab-pane/tab-pane-view":549,"../../../../components/toggler/toggler-view":590,"../../../../components/view-options/panel-with-options-view":595,"../../../../data/legends/legend-base-definition-model":638,"./apply-button-view":932,"./color/legend-custom-template.tpl":942,"./legend-content-view":958,"./legend-editor-view":960,"./legend-factory":961,backbone:"backbone","backbone/core-view":1127,"cartodb.js":"cartodb.js",underscore:"underscore"}],956:[function(a,b,c){var d={};b.exports={add:function(a){var b=a.layerDefinitionModel.id+":"+a.get("type");d[b]=a},find:function(a,b){var c=a.id+":"+b;return d[c]},remove:function(a){var b=a.layerDefinitionModel.id+":"+a.get("type");delete d[b]}}},{}],957:[function(a,b,c){arguments[4][886][0].apply(c,arguments)},{dup:886,underscore:"underscore"}],958:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../../../components/carousel-form-view"),g=a("../../../../components/custom-carousel/custom-carousel-collection"),h=a("../../../../editor/components/overlay/overlay-view"),i=a("./legend-properties-form"),j=a("./form/legend-custom-definition-form-model"),k=a("./form/legend-category-definition-form-model"),l=a("./form/legend-bubble-definition-form-model"),m=a("./form/legend-choropleth-definition-form-model"),n=a("./form/legend-custom-choropleth-definition-form-model"),o=a("./legend-content.tpl"),p=a("./legend-factory"),q=350,r=["editorModel","legendTypes","updateLegend","overlayModel","layerDefinitionModel","legendDefinitionModel","legendDefinitionsCollection","type","userModel","configModel","modals"],s={bubble:l,custom:j,category:k,choropleth:m,custom_choropleth:n};b.exports=d.extend({initialize:function(a){e.each(r,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this);var b=this._legendDefinitionModel.get("type");this._onDebouncedChange=e.debounce(this._updateChanges.bind(this),q),this._createFormModel(b);var c=this._layerDefinitionModel.styleModel;this._carouselCollection=new g(e.chain(this._legendTypes).filter(function(a){return!a.isStyleCompatible||a.isStyleCompatible(c)},this).map(function(a){return{selected:b===a.value,val:a.value,label:a.label,template:function(){return a.legendIcon&&a.legendIcon()||a.value}}},this).value()),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.html(o()),this._initViews(),this},_createFormModel:function(a){var b,c;this._formModel&&(this._unBindFormModel(this._formModel),delete this._formModel),a&&"none"!==a&&(b=s[a],c=this._pickAttrs(this._legendDefinitionModel),this._formModel=new b(c,{legendDefinitionModel:this._legendDefinitionModel,userModel:this._userModel,configModel:this._configModel,modals:this._modals}),this._bindFormModel(this._formModel))},_pickAttrs:function(a){var b=e.pick(a.attributes,"title","prefix","suffix","leftLabel","rightLabel","topLabel","bottomLabel","items");return b},_initBinds:function(){this._carouselCollection.on("change:selected",this._onCarouselChange,this),this.add_related_model(this._carouselCollection)},_onCarouselChange:function(a){var b=a.getValue();a.get("selected")===!0&&(this._updateLegendModel(b),this._createFormModel(b),this._renderForm(b),this._updateToggle(b)),a.get("selected")===!1&&"none"!==b&&p.removeLegend(this._layerDefinitionModel,b)},_initViews:function(){var a=this._legendDefinitionModel.get("type");this._renderCarousel(),this._renderForm(a),this._renderOverlay(),this._updateToggle(a)},_renderOverlay:function(){var a=new h({overlayModel:this._overlayModel});this.addView(a),this.$el.append(a.render().el)},_updateLegendModel:function(a){a&&"none"!==a?(p.enableLegend(this._type),this._legendDefinitionModel=p.createLegend(this._layerDefinitionModel,a),this._updateLegend(this._legendDefinitionModel)):(p.disableLegend(this._type),this._updateLegend(null),delete this._legendDefinitionModel)},_renderForm:function(a){this._removeForm(),a&&"none"!==a&&this._addForm()},_addForm:function(){this._formView=new i({formModel:this._formModel}),this.addView(this._formView),this.$(".js-form").html(this._formView.render().el)},_removeForm:function(){this._formView&&(this.removeView(this._formView),this._formView.clean())},_updateToggle:function(a){var b="none"===a;this._editorModel.set({disabled:b})},_renderCarousel:function(){var b=new f({collection:this._carouselCollection,template:a("./legend-form-types.tpl")});this.addView(b),this.$(".js-carousel").html(b.render().el)},_bindFormModel:function(a){a&&(a.on("change",this._onDebouncedChange,this),this.add_related_model(a))},_unBindFormModel:function(a){a&&a.off("change",this._onDebouncedChange,this)},_updateChanges:function(){this._legendDefinitionModel&&(this._legendDefinitionModel.setAttributes(this._formModel.toJSON()),p.createLegend(this._layerDefinitionModel,this._legendDefinitionModel.get("type")))}})},{"../../../../components/carousel-form-view":23,"../../../../components/custom-carousel/custom-carousel-collection":40,"../../../../editor/components/overlay/overlay-view":694,"./form/legend-bubble-definition-form-model":944,"./form/legend-category-definition-form-model":945,"./form/legend-choropleth-definition-form-model":946,"./form/legend-custom-choropleth-definition-form-model":949,"./form/legend-custom-definition-form-model":950,"./legend-content.tpl":959,"./legend-factory":961,"./legend-form-types.tpl":962,"./legend-properties-form":964,"backbone/core-view":1127,underscore:"underscore"}],959:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-carousel"></div>\n<div class="js-form"></div>';return __p}},{underscore:"underscore"}],960:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("../../../../components/code-mirror/code-mirror-view"),g=a("./code-mirror-error.tpl"),h=["codemirrorModel","onApplyEvent","isCustom"],i="[[Legend]]";b.exports=e.extend({className:"Editor-content",initialize:function(a){d.each(h,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){this.codeMirrorView=new f({model:this._codemirrorModel,tip:_t("editor.legend.code-mirror.save"),errorTemplate:g}),this.codeMirrorView.bind("codeSaved",this._triggerCodeSaved,this),this.addView(this.codeMirrorView),this.$el.append(this.codeMirrorView.render().el),this._isCustom||this._markReadOnly()},_markReadOnly:function(){var a=this.codeMirrorView.search(i);this.codeMirrorView.markReadOnly(a.from,a.to)},_triggerCodeSaved:function(a,b){this.options.onApplyEvent&&this.options.onApplyEvent()}})},{"../../../../components/code-mirror/code-mirror-view":27,"./code-mirror-error.tpl":939,"backbone/core-view":1127,underscore:"underscore"}],961:[function(a,b,c){var d=a("underscore"),e=a("../../../../data/legends/legend-category-definition-model"),f=a("../../../../data/legends/legend-bubble-definition-model"),g=a("../../../../data/legends/legend-choropleth-definition-model"),h=a("../../../../data/legends/legend-custom-choropleth-definition-model"),i=a("../../../../data/legends/legend-custom-definition-model"),j=a("./legend-validations"),k=a("./legend-buffer"),l={bubble:f,category:e,choropleth:g,custom_choropleth:h,custom:i},m=function(){return{init:function(a){if(!a)throw new Error("legendDefinitionsCollection is required");this.legendDefinitionsCollection=a},getLegendsCollection:function(){return this.legendDefinitionsCollection},add:function(a,b){var c=this;a.save(null,{success:function(a){k.remove(a),c.legendDefinitionsCollection.add(a)},complete:function(){b&&b()}})},save:function(a,b){a.save(null,{complete:function(a){b&&b()}})},remove:function(a,b){var c=this;a.destroy({success:function(a){c.legendDefinitionsCollection.remove(a)},complete:function(){b&&b()}})},createLegend:function(a,b,c,d){var e,f=this.legendDefinitionsCollection.findByLayerDefModelAndType(a,b),g=k.find(a,b),h=j[b],i=h(a.styleModel);return c=c||{},g?g:(f?i?(f.set(c),this.save(f,d)):this.remove(f,d):(e=l[b],f=new e(c,{layerDefinitionModel:a,configModel:this.legendDefinitionsCollection.configModel,vizId:this.legendDefinitionsCollection.vizId,parse:!0}),i&&(k.add(f),this.add(f,d))),f)},removeLegend:function(a,b,c){var d=this.legendDefinitionsCollection.findByLayerDefModelAndType(a,b);return d?this.remove(d,c):c&&c(),d},find:function(a,b){return this.legendDefinitionsCollection.findByLayerDefModelAndType(a,b)},removeAllLegend:function(a){var b=this.legendDefinitionsCollection.findByLayerDefModel(a);d.each(b,function(a){"custom"!==a.get("type")&&this.remove(a)},this)},hasMigratedLegend:function(a){var b=this.legendDefinitionsCollection.findByLayerDefModelAndType(a,"html");return!!b},disableLegend:function(a){this[a]=!1},enableLegend:function(a){this[a]=!0},isEnabledType:function(a){return void 0===this[a]||!!this[a]}}}();b.exports=m},{"../../../../data/legends/legend-bubble-definition-model":639,"../../../../data/legends/legend-category-definition-model":640,"../../../../data/legends/legend-choropleth-definition-model":641,"../../../../data/legends/legend-custom-choropleth-definition-model":642,"../../../../data/legends/legend-custom-definition-model":643,"./legend-buffer":956,"./legend-validations":966,underscore:"underscore"}],962:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-bSpace--xl">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">1</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.legend.legend-form.type.title"))?"":_.escape(__t))+'</h2>\n    </div>\n    <div class="js-selector u-bSpace--xl">\n      <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=name)?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],963:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">\n  '+(null==(__t=_t("editor.legend.no-geometry-data"))?"":_.escape(__t))+"\n</h2>\n";return __p}},{underscore:"underscore"}],964:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./legend-properties-form.tpl");a("../../../../components/form-components/index"),b.exports=e.extend({initialize:function(a){if(!a.formModel)throw new Error("formModel is required");this._formModel=a.formModel},render:function(){return this.clearSubViews(),this._removeFormView(),this.$el.html(f()),this._initViews(),this},_initViews:function(){this._formView=new d.Form({model:this._formModel}),this._formView.on("change",this._updateChanges,this),this.add_related_model(this._formView),this.$(".js-propertiesForm").append(this._formView.render().el),this.$("form").on("submit",function(a){a.preventDefault()})},_updateChanges:function(){this._formView.commit()},_removeFormView:function(){this._formView&&this._formView.remove()},clean:function(){this.$("form").off("submit"),this._removeFormView(),e.prototype.clean.call(this)}})},{"../../../../components/form-components/index":211,"./legend-properties-form.tpl":965,backbone:"backbone","backbone/core-view":1127}],965:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-bSpace--xl">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text js-selector">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.legend.legend-form.properties.title"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.legend.legend-form.properties.subtitle"))?"":_.escape(__t))+'</p>\n    <div class="js-propertiesForm"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],966:[function(a,b,c){var d=a("underscore"),e=function(){return!0},f=function(a){var b=a.get("fill"),c=a.get("stroke");return!(!b&&!c||d.isEmpty(b)&&d.isEmpty(c))&&{fill:b,stroke:c}},g=function(a){var b=f(a);if(!b)return!1;var c=b.fill&&b.fill.color||b.stroke&&b.stroke.color;return c.range&&c.range.length>0},h=function(a){var b=f(a);if(!b)return!1;var c=b.fill&&b.fill.size||b.stroke&&b.stroke.size;return c.range&&c.range.length>0},i=function(a){var b=f(a);if(!b)return!1;var c=b.fill&&b.fill.color||b.stroke&&b.stroke.color;return c.range&&c.range.length>0&&c.domain&&c.domain.length>0&&c.range&&c.range.length>0},j={bubble:h,category:i,choropleth:g,custom_choropleth:g,custom:e};b.exports=j},{underscore:"underscore"}],967:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./color/legend-color-view"),g=a("./size/legend-size-view"),h=a("../../../../components/tab-pane/create-text-labels-tab-pane"),i=a("../../../tab-pane-submenu.tpl"),j=a("./legend-content-sql-error.tpl"),k=a("../../sql-error-action.tpl"),l=a("../../panel-loading-template.tpl"),m=a("./legend-no-geometry-template.tpl"),n=a("../../query-sanity-check"),o=a("./georeference-placeholder.tpl"),p=a("../../../../helpers/required-opts"),q=a("../../../../components/infobox/infobox-factory"),r=a("../../../../components/infobox/infobox-model"),s=a("../../../../components/infobox/infobox-collection"),t=a("../../../../components/view-options/panel-with-options-view"),u=a("../../../../components/view-factory"),v=a("./panel-with-options.tpl"),w=a("../../../components/overlay/overlay-view"),x=a("../../../../helpers/fetch-all-query-objects"),y={ready:"ready",loading:"loading",fetched:"fetched",error:"error"},z=["mapDefinitionModel","userActions","layerDefinitionModel","queryGeometryModel","querySchemaModel","queryRowsCollection","legendDefinitionsCollection","editorModel","userModel","configModel","modals"];b.exports=e.extend({initialize:function(a){p(a,z,this),this.render=this.render.bind(this),this._layerInfowindowModel=this._layerDefinitionModel.infowindowModel,this._layerTooltipModel=this._layerDefinitionModel.tooltipModel,this._initModels(),this._initBinds(),this._fetchAllQueryObjectsIfNecessary(),n.track(this,this._onQueryChanged.bind(this))},render:function(){return this.clearSubViews(),this.$el.empty(),this._queryGeometryModel.isFetching()?this._renderLoading():this._hasError()?this._renderError():this._queryGeometryModel.hasValue()?this._initViews():this._layerDefinitionModel.canBeGeoreferenced()?this._renderGeoreferencePlaceholder():this._renderEmptyGeometry(),this._renderOverlay(),this},_renderOverlay:function(){var a=new w({overlayModel:this._overlayModel});this.addView(a),this.$(".js-content").append(a.render().el)},_initModels:function(){this._infoboxModel=new r({state:this._isLayerHidden()?"layer-hidden":""}),this._overlayModel=new d.Model({visible:this._isLayerHidden()}),this.modelView=new d.Model({state:this._getInitialState()})},_isLayerHidden:function(){return this._layerDefinitionModel.get("visible")===!1},_initBinds:function(){this.listenTo(this._querySchemaModel,"change:status",this._onStatusChanged),this.listenTo(this._queryGeometryModel,"change:status",this._onStatusChanged),this.listenTo(this._queryRowsCollection.statusModel,"change:status",this._onStatusChanged),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.listenTo(this._queryGeometryModel,"change:status",this._onGeometryChanged),this.listenTo(this._editorModel,"change:edition",this._changeStyle)},_fetchAllQueryObjectsIfNecessary:function(){x({queryRowsCollection:this._queryRowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel})},_onStatusChanged:function(){x({queryRowsCollection:this._queryRowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel},this.render)},_onQueryChanged:function(){this._hasError()&&this.render()},_getInitialState:function(){return y.ready},_hasError:function(){return this.modelView.get("state")===y.error},_renderError:function(){this.$el.append(j({body:_t("editor.error-query.body",{action:k({label:_t("editor.error-query.label")})})}))},_renderGeoreferencePlaceholder:function(){var a=this,b=[{state:"layer-hidden",createContentView:function(){return q.createWithAction({type:"alert",title:_t("editor.infowindow.messages.layer-hidden.title"),body:_t("editor.infowindow.messages.layer-hidden.body"),mainAction:{label:_t("editor.infowindow.messages.layer-hidden.show")}})},mainAction:a._showHiddenLayer.bind(a)}],c=new s(b),d=new t({template:v,className:"Editor-content",editorModel:a._editorModel,infoboxModel:a._infoboxModel,infoboxCollection:c,createContentView:function(){return u.createByHTML(o())}});this.$el.append(d.render().el),this.addView(d)},_renderEmptyGeometry:function(){this.$el.append(m())},_renderLoading:function(){this.$el.append(l())},_initViews:function(){var a=this,b=[{name:"color",label:_t("editor.legend.menu-tab-pane-labels.color"),createContentView:function(){return new f({className:"Editor-content",mapDefinitionModel:a._mapDefinitionModel,editorModel:a._editorModel,userActions:a._userActions,modelView:a.modelView,layerDefinitionModel:a._layerDefinitionModel,legendDefinitionsCollection:a._legendDefinitionsCollection,type:"color",userModel:a._userModel,configModel:a._configModel,modals:a._modals})}},{name:"size",label:_t("editor.legend.menu-tab-pane-labels.size"),createContentView:function(){return new g({className:"Editor-content",mapDefinitionModel:a._mapDefinitionModel,editorModel:a._editorModel,userActions:a._userActions,userModel:a._userModel,configModel:a._configModel,modals:a._modals,modelView:a.modelView,layerDefinitionModel:a._layerDefinitionModel,legendDefinitionsCollection:a._legendDefinitionsCollection,type:"size"})}}],c={tabPaneOptions:{template:i,tabPaneItemOptions:{tagName:"li",className:"CDB-NavSubmenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavSubmenu-link u-upperCase"}};this._layerTabPaneView=h(b,c),this.$el.append(this._layerTabPaneView.render().$el),this.addView(this._layerTabPaneView),this._changeStyle(this._editorModel)},_changeStyle:function(a){this._layerTabPaneView.changeStyleMenu(a)},_showHiddenLayer:function(){var a={shouldPreserveAutoStyle:!0};this._layerDefinitionModel.toggleVisible(),this._userActions.saveLayer(this._layerDefinitionModel,a)}})},{"../../../../components/infobox/infobox-collection":215,"../../../../components/infobox/infobox-factory":216,"../../../../components/infobox/infobox-model":219,"../../../../components/tab-pane/create-text-labels-tab-pane":537,"../../../../components/view-factory":594,"../../../../components/view-options/panel-with-options-view":595,"../../../../helpers/fetch-all-query-objects":1092,"../../../../helpers/required-opts":1097,"../../../components/overlay/overlay-view":694,"../../../tab-pane-submenu.tpl":1054,"../../panel-loading-template.tpl":996,"../../query-sanity-check":997,"../../sql-error-action.tpl":1e3,"./color/legend-color-view":941,"./georeference-placeholder.tpl":954,"./legend-content-sql-error.tpl":957,"./legend-no-geometry-template.tpl":963,"./panel-with-options.tpl":968,"./size/legend-size-view":970,backbone:"backbone","backbone/core-view":1127
}],968:[function(a,b,c){arguments[4][882][0].apply(c,arguments)},{dup:882,underscore:"underscore"}],969:[function(a,b,c){var d=a("underscore");b.exports=[{value:"none",legendIcon:a("../carousel-icons/none.tpl"),label:_t("editor.legend.types.none")},{value:"bubble",legendIcon:a("../carousel-icons/bubble.tpl"),label:_t("editor.legend.types.bubble"),isStyleCompatible:function(a){var b,c=a.get("fill"),e=a.get("stroke");return!(!c&&!e||d.isEmpty(c)&&d.isEmpty(e))&&(b=c&&c.size||e&&e.size,b&&void 0!==b.attribute)}}]},{"../carousel-icons/bubble.tpl":934,"../carousel-icons/none.tpl":938,underscore:"underscore"}],970:[function(a,b,c){var d=a("./legend-size-types"),e=a("../legend-base-type-view");b.exports=e.extend({initialize:function(a){this.legendTypes=d,e.prototype.initialize.call(this,a)}})},{"../legend-base-type-view":955,"./legend-size-types":969}],971:[function(a,b,c){var d=a("backbone/core-view"),e=a("backbone"),f=a("./layer-header.tpl"),g=a("./sync-info/sync-info-view"),h=a("../../components/context-menu/context-menu-view"),i=a("../../components/custom-list/custom-list-collection"),j=a("../../data/visualization-table-model"),k=a("./operations/rename-layer"),l=a("../../components/modals/remove-layer/delete-layer-confirmation-view"),m=a("../../components/inline-editor/inline-editor-view"),n=a("../../components/modals/export-data/modal-export-data-view"),o=a("./inline-editor.tpl"),p=a("../../data/layer-colors"),q=a("../map-operations/zoom-to-data"),r=a("../../components/tipsy-tooltip-view"),s=a("../../helpers/required-opts"),t=["modals","userActions","layerDefinitionModel","layerDefinitionsCollection","configModel","stateDefinitionModel","editorModel","userModel","visDefinitionModel","widgetDefinitionsCollection"];b.exports=d.extend({className:"js-editorPanelHeader",events:{"click .js-toggle-menu":"_onToggleContextMenuClicked","click .js-zoom":"_onZoomClicked","blur .js-input":"_hideRenameInput","keyup .js-input":"_onKeyUpInput"},initialize:function(a){if(s(a,t,this),this._tableNodeModel=a.tableNodeModel,this._sourceNode=this._getSourceNode(),this._topQueryGeometryModel=null,this._sourceNode){var b=this._sourceNode.get("table_name");this._visTableModel=new j({id:b,table:{name:b}},{configModel:this._configModel})}this._uiModel=new e.Model({zoomVisible:this._isQueryGeometryVisible()}),this._changeStyle=this._changeStyle.bind(this),this._bindEvents(),this._onSourceChanged()},render:function(){this.clearSubViews();var a="",b="";if(this._visTableModel){var c=this._visTableModel.getTableModel();a=c.getUnquotedName(),b=this._visTableModel&&this._visTableModel.datasetURL()}var d=this._layerDefinitionModel.get("letter");this.$el.html(f({letter:d,bgColor:p.getColorForLetter(d),isTableSource:!!this._sourceNode,url:b,tableName:a,title:this._layerDefinitionModel.getTableName().replace(/_/gi," "),alias:this._layerDefinitionModel.getName()}));var e=new r({el:this._getZoom(),gravity:"w",title:function(){return _t("editor.layers.options.center-map")}});return this.addView(e),this._showOrHideZoomVisibility(),this._initViews(),this},_initViews:function(){this._addSyncInfo(),this._inlineEditor=new m({template:o,renderOptions:{alias:this._layerDefinitionModel.getName()},onEdit:this._renameLayer.bind(this)}),this.addView(this._inlineEditor),this.$(".js-header").append(this._inlineEditor.render().el)},_addSyncInfo:function(){var a=this._layerDefinitionModel.getAnalysisDefinitionNodeModel();a&&a.tableModel&&a.tableModel.isSync()&&this._createSyncInfo(a.tableModel)},_createSyncInfo:function(a){var b=a.getSyncModel();this._syncInfoView=new g({modals:this._modals,syncModel:a._syncModel,tableModel:a,userModel:this._userModel}),this.addView(this._syncInfoView),this.$el.prepend(this._syncInfoView.render().el),b.bind("destroy",this._destroySyncInfo,this),this.add_related_model(b)},_destroySyncInfo:function(){this.removeView(this._syncInfoView),this._syncInfoView.clean(),delete this._syncInfoView},_bindEvents:function(){this._tableNodeModel&&(this._tableNodeModel.bind("change:synchronization",this.render,this),this.add_related_model(this._tableNodeModel)),this._layerDefinitionModel.bind("change:source",this.render,this),this._layerDefinitionModel.bind("change:source",this._onSourceChanged,this),this._editorModel.on("change:edition",this._changeStyle,this),this._uiModel.on("change:zoomVisible",this._showOrHideZoomVisibility,this),this.add_related_model(this._editorModel),this.add_related_model(this._layerDefinitionModel)},_getSourceNode:function(){var a,b=this._layerDefinitionModel.getAnalysisDefinitionNodeModel();if("source"===b.get("type"))a=b;else{var c=b.getPrimarySource();c&&"source"===c.get("type")&&(a=c)}return a},_onSourceChanged:function(){var a=this._layerDefinitionModel.getAnalysisDefinitionNodeModel();null!==this._topQueryGeometryModel&&this._topQueryGeometryModel.unbind("change:simple_geom"),this._topQueryGeometryModel=a.queryGeometryModel.bind("change:simple_geom",this._checkIfGeometryVisible,this),this._checkIfGeometryVisible()},_isQueryGeometryVisible:function(){var a=this._layerDefinitionModel.getAnalysisDefinitionNodeModel();return!!a.queryGeometryModel.get("simple_geom")},_checkIfGeometryVisible:function(){this._uiModel.set("zoomVisible",this._isQueryGeometryVisible())},_changeStyle:function(){var a=this._editorModel.isEditing();this._getTitle().toggleClass("u-whiteTextColor",a),this._getIcon().toggleClass("is-white",a),this._getInlineEditor().toggleClass("u-mainTextColor",a),this._getLink().toggleClass("u-altTextColor",a),this._getBack().toggleClass("u-whiteTextColor",a),this._getToggleMenu().toggleClass("is-white",a),this._getZoom().toggleClass("is-white",a)},_getInlineEditor:function(){return this.$(".Inline-editor-input")},_getTitle:function(){return this.$(".Editor-HeaderInfo-titleText")},_getIcon:function(){return this.$(".CDB-Shape-Dataset")},_getLink:function(){return this.$(".CDB-Text a")},_getBack:function(){return this.$(".js-back")},_getToggleMenu:function(){return this.$(".CDB-Shape-threePoints")},_getZoom:function(){return this.$(".js-zoom")},_onToggleContextMenuClicked:function(a){this._hasContextMenu()?this._hideContextMenu():this._showContextMenu({x:a.pageX,y:a.pageY})},_hasContextMenu:function(){return null!=this._menuView},_showContextMenu:function(a){var b=new i([{label:_t("editor.layers.options.rename"),val:"rename-layer"},{label:this._layerHidden()?_t("editor.layers.options.show"):_t("editor.layers.options.hide"),val:"toggle-layer"},{label:_t("editor.layers.options.export"),val:"export-data"}]);this._layerDefinitionModel.canBeDeletedByUser()&&b.add({label:_t("editor.layers.options.delete"),val:"delete-layer",destructive:!0});var c="context-menu-trigger-"+this._layerDefinitionModel.cid;this.$(".js-toggle-menu").attr("id",c),this._menuView=new h({collection:b,triggerElementID:c,position:a}),b.bind("change:selected",function(a){if("delete-layer"===a.get("val")&&this._confirmDeleteLayer(),"rename-layer"===a.get("val")&&this._inlineEditor.edit(),"toggle-layer"===a.get("val")){var b={shouldPreserveAutoStyle:!0};this._layerDefinitionModel.toggleVisible(),this._userActions.saveLayer(this._layerDefinitionModel,b)}"export-data"===a.get("val")&&this._exportLayer()},this),this._menuView.model.bind("change:visible",function(a,b){this._hasContextMenu()&&!b&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView)},_confirmDeleteLayer:function(){this._modals.create(function(a){var b=new l({userActions:this._userActions,modals:this._modals,layerModel:this._layerDefinitionModel,modalModel:a,visDefinitionModel:this._visDefinitionModel,widgetDefinitionsCollection:this._widgetDefinitionsCollection});return b}.bind(this))},_hideContextMenu:function(){this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_exportLayer:function(){var a=this._layerDefinitionModel.getAnalysisDefinitionNodeModel(),b=a.queryGeometryModel;this._modals.create(function(a){return new n({modalModel:a,queryGeometryModel:b,configModel:this._configModel,fileName:this._layerDefinitionModel.getName()})}.bind(this))},_renameLayer:function(){var a=this._inlineEditor.getValue();""!==a&&(this._onSaveSuccess(a),k({newName:a,userActions:this._userActions,layerDefinitionsCollection:this._layerDefinitionsCollection,layerDefinitionModel:this._layerDefinitionModel,onError:this._onSaveError.bind(this)}))},_onSaveSuccess:function(a){this.$(".js-title").text(a).show(),this._inlineEditor.hide()},_onSaveError:function(a){this.$(".js-title").text(a).show(),this._inlineEditor.hide()},_layerHidden:function(){return this._layerDefinitionModel.get("visible")===!1},_onZoomClicked:function(){var a=this._layerDefinitionModel.getAnalysisDefinitionNodeModel(),b=a.querySchemaModel.get("query");q(this._configModel,this._stateDefinitionModel,b)},_showOrHideZoomVisibility:function(){this._getZoom().toggle(this._isQueryGeometryVisible())}})},{"../../components/context-menu/context-menu-view":39,"../../components/custom-list/custom-list-collection":47,"../../components/inline-editor/inline-editor-view":223,"../../components/modals/export-data/modal-export-data-view":408,"../../components/modals/remove-layer/delete-layer-confirmation-view":453,"../../components/tipsy-tooltip-view":589,"../../data/layer-colors":633,"../../data/visualization-table-model":677,"../../helpers/required-opts":1097,"../map-operations/zoom-to-data":1005,"./inline-editor.tpl":787,"./layer-header.tpl":972,"./operations/rename-layer":995,"./sync-info/sync-info-view":1001,backbone:"backbone","backbone/core-view":1127}],972:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfoEditor">\n  <div class="u-rSpace--xl u-actionTextColor js-back Editor-HeaderInfoEditorShape">\n    <button>\n      <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n    </button>\n  </div>\n\n  <div class="Editor-HeaderInfo-inner u-ellipsis">\n    <div class="Editor-HeaderInfo-title u-bSpace js-header">\n      <span class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-tSpace--m u-rSpace--m u-upperCase" style="background-color: '+(null==(__t=bgColor)?"":_.escape(__t))+';">\n        '+(null==(__t=letter)?"":_.escape(__t))+'\n      </span>\n    </div>\n    <div class="u-flex u-ellipsis">\n      ',isTableSource&&(__p+='\n        <div class="CDB-Shape CDB-Size-medium u-rSpace">\n          <ul class="CDB-Shape-Dataset is-small is-grey">\n            <li class="CDB-Shape-DatasetItem"></li>\n            <li class="CDB-Shape-DatasetItem"></li>\n          </ul>\n        </div>\n        <p class="CDB-Text CDB-Size-medium u-ellipsis">\n          <a href="'+(null==(__t=url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=tableName)?"":_.escape(__t))+'" class="Editor-headerLayerName">'+(null==(__t=tableName)?"":_.escape(__t))+"</a>\n        </p>\n      "),__p+='\n    </div>\n  </div>\n\n  <ul class="u-flex u-tSpace-xl">\n    <li class="u-rSpace">\n      <button class="Editor-HeaderInfo-zoom CDB-Shape js-zoom">\n        <svg width="16px" height="15px" viewBox="287 30 16 15" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Icon" stroke="none" stroke-width="1" fill-rule="evenodd" transform="translate(288.000000, 30.000000)">\n            <circle id="Oval" cx="7.5" cy="7.5" r="0.5"></circle>\n            <path d="M7,0 L8,0 L8,5 L7,5 L7,0 Z M6,3 L7,3 L7,4 L6,4 L6,3 Z M8,3 L9,3 L9,4 L8,4 L8,3 Z M9,2 L10,2 L10,3 L9,3 L9,2 Z M5,2 L6,2 L6,3 L5,3 L5,2 Z" id="Combined-Shape"></path>\n            <path d="M7,10 L8,10 L8,15 L7,15 L7,10 Z M6,13 L7,13 L7,14 L6,14 L6,13 Z M8,13 L9,13 L9,14 L8,14 L8,13 Z M9,12 L10,12 L10,13 L9,13 L9,12 Z M5,12 L6,12 L6,13 L5,13 L5,12 Z" id="Combined-Shape" transform="translate(7.500000, 12.500000) scale(1, -1) translate(-7.500000, -12.500000) "></path>\n            <path d="M12,5 L13,5 L13,10 L12,10 L12,5 Z M11,8 L12,8 L12,9 L11,9 L11,8 Z M13,8 L14,8 L14,9 L13,9 L13,8 Z M14,7 L15,7 L15,8 L14,8 L14,7 Z M10,7 L11,7 L11,8 L10,8 L10,7 Z" id="Combined-Shape" transform="translate(12.500000, 7.500000) scale(1, -1) rotate(90.000000) translate(-12.500000, -7.500000) "></path>\n            <path d="M2,5 L3,5 L3,10 L2,10 L2,5 Z M1,8 L2,8 L2,9 L1,9 L1,8 Z M3,8 L4,8 L4,9 L3,9 L3,8 Z M4,7 L5,7 L5,8 L4,8 L4,7 Z M0,7 L1,7 L1,8 L0,8 L0,7 Z" id="Combined-Shape" transform="translate(2.500000, 7.500000) scale(-1, -1) rotate(90.000000) translate(-2.500000, -7.500000) "></path>\n          </g>\n        </svg>\n      </button>\n    </li>\n    <li class="CDB-Shape">\n      <button class="CDB-Shape-threePoints is-blue is-small js-toggle-menu">\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n      </button>\n    </li>\n  </ul>\n\n</div>\n';return __p}},{underscore:"underscore"}],973:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<nav class="CDB-NavMenu js-theme">\n  <ul class="CDB-NavMenu-inner CDB-Text is-semibold CDB-Size-medium js-menu"></ul>\n</nav>\n<div class="Editor-content js-content"></div>\n';return __p}},{underscore:"underscore"}],974:[function(a,b,c){var d=a("underscore"),e=a("../../data/layer-types-and-kinds"),f=a("./layer-views/base-tiled-layer-view"),g=a("./layer-views/plain-color-layer-view"),h=a("./layer-views/background-image-layer-view"),i=a("./layer-views/google-maps-base-layer-view"),j=a("./layer-views/data-layer-view"),k=a("./layer-views/labels-layer-view"),l=a("./layer-analyses-view"),m=a("./layer-analysis-view-factory"),n=a("../../helpers/required-opts"),o=["stackLayoutModel","userActions","layerDefinitionsCollection","analysisDefinitionNodesCollection","modals","configModel","sortableSelector","stateDefinitionModel","visDefinitionModel","widgetDefinitionsCollection"],p=function(a){a=a||{},n(a,o,this)};p.prototype.createLayerView=function(a){var b={model:a,stackLayoutModel:this._stackLayoutModel,modals:this._modals,stateDefinitionModel:this._stateDefinitionModel,configModel:this._configModel};a.isDataLayer()&&(b=d.extend(b,{userActions:this._userActions,layerDefinitionsCollection:this._layerDefinitionsCollection,newAnalysesView:this._newAnalysesView.bind(this),widgetDefinitionsCollection:this._widgetDefinitionsCollection,visDefinitionModel:this._visDefinitionModel,analysisDefinitionNodesCollection:this._analysisDefinitionNodesCollection}));var c=this._getLayerViewClass(a);return new c(b)},p.prototype._getLayerViewClass=function(a){if(this._isTiledBaseLayer(a))return f;if(this._isPlainColorBaseLayer(a))return g;if(this._isBackgroundImageBaseLayer(a))return h;if(this._isGoogleMapsBaseLayer(a))return i;if(a.isDataLayer())return j;if(this._isLabelsLayer(a))return k;throw new Error('No layer view for type "'+a.get("type")+'" just yet.')},p.prototype._isBaseLayer=function(a){return 0===a.get("order")},p.prototype._isTiledBaseLayer=function(a){var b=a.get("type");return e.isTiledType(b)&&this._isBaseLayer(a)},p.prototype._isPlainColorBaseLayer=function(a){var b=a.get("type");return e.isPlainType(b)&&this._isBaseLayer(a)&&a.get("color")},p.prototype._isBackgroundImageBaseLayer=function(a){var b=a.get("type");return e.isPlainType(b)&&this._isBaseLayer(a)&&a.get("image")},p.prototype._isGoogleMapsBaseLayer=function(a){var b=a.get("type");return e.isGMapsBase(b)&&this._isBaseLayer(a)},p.prototype._isLabelsLayer=function(a){var b=a.get("type");return e.isTiledType(b)&&!this._isBaseLayer(a)},p.prototype._newAnalysesView=function(a,b){var c=new m(this._analysisDefinitionNodesCollection);return new l({el:a,model:b,layerAnalysisViewFactory:c,sortableSelector:this._sortableSelector})},b.exports=p},{"../../data/layer-types-and-kinds":637,"../../helpers/required-opts":1097,"./layer-analyses-view":788,"./layer-analysis-view-factory":791,"./layer-views/background-image-layer-view":975,"./layer-views/base-tiled-layer-view":977,"./layer-views/data-layer-view":978,"./layer-views/google-maps-base-layer-view":984,"./layer-views/labels-layer-view":987,"./layer-views/plain-color-layer-view":988,underscore:"underscore"}],975:[function(a,b,c){var d=a("underscore"),e=a("./base-layer-view-base"),f=a("./image-thumbnail-layer.tpl");b.exports=e.extend({_getCompiledTemplate:function(){return f({title:this._getImageFileName(),desc:_t("editor.layers.image.title-label"),imgURL:this.model.get("image")})},_getImageFileName:function(){var a=this.model.get("image"),b=d.last(a.split("/")),c=b.split("?")[0];return c}})},{"./base-layer-view-base":976,"./image-thumbnail-layer.tpl":985,underscore:"underscore"}],976:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({tagName:"li",className:"BlockList-item js-layer ui-state-disabled",events:{click:"_onEditBasemap"},initialize:function(a){if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");this._stackLayoutModel=a.stackLayoutModel,this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(this._getCompiledTemplate()),this},_getCompiledTemplate:function(){throw new Error("subclasses of BasemapLayerViewBase must implement _getCompiledTemplate")},_onEditBasemap:function(a){a.stopPropagation(),this._stackLayoutModel.nextStep(this.model,"basemaps")}})},{"backbone/core-view":1127}],977:[function(a,b,c){var d=a("./base-layer-view-base"),e=a("./image-thumbnail-layer.tpl"),f="a",g=30,h=24,i=6,j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAZ9JREFUWAntWUtugzAUNKbAJl1EYtcz9Ba5UE6SC+UWPUN3SNlkw78zVhJRCeIXbCup6ic5gP08Ho/x40ESBauq6iNJkgPKDpdb1j3RTuM4HlH2ZVl+JySXpukXygaksiViRVEsNd3qu65Tfd/frpdO8jxXEGO2GcTUMAxtXddnYH1qKqe1fof3IrlZpECVJA6xMgiyMdzws0N5CzTealiIlpGbBsKz77nZSYAc67ck+NIWCbouj1cFL/eNK6df/UW7FztKMT7ZTOJDDMQ5RUyJGYK2IMyBm6ax4nFQGxZBEIStWFcH2TSu3pZjiCX2StDCf1VzJLhKtkmnqOBEjFWn/0tBaaB+REoTqJkJ2wxJpM3FtPvGMgQlabrkCUEcCcF7Kf9UBT5xvN6DIZbYK8Hp7H2dR4KuSkYFo4KPKBAiYTWBmoHznvEdQpKm82ljw+I4DObElJghaJu59AWHA9qw6CMlR9+4i6mCi0UFXdRj3z+hIL8Ju040VP+TBrkjtn0bagQH3JbcSHB/+WDNCgc8r11bZOdncjPfWV/5b4gfOaaYLUG/QVoAAAAASUVORK5CYII=",k=_t("editor.layers.basemap.custom-basemap");b.exports=d.extend({_getCompiledTemplate:function(){var a=this.model.getName()||k,b=_t("editor.layers.basemap.title-label");return e({title:a,desc:a===b?"":b,imgURL:this._getImageURL()})},_getImageURL:function(){var a=this,b=this._lowerXYZ(),c=new Image;return c.onerror=function(){a.$(".js-thumbnailImg").attr("src",j)},c.src=b,b},_getSubdomain:function(){var a=this.model.get("subdomains");return a&&a.length?a[0]:f},_lowerXYZ:function(){return this.model.get("urlTemplate").replace("{s}",this._getSubdomain()).replace("{z}",i).replace("{x}",g).replace("{y}",h)}})},{"./base-layer-view-base":976,"./image-thumbnail-layer.tpl":985}],978:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone/core-view"),g=a("./data-layer.tpl"),h=a("../../../components/context-menu/context-menu-view"),i=a("../../../components/custom-list/custom-list-collection"),j=a("../operations/rename-layer"),k=a("../../../components/modals/remove-layer/delete-layer-confirmation-view"),l=a("../../../components/modals/export-data/modal-export-data-view"),m=a("../../../components/inline-editor/inline-editor-view"),n=a("../../../components/tipsy-tooltip-view"),o=a("../../map-operations/zoom-to-data"),p=a("./inline-editor.tpl"),q=a("./geometry-none.tpl"),r=a("./geometry-points.tpl"),s=a("./geometry-lines.tpl"),t=a("./geometry-polygons.tpl"),u=a("../../../helpers/required-opts"),v=["userActions","stackLayoutModel","layerDefinitionsCollection","modals","configModel","stateDefinitionModel","widgetDefinitionsCollection","visDefinitionModel","analysisDefinitionNodesCollection"];b.exports=f.extend({tagName:"li",className:"Editor-ListLayer-item js-layer",events:{click:"_onEditLayer","click .js-base":"_onClickSource","click .js-title":"_onClickTitle","click .js-toggle-menu":"_onToggleContextMenuClicked","click .js-toggle":"_onToggleLayerClicked","click .js-analysis-node":"_onAnalysisNodeClicked"},initialize:function(a){if(u(a,v,this),!d.isFunction(a.newAnalysesView))throw new Error("newAnalysesView is required as a function");this._newAnalysesView=a.newAnalysesView,this._styleModel=this.model.styleModel;var b=this.model.getAnalysisDefinitionNodeModel();this._queryGeometryModel=b.queryGeometryModel,this._bindEvents(),this._queryGeometryModel.shouldFetch()&&this._queryGeometryModel.fetch()},render:function(){this.clearSubViews();var a=this.model,b=this,c=a.isTorqueLayer(),d=this._styleModel.isAnimation(),f=this._getGeometryTemplate(this._queryGeometryModel.get("simple_geom"));if(this.$el.html(g({layerId:a.id,title:a.getName(),color:a.get("color"),isVisible:a.get("visible"),isAnimated:d,isTorque:c,hasError:this._hasError(),isCollapsed:this._isCollapsed(),numberOfAnalyses:a.getNumberOfAnalyses(),numberOfWidgets:this._widgetDefinitionsCollection.widgetsOwnedByLayer(a.id),hasGeom:this._queryGeometryHasGeom()})),this._inlineEditor=new m({template:p,renderOptions:{title:a.getName()},onClick:b._onEditLayer.bind(b),onEdit:b._renameLayer.bind(b)}),this.addView(this._inlineEditor),this.$(".js-thumbnail").append(f({letter:a.get("letter")})),this.$(".js-header").append(this._inlineEditor.render().el),this.$el.toggleClass("is-unavailable",a.isNew()),this.$el.toggleClass("js-sortable-item",!c),this.$el.toggleClass("is-animated",c),this.$(".js-thumbnail").toggleClass("is-hidden",this._isHidden()),this.$(".js-title").toggleClass("is-hidden",this._isHidden()),this.$(".js-analyses-widgets-info").toggleClass("is-hidden",this._isHidden()),c){var h=new n({el:this.$(".js-torqueIcon"),gravity:"s",offset:0,title:function(){return e(this).data("tooltip")}});this.addView(h)}if(!this._queryGeometryHasGeom()){var i=new n({el:this.$(".js-georeferenceIcon"),gravity:"s",offset:0,title:function(){return e(this).data("tooltip")}});this.addView(i)}if(this._toggleClickEventsOnCapturePhase("remove"),a.isNew()&&this._toggleClickEventsOnCapturePhase("add"),a.get("source")){var j=this._newAnalysesView(this.$(".js-analyses"),a);this.addView(j),j.render()}if(this._hasError()){var k=new n({el:this.$(".js-error"),gravity:"s",offset:0,title:function(){return this.model.get("error")&&this.model.get("error").message}.bind(this)});this.addView(k)}return this},_bindEvents:function(){this.listenTo(this.model,"change",this.render),this.listenToOnce(this.model,"destroy",this._onDestroy),this.listenTo(this.model,"change:collapsed",this.render),this.listenTo(this._queryGeometryModel,"change:simple_geom",this.render)},_getGeometryTemplate:function(a){switch(a){case"line":return s;case"point":return r;case"polygon":return t;default:return q}},_isHidden:function(){return!this.model.get("visible")},_hasError:function(){return!!this.model.get("error")},_isCollapsed:function(){return!!this.model.get("collapsed")},_onClickTitle:function(a){a.stopPropagation()},_onAnalysisNodeClicked:function(a){a.stopPropagation();var b=a.currentTarget&&a.currentTarget.dataset.analysisNodeId;if(!b)throw new Error("missing data-analysis-node-id on element to edit analysis node, the element was: "+a.currentTarget.outerHTML);var c=this._analysisDefinitionNodesCollection.get(b),d=this._layerDefinitionsCollection.findOwnerOfAnalysisNode(c);if(!d)throw new Error("no owning layer found for node "+b);this._stackLayoutModel.nextStep(d,"layer-content","analyses",b)},_onClickSource:function(a){a.stopPropagation(),this._stackLayoutModel.nextStep(this.model,"layer-content")},_onEditLayer:function(a){a&&a.stopPropagation(),this._stackLayoutModel.nextStep(this.model,"layer-content","style")},_onToggleCollapsedLayer:function(){this.model.toggleCollapse()},_onToggleLayerClicked:function(a){a.stopPropagation();var b={shouldPreserveAutoStyle:!0};this.model.toggleVisible(),this._userActions.saveLayer(this.model,b)},_onToggleContextMenuClicked:function(a){a.stopPropagation(),this._hasContextMenu()?this._hideContextMenu():this._showContextMenu({x:a.pageX,y:a.pageY})},_hasContextMenu:function(){return this._menuView},_hideContextMenu:function(){this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_showContextMenu:function(a){var b=new i([{label:this._isCollapsed()?_t("editor.layers.options.expand"):_t("editor.layers.options.collapse"),val:"collapse-expand-layer"},{label:_t("editor.layers.options.rename"),val:"rename-layer"},{label:_t("editor.layers.options.export"),val:"export-data"},{label:_t("editor.layers.options.edit"),val:"edit-layer"}]);this._queryGeometryHasGeom()&&b.add({label:_t("editor.layers.options.center-map"),val:"center-map"}),this.model.canBeDeletedByUser()&&b.add({label:_t("editor.layers.options.delete"),val:"delete-layer",destructive:!0});var c="context-menu-trigger-"+this.model.cid;this.$(".js-toggle-menu").attr("id",c),this._menuView=new h({collection:b,triggerElementID:c,position:a}),b.bind("change:selected",function(a){var b=a.get("val");"delete-layer"===b&&this._confirmDeleteLayer(),"collapse-expand-layer"===b&&this._onToggleCollapsedLayer(),"rename-layer"===b&&this._inlineEditor.edit(),"export-data"===b&&this._exportLayer(),"edit-layer"===b&&this._onEditLayer(),"center-map"===b&&this._centerMap()},this),this._menuView.model.bind("change:visible",function(a,b){this._hasContextMenu()&&!b&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView)},_exportLayer:function(){var a=this.model.getAnalysisDefinitionNodeModel(),b=a.queryGeometryModel;this._modals.create(function(a){return new l({modalModel:a,queryGeometryModel:b,configModel:this._configModel,fileName:this.model.getName()})}.bind(this))},_confirmDeleteLayer:function(){this._modals.create(function(a){var b=new k({userActions:this._userActions,modals:this._modals,layerModel:this.model,modalModel:a,visDefinitionModel:this._visDefinitionModel,widgetDefinitionsCollection:this._widgetDefinitionsCollection});return b}.bind(this))},_renameLayer:function(){var a=this._inlineEditor.getValue();""!==a&&(this._onSaveSuccess(a),j({newName:a,userActions:this._userActions,layerDefinitionsCollection:this._layerDefinitionsCollection,layerDefinitionModel:this.model,onError:this._onSaveError.bind(this)}))},_onSaveSuccess:function(a){this.$(".js-title").text(a).show(),this._inlineEditor.hide()},_onSaveError:function(a){this.$(".js-title").text(a).show(),this._inlineEditor.hide()},_onDestroy:function(){this.clean()},_disableEventsOnCapturePhase:function(a){a.stopPropagation(),a.preventDefault()},_toggleClickEventsOnCapturePhase:function(a){var b="add"===a?"add":"remove";this.el[b+"EventListener"]("click",this._disableEventsOnCapturePhase,!0)},_centerMap:function(){var a=this.model.getAnalysisDefinitionNodeModel(),b=a.querySchemaModel.get("query");o(this._configModel,this._stateDefinitionModel,b)},_queryGeometryHasGeom:function(){return!!this._queryGeometryModel.hasValue()},clean:function(){this._toggleClickEventsOnCapturePhase("remove"),f.prototype.clean.apply(this)}})},{"../../../components/context-menu/context-menu-view":39,"../../../components/custom-list/custom-list-collection":47,"../../../components/inline-editor/inline-editor-view":223,"../../../components/modals/export-data/modal-export-data-view":408,"../../../components/modals/remove-layer/delete-layer-confirmation-view":453,"../../../components/tipsy-tooltip-view":589,"../../../helpers/required-opts":1097,"../../map-operations/zoom-to-data":1005,"../operations/rename-layer":995,"./data-layer.tpl":979,"./geometry-lines.tpl":980,"./geometry-none.tpl":981,"./geometry-points.tpl":982,"./geometry-polygons.tpl":983,"./inline-editor.tpl":986,"backbone/core-view":1127,jquery:"jquery",underscore:"underscore"}],979:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",hasError&&(__p+='\n  <div class="Editor-ListLayer-itemError js-error"></div>\n'),__p+="\n\n",isTorque||(__p+='\n  <div class="Editor-ListLayer-dragIcon">\n    <div class="CDB-Shape">\n      <div class="CDB-Shape-rectsHandle is-small">\n        <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-first"></div>\n        <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-second"></div>\n        <div class="CDB-Shape-rectsHandleItem CDB-Shape-rectsHandleItem--grey is-third"></div>\n      </div>\n    </div>\n  </div>\n'),__p+='\n<div class="Editor-ListLayer-itemHeader">\n  <div class="Editor-ListLayer-media u-rSpace--m js-thumbnail" style="background: '+(null==(__t=color)?"":_.escape(__t))+'; color: #fff">\n  </div>\n  <div class="Editor-ListLayer-inner">\n    <div class="Editor-ListLayer-title">\n      <div class="Editor-ListLayer-titleText js-Editor-ListLayer-titleText js-header"></div>\n      <ul class="Editor-HeaderInfo-actions">\n        ',isTorque&&(__p+='\n          <li class="Editor-HeaderInfo-actionsItem u-rSpace">\n            ',__p+=isAnimated?'\n              <svg class="js-torqueIcon" width="19px" height="8px" viewBox="222 24 19 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-tooltip="'+(null==(__t=_t("editor.layers.layer.animated"))?"":_.escape(__t))+'">\n                <g id="Animated-Icon" opacity="0.6" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(222.000000, 24.000000)">\n                  <rect id="Rectangle-649" fill="#2E3C43" x="11" y="0" width="8" height="8" rx="4"></rect>\n                  <rect id="Rectangle-649" fill="#2E3C43" opacity="0.5" x="5" y="0" width="8" height="8" rx="4"></rect>\n                  <rect id="Rectangle-649" fill="#2E3C43" opacity="0.2" x="0" y="0" width="8" height="8" rx="4"></rect>\n                </g>\n              </svg>\n            ':'\n              <svg class="js-torqueIcon" width="31px" height="17px" viewBox="563 512 31 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-tooltip="'+(null==(__t=_t("editor.layers.layer.heatmap"))?"":_.escape(__t))+'">\n                <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(563.000000, 512.000000)">\n                  <ellipse id="Oval-120" fill="#E6E8E8" transform="translate(27.020000, 12.197917) rotate(-90.000000) translate(-27.020000, -12.197917) " cx="27.02" cy="12.1979167" rx="3.875" ry="3.84"></ellipse>\n                  <path d="M26.93,13.0729167 C27.3442136,13.0729167 27.68,12.7371302 27.68,12.3229167 C27.68,11.9087031 27.3442136,11.5729167 26.93,11.5729167 C26.5157864,11.5729167 26.18,11.9087031 26.18,12.3229167 C26.18,12.7371302 26.5157864,13.0729167 26.93,13.0729167 Z" id="Oval-120-Copy-2" fill="#828A8F" opacity="0.8" transform="translate(26.930000, 12.322917) rotate(-90.000000) translate(-26.930000, -12.322917) "></path>\n                  <ellipse id="Oval-120" fill="#E6E8E8" transform="translate(8.140000, 8.000000) rotate(-90.000000) translate(-8.140000, -8.000000) " cx="8.14" cy="8" rx="7.75" ry="7.68"></ellipse>\n                  <path d="M7.96,10.75 C9.34071187,10.75 10.46,9.63071187 10.46,8.25 C10.46,6.86928813 9.34071187,5.75 7.96,5.75 C6.57928813,5.75 5.46,6.86928813 5.46,8.25 C5.46,9.63071187 6.57928813,10.75 7.96,10.75 Z" id="Oval-120-Copy-2" fill="#828A8F" transform="translate(7.960000, 8.250000) rotate(-90.000000) translate(-7.960000, -8.250000) "></path>\n                  <path d="M15.1403347,6.71285923 C15.4606435,9.05621552 17.487459,10.8625 19.94,10.8625 C22.6151293,10.8625 24.78375,8.7134668 24.78375,6.0625 C24.78375,3.4115332 22.6151293,1.2625 19.94,1.2625 C17.2648707,1.2625 15.09625,3.4115332 15.09625,6.0625 C15.09625,6.28307774 15.1112641,6.50018043 15.1403347,6.71285923 Z" id="Oval-120" fill="#E6E8E8" transform="translate(19.940000, 6.062500) rotate(-90.000000) translate(-19.940000, -6.062500) "></path>\n                  <path d="M20.64,7.90625 C21.4684271,7.90625 22.14,7.23467712 22.14,6.40625 C22.14,5.57782288 21.4684271,4.90625 20.64,4.90625 C19.8115729,4.90625 19.14,5.57782288 19.14,6.40625 C19.14,7.23467712 19.8115729,7.90625 20.64,7.90625 Z" id="Oval-120-Copy-2" fill="#828A8F" opacity="0.8" transform="translate(20.640000, 6.406250) rotate(-90.000000) translate(-20.640000, -6.406250) "></path>\n                  <path d="M13.5625,2.88 C13.5625,2.88 16.1458333,5.12 18.0833333,2.56 C17.4375,4.16 17.1145833,5.44 17.1145833,5.44 L16.46875,6.72 L14.2083333,4.8 L13.5625,2.88 Z" id="Path-494" fill="#E6E8E8"></path>\n                  <path d="M22.3894032,6.40571996 C22.3894032,6.40571996 24.9727365,8.64571996 26.9102365,6.08571996 C26.2644032,7.68571996 25.9414865,8.96571996 25.9414865,8.96571996 L25.2956532,10.24572 L23.0352365,8.32571996 L22.3894032,6.40571996 Z" id="Path-494" fill="#E6E8E8" transform="translate(24.649820, 8.165720) rotate(52.000000) translate(-24.649820, -8.165720) "></path>\n                  <path d="M20.6462245,8.51753488 C20.6462245,8.51753488 23.9604656,11.3038091 25.8979656,8.74380905 C25.2521323,10.3438091 25.078218,11.598674 25.078218,11.598674 L24.4323847,12.878674 L21.1028976,9.87517984 L20.6462245,8.51753488 Z" id="Path-494" fill="#E6E8E8" transform="translate(23.272095, 10.698104) rotate(-135.000000) translate(-23.272095, -10.698104) "></path>\n                  <path d="M18.2927779,9.85808612 C18.2927779,9.85808612 15.6067281,8.91370489 14.3461002,11.8663856 C14.5856745,10.1576712 14.5893391,8.83757209 14.5893391,8.83757209 L14.4253034,7.30493626 L14.7514729,5.70339822 L18.2927779,9.85808612" id="Path-494" fill="#E6E8E8"></path>\n                  <path d="" id="Path-499" stroke="#979797" stroke-width="0.64"></path>\n                  <polygon id="Path-500" fill="#828A8F" points="9.94618849 9.56 11.6875 7.72609277 9.6875 6.56"></polygon>\n                </g>\n              </svg>\n            ',
__p+="\n          </li>\n        "),__p+='\n        <li class="Editor-HeaderInfo-actionsItem CDB-Shape">\n          ',hasGeom?(__p+='\n            <button class="js-toggle">\n              ',__p+=isVisible?'\n                <i class="CDB-IconFont CDB-IconFont-view u-actionTextColor"></i>\n              ':'\n                <i class="CDB-IconFont CDB-IconFont-hide u-actionTextColor"></i>\n              ',__p+="\n            </button>\n          "):__p+='\n            <svg class="js-georeferenceIcon" xmlns="http://www.w3.org/2000/svg" width="14" height="12" viewBox="0 0 14 12" data-tooltip="'+(null==(__t=_t("editor.layers.georeference.visualize"))?"":_.escape(__t))+'"><path fill="#FFB300" fill-rule="evenodd" d="M5.012 1.48C6.11-.444 7.887-.45 8.988 1.48l4.526 7.92c.82 1.436.15 2.6-1.523 2.6H2.01C.346 12-.333 10.83.485 9.4l4.526-7.92zM1.354 9.895C.917 10.66 1.116 11 2.01 11h9.98c.903 0 1.097-.333.656-1.104L8.12 1.976C7.404.72 6.596.722 5.88 1.975l-4.526 7.92zM6 9h2v1H6V9zm0-5h2v4H6V4z"/></svg>\n          ',__p+='\n        </li>\n        <li class="Editor-HeaderInfo-actionsItem CDB-Shape">\n          <button class="CDB-Shape-threePoints is-blue is-small js-toggle-menu">\n            <div class="CDB-Shape-threePointsItem"></div>\n            <div class="CDB-Shape-threePointsItem"></div>\n            <div class="CDB-Shape-threePointsItem"></div>\n          </button>\n        </li>\n      </ul>\n    </div>\n    <div class="u-flex Editor-ListLayer-info js-analyses-widgets-info">\n      <span class="CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-rSpace--m">\n        '+(null==(__t=_t("editor.layers.layer.analyses-count",{smart_count:numberOfAnalyses}))?"":_.escape(__t))+'\n      </span>\n      <span class="CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase">\n        '+(null==(__t=_t("editor.layers.layer.widgets-count",{smart_count:numberOfWidgets}))?"":_.escape(__t))+'\n      </span>\n    </div>\n  </div>\n</div>\n<ul class="Editor-ListAnalysis js-analyses '+(null==(__t=isVisible?"":"is-hidden")?"":_.escape(__t))+"  "+(null==(__t=isCollapsed?"is-collapsed":"")?"":_.escape(__t))+'"></ul>\n';return __p}},{underscore:"underscore"}],980:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-large is-semibold u-upperCase">'+(null==(__t=letter)?"":_.escape(__t))+' <svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <path d="M8.30379432,3.06016671 C8.11128812,2.75281724 8,2.38940498 8,2 C8,0.8954305 8.8954305,0 10,0 C11.1045695,0 12,0.8954305 12,2 C12,3.1045695 11.1045695,4 10,4 C9.70653076,4 9.42782451,3.93679216 9.17675238,3.82324762 L3.82324762,9.17675238 C3.93679216,9.42782451 4,9.70653076 4,10 C4,11.1045695 3.1045695,12 2,12 C0.8954305,12 0,11.1045695 0,10 C0,8.8954305 0.8954305,8 2,8 C2.38940498,8 2.75281724,8.11128812 3.06016671,8.30379432 L8.30379432,3.06016671 Z" stroke="none" fill="#FFFFFF" fill-rule="evenodd"></path>\n</svg></p>';return __p}},{underscore:"underscore"}],981:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-large is-semibold u-upperCase">'+(null==(__t=letter)?"":_.escape(__t))+"</p>";return __p}},{underscore:"underscore"}],982:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-large is-semibold u-upperCase">'+(null==(__t=letter)?"":_.escape(__t))+' <svg width="12px" height="12px" viewBox="589 382 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(589.000000, 382.000000)">\n    <circle fill="#FFFFFF" cx="2" cy="2" r="2"></circle>\n    <circle fill="#FFFFFF" cx="2" cy="10" r="2"></circle>\n    <circle fill="#FFFFFF" cx="10" cy="10" r="2"></circle>\n  </g>\n</svg></p>';return __p}},{underscore:"underscore"}],983:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-large is-semibold u-upperCase">'+(null==(__t=letter)?"":_.escape(__t))+' <svg width="12px" height="12px" viewBox="589 382 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(589.000000, 382.000000)">\n    <path d="M1,2 L1,2 L2,1 L2,11 L1,10 L11,10 L10,11 L10,1 L11,2 L1,2 Z M1,1 L11,1 L11,11 L1,11 L1,1 L1,1 Z" id="Rectangle-2" fill="#FFFFFF"></path>\n    <circle fill="#FFFFFF" cx="2" cy="2" r="2"></circle>\n    <circle fill="#FFFFFF" cx="10" cy="2" r="2"></circle>\n    <circle fill="#FFFFFF" cx="2" cy="10" r="2"></circle>\n    <circle fill="#FFFFFF" cx="10" cy="10" r="2"></circle>\n  </g>\n</svg></p>';return __p}},{underscore:"underscore"}],984:[function(a,b,c){var d=a("./base-layer-view-base"),e=a("./image-thumbnail-layer.tpl");b.exports=d.extend({initialize:function(a){if(d.prototype.initialize.apply(this,arguments),!a.configModel)throw new Error("configModel is required");this._configModel=a.configModel},_getCompiledTemplate:function(){return e({title:this._getTitle(),desc:_t("editor.layers.gmaps.title-label"),imgURL:this._getImageURL()})},_getImageURL:function(){var a=this.model.get("baseType");this.model.get("baseName")&&(a=a+"_"+this.model.get("baseName"));var b=[this._configModel.get("app_assets_base_url"),"unversioned/images/google-maps-basemap-icons",a+".jpg"].join("/");return b},_getTitle:function(){return this.model.get("name").replace("GMaps ","")}})},{"./base-layer-view-base":976,"./image-thumbnail-layer.tpl":985}],985:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="BlockList-media u-rSpace--xl js-thumbnail">\n  <img src="'+(null==(__t=imgURL)?"":_.escape(__t))+'" class="BlockList-mediaImg js-thumbnailImg" />\n</div>\n<div class="BlockList-inner">\n  <div class="BlockList-title u-bSpace">\n    <h2 class="BlockList-titleText CDB-Text CDB-Size-large u-ellipsis js-title">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n  </div>\n  <p class="CDB-Text CDB-Size-medium u-secondaryTextColor">'+(null==(__t=desc)?"":_.escape(__t))+"</p>\n</div>\n";return __p}},{underscore:"underscore"}],986:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="Inline-editor">\n  <div class="CDB-Text CDB-Size-large u-ellipsis js-title Inline-editor-text">'+(null==(__t=title)?"":_.escape(__t))+'</div>\n  <input type="text" name="text" class="Inline-editor-input Inline-editor-input--small CDB-Text CDB-InputText js-input" value="'+(null==(__t=title)?"":_.escape(__t))+'" readonly>\n</h2>';return __p}},{underscore:"underscore"}],987:[function(a,b,c){var d=a("backbone/core-view"),e=a("./image-thumbnail-layer.tpl");b.exports=d.extend({tagName:"li",className:"BlockList-item BlockList-item--noAction js-layer ui-state-disabled",initialize:function(a){this.listenTo(this.model,"change",this.render)},render:function(){var a=_t("editor.layers.labels.title-label"),b=this.model.getName()||a;return this.$el.html(e({title:b,desc:b===a?"":a,imgURL:this._getImageURL()})),this},_getImageURL:function(){return this.model.get("urlTemplate").replace("{s}","a").replace("{z}",6).replace("{x}",30).replace("{y}",24)}})},{"./image-thumbnail-layer.tpl":985,"backbone/core-view":1127}],988:[function(a,b,c){var d=a("./base-layer-view-base"),e=a("./plain-color-layer.tpl");b.exports=d.extend({_getCompiledTemplate:function(){var a=_t("editor.layers.color.title-label"),b=this.model.get("color")||a;return e({title:b,desc:b===a?"":a,color:this.model.get("color")})}})},{"./base-layer-view-base":976,"./plain-color-layer.tpl":989}],989:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="BlockList-media u-rSpace--xl js-thumbnail" style="background-color: '+(null==(__t=color)?"":_.escape(__t))+'">\n</div>\n<div class="BlockList-inner">\n  <div class="BlockList-title u-bSpace">\n    <h2 class="BlockList-titleText CDB-Text CDB-Size-large u-ellipsis js-title">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n  </div>\n  <p class="CDB-Text CDB-Size-medium u-secondaryTextColor">'+(null==(__t=desc)?"":_.escape(__t))+"</p>\n</div>\n";return __p}},{underscore:"underscore"}],990:[function(a,b,c){a("jquery-ui");var d=a("underscore"),e=a("jquery"),f=a("backbone/core-view"),g=a("../../components/notifier/notifier"),h=a("./layers.tpl"),i=a("./layer-view-factory"),j=a("../../helpers/required-opts"),k=".js-layers",l=".js-layer.js-sortable-item",m=["stackLayoutModel","analysisDefinitionNodesCollection","layerDefinitionsCollection","modals","userModel","configModel","editorModel","userActions","stateDefinitionModel","visDefinitionModel","widgetDefinitionsCollection"];b.exports=f.extend({initialize:function(a){j(a,m,this),this._layerViewFactory=new i({stackLayoutModel:this._stackLayoutModel,userActions:this._userActions,layerDefinitionsCollection:this._layerDefinitionsCollection,analysisDefinitionNodesCollection:a.analysisDefinitionNodesCollection,modals:a.modals,configModel:a.configModel,sortableSelector:k,stateDefinitionModel:this._stateDefinitionModel,visDefinitionModel:this._visDefinitionModel,widgetDefinitionsCollection:this._widgetDefinitionsCollection}),this._initBinds()},_initBinds:function(){this.listenTo(this._layerDefinitionsCollection,"add remove change:id",this.render),this.listenTo(this._layerDefinitionsCollection,"add",this._createNotification)},render:function(){return this.clearSubViews(),this.$el.html(h),d.each(this._layerDefinitionsCollection.toArray().reverse(),this._addLayerView,this),this._initSortable(),this},_createNotification:function(a){g.addNotification({status:"success",info:_t("notifications.layer.added",{name:a.getName()}),closable:!0,delay:g.DEFAULT_DELAY})},_addLayerView:function(a){var b=this._layerViewFactory.createLayerView(a);b.$el.data("layerId",a.id),this.addView(b),this.$(k).append(b.render().el)},_initSortable:function(){this.$(k).sortable({axis:"y",items:l,placeholder:"Editor-ListLayer-item Editor-ListLayer-item--placeholder",containment:k,forceHelperSize:!0,forcePlaceholderSize:!0,start:this._preventPlaceholderAfterBasemap.bind(this),beforeStop:this._dontAllowToMoveItemAfterBasemap.bind(this),update:this._onSortableUpdate.bind(this)})},_preventPlaceholderAfterBasemap:function(a,b){var c=e(b.placeholder);if(c.is(":last-child"))return void c.remove()},_dontAllowToMoveItemAfterBasemap:function(a,b){this._stopUpdate=e(b.placeholder).is(":last-child")},_onSortableUpdate:function(a,b){if(this._stopUpdate)return this.$(k).sortable("cancel"),void(this._stopUpdate=!1);var c=b.item,d=c.parent().children(".js-layer").length,e=d-c.index(),f=c.data("layerId");if(f){var h=this._layerDefinitionsCollection.get(f);return void this._userActions.moveLayer({from:h.get("order"),to:e-1})}var i=c.data("analysis-node-id");if(i)try{this._userActions.createLayerForAnalysisNode(i,{at:e})}catch(a){if(!/max/.test(a.message))throw a;c.remove(),g.addNotification({status:"warning",info:_t("editor.layers.drag-n-drop-analysis.upgrade-max-layers-err",{a_start:'<a href="https://carto.com/pricing/">',a_end:"</a>",userMaxLayers:a.userMaxLayers}),closable:!0,delay:g.DEFAULT_DELAY})}},_destroySortable:function(){this.$(k).data("ui-sortable")&&this.$(k).sortable("destroy")},clean:function(){this._destroySortable(),f.prototype.clean.apply(this)}})},{"../../components/notifier/notifier":475,"../../helpers/required-opts":1097,"./layer-view-factory":974,"./layers.tpl":991,"backbone/core-view":1127,jquery:"jquery","jquery-ui":1128,underscore:"underscore"}],991:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Editor-ListLayer js-layers"></ul>\n<div class="Editor-dropArea js-drop"></div>\n';return __p}},{underscore:"underscore"}],992:[function(a,b,c){var d,e,f=a("underscore"),g=a("./notification-error-messages.json"),h=a("../../../../javascripts/cartodb3/helpers/utils"),i=function(a,b){var c={};return"timeout"===a&&(null!=b?(d=f.template("<a href='mailto:<%- mail %>'><%- contact %></a>")({contact:_t("notifications.analysis.contact.label"),mail:_t("notifications.analysis.contact.mail")}),e=f.template("<button class='js-add-analysis u-actionTextColor' data-layer-id='<%- layerId %>'><%- sample %></button>")({sample:_t("notifications.analysis.sample"),layerId:b&&b.get("id")||""})):(d=_t("notifications.analysis.contact.label"),e=_t("notifications.analysis.sample")),c={sample:e,contact:d}),c};b.exports={extractErrorFromAnalysisNode:function(a,b){var c="error",d=_t("notifications.analysis.failed",{nodeId:a.get("id").toUpperCase()}),e=a.get("error");if(e&&e.message||a.get("error_message")){var f=e&&e.message||a.get("error_message"),g=this.extractError(f,b);d+=": "+g.message,c=g.type}return{message:d,type:c}},extractError:function(a,b){for(var c,d,e=!1,f=0;!e&&f<g.messages.length;){var j,k=g.messages[f],l=k.replaceWith,m=new RegExp(k.match),n=a.match(m);a=h.removeNewLines(a),n&&(l?(j=_t("notifications.analysis.errors."+l,i(l,b)),d=a.replace(m,j)):d=n[1],e=!0,c=k.errorType),f++}return{message:d||a,type:c||"error"}}}},{"../../../../javascripts/cartodb3/helpers/utils":1102,"./notification-error-messages.json":993,underscore:"underscore"}],993:[function(a,b,c){b.exports={messages:[{match:"Exception: (.*)$"},{match:"REMOTE ERROR: .*Error: (.*?)$"},{match:"ERROR: transform: (couldn't project point .*?)in executeQuery"},{match:"RuntimeError: Execution of function interrupted by signal",replaceWith:"timeout"},{match:"canceling statement due to statement timeout.*",replaceWith:"timeout"},{match:"^.*?PQconnectPoll: FATAL: no pg_hba.conf entry for host.*",replaceWith:"connect-poll"},{match:'^.*?column "the_geom_webmercator" does not exist.*',replaceWith:"without-geom-webmercator",errorType:"warning"},{match:"ERROR: (column .*? does not exist)"}]}},{}],994:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.userActions)throw new Error("userActions is required");var b=a.layerDefinitionModel,c=b.getName(),f=d.addNotification({status:"loading",info:_t("editor.layers.delete.loading",{name:c}),closable:!1});a.userActions.deleteLayer(b.id).done(function(){f.set({status:"success",info:_t("editor.layers.delete.success",{name:c}),closable:!0})}).fail(function(a){f.set({status:"error",info:_t("editor.layers.delete.error",{name:c,error:e(a)}),closable:!0})})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],995:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.userActions)throw new Error("userActions is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.newName)throw new Error("newName is required");var b=a.layerDefinitionModel,c=a.onSuccess,f=a.onError,g=a.newName,h=b.getName(),i=d.addNotification({status:"loading",info:_t("editor.layers.rename.loading"),closable:!1});b.set("table_name_alias",g),a.userActions.saveLayer(b).done(function(){c&&c(g),i.set({status:"success",info:_t("editor.layers.rename.success",{name:g}),closable:!0})}).fail(function(a){f&&f(h),i.set({status:"error",info:_t("editor.layers.rename.error",{name:h,error:e(a)}),closable:!0})})}},{"../../../components/notifier/notifier":475,"../../../helpers/error-parser":1090}],996:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="FormPlaceholder-paragraph u-tSpace-m u-flex">\n  <div class="FormPlaceholder-paragraphLoader">\n    <div class="CDB-Loader is-visible"></div>\n  </div>\n</div>\n\n<div class="FormPlaceholder-paragraph u-tSpace-m u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-tSpace--m"></span>\n  </div>\n</div>\n<div class="FormPlaceholder-paragraph u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-tSpace--m"></span>\n    <span class="FormPlaceholder-label FormPlaceholder-size--short u-tSpace-xl"></span>\n    <ul class="FormPlaceholder-carousel u-flex FormPlaceholder-size--long">\n      <li class="FormPlaceholder-carouselItem"></li>\n      <li class="FormPlaceholder-carouselItem"></li>\n      <li class="FormPlaceholder-carouselItem"></li>\n    </ul>\n  </div>\n</div>\n<div class="FormPlaceholder-paragraph u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--short u-tSpace--m"></span>\n    <span class="FormPlaceholder-label FormPlaceholder-size--med u-tSpace-xl"></span>\n    <ul class="FormPlaceholder-fields">\n      <li class="FormPlaceholder-fieldsItem u-flex u-justifySpace">\n        <span class="FormPlaceholder-label FormPlaceholder-size--short"></span>\n        <span class="FormPlaceholder-input FormPlaceholder-size--med"></span>\n      </li>\n      <li class="FormPlaceholder-fieldsItem u-flex u-justifySpace">\n        <span class="FormPlaceholder-label FormPlaceholder-size--shorter"></span>\n        <span class="FormPlaceholder-input FormPlaceholder-size--med"></span>\n      </li>\n    </ul>\n  </div>\n</div>\n<div class="FormPlaceholder-paragraph u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--short u-tSpace--m"></span>\n    <span class="FormPlaceholder-label FormPlaceholder-size--med u-tSpace-xl"></span>\n    <ul class="FormPlaceholder-fields">\n      <li class="FormPlaceholder-fieldsItem u-flex u-justifySpace">\n        <span class="FormPlaceholder-label FormPlaceholder-size--short"></span>\n        <span class="FormPlaceholder-input FormPlaceholder-size--med"></span>\n      </li>\n      <li class="FormPlaceholder-fieldsItem u-flex u-justifySpace">\n        <span class="FormPlaceholder-label FormPlaceholder-size--shorter"></span>\n        <span class="FormPlaceholder-input FormPlaceholder-size--med"></span>\n      </li>\n      <li class="FormPlaceholder-fieldsItem u-flex u-justifySpace">\n        <span class="FormPlaceholder-label FormPlaceholder-size--shorter"></span>\n        <span class="FormPlaceholder-input FormPlaceholder-size--med"></span>\n      </li>\n      <li class="FormPlaceholder-fieldsItem u-flex u-justifySpace">\n        <span class="FormPlaceholder-label FormPlaceholder-size--short"></span>\n        <span class="FormPlaceholder-input FormPlaceholder-size--med"></span>\n      </li>\n      <li class="FormPlaceholder-fieldsItem u-flex u-justifySpace">\n        <span class="FormPlaceholder-label FormPlaceholder-size--short"></span>\n        <span class="FormPlaceholder-input FormPlaceholder-size--med"></span>\n      </li>\n    </ul>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],997:[function(a,b,c){var d={ready:"ready",loading:"loading",fetched:"fetched",error:"error"};b.exports={track:function(a,b){if(void 0===a.modelView)throw new Error("modelView is required");if(void 0===a._querySchemaModel)throw new Error("querySchemaModel is required");this.modelView=a.modelView,this.querySchemaModel=a._querySchemaModel,this.querySchemaModel.on("change:query_errors change:status",this._setState,this),a.add_related_model(this.querySchemaModel),this.modelView.on("change:state",b),a.add_related_model(this.modelView),this.querySchemaModel.shouldFetch()&&!this._hasErrors()&&this.querySchemaModel.fetch(),this._setState()},_setState:function(){this._hasErrors()?this.modelView.set({state:d.error}):this.querySchemaModel.isFetched()?this.modelView.set({state:d.ready}):this.modelView.set({state:d.loading})},_hasErrors:function(){var a=this.querySchemaModel.get("query_errors");return a&&a.length>0}}},{}],998:[function(a,b,c){var d=a("backbone/core-view"),e=a("./share-button.tpl"),f=a("underscore"),g=["onClickAction","visDefinitionModel"];b.exports=d.extend({events:{"click .js-button":"_clickHandler"},initialize:function(a){f.each(g,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(e({hasChanges:this._visDefinitionModel.get("visChanges")>0})),this},_initBinds:function(){this._visDefinitionModel.on("change:visChanges",this.render,this),this.add_related_model(this._visDefinitionModel)},_clickHandler:function(){this._onClickAction&&this._onClickAction()}})},{"./share-button.tpl":999,"backbone/core-view":1127,underscore:"underscore"}],999:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",hasChanges&&(__p+='\n<span class="CDB-Text CDB-Size-small u-rSpace--m u-altTextColor">'+(null==(__t=_t("editor.unpublished-changes"))?"":_.escape(__t))+"</span>\n"),__p+='\n<button class="CDB-Button CDB-Button--primary js-button">\n  <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small">'+(null==(__t=_t("editor.button_share"))?"":_.escape(__t))+"</span>\n</button>";return __p}},{underscore:"underscore"}],1e3:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<button class='CDB-Text u-actionTextColor js-fix-sql'>"+(null==(__t=label)?"":_.escape(__t))+"</button>";return __p}},{underscore:"underscore"}],1001:[function(a,b,c){var d=a("backbone/core-view"),e=a("./sync-info.tpl"),f=a("moment"),g=a("../../../components/tipsy-tooltip-view"),h=a("../../../components/modals/sync-options/sync-options-modal-view"),i=a("../../../helpers/required-opts"),j=["modals","syncModel","tableModel","userModel"];b.exports=d.extend({className:"SyncInfo SyncInfo--separator",events:{"click .js-options":"_openSyncOptions"},initialize:function(a){i(a,j,this)},render:function(){var a=this._syncModel.get("run_at"),b={canSyncNow:this._syncModel.canSyncNow(),fromExternalSource:this._syncModel.get("from_external_source"),ranAt:f(this._syncModel.get("ran_at")||new Date).fromNow(),runAt:f(a).fromNow(),state:this._syncModel.get("state"),errorCode:this._syncModel.get("error_code"),errorMessage:this._syncModel.get("error_message"),isOwner:this._tableModel.isOwner(this._userModel)};if((!a||new Date(a)<=new Date)&&(b.runAt=_t("dataset.sync.in-a-moment")),this.$el.html(e(b)),b.errorCode||b.errorMessage){var c=new g({el:this.$(".js-tooltip"),title:function(){return _t("dataset.sync.error-code",{errorCode:b.errorCode})+":"+b.errorMessage}});this.addView(c)}return this},_openSyncOptions:function(){var a=this;this._modals.create(function(b){return new h({syncModel:a._syncModel,modalModel:b,tableName:a._tableModel.getUnquotedName()})})}})},{"../../../components/modals/sync-options/sync-options-modal-view":454,"../../../components/tipsy-tooltip-view":589,"../../../helpers/required-opts":1097,"./sync-info.tpl":1002,"backbone/core-view":1127,moment:"moment"}],1002:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter u-justifySpace">\n  <div class="u-flex u-alignCenter CDB-Text CDB-Size-small u-altTextColor SyncInfo-message--'+(null==(__t=state)?"":_.escape(__t))+' js-state">\n    <i class="CDB-IconFont CDB-IconFont-wifi"></i>\n    <p class="u-upperCase is-semibold u-lSpace">\n      ',__p+=errorCode||errorMessage?"\n        "+(null==(__t=_t("dataset.sync.sync-failed"))?"":_.escape(__t))+"\n      ":"\n        "+(null==(__t=ranAt)?"":_.escape(__t))+"\n      ",__p+="\n    </p>\n  </div>\n  ",isOwner&&(__p+='\n    <button class="CDB-Text CDB-Size-small u-upperCase js-options SyncInfo-viewOptions">'+(null==(__t=_t("dataset.sync.view-options"))?"":_.escape(__t))+"</button>\n  "),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],1003:[function(a,b,c){var d=a("../../components/notifier/notifier"),e=a("../../helpers/error-parser");b.exports=function(a){if(!a.visDefinitionModel)throw new Error("visDefinitionModel is required");var b=a.visDefinitionModel,c=a.onSuccess,f=a.onError,g=b.get("name");b.destroy({wait:!0,success:function(a,b){c&&c(a,b)},error:function(a,b){f&&f(a,b),d.addNotification({status:"error",info:_t("editor.maps.delete.error",{name:g,error:e(b)}),closable:!0})}})}},{"../../components/notifier/notifier":475,"../../helpers/error-parser":1090}],1004:[function(a,b,c){var d=a("../../components/notifier/notifier"),e=a("../../helpers/error-parser"),f=a("../../components/modals/visualization-title-suffix-metadata");b.exports=function(a){if(!a.visDefinitionModel)throw new Error("visDefinitionModel is required");if(!a.newName)throw new Error("newName is required");var b=a.visDefinitionModel,c=a.onSuccess,g=a.onError,h=a.newName,i=b.get("name"),j=d.addNotification({status:"loading",info:_t("editor.maps.rename.loading"),closable:!1});b.save({name:h},{wait:!0,success:function(a,b){c&&c(h),document.title=h+f,j.set({status:"success",info:_t("editor.maps.rename.success",{name:h}),closable:!0})},error:function(a,b){g&&g(i),j.set({status:"error",info:_t("editor.maps.rename.error",{name:i,error:e(b)}),closable:!0})}})}},{"../../components/modals/visualization-title-suffix-metadata":456,"../../components/notifier/notifier":475,"../../helpers/error-parser":1090}],1005:[function(a,b,c){var d=a("cartodb.js"),e=a("../../components/notifier/notifier"),f=!1;b.exports=function(a,b,c){if(!a)throw new Error("configModel is required");if(!b)throw new Error("stateModel is required");if(!c)throw new Error("query is required");var g=new d.SQL({user:a.get("user_name"),sql_api_template:a.get("sql_api_template"),api_key:a.get("api_key")}),h=null;f||(f=!0,h=e.addNotification({status:"loading",info:_t("editor.layers.notifier.center-map.loading"),closable:!1}),g.getBounds(c).done(function(a){f=!1,b.setBounds(a),h.set({status:"success",info:_t("editor.layers.notifier.center-map.success"),closable:!0})}).error(function(){f=!1,h.set({status:"error",info:_t("editor.layers.notifier.center-map.error"),closable:!0})}))}},{"../../components/notifier/notifier":475,"cartodb.js":"cartodb.js"}],1006:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-formInner CDB-Text CDB-Size-small u-upperCase ',disabled&&(__p+="u-altTextColor"),__p+=' u-upperCase">\n  <div class="u-flex u-alignCenter">\n    <div class="u-iBlock u-rSpace--m">\n      <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',checked&&(__p+="checked"),__p+=" ",disabled&&(__p+="disabled"),__p+='>\n      <span class="u-iBlock CDB-Checkbox-face"></span>\n    </div>\n    <span class="',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+=" >"+(null==(__t=title)?"":_.escape(__t))+"</span>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],1007:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="FormPlaceholder-paragraph u-tSpace-m u-flex">\n  <div class="FormPlaceholder-step u-rSpace--m"></div>\n  <div class="FormPlaceholder-inner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--long u-bSpace"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-bSpace--xl"></span>\n\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-bSpace--m"></span>\n\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-bSpace--m"></span>\n\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-bSpace--m"></span>\n\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-bSpace--m"></span>\n\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-bSpace--m"></span>\n\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-bSpace--m"></span>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],1008:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./enabler.tpl");a("../../../components/form-components/index");var h=["model"];b.exports=f.extend({initialize:function(a){d.each(h,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this.model.set(this.model.get("setting"),this.model.get("active"),{silent:!0})},render:function(){return this.$el.empty(),this._initViews(),this},_initViews:function(){this._enablerView=new e.Form.editors.Enabler({template:g,model:this.model,title:this.model.get("label"),disabled:this.model.get("disabled"),help:"",key:this.model.get("setting")}),this.$el.append(this._enablerView.render().$el)}})},{"../../../components/form-components/index":211,"./enabler.tpl":1006,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],1009:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./preview-options-item-view"),g=a("./preview-options.tpl"),h=a("./options-not-ready.tpl"),i=["mapDefinitionModel","settingsCollection","overlaysCollection"];b.exports=e.extend({initialize:function(a){d.each(i,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._initBinds()},render:function(){return this.clearSubViews(),this._overlaysCollection.hasFetched()?(this.$el.html(g()),this._initViews()):this.$el.html(h()),this},_initBinds:function(){this._settingsCollection.on("change",this._onChangeOptions,this),this.add_related_model(this._settingsCollection)},_onChangeOptions:function(a){var b=a.get("related"),c=a.get("setting"),d=a.get("enabler");"overlays"===b&&this._overlayHandler(c,d),"map"===b&&this._mapHandler(c,d)},_initViews:function(){this._settingsCollection.each(this._renderSetting,this)},_renderSetting:function(a){var b=new f({model:a});this.$(".js-settings").append(b.render().$el),
this.addView(b)},_overlayHandler:function(a,b){b===!1?this._overlaysCollection.removeOverlay(a):this._overlaysCollection.createOverlay(a)},_mapHandler:function(a,b){var c={};c[a]=b,this._mapDefinitionModel.set(c),this._mapDefinitionModel.save()}})},{"./options-not-ready.tpl":1007,"./preview-options-item-view":1008,"./preview-options.tpl":1010,"backbone/core-view":1127,underscore:"underscore"}],1010:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">1</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.settings.preview.options.title"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-Size-small u-altTextColor u-bSpace--xl">'+(null==(__t=_t("editor.settings.preview.options.subtitle"))?"":_.escape(__t))+'</p>\n    <div class="u-flex u-justifySpace">\n      <div class="js-settings Options-form"></div>\n    </div>\n\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],1011:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./preview-options-view"),g=["mapDefinitionModel","settingsCollection","overlaysCollection"];b.exports=d.extend({initialize:function(a){e.each(g,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.empty(),this._renderOptions(),this},_renderOptions:function(){var a=new f({mapDefinitionModel:this._mapDefinitionModel,settingsCollection:this._settingsCollection,overlaysCollection:this._overlaysCollection});this.$el.append(a.render().el),this.addView(a)}})},{"./preview-options-view":1009,"backbone/core-view":1127,underscore:"underscore"}],1012:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">'+(null==(__t=_t("editor.style.style-form.properties.placeholder-text"))?"":_.escape(__t))+" "+(null==(__t=_t("editor.layers.georeference.manually-add"))?"":_.escape(__t))+'</h2>\n<div class="BlockList-item is-dashed no-hover is-space u-tSpace-xl">\n  <ul class="HorizontalBlockList">\n    <li class="HorizontalBlockList-item"></li>\n    <li class="HorizontalBlockList-item"></li>\n  </ul>\n\n  <button class="CDB-Button CDB-Button--primary js-georeference">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("editor.layers.georeference.georeference-button"))?"":_.escape(__t))+"</span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],1013:[function(a,b,c){var d=a("backbone"),e=a("../../data/undo-manager.js"),f=a("underscore");b.exports=d.Model.extend({defaults:{content:""},initialize:function(a,b){this._history=this._generateHistory(b&&b.history),e.init(this,{track:!0,history:this._history})},_generateHistory:function(a){if(a&&a.length){var b=f.reduce(a,function(a,b){return a.push({content:b}),a},[],this);return b}return!1},getHistory:function(){return f.pluck(this.getUndoHistory(),"content")}})},{"../../data/undo-manager.js":667,backbone:"backbone",underscore:"underscore"}],1014:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../components/code-mirror/code-mirror-view"),f=a("../editor-hints/factory-hints"),g=a("../editor-hints/css-hints");b.exports=d.extend({className:"Editor-styleContentCartoCSS Editor-content",initialize:function(a){if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.styleModel)throw new Error("styleModel is required");if(!a.codemirrorModel)throw new Error("codemirrorModel is required");if(!a.editorModel)throw new Error("editorModel is required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.onApplyEvent)throw new Error("onApplyEvent");this._layerDefinitionModel=a.layerDefinitionModel,this._styleModel=this._layerDefinitionModel.styleModel,this._codemirrorModel=a.codemirrorModel,this._editorModel=a.editorModel,this._querySchemaModel=a.querySchemaModel,this._initBinds(),f.init({querySchemaModel:this._querySchemaModel,layerDefinitionModel:this._layerDefinitionModel,tokens:g})},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this._layerDefinitionModel.bind("change:cartocss",this._updateEditorContent,this),this.add_related_model(this._layerDefinitionModel)},_initViews:function(){var a=f.reset().hints;this.codeMirrorView=new e({model:this._codemirrorModel,addons:["color-picker"],hints:a,tip:_t("editor.style.code-mirror.save")}),this.codeMirrorView.bind("codeSaved",this._triggerCodeSaved,this),this.addView(this.codeMirrorView),this.$el.append(this.codeMirrorView.render().el)},_updateEditorContent:function(){this._editorModel.get("edition")===!1&&this.codeMirrorView.setContent(this._layerDefinitionModel.get("cartocss"))},_triggerCodeSaved:function(a,b){this.options.onApplyEvent&&this.options.onApplyEvent()}})},{"../../components/code-mirror/code-mirror-view":27,"../editor-hints/css-hints":699,"../editor-hints/factory-hints":700,"backbone/core-view":1127}],1015:[function(a,b,c){arguments[4][886][0].apply(c,arguments)},{dup:886,underscore:"underscore"}],1016:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("underscore"),g=a("./style-form/style-form-view"),h=a("./styles-factory"),i=a("../../components/carousel-form-view"),j=a("../../components/custom-carousel/custom-carousel-collection"),k=a("../layers/panel-loading-template.tpl"),l=a("./style-form-placeholder.tpl"),m=a("./georeference-placeholder.tpl"),n=a("./style-content-sql-error.tpl"),o=a("../components/overlay/overlay-view"),p=a("../../components/notifier/notifier"),q=a("../layers/query-sanity-check"),r=a("../layers/sql-error-action.tpl"),s=a("../../components/metrics/metrics-tracker"),t=a("../../helpers/required-opts"),u=a("../../helpers/fetch-all-query-objects"),v={ready:"ready",loading:"loading",fetched:"fetched",error:"error"},w=["configModel","layerDefinitionsCollection","userModel","layerDefinitionModel","userActions","styleModel","overlayModel","queryGeometryModel","querySchemaModel","queryRowsCollection","freezeTorgeAggregation","editorModel","modals"];b.exports=e.extend({className:"Editor-styleContent",initialize:function(a){t(a,w,this),this.render=this.render.bind(this),this._initModels(),this._initBinds(),this._fetchAllQueryObjectsIfNecessary(),q.track(this,this.render)},render:function(){return this.clearSubViews(),this.$el.empty(),this._hasError()?this._renderError():this._isLoading()?this._renderStateless():this._isReady()&&(this._queryGeometryModel.hasValue()?("point"===this._queryGeometryModel.get("simple_geom")&&this._renderCarousel(),this._renderForm(),this._renderOverlay()):this._layerDefinitionModel.canBeGeoreferenced()?(this.$el.html(m()),this._renderOverlay()):this.$el.html(l())),this},_hasError:function(){return this.modelView.get("state")===v.error},_isLoading:function(){return this.modelView.get("state")===v.loading||!this._querySchemaModel.isFetched()||!this._queryGeometryModel.isFetched()||!this._queryRowsCollection.isFetched()},_isReady:function(){return this.modelView.get("state")===v.ready&&this._querySchemaModel.isFetched()&&this._queryGeometryModel.isFetched()&&this._queryRowsCollection.isFetched()},_getInitialState:function(){return v.loading},_initModels:function(){this.modelView=new d.Model({state:v.loading}),this._carouselCollection=new j(f.map(h.getStyleTypes(this._styleModel.get("type"),this._queryGeometryModel.get("simple_geom")),function(a){return{selected:this._styleModel.get("type")===a.value,val:a.value,label:a.label,template:function(){return a.iconTemplate&&a.iconTemplate()||a.value}}},this))},_initBinds:function(){this.listenTo(this._layerDefinitionModel,"change:autoStyle",this._onAutoStyleChanged),this.listenTo(this.modelView,"change:state",this._checkEditorModel),this.listenTo(this._carouselCollection,"change:selected",this._onSelectAggregation),this.listenTo(this._styleModel,"undo redo",this.render),this.listenTo(this._styleModel,"change",this._onStyleChanged),this.listenTo(this._querySchemaModel,"change:status",this._onStatusChanged),this.listenTo(this._queryGeometryModel,"change:status",this._onStatusChanged),this.listenTo(this._queryRowsCollection.statusModel,"change:status",this._onStatusChanged)},_fetchAllQueryObjectsIfNecessary:function(){u({queryRowsCollection:this._queryRowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel})},_onAutoStyleChanged:function(a){var b=a.get("autoStyle");b?(this._styleModel.unbind("change",this._onStyleChanged,this),this._styleModel.once("change",function(){this.render(),this._styleModel.bind("change",this._onStyleChanged,this)},this)):this.render()},_onStatusChanged:function(){u({queryRowsCollection:this._queryRowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel},this.render),this._checkEditorModel()},_checkEditorModel:function(){var a=this._queryGeometryModel.hasValue();this._editorModel.set({disabled:this._hasError()||!a})},_renderError:function(){this.$el.append(n({body:_t("editor.error-query.body",{action:r({label:_t("editor.error-query.label")})})}))},_renderStateless:function(){this.$el.append(k())},_renderOverlay:function(){var a=new o({overlayModel:this._overlayModel});this.addView(a),this.$el.append(a.render().el)},_renderCarousel:function(){var b=new i({collection:this._carouselCollection,template:a("./style-form-types.tpl")});b.$el.addClass("js-aggregationTypes"),this.addView(b),this.$el.append(b.render().el)},_onSelectAggregation:function(a){var b,c,d,e=this._layerDefinitionsCollection.isThereAnyTorqueLayer(),f="torque"===this._layerDefinitionModel.get("type");if(a.get("selected"))if(b=a.getValue(),d=this._queryGeometryModel.get("simple_geom"),c="heatmap"===b||"animation"===b,e&&!f&&c)this._freezeTorgeAggregation(b,d);else{var g=function(){this._styleModel.setDefaultPropertiesByType(b,d)}.bind(this);c&&!this._layerDefinitionsCollection.isDataLayerOnTop(this._layerDefinitionModel)?this._moveTorqueLayerToTop(g):g()}},_moveTorqueLayerToTop:function(a){var b=p.addNotification({status:"loading",info:_t("editor.layers.moveTorqueLayer.loading"),closable:!0});this._layerDefinitionsCollection.once("layerMoved",function(){a&&a(),b.set({status:"success",info:_t("editor.layers.moveTorqueLayer.success"),delay:p.DEFAULT_DELAY})},this),this._userActions.moveLayer({from:this._layerDefinitionModel.get("order"),to:this._layerDefinitionsCollection.getTopDataLayerIndex()})},_renderForm:function(){this._styleForm=new g({layerDefinitionsCollection:this._layerDefinitionsCollection,layerDefinitionModel:this._layerDefinitionModel,styleModel:this._styleModel,configModel:this._configModel,userModel:this._userModel,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,modals:this._modals}),this.$el.append(this._styleForm.render().el),this.addView(this._styleForm)},_onStyleChanged:function(){this._styleModel.attributes.autogenerated=!1,this._layerDefinitionModel.save(),s.track("Modified Style Form",{layer_id:this._layerDefinitionModel.get("id"),cartocss:this._layerDefinitionModel.get("cartocss"),style_properties:this._layerDefinitionModel.get("style_properties")})}})},{"../../components/carousel-form-view":23,"../../components/custom-carousel/custom-carousel-collection":40,"../../components/metrics/metrics-tracker":233,"../../components/notifier/notifier":475,"../../helpers/fetch-all-query-objects":1092,"../../helpers/required-opts":1097,"../components/overlay/overlay-view":694,"../layers/panel-loading-template.tpl":996,"../layers/query-sanity-check":997,"../layers/sql-error-action.tpl":1e3,"./georeference-placeholder.tpl":1012,"./style-content-sql-error.tpl":1015,"./style-form-placeholder.tpl":1026,"./style-form-types.tpl":1027,"./style-form/style-form-view":1034,"./styles-factory":1053,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],1017:[function(a,b,c){function d(){return""}function e(a,b){var c="";b=b||"";for(var d in a)c+=b+d+": "+a[d]+";\n";return c}function f(a,b){var c=b?"value":a.attribute,d=["ramp(["+c+"]"];if(a.range&&(H.isArray(a.range)?d.push("("+a.range.join(", ")+")"):(d.push(a.range),a.bins&&d.push(a.bins))),a.domain)if(b)d.push("("+H.map(a.domain,function(a,b){return b+1}).join(", ")+")");else if(a.static){var e=H.filter(a.domain,function(a){return'"Other"'!==a});d.push("("+e.join(", ")+")")}else d.push("("+H.filter(H.map(a.domain,function(a,b){return a}),function(a){return!H.isUndefined(a)}).join(", ")+")"),d.push('"="');return a.quantification&&d.push(a.quantification.toLowerCase()),b&&d.push('"="'),d.join(", ")+")"}function g(a){var b=["ramp(["+a.attribute+"]"];if(a.range){var c=a.range[0],d=a.range[1];b.push("range("+c+", "+d+")")}if(a.quantification){var e=a.quantification.toLowerCase();a.bins?b.push(e+"("+a.bins+")"):b.push(e)}return b.join(", ")+")"}function h(a){var b={};return void 0!==a.fixed?b["marker-width"]=a.fixed:a.attribute&&(b["marker-width"]=g(a)),b}function i(a,b,c){var d={},e=b+"-comp-op";return"none"!==a&&void 0!==a&&"heatmap"!==c&&("simple"===c&&(e="comp-op"),d[e]=a),d}function j(a,b){var c={},d=a&&a.color||{},e=b&&!d.fixed,g=d.opacity;if(a.size&&(c=h(a.size)),d)if(void 0!==d.fixed?c["marker-fill"]=d.fixed:d.attribute&&(c["marker-fill"]=f(d,e)),d.operation&&(c["marker-comp-op"]=d.operation),c["marker-fill-opacity"]=null!=g?g:1,k(a.images)||k(d.images))c["marker-file"]=m(a.images||d.images,d);else if(a.image||d.image){var i=a.image;d.image&&(i="url('"+d.image+"')"),c["marker-file"]=i}return b||(c["marker-allow-overlap"]=!0),c}function k(a){return!!a&&(!!H.isArray(a)&&H.some(a,function(a){return""!==a}))}function l(a){return 0===a?"0":"''"}function m(a,b){if(H.isArray(a)&&b&&b.attribute){var c="["+b.attribute+"]",d=[],e=[];return H.each(a,function(a,c){if(""!==a){var f="url('"+a+"')";if(d.push(f),!H.isUndefined(b.domain[c])){var g=b.domain[c]||l(b.domain[c]);e.push(g)}}}),"ramp("+c+", ("+d.join(", ")+"), ("+e.join(", ")+'), "=")'}}function n(a){var b={};return a.color&&(void 0!==a.color.fixed?b["polygon-fill"]=a.color.fixed:a.color.attribute&&(b["polygon-fill"]=f(a.color)),a.color.operation&&(b["polygon-comp-op"]=a.color.operation),H.isNumber(a.color.opacity)&&(b["polygon-opacity"]=a.color.opacity)),b}function o(a,b){var c={};return"heatmap"===b?c:(a.size&&(c["marker-line-width"]=a.size.fixed),a.color&&(void 0!==a.color.fixed?c["marker-line-color"]=a.color.fixed:a.color.attribute&&(c["marker-line-color"]=f(a.color)),H.isNumber(a.color.opacity)&&(c["marker-line-opacity"]=a.color.opacity)),c)}function p(a){var b={};return a.size&&(void 0!==a.size.fixed?b["line-width"]=a.size.fixed:a.size.attribute&&(b["line-width"]=g(a.size))),a.color&&(a.color.fixed?b["line-color"]=a.color.fixed:a.color.attribute&&(b["line-color"]=f(a.color)),H.isNumber(a.color.opacity)&&(b["line-opacity"]=a.color.opacity)),b}function q(a){return a&&""!==a}function r(a){var b={};return q(a.attribute)&&(b["-torque-frame-count"]=a.steps,b["-torque-animation-duration"]=a.duration,b["-torque-time-attribute"]='"'+a.attribute+'"',a.isCategory?b["-torque-aggregation-function"]='"CDB_Math_Mode(value)"':b["-torque-aggregation-function"]='"count(1)"',b["-torque-resolution"]=a.resolution,b["-torque-data-aggregation"]=a.overlap?"cumulative":"linear"),b}function s(a){var b={};return q(a.attribute)&&(b["text-name"]="["+a.attribute+"]",b["text-face-name"]="'"+a.font+"'",a.fill&&(b["text-size"]=a.fill.size.fixed,null!=a.fill.color.opacity&&a.fill.color.opacity<1?b["text-fill"]=J.hexToRGBA(a.fill.color.fixed,a.fill.color.opacity):b["text-fill"]=a.fill.color.fixed),b["text-label-position-tolerance"]=0,a.halo&&(b["text-halo-radius"]=a.halo.size.fixed,null!=a.halo.color.opacity&&a.halo.color.opacity<1?b["text-halo-fill"]=J.hexToRGBA(a.halo.color.fixed,a.halo.color.opacity):b["text-halo-fill"]=a.halo.color.fixed),b["text-dy"]=void 0===a.offset?-10:a.offset,b["text-allow-overlap"]=void 0===a.overlap||a.overlap,b["text-placement"]="point",b["text-placement-type"]="dummy"),b}function t(a){var b={};return a.ramp&&(b["image-filters"]="colorize-alpha("+a.ramp.join(",")+")"),b}function u(a,b,c){var d={};for(var f in a){var g=M[f];g&&(d=H.extend(d,g[b](a[f],c)))}return e(d,"  ")}function v(a){return"animation"===a||"heatmap"===a}function w(a,b){if("line"===b){var c=a.stroke;return c&&c.color&&null==c.color.fixed}var d=a.fill;return d&&d.color&&null==d.color.fixed}function x(a,b,c){var d="",e=a.properties,f=v(a.type),g=w(e,b),h="animation"===a.type&&e.style;return"point"===b&&f&&(d+="Map {\n",d+=u({animated:H.extend({},e.animated,{isCategory:g})},b),d+="}\n"),d+="#layer {\n",d+=u(H.omit(e,"animated","labels"),b,h),d+="}",e.labels&&e.labels.enabled&&"false"!==e.labels.enabled&&(d+="\n#layer::labels {\n",d+=u({labels:e.labels},b),d+="}"),f&&e.animated.trails&&e.animated.trails>0&&(d+=M.trails[b](e)),d}function y(a){var b=a.fill.size&&parseInt(a.fill.size.fixed,10),c=null!=a.fill.color.opacity?a.fill.color.opacity:1;return b?"\n"+H.range(1,parseInt(a.animated.trails,10)+1).map(function(a){return"#layer[frame-offset="+a+"] {\n"+e({"marker-width":b+2*a},"  ")+e({"marker-fill-opacity":c/(2*a)},"  ")+"}"}).join("\n"):""}function z(a){return"count"===a.operator.toLowerCase()?"count(1)":a.operator+"("+a.attribute+")"}function A(a){var b={countries:"aggregation.agg_admin0",provinces:"aggregation.agg_admin1"};return b[a]}function B(a,b){var c=a.properties.aggregation,d="WITH hgrid AS (SELECT CDB_HexagonGrid(ST_Expand(!bbox!, CDB_XYZ_Resolution(<%= z %>) * <%= size %>), CDB_XYZ_Resolution(<%= z %>) * <%= size %>) as cell) SELECT hgrid.cell as the_geom_webmercator, <%= agg %> as agg_value, count(1)/power( <%= size %> * CDB_XYZ_Resolution(<%= z %>), 2 ) as agg_value_density, row_number() over () as cartodb_id FROM hgrid, <%= table %> i where ST_Intersects(i.the_geom_webmercator, hgrid.cell) GROUP BY hgrid.cell";return H.template(d)({table:"(<%= sql %>)",size:c.size,agg:z(c.value),z:b.zoom})}function C(a,b){var c=a.properties.aggregation,d="WITH hgrid AS (SELECT CDB_RectangleGrid ( ST_Expand(!bbox!, CDB_XYZ_Resolution(<%= z %>) * <%= size %>), CDB_XYZ_Resolution(<%= z %>) * <%= size %>, CDB_XYZ_Resolution(<%= z %>) * <%= size %>) as cell) SELECT hgrid.cell as the_geom_webmercator, <%= agg %> as agg_value, <%= agg %> /power( <%= size %> * CDB_XYZ_Resolution(<%= z %>), 2 ) as agg_value_density, row_number() over () as cartodb_id FROM hgrid, <%= table %> i where ST_Intersects(i.the_geom_webmercator, hgrid.cell) GROUP BY hgrid.cell";return H.template(d)({table:"(<%= sql %>)",size:c.size,agg:z(c.value),z:b.zoom})}function D(a){var b=a.properties.aggregation,c=["SELECT _poly.*, _merge.points_agg/GREATEST(0.0000026, ST_Area((ST_Transform(the_geom, 4326))::geography)) as agg_value_density, _merge.points_agg as agg_value FROM <%= aggr_dataset %> _poly, lateral (","SELECT <%= agg %> points_agg FROM (<%= table %>) _point where ST_Contains(_poly.the_geom_webmercator, _point.the_geom_webmercator) ) _merge"].join("\n");return H.template(c)({table:"<%= sql %>",aggr_dataset:A(b.dataset),agg:z(b.value)})}function E(a,b){function c(a){return a.replace(/\n/g,"\\n").replace(/\"/g,'\\"').replace()}var d=a.properties.fill.color,e=d.attribute_type,f=d.attribute,g=d.range&&d.range.length>K.MAX_VALUES,h=d.domain&&d.domain.length,i=["select *, (CASE"];if(null!=d.fixed||null==d.domain)return null;for(var j=0,k=h;j<k;j++){var l,m=d.domain[j],n=j+1;l="string"!==e||null===m?m:"'"+c(m.replace(/(^")|("$)/g,""))+"'",null!=l?i.push('WHEN "'+f+'" = '+l+" THEN "+n):i.push('WHEN "'+f+'" is NULL THEN '+n)}return g&&i.push(" ELSE "+(h+1)),i.push(" END) as value FROM (<%= sql %>) __wrapped"),i.join(" ")}function F(a,b,c){if(void 0===P[a.type])return null;if("animation"!==a.type&&void 0===a.properties.aggregation)throw new Error("aggregation properties not available");var d=P[a.type];if(void 0===d)throw new Error("can't generate SQL for aggregation "+a.type);return d(a,c)}function G(a,b,c,d){if("none"===a.type)return{cartoCSS:L.GENERIC_STYLE,sql:null,layerType:"CartoDB"};if("simple"!==a.type&&"point"!==b)throw new Error("aggregated styling does not work with "+b);var e,f=O[a.type];f&&(e=f(a.properties,d),e&&(a.properties=e));var g=Q[a.type];if(g&&(b=g.geometryType[b]),!b)throw new Error("geometry type not supported for "+a.type);var h="heatmap"===a.type||"animation"===a.type?"torque":"CartoDB";return{cartoCSS:x(a,b,d),sql:F(a,b,c),layerType:h}}var H=a("underscore"),I=a("../../data/camshaft-reference"),J=a("../../helpers/utils"),K=a("../../components/form-components/editors/fill/input-color/input-categories/input-color-categories.js"),L={GENERIC_STYLE:I.getDefaultCartoCSSForType(),DEFAULT_HEATMAP_COLORS:["blue","cyan","lightgreen","yellow","orange","red"]},M={animated:{point:r,line:d,polygon:d},trails:{point:y,line:d,polygon:d},fill:{point:j,line:d,polygon:n},stroke:{point:o,line:p,polygon:p},labels:{point:s,line:s,polygon:s},imageFilters:{point:t,line:t,polygon:t},blending:{point:function(a,b){return i(a,"marker",b)},line:function(a){return i(a,"line")},polygon:function(a){return i(a,"polygon")}}},N=function(a,b,c){a.fill=H.clone(a.fill);var d=a.fill.color.range;return a.fill.size=a.fill.size||{fixed:35},a.fill.image="url("+c.get("app_assets_base_url")+"/unversioned/images/alphamarker.png)",a.fill.color={fixed:a.fill.color.fixed||"white",opacity:a.fill.color.opacity},void 0!==d&&(a.imageFilters={ramp:H.isArray(d)?d:L.DEFAULT_HEATMAP_COLORS}),a},O={animation:function(a,b){if("heatmap"===a.style)return N(a,!0,b)},heatmap:function(a,b){return N(a,!1,b)}},P={hexabins:B,squares:C,regions:D,animation:E},Q={simple:{geometryType:{point:"point",line:"line",polygon:"polygon"}},hexabins:{geometryType:{point:"polygon",line:null,polygon:null}},squares:{geometryType:{point:"polygon",line:null,polygon:null}},regions:{geometryType:{point:"polygon",line:null,polygon:null}}};b.exports={configure:function(a){H.extend(L,a)},generateStyle:G,GENERIC_STYLE:L.GENERIC_STYLE}},{"../../components/form-components/editors/fill/input-color/input-categories/input-color-categories.js":139,"../../data/camshaft-reference":615,"../../helpers/utils":1102,underscore:"underscore"}],1018:[function(a,b,c){var d=a("underscore"),e=a("./simple-style-defaults");b.exports=d.defaults({generateAttributes:function(a){return d.extend(this._getStyleTypeAttrs(),this._getFillAttrs(a),this._getStrokeAttrs(a),{blending:"lighter"},this._getAggrAttrs(a),this._getAnimatedAttrs(a))},_getStyleTypeAttrs:function(){return{style:"simple"}},_getAnimatedAttrs:function(a){return{animated:{attribute:null,overlap:!1,duration:30,steps:256,trails:2,resolution:4}}},_getAggrAttrs:function(a){return{aggregation:{}}}},e)},{"./simple-style-defaults":1022,underscore:"underscore"}],1019:[function(a,b,c){var d=a("underscore"),e=a("./simple-style-defaults"),f=a("cartocolor");b.exports=d.defaults({generateAttributes:function(a){return d.extend(this._getFillAttrs(a),this._getAggrAttrs(),this._getAnimatedAttrs(),this._getLabelsAttrs())},_getFillAttrs:function(a){var b={fill:{size:{fixed:45},color:{attribute:"cartodb_id",range:f.ag_Sunset[7],bins:6}}};return b},_getAggrAttrs:function(){return{aggregation:{}}},_getAnimatedAttrs:function(a){return{animated:{attribute:"cartodb_id",overlap:!1,duration:30,steps:1,trails:0,resolution:4}}},_getLabelsAttrs:function(){return{labels:{}}}},e)},{"./simple-style-defaults":1022,cartocolor:"cartocolor",underscore:"underscore"}],1020:[function(a,b,c){var d=a("underscore"),e=a("./simple-style-defaults"),f=a("../../../data/default-form-styles.json"),g=a("../../../helpers/utils"),h=a("cartocolor");b.exports=d.defaults({_getAggrAttrs:function(a){return{aggregation:{size:10,value:{operator:"count",attribute:""}}}},_getStrokeAttrs:function(a){var b=f.stroke;return{stroke:g.cloneObject(b)}},_getFillAttrs:function(a){var b=h.ag_GrnYl[5];return{fill:{color:{attribute:"agg_value",bins:"5",quantification:"quantiles",range:g.cloneObject(b)}}}}},e)},{"../../../data/default-form-styles.json":622,"../../../helpers/utils":1102,"./simple-style-defaults":1022,cartocolor:"cartocolor",underscore:"underscore"}],1021:[function(a,b,c){var d=a("underscore"),e=a("./simple-style-defaults"),f=a("cartocolor");b.exports=d.defaults({_getAggrAttrs:function(a){return{aggregation:{dataset:"countries",change:"manual",value:{operator:"count",attribute:""}}}},_getFillAttrs:function(a){return{fill:{color:{attribute:"agg_value_density",bins:"5",quantification:"quantiles",range:d.clone(f.Emrld[5])}}}}},e)},{"./simple-style-defaults":1022,cartocolor:"cartocolor",underscore:"underscore"}],1022:[function(a,b,c){var d=a("underscore"),e=a("./style-defaults"),f=a("../../../data/default-cartography.json"),g=a("../../../data/default-form-styles.json"),h=a("../../../helpers/utils");b.exports=d.defaults({generateAttributes:function(a){return d.extend({},this._getFillAttrs(a),this._getStrokeAttrs(a),{blending:g.blending},this._getAggrAttrs(a),this._getLabelsAttrs())},_getFillAttrs:function(a){var b=f.simple[a].fill;return{fill:h.cloneObject(b)}},_getStrokeAttrs:function(a){var b=f.simple[a].stroke;return{stroke:h.cloneObject(b)}},_getAggrAttrs:function(){var a=g.aggregation;return{aggregation:h.cloneObject(a)}},_getLabelsAttrs:function(){var a=g.labels;return{labels:h.cloneObject(a)}}},e)},{"../../../data/default-cartography.json":621,"../../../data/default-form-styles.json":622,"../../../helpers/utils":1102,"./style-defaults":1024,underscore:"underscore"}],1023:[function(a,b,c){var d=a("underscore"),e=a("./hexabins-aggregation-style-defaults");b.exports=d.defaults({_getAggrAttrs:function(a){return{aggregation:{size:12,value:{operator:"count",attribute:""}}}}},e)},{"./hexabins-aggregation-style-defaults":1020,underscore:"underscore"}],1024:[function(a,b,c){b.exports={generateAttributes:function(a){return{fill:null,stroke:null,blending:null,aggregation:{},labels:{}}}}},{}],1025:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./styles-factory"),g=a("../../data/undo-manager");b.exports=d.Model.extend({parse:function(a){return a=a||{},e.extend({type:a.type,autogenerated:a&&a.autogenerated},a.properties)},initialize:function(a,b){this.get("type")||this.setDefaultPropertiesByType("simple","point"),g.init(this,{track:!0})},resetPropertiesFromAutoStyle:function(){this._stylesPreAutoStyle&&(delete this.attributes.autoStyle,this.set(this._stylesPreAutoStyle),this.removeStylesPreAutoStyle())},removeStylesPreAutoStyle:function(){delete this._stylesPreAutoStyle},setPropertiesFromAutoStyle:function(a){if(!a.definition)throw new Error("definition is required");if(!a.geometryType)throw new Error("geometryType is required");if(!a.widgetId)throw new Error("widgetId is required");this._stylesPreAutoStyle||(this._stylesPreAutoStyle=JSON.parse(JSON.stringify(this.attributes))),delete this.attributes.autoStyle;var b=function(a,b){var c=this.get(a);if(b.color&&b.color.domain){var d=e.compact(e.map(b.color.domain,function(a){return a&&a!==!0?'"'+a.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':a}));b.color.static=!0,b.color.domain=d,b.color.quantification="category",b.color.attribute_type="string"}else b.color.bins=b.color.range.length,b.color.quantification="quantiles",b.color.attribute_type="number";return c=e.extend(c,b)}.bind(this),c=JSON.parse(JSON.stringify(this.attributes));"line"===a.geometryType?c.stroke=b("stroke",a.definition[a.geometryType]):c.fill=b("fill",a.definition[a.geometryType]),this.set(e.extend({type:"simple",autoStyle:a.widgetId},c))},setDefaultPropertiesByType:function(a,b,c){this.set(e.extend({type:a},f.getDefaultStyleAttrsByType(a,b)),{silently:!!c}),c&&this.trigger("style:update")},setFill:function(a){var b=f.getDefaultStyleAttrsByType(a,"point");this.set("fill",b.fill)},applyLastState:function(){this._undoManager.stopTracking(),this.trigger("change"),this._undoManager.startTracking()},resetStyles:function(){this.setDefaultPropertiesByType("none","")},isAutogenerated:function(){return this.get("autogenerated")},isAggregatedType:function(){return e.contains(f.getAggregationTypes(),this.get("type"))},isAnimation:function(){return"animation"===this.get("type")},hasNoneStyles:function(){return"none"===this.get("type")},canApplyAutoStyle:function(){return"simple"===this.get("type")},getColumnsUsedForStyle:function(){var a=[],b=this.get("fill");b&&b.color&&b.color.attribute&&a.push({name:b.color.attribute,type:b.color.attribute_type||"string"}),b&&b.size&&b.size.attribute&&a.push({name:b.size.attribute,type:"number"});var c=this.get("stroke");c&&c.color&&c.color.attribute&&a.push({name:c.color.attribute,type:c.color.attribute_type||"string"}),c&&c.size&&c.size.attribute&&a.push({name:c.size.attribute,type:"number"});var d=this.get("labels");d&&d.attribute&&d.enabled&&a.push({name:d.attribute});var e=this.get("aggregation");return e&&e.value&&e.value.attribute&&a.push({name:e.value.attribute,type:e.value.attribute_type||"string"}),a},toJSON:function(){return{type:this.get("type"),properties:e.omit(this.attributes,"type","autogenerated")}}})},{"../../data/undo-manager":667,"./styles-factory":1053,backbone:"backbone",underscore:"underscore"}],1026:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor js-styleNoGeom">'+(null==(__t=_t("editor.style.style-form.properties.placeholder-text"))?"":_.escape(__t))+"</h2>\n";return __p}},{underscore:"underscore"}],1027:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">1</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text js-selector">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.style.style-form.type.title-label"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=name)?"":_.escape(__t))+"</p>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],1028:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">\n  '+(null==(__t=_t("editor.style.messages.none"))?"":_.escape(__t))+"\n</h2>\n";return __p}},{underscore:"underscore"}],1029:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");a("../../../../components/form-components/index");var f=a("./style-aggregation-properties-form-model"),g=a("./style-aggregation-form.tpl");b.exports=e.extend({initialize:function(a){if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.styleModel)throw new Error("styleModel is required");if(!a.modals)throw new Error("modals is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");this._queryGeometryModel=a.queryGeometryModel,this._querySchemaModel=a.querySchemaModel,this._styleModel=a.styleModel,this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals;
},render:function(){return this.clearSubViews(),this._removeFormView(),this.$el.html(g()),this._initViews(),this},_initViews:function(){this._aggrFormModel=new f(this._styleModel.get("aggregation"),{queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,styleModel:this._styleModel,configModel:this._configModel,userModel:this._userModel,modals:this._modals}),this._aggrFormView=new d.Form({model:this._aggrFormModel}),this._aggrFormView.bind("change",function(){this.commit()}),this.$(".js-aggregationForm").append(this._aggrFormView.render().el)},_removeFormView:function(){this._aggrFormView&&this._aggrFormView.remove()},clean:function(){this._removeFormView(),e.prototype.clean.call(this)}})},{"../../../../components/form-components/index":211,"./style-aggregation-form.tpl":1030,"./style-aggregation-properties-form-model":1031,backbone:"backbone","backbone/core-view":1127}],1030:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo js-aggregationOptions">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text js-selector">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.style.style-form.aggregation.title-label"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=_t("editor.style.style-form.aggregation.desc"))?"":_.escape(__t))+'</p>\n    <div class="js-aggregationForm"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],1031:[function(a,b,c){var d=a("underscore"),e=a("../style-form-default-model");b.exports=e.extend({_FORM_NAME:"aggregation",_onChange:function(){this._styleModel.set("aggregation",d.clone(this.attributes))}})},{"../style-form-default-model":1033,underscore:"underscore"}],1032:[function(a,b,c){function d(a){if(!a.querySchemaModel)throw new Error("querySchemaModel is required");var b=e(a.querySchemaModel,a.filterFunction);switch(a.styleType){case"heatmap":b=[{val:"cartodb_id",label:"cartodb_id",type:"number"}];break;case"regions":b=[{val:"agg_value",label:"agg_value",type:"number"},{val:"agg_value_density",label:"agg_value_density",type:"number"}];break;case"hexabins":case"squares":b=[{val:"agg_value",label:"agg_value",type:"number"}];break;case"animation":"heatmap"===a.animationType&&(b=[{val:"cartodb_id",label:"cartodb_id",type:"number"}])}return b}function e(a,b){if(!a)throw new Error("querySchemaModel is required");var c=a.columnsCollection;return b&&(c=c.filter(b)),c.map(function(a){var b=a.get("name");return{val:b,label:b,type:a.get("type")}})}function f(a){if(!a.componentName)throw new Error("componentName is required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.styleType)throw new Error("styleType is required");var b=a.querySchemaModel.get("status"),c="fetched"!==b,e=_t("editor.style.components."+a.componentName+"."+b);return{type:"Select",title:_t("editor.style.components."+a.componentName+".label"),help:c?e:"",options:d({querySchemaModel:a.querySchemaModel,filterFunction:a.filterFunction,styleType:a.styleType}),dialogMode:"float",editorAttrs:{disabled:c},validators:["required"]}}function g(a,b,c){var d=b.get("status"),f="fetched"!==d,g=_t("editor.style.components."+a+"."+d);return{type:"Select",title:_t("editor.style.components."+a+".label"),help:f?g:"",options:e(b,c),editorAttrs:{disabled:f},dialogMode:"float",validators:["required"]}}function h(a){if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.modals)throw new Error("modals is required");return{type:"Fill",title:_t("editor.style.components.stroke.label"),options:[],query:a.querySchemaModel.get("query"),configModel:a.configModel,userModel:a.userModel,modals:a.modals,dialogMode:"float",editorAttrs:{size:{min:0,max:10,step:.5,hidePanes:["value"]},color:{hidePanes:["value"]}},validators:["required"]}}function i(a){if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.styleType)throw new Error("styleType is required");if(!a.userModel)throw new Error("userModel is required");if(!a.modals)throw new Error("modals is required");var b=a.querySchemaModel.get("status"),c="fetched"!==b,e=_t("editor.style.components.stroke."+b);return{type:"Fill",title:_t("editor.style.components.stroke.label"),help:c?e:"",options:d({querySchemaModel:a.querySchemaModel,styleType:a.styleType}),query:a.querySchemaModel.get("query"),configModel:a.configModel,userModel:a.userModel,modals:a.modals,dialogMode:"float",editorAttrs:{min:0,max:50,disabled:c},validators:["required"]}}var j=a("underscore"),k=["DejaVu Sans Book","unifont Medium","Open Sans Regular","Lato Regular","Lato Bold","Lato Bold Italic","Graduate Regular","Gravitas One Regular","Old Standard TT Regular","Old Standard TT Italic","Old Standard TT Bold"];b.exports={fill:function(a){var b={size:{min:1,max:45,step:.5}},c=d({querySchemaModel:a.querySchemaModel,styleType:a.styleType,animationType:a.animationType}),e=a.queryGeometryModel&&"point"===a.queryGeometryModel.get("simple_geom");return"heatmap"===a.styleType?(b.size.hidePanes=["value"],b.color={hidePanes:["fixed"]}):"simple"===a.styleType&&e&&!a.isAutoStyleApplied&&(b.color={imageEnabled:!0}),"animation"===a.styleType&&(b.size.hidePanes=["value"],"simple"===a.animationType?b.color={categorizeColumns:!0}:b.color={hidePanes:["fixed"]}),{type:"Fill",title:_t("editor.style.components.fill"),options:c,query:a.querySchemaModel.get("query"),configModel:a.configModel,userModel:a.userModel,validators:["required"],editorAttrs:b,modals:a.modals,dialogMode:"float"}},stroke:function(a){return"line"===a.queryGeometryModel.get("simple_geom")?i({querySchemaModel:a.querySchemaModel,styleType:a.styleType,configModel:a.configModel,userModel:a.userModel,modals:a.modals}):h({querySchemaModel:a.querySchemaModel,configModel:a.configModel,userModel:a.userModel,modals:a.modals})},blending:function(a){var b=["lighter","multiply","source-over","xor"],c=["none","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","xor","src-over"],d="editor.style.components.blending.options",e=function(a){return j.reduce(a,function(a,b){return a.push({val:b,label:_t(d+"."+b)}),a},[])};return{type:"Select",title:_t("editor.style.components.blending.label"),options:e("animation"===a.styleType?b:c),dialogMode:"float"}},style:function(){return{type:"Radio",title:_t("editor.style.components.type.label"),options:[{val:"simple",label:_t("editor.style.components.type.options.points")},{val:"heatmap",label:_t("editor.style.components.type.options.heatmap")}]}},"aggregation-size":function(){return{type:"Number",title:_t("editor.style.components.aggregation-size.label"),help:_t("editor.style.components.aggregation-size.help"),validators:["required",{type:"interval",min:10,max:100}]}},"aggregation-dataset":function(){return{type:"Select",title:_t("editor.style.components.aggregation-dataset"),dialogMode:"float",options:[{val:"countries"},{val:"provinces"}]}},"aggregation-value":function(a){return{type:"Operators",title:_t("editor.style.components.aggregation-value"),options:e(a.querySchemaModel),dialogMode:"float"}},"labels-enabled":function(){return{type:"Hidden"}},"labels-attribute":function(a){var b=function(a){var b=a.get("name"),c=a.get("type");return"the_geom"!==b&&"the_geom_webmercator"!==b&&"date"!==c};return f({componentName:"labels-attribute",querySchemaModel:a.querySchemaModel,styleType:a.styleType,filterFunction:b})},"labels-fill":function(){return{type:"Fill",title:_t("editor.style.components.labels-fill"),options:[],dialogMode:"float",editorAttrs:{size:{min:6,max:24,hidePanes:["value"]},color:{hidePanes:["value"]}},validators:["required"]}},"labels-halo":function(){return{type:"Fill",title:_t("editor.style.components.labels-halo"),options:[],dialogMode:"float",editorAttrs:{size:{hidePanes:["value"]},color:{hidePanes:["value"]}},validators:["required"]}},"labels-font":function(){return{type:"Select",dialogMode:"float",options:k}},"labels-offset":function(){return{type:"Number",title:_t("editor.style.components.labels-offset"),validators:["required",{type:"interval",min:-15,max:15}]}},"labels-overlap":function(){return{type:"Radio",title:_t("editor.style.components.labels-overlap.label"),options:[{val:"true",label:_t("editor.style.components.labels-overlap.options.true")},{val:"false",label:_t("editor.style.components.labels-overlap.options.false")}]}},"labels-placement":function(){var a=["point","line","vertex","interior"],b="editor.style.components.labels-placement.options";return{type:"Select",title:_t("editor.style.components.labels-placement.label"),dialogMode:"float",options:j.reduce(a,function(a,c){return a.push({val:c,label:_t(b+"."+c)}),a},[]),editorAttrs:{showSearch:!1}}},"animated-enabled":function(){return{type:"Hidden"}},"animated-attribute":function(a){var b=function(a){var b=a.get("type");return!(!b||"number"!==b&&"date"!==b)};return"heatmap"===a.styleType?g({componentName:"animated-attribute",querySchemaModel:a.querySchemaModel,filterFunction:b}):f({componentName:"animated-attribute",querySchemaModel:a.querySchemaModel,filterFunction:b,styleType:a.styleType})},"animated-overlap":function(){return{type:"Radio",title:_t("editor.style.components.animated-overlap.label"),options:[{val:"false",label:_t("editor.style.components.animated-overlap.options.false")},{val:"true",label:_t("editor.style.components.animated-overlap.options.true")}]}},"animated-duration":function(){return{type:"Number",title:_t("editor.style.components.animated-duration"),validators:["required",{type:"interval",min:0,max:60}]}},"animated-steps":function(){return{type:"Number",title:_t("editor.style.components.animated-steps"),validators:["required",{type:"interval",min:1,max:1024,step:4}]}},"animated-trails":function(){return{type:"Number",title:_t("editor.style.components.animated-trails"),validators:["required",{type:"interval",min:0,max:30}]}},"animated-resolution":function(){return{type:"Number",title:_t("editor.style.components.animated-resolution"),validators:["required",{type:"interval",min:1,max:16}]}}}},{underscore:"underscore"}],1033:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./style-form-components-dictionary"),g=350;b.exports=d.Model.extend({_FORM_NAME:"",initialize:function(a,b){if(!b.styleModel)throw new Error("Style model is required");if(!b.modals)throw new Error("modals is required");this._styleModel=b.styleModel,this._querySchemaModel=b.querySchemaModel,this._queryGeometryModel=b.queryGeometryModel,this._configModel=b.configModel,this._userModel=b.userModel,this._modals=b.modals,this.schema=this._generateSchema(),this._initBinds()},_initBinds:function(){this.bind("change",e.debounce(this._onChange.bind(this),g),this)},_onChange:function(){throw new Error("_onChange should be defined")},_generateSchema:function(){var a=this._querySchemaModel,b=this._queryGeometryModel,c=this._configModel,d=this._userModel,g=this._modals,h=this._styleModel.get("type"),i=this._styleModel.has("autoStyle"),j=this._styleModel.get("style"),k=this._FORM_NAME?this._FORM_NAME+"-":"";return e.reduce(this.attributes,function(e,l,m){var n=f[k+m];return n&&(e[m]=n({styleType:h,isAutoStyleApplied:i,animationType:j,querySchemaModel:a,queryGeometryModel:b,modals:g,userModel:d,configModel:c})),e},{})}})},{"./style-form-components-dictionary":1032,backbone:"backbone",underscore:"underscore"}],1034:[function(a,b,c){var d=a("backbone/core-view"),e=a("./style-properties-form/style-properties-form-view"),f=a("./style-aggregation-form/style-aggregation-form-view"),g=a("./none-form-message.tpl");b.exports=d.extend({className:"Editor-formView",initialize:function(a){if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.styleModel)throw new Error("styleModel is required");if(!a.modals)throw new Error("modals is required");this._querySchemaModel=a.querySchemaModel,this._queryGeometryModel=a.queryGeometryModel,this._configModel=a.configModel,this._userModel=a.userModel,this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._layerDefinitionModel=a.layerDefinitionModel,this._styleModel=a.styleModel,this._modals=a.modals,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),"none"===this._styleModel.get("type")?this._renderNoneMessage():this._initFormViews(),this},_initBinds:function(){this._styleModel.bind("change:type",this.render,this),this.add_related_model(this._styleModel)},_renderNoneMessage:function(){this.$el.append(g())},_initFormViews:function(){if(this._styleModel.isAggregatedType()){var a=new f({styleModel:this._styleModel,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,configModel:this._configModel,userModel:this._userModel,modals:this._modals});this.addView(a),this.$el.append(a.render().el)}var b=new e({styleModel:this._styleModel,layerDefinitionsCollection:this._layerDefinitionsCollection,configModel:this._configModel,userModel:this._userModel,layerDefinitionModel:this._layerDefinitionModel,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,modals:this._modals});this.addView(b),this.$el.append(b.render().el)}})},{"./none-form-message.tpl":1028,"./style-aggregation-form/style-aggregation-form-view":1029,"./style-properties-form/style-properties-form-view":1039,"backbone/core-view":1127}],1035:[function(a,b,c){var d=a("underscore"),e=a("../style-form-default-model"),f=a("../style-form-components-dictionary");b.exports=e.extend({_FORM_NAME:"animated",parse:function(a,b){var c=b.querySchemaModel,e=c.columnsCollection.findWhere(function(a){return"number"===a.get("type")||"date"===a.get("type")});return d.extend(a,{attribute:a.attribute||e&&e.get("name"),overlap:a.overlap&&a.overlap.toString()})},_onChange:function(){var a=d.extend({},this.attributes,{overlap:"true"===this.get("overlap")});return!!a.attribute&&void this._styleModel.set("animated",a)},_generateSchema:function(){var a=this._styleModel.get("type");return"heatmap"===a?{resolution:f["animated-resolution"]()}:e.prototype._generateSchema.call(this)}})},{"../style-form-components-dictionary":1032,"../style-form-default-model":1033,underscore:"underscore"}],1036:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");a("../../../../components/form-components/index");var f=a("./style-animated-properties-form-model");b.exports=e.extend({initialize:function(a){if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.styleModel)throw new Error("styleModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.modals)throw new Error("modals is required");this._userModel=a.userModel,this._modals=a.modals,this._querySchemaModel=a.querySchemaModel,this._queryGeometryModel=a.queryGeometryModel,this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._layerDefinitionModel=a.layerDefinitionModel,this._styleModel=a.styleModel,this._animatedFormModel=new f(this._styleModel.get("animated"),{parse:!0,querySchemaModel:this._querySchemaModel,queryGeometryModel:this._queryGeometryModel,styleModel:this._styleModel,userModel:this._userModel,modals:this._modals})},render:function(){return this.clearSubViews(),this._genAnimatedFormView(),this},_genAnimatedFormView:function(){this._animatedFormView=new d.Form({model:this._animatedFormModel}),this._animatedFormView.bind("change",function(){this.commit()}),this.$el.append(this._animatedFormView.render().el)},_removeAnimatedFormView:function(){this._animatedFormView&&(this._animatedFormView.remove(),this._animatedFormView.$el.empty())},clean:function(){this._removeAnimatedFormView(),e.prototype.clean.call(this)}})},{"../../../../components/form-components/index":211,"./style-animated-properties-form-model":1035,backbone:"backbone","backbone/core-view":1127}],1037:[function(a,b,c){var d=a("underscore"),e=a("../style-form-default-model");b.exports=e.extend({_FORM_NAME:"labels",_onChange:function(){var a=d.extend({},this.attributes);return!(a.enabled&&!a.attribute)&&void this._styleModel.set("labels",a)}})},{"../style-form-default-model":1033,underscore:"underscore"}],1038:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");a("../../../../components/form-components/index");var f=a("./style-labels-properties-form-model");b.exports=e.extend({className:"u-tSpace-xl",initialize:function(a){if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.styleModel)throw new Error("styleModel is required");if(!a.modals)throw new Error("modals is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");this._queryGeometryModel=a.queryGeometryModel,this._querySchemaModel=a.querySchemaModel,this._styleModel=a.styleModel,this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals,this._labelsFormModel=new f(this._styleModel.get("labels"),{parse:!0,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,styleModel:this._styleModel,configModel:this._configModel,userModel:this._userModel,modals:this._modals}),this._enablerModel=new d.Model({enabler:this._styleModel.get("labels").enabled}),this._initBinds()},render:function(){return this.$el.empty(),this._initLabelsEnablerView(),this},_initBinds:function(){this._styleModel.bind("change:type",function(){var a="animation"===this._styleModel.get("type");a&&this._enablerView.setValue(!1)},this),this.add_related_model(this._styleModel)},_initLabelsEnablerView:function(){var a=_t("editor.style.components.labels-enabled.not-with-animated"),b="point"===this._queryGeometryModel.get("simple_geom");this._enablerView=new d.Form.editors.Enabler({model:this._enablerModel,title:_t("editor.style.components.labels-enabled.label"),help:b?a:"",key:"enabler"}),this._enablerModel.bind("change",this._setLabelsFormView,this),this.add_related_model(this._enablerModel),this.$el.append(this._enablerView.render().el),this._setLabelsFormView()},_setLabelsFormView:function(){var a=this._enablerModel.get("enabler");this._updateFormModel(),a?this._genLabelsFormView():this._removeLabelsFormView()},_updateFormModel:function(){this._labelsFormModel.set("enabled",this._enablerModel.get("enabler"))},_genLabelsFormView:function(){this._labelsFormView=new d.Form({className:"Editor-formInner--nested",model:this._labelsFormModel}),this._labelsFormView.bind("change",function(){this.commit()}),this.$el.append(this._labelsFormView.render().el)},_removeLabelsFormView:function(){this._labelsFormView&&(this._labelsFormView.remove(),this._labelsFormView.$el.empty())},clean:function(){this._removeLabelsFormView(),e.prototype.clean.call(this)}})},{"../../../../components/form-components/index":211,"./style-labels-properties-form-model":1037,backbone:"backbone","backbone/core-view":1127}],1039:[function(a,b,c){var d=a("backbone/core-view"),e=a("./style-labels-properties-form-view"),f=a("./style-animated-properties-form-view"),g=a("./style-shape-properties-form-view"),h=a("./style-unanimatable-view"),i=a("./style-properties-form.tpl"),j={HEATMAP:"heatmap",ANIMATION:"animation"};b.exports=d.extend({initialize:function(a){if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.styleModel)throw new Error("styleModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.modals)throw new Error("modals is required");this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._layerDefinitionModel=a.layerDefinitionModel,this._querySchemaModel=a.querySchemaModel,this._queryGeometryModel=a.queryGeometryModel,this._styleModel=a.styleModel,this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals},render:function(){this.clearSubViews();var a=this._styleModel.isAggregatedType()?3:2,b=this._queryGeometryModel.get("simple_geom");return"point"!==b&&a--,this.$el.html(i({stepNumber:a,simpleGeometry:b})),this._initViews(),this},_initViews:function(){var a,b,c,d=this._styleModel.get("type");this._isUnanimatable()?(b=new h({layerDefinitionModel:this._layerDefinitionModel,userModel:this._userModel,configModel:this._configModel,modals:this._modals}),this.addView(b),this.$(".js-propertiesForm").append(b.render().el)):(b=new g({styleModel:this._styleModel,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,configModel:this._configModel,userModel:this._userModel,modals:this._modals}),this.addView(b),this.$(".js-propertiesForm").append(b.render().el),d!==j.HEATMAP&&d!==j.ANIMATION&&(c=new e({styleModel:this._styleModel,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,configModel:this._configModel,userModel:this._userModel,modals:this._modals}),this.addView(c),this.$(".js-propertiesForm").append(c.render().el)),"point"!==this._queryGeometryModel.get("simple_geom")||d!==j.ANIMATION&&d!==j.HEATMAP||(a=new f({layerDefinitionsCollection:this._layerDefinitionsCollection,layerDefinitionModel:this._layerDefinitionModel,styleModel:this._styleModel,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,userModel:this._userModel,configModel:this._configModel,modals:this._modals}),this.addView(a),this.$(".js-propertiesForm").append(a.render().el)))},_isUnanimatable:function(){return 0===this._querySchemaModel.columnsCollection.filter(function(a){return"number"===a.get("type")||"date"===a.get("type")}).length&&"animated"===this._styleModel.get("type")}})},{"./style-animated-properties-form-view":1036,"./style-labels-properties-form-view":1038,"./style-properties-form.tpl":1040,"./style-shape-properties-form-view":1042,"./style-unanimatable-view":1043,"backbone/core-view":1127}],1040:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo js-styleProperties">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">'+(null==(__t=stepNumber)?"":_.escape(__t))+'</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text js-selector">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">\n        '+(null==(__t=_t("editor.style.style-form.properties.title-label-"+simpleGeometry))?"":_.escape(__t))+'\n      </h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=_t("editor.style.style-form.properties.desc"))?"":_.escape(__t))+'</p>\n    <div class="js-propertiesForm"></div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],1041:[function(a,b,c){var d=a("underscore"),e=a("../../styles-factory"),f=a("../style-form-default-model"),g={HEATMAP:"heatmap",ANIMATION:"animation"};b.exports=f.extend({parse:function(a){var b=a.geom,c={style:a.style,fill:a.fill,stroke:a.stroke,blending:a.blending},f=d.contains(e.getAggregationTypes(),a.type);return(f||"polygon"===b)&&c.fill.size&&(c.fill=d.omit(c.fill,"size")),"line"===b&&(c=d.omit(c,"fill")),(a.type===g.HEATMAP||a.type===g.ANIMATION&&"heatmap"===a.style)&&(c=d.omit(c,"stroke","blending")),a.type!==g.ANIMATION&&(c=d.omit(c,"style")),c},_onChange:function(){this._styleModel.set(d.clone(this.attributes))}})},{"../../styles-factory":1053,"../style-form-default-model":1033,underscore:"underscore"}],1042:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");a("../../../../components/form-components/index");var f=a("./style-shape-properties-form-model");b.exports=e.extend({className:"u-tSpace--m",initialize:function(a){if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.styleModel)throw new Error("styleModel is required");if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.modals)throw new Error("modals is required");this._queryGeometryModel=a.queryGeometryModel,this._querySchemaModel=a.querySchemaModel,this._styleModel=a.styleModel,this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals,this._initBinds()},render:function(){return this.clearSubViews(),this._removeFormView(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this._styleModel.bind("change:style",function(){var a=this._styleModel.get("style");this._styleModel.setFill(a),this.render()},this),this.add_related_model(this._styleModel)},_initViews:function(){this._shapeFormModel=new f({type:this._styleModel.get("type"),geom:this._queryGeometryModel.get("simple_geom"),style:this._styleModel.get("style"),fill:this._styleModel.get("fill"),stroke:this._styleModel.get("stroke"),blending:this._styleModel.get("blending")},{parse:!0,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,configModel:this._configModel,userModel:this._userModel,modals:this._modals,styleModel:this._styleModel}),this._shapeFormView=new d.Form({model:this._shapeFormModel}),this._shapeFormView.bind("change",function(){this.commit()}),this.$el.append(this._shapeFormView.render().el)},_removeFormView:function(){this._shapeFormView&&this._shapeFormView.remove()},clean:function(){this._removeFormView(),e.prototype.clean.call(this)}})},{"../../../../components/form-components/index":211,"./style-shape-properties-form-model":1041,backbone:"backbone","backbone/core-view":1127}],1043:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./style-unanimatable.tpl"),g=a("../../../../data/visualization-table-model"),h=e.template('<a href="<%- url %>" target="_blank" title="<%- tableName %>"><%- label %></a>'),i=["layerDefinitionModel","configModel"];b.exports=d.extend({initialize:function(a){var b;e.each(i,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._sourceNode=this._getSourceNode(),this._sourceNode&&(b=this._sourceNode.get("table_name"),this._visTableModel=new g({id:b,table:{name:b}},{configModel:this._configModel}))},render:function(){var a=this._getDescTemplate();return this.clearSubViews(),this.$el.html(f({title:_t("editor.style.style-form.unanimatable.desc"),desc:a})),this},_getDescTemplate:function(){var a,b="",c="";this._visTableModel&&(a=this._visTableModel.getTableModel(),b=a.getUnquotedName(),c=this._visTableModel&&this._visTableModel.datasetURL());var d=h({url:c,tableName:b,label:_t("editor.style.style-form.unanimatable.label")});return _t("editor.style.style-form.unanimatable.body",{link:d})},_getSourceNode:function(){var a,b,c=this._layerDefinitionModel.getAnalysisDefinitionNodeModel();return"source"===c.get("type")?a=c:(b=c.getPrimarySource(),b&&"source"===b.get("type")&&(a=b)),a}})},{"../../../../data/visualization-table-model":677,"./style-unanimatable.tpl":1044,"backbone/core-view":1127,underscore:"underscore"}],1044:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n<p class="CDB-Text u-tSpace--m CDB-Size-medium u-altTextColor">'+(null==(__t=desc)?"":__t)+"</p>\n";return __p}},{underscore:"underscore"}],1045:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="16px" viewBox="718 455 56 16">\n    <g id="animated" transform="translate(718.000000, 455.000000)" class="Style-fill">\n        <rect id="Rectangle-649" x="40" y="0" width="16" height="16" rx="8"></rect>\n        <rect id="Rectangle-649" opacity="0.8" x="30" y="0" width="16" height="16" rx="8"></rect>\n        <rect id="Rectangle-649" opacity="0.6" x="20" y="0" width="16" height="16" rx="8"></rect>\n        <rect id="Rectangle-649" opacity="0.4" x="10" y="0" width="16" height="16" rx="8"></rect>\n        <rect id="Rectangle-649" opacity="0.2" x="0" y="0" width="16" height="16" rx="8"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1046:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="25px" viewBox="0 0 56 25">\n    <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Aggregation-/-Heatmap" transform="translate(-15.000000, -16.000000)">\n            <g id="Group-7">\n                <g transform="translate(15.000000, 16.000000)">\n                    <g id="Group-2" style="mix-blend-mode: luminosity;" transform="translate(28.000000, 12.500000) rotate(-90.000000) translate(-28.000000, -12.500000) translate(15.500000, -15.500000)" class="Style-fill">\n                        <g id="heat-copy-2" transform="translate(0.000000, 36.000000)">\n                            <circle id="Oval-120" opacity="0.4" cx="6" cy="6" r="6"></circle>\n                            <circle id="Oval-120-Copy" opacity="0.6" cx="6.5" cy="5.5" r="4.03333333"></circle>\n                            <path d="M6.5,8.06666667 C7.91753086,8.06666667 9.06666667,6.91753086 9.06666667,5.5 C9.06666667,4.08246914 7.91753086,2.93333333 6.5,2.93333333 C5.08246914,2.93333333 3.93333333,4.08246914 3.93333333,5.5 C3.93333333,6.91753086 5.08246914,8.06666667 6.5,8.06666667 Z" id="Oval-120-Copy-2" opacity="0.8"></path>\n                            <circle id="Oval-120-Copy-3" cx="6.5" cy="5.5" r="1.1"></circle>\n                        </g>\n                        <g id="heat-copy-2" transform="translate(13.000000, 48.000000)">\n                            <circle id="Oval-120" opacity="0.4" cx="4" cy="4" r="4"></circle>\n                            <circle id="Oval-120-Copy" opacity="0.6" cx="4" cy="4" r="2.93333333"></circle>\n                            <path d="M4,5.86666667 C5.03093153,5.86666667 5.86666667,5.03093153 5.86666667,4 C5.86666667,2.96906847 5.03093153,2.13333333 4,2.13333333 C2.96906847,2.13333333 2.13333333,2.96906847 2.13333333,4 C2.13333333,5.03093153 2.96906847,5.86666667 4,5.86666667 Z" id="Oval-120-Copy-2" opacity="0.8"></path>\n                            <circle id="Oval-120-Copy-3" cx="4" cy="4" r="0.8"></circle>\n                        </g>\n                        <g id="heat-copy-3" transform="translate(0.500000, 0.500000)">\n                            <circle id="Oval-120" opacity="0.4" cx="12" cy="12" r="12"></circle>\n                            <ellipse id="Oval-120-Copy" opacity="0.6" cx="12" cy="12" rx="8.8" ry="8.8"></ellipse>\n                            <path d="M12,17.6 C15.0927946,17.6 17.6,15.0927946 17.6,12 C17.6,8.9072054 15.0927946,6.4 12,6.4 C8.9072054,6.4 6.4,8.9072054 6.4,12 C6.4,15.0927946 8.9072054,17.6 12,17.6 Z" id="Oval-120-Copy-2" opacity="0.8"></path>\n                            <circle id="Oval-120-Copy-3" cx="12" cy="12" r="2.4"></circle>\n                        </g>\n                        <g id="heat" transform="translate(8.000000, 25.000000)">\n                            <path d="M0.0682602115,8.5161863 C0.564222232,12.1776805 3.7025171,15 7.5,15 C11.6421356,15 15,11.6421356 15,7.5 C15,3.35786438 11.6421356,0 7.5,0 C3.35786438,0 0,3.35786438 0,7.5 C0,7.84465272 0.0232475903,8.18387567 0.0682602115,8.5161863 Z" id="Oval-120" opacity="0.4"></path>\n                            <circle id="Oval-120-Copy" opacity="0.6" cx="7.5" cy="7.5" r="5.5"></circle>\n                            <path d="M7.5,11 C9.43299662,11 11,9.43299662 11,7.5 C11,5.56700338 9.43299662,4 7.5,4 C5.56700338,4 4,5.56700338 4,7.5 C4,9.43299662 5.56700338,11 7.5,11 Z" id="Oval-120-Copy-2" opacity="0.8"></path>\n                            <circle id="Oval-120-Copy-3" cx="7.5" cy="7.5" r="1.5"></circle>\n                        </g>\n                    </g>\n                    <g id="Group-8" style="mix-blend-mode: luminosity;" transform="translate(15.000000, 4.000000)">\n                        <path opacity="0.4" d="M6,0.5 C6,0.5 10,4 13,0 C12,2.5 11.5,4.5 11.5,4.5 L10.5,6.5 L7,3.5 L6,0.5 Z" id="Path-494" class="Style-fill"></path>\n                        <path opacity="0.4" d="M21.2158501,6.00893743 C21.2158501,6.00893743 25.2158501,9.50893743 28.2158501,5.50893743 C27.2158501,8.00893743 26.7158501,10.0089374 26.7158501,10.0089374 L25.7158501,12.0089374 L22.2158501,9.00893743 L21.2158501,6.00893743 Z" id="Path-494" class="Style-fill" transform="translate(24.715850, 8.758937) rotate(52.000000) translate(-24.715850, -8.758937) "></path>\n                        <path opacity="0.4" d="M16.9683476,9.30864826 C16.9683476,9.30864826 22.1000758,13.6622016 25.1000758,9.66220164 C24.1000758,12.1622016 23.8307892,14.1229281 23.8307892,14.1229281 L22.8307892,16.1229281 L17.6754544,11.4299685 L16.9683476,9.30864826 Z" id="Path-494" class="Style-fill" transform="translate(21.034212, 12.715788) rotate(-135.000000) translate(-21.034212, -12.715788) "></path>\n                        <path opacity="0.4" d="M6.01244045,6.22463473 C6.01244045,6.22463473 9.69418934,8.6717337 12.6941893,4.6717337 C11.6941893,7.1717337 11.1941893,9.1717337 11.1941893,9.1717337 L10.8665273,11.557349 L9.7765744,13.8621271 L6.01244045,6.22463473 Z" id="Path-494" class="Style-fill" transform="translate(9.353315, 9.266930) rotate(-194.000000) translate(-9.353315, -9.266930) "></path>\n                        <path opacity="0.6" d="M6,7.5 C5.85295664,5.882523 3.5,2.5 3.5,2.5 C3.5,2.5 6.5,5 9,5 C11.5,5 14.5,1 14.5,1 C14.5,1 12.5,4.25504557 12.5,6 C12.5,7.25504557 14.5,10 14.5,10 C14.5,10 12,8 9.5,8 C7,8 4.5,13.5 4.5,13.5 C4.5,13.5 6.18628997,9.54918967 6,7.5 Z" id="Path-497" class="Style-fill"></path>\n                        <path opacity="0.6" d="M19.7830175,9.69012543 C19.6894445,8.07264843 16.7664559,5.429802 16.7664559,5.429802 C16.7664559,5.429802 20.2086087,8.27970692 21.7995178,8.27970692 C23.3904269,8.27970692 26.4566805,5.77970692 26.4566805,5.77970692 C26.4566805,5.77970692 24.4742142,8.43779004 24.4742142,10.1827445 C24.4742142,11.43779 25.8285796,12.5099091 25.8285796,12.5099091 C25.8285796,12.5099091 23.7086087,11.2797069 22.1176996,11.2797069 C20.5267905,11.2797069 17.9729009,15.2555074 17.9729009,15.2555074 C17.9729009,15.2555074 19.9015657,11.7393151 19.7830175,9.69012543 Z" id="Path-497" class="Style-fill" transform="translate(21.611568, 10.342655) rotate(52.000000) translate(-21.611568, -10.342655) "></path>\n                        <path id="Path-499" stroke="#979797"></path>\n                        <polygon id="Path-500" class="Style-fill" points="0.5 12.5 5 7.5 1 4"></polygon>\n                    </g>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>';
return __p}},{underscore:"underscore"}],1047:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="52px" height="23px" viewBox="0 0 52 23">\n    <g id="Symbols">\n        <g id="Aggregation-/-Hexabins" transform="translate(-15.000000, -17.000000)" class="Style-fill">\n            <g id="Hexabins">\n                <g transform="translate(15.000000, 17.000000)">\n                    <polygon id="Polygon-1-Copy-4" points="23 11 28 14 28 20 23 23 18 20 18 14"></polygon>\n                    <polygon id="Polygon-1-Copy-8" points="17 0 22 3 22 9 17 12 12 9 12 3"></polygon>\n                    <polygon id="Polygon-1-Copy-8" points="5 0 10 3 10 9 5 12 -1.15463195e-13 9 3.85466323e-09 3"></polygon>\n                    <polygon id="Polygon-1-Copy-13" points="29 0 34 3 34 9 29 12 24 9 24 3"></polygon>\n                    <polygon id="Polygon-1-Copy-15" points="41 0 46 3 46 9 41 12 36 9 36 3"></polygon>\n                    <polygon id="Polygon-1-Copy-14" points="35 11 40 14 40 20 35 23 30 20 30 14"></polygon>\n                    <polygon id="Polygon-1-Copy-14" points="47 11 52 14 52 20 47 23 42 20 42 14"></polygon>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1048:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="24px" viewBox="16 16 56 24">\n    <g id="points" transform="translate(16.000000, 16.000000)"  class="Style-fill">\n        <path d="M6,10 C8.209139,10 10,8.209139 10,6 C10,3.790861 8.209139,2 6,2 C3.790861,2 2,3.790861 2,6 C2,8.209139 3.790861,10 6,10 Z" id="Oval-59"></path>\n        <path d="M52,8 C54.209139,8 56,6.209139 56,4 C56,1.790861 54.209139,0 52,0 C49.790861,0 48,1.790861 48,4 C48,6.209139 49.790861,8 52,8 Z" id="Oval-59-Copy-2"></path>\n        <path d="M52,22 C54.209139,22 56,20.209139 56,18 C56,15.790861 54.209139,14 52,14 C49.790861,14 48,15.790861 48,18 C48,20.209139 49.790861,22 52,22 Z" id="Oval-59-Copy-3"></path>\n        <path d="M4,24 C6.209139,24 8,22.209139 8,20 C8,17.790861 6.209139,16 4,16 C1.790861,16 0,17.790861 0,20 C0,22.209139 1.790861,24 4,24 Z" id="Oval-59-Copy"></path>\n        <path d="M28,8 C30.209139,8 32,6.209139 32,4 C32,1.790861 30.209139,0 28,0 C25.790861,0 24,1.790861 24,4 C24,6.209139 25.790861,8 28,8 Z" id="Oval-59-Copy-4"></path>\n        <path d="M24,20 C26.209139,20 28,18.209139 28,16 C28,13.790861 26.209139,12 24,12 C21.790861,12 20,13.790861 20,16 C20,18.209139 21.790861,20 24,20 Z" id="Oval-59-Copy-4"></path>\n        <path d="M16,16 C18.209139,16 20,14.209139 20,12 C20,9.790861 18.209139,8 16,8 C13.790861,8 12,9.790861 12,12 C12,14.209139 13.790861,16 16,16 Z" id="Oval-59-Copy-4"></path>\n        <path d="M44,12 C46.209139,12 48,10.209139 48,8 C48,5.790861 46.209139,4 44,4 C41.790861,4 40,5.790861 40,8 C40,10.209139 41.790861,12 44,12 Z" id="Oval-59-Copy-4"></path>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1049:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="24px" viewBox="0 0 56 24">\n    <g id="Symbols">\n        <g id="Aggregation-/-Admin-Regions" transform="translate(-16.000000, -16.000000)" class="Style-fill">\n            <g id="regions">\n                <g transform="translate(16.000000, 16.000000)">\n                    <polygon id="Rectangle-649" points="9 8 1 0 27 0 27 17 36 17 36.0065918 23.9934082 25 24 9 16"></polygon>\n                    <polygon id="Rectangle-649" points="0 2 7 9 7 17 21 24 0 24 0 15"></polygon>\n                    <polygon id="Rectangle-649" points="29 0 50 0 50 6 56 6 56 24 48 24 38 24 38 15 29 15"></polygon>\n                    <rect id="Rectangle-1933" x="52" y="0" width="4" height="4"></rect>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1050:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="58px" height="28px" viewBox="0 0 58 28">\n    <g id="Symbols">\n        <g id="Aggregation-/-Squares" transform="translate(-15.000000, -14.000000)" class="Style-fill">\n            <g id="squares">\n                <g transform="translate(15.000000, 14.000000)">\n                    <rect id="Rectangle-847-Copy-2" x="10" y="0" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-5" x="30" y="20" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-12" x="40" y="20" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-13" x="40" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-8" x="20" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-6" x="30" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-9" x="20" y="20" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-10" x="10" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-10" x="0" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-10" x="50" y="20" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-11" x="20" y="0" width="8" height="8" rx="1"></rect>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1051:[function(a,b,c){function d(a,b,c){this.layerDefinitionsCollection=a,this.map=b,this._configModel=c,this._initBinds()}var e=a("./style-converter"),f=a("underscore");d.prototype={_initBinds:function(){function a(a){return function(){e.generate(a)}}function b(b){b&&b.styleModel&&(b.styleModel.bind("change",a(b),this),b.bind("change:autoStyle",a(b),this))}function c(b){b.styleModel&&(b.styleModel.unbind("change",a(b),this),b.unbind("change:autoStyle",a(b),this))}function d(){this.layerDefinitionsCollection.each(b,this)}var e=this;this.layerDefinitionsCollection.bind("reset",d,this),this.layerDefinitionsCollection.bind("add",b,this),this.layerDefinitionsCollection.bind("remove",c,this),d.call(this)},generate:function(a){var b=a.get("autoStyle"),c=a.styleModel.changed;if(!(b||c.type&&1===f.size(c))){var d=a.getAnalysisDefinitionNodeModel().queryGeometryModel.get("simple_geom")||"point",g=e.generateStyle(a.styleModel.toJSON(),d,{zoom:this.map.get("zoom")},this._configModel),h={cartocss:g.cartoCSS,sql_wrap:g.sql,type:g.layerType};a.get("previousCartoCSSCustom")&&(h=f.extend(h,{cartocss:a.get("previousCartoCSS"),cartocss_custom:a.get("previousCartoCSSCustom"),previousCartoCSSCustom:!1})),a.set(h)}}},b.exports=d},{"./style-converter":1017,underscore:"underscore"}],1052:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../components/view-options/panel-with-options-view"),h=a("./style-content-view"),i=a("./style-cartocss-view"),j=a("../../components/scroll/scroll-view"),k=a("../../components/tab-pane/tab-pane-view"),l=a("../../components/tab-pane/tab-pane-collection"),m=a("../../components/toggler/toggler-view"),n=a("../../components/undo-redo/undo-redo-view"),o=a("../../helpers/parser-css"),p=a("../../components/infobox/infobox-factory"),q=a("../../components/infobox/infobox-model"),r=a("../../components/infobox/infobox-collection"),s=a("../../components/notifier/notifier"),t=a("../../cartocss-notifications"),u=a("../../components/metrics/metrics-tracker"),v=a("../../components/onboardings/generic/generic-onboarding-launcher"),w=a("../../components/onboardings/layers/style-onboarding/style-onboarding-view"),x=a("../../components/onboardings/layers/layer-onboarding-key"),y=a("../../helpers/required-opts"),z=["layerDefinitionsCollection","layerDefinitionModel","userActions","queryGeometryModel","querySchemaModel","queryRowsCollection","modals","editorModel","configModel","userModel","onboardings","onboardingNotification"];b.exports=f.extend({initialize:function(a){y(a,z,this),this._styleModel=this._layerDefinitionModel.styleModel,this._cartocssModel=this._layerDefinitionModel.cartocssModel,this._codemirrorModel=new e.Model({content:this._layerDefinitionModel.get("cartocss")}),this._editorModel.set({edition:!!this._layerDefinitionModel.get("cartocss_custom"),disabled:!1}),this._infoboxModel=new q({state:this._isLayerHidden()?"layer-hidden":""}),this._overlayModel=new e.Model({visible:this._isLayerHidden()}),this._appendMapsAPIError(),t.track(this),this._onboardingLauncher=new v({view:w,onboardingNotification:this._onboardingNotification,notificationKey:x,onboardings:this._onboardings},{editorModel:this._editorModel,selector:"LayerOnboarding"}),this._configPanes(),this._initBinds()},render:function(){return this._launchOnboarding(),this.clearSubViews(),this.$el.empty(),this._initViews(),this},_launchOnboarding:function(){if(!this._onboardingNotification.getKey(x)){var a=function(){this._editorModel.isEditing()||this._layerDefinitionModel.canBeGeoreferenced()||!this._queryGeometryModel.hasValue()||this._onboardingLauncher.launch({geom:this._queryGeometryModel.get("simple_geom"),type:this._styleModel.get("type")})}.bind(this);this._queryRowsCollection.isFetched()?a():this._queryRowsCollection.statusModel.bind("change:status",function(){this._queryRowsCollection.isFetched()&&(a(),this._queryRowsCollection.statusModel.unbind(null,null,this))},this)}},_initBinds:function(){this.listenTo(this._layerDefinitionModel,"change:error",this._appendMapsAPIError),this.listenTo(this._layerDefinitionModel,"change:cartocss",function(){this._codemirrorModel.set("content",this._layerDefinitionModel.get("cartocss"))},this),this.listenTo(this._layerDefinitionModel,"change:visible",this._infoboxState),this.listenTo(this._layerDefinitionModel,"change:autoStyle",this._infoboxState),this.listenTo(this._editorModel,"change:edition",this._onChangeEdition),this.listenTo(this._querySchemaModel,"change:query_errors",this._updateEditor),this.listenTo(this._styleModel,"change",function(){this._codemirrorModel.set("content",this._layerDefinitionModel.get("cartocss"))}.bind(this)),this.listenTo(this._cartocssModel,"undo redo",function(){this._codemirrorModel.set("content",this._cartocssModel.get("content"))}.bind(this))},_appendMapsAPIError:function(){var a=this._layerDefinitionModel.get("error");if(a&&"turbo-carto"===a.type){var b=d.clone(this._codemirrorModel.get("errors"))||[];b.push({line:a.line,message:a.message}),this._codemirrorModel.set("errors",b)}},_updateEditor:function(a){var b=this._querySchemaModel.get("query_errors"),c=b&&b.length>0;this._editorModel.set("disabled",c)},_saveCartoCSS:function(){var a=this._codemirrorModel.get("content"),b=new o(a),c=b.errors();return!!a&&(this._codemirrorModel.set("errors",b.parseError(c)),void(0===c.length?(this._cartocssModel.set("content",a),this._layerDefinitionModel.set("autoStyle",!1),this._layerDefinitionModel.save({cartocss_custom:!0,cartocss:a}),t.showSuccessNotification(),u.track("Applied Cartocss",{layer_id:this._layerDefinitionModel.get("id"),cartocss:this._layerDefinitionModel.get("cartocss")})):this._editorModel.get("edition")===!1&&t.showErrorNotification(b.parseError(c))))},_cancelClearStyles:function(){this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1}),this._editorModel.set({edition:!0})},_clearCustomStyles:function(){this._layerDefinitionModel.set("cartocss_custom",!1),this._styleModel.applyLastState(),this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1}),this.render()},_cancelTorqueAggregation:function(){this._styleModel.applyLastState(),this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1}),this.render()},_applyTorqueAggregation:function(){if(this._layerDefinitionsCollection.isThereAnyTorqueLayer()){var a=this._layerDefinitionsCollection.findWhere({type:"torque"});a.styleModel.setDefaultPropertiesByType("simple","point")}this._infoboxModel.set({state:"unfreeze"})},_onChangeEdition:function(){this._infoboxState();var a=this._editorModel.get("edition"),b=a?1:0;this._collectionPane.at(b).set({selected:!0})},_freezeTorgeAggregation:function(a,b){this._infoboxModel.set({state:"torque-exists"}),this._overlayModel.set({visible:!0}),this._infoboxModel.once("change:state",function(c,d){"unfreeze"===d&&(this._moveTorqueLayerToTop(function(){this._overlayModel.set({visible:!1}),this._styleModel.setDefaultPropertiesByType(a,b)}.bind(this)),this._infoboxModel.set({state:""}))},this)},_moveTorqueLayerToTop:function(a){var b=s.addNotification({status:"loading",info:_t("editor.layers.moveTorqueLayer.loading"),closable:!0});this._layerDefinitionsCollection.once("layerMoved",function(){a&&a(),b.set({status:"success",info:_t("editor.layers.moveTorqueLayer.success"),delay:s.DEFAULT_DELAY})},this),this._userActions.moveLayer({from:this._layerDefinitionModel.get("order"),to:this._layerDefinitionsCollection.getTopDataLayerIndex()})},_configPanes:function(){var a=this,b=[{selected:!this._layerDefinitionModel.get("cartocss_custom"),createContentView:function(){return new j({createContentView:function(){return new h({className:"Editor-content",userActions:a._userActions,layerDefinitionsCollection:a._layerDefinitionsCollection,layerDefinitionModel:a._layerDefinitionModel,styleModel:a._styleModel,modals:a._modals,configModel:a._configModel,userModel:a._userModel,queryGeometryModel:a._queryGeometryModel,querySchemaModel:a._querySchemaModel,queryRowsCollection:a._queryRowsCollection,editorModel:a._editorModel,overlayModel:a._overlayModel,freezeTorgeAggregation:a._freezeTorgeAggregation.bind(a)})}})},createActionView:function(){return new n({trackModel:a._styleModel,editorModel:a._editorModel,applyButton:!1})}},{selected:this._layerDefinitionModel.get("cartocss_custom"),createContentView:function(){return new i({layerDefinitionModel:a._layerDefinitionModel,querySchemaModel:a._querySchemaModel,styleModel:a._styleModel,editorModel:a._editorModel,codemirrorModel:a._codemirrorModel,onApplyEvent:a._saveCartoCSS.bind(a)})},createActionView:function(){return new n({trackModel:a._cartocssModel,editorModel:a._editorModel,applyButton:!0,onApplyClick:a._saveCartoCSS.bind(a)})}}];this._collectionPane=new l(b)},_isLayerHidden:function(){return this._layerDefinitionModel.get("visible")===!1},_infoboxState:function(){var a=this._editorModel.get("edition"),b=this._layerDefinitionModel.get("cartocss_custom"),c=this._layerDefinitionModel.get("autoStyle");a||!b||c?!a&&this._isLayerHidden()?(this._infoboxModel.set({state:"layer-hidden"}),this._overlayModel.set({visible:!0})):(this._infoboxModel.set({state:""}),this._overlayModel.set({visible:!1})):(this._infoboxModel.set({state:"confirm"}),this._overlayModel.set({visible:!0}))},_showHiddenLayer:function(){var a={shouldPreserveAutoStyle:!0};this._layerDefinitionModel.toggleVisible(),this._userActions.saveLayer(this._layerDefinitionModel,a)},_initViews:function(){var a=this,b=[{state:"confirm",createContentView:function(){return p.createWithAction({type:"alert",closable:!1,title:_t("editor.style.messages.cartocss-applied.title"),body:_t("editor.style.messages.cartocss-applied.body"),mainAction:{label:_t("editor.style.messages.cartocss-applied.clear")},secondAction:{label:_t("editor.style.messages.cartocss-applied.continue")}})},mainAction:a._clearCustomStyles.bind(a),secondAction:a._cancelClearStyles.bind(a)},{state:"layer-hidden",createContentView:function(){return p.createWithAction({type:"alert",title:_t("editor.style.messages.layer-hidden.title"),body:_t("editor.style.messages.layer-hidden.body"),mainAction:{label:_t("editor.style.messages.layer-hidden.show")}})},mainAction:a._showHiddenLayer.bind(a)},{state:"torque-exists",createContentView:function(){return p.createWithAction({type:"alert",closable:!1,title:_t("editor.style.messages.torque-exists.title"),body:_t("editor.style.messages.torque-exists.body"),mainAction:{label:_t("editor.style.messages.torque-exists.continue")}})},closeAction:a._cancelTorqueAggregation.bind(a),mainAction:a._applyTorqueAggregation.bind(a)}],c=new r(b),d=new g({className:"Editor-content",editorModel:a._editorModel,infoboxModel:a._infoboxModel,infoboxCollection:c,createContentView:function(){return new k({collection:a._collectionPane})},createControlView:function(){return new m({editorModel:a._editorModel,labels:[_t("editor.style.style-toggle.values"),_t("editor.style.style-toggle.cartocss")],isDisableable:!0})},createActionView:function(){return new k({collection:a._collectionPane,createContentKey:"createActionView"})}});this.$el.append(d.render().el),this.addView(d)}})},{"../../cartocss-notifications":1,"../../components/infobox/infobox-collection":215,"../../components/infobox/infobox-factory":216,"../../components/infobox/infobox-model":219,"../../components/metrics/metrics-tracker":233,"../../components/notifier/notifier":475,"../../components/onboardings/generic/generic-onboarding-launcher":501,"../../components/onboardings/layers/layer-onboarding-key":507,"../../components/onboardings/layers/style-onboarding/style-onboarding-view":508,"../../components/scroll/scroll-view":530,"../../components/tab-pane/tab-pane-collection":538,"../../components/tab-pane/tab-pane-view":549,"../../components/toggler/toggler-view":590,"../../components/undo-redo/undo-redo-view":592,"../../components/view-options/panel-with-options-view":595,"../../helpers/parser-css":1095,"../../helpers/required-opts":1097,"./style-cartocss-view":1014,"./style-content-view":1016,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],1053:[function(a,b,c){var d=a("underscore"),e=a("./style-defaults/style-defaults"),f=a("./style-defaults/simple-style-defaults"),g=a("./style-defaults/heatmap-style-defaults"),h=a("./style-defaults/animation-style-defaults"),i=a("./style-defaults/squares-aggregation-style-defaults"),j=a("./style-defaults/hexabins-aggregation-style-defaults"),k=a("./style-defaults/regions-aggregation-style-defaults"),l={none:{labelTranslationKey:"editor.style.types.none",checkIfValid:function(a){return!a},defaultStyles:e},simple:{labelTranslationKey:"editor.style.types.simple",iconTemplate:a("./style-icons/points.tpl"),checkIfValid:function(a){return!!a},defaultStyles:f},squares:{labelTranslationKey:"editor.style.types.squares",iconTemplate:a("./style-icons/squares.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:i},hexabins:{labelTranslationKey:"editor.style.types.hexabins",iconTemplate:a("./style-icons/hexabins.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:j},regions:{labelTranslationKey:"editor.style.types.regions",iconTemplate:a("./style-icons/regions.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:k},animation:{labelTranslationKey:"editor.style.types.animation",iconTemplate:a("./style-icons/animated.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:h},heatmap:{labelTranslationKey:"editor.style.types.heatmap",iconTemplate:a("./style-icons/heatmap.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:g}};b.exports={getDefaultStyleAttrsByType:function(a,b){var c=l[a].defaultStyles;return c.generateAttributes(b)},getStyleTypes:function(a,b){return d.reduce(l,function(c,d,e){return a!==e&&d.checkIfValid&&!d.checkIfValid(b)||c.push({value:e,label:_t(d.labelTranslationKey),iconTemplate:d.iconTemplate}),c},[])},getFormTemplateByType:function(a){return l[a].formTemplate},getAggregationTypes:function(){return["squares","hexabins","regions"]}}},{"./style-defaults/animation-style-defaults":1018,"./style-defaults/heatmap-style-defaults":1019,"./style-defaults/hexabins-aggregation-style-defaults":1020,"./style-defaults/regions-aggregation-style-defaults":1021,"./style-defaults/simple-style-defaults":1022,"./style-defaults/squares-aggregation-style-defaults":1023,"./style-defaults/style-defaults":1024,"./style-icons/animated.tpl":1045,"./style-icons/heatmap.tpl":1046,"./style-icons/hexabins.tpl":1047,"./style-icons/points.tpl":1048,"./style-icons/regions.tpl":1049,"./style-icons/squares.tpl":1050,underscore:"underscore"}],1054:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<nav class="CDB-NavMenu js-theme">\n  <ul class="CDB-NavSubmenu CDB-NavSubmenu--outside CDB-Size-small CDB-Text is-semibold js-menu"></ul>\n</nav>\n<div class="Editor-content js-content"></div>\n';return __p}},{underscore:"underscore"}],1055:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n            <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("editor.widgets.delete.title",{name:name}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("editor.widgets.delete.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("editor.widgets.delete.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("editor.widgets.delete.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],1056:[function(a,b,c){arguments[4][986][0].apply(c,arguments)},{dup:986,underscore:"underscore"}],1057:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="32px" viewBox="498 425 56 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Bolean" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(498.000000, 425.000000)">\n        <rect id="Rectangle-17" fill="#FFFFFF" x="0" y="0" width="56" height="32" rx="4"></rect>\n        <path d="M1,2.00174332 L1,2.00174332 L1,29.9982567 C1,30.5564876 1.4426521,31 1.99306965,31 L54.0069304,31 C54.5486548,31 55,30.5482532 55,29.9982567 L55,2.00174332 C55,1.44351239 54.5573479,1 54.0069304,1 L1.99306965,1 C1.45134516,1 1,1.4517468 1,2.00174332 L1,2.00174332 Z M0,2.00174332 C0,0.89621101 0.902308181,0 1.99306965,0 L54.0069304,0 C55.1076723,0 56,0.889261723 56,2.00174332 L56,29.9982567 C56,31.103789 55.0976918,32 54.0069304,32 L1.99306965,32 C0.892327676,32 0,31.1107383 0,29.9982567 L0,2.00174332 L0,2.00174332 Z" id="Rectangle-774" fill="#EEEEEE"></path>\n        <rect id="Rectangle-1876" fill="#EEEEEE" x="8" y="6" width="16" height="3"></rect>\n        <rect id="Rectangle-1876" fill="#EEEEEE" x="8" y="15" width="40" height="2" rx="1"></rect>\n        <rect id="Rectangle-1876-Copy" fill="#9DE0AD" x="8" y="15" width="31" height="2" rx="1"></rect>\n        <rect id="Rectangle-1876" fill="#EEEEEE" x="8" y="22" width="40" height="2" rx="1"></rect>\n        <rect id="Rectangle-1876-Copy" fill="#9DE0AD" x="8" y="22" width="11" height="2" rx="1"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1058:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="32px" viewBox="0 0 56 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Graf" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <rect id="Rectangle-17" fill="#FFFFFF" x="0" y="0" width="56" height="32" rx="4"></rect>\n        <path d="M1,2.00174332 L1,2.00174332 L1,29.9982567 C1,30.5564876 1.4426521,31 1.99306965,31 L54.0069304,31 C54.5486548,31 55,30.5482532 55,29.9982567 L55,2.00174332 C55,1.44351239 54.5573479,1 54.0069304,1 L1.99306965,1 C1.45134516,1 1,1.4517468 1,2.00174332 L1,2.00174332 Z M0,2.00174332 C0,0.89621101 0.902308181,0 1.99306965,0 L54.0069304,0 C55.1076723,0 56,0.889261723 56,2.00174332 L56,29.9982567 C56,31.103789 55.0976918,32 54.0069304,32 L1.99306965,32 C0.892327676,32 0,31.1107383 0,29.9982567 L0,2.00174332 L0,2.00174332 Z" id="Rectangle-774" fill="#EEEEEE"></path>\n        <rect id="Rectangle-1876" fill="#EEEEEE" x="8" y="6" width="16" height="3"></rect>\n        <rect id="Rectangle-53" fill="#9DE0AD" x="8" y="19" width="40" height="7"></rect>\n        <rect id="Rectangle-1876" fill="#EEEEEE" x="8" y="14" width="16" height="2"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1059:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="32px" viewBox="498 425 56 32" version="1.1" mlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Bars" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(498.000000, 425.000000)">\n        <rect id="Rectangle-17" fill="#FFFFFF" x="0" y="0" width="56" height="32" rx="4"></rect>\n        <path d="M1,2.00174332 L1,2.00174332 L1,29.9982567 C1,30.5564876 1.4426521,31 1.99306965,31 L54.0069304,31 C54.5486548,31 55,30.5482532 55,29.9982567 L55,2.00174332 C55,1.44351239 54.5573479,1 54.0069304,1 L1.99306965,1 C1.45134516,1 1,1.4517468 1,2.00174332 L1,2.00174332 Z M0,2.00174332 C0,0.89621101 0.902308181,0 1.99306965,0 L54.0069304,0 C55.1076723,0 56,0.889261723 56,2.00174332 L56,29.9982567 C56,31.103789 55.0976918,32 54.0069304,32 L1.99306965,32 C0.892327676,32 0,31.1107383 0,29.9982567 L0,2.00174332 L0,2.00174332 Z" id="Rectangle-774" fill="#EEEEEE"></path>\n        <rect id="Bar" fill="#9DE0AD" transform="translate(36.000000, 23.000000) scale(-1, 1) translate(-36.000000, -23.000000) " x="35" y="22" width="2" height="2"></rect>\n        <rect id="Bar-Copy-6" fill="#9DE0AD" transform="translate(39.000000, 22.000000) scale(-1, 1) translate(-39.000000, -22.000000) " x="38" y="20" width="2" height="4"></rect>\n        <rect id="Bar-Copy-7" fill="#9DE0AD" transform="translate(42.000000, 21.500000) scale(-1, 1) translate(-42.000000, -21.500000) " x="41" y="19" width="2" height="5"></rect>\n        <rect id="Bar-Copy-8" fill="#9DE0AD" transform="translate(45.000000, 20.000000) scale(-1, 1) translate(-45.000000, -20.000000) " x="44" y="16" width="2" height="8"></rect>\n        <rect id="Bar-Copy-9" fill="#9DE0AD" transform="translate(48.000000, 21.500000) scale(-1, 1) translate(-48.000000, -21.500000) " x="47" y="19" width="2" height="5"></rect>\n        <rect id="Bar-Copy-2" fill="#9DE0AD" transform="translate(33.000000, 21.000000) scale(-1, 1) translate(-33.000000, -21.000000) " x="32" y="18" width="2" height="6"></rect>\n        <rect id="Bar-Copy-3" fill="#9DE0AD" transform="translate(30.000000, 22.500000) scale(-1, 1) translate(-30.000000, -22.500000) " x="29" y="21" width="2" height="3"></rect>\n        <rect id="Bar-Copy-4" fill="#9DE0AD" transform="translate(27.000000, 22.000000) scale(-1, 1) translate(-27.000000, -22.000000) " x="26" y="20" width="2" height="4"></rect>\n        <polygon id="Bar-Copy-5" fill="#9DE0AD" transform="translate(24.000000, 20.500000) scale(-1, 1) translate(-24.000000, -20.500000) " points="23 17 25 17 25 24 23 24"></polygon>\n        <rect id="Bar" fill="#9DE0AD" x="8" y="21" width="2" height="3"></rect>\n        <rect id="Bar-Copy-2" fill="#9DE0AD" x="11" y="15" width="2" height="9"></rect>\n        <rect id="Bar-Copy-3" fill="#9DE0AD" x="14" y="16" width="2" height="8"></rect>\n        <rect id="Bar-Copy-4" fill="#9DE0AD" x="17" y="19" width="2" height="5"></rect>\n        <polygon id="Bar-Copy-5" fill="#9DE0AD" points="20 16 22 16 22 24 20 24"></polygon>\n        <rect id="Rectangle-1876" fill="#EEEEEE" x="7" y="7" width="16" height="3"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1060:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="20px" height="18px" viewBox="10 11 20 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(10.000000, 11.000000)">\n        <rect id="Bar" fill="#A4DAB1" x="0" y="2" width="13" height="2"></rect>\n        <rect id="Bar" fill="#A4DAB1" x="0" y="9" width="10" height="2"></rect>\n        <rect id="Bar" fill="#A4DAB1" x="0" y="16" width="12" height="2"></rect>\n        <rect id="Bar" fill="#DDDDDD" x="0" y="7" width="7" height="1"></rect>\n        <rect id="Bar" fill="#DDDDDD" x="0" y="14" width="5" height="1"></rect>\n        <rect id="Bar" fill="#EEEEEE" x="13" y="2" width="7" height="2"></rect>\n        <rect id="Bar" fill="#EEEEEE" x="10" y="9" width="10" height="2"></rect>\n        <rect id="Bar" fill="#EEEEEE" x="12" y="16" width="8" height="2"></rect>\n        <rect id="Bar" fill="#DDDDDD" x="0" y="0" width="5" height="1"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1061:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="20px" height="8px" viewBox="0 0 20 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <rect id="Bar-Copy-2" fill="#9DE0AD" x="0" y="4" width="20" height="4"></rect>\n        <rect id="Bar-Copy-3" fill="#DDDDDD" x="0" y="0" width="9" height="2"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1062:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="20px" height="18px" viewBox="10 11 20 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Bars" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(10.000000, 11.000000)">\n        <rect id="Bar" fill="#A4DAB1" x="0" y="10" width="2" height="8"></rect>\n        <rect id="Bar" fill="#A4DAB1" x="3" y="6" width="2" height="12"></rect>\n        <rect id="Bar" fill="#A4DAB1" x="6" y="2" width="2" height="16"></rect>\n        <rect id="Bar" fill="#A4DAB1" x="9" y="0" width="2" height="18"></rect>\n        <rect id="Bar" fill="#A4DAB1" x="12" y="2" width="2" height="16"></rect>\n        <rect id="Bar" fill="#A4DAB1" x="15" y="5" width="2" height="13"></rect>\n        <rect id="Bar" fill="#A4DAB1" x="18" y="8" width="2" height="10"></rect>\n    </g>\n</svg>';
return __p}},{underscore:"underscore"}],1063:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="21px" height="18px" viewBox="10 11 21 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Group-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(10.000000, 11.000000)">\n        <g id="Bars" transform="translate(0.000000, 8.000000)">\n            <rect id="Bar" fill="#F2CC8F" x="4" y="0" width="1" height="10"></rect>\n            <rect id="Bar" fill="#F2CC8F" x="6" y="1" width="1" height="9"></rect>\n            <rect id="Bar-Copy" fill="#F2CC8F" x="0" y="5" width="1" height="5"></rect>\n            <rect id="Bar" fill="#F2CC8F" x="8" y="2" width="1" height="8"></rect>\n            <rect id="Bar" fill="#F2CC8F" x="10" y="3" width="1" height="7"></rect>\n            <rect id="Bar" fill="#EEEEEE" x="12" y="4" width="1" height="6"></rect>\n            <rect id="Bar" fill="#EEEEEE" x="14" y="5" width="1" height="5"></rect>\n            <rect id="Bar" fill="#EEEEEE" x="16" y="6" width="1" height="4"></rect>\n            <rect id="Bar-Copy" fill="#F2CC8F" x="2" y="3" width="1" height="7"></rect>\n            <rect id="Bar" fill="#EEEEEE" x="18" y="7" width="1" height="3"></rect>\n            <rect id="Bar" fill="#EEEEEE" x="20" y="7" width="1" height="3"></rect>\n        </g>\n        <polygon id="Rectangle-316" fill="#979EA1" points="0 5 0 0 4 2.5"></polygon>\n        <rect id="Rectangle-1876" fill="#DDDDDD" x="8" y="1" width="12" height="3"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1064:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="32px" viewBox="539 370 56 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Time-Series" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(539.000000, 370.000000)">\n        <rect id="Rectangle-17" fill="#FFFFFF" x="0" y="0" width="56" height="32" rx="4"></rect>\n        <path d="M1,2.00174332 L1,2.00174332 L1,29.9982567 C1,30.5564876 1.4426521,31 1.99306965,31 L54.0069304,31 C54.5486548,31 55,30.5482532 55,29.9982567 L55,2.00174332 C55,1.44351239 54.5573479,1 54.0069304,1 L1.99306965,1 C1.45134516,1 1,1.4517468 1,2.00174332 L1,2.00174332 Z M0,2.00174332 C0,0.89621101 0.902308181,0 1.99306965,0 L54.0069304,0 C55.1076723,0 56,0.889261723 56,2.00174332 L56,29.9982567 C56,31.103789 55.0976918,32 54.0069304,32 L1.99306965,32 C0.892327676,32 0,31.1107383 0,29.9982567 L0,2.00174332 L0,2.00174332 Z" id="Rectangle-774" fill="#EEEEEE"></path>\n        <rect id="Bar" fill="#DDDDDD" opacity="0.5" transform="translate(34.000000, 23.500000) scale(-1, 1) translate(-34.000000, -23.500000) " x="33" y="22" width="2" height="3"></rect>\n        <rect id="Bar-Copy-6" fill="#DDDDDD" opacity="0.5" transform="translate(37.000000, 24.000000) scale(-1, 1) translate(-37.000000, -24.000000) " x="36" y="23" width="2" height="2"></rect>\n        <rect id="Bar-Copy-7" fill="#DDDDDD" opacity="0.5" transform="translate(40.000000, 24.000000) scale(-1, 1) translate(-40.000000, -24.000000) " x="39" y="23" width="2" height="2"></rect>\n        <rect id="Bar-Copy-8" fill="#DDDDDD" opacity="0.5" transform="translate(43.000000, 24.500000) scale(-1, 1) translate(-43.000000, -24.500000) " x="42" y="24" width="2" height="1"></rect>\n        <rect id="Bar-Copy-9" fill="#DDDDDD" opacity="0.5" transform="translate(46.000000, 24.500000) scale(-1, 1) translate(-46.000000, -24.500000) " x="45" y="24" width="2" height="1"></rect>\n        <rect id="Bar-Copy-2" fill="#DDDDDD" opacity="0.5" transform="translate(31.000000, 23.500000) scale(-1, 1) translate(-31.000000, -23.500000) " x="30" y="22" width="2" height="3"></rect>\n        <rect id="Bar-Copy-3" fill="#DDDDDD" opacity="0.5" transform="translate(28.000000, 23.000000) scale(-1, 1) translate(-28.000000, -23.000000) " x="27" y="21" width="2" height="4"></rect>\n        <rect id="Bar-Copy-4" fill="#F2CC8F" transform="translate(25.000000, 23.000000) scale(-1, 1) translate(-25.000000, -23.000000) " x="24" y="21" width="2" height="4"></rect>\n        <polygon id="Bar-Copy-5" fill="#F2CC8F" transform="translate(22.000000, 22.500000) scale(-1, 1) translate(-22.000000, -22.500000) " points="21 20 23 20 23 25 21 25"></polygon>\n        <rect id="Bar-Copy-2" fill="#F2CC8F" x="9" y="24" width="2" height="1"></rect>\n        <rect id="Bar-Copy-3" fill="#F2CC8F" x="12" y="21" width="2" height="4"></rect>\n        <rect id="Bar-Copy-4" fill="#F2CC8F" x="15" y="18" width="2" height="7"></rect>\n        <polygon id="Bar-Copy-5" fill="#F2CC8F" points="18 19 20 19 20 25 18 25"></polygon>\n        <polygon id="Rectangle-316" fill="#979EA1" points="9 10 9 5 13 7.5"></polygon>\n        <rect id="Rectangle-1876" fill="#EEEEEE" x="16" y="6" width="16" height="3"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],1065:[function(a,b,c){var d=a("backbone/core-view"),e=a("./widget-view.tpl"),f=a("../../components/context-menu-factory-view"),g=a("../../components/inline-editor/inline-editor-view"),h=a("./inline-editor.tpl"),i=a("./widgets-service"),j={category:a("./widget-icon-layer-category.tpl"),histogram:a("./widget-icon-layer-histogram.tpl"),formula:a("./widget-icon-layer-formula.tpl"),"time-series":a("./widget-icon-layer-timeSeries.tpl")};b.exports=d.extend({tagName:"li",className:"BlockList-item js-widgetItem",initialize:function(a){if(!a.layer)throw new Error("layer is required");if(!a.userActions)throw new Error("userActions is required");this.layer=a.layer,this._userActions=a.userActions,this.stackLayoutModel=a.stackLayoutModel,this.listenTo(this.model,"change",this.render),this.listenToOnce(this.model,"destroy",this._onDestroy)},render:function(){var a=this.model.get("type"),b=this.model.get("source"),c=this.layer.get("color");return this.$el.html(e({widgetType:a,layerName:this.layer.getName(),source:b,sourceColor:c})),this.$el.attr("data-model-cid",this.model.cid),this._initViews(),this},_initViews:function(){var a=this.model.get("type");this._inlineEditor=new g({template:h,renderOptions:{title:this.model.get("title")},onClick:this._onEditWidget.bind(this),onEdit:this._renameWidget.bind(this)}),this.$(".js-header").append(this._inlineEditor.render().el),this.addView(this._inlineEditor);var b=j[a];b?this.$(".js-widgetIcon").append(b()):console.log(a+" widget template not defined");var c=[{label:_t("editor.widgets.options.rename"),val:"rename-widget",action:this._onRenameWidget.bind(this)},{label:_t("editor.widgets.options.edit"),val:"edit-widget",action:this._onEditWidget.bind(this)},{label:_t("editor.widgets.options.remove"),val:"delete-widget",destructive:!0,action:this._confirmDeleteWidget.bind(this)}];this._contextMenuFactory=new f({menuItems:c}),this.$(".js-context-menu").append(this._contextMenuFactory.render().el),this.addView(this._contextMenuFactory)},_onRenameWidget:function(){this._inlineEditor.edit()},_renameWidget:function(){var a=this._inlineEditor.getValue();""!==a&&a!==this.model.get("title")&&(this.$(".js-title").text(a).show(),this._inlineEditor.hide(),this.model.set({title:a}),this._userActions.saveWidget(this.model))},_confirmDeleteWidget:function(){i.removeWidget(this.model)},_onEditWidget:function(){i.editWidget(this.model)},_onDestroy:function(){this.clean()}})},{"../../components/context-menu-factory-view":37,"../../components/inline-editor/inline-editor-view":223,"./inline-editor.tpl":1056,"./widget-icon-layer-category.tpl":1060,"./widget-icon-layer-formula.tpl":1061,"./widget-icon-layer-histogram.tpl":1062,"./widget-icon-layer-timeSeries.tpl":1063,"./widget-view.tpl":1066,"./widgets-service":1085,"backbone/core-view":1127}],1066:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="BlockList-media u-rSpace--m js-widgetIcon">\n</div>\n<div class="BlockList-inner u-ellipsis">\n  <div class="BlockList-title u-bSpace js-context-menu">\n    <div class="BlockList-titleText js-header"></div>\n  </div>\n  <div class="u-flex">\n    <span\n      class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase"\n      style="background-color: '+(null==(__t=sourceColor)?"":_.escape(__t))+';">'+(null==(__t=source)?"":_.escape(__t))+'</span>\n    <p class="CDB-Text CDB-Size-medium u-altTextColor u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</p>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],1067:[function(a,b,c){arguments[4][886][0].apply(c,arguments)},{dup:886,underscore:"underscore"}],1068:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="FormPlaceholder-widget u-tSpace-m u-flex">\n  <div class="FormPlaceholder-widgetIcon u-rSpace--m"></div>\n  <div class="FormPlaceholder-widgetInner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--long"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med u-tSpace-xl"></span>\n  </div>\n</div>\n\n<div class="FormPlaceholder-widget u-tSpace-m u-flex">\n  <div class="FormPlaceholder-widgetIcon u-rSpace--m"></div>\n  <div class="FormPlaceholder-widgetInner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long u-tSpace-xl"></span>\n  </div>\n</div>\n\n<div class="FormPlaceholder-widget u-tSpace-m u-flex">\n  <div class="FormPlaceholder-widgetIcon u-rSpace--m"></div>\n  <div class="FormPlaceholder-widgetInner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--med"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--short u-tSpace-xl"></span>\n  </div>\n</div>\n\n<div class="FormPlaceholder-widget u-tSpace-m u-flex">\n  <div class="FormPlaceholder-widgetIcon u-rSpace--m"></div>\n  <div class="FormPlaceholder-widgetInner">\n    <span class="FormPlaceholder-title FormPlaceholder-size--long"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--long"></span>\n    <span class="FormPlaceholder-title FormPlaceholder-size--short u-tSpace-xl"></span>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],1069:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="Inline-editor">\n  <div class="CDB-Text CDB-Size-huge is-light u-ellipsis js-title Inline-editor-text">'+(null==(__t=title)?"":_.escape(__t))+'</div>\n  <input type="text" name="text" class="Inline-editor-input Inline-editor-input--small CDB-Text CDB-InputText js-input" value="'+(null==(__t=title)?"":_.escape(__t))+'" readonly>\n</h2>';return __p}},{underscore:"underscore"}],1070:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../../../../data/widget-definition-model");b.exports=e.Model.extend({initialize:function(a,b){var c=[{val:!0,label:_t("editor.widgets.widgets-form.style.yes")},{val:!1,label:_t("editor.widgets.widgets-form.style.no")}];this.schema={sync_on_bbox_change:{type:"Radio",title:_t("editor.widgets.widgets-form.style.sync_on_bbox_change"),options:c}}},_addAllStyleSchemaAttributes:function(){var a="category"===this.get("type")?"categories":"ramp",b={widget_style_definition:{type:"Fill",title:_t("editor.widgets.widgets-form.style.fill"),options:[],configModel:this._configModel,modals:this._modals,userModel:this._userModel,dialogMode:"float",editorAttrs:{color:{hidePanes:["value"],disableOpacity:!0}}}};if(this.get("auto_style_allowed")){var c={color:{hidePanes:["fixed"]}};"categories"===a&&(c.color.hideTabs=["bins","quantification"]),b=d.extend(b,{auto_style_definition:{type:"EnablerEditor",title:"",label:_t("editor.widgets.widgets-form.style.custom-"+a),help:_t("editor.widgets.widgets-form.style.custom-help"),editor:{type:"Fill",title:"",options:[this.get("column")],dialogMode:"float",query:"query",configModel:this._configModel,modals:this._modals,userModel:this._userModel,editorAttrs:c}}})}else b=d.extend(b,{auto_style_definition:{type:"Text",title:_t("editor.widgets.widgets-form.style.custom-"+a),help:_t("editor.widgets.widgets-form.style.custom-disabled"),disabled:!0}});this.schema=d.extend(this.schema,b)},parse:function(a){var b=d.defaults({sync_on_bbox_change:a.sync_on_bbox_change?"true":""},a);return b},changeWidgetDefinitionModel:function(a){var b=d.defaults({sync_on_bbox_change:"true"===this.get("sync_on_bbox_change")},this.attributes);""!==b.auto_style_definition&&d.isEmpty(b.auto_style_definition)&&(b.auto_style_definition=f.getDefaultAutoStyle(a.get("type"),a.get("column"))),a.set(b)}})},{"../../../../data/widget-definition-model":680,backbone:"backbone",underscore:"underscore"}],1071:[function(a,b,c){var d=a("underscore"),e=a("./widgets-form-base-schema-model"),f=a("../../../../helpers/required-opts"),g=["columnOptionsFactory","modals","configModel","userModel"];b.exports=e.extend({defaults:{schema:{},aggregate:{attribute:"",operator:"count"}},initialize:function(a,b){f(b,g,this),this.on("change:aggregate",this._updateAggregation,this),this.on("change:column",this.updateSchema,this),this._updateAggregation(),e.prototype.initialize.apply(this,arguments)},getFields:function(){var a=["column","aggregate","prefix","suffix"];return{data:a.join(","),style:["sync_on_bbox_change","widget_style_definition","auto_style_definition"]}},_updateAggregation:function(){var a=this.get("aggregate");void 0===a?this.set({aggregation:"count",aggregation_column:""}):this.set({aggregation_column:a.attribute,aggregation:a.operator}),this.updateSchema()},updateSchema:function(){var a=this._columnOptionsFactory.create(this.get("column")),b=this._columnOptionsFactory.unavailableColumnsHelpMessage(),c=d.filter(a,function(a){return"number"===a.type});this.schema=d.extend(this.schema,{column:{type:"Select",title:_t("editor.widgets.widgets-form.data.aggregate-by"),options:a,help:b,dialogMode:"float",editorAttrs:{disabled:this._columnOptionsFactory.areColumnsUnavailable()}},aggregate:{type:"Operators",title:_t("editor.widgets.widgets-form.data.operation"),options:c,dialogMode:"float",editorAttrs:{showSearch:!1}},suffix:{type:"EnablerEditor",title:"",label:_t("editor.widgets.widgets-form.data.suffix"),editor:{type:"Text"}},prefix:{type:"EnablerEditor",title:"",label:_t("editor.widgets.widgets-form.data.prefix"),editor:{type:"Text"}}}),this._addAllStyleSchemaAttributes()},canSave:function(){var a=this.get("aggregation"),b=this.get("aggregation_column"),c=!1;return c="count"===a||!(!a||!b)}})},{"../../../../helpers/required-opts":1097,"./widgets-form-base-schema-model":1070,underscore:"underscore"}],1072:[function(a,b,c){var d=a("underscore"),e=a("./widgets-form-base-schema-model");b.exports=e.extend({defaults:{schema:{}},initialize:function(a,b){if(!b.columnOptionsFactory)throw new Error("columnOptionsFactory is required");this._columnOptionsFactory=b.columnOptionsFactory,e.prototype.initialize.apply(this,arguments)},getFields:function(){return{data:"column,operation,prefix,suffix,description",style:"sync_on_bbox_change"}},updateSchema:function(){var a=this._columnOptionsFactory.create(this.get("column"),this._isNumberType);this.schema=d.extend(this.schema,{column:{type:"Select",title:_t("editor.widgets.widgets-form.data.column"),help:this._columnOptionsFactory.unavailableColumnsHelpMessage(),options:a,dialogMode:"float",editorAttrs:{disabled:this._columnOptionsFactory.areColumnsUnavailable()}},operation:{type:"Select",title:_t("editor.widgets.widgets-form.data.operation"),dialogMode:"float",options:["min","max","count","avg","sum"]},suffix:{type:"EnablerEditor",title:"",label:_t("editor.widgets.widgets-form.data.suffix"),editor:{type:"Text"}},prefix:{type:"EnablerEditor",title:"",label:_t("editor.widgets.widgets-form.data.prefix"),editor:{type:"Text"}},description:{type:"EnablerEditor",title:"",label:_t("editor.widgets.widgets-form.style.description"),editor:{type:"TextArea"}}})},canSave:function(){return!!this.get("column")},_isNumberType:function(a){return"number"===a.get("type")}})},{"./widgets-form-base-schema-model":1070,underscore:"underscore"}],1073:[function(a,b,c){var d=a("underscore"),e=a("./widgets-form-base-schema-model"),f=a("../../../../helpers/required-opts"),g=["columnOptionsFactory","modals","configModel","userModel"];b.exports=e.extend({initialize:function(a,b){f(b,g,this),e.prototype.initialize.apply(this,arguments)},getFields:function(){return{data:["column","bins"],style:["sync_on_bbox_change","widget_style_definition","auto_style_definition"]}},updateSchema:function(){var a=this._columnOptionsFactory.create(this.get("column"),this._isNumberType),b=this._columnOptionsFactory.unavailableColumnsHelpMessage();this.schema=d.extend(this.schema,{column:{title:_t("editor.widgets.widgets-form.data.column"),type:"Select",help:b,options:a,dialogMode:"float",editorAttrs:{disabled:this._columnOptionsFactory.areColumnsUnavailable()}},bins:{title:_t("editor.widgets.widgets-form.data.bins"),type:"Number",validators:["required",{type:"interval",min:2,max:30}]}}),this._addAllStyleSchemaAttributes()},canSave:function(){return!!this.get("column")},_isNumberType:function(a){return"number"===a.get("type")}})},{"../../../../helpers/required-opts":1097,"./widgets-form-base-schema-model":1070,underscore:"underscore"}],1074:[function(a,b,c){var d=a("underscore"),e=a("./widgets-form-base-schema-model"),f=a("../../../../helpers/required-opts"),g=["columnOptionsFactory"];b.exports=e.extend({initialize:function(a,b){f(b,g,this),e.prototype.initialize.apply(this,arguments)},getFields:function(){return{data:["column","bins"],style:["sync_on_bbox_change","widget_style_definition"]}},updateSchema:function(){var a=this._columnOptionsFactory.create(this.get("column"),this._isDateType),b=this._columnOptionsFactory.unavailableColumnsHelpMessage();this.schema=d.extend(this.schema,{column:{title:_t("editor.widgets.widgets-form.data.column"),type:"Select",help:b,options:a,dialogMode:"float",editorAttrs:{disabled:this._columnOptionsFactory.areColumnsUnavailable()}},bins:{title:_t("editor.widgets.widgets-form.data.bins"),type:"Number",validators:["required",{type:"interval",min:0,max:256}]},widget_style_definition:{type:"Fill",title:_t("editor.widgets.widgets-form.style.fill"),options:[],dialogMode:"float",editorAttrs:{color:{hidePanes:["value"],disableOpacity:!0}}}})},canSave:function(){return this.get("column")},_isDateType:function(a){return"date"===a.get("type")||"number"===a.get("type")}})},{"../../../../helpers/required-opts":1097,"./widgets-form-base-schema-model":1070,underscore:"underscore"}],1075:[function(a,b,c){var d=a("backbone/core-view"),e=a("./widget-header.tpl"),f=a("../../../components/inline-editor/inline-editor-view"),g=a("./inline-editor.tpl"),h=a("../../../components/context-menu-factory-view"),i=a("../widgets-service");b.exports=d.extend({events:{"click .js-toggle-menu":"_onToggleContextMenuClicked"},initialize:function(a){if(!this.model)throw new Error("model is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");if(!a.userActions)throw new Error("userActions is required");if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");this._layerDefinitionModel=a.layerDefinitionModel,this._userActions=a.userActions,this._stackLayoutModel=a.stackLayoutModel},render:function(){var a=this.model.get("title");return this.$el.html(e({title:a,source:this.model.get("source"),sourceColor:this._layerDefinitionModel.get("color"),layerName:this._layerDefinitionModel.getName()})),this._initViews(),this},_initViews:function(){var a=this.model.get("title");this._inlineEditor=new f({template:g,renderOptions:{title:a},onEdit:this._renameWidget.bind(this)}),this.$(".js-header").append(this._inlineEditor.render().el),this.addView(this._inlineEditor);var b=[{label:_t("editor.widgets.options.rename"),val:"rename-widget",action:this._onRenameWidget.bind(this)},{label:_t("editor.widgets.options.remove"),val:"delete-widget",destructive:!0,action:this._confirmDeleteWidget.bind(this)}];this._contextMenuFactory=new h({menuItems:b}),this.$(".js-context-menu").append(this._contextMenuFactory.render().el),this.addView(this._contextMenuFactory)},_onRenameWidget:function(){this._inlineEditor.edit()},_renameWidget:function(){var a=this._inlineEditor.getValue();""!==a&&a!==this.model.get("title")&&(this.model.set({title:a}),this._userActions.saveWidget(this.model),this.$(".js-title").text(a).show(),this._inlineEditor.hide())},_confirmDeleteWidget:function(){i.removeWidget(this.model)},_onDeleteWidget:function(a){a.destroy(),this._stackLayoutModel.prevStep("widgets"),this.model.destroy()}})},{"../../../components/context-menu-factory-view":37,"../../../components/inline-editor/inline-editor-view":223,"../widgets-service":1085,"./inline-editor.tpl":1069,"./widget-header.tpl":1076,"backbone/core-view":1127}],1076:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfoEditor">\n  <div class="u-rSpace--xl u-actionTextColor js-back Editor-HeaderInfoEditorShape">\n    <button>\n      <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n    </button>\n  </div>\n  <div class="Editor-HeaderInfo-inner">\n    <div class="Editor-HeaderInfo-title js-context-menu">\n      <div class="Editor-HeaderInfo-titleText js-header"></div>\n    </div>\n\n    <div class="u-flex">\n      <span class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase"\n        style="background-color: '+(null==(__t=sourceColor)?"":_.escape(__t))+';">'+(null==(__t=source)?"":_.escape(__t))+'</span>\n      <p class="CDB-Text CDB-Size-medium u-altTextColor u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</p>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],1077:[function(a,b,c){var d=function(a){this._querySchemaModel=a};d.prototype.areColumnsUnavailable=function(){var a=this._querySchemaModel.get("status");return"fetching"===a||"unavailable"===a},d.prototype.unavailableColumnsHelpMessage=function(){if("unavailable"===this._querySchemaModel.get("status"))return _t("editor.widgets.widgets-form.data.columns-unavailable")},d.prototype.create=function(a,b){switch(b=b||function(){return!0},this._querySchemaModel.get("status")){case"fetching":return[{val:_t("editor.widgets.widgets-form.data.loading")}];case"unavailable":return[{val:a}];default:return this._querySchemaModel.columnsCollection.filter(b).map(function(a){var b=a.get("name");return{val:b,label:b,type:a.get("type")}})}},b.exports=d},{}],1078:[function(a,b,c){var d=a("backbone/core-view"),e=a("./widgets-form-view"),f=a("./widget-header.js"),g=a("../../../components/scroll/scroll-view"),h=a("../../../helpers/required-opts"),i=["userActions","widgetDefinitionModel","modals","analysisDefinitionNodesCollection","layerDefinitionsCollection","stackLayoutModel","configModel","userModel"];b.exports=d.extend({events:{"click .js-back":"_goBack"},initialize:function(a){h(a,i,this),this._initBinds()},render:function(){return this.clearSubViews(),this._initViews(),this},_initBinds:function(){this._widgetDefinitionModel.bind("destroy",this._goBack,this),this.add_related_model(this._widgetDefinitionModel)},_initViews:function(){var a=this,b=a._widgetDefinitionModel.get("source"),c=a._analysisDefinitionNodesCollection.get(b),d=new f({layerDefinitionModel:this._layerDefinitionsCollection.get(this._widgetDefinitionModel.get("layer_id")),model:this._widgetDefinitionModel,modals:this._modals,userActions:this._userActions,stackLayoutModel:this._stackLayoutModel});this.$el.append(d.render().$el),this.addView(d);var h=new g({createContentView:function(){return new e({userActions:a._userActions,widgetDefinitionModel:a._widgetDefinitionModel,querySchemaModel:c.querySchemaModel,modals:a._modals,configModel:a._configModel,userModel:a._userModel})}});this.$el.append(h.render().$el),this.addView(h)},_goBack:function(){this._stackLayoutPrevStep?this._stackLayoutPrevStep():this._stackLayoutModel.prevStep("widgets")}})},{"../../../components/scroll/scroll-view":530,"../../../helpers/required-opts":1097,"./widget-header.js":1075,"./widgets-form-view":1083,"backbone/core-view":1127}],1079:[function(a,b,c){var d=a("underscore"),e=a("./widgets-form-column-options-factory"),f={category:{labelTranslationKey:"editor.widgets.widgets-form.type.category",iconTemplate:a("../widget-icon-category.tpl"),Class:a("./schema/widgets-form-category-schema-model")},formula:{labelTranslationKey:"editor.widgets.widgets-form.type.formula",iconTemplate:a("../widget-icon-formula.tpl"),Class:a("./schema/widgets-form-formula-schema-model"),checkIfValid:function(a){return a.columnsCollection.any(function(a){return"number"===a.get("type")})}},histogram:{labelTranslationKey:"editor.widgets.widgets-form.type.histogram",iconTemplate:a("../widget-icon-histogram.tpl"),Class:a("./schema/widgets-form-histogram-schema-model"),checkIfValid:function(a){return a.columnsCollection.any(function(a){return"number"===a.get("type")})}},"time-series":{labelTranslationKey:"editor.widgets.widgets-form.type.time_series",iconTemplate:a("../widget-icon-timeSeries.tpl"),Class:a("./schema/widgets-form-time-series-schema-model"),checkIfValid:function(a){return a.columnsCollection.any(function(a){return"date"===a.get("type")||"number"===a.get("type")})}}};b.exports={createWidgetFormModel:function(a){var b=a.widgetDefinitionModel,c=b.get("type"),d=f[c].Class;return new d(b.attributes,{parse:!0,widgetDefinitionModel:b,columnOptionsFactory:new e(a.querySchemaModel),userModel:a.userModel,modals:a.modals,configModel:a.configModel})},getDataTypes:function(a){return d.reduce(f,function(b,c,d){return c.checkIfValid&&!c.checkIfValid(a)||b.push({iconTemplate:c.iconTemplate,value:d,label:_t(c.labelTranslationKey)}),b},[])}}},{"../widget-icon-category.tpl":1057,"../widget-icon-formula.tpl":1058,"../widget-icon-histogram.tpl":1059,"../widget-icon-timeSeries.tpl":1064,"./schema/widgets-form-category-schema-model":1071,"./schema/widgets-form-formula-schema-model":1072,"./schema/widgets-form-histogram-schema-model":1073,"./schema/widgets-form-time-series-schema-model":1074,"./widgets-form-column-options-factory":1077,underscore:"underscore"}],1080:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./widgets-form-factory"),h=a("./widgets-form-fields.tpl");a("../../../components/form-components/index");var i=a("../../../helpers/required-opts"),j=["userActions","widgetDefinitionModel","querySchemaModel","modals","configModel","userModel"];b.exports=f.extend({initialize:function(a){i(a,j,this);var b={widgetDefinitionModel:this._widgetDefinitionModel,querySchemaModel:this._querySchemaModel,modals:this._modals,userModel:this._userModel,configModel:this._configModel};this._widgetFormModel=g.createWidgetFormModel(b),this._widgetFormModel.updateSchema(),this._debounceSaveWidget=d.debounce(this._saveWidget.bind(this),500),this._initBinds()},render:function(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this._widgetFormModel.bind("change:aggregation",this.render,this),this._widgetFormModel.bind("change:column",this.render,this),this._widgetFormModel.bind("change",this._onFormChange,this),this.add_related_model(this._widgetFormModel),this._widgetDefinitionModel.on("change:title",function(a,b){this._widgetFormModel.set({title:b},{silent:!0})},this),this._widgetDefinitionModel.bind("change:auto_style_definition",this._onAutoStyleChanged,this),this.add_related_model(this._widgetDefinitionModel)},_initViews:function(){var a=this._widgetFormModel,b=a.getFields();return this._widgetFormView=new e.Form({template:h,templateData:{dataFields:b.data,styleFields:b.style},model:a}),this._widgetFormView.bind("change",function(){this.commit()}),this.$el.append(this._widgetFormView.render().$el),this},_removeForm:function(){this._widgetFormView&&this._widgetFormView.remove()},_onFormChange:function(){this._widgetFormModel.canSave()&&(this._widgetFormModel.changeWidgetDefinitionModel(this._widgetDefinitionModel),this._debounceSaveWidget())},_onAutoStyleChanged:function(a,b){var c=a.previous("auto_style_definition");""===c&&d.isEmpty(c)&&(this._widgetFormModel.set({auto_style_definition:a.get("auto_style_definition")},{silent:!0}),d.isEmpty(b)||this.render())},_saveWidget:function(){this._userActions.saveWidget(this._widgetDefinitionModel)},clean:function(){this._removeForm(),f.prototype.clean.call(this)}})},{"../../../components/form-components/index":211,"../../../helpers/required-opts":1097,"./widgets-form-factory":1079,"./widgets-form-fields.tpl":1081,backbone:"backbone","backbone/core-view":1127,underscore:"underscore"}],1081:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">2</div>\n\n  <div class="Editor-HeaderInfo-inner CDB-Text">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.widgets.widgets-form.data.title-label"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.widgets.widgets-form.data.description"))?"":_.escape(__t))+'</p>\n\n    <div data-fields="'+(null==(__t=dataFields)?"":_.escape(__t))+'"></div>\n\n  </div>\n</div>\n\n<div class="CDB-HeaderInfo">\n  <div class="CDB-HeaderNumeration CDB-Text is-semibold u-rSpace--m">3</div>\n\n  <div class="Editor-HeaderInfo-inner CDB-Text">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-TitleText CDB-Size-large">'+(null==(__t=_t("editor.widgets.widgets-form.style.title-label"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m">'+(null==(__t=_t("editor.widgets.widgets-form.style.define"))?"":_.escape(__t))+'</p>\n\n    <div data-fields="'+(null==(__t=styleFields)?"":_.escape(__t))+'"></div>\n\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],1082:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo">\n  <div class="Editor-HeaderNumeration CDB-Text is-semibold u-rSpace--m">1</div>\n  <div class="Editor-HeaderInfo-inner CDB-Text js-selector">\n    <div class="Editor-HeaderInfo-title u-bSpace--m">\n      <h2 class="CDB-Text CDB-HeaderInfo-titleText CDB-Size-large">'+(null==(__t=_t("editor.widgets.widgets-form.type.title-label"))?"":_.escape(__t))+'</h2>\n    </div>\n    <p class="CDB-Text u-upperCase CDB-FontSize-small u-altTextColor u-bSpace--m js-highlight">'+(null==(__t=_t("editor.widgets.widgets-form.type.description"))?"":_.escape(__t))+"</p>\n  </div>\n</div>\n";
return __p}},{underscore:"underscore"}],1083:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../../components/carousel-form-view"),g=a("../../../components/custom-carousel/custom-carousel-collection"),h=a("./widgets-form-factory"),i=a("./widgets-form-fields-view"),j=a("../../../helpers/required-opts"),k=a("../../layers/panel-loading-template.tpl"),l=["userActions","widgetDefinitionModel","modals","querySchemaModel","configModel","userModel"];b.exports=d.extend({initialize:function(a){j(a,l,this),this._initBinds(),this._querySchemaModel.shouldFetch()&&this._querySchemaModel.fetch()},render:function(){return this.clearSubViews(),this.$el.empty(),this._querySchemaModel.isFetched()?(this._renderCarousel(),this._renderForm()):this.$el.html(k()),this},_initBinds:function(){this.listenTo(this._widgetDefinitionModel,"change:type",this._renderForm),this.listenTo(this._querySchemaModel,"change:status",this.render)},_renderCarousel:function(){var b=new g(e.map(h.getDataTypes(this._querySchemaModel),function(a){return{selected:this._widgetDefinitionModel.get("type")===a.value,val:a.value,label:a.label,template:function(){return a.iconTemplate&&a.iconTemplate({makeItBig:!0})||a.value}}},this));b.bind("change:selected",function(a){a.get("selected")&&(this._widgetDefinitionModel.changeType(a.getValue()),this._userActions.saveWidget(this._widgetDefinitionModel))},this);var c=new f({collection:b,template:a("./widgets-form-types.tpl")});this.addView(c),this.$el.append(c.render().el)},_renderForm:function(){this._formView&&(this.removeView(this._formView),this._formView.clean()),this._formView=new i({userActions:this._userActions,widgetDefinitionModel:this._widgetDefinitionModel,querySchemaModel:this._querySchemaModel,modals:this._modals,userModel:this._userModel,configModel:this._configModel}),this.addView(this._formView),this.$el.append(this._formView.render().el)}})},{"../../../components/carousel-form-view":23,"../../../components/custom-carousel/custom-carousel-collection":40,"../../../helpers/required-opts":1097,"../../layers/panel-loading-template.tpl":996,"./widgets-form-factory":1079,"./widgets-form-fields-view":1080,"./widgets-form-types.tpl":1082,"backbone/core-view":1127,underscore:"underscore"}],1084:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-huge is-light u-secondaryTextColor">'+(null==(__t=_t("editor.widgets.widgets-form.placeholder-text"))?"":_.escape(__t))+'</h2>\n<div class="BlockList-item is-dashed no-hover is-space u-tSpace-xl">\n  <div class="WidgetPlaceHolder">\n    <div class="WidgetPlaceHolder-media"></div>\n    <div class="WidgetPlaceHolder-txt">\n        <h2 class="WidgetPlaceHolder-title"></h2>\n        <p class="WidgetPlaceHolder-text"></p>\n    </div>\n  </div>\n  <button class="CDB-Button CDB-Button--primary js-add">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">'+(null==(__t=_t("editor.widgets.widgets-view.add_widget"))?"":_.escape(__t))+"</span>\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],1085:[function(a,b,c){var d=a("./delete-widget-confirmation.tpl"),e=a("../../components/modals/confirmation/modal-confirmation-view"),f=function(){return{init:function(a){if(!a.widgetDefinitionsCollection)throw new Error("widgetDefinitionsCollection is required");if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.userActions)throw new Error("userActions is required");if(!a.modals)throw new Error("modals is required");this._modals=a.modals,this._userActions=a.userActions,this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._widgetDefinitionsCollection=a.widgetDefinitionsCollection,this._analysisDefinitionNodesCollection=a.analysisDefinitionNodesCollection},setStackLayoutBehaviour:function(a,b,c){this._stackLayoutModel=a,this._nextStepProps=b,this._backStepProps=c},removeWidget:function(a,b){var c=a.get("title");a&&this._modals.create(function(f){return new e({modalModel:f,template:d,loadingTitle:_t("editor.widgets.delete.loading",{name:c}),renderOpts:{name:c},runAction:function(){f.destroy(),a.destroy(),b&&b()}})})},editWidget:function(a){this._stackLayoutModel&&this._stackLayoutModel.goToStep(this._nextStepProps.position,a,this._nextStepProps.arguments,function(){this._stackLayoutModel.goToStep(this._backStepProps.position,this._backStepProps.arguments)}.bind(this))}}}();b.exports=f},{"../../components/modals/confirmation/modal-confirmation-view":404,"./delete-widget-confirmation.tpl":1055}],1086:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone"),g=a("backbone/core-view"),h=a("./widget-view"),i=a("./widgets-view.tpl"),j=a("./widgets-placeholder.tpl"),k=a("./widgets-content-error.tpl"),l=a("./widgets-content-not-ready.tpl");a("jquery-ui"),b.exports=g.extend({initialize:function(a){if(!a.userActions)throw new Error("userActions is required");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.widgetDefinitionsCollection)throw new Error("widgetDefinitionsCollection is required");if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");if(!a.modals)throw new Error("modals is required");this._userActions=a.userActions,this._modals=a.modals,this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._widgetDefinitionsCollection=a.widgetDefinitionsCollection,this.stackLayoutModel=a.stackLayoutModel,this._widgetDefinitionsCollection.on("add",this._goToWidget,this),this._widgetDefinitionsCollection.on("destroy",this.render,this),this.add_related_model(this._widgetDefinitionsCollection),this.viewModel=new f.Model({state:"loading"}),this.viewModel.on("change:state",this.render,this),this.add_related_model(this.viewModel);var b=this._onAllQueryGeometryLoaded.bind(this);this._layerDefinitionsCollection.loadAllQueryGeometryModels(b)},render:function(){return this._destroySortable(),this.clearSubViews(),this.$el.empty(),this._isLoading()?this.$el.append(l()):this._anyGeometryData()?this._widgetDefinitionsCollection.size()>0?(this.$el.append(i),d.each(this._widgetDefinitionsCollection.sortBy("order"),this._addWidgetItem,this),this._initSortable()):this.$el.append(j()):this._showNoGeometryData(),this},_showNoGeometryData:function(){this.$el.append(k({body:_t("editor.widgets.no-geometry-data")}))},_onAllQueryGeometryLoaded:function(){this.viewModel.set({state:"ready"})},_isLoading:function(){return"loading"===this.viewModel.get("state")},_isReady:function(){return"ready"===this.viewModel.get("state")},_anyGeometryData:function(){return this._layerDefinitionsCollection.isThereAnyGeometryData()},_initSortable:function(){this.$(".js-widgets").sortable({axis:"y",items:"> li.BlockList-item",opacity:.8,update:this._onSortableFinish.bind(this),forcePlaceholderSize:!1}).disableSelection()},_destroySortable:function(){this.$(".js-widgets").data("ui-sortable")&&this.$(".js-widgets").sortable("destroy")},_onSortableFinish:function(){var a=this;this.$(".js-widgets > .js-widgetItem").each(function(b,c){var d=e(c).data("model-cid"),f=a._widgetDefinitionsCollection.get(d);f.set("order",b),a._userActions.saveWidget(f)})},_goToWidget:function(a){this.stackLayoutModel.nextStep(a,"widget-content")},_addWidgetItem:function(a){var b=new h({model:a,layer:this._layerDefinitionsCollection.get(a.get("layer_id")),modals:this._modals,userActions:this._userActions,stackLayoutModel:this.stackLayoutModel});this.addView(b),this.$(".js-widgets").append(b.render().el)},clean:function(){this._destroySortable(),g.prototype.clean.apply(this)}})},{"./widget-view":1065,"./widgets-content-error.tpl":1067,"./widgets-content-not-ready.tpl":1068,"./widgets-placeholder.tpl":1084,"./widgets-view.tpl":1087,backbone:"backbone","backbone/core-view":1127,jquery:"jquery","jquery-ui":1128,underscore:"underscore"}],1087:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="BlockList js-widgets"></ul>\n';return __p}},{underscore:"underscore"}],1088:[function(a,b,c){b.exports=function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],{name:"IE ",version:a[1]||""}):"Chrome"===c[1]&&(a=b.match(/\bOPR\/(\d+)/),null!=a)?{name:"Opera",version:a[1]}:(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),{name:c[0],version:c[1]})}},{}],1089:[function(a,b,c){b.exports=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]},{}],1090:[function(a,b,c){var d=a("underscore"),e="";b.exports=function(a){if(!a)throw new Error("error is required");try{var b=a.responseText&&a.responseText.trim()&&JSON.parse(a.responseText),c=a.statusText||e;if(b){var f=d.compact(d.map(["errors","error"],function(a){return b[a]&&b[a].join(", ")}));c=f.join(", ")}return c}catch(a){return e}}},{underscore:"underscore"}],1091:[function(a,b,c){var d=function(a){window.trackJs&&window.trackJs.track(a)};b.exports=d},{}],1092:[function(a,b,c){b.exports=function(a,b){if(!a)throw new Error("all query objects are required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.queryRowsCollection)throw new Error("queryRowsCollection is required");var c=function(){return a.querySchemaModel.isFetched()&&a.queryGeometryModel.isFetched()&&a.queryRowsCollection.isFetched()},d=function(){if(a.queryRowsCollection.shouldFetch()){var d={};b&&(d.success=b),a.queryRowsCollection.fetch(d)}else c()&&b&&b()},e=a.queryRowsCollection.size();(a.queryGeometryModel.shouldFetch()||0===e&&a.queryRowsCollection.shouldFetch())&&a.queryGeometryModel.fetch(),a.querySchemaModel.shouldFetch()?a.querySchemaModel.fetch({success:d}):d()}},{}],1093:[function(a,b,c){var d=a("underscore"),e={top:0,left:0},f=10,g=205,h=244,i=function(a){if(!a.parentView)throw new Error("parentView within params is required");if(!d.isNumber(a.posX))throw new Error("posX within params is required");if(!d.isNumber(a.posY))throw new Error("posY within params is required");var b=a.parentView,c=b.outerHeight(),i=b.outerWidth(),j=a.posX,k=a.posY,l=a.offsetX||0,m=a.offsetY||0,n=a.elementWidth||h,o=a.elementHeight||g,p=e;return j-n>f?(p.left="auto",p.right=i-j+l+"px"):j+n>n&&(p.right="auto",p.left=j+l+"px"),k+o<c?(p.bottom="auto",p.top=k+m+"px"):k+o>c&&(p.top="auto",p.bottom=c-k+m+"px"),p};b.exports=i},{underscore:"underscore"}],1094:[function(a,b,c){function d(a){return 2===a.which||3===a.which}function e(a){return a.metaKey}function f(a){return a.ctrlKey}var g=a("jquery");b.exports=function(a){this.killEvent(a);var b=g(a.target).closest("a").attr("href");if(!b)return!1;if(d(a)||e(a))(f(a)||e(a))&&window.open(b,"_blank");else{var c=this.routerModel||this.options.routerModel;if(!c)throw new Error("routerModel is required");c.navigate(b,{trigger:!0})}}},{jquery:"jquery"}],1095:[function(a,b,c){var d=a("cartodb.js"),e=a("carto"),f=a("torque.js"),g=a("underscore"),h=function(a){this.parse_env=null,this.ruleset=null,a&&this.parse(a)};h.prototype={RESERVED_VARIABLES:["mapnik-geometry-type","points_density","points_count","src","value","agg_value","agg_value_density"],parse:function(a){this.parse_env={validation_data:!1,frames:[],errors:[],error:function(b){b.line=e.Parser().extractErrorLine(a,b.index),this.errors.push(b)}};var b=this,c=null,d=null;try{e.tree.Reference.setData(e.default_reference.version.latest),c=new e.Parser(this.parse_env).parse(a)}catch(a){return void(this.parse_env.errors=this.parseError(["style.mss"+a.message]))}if(c){var h,i,j,k,l,m={};this.definitions=d=c.toList(this.parse_env);for(j in d)d[j].elements.length>0&&"Map"===d[j].elements[0].value&&(h=d.splice(j,1)[0]);i=f.cartocss_reference.version.latest.layer,h&&h.rules.forEach(function(a){var c,d,e=a.name;e in i?(c=i[a.name].type,d=a.value.value[0].value[0],b._checkValidType(d,c)||b.parse_env.error({message:"Expected type "+c+".",index:a.index})):b.parse_env.error({message:"Rule "+e+" not allowed for Map.",index:a.index})}),d=e.inheritDefinitions(d,this.parse_env),d=e.sortStyles(d,this.parse_env);for(j in d)for(k in d[j])l=d[j][k],l&&l.toXML&&l.toXML(this.parse_env,m);this.parse_env.errors.message&&g(this.parse_env.errors.message.split("\n")).each(function(a){b.parse_env.errors.push(a)})}return this.ruleset=c,this},_checkValidType:function(a,b){return["number","float"].indexOf(b)>-1?"number"==typeof a.value:"string"===b?"undefined"!==a.value&&"string"==typeof a.value:b.constructor===Array?b.indexOf(a.value)>-1||"linear"===a.value:"color"!==b||this._checkValidColor(a)},_checkValidColor:function(a){var b={rgb:3,hsl:3,rgba:4,hsla:4};return"undefined"!=typeof a.rgb||b[a.name]===a.args},parseError:function(a){var b,c,d,e=[];for(b in a)d=a[b],d&&d.length>0&&(c=d.match(/.*:(\d+):(\d+)\s*(.*)/),c?e.push({line:parseInt(c[1],10),message:c[3]}):e.push({line:null,message:d}));return e.sort(function(a,b){return a.line-b.line}),e=g.uniq(e,!0,function(a){return a.line+a.message})},errors:function(){return this.parse_env?this.parse_env.errors:[]},_colorsFromRule:function(a){function b(a,c){var d,e,f=[];for(d in a)a[d]instanceof c?f.push(a[d]):"object"==typeof a[d]&&(e=b(a[d],c),e.length&&(f=f.concat(e)));return f}return b(a.ev(this.parse_env),e.tree.Color)},_varsFromRule:function(a){function b(a,c){var d,e,f=[];for(d in a)a[d]instanceof c?f.push(a[d]):"object"==typeof a[d]&&(e=b(a[d],c),e.length&&(f=f.concat(e)));return f}return b(a,e.tree.Field)},_extract:function(a,b){var c,d,e,f,h,i,j,k,l,m,n=this,o=[];if(this.ruleset){c=this.ruleset.toList(this.parse_env);for(e in c)if(d=c[e],d.filters){for(f in d.rules)j=d.rules[f],k=a(this,j),o=o.concat(k);if(b)for(h in d.filters){l=d.filters[h];for(i in l)m=l[i],m.key&&m.key.value&&o.push(m.key.value)}}return g.reject(g.uniq(o),function(a){return g.contains(n.RESERVED_VARIABLES,a)})}},colorsUsed:function(a){var b=function(a,b){return g.map(a._colorsFromRule(b),function(a){return a.rgb})},c=this._extract(b,!1);return a&&"hex"===a.mode&&(c=g.map(c,function(a){return d.Utils.rgbToHex(a[0],a[1],a[2])})),c},variablesUsed:function(){var a=function(a,b){return g.map(a._varsFromRule(b),function(a){return a.value})};return this._extract(a,!0)},getDefaultRules:function(){var a,b,c=[],d={};for(a=0;a<this.definitions.length;++a)b=this.definitions[a],8388607===b.zoom&&0===g.size(b.filters.filters)&&"__default__"===b.attachment&&(c=c.concat(b.rules));for(a in c){var e=c[a];d[e.name]=e}return d},getRuleByName:function(a,b){if(!a._rulesByName){var c=a._rulesByName={};for(var d in a.rules){var e=a.rules[d];c[e.name]=e}}return a._rulesByName[b]}},b.exports=h},{carto:"carto","cartodb.js":"cartodb.js","torque.js":"torque.js",underscore:"underscore"}],1096:[function(a,b,c){b.exports=function(a){try{var b=JSON.parse(a);return b.coordinates.join(", ")}catch(a){return!1}}},{}],1097:[function(a,b,c){var d=a("underscore");b.exports=function(a,b,c){if(void 0===b)throw new Error("Opts are required");d.each(b,function(b){if(void 0===a[b])throw new Error(b+" is required");c["_"+b]=a[b]},c)}},{underscore:"underscore"}],1098:[function(a,b,c){b.exports=function(a,b,c,d){if(!a)throw new Error("nodeDefModel is required");if(!b)throw new Error("layerDefModel is required");var e,f="change:ready",g=b.styleModel,h=a.queryGeometryModel,i=a.querySchemaModel;e=function(){if(h.get("ready")&&i.get("ready")){h.unbind(f,e),i.unbind(f,e);var d,j="change:status";d=function(){var e=function(){h.unbind(j,d),i.unbind(j,d)},f=function(){var a=h.get("simple_geom");a?g.setDefaultPropertiesByType("simple",a):g.setDefaultPropertiesByType("none"),b.save()},k=g.get("type");if(!h.isFetching()&&!i.isFetching()){if(!(h.isFetching()||h.isFetched()||i.isFetching()||i.isFetched()))return void e();e();var l=i.hasDifferentSchemaThan(g.getColumnsUsedForStyle());("none"===k||c||(h.hasChanged("simple_geom")||l)&&!b.get("cartocss_custom"))&&(b.collection.contains(b)&&b.get("source")===a.id||c)&&f()}},d(),h.isFetched()||h.bind(j,d),i.isFetched()||i.bind(j,d)}},d&&(h.set("ready",!1),i.set("ready",!1)),h.bind(f,e),i.bind(f,e),e()}},{}],1099:[function(a,b,c){var d=a("./table-name-utils");b.exports={isSameQuery:function(a,b){if(null==a||null==b)throw new Error("Needed parameters not provided");var c=function(a){return a.toLowerCase().replace(/\"/g,"").replace(/;/g,"")};return c(a)===c(b)},altersSchema:function(a){return!!a&&(a=this._removeLineBreaks(a.trim()),a.search(/alter\s+[\w\."]+\s+/i)!==-1||a.search(/drop\s+[\w\.\"]+/i)!==-1||a.search(/^vacuum\s+[\w\.\"]+/i)!==-1||a.search(/^create\s+[\w\.\"]+/i)!==-1||a.search(/^reindex\s+[\w\.\"]+/i)!==-1||a.search(/^grant\s+[\w\.\"]+/i)!==-1||a.search(/^revoke\s+[\w\.\"]+/i)!==-1||a.search(/^cluster\s+[\w\.\"]+/i)!==-1||a.search(/^comment\s+on\s+[\w\.\"]+/i)!==-1||a.search(/^explain\s+[\w\.\"]+/i)!==-1)},altersData:function(a){return!!a&&(a=this._removeLineBreaks(a.trim()),this.altersSchema(a)||a.search(/^refresh\s+materialized\s+view\s+[\w\.\"]+/i)!==-1||a.search(/^truncate\s+[\w\.\"]+/i)!==-1||a.search(/insert\s+into/i)!==-1||a.search(/update\s+[\w\.\-"]+\s+.*set/i)!==-1||a.search(/delete\s+from/i)!==-1)},_removeLineBreaks:function(a){return a.replace(/\r?\n|\r/g," ")},getDefaultSQL:function(a,b,c){return this.getDefaultSQLFromTableName(d.getQualifiedTableName(a,b,c))},getDefaultSQLFromTableName:function(a){return"SELECT * FROM "+a}}},{"./table-name-utils":1101}],1100:[function(a,b,c){b.exports=function(){var a;return function(b){var c=!!b.get("autoStyle");return c||(a={previousCartoCSS:b.get("cartocss"),previousCartoCSSCustom:b.attributes.cartocss_custom}),a}}},{}],1101:[function(a,b,c){b.exports={getUnqualifiedName:function(a){if(!a)return null;var b=a.split(".");return 2===b.length?this._getUnquotedName(b[1]):this._getUnquotedName(a)},getUsername:function(a){if(!a)return null;var b=a.split(".");return 2===b.length?this._getUnquotedName(b[0]):""},_getUnquotedName:function(a){return a&&a.replace(/"/g,"")},_quoteIfNeeded:function(a){var b=/^[a-zA-Z_][a-zA-Z0-9_$]*$/;return a=this._getUnquotedName(a),b.test(a)||(a='"'+a+'"'),a},getQualifiedTableName:function(a,b,c){var d=c&&b?this._quoteIfNeeded(b)+".":"";return d+this._quoteIfNeeded(this.getUnqualifiedName(a))},isSameTableName:function(a,b,c){var d=this._getTableNameParts(a,c),e=this._getTableNameParts(b,c);return d[0]===e[0]&&d[1]===e[1]},_getTableNameParts:function(a,b){var c=this.getUnqualifiedName(a),d=this.getUsername(a)||b;return[d,c]}}},{}],1102:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js");b.exports={isURL:function(a){var b=/^((http|https|ftp)\:\/\/)/g;return!!a&&b.test(a)},isBlank:function(a){return!a||/^\s*$/.test(a)},readablizeBytes:function(a,b){if(!a||isNaN(a))return 0;var c=["bytes","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024)),e=(a/Math.pow(1024,Math.floor(d))).toFixed(2);return b&&(e=parseInt(e,10)),e+" "+c[d]},readizableNumber:function(a){return a>=1e9?(a/1e9).toFixed(1)+"G":a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a},formatNumber:function(a){if(!a)return"0";var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")},result:function(a,b){if(null==a)return null;var c=a[b];return d.isFunction(c)?c.apply(a,Array.prototype.slice.call(arguments,2)):c},getFileExtension:function(a){return a?a.substr(a.lastIndexOf(".")+1):""},pad:function(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c},formatDate:function(a){if(!a.time)throw new Error;if(void 0===a.month)throw new Error;if(void 0===a.year)throw new Error;if(!a.day)throw new Error;var b=parseInt(a.month+1,10),c=function(a){return a=String(a),a<10&&1===a.length?"0"+a:a};return""+a.year+"-"+c(b)+"-"+c(a.day)+"T"+a.time+"Z"},rgbToHex:function(a,b,c){function d(a){var b=a.toString(16);return 1===b.length?"0"+b:b}return"#"+d(a)+d(b)+d(c)},isValidHex:function(a){return!!a.match(/(^#?[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i)},hexToRGB:function(a){a||(a="#FFFFFF");var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},hexToRGBA:function(a,b){function c(a){return+(Math.round(a+"e+2")+"e-2")}var d=this.hexToRGB(a);return b=null!=b?c(b):1,d?"rgba("+[d.r,d.g,d.b,b].join(", ")+")":a},stripHTML:function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a&&"string"==typeof a?a.replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""}):""},sanitizeString:function(a){return a.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"_")},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},formatDecimalPositions:function(a){var b,c=+a,d=0;if(isNaN(c)||0===c)return a;b=Math.abs(c),b>10?d=1:b>.01&&(d=Math.min(Math.ceil(Math.abs(Math.log(b)/Math.log(10)))+2,2)),a=a.toFixed(d);var e=a.match(/(\.0+)$/);return e&&(a=a.replace(e[0],"")),a},removeNewLines:function(a){return a.replace(/(\r\n|\n|\r)/gm,"")},endsWith:function(a,b){return a.indexOf(b,a.length-b.length)!==-1},cloneObject:function(a){return a?JSON.parse(JSON.stringify(a)):a},capitalize:function(a){return a?a.charAt(0).toUpperCase()+a.slice(1):a},sanitizeHtml:function(a){return e.core.sanitize.sanitize(a||"")}}},{"cartodb.js":"cartodb.js",underscore:"underscore"}],1103:[function(a,b,c){var d=a("backbone"),e="viewing",f="drawing",g="editing",h=d.Model.extend({defaults:{mode:e},enterViewingMode:function(){delete this._featureDefinition,this.set("mode",e)},enterDrawingFeatureMode:function(a){this._featureDefinition=a,this.set("mode",f)},enterEditingFeatureMode:function(a){this._featureDefinition=a,this.set("mode",g)},getFeatureDefinition:function(){return this._featureDefinition},isViewingMode:function(){return this._isMode(e)},isDrawingFeatureMode:function(){return this._isMode(f)},isEditingFeatureMode:function(){return this._isMode(g)},_isMode:function(a){return this.get("mode")===a}});b.exports=h},{backbone:"backbone"}],1104:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-header CDB-infowindow-headerBg CDB-infowindow-headerBg--light js-header" style="background: #35AAE5;">\n      {{#loading}}…{{/loading}}\n      <ul class="CDB-infowindow-list">\n        {{#content.fields}}\n          {{^index}}\n            <li class="CDB-infowindow-listItem">\n              {{#title}}<h5 class="CDB-infowindow-subtitle">{{title}}</h5>{{/title}}\n              {{#value}}<h4 class="CDB-infowindow-title {{#type}}{{ type }}{{/type}}">{{{ value }}}</h4>{{/value}}\n            </li>\n            {{^value}}{{/value}}\n          {{/index}}\n        {{/content.fields}}\n      </ul>\n    </div>\n    <div class="CDB-infowindow-inner js-inner">\n      {{#loading}}\n        <div class="CDB-Loader js-loader is-visible"></div>\n      {{/loading}}\n      <ul class="CDB-infowindow-list js-content">\n        {{#content.fields}}\n          {{#index}}\n            <li class="CDB-infowindow-listItem">\n              {{#title}}\n                <h5 class="CDB-infowindow-subtitle">{{title}}</h5>\n              {{/title}}\n              {{#value}}\n                <h4 class="CDB-infowindow-title">{{{ value }}}</h4>\n              {{/value}}\n              {{^value}}\n                <h4 class="CDB-infowindow-title">NULL</h4>\n              {{/value}}\n            </li>\n          {{/index}}\n        {{/content.fields}}\n      </ul>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],1105:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--dark js-infowindow" style="background:#2E3C43">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        {{#loading}}\n          <div class="CDB-Loader js-loader is-visible"></div>\n        {{/loading}}\n        <ul class="CDB-infowindow-list js-content">\n          {{#content.fields}}\n          <li class="CDB-infowindow-listItem">\n            {{#title}}<h5 class="CDB-infowindow-subtitle">{{title}}</h5>{{/title}}\n            {{#value}}<h4 class="CDB-infowindow-title">{{{ value }}}</h4>{{/value}}\n            {{^value}}<h4 class="CDB-infowindow-title">null</h4>{{/value}}\n          </li>\n          {{/content.fields}}\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],1106:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow" data-cover="true">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-header CDB-infowindow-headerMedia js-header js-cover">\n      {{#loading}}<div class="CDB-Loader js-loader"></div>{{/loading}}\n      <div class="CDB-infowindow-mediaTitle">\n        {{#content.fields.1}}\n          {{#value}}\n            <h4 class="CDB-infowindow-title">\n              <span>{{{ value }}}</span>\n            </h4>\n          {{/value}}\n        {{/content.fields.1}}\n      </div>\n    </div>\n    <div class="CDB-infowindow-inner js-inner">\n      {{#loading}}<div class="CDB-Loader js-loader"></div>{{/loading}}\n      <div class="CDB-infowindow-list js-content">\n        {{#content.fields}}\n          {{#index}}\n            <div class="CDB-infowindow-listItem CDB-infowindow-listItem--order{{index}}">\n              {{#title}}<h5 class="CDB-infowindow-subtitle">{{title}}</h5>{{/title}}\n              {{#value}}<h4 class="CDB-infowindow-title">{{{ value }}}</h4>{{/value}}\n              {{^value}}<h4 class="CDB-infowindow-title">null</h4>{{/value}}\n            </div>\n          {{/index}}\n        {{/content.fields}}\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],1107:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        {{#loading}}\n          <div class="CDB-Loader js-loader is-visible"></div>\n        {{/loading}}\n        <ul class="CDB-infowindow-list js-content">\n          {{#content.fields}}\n          <li class="CDB-infowindow-listItem">\n            {{#title}}<h5 class="CDB-infowindow-subtitle">{{title}}</h5>{{/title}}\n            {{#value}}<h4 class="CDB-infowindow-title">{{{ value }}}</h4>{{/value}}\n            {{^value}}<h4 class="CDB-infowindow-title">null</h4>{{/value}}\n          </li>\n          {{/content.fields}}\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],1108:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-infowindow Infowindow-none js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        <ul class="CDB-infowindow-list">\n          <li class="CDB-infowindow-listItem">\n            <h5 class="CDB-infowindow-subtitle">'+(null==(__t=subtitle)?"":_.escape(__t))+'</h5>\n            <h4 class="CDB-infowindow-title">'+(null==(__t=title)?"":_.escape(__t))+'</h4>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],1109:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-header CDB-infowindow-headerBg CDB-infowindow-headerBg--light js-header" style="background: #35AAE5;">\n      {{#loading}}…{{/loading}}\n      <ul class="CDB-infowindow-list">\n        {{#content.fields}}\n          {{^position}}\n        <li class="CDB-infowindow-listItem">\n          {{#title}}\n            {{#alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{alternative_name}}}</h5>\n            {{/alternative_name}}\n            {{^alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{name}}}</h5>\n            {{/alternative_name}}\n          {{/title}}\n          {{#name}}\n          <h4 class="CDB-infowindow-title {{#type}}{{=<% %>=}}{{<%={{ }}=%>{{{ type }}}{{=<% %>=}}}}<%={{ }}=%>{{/type}}">\n            {{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%>\n          </h4>\n          {{/name}}\n        </li>\n          {{/position}}\n        {{/content.fields}}\n      </ul>\n    </div>\n    <div class="CDB-infowindow-inner js-inner">\n      {{#loading}}\n        <div class="CDB-Loader js-loader is-visible"></div>\n      {{/loading}}\n      <ul class="CDB-infowindow-list js-content">\n        {{#content.fields}}\n          {{#position}}\n        <li class="CDB-infowindow-listItem">\n          {{#title}}\n            {{#alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{alternative_name}}}</h5>\n            {{/alternative_name}}\n            {{^alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{name}}}</h5>\n            {{/alternative_name}}\n          {{/title}}\n          <h4 class="CDB-infowindow-title">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n        </li>\n          {{/position}}\n        {{/content.fields}}\n      </ul>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n';
},{}],1110:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--dark js-infowindow" style="background:#2E3C43">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        {{#loading}}\n          <div class="CDB-Loader js-loader is-visible"></div>\n        {{/loading}}\n        <ul class="CDB-infowindow-list js-content">\n          {{#content.fields}}\n          <li class="CDB-infowindow-listItem">\n            {{#title}}\n              {{#alternative_name}}\n              <h5 class="CDB-infowindow-subtitle">{{alternative_name}}</h5>\n              {{/alternative_name}}\n              {{^alternative_name}}\n              <h5 class="CDB-infowindow-subtitle">{{name}}</h5>\n              {{/alternative_name}}\n            {{/title}}\n            <h4 class="CDB-infowindow-title">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n          </li>\n          {{/content.fields}}\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],1111:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow" data-cover="true">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-header CDB-infowindow-headerMedia js-header js-cover">\n      {{#loading}}<div class="CDB-Loader js-loader"></div>{{/loading}}\n      <div class="CDB-infowindow-mediaTitle">\n        {{#content.fields.1}}\n        <h4 class="CDB-infowindow-title">\n          <span>{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></span>\n        </h4>\n        {{/content.fields.1}}\n      </div>\n    </div>\n    <div class="CDB-infowindow-inner js-inner">\n      {{#loading}}<div class="CDB-Loader js-loader"></div>{{/loading}}\n      <div class="CDB-infowindow-list js-content">\n        {{#content.fields}}\n          {{#position}}\n        <div class="CDB-infowindow-listItem CDB-infowindow-listItem--order{{position}}">\n            {{#title}}\n              {{#alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{alternative_name}}}</h5>\n              {{/alternative_name}}\n              {{^alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{name}}}</h5>\n              {{/alternative_name}}\n            {{/title}}\n          <h4 class="CDB-infowindow-title">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n        </div>\n          {{/position}}\n        {{/content.fields}}\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],1112:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        {{#loading}}\n          <div class="CDB-Loader js-loader is-visible"></div>\n        {{/loading}}\n        <ul class="CDB-infowindow-list js-content">\n          {{#content.fields}}\n          <li class="CDB-infowindow-listItem">\n            {{#title}}\n              {{#alternative_name}}\n              <h5 class="CDB-infowindow-subtitle">{{alternative_name}}</h5>\n              {{/alternative_name}}\n              {{^alternative_name}}\n              <h5 class="CDB-infowindow-subtitle">{{name}}</h5>\n              {{/alternative_name}}\n            {{/title}}\n            <h4 class="CDB-infowindow-title">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n          </li>\n          {{/content.fields}}\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],1113:[function(a,b,c){b.exports='<div class="CDB-Tooltip CDB-Tooltip--isDark">\n  <ul class="CDB-Tooltip-list">\n    {{#fields}}\n      <li class="CDB-Tooltip-listItem">\n        {{#title}}\n          <h3 class="CDB-Tooltip-listTitle">{{{ title }}}</h3>\n        {{/title}}\n        <h4 class="CDB-Tooltip-listText">{{{ value }}}</h4>\n      </li>\n    {{/fields}}\n  </ul>\n</div>\n'},{}],1114:[function(a,b,c){b.exports='<div class="CDB-Tooltip CDB-Tooltip--isLight">\n  <ul class="CDB-Tooltip-list">\n    {{#fields}}\n      <li class="CDB-Tooltip-listItem">\n        {{#title}}\n          <h3 class="CDB-Tooltip-listTitle">{{{ title }}}</h3>\n        {{/title}}\n        <h4 class="CDB-Tooltip-listText">{{{ value }}}</h4>\n      </li>\n    {{/fields}}\n  </ul>\n</div>\n'},{}],1115:[function(a,b,c){b.exports='<div class="CDB-Tooltip CDB-Tooltip--isDark">\n  <ul class="CDB-Tooltip-list">\n    {{#content.fields}}\n      <li class="CDB-Tooltip-listItem">\n        {{#title}}\n          <h3 class="CDB-Tooltip-listTitle">{{{ name }}}</h3>\n        {{/title}}\n        <h4 class="CDB-Tooltip-listText">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n      </li>\n    {{/content.fields}}\n  </ul>\n</div>\n'},{}],1116:[function(a,b,c){b.exports='<div class="CDB-Tooltip CDB-Tooltip--isLight">\n  <ul class="CDB-Tooltip-list">\n    {{#content.fields}}\n      <li class="CDB-Tooltip-listItem">\n        {{#title}}\n          <h3 class="CDB-Tooltip-listTitle">{{{ name }}}</h3>\n        {{/title}}\n        <h4 class="CDB-Tooltip-listText">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n      </li>\n    {{/content.fields}}\n  </ul>\n</div>\n'},{}],1117:[function(a,b,c){b.exports={track:function(a){if(!a)throw new Error("several parameters required");if(!a.layerDefinitionsCollection)throw new Error("layerDefinitionsCollection is required");if(!a.analysisDefinitionNodesCollection)throw new Error("analysisDefinitionNodesCollection is required");if(!a.analysisDefinitionsCollection)throw new Error("analysisDefinitionsCollection is required");this._layerDefinitionsCollection=a.layerDefinitionsCollection,this._analysisDefinitionsCollection=a.analysisDefinitionsCollection,a.analysisDefinitionNodesCollection.bind("change:simple_geom",this._onNodeGeometryChange,this)},_onNodeGeometryChange:function(a){if(!a.get("table_name")){var b=this._layerDefinitionsCollection.findWhere({source:a.get("id")});b&&this._analysisDefinitionsCollection.saveAnalysisForLayer(b)}}}},{}],1118:[function(a,b,c){var d=a("underscore"),e=a("./components/notifier/notifier"),f=d.template("<span class='CDB-Text u-errorTextColor'><%- title %></span>"),g="sql-notifications",h={track:function(a){this._notificationId=g},removeNotification:function(){e.removeNotification(this._notificationId)},showNotification:function(a){this._addOrUpdateNotification(this._notificationId,a)},showErrorNotification:function(a){var b={status:"error",info:_t("notifications.sql.error.body",{body:f({title:_t("notifications.sql.error.title")}),error:this._transformErrors(a)}),closable:!1};this._addOrUpdateNotification(this._notificationId,b)},_transformErrors:function(a){return d.map(a,function(a){return a.message},this).join(". ")},_addOrUpdateNotification:function(a,b){var c=this._getNotification(a);c?c.set(b):this._addNotification(a,b)},_addNotification:function(a,b){b=d.extend({id:a},b),e.addNotification(b)},_getNotification:function(a){return e.getNotification(a)}};b.exports=h},{"./components/notifier/notifier":475,underscore:"underscore"}],1119:[function(a,b,c){var d=a("underscore"),e=/^([a-z]+)(\d*)$/,f=function(a,b){if(!a||!a.match)throw new Error("invalid id");var c=a.match(e);if(c[2]=c[2]||-1,c&&3===c.length){var d=c[1],f=parseInt(c[2],10)+b;return d+Math.max(f,0)}throw new Error("invalid id")};b.exports={next:function(a){return f(a,1)},prev:function(a){return f(a,-1)},letter:function(a){if(!a||!d.isString(a))return"";var b=a.match(/^([a-z]+)/);return d.isArray(b)&&b[0]||""},sequence:function(a){if(a&&d.isString(a)){var b=a.match(/(\d+$)/);return d.isArray(b)&&b[0]||void 0}},changeLetter:function(a,b){var c=a.match(/(\d+)$/)[0];return b+c}}},{underscore:"underscore"}],1120:[function(a,b,c){var d=a("underscore");b.exports={OPTIONS:[{distance:"meters",metersPerDistance:1},{distance:"kilometers",metersPerDistance:1e3},{distance:"miles",metersPerDistance:1609.34}],toMeters:function(a,b){if(a=parseFloat(a),isNaN(a))throw new Error("val (1st arg) is required, expected a parseable number or float");var c=d.find(this.OPTIONS,function(a){return a.distance===b});if(!c)throw new Error(b+" (2nd arg) is not a valid distance value, expects one of "+d.pluck(this.OPTIONS,"distance").join(", "));return a*c.metersPerDistance},toDistance:function(a,b){if(a=parseFloat(a),isNaN(a))throw new Error("meters (1st arg) is required");var c=d.find(this.OPTIONS,function(a){return a.distance===b});if(!c)throw new Error(b+" (2nd arg) is not a valid distance value, expects one of "+d.pluck(this.OPTIONS,"distance").join(", "));return a/c.metersPerDistance}}},{underscore:"underscore"}],1121:[function(a,b,c){var d=a("underscore"),e=a("./components/notifier/notifier"),f="visNotification",g=d.template("<span class='CDB-Text is-semibold u-errorTextColor'><%= title %></span>&nbsp;<%= body %>"),h=d.template("<%- message %> <%- body %>"),i={track:function(a){a.on("change:error",this._toggleVisErrorNotification,this),this._toggleVisErrorNotification(a)},_toggleVisErrorNotification:function(a){var b=a.get("error");b?this._showVisErrorNotification(b.message):this._hideVisErrorNotification()},_showVisErrorNotification:function(a){e.addNotification(this._getNotificationAttrs(a))},_hideVisErrorNotification:function(){e.getNotification(f)&&e.removeNotification(f)},_getNotificationAttrs:function(a){var b=_t("notifications.vis.failed.body");return a&&(b=h({message:this._period(a),body:b})),{id:f,status:"error",info:g({title:_t("notifications.vis.failed.title"),body:b}),closable:!1}},_period:function(a){return a&&!/\.$/.test(a)?a+".":a}};b.exports=i},{"./components/notifier/notifier":475,underscore:"underscore"}],1122:[function(a,b,c){var d=a("underscore"),e=a("./components/notifier/notifier"),f=a("./helpers/error-parser"),g=d.template("<span class='u-errorTextColor'><%- title %></span>"),h={track:function(a){this._widgetDefinitionsCollection=a,this._widgetDefinitionsCollection.on("success",this._showAddNotification,this),this._widgetDefinitionsCollection.on("destroy",this._showRemoveNotification,this),this._widgetDefinitionsCollection.on("error",this._showErrorNotification,this),this._widgetDefinitionsCollection.on("loading",this._showLoadingNotification,this),this._widgetDefinitionsCollection.on("updating",this._showUpdatingNotification,this)},_showLoadingNotification:function(a){var b=a.cid,c={status:"loading",info:_t("notifications.widgets.loading"),closable:!1};this._addNotification(b,c)},_showUpdatingNotification:function(a){var b=a.cid,c={status:"loading",info:_t("notifications.widgets.updating"),closable:!1};this._addNotification(b,c)},_showRemoveNotification:function(a){if(a.get("avoidNotification")!==!0){var b={status:"success",info:_t("notifications.widgets.delete"),closable:!0,delay:e.DEFAULT_DELAY};this._addNotification(a.cid,b)}},_showAddNotification:function(a){var b=a.cid,c={status:"success",info:_t("notifications.widgets.success"),closable:!0};this._addOrUpdateNotification(b,c)},_showErrorNotification:function(a,b){var c=a.cid,d={status:"error",info:_t("notifications.widgets.error.body",{body:g({title:_t("notifications.widgets.error.title")}),error:f(b)}),closable:!0};this._addOrUpdateNotification(c,d)},_addOrUpdateNotification:function(a,b){var c=this._getNotification(a);c?c.set(b):this._addNotification(a,b)},_addNotification:function(a,b){b=d.extend({id:a},b),e.addNotification(b)},_getNotification:function(a){return e.getNotification(a)}};b.exports=h},{"./components/notifier/notifier":475,"./helpers/error-parser":1090,underscore:"underscore"}],1123:[function(a,b,c){b.exports={feedback:"Give us feedback!",user:{you:"You"},months:{january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December"},assets:{"maki-icons":{disclaimer:"<a href='https://github.com/mapbox/maki' target='_blank'>Maki Icons</a>, an open source project by <a href='http://mapbox.com' target='_blank'>Mapbox</a>"}},operators:{count:"COUNT",sum:"SUM",avg:"AVG",min:"MIN",max:"MAX"},"builder-activated-notification":{message:"CARTO Builder has been activated in your account. <a href='https://carto.com/learn/guides' class='onboardingNotification-link'>Learn more</a> about it and let us know what you think or <a href='mailto:builder-support@carto.com' class='onboardingNotification-link'>contact us</a>. Happy mapping!"},"builder-onboarding":{title:"Welcome to Builder,",description:"Discover the new and exciting analyses you can perform with location intelligence.","take-tour":"Take a tour","edit-map":"Edit your map",toolbar:{title:"Toolbar",description:"The toolbar provides options to access your dashboard, edit your map, and configure its settings."},configurator:{title:"Edit pane",description:"Manage all the components of your map: add layers and widgets, import datasets, customize analyses, and change styles."},map:{title:"Map",description:"Your map reflects changes instantly."},widgets:{title:"Widgets pane",description:"The widgets you add to your map appear directly on your visualization."},skip:"skip",next:"next"},"data-onboarding":{title:"Welcome to the layer pane",description:"Analyze, style, and enhance your data with pop-ups and&nbsp;legends.","take-tour":"Take the tour","edit-layer":"Edit layer","layer-options":{title:"Layer options",description:"Layers can be renamed by double-clicking on the layer name, centered by clicking in the crosshair, and exported through their contextual menu."},"data-tab":{title:"Data tab",description:"Style, add analysis, pop-ups, and legends to layers. To further explore your data, add widgets."},"sql-editor":{title:"SQL View",description:"Data layers can be edited and processed by using the SQL view at the bottom of the screen."},"add-geometry":{title:"Add geometries and switch to dataset view",description:"You can switch between map or data view. In map view, you can add points, lines, and polygons.","edit-layer":"Edit layer"},exit:"Exit tour",next:"Next"},"analysis-onboarding":{title:"The Art of Analysis",description:"Build reproducible workflows for analyzing and explaining your data. Analyses turn your maps into Location Intelligence apps.","description-list":{item1:"Different analyses can be chained",item2:"Analyses are dynamic. When the data changes, the analysis is&nbsp;refreshed.",item3:"The original data is not modified by the analysis workflow.",item4:"Some analysis queries add calculated results to columns in your dataset."},done:"Done","add-analysis":"Add analysis","never-show-message":"Don't show me this again."},"style-onboarding":{title:"Style this map!",description:"Apply aggregation styling to maps and define options by geometry attributes or by a column value.",aggregation:{title:"How would you like to aggregate your data?",description:'Map types are called "Aggregation". Add Torque, Heatmap, and other aggregation styles to data.'},style:{title:"Make it beautiful!",description:"Use these options to style your data in beautiful ways. For example, you can create thematic maps by altering the FILL option by value.","short-description":"Use these options to style your data in beautiful ways."},cartocss:{title:"Dress it up with CartoCSS",description:"Further style data by using the CartoCSS view at the bottom of the screen."},"take-tour":"Take the tour","style-layer":"Style layer","never-show-message":"Don't show me this again.",exit:"Exit tour",next:"Next"},"analyses-onboarding":{placeholders:{"layer-name":"NAME OF THE LAYER",clusters:"CLUSTERS",method:"METHOD",percentage:"PERCENTAGE"},done:"Done",finished:"has finished","style-analysis":"Style this analysis","read-more":"Read more in documentation","learn-more":"Learn more","never-show-message":"Don't show me this again.","no-new-columns":"No new columns were created.","geometries-updated":"The geometries in your table were updated","new-column-added":"A new column has been added to your dataset.","new-columns-created":"New columns have been created as a new dataset.","new-column-included":"A new column has been included with your original data.","new-columns-included":"New columns has been included with your original data.","new-columns-included-based-on-input":"New columns have been included with your original data based on the columns chosen for the input.",sampling:{title:"Subsample of rows",description:"A sample of your original table was randomly selected to give approximately a percentage of the rows from your input dataset."},merge:{title:"Join columns from 2nd layer",description:"This analysis performed a columnar JOIN in order to get columns from two different tables."},intersection:{title:"Filter points in polygons",description:"This analysis performs a spatial intersection, returning only the rows from the target layer which intersect with geometries in the source layer.","source-cartodb-id":"This number represents the cartodb_id of the source geometry"},"area-of-influence":{title:"Create areas of influence",description:"Area of influence creates polygons according to the parameters set by the user.","the-geom":"This column was updated to show the area of influence requested."},"aggregate-intersection":{title:"Intersect second layer",description:"This operation performs a spatial intersection and aggregates the geometry values from the target layer that intersect with the geometry of the source layer.","count-vals-density":"This column is added if COUNT was chosen as the aggregation operation","extra-column":"This column is added if {operation_type} is chosen with column {column_name}"},filter:{title:"Row filtering",description:"Row filtering allows you to quickly narrow down the total data you display on a map or input into an analysis node."},"filter-by-node-column":{title:"Filter by layer",description:"Filter by layer allows you to filter the data in your layer by propagating the filters in the attached layer. Now if you filter on widgets added to the first node, the results in the second node would be also filtered."},"spatial-markov-trend":{trend:"The normalized trend for each geometry",trend_up:"The probability that a geometry's value will move to a higher class",trend_down:"The probability that a geometry's value will move to a lower class",volatility:"A measure of the potential for a geometry to possess values in other classes",description:"Trends and volatility are calculated based on the time series data input. Trends calculated from inputs with a longer history are more precise. Inputs for the time column should equally spaced (e.g., all one week/month/year apart)."},moran:{title:"Detect outliers and clusters",description:"Detect outliers and clusters finds areas in your data where clusters of high values or low values exist, as well as areas which are dissimilar from their neighbors.",quads:"Classification of the geometry from the analysis",significance:"The statistical significance of the geometry's classification of one of four quadrant types.",moran:"The local statistic calculated from the Moran's I analysis for each geometry/value in the dataset.",rowid:"The original row id of the geometry (cartodb_id)."},kmeans:{title:"Calculating point clusters","cluster-no":"A numeric identifier for each cluster in your dataset. Values start at 1 and go up to the %{clusters} clusters you requested (or max rows if less).",description:"Point clustering is uses k-means to calculate a predefined number of clusters from your data."},"data-observatory-measure":{title:"Enrich from the Data Observatory","custom-column":"This column contains the data requested from the Data Observatory",description:"The Data Observatory enrichment is the result of the geometry location and the measure requested."},"connect-with-lines":{title:"Connect with lines",description:"Create lines from point datasets using a variety of methods","the-geom":"This column was updated to be lines according to the method chosen.","line-sequential":"This analysis creates a line by connecting all points in the dataset in a specified order","line-source-to-target":"Link a source point to a target point based on a shared attribute","line-to-column":"Create lines from a point to to a geometry stored in another column","line-to-single-point":"Connect the coordinate from latitude and longitude columns to the point geometry (`the_geom`) in your dataset."},"group-points":{title:"Group points into polygons","the-geom":"This column was updated to polygons encompassing the input points.",category:"This will be the category over which the polygons were calculated",description:"Group points into polygons to create new polygons."},georeference:{title:"Georeference","the-geom":"This column, which stores the geographic information in your dataset, has been updated to reflect the boundaries or locations from the inputs specified.",description:"Georeferencing data is a service that uses information from many sources to get the geographical information associated with latitude/longitude columns, city names, postal codes, administrative boundaries, IP addresses, or street addresses."},centroid:{title:"Calculating centroids from geometries",description:"Centroids are calculated from all, groups, or singular geometries. Using the optional parameters of Category, Aggregate, and Weight you can change how they are calculated and what information the result will contain. ","the-geom":"Point geometries representing the centroid(s) of your input data.","aggregated-value":"Stores the aggregate value for each centroid.","non-aggregated-value":"Contains the count of features considered for each centroid",category:"Stores the category value for each centroid from the source dataset"},closest:{description:"Find nearest analysis locates the closest points between two tables.",source_cdb_id:"This column has been created with the related points id from the source table.","the-geom":"This column has been updated with the target table geometries.",title:"Find nearest"}},analyses:{"connect-with-lines":{title:"Connect with lines","short-title":"Connect with lines"},georeference:{title:"Georeference","short-title":"Georeference"},"data-observatory-measure":{title:"Enrich from Data Observatory","short-title":"Data observatory","age-and-gender":"Age and Gender",boundaries:"Boundaries",education:"Education",employment:"Employment",families:"Families",housing:"Housing",income:"Income",language:"Language",migration:"Migration",nationality:"Nationality","population-segments":"Population segments","race-and-ethnicity":"Race and Ethnicity",religion:"Religion",transportation:"Transportation",filters:"Filters"},merge:{title:"Join columns from 2nd layer","short-title":"Join columns"},"filter-by-node-column":{title:"Filter by layer","short-title":"Filter by layer"},centroid:{title:"Centroid from geometries","short-title":"Centroid"},"group-points":{title:"Group points into polygons","short-title":"Group points"},"convex-hull":{title:"Convex Hull","short-title":"Convex Hull"},"concave-hull":{title:"Concave Hull","short-title":"Concave Hull"},"bounding-box":{title:"Bounding Box","short-title":"Bounding Box"},"bounding-circle":{title:"Bounding Circle","short-title":"Bounding Circle"},"area-of-influence":{title:"Create areas of influence","short-title":"AOI"},"filter-intersection":{title:"Filter points in polygons","short-title":"Filter points in polygons"},"aggregate-intersection":{title:"Aggregate intersection","short-title":"Aggregate intersection"},filter:{title:"Filter by column value","short-title":"Filter"},sampling:{title:"Subsample percent of rows","short-title":"Sampling"},kmeans:{title:"Calculate clusters of points","short-title":"Clusters"},"moran-cluster":{title:"Detect outliers and clusters","short-title":"Outliers & clusters"},"spatial-markov-trend":{title:"Predict trends and volatility","short-title":"Trends"},source:"Source",routing:{"short-title":"Routing"}},"analysis-category":{all:"All","analyze-predict":"Analyze and predict","create-clean":"Create and clean","data-transformation":"Transform"},"form-components":{editors:{radio:{true:"True",false:"False",null:"Null"},fill:{customize:"Custom color set",quantification:{title:"Quantification",methods:{jenks:"Jenks",equal:"Equal Interval",headtails:"Heads/Tails",quantiles:"Quantiles",category:"Category"}},bins:"Buckets","input-color":{solid:"Solid",value:"By value",img:"Img"},"input-number":{fixed:"Fixed",value:"By value"},"input-ramp":{buckets:"bucket |||| buckets"},"input-categories":{null:"null",others:"Others"},image:{"recently-title":"Most used",none:"None","show-all":"Show full collections"}}}},data:{"import-model":{"error-title":"There was an error","error-starting-import":"Unfortunately, there was an error starting the import"},"upload-model":{"invalid-import":"Invalid import","one-file":"Unfortunately, only one file is allowed per upload","file-defined":"File name should be defined","file-extension":"Unfortunately, this file extension is not allowed","file-size":"Unfortunately, the size of the file is bigger than your remaining quota","visualization-id":"The remote visualization id was not specified","remote-file-size":"Unfortunately, the size of the remote dataset is bigger than your remaining quota","url-invalid":"Unfortunately, the URL provided is not valid","error-happened":"There was an error","connection-error":"Unfortunately, there was a connection error","twitter-dates-invalid":"Twitter dates are not valid","twitter-dates-empty":"Twitter dates are empty","twitter-categories-invalid":"Twitter categories are not valid","twitter-data":"Twitter data is empty","dataset-copy-undefined":"Dataset copy is not defined","query-undefined":"Query is not provided"},"analysis-definition-node-model":{validation:{"missing-required":"Required","invalid-source":"Invalid source","invalid-value":"Invalid value","invalid-enum":"Invalid value, must be any of %{expectedValues}"}}},components:{geocoding:{"geocoding-error-details":{close:"close",description:"There was a problem georeferencing your data",title:"Geocoding Error","try-again":"Please try again and if the problem persists, <a href='mailto:support@carto.com?subject=Geocoding error with id:%{id}'>contact us</a> with the following code:","view-dataset":"view dataset"},"geocoding-success-detail":{"amount-charged":"<strong>$%{price}</strong> will be charged to your account","credits-consumed":"You have consumed all your credits during this billing cycle, price is $%{price} / 1,000 extra credits.",description:"We've successfully geocoded <%- realRowsFormatted %> <%- geometryType %> of <%- processableRowsFormatted %>. |||| We've successfully geocoded <%- realRowsFormatted %> <%- geometryType %>s of <%- processableRowsFormatted %>.",explanation:"Rows that are not geocoded could have errors in their column values, or don’t exist in our data. Try geocoding again and check the 'override all values' to try again.","no-extra-charge":"No extra charges have been done",remainingQuotaFormatted:"You still have %{remainingQuotaFormatted} credits left for this month.",title:"Data geocoded","try-again":"Unsuccessful rows don't count against your quota, so we encourage you to take a look and try again.","view-dataset":"view dataset"},"geocoding-no-result-details":{close:"close",description:"These rows contained empty values or perhaps we just didn't know what the values meant. We encourage you to take a look and try again.",title:"No rows were georeferenced","view-dataset":"view dataset"}},"background-importer":{"background-importer-item":{completed:"completed","error-connecting":"<span class='u-errorTextColor'>Error connecting</span> %{name}",from:"from",show:"show"},"warnings-details":{"continue-btn":"Continue","find-connected-datasets":"You can find all the connected datasets under the datasets section.","no-more-datasets":"No more than %{maxTablesPerImport} datasets can be imported from a single file.","unable-to-import-datasets":"Unable to import all datasets in file"},"partial-import-details":{"find-connected-datasets":"You can find all the connected datasets under the datasets section.","continue-btn":"Continue","too-many-datasets":"NOTE: The file you uploaded contained too many datasets. No more than %{maxTablesPerImport} datasets can be imported from a single file.","unable-to-import-as-layers":"Unable to add all imported datasets as layers","upgrade-your-account":"<a href='https://carto.com/pricing/'>Upgrade your account</a> to add more than %{userMaxLayers} layers to your maps."},"connector-warning-details":{"continue-btn":"Continue","too-many-rows":"You may have reached the maximum limit.","unable-to-import-all-rows":"For a database connector import, the number of rows allowed is %{maxRowsPerConnectorImport}. Some of your data may not be imported."},"error-details":{"check-errors":"Check errors","check-url":"Check that the URL you provided is OK",close:"close","dont-panic":"Don’t panic, here's some info that might help","remote-server-code":"The remote server returned a <span class='ErrorDetails-itemTextStrong'>%{httpResponseCode}</span> code.","send-us-the-error-code":"Persisting error? Please <a href='mailto:support@carto.com'>send us</a> the following code","unknown-error":"An unknown error has happened"},"upgrade-errors":{8001:{description:"Remove some of your datasets to gain available space or upgrade your account",info:"Keep your data and get a larger quota by upgrading your plan",title:"Your quota has run out"},8005:{description:"Remove any layer or upgrade your account",info:"Keep your maps and get more layer count quota by upgrading your plan",title:"You have reached your layer count limit"},upgrade:"upgrade"},"twitter-import-details":{"new-type-created":"We've created a new dataset containing a total of %{datasetTotalRowsFormatted}<br/>tweet%{tweetPlural} with your search terms","credit-left":"You still have %{availableTweetsFormatted} credit left for this billing cycle.","credits-left":"You still have %{availableTweetsFormatted} credits left for this billing cycle.","no-more-credits":"You have consumed all your credits during this billing cycle (price is $%{blockPriceFormatted}/%{blockSizeFormatted} extra credits).","twitter-import-title":"Your Twitter dataset is created","tweet-cost":{free:"No extra charges have been applied",paid:"$%{tweetsCostFormatted} will be charged to your account"},errors:{"no-results":"Your search query was correct but returned no results, \n please try with a different set of parameters before running it again"}},"background-geocoding-item":{geocoded:"%{realRowsFormatted}/%{processableRowsFormatted} row geocoded… |||| %{realRowsFormatted}/%{processableRowsFormatted} rows geocoded…","geocoded-by-lat-lng":"Geocoded by latitude and longitude",geocoding:"Geocoding %{tableName} dataset…",show:"show","rows-geocoded":{"without-dataset":"%{realRowsFormatted} row geocoded |||| %{realRowsFormatted} rows geocoded","in-dataset":"%{realRowsFormatted} row geocoded in %{tableName} dataset|||| %{realRowsFormatted} rows geocoded in %{tableName} dataset"},errors:{"no-rows-geocoded":{"without-dataset":"No rows geocoded","in-dataset":"No rows geocoded in %{tableName} dataset"},"geocoding-layer":"Ouch! There was an error geocoding %{tableName} layer"}},"background-import-limit":{hurry:"In a hurry? <a href='%{upgradeUrl}'>Upgrade your account</a> to import several files at a time","one-file":"Unfortunately, you can only import up to %{importQuota} files at the same time"},"free-trial":"Get a %{days} day free trial",connecting:"Connecting",dataset:"dataset…",
geocoding:"Geocoding",working:"Working…"},"likes-pluralize":"like |||| likes","custom-list":{placeholder:"Search by %{typeLabel}","no-items":"There are no %{typeLabel} items","no-results":"No %{typeLabel} results found with '%{query}'","add-custom-result":"Add custom value"},datepicker:{"dates-placeholder":"Choose your dates","get-last":"Get last",hour:"hour",min:"min",from:"from",to:"to",or:"or","days-pluralize":"1 day |||| %{smart_count} days","weeks-pluralize":"1 week |||| %{smart_count} weeks","hours-pluralize":"hour week |||| %{smart_count} hours","gmt-convertion":"Date will be converted to GMT +0","invalid-date":"Invalid date"},taglist:{none:"No tags",placeholder:"Add tags"},"pagination-search":{filter:{search:"Search",placeholder:"Search by username or email"},loading:{title:"Loading..."},error:{title:"Error",desc:"Oops there was an error."},"no-results":{title:"Oh! No results",desc:"Unfortunately we could not find anything with these parameters"}},modals:{"editor-vis-warning":{title:"You are about to open an Editor map with the new Builder",explanation:"Builder offers an easy-to-use and intuitive drag and drop functionality to analyze and visualize your data. However, some of the old Editor features, such as overlays, are not currently available in Builder.",question:"Opening your map in Builder may cause the loss of any feature not supported yet. Are you sure you want to continue?","go-back":"No, go back to dashboard",open:"Yes, open with Builder",duplicate:"duplicate and open with Builder","opening-title":"Opening %{name} with Builder"},"add-basemap":{"modal-title":"Add a custom basemap","modal-desc":"Select from these great resources","adding-basemap":"Adding new basemap…","add-basemap-error":"Could not add basemap","add-btn":"Add basemap","cancel-btn":"Cancel",validating:"Validating…",saving:"Saving layer…",fetching:"Fetching layers…","get-layers":"Get layers",xyz:{insert:"Insert your XYZ URL",enter:"Enter a URL","not-valid":"Insert a valid XYZ URL",eg:"E.g.",tms:"TMS","couldnt-validate":"We couldn't validate this. If you're sure it contains data click \"add basemap\""},mapbox:{insert:"Insert your Mapbox URL",enter:"Enter your map ID/URL","enter-token":"Enter your access token",error:"Error retrieving your basemap. Please check your access token.",invalid:"This URL is not valid."},wms:{insert:"Insert your WMS/WMTS URL",invalid:"The URL is either invalid or contains unsupported projections","see-docs":"see docs","oh-no":"Oh! No results",unfortunately:"Unfortunately, we couldn't find a layer that matched your search term","tables-pluralize":"table |||| tables",placeholder:"%{layersFoundCount} %{layersFoundCountPluralize} found, %{layersAvailableCount} %{layersAvailableCountPluralize} available"},tilejson:{insert:"Insert your TileJSON URL",invalid:"Invalid URL, please make sure it is correct"},nasa:{select:"Select a date from which you want a NASA Worldview basemap",day:"Day",night:"Night","cant-select":"You can't select a date in night mode"}},"export-data":{title:"Export data",desc:"Select the preferred file format","no-geometry":"To download any geospatial format like SHP, KML or GeoJSON don't forget to select the_geom on your query.",loading:{geometry:"Checking geometries...",preparing:"Preparing content..."},errors:{title:"There was an error","geometry-error":"We can't read data geometries",unknown:"An error occurred"},cancel:"Cancel",download:"Download"},"maps-metadata":{"modal-title":"Map metadata","modal-desc":"Edit the attributes of your map","back-btn":"GO BACK","save-btn":"Save","cancel-btn":"Cancel",form:{name:"Map Name","name-placeholder":"Type your name here",description:"Description","description-placeholder":"Type your description here",tags:"Tags",markdown:"Markdown supported"},validation:{error:{name:"Name can't be blank"}},error:{title:"We couldn't save your data",subtitle:"We had an error trying to save your data: <span class='CDB-Text is-semibold'>%{error}</span>"},loading:"Saving your data...",success:"<span class='CDB-Text is-semibold'>Metadata</span> for %{name} map <span class='CDB-Text is-semibold'>was saved</span>."},"dataset-metadata":{"modal-title":"Dataset metadata","modal-desc":"Edit the attributes of your dataset","back-btn":"GO BACK","save-btn":"Save","cancel-btn":"Cancel",form:{name:"Dataset Name","name-placeholder":"Type your name here",description:"Description","description-placeholder":"Type your description here",attributions:"Attributions","attributions-placeholder":"Type your attributions here",tags:"Tags",source:"Source","source-placeholder":"Enter the source of the data",license:"License",markdown:"Markdown supported"},validation:{error:{name:"Name can't be blank"}},error:{title:"We couldn't save your data",subtitle:"We had an error trying to save your data: <span class='CDB-Text is-semibold'>%{error}</span>"},loading:"Saving your data...",success:"<span class='CDB-Text is-semibold'>Metadata</span> for %{name} dataset <span class='CDB-Text is-semibold'>was saved</span>."},publish:{"done-btn":"Done","update-btn":"Update","publish-btn":"Publish","publishing-btn":"Publishing","updating-btn":"Updating",menu:{share:"Share with colleagues",publish:"publish"},privacy:{privacy:"privacy",cta:{title:"Want some privacy?","desc-trial":"Check our plans with 14 days trial","desc-notrial":"Upgrade your account!"},public:{type:"PUBLIC",title:"Public",body:"Everyone can view your table and download it"},link:{type:"LINK",title:"Only accessible with link",body:"Only the people with a shared link can view the data"},password:{type:"PASSWORD",title:"Password",body:"Set a password and share only with specific people",placeholder:"Type your password"},private:{type:"PRIVATE",title:"Private",body:"Nobody can access this dataset"},error:{title:"We couldn't save your data",subtitle:"We had an internal error trying to save your data. We recommend you try again."},upgrade:{title:"Interested in sharing within your organization?",desc:"%{contact} to try one of our Enterprise plans",contact:"Contact us",mail:"sales@carto.com"},loading:"Saving your data..."},share:{published:"Published %{when}",unpublished:"Never published.","last-published":"Last updated %{date}","unpublished-header":"Click on Publish to start sharing your map on the web","unpublished-subheader":"From the moment you click on publish, you will need to use this window to update your changes on the public version.",upgradeLabel:"Upgrade",upgradeLink:"https://carto.com/pricing/#pricing-standard",upgrade:"%{upgradeLink} to share with your colleagues?",private:"PRIVATE","get-link":{title:"Get the link",body:"Send to your friends, coworkers, or post it in your social networks.",link:"",copy:"COPY",select:"SELECT",private:{body:"Your map is %{private} Change privacy to get the link"}},embed:{title:"Embed it",body:"Insert your map into your blog, website, or simple application.",link:"Get a simple URL.",copy:"COPY",select:"SELECT",private:{body:"Your map is %{private} Change privacy to embed map"}},cartodbjs:{title:"CARTO.js",body:"Add your map to your applications using this URL.",link:"Read more.",copy:"COPY",select:"SELECT"},"mobile-sdk":{title:"CARTO Mobile SDK",body:"Add your map to your native mobile applications using this line of code.",link:"Read more.",copy:"COPY",select:"SELECT"},error:{title:"We couldn't save your data",subtitle:"We had an internal error trying to save your data. We recommend you try again."},loading:"Saving your data...",organization:{title:"Default settings for your Organization",desc:"New users will have this permission"},role:{viewer:"Viewer",builder:"Builder"},tooltip:{group:"Access is inherited from group %{name}",org:"Access is inherited from organization"},toggle:{read:"Read",write:"Write"},"add-people":"Add people"}},"assets-picker":{browse:"Browse","delete-image":"Delete image","delete-images":"Delete images","deselect-all":"Deselect all","drag-and-drop":"Drag & drop your file","error-desc":"Please, go back and try again. If the problem persists contact us at <a href='mailto:support@carto.com'>support@carto.com</a>","go-back":"Go back","incorrect-url":"Error. Your URL doesn’t look correct.",loading:"Loading…",or:"or","select-all":"Select all",submit:"submit","upload-desc":"Paste a URL or select a file like JPG, GIF, PNG, SVG","upload-file-url":"Upload a file or a URL"},"add-asset":{icons:"Icons","modal-desc":"or just use our nice selection","modal-title":"Select marker image","set-image":"Set image","upload-file":"Upload file","upload-asset":"Upload asset","upload-image":"Upload your image","your-uploads":"Your uploads","organization-uploads":"Organization uploads"},"add-analysis":{"modal-title":"Add a new analysis","modal-desc":"Select the analysis you want to add","loading-title":"Loading options","add-btn":"Add analysis","disabled-option-desc":"Your layer's geometries are %{simpleGeometryType} and this analysis needs %{requiredInputGeometries}","unknown-geometry-type":"unknown","info-analysis":"Info about analysis","option-types":{"connect-with-lines":{title:"Connect with lines",desc:"Create lines from point datasets using a variety of methods"},"group-points":{title:"Group points into polygons",desc:"Aggregate points into polygons such as convex hulls or bounding boxes."},"aggregate-intersection":{title:"Intersect second layer",desc:"Intersect with a second layer and calculate aggregations on the fly."},"area-of-influence":{title:"Create areas of influence",desc:"Use travel time (e.g. walking or driving) or distance to calculate areas of influence from points."},georeference:{title:"Georeference",desc:"Use street addresses, city names, or other location text to generate point geometries."},"filter-intersection":{title:"Filter points in polygons",desc:"Filter points intersecting your polygons layer, and augment those with your polygons columns."},filter:{title:"Filter by column value",desc:"Keep or discard rows according to a custom criteria."},merge:{title:"Join columns from 2nd layer",desc:"Join columns from a second layer by linking a shared value found in both datasets."},"moran-cluster":{title:"Detect outliers and clusters",desc:"Use Moran's I to find high (HL) and low (LH) outliers and high (HH) and low (LL) clusters.","high-low":"High-Low (HL)","high-high":"High-High (HH)","low-high":"Low-High (LH)","low-low":"Low-Low (LL)"},kmeans:{title:"Calculate clusters of points",desc:"Spatially separate a layer of points into a specified number (N) of groups."},centroid:{title:"Find centroid of geometries",desc:"Calculate a direct or weighted centroid based on all rows of a layer or by categories."},"filter-by-node-column":{title:"Filter by layer",desc:"Filter your layer depending on a second layer such that widgets will effect both."},sampling:{title:"Subsample percent of rows",desc:"Subsample the rows in a dataset based on a specified percent."},"spatial-markov-trend":{title:"Predict trends and volatility",desc:"Predict probability of upward and downward trends using spatial Markov chains."},"data-observatory-measure":{title:"Enrich from Data Observatory",desc:"Add a new column with contextual demographic and economic measures."},"deprecated-sql-function":{title:"SQL Function",desc:"Run your custom SQL function"}}},"add-widgets":{"modal-title":"Add new widgets","modal-desc":"Select the widgets you want to add","continue-btn":"Continue","loading-title":"Loading columns","tab-pane":{"histogram-label":"Histogram","category-label":"Category","formula-label":"Formula","time-series-label":"Time-series"},"percentage-in-top-cats":"% in top 10 cat","time-series-no-option-title":"None","time-series-no-option-desc":"This option won't show your time-series widget"},"add-layer":{"modal-title":"Add a new layer","modal-desc":"Select an existing dataset or connect a new one",navigation:{search:"Search","search-placeholder":"by name, description, or :tag","connect-dataset":"Connect dataset","shared-with-you":"Shared with you","data-library":"Data library","create-empty-map":"Create empty map","create-empty-dataset":"Create empty dataset","create-empty-addLayer":"Add an empty layer","dataset-pluralize":"Dataset |||| Datasets"},"create-loading-title":"Creating an empty dataset…","adding-new-layer":"Adding new layer…","add-layer-error":"Could not add layer",imports:{"ask-for-demo":"ask for demo",connector:"connector","demo-email-title":"I am interested in the %{name} connector","demo-email-desc":"Hi, I am interested in testing the %{name} connector. Please contact me to schedule a demo of this feature.","tab-options-error":{"no-key":"%{name} key is not specified and the panel can't be enabled","not-allowed":"%{name} data source is not available for your plan. Please upgrade.","limits-reached":"You've reached the limits for your account. Please upgrade.","no-credits":"You've reached the available %{name} credits for your account this month."},"member-pluralize":"member |||| members","item-pluralize":"item |||| items","form-import":{browse:"Browse","drag-and-drop":"Drag & drop your file","error-desc":"Error. Your URL doesn’t look correct.",format:"Format",or:"or",title:"Enter a URL",desc:"Paste a URL and start the import",submit:"submit"},"header-import":{"import-url":"Import your data from a %{brand} URL","file-selected":"File selected","paste-url":"Paste a URL %{fileEnabled} ","select-a-file":"or select a file like CSV, XLS, ZIP, KML, GPX,","see-all-formats":"see all formats","sync-enabled":"Keep it synchronized with the source","sync-disabled":"Sync options are not available","type-selected":"%{brand} selected","type-import":"%{brand} import","upload-file-url":"Upload a file or a URL |||| Upload a URL"},"service-import":{and:"and","account-connected":"Account connected","connect-with":"Connect with %{title}",choose:"Choose",connect:"Connect","found-in":"%{size} %{pluralize} found in %{title}","item-selected":"Item selected","many-more-formats":"many more formats","no-results-title":"Oouch! There are no results","no-results-desc":"We haven't found any valid file from your account","state-idle-login":"Login to your account and select any item.","state-error":"We are sorry that you can’t connect to your %{title} account. Be sure you have any pop-up blockers deactivated for this website.","state-token":"Checking Token.","state-oauth":"Requesting oAuth.","state-retrieving":"A list of your %{title} files will be displayed in a moment.","state-selected-sync":"You can choose when to sync the file.","state-selected-instagram":"A map containing all your georeferenced photos will be created","state-selected-no-sync":"Sync options are not available.",supported:"supported","try-again":"Try again"},"selected-state":{"sync-my-data":"Sync my data",never:"Never","every-hour":"Every hour","every-day":"Every day","every-week":"Every week","every-month":"Every month","free-trial":"%{days} day free trial","more-features":"more features","upgrade-desc":"Upgrade your account to get sync options and %{features}",upgrade:"upgrade"},twitter:{category:"Category","credits-consumed":"Twitter credits for this period consumed - %{extraTweets} will be charged","credits-left":"%{per}% of your %{remainingFormatted} Twitter credits left","credits-no-limit":"No limits - %{extraTweets} will be charged","extra-tweets":"extra tweets","fallback-title":"Enable the %{brand} connector","fallback-desc":"The %{brand} connector allows you to map %{brand} data activity related to your brand, event, or any term you may be interested in.","from-to":"From / to","terms-desc":"Enter up to four search terms using the category fields.","terms-placeholder":"Insert your terms separated by commas",title:"Twitter trends","twitter-gmt":"Time is in GMT+0",use:"Use","your-gmt":"You are in GMT"},arcgis:{"fallback-desc":"Enable the %{brand} connector in your account to connect your %{brand} data to CARTO and mantain it in sync with the source.","input-placeholder":"Paste your %{brand} table URL here","url-desc":"To retrieve a particular layer, add the layer index at the end of the URL","import-data":"Import your data from a %{brand} instance","sync-options":"Sync options only available for a layer"},instagram:{"fallback-desc":"Enable the %{brand} connector to map your photos or videos from your account in CARTO."},box:{"fallback-desc":"Enable the %{brand} connector in your account to map your %{brand} files in CARTO or mantain your CARTO maps in sync with your Box data."},mailchimp:{"campaign-selected":"%{brand} campaign selected","fallback-desc":"Enable the %{brand} connector in your account to map your user lists from %{brand} in CARTO or mantain your CARTO maps in sync with your %{brand} data.","map-campaign":"Map your %{brand} campaigns","state-idle":"Connect your %{brand} account to select any of your campaigns.","state-error":"We are sorry, there has been an error while connecting to your %{brand} account. Just in case it helps, be sure you have the pop-up blocker deactivated for this website.","state-token":"Checking %{brand} token.","state-oauth":"Requesting oAuth.","state-retrieving":"A list of your %{brand} campaigns will be displayed in a moment.","state-selected":"Campaign selected."},salesforce:{"fallback-desc":"Enable the %{brand} connector in your account to map your user lists from %{brand} in CARTO or mantain your CARTO maps in sync with your %{brand} data.","input-placeholder":"Paste your %{brand} URL here"}},datasets:{item:{"sync-failed":"Sync failed, the last attempt was",syncing:"Syncing",synced:"Synced",read:"read",from:"from",by:"by","no-description":"No description","rows-pluralize":"row |||| rows","tags-more":"and %{tagsCount} more","no-tags":"No tags"},loading:"Loading",searching:"Searching",error:{title:"Ouch! There has been an error loading your datasets",desc:"If the problem persists contact us at"},"no-datasets":{title:"You have not connected any datasets yet",desc:"You can %{connectDataset} or %{search} in all our data library","connect-datasets":"connect datasets",search:"search"},"no-results":{desc:"There are no results in this page",found:"found","there-are-no":"There are no","no-fun":"No %{type}, no fun"}},footer:{"guessing-desc":"Let CARTO automatically guess data types and content on import.","twitter-desc":"To get access to historical data (older than 30 days) you need to","contact-team":"contact our team","privacy-upgrade":"You cannot change the privacy of your new datasets. Click here to upgrade your account.","privacy-change":"Your new dataset will be %{privacy}","privacy-click":"Click to change it to %{nextPrivacy}","privacy-change-banned":"You cannot change the privacy of your new datasets.","add-layer":"Add layer"}},"edit-feature":{confirmation:{title:"This geometry is too big to edit from the web",desc:"Editing this geometry could freeze or crash your browser, and you could lose your work. We encourage you to edit this feature through the API.",cancel:"Cancel",continue:"Ok, continue"},delete:{title:"You are about to delete a feature",desc:"Are you sure you want to delete it?",cancel:"Cancel",confirm:"Ok, delete it"}}},error:{"default-title":"Oops, there was a problem","default-desc":"Reload the page again. If the problem persists contact us at <a href='mailto:support@carto.com'>support@carto.com</a>"},"backbone-forms":{select:{placeholder:"Select a %{keyAttr}",loading:"loading…",empty:"No values",selected:"%{count} selected"},operators:{"count-message":"If you select 'COUNT' all columns are selected"},"interval-error":"Value must be between %{minValue} and %{maxValue}","copy-button":"COPY","data-observatory":{dropdown:{measurement:{search:"Search...",type:"measurements"},filter:{header:"Filter measurements by",type:"filters"}}}},codemirror:{"no-errors":"No errors",docs:"DOCS","syntax-error":"Syntax error",line:"Line"},"undo-redo":{clear:"CLEAR",apply:"APPLY"},table:{columns:{"change-type":{confirm:"ok, change it",cancel:"Cancel",desc:"Maps using this column will be affected and unconvertible data will be lost. Are you sure?",error:"There was an error changing %{columnName} column: %{error}",loading:"Changing %{columnName} column...",title:"%{columnName} column will change to %{newType}",success:"Column %{columnName} changed to %{newType}"},create:{loading:"Adding new column...",error:"Error adding new column: %{error}",success:"%{columnName} column added"},destroy:{cancel:"Cancel",confirm:"Ok, delete it",desc:"Maps using this column will be affected, are you sure you want to delete it?",error:"Error deleting %{columnName} column: %{error}",loading:"Removing your column %{columnName}...",success:"%{columnName} column deleted",title:"You are about to delete %{columnName} column "},rename:{cancel:"Cancel",confirm:"ok, rename it",desc:"Maps using this column will be affected, are you sure you want to rename it?",error:"Error renaming column %{columnName} to %{newName}: %{error}",loading:"Renaming your column %{columnName} to %{newName}...",success:"Column %{columnName} renamed to %{newName}",title:"You are about to rename column %{columnName} to %{newName}"},options:{order:"Order",rename:"Rename column",change:"Change data type",create:"Add new column",delete:"Delete this column..."},types:{boolean:"Boolean",date:"Date",number:"Number",string:"String"}},rows:{loading:{title:"Loading rows..."},error:{title:"There was an error...",desc:"It was not possible to obtain any results, check the query applied"},result:{"no-page-title":"Ouch! Sorry","no-page-desc":"This page %{page} doesn't contain any results...","no-results-title":"There is no data","no-results-desc":"","no-results-button":""},options:{copy:"Copy cell value",create:"Add new row",edit:"Edit this cell",delete:"Delete this row..."},create:{loading:"Adding new row...",error:"Error adding new row: %{error}",success:"New row added"},edit:{loading:"Editing %{attribute} with cartodb_id %{cartodbId}...",error:"Error editing %{attribute} with cartodb_id %{cartodbId}: %{error}",success:"Edited %{attribute} with cartodb_id %{cartodbId}"},destroy:{cancel:"Cancel",confirm:"ok, delete",desc:"Are you sure you want to delete it?",error:"Error deleting row with cartodb_id %{cartodb_id}: %{error}",loading:"Removing your row with cartodb_id %{cartodb_id}...",success:"Row with cartodb_id %{cartodb_id} deleted",title:"You are about to delete row with cartodb_id %{cartodb_id}"},paginator:{error:"There was an error with pagination: %{error}",to:"to"}}}},dataset:{sql:"SQL",data:"Metadata",updated:"Updated %{ago}",read:"Read",options:{"add-row":"Add row","add-column":"Add column",export:"Export"},"preview-map":{preview:"preview",back:"back"},"create-map":{title:"Create map",loading:"Creating a map from %{tableName}",error:"There was an error creating the map"},delete:{option:"Delete dataset...",cancel:"Cancel",confirm:"Ok, delete it",desc:"The deleted dataset cannot be recovered, be sure before proceeding. We recommend you to export your dataset before deleting it.",error:"Error deleting %{tableName}: %{error}",loading:"Deleting your dataset %{tableName}...",title:"You are about to delete the %{tableName} dataset","affected-vis-count":"%{smart_count} map affected |||| %{smart_count} maps affected","affected-vis-count-extended":"%{affectedVisCount} maps affected, some of them are","affected-entities-count":"%{smart_count} user will lose access |||| %{smart_count} users will lose access","affected-entities-count-extended":"%{affectedEntitiesCount} users will lose access, some of them are","whole-organization-affected":"All users from your organization will be affected"},metadata:{option:"Edit metadata",error:"There was an error edititng metadata of your dataset %{name}",loading:"Editing metadata of your dataset %{name}..."},duplicate:{option:"Duplicate dataset",query:"applied query",customOption:"Create Dataset from query",error:"There was an error duplicating %{name}",loading:"Duplicating your dataset %{name}..."},lock:{option:"Lock dataset",error:"There was an error locking %{tableName}",loading:"Locking your dataset %{tableName}..."},rename:{option:"Rename dataset",cancel:"Cancel",confirm:"ok, rename it",desc:"If you are accessing this dataset via API, don't forget to use the new name in your API calls afterwards.",error:"Error renaming %{tableName}: %{error}",loading:"Renaming your dataset %{tableName}...",success:"Dataset %{tableName} renamed",title:"Renaming %{tableName} will affect your API calls, maps, analyses, ..."},sync:{"in-a-moment":"in a few moments",synced:"Synced %{ranAt}",syncing:"Syncing",loading:"Syncing dataset %{tableName}","sync-failed":"Sync failed",next:"Next will be %{runAt}","error-code":"Error code %{errorCode}","sync-now":"Sync now","view-options":"View options",disabled:"You will be able to sync manually %{gap} minutes after your last synchronization",title:"Sync dataset options",desc:"Your dataset is in sync with a %{service} file: <br/>%{url}",label:"Sync my data",error:"There was an error setting the interval",confirm:"Save",cancel:"Cancel"},unlock:{cancel:"back to dashboard",confirm:"ok, unlock it",desc:"That means you need to unlock it before doing anything. Are you sure?",error:"Error unlocking %{tableName}: %{error}",loading:"Unlocking your dataset %{tableName}...",success:"Dataset %{tableName} unlocked",title:"Your dataset %{tableName} is locked."}},editor:{map:"map",map_name:"%{name} map",published:"Published %{when}",unpublished:"Map not published yet",map_pluralize:"%{smart_count} map |||| %{smart_count} maps",button_add:"Add",button_share:"SHARE","unpublished-changes":"Unpublished changes","error-query":{body:"Errors found in your SQL query. %{action} before continuing.",label:"Fix them"},settings:{"menu-tab-pane-labels":{preview:"Preview",snapshots:"Snapshots"},preview:{mode:{title:"Mode"},options:{title:"Map Options",subtitle:"Components that are shown in the map",description:{title:"Components",subtitle:"Change map elements"},elements:{search:"Search box",zoom:"Zoom controls",fullscreen:"Fullscreen",scrollwheel:"Scroll wheel zoom",layer_selector:"Layer selector",logo:"CARTO Logo",widgets:"Widgets column",legends:"Legends",dashboard_menu:"Show toolbar"}}}},maps:{options:{duplicate:"Duplicate","edit-metadata":"Edit metadata…","export-image":"Export image…","export-map":"Download map…",remove:"Delete map…",rename:"Rename"},duplicate:{error:"There was an error duplicating %{name}",loading:"Duplicating your map %{name}..."},delete:{confirm:"Ok, delete it",cancel:"Cancel",desc:"The deleted map cannot be recovered, be sure before proceeding.",title:"You are about to delete map %{name}",error:"Error deleting map %{name}: %{error}",loading:"Removing the map %{name}...",success:"Map %{name} deleted"},"export-image":{title:"Export as image",export:"Export",generating:"Generating",disclaimer:{title:"Disclaimer",body:"Legends and widgets won't be exported as part of the image"},download:"Download",errors:{"try-again":"Please, try again. If the problem persists, contact support","error-attribution":"Error generating attribution.","error-basemap":"Error loading basemap.","error-image":"Error generating image."}},export:{confirmation:{confirm:"Download",cancel:"Cancel",desc:"This map, and the connected data, will be downloaded as a .carto file",title:'Download "%{name}"'},download:{confirm:"Download",tip:"Tip: Allow pop-ups from CARTO in your web browser.",desc:"Click Download to begin the .carto file download.",title:"Ready to Download"},error:{title:"An error occured while exporting your map",desc:"Please try again. If the problem persists, please contact support"}},rename:{loading:"Renaming map...",success:"Map renamed to %{name}",error:"Error renaming map %{name}: %{error}"}},"tab-pane":{layers:{"title-label":"Layers",georeference:{title:"Layer not georeferenced",body:"The layer <span class='CDB-Text is-semibold'>%{name}</span> include non-georeferenced data."}},elements:{"title-label":"Elements"},widgets:{"title-label":"Widgets"}},elements:{message:"Unfortunately, map overlays are not available yet, but they will be very soon. Stay tuned!"},layers:{options:{rename:"Rename",delete:"Delete layer…",collapse:"Collapse",expand:"Expand",export:"Export data",hide:"Hide layer",show:"Show layer",edit:"Edit layer","center-map":"Center map on layer"},"drag-n-drop-analysis":{"upgrade-max-layers-err":"%{a_start}Upgrade your account%{a_end} to add more than %{userMaxLayers} layers to your maps."},rename:{loading:"Renaming layer…",success:"Layer renamed to %{name}",error:"<span class='u-errorTextColor'>Error renaming layer</span> %{name}: %{error}"},moveTorqueLayer:{loading:"Moving torque layer to first position...",success:"Layer moved",error:"Error moving the layer..."},delete:{confirm:"Ok, delete it",cancel:"Cancel",desc:"<span class='CDB-Text u-mainTextColor is-semibold'>%{layerVisName}</span> will be affected, are you sure you want to delete it?",title:"You are about to delete the layer %{layerName}",error:"<span class='u-errorTextColor'>Error deleting layer</span>: %{error}",loading:"Removing layer…",success:"Layer deleted correctly.",widgets:"one widget |||| %{smart_count} widgets",analyses:"one analysis |||| %{smart_count} analyses",layers:"one layer |||| %{smart_count} layers","affected-items":"Deleting this layer affects",and:"and","link-to-export":"Before deleting the layer, you can <a href='#' data-event='exportMapAction'>export as .CARTO file</a>"},layer:{animated:"Animated",heatmap:"Pixel",analysis:"Analysis","add-analysis":"Add analysis","analyses-count":"%{smart_count} Analysis |||| %{smart_count} Analyses","widgets-count":"%{smart_count} Widget |||| %{smart_count} Widgets","add-layer":"Add layer",delete:"Delete","cancel-delete-analysis":"Cancel"},basemap:{"remove-baselayer":"Remove baselayer","custom-basemap":"Custom basemap","title-label":"Basemap",by:"by",category:{"title-label":"Source","select-category":"Select source"},style:{"title-label":"Style","select-style":"Select style",color:"Color"},saving:{loading:"Saving new basemap...",error:"Error saving new basemap.",success:"Basemap saved successfully."}},labels:{"title-label":"Labels"},color:{"title-label":"Color"},image:{"title-label":"Image"},gmaps:{"title-label":"Google Maps"},"menu-tab-pane-labels":{data:"Data",analyses:"Analysis",style:"Style",infowindow:"Pop-up",legends:"Legend"},"infowindow-menu-tab-pane-labels":{click:"Click",hover:"Hover"},"analysis-form":{"merge-type":{left:"Returns all rows from #1, with the matching rows in #2 or NULL when there is no match.",inner:"Returns the result of #1 intersecting #2 (i.e. the inner part of a Venn diagram intersection)"},"admin-region":"Admin. Region",aggregate:"Aggregate","aggregate-by":"Aggregate by","aggregate-by-help":"Will calculate aggregate values for each centroid","aggregate-column":"Aggregate column","all-to-all":"All to all","allow-holes":"Allow holes","apply-btn":"Apply",asc:"ASC",bicycle:"Bicycle",boundaries:"Boundaries","bounding-box":"Bounding Box","bounding-circle":"Bounding Circle",by:"By","by-bike":"bike","by-car":"car","by-walk":"walk",car:"Car","categorize-by":"Categorize by","categorize-by-help":"If selected a centroid will be found for each category","category-column":"Category column",city:"City","clusters-num":"# of clusters",column:"Column",columns:"Columns","concave-hull":"Concave Hull","confirm-analysis":"Confirm","convex-hull":"Convex Hull",country:"Country","create-btn":"Apply","data-observatory-measurement-area":"Country","data-observatory-measurement-column":"New col. name","data-observatory-measurement-column-help":"Adds a new column to your layer to store result","data-observatory-measurement-desc":"enrich your data","data-observatory-measurement-measurement":"Measurement","data-observatory-measurement-refine":"Choose a measure","data-observatory-measurement-segments":"Segments","define-columns":"Define column to find similarities with","define-reference-and-target":"Define reference and target layers","define-two-layers":"Define two layers",denominator:"Denominator","denominator-help":"A column to normalize the target column",
"deprecated-sql-function":{"choose-function":"Choose the function to run on this node","choose-function-small":"Choose function","define-params":"define your parameters below",function:"function",input:"input",params:"Your Function's Parameters",target:"target node",title:"SQL Function"},desc:"DESC",direction:"Direction","disabled-by-config":"This analysis type is disabled",dissolved:"Dissolved","dissolved-help":"Combine polygons tracts which have equal ranges",distance:"Distance","enter-latitude":"Enter latitude","enter-longitude":"Enter longitude",filter:"Filter","filter-aggregate":"Aggregate your results","filter-column":"Filter column","foreign-keys":"Foreign Keys","geometry-from":"Geometry from",georeference:{"postal-code-help":"Select a column with postal codes","admin-region-help":"Select a column with region names","admin-region-extended-help":"Specify an admin. region or select a column with region names","admin-region":"Admin. Regions","city-help":"Select a column with city names","city-extended-help":"Specify a city or select a column with city names",city:"Cities","country-help":"Select a column with country names","country-extended-help":"Specify a country or select a column with country names",country:"Countries","enter-city-name":"Or enter city name","enter-country-name":"Or enter country name","enter-region-name":"Or enter region name","enter-state-name":"Or enter state name","ip-address-column":"IP Address","ip-address-help":"Select a column with IP addresses","ip-address":"IP Addresses","long-lat":"Longitude and Latitude","postal-code":"Postal Codes","select-a-country":"Select a country column","select-admin":"Select a region column","select-city":"Select a city column","select-country":"Select country column","select-ip":"Select an IP column","select-latitude":"Select a latitude column","select-longitude":"Select a longitude column","select-postal-code":"Select a postal code column","select-state":"Select state column","select-street-address":"Select an address column","state-help":"Specify a state or select a column with state names","street-address-column":"Street Address","street-address-column-help":"Select a column with street addresses","street-address-help":"Use columns or free text to compose your address schema. <a href='https://carto.com/learn/guides/analysis/geocode-street-addresses-into-point-geometries' target='_blank'>More info.</a>","street-address":"Street Addresses",advance:"Advanced mode",normal:"Normal mode"},"group-by":"Group by",hide:"Hide",inner:"Inner",input:"Input","input-layer":"Define your input layer","input-num":"Input #%{num}",intact:"Intact","intact-help":"Keep all polygon tracts as individual polygons","join-type":"Join Type","keep-columns":"Select the columns you want to keep","key-columns":"Key columns","key-columns-desc":"Choose similar columns to relate them",kilometers:"km",latitude:"Latitude",left:"Left","line-sequential":"Sequential","line-source-to-target":"To Source","line-to-column":"To Column","line-to-single-point":"To Single Point","link-layer":"Link to col.","link-layer-desc":"Specify a second layer to filter by","linked-layer":"Filter by layer",loading:"loading…",longitude:"Longitude",max:"Max","measure-by":"Measure by",meters:"m",method:"Method",miles:"mi",min:"Min",mode:"Mode","find-nearest":{categorized:"Per group","categorized-help":"Calculate results per each category of the chosen column",criteria:"Select the target point layer","define-params":"Define your parameters","define-params-desc":"Define and categorize the number of results",input:"input","max-results":"max results","modal-desc":"Find nearest analysis locates the closest points between two tables.","modal-title":"Find nearest",target:"target",title:"Find nearest"},neighbors:"Neighbors","neighbors-help":"Define the local neighborhood as this many nearest-neighbors",no:"No","no-coincidence":"When no coincidence no row will be added","should-match":"Column types should match",numerator:"Target column","numerator-help":"Measure spatial autocorrelation of this column",operation:"Operation",order:"Order","order-by":"Order by","order-results":"Order your results",parameters:"Parameters","parameters-description":"Tune your analysis",permutations:"Permutations","placeholder-text":"You have not added any analysis yet. Add an analysis to discover new things.",points_source:"Point source",polygons_source:"Polygon source","postal-code":"Postal Code",quota:{title:"confirm your analysis",loading:"Obtaining your quotas...","credits-left-body":"This might incur into an extra cost. Extra credits will be charged at $%{blockPrice}/%{blockSize}.","credits-left-message":"%{smart_count} credit left |||| %{smart_count} credits left","enough-quota":"You need to use approximately %{credits} of your credits.","hard-limit-not-enough-quota":"We're sorry the current quota is insufficient to enrich your data. Rows will be set to null and analysis may not complete. Please %{contact} us to extend your quota for this function.","soft-limit-enough-quota":"We're sorry the current quota is insufficient to enrich your data. This might need about %{credits} extra credits. Extra credits will be charged at $%{blockPrice}/%{blockSize}.","no-quota-assigned-body":"To get access to the %{analysis} function, %{contact}.","no-credits-body":"You have consumed all your credits during this billing cycle. %{contact} to get some more.","no-credits-message":"No credits available","contact-message":{"no-credits":{regular:"Contact us",organization:"Contact your organization admin"},"no-quota-assigned":{regular:"contact our team",organization:"contact your organization admin"}},emails:{support:"support@carto.com",saas:"sales@carto.com"},"quota-error-title":"Error","quota-fetch-error":"There was an error obtaining your quota: %{error}.","quota-dataservice-down":"Dataservices API unreacheable.",cancel:"Cancel",confirm:"confirm","analysis-type":{routing:"Routing","trade-area":"Trade area","georeference-street-address":"Georeference street address","data-observatory-measure":"Data Observatory"}},public_transport:"Public transport",radius:"Distance","reference-layer-pluralize":"Define your reference layer |||| Define your reference layers",result:"Result",right:"Right",sampling:"Sampling","sampling-desc":"Select a sample of the data","sampling-rate":"% of data ","search-by-column-name":"Search by column name","second-geom-required":"This analysis requires a second geometry column","select-column":"Select a column","select-type":"Select data type","setup-analysis":"Setup analysis",show:"Show",significance:"Significance","significance-help":"Filter outliers and clusters to this significance. Smaller numbers are more significant.",source:"Source","source-col":"Source col.","source-column":"Source column","spatial-markov-trend-desc":"select a column for each time period","spatial-markov-trend-time-columns":"Input columns","spatial-markov-trend-time-columns-help":"Each column should contain values for a time period",state:"State",target:"Target","target-layer":"Target layer","intersection-layer":"Intersect layer","filtering-layer":"Filtering layer","base-layer":"Base layer","target-col":"Target col.","target-column":"Target column","target-percent":"Target percent","target-percent-help":"Convex hull lookalike",time:"Time","time-seconds":"Time (Seconds)","to-closest":"To closest","top-range":"Top range",tracts:"Tracts","tracts-help":"Number of AOIs evenly spaced between 0 and RADIUS","tune-analysis":"Tune your analysis","tune-centroid":"Tune your centroid","tune-clusters":"Tune your clusters",units:"Units",type:"Type",value:"Value","value-aggregation":"Value aggregation","value-aggregation-desc":"Aggregate the desired value in your polygon(s)","value-aggregation-centroids":"Aggregate the desired value in your centroid(s)","valid-type":"This kind of data is not valid for this type",walk:"Walk",weight:"Weight","weight-column":"Weight column","weight-type":"Weight type","weighted-by":"Weighted by","weighted-by-help":"Weights contribution by a value for each point",workflow:"Your workflow","write-max-value":"Write max value","write-min-value":"Write min value",yes:"Yes"},infowindow:{"select-fields":"Select fields","no-fields":"You haven’t selected any fields to be shown in the popup.","placeholder-interactivity-text":"Popups are disabled because interactivity is not available for this layer.","placeholder-columns-text":"Popups are disabled because there are no columns available for this layer.","placeholder-geometry":"There's no geometry in your data to add a popup.",style:{"title-label":"Style","select-style":"Select style","window-size":"Window size","header-color":"Header color",none:"None",custom:"Custom",infowindow_light:"Light",infowindow_dark:"Dark",infowindow_color:"Color",infowindow_header_with_image:"Image"},items:{"title-label":"Show items",description:"Add items"}},tooltip:{style:{none:"None",custom:"Custom",tooltip_light:"Light",tooltip_dark:"Dark"},items:{"title-label":"Show items",description:"Add items"}},"filter-options":{top:"Top",bottom:"Bottom",between:"Between","is-equal-to":"Is equal to","is-greater-than":"Is greater than","is-less-than":"Is less than"},notifier:{"center-map":{loading:"Calculating coordinates...",success:"Map centered",error:"Error centering map"}},georeference:{"manually-add":"Please georeference or manually add data to visualize.","georeference-button":"Georeference",visualize:"Layer doesn't have geometry"}},data:{"no-geometry-data":"Your dataset doesn't contain any geometry data.",stats:{"add-widget":"Add as a widget",edit:"EDIT","top-cat":"% in top 10 cat.",trues:"% true",null:"% null","number-of":"%{geometry} count","geometry-fallback":"features"},"data-toggle":{values:"VALUES",cartocss:"SQL"},"code-mirror":{tip:"CMD + S to apply your query. CTRL + Space to autocomplete."},notifier:{"sql-alter-loading":"Modifying table…","sql-alter-error":"Error in SQL query.","sql-alter-success":"Modification applied.","sql-applying":"Applying query…","sql-error":"Error in SQL query.","sql-success":"SQL query applied."},messages:{"sql-readonly":{title:"SQL READ-ONLY",body:"You just applied an analysis to this layer. The SQL is now read- only.",accept:"CLOSE"},"empty-data":{title:"NO DATA AVAILABLE",body:"There is no data available to be displayed."}}},infowindow:{apply:"APPLY","html-toggle":{values:"VALUES",html:"HTML"},"code-mirror":{save:"CMD + S to apply your html.",errors:{empty:"Template can't be empty."}},messages:{"custom-html-applied":{title:"CUSTOM HTML APPLIED",body:"You just applied custom html with HTML editor. You can continue and clean all html.",accept:"CONTINUE"},"layer-hidden":{title:"LAYER HIDDEN",body:"This layer is hidden, changes will not be shown until you make it visible.",show:"SHOW"}}},"export-image":{"invalid-dimension":"Invalid dimension (%{limit}x%{limit}px)",properties:{width:"width",height:"height",size:"Size","size-subtitle":"Manually enter the image size",format:"Format","format-subtitle":"Choose a lossless (PNG) or lossy (JPG) format",options:"Options","options-subtitle":"Configure display options"}},legend:{"no-geometry-data":"There's no geometry in your data to add a legend.","data-toggle":{values:"VALUES",html:"HTML"},"code-mirror":{save:"CMD + S to apply your html.",errors:{empty:"Template can't be empty."},"pre-html":"<!-- insert your custom html code above this line -->","post-html":"<!-- insert your custom html code below this line -->"},"menu-tab-pane-labels":{color:"color",size:"size"},messages:{"custom-legend":{title:"CUSTOM LEGEND APPLIED",body:"You just applied custom html with HTML editor. You can continue and clean all html.",accept:"Delete custom html"},"layer-hidden":{title:"LAYER HIDDEN",body:"This layer is hidden. Changes won't be shown until you make it visible.",show:"SHOW"},"legends-disabled":{title:"LEGENDS DISABLED",body:"The legends setting is disabled. Changes made will not be shown until you enable legends.",show:"ENABLE"}},types:{none:"none",category:"category",gradient:"gradient",bubble:"bubble",custom:"custom"},"legend-form":{type:{title:"Select Style"},properties:{title:"Creating your legend",subtitle:"Add items"},add:"Add item",title:"Title",fill:"Fill","by-size":"By Size","by-color":"By Color",untitled:"Untitled",prefix:"Prefix",suffix:"Suffix","left-label":"Left Label","right-label":"Right Label","top-label":"Top Label","bottom-label":"Bottom Label","custom-label-placeholder":"Override dynamic value"},"pixel-title":"Amount"},style:{types:{none:"-",simple:"none",hexabins:"hexbins",squares:"squares",regions:"Adm. Regions",heatmap:"pixel",animation:"animated"},"style-form":{type:{"title-label":"Aggregation"},aggregation:{"title-label":"Aggregation Options",desc:"Configure how the aggregation works"},properties:{"title-label-point":"Style","title-label-line":"Lines style","title-label-polygon":"Polygons style","placeholder-text":"There's no geometry in your data that could be styled.",georeference:"Georeference",desc:"Change the visualization"},unanimatable:{desc:"Not any numeric or date column found in your data.",body:"You can change your column's type in the %{link}.",label:"table view"}},"code-mirror":{save:"CMD + S to apply your styles."},"style-toggle":{values:"VALUES",cartocss:"CARTOCSS"},messages:{fetched:"Schema fetched, select a style",fetching:"Schema is being fetched, when it is done, different styles will be avaiable",unavailable:"There was a problem getting schema, try to reload",none:"Your styles were reset, choose new styles for your layer, or go back to your previous style.","cartocss-applied":{title:"CARTOCSS APPLIED",body:"You just applied styles with CartoCSS. You can continue or clear all styles.",continue:"CONTINUE",clear:"CLEAR"},"layer-hidden":{title:"LAYER HIDDEN",body:"This layer is hidden, changes won't be shown until you make it visible.",show:"SHOW"},"torque-exists":{title:"TORQUE LAYER",body:"There is already a torque layer in the layers collection. If you continue, this layer will use the default style.",continue:"CONTINUE",cancel:"CANCEL"}},components:{fill:"Fill",stroke:{label:"Stroke",fetching:"Loading node schema...",unavailable:"Error getting node schema",error:"There was an error fetching node schema..."},blending:{label:"Blending",options:{none:"none",darken:"darken",lighten:"lighten",lighter:"lighter","color-dodge":"color-dodge","color-burn":"color-burn",multiply:"multiply",screen:"screen",overlay:"overlay","src-over":"src-over","source-over":"source-over",xor:"xor"}},type:{label:"Type",options:{heatmap:"Heatmap",points:"Points"}},"aggregation-value":"Operation","aggregation-size":{label:"Size",help:"In pixels"},"aggregation-dataset":"Admin. level","labels-enabled":{label:"labels","not-with-animated":"It won't be available with animations"},"labels-attribute":{label:"column",fetching:"Loading node schema...",unavailable:"Error getting node schema",error:"There was an error fetching node schema..."},"labels-font":"font","labels-offset":"offset","labels-fill":"size/color","labels-overlap":{label:"overlap",options:{true:"True",false:"False"}},"labels-halo":"halo","labels-placement":{label:"placement",options:{point:"point",line:"line",vertex:"vertex",interior:"interior"}},"animated-enabled":{label:"animated","already-one-torque":"There is already a torque layer in your map","not-with-labels":"It won't be available with labels"},"animated-attribute":{label:"column",fetching:"Loading node schema...",unavailable:"Error getting node schema",error:"There was an error fetching node schema..."},"animated-overlap":{label:"overlap",options:{true:"Accum.",false:"None"}},"animated-trails":"trails","animated-resolution":"resolution","animated-steps":"steps","animated-duration":"duration"}},widgets:{"no-geometry-data":"Your dataset lacks geometry data, it is not possible to add a widget.",options:{remove:"Delete...",rename:"Rename",edit:"Edit"},delete:{confirm:"Ok, delete it",cancel:"Cancel",desc:"The widget cannot be recovered, be sure before proceeding.",title:"You are about to delete the widget %{name}",error:"Error deleting widget %{name}: %{error}",loading:"Removing the widget %{name}...",success:"Widget %{name} deleted"},"widgets-view":{add_widget:"Add widget"},"widgets-types":{histogram:"Histogram",category:"Category",formula:"Formula","time-series":"Time series"},"widgets-form":{"placeholder-text":"You have not added any widgets yet. Add widgets to discover new things.",type:{"title-label":"Type",description:"Choose the widget type",category:"Category",formula:"Formula",histogram:"Histogram",time_series:"Time Series"},data:{"columns-unavailable":"No columns available",aggregation:"Aggregation",aggregation_column:"Aggregation Column",bins:"Buckets",column:"Column",description:"Configure your values",end:"End",loading:"loading…",operation:"Operation",prefix:"Prefix",start:"Start",suffix:"Suffix",title:"Title","title-label":"Data",value:"Value","aggregate-by":"aggregate by","operation-column":"operation column"},style:{"custom-categories":"Custom categ.","custom-disabled":"If an aggregated style is applied, auto style is disabled","custom-help":"Represent the widget's values with custom colors in the map","custom-ramp":"Custom ramp",define:"Define how your widget interacts with the data",description:"Description",fill:"Fill",no:"No",sync_on_bbox_change:"Dynamic",sync_on_data_change:"Unfiltered","title-label":"Behavior",yes:"Yes"}}},"edit-feature":{features:{point:"point",line:"line",polygon:"polygon"},"loading-state":"Requesting feature data...","error-state":"There was an error requesting feature data","overlay-text":"Start clicking on the map to draw your %{featureType}",add:"Add",save:"Save",attributes:"Attributes","attributes-columns":"Change column names and type in table mode",cancel:"Cancel",geometry:"Geometry","geometry-edit":"You can also edit it on the map","geometry-disabled":"Not available for hidden or read only layers","out-of-bounds-lng":"Longitude is out of bounds [-180, 180]","out-of-bounds-lat":"Latitude is out of bounds [-90, 90]","valid-lng":"Must be a valid longitude","valid-lat":"Must be a valid latitude",valid:"Only numbers allowed",delete:"Delete %{featureType}",edit:"Edit %{featureType}",analysis:"layers with analysis nodes","custom-sql":"layers with custom SQL applied",sync:"read only layers",disabled:"Feature editing is disabled in %{disabledLayerType}. To edit the data, export this layer and import it as a new layer."}},notifications:{vis:{failed:{title:"This map couldn't be rendered",body:"Please refresh the page and contact us if the error persists"}},analysis:{waiting:"Analysis %{nodeId} enqueued...",running:"Analysis %{nodeId} running...",completed:"Analysis %{nodeId} completed",failed:"Analysis %{nodeId} failed",removed:"Analysis %{nodeId} deleted",contact:{label:"contact us",mail:"support@carto.com"},sample:"sample",errors:{timeout:"Your analysis has taken too long. Try to %{sample} your data or %{contact} for further assistance","without-geom-webmercator":'The column "the_geom_webmercator" does not exist'}},widgets:{delete:"Widget deleted correctly.",success:"Widget successfully added",error:{title:"Error adding widget:",body:"%{body} %{error}"},loading:"Adding widget…",updating:"Updating widget…",restoring:"Restoring widgets…",restored:"Widgets restored"},layer:{error:"Layer error: %{error}",added:"Layer added successfully"},cartocss:{error:{body:"%{body} %{error}",title:"Error in CartoCSS styles:"},success:"CartoCSS applied"},sql:{"alter-loading":"Modifying table…","alter-success":"Modification applied",applying:"Applying query…",error:{body:"%{body} %{error}",title:"Error in SQL query:"},success:"SQL query applied"},"edit-feature":{edit:{loading:"Requesting geometry data...",error:"There was an error requesting geometry data"},error:{body:"%{body} %{error}"},destroy:{loading:"Deleting geometry…",error:"Error deleting geometry",success:"Geometry deleted correctly"},save:{loading:"Saving geometry…",error:"Error saving geometry",success:"Geometry successfully saved"},adding:"Adding geometry…"}}}},{}],1124:[function(a,b,c){b.exports={editor:{map:"mapa",map_name:"%{name} mapa",map_pluralize:"%{smart_count} mapa |||| %{smart_count} mapas"}}},{}],1125:[function(a,b,c){b.exports={en:a("./en.json"),sw:a("./sw.json"),es:a("./es.json")}},{"./en.json":1123,"./es.json":1124,"./sw.json":1126}],1126:[function(a,b,c){b.exports={editor:{map:"karta",map_name:"%{name} karta",map_pluralize:"%{smart_count} karta |||| %{smart_count} kartor"}}},{}],1127:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=e.View.extend({classLabel:"cdb.core.View",constructor:function(a){this.options=d.defaults(a,this.options),this._models=[],this._subviews={},e.View.call(this,a),f.viewCount++,f.views[this.cid]=this,this._created_at=new Date},add_related_model:function(a){if(!a)throw new Error("added non valid model");this._models.push(a)},addView:function(a){this._subviews[a.cid]=a,a._parent=this},removeView:function(a){delete this._subviews[a.cid]},clearSubViews:function(){d(this._subviews).each(function(a){a.clean()}),this._subviews={}},clean:function(){return this.trigger("clean"),this.clearSubViews(),this._parent&&(this._parent.removeView(this),this._parent=null),this.remove(),this.allOff(),f.viewCount--,delete f.views[this.cid],this},allOff:function(){this.off(),this.model&&this.model.off&&this.model.off(null,null,this);var a=this;d(this._models).each(function(b){b.off(null,null,a)}),this._models=[]},show:function(){this.$el.show()},hide:function(){this.$el.hide()},retrigger:function(a,b,c){c||(c=a);var d=this;b.bind&&b.bind(a,function(){d.trigger(c)},d),this.add_related_model(b)},killEvent:function(a){a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation()},cleanTooltips:function(){this.$(".tipsy").remove()}},{viewCount:0,views:{},extendEvents:function(a){return function(){return d.extend(a,this.constructor.__super__.events)}},runChecker:function(){d.each(f.views,function(a){d.each(a,function(b,c){"_parent"!==c&&a.hasOwnProperty(c)&&b instanceof f&&void 0===a._subviews[b.cid]&&(console.log("========="),console.log("untracked view: "),console.log(b.el),console.log("parent"),console.log(a.el),console.log(" "))})})}});b.exports=f},{backbone:"backbone",underscore:"underscore"}],1128:[function(a,b,c){!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(b,d){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,!(!b.href||!f||"map"!==e.nodeName.toLowerCase())&&(g=a("img[usemap='#"+f+"']")[0],!!g&&c(g))):(/^(input|select|textarea|button|object)$/.test(h)?!b.disabled:"a"===h?b.href||d:d)&&c(b)}function c(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}function d(a){for(var b,c;a.length&&a[0]!==document;){if(b=a.css("position"),("absolute"===b||"relative"===b||"fixed"===b)&&(c=parseInt(a.css("zIndex"),10),!isNaN(c)&&0!==c))return c;a=a.parent()}return 0}function e(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},a.extend(this._defaults,this.regional[""]),this.regional.en=a.extend(!0,{},this.regional[""]),this.regional["en-US"]=a.extend(!0,{},this.regional.en),this.dpDiv=f(a("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function f(b){var c="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return b.delegate(c,"mouseout",function(){a(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&a(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&a(this).removeClass("ui-datepicker-next-hover")}).delegate(c,"mouseover",g)}function g(){a.datepicker._isDisabledDatepicker(r.inline?r.dpDiv.parent()[0]:r.input[0])||(a(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),a(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&a(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&a(this).addClass("ui-datepicker-next-hover"))}function h(b,c){a.extend(b,c);for(var d in c)null==c[d]&&(b[d]=c[d]);return b}function i(a){return function(){var b=this.element.val();a.apply(this,arguments),this._refresh(),b!==this.element.val()&&this._trigger("change")}}a.ui=a.ui||{},a.extend(a.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({scrollParent:function(b){var c=this.css("position"),d="absolute"===c,e=b?/(auto|scroll|hidden)/:/(auto|scroll)/,f=this.parents().filter(function(){var b=a(this);return(!d||"static"!==b.css("position"))&&e.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return"fixed"!==c&&f.length?f:a(this[0].ownerDocument||document)},uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(c){return b(c,!isNaN(a.attr(c,"tabindex")))},tabbable:function(c){var d=a.attr(c,"tabindex"),e=isNaN(d);return(e||d>=0)&&b(c,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(b,c){function d(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),f&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var e="Width"===c?["Left","Right"]:["Top","Bottom"],f=c.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+c]=function(b){return void 0===b?g["inner"+c].call(this):this.each(function(){a(this).css(f,d(this,b)+"px")})},a.fn["outer"+c]=function(b,e){return"number"!=typeof b?g["outer"+c].call(this,b):this.each(function(){a(this).css(f,d(this,b,!0,e)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),disableSelection:function(){var a="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(a+".ui-disableSelection",function(a){a.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(b){if(void 0!==b)return this.css("zIndex",b);if(this.length)for(var c,d,e=a(this[0]);e.length&&e[0]!==document;){if(c=e.css("position"),("absolute"===c||"relative"===c||"fixed"===c)&&(d=parseInt(e.css("zIndex"),10),!isNaN(d)&&0!==d))return d;e=e.parent()}return 0}}),a.ui.plugin={add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c,d){var e,f=a.plugins[b];if(f&&(d||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(e=0;e<f.length;e++)a.options[f[e][0]]&&f[e][1].apply(a.element,c)}};var j=0,k=Array.prototype.slice;a.cleanData=function(b){return function(c){var d,e,f;for(f=0;null!=(e=c[f]);f++)try{d=a._data(e,"events"),d&&d.remove&&a(e).triggerHandler("remove")}catch(a){}b(c)}}(a.cleanData),a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];return b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g),g},a.widget.extend=function(b){for(var c,d,e=k.call(arguments,1),f=0,g=e.length;f<g;f++)for(c in e[f])d=e[f][c],e[f].hasOwnProperty(c)&&void 0!==d&&(a.isPlainObject(d)?b[c]=a.isPlainObject(b[c])?a.widget.extend({},b[c],d):a.widget.extend({},d):b[c]=d);return b},a.widget.bridge=function(b,c){var d=c.prototype.widgetFullName||b;a.fn[b]=function(e){var f="string"==typeof e,g=k.call(arguments,1),h=this;return f?this.each(function(){var c,f=a.data(this,d);return"instance"===e?(h=f,!1):f?a.isFunction(f[e])&&"_"!==e.charAt(0)?(c=f[e].apply(f,g),c!==f&&void 0!==c?(h=c&&c.jquery?h.pushStack(c.get()):c,!1):void 0):a.error("no such method '"+e+"' for "+b+" widget instance"):a.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+e+"'")}):(g.length&&(e=a.widget.extend.apply(null,[e].concat(g))),this.each(function(){var b=a.data(this,d);b?(b.option(e||{}),b._init&&b._init()):a.data(this,d,new c(e,this))})),h}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,c){c=a(c||this.defaultElement||this)[0],this.element=a(c),this.uuid=j++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=a(),
this.hoverable=a(),this.focusable=a(),c!==this&&(a.data(c,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===c&&this.destroy()}}),this.document=a(c.style?c.ownerDocument:c.document||c),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(b,c){var d,e,f,g=b;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof b)if(g={},d=b.split("."),b=d.shift(),d.length){for(e=g[b]=a.widget.extend({},this.options[b]),f=0;f<d.length-1;f++)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b=d.pop(),1===arguments.length)return void 0===e[b]?null:e[b];e[b]=c}else{if(1===arguments.length)return void 0===this.options[b]?null:this.options[b];g[b]=c}return this._setOptions(g),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!b),b&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){if(b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof g?f[g]:g).apply(f,arguments)}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^([\w:-]*)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(b,c){c=(c||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,b.unbind(c).undelegate(c),this.bindings=a(this.bindings.not(b).get()),this.focusable=a(this.focusable.not(b).get()),this.hoverable=a(this.hoverable.not(b).get())},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}});var l=(a.widget,!1);a(document).mouseup(function(){l=!1});a.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(!l){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var c=this,d=1===b.which,e=!("string"!=typeof this.options.cancel||!b.target.nodeName)&&a(b.target).closest(this.options.cancel).length;return!(d&&!e&&this._mouseCapture(b))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(b)!==!1,!this._mouseStarted)?(b.preventDefault(),!0):(!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return c._mouseMove(a)},this._mouseUpDelegate=function(a){return c._mouseUp(a)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),l=!0,!0))}},_mouseMove:function(b){if(this._mouseMoved){if(a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button)return this._mouseUp(b);if(!b.which)return this._mouseUp(b)}return(b.which||b.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),l=!1,!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});!function(){function b(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function c(b,c){return parseInt(a.css(b,c),10)||0}function d(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var e,f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(void 0!==e)return e;var b,c,d=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),f=d.children()[0];return a("body").append(d),b=f.offsetWidth,d.css("overflow","scroll"),c=f.offsetWidth,b===c&&(c=d[0].clientWidth),d.remove(),e=b-c},getScrollInfo:function(b){var c=b.isWindow||b.isDocument?"":b.element.css("overflow-x"),d=b.isWindow||b.isDocument?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:e,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d||e?c.width():c.outerWidth(),height:d||e?c.height():c.outerHeight()}}},a.fn.position=function(e){if(!e||!e.of)return o.apply(this,arguments);e=a.extend({},e);var n,p,q,r,s,t,u=a(e.of),v=a.position.getWithinInfo(e.within),w=a.position.getScrollInfo(v),x=(e.collision||"flip").split(" "),y={};return t=d(u),u[0].preventDefault&&(e.at="left top"),p=t.width,q=t.height,r=t.offset,s=a.extend({},r),a.each(["my","at"],function(){var a,b,c=(e[this]||"").split(" ");1===c.length&&(c=j.test(c[0])?c.concat(["center"]):k.test(c[0])?["center"].concat(c):["center","center"]),c[0]=j.test(c[0])?c[0]:"center",c[1]=k.test(c[1])?c[1]:"center",a=l.exec(c[0]),b=l.exec(c[1]),y[this]=[a?a[0]:0,b?b[0]:0],e[this]=[m.exec(c[0])[0],m.exec(c[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===e.at[0]?s.left+=p:"center"===e.at[0]&&(s.left+=p/2),"bottom"===e.at[1]?s.top+=q:"center"===e.at[1]&&(s.top+=q/2),n=b(y.at,p,q),s.left+=n[0],s.top+=n[1],this.each(function(){var d,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=c(this,"marginLeft"),t=c(this,"marginTop"),z=l+o+c(this,"marginRight")+w.width,A=m+t+c(this,"marginBottom")+w.height,B=a.extend({},s),C=b(y.my,k.outerWidth(),k.outerHeight());"right"===e.my[0]?B.left-=l:"center"===e.my[0]&&(B.left-=l/2),"bottom"===e.my[1]?B.top-=m:"center"===e.my[1]&&(B.top-=m/2),B.left+=C[0],B.top+=C[1],f||(B.left=i(B.left),B.top=i(B.top)),d={marginLeft:o,marginTop:t},a.each(["left","top"],function(b,c){a.ui.position[x[b]]&&a.ui.position[x[b]][c](B,{targetWidth:p,targetHeight:q,elemWidth:l,elemHeight:m,collisionPosition:d,collisionWidth:z,collisionHeight:A,offset:[n[0]+C[0],n[1]+C[1]],my:e.my,at:e.at,within:v,elem:k})}),e.using&&(j=function(a){var b=r.left-B.left,c=b+p-l,d=r.top-B.top,f=d+q-m,i={target:{element:u,left:r.left,top:r.top,width:p,height:q},element:{element:k,left:B.left,top:B.top,width:l,height:m},horizontal:c<0?"left":b>0?"right":"center",vertical:f<0?"top":d>0?"bottom":"middle"};p<l&&h(b+c)<p&&(i.horizontal="center"),q<m&&h(d+f)<q&&(i.vertical="middle"),g(h(b),h(c))>g(h(d),h(f))?i.important="horizontal":i.important="vertical",e.using.call(this,a,i)}),k.offset(a.extend(B,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&j<=0?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):j>0&&i<=0?a.left=e:i>j?a.left=e+f-b.collisionWidth:a.left=e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&j<=0?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):j>0&&i<=0?a.top=e:i>j?a.top=e+f-b.collisionHeight:a.top=e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];k<0?(c=a.left+m+n+o+b.collisionWidth-g-f,(c<0||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];k<0?(d=a.top+n+o+p+b.collisionHeight-g-f,(d<0||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,g,h=document.getElementsByTagName("body")[0],i=document.createElement("div");b=document.createElement(h?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},h&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(g in d)b.style[g]=d[g];b.appendChild(i),c=h||document.documentElement,c.insertBefore(b,c.firstChild),i.style.cssText="position: absolute; left: 10.7432222px;",e=a(i).offset().left,f=e>10&&e<11,b.innerHTML="",c.removeChild(b)}()}();a.ui.position,a.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var b=this.options;this.prevShow=this.prevHide=a(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),b.collapsible||b.active!==!1&&null!=b.active||(b.active=0),this._processPanels(),b.active<0&&(b.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():a()}},_createIcons:function(){var b=this.options.icons;b&&(a("<span>").addClass("ui-accordion-header-icon ui-icon "+b.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(b.header).addClass(b.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var a;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),a=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&a.css("height","")},_setOption:function(a,b){return"active"===a?void this._activate(b):("event"===a&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(b)),this._super(a,b),"collapsible"!==a||b||this.options.active!==!1||this._activate(0),"icons"===a&&(this._destroyIcons(),b&&this._createIcons()),void("disabled"===a&&(this.element.toggleClass("ui-state-disabled",!!b).attr("aria-disabled",b),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!b))))},_keydown:function(b){if(!b.altKey&&!b.ctrlKey){var c=a.ui.keyCode,d=this.headers.length,e=this.headers.index(b.target),f=!1;switch(b.keyCode){case c.RIGHT:case c.DOWN:f=this.headers[(e+1)%d];break;case c.LEFT:case c.UP:f=this.headers[(e-1+d)%d];break;case c.SPACE:case c.ENTER:this._eventHandler(b);break;case c.HOME:f=this.headers[0];break;case c.END:f=this.headers[d-1]}f&&(a(b.target).attr("tabIndex",-1),a(f).attr("tabIndex",0),f.focus(),b.preventDefault())}},_panelKeyDown:function(b){b.keyCode===a.ui.keyCode.UP&&b.ctrlKey&&a(b.currentTarget).prev().focus()},refresh:function(){var b=this.options;this._processPanels(),b.active===!1&&b.collapsible===!0||!this.headers.length?(b.active=!1,this.active=a()):b.active===!1?this._activate(0):this.active.length&&!a.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(b.active=!1,this.active=a()):this._activate(Math.max(0,b.active-1)):b.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var a=this.headers,b=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),b&&(this._off(a.not(this.headers)),this._off(b.not(this.panels)))},_refresh:function(){var b,c=this.options,d=c.heightStyle,e=this.element.parent();this.active=this._findActive(c.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var b=a(this),c=b.uniqueId().attr("id"),d=b.next(),e=d.uniqueId().attr("id");b.attr("aria-controls",e),d.attr("aria-labelledby",c)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(c.event),"fill"===d?(b=e.height(),this.element.siblings(":visible").each(function(){var c=a(this),d=c.css("position");"absolute"!==d&&"fixed"!==d&&(b-=c.outerHeight(!0))}),this.headers.each(function(){b-=a(this).outerHeight(!0)}),this.headers.next().each(function(){a(this).height(Math.max(0,b-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")):"auto"===d&&(b=0,this.headers.next().each(function(){b=Math.max(b,a(this).css("height","").height())}).height(b))},_activate:function(b){var c=this._findActive(b)[0];c!==this.active[0]&&(c=c||this.active[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return"number"==typeof b?this.headers.eq(b):a()},_setupEvents:function(b){var c={keydown:"_keydown"};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,c),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget),f=e[0]===d[0],g=f&&c.collapsible,h=g?a():e.next(),i=d.next(),j={oldHeader:d,oldPanel:i,newHeader:g?a():e,newPanel:h};b.preventDefault(),f&&!c.collapsible||this._trigger("beforeActivate",b,j)===!1||(c.active=!g&&this.headers.index(e),this.active=f?a():e,this._toggle(j),d.removeClass("ui-accordion-header-active ui-state-active"),c.icons&&d.children(".ui-accordion-header-icon").removeClass(c.icons.activeHeader).addClass(c.icons.header),f||(e.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),c.icons&&e.children(".ui-accordion-header-icon").removeClass(c.icons.header).addClass(c.icons.activeHeader),e.next().addClass("ui-accordion-content-active")))},_toggle:function(b){var c=b.newPanel,d=this.prevShow.length?this.prevShow:b.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=c,this.prevHide=d,this.options.animate?this._animate(c,d,b):(d.hide(),c.show(),this._toggleComplete(b)),d.attr({"aria-hidden":"true"}),d.prev().attr({"aria-selected":"false","aria-expanded":"false"}),c.length&&d.length?d.prev().attr({tabIndex:-1,"aria-expanded":"false"}):c.length&&this.headers.filter(function(){return 0===parseInt(a(this).attr("tabIndex"),10)}).attr("tabIndex",-1),c.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(a,b,c){var d,e,f,g=this,h=0,i=a.css("box-sizing"),j=a.length&&(!b.length||a.index()<b.index()),k=this.options.animate||{},l=j&&k.down||k,m=function(){g._toggleComplete(c)};return"number"==typeof l&&(f=l),"string"==typeof l&&(e=l),e=e||l.easing||k.easing,f=f||l.duration||k.duration,b.length?a.length?(d=a.show().outerHeight(),b.animate(this.hideProps,{duration:f,easing:e,step:function(a,b){b.now=Math.round(a)}}),void a.hide().animate(this.showProps,{duration:f,easing:e,complete:m,step:function(a,c){c.now=Math.round(a),"height"!==c.prop?"content-box"===i&&(h+=c.now):"content"!==g.options.heightStyle&&(c.now=Math.round(d-b.outerHeight()-h),h=0)}})):b.animate(this.hideProps,f,e,m):a.animate(this.showProps,f,e,m)},_toggleComplete:function(a){var b=a.oldPanel;b.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),b.length&&(b.parent()[0].className=b.parent()[0].className),this._trigger("activate",null,a)}}),a.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(a){a.preventDefault()},"click .ui-menu-item":function(b){var c=a(b.target);!this.mouseHandled&&c.not(".ui-state-disabled").length&&(this.select(b),b.isPropagationStopped()||(this.mouseHandled=!0),c.has(".ui-menu").length?this.expand(b):!this.element.is(":focus")&&a(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(b){if(!this.previousFilter){var c=a(b.currentTarget);c.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(b,c)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(a,b){var c=this.active||this.element.find(this.options.items).eq(0);b||this.focus(a,c)},blur:function(b){this._delay(function(){a.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(b)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(a){this._closeOnDocumentClick(a)&&this.collapseAll(a),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var b=a(this);b.data("ui-menu-submenu-carat")&&b.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(b){var c,d,e,f,g=!0;switch(b.keyCode){case a.ui.keyCode.PAGE_UP:this.previousPage(b);break;case a.ui.keyCode.PAGE_DOWN:this.nextPage(b);break;case a.ui.keyCode.HOME:this._move("first","first",b);break;case a.ui.keyCode.END:this._move("last","last",b);break;case a.ui.keyCode.UP:this.previous(b);break;case a.ui.keyCode.DOWN:this.next(b);break;case a.ui.keyCode.LEFT:this.collapse(b);break;case a.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(b);break;case a.ui.keyCode.ENTER:case a.ui.keyCode.SPACE:this._activate(b);break;case a.ui.keyCode.ESCAPE:this.collapse(b);break;default:g=!1,d=this.previousFilter||"",e=String.fromCharCode(b.keyCode),f=!1,clearTimeout(this.filterTimer),e===d?f=!0:e=d+e,c=this._filterMenuItems(e),c=f&&c.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):c,c.length||(e=String.fromCharCode(b.keyCode),c=this._filterMenuItems(e)),c.length?(this.focus(b,c),this.previousFilter=e,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}g&&b.preventDefault()},_activate:function(a){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(a):this.select(a))},refresh:function(){var b,c,d=this,e=this.options.icons.submenu,f=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),f.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var b=a(this),c=b.parent(),d=a("<span>").addClass("ui-menu-icon ui-icon "+e).data("ui-menu-submenu-carat",!0);c.attr("aria-haspopup","true").prepend(d),b.attr("aria-labelledby",c.attr("id"))}),b=f.add(this.element),c=b.find(this.options.items),c.not(".ui-menu-item").each(function(){var b=a(this);d._isDivider(b)&&b.addClass("ui-widget-content ui-menu-divider")}),c.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),c.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!a.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(a,b){"icons"===a&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(b.submenu),"disabled"===a&&this.element.toggleClass("ui-state-disabled",!!b).attr("aria-disabled",b),this._super(a,b)},focus:function(a,b){var c,d;this.blur(a,a&&"focus"===a.type),this._scrollIntoView(b),this.active=b.first(),d=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",d.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),a&&"keydown"===a.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),c=b.children(".ui-menu"),c.length&&a&&/^mouse/.test(a.type)&&this._startOpening(c),this.activeMenu=b.parent(),this._trigger("focus",a,{item:b})},_scrollIntoView:function(b){var c,d,e,f,g,h;this._hasScroll()&&(c=parseFloat(a.css(this.activeMenu[0],"borderTopWidth"))||0,d=parseFloat(a.css(this.activeMenu[0],"paddingTop"))||0,e=b.offset().top-this.activeMenu.offset().top-c-d,f=this.activeMenu.scrollTop(),g=this.activeMenu.height(),h=b.outerHeight(),e<0?this.activeMenu.scrollTop(f+e):e+h>g&&this.activeMenu.scrollTop(f+e-g+h))},blur:function(a,b){b||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",a,{item:this.active}))},_startOpening:function(a){clearTimeout(this.timer),"true"===a.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(a)},this.delay))},_open:function(b){var c=a.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(b.parents(".ui-menu")).hide().attr("aria-hidden","true"),b.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(c)},collapseAll:function(b,c){clearTimeout(this.timer),this.timer=this._delay(function(){var d=c?this.element:a(b&&b.target).closest(this.element.find(".ui-menu"));d.length||(d=this.element),this._close(d),this.blur(b),this.activeMenu=d},this.delay)},_close:function(a){a||(a=this.active?this.active.parent():this.element),a.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(b){return!a(b.target).closest(".ui-menu").length},_isDivider:function(a){return!/[^\-\u2014\u2013\s]/.test(a.text())},collapse:function(a){var b=this.active&&this.active.parent().closest(".ui-menu-item",this.element);b&&b.length&&(this._close(),this.focus(a,b))},expand:function(a){var b=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();b&&b.length&&(this._open(b.parent()),this._delay(function(){this.focus(a,b)}))},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,c){var d;this.active&&(d="first"===a||"last"===a?this.active["first"===a?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[a+"All"](".ui-menu-item").eq(0)),d&&d.length&&this.active||(d=this.activeMenu.find(this.options.items)[b]()),this.focus(c,d)},nextPage:function(b){var c,d,e;return this.active?void(this.isLastItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return c=a(this),c.offset().top-d-e<0}),this.focus(b,c)):this.focus(b,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(b)},previousPage:function(b){var c,d,e;return this.active?void(this.isFirstItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return c=a(this),c.offset().top-d+e>0}),this.focus(b,c)):this.focus(b,this.activeMenu.find(this.options.items).first()))):void this.next(b)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(b){this.active=this.active||a(b.target).closest(".ui-menu-item");var c={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(b,!0),this._trigger("select",b,c)},_filterMenuItems:function(b){var c=b.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),d=new RegExp("^"+c,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return d.test(a.trim(a(this).text()))})}});a.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var b,c,d,e=this.element[0].nodeName.toLowerCase(),f="textarea"===e,g="input"===e;this.isMultiLine=!!f||!g&&this.element.prop("isContentEditable"),this.valueMethod=this.element[f||g?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(e){if(this.element.prop("readOnly"))return b=!0,d=!0,void(c=!0);b=!1,d=!1,c=!1;var f=a.ui.keyCode;switch(e.keyCode){case f.PAGE_UP:b=!0,this._move("previousPage",e);break;case f.PAGE_DOWN:b=!0,this._move("nextPage",e);break;case f.UP:b=!0,this._keyEvent("previous",e);break;case f.DOWN:b=!0,this._keyEvent("next",e);break;case f.ENTER:this.menu.active&&(b=!0,e.preventDefault(),this.menu.select(e));break;case f.TAB:this.menu.active&&this.menu.select(e);break;case f.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(e),e.preventDefault());break;default:c=!0,this._searchTimeout(e)}},keypress:function(d){if(b)return b=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||d.preventDefault());if(!c){var e=a.ui.keyCode;switch(d.keyCode){case e.PAGE_UP:this._move("previousPage",d);break;case e.PAGE_DOWN:this._move("nextPage",d);
break;case e.UP:this._keyEvent("previous",d);break;case e.DOWN:this._keyEvent("next",d)}}},input:function(a){return d?(d=!1,void a.preventDefault()):void this._searchTimeout(a)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(a){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(a),void this._change(a))}}),this._initSource(),this.menu=a("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(b){b.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var c=this.menu.element[0];a(b.target).closest(".ui-menu-item").length||this._delay(function(){var b=this;this.document.one("mousedown",function(d){d.target===b.element[0]||d.target===c||a.contains(c,d.target)||b.close()})})},menufocus:function(b,c){var d,e;return this.isNewMenu&&(this.isNewMenu=!1,b.originalEvent&&/^mouse/.test(b.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){a(b.target).trigger(b.originalEvent)})):(e=c.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",b,{item:e})&&b.originalEvent&&/^key/.test(b.originalEvent.type)&&this._value(e.value),d=c.item.attr("aria-label")||e.value,void(d&&a.trim(d).length&&(this.liveRegion.children().hide(),a("<div>").text(d).appendTo(this.liveRegion))))},menuselect:function(a,b){var c=b.item.data("ui-autocomplete-item"),d=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=d,this._delay(function(){this.previous=d,this.selectedItem=c})),!1!==this._trigger("select",a,{item:c})&&this._value(c.value),this.term=this._value(),this.close(a),this.selectedItem=c}}),this.liveRegion=a("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(a,b){this._super(a,b),"source"===a&&this._initSource(),"appendTo"===a&&this.menu.element.appendTo(this._appendTo()),"disabled"===a&&b&&this.xhr&&this.xhr.abort()},_appendTo:function(){var b=this.options.appendTo;return b&&(b=b.jquery||b.nodeType?a(b):this.document.find(b).eq(0)),b&&b[0]||(b=this.element.closest(".ui-front")),b.length||(b=this.document[0].body),b},_initSource:function(){var b,c,d=this;a.isArray(this.options.source)?(b=this.options.source,this.source=function(c,d){d(a.ui.autocomplete.filter(b,c.term))}):"string"==typeof this.options.source?(c=this.options.source,this.source=function(b,e){d.xhr&&d.xhr.abort(),d.xhr=a.ajax({url:c,data:b,dataType:"json",success:function(a){e(a)},error:function(){e([])}})}):this.source=this.options.source},_searchTimeout:function(a){clearTimeout(this.searching),this.searching=this._delay(function(){var b=this.term===this._value(),c=this.menu.element.is(":visible"),d=a.altKey||a.ctrlKey||a.metaKey||a.shiftKey;b&&(!b||c||d)||(this.selectedItem=null,this.search(null,a))},this.options.delay)},search:function(a,b){return a=null!=a?a:this._value(),this.term=this._value(),a.length<this.options.minLength?this.close(b):this._trigger("search",b)!==!1?this._search(a):void 0},_search:function(a){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:a},this._response())},_response:function(){var b=++this.requestIndex;return a.proxy(function(a){b===this.requestIndex&&this.__response(a),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(a){a&&(a=this._normalize(a)),this._trigger("response",null,{content:a}),!this.options.disabled&&a&&a.length&&!this.cancelSearch?(this._suggest(a),this._trigger("open")):this._close()},close:function(a){this.cancelSearch=!0,this._close(a)},_close:function(a){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",a))},_change:function(a){this.previous!==this._value()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(b){return b.length&&b[0].label&&b[0].value?b:a.map(b,function(b){return"string"==typeof b?{label:b,value:b}:a.extend({},b,{label:b.label||b.value,value:b.value||b.label})})},_suggest:function(b){var c=this.menu.element.empty();this._renderMenu(c,b),this.isNewMenu=!0,this.menu.refresh(),c.show(),this._resizeMenu(),c.position(a.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(b,c){var d=this;a.each(c,function(a,c){d._renderItemData(b,c)})},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-autocomplete-item",b)},_renderItem:function(b,c){return a("<li>").text(c.label).appendTo(b)},_move:function(a,b){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(a)||this.menu.isLastItem()&&/^next/.test(a)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[a](b):void this.search(null,b)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(a,b){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(a,b),b.preventDefault())}}),a.extend(a.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(b,c){var d=new RegExp(a.ui.autocomplete.escapeRegex(c),"i");return a.grep(b,function(a){return d.test(a.label||a.value||a)})}}),a.widget("ui.autocomplete",a.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(a){return a+(a>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(b){var c;this._superApply(arguments),this.options.disabled||this.cancelSearch||(c=b&&b.length?this.options.messages.results(b.length):this.options.messages.noResults,this.liveRegion.children().hide(),a("<div>").text(c).appendTo(this.liveRegion))}});var m,n=(a.ui.autocomplete,"ui-button ui-widget ui-state-default ui-corner-all"),o="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",p=function(){var b=a(this);setTimeout(function(){b.find(":ui-button").button("refresh")},1)},q=function(b){var c=b.name,d=b.form,e=a([]);return c&&(c=c.replace(/'/g,"\\'"),e=d?a(d).find("[name='"+c+"'][type=radio]"):a("[name='"+c+"'][type=radio]",b.ownerDocument).filter(function(){return!this.form})),e};a.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,p),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var b=this,c=this.options,d="checkbox"===this.type||"radio"===this.type,e=d?"":"ui-state-active";null===c.label&&(c.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(n).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){c.disabled||this===m&&a(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){c.disabled||a(this).removeClass(e)}).bind("click"+this.eventNamespace,function(a){c.disabled&&(a.preventDefault(),a.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),d&&this.element.bind("change"+this.eventNamespace,function(){b.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(c.disabled)return!1}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(c.disabled)return!1;a(this).addClass("ui-state-active"),b.buttonElement.attr("aria-pressed","true");var d=b.element[0];q(d).not(d).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return!c.disabled&&(a(this).addClass("ui-state-active"),m=this,void b.document.one("mouseup",function(){m=null}))}).bind("mouseup"+this.eventNamespace,function(){return!c.disabled&&void a(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(b){return!c.disabled&&void(b.keyCode!==a.ui.keyCode.SPACE&&b.keyCode!==a.ui.keyCode.ENTER||a(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){a(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(b){b.keyCode===a.ui.keyCode.SPACE&&a(this).click()})),this._setOption("disabled",c.disabled),this._resetButton()},_determineButtonType:function(){var a,b,c;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(a=this.element.parents().last(),b="label[for='"+this.element.attr("id")+"']",this.buttonElement=a.find(b),this.buttonElement.length||(a=a.length?a.siblings():this.element.siblings(),this.buttonElement=a.filter(b),this.buttonElement.length||(this.buttonElement=a.find(b))),this.element.addClass("ui-helper-hidden-accessible"),c=this.element.is(":checked"),c&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",c)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(n+" ui-state-active "+o).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(a,b){return this._super(a,b),"disabled"===a?(this.widget().toggleClass("ui-state-disabled",!!b),this.element.prop("disabled",!!b),void(b&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")))):void this._resetButton()},refresh:function(){var b=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");b!==this.options.disabled&&this._setOption("disabled",b),"radio"===this.type?q(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var b=this.buttonElement.removeClass(o),c=a("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),d=this.options.icons,e=d.primary&&d.secondary,f=[];d.primary||d.secondary?(this.options.text&&f.push("ui-button-text-icon"+(e?"s":d.primary?"-primary":"-secondary")),d.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+d.primary+"'></span>"),d.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+d.secondary+"'></span>"),this.options.text||(f.push(e?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||b.attr("title",a.trim(c)))):f.push("ui-button-text-only"),b.addClass(f.join(" "))}}),a.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(a,b){"disabled"===a&&this.buttons.button("option",a,b),this._super(a,b)},refresh:function(){var b="rtl"===this.element.css("direction"),c=this.element.find(this.options.items),d=c.filter(":ui-button");c.not(":ui-button").button(),d.button("refresh"),this.buttons=c.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(b?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}});a.ui.button;a.extend(a.ui,{datepicker:{version:"1.11.4"}});var r;a.extend(e.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(a){return h(this._defaults,a||{}),this},_attachDatepicker:function(b,c){var d,e,f;d=b.nodeName.toLowerCase(),e="div"===d||"span"===d,b.id||(this.uuid+=1,b.id="dp"+this.uuid),f=this._newInst(a(b),e),f.settings=a.extend({},c||{}),"input"===d?this._connectDatepicker(b,f):e&&this._inlineDatepicker(b,f)},_newInst:function(b,c){var d=b[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:d,input:b,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:c,dpDiv:c?f(a("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(b,c){var d=a(b);c.append=a([]),c.trigger=a([]),d.hasClass(this.markerClassName)||(this._attachments(d,c),d.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(c),a.data(b,"datepicker",c),c.settings.disabled&&this._disableDatepicker(b))},_attachments:function(b,c){var d,e,f,g=this._get(c,"appendText"),h=this._get(c,"isRTL");c.append&&c.append.remove(),g&&(c.append=a("<span class='"+this._appendClass+"'>"+g+"</span>"),b[h?"before":"after"](c.append)),b.unbind("focus",this._showDatepicker),c.trigger&&c.trigger.remove(),d=this._get(c,"showOn"),"focus"!==d&&"both"!==d||b.focus(this._showDatepicker),"button"!==d&&"both"!==d||(e=this._get(c,"buttonText"),f=this._get(c,"buttonImage"),c.trigger=a(this._get(c,"buttonImageOnly")?a("<img/>").addClass(this._triggerClass).attr({src:f,alt:e,title:e}):a("<button type='button'></button>").addClass(this._triggerClass).html(f?a("<img/>").attr({src:f,alt:e,title:e}):e)),b[h?"before":"after"](c.trigger),c.trigger.click(function(){return a.datepicker._datepickerShowing&&a.datepicker._lastInput===b[0]?a.datepicker._hideDatepicker():a.datepicker._datepickerShowing&&a.datepicker._lastInput!==b[0]?(a.datepicker._hideDatepicker(),a.datepicker._showDatepicker(b[0])):a.datepicker._showDatepicker(b[0]),!1}))},_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b,c,d,e,f=new Date(2009,11,20),g=this._get(a,"dateFormat");g.match(/[DM]/)&&(b=function(a){for(c=0,d=0,e=0;e<a.length;e++)a[e].length>c&&(c=a[e].length,d=e);return d},f.setMonth(b(this._get(a,g.match(/MM/)?"monthNames":"monthNamesShort"))),f.setDate(b(this._get(a,g.match(/DD/)?"dayNames":"dayNamesShort"))+20-f.getDay())),a.input.attr("size",this._formatDate(a,f).length)}},_inlineDatepicker:function(b,c){var d=a(b);d.hasClass(this.markerClassName)||(d.addClass(this.markerClassName).append(c.dpDiv),a.data(b,"datepicker",c),this._setDate(c,this._getDefaultDate(c),!0),this._updateDatepicker(c),this._updateAlternate(c),c.settings.disabled&&this._disableDatepicker(b),c.dpDiv.css("display","block"))},_dialogDatepicker:function(b,c,d,e,f){var g,i,j,k,l,m=this._dialogInst;return m||(this.uuid+=1,g="dp"+this.uuid,this._dialogInput=a("<input type='text' id='"+g+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),a("body").append(this._dialogInput),m=this._dialogInst=this._newInst(this._dialogInput,!1),m.settings={},a.data(this._dialogInput[0],"datepicker",m)),h(m.settings,e||{}),c=c&&c.constructor===Date?this._formatDate(m,c):c,this._dialogInput.val(c),this._pos=f?f.length?f:[f.pageX,f.pageY]:null,this._pos||(i=document.documentElement.clientWidth,j=document.documentElement.clientHeight,k=document.documentElement.scrollLeft||document.body.scrollLeft,l=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[i/2-100+k,j/2-150+l]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),m.settings.onSelect=d,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),a.blockUI&&a.blockUI(this.dpDiv),a.data(this._dialogInput[0],"datepicker",m),this},_destroyDatepicker:function(b){var c,d=a(b),e=a.data(b,"datepicker");d.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),a.removeData(b,"datepicker"),"input"===c?(e.append.remove(),e.trigger.remove(),d.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==c&&"span"!==c||d.removeClass(this.markerClassName).empty(),r===e&&(r=null))},_enableDatepicker:function(b){var c,d,e=a(b),f=a.data(b,"datepicker");e.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),"input"===c?(b.disabled=!1,f.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==c&&"span"!==c||(d=e.children("."+this._inlineClass),d.children().removeClass("ui-state-disabled"),d.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=a.map(this._disabledInputs,function(a){return a===b?null:a}))},_disableDatepicker:function(b){var c,d,e=a(b),f=a.data(b,"datepicker");e.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),"input"===c?(b.disabled=!0,f.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==c&&"span"!==c||(d=e.children("."+this._inlineClass),d.children().addClass("ui-state-disabled"),d.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=a.map(this._disabledInputs,function(a){return a===b?null:a}),this._disabledInputs[this._disabledInputs.length]=b)},_isDisabledDatepicker:function(a){if(!a)return!1;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]===a)return!0;return!1},_getInst:function(b){try{return a.data(b,"datepicker")}catch(a){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(b,c,d){var e,f,g,i,j=this._getInst(b);return 2===arguments.length&&"string"==typeof c?"defaults"===c?a.extend({},a.datepicker._defaults):j?"all"===c?a.extend({},j.settings):this._get(j,c):null:(e=c||{},"string"==typeof c&&(e={},e[c]=d),void(j&&(this._curInst===j&&this._hideDatepicker(),f=this._getDateDatepicker(b,!0),g=this._getMinMaxDate(j,"min"),i=this._getMinMaxDate(j,"max"),h(j.settings,e),null!==g&&void 0!==e.dateFormat&&void 0===e.minDate&&(j.settings.minDate=this._formatDate(j,g)),null!==i&&void 0!==e.dateFormat&&void 0===e.maxDate&&(j.settings.maxDate=this._formatDate(j,i)),"disabled"in e&&(e.disabled?this._disableDatepicker(b):this._enableDatepicker(b)),this._attachments(a(b),j),this._autoSize(j),this._setDate(j,f),this._updateAlternate(j),this._updateDatepicker(j))))},_changeDatepicker:function(a,b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){var b=this._getInst(a);b&&this._updateDatepicker(b)},_setDateDatepicker:function(a,b){var c=this._getInst(a);c&&(this._setDate(c,b),this._updateDatepicker(c),this._updateAlternate(c))},_getDateDatepicker:function(a,b){var c=this._getInst(a);return c&&!c.inline&&this._setDateFromField(c,b),c?this._getDate(c):null},_doKeyDown:function(b){var c,d,e,f=a.datepicker._getInst(b.target),g=!0,h=f.dpDiv.is(".ui-datepicker-rtl");if(f._keyEvent=!0,a.datepicker._datepickerShowing)switch(b.keyCode){case 9:a.datepicker._hideDatepicker(),g=!1;break;case 13:return e=a("td."+a.datepicker._dayOverClass+":not(."+a.datepicker._currentClass+")",f.dpDiv),e[0]&&a.datepicker._selectDay(b.target,f.selectedMonth,f.selectedYear,e[0]),c=a.datepicker._get(f,"onSelect"),c?(d=a.datepicker._formatDate(f),c.apply(f.input?f.input[0]:null,[d,f])):a.datepicker._hideDatepicker(),!1;case 27:a.datepicker._hideDatepicker();break;case 33:a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 34:a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,"stepMonths"),"M");break;case 35:(b.ctrlKey||b.metaKey)&&a.datepicker._clearDate(b.target),g=b.ctrlKey||b.metaKey;break;case 36:(b.ctrlKey||b.metaKey)&&a.datepicker._gotoToday(b.target),g=b.ctrlKey||b.metaKey;break;case 37:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,h?1:-1,"D"),g=b.ctrlKey||b.metaKey,b.originalEvent.altKey&&a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 38:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,-7,"D"),g=b.ctrlKey||b.metaKey;break;case 39:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,h?-1:1,"D"),g=b.ctrlKey||b.metaKey,b.originalEvent.altKey&&a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,"stepMonths"),"M");break;case 40:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,7,"D"),g=b.ctrlKey||b.metaKey;break;default:g=!1}else 36===b.keyCode&&b.ctrlKey?a.datepicker._showDatepicker(this):g=!1;g&&(b.preventDefault(),b.stopPropagation())},_doKeyPress:function(b){var c,d,e=a.datepicker._getInst(b.target);if(a.datepicker._get(e,"constrainInput"))return c=a.datepicker._possibleChars(a.datepicker._get(e,"dateFormat")),d=String.fromCharCode(null==b.charCode?b.keyCode:b.charCode),b.ctrlKey||b.metaKey||d<" "||!c||c.indexOf(d)>-1},_doKeyUp:function(b){var c,d=a.datepicker._getInst(b.target);if(d.input.val()!==d.lastVal)try{c=a.datepicker.parseDate(a.datepicker._get(d,"dateFormat"),d.input?d.input.val():null,a.datepicker._getFormatConfig(d)),c&&(a.datepicker._setDateFromField(d),a.datepicker._updateAlternate(d),a.datepicker._updateDatepicker(d))}catch(a){}return!0},_showDatepicker:function(b){if(b=b.target||b,"input"!==b.nodeName.toLowerCase()&&(b=a("input",b.parentNode)[0]),!a.datepicker._isDisabledDatepicker(b)&&a.datepicker._lastInput!==b){var c,e,f,g,i,j,k;c=a.datepicker._getInst(b),a.datepicker._curInst&&a.datepicker._curInst!==c&&(a.datepicker._curInst.dpDiv.stop(!0,!0),c&&a.datepicker._datepickerShowing&&a.datepicker._hideDatepicker(a.datepicker._curInst.input[0])),e=a.datepicker._get(c,"beforeShow"),f=e?e.apply(b,[b,c]):{},f!==!1&&(h(c.settings,f),c.lastVal=null,a.datepicker._lastInput=b,a.datepicker._setDateFromField(c),a.datepicker._inDialog&&(b.value=""),a.datepicker._pos||(a.datepicker._pos=a.datepicker._findPos(b),a.datepicker._pos[1]+=b.offsetHeight),g=!1,a(b).parents().each(function(){return g|="fixed"===a(this).css("position"),!g}),i={left:a.datepicker._pos[0],top:a.datepicker._pos[1]},a.datepicker._pos=null,c.dpDiv.empty(),c.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),a.datepicker._updateDatepicker(c),i=a.datepicker._checkOffset(c,i,g),c.dpDiv.css({position:a.datepicker._inDialog&&a.blockUI?"static":g?"fixed":"absolute",display:"none",left:i.left+"px",top:i.top+"px"}),c.inline||(j=a.datepicker._get(c,"showAnim"),k=a.datepicker._get(c,"duration"),c.dpDiv.css("z-index",d(a(b))+1),a.datepicker._datepickerShowing=!0,a.effects&&a.effects.effect[j]?c.dpDiv.show(j,a.datepicker._get(c,"showOptions"),k):c.dpDiv[j||"show"](j?k:null),a.datepicker._shouldFocusInput(c)&&c.input.focus(),a.datepicker._curInst=c))}},_updateDatepicker:function(b){this.maxRows=4,r=b,b.dpDiv.empty().append(this._generateHTML(b)),this._attachHandlers(b);var c,d=this._getNumberOfMonths(b),e=d[1],f=17,h=b.dpDiv.find("."+this._dayOverClass+" a");h.length>0&&g.apply(h.get(0)),b.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),e>1&&b.dpDiv.addClass("ui-datepicker-multi-"+e).css("width",f*e+"em"),b.dpDiv[(1!==d[0]||1!==d[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),b.dpDiv[(this._get(b,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),b===a.datepicker._curInst&&a.datepicker._datepickerShowing&&a.datepicker._shouldFocusInput(b)&&b.input.focus(),b.yearshtml&&(c=b.yearshtml,setTimeout(function(){c===b.yearshtml&&b.yearshtml&&b.dpDiv.find("select.ui-datepicker-year:first").replaceWith(b.yearshtml),c=b.yearshtml=null},0))},_shouldFocusInput:function(a){return a.input&&a.input.is(":visible")&&!a.input.is(":disabled")&&!a.input.is(":focus")},_checkOffset:function(b,c,d){var e=b.dpDiv.outerWidth(),f=b.dpDiv.outerHeight(),g=b.input?b.input.outerWidth():0,h=b.input?b.input.outerHeight():0,i=document.documentElement.clientWidth+(d?0:a(document).scrollLeft()),j=document.documentElement.clientHeight+(d?0:a(document).scrollTop());return c.left-=this._get(b,"isRTL")?e-g:0,c.left-=d&&c.left===b.input.offset().left?a(document).scrollLeft():0,c.top-=d&&c.top===b.input.offset().top+h?a(document).scrollTop():0,c.left-=Math.min(c.left,c.left+e>i&&i>e?Math.abs(c.left+e-i):0),c.top-=Math.min(c.top,c.top+f>j&&j>f?Math.abs(f+h):0),c},_findPos:function(b){for(var c,d=this._getInst(b),e=this._get(d,"isRTL");b&&("hidden"===b.type||1!==b.nodeType||a.expr.filters.hidden(b));)b=b[e?"previousSibling":"nextSibling"];return c=a(b).offset(),[c.left,c.top]},_hideDatepicker:function(b){var c,d,e,f,g=this._curInst;!g||b&&g!==a.data(b,"datepicker")||this._datepickerShowing&&(c=this._get(g,"showAnim"),d=this._get(g,"duration"),e=function(){a.datepicker._tidyDialog(g)},a.effects&&(a.effects.effect[c]||a.effects[c])?g.dpDiv.hide(c,a.datepicker._get(g,"showOptions"),d,e):g.dpDiv["slideDown"===c?"slideUp":"fadeIn"===c?"fadeOut":"hide"](c?d:null,e),c||e(),this._datepickerShowing=!1,f=this._get(g,"onClose"),f&&f.apply(g.input?g.input[0]:null,[g.input?g.input.val():"",g]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),a.blockUI&&(a.unblockUI(),a("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(b){if(a.datepicker._curInst){var c=a(b.target),d=a.datepicker._getInst(c[0]);(c[0].id===a.datepicker._mainDivId||0!==c.parents("#"+a.datepicker._mainDivId).length||c.hasClass(a.datepicker.markerClassName)||c.closest("."+a.datepicker._triggerClass).length||!a.datepicker._datepickerShowing||a.datepicker._inDialog&&a.blockUI)&&(!c.hasClass(a.datepicker.markerClassName)||a.datepicker._curInst===d)||a.datepicker._hideDatepicker()}},_adjustDate:function(b,c,d){var e=a(b),f=this._getInst(e[0]);this._isDisabledDatepicker(e[0])||(this._adjustInstDate(f,c+("M"===d?this._get(f,"showCurrentAtPos"):0),d),this._updateDatepicker(f))},_gotoToday:function(b){var c,d=a(b),e=this._getInst(d[0]);this._get(e,"gotoCurrent")&&e.currentDay?(e.selectedDay=e.currentDay,e.drawMonth=e.selectedMonth=e.currentMonth,e.drawYear=e.selectedYear=e.currentYear):(c=new Date,e.selectedDay=c.getDate(),e.drawMonth=e.selectedMonth=c.getMonth(),e.drawYear=e.selectedYear=c.getFullYear()),this._notifyChange(e),this._adjustDate(d)},_selectMonthYear:function(b,c,d){var e=a(b),f=this._getInst(e[0]);f["selected"+("M"===d?"Month":"Year")]=f["draw"+("M"===d?"Month":"Year")]=parseInt(c.options[c.selectedIndex].value,10),this._notifyChange(f),this._adjustDate(e)},_selectDay:function(b,c,d,e){var f,g=a(b);a(e).hasClass(this._unselectableClass)||this._isDisabledDatepicker(g[0])||(f=this._getInst(g[0]),f.selectedDay=f.currentDay=a("a",e).html(),f.selectedMonth=f.currentMonth=c,f.selectedYear=f.currentYear=d,this._selectDate(b,this._formatDate(f,f.currentDay,f.currentMonth,f.currentYear)))},_clearDate:function(b){var c=a(b);this._selectDate(c,"")},_selectDate:function(b,c){var d,e=a(b),f=this._getInst(e[0]);c=null!=c?c:this._formatDate(f),f.input&&f.input.val(c),this._updateAlternate(f),d=this._get(f,"onSelect"),d?d.apply(f.input?f.input[0]:null,[c,f]):f.input&&f.input.trigger("change"),f.inline?this._updateDatepicker(f):(this._hideDatepicker(),this._lastInput=f.input[0],"object"!=typeof f.input[0]&&f.input.focus(),this._lastInput=null)},_updateAlternate:function(b){var c,d,e,f=this._get(b,"altField");f&&(c=this._get(b,"altFormat")||this._get(b,"dateFormat"),d=this._getDate(b),e=this.formatDate(c,d,this._getFormatConfig(b)),a(f).each(function(){a(this).val(e)}))},noWeekends:function(a){var b=a.getDay();return[b>0&&b<6,""]},iso8601Week:function(a){var b,c=new Date(a.getTime());return c.setDate(c.getDate()+4-(c.getDay()||7)),b=c.getTime(),c.setMonth(0),c.setDate(1),Math.floor(Math.round((b-c)/864e5)/7)+1},parseDate:function(b,c,d){if(null==b||null==c)throw"Invalid arguments";if(c="object"==typeof c?c.toString():c+"",""===c)return null;var e,f,g,h,i=0,j=(d?d.shortYearCutoff:null)||this._defaults.shortYearCutoff,k="string"!=typeof j?j:(new Date).getFullYear()%100+parseInt(j,10),l=(d?d.dayNamesShort:null)||this._defaults.dayNamesShort,m=(d?d.dayNames:null)||this._defaults.dayNames,n=(d?d.monthNamesShort:null)||this._defaults.monthNamesShort,o=(d?d.monthNames:null)||this._defaults.monthNames,p=-1,q=-1,r=-1,s=-1,t=!1,u=function(a){var c=e+1<b.length&&b.charAt(e+1)===a;return c&&e++,c},v=function(a){var b=u(a),d="@"===a?14:"!"===a?20:"y"===a&&b?4:"o"===a?3:2,e="y"===a?d:1,f=new RegExp("^\\d{"+e+","+d+"}"),g=c.substring(i).match(f);if(!g)throw"Missing number at position "+i;return i+=g[0].length,parseInt(g[0],10)},w=function(b,d,e){var f=-1,g=a.map(u(b)?e:d,function(a,b){return[[b,a]]}).sort(function(a,b){return-(a[1].length-b[1].length)});if(a.each(g,function(a,b){var d=b[1];if(c.substr(i,d.length).toLowerCase()===d.toLowerCase())return f=b[0],i+=d.length,!1}),f!==-1)return f+1;throw"Unknown name at position "+i},x=function(){if(c.charAt(i)!==b.charAt(e))throw"Unexpected literal at position "+i;i++};for(e=0;e<b.length;e++)if(t)"'"!==b.charAt(e)||u("'")?x():t=!1;else switch(b.charAt(e)){case"d":r=v("d");break;case"D":w("D",l,m);break;case"o":s=v("o");break;case"m":q=v("m");break;case"M":q=w("M",n,o);break;case"y":p=v("y");break;case"@":h=new Date(v("@")),p=h.getFullYear(),q=h.getMonth()+1,r=h.getDate();break;case"!":h=new Date((v("!")-this._ticksTo1970)/1e4),p=h.getFullYear(),q=h.getMonth()+1,r=h.getDate();break;case"'":u("'")?x():t=!0;break;default:x()}if(i<c.length&&(g=c.substr(i),!/^\s+/.test(g)))throw"Extra/unparsed characters found in date: "+g;if(p===-1?p=(new Date).getFullYear():p<100&&(p+=(new Date).getFullYear()-(new Date).getFullYear()%100+(p<=k?0:-100)),s>-1)for(q=1,r=s;;){if(f=this._getDaysInMonth(p,q-1),r<=f)break;q++,r-=f}if(h=this._daylightSavingAdjust(new Date(p,q-1,r)),h.getFullYear()!==p||h.getMonth()+1!==q||h.getDate()!==r)throw"Invalid date";return h},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(a,b,c){if(!b)return"";var d,e=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,g=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,h=(c?c.monthNames:null)||this._defaults.monthNames,i=function(b){
var c=d+1<a.length&&a.charAt(d+1)===b;return c&&d++,c},j=function(a,b,c){var d=""+b;if(i(a))for(;d.length<c;)d="0"+d;return d},k=function(a,b,c,d){return i(a)?d[b]:c[b]},l="",m=!1;if(b)for(d=0;d<a.length;d++)if(m)"'"!==a.charAt(d)||i("'")?l+=a.charAt(d):m=!1;else switch(a.charAt(d)){case"d":l+=j("d",b.getDate(),2);break;case"D":l+=k("D",b.getDay(),e,f);break;case"o":l+=j("o",Math.round((new Date(b.getFullYear(),b.getMonth(),b.getDate()).getTime()-new Date(b.getFullYear(),0,0).getTime())/864e5),3);break;case"m":l+=j("m",b.getMonth()+1,2);break;case"M":l+=k("M",b.getMonth(),g,h);break;case"y":l+=i("y")?b.getFullYear():(b.getYear()%100<10?"0":"")+b.getYear()%100;break;case"@":l+=b.getTime();break;case"!":l+=1e4*b.getTime()+this._ticksTo1970;break;case"'":i("'")?l+="'":m=!0;break;default:l+=a.charAt(d)}return l},_possibleChars:function(a){var b,c="",d=!1,e=function(c){var d=b+1<a.length&&a.charAt(b+1)===c;return d&&b++,d};for(b=0;b<a.length;b++)if(d)"'"!==a.charAt(b)||e("'")?c+=a.charAt(b):d=!1;else switch(a.charAt(b)){case"d":case"m":case"y":case"@":c+="0123456789";break;case"D":case"M":return null;case"'":e("'")?c+="'":d=!0;break;default:c+=a.charAt(b)}return c},_get:function(a,b){return void 0!==a.settings[b]?a.settings[b]:this._defaults[b]},_setDateFromField:function(a,b){if(a.input.val()!==a.lastVal){var c=this._get(a,"dateFormat"),d=a.lastVal=a.input?a.input.val():null,e=this._getDefaultDate(a),f=e,g=this._getFormatConfig(a);try{f=this.parseDate(c,d,g)||e}catch(a){d=b?"":d}a.selectedDay=f.getDate(),a.drawMonth=a.selectedMonth=f.getMonth(),a.drawYear=a.selectedYear=f.getFullYear(),a.currentDay=d?f.getDate():0,a.currentMonth=d?f.getMonth():0,a.currentYear=d?f.getFullYear():0,this._adjustInstDate(a)}},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(b,c,d){var e=function(a){var b=new Date;return b.setDate(b.getDate()+a),b},f=function(c){try{return a.datepicker.parseDate(a.datepicker._get(b,"dateFormat"),c,a.datepicker._getFormatConfig(b))}catch(a){}for(var d=(c.toLowerCase().match(/^c/)?a.datepicker._getDate(b):null)||new Date,e=d.getFullYear(),f=d.getMonth(),g=d.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,i=h.exec(c);i;){switch(i[2]||"d"){case"d":case"D":g+=parseInt(i[1],10);break;case"w":case"W":g+=7*parseInt(i[1],10);break;case"m":case"M":f+=parseInt(i[1],10),g=Math.min(g,a.datepicker._getDaysInMonth(e,f));break;case"y":case"Y":e+=parseInt(i[1],10),g=Math.min(g,a.datepicker._getDaysInMonth(e,f))}i=h.exec(c)}return new Date(e,f,g)},g=null==c||""===c?d:"string"==typeof c?f(c):"number"==typeof c?isNaN(c)?d:e(c):new Date(c.getTime());return g=g&&"Invalid Date"===g.toString()?d:g,g&&(g.setHours(0),g.setMinutes(0),g.setSeconds(0),g.setMilliseconds(0)),this._daylightSavingAdjust(g)},_daylightSavingAdjust:function(a){return a?(a.setHours(a.getHours()>12?a.getHours()+2:0),a):null},_setDate:function(a,b,c){var d=!b,e=a.selectedMonth,f=a.selectedYear,g=this._restrictMinMax(a,this._determineDate(a,b,new Date));a.selectedDay=a.currentDay=g.getDate(),a.drawMonth=a.selectedMonth=a.currentMonth=g.getMonth(),a.drawYear=a.selectedYear=a.currentYear=g.getFullYear(),e===a.selectedMonth&&f===a.selectedYear||c||this._notifyChange(a),this._adjustInstDate(a),a.input&&a.input.val(d?"":this._formatDate(a))},_getDate:function(a){var b=!a.currentYear||a.input&&""===a.input.val()?null:this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return b},_attachHandlers:function(b){var c=this._get(b,"stepMonths"),d="#"+b.id.replace(/\\\\/g,"\\");b.dpDiv.find("[data-handler]").map(function(){var b={prev:function(){a.datepicker._adjustDate(d,-c,"M")},next:function(){a.datepicker._adjustDate(d,+c,"M")},hide:function(){a.datepicker._hideDatepicker()},today:function(){a.datepicker._gotoToday(d)},selectDay:function(){return a.datepicker._selectDay(d,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return a.datepicker._selectMonthYear(d,this,"M"),!1},selectYear:function(){return a.datepicker._selectMonthYear(d,this,"Y"),!1}};a(this).bind(this.getAttribute("data-event"),b[this.getAttribute("data-handler")])})},_generateHTML:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=new Date,P=this._daylightSavingAdjust(new Date(O.getFullYear(),O.getMonth(),O.getDate())),Q=this._get(a,"isRTL"),R=this._get(a,"showButtonPanel"),S=this._get(a,"hideIfNoPrevNext"),T=this._get(a,"navigationAsDateFormat"),U=this._getNumberOfMonths(a),V=this._get(a,"showCurrentAtPos"),W=this._get(a,"stepMonths"),X=1!==U[0]||1!==U[1],Y=this._daylightSavingAdjust(a.currentDay?new Date(a.currentYear,a.currentMonth,a.currentDay):new Date(9999,9,9)),Z=this._getMinMaxDate(a,"min"),$=this._getMinMaxDate(a,"max"),_=a.drawMonth-V,aa=a.drawYear;if(_<0&&(_+=12,aa--),$)for(b=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-U[0]*U[1]+1,$.getDate())),b=Z&&b<Z?Z:b;this._daylightSavingAdjust(new Date(aa,_,1))>b;)_--,_<0&&(_=11,aa--);for(a.drawMonth=_,a.drawYear=aa,c=this._get(a,"prevText"),c=T?this.formatDate(c,this._daylightSavingAdjust(new Date(aa,_-W,1)),this._getFormatConfig(a)):c,d=this._canAdjustMonth(a,-1,aa,_)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+c+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"e":"w")+"'>"+c+"</span></a>":S?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+c+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"e":"w")+"'>"+c+"</span></a>",e=this._get(a,"nextText"),e=T?this.formatDate(e,this._daylightSavingAdjust(new Date(aa,_+W,1)),this._getFormatConfig(a)):e,f=this._canAdjustMonth(a,1,aa,_)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+e+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"w":"e")+"'>"+e+"</span></a>":S?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+e+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"w":"e")+"'>"+e+"</span></a>",g=this._get(a,"currentText"),h=this._get(a,"gotoCurrent")&&a.currentDay?Y:P,g=T?this.formatDate(g,h,this._getFormatConfig(a)):g,i=a.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(a,"closeText")+"</button>",j=R?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Q?i:"")+(this._isInRange(a,h)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+g+"</button>":"")+(Q?"":i)+"</div>":"",k=parseInt(this._get(a,"firstDay"),10),k=isNaN(k)?0:k,l=this._get(a,"showWeek"),m=this._get(a,"dayNames"),n=this._get(a,"dayNamesMin"),o=this._get(a,"monthNames"),p=this._get(a,"monthNamesShort"),q=this._get(a,"beforeShowDay"),r=this._get(a,"showOtherMonths"),s=this._get(a,"selectOtherMonths"),t=this._getDefaultDate(a),u="",w=0;w<U[0];w++){for(x="",this.maxRows=4,y=0;y<U[1];y++){if(z=this._daylightSavingAdjust(new Date(aa,_,a.selectedDay)),A=" ui-corner-all",B="",X){if(B+="<div class='ui-datepicker-group",U[1]>1)switch(y){case 0:B+=" ui-datepicker-group-first",A=" ui-corner-"+(Q?"right":"left");break;case U[1]-1:B+=" ui-datepicker-group-last",A=" ui-corner-"+(Q?"left":"right");break;default:B+=" ui-datepicker-group-middle",A=""}B+="'>"}for(B+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+A+"'>"+(/all|left/.test(A)&&0===w?Q?f:d:"")+(/all|right/.test(A)&&0===w?Q?d:f:"")+this._generateMonthYearHeader(a,_,aa,Z,$,w>0||y>0,o,p)+"</div><table class='ui-datepicker-calendar'><thead><tr>",C=l?"<th class='ui-datepicker-week-col'>"+this._get(a,"weekHeader")+"</th>":"",v=0;v<7;v++)D=(v+k)%7,C+="<th scope='col'"+((v+k+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+m[D]+"'>"+n[D]+"</span></th>";for(B+=C+"</tr></thead><tbody>",E=this._getDaysInMonth(aa,_),aa===a.selectedYear&&_===a.selectedMonth&&(a.selectedDay=Math.min(a.selectedDay,E)),F=(this._getFirstDayOfMonth(aa,_)-k+7)%7,G=Math.ceil((F+E)/7),H=X&&this.maxRows>G?this.maxRows:G,this.maxRows=H,I=this._daylightSavingAdjust(new Date(aa,_,1-F)),J=0;J<H;J++){for(B+="<tr>",K=l?"<td class='ui-datepicker-week-col'>"+this._get(a,"calculateWeek")(I)+"</td>":"",v=0;v<7;v++)L=q?q.apply(a.input?a.input[0]:null,[I]):[!0,""],M=I.getMonth()!==_,N=M&&!s||!L[0]||Z&&I<Z||$&&I>$,K+="<td class='"+((v+k+6)%7>=5?" ui-datepicker-week-end":"")+(M?" ui-datepicker-other-month":"")+(I.getTime()===z.getTime()&&_===a.selectedMonth&&a._keyEvent||t.getTime()===I.getTime()&&t.getTime()===z.getTime()?" "+this._dayOverClass:"")+(N?" "+this._unselectableClass+" ui-state-disabled":"")+(M&&!r?"":" "+L[1]+(I.getTime()===Y.getTime()?" "+this._currentClass:"")+(I.getTime()===P.getTime()?" ui-datepicker-today":""))+"'"+(M&&!r||!L[2]?"":" title='"+L[2].replace(/'/g,"&#39;")+"'")+(N?"":" data-handler='selectDay' data-event='click' data-month='"+I.getMonth()+"' data-year='"+I.getFullYear()+"'")+">"+(M&&!r?"&#xa0;":N?"<span class='ui-state-default'>"+I.getDate()+"</span>":"<a class='ui-state-default"+(I.getTime()===P.getTime()?" ui-state-highlight":"")+(I.getTime()===Y.getTime()?" ui-state-active":"")+(M?" ui-priority-secondary":"")+"' href='#'>"+I.getDate()+"</a>")+"</td>",I.setDate(I.getDate()+1),I=this._daylightSavingAdjust(I);B+=K+"</tr>"}_++,_>11&&(_=0,aa++),B+="</tbody></table>"+(X?"</div>"+(U[0]>0&&y===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=B}u+=x}return u+=j,a._keyEvent=!1,u},_generateMonthYearHeader:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q=this._get(a,"changeMonth"),r=this._get(a,"changeYear"),s=this._get(a,"showMonthAfterYear"),t="<div class='ui-datepicker-title'>",u="";if(f||!q)u+="<span class='ui-datepicker-month'>"+g[b]+"</span>";else{for(i=d&&d.getFullYear()===c,j=e&&e.getFullYear()===c,u+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",k=0;k<12;k++)(!i||k>=d.getMonth())&&(!j||k<=e.getMonth())&&(u+="<option value='"+k+"'"+(k===b?" selected='selected'":"")+">"+h[k]+"</option>");u+="</select>"}if(s||(t+=u+(!f&&q&&r?"":"&#xa0;")),!a.yearshtml)if(a.yearshtml="",f||!r)t+="<span class='ui-datepicker-year'>"+c+"</span>";else{for(l=this._get(a,"yearRange").split(":"),m=(new Date).getFullYear(),n=function(a){var b=a.match(/c[+\-].*/)?c+parseInt(a.substring(1),10):a.match(/[+\-].*/)?m+parseInt(a,10):parseInt(a,10);return isNaN(b)?m:b},o=n(l[0]),p=Math.max(o,n(l[1]||"")),o=d?Math.max(o,d.getFullYear()):o,p=e?Math.min(p,e.getFullYear()):p,a.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";o<=p;o++)a.yearshtml+="<option value='"+o+"'"+(o===c?" selected='selected'":"")+">"+o+"</option>";a.yearshtml+="</select>",t+=a.yearshtml,a.yearshtml=null}return t+=this._get(a,"yearSuffix"),s&&(t+=(!f&&q&&r?"":"&#xa0;")+u),t+="</div>"},_adjustInstDate:function(a,b,c){var d=a.drawYear+("Y"===c?b:0),e=a.drawMonth+("M"===c?b:0),f=Math.min(a.selectedDay,this._getDaysInMonth(d,e))+("D"===c?b:0),g=this._restrictMinMax(a,this._daylightSavingAdjust(new Date(d,e,f)));a.selectedDay=g.getDate(),a.drawMonth=a.selectedMonth=g.getMonth(),a.drawYear=a.selectedYear=g.getFullYear(),"M"!==c&&"Y"!==c||this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max"),e=c&&b<c?c:b;return d&&e>d?d:e},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");b&&b.apply(a.input?a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){var b=this._get(a,"numberOfMonths");return null==b?[1,1]:"number"==typeof b?[1,b]:b},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return new Date(a,b,1).getDay()},_canAdjustMonth:function(a,b,c,d){var e=this._getNumberOfMonths(a),f=this._daylightSavingAdjust(new Date(c,d+(b<0?b:e[0]*e[1]),1));return b<0&&f.setDate(this._getDaysInMonth(f.getFullYear(),f.getMonth())),this._isInRange(a,f)},_isInRange:function(a,b){var c,d,e=this._getMinMaxDate(a,"min"),f=this._getMinMaxDate(a,"max"),g=null,h=null,i=this._get(a,"yearRange");return i&&(c=i.split(":"),d=(new Date).getFullYear(),g=parseInt(c[0],10),h=parseInt(c[1],10),c[0].match(/[+\-].*/)&&(g+=d),c[1].match(/[+\-].*/)&&(h+=d)),(!e||b.getTime()>=e.getTime())&&(!f||b.getTime()<=f.getTime())&&(!g||b.getFullYear()>=g)&&(!h||b.getFullYear()<=h)},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff");return b="string"!=typeof b?b:(new Date).getFullYear()%100+parseInt(b,10),{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,"monthNames")}},_formatDate:function(a,b,c,d){b||(a.currentDay=a.selectedDay,a.currentMonth=a.selectedMonth,a.currentYear=a.selectedYear);var e=b?"object"==typeof b?b:this._daylightSavingAdjust(new Date(d,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),e,this._getFormatConfig(a))}}),a.fn.datepicker=function(b){if(!this.length)return this;a.datepicker.initialized||(a(document).mousedown(a.datepicker._checkExternalClick),a.datepicker.initialized=!0),0===a("#"+a.datepicker._mainDivId).length&&a("body").append(a.datepicker.dpDiv);var c=Array.prototype.slice.call(arguments,1);return"string"!=typeof b||"isDisabled"!==b&&"getDate"!==b&&"widget"!==b?"option"===b&&2===arguments.length&&"string"==typeof arguments[1]?a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(c)):this.each(function(){"string"==typeof b?a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this].concat(c)):a.datepicker._attachDatepicker(this,b)}):a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(c))},a.datepicker=new e,a.datepicker.initialized=!1,a.datepicker.uuid=(new Date).getTime(),a.datepicker.version="1.11.4";a.datepicker;a.widget("ui.draggable",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(a,b){this._super(a,b),"handle"===a&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(b){var c=this.options;return this._blurActiveElement(b),!(this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(b),!!this.handle&&(this._blockFrames(c.iframeFix===!0?"iframe":c.iframeFix),!0))},_blockFrames:function(b){this.iframeBlocks=this.document.find(b).map(function(){var b=a(this);return a("<div>").css("position","absolute").appendTo(b.parent()).outerWidth(b.outerWidth()).outerHeight(b.outerHeight()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(b){var c=this.document[0];if(this.handleElement.is(b.target))try{c.activeElement&&"body"!==c.activeElement.nodeName.toLowerCase()&&a(c.activeElement).blur()}catch(a){}},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===a(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(b),this.originalPosition=this.position=this._generatePosition(b,!1),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._normalizeRightBottom(),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_refreshOffsets:function(a){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:a.pageX-this.offset.left,top:a.pageY-this.offset.top}},_mouseDrag:function(b,c){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b,!0),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1},_mouseUp:function(b){return this._unblockFrames(),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),this.handleElement.is(b.target)&&this.element.focus(),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return!this.options.handle||!!a(b.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper),e=d?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return e.parents("body").length||e.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d&&e[0]===this.element[0]&&this._setPositionRelative(),e[0]===this.element[0]||/(fixed|absolute)/.test(e.css("position"))||e.css("position","absolute"),e},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_isRootNode:function(a){return/(html|body)/i.test(a.tagName)||a===this.document[0]},_getParentOffset:function(){var b=this.offsetParent.offset(),c=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==c&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var a=this.element.position(),b=this._isRootNode(this.scrollParent[0]);return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+(b?0:this.scrollParent.scrollTop()),left:a.left-(parseInt(this.helper.css("left"),10)||0)+(b?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options,f=this.document[0];return this.relativeContainer=null,e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(f).width()-this.helperProportions.width-this.margins.left,(a(f).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b=/(scroll|auto)/.test(c.css("overflow")),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=c))):void(this.containment=null)},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"===a?1:-1,d=this._isRootNode(this.scrollParent[0]);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.offset.scroll.top:d?0:this.offset.scroll.top)*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.offset.scroll.left:d?0:this.offset.scroll.left)*c}},_generatePosition:function(a,b){var c,d,e,f,g=this.options,h=this._isRootNode(this.scrollParent[0]),i=a.pageX,j=a.pageY;return h&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),b&&(this.containment&&(this.relativeContainer?(d=this.relativeContainer.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,a.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),a.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),a.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),a.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f),"y"===g.axis&&(i=this.originalPageX),"x"===g.axis&&(j=this.originalPageY)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:h?0:this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:h?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d,this],!0),/^(drag|start|stop)/.test(b)&&(this.positionAbs=this._convertPositionTo("absolute"),d.offset=this.positionAbs),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c,d){var e=a.extend({},c,{item:d.element});d.sortables=[],a(d.options.connectToSortable).each(function(){var c=a(this).sortable("instance");c&&!c.options.disabled&&(d.sortables.push(c),c.refreshPositions(),c._trigger("activate",b,e))})},stop:function(b,c,d){var e=a.extend({},c,{item:d.element});d.cancelHelperRemoval=!1,a.each(d.sortables,function(){var a=this;a.isOver?(a.isOver=0,d.cancelHelperRemoval=!0,a.cancelHelperRemoval=!1,a._storedCSS={position:a.placeholder.css("position"),top:a.placeholder.css("top"),left:a.placeholder.css("left")},a._mouseStop(b),a.options.helper=a.options._helper):(a.cancelHelperRemoval=!0,a._trigger("deactivate",b,e))})},drag:function(b,c,d){a.each(d.sortables,function(){var e=!1,f=this;f.positionAbs=d.positionAbs,f.helperProportions=d.helperProportions,f.offset.click=d.offset.click,f._intersectsWith(f.containerCache)&&(e=!0,a.each(d.sortables,function(){return this.positionAbs=d.positionAbs,this.helperProportions=d.helperProportions,this.offset.click=d.offset.click,this!==f&&this._intersectsWith(this.containerCache)&&a.contains(f.element[0],this.element[0])&&(e=!1),e})),e?(f.isOver||(f.isOver=1,d._parent=c.helper.parent(),f.currentItem=c.helper.appendTo(f.element).data("ui-sortable-item",!0),f.options._helper=f.options.helper,f.options.helper=function(){return c.helper[0]},b.target=f.currentItem[0],f._mouseCapture(b,!0),f._mouseStart(b,!0,!0),f.offset.click.top=d.offset.click.top,f.offset.click.left=d.offset.click.left,f.offset.parent.left-=d.offset.parent.left-f.offset.parent.left,f.offset.parent.top-=d.offset.parent.top-f.offset.parent.top,d._trigger("toSortable",b),d.dropped=f.element,a.each(d.sortables,function(){this.refreshPositions()}),d.currentItem=d.element,f.fromOutside=d),f.currentItem&&(f._mouseDrag(b),c.position=f.position)):f.isOver&&(f.isOver=0,f.cancelHelperRemoval=!0,f.options._revert=f.options.revert,f.options.revert=!1,f._trigger("out",b,f._uiHash(f)),f._mouseStop(b,!0),f.options.revert=f.options._revert,f.options.helper=f.options._helper,f.placeholder&&f.placeholder.remove(),c.helper.appendTo(d._parent),d._refreshOffsets(b),c.position=d._generatePosition(b,!0),d._trigger("fromSortable",b),d.dropped=!1,a.each(d.sortables,function(){this.refreshPositions()}))})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c,d){var e=a("body"),f=d.options;e.css("cursor")&&(f._cursor=e.css("cursor")),e.css("cursor",f.cursor)},stop:function(b,c,d){var e=d.options;e._cursor&&a("body").css("cursor",e._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("opacity")&&(f._opacity=e.css("opacity")),e.css("opacity",f.opacity)},stop:function(b,c,d){var e=d.options;e._opacity&&a(c.helper).css("opacity",e._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(a,b,c){c.scrollParentNotHidden||(c.scrollParentNotHidden=c.helper.scrollParent(!1)),c.scrollParentNotHidden[0]!==c.document[0]&&"HTML"!==c.scrollParentNotHidden[0].tagName&&(c.overflowOffset=c.scrollParentNotHidden.offset())},drag:function(b,c,d){var e=d.options,f=!1,g=d.scrollParentNotHidden[0],h=d.document[0];g!==h&&"HTML"!==g.tagName?(e.axis&&"x"===e.axis||(d.overflowOffset.top+g.offsetHeight-b.pageY<e.scrollSensitivity?g.scrollTop=f=g.scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(g.scrollTop=f=g.scrollTop-e.scrollSpeed)),e.axis&&"y"===e.axis||(d.overflowOffset.left+g.offsetWidth-b.pageX<e.scrollSensitivity?g.scrollLeft=f=g.scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(g.scrollLeft=f=g.scrollLeft-e.scrollSpeed))):(e.axis&&"x"===e.axis||(b.pageY-a(h).scrollTop()<e.scrollSensitivity?f=a(h).scrollTop(a(h).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(h).scrollTop())<e.scrollSensitivity&&(f=a(h).scrollTop(a(h).scrollTop()+e.scrollSpeed))),e.axis&&"y"===e.axis||(b.pageX-a(h).scrollLeft()<e.scrollSensitivity?f=a(h).scrollLeft(a(h).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(h).scrollLeft())<e.scrollSensitivity&&(f=a(h).scrollLeft(a(h).scrollLeft()+e.scrollSpeed)))),f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c,d){var e=d.options;d.snapElements=[],a(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!==d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=d.options,p=o.snapTolerance,q=c.offset.left,r=q+d.helperProportions.width,s=c.offset.top,t=s+d.helperProportions.height;for(m=d.snapElements.length-1;m>=0;m--)i=d.snapElements[m].left-d.margins.left,j=i+d.snapElements[m].width,k=d.snapElements[m].top-d.margins.top,l=k+d.snapElements[m].height,r<i-p||q>j+p||t<k-p||s>l+p||!a.contains(d.snapElements[m].item.ownerDocument,d.snapElements[m].item)?(d.snapElements[m].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=!1):("inner"!==o.snapMode&&(e=Math.abs(k-t)<=p,f=Math.abs(l-s)<=p,g=Math.abs(i-r)<=p,h=Math.abs(j-q)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k-d.helperProportions.height,left:0}).top),f&&(c.position.top=d._convertPositionTo("relative",{top:l,left:0}).top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i-d.helperProportions.width}).left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j}).left)),n=e||f||g||h,"outer"!==o.snapMode&&(e=Math.abs(k-s)<=p,f=Math.abs(l-t)<=p,g=Math.abs(i-q)<=p,h=Math.abs(j-r)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k,left:0}).top),f&&(c.position.top=d._convertPositionTo("relative",{top:l-d.helperProportions.height,left:0}).top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i}).left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j-d.helperProportions.width}).left)),!d.snapElements[m].snapping&&(e||f||g||h||n)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item
})),d.snapElements[m].snapping=e||f||g||h||n)}}),a.ui.plugin.add("draggable","stack",{start:function(b,c,d){var e,f=d.options,g=a.makeArray(a(f.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});g.length&&(e=parseInt(a(g[0]).css("zIndex"),10)||0,a(g).each(function(b){a(this).css("zIndex",e+b)}),this.css("zIndex",e+g.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("zIndex")&&(f._zIndex=e.css("zIndex")),e.css("zIndex",f.zIndex)},stop:function(b,c,d){var e=d.options;e._zIndex&&a(c.helper).css("zIndex",e._zIndex)}});a.ui.draggable;a.widget("ui.resizable",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(a){return parseInt(a,10)||0},_isNumber:function(a){return!isNaN(parseInt(a,10))},_hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0||(b[d]=1,e=b[d]>0,b[d]=0,e)},_create:function(){var b,c,d,e,f,g=this,h=this.options;if(this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=h.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=a(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),b=this.handles.split(","),this.handles={},c=0;c<b.length;c++)d=a.trim(b[c]),f="ui-resizable-"+d,e=a("<div class='ui-resizable-handle "+f+"'></div>"),e.css({zIndex:h.zIndex}),"se"===d&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[d]=".ui-resizable-"+d,this.element.append(e);this._renderAxis=function(b){var c,d,e,f;b=b||this.element;for(c in this.handles)this.handles[c].constructor===String?this.handles[c]=this.element.children(this.handles[c]).first().show():(this.handles[c].jquery||this.handles[c].nodeType)&&(this.handles[c]=a(this.handles[c]),this._on(this.handles[c],{mousedown:g._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(d=a(this.handles[c],this.element),f=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(e,f),this._proportionallyResize()),this._handles=this._handles.add(this.handles[c])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){g.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),g.axis=e&&e[1]?e[1]:"se")}),h.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").mouseenter(function(){h.disabled||(a(this).removeClass("ui-resizable-autohide"),g._handles.show())}).mouseleave(function(){h.disabled||g.resizing||(a(this).addClass("ui-resizable-autohide"),g._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var b,c=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove()),this.originalElement.css("resize",this.originalResizeStyle),c(this.originalElement),this},_mouseCapture:function(b){var c,d,e=!1;for(c in this.handles)d=a(this.handles[c])[0],(d===b.target||a.contains(d,b.target))&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(b){var c,d,e,f=this.options,g=this.element;return this.resizing=!0,this._renderProxy(),c=this._num(this.helper.css("left")),d=this._num(this.helper.css("top")),f.containment&&(c+=a(f.containment).scrollLeft()||0,d+=a(f.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:c,top:d},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:g.width(),height:g.height()},this.originalSize=this._helper?{width:g.outerWidth(),height:g.outerHeight()}:{width:g.width(),height:g.height()},this.sizeDiff={width:g.outerWidth()-g.width(),height:g.outerHeight()-g.height()},this.originalPosition={left:c,top:d},this.originalMousePosition={left:b.pageX,top:b.pageY},this.aspectRatio="number"==typeof f.aspectRatio?f.aspectRatio:this.originalSize.width/this.originalSize.height||1,e=a(".ui-resizable-"+this.axis).css("cursor"),a("body").css("cursor","auto"===e?this.axis+"-resize":e),g.addClass("ui-resizable-resizing"),this._propagate("start",b),!0},_mouseDrag:function(b){var c,d,e=this.originalMousePosition,f=this.axis,g=b.pageX-e.left||0,h=b.pageY-e.top||0,i=this._change[f];return this._updatePrevProperties(),!!i&&(c=i.apply(this,[b,g,h]),this._updateVirtualBoundaries(b.shiftKey),(this._aspectRatio||b.shiftKey)&&(c=this._updateRatio(c,b)),c=this._respectSize(c,b),this._updateCache(c),this._propagate("resize",b),d=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),a.isEmptyObject(d)||(this._updatePrevProperties(),this._trigger("resize",b,this.ui()),this._applyChanges()),!1)},_mouseStop:function(b){this.resizing=!1;var c,d,e,f,g,h,i,j=this.options,k=this;return this._helper&&(c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),e=d&&this._hasScroll(c[0],"left")?0:k.sizeDiff.height,f=d?0:k.sizeDiff.width,g={width:k.helper.width()-f,height:k.helper.height()-e},h=parseInt(k.element.css("left"),10)+(k.position.left-k.originalPosition.left)||null,i=parseInt(k.element.css("top"),10)+(k.position.top-k.originalPosition.top)||null,j.animate||this.element.css(a.extend(g,{top:i,left:h})),k.helper.height(k.size.height),k.helper.width(k.size.width),this._helper&&!j.animate&&this._proportionallyResize()),a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var a={};return this.position.top!==this.prevPosition.top&&(a.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(a.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(a.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(a.height=this.size.height+"px"),this.helper.css(a),a},_updateVirtualBoundaries:function(a){var b,c,d,e,f,g=this.options;f={minWidth:this._isNumber(g.minWidth)?g.minWidth:0,maxWidth:this._isNumber(g.maxWidth)?g.maxWidth:1/0,minHeight:this._isNumber(g.minHeight)?g.minHeight:0,maxHeight:this._isNumber(g.maxHeight)?g.maxHeight:1/0},(this._aspectRatio||a)&&(b=f.minHeight*this.aspectRatio,d=f.minWidth/this.aspectRatio,c=f.maxHeight*this.aspectRatio,e=f.maxWidth/this.aspectRatio,b>f.minWidth&&(f.minWidth=b),d>f.minHeight&&(f.minHeight=d),c<f.maxWidth&&(f.maxWidth=c),e<f.maxHeight&&(f.maxHeight=e)),this._vBoundaries=f},_updateCache:function(a){this.offset=this.helper.offset(),this._isNumber(a.left)&&(this.position.left=a.left),this._isNumber(a.top)&&(this.position.top=a.top),this._isNumber(a.height)&&(this.size.height=a.height),this._isNumber(a.width)&&(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,c=this.size,d=this.axis;return this._isNumber(a.height)?a.width=a.height*this.aspectRatio:this._isNumber(a.width)&&(a.height=a.width/this.aspectRatio),"sw"===d&&(a.left=b.left+(c.width-a.width),a.top=null),"nw"===d&&(a.top=b.top+(c.height-a.height),a.left=b.left+(c.width-a.width)),a},_respectSize:function(a){var b=this._vBoundaries,c=this.axis,d=this._isNumber(a.width)&&b.maxWidth&&b.maxWidth<a.width,e=this._isNumber(a.height)&&b.maxHeight&&b.maxHeight<a.height,f=this._isNumber(a.width)&&b.minWidth&&b.minWidth>a.width,g=this._isNumber(a.height)&&b.minHeight&&b.minHeight>a.height,h=this.originalPosition.left+this.originalSize.width,i=this.position.top+this.size.height,j=/sw|nw|w/.test(c),k=/nw|ne|n/.test(c);return f&&(a.width=b.minWidth),g&&(a.height=b.minHeight),d&&(a.width=b.maxWidth),e&&(a.height=b.maxHeight),f&&j&&(a.left=h-b.minWidth),d&&j&&(a.left=h-b.maxWidth),g&&k&&(a.top=i-b.minHeight),e&&k&&(a.top=i-b.maxHeight),a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null,a},_getPaddingPlusBorderDimensions:function(a){for(var b=0,c=[],d=[a.css("borderTopWidth"),a.css("borderRightWidth"),a.css("borderBottomWidth"),a.css("borderLeftWidth")],e=[a.css("paddingTop"),a.css("paddingRight"),a.css("paddingBottom"),a.css("paddingLeft")];b<4;b++)c[b]=parseInt(d[b],10)||0,c[b]+=parseInt(e[b],10)||0;return{height:c[0]+c[2],width:c[1]+c[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var a,b=0,c=this.helper||this.element;b<this._proportionallyResizeElements.length;b++)a=this._proportionallyResizeElements[b],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(a)),a.css({height:c.height()-this.outerDimensions.height||0,width:c.width()-this.outerDimensions.width||0})},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset(),this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){var c=this.originalSize,d=this.originalPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this.originalSize,e=this.originalPosition;return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"resize"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).resizable("instance"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&c._hasScroll(e[0],"left")?0:c.sizeDiff.height,h=f?0:c.sizeDiff.width,i={width:c.size.width-h,height:c.size.height-g},j=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,k=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(i,k&&j?{top:k,left:j}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),10)};e&&e.length&&a(e[0]).css({width:d.width,height:d.height}),c._updateCache(d),c._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(){var b,c,d,e,f,g,h,i=a(this).resizable("instance"),j=i.options,k=i.element,l=j.containment,m=l instanceof a?l.get(0):/parent/.test(l)?k.parent().get(0):l;m&&(i.containerElement=a(m),/document/.test(l)||l===document?(i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}):(b=a(m),c=[],a(["Top","Right","Left","Bottom"]).each(function(a,d){c[a]=i._num(b.css("padding"+d))}),i.containerOffset=b.offset(),i.containerPosition=b.position(),i.containerSize={height:b.innerHeight()-c[3],width:b.innerWidth()-c[1]},d=i.containerOffset,e=i.containerSize.height,f=i.containerSize.width,g=i._hasScroll(m,"left")?m.scrollWidth:f,h=i._hasScroll(m)?m.scrollHeight:e,i.parentData={element:m,left:d.left,top:d.top,width:g,height:h}))},resize:function(b){var c,d,e,f,g=a(this).resizable("instance"),h=g.options,i=g.containerOffset,j=g.position,k=g._aspectRatio||b.shiftKey,l={top:0,left:0},m=g.containerElement,n=!0;m[0]!==document&&/static/.test(m.css("position"))&&(l=i),j.left<(g._helper?i.left:0)&&(g.size.width=g.size.width+(g._helper?g.position.left-i.left:g.position.left-l.left),k&&(g.size.height=g.size.width/g.aspectRatio,n=!1),g.position.left=h.helper?i.left:0),j.top<(g._helper?i.top:0)&&(g.size.height=g.size.height+(g._helper?g.position.top-i.top:g.position.top),k&&(g.size.width=g.size.height*g.aspectRatio,n=!1),g.position.top=g._helper?i.top:0),e=g.containerElement.get(0)===g.element.parent().get(0),f=/relative|absolute/.test(g.containerElement.css("position")),e&&f?(g.offset.left=g.parentData.left+g.position.left,g.offset.top=g.parentData.top+g.position.top):(g.offset.left=g.element.offset().left,g.offset.top=g.element.offset().top),c=Math.abs(g.sizeDiff.width+(g._helper?g.offset.left-l.left:g.offset.left-i.left)),d=Math.abs(g.sizeDiff.height+(g._helper?g.offset.top-l.top:g.offset.top-i.top)),c+g.size.width>=g.parentData.width&&(g.size.width=g.parentData.width-c,k&&(g.size.height=g.size.width/g.aspectRatio,n=!1)),d+g.size.height>=g.parentData.height&&(g.size.height=g.parentData.height-d,k&&(g.size.width=g.size.height*g.aspectRatio,n=!1)),n||(g.position.left=g.prevPosition.left,g.position.top=g.prevPosition.top,g.size.width=g.prevSize.width,g.size.height=g.prevSize.height)},stop:function(){var b=a(this).resizable("instance"),c=b.options,d=b.containerOffset,e=b.containerPosition,f=b.containerElement,g=a(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,j=g.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j}),b._helper&&!c.animate&&/static/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j})}}),a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).resizable("instance"),c=b.options;a(c.alsoResize).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})},resize:function(b,c){var d=a(this).resizable("instance"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0};a(e.alsoResize).each(function(){var b=a(this),d=a(this).data("ui-resizable-alsoresize"),e={},f=b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(f,function(a,b){var c=(d[b]||0)+(h[b]||0);c&&c>=0&&(e[b]=c||null)}),b.css(e)})},stop:function(){a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).resizable("instance"),c=b.options,d=b.size;b.ghost=b.originalElement.clone(),b.ghost.css({opacity:.25,display:"block",position:"relative",height:d.height,width:d.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof c.ghost?c.ghost:""),b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).resizable("instance");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).resizable("instance");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(){var b,c=a(this).resizable("instance"),d=c.options,e=c.size,f=c.originalSize,g=c.originalPosition,h=c.axis,i="number"==typeof d.grid?[d.grid,d.grid]:d.grid,j=i[0]||1,k=i[1]||1,l=Math.round((e.width-f.width)/j)*j,m=Math.round((e.height-f.height)/k)*k,n=f.width+l,o=f.height+m,p=d.maxWidth&&d.maxWidth<n,q=d.maxHeight&&d.maxHeight<o,r=d.minWidth&&d.minWidth>n,s=d.minHeight&&d.minHeight>o;d.grid=i,r&&(n+=j),s&&(o+=k),p&&(n-=j),q&&(o-=k),/^(se|s|e)$/.test(h)?(c.size.width=n,c.size.height=o):/^(ne)$/.test(h)?(c.size.width=n,c.size.height=o,c.position.top=g.top-m):/^(sw)$/.test(h)?(c.size.width=n,c.size.height=o,c.position.left=g.left-l):((o-k<=0||n-j<=0)&&(b=c._getPaddingPlusBorderDimensions(this)),o-k>0?(c.size.height=o,c.position.top=g.top-m):(o=k-b.height,c.size.height=o,c.position.top=g.top+f.height-o),n-j>0?(c.size.width=n,c.position.left=g.left-l):(n=j-b.width,c.size.width=n,c.position.left=g.left+f.width-n))}});a.ui.resizable,a.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(b){var c=a(this).css(b).offset().top;c<0&&a(this).css("top",b.top-c)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&a.fn.draggable&&this._makeDraggable(),this.options.resizable&&a.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var b=this.options.appendTo;return b&&(b.jquery||b.nodeType)?a(b):this.document.find(b||"body").eq(0)},_destroy:function(){var a,b=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),a=b.parent.children().eq(b.index),a.length&&a[0]!==this.element[0]?a.before(this.element):b.parent.append(this.element)},widget:function(){return this.uiDialog},disable:a.noop,enable:a.noop,close:function(b){var c,d=this;if(this._isOpen&&this._trigger("beforeClose",b)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{c=this.document[0].activeElement,c&&"body"!==c.nodeName.toLowerCase()&&a(c).blur()}catch(a){}this._hide(this.uiDialog,this.options.hide,function(){d._trigger("close",b)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(b,c){var d=!1,e=this.uiDialog.siblings(".ui-front:visible").map(function(){return+a(this).css("z-index")}).get(),f=Math.max.apply(null,e);return f>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",f+1),d=!0),d&&!c&&this._trigger("focus",b),d},open:function(){var b=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=a(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){b._focusTabbable(),b._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var a=this._focusedElement;a||(a=this.element.find("[autofocus]")),a.length||(a=this.element.find(":tabbable")),a.length||(a=this.uiDialogButtonPane.find(":tabbable")),a.length||(a=this.uiDialogTitlebarClose.filter(":tabbable")),a.length||(a=this.uiDialog),a.eq(0).focus()},_keepFocus:function(b){function c(){var b=this.document[0].activeElement,c=this.uiDialog[0]===b||a.contains(this.uiDialog[0],b);c||this._focusTabbable()}b.preventDefault(),c.call(this),this._delay(c)},_createWrapper:function(){this.uiDialog=a("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(b){if(this.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE)return b.preventDefault(),void this.close(b);if(b.keyCode===a.ui.keyCode.TAB&&!b.isDefaultPrevented()){var c=this.uiDialog.find(":tabbable"),d=c.filter(":first"),e=c.filter(":last");b.target!==e[0]&&b.target!==this.uiDialog[0]||b.shiftKey?b.target!==d[0]&&b.target!==this.uiDialog[0]||!b.shiftKey||(this._delay(function(){e.focus()}),b.preventDefault()):(this._delay(function(){d.focus()}),b.preventDefault())}},mousedown:function(a){this._moveToTop(a)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var b;this.uiDialogTitlebar=a("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(b){a(b.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=a("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(a){a.preventDefault(),this.close(a)}}),b=a("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(b),this.uiDialog.attr({"aria-labelledby":b.attr("id")})},_title:function(a){this.options.title||a.html("&#160;"),a.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=a("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=a("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var b=this,c=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),a.isEmptyObject(c)||a.isArray(c)&&!c.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(a.each(c,function(c,d){var e,f;d=a.isFunction(d)?{click:d,text:c}:d,d=a.extend({type:"button"},d),e=d.click,d.click=function(){e.apply(b.element[0],arguments)},f={icons:d.icons,text:d.showText},delete d.icons,delete d.showText,a("<button></button>",d).button(f).appendTo(b.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var c=this,d=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,e){a(this).addClass("ui-dialog-dragging"),c._blockFrames(),c._trigger("dragStart",d,b(e))},drag:function(a,d){c._trigger("drag",a,b(d))},stop:function(e,f){var g=f.offset.left-c.document.scrollLeft(),h=f.offset.top-c.document.scrollTop();d.position={my:"left top",at:"left"+(g>=0?"+":"")+g+" top"+(h>=0?"+":"")+h,of:c.window},a(this).removeClass("ui-dialog-dragging"),c._unblockFrames(),c._trigger("dragStop",e,b(f))}})},_makeResizable:function(){function b(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}var c=this,d=this.options,e=d.resizable,f=this.uiDialog.css("position"),g="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:d.maxWidth,maxHeight:d.maxHeight,minWidth:d.minWidth,minHeight:this._minHeight(),handles:g,start:function(d,e){a(this).addClass("ui-dialog-resizing"),c._blockFrames(),c._trigger("resizeStart",d,b(e))},resize:function(a,d){c._trigger("resize",a,b(d))},stop:function(e,f){var g=c.uiDialog.offset(),h=g.left-c.document.scrollLeft(),i=g.top-c.document.scrollTop();d.height=c.uiDialog.height(),d.width=c.uiDialog.width(),d.position={my:"left top",at:"left"+(h>=0?"+":"")+h+" top"+(i>=0?"+":"")+i,of:c.window},a(this).removeClass("ui-dialog-resizing"),c._unblockFrames(),c._trigger("resizeStop",e,b(f))}}).css("position",f)},_trackFocus:function(){this._on(this.widget(),{focusin:function(b){this._makeFocusTarget(),this._focusedElement=a(b.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var b=this._trackingInstances(),c=a.inArray(this,b);c!==-1&&b.splice(c,1)},_trackingInstances:function(){var a=this.document.data("ui-dialog-instances");return a||(a=[],this.document.data("ui-dialog-instances",a)),a},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(){var a=this.uiDialog.is(":visible");a||this.uiDialog.show(),this.uiDialog.position(this.options.position),a||this.uiDialog.hide()},_setOptions:function(b){var c=this,d=!1,e={};a.each(b,function(a,b){c._setOption(a,b),a in c.sizeRelatedOptions&&(d=!0),a in c.resizableRelatedOptions&&(e[a]=b)}),d&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",e)},_setOption:function(a,b){var c,d,e=this.uiDialog;"dialogClass"===a&&e.removeClass(this.options.dialogClass).addClass(b),"disabled"!==a&&(this._super(a,b),"appendTo"===a&&this.uiDialog.appendTo(this._appendTo()),"buttons"===a&&this._createButtons(),"closeText"===a&&this.uiDialogTitlebarClose.button({label:""+b}),"draggable"===a&&(c=e.is(":data(ui-draggable)"),c&&!b&&e.draggable("destroy"),!c&&b&&this._makeDraggable()),"position"===a&&this._position(),"resizable"===a&&(d=e.is(":data(ui-resizable)"),d&&!b&&e.resizable("destroy"),d&&"string"==typeof b&&e.resizable("option","handles",b),d||b===!1||this._makeResizable()),"title"===a&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var a,b,c,d=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),d.minWidth>d.width&&(d.width=d.minWidth),a=this.uiDialog.css({height:"auto",width:d.width}).outerHeight(),b=Math.max(0,d.minHeight-a),c="number"==typeof d.maxHeight?Math.max(0,d.maxHeight-a):"none","auto"===d.height?this.element.css({minHeight:b,maxHeight:c,height:"auto"}):this.element.height(Math.max(0,d.height-a)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var b=a(this);return a("<div>").css({position:"absolute",width:b.outerWidth(),height:b.outerHeight()}).appendTo(b.parent()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(b){return!!a(b.target).closest(".ui-dialog").length||!!a(b.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var b=!0;this._delay(function(){b=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(a){b||this._allowInteraction(a)||(a.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=a("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var a=this.document.data("ui-dialog-overlays")-1;a?this.document.data("ui-dialog-overlays",a):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}});a.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b,c=this.options,d=c.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(d)?d:function(a){return a.is(d)},this.proportions=function(){return arguments.length?void(b=arguments[0]):b?b:b={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(c.scope),c.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(b){a.ui.ddmanager.droppables[b]=a.ui.ddmanager.droppables[b]||[],a.ui.ddmanager.droppables[b].push(this)},_splice:function(a){for(var b=0;b<a.length;b++)a[b]===this&&a.splice(b,1)},_destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];this._splice(b),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){if("accept"===b)this.accept=a.isFunction(c)?c:function(a){return a.is(c)};else if("scope"===b){var d=a.ui.ddmanager.droppables[this.options.scope];this._splice(d),this._addToManager(c)}this._super(b,c)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){
var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return!(!d||(d.currentItem||d.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var c=a(this).droppable("instance");if(c.options.greedy&&!c.options.disabled&&c.options.scope===d.options.scope&&c.accept.call(c.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(c,{offset:c.element.offset()}),c.options.tolerance,b))return e=!0,!1}),!e&&(!!this.accept.call(this.element[0],d.currentItem||d.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element)))},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(){function a(a,b,c){return a>=b&&a<b+c}return function(b,c,d,e){if(!c.offset)return!1;var f=(b.positionAbs||b.position.absolute).left+b.margins.left,g=(b.positionAbs||b.position.absolute).top+b.margins.top,h=f+b.helperProportions.width,i=g+b.helperProportions.height,j=c.offset.left,k=c.offset.top,l=j+c.proportions().width,m=k+c.proportions().height;switch(d){case"fit":return j<=f&&h<=l&&k<=g&&i<=m;case"intersect":return j<f+b.helperProportions.width/2&&h-b.helperProportions.width/2<l&&k<g+b.helperProportions.height/2&&i-b.helperProportions.height/2<m;case"pointer":return a(e.pageY,k,c.proportions().height)&&a(e.pageX,j,c.proportions().width);case"touch":return(g>=k&&g<=m||i>=k&&i<=m||g<k&&i>m)&&(f>=j&&f<=l||h>=j&&h<=l||f<j&&h>l);default:return!1}}}(),a.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;d<f.length;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){for(e=0;e<h.length;e++)if(h[e]===f[d].element[0]){f[d].proportions().height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions({width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight}))}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance,c)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance,c),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a(this).droppable("instance").options.scope===e}),f.length&&(d=a(f[0]).droppable("instance"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}};var s=(a.ui.droppable,"ui-effects-"),t=a;a.effects={effect:{}},function(a,b){function c(a,b,c){var d=l[b.type]||{};return null==a?c||!b.def?null:b.def:(a=d.floor?~~a:parseFloat(a),isNaN(a)?b.def:d.mod?(a+d.mod)%d.mod:0>a?0:d.max<a?d.max:a)}function d(b){var c=j(),d=c._rgba=[];return b=b.toLowerCase(),o(i,function(a,e){var f,g=e.re.exec(b),h=g&&e.parse(g),i=e.space||"rgba";if(h)return f=c[i](h),c[k[i].cache]=f[k[i].cache],d=c._rgba=f._rgba,!1}),d.length?("0,0,0,0"===d.join()&&a.extend(d,f.transparent),c):f[b]}function e(a,b,c){return c=(c+1)%1,6*c<1?a+(b-a)*c*6:2*c<1?b:3*c<2?a+(b-a)*(2/3-c)*6:a}var f,g="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",h=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],j=a.Color=function(b,c,d,e){return new a.Color.fn.parse(b,c,d,e)},k={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},l={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},m=j.support={},n=a("<p>")[0],o=a.each;n.style.cssText="background-color:rgba(1,1,1,.5)",m.rgba=n.style.backgroundColor.indexOf("rgba")>-1,o(k,function(a,b){b.cache="_"+a,b.props.alpha={idx:3,type:"percent",def:1}}),j.fn=a.extend(j.prototype,{parse:function(e,g,h,i){if(e===b)return this._rgba=[null,null,null,null],this;(e.jquery||e.nodeType)&&(e=a(e).css(g),g=b);var l=this,m=a.type(e),n=this._rgba=[];return g!==b&&(e=[e,g,h,i],m="array"),"string"===m?this.parse(d(e)||f._default):"array"===m?(o(k.rgba.props,function(a,b){n[b.idx]=c(e[b.idx],b)}),this):"object"===m?(e instanceof j?o(k,function(a,b){e[b.cache]&&(l[b.cache]=e[b.cache].slice())}):o(k,function(b,d){var f=d.cache;o(d.props,function(a,b){if(!l[f]&&d.to){if("alpha"===a||null==e[a])return;l[f]=d.to(l._rgba)}l[f][b.idx]=c(e[a],b,!0)}),l[f]&&a.inArray(null,l[f].slice(0,3))<0&&(l[f][3]=1,d.from&&(l._rgba=d.from(l[f])))}),this):void 0},is:function(a){var b=j(a),c=!0,d=this;return o(k,function(a,e){var f,g=b[e.cache];return g&&(f=d[e.cache]||e.to&&e.to(d._rgba)||[],o(e.props,function(a,b){if(null!=g[b.idx])return c=g[b.idx]===f[b.idx]})),c}),c},_space:function(){var a=[],b=this;return o(k,function(c,d){b[d.cache]&&a.push(c)}),a.pop()},transition:function(a,b){var d=j(a),e=d._space(),f=k[e],g=0===this.alpha()?j("transparent"):this,h=g[f.cache]||f.to(g._rgba),i=h.slice();return d=d[f.cache],o(f.props,function(a,e){var f=e.idx,g=h[f],j=d[f],k=l[e.type]||{};null!==j&&(null===g?i[f]=j:(k.mod&&(j-g>k.mod/2?g+=k.mod:g-j>k.mod/2&&(g-=k.mod)),i[f]=c((j-g)*b+g,e)))}),this[e](i)},blend:function(b){if(1===this._rgba[3])return this;var c=this._rgba.slice(),d=c.pop(),e=j(b)._rgba;return j(a.map(c,function(a,b){return(1-d)*e[b]+d*a}))},toRgbaString:function(){var b="rgba(",c=a.map(this._rgba,function(a,b){return null==a?b>2?1:0:a});return 1===c[3]&&(c.pop(),b="rgb("),b+c.join()+")"},toHslaString:function(){var b="hsla(",c=a.map(this.hsla(),function(a,b){return null==a&&(a=b>2?1:0),b&&b<3&&(a=Math.round(100*a)+"%"),a});return 1===c[3]&&(c.pop(),b="hsl("),b+c.join()+")"},toHexString:function(b){var c=this._rgba.slice(),d=c.pop();return b&&c.push(~~(255*d)),"#"+a.map(c,function(a){return a=(a||0).toString(16),1===a.length?"0"+a:a}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),j.fn.parse.prototype=j.fn,k.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b,c,d=a[0]/255,e=a[1]/255,f=a[2]/255,g=a[3],h=Math.max(d,e,f),i=Math.min(d,e,f),j=h-i,k=h+i,l=.5*k;return b=i===h?0:d===h?60*(e-f)/j+360:e===h?60*(f-d)/j+120:60*(d-e)/j+240,c=0===j?0:l<=.5?j/k:j/(2-k),[Math.round(b)%360,c,l,null==g?1:g]},k.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/360,c=a[1],d=a[2],f=a[3],g=d<=.5?d*(1+c):d+c-d*c,h=2*d-g;return[Math.round(255*e(h,g,b+1/3)),Math.round(255*e(h,g,b)),Math.round(255*e(h,g,b-1/3)),f]},o(k,function(d,e){var f=e.props,g=e.cache,i=e.to,k=e.from;j.fn[d]=function(d){if(i&&!this[g]&&(this[g]=i(this._rgba)),d===b)return this[g].slice();var e,h=a.type(d),l="array"===h||"object"===h?d:arguments,m=this[g].slice();return o(f,function(a,b){var d=l["object"===h?a:b.idx];null==d&&(d=m[b.idx]),m[b.idx]=c(d,b)}),k?(e=j(k(m)),e[g]=m,e):j(m)},o(f,function(b,c){j.fn[b]||(j.fn[b]=function(e){var f,g=a.type(e),i="alpha"===b?this._hsla?"hsla":"rgba":d,j=this[i](),k=j[c.idx];return"undefined"===g?k:("function"===g&&(e=e.call(this,k),g=a.type(e)),null==e&&c.empty?this:("string"===g&&(f=h.exec(e),f&&(e=k+parseFloat(f[2])*("+"===f[1]?1:-1))),j[c.idx]=e,this[i](j)))})})}),j.hook=function(b){var c=b.split(" ");o(c,function(b,c){a.cssHooks[c]={set:function(b,e){var f,g,h="";if("transparent"!==e&&("string"!==a.type(e)||(f=d(e)))){if(e=j(f||e),!m.rgba&&1!==e._rgba[3]){for(g="backgroundColor"===c?b.parentNode:b;(""===h||"transparent"===h)&&g&&g.style;)try{h=a.css(g,"backgroundColor"),g=g.parentNode}catch(a){}e=e.blend(h&&"transparent"!==h?h:"_default")}e=e.toRgbaString()}try{b.style[c]=e}catch(a){}}},a.fx.step[c]=function(b){b.colorInit||(b.start=j(b.elem,c),b.end=j(b.end),b.colorInit=!0),a.cssHooks[c].set(b.elem,b.start.transition(b.end,b.pos))}})},j.hook(g),a.cssHooks.borderColor={expand:function(a){var b={};return o(["Top","Right","Bottom","Left"],function(c,d){b["border"+d+"Color"]=a}),b}},f=a.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(t),function(){function b(b){var c,d,e=b.ownerDocument.defaultView?b.ownerDocument.defaultView.getComputedStyle(b,null):b.currentStyle,f={};if(e&&e.length&&e[0]&&e[e[0]])for(d=e.length;d--;)c=e[d],"string"==typeof e[c]&&(f[a.camelCase(c)]=e[c]);else for(c in e)"string"==typeof e[c]&&(f[c]=e[c]);return f}function c(b,c){var d,f,g={};for(d in c)f=c[d],b[d]!==f&&(e[d]||!a.fx.step[d]&&isNaN(parseFloat(f))||(g[d]=f));return g}var d=["add","remove","toggle"],e={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(b,c){a.fx.step[c]=function(a){("none"!==a.end&&!a.setAttr||1===a.pos&&!a.setAttr)&&(t.style(a.elem,c,a.end),a.setAttr=!0)}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a.effects.animateClass=function(e,f,g,h){var i=a.speed(f,g,h);return this.queue(function(){var f,g=a(this),h=g.attr("class")||"",j=i.children?g.find("*").addBack():g;j=j.map(function(){var c=a(this);return{el:c,start:b(this)}}),f=function(){a.each(d,function(a,b){e[b]&&g[b+"Class"](e[b])})},f(),j=j.map(function(){return this.end=b(this.el[0]),this.diff=c(this.start,this.end),this}),g.attr("class",h),j=j.map(function(){var b=this,c=a.Deferred(),d=a.extend({},i,{queue:!1,complete:function(){c.resolve(b)}});return this.el.animate(this.diff,d),c.promise()}),a.when.apply(a,j.get()).done(function(){f(),a.each(arguments,function(){var b=this.el;a.each(this.diff,function(a){b.css(a,"")})}),i.complete.call(g[0])})})},a.fn.extend({addClass:function(b){return function(c,d,e,f){return d?a.effects.animateClass.call(this,{add:c},d,e,f):b.apply(this,arguments)}}(a.fn.addClass),removeClass:function(b){return function(c,d,e,f){return arguments.length>1?a.effects.animateClass.call(this,{remove:c},d,e,f):b.apply(this,arguments)}}(a.fn.removeClass),toggleClass:function(b){return function(c,d,e,f,g){return"boolean"==typeof d||void 0===d?e?a.effects.animateClass.call(this,d?{add:c}:{remove:c},e,f,g):b.apply(this,arguments):a.effects.animateClass.call(this,{toggle:c},d,e,f)}}(a.fn.toggleClass),switchClass:function(b,c,d,e,f){return a.effects.animateClass.call(this,{add:c,remove:b},d,e,f)}})}(),function(){function b(b,c,d,e){return a.isPlainObject(b)&&(c=b,b=b.effect),b={effect:b},null==c&&(c={}),a.isFunction(c)&&(e=c,d=null,c={}),("number"==typeof c||a.fx.speeds[c])&&(e=d,d=c,c={}),a.isFunction(d)&&(e=d,d=null),c&&a.extend(b,c),d=d||c.duration,b.duration=a.fx.off?0:"number"==typeof d?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default,b.complete=e||c.complete,b}function c(b){return!(b&&"number"!=typeof b&&!a.fx.speeds[b])||("string"==typeof b&&!a.effects.effect[b]||(!!a.isFunction(b)||"object"==typeof b&&!b.effect))}a.extend(a.effects,{version:"1.11.4",save:function(a,b){for(var c=0;c<b.length;c++)null!==b[c]&&a.data(s+b[c],a[0].style[b[c]])},restore:function(a,b){var c,d;for(d=0;d<b.length;d++)null!==b[d]&&(c=a.data(s+b[d]),void 0===c&&(c=""),a.css(b[d],c))},setMode:function(a,b){return"toggle"===b&&(b=a.is(":hidden")?"show":"hide"),b},getBaseline:function(a,b){var c,d;switch(a[0]){case"top":c=0;break;case"middle":c=.5;break;case"bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case"left":d=0;break;case"center":d=.5;break;case"right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),float:b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),e={width:b.width(),height:b.height()},f=document.activeElement;try{f.id}catch(a){f=document.body}return b.wrap(d),(b[0]===f||a.contains(b[0],f))&&a(f).focus(),d=b.parent(),"static"===b.css("position")?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,d){c[d]=b.css(d),isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),b.css(e),d.css(c).show()},removeWrapper:function(b){var c=document.activeElement;return b.parent().is(".ui-effects-wrapper")&&(b.parent().replaceWith(b),(b[0]===c||a.contains(b[0],c))&&a(c).focus()),b},setTransition:function(b,c,d,e){return e=e||{},a.each(c,function(a,c){var f=b.cssUnit(c);f[0]>0&&(e[c]=f[0]*d+f[1])}),e}}),a.fn.extend({effect:function(){function c(b){function c(){a.isFunction(f)&&f.call(e[0]),a.isFunction(b)&&b()}var e=a(this),f=d.complete,h=d.mode;(e.is(":hidden")?"hide"===h:"show"===h)?(e[h](),c()):g.call(e[0],d,c)}var d=b.apply(this,arguments),e=d.mode,f=d.queue,g=a.effects.effect[d.effect];return a.fx.off||!g?e?this[e](d.duration,d.complete):this.each(function(){d.complete&&d.complete.call(this)}):f===!1?this.each(c):this.queue(f||"fx",c)},show:function(a){return function(d){if(c(d))return a.apply(this,arguments);var e=b.apply(this,arguments);return e.mode="show",this.effect.call(this,e)}}(a.fn.show),hide:function(a){return function(d){if(c(d))return a.apply(this,arguments);var e=b.apply(this,arguments);return e.mode="hide",this.effect.call(this,e)}}(a.fn.hide),toggle:function(a){return function(d){if(c(d)||"boolean"==typeof d)return a.apply(this,arguments);var e=b.apply(this,arguments);return e.mode="toggle",this.effect.call(this,e)}}(a.fn.toggle),cssUnit:function(b){var c=this.css(b),d=[];return a.each(["em","px","%","pt"],function(a,b){c.indexOf(b)>0&&(d=[parseFloat(c),b])}),d}})}(),function(){var b={};a.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,c){b[c]=function(b){return Math.pow(b,a+2)}}),a.extend(b,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){for(var b,c=4;a<((b=Math.pow(2,--c))-1)/11;);return 1/Math.pow(4,3-c)-7.5625*Math.pow((3*b-2)/22-a,2)}}),a.each(b,function(b,c){a.easing["easeIn"+b]=c,a.easing["easeOut"+b]=function(a){return 1-c(1-a)},a.easing["easeInOut"+b]=function(a){return a<.5?c(2*a)/2:1-c(a*-2+2)/2}})}();a.effects,a.effects.effect.blind=function(b,c){var d,e,f,g=a(this),h=/up|down|vertical/,i=/up|left|vertical|horizontal/,j=["position","top","bottom","left","right","height","width"],k=a.effects.setMode(g,b.mode||"hide"),l=b.direction||"up",m=h.test(l),n=m?"height":"width",o=m?"top":"left",p=i.test(l),q={},r="show"===k;g.parent().is(".ui-effects-wrapper")?a.effects.save(g.parent(),j):a.effects.save(g,j),g.show(),d=a.effects.createWrapper(g).css({overflow:"hidden"}),e=d[n](),f=parseFloat(d.css(o))||0,q[n]=r?e:0,p||(g.css(m?"bottom":"right",0).css(m?"top":"left","auto").css({position:"absolute"}),q[o]=r?f:e+f),r&&(d.css(n,0),p||d.css(o,f+e)),d.animate(q,{duration:b.duration,easing:b.easing,queue:!1,complete:function(){"hide"===k&&g.hide(),a.effects.restore(g,j),a.effects.removeWrapper(g),c()}})},a.effects.effect.bounce=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","height","width"],i=a.effects.setMode(g,b.mode||"effect"),j="hide"===i,k="show"===i,l=b.direction||"up",m=b.distance,n=b.times||5,o=2*n+(k||j?1:0),p=b.duration/o,q=b.easing,r="up"===l||"down"===l?"top":"left",s="up"===l||"left"===l,t=g.queue(),u=t.length;for((k||j)&&h.push("opacity"),a.effects.save(g,h),g.show(),a.effects.createWrapper(g),m||(m=g["top"===r?"outerHeight":"outerWidth"]()/3),k&&(f={opacity:1},f[r]=0,g.css("opacity",0).css(r,s?2*-m:2*m).animate(f,p,q)),j&&(m/=Math.pow(2,n-1)),f={},f[r]=0,d=0;d<n;d++)e={},e[r]=(s?"-=":"+=")+m,g.animate(e,p,q).animate(f,p,q),m=j?2*m:m/2;j&&(e={opacity:0},e[r]=(s?"-=":"+=")+m,g.animate(e,p,q)),g.queue(function(){j&&g.hide(),a.effects.restore(g,h),a.effects.removeWrapper(g),c()}),u>1&&t.splice.apply(t,[1,0].concat(t.splice(u,o+1))),g.dequeue()},a.effects.effect.clip=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","height","width"],i=a.effects.setMode(g,b.mode||"hide"),j="show"===i,k=b.direction||"vertical",l="vertical"===k,m=l?"height":"width",n=l?"top":"left",o={};a.effects.save(g,h),g.show(),d=a.effects.createWrapper(g).css({overflow:"hidden"}),e="IMG"===g[0].tagName?d:g,f=e[m](),j&&(e.css(m,0),e.css(n,f/2)),o[m]=j?f:0,o[n]=j?0:f/2,e.animate(o,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){j||g.hide(),a.effects.restore(g,h),a.effects.removeWrapper(g),c()}})},a.effects.effect.drop=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","opacity","height","width"],g=a.effects.setMode(e,b.mode||"hide"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i?"pos":"neg",l={opacity:h?1:0};a.effects.save(e,f),e.show(),a.effects.createWrapper(e),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0)/2,h&&e.css("opacity",0).css(j,"pos"===k?-d:d),l[j]=(h?"pos"===k?"+=":"-=":"pos"===k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})},a.effects.effect.explode=function(b,c){function d(){t.push(this),t.length===l*m&&e()}function e(){n.css({visibility:"visible"}),a(t).remove(),p||n.hide(),c()}var f,g,h,i,j,k,l=b.pieces?Math.round(Math.sqrt(b.pieces)):3,m=l,n=a(this),o=a.effects.setMode(n,b.mode||"hide"),p="show"===o,q=n.show().css("visibility","hidden").offset(),r=Math.ceil(n.outerWidth()/m),s=Math.ceil(n.outerHeight()/l),t=[];for(f=0;f<l;f++)for(i=q.top+f*s,k=f-(l-1)/2,g=0;g<m;g++)h=q.left+g*r,j=g-(m-1)/2,n.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-g*r,top:-f*s}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:r,height:s,left:h+(p?j*r:0),top:i+(p?k*s:0),opacity:p?0:1}).animate({left:h+(p?0:j*r),top:i+(p?0:k*s),opacity:p?1:0},b.duration||500,b.easing,d)},a.effects.effect.fade=function(b,c){var d=a(this),e=a.effects.setMode(d,b.mode||"toggle");d.animate({opacity:e},{queue:!1,duration:b.duration,easing:b.easing,complete:c})},a.effects.effect.fold=function(b,c){var d,e,f=a(this),g=["position","top","bottom","left","right","height","width"],h=a.effects.setMode(f,b.mode||"hide"),i="show"===h,j="hide"===h,k=b.size||15,l=/([0-9]+)%/.exec(k),m=!!b.horizFirst,n=i!==m,o=n?["width","height"]:["height","width"],p=b.duration/2,q={},r={};a.effects.save(f,g),f.show(),d=a.effects.createWrapper(f).css({overflow:"hidden"}),e=n?[d.width(),d.height()]:[d.height(),d.width()],l&&(k=parseInt(l[1],10)/100*e[j?0:1]),i&&d.css(m?{height:0,width:k}:{height:k,width:0}),q[o[0]]=i?e[0]:k,r[o[1]]=i?e[1]:0,d.animate(q,p,b.easing).animate(r,p,b.easing,function(){j&&f.hide(),a.effects.restore(f,g),a.effects.removeWrapper(f),c()})},a.effects.effect.highlight=function(b,c){var d=a(this),e=["backgroundImage","backgroundColor","opacity"],f=a.effects.setMode(d,b.mode||"show"),g={backgroundColor:d.css("backgroundColor")};"hide"===f&&(g.opacity=0),a.effects.save(d,e),d.show().css({backgroundImage:"none",backgroundColor:b.color||"#ffff99"}).animate(g,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===f&&d.hide(),a.effects.restore(d,e),c()}})},a.effects.effect.size=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","width","height","overflow","opacity"],i=["position","top","bottom","left","right","overflow","opacity"],j=["width","height","overflow"],k=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],m=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],n=a.effects.setMode(g,b.mode||"effect"),o=b.restore||"effect"!==n,p=b.scale||"both",q=b.origin||["middle","center"],r=g.css("position"),s=o?h:i,t={height:0,width:0,outerHeight:0,outerWidth:0};"show"===n&&g.show(),d={height:g.height(),width:g.width(),outerHeight:g.outerHeight(),outerWidth:g.outerWidth()},"toggle"===b.mode&&"show"===n?(g.from=b.to||t,g.to=b.from||d):(g.from=b.from||("show"===n?t:d),g.to=b.to||("hide"===n?t:d)),f={from:{y:g.from.height/d.height,x:g.from.width/d.width},to:{y:g.to.height/d.height,x:g.to.width/d.width}},"box"!==p&&"both"!==p||(f.from.y!==f.to.y&&(s=s.concat(l),g.from=a.effects.setTransition(g,l,f.from.y,g.from),g.to=a.effects.setTransition(g,l,f.to.y,g.to)),f.from.x!==f.to.x&&(s=s.concat(m),g.from=a.effects.setTransition(g,m,f.from.x,g.from),g.to=a.effects.setTransition(g,m,f.to.x,g.to))),"content"!==p&&"both"!==p||f.from.y!==f.to.y&&(s=s.concat(k).concat(j),g.from=a.effects.setTransition(g,k,f.from.y,g.from),g.to=a.effects.setTransition(g,k,f.to.y,g.to)),a.effects.save(g,s),g.show(),a.effects.createWrapper(g),g.css("overflow","hidden").css(g.from),q&&(e=a.effects.getBaseline(q,d),g.from.top=(d.outerHeight-g.outerHeight())*e.y,g.from.left=(d.outerWidth-g.outerWidth())*e.x,g.to.top=(d.outerHeight-g.to.outerHeight)*e.y,g.to.left=(d.outerWidth-g.to.outerWidth)*e.x),g.css(g.from),"content"!==p&&"both"!==p||(l=l.concat(["marginTop","marginBottom"]).concat(k),m=m.concat(["marginLeft","marginRight"]),j=h.concat(l).concat(m),g.find("*[width]").each(function(){var c=a(this),d={height:c.height(),width:c.width(),outerHeight:c.outerHeight(),outerWidth:c.outerWidth()};o&&a.effects.save(c,j),c.from={height:d.height*f.from.y,width:d.width*f.from.x,outerHeight:d.outerHeight*f.from.y,outerWidth:d.outerWidth*f.from.x},c.to={height:d.height*f.to.y,width:d.width*f.to.x,outerHeight:d.height*f.to.y,outerWidth:d.width*f.to.x},f.from.y!==f.to.y&&(c.from=a.effects.setTransition(c,l,f.from.y,c.from),c.to=a.effects.setTransition(c,l,f.to.y,c.to)),f.from.x!==f.to.x&&(c.from=a.effects.setTransition(c,m,f.from.x,c.from),c.to=a.effects.setTransition(c,m,f.to.x,c.to)),c.css(c.from),c.animate(c.to,b.duration,b.easing,function(){o&&a.effects.restore(c,j)})})),g.animate(g.to,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){0===g.to.opacity&&g.css("opacity",g.from.opacity),"hide"===n&&g.hide(),a.effects.restore(g,s),o||("static"===r?g.css({position:"relative",top:g.to.top,left:g.to.left}):a.each(["top","left"],function(a,b){g.css(b,function(b,c){var d=parseInt(c,10),e=a?g.to.left:g.to.top;return"auto"===c?e+"px":d+e+"px"})})),a.effects.removeWrapper(g),c()}})},a.effects.effect.scale=function(b,c){var d=a(this),e=a.extend(!0,{},b),f=a.effects.setMode(d,b.mode||"effect"),g=parseInt(b.percent,10)||(0===parseInt(b.percent,10)?0:"hide"===f?0:100),h=b.direction||"both",i=b.origin,j={height:d.height(),width:d.width(),outerHeight:d.outerHeight(),outerWidth:d.outerWidth()},k={y:"horizontal"!==h?g/100:1,x:"vertical"!==h?g/100:1};e.effect="size",e.queue=!1,e.complete=c,"effect"!==f&&(e.origin=i||["middle","center"],e.restore=!0),e.from=b.from||("show"===f?{height:0,width:0,outerHeight:0,outerWidth:0}:j),e.to={height:j.height*k.y,width:j.width*k.x,outerHeight:j.outerHeight*k.y,outerWidth:j.outerWidth*k.x},e.fade&&("show"===f&&(e.from.opacity=0,e.to.opacity=1),"hide"===f&&(e.from.opacity=1,e.to.opacity=0)),d.effect(e)},a.effects.effect.puff=function(b,c){var d=a(this),e=a.effects.setMode(d,b.mode||"hide"),f="hide"===e,g=parseInt(b.percent,10)||150,h=g/100,i={height:d.height(),width:d.width(),outerHeight:d.outerHeight(),outerWidth:d.outerWidth()};a.extend(b,{effect:"scale",queue:!1,fade:!0,mode:e,complete:c,percent:f?g:100,from:f?i:{height:i.height*h,width:i.width*h,outerHeight:i.outerHeight*h,outerWidth:i.outerWidth*h}}),d.effect(b)},a.effects.effect.pulsate=function(b,c){var d,e=a(this),f=a.effects.setMode(e,b.mode||"show"),g="show"===f,h="hide"===f,i=g||"hide"===f,j=2*(b.times||5)+(i?1:0),k=b.duration/j,l=0,m=e.queue(),n=m.length;for(!g&&e.is(":visible")||(e.css("opacity",0).show(),l=1),d=1;d<j;d++)e.animate({opacity:l},k,b.easing),l=1-l;e.animate({opacity:l},k,b.easing),e.queue(function(){h&&e.hide(),c()}),n>1&&m.splice.apply(m,[1,0].concat(m.splice(n,j+1))),e.dequeue()},a.effects.effect.shake=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","height","width"],g=a.effects.setMode(e,b.mode||"effect"),h=b.direction||"left",i=b.distance||20,j=b.times||3,k=2*j+1,l=Math.round(b.duration/k),m="up"===h||"down"===h?"top":"left",n="up"===h||"left"===h,o={},p={},q={},r=e.queue(),s=r.length;for(a.effects.save(e,f),e.show(),a.effects.createWrapper(e),o[m]=(n?"-=":"+=")+i,p[m]=(n?"+=":"-=")+2*i,q[m]=(n?"-=":"+=")+2*i,e.animate(o,l,b.easing),d=1;d<j;d++)e.animate(p,l,b.easing).animate(q,l,b.easing);e.animate(p,l,b.easing).animate(o,l/2,b.easing).queue(function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}),s>1&&r.splice.apply(r,[1,0].concat(r.splice(s,k+1))),e.dequeue()},a.effects.effect.slide=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","width","height"],g=a.effects.setMode(e,b.mode||"show"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i,l={};a.effects.save(e,f),e.show(),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0),a.effects.createWrapper(e).css({overflow:"hidden"}),h&&e.css(j,k?isNaN(d)?"-"+d:-d:d),l[j]=(h?k?"+=":"-=":k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})},a.effects.effect.transfer=function(b,c){var d=a(this),e=a(b.to),f="fixed"===e.css("position"),g=a("body"),h=f?g.scrollTop():0,i=f?g.scrollLeft():0,j=e.offset(),k={top:j.top-h,left:j.left-i,height:e.innerHeight(),width:e.innerWidth()},l=d.offset(),m=a("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(b.className).css({top:l.top-h,left:l.left-i,height:d.innerHeight(),width:d.innerWidth(),position:f?"fixed":"absolute"}).animate(k,b.duration,b.easing,function(){m.remove(),c()})},a.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=a("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(a){return void 0===a?this.options.value:(this.options.value=this._constrainedValue(a),void this._refreshValue())},_constrainedValue:function(a){return void 0===a&&(a=this.options.value),this.indeterminate=a===!1,"number"!=typeof a&&(a=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,a))},_setOptions:function(a){var b=a.value;delete a.value,this._super(a),this.options.value=this._constrainedValue(b),this._refreshValue()},_setOption:function(a,b){"max"===a&&(b=Math.max(this.min,b)),"disabled"===a&&this.element.toggleClass("ui-state-disabled",!!b).attr("aria-disabled",b),this._super(a,b)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var b=this.options.value,c=this._percentage();this.valueDiv.toggle(this.indeterminate||b>this.min).toggleClass("ui-corner-right",b===this.options.max).width(c.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=a("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":b}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==b&&(this.oldValue=b,this._trigger("change")),b===this.options.max&&this._trigger("complete")}}),a.widget("ui.selectable",a.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var b,c=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){b=a(c.options.filter,c.element[0]),b.addClass("ui-selectee"),b.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=b.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(b){var c=this,d=this.options;this.opos=[b.pageX,b.pageY],this.options.disabled||(this.selectees=a(d.filter,this.element[0]),
this._trigger("start",b),a(d.appendTo).append(this.helper),this.helper.css({left:b.pageX,top:b.pageY,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,b.metaKey||b.ctrlKey||(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().addBack().each(function(){var d,e=a.data(this,"selectable-item");if(e)return d=!b.metaKey&&!b.ctrlKey||!e.$element.hasClass("ui-selected"),e.$element.removeClass(d?"ui-unselecting":"ui-selected").addClass(d?"ui-selecting":"ui-unselecting"),e.unselecting=!d,e.selecting=d,e.selected=d,d?c._trigger("selecting",b,{selecting:e.element}):c._trigger("unselecting",b,{unselecting:e.element}),!1}))},_mouseDrag:function(b){if(this.dragged=!0,!this.options.disabled){var c,d=this,e=this.options,f=this.opos[0],g=this.opos[1],h=b.pageX,i=b.pageY;return f>h&&(c=h,h=f,f=c),g>i&&(c=i,i=g,g=c),this.helper.css({left:f,top:g,width:h-f,height:i-g}),this.selectees.each(function(){var c=a.data(this,"selectable-item"),j=!1;c&&c.element!==d.element[0]&&("touch"===e.tolerance?j=!(c.left>h||c.right<f||c.top>i||c.bottom<g):"fit"===e.tolerance&&(j=c.left>f&&c.right<h&&c.top>g&&c.bottom<i),j?(c.selected&&(c.$element.removeClass("ui-selected"),c.selected=!1),c.unselecting&&(c.$element.removeClass("ui-unselecting"),c.unselecting=!1),c.selecting||(c.$element.addClass("ui-selecting"),c.selecting=!0,d._trigger("selecting",b,{selecting:c.element}))):(c.selecting&&((b.metaKey||b.ctrlKey)&&c.startselected?(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.$element.addClass("ui-selected"),c.selected=!0):(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.startselected&&(c.$element.addClass("ui-unselecting"),c.unselecting=!0),d._trigger("unselecting",b,{unselecting:c.element}))),c.selected&&(b.metaKey||b.ctrlKey||c.startselected||(c.$element.removeClass("ui-selected"),c.selected=!1,c.$element.addClass("ui-unselecting"),c.unselecting=!0,d._trigger("unselecting",b,{unselecting:c.element})))))}),!1}},_mouseStop:function(b){var c=this;return this.dragged=!1,a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove(),!1}}),a.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var a=this.element.uniqueId().attr("id");this.ids={element:a,button:a+"-button",menu:a+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var b=this;this.label=a("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(a){this.button.focus(),a.preventDefault()}}),this.element.hide(),this.button=a("<span>",{class:"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),a("<span>",{class:"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=a("<span>",{class:"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){b.menuItems||b._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var b=this;this.menu=a("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=a("<div>",{class:"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(a,c){a.preventDefault(),b._setSelection(),b._select(c.item.data("ui-selectmenu-item"),a)},focus:function(a,c){var d=c.item.data("ui-selectmenu-item");null!=b.focusIndex&&d.index!==b.focusIndex&&(b._trigger("focus",a,{item:d}),b.isOpen||b._select(d,a)),b.focusIndex=d.index,b.button.attr("aria-activedescendant",b.menuItems.eq(d.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var a,b=this.element.find("option");b.length&&(this._parseOptions(b),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),a=this._getSelectedItem(),this.menuInstance.focus(null,a),this._setAria(a.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(a){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",a))},_position:function(){this.menuWrap.position(a.extend({of:this.button},this.options.position))},close:function(a){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",a))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(b,c){var d=this,e="";a.each(c,function(c,f){f.optgroup!==e&&(a("<li>",{class:"ui-selectmenu-optgroup ui-menu-divider"+(f.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:f.optgroup}).appendTo(b),e=f.optgroup),d._renderItemData(b,f)})},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-selectmenu-item",b)},_renderItem:function(b,c){var d=a("<li>");return c.disabled&&d.addClass("ui-state-disabled"),this._setText(d,c.label),d.appendTo(b)},_setText:function(a,b){b?a.text(b):a.html("&#160;")},_move:function(a,b){var c,d,e=".ui-menu-item";this.isOpen?c=this.menuItems.eq(this.focusIndex):(c=this.menuItems.eq(this.element[0].selectedIndex),e+=":not(.ui-state-disabled)"),d="first"===a||"last"===a?c["first"===a?"prevAll":"nextAll"](e).eq(-1):c[a+"All"](e).eq(0),d.length&&this.menuInstance.focus(b,d)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(a){this[this.isOpen?"close":"open"](a)},_setSelection:function(){var a;this.range&&(window.getSelection?(a=window.getSelection(),a.removeAllRanges(),a.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(b){this.isOpen&&(a(b.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(b))}},_buttonEvents:{mousedown:function(){var a;window.getSelection?(a=window.getSelection(),a.rangeCount&&(this.range=a.getRangeAt(0))):this.range=document.selection.createRange()},click:function(a){this._setSelection(),this._toggle(a)},keydown:function(b){var c=!0;switch(b.keyCode){case a.ui.keyCode.TAB:case a.ui.keyCode.ESCAPE:this.close(b),c=!1;break;case a.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(b);break;case a.ui.keyCode.UP:b.altKey?this._toggle(b):this._move("prev",b);break;case a.ui.keyCode.DOWN:b.altKey?this._toggle(b):this._move("next",b);break;case a.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(b):this._toggle(b);break;case a.ui.keyCode.LEFT:this._move("prev",b);break;case a.ui.keyCode.RIGHT:this._move("next",b);break;case a.ui.keyCode.HOME:case a.ui.keyCode.PAGE_UP:this._move("first",b);break;case a.ui.keyCode.END:case a.ui.keyCode.PAGE_DOWN:this._move("last",b);break;default:this.menu.trigger(b),c=!1}c&&b.preventDefault()}},_selectFocusedItem:function(a){var b=this.menuItems.eq(this.focusIndex);b.hasClass("ui-state-disabled")||this._select(b.data("ui-selectmenu-item"),a)},_select:function(a,b){var c=this.element[0].selectedIndex;this.element[0].selectedIndex=a.index,this._setText(this.buttonText,a.label),this._setAria(a),this._trigger("select",b,{item:a}),a.index!==c&&this._trigger("change",b,{item:a}),this.close(b)},_setAria:function(a){var b=this.menuItems.eq(a.index).attr("id");this.button.attr({"aria-labelledby":b,"aria-activedescendant":b}),this.menu.attr("aria-activedescendant",b)},_setOption:function(a,b){"icons"===a&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(b.button),this._super(a,b),"appendTo"===a&&this.menuWrap.appendTo(this._appendTo()),"disabled"===a&&(this.menuInstance.option("disabled",b),this.button.toggleClass("ui-state-disabled",b).attr("aria-disabled",b),this.element.prop("disabled",b),b?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===a&&this._resizeButton()},_appendTo:function(){var b=this.options.appendTo;return b&&(b=b.jquery||b.nodeType?a(b):this.document.find(b).eq(0)),b&&b[0]||(b=this.element.closest(".ui-front")),b.length||(b=this.document[0].body),b},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var a=this.options.width;a||(a=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(a)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(b){var c=[];b.each(function(b,d){var e=a(d),f=e.parent("optgroup");c.push({element:e,index:b,value:e.val(),label:e.text(),optgroup:f.attr("label")||"",disabled:f.prop("disabled")||e.prop("disabled")})}),this.items=c},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),a.widget("ui.slider",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var b,c,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",g=[];for(c=d.values&&d.values.length||1,e.length>c&&(e.slice(c).remove(),e=e.slice(0,c)),b=e.length;b<c;b++)g.push(f);this.handles=e.add(a(g.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(b){a(this).data("ui-slider-handle-index",b)})},_createRange:function(){var b=this.options,c="";b.range?(b.range===!0&&(b.values?b.values.length&&2!==b.values.length?b.values=[b.values[0],b.values[0]]:a.isArray(b.values)&&(b.values=b.values.slice(0)):b.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=a("<div></div>").appendTo(this.element),c="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(c+("min"===b.range||"max"===b.range?" ui-slider-range-"+b.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(b){var c,d,e,f,g,h,i,j,k=this,l=this.options;return!l.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),c={x:b.pageX,y:b.pageY},d=this._normValueFromMouse(c),e=this._valueMax()-this._valueMin()+1,this.handles.each(function(b){var c=Math.abs(d-k.values(b));(e>c||e===c&&(b===k._lastChangedValue||k.values(b)===l.min))&&(e=c,f=a(this),g=b)}),h=this._start(b,g),h!==!1&&(this._mouseSliding=!0,this._handleIndex=g,f.addClass("ui-state-active").focus(),i=f.offset(),j=!a(b.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=j?{left:0,top:0}:{left:b.pageX-i.left-f.width()/2,top:b.pageY-i.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,g,d),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return"horizontal"===this.orientation?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),d<0&&(d=0),"vertical"===this.orientation&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),2===this.options.values.length&&this.options.range===!0&&(0===b&&c>d||1===b&&c<d)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._lastChangedValue=b,this._trigger("change",a,c)}},value:function(a){return arguments.length?(this.options.value=this._trimAlignValue(a),this._refreshValue(),void this._change(null,0)):this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)return this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),void this._change(null,b);if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();for(d=this.options.values,e=arguments[0],f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;switch("range"===b&&this.options.range===!0&&("min"===c?(this.options.value=this._values(0),this.options.values=null):"max"===c&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),a.isArray(this.options.values)&&(e=this.options.values.length),"disabled"===b&&this.element.toggleClass("ui-state-disabled",!!c),this._super(b,c),b){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===c?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),d=0;d<e;d+=1)this._change(null,d);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b);if(this.options.values&&this.options.values.length){for(c=this.options.values.slice(),d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c}return[]},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return 2*Math.abs(c)>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_calculateNewMax:function(){var a=this.options.max,b=this._valueMin(),c=this.options.step,d=Math.floor(+(a-b).toFixed(this._precision())/c)*c;a=d+b,this.max=parseFloat(a.toFixed(this._precision()))},_precision:function(){var a=this._precisionOf(this.options.step);return null!==this.options.min&&(a=Math.max(a,this._precisionOf(this.options.min))),a},_precisionOf:function(a){var b=a.toString(),c=b.indexOf(".");return c===-1?0:b.length-c-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var b,c,d,e,f,g=this.options.range,h=this.options,i=this,j=!this._animateOff&&h.animate,k={};this.options.values&&this.options.values.length?this.handles.each(function(d){c=(i.values(d)-i._valueMin())/(i._valueMax()-i._valueMin())*100,k["horizontal"===i.orientation?"left":"bottom"]=c+"%",a(this).stop(1,1)[j?"animate":"css"](k,h.animate),i.options.range===!0&&("horizontal"===i.orientation?(0===d&&i.range.stop(1,1)[j?"animate":"css"]({left:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({width:c-b+"%"},{queue:!1,duration:h.animate})):(0===d&&i.range.stop(1,1)[j?"animate":"css"]({bottom:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({height:c-b+"%"},{queue:!1,duration:h.animate}))),b=c}):(d=this.value(),e=this._valueMin(),f=this._valueMax(),c=f!==e?(d-e)/(f-e)*100:0,k["horizontal"===this.orientation?"left":"bottom"]=c+"%",this.handle.stop(1,1)[j?"animate":"css"](k,h.animate),"min"===g&&"horizontal"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({width:c+"%"},h.animate),"max"===g&&"horizontal"===this.orientation&&this.range[j?"animate":"css"]({width:100-c+"%"},{queue:!1,duration:h.animate}),"min"===g&&"vertical"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({height:c+"%"},h.animate),"max"===g&&"vertical"===this.orientation&&this.range[j?"animate":"css"]({height:100-c+"%"},{queue:!1,duration:h.animate}))},_handleEvents:{keydown:function(b){var c,d,e,f,g=a(b.target).data("ui-slider-handle-index");switch(b.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(b.preventDefault(),!this._keySliding&&(this._keySliding=!0,a(b.target).addClass("ui-state-active"),c=this._start(b,g),c===!1))return}switch(f=this.options.step,d=e=this.options.values&&this.options.values.length?this.values(g):this.value(),b.keyCode){case a.ui.keyCode.HOME:e=this._valueMin();break;case a.ui.keyCode.END:e=this._valueMax();break;case a.ui.keyCode.PAGE_UP:e=this._trimAlignValue(d+(this._valueMax()-this._valueMin())/this.numPages);break;case a.ui.keyCode.PAGE_DOWN:e=this._trimAlignValue(d-(this._valueMax()-this._valueMin())/this.numPages);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(d===this._valueMax())return;e=this._trimAlignValue(d+f);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(d===this._valueMin())return;e=this._trimAlignValue(d-f)}this._slide(b,g,e)},keyup:function(b){var c=a(b.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(b,c),this._change(b,c),a(b.target).removeClass("ui-state-active"))}}}),a.widget("ui.sortable",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(a,b,c){return a>=b&&a<b+c},_isFloating:function(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(a,b){this._super(a,b),"handle"===a&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),a.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(b),a(b.target).parents().each(function(){if(a.data(this,f.widgetName+"-item")===f)return d=a(this),!1}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),!!d&&(!(this.options.handle&&!c&&(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),!e))&&(this.currentItem=d,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-this.document.scrollTop()<g.scrollSensitivity?h=this.document.scrollTop(this.document.scrollTop()-g.scrollSpeed):this.window.height()-(b.pageY-this.document.scrollTop())<g.scrollSensitivity&&(h=this.document.scrollTop(this.document.scrollTop()+g.scrollSpeed)),b.pageX-this.document.scrollLeft()<g.scrollSensitivity?h=this.document.scrollLeft(this.document.scrollLeft()-g.scrollSpeed):this.window.width()-(b.pageX-this.document.scrollLeft())<g.scrollSensitivity&&(h=this.document.scrollLeft(this.document.scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&!(e===this.currentItem[0]||this.placeholder[1===f?"next":"prev"]()[0]===e||a.contains(this.placeholder[0],e)||"semi-dynamic"===this.options.type&&a.contains(this.element[0],e))){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&d+j<i,m="y"===this.options.axis||b+k>f&&b+k<g,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(a){var b="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height),c="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width),d=b&&c,e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return!!d&&(this.floating?f&&"right"===f||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(a){var b=this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),c=this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),d=this._getDragVerticalDirection(),e=this._getDragHorizontalDirection();return this.floating&&e?"right"===e&&c||"left"===e&&!c:d&&("down"===d&&b||"up"===d&&!b)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){function c(){h.push(this)}var d,e,f,g,h=[],i=[],j=this._connectWith();if(j&&b)for(d=j.length-1;d>=0;d--)for(f=a(j[d],this.document[0]),e=f.length-1;e>=0;e--)g=a.data(f[e],this.widgetFullName),g&&g!==this&&!g.options.disabled&&i.push([a.isFunction(g.options.items)?g.options.items.call(g.element):a(g.options.items,g.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),g]);
for(i.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),d=i.length-1;d>=0;d--)i[d][0].each(c);return a(h)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c],this.document[0]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;d<j;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===d?b._createTrPlaceholder(b.currentItem.find("tr").eq(0),a("<tr>",b.document[0]).appendTo(e)):"tr"===d?b._createTrPlaceholder(b.currentItem,e):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){c&&!d.forcePlaceholderSize||(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_createTrPlaceholder:function(b,c){var d=this;b.children().each(function(){a("<td>&#160;</td>",d.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(c)})},_contactContainers:function(b){var c,d,e,f,g,h,i,j,k,l,m=null,n=null;for(c=this.containers.length-1;c>=0;c--)if(!a.contains(this.currentItem[0],this.containers[c].element[0]))if(this._intersectsWith(this.containers[c].containerCache)){if(m&&a.contains(this.containers[c].element[0],m.element[0]))continue;m=this.containers[c],n=c}else this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",b,this._uiHash(this)),this.containers[c].containerCache.over=0);if(m)if(1===this.containers.length)this.containers[n].containerCache.over||(this.containers[n]._trigger("over",b,this._uiHash(this)),this.containers[n].containerCache.over=1);else{for(e=1e4,f=null,k=m.floating||this._isFloating(this.currentItem),g=k?"left":"top",h=k?"width":"height",l=k?"clientX":"clientY",d=this.items.length-1;d>=0;d--)a.contains(this.containers[n].element[0],this.items[d].item[0])&&this.items[d].item[0]!==this.currentItem[0]&&(i=this.items[d].item.offset()[g],j=!1,b[l]-i>this.items[d][h]/2&&(j=!0),Math.abs(b[l]-i)<e&&(e=Math.abs(b[l]-i),f=this.items[d],this.direction=j?"up":"down"));if(!f&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[n])return void(this.currentContainer.containerCache.over||(this.containers[n]._trigger("over",b,this._uiHash()),this.currentContainer.containerCache.over=1));f?this._rearrange(b,f,null,!0):this._rearrange(b,null,this.containers[n].element,!0),this._trigger("change",b,this._uiHash()),this.containers[n]._trigger("change",b,this._uiHash(this)),this.currentContainer=this.containers[n],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",b,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),d[0].style.width&&!c.forceHelperSize||d.width(this.currentItem.width()),d[0].style.height&&!c.forceHelperSize||d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),"document"!==e.containment&&"window"!==e.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===e.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===e.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function c(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var d,e=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(d in this._storedCSS)"auto"!==this._storedCSS[d]&&"static"!==this._storedCSS[d]||(this._storedCSS[d]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||e.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),d=this.containers.length-1;d>=0;d--)b||e.push(c("deactivate",this,this.containers[d])),this.containers[d].containerCache.over&&(e.push(c("out",this,this.containers[d])),this.containers[d].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!b){for(d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}}),a.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var b={},c=this.element;return a.each(["min","max","step"],function(a,d){var e=c.attr(d);void 0!==e&&e.length&&(b[d]=e)}),b},_events:{keydown:function(a){this._start(a)&&this._keydown(a)&&a.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(a){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",a)))},mousewheel:function(a,b){if(b){if(!this.spinning&&!this._start(a))return!1;this._spin((b>0?1:-1)*this.options.step,a),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(a)},100),a.preventDefault()}},"mousedown .ui-spinner-button":function(b){function c(){var a=this.element[0]===this.document[0].activeElement;a||(this.element.focus(),this.previous=d,this._delay(function(){this.previous=d}))}var d;d=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),b.preventDefault(),c.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,c.call(this)}),this._start(b)!==!1&&this._repeat(null,a(b.currentTarget).hasClass("ui-spinner-up")?1:-1,b)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(b){if(a(b.currentTarget).hasClass("ui-state-active"))return this._start(b)!==!1&&void this._repeat(null,a(b.currentTarget).hasClass("ui-spinner-up")?1:-1,b)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var a=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=a.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*a.height())&&a.height()>0&&a.height(a.height()),this.options.disabled&&this.disable()},_keydown:function(b){var c=this.options,d=a.ui.keyCode;switch(b.keyCode){case d.UP:return this._repeat(null,1,b),!0;case d.DOWN:return this._repeat(null,-1,b),!0;case d.PAGE_UP:return this._repeat(null,c.page,b),!0;case d.PAGE_DOWN:return this._repeat(null,-c.page,b),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(a){return!(!this.spinning&&this._trigger("start",a)===!1)&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(a,b,c){a=a||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,b,c)},a),this._spin(b*this.options.step,c)},_spin:function(a,b){var c=this.value()||0;this.counter||(this.counter=1),c=this._adjustValue(c+a*this._increment(this.counter)),this.spinning&&this._trigger("spin",b,{value:c})===!1||(this._value(c),this.counter++)},_increment:function(b){var c=this.options.incremental;return c?a.isFunction(c)?c(b):Math.floor(b*b*b/5e4-b*b/500+17*b/200+1):1},_precision:function(){var a=this._precisionOf(this.options.step);return null!==this.options.min&&(a=Math.max(a,this._precisionOf(this.options.min))),a},_precisionOf:function(a){var b=a.toString(),c=b.indexOf(".");return c===-1?0:b.length-c-1},_adjustValue:function(a){var b,c,d=this.options;return b=null!==d.min?d.min:0,c=a-b,c=Math.round(c/d.step)*d.step,a=b+c,a=parseFloat(a.toFixed(this._precision())),null!==d.max&&a>d.max?d.max:null!==d.min&&a<d.min?d.min:a},_stop:function(a){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",a))},_setOption:function(a,b){if("culture"===a||"numberFormat"===a){var c=this._parse(this.element.val());return this.options[a]=b,void this.element.val(this._format(c))}"max"!==a&&"min"!==a&&"step"!==a||"string"==typeof b&&(b=this._parse(b)),"icons"===a&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(b.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(b.down)),this._super(a,b),"disabled"===a&&(this.widget().toggleClass("ui-state-disabled",!!b),this.element.prop("disabled",!!b),this.buttons.button(b?"disable":"enable"))},_setOptions:i(function(a){this._super(a)}),_parse:function(a){return"string"==typeof a&&""!==a&&(a=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(a,10,this.options.culture):+a),""===a||isNaN(a)?null:a},_format:function(a){return""===a?"":window.Globalize&&this.options.numberFormat?Globalize.format(a,this.options.numberFormat,this.options.culture):a},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var a=this.value();return null!==a&&a===this._adjustValue(a)},_value:function(a,b){var c;""!==a&&(c=this._parse(a),null!==c&&(b||(c=this._adjustValue(c)),a=this._format(c))),this.element.val(a),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:i(function(a){this._stepUp(a)}),_stepUp:function(a){this._start()&&(this._spin((a||1)*this.options.step),this._stop())},stepDown:i(function(a){this._stepDown(a)}),_stepDown:function(a){this._start()&&(this._spin((a||1)*-this.options.step),this._stop())},pageUp:i(function(a){this._stepUp((a||1)*this.options.page)}),pageDown:i(function(a){this._stepDown((a||1)*this.options.page)}),value:function(a){return arguments.length?void i(this._value).call(this,a):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),a.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var a=/#.*$/;return function(b){var c,d;b=b.cloneNode(!1),c=b.href.replace(a,""),d=location.href.replace(a,"");try{c=decodeURIComponent(c)}catch(a){}try{d=decodeURIComponent(d)}catch(a){}return b.hash.length>1&&c===d}}(),_create:function(){var b=this,c=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",c.collapsible),this._processTabs(),c.active=this._initialActive(),a.isArray(c.disabled)&&(c.disabled=a.unique(c.disabled.concat(a.map(this.tabs.filter(".ui-state-disabled"),function(a){return b.tabs.index(a)}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(c.active):this.active=a(),this._refresh(),this.active.length&&this.load(c.active)},_initialActive:function(){var b=this.options.active,c=this.options.collapsible,d=location.hash.substring(1);return null===b&&(d&&this.tabs.each(function(c,e){if(a(e).attr("aria-controls")===d)return b=c,!1}),null===b&&(b=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==b&&b!==-1||(b=!!this.tabs.length&&0)),b!==!1&&(b=this.tabs.index(this.tabs.eq(b)),b===-1&&(b=!c&&0)),!c&&b===!1&&this.anchors.length&&(b=0),b},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):a()}},_tabKeydown:function(b){var c=a(this.document[0].activeElement).closest("li"),d=this.tabs.index(c),e=!0;if(!this._handlePageNav(b)){switch(b.keyCode){case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:d++;break;case a.ui.keyCode.UP:case a.ui.keyCode.LEFT:e=!1,d--;break;case a.ui.keyCode.END:d=this.anchors.length-1;break;case a.ui.keyCode.HOME:d=0;break;case a.ui.keyCode.SPACE:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d);case a.ui.keyCode.ENTER:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d!==this.options.active&&d);default:return}b.preventDefault(),clearTimeout(this.activating),d=this._focusNextTab(d,e),b.ctrlKey||b.metaKey||(c.attr("aria-selected","false"),this.tabs.eq(d).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",d)},this.delay))}},_panelKeydown:function(b){this._handlePageNav(b)||b.ctrlKey&&b.keyCode===a.ui.keyCode.UP&&(b.preventDefault(),this.active.focus())},_handlePageNav:function(b){return b.altKey&&b.keyCode===a.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):b.altKey&&b.keyCode===a.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(b,c){function d(){return b>e&&(b=0),b<0&&(b=e),b}for(var e=this.tabs.length-1;a.inArray(d(),this.options.disabled)!==-1;)b=c?b+1:b-1;return b},_focusNextTab:function(a,b){return a=this._findNextTab(a,b),this.tabs.eq(a).focus(),a},_setOption:function(a,b){return"active"===a?void this._activate(b):"disabled"===a?void this._setupDisabled(b):(this._super(a,b),"collapsible"===a&&(this.element.toggleClass("ui-tabs-collapsible",b),b||this.options.active!==!1||this._activate(0)),"event"===a&&this._setupEvents(b),void("heightStyle"===a&&this._setupHeightStyle(b)))},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var b=this.options,c=this.tablist.children(":has(a[href])");b.disabled=a.map(c.filter(".ui-state-disabled"),function(a){return c.index(a)}),this._processTabs(),b.active!==!1&&this.anchors.length?this.active.length&&!a.contains(this.tablist[0],this.active[0])?this.tabs.length===b.disabled.length?(b.active=!1,this.active=a()):this._activate(this._findNextTab(Math.max(0,b.active-1),!1)):b.active=this.tabs.index(this.active):(b.active=!1,this.active=a()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var b=this,c=this.tabs,d=this.anchors,e=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(b){a(this).is(".ui-state-disabled")&&b.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){a(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return a("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=a(),this.anchors.each(function(c,d){var e,f,g,h=a(d).uniqueId().attr("id"),i=a(d).closest("li"),j=i.attr("aria-controls");b._isLocal(d)?(e=d.hash,g=e.substring(1),f=b.element.find(b._sanitizeSelector(e))):(g=i.attr("aria-controls")||a({}).uniqueId()[0].id,e="#"+g,f=b.element.find(e),f.length||(f=b._createPanel(g),f.insertAfter(b.panels[c-1]||b.tablist)),f.attr("aria-live","polite")),f.length&&(b.panels=b.panels.add(f)),j&&i.data("ui-tabs-aria-controls",j),i.attr({"aria-controls":g,"aria-labelledby":h}),f.attr("aria-labelledby",h)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),c&&(this._off(c.not(this.tabs)),this._off(d.not(this.anchors)),this._off(e.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(b){return a("<div>").attr("id",b).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(b){a.isArray(b)&&(b.length?b.length===this.anchors.length&&(b=!0):b=!1);for(var c,d=0;c=this.tabs[d];d++)b===!0||a.inArray(d,b)!==-1?a(c).addClass("ui-state-disabled").attr("aria-disabled","true"):a(c).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=b},_setupEvents:function(b){var c={};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(a){a.preventDefault()}}),this._on(this.anchors,c),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(b){var c,d=this.element.parent();"fill"===b?(c=d.height(),c-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var b=a(this),d=b.css("position");"absolute"!==d&&"fixed"!==d&&(c-=b.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){c-=a(this).outerHeight(!0)}),this.panels.each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")):"auto"===b&&(c=0,this.panels.each(function(){c=Math.max(c,a(this).height("").height())}).height(c))},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget),f=e.closest("li"),g=f[0]===d[0],h=g&&c.collapsible,i=h?a():this._getPanelForTab(f),j=d.length?this._getPanelForTab(d):a(),k={oldTab:d,oldPanel:j,newTab:h?a():f,newPanel:i};b.preventDefault(),f.hasClass("ui-state-disabled")||f.hasClass("ui-tabs-loading")||this.running||g&&!c.collapsible||this._trigger("beforeActivate",b,k)===!1||(c.active=!h&&this.tabs.index(f),this.active=g?a():f,this.xhr&&this.xhr.abort(),j.length||i.length||a.error("jQuery UI Tabs: Mismatching fragment identifier."),i.length&&this.load(this.tabs.index(f),b),this._toggle(b,k))},_toggle:function(b,c){function d(){f.running=!1,f._trigger("activate",b,c)}function e(){c.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),g.length&&f.options.show?f._show(g,f.options.show,d):(g.show(),d())}var f=this,g=c.newPanel,h=c.oldPanel;this.running=!0,h.length&&this.options.hide?this._hide(h,this.options.hide,function(){c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),e()}):(c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),h.hide(),e()),h.attr("aria-hidden","true"),c.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),g.length&&h.length?c.oldTab.attr("tabIndex",-1):g.length&&this.tabs.filter(function(){return 0===a(this).attr("tabIndex")}).attr("tabIndex",-1),g.attr("aria-hidden","false"),c.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(b){var c,d=this._findActive(b);d[0]!==this.active[0]&&(d.length||(d=this.active),c=d.find(".ui-tabs-anchor")[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return b===!1?a():this.tabs.eq(b)},_getIndex:function(a){return"string"==typeof a&&(a=this.anchors.index(this.anchors.filter("[href$='"+a+"']"))),a},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){a.data(this,"ui-tabs-destroy")?a(this).remove():a(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var b=a(this),c=b.data("ui-tabs-aria-controls");c?b.attr("aria-controls",c).removeData("ui-tabs-aria-controls"):b.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(b){var c=this.options.disabled;c!==!1&&(void 0===b?c=!1:(b=this._getIndex(b),c=a.isArray(c)?a.map(c,function(a){return a!==b?a:null}):a.map(this.tabs,function(a,c){return c!==b?c:null})),this._setupDisabled(c))},disable:function(b){var c=this.options.disabled;if(c!==!0){if(void 0===b)c=!0;else{if(b=this._getIndex(b),a.inArray(b,c)!==-1)return;c=a.isArray(c)?a.merge([b],c).sort():[b]}this._setupDisabled(c)}},load:function(b,c){b=this._getIndex(b);var d=this,e=this.tabs.eq(b),f=e.find(".ui-tabs-anchor"),g=this._getPanelForTab(e),h={tab:e,panel:g},i=function(a,b){"abort"===b&&d.panels.stop(!1,!0),e.removeClass("ui-tabs-loading"),g.removeAttr("aria-busy"),a===d.xhr&&delete d.xhr};this._isLocal(f[0])||(this.xhr=a.ajax(this._ajaxSettings(f,c,h)),this.xhr&&"canceled"!==this.xhr.statusText&&(e.addClass("ui-tabs-loading"),g.attr("aria-busy","true"),this.xhr.done(function(a,b,e){setTimeout(function(){g.html(a),d._trigger("load",c,h),i(e,b)},1)}).fail(function(a,b){setTimeout(function(){i(a,b)},1)})))},_ajaxSettings:function(b,c,d){var e=this;return{url:b.attr("href"),beforeSend:function(b,f){return e._trigger("beforeLoad",c,a.extend({
jqXHR:b,ajaxSettings:f},d))}}},_getPanelForTab:function(b){var c=a(b).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+c))}}),a.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var b=a(this).attr("title")||"";return a("<a>").text(b).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(b,c){var d=(b.attr("aria-describedby")||"").split(/\s+/);d.push(c),b.data("ui-tooltip-id",c).attr("aria-describedby",a.trim(d.join(" ")))},_removeDescribedBy:function(b){var c=b.data("ui-tooltip-id"),d=(b.attr("aria-describedby")||"").split(/\s+/),e=a.inArray(c,d);e!==-1&&d.splice(e,1),b.removeData("ui-tooltip-id"),d=a.trim(d.join(" ")),d?b.attr("aria-describedby",d):b.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=a("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(b,c){var d=this;return"disabled"===b?(this[c?"_disable":"_enable"](),void(this.options[b]=c)):(this._super(b,c),void("content"===b&&a.each(this.tooltips,function(a,b){d._updateContent(b.element)})))},_disable:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur");e.target=e.currentTarget=d.element[0],b.close(e,!0)}),this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.is("[title]")&&b.data("ui-tooltip-title",b.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.data("ui-tooltip-title")&&b.attr("title",b.data("ui-tooltip-title"))})},open:function(b){var c=this,d=a(b?b.target:this.element).closest(this.options.items);d.length&&!d.data("ui-tooltip-id")&&(d.attr("title")&&d.data("ui-tooltip-title",d.attr("title")),d.data("ui-tooltip-open",!0),b&&"mouseover"===b.type&&d.parents().each(function(){var b,d=a(this);d.data("ui-tooltip-open")&&(b=a.Event("blur"),b.target=b.currentTarget=this,c.close(b,!0)),d.attr("title")&&(d.uniqueId(),c.parents[this.id]={element:this,title:d.attr("title")},d.attr("title",""))}),this._registerCloseHandlers(b,d),this._updateContent(d,b))},_updateContent:function(a,b){var c,d=this.options.content,e=this,f=b?b.type:null;return"string"==typeof d?this._open(b,a,d):(c=d.call(a[0],function(c){e._delay(function(){a.data("ui-tooltip-open")&&(b&&(b.type=f),this._open(b,a,c))})}),void(c&&this._open(b,a,c)))},_open:function(b,c,d){function e(a){j.of=a,g.is(":hidden")||g.position(j)}var f,g,h,i,j=a.extend({},this.options.position);if(d){if(f=this._find(c))return void f.tooltip.find(".ui-tooltip-content").html(d);c.is("[title]")&&(b&&"mouseover"===b.type?c.attr("title",""):c.removeAttr("title")),f=this._tooltip(c),g=f.tooltip,this._addDescribedBy(c,g.attr("id")),g.find(".ui-tooltip-content").html(d),this.liveRegion.children().hide(),d.clone?(i=d.clone(),i.removeAttr("id").find("[id]").removeAttr("id")):i=d,a("<div>").html(i).appendTo(this.liveRegion),this.options.track&&b&&/^mouse/.test(b.type)?(this._on(this.document,{mousemove:e}),e(b)):g.position(a.extend({of:c},this.options.position)),g.hide(),this._show(g,this.options.show),this.options.show&&this.options.show.delay&&(h=this.delayedShow=setInterval(function(){g.is(":visible")&&(e(j.of),clearInterval(h))},a.fx.interval)),this._trigger("open",b,{tooltip:g})}},_registerCloseHandlers:function(b,c){var d={keyup:function(b){if(b.keyCode===a.ui.keyCode.ESCAPE){var d=a.Event(b);d.currentTarget=c[0],this.close(d,!0)}}};c[0]!==this.element[0]&&(d.remove=function(){this._removeTooltip(this._find(c).tooltip)}),b&&"mouseover"!==b.type||(d.mouseleave="close"),b&&"focusin"!==b.type||(d.focusout="close"),this._on(!0,c,d)},close:function(b){var c,d=this,e=a(b?b.currentTarget:this.element),f=this._find(e);return f?(c=f.tooltip,void(f.closing||(clearInterval(this.delayedShow),e.data("ui-tooltip-title")&&!e.attr("title")&&e.attr("title",e.data("ui-tooltip-title")),this._removeDescribedBy(e),f.hiding=!0,c.stop(!0),this._hide(c,this.options.hide,function(){d._removeTooltip(a(this))}),e.removeData("ui-tooltip-open"),this._off(e,"mouseleave focusout keyup"),e[0]!==this.element[0]&&this._off(e,"remove"),this._off(this.document,"mousemove"),b&&"mouseleave"===b.type&&a.each(this.parents,function(b,c){a(c.element).attr("title",c.title),delete d.parents[b]}),f.closing=!0,this._trigger("close",b,{tooltip:c}),f.hiding||(f.closing=!1)))):void e.removeData("ui-tooltip-open")},_tooltip:function(b){var c=a("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),d=c.uniqueId().attr("id");return a("<div>").addClass("ui-tooltip-content").appendTo(c),c.appendTo(this.document[0].body),this.tooltips[d]={element:b,tooltip:c}},_find:function(a){var b=a.data("ui-tooltip-id");return b?this.tooltips[b]:null},_removeTooltip:function(a){a.remove(),delete this.tooltips[a.attr("id")]},_destroy:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur"),f=d.element;e.target=e.currentTarget=f[0],b.close(e,!0),a("#"+c).remove(),f.data("ui-tooltip-title")&&(f.attr("title")||f.attr("title",f.data("ui-tooltip-title")),f.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})})},{}],1129:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.prependListener=k,n.prependOnceListener=k,n.listeners=function(a){return[]},n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],1130:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],1131:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],1132:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(d<0)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return a<10?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];c<f;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":1131,_process:1129,inherits:1130}],1133:[function(a,b,c){!function(a){var b=function(){var b={years:"datepickerViewYears",moths:"datepickerViewMonths",days:"datepickerViewDays"},c={wrapper:'<div class="datepicker"><div class="datepickerBorderT" /><div class="datepickerBorderB" /><div class="datepickerBorderL" /><div class="datepickerBorderR" /><div class="datepickerBorderTL" /><div class="datepickerBorderTR" /><div class="datepickerBorderBL" /><div class="datepickerBorderBR" /><div class="datepickerContainer"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div></div>',head:["<td>",'<table cellspacing="0" cellpadding="0">',"<thead>","<tr>",'<th class="datepickerGoPrev"><a href="#"><span><%=prev%></span></a></th>','<th colspan="5" class="datepickerMonth"><a href="#"><span></span></a></th>','<th class="datepickerGoNext"><a href="#"><span><%=next%></span></a></th>',"</tr>",'<tr class="datepickerDoW">',"<th><span><%=week%></span></th>","<th><span><%=day1%></span></th>","<th><span><%=day2%></span></th>","<th><span><%=day3%></span></th>","<th><span><%=day4%></span></th>","<th><span><%=day5%></span></th>","<th><span><%=day6%></span></th>","<th><span><%=day7%></span></th>","</tr>","</thead>","</table></td>"],space:'<td class="datepickerSpace"><div></div></td>',days:['<tbody class="datepickerDays">',"<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[0].week%></span></a></th>','<td class="<%=weeks[0].days[0].classname%>"><a href="#"><span><%=weeks[0].days[0].text%></span></a></td>','<td class="<%=weeks[0].days[1].classname%>"><a href="#"><span><%=weeks[0].days[1].text%></span></a></td>','<td class="<%=weeks[0].days[2].classname%>"><a href="#"><span><%=weeks[0].days[2].text%></span></a></td>','<td class="<%=weeks[0].days[3].classname%>"><a href="#"><span><%=weeks[0].days[3].text%></span></a></td>','<td class="<%=weeks[0].days[4].classname%>"><a href="#"><span><%=weeks[0].days[4].text%></span></a></td>','<td class="<%=weeks[0].days[5].classname%>"><a href="#"><span><%=weeks[0].days[5].text%></span></a></td>','<td class="<%=weeks[0].days[6].classname%>"><a href="#"><span><%=weeks[0].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[1].week%></span></a></th>','<td class="<%=weeks[1].days[0].classname%>"><a href="#"><span><%=weeks[1].days[0].text%></span></a></td>','<td class="<%=weeks[1].days[1].classname%>"><a href="#"><span><%=weeks[1].days[1].text%></span></a></td>','<td class="<%=weeks[1].days[2].classname%>"><a href="#"><span><%=weeks[1].days[2].text%></span></a></td>','<td class="<%=weeks[1].days[3].classname%>"><a href="#"><span><%=weeks[1].days[3].text%></span></a></td>','<td class="<%=weeks[1].days[4].classname%>"><a href="#"><span><%=weeks[1].days[4].text%></span></a></td>','<td class="<%=weeks[1].days[5].classname%>"><a href="#"><span><%=weeks[1].days[5].text%></span></a></td>','<td class="<%=weeks[1].days[6].classname%>"><a href="#"><span><%=weeks[1].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[2].week%></span></a></th>','<td class="<%=weeks[2].days[0].classname%>"><a href="#"><span><%=weeks[2].days[0].text%></span></a></td>','<td class="<%=weeks[2].days[1].classname%>"><a href="#"><span><%=weeks[2].days[1].text%></span></a></td>','<td class="<%=weeks[2].days[2].classname%>"><a href="#"><span><%=weeks[2].days[2].text%></span></a></td>','<td class="<%=weeks[2].days[3].classname%>"><a href="#"><span><%=weeks[2].days[3].text%></span></a></td>','<td class="<%=weeks[2].days[4].classname%>"><a href="#"><span><%=weeks[2].days[4].text%></span></a></td>','<td class="<%=weeks[2].days[5].classname%>"><a href="#"><span><%=weeks[2].days[5].text%></span></a></td>','<td class="<%=weeks[2].days[6].classname%>"><a href="#"><span><%=weeks[2].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[3].week%></span></a></th>','<td class="<%=weeks[3].days[0].classname%>"><a href="#"><span><%=weeks[3].days[0].text%></span></a></td>','<td class="<%=weeks[3].days[1].classname%>"><a href="#"><span><%=weeks[3].days[1].text%></span></a></td>','<td class="<%=weeks[3].days[2].classname%>"><a href="#"><span><%=weeks[3].days[2].text%></span></a></td>','<td class="<%=weeks[3].days[3].classname%>"><a href="#"><span><%=weeks[3].days[3].text%></span></a></td>','<td class="<%=weeks[3].days[4].classname%>"><a href="#"><span><%=weeks[3].days[4].text%></span></a></td>','<td class="<%=weeks[3].days[5].classname%>"><a href="#"><span><%=weeks[3].days[5].text%></span></a></td>','<td class="<%=weeks[3].days[6].classname%>"><a href="#"><span><%=weeks[3].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[4].week%></span></a></th>','<td class="<%=weeks[4].days[0].classname%>"><a href="#"><span><%=weeks[4].days[0].text%></span></a></td>','<td class="<%=weeks[4].days[1].classname%>"><a href="#"><span><%=weeks[4].days[1].text%></span></a></td>','<td class="<%=weeks[4].days[2].classname%>"><a href="#"><span><%=weeks[4].days[2].text%></span></a></td>','<td class="<%=weeks[4].days[3].classname%>"><a href="#"><span><%=weeks[4].days[3].text%></span></a></td>','<td class="<%=weeks[4].days[4].classname%>"><a href="#"><span><%=weeks[4].days[4].text%></span></a></td>','<td class="<%=weeks[4].days[5].classname%>"><a href="#"><span><%=weeks[4].days[5].text%></span></a></td>','<td class="<%=weeks[4].days[6].classname%>"><a href="#"><span><%=weeks[4].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[5].week%></span></a></th>','<td class="<%=weeks[5].days[0].classname%>"><a href="#"><span><%=weeks[5].days[0].text%></span></a></td>','<td class="<%=weeks[5].days[1].classname%>"><a href="#"><span><%=weeks[5].days[1].text%></span></a></td>','<td class="<%=weeks[5].days[2].classname%>"><a href="#"><span><%=weeks[5].days[2].text%></span></a></td>','<td class="<%=weeks[5].days[3].classname%>"><a href="#"><span><%=weeks[5].days[3].text%></span></a></td>','<td class="<%=weeks[5].days[4].classname%>"><a href="#"><span><%=weeks[5].days[4].text%></span></a></td>','<td class="<%=weeks[5].days[5].classname%>"><a href="#"><span><%=weeks[5].days[5].text%></span></a></td>','<td class="<%=weeks[5].days[6].classname%>"><a href="#"><span><%=weeks[5].days[6].text%></span></a></td>',"</tr>","</tbody>"],months:['<tbody class="<%=className%>">',"<tr>",'<td colspan="2"><a href="#"><span><%=data[0]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[1]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[2]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[3]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[4]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[5]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[6]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[7]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[8]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[9]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[10]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[11]%></span></a></td>',"</tr>","</tbody>"]},d={flat:!1,starts:1,prev:"&#9664;",next:"&#9654;",lastSel:!1,mode:"single",view:"days",calendars:1,format:"Y-m-d",position:"bottom",eventName:"click",onRender:function(){return{}},onChange:function(){return!0},onShow:function(){return!0},onBeforeShow:function(){return!0},onHide:function(){return!0},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekMin:"wk"}},e=function(b){var d,e,f,h,i,j,k,l,m,n=a(b).data("datepicker"),o=a(b),p=Math.floor(n.calendars/2),q=0;o.find("td>table tbody").remove();for(var r=0;r<n.calendars;r++){switch(d=new Date(n.current),d.addMonths(-p+r),m=o.find("table").eq(r+1),m[0].className){case"datepickerViewDays":f=g(d,"B, Y");break;case"datepickerViewMonths":f=d.getFullYear();break;case"datepickerViewYears":f=d.getFullYear()-6+" - "+(d.getFullYear()+5)}m.find("thead tr:first th:eq(1) span").text(f),f=d.getFullYear()-6,e={data:[],className:"datepickerYears"};for(var s=0;s<12;s++)e.data.push(f+s);l=tmpl(c.months.join(""),e),d.setDate(1),e={weeks:[],test:10},h=d.getMonth();var f=(d.getDay()-n.starts)%7;for(d.addDays(-(f+(f<0?7:0))),i=-1,q=0;q<42;){j=parseInt(q/7,10),k=q%7,e.weeks[j]||(i=d.getWeekNumber(),e.weeks[j]={week:i,days:[]}),e.weeks[j].days[k]={text:d.getDate(),classname:[]},h!=d.getMonth()&&e.weeks[j].days[k].classname.push("datepickerNotInMonth"),0==d.getDay()&&e.weeks[j].days[k].classname.push("datepickerSunday"),6==d.getDay()&&e.weeks[j].days[k].classname.push("datepickerSaturday");var t=n.onRender(d),u=d.valueOf();u===n.date[0]&&e.weeks[j].days[k].classname.push("datepickerSelectedFirst"),u+86399e3===n.date[1]&&e.weeks[j].days[k].classname.push("datepickerSelectedLast"),(t.selected||n.date==u||a.inArray(u,n.date)>-1||"range"==n.mode&&u>=n.date[0]&&u<=n.date[1])&&e.weeks[j].days[k].classname.push("datepickerSelected"),t.disabled&&e.weeks[j].days[k].classname.push("datepickerDisabled"),t.className&&e.weeks[j].days[k].classname.push(t.className),e.weeks[j].days[k].classname=e.weeks[j].days[k].classname.join(" "),q++,d.addDays(1)}l=tmpl(c.days.join(""),e)+l,e={data:n.locale.monthsShort,className:"datepickerMonths"},l=tmpl(c.months.join(""),e)+l,m.append(l)}},f=function(a,b){if(a.constructor==Date)return new Date(a);for(var c,d,e,f,g,h=a.split(/\W+/),i=b.split(/\W+/),j=new Date,k=0;k<h.length;k++)switch(i[k]){case"d":case"e":c=parseInt(h[k],10);break;case"m":d=parseInt(h[k],10)-1;break;case"Y":case"y":e=parseInt(h[k],10),e+=e>100?0:e<29?2e3:1900;break;case"H":case"I":case"k":case"l":f=parseInt(h[k],10);break;case"P":case"p":/pm/i.test(h[k])&&f<12?f+=12:/am/i.test(h[k])&&f>=12&&(f-=12);break;case"M":g=parseInt(h[k],10)}return new Date(void 0===e?j.getFullYear():e,void 0===d?j.getMonth():d,void 0===c?j.getDate():c,void 0===f?j.getHours():f,void 0===g?j.getMinutes():g,0)},g=function(a,b){var c=a.getMonth(),d=a.getDate(),e=a.getFullYear(),f=(a.getWeekNumber(),a.getDay()),g=a.getHours(),h=g>=12,i=h?g-12:g,j=a.getDayOfYear();0==i&&(i=12);for(var k,l=a.getMinutes(),m=a.getSeconds(),n=b.split(""),o=0;o<n.length;o++){switch(k=n[o],n[o]){case"a":k=a.getDayName();break;case"A":k=a.getDayName(!0);break;case"b":k=a.getMonthName();break;case"B":k=a.getMonthName(!0);break;case"C":k=1+Math.floor(e/100);break;case"d":k=d<10?"0"+d:d;break;case"e":k=d;break;case"H":k=g<10?"0"+g:g;break;case"I":k=i<10?"0"+i:i;break;case"j":k=j<100?j<10?"00"+j:"0"+j:j;break;case"k":k=g;break;case"l":k=i;break;case"m":k=c<9?"0"+(1+c):1+c;break;case"M":k=l<10?"0"+l:l;break;case"p":case"P":k=h?"PM":"AM";break;case"s":k=Math.floor(a.getTime()/1e3);break;case"S":k=m<10?"0"+m:m;break;case"u":k=f+1;break;case"w":k=f;break;case"y":k=(""+e).substr(2,2);break;case"Y":k=e}n[o]=k}return n.join("")},h=function(a){Date.prototype.tempDate||(Date.prototype.tempDate=null,Date.prototype.months=a.months,Date.prototype.monthsShort=a.monthsShort,Date.prototype.days=a.days,Date.prototype.daysShort=a.daysShort,Date.prototype.getMonthName=function(a){return this[a?"months":"monthsShort"][this.getMonth()]},Date.prototype.getDayName=function(a){return this[a?"days":"daysShort"][this.getDay()]},Date.prototype.addDays=function(a){this.setDate(this.getDate()+a),this.tempDate=this.getDate()},Date.prototype.addMonths=function(a){null==this.tempDate&&(this.tempDate=this.getDate()),this.setDate(1),this.setMonth(this.getMonth()+a),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.addYears=function(a){null==this.tempDate&&(this.tempDate=this.getDate()),this.setDate(1),this.setFullYear(this.getFullYear()+a),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.getMaxDays=function(){var a,b=new Date(Date.parse(this)),c=28;for(a=b.getMonth(),c=28;b.getMonth()==a;)c++,b.setDate(c);return c-1},Date.prototype.getFirstDay=function(){var a=new Date(Date.parse(this));return a.setDate(1),a.getDay()},Date.prototype.getWeekNumber=function(){var a=new Date(this);a.setDate(a.getDate()-(a.getDay()+6)%7+3);var b=a.valueOf();return a.setMonth(0),a.setDate(4),Math.round((b-a.valueOf())/6048e5)+1},Date.prototype.getDayOfYear=function(){var a=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),b=new Date(this.getFullYear(),0,0,0,0,0),c=a-b;return Math.floor(c/24*60*60*1e3)})},i=function(b){var c=a(b).data("datepicker"),d=a("#"+c.id);if(!c.extraHeight){var e=a(b).find("div");c.extraHeight=e.get(0).offsetHeight+e.get(1).offsetHeight,c.extraWidth=e.get(2).offsetWidth+e.get(3).offsetWidth}var f=d.find("table:first").get(0),g=f.offsetWidth,h=f.offsetHeight;d.css({width:g+c.extraWidth+"px",height:h+c.extraHeight+"px"}).find("div.datepickerContainer").css({width:g+"px",height:h+"px"})},j=function(b){a(b.target).is("span")&&(b.target=b.target.parentNode);var c=a(b.target);if(c.is("a")){if(b.target.blur(),c.hasClass("datepickerDisabled"))return!1;var d=a(this).data("datepicker"),f=c.parent(),g=f.parent().parent().parent(),h=a("table",this).index(g.get(0))-1,i=new Date(d.current),j=!1,l=!1;if(f.is("th"))if(f.hasClass("datepickerWeek")&&"range"==d.mode&&!f.next().hasClass("datepickerDisabled")){var m=parseInt(f.next().text(),10);i.addMonths(h-Math.floor(d.calendars/2)),f.next().hasClass("datepickerNotInMonth")&&i.addMonths(m>15?-1:1),i.setDate(m),d.date[0]=i.setHours(0,0,0,0).valueOf(),i.setHours(23,59,59,0),i.addDays(6),d.date[1]=i.valueOf(),l=!0,j=!0,d.lastSel=!1}else{if(f.hasClass("datepickerMonth"))return!1;if(f.parent().parent().is("thead")){switch(g.get(0).className){case"datepickerViewDays":d.current.addMonths(f.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewMonths":d.current.addYears(f.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewYears":d.current.addYears(f.hasClass("datepickerGoPrev")?-12:12)}l=!0}}else if(f.is("td")&&!f.hasClass("datepickerDisabled")){switch(g.get(0).className){case"datepickerViewMonths":d.current.setMonth(g.find("tbody.datepickerMonths td").index(f)),d.current.setFullYear(parseInt(g.find("thead th.datepickerMonth span").text(),10)),d.current.addMonths(Math.floor(d.calendars/2)-h),g.get(0).className="datepickerViewDays";break;case"datepickerViewYears":d.current.setFullYear(parseInt(c.text(),10)),g.get(0).className="datepickerViewMonths";break;default:var m=parseInt(c.text(),10);switch(i.addMonths(h-Math.floor(d.calendars/2)),f.hasClass("datepickerNotInMonth")&&i.addMonths(m>15?-1:1),i.setDate(m),d.mode){case"multiple":m=i.setHours(0,0,0,0).valueOf(),a.inArray(m,d.date)>-1?a.each(d.date,function(a,b){if(b==m)return d.date.splice(a,1),!1}):d.date.push(m);break;case"range":d.lastSel||(d.date[0]=i.setHours(0,0,0,0).valueOf()),m=i.setHours(23,59,59,0).valueOf(),m<d.date[0]?(d.date[1]=d.date[0]+86399e3,d.date[0]=m-86399e3):d.date[1]=m,d.lastSel=!d.lastSel;break;default:d.date=i.valueOf()}}l=!0,j=!0}l&&e(this),j&&d.onChange.apply(this,k(d))}return!1},k=function(b){var c;return"single"==b.mode?(c=new Date(b.date),[g(c,b.format),c,b.el]):(c=[[],[],b.el],a.each(b.date,function(a,d){var e=new Date(d);c[0].push(g(e,b.format)),c[1].push(e)}),c)},l=function(){var a="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(a?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(a?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(a?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(a?document.documentElement.clientHeight:document.body.clientHeight)}},m=function(a,b,c){if(a==b)return!0;if(a.contains)return a.contains(b);if(a.compareDocumentPosition)return!!(16&a.compareDocumentPosition(b));for(var d=b.parentNode;d&&d!=c;){if(d==a)return!0;d=d.parentNode}return!1},n=function(b){var c=a("#"+a(this).data("datepickerId"));if(!c.is(":visible")){var d=c.get(0);e(d);var f=c.data("datepicker");f.onBeforeShow.apply(this,[c.get(0)]);var g=a(this).offset(),h=l(),j=g.top,k=g.left;a.curCSS(d,"display");switch(c.css({visibility:"hidden",display:"block"}),i(d),f.position){case"top":j-=d.offsetHeight;break;case"left":k-=d.offsetWidth;break;case"right":k+=this.offsetWidth;break;case"bottom":j+=this.offsetHeight}j+d.offsetHeight>h.t+h.h&&(j=g.top-d.offsetHeight),j<h.t&&(j=g.top+this.offsetHeight+d.offsetHeight),k+d.offsetWidth>h.l+h.w&&(k=g.left-d.offsetWidth),k<h.l&&(k=g.left+this.offsetWidth),c.css({visibility:"visible",display:"block",top:j+"px",left:k+"px"}),0!=f.onShow.apply(this,[c.get(0)])&&c.show(),a(document).bind("mousedown",{cal:c,trigger:this},o)}return!1},o=function(b){b.target==b.data.trigger||m(b.data.cal.get(0),b.target,b.data.cal.get(0))||(0!=b.data.cal.data("datepicker").onHide.apply(this,[b.data.cal.get(0)])&&b.data.cal.hide(),a(document).unbind("mousedown",o))};return{init:function(g){return g=a.extend({},d,g||{}),h(g.locale),g.calendars=Math.max(1,parseInt(g.calendars,10)||1),g.mode=/single|multiple|range/.test(g.mode)?g.mode:"single",this.each(function(){if(!a(this).data("datepicker")){if(g.el=this,g.date.constructor==String&&(g.date=f(g.date,g.format),g.date.setHours(0,0,0,0)),"single"!=g.mode)if(g.date.constructor!=Array)g.date=[g.date.valueOf()],"range"==g.mode&&g.date.push(new Date(g.date[0]).setHours(23,59,59,0).valueOf());else{for(var d=0;d<g.date.length;d++)g.date[d]=f(g.date[d],g.format).setHours(0,0,0,0).valueOf();"range"==g.mode&&(g.date[1]=new Date(g.date[1]).setHours(23,59,59,0).valueOf())}else g.date=g.date.valueOf();g.current?g.current=f(g.current,g.format):g.current=new Date,g.current.setDate(1),g.current.setHours(0,0,0,0);var h,k="datepicker_"+parseInt(1e3*Math.random());
g.id=k,a(this).data("datepickerId",g.id);var l=a(c.wrapper).attr("id",k).bind("click",j).data("datepicker",g);g.className&&l.addClass(g.className);for(var m="",d=0;d<g.calendars;d++)h=g.starts,d>0&&(m+=c.space),m+=tmpl(c.head.join(""),{week:g.locale.weekMin,prev:g.prev,next:g.next,day1:g.locale.daysMin[h++%7],day2:g.locale.daysMin[h++%7],day3:g.locale.daysMin[h++%7],day4:g.locale.daysMin[h++%7],day5:g.locale.daysMin[h++%7],day6:g.locale.daysMin[h++%7],day7:g.locale.daysMin[h++%7]});l.find("tr:first").append(m).find("table").addClass(b[g.view]),e(l.get(0)),g.flat?(l.appendTo(this).show().css("position","relative"),i(l.get(0))):(l.appendTo(document.body),a(this).bind(g.eventName,n))}})},showPicker:function(){return this.each(function(){a(this).data("datepickerId")&&n.apply(this)})},hidePicker:function(){return this.each(function(){a(this).data("datepickerId")&&a("#"+a(this).data("datepickerId")).hide()})},setDate:function(b,c){return this.each(function(){if(a(this).data("datepickerId")){var d=a("#"+a(this).data("datepickerId")),g=d.data("datepicker");if(g.date=b,g.date.constructor==String&&(g.date=f(g.date,g.format),g.date.setHours(0,0,0,0)),"single"!=g.mode)if(g.date.constructor!=Array)g.date=[g.date.valueOf()],"range"==g.mode&&g.date.push(new Date(g.date[0]).setHours(23,59,59,0).valueOf());else{for(var h=0;h<g.date.length;h++)g.date[h]=f(g.date[h],g.format).setHours(0,0,0,0).valueOf();"range"==g.mode&&(g.date[1]=new Date(g.date[1]).setHours(23,59,59,0).valueOf())}else g.date=g.date.valueOf();c&&(g.current=new Date("single"!=g.mode?g.date[0]:g.date)),e(d.get(0))}})},getDate:function(b){if(this.size()>0)return k(a("#"+a(this).data("datepickerId")).data("datepicker"))[b?0:1]},clear:function(){return this.each(function(){if(a(this).data("datepickerId")){var b=a("#"+a(this).data("datepickerId")),c=b.data("datepicker");"single"!=c.mode&&(c.date=[],e(b.get(0)))}})},fixLayout:function(){return this.each(function(){if(a(this).data("datepickerId")){var b=a("#"+a(this).data("datepickerId")),c=b.data("datepicker");c.flat&&i(b.get(0))}})}}}();a.fn.extend({DatePicker:b.init,DatePickerHide:b.hidePicker,DatePickerShow:b.showPicker,DatePickerSetDate:b.setDate,DatePickerGetDate:b.getDate,DatePickerClear:b.clear,DatePickerLayout:b.fixLayout})}(jQuery),function(){var a={};this.tmpl=function b(c,d){var e=/\W/.test(c)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):a[c]=a[c]||b(document.getElementById(c).innerHTML);return d?e(d):e}}()},{}],1134:[function(a,b,c){(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a){this.el=a,this.dragleave=b(this.dragleave,this),this.dragenter=b(this.dragenter,this),this.supportsEventConstructors()&&(this.first=!1,this.second=!1,this.el.addEventListener("dragenter",this.dragenter,!1),this.el.addEventListener("dragleave",this.dragleave,!1))}return a.prototype.dragenter=function(a){return this.first?this.second=!0:(this.first=!0,this.el.dispatchEvent(new CustomEvent("dragster:enter",{bubbles:!0,cancelable:!0,detail:{dataTransfer:a.dataTransfer}})))},a.prototype.dragleave=function(a){if(this.second?this.second=!1:this.first&&(this.first=!1),!this.first&&!this.second)return this.el.dispatchEvent(new CustomEvent("dragster:leave",{bubbles:!0,cancelable:!0,detail:{dataTransfer:a.dataTransfer}}))},a.prototype.removeListeners=function(){return this.el.removeEventListener("dragenter",this.dragenter,!1),this.el.removeEventListener("dragleave",this.dragleave,!1)},a.prototype.supportsEventConstructors=function(){try{new CustomEvent("z")}catch(a){return!1}return!0},a.prototype.reset=function(){return this.first=!1,this.second=!1},a}(),window.Dragster=a}).call(this)},{}],1135:[function(a,b,c){(function(){var a,c,d,e,f,g,h,i,j=[].slice,k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};h=function(){},c=function(){function a(){}return a.prototype.addEventListener=a.prototype.on,a.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},this._callbacks[a]||(this._callbacks[a]=[]),this._callbacks[a].push(b),this},a.prototype.emit=function(){var a,b,c,d,e,f;if(d=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],this._callbacks=this._callbacks||{},c=this._callbacks[d])for(e=0,f=c.length;e<f;e++)b=c[e],b.apply(this,a);return this},a.prototype.removeListener=a.prototype.off,a.prototype.removeAllListeners=a.prototype.off,a.prototype.removeEventListener=a.prototype.off,a.prototype.off=function(a,b){var c,d,e,f,g;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(d=this._callbacks[a],!d)return this;if(1===arguments.length)return delete this._callbacks[a],this;for(e=f=0,g=d.length;f<g;e=++f)if(c=d[e],c===b){d.splice(e,1);break}return this},a}(),a=function(a){function b(a,c){var e,f,g;if(this.element=a,this.version=b.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(b.instances.push(this),this.element.dropzone=this,e=null!=(g=b.optionsForElement(this.element))?g:{},this.options=d({},this.defaultOptions,e,null!=c?c:{}),this.options.forceFallback||!b.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(f=this.getExistingFallback())&&f.parentNode&&f.parentNode.removeChild(f),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=b.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=b.getElements(this.options.clickable,"clickable")),this.init()}var d,e;return l(b,a),b.prototype.Emitter=c,b.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],b.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(a,b){return b()},init:function(){return h},forceFallback:!1,fallback:function(){var a,c,d,e,f,g;for(this.element.className=""+this.element.className+" dz-browser-not-supported",g=this.element.getElementsByTagName("div"),e=0,f=g.length;e<f;e++)a=g[e],/(^| )dz-message($| )/.test(a.className)&&(c=a,a.className="dz-message");return c||(c=b.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(c)),d=c.getElementsByTagName("span")[0],d&&(d.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(a){var b,c,d;return b={srcX:0,srcY:0,srcWidth:a.width,srcHeight:a.height},c=a.width/a.height,b.optWidth=this.options.thumbnailWidth,b.optHeight=this.options.thumbnailHeight,null==b.optWidth&&null==b.optHeight?(b.optWidth=b.srcWidth,b.optHeight=b.srcHeight):null==b.optWidth?b.optWidth=c*b.optHeight:null==b.optHeight&&(b.optHeight=1/c*b.optWidth),d=b.optWidth/b.optHeight,a.height<b.optHeight||a.width<b.optWidth?(b.trgHeight=b.srcHeight,b.trgWidth=b.srcWidth):c>d?(b.srcHeight=a.height,b.srcWidth=b.srcHeight*d):(b.srcWidth=a.width,b.srcHeight=b.srcWidth/d),b.srcX=(a.width-b.srcWidth)/2,b.srcY=(a.height-b.srcHeight)/2,b},drop:function(a){return this.element.classList.remove("dz-drag-hover")},dragstart:h,dragend:function(a){return this.element.classList.remove("dz-drag-hover")},dragenter:function(a){return this.element.classList.add("dz-drag-hover")},dragover:function(a){return this.element.classList.add("dz-drag-hover")},dragleave:function(a){return this.element.classList.remove("dz-drag-hover")},paste:h,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(a.previewElement=b.createElement(this.options.previewTemplate.trim()),a.previewTemplate=a.previewElement,this.previewsContainer.appendChild(a.previewElement),l=a.previewElement.querySelectorAll("[data-dz-name]"),f=0,i=l.length;f<i;f++)c=l[f],c.textContent=a.name;for(m=a.previewElement.querySelectorAll("[data-dz-size]"),g=0,j=m.length;g<j;g++)c=m[g],c.innerHTML=this.filesize(a.size);for(this.options.addRemoveLinks&&(a._removeLink=b.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),a.previewElement.appendChild(a._removeLink)),d=function(c){return function(d){return d.preventDefault(),d.stopPropagation(),a.status===b.UPLOADING?b.confirm(c.options.dictCancelUploadConfirmation,function(){return c.removeFile(a)}):c.options.dictRemoveFileConfirmation?b.confirm(c.options.dictRemoveFileConfirmation,function(){return c.removeFile(a)}):c.removeFile(a)}}(this),n=a.previewElement.querySelectorAll("[data-dz-remove]"),o=[],h=0,k=n.length;h<k;h++)e=n[h],o.push(e.addEventListener("click",d));return o}},removedfile:function(a){var b;return a.previewElement&&null!=(b=a.previewElement)&&b.parentNode.removeChild(a.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(a,b){var c,d,e,f;if(a.previewElement){for(a.previewElement.classList.remove("dz-file-preview"),f=a.previewElement.querySelectorAll("[data-dz-thumbnail]"),d=0,e=f.length;d<e;d++)c=f[d],c.alt=a.name,c.src=b;return setTimeout(function(b){return function(){return a.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(a,b){var c,d,e,f,g;if(a.previewElement){for(a.previewElement.classList.add("dz-error"),"String"!=typeof b&&b.error&&(b=b.error),f=a.previewElement.querySelectorAll("[data-dz-errormessage]"),g=[],d=0,e=f.length;d<e;d++)c=f[d],g.push(c.textContent=b);return g}},errormultiple:h,processing:function(a){if(a.previewElement&&(a.previewElement.classList.add("dz-processing"),a._removeLink))return a._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:h,uploadprogress:function(a,b,c){var d,e,f,g,h;if(a.previewElement){for(g=a.previewElement.querySelectorAll("[data-dz-uploadprogress]"),h=[],e=0,f=g.length;e<f;e++)d=g[e],"PROGRESS"===d.nodeName?h.push(d.value=b):h.push(d.style.width=""+b+"%");return h}},totaluploadprogress:h,sending:h,sendingmultiple:h,success:function(a){if(a.previewElement)return a.previewElement.classList.add("dz-success")},successmultiple:h,canceled:function(a){return this.emit("error",a,"Upload canceled.")},canceledmultiple:h,complete:function(a){if(a._removeLink&&(a._removeLink.textContent=this.options.dictRemoveFile),a.previewElement)return a.previewElement.classList.add("dz-complete")},completemultiple:h,maxfilesexceeded:h,maxfilesreached:h,queuecomplete:h,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},d=function(){var a,b,c,d,e,f,g;for(d=arguments[0],c=2<=arguments.length?j.call(arguments,1):[],f=0,g=c.length;f<g;f++){b=c[f];for(a in b)e=b[a],d[a]=e}return d},b.prototype.getAcceptedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],a.accepted&&e.push(a);return e},b.prototype.getRejectedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],a.accepted||e.push(a);return e},b.prototype.getFilesWithStatus=function(a){var b,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;c<d;c++)b=e[c],b.status===a&&f.push(b);return f},b.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(b.QUEUED)},b.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(b.UPLOADING)},b.prototype.getActiveFiles=function(){var a,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;c<d;c++)a=e[c],a.status!==b.UPLOADING&&a.status!==b.QUEUED||f.push(a);return f},b.prototype.init=function(){var a,c,d,e,f,g,h;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(b.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(d=function(a){return function(){return a.hiddenFileInput&&document.body.removeChild(a.hiddenFileInput),a.hiddenFileInput=document.createElement("input"),a.hiddenFileInput.setAttribute("type","file"),(null==a.options.maxFiles||a.options.maxFiles>1)&&a.hiddenFileInput.setAttribute("multiple","multiple"),a.hiddenFileInput.className="dz-hidden-input",null!=a.options.acceptedFiles&&a.hiddenFileInput.setAttribute("accept",a.options.acceptedFiles),null!=a.options.capture&&a.hiddenFileInput.setAttribute("capture",a.options.capture),a.hiddenFileInput.style.visibility="hidden",a.hiddenFileInput.style.position="absolute",a.hiddenFileInput.style.top="0",a.hiddenFileInput.style.left="0",a.hiddenFileInput.style.height="0",a.hiddenFileInput.style.width="0",document.body.appendChild(a.hiddenFileInput),a.hiddenFileInput.addEventListener("change",function(){var b,c,e,f;if(c=a.hiddenFileInput.files,c.length)for(e=0,f=c.length;e<f;e++)b=c[e],a.addFile(b);return d()})}}(this))(),this.URL=null!=(g=window.URL)?g:window.webkitURL,h=this.events,e=0,f=h.length;e<f;e++)a=h[e],this.on(a,this.options[a]);return this.on("uploadprogress",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("canceled",function(a){return function(b){return a.emit("complete",b)}}(this)),this.on("complete",function(a){return function(b){if(0===a.getUploadingFiles().length&&0===a.getQueuedFiles().length)return setTimeout(function(){return a.emit("queuecomplete")},0)}}(this)),c=function(a){return a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(a){return function(b){return a.emit("dragstart",b)}}(this),dragenter:function(a){return function(b){return c(b),a.emit("dragenter",b)}}(this),dragover:function(a){return function(b){var d;try{d=b.dataTransfer.effectAllowed}catch(a){}return b.dataTransfer.dropEffect="move"===d||"linkMove"===d?"move":"copy",c(b),a.emit("dragover",b)}}(this),dragleave:function(a){return function(b){return a.emit("dragleave",b)}}(this),drop:function(a){return function(b){return c(b),a.drop(b)}}(this),dragend:function(a){return function(b){return a.emit("dragend",b)}}(this)}}],this.clickableElements.forEach(function(a){return function(c){return a.listeners.push({element:c,events:{click:function(d){if(c!==a.element||d.target===a.element||b.elementInside(d.target,a.element.querySelector(".dz-message")))return a.hiddenFileInput.click()}}})}}(this)),this.enable(),this.options.init.call(this)},b.prototype.destroy=function(){var a;return this.disable(),this.removeAllFiles(!0),(null!=(a=this.hiddenFileInput)?a.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,b.instances.splice(b.instances.indexOf(this),1)},b.prototype.updateTotalUploadProgress=function(){var a,b,c,d,e,f,g,h;if(d=0,c=0,a=this.getActiveFiles(),a.length){for(h=this.getActiveFiles(),f=0,g=h.length;f<g;f++)b=h[f],d+=b.upload.bytesSent,c+=b.upload.total;e=100*d/c}else e=100;return this.emit("totaluploadprogress",e,c,d)},b.prototype._getParamName=function(a){return"function"==typeof this.options.paramName?this.options.paramName(a):""+this.options.paramName+(this.options.uploadMultiple?"["+a+"]":"")},b.prototype.getFallbackForm=function(){var a,c,d,e;return(a=this.getExistingFallback())?a:(d='<div class="dz-fallback">',this.options.dictFallbackText&&(d+="<p>"+this.options.dictFallbackText+"</p>"),d+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',c=b.createElement(d),"FORM"!==this.element.tagName?(e=b.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),e.appendChild(c)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=e?e:c)},b.prototype.getExistingFallback=function(){var a,b,c,d,e,f;for(b=function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)if(b=a[c],/(^| )fallback($| )/.test(b.className))return b},f=["div","form"],d=0,e=f.length;d<e;d++)if(c=f[d],a=b(this.element.getElementsByTagName(c)))return a},b.prototype.setupEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;d<e;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.addEventListener(b,c,!1));return e}());return g},b.prototype.removeEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;d<e;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.removeEventListener(b,c,!1));return e}());return g},b.prototype.disable=function(){var a,b,c,d,e;for(this.clickableElements.forEach(function(a){return a.classList.remove("dz-clickable")}),this.removeEventListeners(),d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(this.cancelUpload(a));return e},b.prototype.enable=function(){return this.clickableElements.forEach(function(a){return a.classList.add("dz-clickable")}),this.setupEventListeners()},b.prototype.filesize=function(a){var b,c,d,e,f,g,h,i;for(g=["TB","GB","MB","KB","b"],d=e=null,c=h=0,i=g.length;h<i;c=++h)if(f=g[c],b=Math.pow(this.options.filesizeBase,4-c)/10,a>=b){d=a/Math.pow(this.options.filesizeBase,4-c),e=f;break}return d=Math.round(10*d)/10,"<strong>"+d+"</strong> "+e},b.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},b.prototype.drop=function(a){var b,c;a.dataTransfer&&(this.emit("drop",a),b=a.dataTransfer.files,b.length&&(c=a.dataTransfer.items,c&&c.length&&null!=c[0].webkitGetAsEntry?this._addFilesFromItems(c):this.handleFiles(b)))},b.prototype.paste=function(a){var b,c;if(null!=(null!=a&&null!=(c=a.clipboardData)?c.items:void 0))return this.emit("paste",a),b=a.clipboardData.items,b.length?this._addFilesFromItems(b):void 0},b.prototype.handleFiles=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;c<d;c++)b=a[c],e.push(this.addFile(b));return e},b.prototype._addFilesFromItems=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;d<e;d++)c=a[d],null!=c.webkitGetAsEntry&&(b=c.webkitGetAsEntry())?b.isFile?f.push(this.addFile(c.getAsFile())):b.isDirectory?f.push(this._addFilesFromDirectory(b,b.name)):f.push(void 0):null!=c.getAsFile&&(null==c.kind||"file"===c.kind)?f.push(this.addFile(c.getAsFile())):f.push(void 0);return f},b.prototype._addFilesFromDirectory=function(a,b){var c,d;return c=a.createReader(),d=function(a){return function(c){var d,e,f;for(e=0,f=c.length;e<f;e++)d=c[e],d.isFile?d.file(function(c){if(!a.options.ignoreHiddenFiles||"."!==c.name.substring(0,1))return c.fullPath=""+b+"/"+c.name,a.addFile(c)}):d.isDirectory&&a._addFilesFromDirectory(d,""+b+"/"+d.name)}}(this),c.readEntries(d,function(a){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(a):void 0})},b.prototype.accept=function(a,c){return a.size>1024*this.options.maxFilesize*1024?c(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(a.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):b.isValidFile(a,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(c(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",a)):this.options.accept.call(this,a,c):c(this.options.dictInvalidFileType)},b.prototype.addFile=function(a){return a.upload={progress:0,total:a.size,bytesSent:0},this.files.push(a),a.status=b.ADDED,this.emit("addedfile",a),this._enqueueThumbnail(a),this.accept(a,function(b){return function(c){return c?(a.accepted=!1,b._errorProcessing([a],c)):(a.accepted=!0,b.options.autoQueue&&b.enqueueFile(a)),b._updateMaxFilesReachedClass()}}(this))},b.prototype.enqueueFiles=function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)b=a[c],this.enqueueFile(b);return null},b.prototype.enqueueFile=function(a){if(a.status!==b.ADDED||a.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(a.status=b.QUEUED,this.options.autoProcessQueue)return setTimeout(function(a){return function(){return a.processQueue()}}(this),0)},b.prototype._thumbnailQueue=[],b.prototype._processingThumbnail=!1,b.prototype._enqueueThumbnail=function(a){if(this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(a),setTimeout(function(a){return function(){return a._processThumbnailQueue()}}(this),0)},b.prototype._processThumbnailQueue=function(){if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(a){return function(){return a._processingThumbnail=!1,a._processThumbnailQueue()}}(this))},b.prototype.removeFile=function(a){if(a.status===b.UPLOADING&&this.cancelUpload(a),this.files=i(this.files,a),this.emit("removedfile",a),0===this.files.length)return this.emit("reset")},b.prototype.removeAllFiles=function(a){var c,d,e,f;for(null==a&&(a=!1),f=this.files.slice(),d=0,e=f.length;d<e;d++)c=f[d],(c.status!==b.UPLOADING||a)&&this.removeFile(c);return null},b.prototype.createThumbnail=function(a,b){var c;return c=new FileReader,c.onload=function(d){return function(){return"image/svg+xml"===a.type?(d.emit("thumbnail",a,c.result),void(null!=b&&b())):d.createThumbnailFromUrl(a,c.result,b)}}(this),c.readAsDataURL(a)},b.prototype.createThumbnailFromUrl=function(a,b,c){var d;return d=document.createElement("img"),d.onload=function(b){return function(){var e,f,h,i,j,k,l,m;if(a.width=d.width,a.height=d.height,h=b.options.resize.call(b,a),null==h.trgWidth&&(h.trgWidth=h.optWidth),null==h.trgHeight&&(h.trgHeight=h.optHeight),e=document.createElement("canvas"),f=e.getContext("2d"),e.width=h.trgWidth,e.height=h.trgHeight,g(f,d,null!=(j=h.srcX)?j:0,null!=(k=h.srcY)?k:0,h.srcWidth,h.srcHeight,null!=(l=h.trgX)?l:0,null!=(m=h.trgY)?m:0,h.trgWidth,h.trgHeight),i=e.toDataURL("image/png"),b.emit("thumbnail",a,i),null!=c)return c()}}(this),null!=c&&(d.onerror=c),d.src=b},b.prototype.processQueue=function(){var a,b,c,d;if(b=this.options.parallelUploads,c=this.getUploadingFiles().length,a=c,!(c>=b)&&(d=this.getQueuedFiles(),d.length>0)){if(this.options.uploadMultiple)return this.processFiles(d.slice(0,b-c));for(;a<b;){if(!d.length)return;this.processFile(d.shift()),a++}}},b.prototype.processFile=function(a){return this.processFiles([a])},b.prototype.processFiles=function(a){var c,d,e;for(d=0,e=a.length;d<e;d++)c=a[d],c.processing=!0,c.status=b.UPLOADING,this.emit("processing",c);return this.options.uploadMultiple&&this.emit("processingmultiple",a),this.uploadFiles(a)},b.prototype._getFilesWithXhr=function(a){var b,c;return c=function(){var c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;c<d;c++)b=e[c],b.xhr===a&&f.push(b);return f}.call(this)},b.prototype.cancelUpload=function(a){var c,d,e,f,g,h,i;if(a.status===b.UPLOADING){for(d=this._getFilesWithXhr(a.xhr),e=0,g=d.length;e<g;e++)c=d[e],c.status=b.CANCELED;for(a.xhr.abort(),f=0,h=d.length;f<h;f++)c=d[f],this.emit("canceled",c);this.options.uploadMultiple&&this.emit("canceledmultiple",d)}else(i=a.status)!==b.ADDED&&i!==b.QUEUED||(a.status=b.CANCELED,this.emit("canceled",a),this.options.uploadMultiple&&this.emit("canceledmultiple",[a]));if(this.options.autoProcessQueue)return this.processQueue()},e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],"function"==typeof b?b.apply(this,a):b},b.prototype.uploadFile=function(a){return this.uploadFiles([a])},b.prototype.uploadFiles=function(a){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;for(w=new XMLHttpRequest,x=0,B=a.length;x<B;x++)c=a[x],c.xhr=w;p=e(this.options.method,a),u=e(this.options.url,a),w.open(p,u,!0),w.withCredentials=!!this.options.withCredentials,s=null,g=function(b){return function(){var d,e,f;for(f=[],d=0,e=a.length;d<e;d++)c=a[d],f.push(b._errorProcessing(a,s||b.options.dictResponseError.replace("{{statusCode}}",w.status),w));return f}}(this),t=function(b){return function(d){var e,f,g,h,i,j,k,l,m;if(null!=d)for(f=100*d.loaded/d.total,g=0,j=a.length;g<j;g++)c=a[g],c.upload={progress:f,total:d.total,bytesSent:d.loaded};else{for(e=!0,f=100,h=0,k=a.length;h<k;h++)c=a[h],100===c.upload.progress&&c.upload.bytesSent===c.upload.total||(e=!1),c.upload.progress=f,c.upload.bytesSent=c.upload.total;if(e)return}for(m=[],i=0,l=a.length;i<l;i++)c=a[i],m.push(b.emit("uploadprogress",c,f,c.upload.bytesSent));return m}}(this),w.onload=function(c){return function(d){var e;if(a[0].status!==b.CANCELED&&4===w.readyState){if(s=w.responseText,w.getResponseHeader("content-type")&&~w.getResponseHeader("content-type").indexOf("application/json"))try{s=JSON.parse(s)}catch(a){d=a,s="Invalid JSON response from server."}return t(),200<=(e=w.status)&&e<300?c._finished(a,s,d):g()}}}(this),w.onerror=function(c){return function(){if(a[0].status!==b.CANCELED)return g()}}(this),r=null!=(G=w.upload)?G:w,r.onprogress=t,j={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&d(j,this.options.headers);for(h in j)i=j[h],w.setRequestHeader(h,i);if(f=new FormData,this.options.params){H=this.options.params;for(o in H)v=H[o],f.append(o,v)}for(y=0,C=a.length;y<C;y++)c=a[y],this.emit("sending",c,w,f);if(this.options.uploadMultiple&&this.emit("sendingmultiple",a,w,f),"FORM"===this.element.tagName)for(I=this.element.querySelectorAll("input, textarea, select, button"),z=0,D=I.length;z<D;z++)if(l=I[z],m=l.getAttribute("name"),n=l.getAttribute("type"),"SELECT"===l.tagName&&l.hasAttribute("multiple"))for(J=l.options,A=0,E=J.length;A<E;A++)q=J[A],q.selected&&f.append(m,q.value);else(!n||"checkbox"!==(K=n.toLowerCase())&&"radio"!==K||l.checked)&&f.append(m,l.value);for(k=F=0,L=a.length-1;0<=L?F<=L:F>=L;k=0<=L?++F:--F)f.append(this._getParamName(k),a[k],a[k].name);return w.send(f)},b.prototype._finished=function(a,c,d){var e,f,g;for(f=0,g=a.length;f<g;f++)e=a[f],e.status=b.SUCCESS,this.emit("success",e,c,d),
this.emit("complete",e);if(this.options.uploadMultiple&&(this.emit("successmultiple",a,c,d),this.emit("completemultiple",a)),this.options.autoProcessQueue)return this.processQueue()},b.prototype._errorProcessing=function(a,c,d){var e,f,g;for(f=0,g=a.length;f<g;f++)e=a[f],e.status=b.ERROR,this.emit("error",e,c,d),this.emit("complete",e);if(this.options.uploadMultiple&&(this.emit("errormultiple",a,c,d),this.emit("completemultiple",a)),this.options.autoProcessQueue)return this.processQueue()},b}(c),a.version="4.0.1",a.options={},a.optionsForElement=function(b){return b.getAttribute("id")?a.options[d(b.getAttribute("id"))]:void 0},a.instances=[],a.forElement=function(a){if("string"==typeof a&&(a=document.querySelector(a)),null==(null!=a?a.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return a.dropzone},a.autoDiscover=!0,a.discover=function(){var b,c,d,e,f,g;for(document.querySelectorAll?d=document.querySelectorAll(".dropzone"):(d=[],b=function(a){var b,c,e,f;for(f=[],c=0,e=a.length;c<e;c++)b=a[c],/(^| )dropzone($| )/.test(b.className)?f.push(d.push(b)):f.push(void 0);return f},b(document.getElementsByTagName("div")),b(document.getElementsByTagName("form"))),g=[],e=0,f=d.length;e<f;e++)c=d[e],a.optionsForElement(c)!==!1?g.push(new a(c)):g.push(void 0);return g},a.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],a.isBrowserSupported=function(){var b,c,d,e,f;if(b=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(f=a.blacklistedBrowsers,d=0,e=f.length;d<e;d++)c=f[d],c.test(navigator.userAgent)&&(b=!1);else b=!1;else b=!1;return b},i=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;d<e;d++)c=a[d],c!==b&&f.push(c);return f},d=function(a){return a.replace(/[\-_](\w)/g,function(a){return a.charAt(1).toUpperCase()})},a.createElement=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.childNodes[0]},a.elementInside=function(a,b){if(a===b)return!0;for(;a=a.parentNode;)if(a===b)return!0;return!1},a.getElement=function(a,b){var c;if("string"==typeof a?c=document.querySelector(a):null!=a.nodeType&&(c=a),null==c)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector or a plain HTML element.");return c},a.getElements=function(a,b){var c,d,e,f,g,h,i,j;if(a instanceof Array){e=[];try{for(f=0,h=a.length;f<h;f++)d=a[f],e.push(this.getElement(d,b))}catch(a){c=a,e=null}}else if("string"==typeof a)for(e=[],j=document.querySelectorAll(a),g=0,i=j.length;g<i;g++)d=j[g],e.push(d);else null!=a.nodeType&&(e=[a]);if(null==e||!e.length)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return e},a.confirm=function(a,b,c){return window.confirm(a)?b():null!=c?c():void 0},a.isValidFile=function(a,b){var c,d,e,f,g;if(!b)return!0;for(b=b.split(","),d=a.type,c=d.replace(/\/.*$/,""),f=0,g=b.length;f<g;f++)if(e=b[f],e=e.trim(),"."===e.charAt(0)){if(a.name.toLowerCase().indexOf(e.toLowerCase(),a.name.length-e.length)!==-1)return!0}else if(/\/\*$/.test(e)){if(c===e.replace(/\/.*$/,""))return!0}else if(d===e)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(b){return this.each(function(){return new a(this,b)})}),"undefined"!=typeof b&&null!==b?b.exports=a:window.Dropzone=a,a.ADDED="added",a.QUEUED="queued",a.ACCEPTED=a.QUEUED,a.UPLOADING="uploading",a.PROCESSING=a.UPLOADING,a.CANCELED="canceled",a.ERROR="error",a.SUCCESS="success",f=function(a){var b,c,d,e,f,g,h,i,j,k;for(h=a.naturalWidth,g=a.naturalHeight,c=document.createElement("canvas"),c.width=1,c.height=g,d=c.getContext("2d"),d.drawImage(a,0,0),e=d.getImageData(0,0,1,g).data,k=0,f=g,i=g;i>k;)b=e[4*(i-1)+3],0===b?f=i:k=i,i=f+k>>1;return j=i/g,0===j?1:j},g=function(a,b,c,d,e,g,h,i,j,k){var l;return l=f(b),a.drawImage(b,c,d,e,g,h,i,j,k/l)},e=function(a,b){var c,d,e,f,g,h,i,j,k;if(e=!1,k=!0,d=a.document,j=d.documentElement,c=d.addEventListener?"addEventListener":"attachEvent",i=d.addEventListener?"removeEventListener":"detachEvent",h=d.addEventListener?"":"on",f=function(c){if("readystatechange"!==c.type||"complete"===d.readyState)return("load"===c.type?a:d)[i](h+c.type,f,!1),!e&&(e=!0)?b.call(a,c.type||c):void 0},g=function(){var a;try{j.doScroll("left")}catch(b){return a=b,void setTimeout(g,50)}return f("poll")},"complete"!==d.readyState){if(d.createEventObject&&j.doScroll){try{k=!a.frameElement}catch(a){}k&&g()}return d[c](h+"DOMContentLoaded",f,!1),d[c](h+"readystatechange",f,!1),a[c](h+"load",f,!1)}},a._autoDiscoverFunction=function(){if(a.autoDiscover)return a.discover()},e(window,a._autoDiscoverFunction)}).call(this)},{}],1136:[function(a,b,c){!function(a){function b(a,b){return"function"==typeof a?a.call(b):a}function c(a){for(;a=a.parentNode;)if(a==document)return!0;return!1}function d(b,c){this.$element=a(b),this.options=c,this.enabled=!0,this.fixTitle()}var e=6;d.prototype={show:function(){var c=this.getTitle();if(c&&this.enabled){var d=this.tip();d.find(".tipsy-inner")[this.options.html?"html":"text"](c),d[0].className="tipsy",d.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body),this.options.className&&d.addClass(b(this.options.className,this.$element[0]));var f,g=a.extend({},this.$element.offset(),{width:this.$element[0].getBoundingClientRect().width,height:this.$element[0].getBoundingClientRect().height}),h=d[0].offsetWidth,i=d[0].offsetHeight,j=b(this.options.gravity,this.$element[0]);switch(j.charAt(0)){case"n":f={top:g.top+g.height+this.options.offset,left:g.left+g.width/2-h/2},mo={top:parseInt(g.top+g.height+this.options.offset+e),opacity:this.options.opacity};break;case"s":f={top:g.top-i-this.options.offset,left:g.left+g.width/2-h/2},mo={top:parseInt(g.top-i-this.options.offset-e),opacity:this.options.opacity};break;case"e":f={top:g.top+g.height/2-i/2,left:g.left-h-this.options.offset},mo={left:parseInt(g.left-h-this.options.offset-e),opacity:this.options.opacity};break;case"w":f={top:g.top+g.height/2-i/2,left:g.left+g.width+this.options.offset},mo={left:parseInt(g.left+g.width+this.options.offset+e),opacity:this.options.opacity}}2==j.length&&("w"==j.charAt(1)?f.left=g.left+g.width/2-15:f.left=g.left+g.width/2-h+15),d.css(f).addClass("tipsy-"+j),d.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+j.charAt(0),this.options.fade?d.stop().css({opacity:0,display:"block",visibility:"visible"}).animate(mo,200):d.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){switch(gravity=b(this.options.gravity,this.$element[0]),gravity.charAt(0)){case"n":mo={top:parseInt(this.tip().css("top"))+e,opacity:0};break;case"s":mo={top:parseInt(this.tip().css("top"))-e,opacity:0};break;case"e":mo={left:parseInt(this.tip().css("left"))-e,opacity:0};break;case"w":mo={left:parseInt(this.tip().css("left"))+e,opacity:0}}this.options.fade?this.tip().stop().animate(mo,200,function(){a(this).remove()}):this.tip().remove()},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("original-title"))&&a.attr("original-title",a.attr("title")||"").removeAttr("title")},getTitle:function(){var a,b=this.$element,c=this.options;this.fixTitle();var a,c=this.options;return"string"==typeof c.title?a=b.attr("title"==c.title?"original-title":c.title):"function"==typeof c.title&&(a=c.title.call(b[0])),a=(""+a).replace(/(^\s*|\s*$)/,""),a||c.fallback},tip:function(){return this.$tip||(this.$tip=a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},remove:function(){this.enabled=!1,this.$tip&&this.$tip.remove()},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},a.fn.tipsy=function(b){function c(c){var e=a.data(c,"tipsy");return e||(e=new d(c,a.fn.tipsy.elementOptions(c,b)),a.data(c,"tipsy",e)),e}function e(){var a=c(this);a.hoverState="in",0==b.delayIn?a.show():(a.fixTitle(),setTimeout(function(){"in"==a.hoverState&&a.show()},b.delayIn))}function f(){var a=c(this);a.hoverState="out",0==b.delayOut?a.hide():setTimeout(function(){"out"==a.hoverState&&a.hide()},b.delayOut)}if(b===!0)return this.data("tipsy");if("string"==typeof b){var g=this.data("tipsy");return g&&g[b](),this}if(b=a.extend({},a.fn.tipsy.defaults,b),b.live||this.each(function(){c(this)}),"manual"!=b.trigger){var h=b.live?"live":"bind",i="hover"==b.trigger?"mouseenter":"focus",j="hover"==b.trigger?"mouseleave":"blur";this[h](i,e)[h](j,f)}return this},a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},a.fn.tipsy.revalidate=function(){a(".tipsy").each(function(){var b=a.data(this,"tipsy-pointee");b&&c(b)||a(this).remove()})},a.fn.tipsy.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c},a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"},a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"},a.fn.tipsy.autoBounds=function(b,c){return function(){var d={ns:c[0],ew:c.length>1&&c[1]},e=a(document).scrollTop()+b,f=a(document).scrollLeft()+b,g=a(this);return g.offset().top<e&&(d.ns="n"),g.offset().left<f&&(d.ew="w"),a(window).width()+a(document).scrollLeft()-g.offset().left<b&&(d.ew="e"),a(window).height()+a(document).scrollTop()-g.offset().top<b&&(d.ns="s"),d.ns+(d.ew?d.ew:"")}}}(jQuery)},{}],1137:[function(b,c,d){!function(c){function d(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function e(){var a=b("util");return"Markdown.mk_block( "+a.inspect(this.toString())+", "+a.inspect(this.trailing)+", "+a.inspect(this.lineNumber)+" )"}function f(a){for(var b=0,c=-1;(c=a.indexOf("\n",c+1))!==-1;)b++;return b}function g(a,b){function c(a){this.len_after=a,this.name="close_"+b}var d=a+"_state",e="strong"==a?"em_state":"strong_state";return function(f,g){if(this[d][0]==b)return this[d].shift(),[f.length,new c(f.length-b.length)];var h=this[e].slice(),i=this[d].slice();this[d].unshift(b);var j=this.processInline(f.substr(b.length)),k=j[j.length-1];this[d].shift();if(k instanceof c){j.pop();var l=f.length-k.len_after;return[l,[a].concat(j)]}return this[e]=h,this[d]=i,[b.length,b]}}function h(a){for(var b=a.split(""),c=[""],d=!1;b.length;){var e=b.shift();switch(e){case" ":d?c[c.length-1]+=e:c.push("");break;case"'":case'"':d=!d;break;case"\\":e=b.shift();default:c[c.length-1]+=e}}return c}function i(a){return r(a)&&a.length>1&&"object"==typeof a[1]&&!r(a[1])?a[1]:void 0}function j(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function k(a){if("string"==typeof a)return j(a);var b=a.shift(),c={},d=[];for(!a.length||"object"!=typeof a[0]||a[0]instanceof Array||(c=a.shift());a.length;)d.push(k(a.shift()));var e="";for(var f in c)e+=" "+f+'="'+j(c[f])+'"';return"img"==b||"br"==b||"hr"==b?"<"+b+e+"/>":"<"+b+e+">"+d.join("")+"</"+b+">"}function l(a,b,c){var d;c=c||{};var e=a.slice(0);"function"==typeof c.preprocessTreeNode&&(e=c.preprocessTreeNode(e,b));var f=i(e);if(f){e[1]={};for(d in f)e[1][d]=f[d];f=e[1]}if("string"==typeof e)return e;switch(e[0]){case"header":e[0]="h"+e[1].level,delete e[1].level;break;case"bulletlist":e[0]="ul";break;case"numberlist":e[0]="ol";break;case"listitem":e[0]="li";break;case"para":e[0]="p";break;case"markdown":e[0]="html",f&&delete f.references;break;case"code_block":e[0]="pre",d=f?2:1;var g=["code"];g.push.apply(g,e.splice(d,e.length-d)),e[d]=g;break;case"inlinecode":e[0]="code";break;case"img":e[1].src=e[1].href,delete e[1].href;break;case"linebreak":e[0]="br";break;case"link":e[0]="a";break;case"link_ref":e[0]="a";var h=b[f.ref];if(!h)return f.original;delete f.ref,f.href=h.href,h.title&&(f.title=h.title),delete f.original;break;case"img_ref":e[0]="img";var h=b[f.ref];if(!h)return f.original;delete f.ref,f.src=h.href,h.title&&(f.title=h.title),delete f.original}if(d=1,f){for(var j in e[1]){d=2;break}1===d&&e.splice(d,1)}for(;d<e.length;++d)e[d]=l(e[d],b,c);return e}function m(a){for(var b=i(a)?2:1;b<a.length;)"string"==typeof a[b]?b+1<a.length&&"string"==typeof a[b+1]?a[b]+=a.splice(b+1,1)[0]:++b:(m(a[b]),++b)}var n=c.Markdown=function(a){switch(typeof a){case"undefined":this.dialect=n.dialects.Gruber;break;case"object":this.dialect=a;break;default:if(!(a in n.dialects))throw new Error("Unknown Markdown dialect '"+String(a)+"'");this.dialect=n.dialects[a]}this.em_state=[],this.strong_state=[],this.debug_indent=""};c.parse=function(a,b){var c=new n(b);return c.toTree(a)},c.toHTML=function(a,b,d){var e=c.toHTMLTree(a,b,d);return c.renderJsonML(e)},c.toHTMLTree=function(a,b,c){"string"==typeof a&&(a=this.parse(a,b));var d=i(a),e={};d&&d.references&&(e=d.references);var f=l(a,e,c);return m(f),f};var o=n.mk_block=function(a,b,c){1==arguments.length&&(b="\n\n");var f=new String(a);return f.trailing=b,f.inspect=e,f.toSource=d,void 0!=c&&(f.lineNumber=c),f};n.prototype.split_blocks=function(a,b){a=a.replace(/(\r\n|\n|\r)/g,"\n");var c,d=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,e=[],g=1;for(null!=(c=/^(\s*\n)/.exec(a))&&(g+=f(c[0]),d.lastIndex=c[0].length);null!==(c=d.exec(a));)"\n#"==c[2]&&(c[2]="\n",d.lastIndex--),e.push(o(c[1],c[2],g)),g+=f(c[0]);return e},n.prototype.processBlock=function(a,b){var c=this.dialect.block,d=c.__order__;if("__call__"in c)return c.__call__.call(this,a,b);for(var e=0;e<d.length;e++){var f=c[d[e]].call(this,a,b);if(f)return(!r(f)||f.length>0&&!r(f[0]))&&this.debug(d[e],"didn't return a proper array"),f}return[]},n.prototype.processInline=function(a){return this.dialect.inline.__call__.call(this,String(a))},n.prototype.toTree=function(a,b){var c=a instanceof Array?a:this.split_blocks(a),d=this.tree;try{for(this.tree=b||this.tree||["markdown"];c.length;){var e=this.processBlock(c.shift(),c);e.length&&this.tree.push.apply(this.tree,e)}return this.tree}finally{b&&(this.tree=d)}},n.prototype.debug=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,a),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,a)},n.prototype.loop_re_over_block=function(a,b,c){for(var d,e=b.valueOf();e.length&&null!=(d=a.exec(e));)e=e.substr(d[0].length),c.call(this,d);return e},n.dialects={},n.dialects.Gruber={block:{atxHeader:function(a,b){var c=a.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(c){var d=["header",{level:c[1].length}];return Array.prototype.push.apply(d,this.processInline(c[2])),c[0].length<a.length&&b.unshift(o(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},setextHeader:function(a,b){var c=a.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(c){var d="="===c[2]?1:2,e=["header",{level:d},c[1]];return c[0].length<a.length&&b.unshift(o(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[e]}},code:function(a,b){var c=[],d=/^(?: {0,3}\t| {4})(.*)\n?/;if(a.match(d)){a:for(;;){var e=this.loop_re_over_block(d,a.valueOf(),function(a){c.push(a[1])});if(e.length){b.unshift(o(e,a.trailing));break a}if(!b.length)break a;if(!b[0].match(d))break a;c.push(a.trailing.replace(/[^\n]/g,"").substring(2)),a=b.shift()}return[["code_block",c.join("\n")]]}},horizRule:function(a,b){var c=a.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(c){var d=[["hr"]];return c[1]&&d.unshift.apply(d,this.processBlock(c[1],[])),c[3]&&b.unshift(o(c[3])),d}},lists:function(){function a(a){return new RegExp("(?:^("+i+"{0,"+a+"} {0,3})("+f+")\\s+)|(^"+i+"{0,"+(a-1)+"}[ ]{0,4})")}function b(a){return a.replace(/ {0,3}\t/g,"    ")}function c(a,b,c,d){if(b)return void a.push(["para"].concat(c));var e=a[a.length-1]instanceof Array&&"para"==a[a.length-1][0]?a[a.length-1]:a;d&&a.length>1&&c.unshift(d);for(var f=0;f<c.length;f++){var g=c[f],h="string"==typeof g;h&&e.length>1&&"string"==typeof e[e.length-1]?e[e.length-1]+=g:e.push(g)}}function d(a,b){for(var c=new RegExp("^("+i+"{"+a+"}.*?\\n?)*$"),d=new RegExp("^"+i+"{"+a+"}","gm"),e=[];b.length>0&&c.exec(b[0]);){var f=b.shift(),g=f.replace(d,"");e.push(o(g,f.trailing,f.lineNumber))}return e}function e(a,b,c){var d=a.list,e=d[d.length-1];if(!(e[1]instanceof Array&&"para"==e[1][0]))if(b+1==c.length)e.push(["para"].concat(e.splice(1,e.length-1)));else{var f=e.pop();e.push(["para"].concat(e.splice(1,e.length-1)),f)}}var f="[*+-]|\\d+\\.",g=/[*+-]/,h=new RegExp("^( {0,3})("+f+")[ \t]+"),i="(?: {0,3}\\t| {4})";return function(f,i){function j(a){var b=g.exec(a[2])?["bulletlist"]:["numberlist"];return n.push({list:b,indent:a[1]}),b}var k=f.match(h);if(k){for(var l,m,n=[],o=j(k),p=!1,r=[n[0].list];;){for(var s=f.split(/(?=\n)/),t="",u=0;u<s.length;u++){var v="",w=s[u].replace(/^\n/,function(a){return v=a,""}),x=a(n.length);if(k=w.match(x),void 0!==k[1]){t.length&&(c(l,p,this.processInline(t),v),p=!1,t=""),k[1]=b(k[1]);var y=Math.floor(k[1].length/4)+1;if(y>n.length)o=j(k),l.push(o),l=o[1]=["listitem"];else{var z=!1;for(m=0;m<n.length;m++)if(n[m].indent==k[1]){o=n[m].list,n.splice(m+1,n.length-(m+1)),z=!0;break}z||(y++,y<=n.length?(n.splice(y,n.length-y),o=n[y-1].list):(o=j(k),l.push(o))),l=["listitem"],o.push(l)}v=""}w.length>k[0].length&&(t+=v+w.substr(k[0].length))}t.length&&(c(l,p,this.processInline(t),v),p=!1,t="");var A=d(n.length,i);A.length>0&&(q(n,e,this),l.push.apply(l,this.toTree(A,[])));var B=i[0]&&i[0].valueOf()||"";if(!B.match(h)&&!B.match(/^ /))break;f=i.shift();var C=this.dialect.block.horizRule(f,i);if(C){r.push.apply(r,C);break}q(n,e,this),p=!0}return r}}}(),blockquote:function(a,b){if(a.match(/^>/m)){var c=[];if(">"!=a[0]){for(var d=a.split(/\n/),e=[],f=a.lineNumber;d.length&&">"!=d[0][0];)e.push(d.shift()),f++;var g=o(e.join("\n"),"\n",a.lineNumber);c.push.apply(c,this.processBlock(g,[])),a=o(d.join("\n"),a.trailing,f)}for(;b.length&&">"==b[0][0];){var h=b.shift();a=o(a+a.trailing+h,h.trailing,a.lineNumber)}var j=a.replace(/^> ?/gm,""),k=(this.tree,this.toTree(j,["blockquote"])),l=i(k);return l&&l.references&&(delete l.references,s(l)&&k.splice(1,1)),c.push(k),c}},referenceDefn:function(a,b){var c=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(a.match(c)){i(this.tree)||this.tree.splice(1,0,{});var d=i(this.tree);void 0===d.references&&(d.references={});var e=this.loop_re_over_block(c,a,function(a){a[2]&&"<"==a[2][0]&&">"==a[2][a[2].length-1]&&(a[2]=a[2].substring(1,a[2].length-1));var b=d.references[a[1].toLowerCase()]={href:a[2]};void 0!==a[4]?b.title=a[4]:void 0!==a[5]&&(b.title=a[5])});return e.length&&b.unshift(o(e,a.trailing)),[]}},para:function(a,b){return[["para"].concat(this.processInline(a))]}}},n.dialects.Gruber.inline={__oneElement__:function(a,b,c){var d,e;b=b||this.dialect.inline.__patterns__;var f=new RegExp("([\\s\\S]*?)("+(b.source||b)+")");if(d=f.exec(a),!d)return[a.length,a];if(d[1])return[d[1].length,d[1]];var e;return d[2]in this.dialect.inline&&(e=this.dialect.inline[d[2]].call(this,a.substr(d.index),d,c||[])),e=e||[d[2].length,d[2]]},__call__:function(a,b){function c(a){"string"==typeof a&&"string"==typeof e[e.length-1]?e[e.length-1]+=a:e.push(a)}for(var d,e=[];a.length>0;)d=this.dialect.inline.__oneElement__.call(this,a,b,e),a=a.substr(d.shift()),q(d,c);return e},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(a){return this.dialect.inline.__escape__.exec(a)?[2,a.charAt(1)]:[1,"\\"]},"![":function(a){var b=a.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(b){b[2]&&"<"==b[2][0]&&">"==b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1)),b[2]=this.dialect.inline.__call__.call(this,b[2],/\\/)[0];var c={alt:b[1],href:b[2]||""};return void 0!==b[4]&&(c.title=b[4]),[b[0].length,["img",c]]}return b=a.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),b?[b[0].length,["img_ref",{alt:b[1],ref:b[2].toLowerCase(),original:b[0]}]]:[2,"!["]},"[":function a(b){var c=String(b),d=n.DialectHelpers.inline_until_char.call(this,b.substr(1),"]");if(!d)return[1,"["];var a,e,f=1+d[0],g=d[1];b=b.substr(f);var h=b.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(h){var i=h[1];if(f+=h[0].length,i&&"<"==i[0]&&">"==i[i.length-1]&&(i=i.substring(1,i.length-1)),!h[3])for(var j=1,k=0;k<i.length;k++)switch(i[k]){case"(":j++;break;case")":0==--j&&(f-=i.length-k,i=i.substring(0,k))}return i=this.dialect.inline.__call__.call(this,i,/\\/)[0],e={href:i||""},void 0!==h[3]&&(e.title=h[3]),a=["link",e].concat(g),[f,a]}return h=b.match(/^\s*\[(.*?)\]/),h?(f+=h[0].length,e={ref:(h[1]||String(g)).toLowerCase(),original:c.substr(0,f)},a=["link_ref",e].concat(g),[f,a]):1==g.length&&"string"==typeof g[0]?(e={ref:g[0].toLowerCase(),original:c.substr(0,f)},a=["link_ref",e,g[0]],[f,a]):[1,"["]},"<":function(a){var b;return null!=(b=a.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?b[3]?[b[0].length,["link",{href:"mailto:"+b[3]},b[3]]]:"mailto"==b[2]?[b[0].length,["link",{href:b[1]},b[1].substr("mailto:".length)]]:[b[0].length,["link",{href:b[1]},b[1]]]:[1,"<"]},"`":function(a){var b=a.match(/(`+)(([\s\S]*?)\1)/);return b&&b[2]?[b[1].length+b[2].length,["inlinecode",b[3]]]:[1,"`"]},"  \n":function(a){return[3,["linebreak"]]}},n.dialects.Gruber.inline["**"]=g("strong","**"),n.dialects.Gruber.inline.__=g("strong","__"),n.dialects.Gruber.inline["*"]=g("em","*"),n.dialects.Gruber.inline._=g("em","_"),n.buildBlockOrder=function(a){var b=[];for(var c in a)"__order__"!=c&&"__call__"!=c&&b.push(c);a.__order__=b},n.buildInlinePatterns=function(a){var b=[];for(var c in a)if(!c.match(/^__.*__$/)){var d=c.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");b.push(1==c.length?d:"(?:"+d+")")}b=b.join("|"),a.__patterns__=b;var e=a.__call__;a.__call__=function(a,c){return void 0!=c?e.call(this,a,c):e.call(this,a,b)}},n.DialectHelpers={},n.DialectHelpers.inline_until_char=function(a,b){for(var c=0,d=[];;){if(a.charAt(c)==b)return c++,[c,d];if(c>=a.length)return null;var e=this.dialect.inline.__oneElement__.call(this,a.substr(c));c+=e[0],d.push.apply(d,e.slice(1))}},n.subclassDialect=function(a){function b(){}function c(){}return b.prototype=a.block,c.prototype=a.inline,{block:new b,inline:new c}},n.buildBlockOrder(n.dialects.Gruber.block),n.buildInlinePatterns(n.dialects.Gruber.inline),n.dialects.Maruku=n.subclassDialect(n.dialects.Gruber),n.dialects.Maruku.processMetaHash=function(a){for(var b=h(a),c={},d=0;d<b.length;++d)if(/^#/.test(b[d]))c.id=b[d].substring(1);else if(/^\./.test(b[d]))c.class?c.class=c.class+b[d].replace(/./," "):c.class=b[d].substring(1);else if(/\=/.test(b[d])){var e=b[d].split(/\=/);c[e[0]]=e[1]}return c},n.dialects.Maruku.block.document_meta=function(a,b){if(!(a.lineNumber>1)&&a.match(/^(?:\w+:.*\n)*\w+:.*$/)){i(this.tree)||this.tree.splice(1,0,{});var c=a.split(/\n/);for(p in c){var d=c[p].match(/(\w+):\s*(.*)$/),e=d[1].toLowerCase(),f=d[2];this.tree[1][e]=f}return[]}},n.dialects.Maruku.block.block_meta=function(b,c){var d=b.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(d){var e,f=this.dialect.processMetaHash(d[2]);if(""===d[1]){var g=this.tree[this.tree.length-1];if(e=i(g),"string"==typeof g)return;e||(e={},g.splice(1,0,e));for(a in f)e[a]=f[a];return[]}var h=b.replace(/\n.*$/,""),j=this.processBlock(h,[]);e=i(j[0]),e||(e={},j[0].splice(1,0,e));for(a in f)e[a]=f[a];return j}},n.dialects.Maruku.block.definition_list=function(a,b){var c,d,e=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,f=["dl"];if(d=a.match(e)){for(var g=[a];b.length&&e.exec(b[0]);)g.push(b.shift());for(var h=0;h<g.length;++h){var d=g[h].match(e),i=d[1].replace(/\n$/,"").split(/\n/),j=d[2].split(/\n:\s+/);for(c=0;c<i.length;++c)f.push(["dt",i[c]]);for(c=0;c<j.length;++c)f.push(["dd"].concat(this.processInline(j[c].replace(/(\n)\s+/,"$1"))))}return[f]}},n.dialects.Maruku.block.table=function a(b,c){var d,e,f=function(a,b){b=b||"\\s",b.match(/^[\\|\[\]{}?*.+^$]$/)&&(b="\\"+b);for(var c,d=[],e=new RegExp("^((?:\\\\.|[^\\\\"+b+"])*)"+b+"(.*)");c=a.match(e);)d.push(c[1]),a=c[2];return d.push(a),d},g=/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,h=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;if(e=b.match(g))e[3]=e[3].replace(/^\s*\|/gm,"");else if(!(e=b.match(h)))return;var a=["table",["thead",["tr"]],["tbody"]];e[2]=e[2].replace(/\|\s*$/,"").split("|");var i=[];for(q(e[2],function(a){a.match(/^\s*-+:\s*$/)?i.push({align:"right"}):a.match(/^\s*:-+\s*$/)?i.push({align:"left"}):a.match(/^\s*:-+:\s*$/)?i.push({align:"center"}):i.push({})}),e[1]=f(e[1].replace(/\|\s*$/,""),"|"),d=0;d<e[1].length;d++)a[1][1].push(["th",i[d]||{}].concat(this.processInline(e[1][d].trim())));return q(e[3].replace(/\|\s*$/gm,"").split("\n"),function(b){var c=["tr"];for(b=f(b,"|"),d=0;d<b.length;d++)c.push(["td",i[d]||{}].concat(this.processInline(b[d].trim())));a[2].push(c)},this),[a]},n.dialects.Maruku.inline["{:"]=function(a,b,c){if(!c.length)return[2,"{:"];var d=c[c.length-1];if("string"==typeof d)return[2,"{:"];var e=a.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!e)return[2,"{:"];var f=this.dialect.processMetaHash(e[1]),g=i(d);g||(g={},d.splice(1,0,g));for(var h in f)g[h]=f[h];return[e[0].length,""]},n.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,n.buildBlockOrder(n.dialects.Maruku.block),n.buildInlinePatterns(n.dialects.Maruku.inline);var q,r=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)};q=Array.prototype.forEach?function(a,b,c){return a.forEach(b,c)}:function(a,b,c){for(var d=0;d<a.length;d++)b.call(c||a,a[d],d,a)};var s=function(a){for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0};c.renderJsonML=function(a,b){b=b||{},b.root=b.root||!1;var c=[];if(b.root)c.push(k(a));else for(a.shift(),!a.length||"object"!=typeof a[0]||a[0]instanceof Array||a.shift();a.length;)c.push(k(a.shift()));return c.join("\n\n")}}(function(){return"undefined"==typeof d?(window.markdown={},window.markdown):d}())},{util:1132}],1138:[function(a,b,c){!function(a){a.widget("ui.tagit",{options:{allowDuplicates:!1,caseSensitive:!0,fieldName:"tags",placeholderText:null,readOnly:!1,removeConfirmation:!1,tagLimit:null,availableTags:[],autocomplete:{},showAutocompleteOnFocus:!1,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,animate:!0,tabIndex:null,beforeTagAdded:null,afterTagAdded:null,beforeTagRemoved:null,afterTagRemoved:null,onTagClicked:null,onTagLimitExceeded:null,onTagAdded:null,onTagRemoved:null,tagSource:null,onSubmitTags:null,onFocus:null,onBlur:null},_create:function(){var b=this;this.element.is("input")?(this.tagList=a("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.addClass("tagit-hidden-field")):this.tagList=this.element.find("ul, ol").andSelf().last(),this.tagInput=a('<input type="text" />').addClass("ui-widget-content"),this.options.readOnly&&this.tagInput.attr("disabled","disabled"),this.options.tabIndex&&this.tagInput.attr("tabindex",this.options.tabIndex),this.options.placeholderText&&this.tagInput.attr("placeholder",this.options.placeholderText),this.options.autocomplete.source||(this.options.autocomplete.source=function(b,c){var d=b.term.toLowerCase(),e=a.grep(this.options.availableTags,function(a){return 0===a.toLowerCase().indexOf(d)});this.options.allowDuplicates||(e=this._subtractArray(e,this.assignedTags())),c(e)}),this.options.showAutocompleteOnFocus&&(this.tagInput.focus(function(a,c){b._showAutocomplete()}),"undefined"==typeof this.options.autocomplete.minLength&&(this.options.autocomplete.minLength=0)),a.isFunction(this.options.autocomplete.source)&&(this.options.autocomplete.source=a.proxy(this.options.autocomplete.source,this)),a.isFunction(this.options.tagSource)&&(this.options.tagSource=a.proxy(this.options.tagSource,this)),this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(a('<li class="tagit-new"></li>').append(this.tagInput)).click(function(c){var d=a(c.target);if(d.hasClass("tagit-label")){var e=d.closest(".tagit-choice");e.hasClass("removed")||b._trigger("onTagClicked",c,{tag:e,tagLabel:b.tagLabel(e)})}else b.tagInput.focus()});var c=!1;if(this.options.singleField)if(this.options.singleFieldNode){var d=a(this.options.singleFieldNode),e=d.val().split(this.options.singleFieldDelimiter);d.val(""),a.each(e,function(a,d){b.createTag(d,null,!0),c=!0})}else this.options.singleFieldNode=a('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />'),this.tagList.after(this.options.singleFieldNode);if(c||this.tagList.children("li").each(function(){a(this).hasClass("tagit-new")||(b.createTag(a(this).text(),a(this).attr("class"),!0),a(this).remove())}),this.tagInput.keydown(function(c){if(c.which==a.ui.keyCode.BACKSPACE&&""===b.tagInput.val()){var d=b._lastTag();!b.options.removeConfirmation||d.hasClass("remove")?b.removeTag(d):b.options.removeConfirmation&&d.addClass("remove ui-state-highlight")}else b.options.removeConfirmation?b._lastTag().removeClass("remove ui-state-highlight"):c.which==a.ui.keyCode.ENTER&&""===b.tagInput.val()&&b._trigger("onSubmitTags",null,b.tagList);(c.which===a.ui.keyCode.COMMA&&c.shiftKey===!1||c.which===a.ui.keyCode.ENTER||c.which==a.ui.keyCode.TAB&&""!==b.tagInput.val()||c.which==a.ui.keyCode.SPACE&&b.options.allowSpaces!==!0&&('"'!=a.trim(b.tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==a.trim(b.tagInput.val()).charAt(0)&&'"'==a.trim(b.tagInput.val()).charAt(a.trim(b.tagInput.val()).length-1)&&a.trim(b.tagInput.val()).length-1!==0))&&(c.which===a.ui.keyCode.ENTER&&""===b.tagInput.val()||c.preventDefault(),b.options.autocomplete.autoFocus&&b.tagInput.data("autocomplete-open")||(b.tagInput.autocomplete("close"),b.createTag(b._cleanedInput())))}).blur(function(a){b._trigger("onBlur",null,null),b.tagInput.data("autocomplete-open")||b.createTag(b._cleanedInput())}).focus(function(a){b._trigger("onFocus",null,null)}),this.options.availableTags||this.options.tagSource||this.options.autocomplete.source){var f={select:function(a,c){return b.createTag(c.item.value),!1}};a.extend(f,this.options.autocomplete),f.source=this.options.tagSource||f.source,this.tagInput.autocomplete(f).bind("autocompleteopen.tagit",function(a,c){b.tagInput.data("autocomplete-open",!0)}).bind("autocompleteclose.tagit",function(a,c){b.tagInput.data("autocomplete-open",!1)}),this.tagInput.autocomplete("widget").addClass("tagit-autocomplete")}},destroy:function(){return a.Widget.prototype.destroy.call(this),this.element.unbind(".tagit"),this.tagList.unbind(".tagit"),this.tagInput.removeData("autocomplete-open"),this.tagList.removeClass(["tagit","ui-widget","ui-widget-content","ui-corner-all","tagit-hidden-field"].join(" ")),this.element.is("input")?(this.element.removeClass("tagit-hidden-field"),this.tagList.remove()):(this.element.children("li").each(function(){a(this).hasClass("tagit-new")?a(this).remove():(a(this).removeClass(["tagit-choice","ui-widget-content","ui-state-default","ui-state-highlight","ui-corner-all","remove","tagit-choice-editable","tagit-choice-read-only"].join(" ")),a(this).text(a(this).children(".tagit-label").text()))}),this.singleFieldNode&&this.singleFieldNode.remove()),this},_cleanedInput:function(){return a.trim(this.tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.find(".tagit-choice:last:not(.removed)")},_tags:function(){return this.tagList.find(".tagit-choice:not(.removed)")},assignedTags:function(){var b=this,c=[];return this.options.singleField?(c=a(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),
""===c[0]&&(c=[])):this._tags().each(function(){c.push(b.tagLabel(this))}),c},_updateSingleTagsField:function(b){a(this.options.singleFieldNode).val(b.join(this.options.singleFieldDelimiter)).trigger("change")},_subtractArray:function(b,c){for(var d=[],e=0;e<b.length;e++)a.inArray(b[e],c)==-1&&d.push(b[e]);return d},tagLabel:function(b){return this.options.singleField?a(b).find(".tagit-label:first").text():a(b).find("input:first").val()},_showAutocomplete:function(){this.tagInput.autocomplete("search","")},_findTagByLabel:function(b){var c=this,d=null;return this._tags().each(function(e){if(c._formatStr(b)==c._formatStr(c.tagLabel(this)))return d=a(this),!1}),d},_isNew:function(a){return!this._findTagByLabel(a)},_formatStr:function(b){return this.options.caseSensitive?b:a.trim(b.toLowerCase())},_effectExists:function(b){return Boolean(a.effects&&(a.effects[b]||a.effects.effect&&a.effects.effect[b]))},createTag:function(b,c,d){var e=this;if(b=a.trim(b),this.options.preprocessTag&&(b=this.options.preprocessTag(b)),""===b)return!1;if(!this.options.allowDuplicates&&!this._isNew(b)){var f=this._findTagByLabel(b);return this._trigger("onTagExists",null,{existingTag:f,duringInitialization:d})!==!1&&this._effectExists("highlight")&&f.effect("highlight"),!1}if(this.options.tagLimit&&this._tags().length>=this.options.tagLimit)return this._trigger("onTagLimitExceeded",null,{duringInitialization:d}),!1;var g=a(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(b),h=a("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(c).append(g);if(this.options.readOnly)h.addClass("tagit-choice-read-only");else{h.addClass("tagit-choice-editable");var i=a("<span></span>").addClass("ui-icon ui-icon-close"),j=a('<a><span class="text-icon">×</span></a>').addClass("tagit-close").append(i).click(function(a){e.removeTag(h)});h.append(j)}if(!this.options.singleField){var k=g.html();h.append('<input type="hidden" value="'+k+'" name="'+this.options.fieldName+'" class="tagit-hidden-field" />')}if(this._trigger("beforeTagAdded",null,{tag:h,tagLabel:this.tagLabel(h),duringInitialization:d})!==!1){if(this.options.singleField){var l=this.assignedTags();l.push(b),this._updateSingleTagsField(l)}this._trigger("onTagAdded",null,h),this.tagInput.val(""),this.tagInput.parent().before(h),this._trigger("afterTagAdded",null,{tag:h,tagLabel:this.tagLabel(h),duringInitialization:d}),this.options.showAutocompleteOnFocus&&!d&&setTimeout(function(){e._showAutocomplete()},0)}},removeTag:function(b,c){if(c="undefined"==typeof c?this.options.animate:c,b=a(b),this._trigger("onTagRemoved",null,b),this._trigger("beforeTagRemoved",null,{tag:b,tagLabel:this.tagLabel(b)})!==!1){if(this.options.singleField){var d=this.assignedTags(),e=this.tagLabel(b);d=a.grep(d,function(a){return a!=e}),this._updateSingleTagsField(d)}if(c){b.addClass("removed");var f=this._effectExists("blind")?["blind",{direction:"horizontal"},"fast"]:["fast"],g=this;f.push(function(){b.remove(),g._trigger("afterTagRemoved",null,{tag:b,tagLabel:g.tagLabel(b)})}),b.fadeOut("fast").hide.apply(b,f).dequeue()}else b.remove(),this._trigger("afterTagRemoved",null,{tag:b,tagLabel:this.tagLabel(b)})}},removeTagByLabel:function(a,b){var c=this._findTagByLabel(a);if(!c)throw"No such tag exists with the name '"+a+"'";this.removeTag(c,b)},removeAll:function(){var a=this;this._tags().each(function(b,c){a.removeTag(c,!1)})}})}(jQuery)},{}]},{},[690]);
//# sourceMappingURL=editor3.js.map