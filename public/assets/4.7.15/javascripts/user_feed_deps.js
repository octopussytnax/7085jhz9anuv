/*! v4.7.15 - 2017-05-30 */
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.moment=b()}(this,function(){"use strict";function a(){return Ac.apply(null,arguments)}function b(a){Ac=a}function c(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}function e(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function f(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function g(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function h(a,b){for(var c in b)g(b,c)&&(a[c]=b[c]);return g(b,"toString")&&(a.toString=b.toString),g(b,"valueOf")&&(a.valueOf=b.valueOf),a}function i(a,b,c,d){return ya(a,b,c,d,!0).utc()}function j(a){return null==a._isValid&&(a._isValid=!isNaN(a._d.getTime())&&a._pf.overflow<0&&!a._pf.empty&&!a._pf.invalidMonth&&!a._pf.nullInput&&!a._pf.invalidFormat&&!a._pf.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===a._pf.charsLeftOver&&0===a._pf.unusedTokens.length&&void 0===a._pf.bigHour)),a._isValid}function k(a){var b=i(NaN);return null!=a?h(b._pf,a):b._pf.userInvalidated=!0,b}function l(a,b){var c,d,e;if("undefined"!=typeof b._isAMomentObject&&(a._isAMomentObject=b._isAMomentObject),"undefined"!=typeof b._i&&(a._i=b._i),"undefined"!=typeof b._f&&(a._f=b._f),"undefined"!=typeof b._l&&(a._l=b._l),"undefined"!=typeof b._strict&&(a._strict=b._strict),"undefined"!=typeof b._tzm&&(a._tzm=b._tzm),"undefined"!=typeof b._isUTC&&(a._isUTC=b._isUTC),"undefined"!=typeof b._offset&&(a._offset=b._offset),"undefined"!=typeof b._pf&&(a._pf=b._pf),"undefined"!=typeof b._locale&&(a._locale=b._locale),Cc.length>0)for(c in Cc)d=Cc[c],e=b[d],"undefined"!=typeof e&&(a[d]=e);return a}function m(b){l(this,b),this._d=new Date(+b._d),Dc===!1&&(Dc=!0,a.updateOffset(this),Dc=!1)}function n(a){return a instanceof m||null!=a&&g(a,"_isAMomentObject")}function o(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function p(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;d<e;d++)(c&&a[d]!==b[d]||!c&&o(a[d])!==o(b[d]))&&g++;return g+f}function q(){}function r(a){return a?a.toLowerCase().replace("_","-"):a}function s(a){for(var b,c,d,e,f=0;f<a.length;){for(e=r(a[f]).split("-"),b=e.length,c=r(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=t(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&p(e,c,!0)>=b-1)break;b--}f++}return null}function t(a){var b=null;if(!Ec[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=Bc._abbr,require("./locale/"+a),u(b)}catch(a){}return Ec[a]}function u(a,b){var c;return a&&(c="undefined"==typeof b?w(a):v(a,b),c&&(Bc=c)),Bc._abbr}function v(a,b){return null!==b?(b.abbr=a,Ec[a]||(Ec[a]=new q),Ec[a].set(b),u(a),Ec[a]):(delete Ec[a],null)}function w(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Bc;if(!d(a)){if(b=t(a))return b;a=[a]}return s(a)}function x(a,b){var c=a.toLowerCase();Fc[c]=Fc[c+"s"]=Fc[b]=a}function y(a){return"string"==typeof a?Fc[a]||Fc[a.toLowerCase()]:void 0}function z(a){var b,c,d={};for(c in a)g(a,c)&&(b=y(c),b&&(d[b]=a[c]));return d}function A(b,c){return function(d){return null!=d?(C(this,b,d),a.updateOffset(this,c),this):B(this,b)}}function B(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function C(a,b,c){return a._d["set"+(a._isUTC?"UTC":"")+b](c)}function D(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else if(a=y(a),"function"==typeof this[a])return this[a](b);return this}function E(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function F(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Jc[a]=e),b&&(Jc[b[0]]=function(){return E(e.apply(this,arguments),b[1],b[2])}),c&&(Jc[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function G(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function H(a){var b,c,d=a.match(Gc);for(b=0,c=d.length;b<c;b++)Jc[d[b]]?d[b]=Jc[d[b]]:d[b]=G(d[b]);return function(e){var f="";for(b=0;b<c;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function I(a,b){return a.isValid()?(b=J(b,a.localeData()),Ic[b]||(Ic[b]=H(b)),Ic[b](a)):a.localeData().invalidDate()}function J(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Hc.lastIndex=0;d>=0&&Hc.test(a);)a=a.replace(Hc,c),Hc.lastIndex=0,d-=1;return a}function K(a,b,c){Yc[a]="function"==typeof b?b:function(a){return a&&c?c:b}}function L(a,b){return g(Yc,a)?Yc[a](b._strict,b._locale):new RegExp(M(a))}function M(a){return a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function N(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),"number"==typeof b&&(d=function(a,c){c[b]=o(a)}),c=0;c<a.length;c++)Zc[a[c]]=d}function O(a,b){N(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function P(a,b,c){null!=b&&g(Zc,a)&&Zc[a](b,c._a,c,a)}function Q(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function R(a){return this._months[a.month()]}function S(a){return this._monthsShort[a.month()]}function T(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;d<12;d++){if(e=i([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function U(a,b){var c;return"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),Q(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function V(b){return null!=b?(U(this,b),a.updateOffset(this,!0),this):B(this,"Month")}function W(){return Q(this.year(),this.month())}function X(a){var b,c=a._a;return c&&a._pf.overflow===-2&&(b=c[_c]<0||c[_c]>11?_c:c[ad]<1||c[ad]>Q(c[$c],c[_c])?ad:c[bd]<0||c[bd]>24||24===c[bd]&&(0!==c[cd]||0!==c[dd]||0!==c[ed])?bd:c[cd]<0||c[cd]>59?cd:c[dd]<0||c[dd]>59?dd:c[ed]<0||c[ed]>999?ed:-1,a._pf._overflowDayOfYear&&(b<$c||b>ad)&&(b=ad),a._pf.overflow=b),a}function Y(b){a.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function Z(a,b){var c=!0;return h(function(){return c&&(Y(a),c=!1),b.apply(this,arguments)},b)}function $(a,b){hd[a]||(Y(b),hd[a]=!0)}function _(a){var b,c,d=a._i,e=id.exec(d);if(e){for(a._pf.iso=!0,b=0,c=jd.length;b<c;b++)if(jd[b][1].exec(d)){a._f=jd[b][0]+(e[6]||" ");break}for(b=0,c=kd.length;b<c;b++)if(kd[b][1].exec(d)){a._f+=kd[b][0];break}d.match(Vc)&&(a._f+="Z"),sa(a)}else a._isValid=!1}function aa(b){var c=ld.exec(b._i);return null!==c?void(b._d=new Date(+c[1])):(_(b),void(b._isValid===!1&&(delete b._isValid,a.createFromInputFallback(b))))}function ba(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return a<1970&&h.setFullYear(a),h}function ca(a){var b=new Date(Date.UTC.apply(null,arguments));return a<1970&&b.setUTCFullYear(a),b}function da(a){return ea(a)?366:365}function ea(a){return a%4===0&&a%100!==0||a%400===0}function fa(){return ea(this.year())}function ga(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),f<e-7&&(f+=7),d=za(a).add(f,"d"),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function ha(a){return ga(a,this._week.dow,this._week.doy).week}function ia(){return this._week.dow}function ja(){return this._week.doy}function ka(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function la(a){var b=ga(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function ma(a,b,c,d,e){var f,g,h=ca(a,0,1).getUTCDay();return h=0===h?7:h,c=null!=c?c:e,f=e-h+(h>d?7:0)-(h<e?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:da(a-1)+g}}function na(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function oa(a,b,c){return null!=a?a:null!=b?b:c}function pa(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function qa(a){var b,c,d,e,f=[];if(!a._d){for(d=pa(a),a._w&&null==a._a[ad]&&null==a._a[_c]&&ra(a),a._dayOfYear&&(e=oa(a._a[$c],d[$c]),a._dayOfYear>da(e)&&(a._pf._overflowDayOfYear=!0),c=ca(e,0,a._dayOfYear),a._a[_c]=c.getUTCMonth(),a._a[ad]=c.getUTCDate()),b=0;b<3&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;b<7;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[bd]&&0===a._a[cd]&&0===a._a[dd]&&0===a._a[ed]&&(a._nextDay=!0,a._a[bd]=0),a._d=(a._useUTC?ca:ba).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[bd]=24)}}function ra(a){var b,c,d,e,f,g,h;b=a._w,null!=b.GG||null!=b.W||null!=b.E?(f=1,g=4,c=oa(b.GG,a._a[$c],ga(za(),1,4).year),d=oa(b.W,1),e=oa(b.E,1)):(f=a._locale._week.dow,g=a._locale._week.doy,c=oa(b.gg,a._a[$c],ga(za(),f,g).year),d=oa(b.w,1),null!=b.d?(e=b.d,e<f&&++d):e=null!=b.e?b.e+f:f),h=ma(c,d,e,g,f),a._a[$c]=h.year,a._dayOfYear=h.dayOfYear}function sa(b){if(b._f===a.ISO_8601)return void _(b);b._a=[],b._pf.empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,j=0;for(e=J(b._f,b._locale).match(Gc)||[],c=0;c<e.length;c++)f=e[c],d=(h.match(L(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&b._pf.unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),j+=d.length),Jc[f]?(d?b._pf.empty=!1:b._pf.unusedTokens.push(f),P(f,d,b)):b._strict&&!d&&b._pf.unusedTokens.push(f);b._pf.charsLeftOver=i-j,h.length>0&&b._pf.unusedInput.push(h),b._pf.bigHour===!0&&b._a[bd]<=12&&(b._pf.bigHour=void 0),b._a[bd]=ta(b._locale,b._a[bd],b._meridiem),qa(b),X(b)}function ta(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&b<12&&(b+=12),d||12!==b||(b=0),b):b}function ua(a){var b,d,e,f,g;if(0===a._f.length)return a._pf.invalidFormat=!0,void(a._d=new Date(NaN));for(f=0;f<a._f.length;f++)g=0,b=l({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._pf=c(),b._f=a._f[f],sa(b),j(b)&&(g+=b._pf.charsLeftOver,g+=10*b._pf.unusedTokens.length,b._pf.score=g,(null==e||g<e)&&(e=g,d=b));h(a,d||b)}function va(a){if(!a._d){var b=z(a._i);a._a=[b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],qa(a)}}function wa(a){var b,c=a._i,e=a._f;return a._locale=a._locale||w(a._l),null===c||void 0===e&&""===c?k({nullInput:!0}):("string"==typeof c&&(a._i=c=a._locale.preparse(c)),n(c)?new m(X(c)):(d(e)?ua(a):e?sa(a):xa(a),b=new m(X(a)),b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b))}function xa(b){var c=b._i;void 0===c?b._d=new Date:e(c)?b._d=new Date(+c):"string"==typeof c?aa(b):d(c)?(b._a=f(c.slice(0),function(a){return parseInt(a,10)}),qa(b)):"object"==typeof c?va(b):"number"==typeof c?b._d=new Date(c):a.createFromInputFallback(b)}function ya(a,b,d,e,f){var g={};return"boolean"==typeof d&&(e=d,d=void 0),g._isAMomentObject=!0,g._useUTC=g._isUTC=f,g._l=d,g._i=a,g._f=b,g._strict=e,g._pf=c(),wa(g)}function za(a,b,c,d){return ya(a,b,c,d,!1)}function Aa(a,b){var c,e;if(1===b.length&&d(b[0])&&(b=b[0]),!b.length)return za();for(c=b[0],e=1;e<b.length;++e)b[e][a](c)&&(c=b[e]);return c}function Ba(){var a=[].slice.call(arguments,0);return Aa("isBefore",a)}function Ca(){var a=[].slice.call(arguments,0);return Aa("isAfter",a)}function Da(a){var b=z(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=w(),this._bubble()}function Ea(a){return a instanceof Da}function Fa(a,b){F(a,0,0,function(){var a=this.utcOffset(),c="+";return a<0&&(a=-a,c="-"),c+E(~~(a/60),2)+b+E(~~a%60,2)})}function Ga(a){var b=(a||"").match(Vc)||[],c=b[b.length-1]||[],d=(c+"").match(qd)||["-",0,0],e=+(60*d[1])+o(d[2]);return"+"===d[0]?e:-e}function Ha(b,c){var d,f;return c._isUTC?(d=c.clone(),f=(n(b)||e(b)?+b:+za(b))-+d,d._d.setTime(+d._d+f),a.updateOffset(d,!1),d):za(b).local()}function Ia(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Ja(b,c){var d,e=this._offset||0;return null!=b?("string"==typeof b&&(b=Ga(b)),Math.abs(b)<16&&(b*=60),!this._isUTC&&c&&(d=Ia(this)),this._offset=b,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==b&&(!c||this._changeInProgress?Za(this,Ua(b-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?e:Ia(this)}function Ka(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function La(a){return this.utcOffset(0,a)}function Ma(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Ia(this),"m")),this}function Na(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Ga(this._i)),this}function Oa(a){return a=a?za(a).utcOffset():0,(this.utcOffset()-a)%60===0}function Pa(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Qa(){if(this._a){var a=this._isUTC?i(this._a):za(this._a);return this.isValid()&&p(this._a,a.toArray())>0}return!1}function Ra(){return!this._isUTC}function Sa(){return this._isUTC}function Ta(){return this._isUTC&&0===this._offset}function Ua(a,b){var c,d,e,f=a,h=null;return Ea(a)?f={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(f={},b?f[b]=a:f.milliseconds=a):(h=rd.exec(a))?(c="-"===h[1]?-1:1,f={y:0,d:o(h[ad])*c,h:o(h[bd])*c,m:o(h[cd])*c,s:o(h[dd])*c,ms:o(h[ed])*c}):(h=sd.exec(a))?(c="-"===h[1]?-1:1,f={y:Va(h[2],c),M:Va(h[3],c),d:Va(h[4],c),h:Va(h[5],c),m:Va(h[6],c),s:Va(h[7],c),w:Va(h[8],c)}):null==f?f={}:"object"==typeof f&&("from"in f||"to"in f)&&(e=Xa(za(f.from),za(f.to)),f={},f.ms=e.milliseconds,f.M=e.months),d=new Da(f),Ea(a)&&g(a,"_locale")&&(d._locale=a._locale),d}function Va(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function Wa(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function Xa(a,b){var c;return b=Ha(b,a),a.isBefore(b)?c=Wa(a,b):(c=Wa(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function Ya(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||($(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Ua(c,d),Za(this,e,a),this}}function Za(b,c,d,e){var f=c._milliseconds,g=c._days,h=c._months;e=null==e||e,f&&b._d.setTime(+b._d+f*d),g&&C(b,"Date",B(b,"Date")+g*d),h&&U(b,B(b,"Month")+h*d),e&&a.updateOffset(b,g||h)}function $a(a){var b=a||za(),c=Ha(b,this).startOf("day"),d=this.diff(c,"days",!0),e=d<-6?"sameElse":d<-1?"lastWeek":d<0?"lastDay":d<1?"sameDay":d<2?"nextDay":d<7?"nextWeek":"sameElse";return this.format(this.localeData().calendar(e,this,za(b)))}function _a(){return new m(this)}function ab(a,b){var c;return b=y("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=n(a)?a:za(a),+this>+a):(c=n(a)?+a:+za(a),c<+this.clone().startOf(b))}function bb(a,b){var c;return b=y("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=n(a)?a:za(a),+this<+a):(c=n(a)?+a:+za(a),+this.clone().endOf(b)<c)}function cb(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)}function db(a,b){var c;return b=y(b||"millisecond"),"millisecond"===b?(a=n(a)?a:za(a),+this===+a):(c=+za(a),+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))}function eb(a){return a<0?Math.ceil(a):Math.floor(a)}function fb(a,b,c){var d,e,f=Ha(a,this),g=6e4*(f.utcOffset()-this.utcOffset());return b=y(b),"year"===b||"month"===b||"quarter"===b?(e=gb(this,f),"quarter"===b?e/=3:"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:eb(e)}function gb(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return b-f<0?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function hb(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function ib(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():I(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):I(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function jb(b){var c=I(this,b||a.defaultFormat);return this.localeData().postformat(c)}function kb(a,b){return Ua({to:this,from:a}).locale(this.locale()).humanize(!b)}function lb(a){return this.from(za(),a)}function mb(a){var b;return void 0===a?this._locale._abbr:(b=w(a),null!=b&&(this._locale=b),this)}function nb(){return this._locale}function ob(a){switch(a=y(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function pb(a){return a=y(a),void 0===a||"millisecond"===a?this:this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")}function qb(){return+this._d-6e4*(this._offset||0)}function rb(){return Math.floor(+this/1e3)}function sb(){return this._offset?new Date(+this):this._d}function tb(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function ub(){return j(this)}function vb(){return h({},this._pf)}function wb(){return this._pf.overflow}function xb(a,b){F(0,[a,a.length],0,b)}function yb(a,b,c){return ga(za([a,11,31+b-c]),b,c).week}function zb(a){var b=ga(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==a?b:this.add(a-b,"y")}function Ab(a){var b=ga(this,1,4).year;return null==a?b:this.add(a-b,"y")}function Bb(){return yb(this.year(),1,4)}function Cb(){var a=this.localeData()._week;return yb(this.year(),a.dow,a.doy)}function Db(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Eb(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function Fb(a){return this._weekdays[a.day()]}function Gb(a){return this._weekdaysShort[a.day()]}function Hb(a){return this._weekdaysMin[a.day()]}function Ib(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;b<7;b++)if(this._weekdaysParse[b]||(c=za([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b}function Jb(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Eb(a,this.localeData()),this.add(a-b,"d")):b}function Kb(a){var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Lb(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)}function Mb(a,b){F(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Nb(a,b){return b._meridiemParse}function Ob(a){return"p"===(a+"").toLowerCase().charAt(0)}function Pb(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Qb(a){F(0,[a,3],0,"millisecond")}function Rb(){return this._isUTC?"UTC":""}function Sb(){return this._isUTC?"Coordinated Universal Time":""}function Tb(a){return za(1e3*a)}function Ub(){return za.apply(null,arguments).parseZone()}function Vb(a,b,c){var d=this._calendar[a];return"function"==typeof d?d.call(b,c):d}function Wb(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b}function Xb(){return this._invalidDate}function Yb(a){return this._ordinal.replace("%d",a)}function Zb(a){return a}function $b(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)}function _b(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)}function ac(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function bc(a,b,c,d){var e=w(),f=i().set(d,b);return e[c](f,a)}function cc(a,b,c,d,e){if("number"==typeof a&&(b=a,a=void 0),a=a||"",null!=b)return bc(a,b,c,e);var f,g=[];for(f=0;f<d;f++)g[f]=bc(a,f,c,e);return g}function dc(a,b){return cc(a,b,"months",12,"month")}function ec(a,b){return cc(a,b,"monthsShort",12,"month")}function fc(a,b){return cc(a,b,"weekdays",7,"day")}function gc(a,b){return cc(a,b,"weekdaysShort",7,"day")}function hc(a,b){return cc(a,b,"weekdaysMin",7,"day")}function ic(){var a=this._data;return this._milliseconds=Od(this._milliseconds),this._days=Od(this._days),this._months=Od(this._months),a.milliseconds=Od(a.milliseconds),a.seconds=Od(a.seconds),a.minutes=Od(a.minutes),a.hours=Od(a.hours),a.months=Od(a.months),a.years=Od(a.years),this}function jc(a,b,c,d){var e=Ua(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function kc(a,b){return jc(this,a,b,1)}function lc(a,b){return jc(this,a,b,-1)}function mc(){var a,b,c,d=this._milliseconds,e=this._days,f=this._months,g=this._data,h=0;return g.milliseconds=d%1e3,a=eb(d/1e3),g.seconds=a%60,b=eb(a/60),g.minutes=b%60,c=eb(b/60),g.hours=c%24,e+=eb(c/24),h=eb(nc(e)),e-=eb(oc(h)),f+=eb(e/30),e%=30,h+=eb(f/12),f%=12,g.days=e,g.months=f,g.years=h,this}function nc(a){return 400*a/146097}function oc(a){return 146097*a/400}function pc(a){var b,c,d=this._milliseconds;if(a=y(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+12*nc(b),"month"===a?c:c/12;switch(b=this._days+Math.round(oc(this._months/12)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 24*b*60+d/6e4;case"second":return 24*b*60*60+d/1e3;case"millisecond":return Math.floor(24*b*60*60*1e3)+d;default:throw new Error("Unknown unit "+a)}}function qc(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*o(this._months/12)}function rc(a){return function(){return this.as(a)}}function sc(a){return a=y(a),this[a+"s"]()}function tc(a){return function(){return this._data[a]}}function uc(){return eb(this.days()/7)}function vc(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function wc(a,b,c){var d=Ua(a).abs(),e=ce(d.as("s")),f=ce(d.as("m")),g=ce(d.as("h")),h=ce(d.as("d")),i=ce(d.as("M")),j=ce(d.as("y")),k=e<de.s&&["s",e]||1===f&&["m"]||f<de.m&&["mm",f]||1===g&&["h"]||g<de.h&&["hh",g]||1===h&&["d"]||h<de.d&&["dd",h]||1===i&&["M"]||i<de.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,vc.apply(null,k)}function xc(a,b){return void 0!==de[a]&&(void 0===b?de[a]:(de[a]=b,!0))}function yc(a){var b=this.localeData(),c=wc(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function zc(){var a=ee(this.years()),b=ee(this.months()),c=ee(this.days()),d=ee(this.hours()),e=ee(this.minutes()),f=ee(this.seconds()+this.milliseconds()/1e3),g=this.asSeconds();return g?(g<0?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}var Ac,Bc,Cc=a.momentProperties=[],Dc=!1,Ec={},Fc={},Gc=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Hc=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ic={},Jc={},Kc=/\d/,Lc=/\d\d/,Mc=/\d{3}/,Nc=/\d{4}/,Oc=/[+-]?\d{6}/,Pc=/\d\d?/,Qc=/\d{1,3}/,Rc=/\d{1,4}/,Sc=/[+-]?\d{1,6}/,Tc=/\d+/,Uc=/[+-]?\d+/,Vc=/Z|[+-]\d\d:?\d\d/gi,Wc=/[+-]?\d+(\.\d{1,3})?/,Xc=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Yc={},Zc={},$c=0,_c=1,ad=2,bd=3,cd=4,dd=5,ed=6;F("M",["MM",2],"Mo",function(){return this.month()+1}),F("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),F("MMMM",0,0,function(a){return this.localeData().months(this,a)}),x("month","M"),K("M",Pc),K("MM",Pc,Lc),K("MMM",Xc),K("MMMM",Xc),N(["M","MM"],function(a,b){b[_c]=o(a)-1}),N(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[_c]=e:c._pf.invalidMonth=a});var fd="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),gd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),hd={};a.suppressDeprecationWarnings=!1;var id=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,jd=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],kd=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ld=/^\/?Date\((\-?\d+)/i;a.createFromInputFallback=Z("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),F(0,["YY",2],0,function(){return this.year()%100}),F(0,["YYYY",4],0,"year"),F(0,["YYYYY",5],0,"year"),F(0,["YYYYYY",6,!0],0,"year"),x("year","y"),K("Y",Uc),K("YY",Pc,Lc),K("YYYY",Rc,Nc),K("YYYYY",Sc,Oc),K("YYYYYY",Sc,Oc),N(["YYYY","YYYYY","YYYYYY"],$c),N("YY",function(b,c){c[$c]=a.parseTwoDigitYear(b)}),a.parseTwoDigitYear=function(a){return o(a)+(o(a)>68?1900:2e3)};var md=A("FullYear",!1);F("w",["ww",2],"wo","week"),F("W",["WW",2],"Wo","isoWeek"),x("week","w"),x("isoWeek","W"),K("w",Pc),K("ww",Pc,Lc),K("W",Pc),K("WW",Pc,Lc),O(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=o(a)});var nd={dow:0,doy:6};F("DDD",["DDDD",3],"DDDo","dayOfYear"),x("dayOfYear","DDD"),K("DDD",Qc),K("DDDD",Mc),N(["DDD","DDDD"],function(a,b,c){c._dayOfYear=o(a)}),a.ISO_8601=function(){};var od=Z("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var a=za.apply(null,arguments);return a<this?this:a}),pd=Z("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var a=za.apply(null,arguments);return a>this?this:a});Fa("Z",":"),Fa("ZZ",""),K("Z",Vc),K("ZZ",Vc),N(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Ga(a)});var qd=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var rd=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,sd=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Ua.fn=Da.prototype;var td=Ya(1,"add"),ud=Ya(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var vd=Z("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});F(0,["gg",2],0,function(){return this.weekYear()%100}),F(0,["GG",2],0,function(){return this.isoWeekYear()%100}),xb("gggg","weekYear"),xb("ggggg","weekYear"),xb("GGGG","isoWeekYear"),xb("GGGGG","isoWeekYear"),x("weekYear","gg"),x("isoWeekYear","GG"),K("G",Uc),K("g",Uc),K("GG",Pc,Lc),K("gg",Pc,Lc),K("GGGG",Rc,Nc),K("gggg",Rc,Nc),K("GGGGG",Sc,Oc),K("ggggg",Sc,Oc),O(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=o(a)}),O(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),F("Q",0,0,"quarter"),x("quarter","Q"),K("Q",Kc),N("Q",function(a,b){b[_c]=3*(o(a)-1)}),F("D",["DD",2],"Do","date"),x("date","D"),K("D",Pc),K("DD",Pc,Lc),K("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),N(["D","DD"],ad),N("Do",function(a,b){b[ad]=o(a.match(Pc)[0],10)});var wd=A("Date",!0);F("d",0,"do","day"),F("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),F("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),F("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),F("e",0,0,"weekday"),F("E",0,0,"isoWeekday"),x("day","d"),x("weekday","e"),x("isoWeekday","E"),K("d",Pc),K("e",Pc),K("E",Pc),K("dd",Xc),K("ddd",Xc),K("dddd",Xc),O(["dd","ddd","dddd"],function(a,b,c){var d=c._locale.weekdaysParse(a);null!=d?b.d=d:c._pf.invalidWeekday=a}),O(["d","e","E"],function(a,b,c,d){b[d]=o(a)});var xd="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),yd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),zd="Su_Mo_Tu_We_Th_Fr_Sa".split("_");F("H",["HH",2],0,"hour"),F("h",["hh",2],0,function(){return this.hours()%12||12}),Mb("a",!0),Mb("A",!1),x("hour","h"),K("a",Nb),K("A",Nb),K("H",Pc),K("h",Pc),K("HH",Pc,Lc),K("hh",Pc,Lc),N(["H","HH"],bd),N(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),N(["h","hh"],function(a,b,c){b[bd]=o(a),c._pf.bigHour=!0});var Ad=/[ap]\.?m?\.?/i,Bd=A("Hours",!0);F("m",["mm",2],0,"minute"),x("minute","m"),K("m",Pc),K("mm",Pc,Lc),N(["m","mm"],cd);var Cd=A("Minutes",!1);F("s",["ss",2],0,"second"),x("second","s"),K("s",Pc),K("ss",Pc,Lc),N(["s","ss"],dd);var Dd=A("Seconds",!1);F("S",0,0,function(){return~~(this.millisecond()/100)}),F(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),Qb("SSS"),Qb("SSSS"),x("millisecond","ms"),K("S",Qc,Kc),K("SS",Qc,Lc),K("SSS",Qc,Mc),K("SSSS",Tc),N(["S","SS","SSS","SSSS"],function(a,b){b[ed]=o(1e3*("0."+a))});var Ed=A("Milliseconds",!1);F("z",0,0,"zoneAbbr"),F("zz",0,0,"zoneName");var Fd=m.prototype;Fd.add=td,Fd.calendar=$a,Fd.clone=_a,Fd.diff=fb,Fd.endOf=pb,Fd.format=jb,Fd.from=kb,Fd.fromNow=lb,Fd.get=D,Fd.invalidAt=wb,Fd.isAfter=ab,Fd.isBefore=bb,Fd.isBetween=cb,Fd.isSame=db,Fd.isValid=ub,Fd.lang=vd,Fd.locale=mb,Fd.localeData=nb,Fd.max=pd,Fd.min=od,Fd.parsingFlags=vb,Fd.set=D,Fd.startOf=ob,Fd.subtract=ud,Fd.toArray=tb,Fd.toDate=sb,Fd.toISOString=ib,Fd.toJSON=ib,Fd.toString=hb,Fd.unix=rb,Fd.valueOf=qb,Fd.year=md,Fd.isLeapYear=fa,Fd.weekYear=zb,Fd.isoWeekYear=Ab,Fd.quarter=Fd.quarters=Db,Fd.month=V,Fd.daysInMonth=W,Fd.week=Fd.weeks=ka,Fd.isoWeek=Fd.isoWeeks=la,Fd.weeksInYear=Cb,Fd.isoWeeksInYear=Bb,Fd.date=wd,Fd.day=Fd.days=Jb,Fd.weekday=Kb,Fd.isoWeekday=Lb,Fd.dayOfYear=na,Fd.hour=Fd.hours=Bd,Fd.minute=Fd.minutes=Cd,Fd.second=Fd.seconds=Dd,Fd.millisecond=Fd.milliseconds=Ed,Fd.utcOffset=Ja,Fd.utc=La,Fd.local=Ma,Fd.parseZone=Na,Fd.hasAlignedHourOffset=Oa,Fd.isDST=Pa,Fd.isDSTShifted=Qa,Fd.isLocal=Ra,Fd.isUtcOffset=Sa,Fd.isUtc=Ta,Fd.isUTC=Ta,Fd.zoneAbbr=Rb,Fd.zoneName=Sb,Fd.dates=Z("dates accessor is deprecated. Use date instead.",wd),Fd.months=Z("months accessor is deprecated. Use month instead",V),Fd.years=Z("years accessor is deprecated. Use year instead",md),Fd.zone=Z("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Ka);var Gd=Fd,Hd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Id={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},Jd="Invalid date",Kd="%d",Ld=/\d{1,2}/,Md={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Nd=q.prototype;Nd._calendar=Hd,Nd.calendar=Vb,Nd._longDateFormat=Id,Nd.longDateFormat=Wb,Nd._invalidDate=Jd,Nd.invalidDate=Xb,Nd._ordinal=Kd,Nd.ordinal=Yb,Nd._ordinalParse=Ld,Nd.preparse=Zb,Nd.postformat=Zb,Nd._relativeTime=Md,
Nd.relativeTime=$b,Nd.pastFuture=_b,Nd.set=ac,Nd.months=R,Nd._months=fd,Nd.monthsShort=S,Nd._monthsShort=gd,Nd.monthsParse=T,Nd.week=ha,Nd._week=nd,Nd.firstDayOfYear=ja,Nd.firstDayOfWeek=ia,Nd.weekdays=Fb,Nd._weekdays=xd,Nd.weekdaysMin=Hb,Nd._weekdaysMin=zd,Nd.weekdaysShort=Gb,Nd._weekdaysShort=yd,Nd.weekdaysParse=Ib,Nd.isPM=Ob,Nd._meridiemParse=Ad,Nd.meridiem=Pb,u("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===o(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),a.lang=Z("moment.lang is deprecated. Use moment.locale instead.",u),a.langData=Z("moment.langData is deprecated. Use moment.localeData instead.",w);var Od=Math.abs,Pd=rc("ms"),Qd=rc("s"),Rd=rc("m"),Sd=rc("h"),Td=rc("d"),Ud=rc("w"),Vd=rc("M"),Wd=rc("y"),Xd=tc("milliseconds"),Yd=tc("seconds"),Zd=tc("minutes"),$d=tc("hours"),_d=tc("days"),ae=tc("months"),be=tc("years"),ce=Math.round,de={s:45,m:45,h:22,d:26,M:11},ee=Math.abs,fe=Da.prototype;fe.abs=ic,fe.add=kc,fe.subtract=lc,fe.as=pc,fe.asMilliseconds=Pd,fe.asSeconds=Qd,fe.asMinutes=Rd,fe.asHours=Sd,fe.asDays=Td,fe.asWeeks=Ud,fe.asMonths=Vd,fe.asYears=Wd,fe.valueOf=qc,fe._bubble=mc,fe.get=sc,fe.milliseconds=Xd,fe.seconds=Yd,fe.minutes=Zd,fe.hours=$d,fe.days=_d,fe.weeks=uc,fe.months=ae,fe.years=be,fe.humanize=yc,fe.toISOString=zc,fe.toString=zc,fe.toJSON=zc,fe.locale=mb,fe.localeData=nb,fe.toIsoString=Z("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",zc),fe.lang=vd,F("X",0,0,"unix"),F("x",0,0,"valueOf"),K("x",Uc),K("X",Wc),N("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),N("x",function(a,b,c){c._d=new Date(o(a))}),a.version="2.10.2",b(za),a.fn=Gd,a.min=Ba,a.max=Ca,a.utc=i,a.unix=Tb,a.months=dc,a.isDate=e,a.locale=u,a.invalid=k,a.duration=Ua,a.isMoment=n,a.weekdays=fc,a.parseZone=Ub,a.localeData=w,a.isDuration=Ea,a.monthsShort=ec,a.weekdaysMin=hc,a.defineLocale=v,a.weekdaysShort=gc,a.normalizeUnits=y,a.relativeTimeThreshold=xc;var ge=a;return ge}),function(b){function c(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function d(){var a=require("util");return"Markdown.mk_block( "+a.inspect(this.toString())+", "+a.inspect(this.trailing)+", "+a.inspect(this.lineNumber)+" )"}function e(a){for(var b=0,c=-1;(c=a.indexOf("\n",c+1))!==-1;)b++;return b}function f(a,b){function c(a){this.len_after=a,this.name="close_"+b}var d=a+"_state",e="strong"==a?"em_state":"strong_state";return function(f,g){if(this[d][0]==b)return this[d].shift(),[f.length,new c(f.length-b.length)];var h=this[e].slice(),i=this[d].slice();this[d].unshift(b);var j=this.processInline(f.substr(b.length)),k=j[j.length-1];this[d].shift();if(k instanceof c){j.pop();var l=f.length-k.len_after;return[l,[a].concat(j)]}return this[e]=h,this[d]=i,[b.length,b]}}function g(a){for(var b=a.split(""),c=[""],d=!1;b.length;){var e=b.shift();switch(e){case" ":d?c[c.length-1]+=e:c.push("");break;case"'":case'"':d=!d;break;case"\\":e=b.shift();default:c[c.length-1]+=e}}return c}function h(a){return q(a)&&a.length>1&&"object"==typeof a[1]&&!q(a[1])?a[1]:void 0}function i(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function j(a){if("string"==typeof a)return i(a);var b=a.shift(),c={},d=[];for(!a.length||"object"!=typeof a[0]||a[0]instanceof Array||(c=a.shift());a.length;)d.push(j(a.shift()));var e="";for(var f in c)e+=" "+f+'="'+i(c[f])+'"';return"img"==b||"br"==b||"hr"==b?"<"+b+e+"/>":"<"+b+e+">"+d.join("")+"</"+b+">"}function k(a,b,c){var d;c=c||{};var e=a.slice(0);"function"==typeof c.preprocessTreeNode&&(e=c.preprocessTreeNode(e,b));var f=h(e);if(f){e[1]={};for(d in f)e[1][d]=f[d];f=e[1]}if("string"==typeof e)return e;switch(e[0]){case"header":e[0]="h"+e[1].level,delete e[1].level;break;case"bulletlist":e[0]="ul";break;case"numberlist":e[0]="ol";break;case"listitem":e[0]="li";break;case"para":e[0]="p";break;case"markdown":e[0]="html",f&&delete f.references;break;case"code_block":e[0]="pre",d=f?2:1;var g=["code"];g.push.apply(g,e.splice(d,e.length-d)),e[d]=g;break;case"inlinecode":e[0]="code";break;case"img":e[1].src=e[1].href,delete e[1].href;break;case"linebreak":e[0]="br";break;case"link":e[0]="a";break;case"link_ref":e[0]="a";var i=b[f.ref];if(!i)return f.original;delete f.ref,f.href=i.href,i.title&&(f.title=i.title),delete f.original;break;case"img_ref":e[0]="img";var i=b[f.ref];if(!i)return f.original;delete f.ref,f.src=i.href,i.title&&(f.title=i.title),delete f.original}if(d=1,f){for(var j in e[1]){d=2;break}1===d&&e.splice(d,1)}for(;d<e.length;++d)e[d]=k(e[d],b,c);return e}function l(a){for(var b=h(a)?2:1;b<a.length;)"string"==typeof a[b]?b+1<a.length&&"string"==typeof a[b+1]?a[b]+=a.splice(b+1,1)[0]:++b:(l(a[b]),++b)}var m=b.Markdown=function(a){switch(typeof a){case"undefined":this.dialect=m.dialects.Gruber;break;case"object":this.dialect=a;break;default:if(!(a in m.dialects))throw new Error("Unknown Markdown dialect '"+String(a)+"'");this.dialect=m.dialects[a]}this.em_state=[],this.strong_state=[],this.debug_indent=""};b.parse=function(a,b){var c=new m(b);return c.toTree(a)},b.toHTML=function(a,c,d){var e=b.toHTMLTree(a,c,d);return b.renderJsonML(e)},b.toHTMLTree=function(a,b,c){"string"==typeof a&&(a=this.parse(a,b));var d=h(a),e={};d&&d.references&&(e=d.references);var f=k(a,e,c);return l(f),f};var n=m.mk_block=function(a,b,e){1==arguments.length&&(b="\n\n");var f=new String(a);return f.trailing=b,f.inspect=d,f.toSource=c,void 0!=e&&(f.lineNumber=e),f};m.prototype.split_blocks=function(a,b){a=a.replace(/(\r\n|\n|\r)/g,"\n");var c,d=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,f=[],g=1;for(null!=(c=/^(\s*\n)/.exec(a))&&(g+=e(c[0]),d.lastIndex=c[0].length);null!==(c=d.exec(a));)"\n#"==c[2]&&(c[2]="\n",d.lastIndex--),f.push(n(c[1],c[2],g)),g+=e(c[0]);return f},m.prototype.processBlock=function(a,b){var c=this.dialect.block,d=c.__order__;if("__call__"in c)return c.__call__.call(this,a,b);for(var e=0;e<d.length;e++){var f=c[d[e]].call(this,a,b);if(f)return(!q(f)||f.length>0&&!q(f[0]))&&this.debug(d[e],"didn't return a proper array"),f}return[]},m.prototype.processInline=function(a){return this.dialect.inline.__call__.call(this,String(a))},m.prototype.toTree=function(a,b){var c=a instanceof Array?a:this.split_blocks(a),d=this.tree;try{for(this.tree=b||this.tree||["markdown"];c.length;){var e=this.processBlock(c.shift(),c);e.length&&this.tree.push.apply(this.tree,e)}return this.tree}finally{b&&(this.tree=d)}},m.prototype.debug=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,a),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,a)},m.prototype.loop_re_over_block=function(a,b,c){for(var d,e=b.valueOf();e.length&&null!=(d=a.exec(e));)e=e.substr(d[0].length),c.call(this,d);return e},m.dialects={},m.dialects.Gruber={block:{atxHeader:function(a,b){var c=a.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(c){var d=["header",{level:c[1].length}];return Array.prototype.push.apply(d,this.processInline(c[2])),c[0].length<a.length&&b.unshift(n(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},setextHeader:function(a,b){var c=a.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(c){var d="="===c[2]?1:2,e=["header",{level:d},c[1]];return c[0].length<a.length&&b.unshift(n(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[e]}},code:function(a,b){var c=[],d=/^(?: {0,3}\t| {4})(.*)\n?/;if(a.match(d)){a:for(;;){var e=this.loop_re_over_block(d,a.valueOf(),function(a){c.push(a[1])});if(e.length){b.unshift(n(e,a.trailing));break a}if(!b.length)break a;if(!b[0].match(d))break a;c.push(a.trailing.replace(/[^\n]/g,"").substring(2)),a=b.shift()}return[["code_block",c.join("\n")]]}},horizRule:function(a,b){var c=a.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(c){var d=[["hr"]];return c[1]&&d.unshift.apply(d,this.processBlock(c[1],[])),c[3]&&b.unshift(n(c[3])),d}},lists:function(){function a(a){return new RegExp("(?:^("+i+"{0,"+a+"} {0,3})("+f+")\\s+)|(^"+i+"{0,"+(a-1)+"}[ ]{0,4})")}function b(a){return a.replace(/ {0,3}\t/g,"    ")}function c(a,b,c,d){if(b)return void a.push(["para"].concat(c));var e=a[a.length-1]instanceof Array&&"para"==a[a.length-1][0]?a[a.length-1]:a;d&&a.length>1&&c.unshift(d);for(var f=0;f<c.length;f++){var g=c[f],h="string"==typeof g;h&&e.length>1&&"string"==typeof e[e.length-1]?e[e.length-1]+=g:e.push(g)}}function d(a,b){for(var c=new RegExp("^("+i+"{"+a+"}.*?\\n?)*$"),d=new RegExp("^"+i+"{"+a+"}","gm"),e=[];b.length>0&&c.exec(b[0]);){var f=b.shift(),g=f.replace(d,"");e.push(n(g,f.trailing,f.lineNumber))}return e}function e(a,b,c){var d=a.list,e=d[d.length-1];if(!(e[1]instanceof Array&&"para"==e[1][0]))if(b+1==c.length)e.push(["para"].concat(e.splice(1,e.length-1)));else{var f=e.pop();e.push(["para"].concat(e.splice(1,e.length-1)),f)}}var f="[*+-]|\\d+\\.",g=/[*+-]/,h=new RegExp("^( {0,3})("+f+")[ \t]+"),i="(?: {0,3}\\t| {4})";return function(f,i){function j(a){var b=g.exec(a[2])?["bulletlist"]:["numberlist"];return n.push({list:b,indent:a[1]}),b}var k=f.match(h);if(k){for(var l,m,n=[],p=j(k),q=!1,r=[n[0].list];;){for(var s=f.split(/(?=\n)/),t="",u=0;u<s.length;u++){var v="",w=s[u].replace(/^\n/,function(a){return v=a,""}),x=a(n.length);if(k=w.match(x),void 0!==k[1]){t.length&&(c(l,q,this.processInline(t),v),q=!1,t=""),k[1]=b(k[1]);var y=Math.floor(k[1].length/4)+1;if(y>n.length)p=j(k),l.push(p),l=p[1]=["listitem"];else{var z=!1;for(m=0;m<n.length;m++)if(n[m].indent==k[1]){p=n[m].list,n.splice(m+1,n.length-(m+1)),z=!0;break}z||(y++,y<=n.length?(n.splice(y,n.length-y),p=n[y-1].list):(p=j(k),l.push(p))),l=["listitem"],p.push(l)}v=""}w.length>k[0].length&&(t+=v+w.substr(k[0].length))}t.length&&(c(l,q,this.processInline(t),v),q=!1,t="");var A=d(n.length,i);A.length>0&&(o(n,e,this),l.push.apply(l,this.toTree(A,[])));var B=i[0]&&i[0].valueOf()||"";if(!B.match(h)&&!B.match(/^ /))break;f=i.shift();var C=this.dialect.block.horizRule(f,i);if(C){r.push.apply(r,C);break}o(n,e,this),q=!0}return r}}}(),blockquote:function(a,b){if(a.match(/^>/m)){var c=[];if(">"!=a[0]){for(var d=a.split(/\n/),e=[],f=a.lineNumber;d.length&&">"!=d[0][0];)e.push(d.shift()),f++;var g=n(e.join("\n"),"\n",a.lineNumber);c.push.apply(c,this.processBlock(g,[])),a=n(d.join("\n"),a.trailing,f)}for(;b.length&&">"==b[0][0];){var i=b.shift();a=n(a+a.trailing+i,i.trailing,a.lineNumber)}var j=a.replace(/^> ?/gm,""),k=(this.tree,this.toTree(j,["blockquote"])),l=h(k);return l&&l.references&&(delete l.references,r(l)&&k.splice(1,1)),c.push(k),c}},referenceDefn:function(a,b){var c=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(a.match(c)){h(this.tree)||this.tree.splice(1,0,{});var d=h(this.tree);void 0===d.references&&(d.references={});var e=this.loop_re_over_block(c,a,function(a){a[2]&&"<"==a[2][0]&&">"==a[2][a[2].length-1]&&(a[2]=a[2].substring(1,a[2].length-1));var b=d.references[a[1].toLowerCase()]={href:a[2]};void 0!==a[4]?b.title=a[4]:void 0!==a[5]&&(b.title=a[5])});return e.length&&b.unshift(n(e,a.trailing)),[]}},para:function(a,b){return[["para"].concat(this.processInline(a))]}}},m.dialects.Gruber.inline={__oneElement__:function(a,b,c){var d,e;b=b||this.dialect.inline.__patterns__;var f=new RegExp("([\\s\\S]*?)("+(b.source||b)+")");if(d=f.exec(a),!d)return[a.length,a];if(d[1])return[d[1].length,d[1]];var e;return d[2]in this.dialect.inline&&(e=this.dialect.inline[d[2]].call(this,a.substr(d.index),d,c||[])),e=e||[d[2].length,d[2]]},__call__:function(a,b){function c(a){"string"==typeof a&&"string"==typeof e[e.length-1]?e[e.length-1]+=a:e.push(a)}for(var d,e=[];a.length>0;)d=this.dialect.inline.__oneElement__.call(this,a,b,e),a=a.substr(d.shift()),o(d,c);return e},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(a){return this.dialect.inline.__escape__.exec(a)?[2,a.charAt(1)]:[1,"\\"]},"![":function(a){var b=a.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(b){b[2]&&"<"==b[2][0]&&">"==b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1)),b[2]=this.dialect.inline.__call__.call(this,b[2],/\\/)[0];var c={alt:b[1],href:b[2]||""};return void 0!==b[4]&&(c.title=b[4]),[b[0].length,["img",c]]}return b=a.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),b?[b[0].length,["img_ref",{alt:b[1],ref:b[2].toLowerCase(),original:b[0]}]]:[2,"!["]},"[":function a(b){var c=String(b),d=m.DialectHelpers.inline_until_char.call(this,b.substr(1),"]");if(!d)return[1,"["];var a,e,f=1+d[0],g=d[1];b=b.substr(f);var h=b.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(h){var i=h[1];if(f+=h[0].length,i&&"<"==i[0]&&">"==i[i.length-1]&&(i=i.substring(1,i.length-1)),!h[3])for(var j=1,k=0;k<i.length;k++)switch(i[k]){case"(":j++;break;case")":0==--j&&(f-=i.length-k,i=i.substring(0,k))}return i=this.dialect.inline.__call__.call(this,i,/\\/)[0],e={href:i||""},void 0!==h[3]&&(e.title=h[3]),a=["link",e].concat(g),[f,a]}return h=b.match(/^\s*\[(.*?)\]/),h?(f+=h[0].length,e={ref:(h[1]||String(g)).toLowerCase(),original:c.substr(0,f)},a=["link_ref",e].concat(g),[f,a]):1==g.length&&"string"==typeof g[0]?(e={ref:g[0].toLowerCase(),original:c.substr(0,f)},a=["link_ref",e,g[0]],[f,a]):[1,"["]},"<":function(a){var b;return null!=(b=a.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?b[3]?[b[0].length,["link",{href:"mailto:"+b[3]},b[3]]]:"mailto"==b[2]?[b[0].length,["link",{href:b[1]},b[1].substr("mailto:".length)]]:[b[0].length,["link",{href:b[1]},b[1]]]:[1,"<"]},"`":function(a){var b=a.match(/(`+)(([\s\S]*?)\1)/);return b&&b[2]?[b[1].length+b[2].length,["inlinecode",b[3]]]:[1,"`"]},"  \n":function(a){return[3,["linebreak"]]}},m.dialects.Gruber.inline["**"]=f("strong","**"),m.dialects.Gruber.inline.__=f("strong","__"),m.dialects.Gruber.inline["*"]=f("em","*"),m.dialects.Gruber.inline._=f("em","_"),m.buildBlockOrder=function(a){var b=[];for(var c in a)"__order__"!=c&&"__call__"!=c&&b.push(c);a.__order__=b},m.buildInlinePatterns=function(a){var b=[];for(var c in a)if(!c.match(/^__.*__$/)){var d=c.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");b.push(1==c.length?d:"(?:"+d+")")}b=b.join("|"),a.__patterns__=b;var e=a.__call__;a.__call__=function(a,c){return void 0!=c?e.call(this,a,c):e.call(this,a,b)}},m.DialectHelpers={},m.DialectHelpers.inline_until_char=function(a,b){for(var c=0,d=[];;){if(a.charAt(c)==b)return c++,[c,d];if(c>=a.length)return null;var e=this.dialect.inline.__oneElement__.call(this,a.substr(c));c+=e[0],d.push.apply(d,e.slice(1))}},m.subclassDialect=function(a){function b(){}function c(){}return b.prototype=a.block,c.prototype=a.inline,{block:new b,inline:new c}},m.buildBlockOrder(m.dialects.Gruber.block),m.buildInlinePatterns(m.dialects.Gruber.inline),m.dialects.Maruku=m.subclassDialect(m.dialects.Gruber),m.dialects.Maruku.processMetaHash=function(a){for(var b=g(a),c={},d=0;d<b.length;++d)if(/^#/.test(b[d]))c.id=b[d].substring(1);else if(/^\./.test(b[d]))c.class?c.class=c.class+b[d].replace(/./," "):c.class=b[d].substring(1);else if(/\=/.test(b[d])){var e=b[d].split(/\=/);c[e[0]]=e[1]}return c},m.dialects.Maruku.block.document_meta=function(a,b){if(!(a.lineNumber>1)&&a.match(/^(?:\w+:.*\n)*\w+:.*$/)){h(this.tree)||this.tree.splice(1,0,{});var c=a.split(/\n/);for(p in c){var d=c[p].match(/(\w+):\s*(.*)$/),e=d[1].toLowerCase(),f=d[2];this.tree[1][e]=f}return[]}},m.dialects.Maruku.block.block_meta=function(b,c){var d=b.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(d){var e,f=this.dialect.processMetaHash(d[2]);if(""===d[1]){var g=this.tree[this.tree.length-1];if(e=h(g),"string"==typeof g)return;e||(e={},g.splice(1,0,e));for(a in f)e[a]=f[a];return[]}var i=b.replace(/\n.*$/,""),j=this.processBlock(i,[]);e=h(j[0]),e||(e={},j[0].splice(1,0,e));for(a in f)e[a]=f[a];return j}},m.dialects.Maruku.block.definition_list=function(a,b){var c,d,e=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,f=["dl"];if(d=a.match(e)){for(var g=[a];b.length&&e.exec(b[0]);)g.push(b.shift());for(var h=0;h<g.length;++h){var d=g[h].match(e),i=d[1].replace(/\n$/,"").split(/\n/),j=d[2].split(/\n:\s+/);for(c=0;c<i.length;++c)f.push(["dt",i[c]]);for(c=0;c<j.length;++c)f.push(["dd"].concat(this.processInline(j[c].replace(/(\n)\s+/,"$1"))))}return[f]}},m.dialects.Maruku.block.table=function a(b,c){var d,e,f=function(a,b){b=b||"\\s",b.match(/^[\\|\[\]{}?*.+^$]$/)&&(b="\\"+b);for(var c,d=[],e=new RegExp("^((?:\\\\.|[^\\\\"+b+"])*)"+b+"(.*)");c=a.match(e);)d.push(c[1]),a=c[2];return d.push(a),d},g=/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,h=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;if(e=b.match(g))e[3]=e[3].replace(/^\s*\|/gm,"");else if(!(e=b.match(h)))return;var a=["table",["thead",["tr"]],["tbody"]];e[2]=e[2].replace(/\|\s*$/,"").split("|");var i=[];for(o(e[2],function(a){a.match(/^\s*-+:\s*$/)?i.push({align:"right"}):a.match(/^\s*:-+\s*$/)?i.push({align:"left"}):a.match(/^\s*:-+:\s*$/)?i.push({align:"center"}):i.push({})}),e[1]=f(e[1].replace(/\|\s*$/,""),"|"),d=0;d<e[1].length;d++)a[1][1].push(["th",i[d]||{}].concat(this.processInline(e[1][d].trim())));return o(e[3].replace(/\|\s*$/gm,"").split("\n"),function(b){var c=["tr"];for(b=f(b,"|"),d=0;d<b.length;d++)c.push(["td",i[d]||{}].concat(this.processInline(b[d].trim())));a[2].push(c)},this),[a]},m.dialects.Maruku.inline["{:"]=function(a,b,c){if(!c.length)return[2,"{:"];var d=c[c.length-1];if("string"==typeof d)return[2,"{:"];var e=a.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!e)return[2,"{:"];var f=this.dialect.processMetaHash(e[1]),g=h(d);g||(g={},d.splice(1,0,g));for(var i in f)g[i]=f[i];return[e[0].length,""]},m.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,m.buildBlockOrder(m.dialects.Maruku.block),m.buildInlinePatterns(m.dialects.Maruku.inline);var o,q=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)};o=Array.prototype.forEach?function(a,b,c){return a.forEach(b,c)}:function(a,b,c){for(var d=0;d<a.length;d++)b.call(c||a,a[d],d,a)};var r=function(a){for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0};b.renderJsonML=function(a,b){b=b||{},b.root=b.root||!1;var c=[];if(b.root)c.push(j(a));else for(a.shift(),!a.length||"object"!=typeof a[0]||a[0]instanceof Array||a.shift();a.length;)c.push(j(a.shift()));return c.join("\n\n")}}(function(){return"undefined"==typeof exports?(window.markdown={},window.markdown):exports}()),cdb.open.AuthenticatedUser=cdb.core.Model.extend({defaults:{username:"",avatar_url:""},url:function(){var a=this.get("host")?this.get("host"):this._getCurrentHost();return"//"+a+"/api/v1/get_authenticated_users"},_getCurrentHost:function(){return window.location.host}}),cdb.admin.CartoDBLayer=cdb.geo.CartoDBLayer.extend({MAX_HISTORY:5,MAX_HISTORY_QUERY:5,MAX_HISTORY_TILE_STYLE:5,initialize:function(){this.sync=_.debounce(this.sync,1e3),this.error=!1,this.set("use_server_style",!0),this.initHistory("query"),this.initHistory("tile_style"),this.table=new cdb.admin.CartoDBTableMetadata({id:this.get("table_name")}),this.infowindow=new cdb.geo.ui.InfowindowModel({template_name:"infowindow_light"}),this.tooltip=new cdb.geo.ui.InfowindowModel({template_name:"tooltip_light"});var a=this.get("wizard_properties");this.wizard_properties=new cdb.admin.WizardProperties(_.extend({},a,{table:this.table,layer:this})),this.wizard_properties.bind("change:type",this._manageInteractivity,this),this.legend=new cdb.geo.ui.LegendModel,this.bind("change:table_name",function(){this.table.set("id",this.get("table_name")).fetch()},this),this.bindInfowindow(this.infowindow,"infowindow"),this.bindInfowindow(this.tooltip,"tooltip"),this.bindLegend(this.legend),this.bindTable(this.table),this.tooltip.bind("change:fields",this._manageInteractivity,this),this.get("table")&&(table_attr=this.get("table"),delete this.attributes.table,this.table.set(table_attr)),this.isTableLoaded()||this.table.fetch()},isTableLoaded:function(){return this.table.get("id")&&this.table.get("privacy")},toLayerGroup:function(){var a=_.clone(this.attributes);return a.layer_definition={version:"1.0.1",layers:[]},this.get("visible")&&a.layer_definition.layers.push(this.getLayerDef()),a.type="layergroup",a},getLayerDef:function(){var a=this.attributes,b=a.query||"select * from "+cdb.Utils.safeTableNameQuoting(a.table_name);return a.query_wrapper&&(b=_.template(a.query_wrapper)({sql:b})),{type:"cartodb",options:{sql:b,cartocss:this.get("tile_style"),cartocss_version:"2.1.1",interactivity:this.get("interactivity")}}},initHistory:function(a){this.get(a+"_history")||this.set(a+"_history",[]),this[a+"_history_position"]=0,this[a+"_storage"]=new cdb.admin.localStorage(a+"_storage_"+this.get("table_name"))},addToHistory:function(a,b){b!=this.get(a+"_history")[this.get(a+"_history").length-1]&&(this.get(a+"_history").push(b),this.trimHistory(a),this[a+"_history_position"]=this.get(a+"_history").length-1)},trimHistory:function(a){for(var b=this["MAX_HISTORY_"+a.toUpperCase()]?this["MAX_HISTORY_"+a.toUpperCase()]:this.MAX_HISTORY;this.get(a+"_history").length>b;){var c=this.get(a+"_history").splice(0,1);this[a+"_storage"].add(c[0])}},moveHistoryPosition:function(a,b){var c=this[a+"_history_position"]+b;c>=0&&c<this.get(a+"_history").length?this[a+"_history_position"]=c:c<0&&Math.abs(c)<=this[a+"_storage"].get().length&&(this[a+"_history_position"]=c)},getCurrentHistoryPosition:function(a){var b=this[a+"_history_position"];return this[a+"_history_position"]>=0?this.get(a+"_history")[b]:Math.abs(b)<=this[a+"_storage"].get().length?this[a+"_storage"].get(this[a+"_storage"].get().length-Math.abs(b)):this.get(a+"_history")[0]},redoHistory:function(a){return this.moveHistoryPosition(a,1),this.getCurrentHistoryPosition(a)},undoHistory:function(a){var b=this.getCurrentHistoryPosition(a);return this.moveHistoryPosition(a,-1),b},isHistoryAtLastPosition:function(a){return 0===this.get(a+"_history").length||this.get(a+"_history").length-1==this[a+"_history_position"]},isHistoryAtFirstPosition:function(a){if(0===this.get(a+"_history").length)return!0;var b=this[a+"_storage"].get();if(!b||0!==b.length){var c=b?1*b.length:0,d=-1*c;return d==this[a+"_history_position"]}return 0===this[a+"_history_position"]},clone:function(){var a=_.clone(this.attributes);return delete a.id,a.table=this.table.toJSON(),new cdb.admin.CartoDBLayer(a)},toJSON:function(){var a=_.clone(this.attributes);a.extra_params&&(a.extra_params=_.clone(this.attributes.extra_params),a.extra_params.api_key&&delete a.extra_params.api_key,a.extra_params.map_key&&delete a.extra_params.map_key),delete a.infowindow,delete a.tooltip,a.wizard_properties=this.wizard_properties.toJSON(),a.legend=this.legend.toJSON();var b={kind:"cartodb"===a.type.toLowerCase()?"carto":a.type,options:a,order:a.order,infowindow:null,tooltip:this.tooltip.toJSON()};return this.wizard_properties.supportsInteractivity()&&(b.infowindow=this.infowindow.toJSON()),void 0!==a.id&&(b.id=a.id),b},parse:function(a,b){var c={};if(!a||this._saving&&!this.isNew())return c;a.options.extra_params&&this.attributes&&this.attributes.extra_params&&(a.options.extra_params.map_key=this.attributes.extra_params.map_key);var d=this.attributes,e=d&&d.wizard_properties;return e&&e.properties&&e.properties.metadata&&a.options.wizard_properties&&a.options.wizard_properties.properties&&(a.options.wizard_properties.properties.metadata=e.properties.metadata),this.wizard_properties&&a.options.wizard_properties&&this.wizard_properties.properties(a.options.wizard_properties),_.extend(c,a.options,{id:a.id,type:"carto"===a.kind?"CartoDB":a.kind,infowindow:a.infowindow,tooltip:a.tooltip,order:a.order}),c},sync:function(a,b,c){return"read"!=a&&(c.data=JSON.stringify(b.toJSON())),c.contentType="application/json",c.url=b.url(),Backbone.syncAbort(a,this,c)},unbindSQLView:function(a){this.sqlView.unbind(null,null,this),this.sqlView=null},getCurrentState:function(){return this.error?"error":"success"},bindSQLView:function(a){var b=this;this.sqlView=a,this.sqlView.bind("error",this.errorSQLView,this),this.sqlView.bind("reset",function(){b.table.isInSQLView()&&(b.error=!1,b.sqlView.modify_rows?(b.set({query:null}),b.invalidate(),b.table.useSQLView(null,{force_data_fetch:!0}),b.trigger("clearSQLView")):b.save({query:a.getSQL(),sql_source:a.sqlSource()}))},this);var c=this.get("query");c?this.applySQLView(c,{add_to_history:!1}):this.table.data().fetch()},bindTable:function(a){this.table=a;var b=this;b.table.bind("change:name",function(){b.get("table_name")!=b.table.get("name")&&b.fetch({success:function(){b.updateCartoCss(b.table.previous("name"),b.table.get("name"))}})}),this.table.bind("change:schema",this._manageInteractivity,this)},_manageInteractivity:function(){var a=null;if(this.wizard_properties.supportsInteractivity()){this.table.containsColumn("cartodb_id")&&(a=["cartodb_id"]);var b=this.tooltip.getInteractivity();b.length&&(a=(a||[]).concat(b)),a&&(a=a.join(","))}this.get("interactivity")!==a&&(this.isNew()?this.set({interactivity:a}):this.save({interactivity:a}))},updateCartoCss:function(a,b){var c=this.get("tile_style");if(c){var d=new RegExp("#"+a,"g");c=c.replace(d,"#"+b),this.save({tile_style:c})}},bindLegend:function(a){var b=this.get("legend");b&&this.legend.set(b),this.legend.bind("change:template change:type change:title change:show_title change:items",_.debounce(function(){this.isNew()||this.save(null,{silent:!0})},250),this)},bindInfowindow:function(a,b){b=b||"infowindow";var c=this.get(b);if(c)a.set(c);else{var d=0;_(this.table.get("schema")).each(function(b){_.contains(["the_geom","created_at","updated_at","cartodb_id"],b[0])||(a.addField(b[0],d),++d)})}this.table.linkToInfowindow(a);var e="change:fields change:template_name change:alternative_names change:template change:disabled change:width change:maxHeight",f=_.debounce(function(){a.unbind(e,f,this),a.removeMissingFields(this.table.columnNames()),a.bind(e,f,this),this.isNew()||this.save(null,{silent:!0})},250);a.bind(e,f,this)},resetQuery:function(){this.get("query")&&this.save({query:void 0,sql_source:null})},errorSQLView:function(a,b){this.save({query:null},{silent:!0}),this.trigger("errorSQLView",b),this.error=!0},clearSQLView:function(){this.table.useSQLView(null),this.addToHistory("query","SELECT * FROM "+cdb.Utils.safeTableNameQuoting(this.table.get("name"))),this.undoHistory("query"),this.resetQuery(),this.trigger("clearSQLView")},applySQLView:function(a,b){b=b||{add_to_history:!0,sql_source:null},this.table.useSQLView(this.sqlView),this.sqlView.setSQL(a,{silent:!0,sql_source:b.sql_source||null}),b.add_to_history&&this.addToHistory("query",a),this.sqlView.fetch(),this.trigger("applySQLView",a)},moveToFront:function(a){var b=this.collection,c=b.getDataLayers();b.moveLayer(this,{to:c.length})}},{createDefaultLayerForTable:function(a,b){return new cdb.admin.CartoDBLayer({user_name:b,table_name:a,tile_style:"#"+a+cdb.admin.CartoStyles.DEFAULT_GEOMETRY_STYLE,style_version:"2.1.0",visible:!0,interactivity:"cartodb_id",maps_api_template:cdb.config.get("maps_api_template"),no_cdn:!0})}}),_.extend(cdb.geo.ui.InfowindowModel.prototype,{toJSON:function(){var a=[];return this.attributes.disabled||(a=_.clone(this.attributes.fields)),{fields:a,template_name:this.attributes.template_name,template:this.attributes.template,alternative_names:this.attributes.alternative_names,old_fields:this.attributes.old_fields,old_template_name:this.attributes.old_template_name,width:this.attributes.width,maxHeight:this.attributes.maxHeight}},removeMissingFields:function(a){for(var b={},c=0;c<a.length;++c){var d=a[c];b[d]=!0}var e=this.get("fields");if(e)for(var c=0;c<e.length;++c){var f=e[c].name;f in b||this.removeField(f)}},addMissingFields:function(a){for(var b={},c=this.get("fields"),d=0;d<c.length;++d){var e=c[d].name;b[e]=!0}for(var d=0;d<a.length;++d){var f=a[d];f in b||this.addField(f)}},mergeFields:function(a){this.removeMissingFields(a),this.addMissingFields(a)},getInteractivity:function(){for(var a=this.get("fields")||[],b=[],c=0;c<a.length;++c)b.push(a[c].name);return b}}),cdb.admin.GMapsBaseLayer=cdb.geo.GMapsBaseLayer.extend({clone:function(){return new cdb.admin.GMapsBaseLayer(_.clone(this.attributes))},parse:function(a){var b={};return _.extend(b,a.options,{id:a.id,type:"GMapsBase",order:a.order,parent_id:a.parent_id}),b},toJSON:function(){var a=_.clone(this.attributes),b={kind:"gmapsbase",options:a,order:a.order};return void 0!==a.id&&(b.id=a.id),b}}),cdb.admin.WMSLayer=cdb.geo.WMSLayer.extend({clone:function(){return new cdb.admin.WMSLayer(_.clone(this.attributes))},_generateClassName:function(a){if(a){var b=a;return b&&parseInt(b)&&_.isNumber(parseInt(b))&&(b="w"+b),b.replace(/\s+/g,"").replace(/[^a-zA-Z_0-9 ]/g,"").toLowerCase()}return""},parse:function(a){var b=this,c={};return _.extend(c,a.options,{id:a.id,className:b._generateClassName(a.options.layers),type:"WMS",order:a.order,parent_id:a.parent_id}),c},toJSON:function(){var a=_.clone(this.attributes),b={kind:"wms",options:a,order:a.order};return void 0!==a.id&&(b.id=a.id),b}}),cdb.admin.PlainLayer=cdb.geo.PlainLayer.extend({parse:function(a){var b={};return _.extend(b,a.options,{id:a.id,type:"Plain",order:a.order,parent_id:a.parent_id}),b},toJSON:function(){var a=_.clone(this.attributes),b={kind:"background",options:a,order:a.order};return void 0!==a.id&&(b.id=a.id),b}}),cdb.admin.TileLayer=cdb.geo.TileLayer.extend({clone:function(){return new cdb.admin.TileLayer(_.clone(this.attributes))},_generateClassName:function(a){return a?a.replace(/\s+/g,"").replace(/[^a-zA-Z_0-9 ]/g,"").toLowerCase():""},parse:function(a){var b=this,c={};return _.extend(c,a.options,{id:a.id,className:b._generateClassName(a.options.urlTemplate),type:"Tiled",order:a.order,parent_id:a.parent_id}),c},toJSON:function(){var a=_.clone(this.attributes),b={kind:"tiled",options:a,order:a.order};return void 0!==a.id&&(b.id=a.id),b},validateTemplateURL:function(a){var b=["a","b","c"],c=new Image;c.onload=a.success,c.onerror=a.error,c.src=this.get("urlTemplate").replace(/\{s\}/g,function(){return b[Math.floor(3*Math.random())]}).replace(/\{x\}/g,"0").replace(/\{y\}/g,"0").replace(/\{z\}/g,"0")}},{byCustomURL:function(a,b){if(a&&a.indexOf("/")===-1)throw new TypeError("invalid URL");a=a.replace(/\{S\}/g,"{s}").replace(/\{X\}/g,"{x}").replace(/\{Y\}/g,"{y}").replace(/\{Z\}/g,"{z}");var c=new cdb.admin.TileLayer({urlTemplate:a,attribution:null,maxZoom:21,minZoom:0,name:"",tms:b});return c.set("className",c._generateClassName(a)),c}}),cdb.admin.TorqueLayer=cdb.admin.CartoDBLayer.extend({}),cdb.admin.Layers=cdb.geo.Layers.extend({_DATA_LAYERS:["CartoDB","torque"],model:function(a,b){var c={Tiled:cdb.admin.TileLayer,CartoDB:cdb.admin.CartoDBLayer,Plain:cdb.admin.PlainLayer,GMapsBase:cdb.admin.GMapsBaseLayer,WMS:cdb.admin.WMSLayer,torque:cdb.admin.CartoDBLayer},d={"Layer::Tiled":"Tiled","Layer::Carto":"CartoDB","Layer::Background":"Plain",tiled:"Tiled",carto:"CartoDB",wms:"WMS",background:"Plain",gmapsbase:"GMapsBase",torque:"torque"};return new c[d[a.kind]](a,b)},initialize:function(){this.bind("change:order",function(){this._isSorted()||this.sort()}),cdb.geo.Layers.prototype.initialize.call(this)},add:function(a,b){return Backbone.Collection.prototype.add.apply(this,arguments)},getTorqueLayers:function(){return this.where({type:"torque"})},getTiledLayers:function(){return this.where({type:"Tiled"})},getLayerDefIndex:function(a){var b=this.getLayersByType("CartoDB");if(!b.length)return-1;for(var c=0,d=0;c<b.length;++c)if(b[c].get("visible")){if(b[c].cid===a.cid)return d;++d}return-1},getLayerDef:function(){for(var a=this.getLayersByType("CartoDB"),b={version:"1.0.1",layers:[]},c=0;c<a.length;++c)a[c].get("visible")&&b.layers.push(a[c].getLayerDef());return b},getDataLayers:function(){var a=this;return this.filter(function(b){return _.contains(a._DATA_LAYERS,b.get("type"))})},getTotalDataLayers:function(){return this.getDataLayers().length},getTotalDataLegends:function(){
var a=this;return this.filter(function(b){return _.contains(a._DATA_LAYERS,b.get("type"))&&b.get("legend")&&b.get("legend").type&&"none"!==b.get("legend").type.toLowerCase()}).length},getLayersByType:function(a){return a&&""!==a?this.filter(function(b){return b.get("type")===a}):(cdb.log.info("a layer type is necessary to get layers"),0)},isLayerOnTopOfDataLayers:function(a){var b=this.getDataLayers().splice(-1)[0];return b.cid===a.cid},url:function(a){var b=cdb.config.urlVersion("layer",a);return"/api/"+b+"/maps/"+this.map.id+"/layers"},parse:function(a){return a.layers},saveLayers:function(a){a=a||{},this.save(null,a)},save:function(a,b){Backbone.sync("update",this,b)},toJSON:function(a){var b=_.map(this.models,function(b){return b.toJSON(a)});return{layers:b}},clone:function(a){return a=a||new cdb.admin.Layers,this.each(function(b){if(b.clone){var c=b.clone();c.unset("id"),a.add(c)}else{var d=_.clone(b.attributes);delete d.id,a.add(d)}}),a},_isSorted:function(){var a=_(this.models).map(function(a){return{cid:a.cid,order:a.get("order")}});return a.sort(function(a,b){return a.order-b.order}),_.isEqual(_(a).map(function(a){return a.cid}),_(this.models).map(function(a){return a.cid}))},moveLayer:function(a,b){b=b||{};var c=b.to,d=this.at(c);a.set("order",d.get("order"),{silent:!0}),this.remove(a,{silent:!0}),this.add(a,{at:c,silent:!0});for(var e=0;e<this.size();e++){var f=this.at(e);f.set("order",e)}this.trigger("reset"),this.saveLayers({complete:b.complete,error:function(){throw"Error saving layers after moving them"}})}}),cdb.admin.Map=cdb.geo.Map.extend({urlRoot:"/api/v1/maps",initialize:function(){this.constructor.__super__.initialize.apply(this),this.sync=Backbone.delayedSaveSync(Backbone.syncAbort,500),this.bind("change:id",this._fetchLayers,this),this.layers=new cdb.admin.Layers,this.layers.map=this,this.layers.bind("reset add change",this._layersChanged,this),this.layers.bind("reset add remove change:attribution",this._updateAttributions,this)},saveLayers:function(a){a=a||{};var b=function(){};this.layers.saveLayers({success:a.success||b,error:a.error||b})},_layersChanged:function(){this.layers.size()>=1&&(this._adjustZoomtoLayer(this.layers.at(0)),this.layers.size()>=2&&this.set({dataLayer:this.layers.at(1)}))},_fetchLayers:function(){this.layers.fetch()},relatedTo:function(a){this.table=a,this.table.bind("change:map_id",this._fetchOrCreate,this)},parse:function(a){return a.bounding_box_ne=JSON.parse(a.bounding_box_ne),a.bounding_box_sw=JSON.parse(a.bounding_box_sw),a.view_bounds_ne=JSON.parse(a.view_bounds_ne),a.view_bounds_sw=JSON.parse(a.view_bounds_sw),a.center=JSON.parse(a.center),a},_fetchOrCreate:function(){var a=this,b=this.table.get("map_id");b?(this.set({id:b}),this.fetch({error:function(){cdb.log.info("creating map for table"),a.create()}})):this.create()},setBaseLayer:function(a){if(this.trigger("savingLayers"),this.isBaseLayerAdded(a))return this.trigger("savingLayersFinish"),!1;var b=this,c=a,d=this.layers.at(0),e=c.get("labels")&&c.get("labels").url,f={success:function(){e||b.trigger("savingLayersFinish")},error:function(){cdb.log.error("error changing the basemap"),b.trigger("savingLayersFinish")}};return d?d.get("type")===c.get("type")?this._updateBaseLayer(d,c,f):this._replaceBaseLayer(d,c,f):this._addBaseLayer(c,f),f.success=function(){b.trigger("savingLayersFinish")},e?this._hasLabelsLayer()?this._updateLabelsLayer(c,f):this._addLabelsLayer(c,f):this._hasLabelsLayer()&&this._destroyLabelsLayer(f),c},_updateBaseLayer:function(a,b,c){var d=_.extend(_.clone(b.attributes),{id:a.get("id"),order:a.get("order")});a.clear({silent:!0}),a.set(d),a.save(null,c)},_replaceBaseLayer:function(a,b,c){this.layers.remove(a),b.set({id:a.get("id"),order:a.get("order")}),this.layers.add(b,{at:0}),b.save(null,c)},_addBaseLayer:function(a,b){this.layers.add(a,{at:0}),a.save(null,b)},_hasLabelsLayer:function(){return this.layers.size()>1&&"Tiled"===this.layers.last().get("type")},_updateLabelsLayer:function(a,b){var c=this.layers.last();c.set({name:this._labelsLayerNameFromBaseLayer(a),urlTemplate:a.get("labels").url,attribution:a.get("attribution"),minZoom:a.get("minZoom"),maxZoom:a.get("maxZoom"),subdomains:a.get("subdomains")}),c.save(null,b)},_addLabelsLayer:function(a,b){this.layers.add({name:this._labelsLayerNameFromBaseLayer(a),urlTemplate:a.get("labels").url,attribution:a.get("attribution"),minZoom:a.get("minZoom"),maxZoom:a.get("maxZoom"),subdomains:a.get("subdomains"),kind:"tiled"});var c=this.layers.last();c.save(null,b)},_destroyLabelsLayer:function(a){this.layers.last().destroy(a)},_labelsLayerNameFromBaseLayer:function(a){return a.get("name")+" Labels"},addDataLayer:function(a){this.addLayer(a),this.set({dataLayer:a})},create:function(){this.unset("id"),this.set({table_id:this.table.id}),this.save()},autoSave:function(){this.bind("change:center",this.save),this.bind("change:zoom",this.save)},toJSON:function(){var a=_.clone(this.attributes);return delete a.dataLayer,a},changeProvider:function(a,b){var c=this;if(b&&b.get("id"))return void cdb.log.error("the baselayer should not be saved in the server");var d=function(){b&&c.setBaseLayer(b)};this.get("provider")!==a?this.save({provider:a},{success:function(){d(),c.change()},error:function(a,b){c.error(_t("error switching base layer"),b)},silent:!0}):d()},isProviderGmaps:function(){var a=this.get("provider");return a&&a.toLowerCase().indexOf("googlemaps")!==-1},clone:function(a){a=a||new cdb.admin.Map;var b=_.clone(this.attributes);return delete b.id,a.set(b),a.set({center:_.clone(this.attributes.center),bounding_box_sw:_.clone(this.attributes.bounding_box_sw),bounding_box_ne:_.clone(this.attributes.bounding_box_ne),view_bounds_sw:_.clone(this.attributes.view_bounds_sw),view_bounds_ne:_.clone(this.attributes.view_bounds_ne),attribution:_.clone(this.attributes.attribution)}),this.layers.clone(a.layers),a.layers.map=a,a},notice:function(a,b,c){this.trigger("notice",a,b,c)},error:function(a,b){var c=b&&JSON.parse(b.responseText).errors[0];this.trigger("notice",a+" "+c,"error")},addCartodbLayerFromTable:function(a,b,c){c=c||{};var d=this,e=new cdb.admin.CartoDBTableMetadata({id:a});e.fetch({success:function(){var a=new cdb.admin.Map({id:e.get("map_id")});a.layers.bind("reset",function(){function b(){e.table.unbind("change:geometry_types",b),"torque"===e.wizard_properties.get("type")&&d.layers.getTorqueLayers().length&&e.wizard_properties.active("polygon"),d.layers.create(e,_.extend({wait:!0},c))}var e=a.layers.at(1).clone();e.unset("order"),e.isTableLoaded()?b():(e.table.bind("change:geometry_types",b),e.table.data().fetch())}),a.layers.fetch()}})},clamp:function(){var a=function(a,b){return Number((a-Math.floor(a/b)*b).toPrecision(8))},b=this.get("center"),c=b[1];return(c<-180||c>180)&&(c=a(180+c,360)-180,this.set("center",[b[0],c])),this}}),cdb.admin.Group=cdb.core.Model.extend({defaults:{display_name:""},initialize:function(a){this.parse(a||{})},parse:function(a){return this.users=new cdb.admin.GroupUsers(a.users,{group:this}),a}}),cdb.admin.UserGroups=Backbone.Collection.extend({model:cdb.admin.Group,initialize:function(a,b){this.organization=b.organization}}),cdb.admin.OrganizationGroups=Backbone.Collection.extend({model:cdb.admin.Group,url:function(a){var b=cdb.config.urlVersion("organizationGroups",a);return"/api/"+b+"/organization/"+this.organization.id+"/groups"},initialize:function(a,b){if(!b.organization)throw new Error("organization is required");this.organization=b.organization},parse:function(a){return this.total_entries=a.total_entries,a.groups},newGroupById:function(a){var b=this.get(a);return b||(b=new this.model({id:a}),b.collection=this),b},totalCount:function(){return this.total_entries}}),cdb.admin.UserLayers=cdb.admin.Layers.extend({url:function(a){var b=cdb.config.urlVersion("layer",a);return"/api/"+b+"/users/"+this.user.id+"/layers"},custom:function(){return this.where({category:void 0})}}),cdb.admin.User=cdb.core.Model.extend({urlRoot:"/api/v1/users",defaults:{avatar_url:"http://cartodb.s3.amazonaws.com/static/public_dashboard_default_avatar.png",username:""},initialize:function(a){a=a||{},this.tables=[],null===this.get("avatar_url")&&this.set("avatar_url",this.defaults.avatar_url),this.get("get_layers")&&(this.layers=new cdb.admin.UserLayers,this.layers.user=this,this._fetchLayers()),this.email="undefined"!=typeof a.email?a.email:"",this.get("organization")&&(this.organization=new cdb.admin.Organization(this.get("organization"),{currentUserId:this.id})),this.groups=new cdb.admin.UserGroups(a.groups,{organization:_.result(this.collection,"organization")||this.organization})},isInsideOrg:function(){return!!this.organization&&(0!=this.organization.id||this.isOrgOwner())},isOrgOwner:function(){return!!this.organization&&this.organization.owner.get("id")===this.get("id")},isOrgAdmin:function(){return!!this.organization&&this.organization.isOrgAdmin(this)},isViewer:function(){return 1==this.get("viewer")},isBuilder:function(){return!this.isViewer()},nameOrUsername:function(){return this.get("name")||this.get("username")},renderData:function(a){var b=this.get("username");return a&&a.id===this.id&&(b=_t("You")),{username:b,avatar_url:this.get("avatar_url")}},_fetchLayers:function(){this.layers.fetch({add:!0})},fetchTables:function(){var a=this;if(!this._fetchingTables){var b=new cdb.admin.Visualizations;b.options.set("type","table"),b.bind("reset",function(){a.tables=b.map(function(a){return a.get("name")})}),this._fetchingTables=!0,b.fetch()}},hasCreateDatasetsFeature:function(){return this.isBuilder()},canCreateDatasets:function(){return!(!this.get("remaining_byte_quota")||this.get("remaining_byte_quota")<=0)&&this.hasCreateDatasetsFeature()},hasCreateMapsFeature:function(){return this.isBuilder()},canAddLayerTo:function(a){if(!a||!a.layers||!a.layers.getDataLayers)throw new Error("Map model is not defined or wrong");var b=a.layers.getDataLayers();return b.length<this.getMaxLayers()},getMaxLayers:function(){return this.get("limits")&&this.get("limits").max_layers||5},getMaxConcurrentImports:function(){return this.get("limits")&&this.get("limits").concurrent_imports||1},featureEnabled:function(a){var b=this.get("feature_flags");return!(!b||0===b.length||!a)&&_.contains(b,a)},isCloseToLimits:function(){var a=this.get("quota_in_bytes"),b=this.get("remaining_byte_quota");return 100*b/a<20},getMaxLayersPerMap:function(){return this.get("max_layers")||4},canStartTrial:function(){return!this.isInsideOrg()&&"FREE"===this.get("account_type")&&this.get("table_count")>0},canCreatePrivateDatasets:function(){var a=this.get("actions");return a&&a.private_tables},equals:function(a){if(a.get)return this.get("id")===a.get("id")},viewUrl:function(){return new cdb.common.UserUrl({base_url:this.get("base_url"),is_org_admin:this.isOrgAdmin()})},upgradeContactEmail:function(){return this.isInsideOrg()?this.isOrgOwner()?"enterprise-support@carto.com":this.organization.owner.get("email"):"support@carto.com"},usedQuotaPercentage:function(){return 100*this.get("db_size_in_bytes")/this.organization.get("available_quota_for_user")},assignedQuotaInRoundedMb:function(){return Math.floor(this.get("quota_in_bytes")/1024/1024).toFixed(0)},assignedQuotaPercentage:function(){return 100*this.get("quota_in_bytes")/this.organization.get("available_quota_for_user")}}),cdb.admin.Permission=cdb.core.Model.extend({urlRoot:"/api/v1/perm",initialize:function(){this.acl=new Backbone.Collection,this.owner=null,this._generateOwner(),this._generateAcl(),this.bind("change:owner",this._generateOwner,this),this.bind("change:acl",this._generateAcl,this)},_generateOwner:function(){this.owner||(this.owner=new cdb.admin.User),this.owner.set(this.get("owner"))},_generateAcl:function(){this.acl.reset([],{silent:!0}),_.each(this.get("acl"),function(a){var b;switch(a.type){case"user":b=new cdb.admin.User(a.entity);break;case"org":b=new cdb.admin.Organization(a.entity);break;case"group":b=new cdb.admin.Group(a.entity);break;default:throw new Error("Unknown ACL item type: "+a.type)}this._grantAccess(b,a.access)},this)},cleanPermissions:function(){this.acl.reset()},hasAccess:function(a){return this.hasReadAccess(a)},hasReadAccess:function(a){return!!this.findRepresentableAclItem(a)},hasWriteAccess:function(a){var b=cdb.Utils.result(this.findRepresentableAclItem(a),"get","access");return b===cdb.admin.Permission.READ_WRITE},canChangeReadAccess:function(a){return this._canChangeAccess(a)},canChangeWriteAccess:function(a){return(!a.isBuilder||a.isBuilder())&&this._canChangeAccess(a,function(a){return cdb.Utils.result(a,"get","access")!==cdb.admin.Permission.READ_WRITE})},_canChangeAccess:function(a){var b=this.findRepresentableAclItem(a);return this.isOwner(a)||!b||b===this._ownAclItem(a)||cdb.Utils.result(arguments,1,b)||!1},grantWriteAccess:function(a){this._grantAccess(a,this.constructor.READ_WRITE)},grantReadAccess:function(a){this._grantAccess(a,this.constructor.READ_ONLY)},revokeWriteAccess:function(a){this.grantReadAccess(a)},revokeAccess:function(a){var b=this._ownAclItem(a);b&&this.acl.remove(b)},isOwner:function(a){return _.result(this.owner,"id")===_.result(a,"id")},toJSON:function(){return{entity:this.get("entity"),acl:this.acl.toJSON()}},getUsersWithAnyPermission:function(){return this.acl.chain().filter(this._hasTypeUser).map(this._getEntity).value()},isSharedWithOrganization:function(){return this.acl.any(this._hasTypeOrg)},clone:function(){var a=_.clone(this.attributes);return delete a.id,new cdb.admin.Permission(a)},overwriteAcl:function(a){this.acl.reset(a.acl.models)},findRepresentableAclItem:function(a){if(this.isOwner(a))return this._newAclItem(a,this.constructor.READ_WRITE);var b=["_ownAclItem","_organizationAclItem","_mostPrivilegedGroupAclItem"];return this._findMostPrivilegedAclItem(b,function(b){return this[b](a)})},_hasTypeUser:function(a){return"user"===a.get("type")},_getEntity:function(a){return a.get("entity")},_hasTypeOrg:function(a){return"org"===a.get("type")},_isOrganization:function(a){return a instanceof cdb.admin.Organization},_ownAclItem:function(a){if(a&&_.isFunction(a.isNew)||cdb.log.error("model is required to find an ACL item"),!a.isNew())return this.acl.find(function(b){return b.get("entity").id===a.id})},_organizationAclItem:function(a){var b=_.result(a.collection,"organization")||a.organization;if(b)return this._ownAclItem(b)},_mostPrivilegedGroupAclItem:function(a){var b=_.result(a.groups,"models");if(b)return this._findMostPrivilegedAclItem(b,this._ownAclItem)},_findMostPrivilegedAclItem:function(a,b){for(var c,d=0,e=a[d];e&&cdb.Utils.result(c,"get","access")!==cdb.admin.Permission.READ_WRITE;e=a[++d])c=b.call(this,e)||c;return c},_grantAccess:function(a,b){var c=this._ownAclItem(a);if(c)c.set("access",b);else{if(c=this._newAclItem(a,b),!c.isValid())throw new Error(b+" is not a valid ACL access");this.acl.add(c)}},_newAclItem:function(a,b){var c;if(a instanceof cdb.admin.User)c="user";else if(a instanceof cdb.admin.Group)c="group";else{if(!this._isOrganization(a))throw new Error("model not recognized as a valid ACL entity "+a);c="org"}return new cdb.admin.ACLItem({type:c,entity:a,access:b})}},{READ_ONLY:"r",READ_WRITE:"rw"}),cdb.admin.ACLItem=Backbone.Model.extend({defaults:{access:"r"},isOwn:function(a){return a.id===this.get("entity").id},validate:function(a,b){var c=cdb.admin.Permission;if(a.access!==c.READ_ONLY&&a.access!==c.READ_WRITE)return"access can't take 'r' or 'rw' values"},toJSON:function(){var a=_.pick(this.get("entity").toJSON(),"id","username","avatar_url","name");return a.username||(a.username=a.name,delete a.name),{type:this.get("type")||"user",entity:a,access:this.get("access")}}}),cdb.admin.GroupUsers=Backbone.Collection.extend({model:cdb.admin.User,initialize:function(a,b){if(!b.group)throw new Error("group is required");this.group=b.group},url:function(){return this.group.url.apply(this.group,arguments)+"/users"},parse:function(a){return this.total_entries=a.total_entries,this.total_user_entries=a.total_user_entries,a.users},addInBatch:function(a){return this._batchAsyncProcessUsers("POST",a)},removeInBatch:function(a){var b=this;return this._batchAsyncProcessUsers("DELETE",a).done(function(){_.each(a,b.remove.bind(b))})},_batchAsyncProcessUsers:function(a,b){var c=this,d=$.Deferred();return $.ajax({type:a,url:cdb.config.prefixUrl()+this.url(),data:{users:b},success:function(){var a=arguments;c.fetch({success:function(){d.resolve.apply(d,a)},error:function(){d.resolve.apply(d,a)}})},error:function(){d.reject.apply(d,arguments)}}),d},totalCount:function(){return this.total_user_entries}}),cdb.admin.Grantable=cdb.core.Model.extend({initialize:function(){this.entity=this._createEntity()},_createEntity:function(){var a=cdb.Utils.capitalize(this.get("type")),b=new cdb.admin[a](this.get("model"));return b.organization=this.collection.organization,b}}),cdb.admin.Grantables=Backbone.Collection.extend({model:cdb.admin.Grantable,url:function(a){var b=cdb.config.urlVersion("organizationGrantables",a);return"/api/"+b+"/organization/"+this.organization.id+"/grantables"},initialize:function(a,b){if(!b.organization)throw new Error("organization is required");this.organization=b.organization,this.currentUserId=b.currentUserId,this.sync=Backbone.syncAbort},parse:function(a){return this.total_entries=a.total_entries,_.reduce(a.grantables,function(a,b){return b.id===this.currentUserId?this.total_entries--:a.push(b),a},[],this)},totalCount:function(){return this.total_entries}}),cdb.admin.Organization=cdb.core.Model.extend({url:"/api/v1/org/",initialize:function(a,b){a=a||{},this.owner=new cdb.admin.User(this.get("owner")),this.display_email="undefined"!=typeof a.admin_email&&null!=a.admin_email&&(""==a.admin_email?this.owner.email:a.admin_email);var c={organization:this,currentUserId:b&&b.currentUserId};this.users=new cdb.admin.Organization.Users(a.users,c),this.groups=new cdb.admin.OrganizationGroups(a.groups,c),this.grantables=new cdb.admin.Grantables(void 0,c),this.users.each(this._setOrganizationOnModel,this),this.groups.each(this._setOrganizationOnModel,this)},_setOrganizationOnModel:function(a){a.organization=this},fetch:function(){throw new Error("organization should not be fetch, should be static")},containsUser:function(a){return!!this.users.find(function(b){return b.id===a.id})},isOrgAdmin:function(a){return this.owner.id===a.id||!!_.find(this.get("admins"),function(b){return b.id===a.id})},viewUrl:function(){return new cdb.common.OrganizationUrl({base_url:this.get("base_url")})}}),cdb.admin.Organization.Users=Backbone.Collection.extend({model:cdb.admin.User,_DEFAULT_EXCLUDE_CURRENT_USER:!0,url:function(){return"/api/v1/organization/"+this.organization.id+"/users"},initialize:function(a,b){if(!b.organization)throw new Error("Organization is needed for fetching organization users");this.elder("initialize"),this.organization=b.organization,this.currentUserId=b.currentUserId,this._excludeCurrentUser=this._DEFAULT_EXCLUDE_CURRENT_USER,this.sync=Backbone.syncAbort},comparator:function(a){return a.get("username")},excludeCurrentUser:function(a){a=!!a,this._excludeCurrentUser=a,a&&!this.currentUserId&&cdb.log.error("set excludeCurrentUser to true, but there is no current user id set to exclude!")},restoreExcludeCurrentUser:function(){this.excludeCurrentUser(this._DEFAULT_EXCLUDE_CURRENT_USER)},parse:function(a){return this.total_entries=a.total_entries,this.total_user_entries=a.total_user_entries,_.reduce(a.users,function(a,b){return this._excludeCurrentUser&&b.id===this.currentUserId?(this.total_user_entries--,this.total_entries--):a.push(b),a},[],this)},totalCount:function(){return this.total_user_entries}}),cdb.admin.Organization.Invites=cdb.core.Model.extend({defaults:{users_emails:[],welcome_text:"I'd like to invite you to my CARTO organization,\nBest regards"},url:function(){return"/api/v1/organization/"+this.organizationId+"/invitations"},initialize:function(a,b){if(!b.organizationId)throw new Error("Organization id is needed for fetching organization users");this.organizationId=b.organizationId}}),cdb.admin.Like=cdb.core.Model.extend({defaults:{likeable:!0},url:function(a){var b=cdb.config.urlVersion("like",a);return"/api/"+b+"/viz/"+this.get("vis_id")+"/like"},initialize:function(){_.bindAll(this,"_onSaveError"),this.on("destroy",function(){this.set({liked:!1,likes:this.get("likes")-1})},this)},_onSaveError:function(a,b){this.trigger("error",{status:b.status,statusText:b.statusText})},toggleLiked:function(){this.get("liked")?this.destroy():(this.set({id:null},{silent:!0}),this.save({},{error:this._onSaveError}))}},{newByVisData:function(a){var b=_.defaults({id:a.liked?a.vis_id:null},_.omit(a,"url")),c=new cdb.admin.Like(b);return a.url&&(c.url=a.url),c}}),cdb.Utils={},cdb.Utils.stripHTML=function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a&&"string"==typeof a?a.replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""}):""},cdb.Utils.removeHTMLEvents=function(a){return a?a.replace(/ on\w+="[^"]*"/g,""):""},cdb.Utils.truncate=function(a,b){return a.substr(0,b-1)+(a.length>b?"&hellip;":"")},cdb.Utils.isURL=function(a){var b=/^((http|https|ftp)\:\/\/)/g;return!!a&&b.test(a)},cdb.Utils.encodeURLParams=function(a){if(this.isURL(a)){var b=a.split("?");return b.length>1?b[0]+"?"+encodeURIComponent(b[1]):a}return a},cdb.Utils.readablizeBytes=function(a,b){if(!a||isNaN(a))return 0;var c=["bytes","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024)),e=(a/Math.pow(1024,Math.floor(d))).toFixed(2);return b&&(e=parseInt(e)),e+" "+c[d]},cdb.Utils.isEmpty=function(a){return!a||0===a.length},cdb.Utils.isBlank=function(a){return!a||/^\s*$/.test(a)},cdb.Utils.formatNumber=function(a){if(!a)return"0";var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")},cdb.Utils.rgbToHex=function(a,b,c){function d(a){var b=a.toString(16);return 1==b.length?"0"+b:b}return"#"+d(a)+d(b)+d(c)},cdb.Utils.hexToRGB=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},cdb.Utils.genRandomPass=function(a){function b(){var a=Math.random();return a=parseInt(1e3*a),a=a%94+33}function c(a){return a>=33&&a<=47||(a>=58&&a<=64||(a>=91&&a<=96||a>=123&&a<=126))}a=isNaN(a)?"":a;var d="",e=!a;for(e&&(a=Math.random(),a=parseInt(100*a),a=a%7+6),i=0;i<a;i++){for(numI=b();c(numI);)numI=b();d+=String.fromCharCode(numI)}return d},cdb.Utils.pad=function(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c},cdb.Utils.sanitizeString=function(a){return a.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"-")},cdb.Utils.readizableNumber=function(a){return a>=1e9?(a/1e9).toFixed(1)+"G":a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a},cdb.Utils.getFileExtension=function(a){return a?a.substr(a.lastIndexOf(".")+1):""},cdb.Utils.getGetOrdinal=function(a){if(!a)return"";var b=["th","st","nd","rd"],c=a%100;return a+(b[(c-20)%10]||b[c]||b[0])},cdb.Utils.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},cdb.Utils.isValidEmail=function(a){var b=/^([^@]+)@([^@]+)\.([^@\.]+)$/i;return b.test(a)},cdb.Utils.result=function(a,b){if(null==a)return null;var c=a[b];return _.isFunction(c)?c.apply(a,Array.prototype.slice.call(arguments,2)):c},cdb.Utils.safeTableNameQuoting=function(a){return void 0===a||a.indexOf("-")===-1||'"'===a[0]||'"'===a[a.length-1]?a:'"'+a+'"'},cdb.admin.DropdownMenu=cdb.ui.common.Dropdown.extend({show:function(){var a=$.Deferred(),b=this;return this.delegateEvents(),this.$el.css({marginTop:"down"==b.options.vertical_position?"-10px":"10px",opacity:0,display:"block"}).animate({margin:"0",opacity:1},{duration:this.options.speedIn,complete:function(){a.resolve()}}),this.trigger("onDropdownShown",this.el),a.promise()},openAt:function(a,b){var c=$.Deferred();return this.$el.css({top:b,left:a,width:this.options.width}).addClass(("up"==this.options.vertical_position?"vertical_top":"vertical_bottom")+" "+("right"==this.options.horizontal_position?"horizontal_right":"horizontal_left")+" tick_"+this.options.tick),this.isOpen=!0,$.when(this.show()).done(function(){c.resolve()}),c.promise()},hide:function(a){if(!this.isOpen)return void(a&&a());var b=this;this.isOpen=!1,this.$el.animate({marginTop:"down"==b.options.vertical_position?"10px":"-10px",opacity:0},this.options.speedOut,function(){$(b.options.target).removeClass("selected"),b.$el.hide(),a&&a(),b.trigger("onDropdownHidden",b.el)})}}),cdb.common.Url=cdb.core.Model.extend({initialize:function(a){if(!a.base_url)throw new Error("base_url is required")},urlToPath:function(){return cdb.common.Url.byBaseUrl(this.toString.apply(this,arguments))},pathname:function(){return this.toString().match(/^.+\/\/[^\/]+(.*)$/)[1]},toString:function(){return this._joinArgumentsWithSlashes(this.get("base_url"),Array.prototype.slice.call(arguments,0))},_joinArgumentsWithSlashes:function(){return _.chain(arguments).flatten().compact().value().join("/")}},{byBaseUrl:function(a){return new cdb.common.Url({base_url:a})}}),cdb.common.DashboardVisUrl=cdb.common.Url.extend({lockedItems:function(){return this.urlToPath("locked")},sharedItems:function(){return this.urlToPath("shared")},likedItems:function(){return this.urlToPath("liked")}}),cdb.common.DashboardDatasetsUrl=cdb.common.DashboardVisUrl.extend({dataLibrary:function(){return this.urlToPath("library")}}),cdb.common.DashboardUrl=cdb.common.Url.extend({datasets:function(){return new cdb.common.DashboardDatasetsUrl({base_url:this.urlToPath("datasets")})},maps:function(){return new cdb.common.DashboardVisUrl({base_url:this.urlToPath("maps")})},deepInsights:function(){return new cdb.common.DashboardVisUrl({base_url:this.urlToPath("deep-insights")})}}),cdb.common.DatasetUrl=cdb.common.Url.extend({edit:function(){return this.urlToPath()},public:function(){return this.urlToPath("public")}}),cdb.common.MapUrl=cdb.common.Url.extend({edit:function(){return this.urlToPath("map")},public:function(){return this.urlToPath("public_map")},deepInsights:function(){return this.urlToPath("deep-insights")}}),cdb.common.OrganizationUrl=cdb.common.Url.extend({edit:function(a){if(!a)throw new Error("User is needed to create the url");return this.urlToPath(a.get("username")+"/edit")},create:function(){return this.urlToPath("new")},groups:function(){return this.urlToPath("groups")}}),cdb.common.UserUrl=cdb.common.Url.extend({initialize:function(a){if(cdb.common.Url.prototype.initialize.apply(this,arguments),_.isUndefined(a.is_org_admin))throw new Error("is_org_admin is required")},organization:function(){return this.get("is_org_admin")?new cdb.common.OrganizationUrl({base_url:this.urlToPath("organization")}):this.urlToPath("account")},accountSettings:function(){return this.urlToPath("profile")},publicProfile:function(){return this.urlToPath("me")},apiKeys:function(){return this.urlToPath("your_apps")},logout:function(){return this.urlToPath("logout")},dashboard:function(){return new cdb.common.DashboardUrl({base_url:this.urlToPath("dashboard")})}});
//# sourceMappingURL=user_feed_deps.js.map