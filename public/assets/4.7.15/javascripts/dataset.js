/*! v4.7.15 - 2017-05-30 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./custom-carousel/custom-carousel-view");b.exports=e.extend({initialize:function(a){if(!a.collection)throw new Error("Carousel collection is required");if(!a.template)throw new Error("template is required");this.template=a.template,this._initBinds()},render:function(){var a=this.collection.getSelected(),b=a&&a.getName();return this.$el.html(this.template({name:b})),this._initViews(),this},_initBinds:function(){this.collection.bind("change:highlighted",this._onChangeHighlighted,this)},_initViews:function(){var a=new f(d.extend(this.options,{collection:this.collection}));if(!this.$(".js-selector").length)throw new Error("HTML element with js-selector class is required");this.$(".js-selector").append(a.render().el),a.initScroll(),this.addView(a)},_onChangeHighlighted:function(){var a=this.collection.getHighlighted()||this.collection.getSelected();if(a){var b=this.$(".js-highlight");b&&b.text(a.getName())}}})},{"./custom-carousel/custom-carousel-view":20,"backbone/core-view":454,underscore:"underscore"}],2:[function(a,b,c){var d=a("../../helpers/color-keywords");b.exports=function(a){a.defineMode("cartocss",function(a){function b(a,b){return k=b,a}function c(a){for(var b=0;b<m.length;b++)if(a===m[b])return!0}function e(a,d){var e=a.next();if("@"===e)return a.eatWhile(/[\w\-]/),b("meta",a.current());if("/"===e&&a.eat("*"))return d.tokenize=h,h(a,d);if("<"===e&&a.eat("!"))return d.tokenize=i,i(a,d);if("="===e)b(null,"compare");else{if("|"===e&&a.eat("="))return b(null,"compare");if("'"===e||"'"===e)return d.tokenize=j(e),d.tokenize(a,d);if("/"===e){if(a.eat("/"))return d.tokenize=g,g(a,d);if("string"===k||"("===k)return b("string","string");if(void 0!==d.stack[d.stack.length-1])return b(null,e);if(a.eatWhile(/[\a-zA-Z0-9\-_.\s]/),/\/|\)|#/.test(a.peek()||a.eatSpace()&&")"===a.peek())||a.eol())return b("string","string")}else{if("!"===e)return a.match(/^\s*\w*/),b("keyword","important");if(/\d/.test(e))return a.eatWhile(/[\w.%]/),b("number","unit");if(/[,+<>*\/]/.test(e))return"="===a.peek()||"a"===k?b("string","string"):b(null,"select-op");if(!/[;{}:\[\]()~\|]/.test(e)){if("."===e)return"("===k||"string"===k?b("string","string"):(a.eatWhile(/[\a-zA-Z0-9\-_]/)," "===a.peek()&&a.eatSpace(),")"===a.peek()?b("number","unit"):b("tag","tag"));if("#"===e)return a.eatWhile(/[A-Za-z0-9]/),(4===a.current().length||7===a.current().length)&&null!=a.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,!1)?a.current().substring(1)!==a.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,!1)[0]?b("atom","tag"):(a.eatSpace(),/[\/<>.({!$%^&*_\-\\?=+\|#'~`]/.test(a.peek())?b("atom","tag"):"}"===a.peek()?b("color","unit"):/[a-zA-Z\\]/.test(a.peek())?b("color","unit"):a.eol()?b("color","unit"):b("color","unit")):(a.eatWhile(/[\w\\\-]/),b("atom","tag"));if("&"===e)return a.eatWhile(/[\w\-]/),b(null,e);if(a.eatWhile(/[\w\\\-_%.{]/),"string"===k)return b("string","string");if(null!=a.current().match(/(^http$|^https$)/))return a.eatWhile(/[\w\\\-_%.{:\/]/),b("string","string");if("<"===a.peek()||">"===a.peek())return b("tag","tag");if(/\(/.test(a.peek()))return b(null,e);if("/"===a.peek()&&void 0!==d.stack[d.stack.length-1])return b("string","string");if(a.current().match(/\-\d|\-.\d/))return b("number","unit");if(c(a.current().toLowerCase()))return b("tag","tag");if(/\/|[\s\)]/.test(a.peek()||a.eol()||a.eatSpace()&&"/"===a.peek())&&a.current().indexOf(".")!==-1)return"{"===a.current().substring(a.current().length-1,a.current().length)?(a.backUp(1),b("tag","tag")):(a.eatSpace(),/[{<>.a-zA-Z\/]/.test(a.peek())||a.eol()?b("tag","tag"):b("string","string"));if(a.eol()||"["===a.peek()||"#"===a.peek()||"tag"===k)return"{"===a.current().substring(a.current().length-1,a.current().length)&&a.backUp(1),b("tag","tag");if("compare"===k||"a"===k||"("===k)return b("string","string");if("|"===k||"-"===a.current()||"["===k)return b(null,e);if(":"===a.peek()){a.next();var f=":"===a.peek();if(f)a.backUp(1);else{var l=a.pos,m=a.current().length;a.eatWhile(/[a-z\\\-]/);var p=a.pos;if(null!=a.current().substring(m-1).match(o))return a.backUp(p-(l-1)),b("tag","tag");a.backUp(p-(l-1))}return f?b("tag","tag"):b("variable","variable")}return n.hasOwnProperty(a.current())?b("color","unit"):b("variable","variable")}if(":"===e)return a.eatWhile(/[a-z\\\-]/),o.test(a.current())?b("tag","tag"):":"===a.peek()?(a.next(),a.eatWhile(/[a-z\\\-]/),a.current().match(/\:\:\-(o|ms|moz|webkit)\-/)?b("string","string"):o.test(a.current().substring(1))?b("tag","tag"):b(null,e)):b(null,e);if("~"!==e)return b(null,e);if("r"===k)return b("string","string")}}}function f(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=!0;return b}function g(a,c){return a.skipToEnd(),c.tokenize=e,b("comment","comment")}function h(a,c){for(var d,f=!1;null!=(d=a.next());){if(f&&"/"===d){c.tokenize=e;break}f="*"===d}return b("comment","comment")}function i(a,c){for(var d,f=0;null!=(d=a.next());){if(f>=2&&">"===d){c.tokenize=e;break}f="-"===d?f+1:0}return b("comment","comment")}function j(a){return function(c,d){for(var f,g=!1;null!=(f=c.next())&&(f!==a||g);)g=!g&&"\\"===f;return g||(d.tokenize=e),b("string","string")}}var k,l=a.indentUnit,m="a abbr acronym address applet area article aside audio b base basefont bdi bdo big blockquote body br button canvas caption cite code col colgroup command datalist dd del details dfn dir div dl dt em embed fieldset figcaption figure font footer form frame frameset h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins keygen kbd label legend li link map mark menu meta meter nav noframes noscript object ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr track tt u ul var video wbr".split(" "),n=f(d),o=/(^\:root$|^\:nth\-child$|^\:nth\-last\-child$|^\:nth\-of\-type$|^\:nth\-last\-of\-type$|^\:first\-child$|^\:last\-child$|^\:first\-of\-type$|^\:last\-of\-type$|^\:only\-child$|^\:only\-of\-type$|^\:empty$|^\:link|^\:visited$|^\:active$|^\:hover$|^\:focus$|^\:target$|^\:lang$|^\:enabled^\:disabled$|^\:checked$|^\:first\-line$|^\:first\-letter$|^\:before$|^\:after$|^\:not$|^\:required$|^\:invalid$)/;return{startState:function(a){return{tokenize:e,baseIndent:a||0,stack:[]}},token:function(a,b){if(a.eatSpace())return null;var c=b.tokenize(a,b),d=b.stack[b.stack.length-1];return"hash"===k&&"rule"===d?c="atom":"variable"===c&&("rule"===d?c=null:d&&"@media{"!==d||(c="when"===a.current()?"variable":/[\s,|\s\)|\s]/.test(a.peek())?"tag":k)),"rule"===d&&/^[\{\};]$/.test(k)&&b.stack.pop(),"{"===k?"@media"===d?b.stack[b.stack.length-1]="@media{":b.stack.push("{"):"}"===k?b.stack.pop():"@media"===k?b.stack.push("@media"):"{"===d&&"comment"!==k&&b.stack.push("rule"),c},indent:function(a,b){var c=a.stack.length;return/^\}/.test(b)&&(c-="rule"===a.stack[a.stack.length-1]?2:1),a.baseIndent+c*l},electricChars:"}"}}),a.defineMIME("text/x-carto","cartocss")}},{"../../helpers/color-keywords":425}],3:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<i class="CodeMirror-bullet"></i>';return __p}},{underscore:"underscore"}],4:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="CodeMirror-error">\n  <li class="CodeMirror-errorMessage u-lSpace--xl u-rSpace--xl">\n    '+(null==(__t=_t("components.codemirror.syntax-error"))?"":_.escape(__t))+". "+(null==(__t=_t("components.codemirror.line"))?"":_.escape(__t))+" "+(null==(__t=line)?"":_.escape(__t))+": <span>"+(null==(__t=message)?"":_.escape(__t))+"</span>\n  </li>\n</ul>\n";return __p}},{underscore:"underscore"}],5:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("codemirror"),g=a("./colorpicker.code-mirror"),h=a("./code-mirror.tpl"),i=a("./code-mirror-bullet.tpl"),j=a("./code-mirror-error.tpl");a("./mode/sql")(f),a("./mode/mustache")(f),a("./cartocss.code-mirror")(f),a("./scroll.code-mirror")(f),a("./show-hint.code-mirror")(f),a("./hint/custom-list-hint")(f),a("./searchcursor.code-mirror")(f),a("./placeholder.code-mirror")(f);var k=27,l=13,m=[k,l],n={"color-picker":g};b.exports=d.extend({className:"Editor-content",options:{readonly:!1,lineNumbers:!0,autocompleteChars:3},initialize:function(a){if(!a)throw new Error("options for codemirror are required.");if(!a.model)throw new Error("Model for codemirror is required.");if(void 0===a.model.get("content")&&void 0===a.placeholder)throw new Error("Content property or placeholder for codemirror is required.");if(void 0===a.tip)throw new Error("tip message is required");this._autocompleteChars=a.autocompleteChars||this.options.autocompleteChars,this._mode=a.mode||"cartocss",this._addons=a.addons,this._hints=a.hints,this._autocompletePrefix=a.autocompletePrefix,this._autocompleteTriggers=a.autocompleteTriggers,this._autocompleteSuffix=a.autocompleteSuffix,this._errorTemplate=a.errorTemplate||j,this._tip=a.tip,this._lineWithErrors=[],this._onInputRead=e.bind(this._onKeyUpEditor,this),this._placeholder=a.placeholder},render:function(){return this.$el.html(h({content:this.model.get("content"),tip:this._tip})),this._initViews(),this._bindEvents(),this._showErrors(),this},_initViews:function(){var a=e.defaults(e.extend({},this.model.toJSON()),this.options),b=a.readonly,c=a.lineNumbers,d={"Ctrl-S":this.triggerApplyEvent.bind(this),"Cmd-S":this.triggerApplyEvent.bind(this),"Ctrl-Space":this._completeIfAfterCtrlSpace.bind(this)};this.editor=f.fromTextArea(this.$(".js-editor").get(0),{lineNumbers:c,theme:"material",mode:this._mode,scrollbarStyle:"simple",lineWrapping:!0,readOnly:b,extraKeys:d,placeholder:this._placeholder}),this.editor.on("change",e.debounce(this._onCodeMirrorChange.bind(this),150),this),e.isEmpty(this._addons)||e.each(this._addons,function(a){var b=n[a],c=new b({editor:this.editor});c.bind("codeSaved",this.triggerApplyEvent,this),this.$el.append(c.el),this.addView(c)},this),this._hints&&this.editor.on("keyup",this._onInputRead),this._toggleReadOnly(),setTimeout(function(){this.editor.refresh()}.bind(this),0)},_completeIfAfterCtrlSpace:function(a){var b=this._autocompletePrefix,c={},d=a.getCursor();return b&&a.getRange(f.Pos(d.line,d.ch-b.length),d)!==b&&(c={autocompletePrefix:b}),this._completeAfter(a,c)},updateHints:function(a){this._hints=a},_onKeyUpEditor:function(a,b){var c=b.keyCode,d=this._hints,g=this._autocompleteChars-1,h=this._autocompletePrefix;if(m.indexOf(c)===-1){var i=this;this._autocompleteTimeout&&clearTimeout(this._autocompleteTimeout),this._autocompleteTimeout=setTimeout(function(){var b={},c=a.getCursor(),j=a.getTokenAt(c).string;return j=j.toLowerCase(),h&&a.getRange(f.Pos(c.line,c.ch-h.length),c)!==h&&(b={autocompletePrefix:h}),i._completeAfter(a,b,function(){var a=function(a){var b=e.isObject(a)?a.text:a;return b=b.toLowerCase(),b.indexOf(j)!==-1};if(j.length>g){var b=e.filter(d,a);return b.length>0||h&&h===j}})},150)}},_onCodeMirrorChange:function(){this.trigger("codeChanged")},_completeAfter:function(a,b,c){return c&&!c()||a.state.completionActive||this._showAutocomplete(a,e.extend({},b)),f.Pass},_showAutocomplete:function(a,b){var c=b&&b.autocompletePrefix;f.showHint(a,f.hint["custom-list"],{completeSingle:!1,list:this._hints,autocompletePrefix:c,autocompleteSuffix:this._autocompleteSuffix})},_bindEvents:function(){var a=this;this.editor.on("change",function(b,c){a.model.set("content",a.getContent(),{silent:!0})}),this.model.on("change:content",function(){this.setContent(this.model.get("content"))},this),this.model.on("change:readonly",this._toggleReadOnly,this),this.model.on("change:errors",function(){this._showErrors()},this),this.model.on("undo redo",function(){this.setContent(this.model.get("content"))},this)},_toggleReadOnly:function(){var a=!!this.model.get("readonly");this.editor.setOption("readOnly",a),a?(this.editor.setOption("theme",""),this._getInfo().hide()):(this.editor.setOption("theme","material"),this._getInfo().show())},search:function(a,b){var c=this.editor.getSearchCursor(a,null,!0);return c.find(),c.pos},markReadOnly:function(a,b){var c={readOnly:!0,inclusiveLeft:!0};this.editor.markText(a,b,c);for(var d=a.line;d<=b.line;d++)this.editor.addLineClass(d,"background","CodeMirror-readonlyLine")},setContent:function(a){this.editor.setValue(a)},getContent:function(){return this.editor.getValue()},triggerApplyEvent:function(){this.trigger("codeSaved",this.getContent(),this)},destroyEditor:function(){this.editor.off("change");var a=this.editor.getWrapperElement();a.parentNode.removeChild(a)},_getInfo:function(){return this.$(".js-console")},_getConsole:function(){return this.$(".js-console-error")},_getCode:function(){return this.$(".CodeMirror-code")},_removeErrors:function(){this._getConsole().empty(),e.each(this._lineWithErrors,function(a){a.find(".CodeMirror-bullet").remove(),a.find(".CodeMirror-linenumber").removeClass("has-error")}),this._lineWithErrors=[]},_showErrors:function(){var a=this.model.get("errors");this._removeErrors(),a&&a.length>0&&e.each(a,function(a){this._renderError(a),this._renderBullet(a)},this)},_renderBullet:function(a){var b,c=a.line;c&&(b=this._getCode().children().eq(+c-1),b.append(i),b.find(".CodeMirror-linenumber").addClass("has-error"),this._lineWithErrors.push(b))},_renderError:function(a){this._getConsole().append(this._errorTemplate(a))},clean:function(){this.destroyEditor(),d.prototype.clean.apply(this)}})},{"./cartocss.code-mirror":2,"./code-mirror-bullet.tpl":3,"./code-mirror-error.tpl":4,"./code-mirror.tpl":6,"./colorpicker.code-mirror":7,"./hint/custom-list-hint":8,"./mode/mustache":9,"./mode/sql":10,"./placeholder.code-mirror":11,"./scroll.code-mirror":12,"./searchcursor.code-mirror":13,"./show-hint.code-mirror":14,"backbone/core-view":454,codemirror:"codemirror",underscore:"underscore"}],6:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CodeMirror-editor">\n  <textarea class="js-editor">'+(null==(__t=content)?"":_.escape(__t))+"</textarea>\n</div>\n\n",tip&&(__p+='\n<div class="CodeMirror-console js-console">\n  '+(null==(__t=tip)?"":_.escape(__t))+'\n  <div class="js-console-error"></div>\n</div>\n'),__p+="";return __p}},{underscore:"underscore"}],7:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("underscore"),g=a("../form-components/editors/fill/color-picker/color-picker.js"),h=a("../../helpers/color-keywords"),i=["editor"],j=f.template("1px solid  <%- color %>"),k=220,l=function(a){a.stopPropagation()};b.exports=d.extend({initialize:function(a){f.each(i,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._updateColors=f.debounce(this._updateColors,5).bind(this),this._onDocumentClick=this._onDocumentClick.bind(this),this._editor=a.editor,this._initBinds()},_initBinds:function(){var a=this,b=function(){this._destroyPicker()}.bind(this);this._enableUpdateBind(),this._editor.on("mousedown",function(b,c){f.delay(a._onClick.bind(a,b,c),50)}),this._editor.on("keydown",b),this._editor.on("viewportChange",b),this._editor.on("scroll",b);var c=this._editor.getWrapperElement();c.addEventListener("click",l)},_disableBinds:function(){var a=this._editor.getWrapperElement();a.removeEventListener("click",l),this._editor.off(null,null,this)},_enableUpdateBind:function(){this._editor.on("update",this._updateColors)},_disableUpdateBind:function(){this._editor.off("update",this._updateColors)},_onClick:function(a,b){var c=this._editor.getCursor(!0),d=this._editor.getTokenAt(c);"color"===d.type?this._createPicker(b,c,d):this._destroyPicker()},_updateColors:function(a){var b=a.getWrapperElement();f.each(b.querySelectorAll(".cm-color"),function(a){this._paintColor(a.textContent,a)},this)},_replaceColor:function(a,b){var c,d,e=this._editor.getCursor(),g=this._getMatch(e,"name"),h=this._getMatch(e,"hex"),i=g||h;if(i){c={line:e.line,ch:i.start},d={line:e.line,ch:i.end},this._editor.replaceRange(a,c,d,"paste");var j=this._editor.getWrapperElement();f.each(j.querySelectorAll(".cm-color"),function(a){var b=a.style,c=a.innerText;b&&b.borderBottom||this._paintColor(c,a)},this)}},_paintColor:function(a,b){b.style.borderBottom=j({color:a})},_getMatch:function(a,b){if(b){var c;switch(b.toLowerCase()){case"name":c=new RegExp(h.join("|"),"g");break;case"hsl":c=/hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)/g;break;case"rgb":c=/rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)/;break;case"hex":c=/#[a-fA-F0-9]{3,6}/g;break;default:return void console.log("Invalid color match selection")}for(var d=this._editor.getLine(a.line),e=c.exec(d);e;){var f=e[0],g=f.length,i=e.index,j=e.index+g;if(a.ch>=i&&a.ch<=j)return e=null,{start:i,end:j,string:f};e=c.exec(d)}}},_createPicker:function(a,b,c){var d=this._editor.cursorCoords();this._destroyPicker(),this._colorPicker=new g({className:"Editor-boxModal ColorPicker--cm Editor-boxModal--darked Editor-FormDialog CDB-Text",value:c.string,disableOpacity:!0}),this._colorPicker.$el.attr("data-colorpicker-cid",this.cid),this._colorPicker.bind("change",f.debounce(this._onColorPickerChange.bind(this,a),5),this);var h=d.top+20,i=e(window).outerHeight();h+k>i&&(h=d.top-k-20),this._colorPicker.$el.css({left:d.left,top:h}),document.body.appendChild(this._colorPicker.render().el),document.addEventListener("click",this._onDocumentClick)},_onDocumentClick:function(a){var b=e(a.target);0===b.closest('[data-colorpicker-cid="'+this.cid+'"]').length&&this._destroyPicker()},_onColorPickerChange:function(a,b){this._disableUpdateBind(),this._replaceColor(b.hex,a.target),this.trigger("codeSaved"),this._enableUpdateBind()},_destroyPicker:function(){this._colorPicker&&(this.removeView(this._colorPicker),this._colorPicker.clean(),delete this._colorPicker),document.removeEventListener("click",this._onDocumentClick)},clean:function(){this._disableBinds(),d.prototype.clean.call(this)}})},{"../../helpers/color-keywords":425,"../form-components/editors/fill/color-picker/color-picker.js":69,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],8:[function(a,b,c){var d=a("underscore");b.exports=function(a){function b(a,b){return a.indexOf(b)!==-1}function c(b,c,d,e){var h=b.getCursor(),i=d(b,h),j=i;for(i.state=a.innerMode(b.getMode(),i.state).state,/^[\w$_-]*$/.test(i.string)||(i=j={start:h.ch,end:h.ch,string:"",state:i.state,type:"."===i.string?"property":null});"property"===j.type;){if(j=d(b,g(h.line,j.start)),"."!==j.string)return;if(j=d(b,g(h.line,j.start)),")"===j.string){var k=1;do switch(j=d(b,g(h.line,j.start)),j.string){case")":k++;break;case"(":k--}while(k>0);if(j=d(b,g(h.line,j.start)),0!==j.type.indexOf("variable"))return;j.type="function"}if(!l)var l=[];l.push(j)}return{list:f(i,l,c,e),from:g(h.line,i.start),to:g(h.line,i.end)}}function e(a,b){return c(a,[],function(a,b){return a.getTokenAt(b)},b)}function f(a,c,e,f){function g(a){var c=d.isObject(a)?a.text:a;c=c.toLowerCase(),0!==c.indexOf(j)||j===c||b(i,c)||i.push(a)}function h(a){for(var b in a)g(a[b])}var i=[],j=a.string.toLowerCase();return h(f.list),d.each(e,g),i}var g=a.Pos;a.registerHelper("hint","custom-list",e)}},{underscore:"underscore"}],9:[function(a,b,c){b.exports=function(a){a.defineMode("mustache",function(){return{token:function(a,b){var c;if(a.match("{{")){if(c=a.peek(),null==c||null!=c&&c.match(/[{]{1,}/))return a.next(),"mustache-error";if(null!=c&&c.match(/[a-zA-Z\u00C0-\u024F_]+/))return null}if(a.match("}}")){if(c=a.peek(),null!=c&&c.match(/[}]{1,}/))return a.next(),"mustache-error";if(null==c)return null}return a.match("}")&&(c=a.peek(),null==c||null!=c&&c.match(/[}]{1,}/))?(a.next(),"mustache-error"):a.match("{")&&(c=a.peek(),null==c||null!=c&&c.match(/[{]{1,}/))?(a.next(),"mustache-error"):a.match(/[a-zA-Z\u00C0-\u024F_]+/,!0)?"mustache-text":void a.next()}}}),function(){function b(a){for(var b={},c=a.split(" "),d=0;d<c.length;++d)b[c[d]]=!0;return b}var c="{{  }}";a.defineMIME("text/mustache",{name:"mustache",client:b("source"),keywords:b(c)})}()}},{}],10:[function(a,b,c){b.exports=function(a){"use strict";a.defineMode("sql",function(b,c){function d(a,b){var c=a.next();if(o[c]){var d=o[c](a,b);if(d!==!1)return d}if(1==n.hexNumber&&("0"==c&&a.match(/^[xX][0-9a-fA-F]+/)||("x"==c||"X"==c)&&a.match(/^'[0-9a-fA-F]+'/)))return"number";if(1==n.binaryNumber&&(("b"==c||"B"==c)&&a.match(/^'[01]+'/)||"0"==c&&a.match(/^b[01]+/)))return"number";if(c.charCodeAt(0)>47&&c.charCodeAt(0)<58)return a.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/),1==n.decimallessFloat&&a.eat("."),"number";if("?"==c&&(a.eatSpace()||a.eol()||a.eat(";")))return"variable-3";if("'"==c||'"'==c&&n.doubleQuote)return b.tokenize=e(c),b.tokenize(a,b);if((1==n.nCharCast&&("n"==c||"N"==c)||1==n.charsetCast&&"_"==c&&a.match(/[a-z][a-z0-9]*/i))&&("'"==a.peek()||'"'==a.peek()))return"keyword";if(/^[\(\),\;\[\]]/.test(c))return null;if(n.commentSlashSlash&&"/"==c&&a.eat("/"))return a.skipToEnd(),"comment";if(n.commentHash&&"#"==c||"-"==c&&a.eat("-")&&(!n.commentSpaceRequired||a.eat(" ")))return a.skipToEnd(),"comment";if("/"==c&&a.eat("*"))return b.tokenize=f,b.tokenize(a,b);if("."!=c){if(m.test(c))return a.eatWhile(m),null;if("{"==c&&(a.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||a.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";a.eatWhile(/^[_\w\d]/);var g=a.current().toLowerCase();return p.hasOwnProperty(g)&&(a.match(/^( )+'[^']*'/)||a.match(/^( )+"[^"]*"/))?"number":j.hasOwnProperty(g)?"atom":k.hasOwnProperty(g)?"builtin":l.hasOwnProperty(g)?"keyword":i.hasOwnProperty(g)?"string-2":null}return 1==n.zerolessFloat&&a.match(/^(?:\d+(?:e[+-]?\d+)?)/i)?"number":1==n.ODBCdotTable&&a.match(/^[a-zA-Z_]+/)?"variable-2":void 0}function e(a){return function(b,c){for(var e,f=!1;null!=(e=b.next());){if(e==a&&!f){c.tokenize=d;break}f=!f&&"\\"==e}return"string"}}function f(a,b){for(;;){if(!a.skipTo("*")){a.skipToEnd();break}if(a.next(),a.eat("/")){b.tokenize=d;break}}return"comment"}function g(a,b,c){b.context={prev:b.context,indent:a.indentation(),col:a.column(),type:c}}function h(a){a.indent=a.context.indent,a.context=a.context.prev}var i=c.client||{},j=c.atoms||{false:!0,true:!0,null:!0},k=c.builtin||{},l=c.keywords||{},m=c.operatorChars||/^[*+\-%<>!=&|~^]/,n=c.support||{},o=c.hooks||{},p=c.dateSQL||{date:!0,time:!0,timestamp:!0};return{startState:function(){return{tokenize:d,context:null}},token:function(a,b){if(a.sol()&&b.context&&null==b.context.align&&(b.context.align=!1),a.eatSpace())return null;var c=b.tokenize(a,b);if("comment"==c)return c;b.context&&null==b.context.align&&(b.context.align=!0);var d=a.current();return"("==d?g(a,b,")"):"["==d?g(a,b,"]"):b.context&&b.context.type==d&&h(b),c},indent:function(c,d){var e=c.context;if(!e)return a.Pass;var f=d.charAt(0)==e.type;return e.align?e.col+(f?0:1):e.indent+(f?0:b.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:n.commentSlashSlash?"//":n.commentHash?"#":null}}),function(){function b(a){for(var b={},c=a.split(" "),d=0;d<c.length;++d)b[c[d]]=!0;return b}var c="alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit ";a.defineMIME("text/x-pgsql",{name:"sql",client:b("source"),keywords:b(c+"a abort abs absent absolute access according action ada add admin after aggregate all allocate also always analyse analyze any are array array_agg array_max_cardinality asensitive assertion assignment asymmetric at atomic attribute attributes authorization avg backward base64 before begin begin_frame begin_partition bernoulli binary bit_length blob blocked bom both breadth c cache call called cardinality cascade cascaded case cast catalog catalog_name ceil ceiling chain characteristics characters character_length character_set_catalog character_set_name character_set_schema char_length check checkpoint class class_origin clob close cluster coalesce cobol collate collation collation_catalog collation_name collation_schema collect column columns column_name command_function command_function_code comment comments commit committed concurrently condition condition_number configuration conflict connect connection connection_name constraint constraints constraint_catalog constraint_name constraint_schema constructor contains content continue control conversion convert copy corr corresponding cost covar_pop covar_samp cross csv cube cume_dist current current_catalog current_date current_default_transform_group current_path current_role current_row current_schema current_time current_timestamp current_transform_group_for_type current_user cursor cursor_name cycle data database datalink datetime_interval_code datetime_interval_precision day db deallocate dec declare default defaults deferrable deferred defined definer degree delimiter delimiters dense_rank depth deref derived describe descriptor deterministic diagnostics dictionary disable discard disconnect dispatch dlnewcopy dlpreviouscopy dlurlcomplete dlurlcompleteonly dlurlcompletewrite dlurlpath dlurlpathonly dlurlpathwrite dlurlscheme dlurlserver dlvalue do document domain dynamic dynamic_function dynamic_function_code each element else empty enable encoding encrypted end end-exec end_frame end_partition enforced enum equals escape event every except exception exclude excluding exclusive exec execute exists exp explain expression extension external extract false family fetch file filter final first first_value flag float floor following for force foreign fortran forward found frame_row free freeze fs full function functions fusion g general generated get global go goto grant granted greatest grouping groups handler header hex hierarchy hold hour id identity if ignore ilike immediate immediately immutable implementation implicit import including increment indent index indexes indicator inherit inherits initially inline inner inout input insensitive instance instantiable instead integrity intersect intersection invoker isnull isolation k key key_member key_type label lag language large last last_value lateral lead leading leakproof least left length level library like_regex link listen ln load local localtime localtimestamp location locator lock locked logged lower m map mapping match matched materialized max maxvalue max_cardinality member merge message_length message_octet_length message_text method min minute minvalue mod mode modifies module month more move multiset mumps name names namespace national natural nchar nclob nesting new next nfc nfd nfkc nfkd nil no none normalize normalized nothing notify notnull nowait nth_value ntile null nullable nullif nulls number object occurrences_regex octets octet_length of off offset oids old only open operator option options ordering ordinality others out outer output over overlaps overlay overriding owned owner p pad parameter parameter_mode parameter_name parameter_ordinal_position parameter_specific_catalog parameter_specific_name parameter_specific_schema parser partial partition pascal passing passthrough password percent percentile_cont percentile_disc percent_rank period permission placing plans pli policy portion position position_regex power precedes preceding prepare prepared preserve primary prior privileges procedural procedure program public quote range rank read reads reassign recheck recovery recursive ref references referencing refresh regr_avgx regr_avgy regr_count regr_intercept regr_r2 regr_slope regr_sxx regr_sxy regr_syy reindex relative release rename repeatable replace replica requiring reset respect restart restore restrict result return returned_cardinality returned_length returned_octet_length returned_sqlstate returning returns revoke right role rollback rollup routine routine_catalog routine_name routine_schema row rows row_count row_number rule savepoint scale schema schema_name scope scope_catalog scope_name scope_schema scroll search second section security selective self sensitive sequence sequences serializable server server_name session session_user setof sets share show similar simple size skip snapshot some source space specific specifictype specific_name sql sqlcode sqlerror sqlexception sqlstate sqlwarning sqrt stable standalone start state statement static statistics stddev_pop stddev_samp stdin stdout storage strict strip structure style subclass_origin submultiset substring substring_regex succeeds sum symmetric sysid system system_time system_user t tables tablesample tablespace table_name temp template temporary then ties timezone_hour timezone_minute to token top_level_count trailing transaction transactions_committed transactions_rolled_back transaction_active transform transforms translate translate_regex translation treat trigger trigger_catalog trigger_name trigger_schema trim trim_array true truncate trusted type types uescape unbounded uncommitted under unencrypted unique unknown unlink unlisten unlogged unnamed unnest until untyped upper uri usage user user_defined_type_catalog user_defined_type_code user_defined_type_name user_defined_type_schema using vacuum valid validate validator value value_of varbinary variadic var_pop var_samp verbose version versioning view views volatile when whenever whitespace width_bucket window within work wrapper write xmlagg xmlattributes xmlbinary xmlcast xmlcomment xmlconcat xmldeclaration xmldocument xmlelement xmlexists xmlforest xmliterate xmlnamespaces xmlparse xmlpi xmlquery xmlroot xmlschema xmlserialize xmltable xmltext xmlvalidate year yes loop repeat"),builtin:b("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float8 inet integer int int4 interval json jsonb line lseg macaddr money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:b("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:b("date time timestamp"),support:b("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast commentHash commentSpaceRequired")})}()}},{}],11:[function(a,b,c){b.exports=function(a){function b(a){a.state.placeholder&&(a.state.placeholder.parentNode.removeChild(a.state.placeholder),a.state.placeholder=null)}function c(a){b(a);var c=a.state.placeholder=document.createElement("pre");c.style.cssText="height: 0; overflow: visible",c.className="CodeMirror-placeholder";var d=a.getOption("placeholder");"string"==typeof d&&(d=document.createTextNode(d)),c.appendChild(d),a.display.lineSpace.insertBefore(c,a.display.lineSpace.firstChild)}function d(a){f(a)&&c(a)}function e(a){var d=a.getWrapperElement(),e=f(a);d.className=d.className.replace(" CodeMirror-empty","")+(e?" CodeMirror-empty":""),e?c(a):b(a)}function f(a){return 1===a.lineCount()&&""===a.getLine(0)}a.defineOption("placeholder","",function(c,f,g){var h=g&&g!=a.Init;if(f&&!h)c.on("blur",d),c.on("change",e),c.on("swapDoc",e),e(c);else if(!f&&h){c.off("blur",d),c.off("change",e),c.off("swapDoc",e),b(c);var i=c.getWrapperElement();i.className=i.className.replace(" CodeMirror-empty","");
}f&&!c.hasFocus()&&d(c)})}},{}],12:[function(a,b,c){b.exports=function(a){function b(b,c,d){function e(b){var c=a.wheelEventPixels(b)["horizontal"===f.orientation?"x":"y"],d=f.pos;f.moveTo(f.pos+c),f.pos!==d&&a.e_preventDefault(b)}this.orientation=c,this.scroll=d,this.screen=this.total=this.size=1,this.pos=0,this.node=document.createElement("div"),this.node.className=b+"-"+c,this.inner=this.node.appendChild(document.createElement("div"));var f=this;a.on(this.inner,"mousedown",function(b){function c(){a.off(document,"mousemove",d),a.off(document,"mouseup",c)}function d(a){return 1!==a.which?c():void f.moveTo(h+(a[e]-g)*(f.total/f.size))}if(1===b.which){a.e_preventDefault(b);var e="horizontal"===f.orientation?"pageX":"pageY",g=b[e],h=f.pos;a.on(document,"mousemove",d),a.on(document,"mouseup",c)}}),a.on(this.node,"click",function(b){a.e_preventDefault(b);var c,d=f.inner.getBoundingClientRect();c="horizontal"===f.orientation?b.clientX<d.left?-1:b.clientX>d.right?1:0:b.clientY<d.top?-1:b.clientY>d.bottom?1:0,f.moveTo(f.pos+c*f.screen)}),a.on(this.node,"mousewheel",e),a.on(this.node,"DOMMouseScroll",e)}function c(a,c,d){this.addClass=a,this.horiz=new b(a,"horizontal",d),c(this.horiz.node),this.vert=new b(a,"vertical",d),c(this.vert.node),this.width=null}b.prototype.setPos=function(a,b){return a<0&&(a=0),a>this.total-this.screen&&(a=this.total-this.screen),!(!b&&a===this.pos)&&(this.pos=a,this.inner.style["horizontal"===this.orientation?"left":"top"]=a*(this.size/this.total)+"px",!0)},b.prototype.moveTo=function(a){this.setPos(a)&&this.scroll(a,this.orientation)};var d=10;b.prototype.update=function(a,b,c){var e=this.screen!==b||this.total!==a||this.size!==c;e&&(this.screen=b,this.total=a,this.size=c);var f=this.screen*(this.size/this.total);f<d&&(this.size-=d-f,f=d),this.inner.style["horizontal"===this.orientation?"width":"height"]=f+"px",this.setPos(this.pos,e)},c.prototype.update=function(a){if(null==this.width){var b=window.getComputedStyle?window.getComputedStyle(this.horiz.node):this.horiz.node.currentStyle;b&&(this.width=parseInt(b.height,10))}var c=this.width||0,d=a.scrollWidth>a.clientWidth+1,e=a.scrollHeight>a.clientHeight+1;return this.vert.node.style.display=e?"block":"none",this.horiz.node.style.display=d?"block":"none",e&&(this.vert.update(a.scrollHeight,a.clientHeight,a.viewHeight-(d?c:0)),this.vert.node.style.bottom=d?c+"px":"0"),d&&(this.horiz.update(a.scrollWidth,a.clientWidth,a.viewWidth-(e?c:0)-a.barLeft),this.horiz.node.style.right=e?c+"px":"0",this.horiz.node.style.left=a.barLeft+"px"),{right:e?c:0,bottom:d?c:0}},c.prototype.setScrollTop=function(a){this.vert.setPos(a)},c.prototype.setScrollLeft=function(a){this.horiz.setPos(a)},c.prototype.clear=function(){var a=this.horiz.node.parentNode;a.removeChild(this.horiz.node),a.removeChild(this.vert.node)},a.scrollbarModel.simple=function(a,b){return new c("CodeMirror-simplescroll",a,b)},a.scrollbarModel.overlay=function(a,b){return new c("CodeMirror-overlayscroll",a,b)}}},{}],13:[function(a,b,c){b.exports=function(a){function b(a,b,e,f){if(this.atOccurrence=!1,this.doc=a,null==f&&"string"==typeof b&&(f=!1),e=e?a.clipPos(e):d(0,0),this.pos={from:e,to:e},"string"!=typeof b)b.global||(b=new RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(c,e){if(c){b.lastIndex=0;for(var f,g,h=a.getLine(e.line).slice(0,e.ch),i=0;;){b.lastIndex=i;var j=b.exec(h);if(!j)break;if(f=j,g=f.index,i=f.index+(f[0].length||1),i==h.length)break}var k=f&&f[0].length||0;k||(0==g&&0==h.length?f=void 0:g!=a.getLine(e.line).length&&k++)}else{b.lastIndex=e.ch;var h=a.getLine(e.line),f=b.exec(h),k=f&&f[0].length||0,g=f&&f.index;g+k==h.length||k||(k=1)}if(f&&k)return{from:d(e.line,g),to:d(e.line,g+k),match:f}};else{var g=b;f&&(b=b.toLowerCase());var h=f?function(a){return a.toLowerCase()}:function(a){return a},i=b.split("\n");if(1==i.length)b.length?this.matches=function(e,f){if(e){var i=a.getLine(f.line).slice(0,f.ch),j=h(i),k=j.lastIndexOf(b);if(k>-1)return k=c(i,j,k),{from:d(f.line,k),to:d(f.line,k+g.length)}}else{var i=a.getLine(f.line).slice(f.ch),j=h(i),k=j.indexOf(b);if(k>-1)return k=c(i,j,k)+f.ch,{from:d(f.line,k),to:d(f.line,k+g.length)}}}:this.matches=function(){};else{var j=g.split("\n");this.matches=function(b,c){var e=i.length-1;if(b){if(c.line-(i.length-1)<a.firstLine())return;if(h(a.getLine(c.line).slice(0,j[e].length))!=i[i.length-1])return;for(var f=d(c.line,j[e].length),g=c.line-1,k=e-1;k>=1;--k,--g)if(i[k]!=h(a.getLine(g)))return;var l=a.getLine(g),m=l.length-j[0].length;if(h(l.slice(m))!=i[0])return;return{from:d(g,m),to:f}}if(!(c.line+(i.length-1)>a.lastLine())){var l=a.getLine(c.line),m=l.length-j[0].length;if(h(l.slice(m))==i[0]){for(var n=d(c.line,m),g=c.line+1,k=1;k<e;++k,++g)if(i[k]!=h(a.getLine(g)))return;if(h(a.getLine(g).slice(0,j[e].length))==i[e])return{from:n,to:d(g,j[e].length)}}}}}}}function c(a,b,c){if(a.length==b.length)return c;for(var d=Math.min(c,a.length);;){var e=a.slice(0,d).toLowerCase().length;if(e<c)++d;else{if(!(e>c))return d;--d}}}var d=a.Pos;b.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function b(a){var b=d(a,0);return c.pos={from:b,to:b},c.atOccurrence=!1,!1}for(var c=this,e=this.doc.clipPos(a?this.pos.from:this.pos.to);;){if(this.pos=this.matches(a,e))return this.atOccurrence=!0,this.pos.match||!0;if(a){if(!e.line)return b(0);e=d(e.line-1,this.doc.getLine(e.line-1).length)}else{var f=this.doc.lineCount();if(e.line==f-1)return b(f);e=d(e.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(b,c){if(this.atOccurrence){var e=a.splitLines(b);this.doc.replaceRange(e,this.pos.from,this.pos.to,c),this.pos.to=d(this.pos.from.line+e.length-1,e[e.length-1].length+(1==e.length?this.pos.from.ch:0))}}},a.defineExtension("getSearchCursor",function(a,c,d){return new b(this.doc,a,c,d)}),a.defineDocExtension("getSearchCursor",function(a,c,d){return new b(this,a,c,d)}),a.defineExtension("selectMatches",function(b,c){for(var d=[],e=this.getSearchCursor(b,this.getCursor("from"),c);e.findNext()&&!(a.cmpPos(e.to(),this.getCursor("to"))>0);)d.push({anchor:e.from(),head:e.to()});d.length&&this.setSelections(d,0)})}},{}],14:[function(a,b,c){b.exports=function(a){"use strict";function b(a,b){this.cm=a,this.options=b,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var c=this;a.on("cursorActivity",this.activityFunc=function(){c.cursorActivity()})}function c(b,c){var d=a.cmpPos(c.from,b.from);return d>0&&b.to.ch-b.from.ch!=c.to.ch-c.from.ch}function d(a,b,c){var d=a.options.hintOptions,e={};for(var f in r)e[f]=r[f];if(d)for(var f in d)void 0!==d[f]&&(e[f]=d[f]);if(c)for(var f in c)void 0!==c[f]&&(e[f]=c[f]);return e.hint.resolve&&(e.hint=e.hint.resolve(a,b)),e}function e(a,b){var c=b&&b.autocompleteSuffix?b.autocompleteSuffix:"",d=b&&b.autocompletePrefix?b.autocompletePrefix:"";return"string"!=typeof a&&(a=a.text),d+a+c}function f(a){return"string"==typeof a?"":a.type}function g(a,b){function c(a,c){var e;e="string"!=typeof c?function(a){return c(a,b)}:d.hasOwnProperty(c)?d[c]:c,f[a]=e}var d={Up:function(){b.moveFocus(-1)},Down:function(){b.moveFocus(1)},PageUp:function(){b.moveFocus(-b.menuSize()+1,!0)},PageDown:function(){b.moveFocus(b.menuSize()-1,!0)},Home:function(){b.setFocus(0)},End:function(){b.setFocus(b.length-1)},Enter:b.pick,Tab:b.pick,Esc:b.close},e=a.options.customKeys,f=e?{}:d;if(e)for(var g in e)e.hasOwnProperty(g)&&c(g,e[g]);var h=a.options.extraKeys;if(h)for(var g in h)h.hasOwnProperty(g)&&c(g,h[g]);return f}function h(a,b){for(;b&&b!=a;){if("LI"===b.nodeName.toUpperCase()&&b.parentNode==a)return b;b=b.parentNode}}function i(a){var b=document.createElement(a.displayText||e(a));b=document.createElement("span"),b.className="CDB-Size-small has-letter",b.innerHTML=a.displayText||e(a);var c=f(a);return c&&(b.className="CDB-Size-small has-letter",b.dataset.type=c),b}function j(b,c){this.completion=b,this.data=c,this.picked=!1;var d=this,e=b.cm,f=this.hints=document.createElement("ul");f.className="CodeMirror-hints",this.selectedHint=c.selectedHint||0;for(var j,k=c.list,l=0;l<k.length;++l){var m=f.appendChild(document.createElement("li")),p=k[l],q=n+(l!=this.selectedHint?"":" "+o);null!=p.className&&(q=p.className+" "+q),m.className=q,p.render?p.render(m,c,p):(j=i(p),m.appendChild(j)),m.hintId=l}var r=e.cursorCoords(b.options.alignWithWord?c.from:null),s=r.left,t=r.bottom,u=!0;f.style.left=s+"px",f.style.top=t+"px";var v=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),w=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(b.options.container||document.body).appendChild(f);var x=f.getBoundingClientRect(),y=x.bottom-w;if(y>0){var z=x.bottom-x.top,A=r.top-(r.bottom-x.top);if(A-z>0)f.style.top=(t=r.top-z)+"px",u=!1;else if(z>w){f.style.height=w-5+"px",f.style.top=(t=r.bottom-x.top)+"px";var B=e.getCursor();c.from.ch!=B.ch&&(r=e.cursorCoords(B),f.style.left=(s=r.left)+"px",x=f.getBoundingClientRect())}}var C=x.right-v;if(C>0&&(x.right-x.left>v&&(f.style.width=v-5+"px",C-=x.right-x.left-v),f.style.left=(s=r.left-C)+"px"),e.addKeyMap(this.keyMap=g(b,{moveFocus:function(a,b){d.changeActive(d.selectedHint+a,b)},setFocus:function(a){d.changeActive(a)},menuSize:function(){return d.screenAmount()},length:k.length,close:function(){b.close()},pick:function(){d.pick()},data:c})),b.options.closeOnUnfocus){var D;e.on("blur",this.onBlur=function(){D=setTimeout(function(){b.close()},100)}),e.on("focus",this.onFocus=function(){clearTimeout(D)})}var E=e.getScrollInfo();return e.on("scroll",this.onScroll=function(){var a=e.getScrollInfo(),c=e.getWrapperElement().getBoundingClientRect(),d=t+E.top-a.top,g=d-(window.pageYOffset||(document.documentElement||document.body).scrollTop);return u||(g+=f.offsetHeight),g<=c.top||g>=c.bottom?b.close():(f.style.top=d+"px",void(f.style.left=s+E.left-a.left+"px"))}),a.on(f,"dblclick",function(a){var b=h(f,a.target||a.srcElement);b&&null!=b.hintId&&(d.changeActive(b.hintId),d.pick())}),a.on(f,"click",function(a){var c=h(f,a.target||a.srcElement);c&&null!=c.hintId&&(d.changeActive(c.hintId),b.options.completeOnSingleClick&&d.pick())}),a.on(f,"mousedown",function(){setTimeout(function(){e.focus()},20)}),a.signal(c,"select",k[0],f.firstChild),!0}function k(a,b){if(!a.somethingSelected())return b;for(var c=[],d=0;d<b.length;d++)b[d].supportsSelection&&c.push(b[d]);return c}function l(a,b,c,d){if(a.async)a(b,d,c);else{var e=a(b,c);e&&e.then?e.then(d):d(e)}}function m(b,c){var d,e=b.getHelpers(c,"hint");if(e.length){var f=function(a,b,c){function d(e){return e==f.length?b(null):void l(f[e],a,c,function(a){a&&a.list.length>0?b(a):d(e+1)})}var f=k(a,e);d(0)};return f.async=!0,f.supportsSelection=!0,f}return(d=b.getHelper(b.getCursor(),"hintWords"))?function(b){return a.hint.fromList(b,{words:d})}:a.hint.anyword?function(b,c){return a.hint.anyword(b,c)}:function(){}}var n="CodeMirror-hint",o="CodeMirror-hint-active";a.showHint=function(a,b,c){if(!b)return a.showHint(c);c&&c.async&&(b.async=!0);var d={hint:b};if(c)for(var e in c)d[e]=c[e];return a.showHint(d)},a.defineExtension("showHint",function(c){c=d(this,this.getCursor("start"),c);var e=this.listSelections();if(!(e.length>1)){if(this.somethingSelected()){if(!c.hint.supportsSelection)return;for(var f=0;f<e.length;f++)if(e[f].head.line!=e[f].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var g=this.state.completionActive=new b(this,c);g.options.hint&&(a.signal(this,"startCompletion",this),g.update(!0))}});var p=window.requestAnimationFrame||function(a){return setTimeout(a,1e3/60)},q=window.cancelAnimationFrame||clearTimeout;b.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&a.signal(this.data,"close"),this.widget&&this.widget.close(),a.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(b,c){var d=b.list[c];d.hint?d.hint(this.cm,b,d):this.cm.replaceRange(e(d,this.options),d.from||b.from,d.to||b.to,"complete"),a.signal(b,"pick",d),this.close()},cursorActivity:function(){this.debounce&&(q(this.debounce),this.debounce=0);var a=this.cm.getCursor(),b=this.cm.getLine(a.line);if(a.line!=this.startPos.line||b.length-a.ch!=this.startLen-this.startPos.ch||a.ch<this.startPos.ch||this.cm.somethingSelected()||a.ch&&this.options.closeCharacters.test(b.charAt(a.ch-1)))this.close();else{var c=this;this.debounce=p(function(){c.update()}),this.widget&&this.widget.disable()}},update:function(a){if(null!=this.tick){var b=this,c=++this.tick;l(this.options.hint,this.cm,this.options,function(d){b.tick==c&&b.finishUpdate(d,a)})}},finishUpdate:function(b,d){this.data&&a.signal(this.data,"update");var e=this.widget&&this.widget.picked||d&&this.options.completeSingle;this.widget&&this.widget.close(),b&&this.data&&c(this.data,b)||(this.data=b,b&&b.list.length&&(e&&1==b.list.length?this.pick(b,0):(this.widget=new j(this,b),a.signal(b,"shown"))))}},j.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var a=this.completion.cm;this.completion.options.closeOnUnfocus&&(a.off("blur",this.onBlur),a.off("focus",this.onFocus)),a.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var a=this;this.keyMap={Enter:function(){a.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(b,c){if(b>=this.data.list.length?b=c?this.data.list.length-1:0:b<0&&(b=c?0:this.data.list.length-1),this.selectedHint!=b){var d=this.hints.childNodes[this.selectedHint];d.className=d.className.replace(" "+o,""),d=this.hints.childNodes[this.selectedHint=b],d.className+=" "+o,d.offsetTop<this.hints.scrollTop?this.hints.scrollTop=d.offsetTop-3:d.offsetTop+d.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=d.offsetTop+d.offsetHeight-this.hints.clientHeight+3),a.signal(this.data,"select",this.data.list[this.selectedHint],d)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},a.registerHelper("hint","auto",{resolve:m}),a.registerHelper("hint","fromList",function(b,c){var d=b.getCursor(),e=b.getTokenAt(d),f=a.Pos(d.line,e.end);if(e.string&&/\w/.test(e.string[e.string.length-1]))var g=e.string,h=a.Pos(d.line,e.start);else var g="",h=f;for(var i=[],j=0;j<c.words.length;j++){var k=c.words[j];k.slice(0,g.length)==g&&i.push(k)}if(i.length)return{list:i,from:h,to:f}}),a.commands.autocomplete=a.showHint;var r={hint:a.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};a.defineOption("hintOptions",null)}},{}],15:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("backbone/core-view"),g=a("../custom-list/custom-list-view"),h=a("../custom-list/custom-list-item-view"),i=a("../custom-list/custom-list-item.tpl"),j=a("../../helpers/magic-positioner"),k=27;b.exports=f.extend({options:{position:{x:0,y:0},offset:{x:0,y:15},itemTemplate:i,itemView:h},className:"CDB-Box-modal CDB-SelectItem CustomList CustomList--small",tagName:"div",initialize:function(a){if(a=a||{},!a.collection)throw new Error("collection option is required");if(!a.triggerElementID)throw new Error("element id is required");this._triggerElementID=a.triggerElementID,this.model=new e.Model({visible:!1}),this._onEscapePressed=this._onEscapePressed.bind(this),this._onDocumentElementClicked=this._onDocumentElementClicked.bind(this),this._initBinds()},_initBinds:function(){this.model.on("change:visible",function(a,b){this.render(),b?this._initDocumentBinds():this._destroyDocumentBinds()},this),this.collection.on("change:selected",this.hide,this),this.add_related_model(this.collection)},_initDocumentBinds:function(){d(document).on("keydown",this._onEscapePressed),d(document).on("mousedown",this._onDocumentElementClicked)},_destroyDocumentBinds:function(){d(document).off("keydown",this._onEscapePressed),d(document).off("mousedown",this._onDocumentElementClicked)},render:function(){var a=d("body"),b=(this.options.position.x||0)+this.options.offset.x,c=(this.options.position.y||0)+this.options.offset.y;return this.clearSubViews(),this.$el.empty(),this._renderList(),this.$el.toggle(this.isVisible()),a.append(this.el),this.$el.css(j({parentView:a,posX:b,posY:c})),this},_onEscapePressed:function(a){a.which===k&&this.hide()},_onDocumentElementClicked:function(a){var b=d(a.target);0===b.closest(this.$el).length&&0===b.closest(d("#"+this._triggerElementID)).length&&this.hide()},_renderList:function(){this._listView=new g({model:this.model,collection:this.collection,typeLabel:"",ItemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:5}),this.$el.append(this._listView.render().el),this.addView(this._listView)},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},clean:function(){this._destroyDocumentBinds(),f.prototype.clean.apply(this)}})},{"../../helpers/magic-positioner":428,"../custom-list/custom-list-item-view":26,"../custom-list/custom-list-item.tpl":28,"../custom-list/custom-list-view":33,backbone:"backbone","backbone/core-view":454,jquery:"jquery"}],16:[function(a,b,c){var d=a("backbone"),e=a("./custom-carousel-item-model");b.exports=d.Collection.extend({model:function(a,b){var c={};return"string"==typeof a?c.val=a:c=a,new e(c)},initialize:function(){this._initBinds()},_initBinds:function(){this.bind("change:selected",this._onSelectedChange,this)},_onSelectedChange:function(a,b){b&&this.each(function(b){b.cid!==a.cid&&b.get("selected")&&b.set("selected",!1)})},getSelected:function(){return this.findWhere({selected:!0})},getSelectedValue:function(){var a=this.getSelected();return a&&a.get("val")},getHighlighted:function(){return this.findWhere({highlighted:!0})}})},{"./custom-carousel-item-model":17,backbone:"backbone"}],17:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{selected:!1,label:"",template:function(){return""}},getName:function(){return this.get("label")||this.getValue()},getValue:function(){return this.get("val")}})},{backbone:"backbone"}],18:[function(a,b,c){var d=a("backbone/core-view"),e=a("./custom-carousel-item.tpl");b.exports=d.extend({className:"Carousel-item",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function(a){this._itemClassName=a&&a.itemOptions?a.itemOptions.className:"",this._initBinds()},render:function(){return this.$el.html(e({name:this.model.getName(),className:this._itemClassName,template:this.model.get("template")()})),this.model.getValue()&&this.$el.addClass("js-"+this.model.getValue()),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this},_initBinds:function(){this.model.bind("change:selected",this.render,this)},_onMouseEnter:function(){this.model.set("highlighted",!0)},_onMouseLeave:function(){this.model.set("highlighted",!1)},_onClick:function(a){this.killEvent(a),this.model.set("selected",!0)}})},{"./custom-carousel-item.tpl":19,"backbone/core-view":454}],19:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<button",className&&(__p+=' class="'+(null==(__t=className)?"":_.escape(__t))+'"'),__p+=">\n  "+(null==(__t=template)?"":__t)+"\n</button>\n";return __p}},{underscore:"underscore"}],20:[function(a,b,c){var d=a("backbone/core-view"),e=a("perfect-scrollbar"),f=a("./custom-carousel.tpl"),g=a("./custom-carousel-collection"),h=a("./custom-carousel-item-view"),i=a("underscore");b.exports=d.extend({className:"Carousel",tagName:"div",initialize:function(a){if(!a.collection){if(!a.options)throw new Error("options array {value, label} is required");this.collection=new g(a.options),this.options=a}this._bindedCheckShadows=this._checkShadows.bind(this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(f()),this._renderList(),this._applyCustomScroll(),this},_initBinds:function(){this.collection.bind("change:selected",this._checkScroll,this)},_renderList:function(){this.collection.each(function(a){this._createItem(a)},this)},_createItem:function(a){var b=this.options,c=b&&b.listItemOptions?b.listItemOptions.className:"Carousel-item",d=new h({className:c,model:a,itemOptions:this.options.itemOptions});this._listContainer().append(d.render().el),this.addView(d)},_applyCustomScroll:function(){e.initialize(this._listContainer().get(0),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,suppressScrollY:!0,stopPropagationOnClick:!1,minScrollbarLength:120}),this._checkScroll(),this._bindScroll()},_destroyCustomScroll:function(){this._unbindScroll(),e.destroy(this._listContainer().get(0))},_bindScroll:function(){this._listContainer().on("ps-x-reach-start",this._bindedCheckShadows).on("ps-x-reach-end",this._bindedCheckShadows).on("ps-scroll-x",this._bindedCheckShadows)},_unbindScroll:function(){this._listContainer().off("ps-x-reach-start",this._bindedCheckShadows).off("ps-x-reach-end",this._bindedCheckShadows).off("ps-scroll-x",this._bindedCheckShadows)},_checkScroll:function(){var a=this.$(".is-selected").position();a&&(this._listContainer().scrollLeft(a.left-20),this._bindedCheckShadows())},_listContainer:function(){return this.$(".js-list")},_checkShadows:function(){var a=this._listContainer().scrollLeft(),b=this._listContainer().get(0).scrollWidth,c=this._listContainer().outerWidth(),d=b-c;this.$(".js-leftShadow").toggleClass("is-visible",a>0),this.$(".js-rightShadow").toggleClass("is-visible",a<d)},clean:function(){this._destroyCustomScroll(),d.prototype.clean.apply(this)},initScroll:function(){setTimeout(i.bind(function(){this._checkShadows(),this._checkScroll(),e.update(this._listContainer().get(0))},this),0)}})},{"./custom-carousel-collection":16,"./custom-carousel-item-view":18,"./custom-carousel.tpl":21,"backbone/core-view":454,"perfect-scrollbar":"perfect-scrollbar",underscore:"underscore"}],21:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Carousel-shadow Carousel-shadow--left js-leftShadow"></div>\n<div class="Carousel-shadow Carousel-shadow--right is-visible js-rightShadow"></div>\n<ul class="Carousel-list js-list"></ul>\n';return __p}},{underscore:"underscore"}],22:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-ListDecoration-item CustomList-item js-listItem">\n  <button type="button" class="CDB-ListDecoration-itemLink CustomList-itemLink js-add-custom-value u-ellipsis" data-val="'+(null==(__t=query)?"":_.escape(__t))+'" title="'+(null==(__t=query)?"":_.escape(__t))+'">\n    <p class="CDB-Text CDB-FontSize-small u-altTextColor">'+(null==(__t=_t("components.custom-list.add-custom-result"))?"":_.escape(__t))+"</p>\n    "+(null==(__t=query)?"":_.escape(__t))+"\n  </button>\n</div>\n";return __p}},{underscore:"underscore"}],23:[function(a,b,c){var d=a("backbone"),e=a("./custom-list-item-model"),f=a("underscore");b.exports=d.Collection.extend({sort_key:"id",initialize:function(a,b){this.options=f.extend({silent:!0},b),this._initBinds()},comparator:function(a){return a.get(this.sort_key)?a.get(this.sort_key).toLowerCase():a.get(this.sort_key)},model:function(a,b){var c={};return"string"==typeof a?c.val=a:c=a,new e(c,b)},sortByKey:function(a){this.sort_key=a,this.sort()},_initBinds:function(){this.bind("change:selected",this._onSelectedChange,this)},search:function(a){return a?(a=a.toLowerCase(),f(this.filter(function(b){var c=b.getName(),d=f.isString(c)?c.toLowerCase():c;return d?~d.indexOf(a):-1}))):this},_onSelectedChange:function(a,b){b&&this.each(function(b){b.cid!==a.cid&&b.set({selected:!1},{silent:this.options.silent})},this)},getSelectedItem:function(){return f.first(this.where({selected:!0}))},containsValue:function(a){return this.find(function(b){return b.getValue()===a})},setSelected:function(a){var b,c={silent:this.options.silent};return this.each(function(d){d.getValue()===a?(d.set({selected:!0},c),b=d):d.set({selected:!1},c)}),b},removeSelected:function(){this.each(function(a){a.set({selected:!1})})}})},{"./custom-list-item-model":25,backbone:"backbone",underscore:"underscore"}],24:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CustomList-message">\n  <p class="CustomList-messageText CDB-Text CDB-Size-medium u-secondaryTextColor">\n    ',__p+=query&&query.length?"\n      "+(null==(__t=_t("components.custom-list.no-results",{typeLabel:typeLabel,query:query}))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.custom-list.no-items",{typeLabel:typeLabel}))?"":_.escape(__t))+"\n    ",__p+="\n  </p>\n</div>\n";return __p}},{underscore:"underscore"}],25:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{selected:!1},getName:function(){return null==this.get("label")?this.getValue():this.get("label")},getValue:function(){return this.get("val")}})},{backbone:"backbone"}],26:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view");b.exports=e.extend({options:{template:a("./custom-list-item.tpl")},className:"CDB-ListDecoration-item CustomList-item js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function(a){this.options=d.extend({},this.options,a),this.model.on("change",this.render,this)},render:function(){this.$el.empty(),this.clearSubViews();var a=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(d.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:a,val:this.model.getValue(),options:this.model.get("renderOptions")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onMouseLeave:function(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function(){this.$el.addClass("is-highlighted")},_onClick:function(a){this.killEvent(a),this.model.set({selectedClass:a.target.classList,selected:!0})}})},{"./custom-list-item.tpl":28,"backbone/core-view":454,underscore:"underscore"}],27:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink u-ellipsis\n  ',isSelected&&(__p+=" is-selected "),__p+="\n  ",__p+=isDestructive?"\n  u-errorTextColor\n  ":isDisabled?"\n  u-hintTextColor\n  ":"\n  u-actionTextColor\n  ",__p+='\n  " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n\n  <div class="u-iBlock u-rSpace">\n    <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',isSelected&&(__p+="checked"),__p+=" ",isDisabled&&(__p+="disabled"),__p+=' />\n    <span class="u-iBlock CDB-Checkbox-face"></span>\n  </div>\n  '+(null==(__t=name)?"":_.escape(__t))+"\n</button>\n";return __p}},{underscore:"underscore"}],28:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink u-ellipsis\n    ',isSelected&&(__p+=" is-selected "),__p+="\n    ",__p+=isDestructive?"\n      u-errorTextColor\n    ":isDisabled?"\n      u-hintTextColor\n    ":"\n      u-actionTextColor\n    ",__p+='\n  " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  '+(null==(__t=name)?"":_.escape(__t))+"\n</button>\n";return __p}},{underscore:"underscore"}],29:[function(a,b,c){var d=a("underscore"),e=a("./custom-list-collection");b.exports=e.extend({_initBinds:function(){},setSelected:function(a){var b,c={silent:!0};return d.isArray(a)?this.each(function(e){d.contains(a,e.getValue())?(e.set({selected:!0},c),b=e):e.set({selected:!1},c)}):this.each(function(d){d.getValue()===a?(d.set({selected:!0},c),b=d):d.set({selected:!1},c)}),b}})},{"./custom-list-collection":23,underscore:"underscore"}],30:[function(a,b,c){var d=a("./custom-list-item-view");b.exports=d.extend({_onClick:function(a){this.killEvent(a),this.model.set("selected",!this.model.get("selected"))}})},{"./custom-list-item-view":26}],31:[function(a,b,c){var d=a("backbone/core-view"),e=a("./custom-list-search.tpl");b.exports=d.extend({className:"CustomList-form CDB-Box-modalHeader",tagName:"form",events:{"keyup .js-search":"_onSearchType","click .js-clear":"_onClickClear",submit:"_submit"},initialize:function(){this.template=this.options.template||e,this.searchPlaceholder=this.options.searchPlaceholder||_t("components.custom-list.placeholder",{typeLabel:this.options.typeLabel}),this._initBinds()},render:function(){return this.$el.empty().append(this.template({query:this.model.get("query"),searchPlaceholder:this.searchPlaceholder})),this},_initBinds:function(){this.model.on("change:query",this._checkButtons,this)},_checkButtons:function(){var a=this.model.get("query");this.$(".js-clear").toggle(a.length>0)},_onSearchType:function(a){this._submit()},_onClickClear:function(a){a.stopPropagation(),this.model.set("query",""),this.render(),this.focus()},focus:function(){this.$(".js-search").focus()},_submit:function(a){this.killEvent(a);var b=this.$(".js-search").val();this.model.set("query",b)}})},{"./custom-list-search.tpl":32,"backbone/core-view":454}],32:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeaderItem">\n  <input type="text" name="text" autocomplete="off" placeholder="'+(null==(__t=searchPlaceholder)?"":_.escape(__t))+'" class="CDB-InputTextPlain CDB-Text js-search">\n  <button type="button" style="display:none" class="u-lSpace--xl js-clear">\n    <div class="CDB-Shape">\n      <div class="CDB-Shape-close is-blue is-large"></div>\n    </div>\n  </button>\n</div>\n';return __p}},{underscore:"underscore"}],33:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("perfect-scrollbar"),g=a("./custom-list-empty.tpl"),h=a("./custom-list-add.tpl"),i=a("./custom-list.tpl"),j=40,k=a("../../helpers/utils"),l=38,m=13;b.exports=d.extend({options:{size:3},className:"CDB-Text CDB-Size-medium CustomList-listWrapper",tagName:"div",events:{"click .js-add-custom-value":"_onClickAddCustomValue"},initialize:function(a){this.options=e.extend({},this.options,a),this._onKeyDownBinded=this._onKeyDown.bind(this),this._needsMaxSize=!0,this._initBinds()},render:function(){this.clearSubViews(),this._removeArrowBinds(),this._destroyCustomScroll(),this.$el.empty();var a=this.model.get("query"),b=this.collection.search(a);this.$el.append(i());var c=this.options.allowFreeTextInput,d=!this.collection.containsValue(a);return c&&a&&!k.isBlank(a)&&d&&this.$el.prepend(h({query:a,typeLabel:this.options.typeLabel
})),b.size()>0?(b.each(this._renderItem,this),this._applyArrowBinds(),setTimeout(this._applyCustomScroll.bind(this),0)):c&&!k.isBlank(a)||this.$el.append(g({query:a,typeLabel:this.options.typeLabel})),this},_renderItem:function(a){var b=this.options.ItemView,c=new b({model:a,typeLabel:this.options.typeLabel,template:this.options.itemTemplate});this.$(".js-list").append(c.render().el),this.addView(c),c.bind("customEvent",function(a,b){this.trigger("customEvent",a,b,this)},this)},_initBinds:function(){this.model.bind("change:query",this.render,this)},_applyArrowBinds:function(){document.addEventListener("keydown",this._onKeyDownBinded)},_removeArrowBinds:function(){document.removeEventListener("keydown",this._onKeyDownBinded)},_getSelected:function(){var a,b=this.collection.getSelectedItem();return b?(a=b.getValue(),this.$("[data-val='"+a+"']")):null},_highlightSelected:function(a){var b=a.outerHeight();a.addClass("is-highlighted"),this.$(".js-list").scrollTop(a.index()*b)},_onClickAddCustomValue:function(a){this.killEvent(a);var b=this.model.get("query"),c=this.collection.add({val:b,label:""+b+""});this.collection.sortByKey("val"),c.set("selected",!0)},_onKeyDown:function(a){if(this.model.get("visible")!==!1){var b,c,d=a.which,f=this.$(".js-listItem"),g=f.filter(".is-highlighted");if(g.removeClass("is-highlighted"),d===j)b=g.length&&g[0]!==f.last()[0]?g.next():f.eq(0);else if(d===l)b=g.length&&g[0]!==f.first()[0]?g.prev():f.last();else if(d===m&&(a.preventDefault(),g&&g.length))return c=e.first(this.collection.where({val:g.data("val")})),c&&c.set("selected",!0),!1;b&&this._highlightSelected(b)}},_applyCustomScroll:function(){f.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20})},_destroyCustomScroll:function(){this._wrapperContainer().length>0&&f.destroy(this._wrapperContainer().get(0))},_wrapperContainer:function(){return this.$(".js-list")},clean:function(){this._removeArrowBinds(),this._destroyCustomScroll(),d.prototype.clean.apply(this)},highlight:function(){var a=this._getSelected();a&&this._highlightSelected(a)}})},{"../../helpers/utils":435,"./custom-list-add.tpl":22,"./custom-list-empty.tpl":24,"./custom-list.tpl":34,"backbone/core-view":454,"perfect-scrollbar":"perfect-scrollbar",underscore:"underscore"}],34:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="CustomList-list js-list"></ul>\n';return __p}},{underscore:"underscore"}],35:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./custom-list-collection"),h=a("./custom-list-search-view"),i=a("./custom-list-view"),j=a("./custom-list-item.tpl"),k=a("./custom-list-item-view");b.exports=f.extend({options:{showSearch:!0,allowFreeTextInput:!1,typeLabel:"column",itemTemplate:j,itemView:k},className:"CDB-Box-modal CustomList",tagName:"div",initialize:function(a){if(!a.collection){if(!a.options)throw new Error("options array {value, label} is required");this.collection=new g(a.options)}a.position&&this.$el.css(a.position),this.options=d.extend({},this.options,a),this.model=new e.Model({query:"",visible:!1}),this._initBinds()},render:function(){return this.$el.empty(),this.clearSubViews(),this.options.showSearch&&this._renderSearch(),this._renderList(),this.options.showSearch&&this._focusSearch(),this},_initBinds:function(){this.model.bind("change:visible",function(a,b){this._resetQuery(),this._toggleVisibility(),b?this.render():this.clearSubViews()},this)},_renderSearch:function(){this._searchView=new h({template:this.options.searchTemplate,typeLabel:this.options.typeLabel,searchPlaceholder:this.options.searchPlaceholder,model:this.model}),this.$el.prepend(this._searchView.render().el),this.addView(this._searchView)},_focusSearch:function(){setTimeout(function(){this._searchView&&this._searchView.focus()}.bind(this),0)},_renderList:function(){this._listView=new i({model:this.model,allowFreeTextInput:this.options.allowFreeTextInput,collection:this.collection,typeLabel:this.options.typeLabel,ItemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:this.options.size}),this.$el.append(this._listView.render().el),this._listView.highlight(),this.addView(this._listView),this._listView.bind("customEvent",function(a,b){this.trigger(a,b,this)},this)},highlight:function(){this._listView.highlight()},_resetQuery:function(){this.model.set("query","")},show:function(){this.model.set("visible",!0)},hide:function(){this.trigger("hidden",this),this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},_toggleVisibility:function(){this.$el.toggleClass("is-visible",!!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},remove:function(){this._listView&&this._listView.clean(),f.prototype.remove.call(this)}})},{"./custom-list-collection":23,"./custom-list-item-view":26,"./custom-list-item.tpl":28,"./custom-list-search-view":31,"./custom-list-view":33,backbone:"backbone","backbone/core-view":454,underscore:"underscore"}],36:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../sql-notifications"),g=a("../../helpers/sql-utils"),h=a("../../components/notifier/notifier"),i=a("cartodb.js"),j=a("../../helpers/required-opts"),k=["configModel","editorModel","layerDefinitionModel","querySchemaModel"];b.exports=e.extend({initialize:function(a){j(a,k,this),this._clearSQLModel=new d.Model({visible:!1}),this._sqlModel=this._layerDefinitionModel.sqlModel,this._SQL=new i.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")}),this._codemirrorModel=new d.Model({content:this._querySchemaModel.get("query"),readonly:!1}),f.track(this)},_internalParseSQL:function(a){var b=this._querySchemaModel.get("query"),c=this._codemirrorModel.get("content");c&&";"===c.slice(-1)&&(c=c.slice(0,c.length-1),this._codemirrorModel.set("content",c));var d=g.isSameQuery(c,b),e=g.altersData(c);return""===c||d?(f.removeNotification(),!1):void(e?(f.showNotification({status:"loading",info:_t("notifications.sql.alter-loading"),closable:!1}),this._sqlModel.set("content",c),this._SQL.execute(c,null,{success:function(){f.showNotification({status:"success",info:_t("notifications.sql.alter-success"),closable:!0,delay:h.DEFAULT_DELAY}),this._applyDefaultSQLAfterAlteringData(),"function"==typeof a&&a.call(this)}.bind(this),error:function(a){a=a.responseJSON.error;var b=this._parseErrors(a);this._codemirrorModel.set("errors",b),f.showErrorNotification(b),this._checkClearButton()}.bind(this)})):this._runQuery(c,this._saveSQL.bind(this)))},_checkClearButton:function(){var a=this._codemirrorModel.get("content"),b=g.isSameQuery(a,this._defaultSQL());this._clearSQLModel.set({visible:!b})},_applyDefaultSQLAfterAlteringData:function(){var a=this._defaultSQL();this._codemirrorModel.set({content:a,errors:[]}),this._sqlModel.set("content",a),this._querySchemaModel.set("query_errors",[]),this._clearSQLModel.set({visible:!1}),this._querySchemaModel.resetDueToAlteredData(),this._clearSQL()},_clearSQL:function(){var a=this._defaultSQL();this._codemirrorModel.set({content:a,errors:[]}),this._runQuery(a,this._saveSQL.bind(this))},_showErrors:function(a){var b=this._querySchemaModel.get("query_errors"),c=b&&b.length>0;this._codemirrorModel.set("errors",this._parseErrors(b)),this._editorModel.set("disabled",c),c&&f.showErrorNotification(this._parseErrors(b)),this._checkClearButton()},_parseErrors:function(a){return a.map(function(a){return{message:a}})}})},{"../../components/notifier/notifier":252,"../../helpers/required-opts":432,"../../helpers/sql-utils":433,"../../sql-notifications":448,backbone:"backbone","backbone/core-view":454,"cartodb.js":"cartodb.js"}],37:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("cartodb.js"),h=a("./error.tpl");b.exports=f.extend({className:"IntermediateInfo",initialize:function(a){var b=d.defaults(d.pick(a,["title","desc"]),{title:_t("components.error.default-title"),desc:_t("components.error.default-desc")});this._template=this.options&&this.options.template||h,this.model=new e.Model(b)},render:function(){return this.$el.html(this._html()),this},_html:function(){var a=this.model;return this._template({title:a.get("title"),desc:g.core.sanitize.html(a.get("desc"))})}})},{"./error.tpl":38,backbone:"backbone","backbone/core-view":454,"cartodb.js":"cartodb.js",underscore:"underscore"}],38:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LayoutIcon LayoutIcon--negative">\n  <i class="CDB-IconFont CDB-IconFont-cockroach"></i>\n</div>\n<h3 class="CDB-Text CDB-Size-large u-mainTextColor u-errorTextColor u-bSpace--m u-tSpace-xl">'+(null==(__t=title)?"":_.escape(__t))+'</h3>\n<p class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=desc)?"":__t)+"</p>\n";return __p}},{underscore:"underscore"}],39:[function(a,b,c){var d=a("backbone"),e=a("jquery"),f=27;d.Form.editors.Base=d.Form.editors.Base.extend({applyESCBind:function(a){this._ESCBindCallback=a,document.addEventListener("keydown",this._onKeyDown.bind(this))},_onKeyDown:function(a){var b;a.which===f&&(b=this._anyModalOpen(),!b&&this._ESCBindCallback())},applyClickOutsideBind:function(a){this._clickBindCallback=a,this.$el.attr("data-cid",this.cid),document.addEventListener("click",this._onDocumentClick.bind(this))},_onDocumentClick:function(a){var b=e(a.target),c=this._anyModalOpen();0!==b.closest('[data-cid="'+this.cid+'"]').length||c||this._clickBindCallback()},_anyModalOpen:function(){var a=this.options.modals;return!!a&&a.isOpen()},remove:function(){this._ESCBindCallback&&document.removeEventListener("keydown",this._onKeyDown.bind(this)),this._clickBindCallback&&document.removeEventListener("click",this._onDocumentClick.bind(this)),d.View.prototype.remove.call(this)}})},{backbone:"backbone",jquery:"jquery"}],40:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("../../../editor/editor-hints/factory-hints"),g=a("../../code-mirror/code-mirror-view");e.Form.editors.CodeEditor=e.Form.editors.TextArea.extend({render:function(){return this.setValue(this.value),this._codemirrorModel=new e.Model({content:this.value,readonly:!1,lineNumbers:!1}),f.init({tokens:this.options.tokens,tableName:!1,columnsName:!1}),this._initViews(),this._toggleDisableState(),this},getValue:function(){var a=this.$el.val();return a=this.codeMirrorView.getContent(),""===a?null:a},_initViews:function(){this._destroyEditor();var a=f.reset().hints;this.codeMirrorView=new g({model:this._codemirrorModel,hints:a,mode:"text/mustache",autocompleteChars:2,autocompletePrefix:"{{",autocompleteSuffix:"}}",placeholder:this.options.placeholder,tip:""}),this.codeMirrorView.bind("codeChanged",function(){this.trigger("change",this.codeMirrorView.getContent())},this);var b=d(this.codeMirrorView.render().el);this.$el.replaceWith(b),this.setElement(b),this.$el.addClass("CodeMirror-formInput"),this._addTrackingClass()},_addTrackingClass:function(){if(this.options.trackingClass){var a=this.options.trackingClass+" track-"+this.options.key+this.options.editorType;this.$el.addClass(a)}},_hasEditor:function(){return this.options.editor&&!!this.codeMirrorView},_destroyEditor:function(){this._hasEditor()&&this.codeMirrorView.remove()},remove:function(){this._destroyEditor(),e.Form.editors.Base.prototype.remove.apply(this)},clean:function(){this.$el.remove()}})},{"../../../editor/editor-hints/factory-hints":405,"../../code-mirror/code-mirror-view":5,backbone:"backbone",jquery:"jquery"}],41:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../../../helpers/required-opts"),g=a("../../../../components/stack-layout/stack-layout-view"),h=a("./measurement-list-view"),i=a("./filter-list-view"),j=["measurementsCollection","filtersCollection"];b.exports=e.extend({className:"CDB-Box-modal CustomList",initialize:function(a){f(a,j,this),this.model=new d.Model({visible:!1}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._generateStackLayoutView(),this},_initBinds:function(){this.listenTo(this.model,"change:visible",function(a,b){b?this.render():this.clearSubViews(),this._toggleVisibility()})},_generateStackLayoutView:function(){var a=this,b=new d.Collection([{createStackView:function(b,c){return a._createListView(b,c).bind(a)}},{createStackView:function(b,c){return a._createFilterView(b,c).bind(a)}}]);this._stackLayoutView=new g({collection:b}),this.addView(this._stackLayoutView),this.$el.append(this._stackLayoutView.render().$el)},_createListView:function(a,b){var c=new h({measurementsCollection:this._measurementsCollection,filtersCollection:this._filtersCollection});return c.bind("filters",function(){a.nextStep()},this),c},_createFilterView:function(a,b){var c=new i({filtersCollection:this._filtersCollection});return c.bind("back",function(){a.prevStep()},this),c},hide:function(){this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},_toggleVisibility:function(){this.$el.toggleClass("is-visible",!!this.isVisible())},clean:function(){e.prototype.clean.apply(this,arguments)}})},{"../../../../components/stack-layout/stack-layout-view":274,"../../../../helpers/required-opts":432,"./filter-list-view":47,"./measurement-list-view":52,backbone:"backbone","backbone/core-view":454}],42:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",__p+="undefined"!=typeof isLoading&&isLoading?'\n  <div class="u-flex">\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n    <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n  </div>\n":"\n  "+(null==(__t=label)?"":_.escape(__t))+"\n",__p+="\n";return __p}},{underscore:"underscore"}],43:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("./dropdown.tpl"),g=a("./dropdown-item.tpl"),h=a("./dropdown-dialog-view"),i=a("../../../popup-manager"),j=a("./measurements-collection"),k=a("./measurements-filters-collection"),l=13,m={idle:"idle",loading:"loading",fetching:"fetching",fetched:"fetched",error:"error"};d.Form.editors.DataObservatoryDropdown=d.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},options:{selectedItemTemplate:g},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.template=a.template||f,this.dialogMode=this.options.dialogMode||"nested";var b={configModel:this.options.configModel,layerDefinitionModel:this.options.layerDefinitionModel,country:this.model.get("country")||null};this.measurementsCollection=new j([],b),this.filtersCollection=new k([],b),this._modelView=new d.Model({state:m.idle}),this._initBinds(),this._dialogView=new h({measurementsCollection:this.measurementsCollection,filtersCollection:this.filtersCollection}),this._fetch()},render:function(){var a=this._isLoading(),b=!this._hasItems(),c=!!b||this.options.disabled,d=this.model.get(this.options.keyAttr),e=this.measurementsCollection.getItem(d),f=null===d,g=f?"null":!!e&&e.get("name"),h=this.options.placeholder;return this.$el.html(this.template({label:g,keyAttr:this.options.keyAttr,placeholder:h,isDisabled:c,isLoading:a,isEmpty:b,isNull:f})),this._popupManager=new i(this.cid,this.$el,this._dialogView.$el),this._popupManager.append(this.dialogMode),this},_initBinds:function(){var a=function(){this._dialogView.hide(),this._popupManager.untrack()}.bind(this);this.applyESCBind(a),this.applyClickOutsideBind(a),this.listenTo(this.measurementsCollection,"change:selected",this._onItemSelected),this.listenTo(this._modelView,"change:state",this.render),this.listenTo(this.model,"change:country",this._fetch)},_fetch:function(){var a={success:this._onFetchSuccess.bind(this),error:this._onFetchError.bind(this)};this.measurementsCollection.fetch(a),this.filtersCollection.fetch(a),this._modelView.set({state:m.loading}),this.setValue(this.model.get(this.options.keyAttr))},_onFetchSuccess:function(){var a=this.measurementsCollection.getState()===m.fetched,b=this.filtersCollection.getState()===m.fetched;b&&a&&this._modelView.set({state:m.fetched})},_onFetchError:function(){this._modelView.set({state:m.error})},_hasItems:function(){var a=this.measurementsCollection.getState();return a===m.fetched&&this.measurementsCollection.filter(function(a){var b=a.get("filter");return b.length>0}).length>0},_isLoading:function(){var a=this.measurementsCollection.getState();return a===m.fetching},_onItemSelected:function(a){this._dialogView.hide(),this._popupManager.untrack(),this._renderButton(a).focus(),this.trigger("change",this)},_onButtonClick:function(){this._hasItems()&&(this._dialogView.toggle(),this._dialogView.isVisible()?this._popupManager.track():this._popupManager.untrack())},_onButtonKeyDown:function(a){a.which===l&&(a.preventDefault(),this._dialogView.isVisible()?this._popupManager.track():(a.stopPropagation(),this._onButtonClick()))},getValue:function(){var a=this.measurementsCollection.getSelectedItem();if(a)return a.getName()},setValue:function(a){var b=this.measurementsCollection.setSelected(a);b&&this._renderButton(b),this.value=a},_renderButton:function(a){var b=this.$(".js-button"),c=this.options.selectedItemTemplate({label:a.getName()});return b.removeClass("is-empty").html(c),b},remove:function(){this._popupManager&&this._popupManager.destroy(),this._dialogView&&this._dialogView.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../popup-manager":263,"../editor-helpers-extend":62,"./dropdown-dialog-view":41,"./dropdown-item.tpl":42,"./dropdown.tpl":44,"./measurements-collection":54,"./measurements-filters-collection":55,backbone:"backbone"}],44:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-InputText CDB-Text is-cursor js-button u-ellipsis\n  ',isDisabled&&(__p+=" is-disabled "),__p+="\n  ",label||(__p+=" is-empty "),__p+="\n  ",isNull&&(__p+=" is-empty "),__p+='"\n  tabindex="0">\n  ',isLoading?__p+='\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark u-iBlock">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n    <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n  ":(__p+="\n    ",__p+=isEmpty?"\n      "+(null==(__t=_t("components.backbone-forms.select.empty"))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=placeholder||label||_t("components.backbone-forms.select.placeholder",{keyAttr:keyAttr}))?"":_.escape(__t))+"\n    ",__p+="\n  "),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],45:[function(a,b,c){var d=a("underscore"),e=a("../../../custom-list/custom-list-multi-item-view"),f=d.template("<%-name %> (<%- items %>)");b.exports=e.extend({render:function(){this.clearSubViews(),this.$el.empty();var a=null==this.model.getName()?"null":this.model.getName();return a=a.replace(/"/g,""),this.$el.append(this.options.template(d.extend({isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),name:f({name:a,items:this.model.get("items")}),val:this.model.getValue(),description:this.model.get("description")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},{"../../../custom-list/custom-list-multi-item-view":30,underscore:"underscore"}],46:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink\n  ',isSelected&&(__p+=" is-selected "),__p+='\n  " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  <div class="u-flex">\n    <div class="u-iBlock u-rSpace--m">\n      <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',isSelected&&(__p+="checked"),__p+=" ",isDisabled&&(__p+="disabled"),__p+=' />\n      <span class="u-iBlock CDB-Checkbox-face"></span>\n    </div>\n    <div>\n      <div class="u-bSpace">'+(null==(__t=name)?"":_.escape(__t))+'</div>\n      <div class="CDB-Size-small u-altTextColor">'+(null==(__t=description)?"":_.escape(__t))+"</div>\n    </div>\n  </div>\n</button>\n";return __p}},{underscore:"underscore"}],47:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../custom-list/custom-view"),f=a("./filter-list-item-view"),g=a("./filter-list-item.tpl"),h=a("./filter-list-view.tpl"),i=a("../../../../helpers/required-opts"),j=["filtersCollection"];b.exports=d.extend({events:{"click .js-back":"_onClickBack"},initialize:function(a){i(a,j,this),this._initBinds(),this._listView=new e({className:"DO-Filters",typeLabel:_t("components.backbone-forms.data-observatory.dropdown.filter.filters"),showSearch:!1,collection:this._filtersCollection,itemTemplate:g,itemView:f}),this.addView(this._listView)},render:function(){return this.$el.append(h({headerTitle:_t("components.backbone-forms.data-observatory.dropdown.filter.header")})),this.$(".js-content").append(this._listView.render().$el),this},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_initBinds:function(){this.listenTo(this._filtersCollection,"change:selected",this._onSelectItem,this)},_onSelectItem:function(a){this.trigger("selectItem",a,this)}})},{"../../../../helpers/required-opts":432,"../../../custom-list/custom-view":35,"./filter-list-item-view":45,"./filter-list-item.tpl":46,"./filter-list-view.tpl":48,"backbone/core-view":454}],48:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <button class="u-actionTextColor js-back u-rSpace">\n        <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n      </button>\n      '+(null==(__t=headerTitle)?"":_.escape(__t))+'\n    </li>\n  </ul>\n</div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],49:[function(a,b,c){var d=a("underscore"),e=a("../../../custom-list/custom-list-item-view");b.exports=e.extend({render:function(){this.$el.empty(),this.clearSubViews();var a=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(d.extend({isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),name:a,val:this.model.getValue(),description:this.model.get("description")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},{"../../../custom-list/custom-list-item-view":26,underscore:"underscore"}],50:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink\n    ',isSelected&&(__p+=" is-selected "),__p+='\n  " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  <div class="u-bSpace">'+(null==(__t=name)?"":_.escape(__t))+'</div>\n  <div class="CDB-Size-small u-altTextColor">'+(null==(__t=description)?"":_.escape(__t))+"</div>\n</button>\n";return __p}},{underscore:"underscore"}],51:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeaderItem">\n  <div  class="u-flex u-grow">\n    <div class="u-flex u-grow">\n      <input type="text" name="text" autocomplete="off" placeholder="'+(null==(__t=searchPlaceholder)?"":_.escape(__t))+'" class="CDB-InputTextPlain CDB-Text js-search">\n      <button type="button" style="display:none" class="u-lSpace--xl u-rSpace--xl js-clear">\n        <div class="CDB-Shape">\n          <div class="CDB-Shape-close is-blue is-large"></div>\n        </div>\n      </button>\n    </div>\n\n    <div>\n      <button class="CDB-Text CDB-Size-medium u-actionTextColor js-filters u-rSpace--m">'+(null==(__t=_t("analyses.data-observatory-measure.filters"))?"":_.escape(__t))+"</button>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],52:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../../custom-list/custom-list-collection"),g=a("../../../custom-list/custom-view"),h=a("./measurement-list-item-view"),i=a("./measurement-list-item.tpl"),j=a("../../../../helpers/required-opts"),k=a("./measurement-list-search.tpl"),l=["measurementsCollection","filtersCollection"];b.exports=d.extend({events:{"click .js-filters":"_onClickFilters"},initialize:function(a){j(a,l,this),this._initCollection(),this._initBinds(),this._listView=new g({className:"DO-Measurements",typeLabel:_t("components.backbone-forms.data-observatory.dropdown.measurement.type"),showSearch:!0,itemView:h,searchTemplate:k,collection:this.collection,itemTemplate:i,searchPlaceholder:_t("components.backbone-forms.data-observatory.dropdown.measurement.search")}),this.addView(this._listView)},render:function(){return this.$el.append(this._listView.render().$el),this},_initCollection:function(){var a=e.map(this._filtersCollection.getSelected(),function(a){return a.getValue()}),b=this._measurementsCollection.filter(function(b){var c=b.get("filter");return a.length>0?e.some(c,function(b){return a.indexOf(b.id)>=0}):c.length>0});this.collection=new f(e.map(b,function(a){return a.attributes}))},_onClickFilters:function(a){this.killEvent(a),this.trigger("filters")},_initBinds:function(){this.listenTo(this.collection,"change:selected",this._onSelectItem)},_onSelectItem:function(a){this._measurementsCollection.setSelected(a.getValue())}})},{"../../../../helpers/required-opts":432,"../../../custom-list/custom-list-collection":23,"../../../custom-list/custom-view":35,"./measurement-list-item-view":49,"./measurement-list-item.tpl":50,"./measurement-list-search.tpl":51,"backbone/core-view":454,underscore:"underscore"}],53:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("cartodb.js"),g=a("../../../../helpers/error-parser"),h=a("../../../../helpers/required-opts"),i=["configModel","layerDefinitionModel"];b.exports=d.Collection.extend({initialize:function(a,b){h(b,i,this),this._country=b.country||"NULL",this._querySchemaModel=this._layerDefinitionModel.getAnalysisDefinitionNodeModel().querySchemaModel;var c=b.configModel;this.SQL=new f.SQL({user:c.get("user_name"),sql_api_template:c.get("sql_api_template"),api_key:c.get("api_key")}),this._state="unfetched"},fetch:function(a){this._success=a&&a.success,this._error=a&&a.error;var b=this._layerDefinitionModel.getTableName(),c=this._querySchemaModel.get("query"),d=this._queryTemplate({table:b,query:c,country:this._country});this.isFetching()||(this._state="fetching",this.SQL.execute(d,null,{success:function(a){this._state="fetched",this._onFetchSuccess(a),this._success&&this._success()}.bind(this),error:function(a){this._state="error",this._error&&this._error(g(a))}.bind(this)}))},_onFetchSuccess:function(a){var b=a.rows;this.reset(b)},isFetching:function(){return"fetching"===this.getState()},getState:function(){return this._state},getSelectedItem:function(){return e.first(this.getSelected())},getSelected:function(){return this.filter(function(a){return a.get("selected")===!0})},removeSelected:function(){this.each(function(a){a.set({selected:!1})})}})},{"../../../../helpers/error-parser":426,"../../../../helpers/required-opts":432,backbone:"backbone","cartodb.js":"cartodb.js",underscore:"underscore"}],54:[function(a,b,c){var d=a("underscore"),e=a("./measurements-base-collection"),f=a("../../../custom-list/custom-list-item-model"),g="SELECT * FROM OBS_GetAvailableNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM (<%- query %>) q), <%- country %>) numers";b.exports=e.extend({initialize:function(a,b){this._queryTemplate=d.template(g),e.prototype.initialize.call(this,a,b)},model:function(a,b){var c={};c.val=a.numer_id,c.label=a.numer_name,c.description=a.numer_description,c.filter=[];var d=JSON.parse(a.numer_tags);for(var e in d)/^subsection/.test(e)&&c.filter.push({id:e,name:d[e]}),/^license/.test(e)&&(c.license=d[e]);return new f(c)},getItem:function(a){return this.findWhere({val:a})},setSelected:function(a){var b,c={silent:!0};return this.each(function(d){d.getValue()===a?(d.set({selected:!0}),b=d):d.set({selected:!1},c)}),b}})},{"../../../custom-list/custom-list-item-model":25,"./measurements-base-collection":53,underscore:"underscore"}],55:[function(a,b,c){var d=a("underscore"),e=a("./measurements-base-collection"),f=a("../../../custom-list/custom-list-item-model"),g="SELECT count(*) num_measurements, tag.key subsection_id, tag.value subsection_name FROM OBS_GetAvailableNumerators((SELECT ST_SetSRID(ST_Extent(the_geom), 4326) FROM (<%- query %>) q), <%- country %>) numers, Jsonb_Each(numers.numer_tags) tag WHERE tag.key like 'subsection%' GROUP BY tag.key, tag.value";b.exports=e.extend({initialize:function(a,b){this._queryTemplate=d.template(g),e.prototype.initialize.call(this,a,b)},model:function(a,b){var c={};return c.val=a.subsection_id,c.label=a.subsection_name,c.items=a.num_measurements,new f(c)},setSelected:function(a){var b={silent:!0};d.isArray(a)?this.each(function(c){d.contains(a,c.getValue())?c.set({selected:!0},b):c.set({selected:!1},b)}):this.each(function(c){c.getValue()===a?c.set({selected:!0},b):c.set({selected:!1},b)})},search:function(){return d(this.models)},containsValue:function(a){return this.length>0}})},{"../../../custom-list/custom-list-item-model":25,"./measurements-base-collection":53,underscore:"underscore"}],56:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{show:!1},show:function(){this.set("show",!0)},hide:function(){this.set("show",!1)},isHidden:function(){return!this.get("show")},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone"}],57:[function(a,b,c){var d=a("backbone/core-view"),e=a("./datetime-editor-view");b.exports=d.extend({className:"CDB-Box-modal CustomList CustomList--inputs is-visible has-visibility js-datetimePicker",initialize:function(){this._initBinds()},render:function(){return this.clearSubViews(),this._datetimeEditorView=new e({model:this.model}),this.addView(this._datetimeEditorView),this.$el.append(this._datetimeEditorView.render().el),this},_initBinds:function(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},_onShowChange:function(a,b){b?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),
this.$el.hide())},show:function(){this.model.show()},hide:function(){this.model.hide()},_onDestroy:function(){this.hide(),this.clean()}})},{"./datetime-editor-view":59,"backbone/core-view":454}],58:[function(a,b,c){var d=a("backbone"),e=a("../../../../helpers/utils"),f=a("moment"),g=[{val:0,label:_t("months.january")},{val:1,label:_t("months.february")},{val:2,label:_t("months.march")},{val:3,label:_t("months.april")},{val:4,label:_t("months.may")},{val:5,label:_t("months.june")},{val:6,label:_t("months.july")},{val:7,label:_t("months.august")},{val:8,label:_t("months.september")},{val:9,label:_t("months.october")},{val:10,label:_t("months.november")},{val:11,label:_t("months.december")}];b.exports=d.Model.extend({initialize:function(){this.schema={day:{type:"Text",title:"",validators:["required",/^(([0]?[1-9])|([1-2][0-9])|(3[01]))$/,function(a,b){var c=f(e.formatDate(b));if(!c.isValid())return{type:"date",message:_t("components.datepicker.invalid-date")}}]},month:{type:"Select",title:"",position:{left:0,"min-width":"200px"},options:g},year:{title:"",type:"Text",validators:["required",/^([0-9]{0,4})$/]},time:{title:"",type:"Text",validators:["required",/^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/]}}},getFormattedDate:function(){return e.formatDate(this.toJSON())}})},{"../../../../helpers/utils":435,backbone:"backbone",moment:"moment"}],59:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("moment"),g=a("./datetime-editor-model");b.exports=e.extend({tagName:"div",className:"Table-editorDate",events:{keyup:"_onKeyUp"},initialize:function(){var a=this.model.get("value"),b={};b=a?f(a).utc():f().utc(),this._formModel=new g({day:b.date(),month:b.month(),year:b.year(),time:b.format("HH:mm:ss"),utcOffset:b.utcOffset()}),this._formModel.bind("change",this._setValue,this),this.add_related_model(this._formModel),this._setValue()},render:function(){return this._formView=new d.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.html(this._formView.render().el),this},_setValue:function(){this.model.set("value",this._formModel.getFormattedDate())},_onKeyUp:function(){this._setValue()},clean:function(){this._formView.remove(),e.prototype.clean.apply(this)}})},{"./datetime-editor-model":58,backbone:"backbone","backbone/core-view":454,moment:"moment"}],60:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("moment"),g=a("./datetime-dialog-model"),h=a("./datetime-dialog-view"),i=a("./datetime.tpl"),j=a("../../../popup-manager");d.Form.editors.DateTime=d.Form.editors.Base.extend({className:"Editor-formInput u-flex u-alignCenter",events:{"click .js-input":"_onInputClick"},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.dialogMode=this.options.dialogMode||"nested",this._initBinds(),this.render()},render:function(){return d.Form.editors.Base.prototype.render.apply(this,arguments),this._removeDateTimeDialog(),this.$el.html(i({value:this._getFormattedDatetime()})),this._initViews(),this},_getFormattedDatetime:function(){if(this.value){var a=new Date(this.value).toUTCString(),b=f(a).utc();return b.format("YYYY-MM-DD")+"T"+b.format("HH:mm:ss")+"Z"}return null},_initViews:function(){this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._datetimeDialogModel=new g({value:this._getFormattedDatetime()}),this._datetimeDialogModel.bind("change:value",this._onInputChanged,this),this._datetimeDialogView=new h({model:this._datetimeDialogModel}),this._popupManager=new j(this.cid,this.$el,this._datetimeDialogView.$el)},_initBinds:function(){var a=function(){this._removeDateTimeDialog()}.bind(this);this.applyESCBind(a),this.applyClickOutsideBind(a)},_onInputClick:function(){this._datetimeDialogView.render(),this._popupManager.append(this.dialogMode),this._popupManager.track()},_removeDateTimeDialog:function(){this._datetimeDialogView&&(this._popupManager.untrack(),this._datetimeDialogView.remove())},_onInputChanged:function(a){var b=this._datetimeDialogModel.get("value");this.setValue(b),this.trigger("change",this)},_updateInput:function(a){this.$(".js-input").toggleClass("is-empty",!a).text(a)},getValue:function(){return this._datetimeDialogModel.get("value")},setValue:function(a){this._updateInput(a),this.value=a},remove:function(){this._removeDateTimeDialog(),this._popupManager&&this._popupManager.destroy(),d.Form.editors.Base.prototype.remove.apply(this)}})},{"../../../popup-manager":263,"../editor-helpers-extend":62,"./datetime-dialog-model":56,"./datetime-dialog-view":57,"./datetime.tpl":61,backbone:"backbone",moment:"moment"}],61:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-InputText\n  ',value||(__p+=" is-empty "),__p+='\n  u-txt-left js-input">'+(null==(__t=value?value:"null")?"":_.escape(__t))+"</button>\n";return __p}},{underscore:"underscore"}],62:[function(a,b,c){var d=a("underscore");b.exports={setOptions:function(a,b){var c=[];if(b.schema&&b.schema.validators&&(c=c.concat(b.schema.validators)),a.options&&a.options.validators&&(c=c.concat(a.options.validators)),a.validators=c,a.options=d.extend({},d.omit(a.options,"validators")||{},b.schema,b.schema&&b.schema.editorAttrs||{},b.editorAttrs,{keyAttr:b.key},{validators:c},d.omit(b,"validators")),a.options.className&&a.$el.addClass(a.options.className),a.options.trackingClass){var e=a.options.trackingClass+" track-"+a.options.key+a.options.editorType;a.$el.addClass(e)}}}},{underscore:"underscore"}],63:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("jquery"),g=a("underscore"),h=a("../../../tipsy-tooltip-view"),i=a("./enabler-editor.tpl");d.Form.editors.EnablerEditor=d.Form.editors.Base.extend({tagName:"div",className:"Editor-checker u-flex u-alignCenter",events:{"click .js-check":"_onCheckClicked"},initialize:function(a){if(d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.validators=null,!this.options.editor)throw new Error("editor options is required");this._editorOptions=this.options.editor,this.value=this.model.get(a.key),this._checkModel=new d.Model({enabled:!!this.value}),this.template=i,this._initBinds()},render:function(){return this.$el.html(this.template({label:this.options.label,isChecked:this._isChecked(),help:this.options.help||""})),this.options.help&&(this._helpTooltip=new h({el:this.$(".js-help"),gravity:"s",offset:0,title:function(){return f(this).data("tooltip")}})),this._renderComponent(),this},_initBinds:function(){this._checkModel.bind("change:enabled",function(a,b){this._manageValue(b),this._renderComponent(),this._triggerChange()},this)},_manageValue:function(a){a?(this.validators=this.options.validators,this.value=this.options.defaultValue||"",this._editorComponent.setValue(this.options.defaultValue||"")):(this.validators=null,this.value="",this._editorComponent.setValue("")),this.model.set(this.options.keyAttr,this.value),this.validate()},_isChecked:function(){return this._checkModel.get("enabled")},_renderComponent:function(){this._editorComponent&&this._removeComponent();var a=d.Form.editors[this._editorOptions.type],b=g.extend(this._editorOptions.editorAttrs||{},{disabled:!this._isChecked()});this._editorComponent=new a(g.extend({model:this.model,key:this.options.keyAttr,editorAttrs:b,trackingClass:this.options.trackingClass,editorType:this._editorOptions.type},g.omit(this._editorOptions,"editorAttrs","type"))),this._editorComponent.bind("change",this._setEditorComponentValue,this),this.$(".js-editor").html(this._editorComponent.render().el);try{this._editorComponent.focus()}catch(a){}},_removeComponent:function(){this._editorComponent.remove(),this._editorComponent.unbind("change",this._setEditorComponentValue,this)},_setEditorComponentValue:function(){this.value=this._editorComponent.getValue(),this._triggerChange()},_triggerChange:function(){this.trigger("change",this)},getValue:function(){return this._checkModel.get("enabled")?this._editorComponent&&this._editorComponent.getValue()||"":""},setValue:function(a){this._checkModel.set("enabled",!!a),this._editorComponent&&this._editorComponent.setValue(a),this.value=a},_onCheckClicked:function(a){this._checkModel.set("enabled",f(a.target).is(":checked"))},remove:function(){this._editorComponent&&this._removeComponent(),this._helpTooltip&&this._helpTooltip.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../tipsy-tooltip-view":325,"../editor-helpers-extend":62,"./enabler-editor.tpl":64,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],64:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex Editor-checkerInput CDB-Text CDB-Size-medium u-rSpace--xl">\n  <input class="CDB-Checkbox js-check" type="checkbox" name="" value="" ',isChecked&&(__p+="checked"),__p+='>\n  <span class="CDB-Checkbox-face u-rSpace--m"></span>\n  <label class="CDB-Text CDB-Size-small u-ellipsis u-upperCase is-semibold u-flex u-alignCenter Editor-formLabel">\n    <span class="u-ellipsis ',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+='  title="'+(null==(__t=label)?"":_.escape(__t))+'">'+(null==(__t=label)?"":_.escape(__t))+'</span>\n  </label>\n</div>\n<div class="Editor-checkerComponent js-editor"></div>\n';return __p}},{underscore:"underscore"}],65:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<label class="CDB-Legend u-upperCase CDB-Text is-semibold CDB-Size-small">\n  <div class="u-flex u-alignCenter">\n    <div class="u-iBlock u-rSpace--m">\n      <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',checked&&(__p+="checked"),__p+=" ",disabled&&(__p+="disabled"),__p+='>\n      <span class="u-iBlock CDB-Checkbox-face"></span>\n    </div>\n    <span class="',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+=" >"+(null==(__t=label)?"":_.escape(__t))+'</span>\n  </div>\n</label>\n<div class="Editor-checkerComponent js-editor"></div>\n';return __p}},{underscore:"underscore"}],66:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("jquery"),g=a("../../../tipsy-tooltip-view"),h=a("./enabler.tpl"),i=a("./enabler-reversed.tpl");d.Form.editors.Enabler=d.Form.editors.Base.extend({tagName:"div",events:{"change .js-input":"_onCheckChange","focus .js-input":function(){this.trigger("focus",this)},"blur .js-input":function(){this.trigger("blur",this)}},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.template=a.schema&&a.schema.editorAttrs&&a.schema.editorAttrs.reversed?i:a.template||h,this._initViews()},_initViews:function(){this.$el.html(this.template({checked:!this.options.disabled&&this.model.get(this.options.key),label:this.options.label,title:this.options.title,help:this.options.help||"",disabled:this.options.disabled})),this.options.help&&(this._removeTooltip(),this._helpTooltip=new g({el:this.$(".js-help"),gravity:"s",title:function(){return f(this).data("tooltip")}})),this.options.disabled&&this.undelegateEvents()},_onCheckChange:function(){var a=this.$(".js-input").is(":checked");this.model.set("enabler",a),this.trigger("change",this)},getValue:function(){return this.$(".js-input").is(":checked")},setValue:function(a){this.$(".js-input")[a?"attr":"removeAttr"]("checked",""),this.model.set(this.key,a)},_removeTooltip:function(){this._helpTooltip&&this._helpTooltip.clean()},remove:function(){this._removeTooltip(),d.Form.editors.Base.prototype.remove.apply(this)}})},{"../../../tipsy-tooltip-view":325,"../editor-helpers-extend":62,"./enabler-reversed.tpl":65,"./enabler.tpl":67,backbone:"backbone",jquery:"jquery"}],67:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<label class="CDB-Legend u-upperCase CDB-Text is-semibold CDB-Size-small">\n  <div class="u-flex u-alignCenter">\n    <div class="u-iBlock u-rSpace--m">\n      <input class="CDB-Checkbox js-input" type="checkbox" name="" value="" ',checked&&(__p+="checked"),__p+=" ",disabled&&(__p+="disabled"),__p+='>\n      <span class="u-iBlock CDB-Checkbox-face"></span>\n    </div>\n    <span class="',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+=" >"+(null==(__t=title)?"":_.escape(__t))+'</span>\n  </div>\n</label>\n<div class="CDB-Text CDB-Size-medium Editor-formInput js-editor"></div>\n';return __p}},{underscore:"underscore"}],68:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="colorpicker dropdown-menu">\n  <div class="colorpicker-saturation">\n    <i><b></b></i>\n  </div>\n  <div class="colorpicker-hue">\n    <i class="ColorPicker-ball"></i>\n  </div>\n  <div class="colorpicker-alpha js-alpha">\n    <i class="ColorPicker-ball"></i>\n  </div>\n  <div class="ColorPicker-colorWrapper">\n    <div class="ColorPicker-color colorpicker-color js-color"></div>\n  </div>\n</div>';return __p}},{underscore:"underscore"}],69:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("backbone/core-view");a("bootstrap-colorpicker");var h=a("./template.tpl"),i=a("./color-picker-template.tpl"),j=a("../../../../../helpers/utils"),k=27;b.exports=g.extend({events:{"blur .js-hex":"_onChangeHex","blur .js-inputColor":"_onChangeColorValue","blur .js-a":"_onChangeOpacity"},initialize:function(a){var b=null!=a.opacity?a.opacity:1;this.model=new f.Model({hex:a.value,opacity:b}),this._onEscape=this._onEscapePressed.bind(this),this._initBinds()},render:function(){var a=j.hexToRGB(this.model.get("hex")),b=e.extend(a,{hex:this.model.get("hex"),opacity:this.model.get("opacity"),opacityDisabled:this.options.disableOpacity});this.$el.append(h(b));var c=e.template("rgba(<%- r %>, <%- g %>, <%- b %>, <%- opacity %>)");this.$(".js-colorPicker").colorpicker({color:c(b),format:"rgba",container:!0,horizontal:!0,inline:!0,customClass:"ColorPicker",template:i(),slidersHorz:{saturation:{maxLeft:206,maxTop:95,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:180,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:180,maxTop:0,callLeft:"setAlpha",callTop:!1}}}),this.options.disableOpacity&&this.$(".js-colorPicker .js-alpha").addClass("is-hidden");var d=function(a){var b=a.color.toRGB(),c=a.color.toHex();this.model.set({hex:c,r:b.r,g:b.g,b:b.b,opacity:b.a}),this.$(".js-color").css("opacity",b.a)}.bind(this);return this.$(".js-colorPicker").colorpicker().on("changeColor",d),this._initDocumentBinds(),this},_initBinds:function(){this.model.bind("change:hex",this._onChangeColor,this),this.model.bind("change:r",this._onChangeColor,this),this.model.bind("change:g",this._onChangeColor,this),this.model.bind("change:b",this._onChangeColor,this),this.model.bind("change:opacity",this._onChangeColor,this)},_onEscapePressed:function(a){a.which===k&&this.remove()},_initDocumentBinds:function(){d(document).on("keydown",this._onEscape)},_destroyDocumentBinds:function(){d(document).off("keydown",this._onEscape)},_onChangeColor:function(){this.trigger("change",{opacity:this.model.get("opacity"),hex:this.model.get("hex")},this),this.$(".js-hex").val(this.model.get("hex")),this.$(".js-r").val(this.model.get("r")),this.$(".js-g").val(this.model.get("g")),this.$(".js-b").val(this.model.get("b")),this.$(".js-a").val(this.model.get("opacity"))},_onChangeOpacity:function(){var a=+this.$(".js-a").val();e.isNumber(a)&&a>=0&&a<=1&&this.setColor(this.model.get("hex"),a)},_onChangeColorValue:function(a){this.$(a.target).removeClass("has-error");var b=+this.$(".js-r").val(),c=+this.$(".js-g").val(),d=+this.$(".js-b").val(),e=j.rgbToHex(b,c,d);j.isValidHex(e)?this.setColor(e):this.$(a.target).addClass("has-error")},_onChangeHex:function(a){this.$(a.target).removeClass("has-error");var b=this.$(".js-hex").val();j.isValidHex(b)?this.setColor(b):this.$(a.target).addClass("has-error")},setColor:function(a,b){void 0===b&&(b=this.model.get("opacity")||1),this.$(".js-colorPicker").colorpicker("setValue",j.hexToRGBA(a,b))},clean:function(){this._destroyDocumentBinds(),g.prototype.clean.apply(this)}})},{"../../../../../helpers/utils":435,"./color-picker-template.tpl":68,"./template.tpl":70,backbone:"backbone","backbone/core-view":454,"bootstrap-colorpicker":"bootstrap-colorpicker",jquery:"jquery",underscore:"underscore"}],70:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-boxModalContent">\n  <div class="ColorPicker-pickerWrapper js-colorPicker"></div>\n  <div class="ColorPicker-inputs">\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input is-color js-hex" value="'+(null==(__t=hex)?"":_.escape(__t))+'"/>\n      <span class="ColorPicker-inputLabel u-upperCase">HEX</span>\n    </div>\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input js-inputColor js-r" value="'+(null==(__t=r)?"":_.escape(__t))+'"/>\n      <span class="ColorPicker-inputLabel u-upperCase">R</span>\n    </div>\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input js-inputColor js-g" value="'+(null==(__t=g)?"":_.escape(__t))+'" />\n      <span class="ColorPicker-inputLabel u-upperCase">G</span>\n    </div>\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input js-inputColor js-b" value="'+(null==(__t=b)?"":_.escape(__t))+'" />\n      <span class="ColorPicker-inputLabel u-upperCase">B</span>\n    </div>\n    <div class="ColorPicker-inputWrapper CDB-Text">\n      <input type="text" class="CDB-Text CDB-InputText ColorPicker-input js-a',opacityDisabled&&(__p+=" is-disabled"),__p+='" value="'+(null==(__t=opacity)?"":_.escape(__t))+'" ',opacityDisabled&&(__p+="disabled"),__p+=' />\n      <span class="ColorPicker-inputLabel u-upperCase">A</span>\n    </div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],71:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../custom-list/custom-view"),f=a("../../../custom-list/custom-list-collection"),g=a("./column-list-view.tpl");b.exports=d.extend({defaults:{headerTitle:""},events:{"click .js-back":"_onClickBack"},initialize:function(a){if(!a.stackLayoutModel)throw new Error("stackLayoutModel is required");if(!a.columns)throw new Error("columns param is required");this._stackLayoutModel=a.stackLayoutModel,this._columns=a.columns,this._showSearch=a.showSearch||!1,this._typeLabel=a.typeLabel,this._itemTemplate=a.itemTemplate,this.collection=new f(this._columns),this.listenTo(this.collection,"change:selected",this._onSelectItem)},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(g({headerTitle:this.options.headerTitle})),this._initViews(),this},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_initViews:function(){this._listView=new e({collection:this.collection,showSearch:this._showSearch,typeLabel:this._typeLabel,itemTemplate:this._itemTemplate}),this.$(".js-content").append(this._listView.render().$el),this.addView(this._listView)},_onSelectItem:function(a){this.trigger("selectItem",a,this)}})},{"../../../custom-list/custom-list-collection":23,"../../../custom-list/custom-view":35,"./column-list-view.tpl":72,"backbone/core-view":454}],72:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",headerTitle&&(__p+='\n<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <button class="u-actionTextColor js-back u-rSpace">\n        <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n      </button>\n      '+(null==(__t=headerTitle)?"":_.escape(__t))+"\n    </li>\n  </ul>\n</div>\n"),__p+='\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],73:[function(a,b,c){b.exports={number:{quantifications:{items:["quantiles","jenks","equal","headtails"],defaultIndex:0},bins:{items:["2","3","4","5","6","7"],defaultIndex:3}},color:{quantifications:{items:["jenks","equal","headtails","quantiles","category"],defaultIndex:0}},"color-ramps":{quantifications:{items:["quantiles","jenks","equal","headtails","category"],defaultIndex:0},bins:{items:["2","3","4","5","6","7"],defaultIndex:3}}}},{}],74:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=d.Model.extend({defaults:{visible:!0,createContentView:function(){return new e}},createContentView:function(){return this.get("createContentView")(this)},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},isHidden:function(){return!this.get("visible")},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone","backbone/core-view":454}],75:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({className:"Editor-boxModal Editor-FormDialog js-formDialog is-opening",initialize:function(){this._initBinds()},render:function(){return this.clearSubViews(),this._renderContentView(),this},_renderContentView:function(){var a=this.model.createContentView();this.addView(a),this.$el.append(a.render().$el)},_initBinds:function(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},_onShowChange:function(a,b){b?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this.$el.hide())},show:function(){this.model.show()},hide:function(){this.model.hide()},_onDestroy:function(){this.hide(),this.clean()}})},{"backbone/core-view":454}],76:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-boxModalHeader">\n  <nav class="CDB-NavMenu">\n    <ul class="CDB-NavMenu-Inner CDB-NavMenu-inner--no-margin CDB-NavMenu-inner--is-dropdown CDB-Text is-semibold CDB-Size-medium js-menu"></ul>\n  </nav>\n</div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],77:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="CDB-OptionInput-container js-content"></ul>\n';return __p}},{underscore:"underscore"}],78:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../editor-helpers-extend"),g=a("./fill-dialog-model"),h=a("./fill-dialog"),i=a("./input-collection"),j=a("./input-number/input-number"),k=a("./input-color/input-color"),l=a("./fill-template.tpl"),m=a("../../../popup-manager"),n={size:j,color:k,image:k},o={Jenks:"jenks","Equal Interval":"equal","Heads/Tails":"headtails",Quantile:"quantiles"},p=20;e.Form.editors.Fill=e.Form.editors.Base.extend({className:"Form-InputFill CDB-OptionInput CDB-Text js-input",events:{focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(a){e.Form.editors.Base.prototype.initialize.call(this,a),f.setOptions(this,a),this.options=d.extend(this.options,{columns:this.options.options,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,editorAttrs:this.options.editorAttrs,modals:this.options.modals}),this._keyAttr=a.key,this.dialogMode=this.options.dialogMode||"nested",this._initBinds(),this._initViews()},_initViews:function(){this.$el.append(l()),this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._initFillDialog(),this._initInputFields(),this._popupManager=new m(this.cid,this.$el,this._fillDialogView.$el)},_initInputFields:function(){var a;this._inputCollection=new i,d.each(this.model.get(this._keyAttr),function(a,b){this._inputCollection.add(d.extend({type:b},a))},this),this._inputCollection.each(function(b){var c=b.get("type"),d=n[c];if(!d)throw new Error(c+" is not a valid type of constructor");b.get("quantification")&&o[b.get("quantification")]&&b.set("quantification",o[b.get("quantification")],{silent:!0}),a=new d({model:b,columns:this.options.columns,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,modals:this.options.modals,editorAttrs:this.options.editorAttrs?this.options.editorAttrs[c]:{},disabled:this.options.editorAttrs&&this.options.editorAttrs.disabled}),a.bind("click",this._onInputClick,this),this.$(".js-content").append(a.render().$el)},this),this._inputCollection.bind("inputChanged",this._onInputChanged,this)},_initBinds:function(){this.applyESCBind(function(){this._removeDialog()}),this.applyClickOutsideBind(function(){this._removeDialog()})},_onInputClick:function(a){return a.get("selected")?void this._removeDialog():(a.set("selected",!0),this._fillDialogView.model.set("createContentView",a.get("createContentView")),this._fillDialogView.render(),this._fillDialogView.show(),this._popupManager.append(this.dialogMode),void this._popupManager.track())},_onInputChanged:function(a){this._adjustImageSize(a),this.trigger("change",this)},_adjustImageSize:function(a){if("color"===a.get("type")||"marker"===a.get("kind")){var b=a.get("image")&&a.hasChanged("image")&&!a.previous("image"),c=d.isEmpty(d.compact(a.get("images"))),e=d.isEmpty(d.compact(a.previous("images"))),f=!c&&a.hasChanged("images")&&e;if(b||f){var g=this._inputCollection.findWhere({type:"size"});g&&g.get("fixed")<p&&g.set("fixed",p)}}},_initFillDialog:function(){var a=new g;this.listenToOnce(a,"destroy",function(){this._fillDialogView=null,this.stopListening(a)}),this._fillDialogView=new h({model:a})},_removeDialog:function(a){this._inputCollection.unselect(),this._fillDialogView.remove(),this._popupManager.untrack()},focus:function(){this.hasFocus||this.$(".js-fillInput").focus()},blur:function(){this.hasFocus&&this.$(".js-fillInput").blur()},getValue:function(){return this._inputCollection.getValues()},setValue:function(a){},remove:function(){this._removeDialog(),this._popupManager.destroy(),this._inputCollection.unbind("inputChanged",this._onInputChanged,this),e.Form.editors.Base.prototype.remove.apply(this)}})},{"../../../popup-manager":263,"../editor-helpers-extend":62,"./fill-dialog":75,"./fill-dialog-model":74,"./fill-template.tpl":77,"./input-collection":79,"./input-color/input-color":121,"./input-number/input-number":137,backbone:"backbone",underscore:"underscore"}],79:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=["size","color"];b.exports=d.Collection.extend({constructor:function(a,b){b=e.extend(b||{},{silent:!1}),d.Collection.prototype.constructor.call(this,a,b)},comparator:function(a){return f.indexOf(a.get("type"))},initialize:function(){this.bind("change:selected",this._onSelectedChange,this),this.bind("change",this._onModelsChanged,this)},getSelected:function(){return this.find(function(a){return a.get("selected")})},unselect:function(){this.each(function(a){a.set("selected",!1)},this)},_onSelectedChange:function(a,b){b&&this.each(function(b){b!==a&&b.set("selected",!1)},this)},_onModelsChanged:function(a){var b=a.changed;e.isEmpty(b)||1===e.size(b)&&a.changed.hasOwnProperty("selected")||this.trigger("inputChanged",a,this)},getValues:function(){return this.reduce(function(a,b){var c={},d=b.toJSON();return d.fixed?(c.fixed=d.fixed,"color"===d.type&&(d.image&&(c.image=d.image),d.kind&&(c.kind=d.kind),c.opacity=d.opacity)):c=e.omit(d,["createContentView","selected","type"]),a[d.type]=c,a},{})}})},{backbone:"backbone",underscore:"underscore"}],80:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../../helpers/required-opts"),f=a("./asset-header-view.tpl"),g=["title","editable"];b.exports=d.extend({events:{"click .js-remove":"_onClickRemove","click .js-select-all":"_onClickSelectAll","click .js-deselect-all":"_onClickDeselectAll"},initialize:function(a){e(a,g,this),this._assetsCollection=this.options.assetsCollection,this._initBinds()},render:function(){this.clearSubViews();var a=this._getSelectedAssetsCount(),b=this._assetsCollection.size();return this.$el.html(f({title:this._title,editable:this._editable,assetsCount:b,selectedCount:a,allSelected:a===b})),this},_initBinds:function(){this.listenTo(this._assetsCollection,"add change remove",this.render)},_onClickRemove:function(){this.trigger("remove")},_onClickSelectAll:function(){this.trigger("select-all")},_onClickDeselectAll:function(){this.trigger("deselect-all")},_getSelectedAssetsCount:function(){var a=this._assetsCollection.where({state:"selected"});return a?a.length:0}})},{"../../../../../../helpers/required-opts":432,"./asset-header-view.tpl":81,"backbone/core-view":454}],81:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul>\n  <li class="CDB-NavSubmenu-item">\n    <h2 class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=title)?"":_.escape(__t))+"</h2>\n  </li>\n  ",editable&&assetsCount>0&&(__p+="\n    ",allSelected?__p+='\n      <li class="CDB-NavSubmenu-item">\n        <button class="CDB-NavSubmenu-itemLink CDB-Text CDB-Size-medium u-actionTextColor js-deselect-all">'+(null==(__t=_t("components.modals.assets-picker.deselect-all"))?"":_.escape(__t))+"</button>\n      </li>\n      ":selectedCount>0&&(__p+='\n      <li class="CDB-NavSubmenu-item">\n        <button class="CDB-NavSubmenu-itemLink CDB-Text CDB-Size-medium u-actionTextColor js-select-all">'+(null==(__t=_t("components.modals.assets-picker.select-all"))?"":_.escape(__t))+"</button>\n      </li>\n    "),__p+="\n\n    ",selectedCount>0&&(__p+='\n      <li class="CDB-NavSubmenu-item">\n          ',__p+=selectedCount>1?'\n        <button class="CDB-NavSubmenu-itemLink CDB-Text CDB-Size-medium u-errorTextColor js-remove">'+(null==(__t=_t("components.modals.assets-picker.delete-images"))?"":_.escape(__t))+"</button>\n        ":'\n        <button class="CDB-NavSubmenu-itemLink CDB-Text CDB-Size-medium u-errorTextColor js-remove">'+(null==(__t=_t("components.modals.assets-picker.delete-image"))?"":_.escape(__t))+"</button>\n        ",__p+="\n      </li>\n    "),__p+="\n  "),__p+="\n</ul>\n";return __p}},{underscore:"underscore"}],82:[function(a,b,c){var d=a("backbone/core-view"),e=a("./asset-item-view.tpl"),f=24;b.exports=d.extend({tagName:"li",className:"AssetsList-item AssetsList-item--medium",events:{"click .js-asset":"_onClick"},initialize:function(a){this.listenTo(this.model,"change:state",this._changeState)},render:function(){this.clearSubViews(),this.$el.attr("id",this.model.get("id"));var a=this.model.get("type")||"icon";return this.$el.append(e({type:a,height:this.options.assetHeight||f,
name:this.model.get("name"),public_url:this.model.get("public_url")})),this.$el.addClass("AssetsList-item--"+a),this},_onClick:function(a){this.killEvent(a),this.trigger("selected",this.model)},_changeState:function(){this.$el.toggleClass("is-selected","selected"===this.model.get("state"))}})},{"./asset-item-view.tpl":83,"backbone/core-view":454}],83:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="AssetItem-label CDB-Text CDB-Size-big ',__p+="icon"===type?"u-mainTextColor":"u-actionTextColor",__p+=' u-upperCase js-asset" title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  ',__p+="icon"===type||"file"===type?'\n    <img height="'+(null==(__t=height)?"":_.escape(__t))+'" src="'+(null==(__t=public_url)?"":_.escape(__t))+'" alt="'+(null==(__t=name)?"":_.escape(__t))+'" />\n  ':"\n    "+(null==(__t=name)?"":_.escape(__t))+"\n  ",__p+="\n</div>\n";return __p}},{underscore:"underscore"}],84:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./static-asset-item-view"),g=a("../../../../../../data/static-assets-collection"),h=a("../../../../../../helpers/required-opts"),i=["icons","selectedAsset"];b.exports=e.extend({tagName:"ul",className:"AssetsList",initialize:function(a){h(a,i,this),this._setupAssets(a)},render:function(){return this.clearSubViews(),this._renderAssets(),this},_renderAssets:function(){this._assetsCollection.each(function(a){var b=new f({model:a});this.model&&b.model.getURLFor(a.get("icon"))===this.model.get("image")&&b.model.set("state","selected"),b.bind("selected",this._selectItem,this),this.$el.append(b.render().el),this.addView(b)},this)},_setupAssets:function(a){d.isEmpty(a)||(this._icons=d.map(this._icons,function(b){return d.extend(b,a)}));var b=this._icons;this.options.limit&&(b=b.slice(0,this.options.limit)),this._assetsCollection=new g(b),this.add_related_model(this._assetsCollection)},_selectItem:function(a){this._selectedAsset.set({url:a.get("public_url"),kind:a.get("kind")}),this._assetsCollection.deselectAll(a)}})},{"../../../../../../data/static-assets-collection":367,"../../../../../../helpers/required-opts":432,"./static-asset-item-view":93,"backbone/core-view":454,underscore:"underscore"}],85:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("backbone"),h=a("../../../../../../helpers/utils"),i=a("../assets/maki-icons"),j=a("./user-assets-tab"),k=a("./organization-assets-list-view"),l=a("../../../../../../data/organization-assets-collection"),m=a("./upload-assets-tab"),n=a("../../../../../../helpers/required-opts"),o=a("../../../../../../data/assets-collection"),p=a("../../../../../tab-pane/create-text-labels-tab-pane"),q=a("../../../../../scroll/scroll-view"),r=a("./assets-list-view"),s=a("../../../../../loading/render-loading"),t=a("../../../../../error/error-view"),u=a("./upload-assets-error.tpl"),v=a("../../../../../../helpers/error-parser"),w=a("./assets-view.tpl"),x=a("./tab-pane-template.tpl"),y="custom-marker",z=["modalModel","configModel","userModel"];b.exports=f.extend({className:"Dialog-content Dialog-content--expanded",events:{"click .js-add":"_onSetImage","click .js-upload":"_initUpload","change .js-fileInput":"_onFileSelected","click .js-back":"_onClickBack"},initialize:function(a){n(a,z,this),this._initModels(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(w({disclaimer:i.disclaimer})),this._hasFetchedAllCollections()?this._initTabPane():this._isLoading()?this._renderLoading():this._hasError()&&this._renderError(),this},_hasFetchedAllCollections:function(){return"show"===this._stateModel.get("status")},_initModels:function(){var a=this;this._selectedAsset=new g.Model({url:this.model.get("image")}),this._stateModel=new g.Model({status:"loading",modalEnabled:!1,uploads:0}),this._assetCollections=[],this._userAssetCollection=new o(null,{configModel:this._configModel,userModel:this._userModel}),this._assetCollections.push(this._userAssetCollection),this._userModel.isInsideOrg()&&(this._organizationAssetCollection=new l(null,{configModel:this._configModel,orgId:this._userModel.getOrganization().get("id")}),this._assetCollections.push(this._organizationAssetCollection));var b=e.invoke(this._assetCollections,"fetch");d.when.apply(d,b).then(function(){a._stateModel.set("status","show")},function(b,c){a._setError(c)})},_initBinds:function(){this.listenTo(this._selectedAsset,"change:url",this._onChangeSelectedAsset),this.listenTo(this._stateModel,"change:status",this.render),this.listenTo(this._stateModel,"change:modalEnabled",this._onChangeSetButton)},_onClickBack:function(a){this.killEvent(a),this._stateModel.set("status","show"),this._assetsTabPaneView.setSelectedTabPaneByName("upload-file")},_upload:function(a){this._userAssetCollection.create(a,{beforeSend:this._beforeAssetUpload.bind(this),success:this._onAssetUploaded.bind(this),error:this._onAssetUploadError.bind(this),complete:this._onAssetUploadComplete.bind(this)})},_renderError:function(){this._hideDisclaimer(),this.$(".js-body").html(new t({title:h.capitalize(this._stateModel.get("error_message")),desc:_t("components.modals.assets-picker.error-desc"),template:u}).render().el)},_renderLoading:function(){this._hideDisclaimer(),this.$(".js-body").html(s({title:_t("components.modals.assets-picker.loading")}))},_isLoading:function(){return"loading"===this._stateModel.get("status")},_hasError:function(){return"error"===this._stateModel.get("status")},_initTabPane:function(){var a=[{name:"maki-icons",label:_t("components.modals.add-asset.icons"),createContentView:this._createMakiIconsView.bind(this)},{name:"your-uploads",label:_t("components.modals.add-asset.your-uploads"),createContentView:this._createYourUploadsView.bind(this)}];this._userModel.isInsideOrg()&&this._organizationAssetCollection.length>0&&a.push({name:"organization-uploads",label:_t("components.modals.add-asset.organization-uploads"),createContentView:this._createOrganizationUploadsView.bind(this)}),a.push({name:"upload-file",label:_t("components.modals.add-asset.upload-file"),createContentView:this._createUploadFileView.bind(this)});var b={tabPaneOptions:{template:x,disclaimer:i.disclaimer,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this._assetsTabPaneView=p(a,b),this.listenTo(this._assetsTabPaneView.collection,"change",this._onChangeSelectedTab),this.addView(this._assetsTabPaneView),this.$(".js-body").append(this._assetsTabPaneView.render().el),this._initSetButtonState()},_onChangeSelectedTab:function(){switch(this._assetsTabPaneView.getSelectedTabPaneName()){case"maki-icons":this._setDisclaimer(i.disclaimer),this._toggleSetButton();break;case"upload-file":this._hideDisclaimer(),this._disableSetButton();break;default:this._hideDisclaimer(),this._toggleSetButton()}},_toggleSetButton:function(){this._stateModel.set("modalEnabled",void 0!==this._selectedAsset.get("url"))},_initSetButtonState:function(){if(this.model.get("image")){var a=!1;"marker"===this.model.get("kind")&&(a=!0),a||e.each(this._assetCollections,function(b){a||(a=b.some(function(a){return this.model.get("image")===a.get("public_url")},this))},this),a&&this._enableSetButton()}},_enableSetButton:function(){this._stateModel.set("modalEnabled",!0)},_disableSetButton:function(){this._stateModel.set("modalEnabled",!1)},_createYourUploadsView:function(){var a=new j({model:this.model,selectedAsset:this._selectedAsset,title:_t("components.modals.add-asset.your-uploads"),organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,userModel:this._userModel}).bind(this);return this._userAssetsView=a,a.bind("init-upload",this._initUpload,this),this._hideDisclaimer(),this._userAssetsView},_createOrganizationUploadsView:function(){var a=new q({createContentView:function(){return new k({title:_t("components.modals.add-asset.organization-uploads"),model:this.model,organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,selectedAsset:this._selectedAsset})}.bind(this)});return this._hideDisclaimer(),a},_createUploadFileView:function(){var a=new m({model:this.model,userModel:this._userModel,configModel:this._configModel}).bind(this);return a.bind("upload-complete",this._onUploadComplete,this),a.bind("upload-files",this._uploadFiles,this),a.bind("upload-url",this._uploadURL,this),a},_createMakiIconsView:function(){return new q({createContentView:function(){return new r({model:this.model,selectedAsset:this._selectedAsset,title:_t("components.modals.add-asset.maki-icons"),icons:i.icons,folder:"maki-icons",kind:"marker",size:"18"})}.bind(this)})},_onUploadComplete:function(){this._assetsTabPaneView.setSelectedTabPaneByName("your-uploads")},_onChangeSetButton:function(){this.$(".js-add").toggleClass("is-disabled",!this._stateModel.get("modalEnabled"))},_onChangeSelectedAsset:function(){this._selectedAsset.get("url")||(this.model.unset("image"),this.model.unset("kind")),this._stateModel.set("modalEnabled",!!this._selectedAsset.get("url"))},_initUpload:function(a){this.killEvent(a),this.$(".js-fileInput").click()},_setDisclaimer:function(a){this.$(".js-disclaimer").html(a)},_hideDisclaimer:function(){this.$(".js-disclaimer").html("")},_getSelectedFiles:function(){return this.$(".js-fileInput").prop("files")},_uploadURL:function(a){this._upload({type:"url",kind:y,url:a})},_uploadFiles:function(a){e.each(a,function(a){this._upload({kind:y,type:"file",filename:a})},this)},_onFileSelected:function(){this._uploadFiles(this._getSelectedFiles())},_beforeAssetUpload:function(){this._stateModel.set("uploads",this._stateModel.get("uploads")+1),this._stateModel.get("uploads")>0&&this._stateModel.set("status","loading")},_onAssetUploaded:function(a){this._resetFileSelection()},_setError:function(a){this._stateModel.set({error_message:v(a),status:"error"})},_onAssetUploadError:function(a,b){this._resetFileSelection(),this._setError(b)},_onAssetUploadComplete:function(){this._stateModel.set("uploads",this._stateModel.get("uploads")-1),this._stateModel.get("uploads")<1&&!this._hasError()&&(this._stateModel.set("status","show"),this._onUploadComplete())},_resetFileSelection:function(){this.$(".js-fileInput").val("")},_onSetImage:function(a){this.killEvent(a),this._stateModel.get("modalEnabled")&&(this.model.set({image:this._selectedAsset.get("url"),kind:this._selectedAsset.get("kind")}),this.trigger("change",{url:this._selectedAsset.get("url"),kind:this._selectedAsset.get("kind")},this),this._modalModel.destroy(this.model))}})},{"../../../../../../data/assets-collection":336,"../../../../../../data/organization-assets-collection":357,"../../../../../../helpers/error-parser":426,"../../../../../../helpers/required-opts":432,"../../../../../../helpers/utils":435,"../../../../../error/error-view":37,"../../../../../loading/render-loading":187,"../../../../../scroll/scroll-view":271,"../../../../../tab-pane/create-text-labels-tab-pane":276,"../assets/maki-icons":102,"./assets-list-view":84,"./assets-view.tpl":86,"./organization-assets-list-view":91,"./tab-pane-template.tpl":95,"./upload-assets-error.tpl":96,"./upload-assets-tab":97,"./user-assets-tab":101,backbone:"backbone","backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],86:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal">\n  <div class="Modal-header">\n    <div class="Modal-headerContainer">\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace">'+(null==(__t=_t("components.modals.add-asset.modal-title"))?"":_.escape(__t))+'</h2>\n      <h3 class="CDB-Text CDB-Size-medium u-altTextColor"><button class="u-actionTextColor js-upload">'+(null==(__t=_t("components.modals.add-asset.upload-asset"))?"":_.escape(__t))+"</button> "+(null==(__t=_t("components.modals.add-asset.modal-desc"))?"":_.escape(__t))+'</h3>\n    </div>\n  </div>\n\n  <div class="Modal-container js-body"></div>\n\n  <div class="Modal-footer">\n    <div class="Modal-footerContainer u-flex u-justifySpace">\n      <div class="CDB-Text CDB-Size-medium js-disclaimer">\n        ',disclaimer&&(__p+="\n        "+(null==(__t=disclaimer)?"":__t)+"\n        "),__p+='\n      </div>\n\n      <button class="CDB-Button CDB-Button--primary is-disabled js-add">\n        <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.add-asset.set-image"))?"":_.escape(__t))+'</span>\n      </button>\n    </div>\n  </div>\n</div>\n\n<form accept-charset="UTF-8" enctype="multipart/form-data" method="post">\n  <input type="file" accept="image/jpeg,image/jpg,image/gif,image/png,image/svg+xml" class="js-fileInput" style="position: absolute; clip: rect(0px 0px 0px 0px); opacity: 0;" multiple="multiple">\n</form>\n';return __p}},{underscore:"underscore"}],87:[function(a,b,c){var d=a("backbone/core-view"),e=a("./input-asset-picker-header.tpl"),f=a("../../../../../img-loader-view");b.exports=d.extend({events:{"click .js-back":"_onClickBack","click .js-colorPicker":"_onClickColorPicker"},initialize:function(a){this._imageEnabled=a.imageEnabled,this._initBinds()},render:function(a,b){this.clearSubViews(),this.$el.empty();var c=this._getRampItem();return this.$el.append(e({index:this.model.get("index")||0,color:c.color||"",label:c.title||_t("form-components.editors.fill.input-categories.others"),image:c.image||"",imageEnabled:this._imageEnabled})),this._loadImages(),this},_initBinds:function(){this.listenTo(this.model,"change:image",this.render)},_getRampItem:function(){var a=this.model.get("ramp");return a?a[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-categories.others"),image:""}},_loadImages:function(){var a=this._getRampItem();this.iconView=new f({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:a.image,color:a.color}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onClickColorPicker:function(a){this.killEvent(a),this.trigger("goToColorPicker",this)}})},{"../../../../../img-loader-view":180,"./input-asset-picker-header.tpl":88,"backbone/core-view":454}],88:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemDisplay--flex CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <div class=\'CDB-ListDecoration-secondaryContainer\'>\n        <button class="u-rSpace u-actionTextColor js-back">\n          <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n        </button>\n        <span class="label js-label">'+(null==(__t=label)?"":_.escape(__t))+"</span>\n      </div>\n\n      <div class='CDB-ListDecoration-secondaryContainer'>\n        <nav class='CDB-NavMenu'>\n          <ul class='CDB-NavMenu-Inner CDB-NavMenu-inner--no-margin js-menu'>\n            <li class='CDB-NavMenu-item'>\n              <div class='CDB-NavMenu-link CDB-ListDecoration-rampNav-item'>\n                <button class=\"ColorBar CDB-ListDecoration-rampItemBar u-rSpace--xl js-colorPicker\" style=\"background-color: "+(null==(__t=color)?"":__t)+';" type="button"></button>\n              </div>\n            </li>\n\n            ',imageEnabled&&(__p+="\n              <li class='CDB-NavMenu-item is-selected'>\n                <div class='CDB-NavMenu-link CDB-ListDecoration-rampNav-item'>\n                  ",__p+=image?"\n                    <div class='CDB-ListDecoration-rampImg js-image-container'></div>\n                  ":'\n                    <span class="CDB-ListDecoration-rampImg CDB-Text js-assetPicker">'+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":__t)+"</span>\n                  ",__p+="\n                </div>\n              </li>\n            "),__p+="\n          </ul>\n        </nav>\n      </div>\n    </li>\n  </ul>\n</div>\n";return __p}},{underscore:"underscore"}],89:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./input-asset-picker-view.tpl"),h=a("./input-asset-picker-header"),i=a("../input-color-file-view"),j=a("../../../../../../helpers/required-opts"),k=["configModel","modals","ramp","userModel"];b.exports=f.extend({initialize:function(a){j(a,k,this),this._imageEnabled=a.imageEnabled,this.model=new e.Model({index:this.options.index,ramp:a.ramp})},render:function(){return this.clearSubViews(),this.$el.html(g()),this._initViews(),this},_initViews:function(){this._headerView=new h({model:this.model,imageEnabled:this._imageEnabled}),this._headerView.bind("goToColorPicker",this._onGoToColorPicker,this),this._headerView.bind("back",this._onClickBack,this),this.$(".js-header").append(this._headerView.render().el),this.addView(this._headerView),this._assetPicker=new i({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals,imageEnabled:this._imageEnabled}),this._assetPicker.bind("change",d.debounce(this._onChangeImage,50),this),this.$(".js-content").append(this._assetPicker.render().el),this.addView(this._assetPicker)},_getRampItem:function(){var a=this.model.get("ramp");return a?a[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-categories.others"),image:""}},_onChangeImage:function(a){var b=a&&a.url||"",c=a&&a.kind||"";this._getRampItem().image=b,this.model.trigger("change:image"),this.trigger("change:image",{url:b,kind:c,index:this.model.get("index")},this)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onGoToColorPicker:function(a){this.killEvent(a),this.trigger("goToColorPicker",this)}})},{"../../../../../../helpers/required-opts":432,"../input-color-file-view":113,"./input-asset-picker-header":87,"./input-asset-picker-view.tpl":90,backbone:"backbone","backbone/core-view":454,underscore:"underscore"}],90:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-header"></div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],91:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../../helpers/required-opts"),f=a("./asset-item-view"),g=a("./organization-assets-list-view.tpl"),h=["userAssetCollection","organizationAssetCollection","selectedAsset"],i="custom-marker",j=48;b.exports=d.extend({initialize:function(a){e(a,h,this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g),this._organizationAssetCollection.deselectAll(),this._organizationAssetCollection.each(this._renderAsset,this),this},_initBinds:function(){this.listenTo(this._organizationAssetCollection,"reset",this.render),this.listenTo(this._organizationAssetCollection,"change",this._onChangeAssets)},_getSelectedAsset:function(){var a=this._organizationAssetCollection.where({state:"selected"});return a&&a[0]},_renderAsset:function(a){var b=new f({model:a,assetHeight:j,selectedAsset:this._selectedAsset});a.get("public_url")===this.model.get("image")&&a.set("state","selected"),b.bind("selected",this._selectAsset,this),this.$(".js-assets").append(b.render().el),this.addView(b)},_onChangeAssets:function(){var a=this._getSelectedAsset();this._selectedAsset.set({url:a&&a.get("public_url"),kind:i})},_selectAsset:function(a){a.set("state","selected"),this._organizationAssetCollection.deselectAll(a),this._userAssetCollection.deselectAll()}})},{"../../../../../../helpers/required-opts":432,"./asset-item-view":82,"./organization-assets-list-view.tpl":92,"backbone/core-view":454}],92:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="AssetsList js-assets"></ul>\n';return __p}},{underscore:"underscore"}],93:[function(a,b,c){var d=a("backbone/core-view"),e=a("./static-asset-item-view.tpl");b.exports=d.extend({tagName:"li",className:"AssetsList-item AssetsList-item--medium",events:{"click .js-asset":"_onClick"},initialize:function(){this.listenTo(this.model,"change:state",this._changeState)},render:function(){return this.clearSubViews(),this.$el.append(e({type:"icon",name:this.model.get("name"),public_url:this.model.get("public_url")})),this},_onClick:function(a){this.killEvent(a),this.trigger("selected",this.model),this.model.set("state","selected")},_changeState:function(){this.$el.toggleClass("is-selected","selected"===this.model.get("state"))}})},{"./static-asset-item-view.tpl":94,"backbone/core-view":454}],94:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",__p+="icon"===type?'\n<div class="AssetItem-icon js-asset"><img height="24" src="'+(null==(__t=public_url)?"":_.escape(__t))+'" alt="'+(null==(__t=name)?"":_.escape(__t))+'" crossOrigin="anonymous" /></div>\n':'\n<div class="AssetItem-label CDB-Text CDB-Size-small u-altTextColor u-upperCase js-asset" title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  '+(null==(__t=name)?"":_.escape(__t))+"\n</div>\n",__p+="\n";return __p}},{underscore:"underscore"}],95:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Modal-navigation">\n  <ul class="Modal-navigationInner CDB-Text is-semibold CDB-Size-medium js-menu"></ul>\n</div>\n<div class="Tab-paneContent Publish-modalContent Modal-inner Modal-inner--with-navigation js-content">\n</div>\n';return __p}},{underscore:"underscore"}],96:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="LayoutIcon LayoutIcon--negative">\n  <i class="CDB-IconFont CDB-IconFont-cockroach"></i>\n</div>\n<h3 class="CDB-Text CDB-Size-large u-mainTextColor u-errorTextColor u-bSpace--m u-tSpace-xl">'+(null==(__t=title)?"":_.escape(__t))+'</h3>\n<p class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=desc)?"":__t)+'</p>\n\n<button class="CDB-Button CDB-Button--primary u-tSpace-xl js-back">\n  <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.assets-picker.go-back"))?"":_.escape(__t))+"</span>\n</button>\n";return __p}},{underscore:"underscore"}],97:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("../../../../../../helpers/utils");a("dragster");var g=a("dropzone"),h=a("backbone/core-view"),i=a("../../../../../../helpers/required-opts"),j=a("../../../../../../data/assets-collection"),k=a("./upload-assets-tab.tpl"),l=["configModel","userModel"];b.exports=h.extend({className:"Form-modal",events:{"keyup .js-url":"_onURLChanged","click .js-submit":"_onClickSubmit"},initialize:function(a){i(a,l,this),this._stateModel=new e.Model({status:"show",uploads:0}),this.listenTo(this._stateModel,"change:status",this.render),this._assetCollection=new j(null,{configModel:this._configModel,userModel:this._userModel})},render:function(){return this.clearSubViews(),this.$el.html(k()),this._initDropzone(),this},_initDropzone:function(){var a=d("html")[0],b=this;this.dragster=new Dragster(a),d(a).bind("dragster:enter",function(a){b._showDropzone()}),d(a).bind("dragster:leave",function(a){b._hideDropzone()}),a.dropzone||(this.dropzone=new g(a,{url:":)",autoProcessQueue:!1,previewsContainer:!1}),this.dropzone.on("dragover",function(){b._showDropzone()}),this.dropzone.on("drop",function(a){b.trigger("upload-files",a.dataTransfer.files),b._hideDropzone()}))},_showDropzone:function(){this.$(".Form-upload").addClass("is-dropping")},_hideDropzone:function(){this.$(".Form-upload").removeClass("is-dropping")},_destroyDropzone:function(){var a=d("html")[0];this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),d(a).unbind("dragster:enter dragster:leave")),this.dropzone&&this.dropzone.destroy()},_hasError:function(){return"error"===this._stateModel.get("status")},_onClickSubmit:function(a){this.killEvent(a);var b=this._getURL();return b?f.isURL(b)?(this._hideURLError(),void this.trigger("upload-url",b)):void this._showURLError():void this._hideURLError()},_getURL:function(){return this.$(".js-url").val()},_onURLChanged:function(){var a=this._getURL();a?f.isURL(a)?this._hideURLError():this._showURLError():this._hideURLError()},_showURLError:function(){this.$(".js-url-error").addClass("is-visible")},_hideURLError:function(){this.$(".js-url-error").removeClass("is-visible")},clean:function(){this._destroyDropzone(),h.prototype.clean.apply(this)}})},{"../../../../../../data/assets-collection":336,"../../../../../../helpers/required-opts":432,"../../../../../../helpers/utils":435,"./upload-assets-tab.tpl":98,backbone:"backbone","backbone/core-view":454,dragster:456,dropzone:457,jquery:"jquery"}],98:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ImportPanel-header">\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m">\n    '+(null==(__t=_t("components.modals.assets-picker.upload-file-url"))?"":_.escape(__t))+'\n  </h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=_t("components.modals.assets-picker.upload-desc"))?"":_.escape(__t))+'\n  </p>\n</div>\n<div class="Form-row Form-row--centered">\n  <div class="Form-rowData Form-rowData--med Form-rowData--noMargin js-dropzone">\n    <div class="Form-upload">\n      <label class="Form-fileLabel js-fileLabel CDB-Text CDB-Size-medium">'+(null==(__t=_t("components.modals.assets-picker.drag-and-drop"))?"":_.escape(__t))+'</label>\n      <label class="Form-fileLabel Form-fileLabel--error CDB-Text CDB-Size-small js-fileError"></label>\n      <div class="Form-file">\n        <span class="CDB-Button CDB-Button--primary Form-fileButton CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase js-upload">\n          '+(null==(__t=_t("components.modals.assets-picker.browse"))?"":_.escape(__t))+'\n        </span>\n      </div>\n    </div>\n  </div>\n  <span class="u-lSpace--xl u-rSpace--xl u-flex u-alignCenter CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("components.modals.assets-picker.or"))?"":_.escape(__t))+'</span>\n  <div class="Form-rowData Form-rowData--noMargin Form-rowData--med">\n    <input type="text" class="Form-input Form-input--med has-submit js-url CDB-Text CDB-Size-medium" value="" placeholder="https://carto.com/markers/pin.png" />\n    <button type="submit" class="CDB-Text CDB-Size-small Form-inputSubmit u-upperCase u-actionTextColor Form-inputSubmit js-submit">\n      <span>'+(null==(__t=_t("components.modals.assets-picker.submit"))?"":_.escape(__t))+'</span>\n    </button>\n    <div class="Form-inputError CDB-Text js-url-error">'+(null==(__t=_t("components.modals.assets-picker.incorrect-url"))?"":_.escape(__t))+"</div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],99:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("./asset-item-view"),h=a("../../../../../../helpers/required-opts"),i=a("backbone"),j=a("../../../../../loading/render-loading"),k=a("./asset-header-view"),l=a("../../../../../error/error-view"),m=a("./upload-assets-error.tpl"),n=a("./user-assets-list-view.tpl"),o=["userModel","userAssetCollection","selectedAsset"],p="custom-marker",q=48;b.exports=f.extend({initialize:function(a){if(h(a,o,this),this._userModel.isInsideOrg()){if(!a.organizationAssetCollection)throw new Error("organizationAssetCollection is required");this._organizationAssetCollection=a.organizationAssetCollection}this._stateModel=new i.Model,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(n),this._isLoading()?this._renderLoading():this._hasError()?this._renderError():this._renderRegularView(),this},_addHeaderView:function(){this._assetHeaderView=new k({editable:!0,title:this.options.title,assetsCollection:this._userAssetCollection}),this.addView(this._assetHeaderView),this.$(".js-nav").append(this._assetHeaderView.render().el),this._assetHeaderView.bind("select-all",this._selectAllAssets,this),this._assetHeaderView.bind("deselect-all",this._deselectAllAssets,this),this._assetHeaderView.bind("remove",this._removeSelectedAssets,this)},_renderRegularView:function(){this._addHeaderView(),this._renderAddButton(),this._userAssetCollection.deselectAll(),this._userAssetCollection.each(this._renderAsset,this)},_renderAddButton:function(){var a=new g({model:new i.Model({type:"text",name:"+"}),assetHeight:q});a.bind("selected",function(){this.trigger("init-upload")},this),this.addView(a),this.$(".js-assets").append(a.render().$el)},_initBinds:function(){this._keyDown=this._onKeyDown.bind(this),d(document).on("keydown",this._keyDown),this._keyUp=this._onKeyUp.bind(this),d(document).on("keyup",this._keyUp),this.listenTo(this._stateModel,"change:status",this.render),this.listenTo(this._userAssetCollection,"change",this._onChangeAssets)},_getSelectedAsset:function(){return this._userAssetCollection.findWhere({state:"selected"})},_getSelectedAssetsCount:function(){var a=this._userAssetCollection.where({state:"selected"});return a?a.length:0},_onKeyDown:function(a){this._shiftKeyPressed=a.shiftKey},_onKeyUp:function(a){this._shiftKeyPressed=a.shiftKey},_onClickBack:function(a){this.killEvent(a),this._stateModel.unset("status")},_renderAsset:function(a){var b=new g({model:a,assetHeight:q,selectedAsset:this._selectedAsset});a.get("public_url")===this.model.get("image")&&a.set("state","selected"),b.bind("selected",this._selectAsset,this),this.$(".js-assets").append(b.render().el),this.addView(b)},_onChangeAssets:function(){if(1===this._getSelectedAssetsCount()){var a=this._getSelectedAsset();this._selectedAsset.set({url:a&&a.get("public_url"),kind:p})}else this._selectedAsset.set({url:"",kind:""})},_selectAllAssets:function(){this._userAssetCollection.selectAll()},_deselectAllAssets:function(){this._userAssetCollection.deselectAll()},_selectAsset:function(a){this._shiftKeyPressed?a.set("state","selected"===a.get("state")?"":"selected"):a.set("state","selected"),this._shiftKeyPressed||(this._userAssetCollection.deselectAll(a),this._userModel.isInsideOrg()&&this._organizationAssetCollection.deselectAll())},_removeSelectedAssetsFromView:function(){var a=this._userAssetCollection.select(function(a){return"selected"===a.get("state")},this);e.each(a,function(a){this.$("#"+a.get("id")).remove()},this)},_removeSelectedAssets:function(){this._stateModel.set("status","loading");var a=this._userAssetCollection.select(function(a){return"selected"===a.get("state")},this);e.each(a,function(a){a.destroy({complete:this._onDestroyFinished.bind(this)})},this)},_onDestroyFinished:function(a){200===a.status?(this._removeSelectedAssetsFromView(),this._stateModel.unset("status"),this._selectedAsset.unset("kind"),this._selectedAsset.unset("url")):this._stateModel.set({error_message:a.statusText,status:"error"})},_isLoading:function(){return"loading"===this._stateModel.get("status")},_hasError:function(){
return"error"===this._stateModel.get("status")},_renderLoading:function(){this.$el.html(j({title:_t("components.modals.assets-picker.loading")}))},_renderError:function(){this.$el.html(new l({title:this._stateModel.get("error_message"),desc:_t("components.modals.assets-picker.error-desc"),template:m}).render().el)},_disableBinds:function(){d(document).off("keydown",this._keyDown),d(document).off("keyup",this._keyUp)},clean:function(){this._disableBinds(),f.prototype.clean.apply(this)}})},{"../../../../../../helpers/required-opts":432,"../../../../../error/error-view":37,"../../../../../loading/render-loading":187,"./asset-header-view":80,"./asset-item-view":82,"./upload-assets-error.tpl":96,"./user-assets-list-view.tpl":100,backbone:"backbone","backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],100:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<nav class="CDB-NavMenu u-bSpace--m u-inner js-nav"></nav>\n<ul class="AssetsList js-assets"></ul>\n';return __p}},{underscore:"underscore"}],101:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../../../../../helpers/required-opts"),f=a("../../../../../scroll/scroll-view"),g=a("./user-assets-list-view"),h=["userModel","userAssetCollection","title","selectedAsset"];b.exports=d.extend({events:{"change .js-uploadInput":"_onFileSelected"},initialize:function(a){if(e(a,h,this),this._userModel.isInsideOrg()){if(!a.organizationAssetCollection)throw new Error("organizationAssetCollection is required");this._organizationAssetCollection=a.organizationAssetCollection}},render:function(){return this.clearSubViews(),this.$el.empty(),this._renderAssets(),this},_renderAssets:function(){var a=new f({createContentView:function(){var a=new g({title:this._title,model:this.model,organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,selectedAsset:this._selectedAsset,userModel:this._userModel});return a.bind("init-upload",function(){this.trigger("init-upload")},this),a}.bind(this)});this.addView(a),this.$el.append(a.render().el)}})},{"../../../../../../helpers/required-opts":432,"../../../../../scroll/scroll-view":271,"./user-assets-list-view":99,"backbone/core-view":454}],102:[function(a,b,c){b.exports={disclaimer:_t("assets.maki-icons.disclaimer"),icons:[{name:"Square stroked",icon:"square-stroked"},{name:"Square solid",icon:"square"},{name:"Triangle stroked",icon:"triangle-stroked"},{name:"Triangle solid",icon:"triangle"},{name:"Star stroked",icon:"star-stroked"},{name:"Star solid",icon:"star"},{name:"Cross",icon:"cross"},{name:"Marker Stroke",icon:"marker-stroked"},{name:"Marker Solid",icon:"marker"},{name:"Religious Jewish",icon:"religious-jewish"},{name:"Religious Christian",icon:"religious-christian"},{name:"Religious Muslim",icon:"religious-muslim"},{name:"Cemetery",icon:"cemetery"},{name:"Rocket",icon:"rocket"},{name:"Airport",icon:"airport"},{name:"Heliport",icon:"heliport"},{name:"Rail",icon:"rail"},{name:"Rail Metro",icon:"rail-metro"},{name:"Rail Light",icon:"rail-light"},{name:"Bus",icon:"bus"},{name:"Fuel",icon:"fuel"},{name:"Parking",tags:["parking","transportation"],icon:"parking"},{name:"Parking Garage",tags:["parking","transportation","garage"],icon:"parking-garage"},{name:"Airfield",tags:["airfield","airport","plane","landing strip"],icon:"airfield"},{name:"Roadblock",tags:["roadblock","stop","warning","dead end"],icon:"roadblock"},{name:"Ferry",tags:["ship","boat","water","ferry","transportation"],icon:"ferry"},{name:"Harbor",tags:["marine","dock","water","wharf"],icon:"harbor"},{name:"Bicycle",tags:["cycling","cycle","transportation"],icon:"bicycle"},{name:"Park",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park"},{name:"Park 2",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park2"},{name:"Museum",tags:["recreation","museum","tourism"],icon:"museum"},{name:"Lodging",tags:["lodging","hotel","recreation","motel","tourism"],icon:"lodging"},{name:"Monument",tags:["recreation","statue","monument","tourism"],icon:"monument"},{name:"Zoo",tags:["recreation","zoo","animal","giraffe"],icon:"zoo"},{name:"Garden",tags:["recreation","garden","park","flower","nature"],icon:"garden"},{name:"Campsite",tags:["recreation","campsite","camp","camping","tent","nature"],icon:"campsite"},{name:"Theatre",tags:["recreation","theatre","theater","entertainment","play","performance"],icon:"theatre"},{name:"Art gallery",tags:["art","center","museum","gallery","creative","recreation","entertainment","studio"],icon:"art-gallery"},{name:"Pitch",tags:["pitch","track","athletic","sports","field"],icon:"pitch"},{name:"Soccer",tags:["soccer","sports"],icon:"soccer"},{name:"American Football",tags:["football","sports"],icon:"america-football"},{name:"Tennis",tags:["tennis","court","ball","sports"],icon:"tennis"},{name:"Basketball",tags:["basketball","ball","sports"],icon:"basketball"},{name:"Baseball",tags:["baseball","softball","ball","sports"],icon:"baseball"},{name:"Golf",tags:["golf","sports","course"],icon:"golf"},{name:"Swimming",tags:["swimming","water","swim","sports"],icon:"swimming"},{name:"Cricket",tags:["cricket","sports"],icon:"cricket"},{name:"Skiing",tags:["winter","skiing","ski","sports"],icon:"skiing"},{name:"School",tags:["school","highschool","elementary","children","amenity","middle"],icon:"school"},{name:"College",tags:["college","school","amenity","university"],icon:"college"},{name:"Library",tags:["library","books","amenity"],icon:"library"},{name:"Post",tags:["post","office","amenity","mail","letter"],icon:"post"},{name:"Fire station",tags:["fire","station","amenity"],icon:"fire-station"},{name:"Town hall",tags:["townhall","mayor","building","amenity","government"],icon:"town-hall"},{name:"Police",tags:["police","jail","arrest","amenity","station"],icon:"police"},{name:"Prison",tags:["prison","jail","amenity"],icon:"prison"},{name:"Embassy",tags:["embassy","diplomacy","consulate","amenity","flag"],icon:"embassy"},{name:"Beer",tags:["bar","beer","drink","commercial","biergarten","pub"],icon:"beer"},{name:"Restaurant",tags:["restaurant","commercial"],icon:"restaurant"},{name:"Cafe",tags:["cafe","coffee","commercial","tea"],icon:"cafe"},{name:"Shop",tags:["shop","mall","commercial","store"],icon:"shop"},{name:"Fast Food",tags:["food","fast","commercial","burger","drive-through"],icon:"fast-food"},{name:"Bar",tags:["bar","drink","commercial","club","martini","lounge"],icon:"bar"},{name:"Bank",tags:["bank","atm","commercial","money"],icon:"bank"},{name:"Grocery",tags:["food","grocery","commercial","store","market"],icon:"grocery"},{name:"Cinema",tags:["cinema","theatre","film","movie","commercial","theater","entertainment"],icon:"cinema"},{name:"Pharmacy",tags:["pharmacy","drugs","medication","social","medicine","prescription"],icon:"pharmacy"},{name:"Hospital",tags:["hospital","health","medication","social","medicine","medical","clinic"],icon:"hospital"},{name:"Danger",tags:["minefield","landmine","disaster","dangerous","hazard"],icon:"danger"},{name:"Industrial",tags:["industrial","factory","property","building"],icon:"industrial"},{name:"Warehouse",tags:["warehouse","property","storage","building"],icon:"warehouse"},{name:"Commercial",tags:["commercial","property","business","building"],icon:"commercial"},{name:"Building",tags:["building","property","structure","business","building"],icon:"building"},{name:"Place of worship",tags:["religion","ceremony","religious","nondenominational","church","temple"],icon:"place-of-worship"},{name:"Alcohol shop",tags:["alcohol","liquor","store","shop","beer","wine","vodka"],icon:"alcohol-shop"},{name:"Logging",tags:["logger","chainsaw","woods","industry"],icon:"logging"},{name:"Oil well",tags:["oil","natural","environment","industry","resources"],icon:"oil-well"},{name:"Slaughterhouse",tags:["cows","cattle","food","meat","industry","resources"],icon:"slaughterhouse"},{name:"Dam",tags:["water","natural","hydro","hydroelectric","energy","environment","industry","resources"],icon:"dam"},{name:"Water",tags:["water","natural","hydro","lake","river","ocean","resources"],icon:"water"},{name:"Wetland",tags:["water","swamp","natural"],icon:"wetland"},{name:"Disability",tags:["handicap","wheelchair","access"],icon:"disability"},{name:"Telephone",tags:["payphone","call"],icon:"telephone"},{name:"Emergency Telephone",tags:["payphone","danger","safety","call"],icon:"emergency-telephone"},{name:"Toilets",tags:["bathroom","men","women","sink","washroom","lavatory"],icon:"toilets"},{name:"Waste Basket",tags:["trash","rubbish","bin","garbage"],icon:"waste-basket"},{name:"Music",tags:["stage","performance","band","concert","venue"],icon:"music"},{name:"Land Use",tags:["zoning","usage","area"],icon:"land-use"},{name:"City",tags:["area","point","place","urban"],icon:"city"},{name:"Town",tags:["area","point","place","small"],icon:"town"},{name:"Village",tags:["area","point","place","small","rural"],icon:"village"},{name:"Farm",tags:["building","farming","crops","plants","agriculture","rural"],icon:"farm"},{name:"Bakery",tags:["bakery","pastry","croissant","food","shop","bread"],icon:"bakery"},{name:"Dog Park",tags:["dog","pet"],icon:"dog-park"},{name:"Lighthouse",tags:["building","navigation","nautical","ocean","logistics"],icon:"lighthouse"},{name:"Clothing Store",tags:["clothing","store","shop"],icon:"clothing-store"},{name:"Polling Place",icon:"polling-place"},{name:"Playground",icon:"playground"},{name:"Entrance",icon:"entrance"},{name:"Heart",icon:"heart"},{name:"London Underground",icon:"london-underground"},{name:"Minefield",icon:"minefield"},{name:"Rail Underground",icon:"rail-underground"},{name:"Rail Above",icon:"rail-above"},{name:"Camera",icon:"camera"},{name:"Laundry",icon:"laundry"},{name:"Car",icon:"car"},{name:"Suitcase",icon:"suitcase"},{name:"Hairdresser",icon:"hairdresser"},{name:"Chemist",icon:"chemist"},{name:"Mobile phone",icon:"mobilephone"},{name:"Scooter",icon:"scooter"}]}},{}],103:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../../../../../img-loader-view"),g=a("../../../../../../custom-list/custom-list-item-view");b.exports=g.extend({render:function(){this.clearSubViews(),this.$el.empty();var a=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(d.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:a,val:this.model.getValue(),options:this.model.get("renderOptions"),image:this.model.get("image"),imageEnabled:this.options.imageEnabled}))),this._loadImages(),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_loadImages:function(){this.iconView=new f({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:this.model.get("image"),color:this.model.get("val")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClick:function(a){this.killEvent(a);var b=e(a.target),c=b.closest(".js-image-container").length>0,d=b.closest(".js-assetPicker").length>0;this.model.set({selectedClass:d||c?["js-assetPicker"]:[],selected:!0})}})},{"../../../../../../custom-list/custom-list-item-view":26,"../../../../../../img-loader-view":180,jquery:"jquery",underscore:"underscore"}],104:[function(a,b,c){var d=a("../../../../../../custom-list/custom-list-view");b.exports=d.extend({_renderItem:function(a){var b=this.options.ItemView,c=new b({model:a,typeLabel:this.options.typeLabel,template:this.options.itemTemplate,imageEnabled:this.options.imageEnabled});this.$(".js-list").append(c.render().el),this.addView(c),c.bind("customEvent",function(a,b){this.trigger("customEvent",a,b,this)},this)}})},{"../../../../../../custom-list/custom-list-view":33}],105:[function(a,b,c){var d=a("../../../../../../custom-list/custom-view.js"),e=a("../../../../../../custom-list/custom-list-item.tpl"),f=a("./categories-list-item-view"),g=a("./categories-list-view");b.exports=d.extend({options:{showSearch:!0,allowFreeTextInput:!1,typeLabel:"column",itemTemplate:e,itemView:f},_renderList:function(){this._listView=new g({model:this.model,allowFreeTextInput:this.options.allowFreeTextInput,collection:this.collection,typeLabel:this.options.typeLabel,ItemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:this.options.size,imageEnabled:this.options.imageEnabled}),this.$el.append(this._listView.render().el),this._listView.highlight(),this.addView(this._listView),this._listView.bind("customEvent",function(a,b){this.trigger(a,b,this)},this)}})},{"../../../../../../custom-list/custom-list-item.tpl":28,"../../../../../../custom-list/custom-view.js":35,"./categories-list-item-view":103,"./categories-list-view":104}],106:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-ListDecoration-itemLink u-flex u-justifySpace u-alignCenter ',isSelected&&(__p+=" is-selected "),__p+='">\n  <span class="RampItem-text CDB-Text u-ellipsis u-actionTextColor" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</span>\n\n  <div class=\'RampItem-secondaryContainer\'>\n    <div class="ColorBar RampItem-bar js-colorPicker" style="background-color: '+(null==(__t=val)?"":_.escape(__t))+';"></div>\n\n    ',imageEnabled&&(__p+="\n      <div class='RampItem-img'>\n        ",__p+=image?"\n          <div class='js-image-container u-flex'></div>\n        ":'\n          <button class="CDB-Text u-actionTextColor js-assetPicker">'+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":__t)+"</button>\n        ",__p+="\n      </div>\n    "),__p+="\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],107:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../../../../../helpers/utils"),g=a("backbone/core-view"),h=a("./categories-list/categories-view"),i=a("../../../../../custom-list/custom-list-collection"),j=a("./input-color-categories-list-view.tpl"),k=a("./input-color-categories-list-item.tpl");b.exports=g.extend({events:{"click .js-color":"_onClickColor"},initialize:function(a){this._showSearch=a.showSearch||!1,this._typeLabel=a.typeLabel,this._maxValues=a.maxValues,this._setupCollection(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(j({range:this.model.get("range"),attribute:this.model.get("attribute")})),this._listView=new h({itemTemplate:k,collection:this._collection,showSearch:this._showSearch,typeLabel:this._typeLabel,imageEnabled:this.options.imageEnabled}),this.addView(this._listView),this.$(".js-content").append(this._listView.render().$el),this},_setupCollection:function(){this._collection=new i(null,{silent:!1});var a=this.model.get("range"),b=this.model.get("domain"),c=this.model.get("images");if(a&&a.length&&b&&b.length){var e=d.map(a,function(a,e){var g=null==b[e]||d.isString(b[e])&&f.isBlank(b[e]),h=b[e];e>=this._maxValues?h=_t("form-components.editors.fill.input-categories.others"):g&&(h=_t("form-components.editors.fill.input-categories.null"));var i={label:h,val:a};return c&&c.length&&(i.image=c[e]),i},this);this._collection.reset(e)}},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_initBinds:function(){this.listenTo(this.model,"change:range",this.render),this.listenTo(this.model,"change:domain",this.render),this.listenTo(this._collection,"change:selected",this._onSelectItem)},_onClickColor:function(a){this.killEvent(a);var b=e(a.target).index(),c=this._collection.at(b);c&&this._onSelectItem(c)},_onSelectItem:function(a){var b={index:this._collection.indexOf(a),target:d.contains(a.get("selectedClass"),"js-assetPicker")?"asset":"color"};this.trigger("selectItem",b,this)}})},{"../../../../../../helpers/utils":435,"../../../../../custom-list/custom-list-collection":23,"./categories-list/categories-view":105,"./input-color-categories-list-item.tpl":106,"./input-color-categories-list-view.tpl":108,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],108:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor u-flex u-alignCenter">\n      <ul class="ColorBarContainer">\n        ',_.each(range,function(a){__p+='\n          <li class="ColorBar ColorBar--spaceless ColorBar--clickable js-color" style="background-color: '+(null==(__t=a)?"":_.escape(__t))+';"></li>\n        '}),__p+='\n      </ul>\n    </li>\n  </ul>\n</div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],109:[function(a,b,c){function d(a){return a&&a!==!0?'"'+a.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':a}var e=a("underscore"),f=a("cartodb.js"),g=a("backbone"),h=a("backbone/core-view"),i=a("./input-color-categories.tpl"),j=a("../../../../../../components/stack-layout/stack-layout-view"),k=a("../input-color-picker/input-color-picker-view"),l=a("./input-color-categories-list-view"),m=a("cartocolor"),n=a("../assets-picker/input-asset-picker-view"),o=10,p=e.clone(m.Prism[o+1]),q=e.template("SELECT <%= column %>, count(<%= column %>) FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY count DESC, <%= column %> ASC LIMIT <%= max_values %>"),r=a("../../../../../../helpers/required-opts"),s=["columns","configModel","modals","query","userModel"];b.exports=h.extend({events:{"click .js-back":"_onClickBack","click .js-quantification":"_onClickQuantification"},initialize:function(a){r(a,s,this),this._imageEnabled=a.imageEnabled,this.listenTo(this.model,"change:attribute",this._fetchColumns),this._viewModel=new g.Model({step:0,status:"idle"}),this.listenTo(this._viewModel,"change:status",this.render),this.model.hasChanged("quantification")&&"category"===this.model.get("quantification")&&this._fetchColumns()},render:function(){this.clearSubViews(),this.$el.empty();var a=this._getColumn(),b=a&&a.type;return this.$el.append(i({status:this._viewModel.get("status"),columnType:b,attribute:this.model.get("attribute"),quantification:this.model.get("quantification")||"category"})),this._generateStackLayoutView(),this},_generateStackLayoutView:function(){var a=this._viewModel.get("step"),b=new g.Collection([{selected:0===a,createStackView:function(a,b){return this._createRangeListView(a,b).bind(this)}.bind(this)},{selected:1===a,createStackView:function(a,b){return this._createColorPickerView(a,b).bind(this)}.bind(this)}]);this._iconStylingEnabled()&&b.add({selected:2===a,createStackView:function(a,b){return this._createImagePickerView(a,b).bind(this)}.bind(this)}),this._stackLayoutView=new j({collection:b}),this._stackLayoutView.bind("positionChanged",this._onStackLayoutPositionChange,this),this.addView(this._stackLayoutView),this.$(".js-content").append(this._stackLayoutView.render().$el)},_onStackLayoutPositionChange:function(){this.$(".js-prevStep").toggle(0===this._stackLayoutView.getCurrentPosition())},_iconStylingEnabled:function(){return this._imageEnabled},_getColumn:function(){return e.find(this._columns,function(a){return a.label===this.model.get("attribute")},this)},_fetchColumns:function(){if(this.model.get("attribute"))if(this._query){this._setViewStatus("loading");var a=new f.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")});a.execute(q({sql:this._query,column:this.model.get("attribute"),max_values:o+1}),null,{success:this._onQueryDone.bind(this),error:function(){this._setViewStatus("error")}.bind(this)})}else this._onQueryDone()},_onQueryDone:function(a){a=a||{},this._updateRangeAndDomain(a.rows),this._setViewStatus("idle")},_updateRangeAndDomain:function(a){a=a||[];var b=e.pluck(a,this.model.get("attribute")),c=e.map(b,function(a,b){return a}).slice(0,o);"number"!==this.model.get("attribute_type")&&(c=c.filter(function(a,b,c){return c.indexOf(a)===b}).map(d));var f=e.map(b,function(a,b){return b<o?p[b]:p[o+1]});if(this._iconStylingEnabled()){var g=e.map(b,function(){return""});this.model.attributes.images=g}this.model.set({range:f,domain:c})},_setViewStatus:function(a){var b={status:a};"loading"===a&&(b.step=0),this._viewModel.set(b)},_getRange:function(){return e.map(this.model.get("range"),function(a,b){var c={val:a,color:a,title:this.model.get("domain")[b]};return this._iconStylingEnabled()&&(c.image=this.model.get("images")[b]),c},this)},_updateRange:function(a){var b=e.clone(this.model.get("range"));b[this._index]=a[this._index].color,this.model.set("range",b)},_createColorPickerView:function(a,b){var c=this._getRange(),d="undefined"!=typeof this.model.get("opacity")?this.model.get("opacity"):1,e=new k({index:this._index,ramp:c,opacity:d,imageEnabled:this._iconStylingEnabled()});return e.bind("back",function(b){a.prevStep()},this),e.bind("goToAssetPicker",function(){a.nextStep()},this),e.bind("change",this._updateRange,this),e.bind("changeIndex",function(a){this._index=a},this),e.bind("change:opacity",function(a){this.model.set("opacity",a)},this),e},_createRangeListView:function(a,b){var c=new l({maxValues:o,model:this.model,imageEnabled:this._iconStylingEnabled()});return c.bind("back",function(b){a.prevStep()},this),c.bind("selectItem",function(b){this._index=b.index,"asset"===b.target?a.goToStep(2):a.goToStep(1)},this),c},_createImagePickerView:function(a,b){var c=this._getRange(),d=new n({userModel:this._userModel,configModel:this._configModel,index:this._index,ramp:c,modals:this._modals,imageEnabled:this._iconStylingEnabled()});return d.bind("back",function(b){a.goToStep(0)},this),d.bind("goToColorPicker",function(){a.prevStep()},this),this._iconStylingEnabled()&&d.bind("change:image",this._onImageChanged,this),d},_onImageChanged:function(a){var b=e.clone(this.model.get("images"));b[this._index]=a.url,this.model.set("images",b)},_onClickQuantification:function(a){this.killEvent(a),this.trigger("selectQuantification",this)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)}},{MAX_VALUES:o})},{"../../../../../../components/stack-layout/stack-layout-view":274,"../../../../../../helpers/required-opts":432,"../assets-picker/input-asset-picker-view":89,"../input-color-picker/input-color-picker-view":118,"./input-color-categories-list-view":107,"./input-color-categories.tpl":110,backbone:"backbone","backbone/core-view":454,cartocolor:"cartocolor","cartodb.js":"cartodb.js",underscore:"underscore"}],110:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader js-prevStep">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <ul class="u-flex u-justifySpace">\n        <li class="u-flex">\n          <button class="u-rSpace u-actionTextColor js-back">\n            <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n          </button>\n          <span class="label js-label">'+(null==(__t=attribute)?"":_.escape(__t))+"</span>\n        </li>\n        ","number"===columnType&&(__p+='\n          <li class="u-flex">\n            '+(null==(__t=_t("form-components.editors.fill.quantification.methods."+quantification))?"":_.escape(__t))+'\n            <button class="CDB-Shape u-lSpace js-quantification">\n              <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n                <div class="CDB-Shape-threePointsItem"></div>\n                <div class="CDB-Shape-threePointsItem"></div>\n                <div class="CDB-Shape-threePointsItem"></div>\n              </div>\n            </button>\n          </li>\n        '),__p+="\n      </ul>\n    </li>\n  </ul>\n</div>\n\n",__p+="loading"===status?'\n  <div class="InputColorCategory-loader js-loader">\n    <div class="CDB-LoaderIcon is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n  </div>\n':"error"===status?'\n  <div class="u-flex u-alignCenter u-justifyCenter CDB-Text CDB-Size-medium u-bSpace--m u-tSpace--m u-errorTextColor">'+(null==(__t=_t("form-components.editors.fill.error"))?"":_.escape(__t))+"</div>\n":'\n  <div class="InputColorCategory-content js-content"></div>\n',__p+="";return __p}},{underscore:"underscore"}],111:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("../fill-tab-pane.tpl"),g=a("../../../../../components/tab-pane/create-text-labels-tab-pane"),h=a("./input-color-fixed-content-view"),i=a("./input-color-value-content-view");b.exports=e.extend({initialize:function(a){if(this.options.editorAttrs){var b=this.options.editorAttrs;if(b.hidePanes&&(this._hidePanes=b.hidePanes,!d.contains(this._hidePanes,"value"))){if(!a.configModel)throw new Error("configModel param is required");if(!a.userModel)throw new Error("userModel param is required");if(!a.modals)throw new Error("modals param is required");if(!a.query)throw new Error("query param is required")}b.categorizeColumns&&(this._categorizeColumns=!0),b.imageEnabled&&(this._imageEnabled=!0)}if(!a.columns)throw new Error("columns is required");this._columns=a.columns,this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals,this._query=a.query,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.model.on("change:fixed",function(){this.model.get("fixed")&&!this.model.get("range")||this.model.unset("image",{silent:!0})},this)},_initViews:function(){var a=this,b={name:"fixed",label:_t("form-components.editors.fill.input-color.solid"),createContentView:function(){return a._generateFixedContentView()}},c={name:"value",label:_t("form-components.editors.fill.input-color.value"),createContentView:function(){return a._generateValueContentView()}};this._tabPaneTabs=[],this._hidePanes?(d.contains(this._hidePanes,"fixed")||this._tabPaneTabs.push(b),d.contains(this._hidePanes,"value")||this._tabPaneTabs.push(c)):this._tabPaneTabs=[b,c];var e={tabPaneOptions:{template:f,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("range")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this._tabPaneView=g(this._tabPaneTabs,e),this._tabPaneView.collection.bind("change:selected",this._onChangeTabPaneViewTab,this),this.$el.append(this._tabPaneView.render().$el),this.addView(this._tabPaneView)},_onChangeTabPaneViewTab:function(){var a=this._tabPaneView.getSelectedTabPaneName(),b=["domain","bins","attribute","quantification"];"fixed"===a&&(d.each(b,function(a){this.model.unset(a,{silent:!0})},this),this.model.get("fixed")||(this.model.get("range")?(this.model.set("fixed",this.model.get("range")[0]),this.model.unset("range")):this.model.set("fixed","#0303FF"))),this.trigger("change",a,this)},_generateFixedContentView:function(){return new h({model:this.model,configModel:this._configModel,userModel:this._userModel,modals:this._modals,editorAttrs:this.options.editorAttrs})},_generateValueContentView:function(){return new i({model:this.model,columns:this._columns,configModel:this._configModel,categorizeColumns:this._categorizeColumns,imageEnabled:this._imageEnabled,userModel:this._userModel,modals:this._modals,hideTabs:this.options.hideTabs,query:this._query})}})},{"../../../../../components/tab-pane/create-text-labels-tab-pane":276,"../fill-tab-pane.tpl":76,"./input-color-fixed-content-view":115,"./input-color-value-content-view":120,"backbone/core-view":454,underscore:"underscore"}],112:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-selector"></div>\n';return __p}},{underscore:"underscore"}],113:[function(a,b,c){var d=a("backbone/core-view"),e=a("./input-color-file-view.tpl"),f=a("./assets-picker/assets-view"),g=a("../../../../../components/carousel-form-view"),h=a("../../../../../components/custom-carousel/custom-carousel-collection"),i=a("../../../../../data/static-assets-collection"),j=a("../../../../../data/static-asset-model"),k=a("./assets-picker/static-asset-item-view.tpl"),l=a("./input-color-file-carousel.tpl"),m=a("./assets/maki-icons");b.exports=d.extend({events:{"click .js-show-collection":"_onClickShowCollection"},initialize:function(a){if(!a.configModel)throw new Error("configModel is required");if(!a.userModel)throw new Error("userModel is required");if(!a.modals)throw new Error("modals is required");this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals,this._initCarouselCollection(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(e()),this._renderAssets(),this},_initBinds:function(){this.listenTo(this._carouselCollection,"change:selected",this._onSelectAsset),this.listenTo(this._carouselCollection,"reset",this.render)},_resetCarouselCollection:function(a){this._icons.reset(m.icons);var b=this._carouselCollection.find(function(b){return b.get("url")===a});b&&b.set("selected",!0),this._icons.unshift(this._resetAsset),this._carouselCollection.reset(this._getIcons())},_initCarouselCollection:function(){this._icons=new i(m.icons),this.add_related_model(this._icons),this._resetAsset=new j({type:"none",selected:!this._getIconSelected(),name:_t("form-components.editors.fill.image.none"),action:function(a){this._resetImage(a)}.bind(this)}),this._icons.unshift(this._resetAsset),this._carouselCollection=new h(this._getIcons()),this.add_related_model(this._carouselCollection)},_getIcons:function(){var a=function(a){this._changeIcon(a)}.bind(this);return this._icons.map(function(b){var c=b.get("type")?b.get("type"):"icon",d=b.get("action")?b.get("action"):a,e=this._getIconSelected();return{selected:b.get("selected")||b.getURLFor(b.get("icon"))===e,icon:b,type:c,name:b.get("name"),url:b.get("public_url"),action:d,template:function(){return k({type:c,public_url:b.get("public_url")+"?req=markup",name:b.get("name")})}}},this)},_getIconSelected:function(){if(this.model.get("ramp")){var a=this.model.get("index")||0,b=this.model.get("ramp")[a].image;return b||""}return this.model.get("image")||""},_renderAssets:function(){this.clearSubViews(),this.$el.html(e());var a=new g({collection:this._carouselCollection,template:l,listItemOptions:{className:"Carousel-item AssetListItem"},itemOptions:{className:"AssetItem-button"}});this.addView(a),this.$(".js-assets").append(a.render().el)},_onSelectAsset:function(a){a.get("action")(a)},_changeIcon:function(a){var b=a.get("icon");this.trigger("change",{url:b.get("public_url"),kind:b.get("kind")},this)},_resetImage:function(){this.trigger("change",null,this)},_onClickShowCollection:function(a){this.killEvent(a);var b=this;this._modals.create(function(a){var c=new f({model:b.model,modalModel:a,configModel:b._configModel,userModel:b._userModel});return c.bind("change",function(a){this._resetCarouselCollection(a.url),this.trigger("change",a,this)},b),c})}})},{"../../../../../components/carousel-form-view":1,
"../../../../../components/custom-carousel/custom-carousel-collection":16,"../../../../../data/static-asset-model":366,"../../../../../data/static-assets-collection":367,"./assets-picker/assets-view":85,"./assets-picker/static-asset-item-view.tpl":94,"./assets/maki-icons":102,"./input-color-file-carousel.tpl":112,"./input-color-file-view.tpl":114,"backbone/core-view":454}],114:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-boxModalContent js-assets">\n  <h2 class="CDB-Text CDB-Size-small u-bSpace--m u-upperCase">\n    '+(null==(__t=_t("form-components.editors.fill.image.recently-title"))?"":_.escape(__t))+'\n  </h2>\n</div>\n<div class="CustomRamp-list">\n  <div class="CustomList-item CustomList-item--add">\n    <button class="CDB-ListDecoration-itemLink CDB-Text CDB-Size-medium u-actionTextColor js-show-collection" type="button">\n      '+(null==(__t=_t("form-components.editors.fill.image.show-all"))?"":_.escape(__t))+"\n    </button>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],115:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("../fill-tab-pane.tpl"),g=a("../../../../../components/tab-pane/create-mixed-labels-tab-pane"),h=a("../color-picker/color-picker"),i=a("./input-color-file-view");b.exports=e.extend({initialize:function(a){if(this.options.editorAttrs){var b=this.options.editorAttrs;if(this._imageEnabled=b.imageEnabled,b.hidePanes&&(this._hidePanes=b.hidePanes,this._imageEnabled&&!d.contains(this._hidePanes,"file"))){if(!a.configModel)throw new Error("configModel param is required");if(!a.userModel)throw new Error("userModel param is required");if(!a.modals)throw new Error("modals param is required")}b.disableOpacity&&(this._disableOpacity=!0)}this._userModel=a.userModel,this._configModel=a.configModel,this._modals=a.modals,this._query=a.query},render:function(){return this.clearSubViews(),this._imageEnabled&&this._setupTabPanes(),this._tabPaneView?this.$el.append(this._tabPaneView.render().$el):this.$el.append(this._generateFixedContentView().render().$el),this},_setupTabPanes:function(){var a=this,b={name:"fixed",type:"color",label:this.model.get("fixed"),createContentView:function(){return a._generateFixedContentView()}},c={name:"file",type:this.model.get("image")?"image":"text",label:this.model.get("image")||_t("form-components.editors.fill.input-color.img"),kind:this.model.get("kind")||"marker",color:this.model.get("fixed"),createContentView:function(){return a._generateFileContentView()}};this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes?(this._hidePanes=this.options.editorAttrs.hidePanes,d.contains(this._hidePanes,"fixed")||this._tabPaneTabs.push(b),d.contains(this._hidePanes,"file")||this._tabPaneTabs.push(c)):this._tabPaneTabs=[b,c];var e={tabPaneOptions:{template:f,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("image")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this.listenTo(this.model,"change:image",this._updateImageTabPane),this.listenTo(this.model,"change:fixed",this._updateTextTabPane),this._tabPaneView=g(this._tabPaneTabs,e),this.addView(this._tabPaneView)},_updateTextTabPane:function(){this._updateImageTabPane(),this._tabPaneView.collection.at(0).set("label",this.model.get("fixed"))},_updateImageTabPane:function(){this.model.get("image")?this._tabPaneView.collection.at(1).set({label:this.model.get("image"),color:this.model.get("fixed")}):this._tabPaneView.collection.at(1).set("label",_t("form-components.editors.fill.input-color.img"))},_generateFixedContentView:function(){var a=new h({value:this.model.get("fixed"),opacity:this.model.get("opacity"),disableOpacity:this._disableOpacity});return a.bind("change",this._onChangeValue,this),a},_generateFileContentView:function(){var a=new i({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals});return a.bind("change",this._onChangeFile,this),a},_onChangeFile:function(a){a&&a.url?this.model.set({image:a.url,kind:a.kind}):this.model.unset("image")},_onChangeValue:function(a){this.model.set({fixed:a.hex,opacity:a.opacity})}})},{"../../../../../components/tab-pane/create-mixed-labels-tab-pane":275,"../color-picker/color-picker":69,"../fill-tab-pane.tpl":76,"./input-color-file-view":113,"backbone/core-view":454,underscore:"underscore"}],116:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("../../../../../img-loader-view"),h=a("./input-color-picker-header.tpl"),i=1;b.exports=f.extend({events:{"click .js-color":"_onClickColor","click .js-assetPicker":"_onClickAssetPicker","keyup .js-a":"_onChangeOpacity"},initialize:function(a){this.listenTo(this.model,"change",this.render)},render:function(a,b){if(a&&a.changed&&"undefined"!=typeof a.changed.opacity)return this._reRenderOpacity(),this;this.clearSubViews(),this.$el.empty();var c=this._getRampItem();return this.$el.append(h({ramp:this.model.get("ramp"),index:this.model.get("index"),opacity:this.model.get("opacity"),label:c.title||_t("form-components.editors.fill.input-categories.others"),color:c.color||"",iconStylingEnabled:this.options.iconStylingEnabled,isCategorized:e.has(c,"image"),image:c.image||"",imageEnabled:this.options.imageEnabled})),this._slider=this.$(".js-slider").slider({range:"min",value:this._inverseSliderValue(this.model.get("opacity")),min:0,max:i,step:.02,orientation:"horizontal",disabled:!1,slide:this._onSlideChange.bind(this)}),this._loadImages(),this},_getRampItem:function(){var a=this.model.get("ramp");return a?a[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-categories.others"),image:""}},_loadImages:function(){var a=this._getRampItem();this.iconView=new g({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:a.image,color:a.color}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClickColor:function(a){this.killEvent(a),this.model.set("index",d(a.target).index())},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onClickAssetPicker:function(a){this.killEvent(a),this.trigger("goToAssetPicker",this)},_onSlideChange:function(a,b){this.model.set("opacity",this._inverseSliderValue(b.value))},_inverseSliderValue:function(a){return parseFloat(Number(i-a).toFixed(2))},_onChangeOpacity:function(){var a=this.$(".js-a"),b=a.val(),c=this._isValidOpacity(b);a.toggleClass("has-error",!c),c&&this.model.set("opacity",parseFloat(b))},_isValidOpacity:function(a){var b=/^((0(\.\d+)?)|(1(\.0)?))$/;return b.test(a)},_reRenderOpacity:function(){var a,b,c=this.$(".js-a"),d=this.$(".js-slider"),e=this.model.get("opacity");c.length>0&&(a=c.val(),(!this._isValidOpacity(a)||this._isValidOpacity(a)&&parseFloat(a)!==e)&&c.val(e)),"undefined"!=typeof d.slider("instance")&&(b=d.slider("value"),"undefined"!=typeof b&&b!==this._inverseSliderValue(e)&&d.slider("value",this._inverseSliderValue(e)))}})},{"../../../../../img-loader-view":180,"./input-color-picker-header.tpl":117,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],117:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemDisplay--flex CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <div class=\'CDB-ListDecoration-secondaryContainer\'>\n        <button class="u-rSpace u-actionTextColor js-back" type="button">\n          <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n        </button>\n        <span class="label js-label">'+(null==(__t=label)?"":_.escape(__t))+"</span>\n      </div>\n\n      ",isCategorized&&imageEnabled&&(__p+="\n        <div class='CDB-ListDecoration-secondaryContainer'>\n          <nav class='CDB-NavMenu'>\n            <ul class='CDB-NavMenu-Inner CDB-NavMenu-inner--no-margin js-menu'>\n              <li class='CDB-NavMenu-item is-selected'>\n                <div class='CDB-NavMenu-link CDB-ListDecoration-rampNav-item'>\n                  <button class='ColorBar CDB-ListDecoration-rampItemBar u-rSpace--xl js-colorPicker' type=\"button\" style=\"background-color: "+(null==(__t=color)?"":__t)+";\"></button>\n                </div>\n              </li>\n              <li class='CDB-NavMenu-item'>\n                <div class='CDB-NavMenu-link CDB-ListDecoration-rampNav-item'>\n                  ",__p+=image?'\n                    <button class="CDB-ListDecoration-rampImg js-image-container" type="button"></button>\n                  ':'\n                    <button class="CDB-ListDecoration-rampImg CDB-Text u-actionTextColor js-assetPicker" type="button">'+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":__t)+"</button>\n                  ",__p+="\n                </div>\n              </li>\n            </ul>\n          </nav>\n        </div>\n      "),__p+='\n    </li>\n  </ul>\n</div>\n\n<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <ul class="ColorBarContainer ColorBarContainer--rampEditing">\n        ',_.each(ramp,function(a,b){__p+='\n        <li class="ColorBar is-link ColorBar--spaceless ColorBar--clickable js-color'+(null==(__t=b===index?" is-selected":"")?"":_.escape(__t))+'" data-label="'+(null==(__t=a.title)?"":_.escape(__t))+'" data-color="'+(null==(__t=a.color)?"":_.escape(__t))+'" style="background-color: '+(null==(__t=a.color)?"":_.escape(__t))+';"></li>\n        '}),__p+='\n      </ul>\n      <div class="OpacityEditor">\n        <div class="OpacityEditor-slider js-slider"></div>\n        <div class="OpacityEditor-inputWrapper">\n          <input type="text" class="CDB-InputText ColorPicker-input js-a" value="'+(null==(__t=opacity)?"":_.escape(__t))+'">\n        </div>\n      </div>\n    </li>\n  </ul>\n</div>\n';return __p}},{underscore:"underscore"}],118:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../color-picker/color-picker"),h=a("./input-color-picker-view.tpl"),i=a("./input-color-picker-header"),j=a("../../../../../../helpers/required-opts"),k=["ramp","opacity"];b.exports=f.extend({events:{"click .js-back":"_onClickBack"},initialize:function(a){j(a,k,this),this.model=new e.Model({index:this.options.index,ramp:a.ramp,opacity:a.opacity}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(h()),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:index",this._onChangeIndex),this.listenTo(this.model,"change:opacity",this._onOpacityChanged)},_initViews:function(){this._headerView=new i({model:this.model,imageEnabled:this.options.imageEnabled}),this.addView(this._headerView),this._headerView.bind("goToAssetPicker",this._onGoToAssetPicker,this),this.$(".js-header").append(this._headerView.render().$el),this._colorPicker=new g({value:this._getColor(),opacity:1,disableOpacity:!0}),this.addView(this._colorPicker),this._colorPicker.bind("change",this._onChangeValue,this),this.$(".js-content").append(this._colorPicker.render().$el)},_setColor:function(a){var b=d.clone(this.model.get("ramp"));b[this.model.get("index")].color=a,this.model.set("ramp",b),this.model.trigger("change",b),this.trigger("change",b)},_getColor:function(){var a=this.model.get("ramp");return a[this.model.get("index")||0].color},_onChangeIndex:function(){this._colorPicker.setColor(this._getColor()),this.trigger("changeIndex",this.model.get("index"),this)},_onChangeValue:function(a){this._setColor(a.hex)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onOpacityChanged:function(){var a=this.model.get("opacity");this.trigger("change:opacity",a)},_onGoToAssetPicker:function(){this.trigger("goToAssetPicker")}})},{"../../../../../../helpers/required-opts":432,"../../color-picker/color-picker":69,"./input-color-picker-header":116,"./input-color-picker-view.tpl":119,backbone:"backbone","backbone/core-view":454,underscore:"underscore"}],119:[function(a,b,c){arguments[4][90][0].apply(c,arguments)},{dup:90,underscore:"underscore"}],120:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../../../components/stack-layout/stack-layout-view"),h=a("../column-list-view"),i=a("./quantification-method-item.tpl"),j=a("./input-ramps/input-color-ramps"),k=a("./input-categories/input-color-categories"),l=a("../default-fill-settings.json"),m=a("../../../../../helpers/required-opts"),n=["the_geom","the_geom_webmercator"],o=["columns","configModel","modals","query","userModel"];b.exports=f.extend({initialize:function(a){m(a,o,this),this._settings=l.color,this._categorizeColumns=a.categorizeColumns,this._imageEnabled=a.imageEnabled,this._column=this._getColumn(),this._columnType=this._column&&this._column.type,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:quantification",function(){"category"===this.model.previous("quantification")&&delete this.model.attributes.range,"category"!==this.model.get("quantification")&&this.model.unset("domain")})},_initViews:function(){var a=this,b=new e.Collection([{createStackView:function(b,c){return a._createColumnListView(b,c).bind(a)}},{createStackView:function(b,c){return a._createInputColorRamps(b,c).bind(a)}},{createStackView:function(b,c){return a._createInputColorCategories(b,c).bind(a)}},{createStackView:function(b,c){return a._createQuantificationListView(b,c).bind(a)}}]);if(this._stackLayoutView=new g({collection:b}),this.model.get("attribute")){var c=this.model.get("domain")&&this.model.get("domain").length,d=this.model.get("range")&&this.model.get("range").length,f="string"===this._columnType||c&&d;f?this._stackLayoutView.model.set("position",2):this._stackLayoutView.model.set("position",1)}this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createInputColorCategories:function(a,b){var c=new k({model:this.model,query:this._query,columns:this._columns,configModel:this._configModel,userModel:this._userModel,modals:this._modals,imageEnabled:this._imageEnabled});return c.bind("selectQuantification",function(b){a.goToStep(3)},this),c.bind("back",function(b){a.goToStep(0)},this),c},_createQuantificationListView:function(a,b){var c=new h({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:a,itemTemplate:i,columns:this._settings.quantifications.items,showSearch:!1});return c.bind("selectItem",function(b){this.model.set("quantification",b.get("val")),a.goToStep(1)},this),c.bind("back",function(b){a.goToStep(0)},this),c},_createInputColorRamps:function(a,b){var c=new j({hideTabs:this.options.hideTabs,model:this.model});return c.bind("switch",function(){a.goToStep(2)},this),c.bind("back",function(b){a.prevStep()},this),c},_getColumn:function(a){return d.find(this._columns,function(b){return b.label===(a||this.model.get("attribute"))},this)},_createColumnListView:function(a,b){var c=d.reject(this._columns,function(a){return"geometry"===a.type||d.contains(n,a.label)},this),e=new h({stackLayoutModel:a,columns:c,showSearch:!0,typeLabel:"column"});return e.bind("selectItem",function(b){this._onChangeAttribute(b.get("val"),a)},this),e},_onChangeAttribute:function(a,b){var c=["string","boolean"],e=["image","fixed","quantification","opacity"],f="category"===this.model.get("quantification");this._column=this._getColumn(a),this._columnType=this._column&&this._column.type,d.each(e,function(a){this.model.unset(a,{silent:!0})},this),d.contains(c,this._columnType)||this._categorizeColumns?(this.model.unset("bins",{silent:!0}),b.goToStep(2)):"number"===this._columnType&&(this.model.unset("images",{silent:!0}),this.model.unset("domain",{silent:!0}),f&&this.model.unset("range",{silent:!0}),b.goToStep(1)),this.model.set({attribute:a,attribute_type:this._columnType})}})},{"../../../../../components/stack-layout/stack-layout-view":274,"../../../../../helpers/required-opts":432,"../column-list-view":71,"../default-fill-settings.json":73,"./input-categories/input-color-categories":109,"./input-ramps/input-color-ramps":124,"./quantification-method-item.tpl":131,backbone:"backbone","backbone/core-view":454,underscore:"underscore"}],121:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./input-color.tpl"),g=a("./input-color-dialog-content"),h=a("../../../../../helpers/utils"),i=a("./input-ramps/ramps"),j=a("../../../../img-loader-view");b.exports=e.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function(a){if(this.options.editorAttrs){this._editorAttrs=this.options.editorAttrs,this._imageEnabled=this._editorAttrs.imageEnabled;var b=this._editorAttrs.hidePanes;if(b&&!d.contains(b,"value")){if(!a.configModel)throw new Error("configModel param is required");if(!a.userModel)throw new Error("userModel param is required");if(!a.modals)throw new Error("modals param is required");if(!a.query)throw new Error("query param is required")}}if(!a.columns)throw new Error("columns is required");this._columns=a.columns,this._configModel=a.configModel,this._userModel=a.userModel,this._modals=a.modals,this._query=a.query,this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty(),this.options.disabled&&this.$el.addClass("is-disabled");var a=this._getColumn(),b=a&&a.type,c=this.model.get("domain")&&this.model.get("domain").length;this.model.get("range")&&d.isString(this.model.get("range"))&&this._migrateRange();var e=this.model.get("range")&&this.model.get("range").length,g="string"===b||c&&e,h=this._getImageURL(),i=this._iconStylingEnabled()&&!this._getImageURL()&&this._categoryImagesPresent();return this.$el.html(f({categoryImagesPresent:i,imageURL:h,kind:this._getKind(),showCategories:g,value:this._getValue(),opacity:this._getOpacity()})),this._loadImages(),this},_loadImages:function(){this.iconView=new j({imageClass:"Editor-fillImageAsset",imageUrl:this._getImageURL(),color:this.model.get("fixed")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_categoryImagesPresent:function(){var a=this.model.get("images");for(var b in a)if(!d.isEmpty(a[b]))return!0;return!1},_iconStylingEnabled:function(){return this._imageEnabled},_getKind:function(){return this.model.get("kind")&&this._iconStylingEnabled()?this.model.get("kind"):""},_getImageURL:function(){return this.model.get("image")&&this._iconStylingEnabled()?this.model.get("image"):""},_migrateRange:function(){var a=this.model.get("range"),b=this.model.get("bins")||3;i[a]&&i[a][b]&&this.model.set("range",i[a][b])},_getColumn:function(){return d.find(this._columns,function(a){return a.label===this.model.get("attribute")},this)},_createContentView:function(){var a=new g({configModel:this._configModel,userModel:this._userModel,modals:this._modals,query:this._query,model:this.model,columns:this._columns,editorAttrs:this._editorAttrs});return a.bind("change",this.render,this),a},_onClick:function(a){this.options.disabled||this.trigger("click",this.model)},_initBinds:function(){var a=this;this.model.set("createContentView",function(){return a._createContentView()}).bind(this),this.model.on("change:images",this.render,this),this.model.on("change:selected",this._onToggleSelected,this),this.model.on("change:opacity",this.render,this),this.model.on("change:fixed",this.render,this),this.model.on("change:fixed",this._updateColor,this),this.model.on("change:image",this.render,this),this.model.on("change:range",this.render,this)},_updateColor:function(){this.iconView&&this.iconView.updateImageColor(this.model.get("fixed"))},_getValue:function(){var a=this.model.get("fixed");return a&&(a=h.hexToRGBA(a,this._getOpacity())),this.model.get("range")&&this.model.get("range").length&&(a=d.map(this.model.get("range"),function(a){return h.hexToRGBA(a,this._getOpacity())},this)),a},_getOpacity:function(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onToggleSelected:function(){this.$el.toggleClass("is-active",this.model.get("selected"))}})},{"../../../../../helpers/utils":435,"../../../../img-loader-view":180,"./input-color-dialog-content":111,"./input-color.tpl":122,"./input-ramps/ramps":130,"backbone/core-view":454,underscore:"underscore"}],122:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",showCategories?(__p+='\n  <ul class="ColorsBar">\n    ',_.each(value,function(a){__p+='\n      <li class="ColorBar '+(null==(__t=categoryImagesPresent?"ColorBar--spaceSmall":"ColorBar--spaceMedium")?"":_.escape(__t))+'" style="background-color: '+(null==(__t=a)?"":_.escape(__t))+'"></li>\n    '}),__p+="\n  </ul>\n"):(__p+='\n  <button type="button" class="Editor-fillContainer">\n    <ul class="ColorBarContainer">\n      ',__p+=_.isArray(value)?'\n        <li class="ColorBar ColorBar-gradient" style="background: linear-gradient(90deg,'+(null==(__t=value.join(","))?"":_.escape(__t))+')"></li>\n      ':'\n        <li class="ColorBar" style="background-color: '+(null==(__t=value)?"":_.escape(__t))+'"></li>\n      ',__p+="\n    </ul>\n  </button>\n"),__p+="\n\n",imageURL&&"custom-marker"!==kind&&(__p+='\n<button type="button" class="Editor-fillImage">\n  <div class="js-image-container"></div>\n</button>\n'),__p+="\n\n",(!imageURL&&categoryImagesPresent||imageURL&&"custom-marker"===kind)&&(__p+='\n<button type="button" class="Editor-fillImage">\n  <div class=\'Editor-categoryImagesTag CDB-Text CDB-FontSize-small u-altTextColor is-semibold u-upperCase\'>'+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":__t)+"</div>\n</button>\n"),__p+="\n";return __p}},{underscore:"underscore"}],123:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",customRamp&&customRamp.length&&(__p+='\n<li class="CDB-ListDecoration-item CustomList-item CustomRamp js-customRampItem">\n  <div class="CustomRamp-listOptions CDB-ListDecoration-itemLink CDB-ListDecoration-itemLink--double js-customRamp js-listItemLink is-selected">\n    <ul class="ColorBarContainer">\n      ',_.each(customRamp,function(a){__p+='\n      <li class="ColorBar ColorBar--spaceless" style="background-color: '+(null==(__t=a)?"":_.escape(__t))+';"></li>\n      '}),__p+='\n    </ul>\n  </div>\n  <button class="CDB-ListDecoration-itemLink CustomRamp-clear js-clear">\n    <div class="CDB-Shape">\n      <div class="CDB-Shape-close is-blue is-large"></div>\n    </div>\n  </button>\n</li>\n'),__p+="\n";return __p}},{underscore:"underscore"}],124:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("../../../../../../components/stack-layout/stack-layout-view"),h=a("../../column-list-view"),i=a("../quantification-method-item.tpl"),j=a("./input-ramp-content-view"),k=a("cartocolor"),l=a("../../default-fill-settings.json");b.exports=f.extend({initialize:function(a){this._settings=l["color-ramps"],this._setupModel(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_setupModel:function(){var a={};this.model.get("quantification")||(a.quantification=this._settings.quantifications.items[this._settings.quantifications.defaultIndex]),this.model.get("bins")||(a.bins=this._settings.bins.items[this._settings.bins.defaultIndex]),+this.model.get("bins")>+this._settings.bins.items[this._settings.bins.items.length-1]&&(a.bins=this._settings.bins.items[this._settings.bins.items.length-1]),this.model.set(a)},_initBinds:function(){var a=this.model.get("range");this.listenTo(this.model,"change:bins",this._updateRange),this.listenTo(this.model,"change:attribute",this.render),this.listenTo(this.model,"change:quantification",this._onChangeQuantification),this.model.unset("fixed"),a&&this._isValidRange(a)||this.model.set("range",this._getDefaultRamp())},_isValidRange:function(a){return a&&a.length>1||!1},_initViews:function(){var a=this,b=[{createStackView:function(b,c){return a._createInputRampContentView(b,c).bind(a)}}];this.options.hideTabs&&d.contains(this.options.hideTabs,"quantification")||b.push({createStackView:function(b,c){return a._createQuantificationListView(b,c).bind(a)}}),this.options.hideTabs&&d.contains(this.options.hideTabs,"bins")||b.push({createStackView:function(b,c){return a._createBinsListView(b,c).bind(a)}});var c=new e.Collection(b);this._stackLayoutView=new g({collection:c}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_updateRange:function(){var a=this.model.previous("bins");if(a){var b=d.find(k,function(b){var c=b[a],d=this.model.get("range");return c&&d&&c.join("").toLowerCase()===d.join("").toLowerCase()},this);if(b){var c=this.model.get("bins");this.model.set("range",b[c])}}},_createInputRampContentView:function(a,b){var c=new j({stackLayoutModel:a,model:this.model});return c.bind("back",function(a){this.trigger("back")},this),c.bind("selectItem",function(a){this.model.unset("domain"),this.model.set("range",a)},this),c.bind("selectQuantification",function(b){a.goToStep(1)},this),c.bind("selectBins",function(b){a.goToStep(2)},this),c},_createBinsListView:function(a,b){var c=new h({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:a,columns:this._settings.bins.items});return c.bind("selectItem",function(b){this.model.set("bins",b.get("val")),a.goToStep(0)},this),c.bind("back",function(b){a.goToStep(0)},this),c},_createQuantificationListView:function(a,b){var c=new h({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:a,itemTemplate:i,columns:this._settings.quantifications.items,showSearch:!1});return c.bind("selectItem",function(b){this.model.set("quantification",b.get("val")),a.prevStep()},this),c.bind("back",function(b){a.goToStep(0)},this),c},_getDefaultRamp:function(){return d.map(k,function(a){return a[this.model.get("bins")]},this)[0]},_onChangeQuantification:function(){"category"===this.model.get("quantification")&&this.trigger("switch",this)},remove:function(){f.prototype.remove.apply(this)}})},{"../../../../../../components/stack-layout/stack-layout-view":274,"../../column-list-view":71,"../../default-fill-settings.json":73,"../quantification-method-item.tpl":131,"./input-ramp-content-view":125,backbone:"backbone","backbone/core-view":454,cartocolor:"cartocolor",underscore:"underscore"}],125:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("backbone/core-view"),g=a("./input-ramp-list-view"),h=a("../../../../../../components/stack-layout/stack-layout-view"),i=a("../input-color-picker/input-color-picker-view");b.exports=f.extend({events:{"click .js-back":"_onClickBack"},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=this,b=new d.Collection([{createStackView:function(b,c){return a._createInputRampListView(b,c).bind(a)}},{createStackView:function(b,c){return a._createColorPickerView(b,c).bind(a)}}]);this._stackLayoutView=new h({collection:b}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createColorPickerView:function(a,b){var c=e.map(this.model.get("range"),function(a,b){return{val:a,color:a,title:this.model.get("attribute")}},this),d="undefined"!=typeof this.model.get("opacity")?this.model.get("opacity"):1,f=new i({index:0,ramp:c,opacity:d});return f.bind("back",function(b){a.prevStep()},this),f.bind("change",this._updateRange,this),f.bind("change:opacity",function(a){this.model.set("opacity",a)},this),f},_createInputRampListView:function(a,b){var c=new g({model:this.model,showSearch:this.options.showSearch||!1,typeLabel:this.options.typeLabel});return c.bind("customize",function(b){a.nextStep()},this),c.bind("change_ramp",this._updateRamp,this),c.bind("change",this._updateRange,this),c.bind("back",function(a){this.trigger("back",this)},this),c.bind("switch",function(a){this.trigger("switch",this)},this),c.bind("selectItem",function(a){this.trigger("selectItem",a.get("val"),this)},this),c.bind("selectBins",function(a){this.trigger("selectBins",this)},this),c.bind("selectQuantification",function(a){this.trigger("selectQuantification",this)},this),c},_updateRamp:function(a){this.model.set("range",a)},_updateRange:function(a){this.model.set("range",e.pluck(a,"color"))},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)}})},{"../../../../../../components/stack-layout/stack-layout-view":274,"../input-color-picker/input-color-picker-view":118,"./input-ramp-list-view":129,backbone:"backbone","backbone/core-view":454,underscore:"underscore"}],126:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="InputColor-modalHeader CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <div class="u-flex u-alignStart u-ellipsis">\n        <button class="u-rSpace u-actionTextColor js-back">\n          <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n        </button>\n        <div class="u-ellipsis">\n          '+(null==(__t=attribute)?"":_.escape(__t))+'\n        </div>\n      </div>\n    </li>\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <ul class="u-flex u-justifySpace">\n        <li class="u-flex">\n          '+(null==(__t=bins)?"":_.escape(__t))+" "+(null==(__t=_t("form-components.editors.fill.input-ramp.buckets",{smart_count:bins}))?"":_.escape(__t))+'\n          <button class="CDB-Shape u-lSpace js-bins">\n            <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n            </div>\n          </button>\n        </li>\n        <li class="u-flex">\n          '+(null==(__t=_t("form-components.editors.fill.quantification.methods."+quantification))?"":_.escape(__t))+'\n          <button class="CDB-Shape u-lSpace js-quantification">\n            <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n            </div>\n          </button>\n        </li>\n      </ul>\n    </li>\n  </ul>\n</div>\n<div class="js-content"></div>\n<div class="CDB-Text CDB-Size-medium CustomRamp-list CustomList-listWrapper">\n  <ul class="CustomList-list js-customList">\n    <li class="CDB-ListDecoration-item CustomList-item CustomList-item--add">\n      <button class="CDB-ListDecoration-itemLink js-listItemLink js-customize u-actionTextColor">'+(null==(__t=_t("form-components.editors.fill.customize"))?"":_.escape(__t))+"</button>\n    </li>\n  </ul>\n</div>\n";
return __p}},{underscore:"underscore"}],127:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ColorBarWrapper--withInvertLink CDB-ListDecoration-itemLink CDB-ListDecoration-itemLink--double js-listItemLink ',isSelected&&(__p+=" is-selected "),__p+='">\n  <ul class="ColorBarContainer">\n    ',_.each(name,function(a){__p+='\n    <li class="ColorBar ColorBar--spaceless" style="background-color: '+(null==(__t=a)?"":_.escape(__t))+';"></li>\n    '}),__p+='\n  </ul>\n</div>\n<button class="ColorBar-invertLink js-invert" data-event="invert"></button>\n\n';return __p}},{underscore:"underscore"}],128:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore");b.exports=d.extend({className:"CDB-ListDecoration-item CustomList-item CustomList-item--invert js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","click .js-listItemLink":"_onClick","click .js-invert":"_onClickInvert"},initialize:function(a){this.options=e.extend({},this.options,a),this.listenTo(this.model,"change",this.render)},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.options.template(e.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isInverted:this.model.get("inverted"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:this.model.getName(),val:this.model.getValue(),options:this.model.get("renderOptions")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")).toggleClass("is-selected",!!this.model.get("selected")).toggleClass("is-inverted",!!this.model.get("inverted")),this},_onMouseLeave:function(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function(){this.$el.addClass("is-highlighted")},_onClick:function(a){this.killEvent(a),this.model.get("selected")?this.trigger("customEvent","customize",this.model.get("val"),this):this.model.set("selected",!0)},_onClickInvert:function(a){this.killEvent(a),this.model.set("inverted",!this.model.get("inverted")),this.trigger("customEvent","invert",this.model,this)}})},{"backbone/core-view":454,underscore:"underscore"}],129:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("backbone/core-view"),g=a("../../../../../custom-list/custom-view"),h=a("../../../../../custom-list/custom-list-collection"),i=a("./input-ramp-list-item-template.tpl"),j=a("./input-ramp-list-item-view"),k=a("./custom-ramp-template.tpl"),l=a("cartocolor"),m=a("./input-ramp-content-view.tpl"),n="#CCCCCC";b.exports=f.extend({events:{"click .js-customize":"_onClickCustomize","click .js-clear":"_onClickClear","click .js-customRamp":"_onClickCustomRamp","click .js-back":"_onClickBack","click .js-switch":"_onClickSwitch","click .js-quantification":"_onClickQuantification","click .js-bins":"_onClickBins"},initialize:function(a){this._showSearch=a.showSearch||!1,this._typeLabel=a.typeLabel,this._initModels(),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty(),this.$el.append(m({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initViews();var a=this._customRamp.get("range");if(this.$(".js-customList").prepend(k({customRamp:a})),a)this.$(".js-customList").addClass("is-customized");else{var b=this.collection.getSelectedItem();b||(b=this.collection.first()),this._selectRamp(b)}return this},_initModels:function(){this._customRamp=new e.core.Model,this._setupCollection()},_initBinds:function(){this.listenTo(this.model,"change:bins",this._onChangeBins),this.listenTo(this.model,"change:attribute_type",this._updateRampOnAttributeChange),this.listenTo(this.collection,"change:selected",this._onSelectItem)},_initViews:function(){this._listView=new g({collection:this.collection,showSearch:this._showSearch,typeLabel:this._typeLabel,itemTemplate:i,itemView:j}),this._listView.bind("invert",this._invertRamp,this),this._listView.bind("customize",function(a){this.trigger("customize",a,this)},this),this.$(".js-content").append(this._listView.render().el),this.addView(this._listView)},_getRamps:function(){var a=this.model.get("attribute_type"),b={number:["quantitative","diverging"],string:["qualitative"]},c=l;return b[a]&&(c=d.filter(c,function(c){return!!c.tags&&d.contains(b[a],c.tags[0])})),c=d.map(c,function(a,b){var c=a[this.model.get("bins")],e=this.model.get("range"),f=!1,g=!1;return c&&c.length&&e&&e.length&&(f=c.join().toLowerCase()===e.join().toLowerCase(),f||(f=d.clone(c).reverse().join().toLowerCase()===e.join().toLowerCase(),g=f)),c?{selected:f,inverted:g,name:b,val:c}:null},this)},_setupCollection:function(){var a=this._getRamps();this.collection=new h(d.compact(a),{silent:!1}),this.collection.getSelectedItem()||this._customRamp.set("range",this.model.get("range"))},_updateRampOnAttributeChange:function(a,b){var c=this._getRamps();this.collection.reset(d.compact(c),{silent:!0}),this._customRamp.set("range",!1);var e=this.collection.first();e&&e.set("selected",!0),this.render()},_invertRamp:function(a){if(a){this._customRamp.set("range",null),a.set("selected",!1);var b=[].concat(a.get("val")).reverse();a.set({val:b,selected:!0}),this.model.set("range",b)}},_selectRamp:function(a){if(a){var b=a.get("val");this.$(".js-listItemLink").removeClass("is-selected"),this.$('.js-listItem[data-val="'+b.join(",")+'"] .js-listItemLink').addClass("is-selected")}},_onClickClear:function(a){this.killEvent(a),this._customRamp.set("range",null),this.collection.getSelectedItem()||this.collection.first().set("selected",!0),this.render(),this._listView.highlight()},_onClickCustomRamp:function(a){this.killEvent(a),this.model.get("range")===this._customRamp.get("range")?this.trigger("customize",this.collection.getSelectedItem(),this):this.model.set("range",this._customRamp.get("range")),this.$(".js-listItemLink").removeClass("is-selected"),this.$(".js-customRamp").addClass("is-selected")},_onClickCustomize:function(a){this.killEvent(a);var b=this.collection.getSelectedItem();this._customRamp.set("range",b),this.trigger("customize",b,this)},_onChangeBins:function(){var a=this._customRamp.get("range");a&&(a=this.model.get("bins")>a.length?d.range(this.model.get("bins")).map(function(b){return b>=a.length?n:a[b]}):a.slice(0,this.model.get("bins")),this.model.set("range",a),this._customRamp.set("range",a))},_onSelectItem:function(a){this._selectRamp(a),this.trigger("selectItem",a,this)},_onClickSwitch:function(a){this.killEvent(a),this.trigger("switch",this)},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onClickQuantification:function(a){this.killEvent(a),this.trigger("selectQuantification",this)},_onClickBins:function(a){this.killEvent(a),this.trigger("selectBins",this)}})},{"../../../../../custom-list/custom-list-collection":23,"../../../../../custom-list/custom-view":35,"./custom-ramp-template.tpl":123,"./input-ramp-content-view.tpl":126,"./input-ramp-list-item-template.tpl":127,"./input-ramp-list-item-view":128,"backbone/core-view":454,cartocolor:"cartocolor","cartodb.js":"cartodb.js",underscore:"underscore"}],130:[function(a,b,c){b.exports={green:{3:["#E5F5F9","#99D8C9","#2CA25F"],4:["#EDF8FB","#B2E2E2","#66C2A4","#238B45"],5:["#EDF8FB","#B2E2E2","#66C2A4","#2CA25F","#006D2C"],6:["#EDF8FB","#CCECE6","#99D8C9","#66C2A4","#2CA25F","#006D2C"],7:["#EDF8FB","#D7FAF4","#CCECE6","#66C2A4","#41AE76","#238B45","#005824"]},blue:{3:["#EDF8B1","#7FCDBB","#2C7FB8"],4:["#FFFFCC","#A1DAB4","#41B6C4","#225EA8"],5:["#FFFFCC","#A1DAB4","#41B6C4","#2C7FB8","#253494"],6:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#2C7FB8","#253494"],7:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#1D91C0","#225EA8","#0C2C84"]},pink:{3:["#E7E1EF","#C994C7","#DD1C77"],4:["#F1EEF6","#D7B5D8","#DF65B0","#CE1256"],5:["#F1EEF6","#D7B5D8","#DF65B0","#DD1C77","#980043"],6:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#DD1C77","#980043"],7:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#E7298A","#CE1256","#91003F"]},black:{3:["#F0F0F0","#BDBDBD","#636363"],4:["#F7F7F7","#CCCCCC","#969696","#525252"],5:["#F7F7F7","#CCCCCC","#969696","#636363","#252525"],6:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#636363","#252525"],7:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#737373","#525252","#252525"]},red:{3:["#FFEDA0","#FEB24C","#F03B20"],4:["#FFFFB2","#FECC5C","#FD8D3C","#E31A1C"],5:["#FFFFB2","#FECC5C","#FD8D3C","#F03B20","#BD0026"],6:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#F03B20","#BD0026"],7:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#B10026"]},inverted_green:{3:["#2CA25F","#99D8C9","#E5F5F9"],4:["#238B45","#66C2A4","#B2E2E2","#EDF8FB"],5:["#006D2C","#2CA25F","#66C2A4","#B2E2E2","#EDF8FB"],6:["#006D2C","#2CA25F","#66C2A4","#99D8C9","#CCECE6","#EDF8FB"],7:["#005824","#238B45","#41AE76","#66C2A4","#CCECE6","#D7FAF4","#EDF8FB"]},inverted_blue:{3:["#2C7FB8","#7FCDBB","#EDF8B1"],4:["#225EA8","#41B6C4","#A1DAB4","#FFFFCC"],5:["#253494","#2C7FB8","#41B6C4","#A1DAB4","#FFFFCC"],6:["#253494","#2C7FB8","#41B6C4","#7FCDBB","#C7E9B4","#FFFFCC"],7:["#0C2C84","#225EA8","#1D91C0","#41B6C4","#7FCDBB","#C7E9B4","#FFFFCC"]},inverted_pink:{3:["#DD1C77","#C994C7","#E7E1EF"],4:["#CE1256","#DF65B0","#D7B5D8","#F1EEF6"],5:["#980043","#DD1C77","#DF65B0","#D7B5D8","#F1EEF6"],6:["#980043","#DD1C77","#DF65B0","#C994C7","#D4B9DA","#F1EEF6"],7:["#91003F","#CE1256","#E7298A","#DF65B0","#C994C7","#D4B9DA","#F1EEF6"]},inverted_black:{3:["#636363","#BDBDBD","#F0F0F0"],4:["#525252","#969696","#CCCCCC","#F7F7F7"],5:["#252525","#636363","#969696","#CCCCCC","#F7F7F7"],6:["#252525","#636363","#969696","#BDBDBD","#D9D9D9","#F7F7F7"],7:["#252525","#525252","#737373","#969696","#BDBDBD","#D9D9D9","#F7F7F7"]},inverted_red:{3:["#F03B20","#FEB24C","#FFEDA0"],4:["#E31A1C","#FD8D3C","#FECC5C","#FFFFB2"],5:["#BD0026","#F03B20","#FD8D3C","#FECC5C","#FFFFB2"],6:["#BD0026","#F03B20","#FD8D3C","#FEB24C","#FED976","#FFFFB2"],7:["#B10026","#E31A1C","#FC4E2A","#FD8D3C","#FEB24C","#FED976","#FFFFB2"]},spectrum1:{3:["#1a9850","#fff2cc","#d73027"],4:["#1a9850","#d2ecb4","#fed6b0","#d73027"],5:["#1a9850","#8cce8a","#fff2cc","#f79272","#d73027"],6:["#1a9850","#8cce8a","#d2ecb4","#fed6b0","#f79272","#d73027"],7:["#1a9850","#8cce8a","#d2ecb4","#fff2cc","#fed6b0","#f79272","#d73027"]},spectrum2:{3:["#0080ff","#fff2cc","#ff4d4d"],4:["#0080ff","#7fbfff","#ffa6a6","#ff4d4d"],5:["#0080ff","#40a0ff","#fff2cc","#ff7a7a","#ff4d4d"],6:["#0080ff","#40a0ff","#7fbfff","#ffa6a6","#ff7a7a","#ff4d4d"],7:["#0080ff","#40a0ff","#7fbfff","#fff2cc","#ffa6a6","#ff7a7a","#ff4d4d"]},purple_states:{3:["#F1E6F1","#B379B3","#8A4E8A"],4:["#F1E6F1","#D8BBD8","#A05AA0","#8A4E8A"],5:["#F1E6F1","#D8BBD8","#B379B3","#A05AA0","#8A4E8A"],6:["#F1E6F1","#D8BBD8","#CCA5CC","#B379B3","#A05AA0","#8A4E8A"],7:["#F1E6F1","#D8BBD8","#CCA5CC","#C08FC0","#B379B3","#A05AA0","#8A4E8A"]},red_states:{3:["#F2D2D3","#D4686C","#C1373C"],4:["#F2D2D3","#EBB7B9","#CC4E52","#C1373C"],5:["#F2D2D3","#EBB7B9","#D4686C","#CC4E52","#C1373C"],6:["#F2D2D3","#EBB7B9","#E39D9F","#D4686C","#CC4E52","#C1373C"],7:["#F2D2D3","#EBB7B9","#E39D9F","#DB8286","#D4686C","#CC4E52","#C1373C"]},blue_states:{3:["#ECF0F6","#6182B5","#43618F"],4:["#ECF0F6","#B2C2DB","#4E71A6","#43618F"],5:["#ECF0F6","#B2C2DB","#6182B5","#4E71A6","#43618F"],6:["#ECF0F6","#B2C2DB","#9BB0D0","#6182B5","#4E71A6","#43618F"],7:["#ECF0F6","#B2C2DB","#9BB0D0","#849EC5","#6182B5","#4E71A6","#43618F"]},inverted_purple_states:{3:["#8A4E8A","#B379B3","#F1E6F1"],4:["#8A4E8A","#A05AA0","#D8BBD8","#F1E6F1"],5:["#8A4E8A","#A05AA0","#B379B3","#D8BBD8","#F1E6F1"],6:["#8A4E8A","#A05AA0","#B379B3","#CCA5CC","#D8BBD8","#F1E6F1"],7:["#8A4E8A","#A05AA0","#B379B3","#C08FC0","#CCA5CC","#D8BBD8","#F1E6F1"]},inverted_red_states:{3:["#C1373C","#D4686C","#F2D2D3"],4:["#C1373C","#CC4E52","#EBB7B9","#F2D2D3"],5:["#C1373C","#CC4E52","#D4686C","#EBB7B9","#F2D2D3"],6:["#C1373C","#CC4E52","#D4686C","#E39D9F","#EBB7B9","#F2D2D3"],7:["#C1373C","#CC4E52","#D4686C","#DB8286","#E39D9F","#EBB7B9","#F2D2D3"]},inverted_blue_states:{3:["#43618F","#6182B5","#ECF0F6"],4:["#43618F","#4E71A6","#B2C2DB","#ECF0F6"],5:["#43618F","#4E71A6","#6182B5","#B2C2DB","#ECF0F6"],6:["#43618F","#4E71A6","#6182B5","#9BB0D0","#B2C2DB","#ECF0F6"],7:["#43618F","#4E71A6","#6182B5","#849EC5","#9BB0D0","#B2C2DB","#ECF0F6"]}}},{}],131:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-ListDecoration-itemLink u-flex u-justifySpace u-alignCenter u-actionTextColor ',isSelected&&(__p+=" is-selected "),__p+='">\n  '+(null==(__t=_t("form-components.editors.fill.quantification.methods."+name))?"":_.escape(__t))+"\n</div>\n\n";return __p}},{underscore:"underscore"}],132:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("./input-number-value-content-view.tpl");b.exports=e.extend({events:{"click .js-back":"_onClickBack","click .js-bins":"_onClickBins","click .js-quantification":"_onClickQuantification"},render:function(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this.$el.append(f({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initForm(),this},_calculateRangeFromFixed:function(a,b){b=b||30;var c=this.options.max-this.options.min,d=a/c;return[Math.floor(Math.max(this.options.min,a-b*d)),Math.floor(Math.min(this.options.max,a+b*d))]},_initForm:function(){var a=this;this._formView&&this._formView.remove();var b,c,e=this.model.get("range");if(b=c=this.model.get("fixed"),e&&(b=+e[0],c=+e[1]),b===c){var f=this._calculateRangeFromFixed(b);b=f[0],c=f[1],this.model.set("range",f)}this._formModel=new d.Model({min:b,max:c}),this._formModel.schema={min:{type:"Number",validators:["required",{type:"interval",min:a.options.min,max:a.options.max}]},max:{type:"Number",validators:["required",{type:"interval",min:a.options.min,max:a.options.max}]}},this._formModel.bind("change",function(a){this.model.set("range",[+a.get("min"),+a.get("max")])},this),this._formView=new d.Form({className:"Editor-boxList",model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$(".js-content").append(this._formView.render().$el)},_removeForm:function(){this._formView&&this._formView.remove()},_onClickBack:function(a){this.killEvent(a),this.trigger("back",this)},_onClickQuantification:function(a){this.killEvent(a),this.trigger("selectQuantification",this)},_onClickBins:function(a){this.killEvent(a),this.trigger("selectBins",this)},clean:function(){this._removeForm(),e.prototype.clean.call(this)}})},{"./input-number-value-content-view.tpl":136,backbone:"backbone","backbone/core-view":454}],133:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("../fill-tab-pane.tpl"),g=a("../../../../../components/tab-pane/create-text-labels-tab-pane"),h=a("./input-number-fixed-content-view"),i=a("./input-number-value-content-view"),j=0,k=100,l=1;b.exports=e.extend({initialize:function(a){if(!a.columns)throw new Error("columns param is required");this._columns=a.columns,this.listenTo(this.model,"change:attribute",this._updateRangeValue)},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=this,b={name:"fixed",label:_t("form-components.editors.fill.input-number.fixed"),createContentView:function(){return a._generateFixedContentView()}},c={name:"value",label:_t("form-components.editors.fill.input-number.value"),createContentView:function(){return a._generateValueContentView()}};if(this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes){var e=this.options.editorAttrs.hidePanes;d.contains(e,"fixed")||this._tabPaneTabs.push(b),d.contains(e,"value")||this._tabPaneTabs.push(c)}else this._tabPaneTabs=[b,c];var h={tabPaneOptions:{template:f,tabPaneItemOptions:{tagName:"li",className:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("range")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this._tabPaneView=g(this._tabPaneTabs,h),this.listenTo(this._tabPaneView.collection,"change:selected",this._onChangeTabPaneViewTab),this.addView(this._tabPaneView),this.$el.append(this._tabPaneView.render().$el)},_onChangeTabPaneViewTab:function(){var a=this._tabPaneView.getSelectedTabPaneName();"fixed"===a?this._updateFixedValue():this._updateRangeValue(),this.trigger("change",a,this)},_updateFixedValue:function(){if(this.model.get("range")){var a=this.model.get("range"),b=.5*(+a[0]+ +a[1]);this.model.set("fixed",b),this.model.unset("range")}},_updateRangeValue:function(){null!==this.model.get("fixed")&&void 0!==this.model.get("fixed")&&this.model.get("attribute")&&(this.model.set("range",[this.model.get("fixed"),this.model.get("fixed")]),this.model.unset("fixed"))},_generateFixedContentView:function(){var a=this.options.editorAttrs;return new h({model:this.model,min:a&&a.min||j,max:a&&a.max||k,step:a&&a.step||l})},_generateValueContentView:function(){var a=this.options.editorAttrs;return new i({model:this.model,columns:this._columns,min:a&&a.min||j,max:a&&a.max||k})},_onChangeValue:function(a){this.model.set("fixed",a.value)}})},{"../../../../../components/tab-pane/create-text-labels-tab-pane":276,"../fill-tab-pane.tpl":76,"./input-number-fixed-content-view":134,"./input-number-value-content-view":135,"backbone/core-view":454,underscore:"underscore"}],134:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=e.extend({render:function(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this._initForm(),this},_initForm:function(){this._formModel=new d.Model({value:this.model.get("fixed")}),this._formModel.schema={value:{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max,step:this.options.step}]}},this._formModel.bind("change",function(a){this.model.set("fixed",a.get("value"))},this),this._formView=new d.Form({className:"CDB-ListDecoration-itemPadding",model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.append(this._formView.render().$el)},_removeForm:function(){this._formView&&this._formView.remove()},clean:function(){this._removeForm(),e.prototype.clean.call(this)}})},{backbone:"backbone","backbone/core-view":454}],135:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("../../../../../components/stack-layout/stack-layout-view"),g=a("../column-list-view"),h=a("./quantification-method-item.tpl"),i=a("./input-number-content-view"),j=a("../default-fill-settings.json"),k=0,l=1,m=2;b.exports=e.extend({events:{"click .js-back":"_onClickBack"},initialize:function(a){if(!a.columns)throw new Error("columns param is required");this._columns=a.columns,this._settings=j.number,this._setupModel()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_setupModel:function(){var a={};this.model.get("quantification")||(a.quantification=this._settings.quantifications.items[this._settings.quantifications.defaultIndex]),this.model.get("bins")||(a.bins=this._settings.bins.items[this._settings.bins.defaultIndex]),+this.model.get("bins")>+this._settings.bins.items[this._settings.bins.items.length-1]&&(a.bins=this._settings.bins.items[this._settings.bins.items.length-1]),this.model.set(a)},_initViews:function(){var a=this,b=new d.Collection([{createStackView:function(b,c){return a._createInputRampContentView(b,c).bind(a)}},{createStackView:function(b,c){return a._createInputNumberContentView(b,c).bind(a)}},{createStackView:function(b,c){return a._createQuantificationListView(b,c).bind(a)}},{createStackView:function(b,c){return a._createBinsListView(b,c).bind(a)}}]);this._stackLayoutView=new f({collection:b});var c=l;this.model.get("attribute")?this.model.get("quantification")||(c=m):c=k,this._stackLayoutView.model.set("position",c),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createInputRampContentView:function(a,b){var c=new g({stackLayoutModel:a,columns:this._columns.filter(function(a){return"number"===a.type}),showSearch:!0,typeLabel:"column"});return c.bind("selectItem",function(a){this.model.set("attribute",a.get("val"));var b=l;this.model.get("quantification")||(b=m),this._stackLayoutView.model.goToStep(b)},this),c},_createInputNumberContentView:function(a,b){var c=new i({stackLayoutModel:a,model:this.model,min:this.options.min,max:this.options.max});return c.bind("back",function(b){a.prevStep()},this),c.bind("selectQuantification",function(b){a.goToStep(2)},this),c.bind("selectBins",function(b){a.goToStep(3)},this),c},_createQuantificationListView:function(a,b){var c=new g({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:a,columns:this._settings.quantifications.items,itemTemplate:h,showSearch:!1});return c.bind("selectItem",function(b){this.model.set("quantification",b.get("val")),a.prevStep()},this),c.bind("back",function(b){a.prevStep()},this),c},_createBinsListView:function(a,b){var c=new g({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:a,columns:this._settings.bins.items});return c.bind("selectItem",function(b){this.model.set("bins",b.get("val")),a.goToStep(1)},this),c.bind("back",function(b){a.goToStep(1)},this),c},_onClickBack:function(a){this.killEvent(a)}})},{"../../../../../components/stack-layout/stack-layout-view":274,"../column-list-view":71,"../default-fill-settings.json":73,"./input-number-content-view":132,"./quantification-method-item.tpl":139,backbone:"backbone","backbone/core-view":454}],136:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="InputColor-modalHeader CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <div class="u-flex u-alignStart u-ellipsis">\n        <button class="u-rSpace u-actionTextColor js-back">\n          <i class="CDB-IconFont CDB-IconFont-arrowPrev Size-large"></i>\n        </button>\n        <div class="u-ellipsis">\n          '+(null==(__t=attribute)?"":_.escape(__t))+'\n        </div>\n      </div>\n    </li>\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical CDB-Text CDB-Size-medium u-secondaryTextColor">\n      <ul class="u-flex u-justifySpace">\n        <li class="u-flex">\n          '+(null==(__t=bins)?"":_.escape(__t))+" "+(null==(__t=_t("form-components.editors.fill.input-ramp.buckets",{smart_count:bins}))?"":_.escape(__t))+'\n          <button class="CDB-Shape u-lSpace js-bins">\n            <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n            </div>\n          </button>\n        </li>\n        <li class="u-flex">\n          '+(null==(__t=_t("form-components.editors.fill.quantification.methods."+quantification))?"":_.escape(__t))+'\n          <button class="CDB-Shape u-lSpace js-quantification">\n            <div class="CDB-Shape-threePoints is-horizontal is-blue is-small">\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n              <div class="CDB-Shape-threePointsItem"></div>\n            </div>\n          </button>\n        </li>\n      </ul>\n    </li>\n  </ul>\n</div>\n<div class="js-content"></div>\n';return __p}},{underscore:"underscore"}],137:[function(a,b,c){var d=a("backbone/core-view"),e=a("./input-number.tpl"),f=a("./input-number-dialog-content");b.exports=d.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function(a){if(!a.columns)throw new Error("columns is required");this._columns=a.columns,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.options.disabled&&this.$el.addClass("is-disabled"),this.$el.html(e({value:this._getValue()})),this},_createContentView:function(){var a=new f({model:this.model,columns:this._columns,editorAttrs:this.options.editorAttrs});return a.bind("change",this.render,this),a},_onClick:function(a){this.options.disabled||this.trigger("click",this.model)},_initBinds:function(){this.model.set("createContentView",function(){return this._createContentView()}.bind(this)),this.listenTo(this.model,"change:selected",this._onToggleSelected),this.listenTo(this.model,"change:fixed",this._onChangeValue),this.listenTo(this.model,"change:range",this._onChangeValue)},_getValue:function(){function a(a){return a.replace(/\.0$/,"")}return this.model.get("range")?this.model.get("range").map(function(b){return a((+b).toFixed(1))}).join(".."):a((+this.model.get("fixed")).toFixed(1))},_onChangeValue:function(){this.$(".js-value").text(this._getValue())},_onToggleSelected:function(){this.$el.toggleClass("is-active",this.model.get("selected"))}})},{"./input-number-dialog-content":133,"./input-number.tpl":138,"backbone/core-view":454}],138:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-OptionInput-content js-value">'+(null==(__t=value)?"":_.escape(__t))+"</button>\n";return __p}},{underscore:"underscore"}],139:[function(a,b,c){arguments[4][131][0].apply(c,arguments)},{dup:131,underscore:"underscore"}],140:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend");d.Form.editors.List.CategoryModel=d.Form.editors.NestedModel.extend({initialize:function(a){if(d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),!this.form)throw new Error('Missing required option "form"');if(!a.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var a=this.form.constructor,b=this.value||{},c=this.schema.model,d=b.constructor===c?b:new c(b,this.options);return this.nestedForm=new a({model:d,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this}})},{"../editor-helpers-extend":62,backbone:"backbone"}],141:[function(a,b,c){var d=a("backbone"),e=a("jquery"),f=a("underscore");d.Form.editors.List.Item=d.Form.editors.Base.extend({events:{'click [data-action="remove"]':function(a){a.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function(a){13===a.keyCode&&(a.preventDefault(),this.list.addItem(),this.list.$list.find("> li:last input").focus())}},initialize:function(a){this.list=a.list,this.schema=a.schema||this.list.schema,this.value=a.value,this.Editor=a.Editor||d.Form.editors.Text,this.key=a.key,this.template=a.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=a.errorClassName||this.constructor.errorClassName,this.form=a.form,this.userModel=a.userModel,this.configModel=a.configModel,this.modals=a.modals},render:function(){this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form},{userModel:this.userModel,configModel:this.configModel,modals:this.modals}).render();var a=e(e.trim(this.template()));return a.find("[data-editor]").append(this.editor.el),this.setElement(a),this},getValue:function(){return this.editor.getValue()},setValue:function(a){this.editor.setValue(a)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),d.View.prototype.remove.call(this)},validate:function(){var a=this.getValue(),b=this.list.form?this.list.form.getValue():{},c=this.schema.validators,d=this.getValidator;if(!c)return null;var e=null;return f.every(c,function(c){return e=d(c)(a,b),!!e}),e?this.setError(e):this.clearError(),e?e:null},setError:function(a){this.$el.addClass(this.errorClassName),this.$el.attr("title",a.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{template:f.template('      <div>        <span data-editor></span>        <button type="button" data-action="remove">&times;</button>      </div>    ',null,d.Form.templateSettings),errorClassName:"error"})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],142:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("jquery"),g=a("underscore");d.Form.editors.List=d.Form.editors.Base.extend({events:{'click [data-action="add"]':function(a){a.preventDefault(),this.addItem(null,!0)}},initialize:function(a){a=a||{};var b=d.Form.editors;b.Base.prototype.initialize.call(this,a),e.setOptions(this,a);var c=this.schema;if(!c)throw new Error("Missing required option 'schema'");this.template=a.template||c.listTemplate||this.constructor.template,this.Editor=function(){var a=c.itemType;return a?b.List[a]?b.List[a]:b[a]:b.Text}(),this._userModel=this.options.userModel,this._configModel=this.options.configModel,this._modals=this.options.modals,this.items=[]},render:function(){var a=this,b=this.value||[],c=f(f.trim(this.template()));return this.$list=c.is("[data-items]")?c:c.find("[data-items]"),b.length?g.each(b,function(b){a.addItem(b)}):this.Editor.isAsync||this.addItem(),this.setElement(c),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this),this},addItem:function(a,b){var c=this,e=d.Form.editors,f=new e.List.Item({list:this,form:this.form,schema:this.schema,value:a,Editor:this.Editor,key:this.key,userModel:this._userModel,configModel:this._configModel,modals:this._modals}).render(),h=function(){c.items.push(f),c.$list.append(f.el),f.editor.on("all",function(a){if("change"!==a){var b=g.toArray(arguments);b[0]="item:"+a,b.splice(1,0,c),e.List.prototype.trigger.apply(this,b)}},c),f.editor.on("change",function(){f.addEventTriggered||(f.addEventTriggered=!0,this.trigger("add",this,f.editor)),this.trigger("item:change",this,f.editor),this.trigger("change",this)},c),f.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},c),f.editor.on("blur",function(){if(this.hasFocus){var a=this;setTimeout(function(){g.find(a.items,function(a){return a.editor.hasFocus})||a.trigger("blur",a)},0)}},c),(b||a)&&(f.addEventTriggered=!0),b&&(c.trigger("add",c,f.editor),c.trigger("change",c))};return this.Editor.isAsync?f.editor.on("readyToAdd",h,this):(h(),f.editor.focus()),f},removeItem:function(a){var b=this.schema.confirmDelete;if(!b||confirm(b)){var c=g.indexOf(this.items,a);this.items[c].remove(),this.items.splice(c,1),a.addEventTriggered&&(this.trigger("remove",this,a.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem()}},getValue:function(){var a=g.map(this.items,function(a){return a.getValue()});return g.without(a,void 0,"")},setValue:function(a){this.value=a,this.render()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){if(this.hasFocus){var a=g.find(this.items,function(a){return a.editor.hasFocus});a&&a.editor.blur()}},remove:function(){g.invoke(this.items,"remove"),d.Form.editors.Base.prototype.remove.call(this)},validate:function(){if(!this.validators)return null;var a=g.map(this.items,function(a){return a.validate()}),b=!!g.compact(a).length;if(!b)return null;var c={type:"list",message:"Some of the items in the list failed validation",errors:a};return c}},{template:g.template('      <div>        <div data-items></div>        <button type="button" data-action="add">Add</button>      </div>    ',null,d.Form.templateSettings)
})},{"../editor-helpers-extend":62,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],143:[function(a,b,c){var d=a("../../../custom-list/custom-list-item-view"),e=a("underscore");b.exports=d.extend({render:function(){return this.$el.empty(),this.clearSubViews(),this.$el.append(this.options.template(e.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),name:this.model.getName(),val:this.model.getValue()},this.model.attributes))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},{"../../../custom-list/custom-list-item-view":26,underscore:"underscore"}],144:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button type="button" class="CDB-ListDecoration-itemLink u-ellipsis u-actionTextColor" title="'+(null==(__t=val)?"":_.escape(__t))+'">\n  ',__p+="undefined"!=typeof type&&"node"===type?'\n    <div class="u-flex">\n      <span\n        class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase"\n        style="background-color: '+(null==(__t=color)?"":_.escape(__t))+';">'+(null==(__t=val)?"":_.escape(__t))+'</span>\n      <p class="CDB-Text CDB-Size-medium u-ellipsis u-flex">\n        '+(null==(__t=nodeTitle)?"":_.escape(__t))+'<span class="u-altTextColor u-lSpace u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</span>\n      </p>\n    </div>\n  ":"\n    "+(null==(__t=val)?"":_.escape(__t))+"\n  ",__p+="\n</button>\n";return __p}},{underscore:"underscore"}],145:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","undefined"!=typeof isLoading&&isLoading?__p+='\n  <div class="u-flex">\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n    </div>\n    <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n  </div>\n":(__p+="\n  ",__p+="undefined"!=typeof type&&"node"===type?'\n    <div class="u-flex">\n      <span\n        class="SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase"\n        style="background-color: '+(null==(__t=color)?"":_.escape(__t))+';">'+(null==(__t=val)?"":_.escape(__t))+'</span>\n        <p class="CDB-Text CDB-Size-medium u-ellipsis u-flex" title="'+(null==(__t=nodeTitle)?"":_.escape(__t))+" - "+(null==(__t=layerName)?"":_.escape(__t))+'">\n          '+(null==(__t=nodeTitle)?"":_.escape(__t))+' <span class="u-altTextColor u-lSpace u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</span>\n        </p>\n    </div>\n  ":"\n    "+(null==(__t=label)?"":_.escape(__t))+"\n  ",__p+="\n"),__p+="\n";return __p}},{underscore:"underscore"}],146:[function(a,b,c){var d=a("backbone"),e=a("./node-dataset-item-view"),f=a("./node-dataset-selected.tpl"),g=a("./node-dataset-item.tpl");d.Form.editors.NodeDataset=d.Form.editors.Select.extend({options:{selectedItemTemplate:f,itemListTemplate:g,customListItemView:e}})},{"./node-dataset-item-view":143,"./node-dataset-item.tpl":144,"./node-dataset-selected.tpl":145,backbone:"backbone"}],147:[function(a,b,c){var d=a("backbone"),e=a("./number.tpl"),f=a("../editor-helpers-extend");a("jquery"),a("jquery-ui");var g=38,h=40,i=32,j=13,k=1,l=10;d.Form.editors.Number=d.Form.editors.Base.extend({tagName:"ul",className:"CDB-OptionInput-container CDB-OptionInput-container--noMargin u-grow",options:{min:0,max:10,step:1,showSlider:!0,validators:[{type:"regexp",regexp:/^[+-]?((\.\d+)|(\d+(\.\d+)?))$/,message:_t("editor.edit-feature.valid")}]},events:{"keydown .js-input":"_onInputKeyDown","keyup .js-input":"_onInputKeyUp",focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),f.setOptions(this,a),this._validators=a.validators||a.schema&&a.schema.validators,this._validators&&this._validators[1]&&(this.options.min=this._validators[1].min,this.options.max=this._validators[1].max,this.options.step=this._validators[1].step),this._initViews()},_initViews:function(){var a=null===this.value?"null":"";this.$el.html(e({value:this.value,isDisabled:this.options.disabled,hasSlider:this.options.showSlider,isFormatted:this.options.isFormatted,placeholder:a})),this.options.showSlider&&this.$(".js-slider").slider({range:"min",value:this.value,min:this.options.min,max:this.options.max,step:this.options.step,orientation:"horizontal",disabled:this.options.disabled,slide:this._onSlideChange.bind(this),stop:this._onSlideStop.bind(this)}),this.$el.toggleClass("CDB-OptionInput-container--noSlider",!!this.options.showSlider)},_onSlideChange:function(a,b){this.value=b.value,this.$(".js-input").val(this.value)},_onSlideStop:function(a,b){this.trigger("change",this)},_onInputKeyDown:function(a){var b=+this.getValue(),c=k,d=this.$(".js-input");switch(a.shiftKey===!0&&(c=l),a.which){case i:case j:return!1;case g:b+=c,d.val(b);break;case h:b-=c,d.val(b)}},_hasSlider:function(){return this.options.showSlider&&this.$(".js-slider").data("ui-slider")},_onInputKeyUp:function(){var a=this.$(".js-input").val();this._hasSlider()&&this.$(".js-slider").slider("value",a),this.value=a,this.trigger("change",this)},focus:function(){this.hasFocus||this.$(".js-input").focus()},blur:function(){this.hasFocus&&this.$(".js-input").blur()},getValue:function(){var a=this.$(".js-input").val();return""===a?null:+a},setValue:function(a){this._hasSlider()&&this.$(".js-slider").slider("value",a),this.$(".js-input").val(a),this.value=a},_destroySlider:function(){this._hasSlider()&&this.$(".js-slider").slider("destroy")},remove:function(){this._destroySlider(),d.Form.editors.Base.prototype.remove.apply(this)},clean:function(){this.$el.remove()}})},{"../editor-helpers-extend":62,"./number.tpl":148,backbone:"backbone",jquery:"jquery","jquery-ui":455}],148:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",hasSlider&&(__p+='\n  <li class="CDB-OptionInput-item CDB-OptionInput-item--noSeparator">\n    <div class="UISlider js-slider"></div>\n  </li>\n'),__p+='\n<li class="CDB-OptionInput-item">\n  <input type="text" class="CDB-InputText ',isFormatted&&(__p+="is-number"),__p+=" ",isDisabled&&(__p+="is-disabled"),__p+=' js-input" ',isDisabled&&(__p+="readonly"),__p+=' value="'+(null==(__t=value)?"":_.escape(__t))+'" placeholder="'+(null==(__t=placeholder)?"":_.escape(__t))+'" />\n</li>\n';return __p}},{underscore:"underscore"}],149:[function(a,b,c){var d=a("../../../custom-list/custom-list-collection"),e=a("underscore");b.exports=d.extend({search:function(a){return a=a.toLowerCase(),e(this.filter(function(b){var c=b.getName().toLowerCase(),d=b.get("type").toLowerCase();return~c.indexOf(a)&&"number"===d}))}})},{"../../../custom-list/custom-list-collection":23,underscore:"underscore"}],150:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-medium u-altTextColor Editor-dropDownInfoText">\n  '+(null==(__t=_t("components.backbone-forms.operators.count-message"))?"":_.escape(__t))+"\n</p>\n";return __p}},{underscore:"underscore"}],151:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{visible:!1,operator:"count",attribute:""},isValidOperator:function(){var a=this.get("operator"),b=this.get("attribute");return"count"===a||!(!a||!b)}})},{backbone:"backbone"}],152:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("jquery"),g=a("../../../custom-list/custom-view"),h=a("./operators-list-model"),i=a("./operators-list-count.tpl"),j=a("./operators-list.tpl");b.exports=d.extend({className:"Editor-dropdown Editor-boxModal Editor-dropdownOperators",tagName:"div",events:{'change input[name="operator"]':"_onOperationChange"},initialize:function(a){this.model=new h({operator:a.operator,attribute:a.attribute,visible:!1}),a.attribute&&this.collection.setSelected(a.attribute),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(j({operator:this.model.get("operator")})),this._renderList(),this},_initBinds:function(){this.model.bind("change:operator change:attribute",e.debounce(this._onModelChange.bind(this),10)),this.model.bind("change:visible",function(a,b){this._toggleVisibility(),b?this.render():(this._destroyList(),this.$(".js-list").html(i()))},this),this.collection.bind("change:selected",this._onAttributeSelected,this),this.add_related_model(this.collection)},_hasList:function(){return!!this._listView},_renderList:function(){if("count"!==this.model.get("operator")){if(this._hasList())return;this._listView=new g({className:"CDB-Dropdown-options CDB-Text CDB-Size-medium",collection:this.collection,showSearch:!0,typeLabel:this.options.keyAttr}),this.$(".js-list").html(this._listView.render().el)}else this._destroyList(),this.$(".js-list").html(i())},_destroyList:function(){this._hasList()&&(this.removeView(this._listView),this._listView.clean(),delete this._listView)},_onModelChange:function(){this.model.isValidOperator()&&this.trigger("change",this.model.toJSON(),this)},_onOperationChange:function(a){var b=f(a.target),c=b.val();"count"===c&&(this.model.set("attribute",""),this.collection.removeSelected()),this.model.set("operator",c),this._renderList()},_onAttributeSelected:function(a){a.get("selected")&&this.model.set("attribute",a.getValue())},_toggleVisibility:function(){this.$el.toggleClass("is-visible",!!this.model.get("visible"))},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},remove:function(){this._destroyList(),this.$el.empty(),d.prototype.remove.call(this)}})},{"../../../custom-list/custom-view":35,"./operators-list-count.tpl":150,"./operators-list-model":151,"./operators-list.tpl":153,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],153:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Editor-dropdownCalculations CDB-Text is-semibold">\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="count" ',"count"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.count"))?"":_.escape(__t))+'</label>\n  </li>\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="sum" ',"sum"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.sum"))?"":_.escape(__t))+'</label>\n  </li>\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="avg" ',"avg"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.avg"))?"":_.escape(__t))+'</label>\n  </li>\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="max" ',"max"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.max"))?"":_.escape(__t))+'</label>\n  </li>\n  <li class="Editor-dropdownCalculationsElement CDB-Fieldset">\n    <input class="CDB-Radio" type="radio" name="operator" value="min" ',"min"===operator&&(__p+="checked"),__p+='>\n    <span class="u-iBlock CDB-Radio-face"></span>\n    <label class="u-iBlock u-lSpace">'+(null==(__t=_t("operators.min"))?"":_.escape(__t))+'</label>\n  </li>\n</ul>\n<div class="js-list"></div>\n';return __p}},{underscore:"underscore"}],154:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("underscore"),g=a("jquery"),h=a("./operators-list-view"),i=a("./operators-list-collection"),j=a("./operators.tpl"),k=13,l=a("../../../popup-manager");d.Form.editors.Operators=d.Form.editors.Base.extend({tagName:"div",className:"Editor-formSelect u-ellipsis",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.collection=new i(this.options.options),this.dialogMode=this.options.dialogMode||"nested",this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},_initViews:function(){var a=this.model.get(this.options.keyAttr);this.$el.append(g("<div>").addClass("js-operator")),this._setOperatorTemplate(),this._operatorsListView=new h({operator:a.operator,attribute:a.attribute,collection:this.collection}),this._operatorsListView.bind("change",this._onOperatorsChange,this),this._popupManager=new l(this.cid,this.$el,this._operatorsListView.$el),this._popupManager.append(this.dialogMode),this.options.disabled&&this.undelegateEvents()},_setOperatorTemplate:function(){this.$(".js-operator").html(j({name:this._getOperatorsTextValue(),disabled:this.options.disabled,keyAttr:this.options.keyAttr}))},_initBinds:function(){var a=function(){this._operatorsListView.hide(),this._popupManager.untrack()}.bind(this);this.applyESCBind(a),this.applyClickOutsideBind(a)},_onOperatorsChange:function(a){this.model.set(this.options.keyAttr,a),this._setOperatorTemplate(),this.$(".js-button").focus(),this.trigger("change",this)},_getOperatorsTextValue:function(){var a=this.model.get(this.options.keyAttr);return a&&a.operator?a.operator.toUpperCase()+(a.attribute?"("+a.attribute+")":""):""},_onButtonClick:function(a){this._operatorsListView.toggle(),this._operatorsListView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function(a){a.which===k&&(a.preventDefault(),this._operatorsListView.isVisible()?this._popupManager.untrack():(a.stopPropagation(),this._operatorsListView.toggle(),this._popupManager.track()))},getValue:function(){var a=this.model.get(this.options.keyAttr);return f.omit(a,"visible")},setValue:function(a){var b=this._getOperatorsTextValue();this.value=b,this._setOperatorTemplate()},remove:function(){this._popupManager&&this._popupManager.destroy(),this._operatorsListView&&this._operatorsListView.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../popup-manager":263,"../editor-helpers-extend":62,"./operators-list-collection":149,"./operators-list-view":152,"./operators.tpl":155,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],155:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-InputText CDB-Text is-cursor js-button u-ellipsis\n  ',disabled&&(__p+=" is-disabled "),__p+="\n  ",name||(__p+=" is-empty "),__p+='"\n  tabindex="0">\n  '+(null==(__t=name||_t("components.backbone-forms.select.placeholder",{keyAttr:keyAttr}))?"":_.escape(__t))+"\n</div>\n";return __p}},{underscore:"underscore"}],156:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("./radio.tpl"),g=a("underscore"),h=a("jquery"),i=a("../../../tipsy-tooltip-view");d.Form.editors.Radio=d.Form.editors.Radio.extend({className:"CDB-Text CDB-Size-medium u-flex u-alignCenter",initialize:function(a){d.Form.editors.Base.prototype.initialize.apply(this,arguments),e.setOptions(this,a)},render:function(){return this.setOptions(this.schema.options),this._setHelp(),this},_setHelp:function(){var a=g.find(this.schema.options,function(a){return a.help});a&&(this._helpTooltip=this._createTooltip({$el:this.$(".js-help")}))},_createTooltip:function(a){return new i({el:a.$el||this.$el,gravity:a.gravity||"s",className:a.className||"",offset:a.offset||0,title:function(){return a.msg||h(this).data("tooltip")}})},getValue:function(){var a=this.$("input[type=radio]:checked").val();return""===a?null:a},_arrayToHtml:function(a){var b=this.form.model.get(this.key),c=g.map(a,function(a,c){var d=a.val,e={name:this.getName(),value:null===d?"":d.toString(),help:a.help,id:this.id,label:a.label,className:a.className};return b===d?e.selected=!0:e.disabled=a.disabled,e},this);return f({items:c})},remove:function(){this._helpTooltip&&this._helpTooltip.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../tipsy-tooltip-view":325,"../editor-helpers-extend":62,"./radio.tpl":157,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],157:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",_.each(items,function(a,b){__p+='\n  <li class="u-flex u-alignCenter '+(null==(__t=b===items.length-1?"":"u-rSpace--xl")?"":_.escape(__t))+'">\n    <input type="radio" class="CDB-Radio u-iBlock',a.className&&(__p+=" "+(null==(__t=a.className)?"":_.escape(__t))+" "),__p+='"\n    name="'+(null==(__t=a.name)?"":_.escape(__t))+'" value="'+(null==(__t=a.value)?"":_.escape(__t))+'" id="'+(null==(__t=a.id)?"":_.escape(__t))+'" \n        ',a.selected?__p+='\n          checked="checked"\n        ':a.disabled&&(__p+='\n          disabled="disabled"\n        '),__p+='\n      />\n    <span class="u-rSpace CDB-Radio-face"></span>\n      ',a.help&&(__p+='\n        <span class="js-help is-underlined u-lSpace" data-tooltip="'+(null==(__t=a.help)?"":_.escape(__t))+'">\n      '),__p+="\n      "+(null==(__t=a.label)?"":_.escape(__t))+"\n      ",a.help&&(__p+="\n        </span>\n      "),__p+="\n  </li>\n"}),__p+="\n";return __p}},{underscore:"underscore"}],158:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("underscore"),g=a("../../../custom-list/custom-view"),h=a("../../../custom-list/custom-list-multi-collection"),i=a("./select-item.tpl"),j=a("../../../custom-list/custom-list-multi-item-view"),k=a("../../../custom-list/custom-list-item-with-checkbox.tpl"),l=a("./select.tpl"),m=a("../../../popup-manager"),n=13;d.Form.editors.MultiSelect=d.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},options:{selectedItemTemplate:i,itemListTemplate:k,customListItemView:j},initialize:function(a){e.setOptions(this,a),this.collection=new h(a.schema.options),this.dialogMode=this.options.dialogMode||"nested",this._initViews(),this.setValue(this.model.get(a.key)),d.Form.editors.Base.prototype.initialize.call(this,a),this._initBinds()},_getLabel:function(){var a=f.compact(this.collection.pluck("selected")).length;return _t("components.backbone-forms.select.selected",{count:a})},_initViews:function(){var a=this.options.loading,b=!this.collection.length,c=!!b||this.options.disabled,d=this._getLabel(),e=null===d,f=e?"null":d;this.$el.html(l({label:f,keyAttr:this.options.keyAttr,isDisabled:c,isLoading:a,isEmpty:b,isNull:e,placeholder:null})),c&&this.undelegateEvents(),this._listView=new g({collection:this.collection,showSearch:this.options.showSearch,typeLabel:this.options.keyAttr,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,searchPlaceholder:null}),this._listView.bind("hidden",this._onHide,this),this._popupManager=new m(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_initBinds:function(){var a=function(){this._listView.hide(),this._popupManager.untrack()}.bind(this);this.collection.bind("change:selected",this._onItemSelected,this),this.applyESCBind(a),this.applyClickOutsideBind(a)},_onItemSelected:function(a){this._renderButton(a).focus(),this.trigger("change",this)},_onButtonClick:function(a){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function(a){a.which===n&&(a.preventDefault(),this._listView.isVisible()?this._popupManager.untrack():(a.stopPropagation(),this._listView.toggle(),this._popupManager.track()))},_getSelectedValues:function(){return this.collection.chain().map(function(a){return a.get("selected")?a.get("val"):null}).compact().value()},getValue:function(){var a=this._getSelectedValues();if(a.length>0)return a},setValue:function(a){if(a){var b=this.collection.setSelected(a);b&&this._renderButton(b)}},_renderButton:function(a){var b=this.$(".js-button"),c=f.extend({},a.attributes,{label:this._getLabel()}),d=this.options.selectedItemTemplate(c);return b.removeClass("is-empty").html(d),b},_onHide:function(){this._getSelectedValues().length>0&&this.trigger("change",this)},remove:function(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../custom-list/custom-list-item-with-checkbox.tpl":27,"../../../custom-list/custom-list-multi-collection":29,"../../../custom-list/custom-list-multi-item-view":30,"../../../custom-list/custom-view":35,"../../../popup-manager":263,"../editor-helpers-extend":62,"./select-item.tpl":159,"./select.tpl":161,backbone:"backbone",underscore:"underscore"}],159:[function(a,b,c){arguments[4][42][0].apply(c,arguments)},{dup:42,underscore:"underscore"}],160:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("underscore"),g=a("../../../custom-list/custom-view"),h=a("../../../custom-list/custom-list-collection"),i=a("./select-item.tpl"),j=a("../../../custom-list/custom-list-item-view"),k=a("../../../custom-list/custom-list-item.tpl"),l=a("./select.tpl"),m=a("../../../popup-manager"),n=13;d.Form.editors.Select=d.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},options:{selectedItemTemplate:i,itemListTemplate:k,customListItemView:j},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.template=a.template||l,this.dialogMode=this.options.dialogMode||"nested",this.collection=new h(this.options.options),this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},_initViews:function(){var a=this.options.loading,b=!this.collection.length,c=!!b||this.options.disabled,d=this.model.get(this.options.keyAttr),e=null===d,f=e?"null":d,h=this.options.placeholder,i=this.options.keyAttr;this.$el.html(this.template({label:f,keyAttr:this.options.keyAttr,placeholder:h,isDisabled:c,isLoading:a,isEmpty:b,isNull:e})),c&&this.undelegateEvents(),this._listView=new g({collection:this.collection,showSearch:this.options.showSearch,allowFreeTextInput:this.options.allowFreeTextInput,typeLabel:i,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,position:this.options.position,searchPlaceholder:this.options.searchPlaceholder}),this._popupManager=new m(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_initBinds:function(){var a=function(){this._listView.hide(),this._popupManager.untrack()}.bind(this);this.collection.bind("change:selected",this._onItemSelected,this),this.applyESCBind(a),this.applyClickOutsideBind(a)},_onItemSelected:function(a){this._listView.hide(),this._popupManager.untrack(),this._renderButton(a).focus(),this.trigger("change",this)},_onButtonClick:function(a){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function(a){a.which===n&&(a.preventDefault(),this._listView.isVisible()?this._popupManager.track():(a.stopPropagation(),this._listView.toggle()))},getValue:function(){var a=this.collection.getSelectedItem();if(a)return a.getValue()},setValue:function(a){var b=this.collection.setSelected(a);b&&this._renderButton(b),this.value=a},_renderButton:function(a){var b=this.$(".js-button"),c=f.extend({},{label:a.getName()},a.attributes),d=this.options.selectedItemTemplate(c);return b.removeClass("is-empty").html(d),b},remove:function(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),d.Form.editors.Base.prototype.remove.call(this)}})},{"../../../custom-list/custom-list-collection":23,"../../../custom-list/custom-list-item-view":26,"../../../custom-list/custom-list-item.tpl":28,"../../../custom-list/custom-view":35,"../../../popup-manager":263,"../editor-helpers-extend":62,"./select-item.tpl":159,"./select.tpl":161,backbone:"backbone",underscore:"underscore"}],161:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-InputText CDB-Text is-cursor js-button u-ellipsis\n  ',isDisabled&&(__p+=" is-disabled "),__p+="\n  ",label||(__p+=" is-empty "),__p+="\n  ",isNull&&(__p+=" is-empty "),__p+='"\n  tabindex="0">\n  ',isLoading?__p+='\n    <div class="CDB-LoaderIcon CDB-LoaderIcon--small is-dark">\n      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n      </svg>\n      <span class="u-lSpace u-secondaryTextColor">'+(null==(__t=_t("components.backbone-forms.select.loading"))?"":_.escape(__t))+"</span>\n    </div>\n  ":(__p+="\n    ",__p+=isEmpty?"\n      "+(null==(__t=_t("components.backbone-forms.select.empty"))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=placeholder||label||_t("components.backbone-forms.select.placeholder",{keyAttr:keyAttr}))?"":_.escape(__t))+"\n    ",__p+="\n  "),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],162:[function(a,b,c){var d=a("backbone"),e=a("../editor-helpers-extend"),f=a("underscore"),g=a("../../../custom-list/custom-view"),h=a("../../../custom-list/custom-list-collection"),i=a("./select-item.tpl"),j=a("../../../custom-list/custom-list-item-view"),k=a("../../../custom-list/custom-list-item.tpl"),l=a("./select.tpl"),m=a("../../../popup-manager"),n=13;d.Form.editors.Suggest=d.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},options:{selectedItemTemplate:i,itemListTemplate:k,customListItemView:j},initialize:function(a){d.Form.editors.Base.prototype.initialize.call(this,a),e.setOptions(this,a),this.template=a.template||l,this.dialogMode=this.options.dialogMode||"nested",this._setupCollection(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},render:function(){return this.setValue(this.value),this},_setupCollection:function(){if(this.collection=new h(this.options.options),this.options.editorAttrs&&this.options.editorAttrs.collectionData){var a=f.map(this.options.editorAttrs.collectionData,function(a){return{label:a,val:a}});this.collection.reset(a)}},_initViews:function(){var a=this.options.loading,b=!this.collection.length,c=!!b||this.options.disabled,d=this.model.get(this.options.keyAttr),e=null===d,f=e?"null":d;this.$el.html(this.template({label:f,keyAttr:this.options.keyAttr,isDisabled:c,isLoading:a,isEmpty:b,isNull:e,placeholder:null})),c&&this.undelegateEvents(),this._listView=new g({collection:this.collection,showSearch:this.options.showSearch,allowFreeTextInput:this.options.allowFreeTextInput,typeLabel:this.options.keyAttr,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,position:this.options.position,searchPlaceholder:null}),this._popupManager=new m(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_initBinds:function(){var a=function(){this._listView.hide(),this._popupManager.untrack()}.bind(this);this.collection.bind("change:selected",this._onItemSelected,this),this.collection.bind("reset",this.render,this),this.applyESCBind(a),this.applyClickOutsideBind(a)},_onItemSelected:function(a){this._listView.hide(),this._popupManager.untrack(),this._renderButton(a).focus(),this.trigger("change",this)},_onButtonClick:function(a){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function(a){a.which===n&&(a.preventDefault(),this._listView.isVisible()?this._popupManager.untrack():(a.stopPropagation(),this._listView.toggle(),this._popupManager.track()))},getValue:function(){var a=this.collection.getSelectedItem();if(a)return a.getValue()},setValue:function(a){var b=this.collection.setSelected(a);b||(this.collection.add({label:a,val:a}),b=this.collection.setSelected(a)),this._initViews(),this._renderButton(b),this.value=a},_renderButton:function(a){var b=this.$(".js-button"),c=a.getName(),d=null===c||"null"===c,e=d?"null":c,g=f.extend({},a.attributes,{label:e}),h=this.options.selectedItemTemplate(g);return b.html(h).toggleClass("is-empty",d),b},remove:function(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),d.Form.editors.Base.prototype.remove.call(this)},clean:function(){this._popupManager&&this._popupManager.destroy()}})},{"../../../custom-list/custom-list-collection":23,"../../../custom-list/custom-list-item-view":26,"../../../custom-list/custom-list-item.tpl":28,"../../../custom-list/custom-view":35,"../../../popup-manager":263,"../editor-helpers-extend":62,"./select-item.tpl":159,"./select.tpl":161,backbone:"backbone",underscore:"underscore"}],163:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("../editor-helpers-extend"),h=a("./slider.tpl");a("jquery"),a("jquery-ui"),f.Form.editors.Slider=f.Form.editors.Base.extend({tagName:"ul",className:"CDB-OptionInput-container CDB-OptionInput-container--noMargin",options:{direction:""},events:{focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(a){if(f.Form.editors.Base.prototype.initialize.call(this,a),g.setOptions(this,a),!this.options.labels)throw new Error("labels is required");if(this.options.values&&this.options.labels.length!==this.options.values.length)throw new Error("values and labels should have the same length");this._values=this.options.values,this._labels=this.options.labels,this._initViews()},_initViews:function(){this.$el.html(h({direction:this.options.direction}));var a=this._getStepPercentage();this._ticks=this._getTicks(a);var b=this._getInitialTickID();this.$(".js-slider").slider({range:"min",value:this._ticks[b],step:a,orientation:"horizontal",disabled:this.options.disabled,slide:this._onSlideChange.bind(this),stop:this._onSlideStop.bind(this)}),this._addTicks(a),this._updateUI(b)},_getInitialTickID:function(){var a=this.value;return this._values?(a=this._values.indexOf(this.value),a===-1&&(a=0)):a||(a=0),a},_updateUI:function(a){void 0===a&&(a=0),this._updateLabel(a),
this._highlightTick(a)},_getTickID:function(){var a=0;return this.value&&e.isNumber(this.value)&&(a=this._calculateTickValue(this.value)),this._ticks.indexOf(a)},_addTicks:function(a){e.each(this._ticks,function(a){d('<div class="UISlider-tick js-tick"></div>').css("left",a+"%").appendTo(this.$(".js-slider"))},this)},_highlightTick:function(a){this.$(".js-tick").removeClass("is-highlighted"),d(this.$(".js-tick").get(a)).addClass("is-highlighted")},_updateLabel:function(a){this.$(".js-label").text(this._labels[a])},_getTicks:function(a){var b=this;return[0].concat(e(this._labels.length-1).times(function(c){return b._calculateTickValue(a*(c+1))}))},_getStepPercentage:function(){return 100/(this._labels.length-1)},_calculateTickValue:function(a){return+a.toFixed(2)},_onSlideChange:function(a,b){this.value=b.value,this._updateUI(this._getTickID())},_onSlideStop:function(a,b){this.trigger("change",this)},_hasSlider:function(){return this.$(".js-slider").data("ui-slider")},getValue:function(){var a=this._values?this._values[this._getTickID()]:this._getTickID();return""===this.value?null:a},setValue:function(a){this.$(".js-slider").slider("value",a),this.value=a},_destroySlider:function(){this._hasSlider()&&this.$(".js-slider").slider("destroy")},remove:function(){this._destroySlider(),f.Form.editors.Base.prototype.remove.apply(this)},clean:function(){this.$el.remove()}})},{"../editor-helpers-extend":62,"./slider.tpl":164,backbone:"backbone",jquery:"jquery","jquery-ui":455,underscore:"underscore"}],164:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li class="CDB-OptionInput-item CDB-OptionInput-item--noSeparator">\n  ',"desc"===direction?__p+='\n  <svg class="UISlider-scale" width="160px" height="7px" viewBox="0 0 160 7" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n      <g fill="#EEEEEE">\n        <path d="M0,3.96972188 C0,2.86143684 0.899814069,1.95171147 1.99402962,1.93799103 L158.00597,-0.0182528125 C159.107243,-0.0320617354 160,0.846465216 160,1.95103649 L160,4.98745286 C160,6.08887023 159.100186,6.96483876 158.00597,6.94427947 L1.99402962,4.012961 C0.89275747,3.99226913 0,3.08692473 0,1.96876746 L0,3.96972188 Z" id="Mask" transform="translate(80.000000, 3.458568) scale(-1, 1) translate(-80.000000, -3.458568) "></path>\n      </g>\n    </g>\n  </svg>\n  ':"asc"===direction&&(__p+='\n  <svg class="UISlider-scale" width="160px" height="7px" viewBox="0 0 160 7" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n      <g transform="translate(80.000000, 4.000000) rotate(-180.000000) translate(-80.000000, -4.000000) " fill-rule="nonzero" fill="#EEEEEE">\n        <path d="M0,4.96972188 C0,3.86143684 0.899814069,2.95171147 1.99402962,2.93799103 L158.00597,0.981747188 C159.107243,0.967938265 160,1.84646522 160,2.95103649 L160,5.98745286 C160,7.08887023 159.100186,7.96483876 158.00597,7.94427947 L1.99402962,5.012961 C0.89275747,4.99226913 0,4.08692473 0,2.96876746 L0,4.96972188 Z" id="Mask" transform="translate(80.000000, 4.463110) scale(-1, 1) translate(-80.000000, -4.463110) "></path>\n      </g>\n    </g>\n  </svg>\n  '),__p+='\n  <div class="UISlider is-standalone ',direction&&(__p+="without-line"),__p+=' js-slider"></div>\n  <span class="UISlider-label js-label"></span>\n</li>\n';return __p}},{underscore:"underscore"}],165:[function(a,b,c){var d=a("backbone"),e=a("underscore");a("jquery-ui"),d.Form.editors.SortableList=d.Form.editors.List.extend({initialize:function(){d.Form.editors.List.prototype.initialize.apply(this,arguments)},render:function(){return d.Form.editors.List.prototype.render.apply(this,arguments),this._initSortable(),this},_initSortable:function(){this.$list.sortable({axis:"y",items:".js-sortable",tolerance:"pointer",containment:this.$list,forceHelperSize:!0,forcePlaceholderSize:!0,update:this._onSortableUpdate.bind(this)})},_onSortableUpdate:function(a,b){var c=[];e.each(this.items,function(a){var b=a.$el.index(this.$list);c[b]=a}),this.items=c,this.commit()}})},{backbone:"backbone","jquery-ui":455,underscore:"underscore"}],166:[function(a,b,c){var d=a("backbone");b.exports=d.Collection.extend({removeTag:function(a){var b=this.findWhere({label:a});b&&this.remove(b)},addTag:function(a){var b=this.findWhere({label:a});!b&&this.add({label:a})},getValue:function(){return this.map(function(a){return a.get("label")})}})},{backbone:"backbone"}],167:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({tagName:"li",initialize:function(a){if(!a.label)throw new Error("label is required");this._label=a.label},render:function(){return this.clearSubViews(),this.$el.html(this._label),this}})},{"backbone/core-view":454}],168:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./taglist.tpl"),g=a("./taglist-item-view"),h=a("./taglist-collection"),i=a("../editor-helpers-extend");a("jquery"),a("jquery-ui"),a("tagit"),e.Form.editors.Taglist=e.Form.editors.Base.extend({className:"Form-tags CDB-Text",events:{mouseover:"_onMouseOver",mouseout:"_onMouseOut"},initialize:function(a){e.Form.editors.Base.prototype.initialize.call(this,a),i.setOptions(this,a),this._tagCollection=new h(this._normalize(a.schema.options.tags)),this.isEditable=a.schema.options.isEditable||void 0===a.schema.options.isEditable},render:function(){return this._initViews(),this},_initViews:function(){var a=this,b=this.isEditable||0!==this._tagCollection.length?_t("components.taglist.placeholder"):_t("components.taglist.none");this.$el.html(f()),this._tagCollection.each(this._renderTag,this),this.$(".js-tagsList").tagit({allowSpaces:!0,caseSensitive:!1,placeholderText:b,readOnly:!this.isEditable,onBlur:function(){a.isEditable&&a.$el.removeClass("is-focus"),a.trigger("blur",a)},onFocus:function(){a.isEditable&&a.$el.removeClass("is-hover").addClass("is-focus"),a.trigger("focus",a)},afterTagAdded:a._onTagAdded.bind(a),afterTagRemoved:a._onTagRemoved.bind(a)})},_renderTag:function(a){var b=new g({label:a.get("label")});this.$(".js-tagsList").append(b.render().el)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},getValue:function(){return this._tagCollection.getValue()},setValue:function(a){this._tagCollection.reset(this._normalize(a)),this._destroyTagit(),this.render(),this.trigger("change",this)},_onMouseOver:function(){!this.$el.hasClass("is-focus")&&this.$el.addClass("is-hover")},_onMouseOut:function(){!this.$el.hasClass("is-focus")&&this.$el.removeClass("is-hover")},_onTagRemoved:function(a,b){var c=b.tag.find(".tagit-label").text();this._tagCollection.removeTag(c),this.trigger("change",this)},_onTagAdded:function(a,b){var c=b.tag.find(".tagit-label").text();this._tagCollection.addTag(c),this.trigger("change",this)},_normalize:function(a){return d.map(a,function(a){return{label:a.trim()}})},_destroyTagit:function(){this.$(".ui-widget").length>0&&this.$(".js-tagsList").tagit("destroy")},remove:function(){this._destroyTagit(),e.Form.editors.Base.prototype.remove.apply(this)},clean:function(){this.$el.remove()}})},{"../editor-helpers-extend":62,"./taglist-collection":166,"./taglist-item-view":167,"./taglist.tpl":169,backbone:"backbone",jquery:"jquery","jquery-ui":455,tagit:459,underscore:"underscore"}],169:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Form-tagsList js-tagsList"></ul>';return __p}},{underscore:"underscore"}],170:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./editor-helpers-extend");e.Form.editors.Text=e.Form.editors.Text.extend({className:"CDB-InputText CDB-Text",initialize:function(a){e.Form.editors.Base.prototype.initialize.call(this,a),f.setOptions(this,a);var b=this.schema,c="text";b&&b.editorAttrs&&b.editorAttrs.type&&(c=b.editorAttrs.type),b&&b.dataType&&(c=b.dataType),this.$el.attr("type",c),this.determineChange=d.debounce(this.determineChange,200)},render:function(){return this.setValue(this.value),this._toggleDisableState(),this._isCopyButtonEnabled()&&this._toggleClipboardState(),this},getValue:function(){var a=this.$el.val();return""===a?null:a},_toggleClipboardState:function(){this.$el.toggleClass("Share-input-field u-ellipsis",this._isCopyButtonEnabled())},_togglePlaceholder:function(){if(this.options.placeholder)this.$el.attr("placeholder",this.options.placeholder);else{var a=null===this.value?"null":"";this.$el.attr("placeholder",a)}},_toggleDisableState:function(){this.options.disabled?(this.$el.attr("readonly",""),this.$el.attr("placeholder",""),this._isCopyButtonEnabled()&&this.$el.removeAttr("disabled")):(this.$el.removeAttr("readonly"),this._togglePlaceholder()),this.$el.toggleClass("is-disabled",!!this.options.disabled)},_isCopyButtonEnabled:function(){return!!this.options.hasCopyButton}})},{"./editor-helpers-extend":62,backbone:"backbone",underscore:"underscore"}],171:[function(a,b,c){var d=a("backbone");d.Form.editors.TextArea=d.Form.editors.Text.extend({tagName:"textarea",className:"CDB-Textarea",render:function(){return this.setValue(this.value),this._toggleDisableState(),this},getValue:function(){var a=this.$el.val();return""===a?null:a},_toggleDisableState:function(){this.options.disabled?(this.$el.attr("readonly",""),this.$el.attr("placeholder","")):(this.$el.removeAttr("readonly"),this._togglePlaceholder()),this.$el.toggleClass("is-disabled",!!this.options.disabled)}})},{backbone:"backbone"}],172:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./toggle.tpl");e.Form.editors.Toggle=e.Form.editors.Radio.extend({className:"Editor-formLabel CDB-Text CDB-Size-medium u-alignCenter",_arrayToHtml:function(a){var b=this.getName(),c=this.id,e=d.map(a,function(a,e){var f=this.form.model.get(this.key),g={name:b,id:c+"-"+e};return d.isObject(a)?(g.value=a.val||0===a.val?a.val:"",g.label=a.label,g.help=a.help,g.labelHTML=a.labelHTML,g.selected=void 0!==f?f===a.val:a.selected):(g.value=a,g.label=a,g.selected=void 0!==f?f===a:a.selected),g}.bind(this));return f({items:e})}})},{"./toggle.tpl":173,backbone:"backbone",underscore:"underscore"}],173:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",_.each(items,function(a,b){__p+="\n  ",a.selected?(__p+='\n    <li class="u-tSpace">\n      <input type="radio" class="Editor-toggleRadio" name="'+(null==(__t=a.name)?"":__t)+'" value="'+(null==(__t=a.value)?"":_.escape(__t))+'" id="'+(null==(__t=a.id)?"":__t)+'" checked="checked" />\n      ',a.help&&(__p+='<p class="Editor-toggleHelp CDB-Text CDB-Size-small u-altTextColor">'+(null==(__t=a.help)?"":__t)+"</p>"),__p+="\n    </li>\n  "):(__p+='\n    <li class="u-tSpace u-txt-right">\n      <input type="radio" name="'+(null==(__t=a.name)?"":__t)+'" value="'+(null==(__t=a.value)?"":_.escape(__t))+'" id="'+(null==(__t=a.id)?"":__t)+'" />\n      <label class="u-upperCase u-actionTextColor CDB-Text is-semibold CDB-Size-small u-iBlock" for="'+(null==(__t=a.id)?"":__t)+'">',__p+=a.labelHTML?""+(null==(__t=a.labelHTML)?"":__t):""+(null==(__t=a.label)?"":_.escape(__t)),__p+="</label>\n    </li>\n  "),__p+="\n"}),__p+="\n";return __p}},{underscore:"underscore"}],174:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("jquery"),g=a("../tipsy-tooltip-view.js"),h=a("clipboard");d.Form.Field=d.Form.Field.extend({initialize:function(a){this.trackingClass=a.trackingClass,this.constructor.__super__.initialize.apply(this,arguments)},render:function(){return this.constructor.__super__.render.apply(this,arguments),this.schema.help&&this._setHelp(),this._isCopyButtonEnabled()&&this._initClipboard(),this},createSchema:function(a){var b=a.type;return a=this.constructor.__super__.createSchema.apply(this,arguments),a.editorType=b,a},createEditor:function(){var a=e.extend(e.pick(this,"schema","form","key","model","value","trackingClass"),{id:this.createEditorId()}),b=this.schema.type;return new b(a)},_setHelp:function(){this._helpTooltip=this._createTooltip({$el:this.$(".js-help")})},setError:function(a){this.editor.hasNestedForm||(this.$el.addClass(this.errorClassName),this._destroyErrorTooltip(),this._errorTooltip=this._createTooltip({gravity:"w",className:"is-error",msg:a,offset:5}),this._errorTooltip.showTipsy())},clearError:function(){this.$el.removeClass(this.errorClassName),this._destroyErrorTooltip()},_initClipboard:function(){this._clipboard&&this._clipboard.destroy();var a=this.$(".js-copy");this._clipboard=new h(a.get(0))},_createTooltip:function(a){return new g({el:a.$el||this.$el,gravity:a.gravity||"s",className:a.className||"",offset:a.offset||0,title:function(){return a.msg||f(this).data("tooltip")}})},_destroyErrorTooltip:function(){this._errorTooltip&&(this._errorTooltip.hideTipsy(),this._errorTooltip.destroyTipsy())},_destroyHelpTooltip:function(){this._helpTooltip&&this._helpTooltip.destroyTipsy()},_destroyClipboard:function(){this._clipboard&&this._clipboard.destroy()},templateData:function(){var a,b=this.schema;try{a=this.form.schema[this.key].type}catch(b){a=void 0}return{help:b.help||"",isCopyButtonEnabled:this._isCopyButtonEnabled(),hasNestedForm:this.editor.hasNestedForm,title:b.title,fieldAttrs:b.fieldAttrs,editorAttrs:b.editorAttrs,key:this.key,type:a,editorId:this.editor.id,editorType:this.editor.el.type}},_isCopyButtonEnabled:function(){return!!this.schema.hasCopyButton},remove:function(){this._destroyErrorTooltip(),this._destroyHelpTooltip(),this._destroyClipboard(),this.editor.remove(),d.View.prototype.remove.call(this)}},{template:a("./field.tpl"),errorClassName:"CDB-FieldError"})},{"../tipsy-tooltip-view.js":325,"./field.tpl":175,backbone:"backbone",clipboard:"clipboard",jquery:"jquery",underscore:"underscore"}],175:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Text Editor-formInner',type&&(__p+=" Editor-formInner--"+(null==(__t=type)?"":_.escape(__t))),__p+='">\n  ',title&&(__p+='\n    <label class="CDB-Legend ',editorType&&(__p+=" CDB-Legend--"+(null==(__t=editorType)?"":_.escape(__t))),__p+=' u-upperCase CDB-Text is-semibold CDB-Size-small u-rSpace--m" for="'+(null==(__t=editorId)?"":_.escape(__t))+'" title="'+(null==(__t=title)?"":_.escape(__t))+'">\n      <div class="u-ellipsis ',help&&(__p+="Editor-formHelp"),__p+='">\n        <span class="',help&&(__p+=" js-help is-underlined"),__p+='" ',help&&(__p+=' data-tooltip="'+(null==(__t=help)?"":_.escape(__t))+'"'),__p+=" >"+(null==(__t=title)?"":_.escape(__t))+"</span>\n      </div>\n    </label>\n  "),__p+='\n  <div class="Editor-formInput u-flex u-alignCenter" data-editor>\n    ',isCopyButtonEnabled&&(__p+='\n      <button type="button" class="Share-copy CDB-Button CDB-Button--small js-copy" data-clipboard-target="#'+(null==(__t=editorId)?"":_.escape(__t))+'">\n        <span class="CDB-Button-Text CDB-Text CDB-Size-small u-actionTextColor">'+(null==(__t=_t("components.backbone-forms.copy-button"))?"":_.escape(__t))+"</span>\n      </button>\n    "),__p+="\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],176:[function(a,b,c){var d=a("backbone"),e=a("underscore");d.Form.Fieldset.template=e.template('  <div class="Editor-fieldset" data-fields>    <% if (legend) { %>      <legend><%= legend %></legend>    <% } %>  </div>')},{backbone:"backbone",underscore:"underscore"}],177:[function(a,b,c){var d=a("backbone");d.Form=d.Form.extend({initialize:function(a){this.options=a,this.constructor.__super__.initialize.apply(this,arguments)},createField:function(a,b){var c={form:this,key:a,schema:b,idPrefix:this.idPrefix,trackingClass:this.options.trackingClass};this.model?c.model=this.model:this.data?c.value=this.data[a]:c.value=void 0;var d=new this.Field(c);return this.listenTo(d.editor,"all",this.handleEditorEvent),d}})},{backbone:"backbone"}],178:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone");a("backbone-forms"),f.$=d,e.extend(f.Form.validators,{interval:a("./validators/interval.js")}),a("./form.js"),a("./fieldset-template.js"),a("./field.js"),a("./editors/base.js"),a("./editors/text.js"),a("./editors/textarea.js"),a("./editors/number/number.js"),a("./editors/select/select-view.js"),a("./editors/select/multi-select-view.js"),a("./editors/radio/radio.js"),a("./editors/enabler/enabler-view.js"),a("./editors/toggle/toggle.js"),a("./editors/enabler-editor/enabler-editor-view.js"),a("./editors/node-dataset/node-dataset-view.js"),a("./editors/operators/operators-view.js"),a("./editors/list/list.js"),a("./editors/list/list-item.js"),a("./editors/sortable-list.js"),a("./editors/legend/category-item.js"),a("./editors/slider/slider.js"),a("./editors/fill/fill.js"),a("./editors/taglist/taglist.js"),a("./editors/datetime/datetime.js"),a("./editors/select/suggest-view.js"),a("./editors/data-observatory/dropdown-view.js"),a("./editors/code-editor")},{"./editors/base.js":39,"./editors/code-editor":40,"./editors/data-observatory/dropdown-view.js":43,"./editors/datetime/datetime.js":60,"./editors/enabler-editor/enabler-editor-view.js":63,"./editors/enabler/enabler-view.js":66,"./editors/fill/fill.js":78,"./editors/legend/category-item.js":140,"./editors/list/list-item.js":141,"./editors/list/list.js":142,"./editors/node-dataset/node-dataset-view.js":146,"./editors/number/number.js":147,"./editors/operators/operators-view.js":154,"./editors/radio/radio.js":156,"./editors/select/multi-select-view.js":158,"./editors/select/select-view.js":160,"./editors/select/suggest-view.js":162,"./editors/slider/slider.js":163,"./editors/sortable-list.js":165,"./editors/taglist/taglist.js":168,"./editors/text.js":170,"./editors/textarea.js":171,"./editors/toggle/toggle.js":172,"./field.js":174,"./fieldset-template.js":176,"./form.js":177,"./validators/interval.js":179,backbone:"backbone","backbone-forms":"backbone-forms",jquery:"jquery",underscore:"underscore"}],179:[function(a,b,c){b.exports=function(a){var b=parseFloat(a.min)||0,c=parseFloat(a.max)||0,d={type:a.type,message:_t("components.backbone-forms.interval-error",{minValue:a.min,maxValue:a.max})};return function(a,e){var f=0;return null===a||void 0===a||""===a?d:(!isNaN(parseFloat(a))&&isFinite(a)&&(f=parseFloat(a)),b>f||c<f?d:void 0)}}},{}],180:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("../helpers/utils"),g=a("underscore"),h=18,i={width:"18px",height:"18px"},j=g.template("0 0 <%- w %> <%- h %>");b.exports=e.extend({initialize:function(a){if(!a.imageClass)throw new Error("Image class is mandatory.");this._imageClass=a.imageClass,this._imageURL=a.imageUrl,this._color=a.color,this._lastImage={url:null,content:null}},render:function(){return this.$el.empty(),this._loadImage(),this},_loadImage:function(){if(this._imageURL){var a=this;if(this._isSVG(this._imageURL))this._loadSVG();else{var b=d('<img crossorigin="anonymous"/>');b.attr("class",a._imageClass+" js-image"),b.attr("src",this._imageURL+"?req=markup");for(var c in i)b.attr(c,i[c]);this.$el.append(b)}}},_loadSVG:function(){var a=this;this._requestImageURL(this._imageURL,function(b){var c=b.cloneNode(!0),e=d(c);e=e.removeAttr("xmlns:a"),e.attr("class",a._imageClass+" js-image");var f={w:h,h:h};e.attr("viewBox")||(e.attr("height")&&e.attr("width")&&(f={w:c.width.baseVal.value,h:c.height.baseVal.value}),e.attr("viewBox",j(f)));for(var g in i)e.attr(g,i[g]);a.$el.append(e),e.css("fill",a._color),e.find("g").css("fill","inherit"),e.find("path").css("fill","inherit")})},_requestImageURL:function(a,b){var c=this,e=a+"?req=ajax";this._lastImage.url===e?b&&b(this._lastImage.content):d.ajax(e).done(function(a){c._lastImage.url=e;var d=c._lastImage.content=a.getElementsByTagName("svg")[0];b&&b(d)}).fail(function(){throw new Error("Couldn't get "+e+" file.")})},updateImageColor:function(a){this.$(".js-image").css("fill",a)},_isSVG:function(a){if(!a)return!1;var b=a.split("?")[0];return b&&f.endsWith(b.toUpperCase(),"SVG")}})},{"../helpers/utils":435,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],181:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../helpers/required-opts"),f=["infoboxModel","infoboxCollection"];b.exports=d.extend({initialize:function(a){e(a,f,this),this._initBinds(),this._setSelectedModel()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.listenTo(this._infoboxModel,"change:state",this._onChangeState),this.listenTo(this._infoboxModel,"change:visible",this.render)},_initViews:function(){var a;this._selectedModel&&(a=this._selectedModel.get("createContentView"),this.infoboxView=a(),this.$el.append(this.infoboxView.render().el),this.addView(this.infoboxView),this._initSubviewBinds())},_setSelectedModel:function(){var a=this._infoboxModel.get("state");this._selectedModel=this._infoboxCollection.setSelected(a)},_onChangeState:function(){this._setSelectedModel(),this.render()},_initSubviewBinds:function(){this.listenTo(this.infoboxView,"action:main",this._onMainAction),this.listenTo(this.infoboxView,"action:second",this._onSecondAction),this.listenTo(this.infoboxView,"action:close",this._onClose)},_onMainAction:function(){var a=this._selectedModel.get("mainAction");a&&a()},_onSecondAction:function(){var a=this._selectedModel.get("secondAction");a&&a()},_onClose:function(){var a=this._selectedModel.get("closeAction");a?a():this._infoboxModel.set("state",null)}})},{"../../helpers/required-opts":432,"backbone/core-view":454}],182:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../helpers/utils"),g=["template","onEdit","renderOptions"],h=200,i=0,j=27,k=13;b.exports=d.extend({events:{"blur .js-input":"hide","keyup .js-input":"_onKeyUpInput"},initialize:function(a){e.each(g,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._onClickHandler=this._onClickHandler.bind(this),this.edit=this.edit.bind(this),this._timeout=a.timeout||h},render:function(){return this._unbindEvents(),this.clearSubViews(),this.$el.empty(),this._initViews(),this._initBinds(),this},_initBinds:function(){this.options.onClick?(this._onClick=this.options.onClick,this._title().on("click",this._onClickHandler)):this._title().on("dblclick",this.edit)},_unbindEvents:function(){var a=this._title();a&&a.off("click dblclick")},_onClickHandler:function(a){var b=this;i++,1===i&&setTimeout(function(){1===i?b._onClick&&b._onClick(a):b.edit(),i=0},this._timeout)},_initViews:function(){this.$el.append(this._template(this._renderOptions)),this.setElement(this.$(".Inline-editor"))},edit:function(){this.$(".js-input").prop("readonly",!1).show().focus(),this.$(".js-input").get(0).setSelectionRange(0,this.$(".js-input").val().length)},getValue:function(){var a=this.$(".js-input").val();return f.sanitizeHtml(a)},_title:function(){return this.$(".js-title")},hide:function(){this.$(".js-input").prop("readonly",!0).hide()},clean:function(){this._unbindEvents(),d.prototype.clean.call(this)},_onKeyUpInput:function(a){a.which===j&&this.hide(),a.which===k&&this._onEdit&&this._onEdit(this.getValue())}})},{"../../helpers/utils":435,"backbone/core-view":454,underscore:"underscore"}],183:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=d.Model.extend({defaults:{likeable:!0},url:function(a){var b=this._configModel.urlVersion("like"),c=this._configModel.get("base_url");return c+"/api/"+b+"/viz/"+this.get("vis_id")+"/like"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!a.vis_id)throw new Error("vis_id attribute is required");this._configModel=b.configModel,this.on("destroy",function(){this.set({liked:!1,likes:this.get("likes")-1})},this)},_onSaveError:function(a,b){this.trigger("error",{status:b.status,statusText:b.statusText})},toggleLiked:function(){this.get("liked")?this.destroy():(this.set({id:null},{silent:!0}),this.save({},{error:this._onSaveError.bind(this)}))}},{newByVisData:function(a){var b=e.defaults({id:a.liked?a.vis_id:null},e.omit(a,"url","configModel")),c=new f(b,{configModel:a.configModel});return a.url&&(c.url=a.url),c}});b.exports=f},{backbone:"backbone",underscore:"underscore"}],184:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="CDB-LoaderIcon CDB-LoaderIcon--big is-dark js-loader">\n    <svg class="CDB-LoaderIcon-spinner" viewbox="0 0 50 50">\n      <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"/>\n    </svg>\n  </div>\n  <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m u-tSpace-xl">'+(null==(__t=title)?"":_.escape(__t))+'</h4>\n  <div class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=descHTML)?"":__t)+"</div>\n</div>\n";return __p}},{underscore:"underscore"}],185:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-medium u-altTextColor">\n  "'+(null==(__t=quote)?"":__t)+'"\n</p>\n',author&&(__p+='\n  <p class="CDB-Text CDB-Size-medium u-altTextColor u-tSpace"><i> '+(null==(__t=author)?"":_.escape(__t))+"</i></p>\n"),__p+="\n";return __p}},{underscore:"underscore"}],186:[function(a,b,c){var d=a("./quote.tpl"),e=[{quote:"Geographers never get lost. They just do accidental field work.",author:"Nicholas Chrisman"},{quote:"Geography is just physics slowed down, with a couple of trees stuck in it.",author:"Terry Pratchett"},{quote:"Not all those who wander are lost.",author:"J. R. R. Tolkien"},{quote:"In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City.",author:"Jorge Luis Borges"},{quote:"X marks the spot",author:"Indiana Jones"},{quote:"It's turtles all the way down.",author:null},{quote:"Remember: no matter where you go, there you are.",author:null},{quote:"Without geography, you're nowhere!",author:"Jimmy Buffett"},{quote:"our earth is a globe / whose surface we probe /<br />no map can replace her / but just try to trace her",author:"Steve Waterman"},{quote:"Everything happens somewhere.",author:"Doctor Who"},{quote:"A map is the greatest of all epic poems. Its lines and colors show the realization of great dreams.",author:"Gilbert H. Grosvenor"},{quote:"Everything is related to everything else,<br />but near things are more related than distant things.",author:"Tobler's first law of geography"},{quote:"Hic Sunt Dracones",author:null},{quote:"Here be dragons",author:null},{quote:"Stand in the place where you live / Now face North /<br/>Think about direction / Wonder why you haven't before",author:"R.E.M"},{quote:"The virtue of maps, they show what can be done with limited space, they foresee that everything can happen therein.",author:"Jos Saramago"}];b.exports=function(){var a=Math.round(Math.random()*(e.length-1));return d(e[a])}},{"./quote.tpl":185}],187:[function(a,b,c){var d=a("cartodb.js"),e=a("./loading.tpl"),f=a("./random-quote");b.exports=function(a){var b=a.desc&&d.core.sanitize(a.desc);return e({title:a.title||"",descHTML:b||f()})}},{"./loading.tpl":184,"./random-quote":186,"cartodb.js":"cartodb.js"}],188:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{eventName:"",eventProperties:{}},url:function(){return this._configModel.get("base_url")+"/api/v3/metrics"},initialize:function(a,b){if(!b.userId)throw new Error("userId is required");if(!b.visId)throw new Error("visId is required");if(!b.configModel)throw new Error("configModel is required");this._userId=b.userId,this._visId=b.visId,this._configModel=b.configModel},toJSON:function(){return{name:this.get("eventName"),properties:e.extend({},this.get("eventProperties"),{visualization_id:this._visId,user_id:this._userId})}}})},{backbone:"backbone",underscore:"underscore"}],189:[function(a,b,c){var d=a("./metrics-model");b.exports=function(){return{init:function(a){if(!a)throw new Error("visId, userId and configModel are required");if(!a.userId)throw new Error("userId is required");if(!a.visId)throw new Error("visId is required");if(!a.configModel)throw new Error("configModel is required");this._userId=a.userId,this._visId=a.visId,this._configModel=a.configModel},track:function(a,b){if(!a)throw new Error("eventName is required");var c=new d({eventName:a,eventProperties:b},{userId:this._userId,visId:this._visId,configModel:this._configModel});c.save()}}}()},{"./metrics-model":188}],190:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("underscore"),g=a("../../loading/render-loading"),h=13,i=["template","runAction","modalModel"];b.exports=d.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function(a){f.each(i,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),a.loadingTitle&&(this._hasLoading=!0,this._loadingTitle=a.loadingTitle),a.renderOpts&&(this._hasRenderOpts=!0,this._renderOpts=a.renderOpts),this._onKeyDown=this._onKeyDown.bind(this),this._initBinds()},render:function(){this.clearSubViews();var a=this._hasRenderOpts?this._template(this._renderOpts):this._template();return this.$el.html(a),this},_initBinds:function(){e(document).bind("keydown",this._onKeyDown)},_disableBinds:function(){e(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function(a){var b=a.which;b===h&&this._onConfirm()},_renderLoadingView:function(){this.$el.html(g({title:this._loadingTitle}))},_$content:function(){return this.$(".js-content")},_onConfirm:function(){this._hasLoading?this._renderLoadingView():this._modalModel.destroy(),this._runAction()},_onCancel:function(){this._modalModel.destroy()},clean:function(){this._disableBinds(),d.prototype.clean.apply(this)}})},{"../../loading/render-loading":187,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],191:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("../../loading/render-loading"),g=a("../../error/error-view"),h=["errorTitle","loadingTitle","runAction","modalModel"];b.exports=d.extend({className:"Dialog-content",initialize:function(a){e.each(h,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(f({title:this._loadingTitle})),this._runAction({error:this._renderErrorView.bind(this)}),this},_renderErrorView:function(a){var b=new g({title:this._errorTitle,desc:a});this.$el.html(b.render().el),this.addView(b)}})},{"../../error/error-view":37,"../../loading/render-loading":187,"backbone/core-view":454,underscore:"underscore"}],192:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="Dialog-header Modal-header js-header">\n    <div class="Dialog-headerIcon Dialog-headerIcon--negative">\n      <i class="CDB-IconFont CDB-IconFont-cockroach"></i>\n    </div>\n    <h2 class="CDB-Text CDB-Size-large u-bSpace u-errorTextColor">'+(null==(__t=_t("components.modals.dataset-metadata.error.title"))?"":_.escape(__t))+'</h2>\n    <h3 class="CDB-Text CDB-Size-medium u-secondaryTextColor">'+(null==(__t=error)?"":__t)+'</h3>\n  </div>\n\n  <div class="Modal-body">\n    <div class="Modal-body-inner">\n\n      <div class="js-footer">\n        <ul class="Modal-actions is-narrow">\n          <li class="Modal-actions-button">\n            <button class="CDB-Button CDB-Button--primary js-back">\n              <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.dataset-metadata.back-btn"))?"":_.escape(__t))+"</span>\n            </button>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>";
return __p}},{underscore:"underscore"}],193:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("underscore"),g=a("../../../data/vis-metadata-model"),h=a("./dataset-metadata.tpl"),i=a("./footer/footer-view"),j=a("./dataset-metadata-error.tpl"),k=a("../../loading/render-loading"),l=a("./form/form-view"),m=a("./save-metadata-dataset"),n=a("../../../helpers/error-parser"),o=a("../../../components/notifier/notifier"),p=a("../../../helpers/utils");b.exports=e.extend({events:{"click .js-back":"_onBackFromError"},className:"Dialog-content Dialog-content--expanded",initialize:function(a){if(!a.modalModel)throw new TypeError("modalModel is required");if(!a.visDefinitionModel)throw new TypeError("visDefinitionModel is required");if(!a.configModel)throw new TypeError("configModel is required");if(void 0===a.isLocked)throw new TypeError("isLocked is required");this._modalModel=a.modalModel,this._visDefinitionModel=a.visDefinitionModel,this._configModel=a.configModel,this._isLocked=a.isLocked,this._visMetadataModel=new g({name:this._visDefinitionModel.get("name"),description:this._visDefinitionModel.get("description"),license:this._visDefinitionModel.get("license"),source:this._visDefinitionModel.get("source"),attributions:this._visDefinitionModel.get("attributions"),tags:this._visDefinitionModel.get("tags")}),this._stateModel=new d.Model({status:"show"}),this._initBinds()},render:function(){return this.clearSubViews(),this._hasError()?this._renderError():this._isLoading()?this._renderLoading():(this.$el.html(h()),this._initViews()),this},_initViews:function(){var a=new l({visDefinitionModel:this._visDefinitionModel,visMetadataModel:this._visMetadataModel,configModel:this._configModel,isLocked:this._isLocked});this.$(".js-content").append(a.render().el),this.addView(a);var b=new i({visMetadataModel:this._visMetadataModel,onSaveAction:this._onSave.bind(this)});this.$(".js-footer").append(b.render().el),this.addView(b)},_renderError:function(){var a=this._stateModel.get("error");this.$el.html(j({error:_t("components.modals.dataset-metadata.error.subtitle",{error:a})}))},_renderLoading:function(){this.$el.html(k({title:_t("components.modals.dataset-metadata.loading")}))},_initBinds:function(){this._stateModel.on("change:status",this.render,this),this.add_related_model(this._stateModel)},_hasError:function(){return"error"===this._stateModel.get("status")},_isLoading:function(){return"loading"===this._stateModel.get("status")},_onSave:function(){this._stateModel.set({status:"loading"}),m({onSuccess:this._onSuccessSave.bind(this),onError:this._onErrorSave.bind(this),visDefinitionModel:this._visDefinitionModel,name:this._getMetadataName(),description:this._getMetadataDescription(),tags:this._getMetadataTags(),source:this._visMetadataModel.get("source"),attributions:this._visMetadataModel.get("attributions"),license:this._visMetadataModel.get("license")})},_onSuccessSave:function(){var a=this;o.addNotification({status:"success",info:_t("components.modals.dataset-metadata.success",{name:a._getMetadataName()}),closable:!0,delay:o.DEFAULT_DELAY}),this._modalModel.destroy()},_onErrorSave:function(a){this._stateModel.set({status:"error",error:n(a)})},_onBackFromError:function(){this._stateModel.set({status:"show"})},_getMetadataName:function(){return p.sanitizeHtml(this._visMetadataModel.get("name"))},_getMetadataDescription:function(){return p.sanitizeHtml(this._visMetadataModel.get("description"))},_getMetadataTags:function(){return f.map(this._visMetadataModel.get("tags"),function(a){return p.sanitizeHtml(a)})}})},{"../../../components/notifier/notifier":252,"../../../data/vis-metadata-model":378,"../../../helpers/error-parser":426,"../../../helpers/utils":435,"../../loading/render-loading":187,"./dataset-metadata-error.tpl":192,"./dataset-metadata.tpl":194,"./footer/footer-view":195,"./form/form-view":197,"./save-metadata-dataset":199,backbone:"backbone","backbone/core-view":454,underscore:"underscore"}],194:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="25px" height="25px" viewBox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Group" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <path d="M16,13 L17,13 L17,5.5 C17,5.433 16.986,5.368 16.961,5.308 C16.936,5.247 16.899,5.192 16.853,5.146 L11.854,0.147 C11.808,0.101 11.753,0.064 11.692,0.039 C11.632,0.014 11.567,0 11.5,0 L0.5,0 C0.224,0 0,0.224 0,0.5 L0,21.5 C0,21.776 0.224,22 0.5,22 L9.5,22 L9.5,21 L1,21 L1,1 L11,1 L11,5.5 C11,5.776 11.224,6 11.5,6 L16,6 L16,13 L16,13 Z M12,1.707 L15.293,5 L12,5 L12,1.707 L12,1.707 Z" id="Shape" fill="#2E3C43"></path>\n              <path d="M23.854,14.646 L21.354,12.146 C21.166,11.958 20.834,11.958 20.647,12.146 L13.146,19.648 C13.089,19.705 13.054,19.773 13.03,19.845 C13.028,19.852 13.021,19.857 13.019,19.865 L12.019,23.365 C11.969,23.539 12.018,23.727 12.146,23.856 C12.241,23.951 12.369,24.002 12.5,24.002 C12.546,24.002 12.592,23.996 12.637,23.983 L16.137,22.983 C16.144,22.981 16.149,22.974 16.157,22.972 C16.229,22.948 16.297,22.913 16.354,22.856 L23.855,15.354 C24.05,15.158 24.05,14.842 23.854,14.646 L23.854,14.646 Z M16,21.795 L14.207,20.002 L19.001,15.207 L20.794,17 L16,21.795 L16,21.795 Z M13.747,20.957 L15.045,22.255 L13.228,22.775 L13.747,20.957 L13.747,20.957 Z M21.501,16.293 L19.708,14.5 L21.001,13.207 L22.794,15 L21.501,16.293 L21.501,16.293 Z" id="Shape" fill="#2E3C43"></path>\n          </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("components.modals.dataset-metadata.modal-title"))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">\n        '+(null==(__t=_t("components.modals.dataset-metadata.modal-desc"))?"":_.escape(__t))+'\n      </p>\n      <div class="Modal-listTextItem js-content"></div>\n      <div class="js-footer"></div>\n    </div>\n  </div>\n</div>\n';return __p}},{underscore:"underscore"}],195:[function(a,b,c){var d=a("backbone/core-view"),e=a("./footer.tpl");b.exports=d.extend({tagName:"ul",className:"Modal-listActions u-flex u-alignCenter ",events:{"click .js-save":"_save"},initialize:function(a){if(!a.visMetadataModel)throw new Error("visMetadataModel is required");if(!a.onSaveAction)throw new Error("onSaveAction is required");this._visMetadataModel=a.visMetadataModel,this._onSaveAction=a.onSaveAction,this._initBinds()},_initBinds:function(){this._visMetadataModel.on("change",this.render,this)},render:function(){return this.$el.html(e({canFinish:this._visMetadataModel.isValid()})),this},_save:function(){this._visMetadataModel.isValid()&&this._onSaveAction()}})},{"./footer.tpl":196,"backbone/core-view":454}],196:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li class="Modal-listActionsitem">\n  <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-close">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n      '+(null==(__t=_t("components.modals.dataset-metadata.cancel-btn"))?"":_.escape(__t))+'\n    </span>\n  </button>\n</li>\n<li class="Modal-listActionsitem">\n  <button class="CDB-Button CDB-Button--primary CDB-Button--big js-save '+(null==(__t=canFinish?"":"is-disabled")?"":_.escape(__t))+'">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase ">\n      '+(null==(__t=_t("components.modals.dataset-metadata.save-btn"))?"":_.escape(__t))+"\n    </span>\n  </button>\n</li>\n\n";return __p}},{underscore:"underscore"}],197:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("backbone/core-view"),g=a("./form.tpl");a("../../../form-components/index");var h=a("../../../tipsy-tooltip-view"),i=a("../../../../helpers/utils"),j=["visDefinitionModel","visMetadataModel","configModel"];b.exports=f.extend({className:"Metadata-form",initialize:function(a){if(d.each(j,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),void 0===a.isLocked)throw new TypeError("isLocked is required");this._isLocked=a.isLocked},render:function(){return this.clearSubViews(),this.$el.html(g()),this._initViews(),this},_initViews:function(){this._addNameView(),this._addDescriptionView(),this._addSourceView(),this._addAttributionView(),this._addLicenseView(),this._addTagsView(),this._addTooltip()},_addInputView:function(a,b,c,d,f){var g="_"+b,h=new e.Form.editors.Text({key:a,model:this._visMetadataModel,schema:{options:this._visDefinitionModel.get(a),editorAttrs:{placeholder:c,disabled:f||!1}}});h.on("change",this._commitView,this),this[g]=h,d.append(h.render().$el)},_addNameView:function(){this._addInputView("name","nameInput",_t("components.modals.dataset-metadata.form.name-placeholder"),this.$(".js-name-field"),this._isLocked)},_addSourceView:function(){this._addInputView("source","sourceInput",_t("components.modals.dataset-metadata.form.source-placeholder"),this.$(".js-source-field"))},_addAttributionView:function(){this._addInputView("attributions","attributionInput",_t("components.modals.dataset-metadata.form.attributions-placeholder"),this.$(".js-attributions-field"))},_buildLicenseOptions:function(){var a=this._configModel.get("licenses"),b=[{id:"",name:"-"}];return d.chain(b.concat(a)).compact().map(function(a){return{val:a.id,label:a.name}}).value()},_addLicenseView:function(){var a=this._buildLicenseOptions();this._selectView=new e.Form.editors.Select({className:"u-flex u-alignCenter",key:"license",schema:{options:a},model:this._visMetadataModel,showSearch:!1}),this._selectView.on("change",this._commitView,this),this._selectView.setValue(this._visMetadataModel.get("license")||0),this.$(".js-license-field").append(this._selectView.render().$el)},_addDescriptionView:function(){this._descriptionView=new e.Form.editors.TextArea({className:"CDB-Textarea Metadata-textarea",key:"description",model:this._visMetadataModel,schema:{options:this._visDefinitionModel.get("description"),editorAttrs:{placeholder:_t("components.modals.dataset-metadata.form.description-placeholder")}}}),this._descriptionView.on("change",this._commitView,this),this.$(".js-description-field").append(this._descriptionView.render().$el)},_addTagsView:function(){this._taglistView=new e.Form.editors.Taglist({key:"tags",model:this._visMetadataModel,schema:{options:{tags:this._visDefinitionModel.get("tags")||[]}}}),this._taglistView.on("change",this._commitView,this),this.$(".js-tags-field").append(this._taglistView.render().$el),this.addView(this._taglistView)},_addTooltip:function(){var a=this.$(".js-markdown").data("tooltip");this._removeTooltip(),this._tooltip=new h({el:this.$(".js-markdown"),html:!0,title:function(){return a}})},_commitView:function(a){a.commit(),a.model.changed.hasOwnProperty("name")&&this._sanitizeName(a.model.get("name"))},_sanitizeName:function(a){this._visMetadataModel.set("name",i.sanitizeHtml(a))},_removeTooltip:function(){this._tooltip&&this._tooltip.clean()},_removeBinds:function(){this._nameView&&this._nameView.off("change",this._commitView,this),this._descriptionView&&this._descriptionView.off("change",this._commitView,this),this._taglistView&&this._taglistView.off("change",this._commitView,this),this._sourceInput&&this._sourceInput.off("change",this._commitView,this),this._attributionView&&this._attributionView.off("change",this._commitView,this),this._selectView&&this._selectView.off("change",this._commitView,this)},clean:function(){this._removeBinds(),f.prototype.clean.call(this)}})},{"../../../../helpers/utils":435,"../../../form-components/index":178,"../../../tipsy-tooltip-view":325,"./form.tpl":198,backbone:"backbone","backbone/core-view":454,underscore:"underscore"}],198:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-tSpace-xl CDB-Text u-flex js-name-field">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.dataset-metadata.form.name"))?"":_.escape(__t))+'</label>\n</div>\n\n<div class="u-tSpace-xl CDB-Text u-flex">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.dataset-metadata.form.description"))?"":_.escape(__t))+'</label>\n  <div class="u-grow">\n    <div class="js-description-field u-bSpace"></div>\n    <div class="Markdown">\n      <span class="Markdown-tooltip js-markdown" data-tooltip="<em>_italics_</em><br/><b>*bold*</b><br/>[link](http://link.com)">\n        <span class="Markdown-icon">\n          <i class="Markdown-icon-text">M</i>\n          <i class="Markdown-icon-char"></i>\n        </span>\n        '+(null==(__t=_t("components.modals.dataset-metadata.form.markdown"))?"":_.escape(__t))+'\n      </span>\n    </div>\n  </div>\n</div>\n\n<div class="u-tSpace-xl CDB-Text u-flex">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.dataset-metadata.form.source"))?"":_.escape(__t))+'</label>\n  <div class="u-grow">\n    <div class="js-source-field u-bSpace"></div>\n  </div>\n</div>\n\n<div class="u-tSpace-xl CDB-Text u-flex">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.dataset-metadata.form.attributions"))?"":_.escape(__t))+'</label>\n  <div class="u-grow">\n    <div class="js-attributions-field u-bSpace"></div>\n  </div>\n</div>\n\n<div class="u-tSpace-xl CDB-Text u-flex">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.dataset-metadata.form.license"))?"":_.escape(__t))+'</label>\n  <div class="u-grow">\n    <div class="js-license-field u-bSpace Metadata-select"></div>\n  </div>\n</div>\n\n<div class="u-tSpace-xl CDB-Text u-flex u-alignCenter js-tags-field">\n  <label class="Metadata-label CDB-Text CDB-Size-medium is-semibold u-upperCase u-ellipsis">'+(null==(__t=_t("components.modals.dataset-metadata.form.tags"))?"":_.escape(__t))+"</label>\n</div>";return __p}},{underscore:"underscore"}],199:[function(a,b,c){var d=a("../visualization-title-suffix-metadata");b.exports=function(a){if(!a.visDefinitionModel)throw new Error("visDefinitionModel is required");if(!a.name)throw new Error("name is required");var b=a.visDefinitionModel,c=a.onSuccess,e=a.onError,f=a.name,g=a.description,h=a.tags,i=a.source,j=a.license,k=a.attributions,l=b.get("name");b.save({name:f,description:g,tags:h,source:i,license:j,attributions:k},{wait:!0,success:function(a,b){document.title=f+d,c&&c()},error:function(a,b){document.title=l+d,e&&e(b)}})}},{"../visualization-title-suffix-metadata":241}],200:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("../../loading/render-loading"),g=a("../../error/error-view"),h=a("./modal-export-data.tpl"),i=1e3,j="SELECT * FROM (%%sql%%) as subq ",k=[{format:"csv",fetcher:"fetchCSV",geomRequired:!1},{format:"shp",fetcher:"fetch",geomRequired:!0},{format:"kml",fetcher:"fetch",geomRequired:!0},{format:"geojson",label:"geo json",fetcher:"fetch",geomRequired:!0},{format:"svg",fetcher:"fetchSVG",geomRequired:!0}];b.exports=e.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_close"},options:{autoClose:!0},initialize:function(a){if(!a.fileName)throw new Error("name is required");if(!a.configModel)throw new Error("configModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.modalModel)throw new Error("modalModel is required");this._configModel=a.configModel,this._fileName=a.fileName,this._queryGeometryModel=a.queryGeometryModel,this._modalModel=a.modalModel,this._initBinds(),"unfetched"===this._queryGeometryModel.get("status")&&this._queryGeometryModel.fetch()},render:function(){var a=this._queryGeometryModel.get("simple_geom");return"fetched"===this._queryGeometryModel.get("status")||"unavailable"===this._queryGeometryModel.get("status")?this.$el.html(h({formats:k,url:this._configModel.getSqlApiUrl(),isGeoreferenced:!!a})):this._renderLoadingContent(_t("components.modals.export-data.loading.geometry")),this},_initBinds:function(){this._queryGeometryModel.bind("change:status",function(){"unavailable"!==this._queryGeometryModel.get("status")?this.render():this.showError(_t("components.modals.export-data.error.geometry-error"))},this),this.add_related_model(this._queryGeometryModel)},_getFormat:function(a){for(var b in k)if(k[b].format===a)return k[b]},_onConfirm:function(){this._form=this.$(".js-form");var a=d(".js-format[name=format]:checked",this._form).data("format"),b=this._getFormat(a);this[b.fetcher](a)},getBaseOptions:function(){return{filename:this._fileName,apiKey:this._configModel.get("api_key")}},getGeomFilteredSql:function(){var a=this._queryGeometryModel.get("query"),b=this._queryGeometryModel.get("simple_geom");return b?j.replace(/%%sql%%/g,a):a},_fetch:function(a,b){this.$(".js-format").val(a.format),this.$(".js-q").val(b),this.$(".js-filename").val(a.filename),this.$(".js-apiKey").val(a.apiKey);var c=["the_geom_webmercator"];if("csv"!==a.format&&c.push("the_geom"),this.$(".js-skipfields").val(c.join(",")),b.length<i){var d=this.$(".js-form").attr("action")+"?"+this.$(".js-form").serialize();this._fetchGET(d)}else this.submit();this.$(".js-skipfields").attr("disabled","disabled"),this.options.autoClose?this._close():this._renderLoadingContent(_t("components.modals.export-data.loading.preparing"))},showError:function(a){var b=new g({title:_t("hello"),desc:a});this.$el.html(b.render().el),this.addView(b)},_fetchGET:function(a){function b(a){var b=null;try{var c=JSON.parse(a);b=c.error[0]}catch(c){a&&a.indexOf("error")!==-1&&(b=_t("components.modals.export-data.error.unknown"))}return b}var c,d=this,e=window.open(a);e.onload=function(){clearInterval(c);var a=b(e.document.body.textContent);a?d.showError(a):d._close(),e.close()},window.focus(),c=setInterval(function(){(e.closed||e.document&&0===e.document.body.textContent.length)&&(d._close(),clearInterval(c))},100)},fetch:function(a){var b=this.getBaseOptions();b.format=a;var c=this._queryGeometryModel.get("query");this._fetch(b,c)},fetchCSV:function(){var a=this.getBaseOptions();a.format="csv";var b=this.getGeomFilteredSql();this.$(".js-skipfields").removeAttr("disabled"),this._fetch(a,b)},fetchSVG:function(){this.fetch("svg")},submit:function(){this.$(".js-form").submit()},_renderLoadingContent:function(a){this.$el.html(f({title:a}))},_close:function(){this._modalModel.destroy()}})},{"../../error/error-view":37,"../../loading/render-loading":187,"./modal-export-data.tpl":201,"backbone/core-view":454,jquery:"jquery"}],201:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="24px" viewbox="459 348 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Export-dataset" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(459.000000, 348.000000)">\n          <path d="M1,1 L11,1 L11,5.5 C11,5.776 11.224,6 11.5,6 L16,6 L16,9.5 L17,9.5 L17,5.502 C17,5.502 17,5.502 17,5.501 C17,5.5 17,5.501 17,5.5 C17,5.447 16.985,5.398 16.97,5.35 C16.966,5.337 16.967,5.323 16.962,5.311 C16.936,5.247 16.896,5.19 16.847,5.142 L11.854,0.147 C11.808,0.101 11.753,0.064 11.692,0.039 C11.632,0.014 11.567,0 11.5,0 L0.5,0 C0.224,0 0,0.224 0,0.5 L0,21.5 C0,21.776 0.224,22 0.5,22 L10.5,22 L10.5,21 L1,21 L1,1 L1,1 Z M12,1.708 L15.291,5 L12,5 L12,1.708 L12,1.708 Z" id="Shape" fill="#2E3C43"/>\n          <path d="M17.5,11 C13.916,11 11,13.916 11,17.5 C11,21.084 13.916,24 17.5,24 C21.084,24 24,21.084 24,17.5 C24,13.916 21.084,11 17.5,11 L17.5,11 Z M17.5,23 C14.467,23 12,20.533 12,17.5 C12,14.467 14.467,12 17.5,12 C20.533,12 23,14.467 23,17.5 C23,20.533 20.533,23 17.5,23 L17.5,23 Z" id="Shape" fill="#2E3C43"/>\n          <path d="M17.858,14.425 C17.767,14.331 17.641,14.272 17.5,14.272 C17.359,14.272 17.232,14.331 17.142,14.425 L14.965,16.602 C14.77,16.797 14.77,17.114 14.965,17.309 C15.16,17.504 15.477,17.504 15.672,17.309 L17,15.981 L17,20.226 C17,20.502 17.224,20.726 17.5,20.726 C17.776,20.726 18,20.502 18,20.226 L18,15.981 L19.328,17.309 C19.426,17.407 19.554,17.455 19.682,17.455 C19.81,17.455 19.938,17.406 20.036,17.309 C20.231,17.114 20.231,16.797 20.036,16.602 L17.858,14.425 L17.858,14.425 Z" id="Shape" fill="#2E3C43" transform="translate(17.500500, 17.499000) scale(1, -1) translate(-17.500500, -17.499000) "/>\n        </g>\n      </svg>\n    </div>\n\n    <div>\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace--xl">'+(null==(__t=_t("components.modals.export-data.title"))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("components.modals.export-data.desc"))?"":_.escape(__t))+".</p>\n      ",isGeoreferenced||(__p+='\n        <p class="CDB-Text CDB-Size-large u-altTextColor u-tSpace-xl">'+(null==(__t=_t("components.modals.export-data.no-geometry"))?"":_.escape(__t))+"</p>\n      "),__p+='\n\n      <div class="Modal-listTextItem u-flex u-alignCenter">\n        <h3 class="CDB-Text CDB-Size-medium is-semibold u-upperCase">Select format</h3>\n\n        <form class="js-form" method="POST" action="'+(null==(__t=url)?"":_.escape(__t))+'">\n          <input type="hidden" class="js-filename" name="filename" />\n          <input type="hidden" class="js-q" name="q" />\n          <input type="hidden" class="js-apiKey" name="api_key" />\n          <input type="hidden" class="js-skipfields" name="skipfields" disabled="disabled" value="" />\n          <input type="hidden" class="js-dp" name="dp" value="4" disabled="disabled" />\n\n          <ul class="Modal-listForm u-flex u-alignCenter CDB-Text CDB-Size-medium">\n            ',_.each(formats,function(a){__p+='\n            <li class="Modal-listFormItem\n              ',isGeoreferenced===!1&&a.geomRequired===!0&&(__p+="\n                is-disabled\n              "),__p+='"\n            >\n              <input class="CDB-Radio js-format" type="radio" name="format" data-format="'+(null==(__t=a.format)?"":_.escape(__t))+'"\n                ',isGeoreferenced===!1&&a.geomRequired===!0&&(__p+="\n                  disabled\n                "),__p+="\n\n                ","csv"===a.format&&(__p+="\n                  checked\n                "),__p+='\n              >\n              <span class="u-iBlock CDB-Radio-face"></span>\n              <label class="u-iBlock u-lSpace u-upperCase">'+(null==(__t=a.label||a.format)?"":_.escape(__t))+"</label>\n            </li>\n            "}),__p+='\n          </ul>\n        </form>\n\n      </div>\n\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.export-data.cancel"))?"":_.escape(__t))+'</span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.export-data.download"))?"":_.escape(__t))+"</span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],202:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=d.Model.extend({defaults:{show:!0,createContentView:function(){return new e}},createContentView:function(){return this.get("createContentView")(this)},show:function(){this.set("show",!0)},hide:function(){this.set("show",!1)},isHidden:function(){return!this.get("show")},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone","backbone/core-view":454}],203:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./modal.tpl"),g=120;b.exports=e.extend({className:function(){return this.options.escapeOptionsDisabled?"Dialog is-white":"Dialog is-opening is-white"},events:{"click .js-close":"_onClose"},initialize:function(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy),this._escapeOptionsDisabled=this.options.escapeOptionsDisabled},render:function(){this.clearSubViews(),this.$el.html(f({escapeOptionsDisabled:this.options.escapeOptionsDisabled||!1}));var a=this.model.createContentView();return this.addView(a),a.render(),this.$(".js-content").append(a.el),this},show:function(){this.model.show()},hide:function(){this.model.hide()},destroy:function(){this.model.destroy()},_onShowChange:function(a,b){b?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this._delayDueToAnimation(function(){this.$el.hide()}))},_onClose:function(a){a.stopPropagation(),this.destroy()},_onDestroy:function(){this.hide(),d.invoke(this._subviews,"allOff"),this._delayDueToAnimation(function(){this.clean()})},_delayDueToAnimation:function(a){setTimeout(a.bind(this),g)}})},{"./modal.tpl":204,"backbone/core-view":454,underscore:"underscore"}],204:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",escapeOptionsDisabled||(__p+='\n  <button class="CDB-Shape js-close Dialog-closeBtn">\n    <div class="CDB-Shape-close is-blue is-huge"></div>\n  </button>\n'),__p+='\n<div class="Dialog-contentWrapper js-content"></div>\n';return __p}},{underscore:"underscore"}],205:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./modal-view"),g=a("./modal-view-model"),h="destroyedModal";b.exports=e.Model.extend({create:function(a,b){if(!d.isFunction(a))throw new Error("createContentView is required");return b&&(this._escapeOptionsDisabled=b),this._modalView||(this.trigger("willCreateModal"),this._modalView=this._newModalView(),this.trigger("didCreateModal",this._modalView),document.body.appendChild(this._modalView.el)),this._modalView.model.set("createContentView",a),this._modalView.render(),this._modalView},onDestroyOnce:function(a,b){this.once(h,a,b)},destroy:function(){this._modalView&&this._modalView.model.destroy()},_newModalView:function(){var a=this,b=new g;return this._handleBodyClass(b),this._escapeOptionsDisabled||this._destroyOnEsc(b),this.listenToOnce(b,"destroy",function(){this._modalView=null,this.trigger.apply(this,[h].concat(Array.prototype.slice.call(arguments))),this.stopListening(b)}),new f({model:b,escapeOptionsDisabled:a._escapeOptionsDisabled})},_destroyOnEsc:function(a){var b=function(b){27===b.keyCode&&(b.stopPropagation(),a.destroy())};document.addEventListener("keydown",b),this.listenToOnce(a,"destroy",function(){document.removeEventListener("keydown",b)})},_handleBodyClass:function(a){var b="is-inDialog";document.body.classList.add(b),this.set("open",!0),this.listenTo(a,"change:show",function(a,c){document.body.classList[c?"add":"remove"](b),this.set("open",c)}),this.listenToOnce(a,"destroy",function(){document.body.classList.remove(b),this.set("open",!1)})},isOpen:function(){return this.get("open")===!0}})},{"./modal-view":203,"./modal-view-model":202,backbone:"backbone",underscore:"underscore"}],206:[function(a,b,c){var d=a("underscore"),e=[{privacy:"PUBLIC",title:_t("components.modals.publish.privacy.public.title"),desc:_t("components.modals.publish.privacy.public.body"),alwaysEnabled:!0,cssClass:"green"},{privacy:"LINK",title:_t("components.modals.publish.privacy.link.title"),desc:_t("components.modals.publish.privacy.link.body"),cssClass:"orange"},{privacy:"PASSWORD",title:_t("components.modals.publish.privacy.password.title"),desc:_t("components.modals.publish.privacy.password.body"),cssClass:"orange-dark"},{privacy:"PRIVATE",title:_t("components.modals.publish.privacy.private.title"),desc:_t("components.modals.publish.privacy.private.body"),cssClass:"red"}];b.exports=function(a,b){var c=a.isVisualization(),f=b.get("actions"),g=f[c?"private_maps":"private_tables"],h=a.get("privacy"),i=a.privacyOptions();return d.chain(e).filter(function(a){return d.contains(i,a.privacy)}).map(function(a){return d.defaults({selected:a.privacy===h,disabled:!(a.alwaysEnabled||g)},a)}).value()}},{underscore:"underscore"}],207:[function(a,b,c){var d=a("backbone"),e=a("./privacy-model"),f=a("./privacy-password-model");b.exports=d.Collection.extend({model:function(a,b){return"PASSWORD"===a.privacy?new f(a,b):new e(a,b)},initialize:function(){this.bind("change:selected",this._deselectLastSelected,this)},searchByPrivacy:function(a){return this.findWhere({privacy:a})},selectedOption:function(){return this.find(function(a){return a.get("selected")})},passwordOption:function(){return this.find(function(a){return"PASSWORD"===a.get("privacy")})},_deselectLastSelected:function(a,b){b&&this.each(function(b){b!==a&&b.set({selected:!1})})}})},{"./privacy-model":208,"./privacy-password-model":209,backbone:"backbone"}],208:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{privacy:"PUBLIC",disabled:!1,selected:!1,password:void 0},validate:function(a){if(a.disabled&&a.selected)return"Option can not be disabled and selected at the same time"},classNames:function(){return e.chain(["disabled","selected"]).map(function(a){return void 0!==this.attributes[a]?"is-"+a:void 0},this).compact().value().join(" ")},canSave:function(){return!this.get("disabled")},isPassword:function(){return!1},isSelected:function(){return this.get("selected")===!0},saveToVis:function(a,b){return a.save(this._attrsToSave(),e.extend({wait:!0},b))},_attrsToSave:function(){return e.pick(this.attributes,"privacy","password")}})},{backbone:"backbone",underscore:"underscore"}],209:[function(a,b,c){var d=a("underscore"),e=a("./privacy-model"),f="!@#!@#";b.exports=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.set("password",f)},_attrsToSave:function(){var a=e.prototype._attrsToSave.call(this);return a.password===f&&delete a.password,a},canSave:function(){return!this.get("disabled")&&!d.isEmpty(this.get("password"))},isPassword:function(){return!0}})},{"./privacy-model":208,underscore:"underscore"}],210:[function(a,b,c){var d=a("jquery"),e=a("moment"),f=a("backbone"),g=a("backbone/core-view"),h=a("underscore"),i=a("./publish-button.tpl"),j=["visDefinitionModel","mapcapsCollection","configModel"];b.exports=g.extend({events:{"click .js-button":"_onUpdate"},initialize:function(a){h.each(j,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this.model=new f.Model({status:"idle"}),this._initBinds()},render:function(){var a=this._mapcapsCollection.length>0?_t("components.modals.publish.share.last-published",{date:"updated"===this.model.get("status")?e(this._mapcapsCollection.first().get("created_at")).fromNow():e(this._mapcapsCollection.first().get("created_at")).format("Do MMMM YYYY, HH:mm")
}):_t("components.modals.publish.share.unpublished");return this.clearSubViews(),this.$el.html(i({isPublished:this._mapcapsCollection.length>0,isLoading:this._isLoading(),isDisabled:this._isDisabled(),publishedOn:a})),this},_initBinds:function(){this._mapcapsCollection.on("reset",this.render,this),this.add_related_model(this._mapcapsCollection),this.model.on("change:status",this.render,this)},_isLoading:function(){return"loading"===this.model.get("status")},_isDisabled:function(){return"updated"===this.model.get("status")},_onUpdate:function(){var a=this,b=this._visDefinitionModel.mapcapsURL(),c={api_key:this._configModel.get("api_key")};return!this._isDisabled()&&(a.model.set({status:"loading"}),void d.post(b,c).done(function(b){a._visDefinitionModel.set("visChanges",0),a._mapcapsCollection.add(b,{at:0}),a.model.set({status:"updated"})}).fail(function(){a.model.set({status:"error"})}))}})},{"./publish-button.tpl":211,backbone:"backbone","backbone/core-view":454,jquery:"jquery",moment:"moment",underscore:"underscore"}],211:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="Publish-modalButton CDB-Button CDB-Button--primary CDB-Button--small u-rSpace js-button ',isDisabled&&(__p+="is-disabled"),__p+='">\n  <div class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase u-flex">\n    ',isLoading?(__p+='\n      <div class="CDB-LoaderIcon CDB-LoaderIcon--small u-iBlock">\n        <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n          <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n        </svg>\n      </div>\n      ',__p+=isPublished?"\n      "+(null==(__t=_t("components.modals.publish.updating-btn"))?"":_.escape(__t))+"\n      ":"\n      "+(null==(__t=_t("components.modals.publish.publishing-btn"))?"":_.escape(__t))+"\n      ",__p+="\n    "):(__p+="\n      ",__p+=isPublished?"\n      "+(null==(__t=_t("components.modals.publish.update-btn"))?"":_.escape(__t))+"\n      ":"\n      "+(null==(__t=_t("components.modals.publish.publish-btn"))?"":_.escape(__t))+"\n      ",__p+="\n    "),__p+="\n  </div>\n</button> "+(null==(__t=publishedOn)?"":_.escape(__t));return __p}},{underscore:"underscore"}],212:[function(a,b,c){var d=a("underscore"),e=a("moment"),f=a("backbone/core-view"),g=a("./publish.tpl"),h=a("./tab-pane-submenu.tpl"),i=a("../../tab-pane/create-text-labels-tab-pane"),j=a("./publish/publish-view"),k=a("./share/share-view"),l=a("../../privacy-dropdown/privacy-dropdown-view"),m=a("./publish-button-view"),n=a("./share-with-view"),o=a("./upgrade-view"),p=["modalModel","visDefinitionModel","privacyCollection","userModel","configModel"],q="full",r="share",s="publish";b.exports=f.extend({className:"Publish-modal",events:{"click .js-done":"_onDone"},initialize:function(a){d.each(p,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._mapcapsCollection=a.mapcapsCollection,this.mode=a.mode||q},render:function(){return this.clearSubViews(),this.$el.html(g({name:this._visDefinitionModel.get("name"),isSimple:!this._hasTabs(),hasShareStats:this._hasShareStats()})),this._initViews(),this.mode===q?this._hasOrganization()?this._initTabsViews():this._makePublishView():this.mode===r?this._makeShareView():this.mode===s&&this._makePublishView(),this},_hasShareStats:function(){return this.mode!==s&&this._hasOrganization()},_hasOrganization:function(){return this._userModel.isInsideOrg()},_hasTabs:function(){var a=this._hasOrganization();return a&&this.mode===q},_makePublishView:function(){var a=this._createPublishView();this.$(".js-panes").append(a.render().el),this.addView(a)},_makeShareView:function(){var a=this._createShareView();this.$(".js-panes").append(a.render().el),this.addView(a)},_initViews:function(){var a,b,c,d,f;a=new l({privacyCollection:this._privacyCollection,visDefinitionModel:this._visDefinitionModel,userModel:this._userModel,configModel:this._configModel}),this.$(".js-dropdown").append(a.render().el),this.addView(a),void 0!==this._mapcapsCollection?(b=new m({visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,configModel:this._configModel}),this.$(".js-update").append(b.render().el),this.addView(b)):(f=_t("components.modals.publish.share.last-published",{date:e(this._visDefinitionModel.get("updated_at")).format("Do MMMM YYYY, HH:mm")}),this.$(".js-update").html(f)),this._hasShareStats()&&(c=new n({visDefinitionModel:this._visDefinitionModel,userModel:this._userModel,avatarClass:"Share-user--big",separationClass:"u-rSpace--xl"}),this.$(".js-share-users").append(c.render().el),this.addView(c)),this._hasOrganization()||(d=new o,this.$(".js-upgrade").append(d.render().el),this.addView(d))},_initTabsViews:function(){var a=this,b=[{name:"share",label:_t("components.modals.publish.menu.share"),createContentView:a._createShareView.bind(a)},{name:"publish",label:_t("components.modals.publish.menu.publish"),createContentView:a._createPublishView.bind(a)}],c={tabPaneOptions:{template:h,tabPaneItemOptions:{tagName:"li",className:"CDB-NavSubmenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavSubmenu-link u-upperCase Publish-modalLink"}};this._layerTabPaneView=i(b,c),this.$(".js-panes").append(this._layerTabPaneView.render().$el),this.addView(this._layerTabPaneView)},_createShareView:function(){return new k({className:"Share-wrapper",currentUserId:this._userModel.id,visDefinitionModel:this._visDefinitionModel,organization:this._userModel._organizationModel,configModel:this._configModel})},_createPublishView:function(){return new j({visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,userModel:this._userModel})},_onDone:function(){this._modalModel.destroy()}})},{"../../privacy-dropdown/privacy-dropdown-view":268,"../../tab-pane/create-text-labels-tab-pane":276,"./publish-button-view":210,"./publish.tpl":213,"./publish/publish-view":217,"./share-with-view":223,"./share/share-view":228,"./tab-pane-submenu.tpl":234,"./upgrade-view":235,"backbone/core-view":454,moment:"moment",underscore:"underscore"}],213:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Publish-modalHeader">\n  <div class="u-inner">\n    <div class="CDB-Text CDB-Size-huge is-light u-ellipsis u-bSpace--m">'+(null==(__t=name)?"":_.escape(__t))+'</div>\n    <ul class="u-flex u-alignCenter">\n      <li class="js-dropdown u-rSpace--xl"></li>\n      ',hasShareStats&&(__p+='\n      <li class="js-share-users">\n      </li>\n      '),__p+='\n      <li class="CDB-Text CDB-Size-medium u-altTextColor js-update">\n      </li>\n  </div>\n</div>\n\n<div class="Publish-modalBody js-panes\n',isSimple&&(__p+="is-simple"),__p+='\n">\n  ',isSimple&&(__p+='\n    <div class="Publish-modalShadow"></div>\n  '),__p+='\n\n</div>\n\n<div class="Dialog-footer Dialog-footer--expanded CreateDialog-footer Publish-modalFooter">\n  <div>\n    <div class="CreateDialog-footerShadow"></div>\n    <div class="CreateDialog-footerLine"></div>\n    <div class="CreateDialog-footerInner ">\n      <div class="CreateDialog-footerInfo"></div>\n      <div class="CreateDialog-footerActions js-footerActions u-flex u-justifySpace u-grow">\n        <div class="js-upgrade"></div>\n        <button class="CDB-Button CDB-Button--secondary js-done">\n          <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">'+(null==(__t=_t("components.modals.publish.done-btn"))?"":_.escape(__t))+"</span>\n        </button>\n      </div>\n    </div>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],214:[function(a,b,c){var d=a("./icon-link.tpl"),e=a("./icon-embed.tpl");b.exports=function(a){return[{createIcon:function(){return d()},type:"get-link",content:a.embedURL(),private:"PRIVATE"===a.get("privacy")},{createIcon:function(){return e()},type:"embed",content:'<iframe width="100%" height="520" frameborder="0" src="'+encodeURI(a.embedURL())+'" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>',url:encodeURI(a.embedURL()),private:"PRIVATE"===a.get("privacy")}]}},{"./icon-embed.tpl":215,"./icon-link.tpl":216}],215:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<svg width="25px" height="25px" viewBox="682 469 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <path d="M697.141667,478.48556 C695.774797,477.117815 695.774797,474.90231 697.141553,473.535553 L697.495051,473.182056 L697.141609,472.828502 L693.960609,469.646502 L693.607124,469.292907 L693.253515,469.646378 L690.685515,472.213378 L691.039,472.567 L691.469343,472.312431 C691.271611,471.978171 691.043454,471.678347 690.778553,471.413447 C689.020272,469.655166 686.171603,469.655166 684.414333,471.41356 C682.657184,473.170709 682.657184,476.020291 684.414447,477.777553 C684.682252,478.044267 684.982655,478.273359 685.314094,478.468734 L685.568,478.038 L685.214447,477.684447 L682.646447,480.252447 L682.292893,480.606 L682.646447,480.959553 L685.828447,484.141553 L686.181887,484.494994 L686.53544,484.141667 C687.903185,482.774797 690.11869,482.774797 691.485447,484.141553 C692.852184,485.508291 692.852184,487.724709 691.485447,489.091447 L691.131893,489.445 L691.485447,489.798553 L694.667447,492.980553 L695.021,493.334107 L695.374553,492.980553 L697.941553,490.413553 L697.588,490.06 L697.157928,490.315025 C697.3561,490.649221 697.584149,490.948256 697.849447,491.213553 C699.60664,492.971872 702.456485,492.971872 704.21278,491.213327 C705.970872,489.45636 705.970872,486.606515 704.212327,484.85022 C703.948015,484.584823 703.647051,484.355236 703.312906,484.158266 L703.059,484.589 L703.412553,484.942553 L705.979553,482.375553 L706.333107,482.022 L705.979553,481.668447 L702.797553,478.486447 L702.444,478.132893 L702.090447,478.486447 C700.725536,479.851357 698.508943,479.851087 697.141327,478.48522 L697.141667,478.48556 Z M696.434673,479.19278 C698.192747,480.948604 701.042155,480.948952 702.797553,479.193553 L702.090447,479.193553 L705.272447,482.375553 L705.272447,481.668447 L702.705447,484.235447 L702.248976,484.691917 L702.805094,485.019734 C703.068228,485.174844 703.301587,485.35286 703.504724,485.55683 C704.873128,486.923485 704.873128,489.13964 703.50556,490.506333 C702.139515,491.874128 699.92336,491.874128 698.556667,490.50656 C698.35252,490.302414 698.175052,490.069704 698.018072,489.804975 L697.689693,489.2512 L697.234447,489.706447 L694.667447,492.273447 L695.374553,492.273447 L692.192553,489.091447 L692.192553,489.798553 C693.949816,488.041291 693.949816,485.191709 692.192553,483.434447 C690.43531,481.677203 687.586815,481.677203 685.82856,483.434333 L686.535553,483.434447 L683.353553,480.252447 L683.353553,480.959553 L685.921553,478.391553 L686.378024,477.935083 L685.821906,477.607266 C685.560783,477.453341 685.327004,477.275057 685.12083,477.069724 C683.754816,475.703709 683.754816,473.487291 685.121553,472.120553 C686.488397,470.752834 688.703728,470.752834 690.071447,472.120553 C690.274695,472.323801 690.452152,472.557 690.608657,472.821569 L690.936742,473.376188 L691.392485,472.920622 L693.960485,470.353622 L693.253391,470.353498 L696.434391,473.535498 L696.434447,472.828447 C694.677203,474.58569 694.677203,477.434185 696.434333,479.19244 L696.434673,479.19278 Z" id="Embed-it" stroke="none" fill="#AAAAAA" fill-rule="evenodd"></path>\n</svg>';return __p}},{underscore:"underscore"}],216:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='  <svg width="23px" height="23px" viewBox="683 470 23 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <path d="M696.399947,482.106803 L696.485947,482.192803 C697.462209,483.169066 699.044791,483.169066 700.021053,482.192803 L703.986009,478.228848 C705.34724,476.86645 705.34724,474.642218 703.986356,473.279 L702.227953,471.521596 C700.866908,470.159384 698.640092,470.159384 697.278795,471.521848 L693.313991,475.485652 C692.337722,476.461921 692.337722,478.044329 693.31372,479.021577 L693.40202,479.108865 L694.10498,478.397635 L694.01898,478.312635 C693.435278,477.728171 693.435278,476.778579 694.021053,476.192803 L697.986009,472.228848 C698.956908,471.257116 700.550092,471.257116 701.520795,472.228652 L703.279047,473.985904 C704.24976,474.958282 704.24976,476.55005 703.278795,477.521848 L699.313991,481.485652 C698.728209,482.071434 697.778791,482.071434 697.193053,481.485697 L697.107053,481.399697 L696.399947,482.106803 L696.399947,482.106803 Z M692.10498,480.397635 L692.01898,480.312635 C691.044791,479.338434 689.462209,479.338434 688.485947,480.314697 L684.520991,484.278652 C683.159735,485.641076 683.159735,487.866424 684.520795,489.228652 L686.279047,490.985904 C687.640092,492.348116 689.866908,492.348116 691.228205,490.985652 L695.193009,487.021848 C696.169278,486.045579 696.169278,484.463171 695.19328,483.485923 L695.107053,483.399697 L694.399947,484.106803 L694.485947,484.192803 C695.071722,484.779329 695.071722,485.728921 694.485947,486.314697 L690.520991,490.278652 C689.550092,491.250384 687.956908,491.250384 686.986205,490.278848 L685.227953,488.521596 C684.257265,487.550076 684.257265,485.957424 685.228205,484.985652 L689.193009,481.021848 C689.778791,480.436066 690.728209,480.436066 691.313947,481.021803 L691.40202,481.108865 L692.10498,480.397635 L692.10498,480.397635 Z M690.718053,485.495803 L698.496053,477.717803 L697.788947,477.010697 L690.010947,484.788697 L690.718053,485.495803 L690.718053,485.495803 Z" id="Get-link" stroke="none" fill="#AAAAAA" fill-rule="evenodd"></path>\n  </svg>';return __p}},{underscore:"underscore"}],217:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./create-share-options"),g=a("./share-collection"),h=a("./share-item-view"),i=a("./publish.tpl"),j=["visDefinitionModel","mapcapsCollection","userModel"];b.exports=e.extend({className:"Publish-modalShare u-inner",initialize:function(a){d.each(j,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this.hasOrganization=this._userModel.isInsideOrg();var b=f(this._visDefinitionModel);this._shareCollection=new g(b),this._initBinds()},render:function(){var a=this._mapcapsCollection.length>0;return this.clearSubViews(),this.$el.html(i({isPublished:a})),this._initViews(),this},_initViews:function(){var a=this._renderItemView.bind(this);this._shareCollection.each(a)},_renderItemView:function(a){var b=this,c=this._mapcapsCollection.length>0,d=new h({model:a,isPublished:c,hasOrganization:b.hasOrganization});this.$(".js-list").append(d.render().el),this.addView(d)},_revampPrivacyOptions:function(){var a=f(this._visDefinitionModel);this._shareCollection.reset(a)},_initBinds:function(){this._visDefinitionModel.on("sync",this._revampPrivacyOptions,this),this.add_related_model(this._visDefinitionModel),this._shareCollection.on("reset",this.render,this),this.add_related_model(this._shareCollection),this._mapcapsCollection.on("reset add",this.render,this),this.add_related_model(this._mapcapsCollection)}})},{"./create-share-options":214,"./publish.tpl":218,"./share-collection":219,"./share-item-view":220,"backbone/core-view":454,underscore:"underscore"}],218:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="Publish-optionsList u-flex u-justifySpace js-list"></ul>\n',isPublished||(__p+='\n<div class="Share-info">\n  <div>\n    <h2 class="CDB-Text CDB-Size-large u-secondaryTextColor u-bSpace is-light">'+(null==(__t=_t("components.modals.publish.share.unpublished-header"))?"":_.escape(__t))+'</h2>\n    <p class="CDB-Text CDB-Size-medium is-light">'+(null==(__t=_t("components.modals.publish.share.unpublished-subheader"))?"":_.escape(__t))+"</p>\n  </div>\n</div>\n"),__p+="\n";return __p}},{underscore:"underscore"}],219:[function(a,b,c){var d=a("backbone"),e=a("./share-model");b.exports=d.Collection.extend({model:e})},{"./share-model":222,backbone:"backbone"}],220:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("clipboard"),g=a("./share-item.tpl"),h=a("../../../../helpers/browser-detect"),i=d.template("<span class='CDB-Text CDB-Size-small is-semibold u-errorTextColor'><%- private %></span>.<br>")({private:_t("components.modals.publish.share.private")});b.exports=e.extend({className:"Card",tagName:"li",events:{"click .js-change-privacy":"_onChangePrivacyClick"},initialize:function(a){if(!a.model)throw new Error("model is required");if(null==a.isPublished)throw new Error("isPublished is required");this._isPublished=a.isPublished,this._type=this.model.type(),this._hasOrganization=a.hasOrganization,this._title=_t("components.modals.publish.share."+this._type+".title"),this.model.isPrivate()?this._body=_t("components.modals.publish.share."+this._type+".private.body",{private:i}):this._body=_t("components.modals.publish.share."+this._type+".body"),this._link=_t("components.modals.publish.share."+this._type+".link"),this._copy=this._getButtonLabel(),this.$el.toggleClass("is-disabled",this.model.isPrivate())},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),!this.model.isPrivate()&&this._isPublished&&this._initClipboard(),this},_getButtonLabel:function(){var a=h(),b=_t("components.modals.publish.share."+this._type+".copy");return"Safari"===a.name&&(b=_t("components.modals.publish.share."+this._type+".select")),b},getValue:function(){return this.$(".js-input").val()},_initViews:function(){var a=g({id:this.cid,isPrivate:this.model.isPrivate(),type:this._type,title:this._title,body:this._body,content:this.model.content(),link:this._link,copy:this._copy,url:this.model.url(),isPublished:this._isPublished});this.$el.append(a);var b=this.model.createIcon();this.$(".js-icon").append(b())},_initClipboard:function(){this._clipboard&&this._clipboard.destroy();var a=this.$(".js-copy");this._clipboard=new f(a.get(0))},_onChangePrivacyClick:function(a){this.killEvent(a),this.options.onChangePrivacy&&this.options.onChangePrivacy()},clean:function(){this._clipboard&&this._clipboard.destroy(),e.prototype.clean.call(this)}})},{"../../../../helpers/browser-detect":424,"./share-item.tpl":221,"backbone/core-view":454,clipboard:"clipboard",underscore:"underscore"}],221:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Card-icon u-bSpace--xl js-icon"></div>\n\n<div class="Card-body u-bSpace--xl">\n  ',__p+=isPrivate?'\n    <h3 class="CDB-Text CDB-Size-large u-altTextColor u-bSpace--m">'+(null==(__t=title)?"":_.escape(__t))+"</h3>\n  ":'\n    <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-bSpace--m">'+(null==(__t=title)?"":_.escape(__t))+"</h3>\n  ",__p+='\n  <div class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=body)?"":__t)+"\n    <br/>\n    ",url&&!isPrivate&&(__p+='\n    <a href="'+(null==(__t=url)?"":_.escape(__t))+'" class="Share-link js-link">'+(null==(__t=link)?"":_.escape(__t))+"</a>\n    "),__p+="\n  </div>\n</div>\n\n",!isPrivate&&isPublished&&(__p+='\n  <div class="Share-input">\n    <input type="text" id="'+(null==(__t=id)?"":_.escape(__t))+'" value="'+(null==(__t=content)?"":_.escape(__t))+'" class="Share-input-field CDB-InputText is-disabled CDB-Text CDB-Size-medium u-ellipsis js-input" readonly>\n    <button class="Share-copy CDB-Button CDB-Button--small js-copy" data-clipboard-target="#'+(null==(__t=id)?"":_.escape(__t))+'">\n      <span class="CDB-Button-Text CDB-Text CDB-Size-small u-actionTextColor">'+(null==(__t=copy)?"":_.escape(__t))+"</span>\n    </button>\n  </div>\n"),__p+="\n";return __p}},{underscore:"underscore"}],222:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({createIcon:function(){return this.get("createIcon")},type:function(){return this.get("type")},content:function(){return this.get("content")},url:function(){return this.get("url")},isPrivate:function(){return this.get("private")}})},{backbone:"backbone"}],223:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./share-with.tpl"),g=["visDefinitionModel","userModel"];b.exports=d.extend({className:"Share-with u-flex u-alignCenter",events:{"click .js-action":"_onAction"},initialize:function(a){e.each(g,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this.separationClass=a.separationClass||"",this.avatarClass=a.avatarClass||"",this._acl=this._visDefinitionModel._permissionModel.acl,this._initBinds()},render:function(){var a=this._getPeople(),b=void 0!==this.options.action&&this._hasOrganization();return this.clearSubViews(),this.$el.html(f({avatar:this._userModel.get("avatar_url"),people:a,avatarClass:this.avatarClass,separationClass:this.separationClass,hasAction:b})),this},_getPeople:function(){var a=this._acl.pluck("type");if(a.indexOf("org")>-1)return this._userModel.getOrganization().get("user_count")-1;var b=[];return e.each(this._acl.where({type:"group"}),function(a){var c=a.get("entity");Array.prototype.push.apply(b,c.users.pluck("id"))},this),e.each(this._acl.where({type:"user"}),function(a){var c=a.get("entity");b.push(c.get("id"))},this),b=e.without(b,this._userModel.id),e.unique(b).length},_hasOrganization:function(){return this._userModel.isInsideOrg()},_initBinds:function(){this._acl.on("fetch",this.render,this),this.add_related_model(this._acl)},_onAction:function(){this.options.action&&this.options.action()}})},{"./share-with.tpl":224,"backbone/core-view":454,underscore:"underscore"}],224:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",people>0?__p+='\n<div class="Share-user '+(null==(__t=avatarClass)?"":_.escape(__t))+' u-rSpace u-iBlock" style="background-image: url('+(null==(__t=avatar)?"":_.escape(__t))+')"></div>\n<span class="u-secondaryTextColor CDB-Text CDB-Size-small '+(null==(__t=separationClass)?"":_.escape(__t))+'">+ '+(null==(__t=people)?"":_.escape(__t))+"</span>\n":(__p+="\n  ",hasAction&&(__p+='\n  <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor js-action '+(null==(__t=separationClass)?"":_.escape(__t))+'">'+(null==(__t=_t("components.modals.publish.share.add-people"))?"":_.escape(__t))+"</button>\n  "),__p+="\n"),__p+="\n";return __p}},{underscore:"underscore"}],225:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./share-permission-view"),g=["collection","currentUserId","organization","hasOrganization","sharePermissionModel","isVisualization"];b.exports=d.extend({className:"Share-list",initialize:function(a){e.each(g,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._sortedCollection=this._sortCollection(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this._sharePermissionModel.acl.on("add remove reset change",this.render,this),this.add_related_model(this._sharePermissionModel)},_initViews:function(){this._hasOrganization&&this._renderOrganization(),e.each(this._sortedCollection,this._renderItem,this)},_sortCollection:function(){var a=this._collection.filter(function(a){var b=this._sharePermissionModel,c=b.hasWriteAccess(a),d=b.hasReadAccess(a);return c||d},this),b=this._collection.filter(function(a){var b=this._sharePermissionModel,c=b.hasWriteAccess(a),d=b.hasReadAccess(a);return!c&&!d},this);return a.concat(b)},_renderOrganization:function(){var a=this,b=this._organization,c=this._sharePermissionModel,d=!a._isVisualization,e=c.canChangeWriteAccess(b),g=c.hasWriteAccess(b),h=c.canChangeReadAccess(b),i=c.hasReadAccess(b),j=new f({model:b,permission:c,avatar:b.get("avatar_url"),description:_t("components.modals.publish.share.organization.desc"),name:_t("components.modals.publish.share.organization.title"),canChangeReadAccess:h,hasReadAccess:i,hasWriteAccessAvailable:d,canChangeWriteAccess:e,hasWriteAccess:g,isSelected:i||g});this.$el.append(j.render().$el),this.addView(j)},_renderItem:function(a){var b,c=this,d=a.get("model"),e=this._sharePermissionModel,g=!c._isVisualization,h=e.canChangeWriteAccess(a),i=e.hasWriteAccess(a),j=e.canChangeReadAccess(a),k=e.hasReadAccess(a),l=this._getRole(d);a.id!==this._currentUserId&&(b=new f({model:a,permission:e,name:a.get("name"),avatar:a.get("avatar_url"),role:l,users:d.users,canChangeReadAccess:j,hasReadAccess:k,hasWriteAccessAvailable:g,canChangeWriteAccess:h,hasWriteAccess:i,isSelected:k||i}),this.$el.append(b.render().$el),this.addView(b))},_getRole:function(a){return void 0!==a.viewer&&(a.viewer===!0?_t("components.modals.publish.share.role.viewer"):_t("components.modals.publish.share.role.builder"))}})},{"./share-permission-view":226,"backbone/core-view":454,underscore:"underscore"}],226:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./share-permission.tpl"),g=a("../../../tipsy-tooltip-view.js"),h=a("jquery"),i=a("./users-group-view"),j=["model","permission","name","canChangeReadAccess","hasReadAccess","hasWriteAccessAvailable","canChangeWriteAccess","hasWriteAccess","isSelected"],k=["description","role","avatar","users"];b.exports=e.extend({className:"Share-permission",events:{"change .js-read":"_onChangeRead","change .js-write":"_onChangeWrite","mouseover .js-toggler.is-disabled":"_onHoverDisabledToggler","mouseout .js-toggler":"_destroyTooltip","mouseleave .js-toggler":"_destroyTooltip"},initialize:function(a){d.each(j,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),d.each(k,function(b){this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(f({name:this._name,avatar:this._avatar,role:this._role,users:this._users,description:this._description,canChangeReadAccess:this._canChangeReadAccess,hasReadAccess:this._hasReadAccess,hasWriteAccessAvailable:this._hasWriteAccessAvailable,canChangeWriteAccess:this._canChangeWriteAccess,hasWriteAccess:this._hasWriteAccess})),this._users&&this._renderUsers(),this.$el.toggleClass("is-selected",this._isSelected),this},_renderUsers:function(){var a=new i({className:"u-flex u-alignCenter",users:this._users});this.$(".js-users").append(a.render().el),this.addView(a)},_onChangeWrite:function(){var a=this._permission;a.canChangeWriteAccess(this._model)&&(a.hasWriteAccess(this._model)?a.revokeWriteAccess(this._model):a.grantWriteAccess(this._model))},_onChangeRead:function(){var a=this._permission;a.canChangeReadAccess(this._model)&&(a.hasReadAccess(this._model)?a.revokeAccess(this._model):a.grantReadAccess(this._model))},_onHoverDisabledToggler:function(a){var b,c,d=this._permission.findRepresentableAclItem(this._model);d&&!d.isOwn(this._model)&&(b=this._inheritedAccessTooltipText(d),c=h(a.currentTarget),this._tooltip=this._createTooltip({$el:c,msg:b}),this._tooltip.showTipsy())},_createTooltip:function(a){return new g({el:a.$el,title:function(){return a.msg}})},_destroyTooltip:function(){this._tooltip&&(this._tooltip.hideTipsy(),this._tooltip.destroyTipsy())},_inheritedAccessTooltipText:function(a){var b=a.get("type");switch(b){case"group":return _t("components.modals.publish.share.tooltip.group",{name:a.get("entity").get("name")});case"org":return _t("components.modals.publish.share.tooltip.org");default:return console.error("Trying to display inherited access for an unrecognized type "+b),""}}})},{"../../../tipsy-tooltip-view.js":325,"./share-permission.tpl":227,"./users-group-view":232,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],227:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Share-permissionInfo">\n  <div class="Share-permissionIcon">\n    ',__p+=avatar?'\n      <div class="Share-user Share-user--huge" style="background-image: url('+(null==(__t=avatar)?"":_.escape(__t))+')"></div>\n    ':'\n        <i class="CDB-IconFont CDB-IconFont-people"></i>\n    ',__p+='\n  </div>\n  <div>\n    <div class="CDB-Text u-mainTextColor CDB-Size-medium is-semibold u-ellipsis">\n      '+(null==(__t=name)?"":_.escape(__t))+'\n    </div>\n\n\n    <div class="CDB-Text u-mainTextColor u-tSpace CDB-Size-medium u-ellipsis">\n      ',role&&(__p+='\n        <i class="Tag Tag--outline Tag--'+(null==(__t=role)?"":_.escape(__t))+' CDB-Text CDB-Size-small u-upperCase">'+(null==(__t=role)?"":_.escape(__t))+"</i>\n      "),__p+="\n\n      ",users&&(__p+='\n        <div class="js-users"></div>\n      '),__p+="\n    </div>\n\n\n    ",description&&(__p+='\n    <div class="CDB-Text u-mainTextColor u-tSpace CDB-Size-medium u-ellipsis">\n      '+(null==(__t=description)?"":_.escape(__t))+"\n    </div>\n    "),__p+='\n  </div>\n</div>\n<div class="Share-togglers">\n  ',hasWriteAccessAvailable&&(__p+='\n    <div class="CDB-Text CDB-Size-medium u-rSpace--xl Share-toggler js-toggler ',canChangeWriteAccess||(__p+="is-disabled"),__p+='">\n      <input class="CDB-Toggle u-iBlock js-write" type="checkbox"\n        ',canChangeWriteAccess||(__p+='disabled="disabled"'),__p+="\n        ",hasWriteAccess&&(__p+=" checked "),__p+='\n      />\n      <span class="u-iBlock CDB-ToggleFace"></span>\n      <label class="u-iBlock u-altTextColor ">'+(null==(__t=_t("components.modals.publish.share.toggle.write"))?"":_.escape(__t))+"</label>\n    </div>\n  "),__p+='\n  <div class="CDB-Text CDB-Size-medium Share-toggler js-toggler ',canChangeReadAccess||(__p+="is-disabled"),__p+='">\n    <input class="CDB-Toggle u-iBlock js-read" type="checkbox"\n      ',hasReadAccess&&(__p+=" checked "),__p+="\n      ",canChangeReadAccess||(__p+='disabled="disabled"'),__p+='\n    />\n    <span class="u-iBlock CDB-ToggleFace"></span>\n    <label class="u-iBlock u-altTextColor ">'+(null==(__t=_t("components.modals.publish.share.toggle.read"))?"":_.escape(__t))+"</label>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],228:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./share.tpl"),g=a("../../../../data/grantables-collection"),h=a("../../../../components/pagination-search/pagination-search-view"),i=a("./share-list-view"),j=["configModel","currentUserId","organization","visDefinitionModel"];b.exports=e.extend({initialize:function(a){d.each(j,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._grantablesCollection=new g([],{currentUserId:this._currentUserId,organization:this._organization,configModel:this._configModel}),this._sharePermissionModel=this._visDefinitionModel.getPermissionModel().clone(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(f({name:this._visDefinitionModel.get("name")})),this._initViews(),this},_initBinds:function(){this._sharePermissionModel.acl.on("add remove reset change",this._onSave,this),this.add_related_model(this._sharePermissionModel.acl)},_initViews:function(){var a=this;this._searchPaginationView=new h({className:"u-inner",listCollection:this._grantablesCollection,createContentView:function(b){return new i(d.extend({},b,{collection:a._grantablesCollection,currentUserId:a._currentUserId,sharePermissionModel:a._sharePermissionModel,organization:a._organization,
isVisualization:a._visDefinitionModel.isVisualization()}))}}),this.addView(this._searchPaginationView),this.$(".js-body").html(this._searchPaginationView.render().el)},_onCancel:function(){this._modalModel.destroy()},_onBack:function(){this._modalModel.destroy(),this._onBack()},_onSave:function(){var a=this._visDefinitionModel.getPermissionModel();a.overwriteAcl(this._sharePermissionModel),a.save().fail(this._searchPaginationView.showError.bind(this._searchPaginationView))}})},{"../../../../components/pagination-search/pagination-search-view":257,"../../../../data/grantables-collection":350,"./share-list-view":225,"./share.tpl":229,"backbone/core-view":454,underscore:"underscore"}],229:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-body">\n\n</div>';return __p}},{underscore:"underscore"}],230:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone/core-view"),g=a("./user.tpl"),h=a("../../../tipsy-tooltip-view"),i=["username","avatar"];b.exports=f.extend({initialize:function(a){e.each(i,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(g({avatar:this._avatar,username:this._username})),this._initViews(),this},_initViews:function(){var a=new h({el:this.$(".js-avatar"),title:function(){return d(this).attr("data-title")}});this.addView(a)}})},{"../../../tipsy-tooltip-view":325,"./user.tpl":231,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],231:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Share-user u-rSpace js-avatar" style="background-image: url('+(null==(__t=avatar)?"":_.escape(__t))+')" data-title="'+(null==(__t=username)?"":_.escape(__t))+'"></div>\n';return __p}},{underscore:"underscore"}],232:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./users-group.tpl"),g=a("./user-view"),h=["users"],i=3;b.exports=d.extend({initialize:function(a){e.each(h,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.clearSubViews(),this.$el.html(f({people:this._getRemainsPeople()})),this._renderUsers(),this},_getRemainsPeople:function(){return Math.max(0,this._users.length-i)},_renderUsers:function(){e.each(this._users.slice(0,i),this._renderUser,this)},_renderUser:function(a){var b=new g({username:a.username,avatar:a.avatar_url});this.$(".js-content").append(b.render().el),this.addView(b)}})},{"./user-view":230,"./users-group.tpl":233,"backbone/core-view":454,underscore:"underscore"}],233:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex js-content"></div>\n',people>0&&(__p+='\n  <div class="u-secondaryTextColor CDB-Text CDB-Size-small u-lSpace">+ '+(null==(__t=people)?"":_.escape(__t))+"</div>\n"),__p+="";return __p}},{underscore:"underscore"}],234:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Publish-modalMenu u-tSpace-xl">\n  <nav class="CDB-NavMenu u-inner">\n    <ul class="CDB-Size-medium CDB-Text is-semibold js-menu"></ul>\n  </nav>\n</div>\n\n<div class="Tab-paneContent Publish-modalContent js-content"></div>\n';return __p}},{underscore:"underscore"}],235:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./upgrade.tpl"),g=d.template("<a href='mailto:<%- mail %>'><%- contact %></a>")({contact:_t("components.modals.publish.privacy.upgrade.contact"),mail:_t("components.modals.publish.privacy.upgrade.mail")});b.exports=e.extend({render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=f({title:_t("components.modals.publish.privacy.upgrade.title"),desc:_t("components.modals.publish.privacy.upgrade.desc",{contact:g})});this.$el.html(a)}})},{"./upgrade.tpl":236,"backbone/core-view":454,underscore:"underscore"}],236:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter">\n  <div class="Upgrade-icon u-rSpace--xl">\n    <svg width="16px" height="16px" viewBox="578 456 16 16">\n      <g id="present" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(578.000000, 456.000000)">\n        <path d="M10.0946667,4.4109223 C10.8886667,4.1368747 11.6846667,3.80147316 12.0073333,3.4715253 C12.7866667,2.67392407 12.7866667,1.37662907 12.0073333,0.579027844 C11.2513333,-0.193350099 9.934,-0.192668389 9.17866667,0.579027844 C8.74133333,1.0262299 8.29266667,2.36033726 8,3.37608583 C7.70666667,2.36033726 7.25866667,1.0262299 6.82133333,0.579027844 C6.066,-0.193350099 4.748,-0.192668389 3.99266667,0.579027844 C3.21266667,1.37662907 3.21266667,2.67392407 3.99266667,3.4715253 C4.316,3.80147316 5.11133333,4.1368747 5.90533333,4.4109223 L0.333333333,4.4109223 C0.149333333,4.4109223 0,4.56362544 0,4.75177753 L0,7.47861934 C0,7.66677142 0.149333333,7.81947456 0.333333333,7.81947456 L0.666666667,7.81947456 L0.666666667,15.6591448 C0.666666667,15.8472969 0.816,16 1,16 L15,16 C15.184,16 15.3333333,15.8472969 15.3333333,15.6591448 L15.3333333,7.81947456 L15.6666667,7.81947456 C15.8506667,7.81947456 16,7.66677142 16,7.47861934 L16,4.75177753 C16,4.56362544 15.8506667,4.4109223 15.6666667,4.4109223 L10.0946667,4.4109223 Z M6,6.95652174 L6,4.86956522 L10,4.86956522 L10,6.95652174 L6,6.95652174 L6,6.95652174 Z M10,7.65217391 L10,15.3043478 L6,15.3043478 L6,7.65217391 L10,7.65217391 L10,7.65217391 Z M9.80833133,1.08822938 C10.0510474,0.834996985 10.3727426,0.695652174 10.7169115,0.695652174 C11.0597961,0.695652174 11.3821334,0.834996985 11.6248495,1.08755946 C12.1250502,1.6101025 12.1250502,2.46023983 11.6248495,2.98278288 C11.2729754,3.34990286 9.79227867,3.85636766 8.66666667,4.17391304 C8.97102496,2.99953105 9.45581507,1.45534937 9.80833133,1.08822938 L9.80833133,1.08822938 Z M4.37515049,1.08822938 C4.6178666,0.834996985 4.94020387,0.695652174 5.28373064,0.695652174 C5.6266153,0.695652174 5.94895256,0.834996985 6.19166867,1.08755946 C6.54354282,1.45467944 7.02833293,2.99886112 7.33333333,4.17391304 C6.20707922,3.85569773 4.72638253,3.34990286 4.37515049,2.98278288 C3.87494984,2.46090976 3.87494984,1.61077243 4.37515049,1.08822938 L4.37515049,1.08822938 Z M0.666666667,4.86956522 L5.33333333,4.86956522 L5.33333333,6.95652174 L1,6.95652174 L0.666666667,6.95652174 L0.666666667,4.86956522 L0.666666667,4.86956522 Z M1.33333333,7.65217391 L5.33333333,7.65217391 L5.33333333,15.3043478 L1.33333333,15.3043478 L1.33333333,7.65217391 L1.33333333,7.65217391 Z M14.6666667,15.3043478 L10.6666667,15.3043478 L10.6666667,7.65217391 L14.6666667,7.65217391 L14.6666667,15.3043478 L14.6666667,15.3043478 Z M15.3333333,6.95652174 L15,6.95652174 L10.6666667,6.95652174 L10.6666667,4.86956522 L15.3333333,4.86956522 L15.3333333,6.95652174 L15.3333333,6.95652174 Z" id="Shape" fill="#9BC63B"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="Upgrade-body">\n    <h2 class="CDB-Text CDB-Size-large">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n    <p class="CDB-Text CDB-Size-medium u-altTextColor ">'+(null==(__t=desc)?"":__t)+"</p>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],237:[function(a,b,c){var d=a("underscore"),e=a("moment"),f=a("../confirmation/modal-confirmation-view"),g=a("../../../data/vis-definition-model"),h=a("../../../helpers/mapcard-preview"),i=a("../../error/error-view"),j=a("../../loading/render-loading"),k=a("../../../dataset/operations/table-delete-operation"),l=a("./remove-dataset.tpl"),m=a("../../../helpers/error-parser"),n=["modalModel","userModel","visModel","tableModel","configModel"],o=3,p=20;b.exports=f.extend({className:"Dialog-content",initialize:function(a){d.each(n,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._acl=this._visModel._permissionModel.acl},render:function(){var a=this._tableModel.get("accessible_dependent_derived_maps"),b=this._prepareVisibleAffectedEntities();return this.clearSubViews(),this.$el.html(l({modalModel:this._modalModel,tableName:this._tableModel.getUnquotedName(),affectedVisCount:a.length,visibleAffectedVis:this._prepareVisibleAffectedVis(a.slice(0,o)),organizationAffected:b.organizationAffected,affectedEntitiesCount:b.count,visibleAffectedEntities:b.data.slice(0,p),maxVisCount:o,maxEntitiesCount:p})),this},_prepareVisibleAffectedVis:function(a){return a.map(function(a){var b=new g(a,{configModel:this._configModel}),c=b._permissionModel.get("owner");return{visId:b.get("id"),name:b.get("name"),url:b.builderURL(),ownerName:c.username,timeDiff:e(b.get("updated_at")).fromNow(),previewUrl:h.urlForStaticMap(this._configModel.get("maps_api_template"),b,304,96)}},this)},_prepareVisibleAffectedEntities:function(){var a,b=this._acl.pluck("type"),c={organizationAffected:!1,count:0,data:[]};if(b.indexOf("org")>-1)a=this._userModel.getOrganization(),c.organizationAffected=!0,c.count=a.get("user_count")-1,a.get("avatar_url")&&c.data.push({avatarUrl:a.get("avatar_url"),username:a.get("display_name")});else{var e=[],f=[],g=this._userModel.get("username");d.each(this._acl.where({type:"group"}),function(a){var b=a.get("entity"),c=d.map(b.users.models,function(a){return{username:a.get("username"),avatarUrl:a.get("avatar_url")}});e=e.concat(c)},this),d.each(this._acl.where({type:"user"}),function(a){var b=a.get("entity");e.push({username:b.get("username"),avatarUrl:b.get("avatar_url")})},this),e=d.filter(e,function(a){return a.username!==g}),f=d.uniq(e,function(a){return a.username}),c.count=f.length,c.data=f}return c},_runAction:function(){this._renderLoadingView(),k({onSuccess:this._onSuccessDestroyDataset.bind(this,this._modalModel),onError:this._onErrorDestroyDataset.bind(this),visModel:this._visModel})},_renderLoadingView:function(){this.$el.html(j({title:_t("dataset.delete.loading",{tableName:this._tableModel.getUnquotedName()})}))},_onSuccessDestroyDataset:function(){window.location=this._configModel.get("base_url")+"/dashboard"},_onErrorDestroyDataset:function(a,b){var c=m(b),d=new i({title:_t("dataset.delete.error",{tableName:this._tableModel.getUnquotedName(),error:c}),desc:c||_t("components.error.default-desc")});this.$el.html(d.render().el),this.addView(d)}})},{"../../../data/vis-definition-model":377,"../../../dataset/operations/table-delete-operation":402,"../../../helpers/error-parser":426,"../../../helpers/mapcard-preview":429,"../../error/error-view":37,"../../loading/render-loading":187,"../confirmation/modal-confirmation-view":190,"./remove-dataset.tpl":238,moment:"moment",underscore:"underscore"}],238:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("dataset.delete.title",{tableName:tableName}))?"":__t)+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-secondaryTextColor">'+(null==(__t=_t("dataset.delete.desc"))?"":_.escape(__t))+"</p>\n\n      ",affectedVisCount>0&&(__p+='\n        <div class="Modal-listActions js-affectedVis">\n          <p class="CDB-Text CDB-Size-large u-altTextColor">\n            ',__p+=affectedVisCount>maxVisCount?"\n              "+(null==(__t=_t("dataset.delete.affected-vis-count-extended",{affectedVisCount:affectedVisCount}))?"":__t)+"\n            ":"\n              "+(null==(__t=_t("dataset.delete.affected-vis-count",{smart_count:affectedVisCount}))?"":__t)+"\n            ",__p+='\n          </p>\n\n          <ul class="u-flex u-justifyStart u-tSpace-xl">\n            ',visibleAffectedVis.forEach(function(a){__p+='\n              <li class="MapsList-item MapsList-item--wRightMargins">\n                <div class="MapCard" data-vis-id="'+(null==(__t=a.visId)?"":_.escape(__t))+'" data-vis-owner-name="'+(null==(__t=a.ownerName)?"":_.escape(__t))+'">\n                  <a href="'+(null==(__t=a.url)?"":_.escape(__t))+'" target="_blank" class="MapCard-header MapCard-header--mCompact js-header">\n                    <img class="MapCard-preview" src="'+(null==(__t=a.previewUrl)?"":_.escape(__t))+'" style="display: inline;">\n                    <div class="MapCard-loader"></div>\n                  </a>\n                  <div class="MapCard-content MapCard-content--compact">\n                    <div class="MapCard-contentBody">\n                      <div class="MapCard-contentBodyRow MapCard-contentBodyRow--flex">\n                        <h3 class="CDB-Text CDB-Size-large u-bSpace u-ellipsis">\n                          <a href="'+(null==(__t=a.url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=a.name)?"":_.escape(__t))+'" class="u-mainTextColor">'+(null==(__t=a.name)?"":_.escape(__t))+'</a>\n                        </h3>\n                      </div>\n                      <p class="MapCard-contentBodyTimeDiff DefaultTimeDiff CDB-Text CDB-Size-medium u-altTextColor">\n                        '+(null==(__t=a.timeDiff)?"":_.escape(__t))+"\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </li>\n            "}),__p+="\n          </ul>\n        </div>\n      "),__p+="\n\n      ",(affectedEntitiesCount>0||organizationAffected)&&(__p+='\n        <div class="Modal-listActions js-affectedEntities">\n          <p class="CDB-Text CDB-Size-large u-altTextColor">\n            ',__p+=organizationAffected?"\n              "+(null==(__t=_t("dataset.delete.whole-organization-affected"))?"":__t)+"\n            ":affectedEntitiesCount>maxEntitiesCount&&visibleAffectedEntities.length>0?"\n              "+(null==(__t=_t("dataset.delete.affected-entities-count-extended",{affectedEntitiesCount:affectedEntitiesCount}))?"":__t)+"\n            ":"\n              "+(null==(__t=_t("dataset.delete.affected-entities-count",{smart_count:affectedEntitiesCount}))?"":__t)+"\n            ",__p+='\n          </p>\n\n          <ul class="u-flex u-justifyStart u-tSpace-xl">\n          ',visibleAffectedEntities.forEach(function(a){__p+="\n            ",a.avatarUrl&&(__p+=' \n              <li class="u-rSpace--m">\n                <div class="Share-user Share-user--medium" style="background-image: url('+(null==(__t=a.avatarUrl)?"":_.escape(__t))+')" data-username="'+(null==(__t=a.username)?"":_.escape(__t))+'" title="'+(null==(__t=a.username)?"":_.escape(__t))+'"></div>\n              </li>\n            '),__p+="\n          "}),__p+="\n        </ul>\n        </div>\n      "),__p+='\n\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--medium js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">\n              '+(null==(__t=_t("dataset.delete.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--medium js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small u-upperCase">\n              '+(null==(__t=_t("dataset.delete.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],239:[function(a,b,c){var d=a("backbone/core-view"),e=a("./sync-options-modal.tpl"),f=a("../../loading/render-loading"),g=a("../../error/error-view"),h=a("../../../helpers/error-parser");b.exports=d.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function(a){if(!a.modalModel)throw new Error("modalModel is required");if(!a.syncModel)throw new Error("syncModel is required");if(!a.tableName)throw new Error("tableName is required");this._syncModel=a.syncModel,this._modalModel=a.modalModel,this._tableName=a.tableName},render:function(){this.clearSubViews(),this.$el.html(e({interval:this._syncModel.get("interval"),service:this._syncModel.get("service_name")||"",isExternalSource:this._syncModel.get("from_external_source"),url:this._getServiceURL()}))},_renderErrorView:function(a){var b=new g({title:_t("dataset.sync.error"),desc:a});this.$el.html(b.render().el),this.addView(b)},_renderLoadingView:function(){this.$el.html(f({title:_t("dataset.sync.loading",{tableName:this._tableName})}))},_getServiceURL:function(){return this._syncModel.get("service_name")||this._syncModel.get("service_item_id")?this._syncModel.get("service_item_id"):this._syncModel.get("url")},_onConfirm:function(){var a=parseInt(this.$('[name="interval"]:checked').val(),10),b={wait:!0,success:function(){this._modalModel.destroy()}.bind(this),error:function(a,b){this._renderErrorView(h(b))}.bind(this)};this._renderLoadingView(),this._syncModel.get("interval")!==a?a?this._syncModel.save({interval:a},b):this._syncModel.destroy(b):this._modalModel.destroy()},_onCancel:function(){this._modalModel.destroy()}})},{"../../../helpers/error-parser":426,"../../error/error-view":37,"../../loading/render-loading":187,"./sync-options-modal.tpl":240,"backbone/core-view":454}],240:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--full u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="20px" viewBox="0 8 24 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Icon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(0.000000, 8.000000)">\n              <path d="M19.591513,9.26858726 C19.7142261,9.39218837 19.8745043,9.45462604 20.0347826,9.45462604 C20.1950609,9.45462604 20.3553391,9.39218837 20.4780522,9.26858726 C20.7222261,9.0201108 20.7222261,8.61617729 20.4780522,8.36770083 C20.1988174,8.08354571 19.908313,7.81468144 19.6065391,7.56365651 C19.5652174,7.52925208 19.5201391,7.4999446 19.4775652,7.46554017 C17.3914435,5.76952909 14.824487,4.84060942 12.1147826,4.84060942 L12.1122783,4.84060942 L12.1097739,4.84060942 C8.95053913,4.84060942 5.98038261,6.0931856 3.74775652,8.36770083 C3.50358261,8.61617729 3.50358261,9.0201108 3.74775652,9.26858726 C3.87046957,9.3934626 4.03074783,9.45462604 4.19102609,9.45462604 C4.35130435,9.45462604 4.51158261,9.39218837 4.63304348,9.26858726 C6.63151304,7.23490305 9.28737391,6.11484765 12.1122783,6.11484765 C14.9371826,6.11484765 17.5930435,7.23490305 19.591513,9.26858726 L19.591513,9.26858726 Z" id="Shape" fill="#2E3C43"></path>\n              <path d="M22.7607652,5.95695291 C22.8834783,6.08182825 23.0437565,6.14299169 23.2040348,6.14299169 C23.364313,6.14299169 23.5245913,6.08055402 23.6473043,5.95695291 C23.8914783,5.70847645 23.8914783,5.30454294 23.6473043,5.05606648 C17.2862609,-1.41706371 6.93704348,-1.41451524 0.578504348,5.05606648 C0.334330435,5.30454294 0.334330435,5.70847645 0.578504348,5.95695291 C0.822678261,6.20542936 1.21961739,6.20542936 1.4637913,5.95695291 C7.33398261,-0.0179501385 16.8905739,-0.0166759003 22.7607652,5.95695291 L22.7607652,5.95695291 Z" id="Shape" fill="#2E3C43"></path>\n              <path d="M9.58789565,9.966759 C8.61495652,10.3273684 7.69586087,10.8854848 6.91575652,11.6793352 C6.67158261,11.9278116 6.67158261,12.3317452 6.91575652,12.5802216 C7.03846957,12.705097 7.19874783,12.7662604 7.35902609,12.7662604 C7.51930435,12.7662604 7.67958261,12.7038227 7.80229565,12.5802216 C10.1789217,10.1642659 14.046887,10.1642659 16.4247652,12.5802216 C16.5474783,12.705097 16.7077565,12.7662604 16.8680348,12.7662604 C17.028313,12.7662604 17.1885913,12.7038227 17.3113043,12.5802216 C17.5554783,12.3317452 17.5554783,11.9278116 17.3113043,11.6793352 C15.2239304,9.55645429 12.1924174,8.99961219 9.58789565,9.966759 L9.58789565,9.966759 Z" id="Shape" fill="#2E3C43"></path>\n              <path d="M12.1122783,14.1359557 C10.5307826,14.1359557 9.2448,15.4445983 9.2448,17.052687 C9.2448,18.6620499 10.5307826,19.9706925 12.1122783,19.9706925 C13.6925217,19.9706925 14.9785043,18.6620499 14.9785043,17.052687 C14.9785043,15.4458726 13.6925217,14.1359557 12.1122783,14.1359557 L12.1122783,14.1359557 Z M12.1122783,18.6977285 C11.2219826,18.6977285 10.4969739,17.9599446 10.4969739,17.0539612 C10.4969739,16.1479778 11.2219826,15.4114681 12.1122783,15.4114681 C13.0025739,15.4114681 13.7263304,16.1479778 13.7263304,17.0539612 C13.7263304,17.9599446 13.0025739,18.6977285 12.1122783,18.6977285 L12.1122783,18.6977285 Z" id="Shape" fill="#2E3C43"></path>\n          </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class="CDB-Text CDB-Size-huge is-light u-bSpace--m">\n        '+(null==(__t=_t("dataset.sync.title"))?"":_.escape(__t))+'\n     </h2>\n      <p class="CDB-Text CDB-Size-medium u-altTextColor">\n        '+(null==(__t=_t("dataset.sync.desc",{service:service,url:url}))?"":__t)+'\n      </p>\n      <div class="Modal-listTextItem u-flex u-alignCenter">\n        <h3 class="CDB-Text CDB-Size-small is-semibold u-upperCase">'+(null==(__t=_t("dataset.sync.label"))?"":_.escape(__t))+'</h3>\n        <ul class="Modal-listForm u-flex u-alignCenter CDB-Text CDB-Size-small js-intervals">\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="3600"\n              ',3600===interval&&(__p+="\n                checked\n              "),__p+="\n\n              ",isExternalSource&&(__p+="\n                disabled\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Every hour</label>\n          </li>\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="86400"\n              ',86400===interval&&(__p+="\n                checked\n              "),__p+="\n\n              ",isExternalSource&&(__p+="\n                disabled\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Every day</label>\n          </li>\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="604800"\n              ',604800===interval&&(__p+="\n                checked\n              "),__p+="\n\n              ",isExternalSource&&(__p+="\n                disabled\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Every week</label>\n          </li>\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="2592000"\n              ',2592e3===interval&&(__p+="\n                checked\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Every month</label>\n          </li>\n          <li class="Modal-listFormItem">\n            <input class="CDB-Radio" type="radio" name="interval" value="0"\n              ',0===interval&&(__p+="\n                checked\n              "),__p+='\n            >\n            <span class="u-iBlock CDB-Radio-face"></span>\n            <label class="u-iBlock u-lSpace u-upperCase">Never</label>\n          </li>\n        </ul>\n      </div>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("dataset.sync.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("dataset.sync.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n\n\n";return __p}},{underscore:"underscore"}],241:[function(a,b,c){b.exports=" | CARTO"},{}],242:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="LayoutIcon">\n    <i class="CDB-IconFont '+(null==(__t=icon)?"":_.escape(__t))+'"></i>\n  </div>\n  <h4 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m u-tSpace-xl">'+(null==(__t=title)?"":_.escape(__t))+'</h4>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">\n    '+(null==(__t=desc)?"":_.escape(__t))+"\n  </p>\n</div>\n";return __p}},{underscore:"underscore"}],243:[function(a,b,c){var d=a("./no-results.tpl");b.exports=function(a){return d({icon:a.icon||"CDB-IconFont-cockroach",title:a.title||"",desc:a.desc})}},{"./no-results.tpl":242}],244:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({tagName:"button",initialize:function(a){if(!a.template)throw new Error("template is required");if(!a.editorModel)throw new Error("editorModel is required");this.template=a.template,this._editorModel=a.editorModel,this._data={},a.model&&(this._data=a.model.toJSON()),this._initBinds()},_initBinds:function(){this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.template(this._data)),this},_changeStyle:function(){this.$(".js-theme").toggleClass("is-white",this._editorModel.isEditing())}})},{"backbone/core-view":454}],245:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span data-action="'+(null==(__t=button)?"":_.escape(__t))+'" class="CDB-Text is-semibold u-lSpace u-actionTextColor u-upperCase">'+(null==(__t=button)?"":_.escape(__t))+"</span>";return __p}},{underscore:"underscore"}],246:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Shape-close is-blue is-large js-theme"></div>';return __p}},{underscore:"underscore"}],247:[function(a,b,c){var d=a("backbone"),e=a("./notifier-model");b.exports=d.Collection.extend({model:function(a,b){return new e(a,b)},findById:function(a){return this.findWhere({id:a})}})},{"./notifier-model":250,backbone:"backbone"}],248:[function(a,b,c){var d=a("backbone/core-view"),e=a("./notifier-item.tpl"),f=a("./notifier-action-view"),g=a("./notifier-close.tpl"),h=a("./notifier-action.tpl");b.exports=d.extend({className:"Notifier-inner",tagName:"li",events:{"click .js-close":"_closeHandler","click .js-action":"_actionHandler"},initialize:function(a){if(!a.notifierModel)throw new Error("notifierModel is required");if(!a.editorModel)throw new Error("editorModel is required");this._editorModel=a.editorModel,this.template=this.options.template||e,this._notifierModel=a.notifierModel,this.$el.attr("id",this._notifierModel.get("id")),this._delay=this._notifierModel.get("delay")||this._notifierModel.get("defaultDelay"),this._notifierModel.get("delay")&&this._notifierModel.get("closable")!==!1&&(this._timeout=setTimeout(this._autoClose.bind(this),this._delay)),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this._changeStyle(),this},_initBinds:function(){this.listenTo(this._notifierModel,"change",this.render),this.listenTo(this._notifierModel,"change:status",this._onChangeStatus),this.add_related_model(this._notifierModel),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},_initViews:function(){var a=this._notifierModel.getButton(),b=this._notifierModel.isClosable(),c=this.template({status:this._notifierModel.getStatus(),info:this._notifierModel.getInfo(),isActionable:a,isClosable:b});this.$el.append(c),a&&this._createActionView(a),b&&this._createCloseView()},_createActionView:function(a){var b=new f({template:h,className:"js-action",model:this._notifierModel,editorModel:this._editorModel});this.$(".js-actionButton").append(b.render().el),this.addView(b)},_createCloseView:function(){var a=new f({template:g,className:"CDB-Shape js-close",editorModel:this._editorModel});this.$(".js-closeButton").append(a.render().el),this.addView(a)},_closeHandler:function(){var a=this._notifierModel.getStatus(),b=this._notifierModel.getAction();this._notifierModel.trigger("notification:close",b||a),clearTimeout(this._timeout),this._notifierModel&&this._notifierModel.collection&&this._notifierModel.collection.remove(this._notifierModel)},_actionHandler:function(){var a=this._notifierModel.getStatus(),b=this._notifierModel.getAction();this._notifierModel.trigger("notification:action",b||a)},_changeStyle:function(){this.$(".Notifier-info").toggleClass("u-whiteTextColor",this._editorModel.isEditing()),this.$(".Notifier-actions .CDB-Shape-close").toggleClass("is-blue",!this._editorModel.isEditing()),this.$(".Notifier-actions .CDB-Shape-close").toggleClass("is-white",this._editorModel.isEditing())},_autoClose:function(){this._notifierModel.set({action:"autoclose"},{silent:!0}),this._closeHandler()},_onChangeStatus:function(a,b){"success"!==b&&"error"!==b||this._notifierModel.get("closable")===!1||this._notifierModel.get("autoclosable")===!1||(this._timeout=setTimeout(this._autoClose.bind(this),this._delay))}})},{"./notifier-action-view":244,"./notifier-action.tpl":245,"./notifier-close.tpl":246,"./notifier-item.tpl":249,"backbone/core-view":454}],249:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Notifier-item Notifier-item--'+(null==(__t=status)?"":_.escape(__t))+'">\n\n  ',"loading"===status&&(__p+='\n  <div class="Notifier-icon CDB-LoaderIcon is-blue js-theme u-rSpace--m">\n    <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n      <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n    </svg>\n  </div>\n  '),
__p+="\n\n  ","success"===status&&(__p+='\n  <div class="Notifier-icon CDB-Shape u-rSpace--m">\n    <div class="CDB-Shape-CircleItem CDB-Shape-CircleItem--fill is-green">\n      <div class="CDB-Shape-tick is-medium is-white"></div>\n    </div>\n  </div>\n  '),__p+="\n\n  ","error"!==status&&"warning"!==status||(__p+='\n  <div class="Notifier-icon CDB-Shape u-rSpace--m">\n    <div class="CDB-Shape-CircleItem CDB-Shape-CircleItem--fill is-red">\n      <div class="CDB-Shape-close is-medium is-white"></div>\n    </div>\n  </div>\n  '),__p+='\n\n  <div class="Notifier-info">\n    <p class="CDB-Text CDB-Size-medium">'+(null==(__t=info)?"":__t)+" ",isActionable&&(__p+=' <span class="js-actionButton"></span> '),__p+="</p>\n  </div>\n\n  ",isClosable&&(__p+='\n    <div class="Notifier-actions js-closeButton"></div>\n  '),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],250:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{status:"idle",info:"",closable:!0},initialize:function(a,b){void 0===a.id&&this.set("id","notifier"+this.cid),this.set("defaultDelay",b.delay),b.visDefinitionModel&&(this._retriggerEvent(b.visDefinitionModel,"vis:reload"),this._retriggerEvent(b.visDefinitionModel,"vis:error"))},isClosable:function(){return this.get("closable")===!0},updateClosable:function(a){this.set({closable:a})},getButton:function(){return this.get("button")},updateButton:function(a){this.set({button:a})},getStatus:function(){return this.get("status")},updateStatus:function(a){this.set({status:a})},getInfo:function(){return this.get("info")},getAction:function(){return this.get("action")},setAction:function(a){this.set({action:a})},updateInfo:function(a){this.set({info:a})},update:function(a){this.set(a)},_retriggerEvent:function(a,b){a.on(b,function(){this.trigger(b,arguments)},this)}})},{backbone:"backbone"}],251:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./notifier-item-view"),g=a("./notifier.tpl");b.exports=d.extend({className:"Notifier",initialize:function(a){if(!a.collection)throw new Error("collection is mandatory");if(!a.editorModel)throw new Error("editorModel is mandatory");this._editorModel=a.editorModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g()),this._renderAllSubviews(),this._renderLoading(),this},rebindEvents:function(){return this.stopListening(this.collection),this.stopListening(this._editorModel),this._initBinds(),this},_initBinds:function(){this.listenTo(this.collection,"reset update change:status",this.render),this.add_related_model(this.collection),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},_renderAllSubviews:function(){this.collection.each(this._renderSubview,this)},_renderSubview:function(a){var b=new f({notifierModel:a,editorModel:this._editorModel}),c=a.get("status"),d="success"===c||"error"===c?this._getDoneContainer():this._getLoadingContainer();d.append(b.render().el),this.addView(b)},_removeSubview:function(a){var b=a.get("id"),c=e.first(e.filter(this._subviews,function(a){return a._notifierModel.get("id")===b}));c&&(this.removeView(c),c.remove())},_renderLoading:function(){this._getLoader().toggleClass("is-visible",this._anyNotificationLoading())},_anyNotificationLoading:function(){return this.collection.any(function(a){return!e.contains(["success","error","warning"],a.get("status"))})},_changeStyle:function(){this.$el.toggleClass("is-dark",this._editorModel.isEditing())},_getDoneContainer:function(){return this.$(".js-status-done")},_getLoadingContainer:function(){return this.$(".js-status-loading")},_getLoader:function(){return this.$(".js-loader")}})},{"./notifier-item-view":248,"./notifier.tpl":253,"backbone/core-view":454,underscore:"underscore"}],252:[function(a,b,c){var d=a("./notifier-view"),e=a("./notifier-collection"),f=function(){function a(a){if(!c&&!a)throw new Error("editorModel is required");!c&&a&&a.editorModel&&(c=a.editorModel),f=!0,b=new d({collection:g,editorModel:c})}var b,c,f=!1,g=new e;return{DEFAULT_DELAY:5e3,init:function(b){b.visDefinitionModel&&(this._visDefinitionModel=b.visDefinitionModel),a(b)},getView:function(){return f||a(),b.rebindEvents()},getCollection:function(){return g},getNotification:function(a){var b;return b="string"==typeof a?g.findById(a):g.findById(a.id)},addNotification:function(a){return g.add(a,{visDefinitionModel:this._visDefinitionModel,delay:this.DEFAULT_DELAY})},removeNotification:function(a){var b;return b="string"==typeof a?g.findById(a):g.findById(a.id),g.remove(b)}}}();b.exports=f},{"./notifier-collection":247,"./notifier-view":251}],253:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Loader js-loader"></div>\n<ul class="Notifier-list js-status-loading"></ul>\n<ul class="Notifier-list js-status-done"></ul>';return __p}},{underscore:"underscore"}],254:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("./builder-activated-notification.tpl"),g="builder_activated";b.exports=d.extend({className:"js-builderNotification",events:{"click .js-close":"_onClose"},initialize:function(){if(!this.options.builderActivatedNotification)throw new Error("builderActivatedNotification is required");this._notification=this.options.builderActivatedNotification,this.render()},render:function(){return this.$el.html(f()),e("body").prepend(this.$el),this},_onClose:function(){this._notification.setKey(g,!0),this._notification.save(),this.clean()},clean:function(){this.constructor.__super__.clean.apply(this)}})},{"./builder-activated-notification.tpl":255,"backbone/core-view":454,jquery:"jquery"}],255:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="onboardingNotification Color-MainDark CDB-Text CDB-Size-medium u-flex u-justifyCenter">\n  <p>'+(null==(__t=_t("builder-activated-notification.message"))?"":__t)+'</p>\n\n  <button class="onboardingNotification-closeButton js-close">\n    <div class="CDB-Shape-close is-large is-white"></div>\n  </button>\n</div>\n';return __p}},{underscore:"underscore"}],256:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{per_page:20,page:1,q:""},initialize:function(a,b){if(!b.collection)throw new Error("collection is required");if(!b.collection.totalCount)throw new Error("collection requires to implement totalCount method");this.collection=b.collection,this._initBinds()},_initBinds:function(){this.collection.on("sync",this._updateStateFetched,this),this.collection.on("error",this._updateStateError,this)},fetch:function(){return this.trigger("fetching",this),this.collection.fetch({data:this.attributes},{reset:!0})},_updateStateFetched:function(){this.trigger("fetched",this)},_updateStateError:function(){this.trigger("error",this)}})},{backbone:"backbone"}],257:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view"),f=a("underscore"),g=a("../pagination/pagination-model"),h=a("./pagination-search-model"),i=a("../loading/render-loading"),j=a("../no-results/render-no-results"),k=a("../error/error-view"),l=a("./pagination-search.tpl"),m=a("../../helpers/utils"),n=a("../pagination/pagination-view"),o=a("./pagination.tpl"),p=["listCollection","createContentView"],q=13,r=27;b.exports=e.extend({events:{"click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","keydown .js-search-input":"_onKeyDown"},initialize:function(a){f.each(p,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._paginationModel=new g({current_page:1}),this._paginationSearchModel=new h({},{collection:this._listCollection}),this._stateModel=new d.Model({state:"idle"}),this._initBinds(),this._initPagination(),this._paginationSearchModel.fetch()},render:function(){return this.clearSubViews(),this.$el.html(l({q:this._paginationSearchModel.get("q")})),this._initViews(),this},_initBinds:function(){this._paginationSearchModel.on("fetching",this.showLoading,this),this._paginationSearchModel.on("fetched",this._updateStateFetched,this),this._paginationSearchModel.on("error",this.showError,this),this._paginationModel.bind("change:current_page",this._fetchByPagination,this),this._stateModel.on("change:state",this.render,this),this.add_related_model(this._paginationModel),this.add_related_model(this._stateModel),this.add_related_model(this._stateModel)},_fetchByPagination:function(){this._paginationSearchModel.set("page",this._paginationModel.get("current_page")),this._paginationSearchModel.fetch()},showError:function(){this._stateModel.set("state","error")},showLoading:function(){this._stateModel.set("state","loading")},_updateStateFetched:function(){this._paginationModel.set({per_page:this._paginationSearchModel.get("per_page"),total_count:this._listCollection.totalCount()}),this._listCollection.length>0?this._stateModel.set("state","show"):this._stateModel.set("state","no-results")},_initPagination:function(){this._paginationView=new n({className:"Pagination Pagination--search Pagination--searchShare",model:this._paginationModel,template:o}),this.addView(this._paginationView)},_initViews:function(){var a,b=this._stateModel.get("state");if(this.$el.append(this._paginationView.render().el),"loading"===b&&this._content().html(i({title:_t("components.pagination-search.loading.title")})),"error"===b){var c=new k({title:_t("components.pagination-search.error.title"),desc:_t("components.pagination-search.error.desc")});this._content().html(c.render().el),this.addView(c)}"show"===b&&(a=this._createContentView({hasOrganization:""===this._paginationSearchModel.get("q")}),this._content().html(a.render().el),this.addView(a)),"no-results"===b&&this._content().html(j({icon:"CDB-IconFont-defaultUser",title:_t("components.pagination-search.no-results.title"),desc:_t("components.pagination-search.no-results.desc")}))},_focusSearchInput:function(){this._searchInput().focus().val()},_onSearchClick:function(a){this.killEvent(a),this._searchInput().focus()},_onCleanSearchClick:function(a){this.killEvent(a),this._cleanSearch()},_onKeyDown:function(a){a.which===q?(this.killEvent(a),this._submitSearch()):a.which===r&&this._paginationSearchModel.get("q")&&(this.killEvent(a),this._cleanSearch())},_submitSearch:function(a){this._makeNewSearch(m.stripHTML(this._searchInput().val().trim()))},_cleanSearch:function(){this._searchInput().val(""),this._makeNewSearch("")},_makeNewSearch:function(a){this._paginationSearchModel.set({q:a,page:1}),this._paginationSearchModel.fetch()},_searchInput:function(){return this.$(".js-search-input")},_cleanSearchBtn:function(){return this.$(".js-clean-search")},_content:function(){return this.$(".js-content")}})},{"../../helpers/utils":435,"../error/error-view":37,"../loading/render-loading":187,"../no-results/render-no-results":243,"../pagination/pagination-model":260,"../pagination/pagination-view":261,"./pagination-search-model":256,"./pagination-search.tpl":258,"./pagination.tpl":259,backbone:"backbone","backbone/core-view":454,underscore:"underscore"}],258:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Filters is-relative">\n  <div class="Filters-inner">\n    <div class="Filters-row Share-filtersRow js-filters">\n      <div class="Filters-typeItem Filters-typeItem--searchEnabler">\n        <p class="Filters-searchLink js-search-link u-alignCenter CDB-Text CDB-Size-medium u-upperCase">\n          <i class="Filters-searchLinkIcon CDB-IconFont CDB-IconFont-lens u-rSpace--xl"></i> '+(null==(__t=_t("components.pagination-search.filter.search"))?"":_.escape(__t))+'\n        </p>\n      </div>\n      <div class="Filters-typeItem Filters-typeItem--searchField">\n        <input class="Filters-searchInput CDB-Text CDB-Size-medium js-search-input" type="text" value="'+(null==(__t=q)?"":_.escape(__t))+'" placeholder="'+(null==(__t=_t("components.pagination-search.filter.placeholder"))?"":_.escape(__t))+'" />\n        ',""!==q&&(__p+='\n        <button type="button" class="CDB-Shape Filters-cleanSearch js-clean-search u-actionTextColor">\n          <div class="CDB-Shape-close is-blue is-large"></div>\n        </button>\n        '),__p+='\n      </div>\n    </div>\n  </div>\n</div>\n<div class="js-content"></div>';return __p}},{underscore:"underscore"}],259:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="CDB-Text CDB-Size-medium u-altTextColor Pagination-label">\n  Page '+(null==(__t=currentPage)?"":_.escape(__t))+" of "+(null==(__t=pagesCount)?"":_.escape(__t))+'\n</span>\n<ul class="Pagination-list CDB-Text CDB-Size-medium">\n  ',m.pagesToDisplay().forEach(function(a){__p+="\n    ",__p+=a>0?'\n      <li class="Pagination-listItem '+(null==(__t=m.isCurrentPage(a)?"is-current":"")?"":_.escape(__t))+'">\n        <button class="Pagination-listItemInner Pagination-listItemInner--link u-actionTextColor js-listItem" data-page="'+(null==(__t=a)?"":_.escape(__t))+'">'+(null==(__t=a)?"":_.escape(__t))+"</button>\n      </li>\n    ":'\n      <li class="Pagination-listItem Pagination-listItem">\n        <span class="Pagination-listItemInner Pagination-listItemInner--more">&hellip;</span>\n      </li>\n    ',__p+="\n  "}),__p+="\n</ul>\n";return __p}},{underscore:"underscore"}],260:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{total_count:0,per_page:10,current_page:1,display_count:5,extras_display_count:1,url_to:void 0},pagesCount:function(){return Math.max(Math.ceil(this.get("total_count")/this.get("per_page")),1)},isCurrentPage:function(a){return this.get("current_page")===a},shouldBeVisible:function(){var a=this.pagesCount();return this.get("total_count")>0&&a>1&&this.get("current_page")<=a},urlTo:function(a){if(this.hasUrl())return this.get("url_to")(a)},hasUrl:function(){return"function"==typeof this.get("url_to")},pagesToDisplay:function(){var a;return a=this._inLowRange()?1:this._inHighRange()?this.get("current_page")-this._startOffset():this.pagesCount()-this.get("display_count")+1,a=Math.max(a,1),this._withExtraPages(e.range(a,this._rangeEnd(a)))},_withExtraPages:function(a){var b=this.pagesCount(),c=this.get("extras_display_count"),d=e.range(1,c+1),f=e.range(b-c+1,b+1),g=a[0]-d.slice(-1)[0];2===g?d.push(a[0]-1):g>2&&d.push(-1);var h=f[0]-a.slice(-1);return 2===h&&f.unshift(f[0]-1),h>2&&f.unshift(-2),e.union(d,a,f)},_inLowRange:function(){return this.get("current_page")<this._startOffset()},_inHighRange:function(){return this.get("current_page")<this._highBoundary()},_highBoundary:function(){return this.pagesCount()-this._startOffset()},_startOffset:function(){return Math.floor(this.get("display_count")/2)},_rangeEnd:function(a){return Math.min(a+this.get("display_count"),this.pagesCount()+1)}})},{backbone:"backbone",underscore:"underscore"}],261:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("../../helpers/navigate-through-router"),g=a("./pagination.tpl");b.exports=d.extend({className:"Pagination",events:{"click .js-listItem":"_paginate"},initialize:function(a){if(this._routerModel=a.routerModel,this.router&&!this.model.hasUrl())throw new Error("since router is set the model must have a url method set too");this.template=a.template||g,this.model.bind("change",this.render,this)},render:function(){return this.model.shouldBeVisible()?(this.$el.html(this.template({m:this.model,pagesCount:this.model.pagesCount(),currentPage:this.model.get("current_page")})),this.$el.addClass(this.className),this.delegateEvents()):this.$el.html(""),this},_paginate:function(a){this._routerModel?f.apply(this,arguments):this.model.hasUrl()||this.killEvent(a);var b=e(a.target).data("page");this.model.set("current_page",b)}})},{"../../helpers/navigate-through-router":430,"./pagination.tpl":262,"backbone/core-view":454,jquery:"jquery"}],262:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="CDB-Text CDB-Size-medium u-altTextColor Pagination-label">\n  Page '+(null==(__t=currentPage)?"":_.escape(__t))+" of "+(null==(__t=pagesCount)?"":_.escape(__t))+'\n</span>\n<ul class="Pagination-list CDB-Text CDB-Size-medium">\n  ',m.pagesToDisplay().forEach(function(a){__p+="\n    ",__p+=a>0?'\n      <li class="Pagination-listItem '+(null==(__t=m.isCurrentPage(a)?"is-current":"")?"":_.escape(__t))+'">\n        <a class="Pagination-listItemInner Pagination-listItemInner--link js-listItem" href="'+(null==(__t=m.urlTo(a))?"":_.escape(__t))+'" data-page="'+(null==(__t=a)?"":_.escape(__t))+'">'+(null==(__t=a)?"":_.escape(__t))+"</a>\n      </li>\n    ":'\n      <li class="Pagination-listItem Pagination-listItem">\n        <span class="Pagination-listItemInner Pagination-listItemInner--more">&hellip;</span>\n      </li>\n    ',__p+="\n  "}),__p+="\n</ul>\n";return __p}},{underscore:"underscore"}],263:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=window.MutationObserver,g={top:8,bottom:8},h=function(a,b){var c={childList:!0,subtree:!0};if(f){var d=new f(b);return d.observe(a.get?a.get(0):a,c),d}},i=function(a){return a.closest(".js-perfect-scroll")},j=function(a,b,c){this.id=a,this.reference=b,this.popup=c,this.state={position:"bottom",scroll:0},c.attr("data-cid",a),c.attr("data-dialog",a)};j.prototype={append:function(a){this.mode=a;var b=this.popup.get(0),c=this.reference.get(0);"float"===a?document.body.appendChild(b):c.appendChild(b)},track:function(){"float"===this.mode&&(this.observer=h(this.popup,this.onChangeMutation.bind(this)),this.emitter=i(this.reference),this.repositionBinded=d.throttle(this.reposition.bind(this),15),this.emitter&&this.emitter.on("ps-scroll-x",this.repositionBinded).on("ps-scroll-y",this.repositionBinded),this.reposition())},onChangeMutation:function(a){d.each(a,function(a){var b=e(a.target),c=b.attr("data-cid");c||(c=b.closest("[data-cid]").attr("data-cid")),c===this.id&&this.repositionBinded()},this)},reposition:function(){if("float"===this.mode&&this.emitter){var a,b=this.emitter.get(0).scrollTop,c=e(window).height(),d=this.reference,f=this.popup,h=this.state,i=d.offset(),j=f.outerHeight(),k=i.top+d.outerHeight()+g.top,l=i.top-j-g.bottom;h.scroll===b?"top"===h.position?l<=0?(a=k,h.position="bottom"):a=l:k+j+g.bottom>=c?(a=l,h.position="top"):a=k:k+j+g.bottom>=c?(a=l,h.position="top"):(a=k,h.position="bottom"),a=a<0?g.top:Math.min(a,c-j-g.bottom),f.css({top:a,left:i.left}),h.scroll=b}},untrack:function(){this.observer&&this.observer.disconnect(),this.emitter&&this.emitter.off("ps-scroll-x",this.repositionBinded).off("ps-scroll-y",this.repositionBinded)},destroy:function(){this.untrack();var a=document.querySelector("[data-dialog="+this.id+"]");a&&a.parentNode.removeChild(a),this.emitter=null,this.reference=null,this.popup=null}},b.exports=j},{jquery:"jquery",underscore:"underscore"}],264:[function(a,b,c){var d=a("backbone/core-view"),e=a("./password-dialog.tpl"),f=a("underscore"),g=["onBack","onEdit"],h=27,i=13;b.exports=d.extend({className:"Editor-boxModal Editor-PrivacyDialog",events:{"click .js-back":"_onClickBack","keyup .js-input":"_onKeyUpInput"},initialize:function(a){f.each(g,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.$el.empty(),this.$el.html(e()),this},_onKeyUpInput:function(a){a.which===h&&this._onBack(),a.which===i&&this._onEdit&&this._onEdit(this.getValue())},_onClickBack:function(){this._onBack()},getValue:function(){return this.$(".js-input").val()}})},{"./password-dialog.tpl":265,"backbone/core-view":454,underscore:"underscore"}],265:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Box-modalHeader">\n  <ul class="CDB-Box-modalHeaderItem CDB-Box-modalHeaderItem--block CDB-Box-modalHeaderItem--paddingHorizontal">\n    <li class="CDB-ListDecoration-item CDB-ListDecoration-itemPadding--vertical">\n      <button class="u-actionTextColor js-back CDB-Size-medium u-rSpace">\n        <i class="CDB-IconFont CDB-IconFont-arrowPrev"></i>\n      </button>\n      <span class="CDB-Text CDB-Size-medium">\n        '+(null==(__t=_t("components.modals.publish.privacy.password.title"))?"":_.escape(__t))+'\n      </span>\n    </li>\n  </ul>\n</div>\n<ul class="CustomList-list js-customList">\n  <li class="Privacy-passwordField CustomList-item">\n    <input type="password" class="CDB-Text CDB-InputText js-input" placeholder="'+(null==(__t=_t("components.modals.publish.privacy.password.placeholder"))?"":_.escape(__t))+'">\n  </li>\n</ul>\n';return __p}},{underscore:"underscore"}],266:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Privacy-cta u-flex">\n  <svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n      <path d="M10.0946667,4.4109223 C10.8886667,4.1368747 11.6846667,3.80147316 12.0073333,3.4715253 C12.7866667,2.67392407 12.7866667,1.37662907 12.0073333,0.579027844 C11.2513333,-0.193350099 9.934,-0.192668389 9.17866667,0.579027844 C8.74133333,1.0262299 8.29266667,2.36033726 8,3.37608583 C7.70666667,2.36033726 7.25866667,1.0262299 6.82133333,0.579027844 C6.066,-0.193350099 4.748,-0.192668389 3.99266667,0.579027844 C3.21266667,1.37662907 3.21266667,2.67392407 3.99266667,3.4715253 C4.316,3.80147316 5.11133333,4.1368747 5.90533333,4.4109223 L0.333333333,4.4109223 C0.149333333,4.4109223 0,4.56362544 0,4.75177753 L0,7.47861934 C0,7.66677142 0.149333333,7.81947456 0.333333333,7.81947456 L0.666666667,7.81947456 L0.666666667,15.6591448 C0.666666667,15.8472969 0.816,16 1,16 L15,16 C15.184,16 15.3333333,15.8472969 15.3333333,15.6591448 L15.3333333,7.81947456 L15.6666667,7.81947456 C15.8506667,7.81947456 16,7.66677142 16,7.47861934 L16,4.75177753 C16,4.56362544 15.8506667,4.4109223 15.6666667,4.4109223 L10.0946667,4.4109223 Z M6,6.95652174 L6,4.86956522 L10,4.86956522 L10,6.95652174 L6,6.95652174 L6,6.95652174 Z M10,7.65217391 L10,15.3043478 L6,15.3043478 L6,7.65217391 L10,7.65217391 L10,7.65217391 Z M9.80833133,1.08822938 C10.0510474,0.834996985 10.3727426,0.695652174 10.7169115,0.695652174 C11.0597961,0.695652174 11.3821334,0.834996985 11.6248495,1.08755946 C12.1250502,1.6101025 12.1250502,2.46023983 11.6248495,2.98278288 C11.2729754,3.34990286 9.79227867,3.85636766 8.66666667,4.17391304 C8.97102496,2.99953105 9.45581507,1.45534937 9.80833133,1.08822938 L9.80833133,1.08822938 Z M4.37515049,1.08822938 C4.6178666,0.834996985 4.94020387,0.695652174 5.28373064,0.695652174 C5.6266153,0.695652174 5.94895256,0.834996985 6.19166867,1.08755946 C6.54354282,1.45467944 7.02833293,2.99886112 7.33333333,4.17391304 C6.20707922,3.85569773 4.72638253,3.34990286 4.37515049,2.98278288 C3.87494984,2.46090976 3.87494984,1.61077243 4.37515049,1.08822938 L4.37515049,1.08822938 Z M0.666666667,4.86956522 L5.33333333,4.86956522 L5.33333333,6.95652174 L1,6.95652174 L0.666666667,6.95652174 L0.666666667,4.86956522 L0.666666667,4.86956522 Z M1.33333333,7.65217391 L5.33333333,7.65217391 L5.33333333,15.3043478 L1.33333333,15.3043478 L1.33333333,7.65217391 L1.33333333,7.65217391 Z M14.6666667,15.3043478 L10.6666667,15.3043478 L10.6666667,7.65217391 L14.6666667,7.65217391 L14.6666667,15.3043478 L14.6666667,15.3043478 Z M15.3333333,6.95652174 L15,6.95652174 L10.6666667,6.95652174 L10.6666667,4.86956522 L15.3333333,4.86956522 L15.3333333,6.95652174 L15.3333333,6.95652174 Z" id="Shape" fill="#9BC63B"></path>\n    </g>\n  </svg>\n  <div class="CDB-Text CDB-Size CDB-Size-small u-lSpace--xl">\n    <h3 class="u-secondaryTextColor">'+(null==(__t=_t("components.modals.publish.privacy.cta.title"))?"":_.escape(__t))+'</h3>\n    <a href="'+(null==(__t=upgradeURL)?"":_.escape(__t))+'">\n      '+(null==(__t=_t("components.modals.publish.privacy.cta.desc-"+(showTrial?"trial":"notrial")))?"":_.escape(__t))+"\n    </a>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],267:[function(a,b,c){var d=a("backbone/core-view"),e=a("../custom-list/custom-list-view"),f=a("../custom-list/custom-list-item-view"),g=a("./privacy-cta.tpl"),h=a("underscore"),i=["model","collection","userModel","configModel"];b.exports=d.extend({className:"Editor-boxModal Privacy-dialog",initialize:function(a){h.each(i,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this)},render:function(){return this.$el.empty(),this.clearSubViews(),this._renderList(),this},_renderList:function(){var a=this._collection.where({disabled:!0}),b=this._configModel.get("cartodb_com_hosted"),c=this._configModel.get("upgrade_url"),d=new e({model:this._model,collection:this._collection,ItemView:f});this.$el.append(d.render().el),this.addView(d),a.length>0&&!b&&c&&this.$el.append(g({upgradeURL:c,showTrial:this._userModel.canStartTrial()}))}})},{"../custom-list/custom-list-item-view":26,"../custom-list/custom-list-view":33,"./privacy-cta.tpl":266,"backbone/core-view":454,underscore:"underscore"}],268:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("backbone/core-view"),g=a("./privacy-dialog-view"),h=a("./password-dialog-view"),i=a("../tab-pane/tab-pane-view"),j=a("../tab-pane/tab-pane-collection"),k=a("../custom-list/custom-list-collection"),l=a("./privacy-dropdown.tpl"),m=a("./tab-pane.tpl"),n=a("underscore"),o=27,p=["visDefinitionModel","userModel","privacyCollection","configModel"],q={public:"green",link:"orange",password:"orange-dark",private:"red"};b.exports=f.extend({events:{"click .js-toggle":"_onToggleDialogClicked"},initialize:function(a){n.each(p,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._triggerElementID="toggle"+this.cid,this.model=new e.Model({privacy:a.visDefinitionModel.get("privacy"),state:"show"}),this._onEscapePressed=this._onEscapePressed.bind(this),this._onDocumentElementClicked=this._onDocumentElementClicked.bind(this),this._configPrivacyCollection(),this._configPanes(),this._initBinds()},render:function(){var a=this.model.get("privacy"),b=q[a.toLowerCase()];return this.clearSubViews(),this._hideDialog(),this.$el.html(l({privacy:a,cssClass:b,isLoading:"loading"===this.model.get("state")})),this._initViews(),this},_initBinds:function(){this._customCollection.on("change:selected",function(a){a.get("disabled")||("password"===a.get("val")?this._showPasswordDialog():(this._onToggleDialogClicked(),this._setPrivacy(a.get("val"))))},this),this.add_related_model(this._customCollection),this.model.on("change:privacy",this._savePrivacy,this),this.model.on("change:state",this.render,this),this.add_related_model(this.model)},_makePrivacyDialog:function(){return new g({model:this.model,collection:this._customCollection,userModel:this._userModel,configModel:this._configModel})},_makePasswordDialog:function(){return new h({onBack:this._showPrivacyDialog.bind(this),onEdit:this._setPassword.bind(this)})},_setPrivacy:function(a){this.model.set({privacy:a})},_setPassword:function(a){""!==a&&(this._privacyCollection.passwordOption().set({password:a}),this.model.set({privacy:"password",password:a}))},_savePrivacy:function(){var a=this,b=this.model.get("privacy").toUpperCase(),c=this._visDefinitionModel;this.model.set({state:"loading"}),this._privacyCollection.searchByPrivacy(b).saveToVis(c,{success:function(){a.model.set({state:"show"})},error:function(){a.model.set({state:"error"})}})},_transformPrivacyOptions:function(){return this._privacyCollection.map(function(a){return{label:a.get("title"),val:a.get("privacy").toLowerCase(),disabled:a.get("disabled"),selected:a.get("selected"),renderOptions:{cssClass:a.get("cssClass")}}}).filter(Boolean)},_configPrivacyCollection:function(){var a=this._transformPrivacyOptions();this._customCollection=new k(a)},_configPanes:function(){var a=this,b=[{createContentView:a._showNoneDialog},{createContentView:a._makePrivacyDialog.bind(a)},{createContentView:a._makePasswordDialog.bind(a)}];this._collectionPane=new j(b)},_showNoneDialog:function(){return!1},_showPasswordDialog:function(){this._collectionPane.at(2).set({selected:!0})},_showPrivacyDialog:function(){this._customCollection.each(function(a){a.set({selected:!1},{silent:!0})}),this._collectionPane.at(1).set({selected:!0})},_onToggleDialogClicked:function(){this._isDialogVisible()?this._hideDialog():(this._initDocumentBinds(),this._showPrivacyDialog())},_isDialogVisible:function(){return this._collectionPane.at(0).get("selected")===!1},_hideDialog:function(){this._destroyDocumentBinds(),this._collectionPane.at(0).set({selected:!0})},_showDialog:function(){this._showPrivacyDialog()},_initViews:function(){var a=new i({collection:this._collectionPane,template:m});this.$(".js-dialog").append(a.render().$el),this.addView(a)},_initDocumentBinds:function(){d(document).on("keydown",this._onEscapePressed),d(document).on("mousedown",this._onDocumentElementClicked)},_destroyDocumentBinds:function(){d(document).off("keydown",this._onEscapePressed),d(document).off("mousedown",this._onDocumentElementClicked)},_onEscapePressed:function(a){a.which===o&&this._hideDialog()},_onDocumentElementClicked:function(a){var b=d(a.target);0===b.closest(this.$el).length&&0===b.closest(d("#"+this._triggerElementID)).length&&this._hideDialog()},clean:function(){this._destroyDocumentBinds(),f.prototype.clean.apply(this)}})},{"../custom-list/custom-list-collection":23,"../tab-pane/tab-pane-collection":277,"../tab-pane/tab-pane-view":285,"./password-dialog-view":264,"./privacy-dialog-view":267,"./privacy-dropdown.tpl":269,"./tab-pane.tpl":270,backbone:"backbone","backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],269:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Privacy-dropdown">\n  <button class="Privacy-dropdownTrigger Tag Tag-fill Tag-fill--'+(null==(__t=cssClass)?"":_.escape(__t))+' CDB-Text CDB-Size-small u-upperCase js-toggle">\n    ',__p+=isLoading?'\n      <div class="CDB-LoaderIcon CDB-LoaderIcon--small u-flex">\n        <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">\n          <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>\n        </svg>\n      </div>\n    ':"\n      "+(null==(__t=privacy)?"":_.escape(__t))+"\n    ",__p+='\n  </button>\n\n  <div class="js-dialog"></div>\n</div>\n';return __p}},{underscore:"underscore"}],270:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Tab-paneContent js-content"></div>\n';return __p}},{underscore:"underscore"}],271:[function(a,b,c){var d=a("backbone/core-view"),e=a("perfect-scrollbar"),f=a("./scroll.tpl"),g=window.MutationObserver;b.exports=d.extend({tagName:"div",className:"ScrollView",initialize:function(a){if(!a.createContentView)throw new Error("A factory createContentView function is required");this.options=a||{},this._type=a.type||"vertical",this._maxScroll=0,this._bindedCheckShadows=this._checkShadows.bind(this)},render:function(){
this.clearSubViews(),this._html();var a=this.options.createContentView.call(this);return this._contentContainer().append(a.render().el),this.addView(a),this._applyScroll(),this._updateScrollWhenExist(),this},_html:function(){this.$el.html(f({type:this._type})),"horizontal"===this._type&&this.$el.addClass("ScrollView--horizontal")},_contentContainer:function(){return this.$(".js-content")},_wrapperContainer:function(){return this.$(".js-wrapper")},_updateScrollWhenExist:function(){if(g){var a=document.body,b=this._wrapperContainer().get(0),c=function(){a.contains(b)&&(e.update(b),d.disconnect())},d=new g(c);c();var f={subtree:!0,childList:!0};d.observe(a,f)}},_applyScroll:function(){e.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,suppressScrollX:"vertical"===this._type,suppressScrollY:"horizontal"===this._type}),this._bindScroll()},_bindScroll:function(){this._wrapperContainer().on("ps-dom-change",this._bindedCheckShadows).on("ps-x-reach-start",this._bindedCheckShadows).on("ps-x-reach-end",this._bindedCheckShadows).on("ps-y-reach-start",this._bindedCheckShadows).on("ps-y-reach-end",this._bindedCheckShadows).on("ps-scroll-x",this._bindedCheckShadows).on("ps-scroll-y",this._bindedCheckShadows)},_unbindScroll:function(){this._wrapperContainer().off("ps-dom-change",this._bindedCheckShadows).off("ps-x-reach-start",this._bindedCheckShadows).off("ps-x-reach-end",this._bindedCheckShadows).off("ps-y-reach-start",this._bindedCheckShadows).off("ps-y-reach-end",this._bindedCheckShadows).off("ps-scroll-x",this._bindedCheckShadows).off("ps-scroll-y",this._bindedCheckShadows)},_checkShadows:function(){var a,b,c,d,e;"horizontal"===this._type?(a=this._wrapperContainer().scrollLeft(),b=this._wrapperContainer().get(0).scrollWidth,c=this._wrapperContainer().outerWidth(),e=b-c,this.$("> .js-leftShadow").toggleClass("is-visible",a>0),this.$("> .js-rightShadow").toggleClass("is-visible",a<e)):(a=this._wrapperContainer().scrollTop(),b=this._wrapperContainer().get(0).scrollHeight,d=this._wrapperContainer().outerHeight(),e=b-d,this.$("> .js-topShadow").toggleClass("is-visible",a>0),this.$("> .js-bottomShadow").toggleClass("is-visible",a<e))},destroyScroll:function(){this._unbindScroll(),e.destroy(this._wrapperContainer().get(0))},clean:function(){this.destroyScroll(),d.prototype.clean.apply(this,arguments)}})},{"./scroll.tpl":272,"backbone/core-view":454,"perfect-scrollbar":"perfect-scrollbar"}],272:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",__p+="vertical"===type?'\n<div class="ScrollView-shadow ScrollView-shadow--top js-topShadow"></div>\n<div class="ScrollView-shadow ScrollView-shadow--bottom js-bottomShadow"></div>\n':'\n<div class="Carousel-shadow Carousel-shadow--left js-leftShadow"></div>\n<div class="Carousel-shadow Carousel-shadow--right js-rightShadow"></div>\n',__p+='\n<div class="ScrollView-wrapper js-wrapper js-perfect-scroll">\n  <div class="ScrollView-content js-content"></div>\n</div>\n';return __p}},{underscore:"underscore"}],273:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{position:0},initialize:function(a,b){this.stackLayoutItems=b.stackLayoutItems},goToStep:function(a){var b=this.stackLayoutItems.size();if(a>=b)throw new Error("There is no "+a+" stack view in the collection");this.set({position:a},{silent:!0}),this._rememberStep.apply(this,arguments),this._triggerPositionChanged(a,Array.prototype.slice.call(arguments,1))},nextStep:function(){var a=this.get("position"),b=++a;this.goToStep.apply(this,Array.prototype.concat.apply([b],arguments))},prevStep:function(){var a=this.get("position"),b=--a;this.goToStep.apply(this,Array.prototype.concat.apply([b],arguments))},goBack:function(){this._goBackToArguments&&this.goToStep.apply(this,this._goBackToArguments)},_triggerPositionChanged:function(a,b){this.trigger("positionChanged",a,Array.prototype.slice.call(b))},_rememberStep:function(){this._goBackToArguments=this._lastStepArguments||[0],this._lastStepArguments=arguments}})},{backbone:"backbone"}],274:[function(a,b,c){var d=a("backbone/core-view"),e=a("./stack-layout-model"),f=a("underscore");b.exports=d.extend({initialize:function(a){if(!this.collection||!this.collection.size())throw new Error("A collection of stack views should be provided");this.model=new e({},{stackLayoutItems:this.collection}),this.model.bind("positionChanged",this._onPositionChange,this)},render:function(){return this.clearSubViews(),this._genNewStackView(),this},_onPositionChange:function(a,b){this._removeOldStackView(),this._genNewStackView(f.flatten(b)),this.trigger("positionChanged",this)},getCurrentPosition:function(){return this.model.get("position")},_removeOldStackView:function(){var a=this._getCurrentView();a&&(a.clean(),this.removeView(a))},_getCurrentView:function(){for(var a in this._subviews)break;return this._subviews[a]},_genNewStackView:function(){var a=[this.model].concat([f.flatten(arguments)]),b=this.collection.at(this.model.get("position")).get("createStackView").apply(this,a);this.$el.html(b.render().el),this.addView(b)}})},{"./stack-layout-model":273,"backbone/core-view":454,underscore:"underscore"}],275:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./tab-pane-view.js"),g=a("./tab-pane-collection"),h=a("./tab-pane-mixed-view"),i=a("./tab-pane-color-view");b.exports=function(a,b){b=b||{};var c=b.tabPaneItemLabelOptions,j=a.map(function(a){return["label","createContentView"].forEach(function(b){if(!a[b])throw new Error(b+" should be provided")}),{name:a.name,selected:a.selected,label:a.label,color:a.color,kind:a.kind,selectedChild:a.selectedChild,createButtonView:function(){return"color"===a.type?new i(d.extend({model:this},c)):new h(d.extend({model:this,type:a.type},c))},createContentView:function(){return a.createContentView&&a.createContentView()||new e}}});this.collection=new g(j);var k=b.tabPaneOptions;return new f(d.extend({collection:this.collection},k))}},{"./tab-pane-collection":277,"./tab-pane-color-view":278,"./tab-pane-mixed-view":284,"./tab-pane-view.js":285,"backbone/core-view":454,underscore:"underscore"}],276:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./tab-pane-view.js"),g=a("./tab-pane-collection"),h=a("./tab-pane-label-view");b.exports=function(a,b){b=b||{};var c=b.tabPaneItemLabelOptions,i=a.map(function(a){return["label","createContentView"].forEach(function(b){if(!a[b])throw new Error(b+" should be provided")}),{name:a.name,selected:a.selected,label:a.label,selectedChild:a.selectedChild,createButtonView:function(){return new h(d.extend({model:this},c))},createContentView:function(){return a.createContentView&&a.createContentView()||new e}}});this.collection=new g(i);var j=b.tabPaneOptions;return new f(d.extend({collection:this.collection},j))}},{"./tab-pane-collection":277,"./tab-pane-label-view":282,"./tab-pane-view.js":285,"backbone/core-view":454,underscore:"underscore"}],277:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Collection.extend({constructor:function(a,b){b=e.extend(b||{},{silent:!1}),d.Collection.prototype.constructor.call(this,a,b)},initialize:function(){this.bind("reset",this._setSelected,this),this.bind("change:selected",this._onSelectedChange,this),this._setSelected()},getSelected:function(){return this.find(function(a){return a.get("selected")})},_setSelected:function(){var a=this.getSelected();!a&&this.size()>0&&this.at(0).set("selected",!0)},_onSelectedChange:function(a,b){b&&this.each(function(b){b!==a&&b.set("selected",!1)},this)},select:function(a,b){var c=this.find(function(c){return c.get(a)===b},this);c&&c.set("selected",!0)}})},{backbone:"backbone",underscore:"underscore"}],278:[function(a,b,c){var d=a("backbone/core-view"),e=a("./tab-pane-color.tpl");b.exports=d.extend({className:"Label",initialize:function(){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:label",this.render,this)},render:function(){return this.clearSubViews(),this.$el.html(e({color:this.model.get("label"),selectedChild:this.model.get("selectedChild")||""})),this}})},{"./tab-pane-color.tpl":279,"backbone/core-view":454}],279:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ColorBar ColorBar--inline" style="background-color: '+(null==(__t=color)?"":_.escape(__t))+';"></div> ',selectedChild&&(__p+=' <span class="CDB-NavSubmenu-status js-NavSubmenu-status u-hintTextColor">'+(null==(__t=selectedChild)?"":_.escape(__t))+"</span>"),__p+="\n";return __p}},{underscore:"underscore"}],280:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","text"===type?(__p+="\n"+(null==(__t=label)?"":_.escape(__t)),selectedChild&&(__p+=' <span class="CDB-NavSubmenu-status js-NavSubmenu-status u-hintTextColor">'+(null==(__t=selectedChild)?"":_.escape(__t))+"</span>"),__p+="\n"):__p+="custom-marker"===kind?"\n<div class='Editor-categoryImagesTag CDB-Text CDB-FontSize-small u-altTextColor is-semibold u-upperCase'>"+(null==(__t=_t("form-components.editors.fill.input-color.img"))?"":_.escape(__t))+"</div>\n":'\n<div class="Tab-paneLabelImageContainer js-image-container"></div>\n',__p+="\n";return __p}},{underscore:"underscore"}],281:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({tagName:"button",events:{click:"_onButtonClicked"},initialize:function(){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:selected",this._onChangeSelected,this)},render:function(){var a=this.model.get("createButtonView").call(this.model);return this.addView(a),this.$el.append(a.render().$el),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this},_onChangeSelected:function(){this.$el.toggleClass("is-selected",!!this.model.get("selected"))},_onButtonClicked:function(a){a.preventDefault(),this.model.set("selected",!0)}})},{"backbone/core-view":454}],282:[function(a,b,c){var d=a("backbone/core-view"),e=a("./tab-pane-label.tpl");b.exports=d.extend({className:"Label",initialize:function(){if(!this.model)throw new Error("A model should be provided")},render:function(){return this.$el.html(e({label:this.model.get("label"),selectedChild:this.model.get("selectedChild")||""})),this}})},{"./tab-pane-label.tpl":283,"backbone/core-view":454}],283:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+(null==(__t=label)?"":_.escape(__t)),selectedChild&&(__p+=' <span class="CDB-NavSubmenu-status js-NavSubmenu-status u-hintTextColor">'+(null==(__t=selectedChild)?"":_.escape(__t))+"</span>"),__p+="\n";return __p}},{underscore:"underscore"}],284:[function(a,b,c){var d=a("./tab-pane-file.tpl"),e=a("backbone/core-view"),f=a("../img-loader-view");b.exports=e.extend({tagName:"i",className:"CDB-IconFont",initialize:function(a){if(!this.model)throw new Error("A model should be provided");this.model.bind("change:label",this.render,this),this.model.bind("change:color",this._updateColor,this)},render:function(){this.clearSubViews();var a=this._getLabelType();return this.$el.html(d({type:a,label:this.model.get("label"),kind:this.model.get("kind"),selectedChild:this.model.get("selectedChild")||""})),"file"===a&&this._loadImages(),this},_loadImages:function(){this.iconView=new f({imageClass:"Tab-paneLabelImage",imageUrl:this._getImageURL(),color:this.model.get("color")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_updateColor:function(){this.iconView&&this.iconView.updateImageColor(this.model.get("color"))},_getLabelType:function(){var a=this.model.get("label");return a&&a.match(/^http/)?"file":"text"},_getImageURL:function(){return this.model.get("label")}})},{"../img-loader-view":180,"./tab-pane-file.tpl":280,"backbone/core-view":454}],285:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./tab-pane-item-view.js"),g=a("./tab-pane.tpl");b.exports=e.extend({className:"Tab-pane",initialize:function(a){if(!this.collection)throw new Error("A TabPaneCollection should be provided");this._tabPaneItemOptions=this.options.tabPaneItemOptions,this._createContentKey=this.options.createContentKey||"createContentView",this.template=this.options.template||g,this.collection.bind("change:selected",this._renderSelected,this)},render:function(){this.clearSubViews(),this.$el.empty(),this.$el.html(this.template(this.options)),this._renderCollection();var a=this.getSelectedTabPane();return a&&this._renderSelected(a,!0),this},getSelectedTabPane:function(){return this.collection.getSelected()},getTabPane:function(a){return d.first(this.collection.where({name:a}))},getSelectedTabPaneName:function(){var a=this.getSelectedTabPane();return a?a.get("name"):null},setSelectedTabPaneByName:function(a){return this.collection.select("name",a)},_renderSelected:function(a,b){b&&(this._selectedView&&(this._selectedView.clean(),this.removeView(this._selectedView)),this._selectedView=this._renderTabPaneContentView(a))},_renderCollection:function(){this.collection.each(function(a){a.get("createButtonView")&&this._renderTabPaneItemView(a)},this)},_renderTabPaneItemView:function(a){var b=new f(d.extend({model:a},this._tabPaneItemOptions));this.addView(b),this.$(".js-menu").append(b.render().el)},_renderTabPaneContentView:function(a){var b=a.get(this._createContentKey).call(a);return b&&(this.addView(b),this.$(".js-content").append(b.render().el)),b},changeStyleMenu:function(a){this.$(".js-theme").toggleClass("is-dark",a.isEditing())}})},{"./tab-pane-item-view.js":281,"./tab-pane.tpl":286,"backbone/core-view":454,underscore:"underscore"}],286:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-menu"></div>\n<div class="Tab-paneContent js-content"></div>\n';return __p}},{underscore:"underscore"}],287:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("components.table.rows.destroy.title",{cartodb_id:cartodb_id}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("components.table.rows.destroy.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.rows.destroy.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.rows.destroy.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],288:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<td class="Table-cellItem" data-attribute="'+(null==(__t=columnName)?"":_.escape(__t))+'" title="'+(null==(__t=value)?"":_.escape(__t))+"\" data-clipboard-text='"+(null==(__t=value)?"":_.escape(__t))+"'>\n  <div class=\"\n      Table-cell u-flex u-justifySpace\n      "+(null==(__t="cartodb_id"===columnName||"geometry"===type&&"point"!==geometry?"Table-cell--short":"")?"":_.escape(__t))+'\n    ">\n    <p class="\n      CDB-Text CDB-Size-medium\n      u-ellipsis u-rSpace--xl\n      '+(null==(__t="number"===type&&"cartodb_id"!==columnName?"is-number":"")?"":_.escape(__t))+"\n      "+(null==(__t=null===value?"is-null":"")?"":_.escape(__t))+"\n      "+(null==(__t="cartodb_id"===columnName?"is-cartodbId":"")?"":_.escape(__t))+'\n      js-value\n    ">\n      '+(null==(__t=null===value?"null":formattedValue)?"":_.escape(__t))+"\n    </p>\n\n    ","cartodb_id"!==columnName&&(__p+='\n      <button class="CDB-Shape-threePoints is-blue is-small Table-cellItemOptions js-cellOptions">\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n      </button>\n    '),__p+="\n  </div>\n</td>\n";return __p}},{underscore:"underscore"}],289:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./table-body-cell.tpl"),g=a("../../../helpers/point-geojson-parser"),h={geometry:g};b.exports=d.extend({className:"Table-row",tagName:"tr",options:{simpleGeometry:""},initialize:function(a){if(!a.columnsCollection)throw new Error("columnsCollection is required");if(!a.tableViewModel)throw new Error("tableViewModel is required");this._columnsCollection=a.columnsCollection,this._tableViewModel=a.tableViewModel,this.el.setAttribute("data-model",this.model.cid),this._initBinds()},render:function(){return this.$el.empty(),this._generateRowsHTML(),this},_initBinds:function(){this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this)},_generateRowsHTML:function(){for(var a=[],b=0,c=this._columnsCollection.size();b<c;b++){var d=this._columnsCollection.at(b),e=d.get("name");("the_geom_webmercator"!==e||this._tableViewModel.isDisabled()&&"the_geom_webmercator"===e)&&(a[b]=this._generateCellHTML(e))}this.el.innerHTML=a.join("")},_generateCellHTML:function(a){var b=this.options.simpleGeometry,c=e.first(this._columnsCollection.where({name:a})),d=c.get("type"),g=this.model.get(a),i=g;return"geometry"===d?i="point"===b?h[d](g):b&&b.charAt(0).toUpperCase()+b.slice(1):h[d]&&(i=h[d](g)),f({value:g,formattedValue:i,type:d,columnName:a,geometry:b})}})},{"../../../helpers/point-geojson-parser":431,"./table-body-cell.tpl":288,"backbone/core-view":454,underscore:"underscore"}],290:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("underscore"),g=a("clipboard"),h=a("./table-body-row-view"),i=a("../../context-menu/context-menu-view"),j=a("../../custom-list/custom-list-collection"),k=a("../operations/table-add-row"),l=a("../operations/table-remove-row"),m=a("../operations/table-edit-cell"),n=a("../../modals/confirmation/modal-confirmation-view"),o=a("../paginator/table-paginator-view"),p=a("./table-body.tpl"),q=a("../../loading/render-loading"),r=a("../../error/error-view"),s=a("./table-no-rows.tpl"),t=a("../editors/editors-service-model"),u=a("../editors/types/editor-model"),v=a("../../../helpers/error-parser"),w=a("../../../helpers/magic-positioner"),x=a("../../../helpers/required-opts"),y={string:a("../editors/types/editor-string-view"),number:a("../editors/types/editor-base-view"),boolean:a("../editors/types/editor-boolean-view"),date:a("../editors/types/editor-date-view"),default:a("../editors/types/editor-string-view")},z=["columnsCollection","modals","queryGeometryModel","querySchemaModel","rowsCollection","tableViewModel"];b.exports=d.extend({className:"Table-body",tagName:"div",events:{click:"_onClick",dblclick:"_onDblClick"},initialize:function(a){x(a,z,this),this._editors=new t,this._closeEditor=this._closeEditor.bind(this),this._hideContextMenu=this._hideContextMenu.bind(this),this._initBinds()},render:function(){return this.clearSubViews(),this._destroyScrollBinding(),this.$el.empty(),!this._querySchemaModel.isFetched()||this._queryGeometryModel.isFetching()||this._rowsCollection.isFetching()?this._renderQueryState():this._rowsCollection.size()?(this.$el.html(p()),this._rowsCollection.each(this._renderBodyRow,this),this._initPaginator()):this._renderNoRows(),this.$el.toggleClass("Table-body--relative",!!this._tableViewModel.get("relativePositionated")),this},_initBinds:function(){this._queryGeometryModel.bind("change:status",this.render,this),this._querySchemaModel.bind("change:status",this.render,this),this._rowsCollection.bind("reset",f.debounce(this.render.bind(this),20),this),this._rowsCollection.bind("add",function(a){1===this._rowsCollection.size()?this.render():(this._renderBodyRow(a),this._scrollToBottom())},this),this._rowsCollection.bind("remove",this._onRemoveRow,this),this._rowsCollection.bind("fail",function(a,b){(!b||b&&"abort"!==b.statusText)&&this._renderError(v(b))},this),this.add_related_model(this._queryGeometryModel),this.add_related_model(this._querySchemaModel),this.add_related_model(this._rowsCollection)},_renderQueryState:function(){var a=this._querySchemaModel.get("status"),b=this._querySchemaModel.get("ready"),c=this._queryGeometryModel.get("status");b&&"unavailable"===a&&"unavailable"===c?this._renderError(this._querySchemaModel.get("query_errors")):this._renderLoading()},_renderLoading:function(){this.$el.html(q({title:_t("components.table.rows.loading.title")}))},_renderError:function(a){var b=new r({title:_t("components.table.rows.error.title"),desc:a||_t("components.table.rows.error.desc")});this.addView(b),this.$el.html(b.render().el)},_renderNoRows:function(){this.$el.html(s({page:this._tableViewModel.get("page"),customQuery:this._tableViewModel.isCustomQueryApplied()}))},_initPaginator:function(){var a=new o({rowsCollection:this._rowsCollection,tableViewModel:this._tableViewModel}),b=e("body");this._tableViewModel.get("relativePositionated")&&(b=this.$el.closest(".Table").parent()),b.append(a.render().el),this.addView(a)},_initScrollBinding:function(){e(".Table").scroll(this._hideContextMenu),this.$(".js-tbody").scroll(this._hideContextMenu)},_destroyScrollBinding:function(){e(".Table").off("scroll",this._hideContextMenu),this.$(".js-tbody").off("scroll",this._hideContextMenu)},_renderBodyRow:function(a){var b=new h({model:a,columnsCollection:this._columnsCollection,simpleGeometry:this._queryGeometryModel.get("simple_geom"),tableViewModel:this._tableViewModel});this.addView(b),this.$(".js-tbody").append(b.render().el)},_onRemoveRow:function(){if(!this._rowsCollection.size()){this._rowsCollection.resetFetch();var a=this._tableViewModel.get("page");a>0?this._tableViewModel.set("page",a-1):this.render()}},_hasContextMenu:function(){return this._menuView},_hideContextMenu:function(){this._unhighlightCell(),this._destroyScrollBinding(),this._menuView.collection.unbind(null,null,this),this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_highlightCell:function(a,b){a.addClass("is-highlighted"),b.addClass("is-highlighted")},_unhighlightCell:function(){this.$(".Table-cellItem.is-highlighted, .Table-row.is-highlighted").removeClass("is-highlighted")},_showContextMenu:function(a){var b=this,c={x:a.clientX,y:a.clientY},d=e(a.target).closest(".Table-row"),f=e(a.target).closest(".Table-cellItem"),g=d.data("model"),h=f.data("attribute"),k=b._rowsCollection.get({cid:g}),l=[];if(l.push({label:_t("components.table.rows.options.copy"),val:"copy",action:function(){b._copyValue(f)}}),this._tableViewModel.isDisabled()||(l=[{label:_t("components.table.rows.options.edit"),val:"edit",action:function(){b._editCell(k,h)}},{label:_t("components.table.rows.options.create"),val:"create",action:function(){b._addRow()}}].concat(l),l.push({label:_t("components.table.rows.options.delete"),val:"delete",destructive:!0,action:function(){b._removeRow(k)}})),!l.length)return!1;var m=new j(l);this._menuView=new i({className:"Table-rowMenu "+i.prototype.className,collection:m,triggerElementID:g,position:c}),this._menuView.$el.css(w({parentView:e("body"),posX:c.x,posY:c.y})),m.bind("change:selected",function(a){var b=a.get("action");b&&b()},this),this._menuView.model.bind("change:visible",function(a,b){this._hasContextMenu()&&!b&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView),this._highlightCell(f,d),this._initScrollBinding()},_onClick:function(a){var b=e(a.target).hasClass("js-cellOptions");b&&(this._hasContextMenu()?this._hideContextMenu():this._showContextMenu(a))},_onDblClick:function(a){var b=e(a.target).closest(".Table-cellItem"),c=e(a.target).hasClass("js-cellOptions");if(b&&!c){var d=b.closest(".Table-row"),f=d.data("model"),g=b.data("attribute"),h=this._rowsCollection.get({cid:f});!this._tableViewModel.isDisabled()&&h&&g&&"cartodb_id"!==g&&this._editCell(h,g)}},_copyValue:function(a){this._clipboard=new g(a.get(0)),a.click(),this._clipboard.destroy()},_addRow:function(){k({rowsCollection:this._rowsCollection})},_initEditorScrollBinding:function(){e(".Table").scroll(this._closeEditor),this.$(".js-tbody").scroll(this._closeEditor)},_destroyEditorScrollBinding:function(){e(".Table").unbind("scroll",this._closeEditor),this.$(".js-tbody").unbind("scroll",this._closeEditor)},_closeEditor:function(){this._unhighlightCell(),this._destroyEditorScrollBinding(),this._editors.unbind(null,null,this),this._editors.destroy()},_saveValue:function(a,b,c){a.get(b)!==c&&m({rowModel:a,attribute:b,newValue:c})},_doCellEdition:function(a,b){var c=this.$('[data-model="'+a.cid+'"]'),d=c.find('[data-attribute="'+b+'"]'),e=d.find(".js-cellOptions"),g=f.first(this._columnsCollection.where({name:b})),h=g.get("type");this._highlightCell(d,c),this._initEditorScrollBinding();var i=new u({type:h,value:a.get(b)});this._editors.bind("destroyedEditor",this._closeEditor,this),this._editors.bind("confirmedEditor",function(){i.isValid()&&this._saveValue(a,b,i.get("value"))},this);var j=e.offset();d.index()>1&&(j.right=window.innerWidth-j.left,delete j.left),this._rowsCollection.size()>4&&c.index()+2>=this._rowsCollection.size()-1?(j.bottom=window.innerHeight-j.top,delete j.top):j.top=j.top+20;var k=y[h];k||(k=y.default),this._editors.create(function(a){return new k({editorModel:a,model:i})},j)},_editCell:function(a,b){var c=this._doCellEdition.bind(this,a,b);a.fetchRowIfGeomIsNotLoaded(c)},_removeRow:function(b){var c=this;this._modals.create(function(d){return new n({modalModel:d,template:a("./modals-templates/remove-table-row.tpl"),renderOpts:{cartodb_id:b.get("cartodb_id")},loadingTitle:_t("components.table.rows.destroy.loading",{cartodb_id:b.get("cartodb_id")}),runAction:function(){l({tableViewModel:c._tableViewModel,rowModel:b,onSuccess:function(){d.destroy()},onError:function(a){d.destroy()}})}})})},_scrollToBottom:function(){var a=this.$(".js-tbody").get(0).scrollHeight;this.$(".js-tbody").animate({scrollTop:a},"slow")},clean:function(){this._destroyScrollBinding(),d.prototype.clean.apply(this)}})},{"../../../helpers/error-parser":426,"../../../helpers/magic-positioner":428,"../../../helpers/required-opts":432,"../../context-menu/context-menu-view":15,"../../custom-list/custom-list-collection":23,"../../error/error-view":37,"../../loading/render-loading":187,"../../modals/confirmation/modal-confirmation-view":190,"../editors/editors-service-model":295,"../editors/types/editor-base-view":296,"../editors/types/editor-boolean-view":297,"../editors/types/editor-date-view":300,"../editors/types/editor-model":301,"../editors/types/editor-string-view":302,"../operations/table-add-row":313,"../operations/table-edit-cell":315,"../operations/table-remove-row":317,"../paginator/table-paginator-view":320,"./modals-templates/remove-table-row.tpl":287,"./table-body-row-view":289,"./table-body.tpl":291,"./table-no-rows.tpl":292,"backbone/core-view":454,clipboard:"clipboard",jquery:"jquery",underscore:"underscore"}],291:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<table>\n  <tbody class="js-tbody"></tbody>\n</table>\n';return __p}},{underscore:"underscore"}],292:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="IntermediateInfo">\n  <div class="LayoutIcon">\n    <i class="CDB-IconFont CDB-IconFont-rows"></i>\n  </div>\n  <h3 class="CDB-Text CDB-Size-large u-mainTextColor u-secondaryTextColor u-bSpace--m u-tSpace-xl">\n    ',__p+=0!==page?"\n      "+(null==(__t=_t("components.table.rows.result.no-page-title",{page:page}))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.table.rows.result.no-results-title"))?"":_.escape(__t))+"\n    ",__p+='\n  </h3>\n  <p class="CDB-Text CDB-Size-medium u-altTextColor">\n    ',__p+=0!==page?"\n      "+(null==(__t=_t("components.table.rows.result.no-page-desc",{page:page}))?"":_.escape(__t))+"\n    ":"\n      "+(null==(__t=_t("components.table.rows.result.no-results-desc",{addRow:_t("components.table.rows.result.no-results-button")}))?"":_.escape(__t))+"\n    ",__p+="\n  </p>\n</div>\n";return __p}},{underscore:"underscore"}],293:[function(a,b,c){var d=a("backbone"),e=a("backbone/core-view");b.exports=d.Model.extend({defaults:{show:!0,createContentView:function(){return new e}},createContentView:function(){return this.get("createContentView")(this)},show:function(){this.set("show",!0)},hide:function(){this.set("show",!1)},isHidden:function(){return!this.get("show")},confirm:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["confirm"].concat(a))},destroy:function(){var a=Array.prototype.slice.call(arguments);this.trigger.apply(this,["destroy"].concat(a))}})},{backbone:"backbone","backbone/core-view":454}],294:[function(a,b,c){var d=a("backbone/core-view");b.exports=d.extend({className:"CDB-Box-modal Table-editor",initialize:function(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},render:function(){this.clearSubViews();var a=this.model.createContentView();return this.addView(a),a.render(),this.$el.append(a.el),this.$el.css(this.options.position),this},show:function(){this.model.show()},hide:function(){this.model.hide()},destroy:function(){this.model.destroy()},_onShowChange:function(a,b){this.$el[b?"show":"hide"]()},_onClose:function(){this.destroy()},_onDestroy:function(){this.hide(),this.clean()}})},{"backbone/core-view":454}],295:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone"),g=a("./editor-view"),h=a("./editor-view-model"),i=27,j="destroyedEditor",k="confirmedEditor";b.exports=f.Model.extend({create:function(a,b){if(!d.isFunction(a))throw new Error("createContentView is required");return b=b||{left:"50%",top:"50%"},this._editorView||(this._editorView=this._newEditorView(b),document.body.appendChild(this._editorView.el)),this._editorView.model.set("createContentView",a),
this._editorView.render(),this._editorView},confirm:function(){this._editorView&&this._editorView.model.confirm()},destroy:function(){this._editorView&&this._editorView.model.destroy()},_newEditorView:function(a){var b=new h;this._destroyOnEsc(b),this.listenToOnce(b,"destroy",function(){this._editorView=null,this.trigger.apply(this,[j].concat(Array.prototype.slice.call(arguments))),this.stopListening(b)}),this.listenToOnce(b,"confirm",function(){this.trigger.apply(this,[k].concat(Array.prototype.slice.call(arguments))),this.destroy()});var c=new g({model:b,position:a});return this._destroyOnClickOutside(c),c},_destroyOnClickOutside:function(a){var b=function(b){0===e(b.target).closest(a.el).length&&a.model.confirm()};document.addEventListener("click",b),this.listenToOnce(a.model,"destroy",function(){document.removeEventListener("click",b)})},_destroyOnEsc:function(a){var b=function(b){b.which===i&&a.destroy()};document.addEventListener("keydown",b),this.listenToOnce(a,"destroy",function(){document.removeEventListener("keydown",b)})}})},{"./editor-view":294,"./editor-view-model":293,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],296:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=13;b.exports=d.extend({tagName:"input",className:"CDB-InputText CDB-Text",events:{keyup:"_onValueChange",change:"_onValueChange"},initialize:function(a){if(!a.editorModel)throw new Error("editorModel is required");this._editorModel=a.editorModel,this._onKeyPressed=this._onKeyPressed.bind(this),this._onValueChange=this._onValueChange.bind(this)},render:function(){return this.$el.val(this.model.get("value")),this._setFocus(),this._initDocumentBind(),this},_setFocus:function(){setTimeout(function(){this.$el.focus()}.bind(this),100)},_initDocumentBind:function(){e(document).bind("keydown",this._onKeyPressed)},_destroyDocumentBind:function(){e(document).unbind("keydown",this._onKeyPressed)},_onKeyPressed:function(a){if(a.which===f){if(!this.model.isValid())return!1;this._editorModel.confirm()}},_onValueChange:function(){this._setValue(),this._checkValidity()},_setValue:function(){this.model.set("value",this.$el.val())},_checkValidity:function(){this.$el.toggleClass("has-error",!this.model.isValid())},clean:function(){this._destroyDocumentBind(),d.prototype.clean.apply(this)}})},{"backbone/core-view":454,jquery:"jquery"}],297:[function(a,b,c){var d=a("./editor-base-view"),e=a("jquery"),f=a("./editor-boolean.tpl");b.exports=d.extend({tagName:"div",className:"u-flex",events:{"change input:radio":"_onRadioChanged"},render:function(){var a=this.model.get("value");return this.$el.html(f({value:null!==a?a.toString():"null"})),this},_onRadioChanged:function(a){var b=e(a.target).val();switch(b){case"true":b=!0;break;case"false":b=!1;break;default:b=null}this.model.set("value",b),this._editorModel.confirm()}})},{"./editor-base-view":296,"./editor-boolean.tpl":298,jquery:"jquery"}],298:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-iBlock CDB-Text CDB-Size-medium u-rSpace--xl">\n  <input class="CDB-Radio" type="radio" name="value" value="true" ',"true"===value&&(__p+="checked"),__p+='>\n  <span class="u-iBlock CDB-Radio-face"></span>\n  <label class="u-iBlock u-lSpace">True</label>\n</div>\n<div class="u-iBlock CDB-Text CDB-Size-medium u-rSpace--xl">\n  <input class="CDB-Radio" type="radio" name="value" value="false" ',"false"===value&&(__p+="checked"),__p+='>\n  <span class="u-iBlock CDB-Radio-face"></span>\n  <label class="u-iBlock u-lSpace">False</label>\n</div>\n<div class="u-iBlock CDB-Text CDB-Size-medium u-rSpace--xl">\n  <input class="CDB-Radio" type="radio" name="value" value="null" ',"null"===value&&(__p+="checked"),__p+='>\n  <span class="u-iBlock CDB-Radio-face"></span>\n  <label class="u-iBlock u-lSpace">Null</label>\n</div>\n';return __p}},{underscore:"underscore"}],299:[function(a,b,c){var d=a("backbone"),e=a("moment"),f=a("../../../../helpers/utils"),g=[{val:0,label:_t("months.january")},{val:1,label:_t("months.february")},{val:2,label:_t("months.march")},{val:3,label:_t("months.april")},{val:4,label:_t("months.may")},{val:5,label:_t("months.june")},{val:6,label:_t("months.july")},{val:7,label:_t("months.august")},{val:8,label:_t("months.september")},{val:9,label:_t("months.october")},{val:10,label:_t("months.november")},{val:11,label:_t("months.december")}];b.exports=d.Model.extend({parse:function(a){var b;return b=a.date?e(a.date).utc():e().utc(),{day:b.date(),month:b.month(),year:b.year(),time:b.format("HH:mm:ss"),utcOffset:b.utcOffset()}},initialize:function(){this.schema={day:{title:"",type:"Text",validators:["required",/^([12]?\d{0,1}|3[01]{0,2})$/,function(a,b){var c=e(f.formatDate(b));if(!c.isValid())return{type:"date",message:_t("components.datepicker.invalid-date")}}]},month:{type:"Select",title:"",options:g},year:{title:"",type:"Text",validators:["required",/^([0-9]{0,4})$/]},time:{title:"",type:"Text",validators:["required",/^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/]}}},getFormattedDate:function(){return f.formatDate(this.toJSON())}})},{"../../../../helpers/utils":435,backbone:"backbone",moment:"moment"}],300:[function(a,b,c){var d=a("backbone"),e=a("./editor-base-view"),f=a("./editor-date-form-model");a("../../../form-components/index"),b.exports=e.extend({tagName:"div",className:"Table-editorDate",initialize:function(a){e.prototype.initialize.apply(this,arguments),this._formModel=new f({date:this.model.get("value")},{parse:!0}),this._setValue(),this._formModel.bind("change",this._setValue,this),this.add_related_model(this._formModel)},render:function(){return this._formView=new d.Form({model:this._formModel}),this._formView.bind("change",function(){this.commit()}),this.$el.html(this._formView.render().el),this},_setValue:function(){this.model.set("value",this._formModel.getFormattedDate())},clean:function(){this._formView.remove(),e.prototype.clean.apply(this)}})},{"../../../form-components/index":178,"./editor-base-view":296,"./editor-date-form-model":299,backbone:"backbone"}],301:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({validate:function(a,b){return"number"===a.type&&isNaN(a.value)?"Number not valid":"boolean"!==a.type||e.isBoolean(a.value)||null===a.value?void 0:"Boolean not valid"}})},{backbone:"backbone",underscore:"underscore"}],302:[function(a,b,c){var d=a("./editor-base-view"),e=13;b.exports=d.extend({tagName:"textarea",className:"Table-editorTextarea CDB-Textarea CDB-Text",_onKeyPressed:function(a){a.shiftKey||a.which!==e||(this._onValueChange(),this._editorModel.confirm())}})},{"./editor-base-view":296}],303:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="25px" height="25px" viewBox="-1 4 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Outline_Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(-1.000000, 4.000000)">\n          <path d="M1.9477838,21.5 C1.6977511,21.5 1.5,21.3016354 1.5,21.0431048 L1.5,1.95689523 C1.5,1.70555616 1.70315066,1.5 1.94113901,1.5 L16.058861,1.5 C16.2975949,1.5 16.5,1.70783627 16.5,1.96250326 L16.5,13.2661378 L17.5,13.2661378 L17.5,1.96250326 C17.5,1.16139088 16.8558926,0.5 16.058861,0.5 L1.94113901,0.5 C1.14821378,0.5 0.5,1.15588925 0.5,1.95689523 L0.5,21.0431048 C0.5,21.8532278 1.1447717,22.5 1.9477838,22.5 L10.0155676,22.5 L10.0155676,21.5 L1.9477838,21.5 Z" id="path-1" fill="#F19243"></path>\n          <rect id="Rectangle-2" fill="#F19243" x="1" y="5" width="16" height="1"></rect>\n          <path d="M23.854,14.646 L21.354,12.146 C21.166,11.958 20.834,11.958 20.647,12.146 L13.146,19.648 C13.089,19.705 13.054,19.773 13.03,19.845 C13.028,19.852 13.021,19.857 13.019,19.865 L12.019,23.365 C11.969,23.539 12.018,23.727 12.146,23.856 C12.241,23.951 12.369,24.002 12.5,24.002 C12.546,24.002 12.592,23.996 12.637,23.983 L16.137,22.983 C16.144,22.981 16.149,22.974 16.157,22.972 C16.229,22.948 16.297,22.913 16.354,22.856 L23.855,15.354 C24.05,15.158 24.05,14.842 23.854,14.646 L23.854,14.646 L23.854,14.646 Z M16,21.795 L14.207,20.002 L19.001,15.207 L20.794,17 L16,21.795 L16,21.795 L16,21.795 Z M13.747,20.957 L15.045,22.255 L13.228,22.775 L13.747,20.957 L13.747,20.957 L13.747,20.957 Z M21.501,16.293 L19.708,14.5 L21.001,13.207 L22.794,15 L21.501,16.293 L21.501,16.293 L21.501,16.293 Z" id="Shape" fill="#F19243"></path>\n        </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("components.table.columns.change-type.title",{columnName:columnName,newType:newType}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">\n        '+(null==(__t=_t("components.table.columns.change-type.desc"))?"":_.escape(__t))+'\n      </p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.change-type.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.change-type.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],304:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="24px" height="25px" viewbox="521 436 24 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M524.5,440 L540.5,440 L540.5,460 L524.5,460 L524.5,440 Z M528.5,437 L536.5,437 L536.5,440 L528.5,440 L528.5,437 Z M522,440 L544,440 L522,440 Z M528.5,443.5 L528.5,455.5 L528.5,443.5 Z M532.5,443.5 L532.5,455.5 L532.5,443.5 Z M536.5,443.5 L536.5,455.5 L536.5,443.5 Z" id="Shape" stroke="#F19243" stroke-width="1" fill="none"/>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("components.table.columns.destroy.title",{columnName:name}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("components.table.columns.destroy.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.destroy.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.destroy.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],305:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="25px" height="25px" viewBox="67 153 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Group-Copy" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(67.000000, 153.000000)">\n          <path d="M16,13 L17,13 L17,5.5 C17,5.433 16.986,5.368 16.961,5.308 C16.936,5.247 16.899,5.192 16.853,5.146 L11.854,0.147 C11.808,0.101 11.753,0.064 11.692,0.039 C11.632,0.014 11.567,0 11.5,0 L0.5,0 C0.224,0 0,0.224 0,0.5 L0,21.5 C0,21.776 0.224,22 0.5,22 L9.5,22 L9.5,21 L1,21 L1,1 L11,1 L11,5.5 C11,5.776 11.224,6 11.5,6 L16,6 L16,13 L16,13 Z M12,1.707 L15.293,5 L12,5 L12,1.707 L12,1.707 Z" id="Shape" fill="#F19243"></path>\n          <path d="M23.854,14.646 L21.354,12.146 C21.166,11.958 20.834,11.958 20.647,12.146 L13.146,19.648 C13.089,19.705 13.054,19.773 13.03,19.845 C13.028,19.852 13.021,19.857 13.019,19.865 L12.019,23.365 C11.969,23.539 12.018,23.727 12.146,23.856 C12.241,23.951 12.369,24.002 12.5,24.002 C12.546,24.002 12.592,23.996 12.637,23.983 L16.137,22.983 C16.144,22.981 16.149,22.974 16.157,22.972 C16.229,22.948 16.297,22.913 16.354,22.856 L23.855,15.354 C24.05,15.158 24.05,14.842 23.854,14.646 L23.854,14.646 Z M16,21.795 L14.207,20.002 L19.001,15.207 L20.794,17 L16,21.795 L16,21.795 Z M13.747,20.957 L15.045,22.255 L13.228,22.775 L13.747,20.957 L13.747,20.957 Z M21.501,16.293 L19.708,14.5 L21.001,13.207 L22.794,15 L21.501,16.293 L21.501,16.293 Z" id="Shape" fill="#F19243"></path>\n        </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--m">\n        '+(null==(__t=_t("components.table.columns.rename.title",{columnName:columnName,newName:newName}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-medium u-altTextColor">\n        '+(null==(__t=_t("components.table.columns.rename.desc",{columnName:columnName,newName:newName}))?"":_.escape(__t))+'\n      </p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.rename.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("components.table.columns.rename.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],306:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("./table-head-item.tpl"),g=a("../../context-menu/context-menu-view"),h=a("../../custom-list/custom-list-collection"),i=a("./table-head-options-item-view"),j=a("./table-head-options-item.tpl"),k=a("../../modals/confirmation/modal-confirmation-view"),l=a("../../../data/query-column-model"),m=a("../operations/table-add-column"),n=a("../operations/table-rename-column"),o=a("../operations/table-change-column-type"),p=a("../operations/table-remove-column"),q=13,r=27;b.exports=e.extend({className:"Table-headItem",tagName:"th",events:{"dblclick .js-attribute":"_onAttributeDblClicked","focusout .js-attribute":"_saveNewName","click .js-columnOptions":"_showContextMenu"},initialize:function(a){if(!a.tableViewModel)throw new Error("tableViewModel is required");if(!a.columnsCollection)throw new Error("columnsCollection is required");if(!a.modals)throw new Error("modals is required");this._tableViewModel=a.tableViewModel,this._columnsCollection=a.columnsCollection,this._modals=a.modals,this._hideContextMenu=this._hideContextMenu.bind(this),this._onKeyDown=this._onKeyDown.bind(this)},render:function(){this.clearSubViews();var a=this.model.get("name");return this.$el.html(f({name:a,type:this.model.get("type"),isOrderBy:this._tableViewModel.get("order_by")===a,sortBy:this._tableViewModel.get("sort_order"),geometry:this.options.simpleGeometry})),this},_hasContextMenu:function(){return this._menuView},_hideContextMenu:function(){this._unhighlightHead(),this._destroyScrollBinding(),this._menuView.collection.unbind(null,null,this),this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_highlightHead:function(){this.$el.addClass("is-highlighted")},_unhighlightHead:function(){this.$el.removeClass("is-highlighted")},_initScrollBinding:function(){d(".Table").scroll(this._hideContextMenu)},_destroyScrollBinding:function(){d(".Table").off("scroll",this._hideContextMenu)},_showContextMenu:function(a){var b=this,c={x:a.clientX,y:a.clientY},d=this.$el.index(),e=this.model.cid,f=this.model.get("name");this._highlightHead();var k=[{label:_t("components.table.columns.options.order"),val:"order",isOrderBy:this._tableViewModel.get("order_by")===f,sortBy:this._tableViewModel.get("sort_order"),action:function(a){b._tableViewModel.set({sort_order:a.get("sort"),order_by:f})}}];this._tableViewModel.isDisabled()||(this.model.isCartoDBIDColumn()||this.model.isGeometryColumn()||(k=k.concat([{label:_t("components.table.columns.options.rename"),val:"rename",action:function(){b._startEditing()}},{label:_t("components.table.columns.options.change"),type:this.model.get("type"),isLastColumns:this._columnsCollection.size()-d<3,val:"change",action:function(a){b._changeColumnType(a.get("type"))}}])),k.push({label:_t("components.table.columns.options.create"),val:"create",action:function(){b._addColumn()}}),this.model.isCartoDBIDColumn()||this.model.isGeometryColumn()||k.push({label:_t("components.table.columns.options.delete"),val:"delete",destructive:!0,action:function(){b._removeColumn()}}));var l=new h(k);this._menuView=new g({className:g.prototype.className+" Table-columnMenu",collection:l,itemTemplate:j,itemView:i,triggerElementID:e,position:c}),l.bind("change:selected",function(a){var b=a.get("action");b&&b(a)},this),this._menuView.model.bind("change:visible",function(a,b){this._hasContextMenu()&&!b&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView),this._initScrollBinding()},_addColumn:function(){m({tableViewModel:this._tableViewModel,columnsCollection:this._columnsCollection})},_changeColumnType:function(b){var c=this,d=this.model.get("type"),e=l.isTypeChangeDestructive(d,b);e?this._modals.create(function(d){return new k({modalModel:d,template:a("./modals-templates/change-table-column-type.tpl"),renderOpts:{columnName:c.model.get("name"),newType:b},loadingTitle:_t("components.table.columns.change-type.loading",{columnName:c.model.get("name")}),runAction:function(){o({columnModel:c.model,newType:b,onSuccess:function(){d.destroy()},onError:function(a){d.destroy()}})}})}):o({columnModel:this.model,newType:b})},_removeColumn:function(){var b=this;this._modals.create(function(c){return new k({modalModel:c,template:a("./modals-templates/remove-table-column.tpl"),renderOpts:{name:b.model.get("name")},loadingTitle:_t("components.table.columns.destroy.loading",{columnName:b.model.get("name")}),runAction:function(){p({columnModel:b.model,onSuccess:function(){c.destroy()},onError:function(a){c.destroy()}})}})})},_onAttributeDblClicked:function(){this.model.isEditable()&&!this._tableViewModel.isDisabled()&&this._startEditing()},_initRenameBinds:function(){d(document).bind("keydown",this._onKeyDown)},_destroyRenameBinds:function(){d(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function(a){var b=a.which;b===q?this._saveNewName():b===r&&this._finishEditing()},_startEditing:function(){this.$(".js-attribute").addClass("is-active").removeAttr("readonly"),this._initRenameBinds()},_finishEditing:function(){this.$(".js-attribute").val(this.model.get("name")).removeClass("is-active").attr("readonly",""),this._destroyRenameBinds()},_saveNewName:function(){if(this.model.isEditable()){var b=this.$(".js-attribute").val(),c=this.model,d=c.get("name");d!==b&&""!==b&&this._modals.create(function(e){return new k({modalModel:e,template:a("./modals-templates/rename-table-column.tpl"),renderOpts:{columnName:d,newName:b},loadingTitle:_t("components.table.columns.rename.loading",{columnName:d,newName:b}),runAction:function(){n({columnModel:c,newName:b,onSuccess:function(){e.destroy()},onError:function(a){e.destroy()}})}})})}this._finishEditing()},clean:function(){this._destroyRenameBinds(),this._destroyScrollBinding(),e.prototype.clean.apply(this)}})},{"../../../data/query-column-model":360,"../../context-menu/context-menu-view":15,"../../custom-list/custom-list-collection":23,"../../modals/confirmation/modal-confirmation-view":190,"../operations/table-add-column":312,"../operations/table-change-column-type":314,"../operations/table-remove-column":316,"../operations/table-rename-column":318,"./modals-templates/change-table-column-type.tpl":303,"./modals-templates/remove-table-column.tpl":304,"./modals-templates/rename-table-column.tpl":305,"./table-head-item.tpl":307,"./table-head-options-item-view":308,"./table-head-options-item.tpl":309,"backbone/core-view":454,jquery:"jquery"}],307:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="\n    Table-headItemWrapper\n    '+(null==(__t="cartodb_id"===name||"geometry"===type&&"point"!==geometry?"Table-headItemWrapper--short":"")?"":_.escape(__t))+'\n  ">\n  <div class="u-flex u-justifySpace">\n    <input class="Table-headItemName CDB-Text CDB-Size-medium is-semibold u-ellipsis js-attribute" value="'+(null==(__t=name)?"":_.escape(__t))+'" title="'+(null==(__t=name)?"":_.escape(__t))+'" readonly />\n\n    ',isOrderBy&&(__p+='\n      <i class="CDB-Size CDB-Size-small CDB-IconFont CDB-IconFont-arrowNext\n        Table-columnSorted\n        Table-columnSorted--',__p+="asc"===sortBy?"asc":"desc",__p+='\n        u-rSpace u-altTextColor\n      "></i>\n    '),__p+='\n\n    <button class="CDB-Shape-threePoints is-blue is-small js-columnOptions">\n      <div class="CDB-Shape-threePointsItem"></div>\n      <div class="CDB-Shape-threePointsItem"></div>\n      <div class="CDB-Shape-threePointsItem"></div>\n    </button>\n  </div>\n  <p class="CDB-Size-small Table-headItemInfo u-altTextColor">'+(null==(__t=type)?"":_.escape(__t))+"</p>\n</div>\n";return __p}},{underscore:"underscore"}],308:[function(a,b,c){var d=a("underscore"),e=a("../../custom-list/custom-list-item-view"),f=a("../../custom-list/custom-view"),g=a("../../../data/query-column-model");b.exports=e.extend({events:d.extend(e.prototype.events,{"click .js-desc":"_onDescClick","click .js-asc":"_onAscClick","click .js-order":"killEvent"}),render:function(){return this.$el.empty(),this.clearSubViews(),this.$el.append(this.options.template({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),isOrderBy:this.model.get("isOrderBy"),sortBy:this.model.get("sortBy"),name:this.model.getName(),val:this.model.getValue()})),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onClick:function(a){this.killEvent(a),"change"===this.model.getValue()?this._openSubContextMenu(a):this.model.set("selected",!0)},_hideSubContextMenu:function(){this._subContextMenu&&(this._subContextMenu.clean(),this.removeView(this._subContextMenu),delete this.collection,delete this._subContextMenu)},_openSubContextMenu:function(a){this._subContextMenu&&this._hideSubContextMenu();var b="Table-columnTypeMenu ";this.model.get("isLastColumns")&&(b+=" Table-columnTypeMenu--toLeft "),this._subContextMenu=new f({className:b+f.prototype.className,options:[{label:_t("components.table.columns.types.number"),disabled:!g.isTypeChangeAllowed(this.model.get("type"),"number"),val:"number"},{label:_t("components.table.columns.types.string"),disabled:!g.isTypeChangeAllowed(this.model.get("type"),"string"),val:"string"},{label:_t("components.table.columns.types.date"),disabled:!g.isTypeChangeAllowed(this.model.get("type"),"date"),val:"date"},{label:_t("components.table.columns.types.boolean"),disabled:!g.isTypeChangeAllowed(this.model.get("type"),"boolean"),val:"boolean"}],showSearch:!1,typeLabel:""}),this._subContextMenu.collection.bind("change:selected",function(a){a.get("disabled")||this.model.set({type:a.getValue(),selected:!0})},this),this.$el.closest(".Table-columnMenu").append(this._subContextMenu.render().el),this._subContextMenu.show(),this.addView(this._subContextMenu)},_onAscClick:function(a){this.killEvent(a),this.model.set({sort:"asc",selected:!0})},_onDescClick:function(a){this.killEvent(a),this.model.set({sort:"desc",selected:!0})}})},{"../../../data/query-column-model":360,"../../custom-list/custom-list-item-view":26,"../../custom-list/custom-view":35,underscore:"underscore"}],309:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","order"===val?(__p+='\n  <div class="u-flex u-justifySpace CDB-ListDecoration-itemLink js-order">\n    <p class="CDB-Text CDB-Size-medium">'+(null==(__t=name)?"":_.escape(__t))+'</p>\n    <ul class="u-flex">\n      <li class="js-asc">\n        <i class="CDB-Text CDB-IconFont\n          CDB-IconFont-arrowNext u-actionTextColor\n          Table-columnSorted\n          Table-columnSorted--asc\n           ',isOrderBy&&"asc"===sortBy&&(__p+="is-disabled"),__p+="\n           ",isOrderBy&&"desc"===sortBy&&(__p+="is-semibold"),__p+='\n        "></i>\n      </li>\n      <li class="js-desc u-lSpace--xl">\n        <i class="CDB-Text CDB-IconFont\n          CDB-IconFont-arrowNext u-actionTextColor\n          Table-columnSorted\n          Table-columnSorted--desc\n           ',isOrderBy&&"desc"===sortBy&&(__p+="is-disabled"),__p+="\n           ",isOrderBy&&"asc"===sortBy&&(__p+="is-semibold"),__p+='\n        "></i>\n      </li>\n    </ul>\n  </div>\n'):"change"===val?__p+='\n  <div class="CDB-ListDecoration-itemLink u-actionTextColor u-flex u-justifySpace u-alignCenter" title="'+(null==(__t=name)?"":_.escape(__t))+'">\n    <span>'+(null==(__t=name)?"":_.escape(__t))+'</span>\n    <i class="CDB-Text CDB-Size-small is-semibold CDB-IconFont CDB-IconFont-rArrowLight"></i>\n  </div>\n':(__p+='\n  <div class="CDB-ListDecoration-itemLink\n    ',__p+=isDestructive?"  u-errorTextColor ":" u-actionTextColor ",__p+="\n    ","change"===val&&(__p+=" u-flex "),__p+='\n    " title="'+(null==(__t=name)?"":_.escape(__t))+'">\n    '+(null==(__t=name)?"":_.escape(__t))+"\n    ","change"===val&&(__p+='\n      <span>\n        <i class="CDB-Text CDB-Size-small is-semibold CDB-IconFont CDB-IconFont-rArrowLight"></i>\n      </span>\n    '),__p+="\n  </div>\n"),__p+="\n";return __p}},{underscore:"underscore"}],310:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("./table-head-item-view"),g=a("./table-head.tpl");b.exports=e.extend({className:"Table-head",tagName:"table",initialize:function(a){if(!a.columnsCollection)throw new Error("columnsCollection is required");if(!a.tableViewModel)throw new Error("tableViewModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.modals)throw new Error("modals is required");this._columnsCollection=a.columnsCollection,this._tableViewModel=a.tableViewModel,this._queryGeometryModel=a.queryGeometryModel,this._modals=a.modals,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append(g()),this._columnsCollection.each(this._renderColumnHead,this),this},_initBinds:function(){this._queryGeometryModel.bind("change:simple_geom",this.render,this),this.add_related_model(this._queryGeometryModel),this._tableViewModel.bind("change:sort_order change:order_by",this.render,this),this.add_related_model(this._tableViewModel),this._columnsCollection.bind("reset",function(){if(this.render(),this._newColumn){var a=this.$el.get(0).scrollWidth;setTimeout(function(){this._scrollToLeft({pos:a})}.bind(this),500),delete this._newColumn}},this),this._columnsCollection.bind("add",function(a){this._newColumn=a},this),this.add_related_model(this._columnsCollection)},_renderColumnHead:function(a){if(this._tableViewModel.isDisabled()||"the_geom_webmercator"!==a.get("name")){var b=new f({model:a,modals:this._modals,columnsCollection:this._columnsCollection,tableViewModel:this._tableViewModel,simpleGeometry:this._queryGeometryModel.get("simple_geom")});this.$(".js-headRow").append(b.render().el),this.addView(b)}},_scrollToLeft:function(a){a=a||{},d(".Table").animate({scrollLeft:a.pos||0},a.speed||"slow")}})},{"./table-head-item-view":306,"./table-head.tpl":311,"backbone/core-view":454,jquery:"jquery"}],311:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<thead>\n  <tr class="js-headRow"></tr>\n</thead>\n';return __p}},{underscore:"underscore"}],312:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.columnsCollection)throw new Error("columnsCollection is required");var b=a.columnsCollection,c=a.onSuccess,f=a.onError,g=d.addNotification({status:"loading",info:_t("components.table.columns.create.loading"),closable:!1});b.addColumn({success:function(a,b){c&&c(a,b),g.set({status:"success",info:_t("components.table.columns.create.success",{columnName:b.name}),closable:!0})},error:function(a,b){f&&f(a,b),g.set({status:"error",info:_t("components.table.columns.create.error",{error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":252,"../../../helpers/error-parser":426}],313:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.rowsCollection)throw new Error("rowsCollection is required");var b=a.rowsCollection,c=a.onSuccess,f=a.onError,g=d.addNotification({status:"loading",info:_t("components.table.rows.create.loading"),closable:!1});b.addRow({success:function(a,b){c&&c(a,b),g.set({status:"success",info:_t("components.table.rows.create.success"),closable:!0})},error:function(a,b){f&&f(a,b),g.set({status:"error",info:_t("components.table.rows.create.error",{error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":252,"../../../helpers/error-parser":426}],314:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.columnModel)throw new Error("columnModel is required");if(!a.newType)throw new Error("newType is required");var b=a.columnModel,c=a.newType,f=a.onSuccess,g=a.onError,h=d.addNotification({status:"loading",info:_t("components.table.columns.change-type.loading",{columnName:b.get("name")}),closable:!1});b.save({type:c},{wait:!0,success:function(a,d){f&&f(a,d),h.set({status:"success",info:_t("components.table.columns.change-type.success",{columnName:b.get("name"),newType:c
}),closable:!0})},error:function(a,d){g&&g(a,d),h.set({status:"error",info:_t("components.table.columns.change-type.error",{columnName:b.get("name"),newType:c,error:e(d)}),closable:!0})}})}},{"../../../components/notifier/notifier":252,"../../../helpers/error-parser":426}],315:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.rowModel)throw new Error("rowModel is required");if(void 0===a.newValue)throw new Error("newValue is required");if(!a.attribute)throw new Error("attribute is required");var b=a.rowModel,c=a.newValue,f=a.attribute,g=b.get("cartodb_id"),h=a.onSuccess,i=a.onError,j=d.addNotification({status:"loading",info:_t("components.table.rows.edit.loading",{attribute:f,cartodbId:g}),closable:!1});b.set(f,c),b.save(null,{success:function(a,b){h&&h(a,b),j.set({status:"success",info:_t("components.table.rows.edit.success",{attribute:f,cartodbId:g}),closable:!0})},error:function(a,b){i&&i(a,b),j.set({status:"error",info:_t("components.table.rows.edit.error",{attribute:f,cartodbId:g,error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":252,"../../../helpers/error-parser":426}],316:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.columnModel)throw new Error("columnModel is required");var b=a.columnModel,c=a.onSuccess,f=a.onError,g=d.addNotification({status:"loading",info:_t("components.table.columns.destroy.loading",{columnName:b.get("name")}),closable:!1});b.destroy({wait:!0,success:function(a,d){c&&c(a,d),g.set({status:"success",info:_t("components.table.columns.destroy.success",{columnName:b.get("name")}),closable:!0})},error:function(a,c){f&&f(a,c),g.set({status:"error",info:_t("components.table.columns.destroy.error",{columnName:b.get("name"),error:e(c)}),closable:!0})}})}},{"../../../components/notifier/notifier":252,"../../../helpers/error-parser":426}],317:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.rowModel)throw new Error("rowModel is required");var b=a.rowModel,c=a.onSuccess,f=a.onError,g=b.get("cartodb_id"),h=d.addNotification({status:"loading",info:_t("components.table.rows.destroy.loading",{cartodb_id:g}),closable:!1});b.destroy({wait:!0,success:function(a,b){c&&c(a,b),h.set({status:"success",info:_t("components.table.rows.destroy.success",{cartodb_id:g}),closable:!0})},error:function(a,b){f&&f(a,b),h.set({status:"error",info:_t("components.table.rows.destroy.error",{cartodb_id:g,error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":252,"../../../helpers/error-parser":426}],318:[function(a,b,c){var d=a("../../../components/notifier/notifier"),e=a("../../../helpers/error-parser");b.exports=function(a){if(!a.columnModel)throw new Error("columnModel is required");if(!a.newName)throw new Error("newName is required");var b=a.columnModel,c=b.get("name"),f=a.newName,g=a.onSuccess,h=a.onError,i=d.addNotification({status:"loading",info:_t("components.table.columns.rename.loading",{oldName:c,newName:f}),closable:!1});b.save({new_name:f,old_name:b.get("name")},{wait:!0,success:function(a,b){g&&g(a,b),i.set({status:"success",info:_t("components.table.columns.rename.success",{columnName:c,newName:f}),closable:!0})},error:function(a,b){h&&h(a,b),i.set({status:"error",info:_t("components.table.columns.rename.error",{columnName:c,newName:f,error:e(b)}),closable:!0})}})}},{"../../../components/notifier/notifier":252,"../../../helpers/error-parser":426}],319:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-LoaderIcon is-dark">\n  <svg class="CDB-LoaderIcon-spinner" viewbox="0 0 50 50">\n    <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"/>\n  </svg>\n</div>\n';return __p}},{underscore:"underscore"}],320:[function(a,b,c){var d=a("underscore"),e=a("backbone/core-view"),f=a("./table-paginator.tpl"),g=a("./table-paginator-loader.tpl"),h=a("../../../components/notifier/notifier"),i=a("../../../helpers/error-parser");b.exports=e.extend({tagName:"div",className:"Table-paginator js-tablePaginator",events:{"click .js-prev":"_onPrevPage","click .js-next":"_onNextPage"},initialize:function(a){if(!a.rowsCollection)throw new Error("rowsCollection is required");if(!a.tableViewModel)throw new Error("tableViewModel is required");this._tableViewModel=a.tableViewModel,this._rowsCollection=a.rowsCollection,this._rowsCollection.bind("loading",function(a){a.models&&(this._isLoading=!0)},this),this._rowsCollection.bind("add remove",this.render,this),this._tableViewModel.bind("change:page",this._onTablePageChange,this),this.add_related_model(this._tableViewModel),this.add_related_model(this._rowsCollection)},render:function(){var a=this._rowsCollection.size(),b=this._tableViewModel.get("page"),c=this._rowsCollection.DEFAULT_FETCH_OPTIONS.rows_per_page;return this.$el.html(f({page:this._tableViewModel.get("page"),size:a,isNextAvailable:a>=c,isPrevAvailable:b>0})),this.$el.toggleClass("Table-paginator--relative",!!this._tableViewModel.get("relativePositionated")),this},_onTablePageChange:function(){this._rowsCollection.fetch({data:d.extend(this._tableViewModel.pick("page","order_by","sort_order"),{exclude:this._tableViewModel.isCustomQueryApplied()?[]:["the_geom_webmercator"]}),error:function(a,b){this._isLoading=!1,this.render(),h.addNotification({status:"error",info:_t("components.table.rows.paginator.error",{error:i(b)}),closable:!0})}.bind(this)})},_onPrevPage:function(a){this._isLoading||(this.$(".js-prev").html(g()),this._tableViewModel.set("page",this._tableViewModel.get("page")-1))},_onNextPage:function(a){this._isLoading||(this.$(".js-next").html(g()),this._tableViewModel.set("page",this._tableViewModel.get("page")+1))}})},{"../../../components/notifier/notifier":252,"../../../helpers/error-parser":426,"./table-paginator-loader.tpl":319,"./table-paginator.tpl":321,"backbone/core-view":454,underscore:"underscore"}],321:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<button class="Table-paginatorButton Table-paginatorButton--prev\n  ',isPrevAvailable&&(__p+="\n    js-prev\n  "),__p+='\n">\n  <i class="CDB-Text is-semibold CDB-IconFont CDB-IconFont-lArrowLight CDB-Size-small\n  ',__p+=isPrevAvailable?"\n    u-actionTextColor\n  ":"\n    u-hintTextColor\n  ",__p+='\n  "></i>\n</button>\n<p class="Table-paginatorText CDB-Text CDB-Size-small is-semibold u-upperCase">\n  ',__p+=size?'\n    <span class="u-mainTextColor">'+(null==(__t=40*page+1)?"":_.escape(__t))+'</span>\n    <span class="u-altTextColor u-lSpace u-rSpace">'+(null==(__t=_t("components.table.rows.paginator.to"))?"":_.escape(__t))+'</span>\n    <span class="u-mainTextColor">'+(null==(__t=40*page+size)?"":_.escape(__t))+"</span>\n  ":'\n   <span class="u-mainTextColor"></span>\n  ',__p+='\n</p>\n<button class="Table-paginatorButton Table-paginatorButton--next\n  ',isNextAvailable&&(__p+="\n    js-next\n  "),__p+='\n">\n  <i class="CDB-Text is-semibold CDB-IconFont CDB-IconFont-rArrowLight CDB-Size-small\n  ',__p+=isNextAvailable?"\n    u-actionTextColor\n  ":"\n    u-hintTextColor\n  ",__p+='\n  "></i>\n</button>\n';return __p}},{underscore:"underscore"}],322:[function(a,b,c){var d=a("./table-view"),e=a("../../data/query-columns-collection"),f=a("../../helpers/table-name-utils"),g=a("../../helpers/required-opts"),h=["analysisDefinitionNodeModel","configModel","modals","userModel"];b.exports={create:function(a){g(a,h,this);var b=this._analysisDefinitionNodeModel.get("table_name"),c=f.getUsername(b)||this._userModel.get("username");b=f.getQualifiedTableName(b,c,this._userModel.isInsideOrg());var i=this._analysisDefinitionNodeModel.querySchemaModel,j=new e(i.columnsCollection.toJSON(),{configModel:this._configModel,tableName:b,querySchemaModel:i});return new d({relativePositionated:a.relativePositionated,modals:this._modals,analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,columnsCollection:j,tableName:b})},destroy:function(a){if(!a)throw new Error("tableView object is needed");a.clean()}}},{"../../data/query-columns-collection":361,"../../helpers/required-opts":432,"../../helpers/table-name-utils":434,"./table-view":324}],323:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{page:0,order_by:"",sort_order:"",readonly:!1,tableName:""},initialize:function(a,b){if(!b.analysisDefinitionNodeModel)throw new Error("analysisDefinitionNodeModel is required");if(!b.columnsCollection)throw new Error("columnsCollection is required");this._analysisDefinitionNodeModel=b.analysisDefinitionNodeModel,this._columnsCollection=b.columnsCollection,this._setOrderAndSort(),this.listenTo(this._columnsCollection,"reset",this._setOrderAndSort)},_setOrderAndSort:function(){var a=this._columnsCollection.where({name:"cartodb_id"}).length;a&&!this.isCustomQueryApplied()&&this.set({order_by:"cartodb_id",sort_order:"asc"},{silent:!0})},resetFetchDefaults:function(){this.set({page:this.defaults.page,order_by:"",sort_order:""},{silent:!0})},isDisabled:function(){return this._analysisDefinitionNodeModel.isReadOnly()},isCustomQueryApplied:function(){return this._analysisDefinitionNodeModel.isCustomQueryApplied()}})},{backbone:"backbone"}],324:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("jquery"),g=a("./table-view-model.js"),h=a("./head/table-head-view"),i=a("./body/table-body-view"),j=a("./operations/table-add-row"),k=a("./operations/table-add-column"),l=a("../../helpers/sql-utils"),m=a("../../helpers/required-opts"),n=["analysisDefinitionNodeModel","columnsCollection","modals"];b.exports=d.extend({className:"Table-wrapper",tagName:"div",initialize:function(a){m(a,n,this),this._rowsCollection=this._analysisDefinitionNodeModel.queryRowsCollection,this._queryGeometryModel=this._analysisDefinitionNodeModel.queryGeometryModel,this._querySchemaModel=this._analysisDefinitionNodeModel.querySchemaModel,this._tableModel=this._analysisDefinitionNodeModel.isSourceType()&&this._analysisDefinitionNodeModel.getTableModel(),this._tableViewModel=new g({relativePositionated:a.relativePositionated,tableName:a.tableName},{analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,columnsCollection:this._columnsCollection}),this._initBinds(),this._queryGeometryModel.shouldFetch()&&this._queryGeometryModel.fetch(),this._querySchemaModel.shouldFetch()?this._querySchemaModel.fetch():this._rowsCollection.shouldFetch()&&this._fetchRowsData()},render:function(){this.clearSubViews(),this.$el.empty();var a=f("<div>").addClass("Table js-table");return this.$el.append(a),this._initViews(),this.$(".js-table").toggleClass("Table--relative",!!this._tableViewModel.get("relativePositionated")),this._setDisableState(),this},_initBinds:function(){if(this._onChangeQueryOrStatus=this._onChangeQueryOrStatus.bind(this),this.listenTo(this._querySchemaModel,"change:query change:status",e.debounce(this._onChangeQueryOrStatus,100)),this.listenTo(this._querySchemaModel,"change:status",this._setDisableState),this.listenTo(this._querySchemaModel,"change:query",this._onQueryChanged),this.listenTo(this._querySchemaModel,"change:status",this._fetchRowsData),this.listenTo(this._tableViewModel,"change:sort_order change:order_by",this._fetchRowsData),this._tableModel&&this._tableModel.isSync()){var a=this._tableModel.getSyncModel();this.listenTo(a,"destroy",this.render)}},_setDisableState:function(){this.$(".js-table").toggleClass("is-disabled",!!this._tableViewModel.isDisabled())},_fetchRowsData:function(a){var b=a&&e.keys(a.changed),c=l.altersData(this._querySchemaModel.get("query")),d=this._tableViewModel.isCustomQueryApplied(),f=!1;b&&(e.contains(b,"sort_order")||e.contains(b,"order_by"))&&(f=!0),this._querySchemaModel.isFetched()&&!c&&this._rowsCollection.fetch({data:{page:this._tableViewModel.get("page"),order_by:!d||f?this._tableViewModel.get("order_by"):"",sort_order:!d||f?this._tableViewModel.get("sort_order"):"",exclude:!d||f?["the_geom_webmercator"]:[]}})},_initViews:function(){var a=new h({modals:this._modals,queryGeometryModel:this._queryGeometryModel,columnsCollection:this._columnsCollection,tableViewModel:this._tableViewModel});this.addView(a),this.$(".js-table").append(a.render().el);var b=new i({modals:this._modals,columnsCollection:this._columnsCollection,rowsCollection:this._rowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,tableViewModel:this._tableViewModel});this.addView(b),this.$(".js-table").append(b.render().el)},_onChangeQueryOrStatus:function(){var a=this._querySchemaModel.get("status"),b=this._queryGeometryModel.get("status");"unfetched"===a&&this._querySchemaModel.canFetch()&&this._querySchemaModel.fetch(),"unfetched"===b&&this._queryGeometryModel.canFetch()&&this._queryGeometryModel.fetch()},addRow:function(){j({tableViewModel:this._tableViewModel,rowsCollection:this._rowsCollection})},addColumn:function(){k({tableViewModel:this._tableViewModel,columnsCollection:this._columnsCollection})},getColumnsCollection:function(){return this._columnsCollection},_onQueryChanged:function(){this._tableViewModel.resetFetchDefaults()},remove:function(){f(".Table-paginator").remove(),d.prototype.remove.apply(this)}})},{"../../helpers/required-opts":432,"../../helpers/sql-utils":433,"./body/table-body-view":290,"./head/table-head-view":310,"./operations/table-add-column":312,"./operations/table-add-row":313,"./table-view-model.js":323,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],325:[function(a,b,c){var d=a("backbone/core-view");a("tipsy"),b.exports=d.extend({options:{gravity:"s",opacity:1,fade:!0},initialize:function(a){if(!a.el)throw new Error("Element is needed to have tipsy tooltip working");this._tipsyOpenedManually="manual"===a.trigger,this._initTipsy()},_initTipsy:function(){this.$el.tipsy(this.options),this.tipsy=this.$el.data("tipsy")},showTipsy:function(){this.$el.tipsy("show")},hideTipsy:function(){this.$el.tipsy("hide")},destroyTipsy:function(){this.tipsy&&(this.tipsy.hide(),this.$el.unbind("mouseleave mouseenter")),this._tipsyOpenedManually&&this.$el.tipsy("hide"),this.$el.removeData("tipsy"),delete this.tipsy},clean:function(){this.destroyTipsy()}})},{"backbone/core-view":454,tipsy:458}],326:[function(a,b,c){var d=a("backbone/core-view"),e=a("./toggler.tpl");b.exports=d.extend({className:"Toggle",events:{"click .js-input":"_onClick"},initialize:function(a){if(!a.editorModel)throw new Error("editorModel should be provided");this._editorModel=a.editorModel,this._labelsArray=a.labels,this._isDisableable=a.isDisableable,this.listenTo(this._editorModel,"change:edition",this.render),this.listenTo(this._editorModel,"change:disabled",this.render),this.add_related_model(this._editorModel)},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=this._editorModel.get("edition"),b=this._editorModel.get("disabled")&&this._isDisableable,c=e({labels:this._labelsArray,checked:a,disabled:b});return this.$el.append(c),this},_onClick:function(){var a=this._editorModel.get("edition");this._editorModel.set({edition:!a})}})},{"./toggler.tpl":327,"backbone/core-view":454}],327:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="CDB-Text CDB-Size-small is-semibold u-rSpace--xl',disabled&&(__p+=" is-disabled"),__p+='">\n  <label class="u-iBlock u-upperCase">'+(null==(__t=labels[0])?"":_.escape(__t))+'</label>\n  <input class="CDB-Toggle u-iBlock js-input" type="checkbox"\n    ',disabled&&(__p+=" disabled"),__p+="\n    ",checked&&(__p+=" checked "),__p+=' >\n  <span class="u-iBlock CDB-ToggleFace"></span>\n  <label class="u-iBlock u-upperCase">'+(null==(__t=labels[1])?"":_.escape(__t))+"</label>\n</div>";return __p}},{underscore:"underscore"}],328:[function(a,b,c){var d=a("backbone/core-view"),e=a("./undo-redo.tpl");b.exports=d.extend({events:{"click .js-redo":"_onRedoClick","click .js-undo":"_onUndoClick","click .js-apply":"_onApplyClick","click .js-clear":"_onClearClick"},options:{applyButton:!1,cancelButton:!1},initialize:function(a){if(!a.editorModel)throw new Error("editorModel is required");if(!a.trackModel)throw new Error("trackModel is required");this._trackModel=a.trackModel,this._editorModel=a.editorModel,this._clearModel=a.clearModel,this._initBinds()},render:function(){var a=!1;return this._clearModel&&(a=this._clearModel.get("visible")===!0),this.$el.html(e({canUndo:this._trackModel.canUndo(),canRedo:this._trackModel.canRedo(),canApply:this.options.applyButton&&this._editorModel.isEditing(),canClear:a})),this._checkButtonsStyle(),this},_initBinds:function(){this._trackModel.bind("undo redo",this.render,this),this._trackModel.bind("unredoChanged",this.render,this),this._editorModel.bind("change:edition",this._checkButtonsStyle,this),this.add_related_model(this._trackModel),this.add_related_model(this._editorModel),this._clearModel&&(this._clearModel.bind("change",this.render,this),this.add_related_model(this._clearModel))},_onUndoClick:function(){this._trackModel.canUndo()&&this._trackModel.undo()},_onRedoClick:function(){this._trackModel.canRedo()&&this._trackModel.redo()},_onApplyClick:function(){this.options.applyButton&&this.options.onApplyClick&&this.options.onApplyClick()},_onClearClick:function(){this.options.clearButton&&this.options.onClearClick&&this.options.onClearClick()},_checkButtonsStyle:function(a){var b=this._editorModel.isEditing();this._getIcons().toggleClass("u-whiteTextColor",b)},_getIcons:function(){return this.$(".js-theme")}})},{"./undo-redo.tpl":329,"backbone/core-view":454}],329:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-alignCenter">\n  <button class="js-undo">\n    <i class="CDB-IconFont CDB-IconFont-undo Size-large u-actionTextColor js-theme ',canUndo||(__p+="is-disabled"),__p+='"></i>\n  </button>\n  <button class="u-lSpace--xl js-redo">\n    <i class="CDB-IconFont CDB-IconFont-redo Size-large u-actionTextColor js-theme ',canRedo||(__p+="is-disabled"),__p+='"></i>\n  </button>\n  ',canClear&&(__p+='\n  <button class="u-lSpace--xl CDB-Button CDB-Button--secondary CDB-Button--white js-clear">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small">'+(null==(__t=_t("components.undo-redo.clear"))?"":_.escape(__t))+"</span>\n  </button>\n  "),__p+="\n  ",canApply&&(__p+='\n  <button class="u-lSpace--xl CDB-Button CDB-Button--primary js-apply">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small">'+(null==(__t=_t("components.undo-redo.apply"))?"":_.escape(__t))+"</span>\n  </button>\n  "),__p+="\n</div>\n";return __p}},{underscore:"underscore"}],330:[function(a,b,c){var d=a("backbone/core-view"),e=a("./panel-with-options.tpl"),f=a("../../components/infobox/infobox-view");b.exports=d.extend({initialize:function(a){if(!a.createContentView)throw new Error("createContentView factory function is mandatory");if(!a.editorModel)throw new Error("editorModel is required");this.template=this.options.template||e,this._createContentView=a.createContentView,this._editorModel=a.editorModel,this._createControlView=a.createControlView,this._createActionView=a.createActionView,this._infoboxModel=a.infoboxModel,this._infoboxCollection=a.infoboxCollection,this._editorModel.on("change:edition",this._setStyleMenu,this),this.add_related_model(this._editorModel)},render:function(){var a,b,c,d;return this.clearSubViews(),this.$el.empty(),this.$el.html(this.template()),a=this._createContentView(),this._content().html(a.render().el),this.addView(a),this._infoboxModel&&(d=new f({infoboxModel:this._infoboxModel,infoboxCollection:this._infoboxCollection}),this._info().html(d.render().el),this.addView(d)),this._createControlView&&(b=this._createControlView(),this._controls().html(b.render().el),this.addView(b)),this._createActionView&&(c=this._createActionView(),this._actions().html(c.render().el),this.addView(c)),this._setStyleMenu(),this},_content:function(){return this.$(".js-content")},_controls:function(){return this.$(".js-controls")},_actions:function(){return this.$(".js-actions")},_info:function(){return this.$(".js-info")},_setStyleMenu:function(){this.$(".js-theme").toggleClass("is-dark",this._editorModel.isEditing())}})},{"../../components/infobox/infobox-view":181,"./panel-with-options.tpl":331,"backbone/core-view":454}],331:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-content js-content"></div>\n<div class="js-info"></div>\n<ul class="Options-bar u-flex u-justifySpace js-theme js-optionsBar">\n  <li class="CDB-InfoBox-footerItem js-controls"></li>\n  <li class="CDB-InfoBox-footerItem CDB-InfoBox-footerItem--right js-actions"></li>\n</ul>';return __p}},{underscore:"underscore"}],332:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./permission-model"),g=["id","username","avatar_url","name"];b.exports=d.Model.extend({defaults:{access:"r"},isOwn:function(a){return a.id===this.get("entity").id},validate:function(a,b){if(a.access!==f.READ_ONLY&&a.access!==f.READ_WRITE)return"access can't take 'r' or 'rw' values"},toJSON:function(){var a=e.pick(this.get("entity").toJSON(),g);return a.username||(a.username=a.name,delete a.name),{type:this.get("type")||"user",entity:a,access:this.get("access")}}})},{"./permission-model":359,backbone:"backbone",underscore:"underscore"}],333:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./camshaft-reference"),g=a("./query-geometry-model"),h=a("./query-schema-model"),i=a("../value-objects/analysis-node-ids"),j=a("../helpers/required-opts"),k=a("./query-rows-collection"),l=a("../helpers/fetch-all-query-objects"),m=["configModel"];b.exports=e.Model.extend({initialize:function(a,b){if(!this.id)throw new Error("id is required");j(b,m,this);var c={configModel:this._configModel,userModel:b.userModel},d=this.get("simple_geom");this.querySchemaModel=new h(void 0,c),this.queryGeometryModel=new g({simple_geom:d,status:d?"fetched":"unfetched"},c),this.queryRowsCollection=new k([],{configModel:this._configModel,userModel:b.userModel,tableName:"",querySchemaModel:this.querySchemaModel}),this.listenTo(this.queryGeometryModel,"change:simple_geom",this._onGeometryTypeChanged)},fetchQueryObjects:function(){"ready"!==this.get("status")||this.get("error")||l({queryGeometryModel:this.queryGeometryModel,querySchemaModel:this.querySchemaModel,queryRowsCollection:this.queryRowsCollection})},parse:function(a,b){var c=!a.type&&b.merge?[]:f.getSourceNamesForAnalysisType(a.type),e=d.reduce(a.params,function(a,d,e){var f=c[c.indexOf(e)];return f?(this.collection.add(d,b),a[e]=d.id):a[e]=d,a},{},this),g=d.reduce(a.options,function(a,b,c){return a[c]=b,a},{},this);return d.defaults(d.omit(a,"params","options"),g,e)},toJSON:function(a){a=a||{};var b=[],c={},e=f.paramsForType(this.get("type"));for(var g in e){var h=e[g],i=this.get(g),j=!0;if("node"===h.type){var k=this.collection.get(i);if(k)i=k.toJSON(a);else{if(!h.optional)throw new Error('no node found for param "'+g+'" with id "'+i+'" in node '+JSON.stringify(this.attributes));j=!1}}j&&(c[g]=i,b.push(g))}var l={id:this.get("id"),type:this.get("type"),params:c},m=d.omit(this.attributes,b.concat("id","type","status","style_history"));return a.skipOptions||d.isEmpty(m)||(l.options=m),l},isNew:function(){return!0},isReadOnly:function(){return!0},isCustomQueryApplied:function(){return!1},canBeDeletedByUser:function(){return this.hasPrimarySource()},hasFailed:function(){return"failed"===this.get("status")},isDone:function(){return"ready"===this.get("status")},destroy:function(){return this.querySchemaModel&&(this.querySchemaModel.destroy(),this.querySchemaModel=null),e.Model.prototype.destroy.apply(this,arguments)},clone:function(a){if(!a)throw new Error("newId is required");if(!d.isString(a)||a.length<2)throw new Error("newId is required as a non-empty string");if(a===this.id)throw new Error("newId must be different from current id, "+this.id);var b=this.toJSON();return b.id=a,this.collection.add(b)},linkedListBySameLetter:function(){for(var a=[this],b=this,c=this.letter();;){var d=b.getPrimarySource();if(!d||d.letter()!==c)break;a.push(d),b=d}return a},isValidAsInputForType:function(a){if("source"===a)return!1;var b=this.queryGeometryModel.get("simple_geom");return b?f.isValidInputGeometryForType(b,a):null},containsNode:function(a){return!!a&&(this.id===a.id||this._sourcesContains(a))},hasPrimarySource:function(){return!!this.getPrimarySource()},hasSecondarySource:function(){return!!this.getSecondarySource()},getPrimarySource:function(){return this.collection.get(this._getPrimarySourceId())},getSecondarySource:function(){var a=this._getPrimarySourceId(),b=d.find(this.sourceIds(),function(b){return b!==a});return this.collection.get(b)},getDefaultQuery:function(){return this.get("query")},sourceIds:function(){return d.map(this._sourceNames(),function(a){return this.get(a)},this)},changeSourceIds:function(a,b,c){this._sourceNames().forEach(function(d){this.get(d)===a&&this.set(d,b,{silent:c})},this)},isSourceType:function(){return"source"===this.get("type")},letter:function(){return i.letter(this.id)},getStyleHistoryForLayer:function(a){var b=this.get("style_history");return b&&b[a]},_sourcesContains:function(a){var b=this.getPrimarySource(),c=this.getSecondarySource();return!!(b&&b.containsNode(a)||c&&c.containsNode(a))},_getPrimarySourceId:function(){var a=this.get("primary_source_name")||this._sourceNames()[0];return this.get(a)},_sourceNames:function(){return f.getSourceNamesForAnalysisType(this.get("type"))},_onGeometryTypeChanged:function(a,b){this.set("simple_geom",b)}})},{"../helpers/fetch-all-query-objects":427,"../helpers/required-opts":432,"../value-objects/analysis-node-ids":449,"./camshaft-reference":341,"./query-geometry-model":362,"./query-rows-collection":364,"./query-schema-model":365,backbone:"backbone",underscore:"underscore"}],334:[function(a,b,c){var d=a("./analysis-definition-node-model"),e=a("./table-model"),f=a("../helpers/sql-utils");b.exports=d.extend({defaults:{status:"ready"},initialize:function(a,b){if(!b.userModel)throw new Error("userModel is required");this._userModel=b.userModel,d.prototype.initialize.apply(this,arguments);var c=this.get("query");this.querySchemaModel.set({query:c,ready:!0},{silent:!0}),this.queryGeometryModel.set({query:c,ready:!0},{silent:!0}),this.queryRowsCollection._tableName=this.get("table_name");var f=b.tableData||{name:this.get("table_name")};this.tableModel=new e(f,{configModel:b.configModel,parse:!0})},getDefaultQuery:function(){return f.getDefaultSQL(this.get("table_name"),this.tableModel.getOwnerName(),this._userModel.isInsideOrg())},isCustomQueryApplied:function(){return!f.isSameQuery(this.querySchemaModel.get("query"),this.getDefaultQuery())},isReadOnly:function(){var a=this.tableModel.isReadOnly(this._userModel),b=this.isCustomQueryApplied();return a||b},getTableModel:function(){return this.tableModel},fetchTable:function(){this.tableModel.get("id")||this.tableModel.fetch()},setTableName:function(a){if(!a)throw new Error("name is required");this.set("table_name",a),this.tableModel.set("name",a),this.queryRowsCollection.setTableName(a),this.querySchemaModel.set({status:"unfetched",query:this.getDefaultQuery()})}})},{"../helpers/sql-utils":433,"./analysis-definition-node-model":333,"./table-model":370}],335:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../helpers/utils");a("backbone-model-file-upload"),b.exports=e.Model.extend({fileAttribute:"filename",defaults:{type:"",filename:"",interval:0,progress:0,state:"idle",option:""},_initBinds:function(){this.bind("progress",function(a){this.set({progress:100*a,state:"uploading"})},this),this.bind("change:filename change:url",function(){"error"===this.get("state")&&(this.set({state:"idle"}),this.unset("get_error_text",{silent:!0}))},this),this.bind("error invalid",function(a,b){this.set({state:"error",error_code:b&&b.error_code||"",get_error_text:{title:_t("componentes.data.asset-model.invalid-import"),what_about:b&&b.msg||""}},{silent:!0}),this.trigger("change")},this)},validate:function(a){if(a){if("filename"===a.type){if(a.filename&&a.filename.length)return{msg:_t("componentes.data.asset-model.one-file-per-upload")};var b=a.filename.name,c=b.substr(b.lastIndexOf(".")+1);if(c&&(c=c.toLowerCase()),!d.contains(["jpg","png","gif","svg"],c))return{msg:_t("componentes.data.asset-model.invalid-extension")}}return"url"!==a.type||f.isURL(a.url)?void 0:{msg:_t("componentes.data.asset-model.invalid-url")}}},isValid:function(){return(this.get("filename")||this.get("url"))&&"error"!==this.get("state")},upload:function(){var a=this,b={kind:this.get("kind")};"file"===this.get("type")?b.filename=this.get("filename"):"url"===this.get("type")&&(b.filename=this.get("filename")),this.xhr=this.save(b,{success:function(a){a.set("state","uploaded")},error:function(b,c){var d,e=_t("componentes.data.asset-model.connection-error");c&&429===c.status?(d=JSON.parse(c.responseText),e=d.error):c&&400===c.status&&(d=JSON.parse(c.responseText),e=d.error),a.set({state:"error",get_error_text:{title:_t("componentes.data.asset-model.error"),what_about:e}})},complete:function(){delete a.xhr}})},stopUpload:function(){this.xhr&&this.xhr.abort()}})},{"../helpers/utils":435,backbone:"backbone","backbone-model-file-upload":"backbone-model-file-upload",underscore:"underscore"}],336:[function(a,b,c){var d=a("backbone"),e=a("./asset-model"),f=a("../helpers/required-opts"),g=["configModel","userModel"];b.exports=d.Collection.extend({model:e,url:function(a){var b=this._configModel.get("base_url"),c=this._configModel.urlVersion("asset",a);return b+"/api/"+c+"/users/"+this._userModel.get("id")+"/assets"},initialize:function(a,b){f(b,g,this)},parse:function(a,b){return a.assets},selectAll:function(){this.each(function(a){a.set("state","selected")})},deselectAll:function(a){this.each(function(b){b!==a&&"selected"===b.get("state")&&b.set("state","")})}})},{"../helpers/required-opts":432,"./asset-model":335,backbone:"backbone"}],337:[function(a,b,c){var d=a("backbone");b.exports=function(a,b,c){this._xhr&&this._xhr.abort();var e=this._xhr=d.Model.prototype.sync.apply(this,arguments);return e.always(function(){b._xhr=null}),e}},{backbone:"backbone"}],338:[function(a,b,c){var d=a("underscore"),e=a("./poller"),f=function(a){var b=2e3,c=2.5,d=30,f={interval:function(a){return a>=d?b*c:b},stopWhen:function(a){var b=a.get("state");return"complete"===b||"failure"===b}};e.call(this,a,f)};f.prototype=d.extend({},e.prototype),b.exports=f},{"./poller":340,underscore:"underscore"}],339:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./import-model-poller"),g=a("../synchronization-model");b.exports=e.Model.extend({idAttribute:"item_queue_id",initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this._initBinds(),this.poller=new f(this)},urlRoot:function(){var a=this._configModel.urlVersion("import"),b=this._configModel.get("base_url");return b+"/api/"+a+"/imports"},_initBinds:function(){this.bind("change:item_queue_id",this._checkQueueId,this)},createImport:function(a){var b=this._prepareData(a);this[0===b.interval?"_createRegularImport":"_createSyncImport"](b)},_checkQueueId:function(){this.get("item_queue_id")&&this.pollCheck();
},_prepareData:function(a){var b={create_vis:a.create_vis,privacy:a.privacy},c=a.type;"remote"!==c&&d.extend(b,{type_guessing:a.type_guessing,content_guessing:a.content_guessing,interval:a.interval});var e=a.service_name;if("url"===c&&d.extend(b,{url:a.value}),"remote"===c&&d.extend(b,{type:"remote",interval:null,remote_visualization_id:a.remote_visualization_id,create_vis:!1,value:a.value}),"sql"===c&&d.extend(b,{table_name:a.table_name,sql:a.value}),"duplication"===c&&d.extend(b,{table_name:a.table_name,table_copy:a.value}),"service"===c){var f="twitter_search"===e?JSON.stringify(a.service_item_id):a.service_item_id;a.user_defined_limits&&(b.user_defined_limits=a.user_defined_limits),d.extend(b,{value:a.value,service_name:a.service_name,service_item_id:f})}return b},_createSyncImport:function(a){var b=this;this._synchronizationModel=new g(a,{configModel:this._configModel}),this._synchronizationModel.save(null,{success:function(a){b.set("item_queue_id",a.get("data_import").item_queue_id)},error:function(a,c,d){b._setErrorState(c)}})},_createRegularImport:function(a){var b=this;this.save(a,{error:function(a,c,d){b._setErrorState(c)}})},_setErrorState:function(a){var b;try{b=a&&JSON.parse(a.responseText).errors.imports}catch(a){b=_t("data.import-model.error-starting-import")}this.set({state:"failure",get_error_text:{title:_t("data.import-model.error-title"),what_about:b}})},pollCheck:function(){this.poller.start()},destroyCheck:function(){this.poller.stop()}})},{"../synchronization-model":368,"./import-model-poller":338,backbone:"backbone",underscore:"underscore"}],340:[function(a,b,c){var d=a("underscore"),e=function(a,b){this.model=a,this.numberOfRequests=0,this.polling=!1,this.interval=b.interval,"function"!=typeof this.interval&&(this.interval=function(){return b.interval}),this.stopWhen=b.stopWhen,this.error=b.error,this.autoStart=b.autoStart,this.autoStart&&this.start()};e.prototype.start=function(){this.timeout||this._scheduleFetch()},e.prototype._scheduleFetch=function(){this.timeout=setTimeout(this._fetch.bind(this),this.interval(this.numberOfRequests))},e.prototype._fetch=function(){var a=this;a.polling||(a.polling=!0,a.model.fetch({success:function(){a.polling=!1,a.numberOfRequests++,a._continuePolling()&&a._scheduleFetch()},error:function(b){d.isFunction(a.error)&&a.error(a.model)}}))},e.prototype._continuePolling=function(){return!this.stopWhen||d.isFunction(this.stopWhen)&&!this.stopWhen(this.model)},e.prototype.stop=function(){this.polling=!1,clearTimeout(this.timeout),delete this.timeout},b.exports=e},{underscore:"underscore"}],341:[function(a,b,c){var d=a("underscore"),e=a("camshaft-reference").getVersion("latest"),f=a("./default-cartography.json"),g={},h=[void 0,null,"",NaN];b.exports={hasType:function(a){return!!e.analyses[a]},paramsForType:function(a){if(!this.hasType(a))throw new Error("no analysis params found for type: "+a);return d.clone(e.analyses[a].params)},validate:function(a){var b={},c=this.parse(a),e=this.paramsForType(a.type);for(var f in e){var g=e[f],h=c[f];if(!g.optional||void 0!==h)switch(g.type){case"node":h||(b[f]=_t("data.analysis-definition-node-model.validation.invalid-source"));break;case"number":isNaN(h)&&(b[f]=_t("data.analysis-definition-node-model.validation.invalid-value"));break;case"enum":d.contains(g.values,h)||(b[f]=_t("data.analysis-definition-node-model.validation.invalid-enum",{expectedValues:JSON.stringify(g.values)}));break;default:null===h&&(b[f]=_t("data.analysis-definition-node-model.validation.missing-required"))}}if(!d.isEmpty(b))return b},parse:function(a){var b=d.extend({},a),c=this.paramsForType(a.type);for(var e in c){var f=c[e],g=b[e];if(f.optional&&d.contains(h,g))delete b[e];else switch(f.type){case"node":b[e]=(g||"").trim();break;case"number":b[e]=parseFloat(g,10);break;case"boolean":b[e]="true"===g||g===!0;break;default:d.contains(h,g)?b[e]=null:d.isString(g)&&(b[e]=g.trim())}}return b},getSourceNamesForAnalysisType:function(a){if(!g[a]){var b=[],c=this.paramsForType(a);for(var d in c){var e=c[d];"node"===e.type&&b.push(d)}g[a]=b}return g[a]},getDefaultCartoCSSForType:function(){return d.template(["#layer['mapnik::geometry_type'=1] {","  marker-width: <%= point.fill.size.fixed %>;","  marker-fill: <%= point.fill.color.fixed %>;","  marker-fill-opacity: <%= point.fill.color.opacity %>;","  marker-line-color: <%= point.stroke.color.fixed %>;","  marker-line-width: <%= point.stroke.size.fixed %>;","  marker-line-opacity: <%= point.stroke.color.opacity %>;","  marker-placement: point;","  marker-type: ellipse;","  marker-allow-overlap: true;","}","#layer['mapnik::geometry_type'=2] {","  line-color: <%= line.stroke.color.fixed %>;","  line-width: <%= line.stroke.size.fixed %>;","  line-opacity: 1;","}","#layer['mapnik::geometry_type'=3] {","  polygon-fill: <%= polygon.fill.color.fixed %>;","  polygon-opacity: <%= polygon.fill.color.opacity %>;","  polygon-gamma: 0.5;","  line-color: <%= polygon.stroke.color.fixed%>;","  line-width: <%= polygon.stroke.size.fixed %>;","  line-opacity: <%= polygon.stroke.color.opacity %>;","  line-comp-op: soft-light;","}"].join("\n"))(f.simple)},isValidInputGeometryForType:function(a,b){var c=this.getValidInputGeometriesForType(b);return d.contains(c,a)||d.contains(c,"*")},getValidInputGeometriesForType:function(a){var b=this.paramsForType(a),c=[];for(var e in b){var f=b[e];"node"===f.type&&(c=d.union(c,f.geometry))}return c}}},{"./default-cartography.json":346,"camshaft-reference":"camshaft-reference",underscore:"underscore"}],342:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({idAttribute:"name"})},{backbone:"backbone"}],343:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({defaults:{base_url:"/CHANGEME"},urlVersion:function(a,b,c){b=b||"";var d=this.get(a+"_"+b+"_url_version");return d||c||"v1"},getSqlApiUrl:function(a){return a=a||"v2",this._getSqlApiBaseUrl()+"/api/"+a+"/sql"},_getSqlApiBaseUrl:function(){var a;return a=this.get("sql_api_template")?this.get("sql_api_template").replace("{user}",this.get("user_name")):this.get("sql_api_protocol")+"://"+this.get("user_name")+"."+this.get("sql_api_domain")+":"+this.get("sql_api_port")},dataServiceEnabled:function(a){var b=this.get("dataservices_enabled");return!!(b&&e.size(b)&&a)&&!!b[a]}})},{backbone:"backbone",underscore:"underscore"}],344:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({getAttributes:function(){return JSON.parse(JSON.stringify(this.attributes))},_generateClassName:function(a){return a?a.replace(/\s+/g,"").replace(/[^a-zA-Z_0-9 ]/g,"").toLowerCase():""},parse:function(a){var b={};return e.extend(b,a.options,{id:a.id,className:this._generateClassName(a.options.urlTemplate),type:"Tiled",order:a.order,parent_id:a.parent_id}),b},toJSON:function(){var a=e.clone(e.omit(this.attributes,["order","id"])),b={kind:"tiled",options:a,order:this.get("order"),id:this.id};return b},getValue:function(){return this.get("val")},validateTemplateURL:function(a){var b=["a","b","c"],c=new Image;c.onload=a.success,c.onerror=a.error,c.src=this.get("urlTemplate").replace(/\{s\}/g,function(){return b[Math.floor(3*Math.random())]}).replace(/\{x\}/g,"0").replace(/\{y\}/g,"0").replace(/\{z\}/g,"0")}})},{backbone:"backbone",underscore:"underscore"}],345:[function(a,b,c){var d=a("backbone"),e=a("./custom-baselayer-model"),f=a("../helpers/required-opts"),g=["configModel","currentUserId"];b.exports=d.Collection.extend({model:function(a,b){var c=b.collection,d=new e(a,{parse:!0,collection:c});return d},url:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("user");return a+"/api/"+b+"/users/"+this._currentUserId+"/layers"},initialize:function(a,b){f(b,g,this)},isCustomCategory:function(){var a=this.where(function(a){return["NASA","TileJSON","WMS","Mapbox","Custom",void 0].some(function(b){return a.get("category")===b})});return a},getSelected:function(){return this.findWhere({selected:!0})},hasCustomBaseLayer:function(a){if(a){var b=this.where({className:a});return b.length>0}}})},{"../helpers/required-opts":432,"./custom-baselayer-model":344,backbone:"backbone"}],346:[function(a,b,c){b.exports={simple:{point:{fill:{size:{fixed:7},color:{fixed:"#FFB927",opacity:.9}},stroke:{size:{fixed:1},color:{fixed:"#FFF",opacity:1}}},line:{fill:{},stroke:{size:{fixed:1.5},color:{fixed:"#3EBCAE",opacity:1}}},polygon:{fill:{color:{fixed:"#374C70",opacity:.9}},stroke:{size:{fixed:1},color:{fixed:"#FFF",opacity:.5}}}}}},{}],347:[function(a,b,c){b.exports={fill:{size:{fixed:7},color:{fixed:"#FFB927",opacity:.9}},stroke:{size:{fixed:1},color:{fixed:"#FFF",opacity:1}},blending:"none",aggregation:{},labels:{enabled:!1,attribute:null,font:"DejaVu Sans Book",fill:{size:{fixed:10},color:{fixed:"#FFFFFF",opacity:1}},halo:{size:{fixed:1},color:{fixed:"#6F808D",opacity:1}},offset:-10,overlap:!0,placement:"point"}}},{}],348:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{edition:!1,disabled:!1},isEditing:function(){return!!this.get("edition")},isDisabled:function(){return!!this.get("disabled")}})},{backbone:"backbone"}],349:[function(a,b,c){var d={st_multipolygon:"polygon",st_polygon:"polygon",st_multilinestring:"line",st_linestring:"line",st_multipoint:"point",st_point:"point"};b.exports=function(a){return d[a.toLowerCase()]}},{}],350:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./backbone/sync-abort"),g=a("./user-model"),h=a("./group-model");b.exports=d.Collection.extend({model:function(a,b){var c=a.type,d=a.configModel;return b=e.extend(b,{configModel:d}),a.model&&(a=e.extend({},a,a.model)),"user"===c?new g(e.omit(a,"configModel"),b):"group"===c?new h(e.omit(a,"configModel"),b):void 0},sync:f,url:function(a){var b=this.configModel.get("base_url"),c=this.configModel.urlVersion("organizationGrantables",a);return b+"/api/"+c+"/organization/"+this.organization.id+"/grantables"},initialize:function(a,b){if(!b.organization)throw new Error("Organization is required");if(!b.currentUserId)throw new Error("currentUserId is required");if(!b.configModel)throw new Error("configModel is required");this.configModel=b.configModel,this.organization=b.organization,this.currentUserId=b.currentUserId},parse:function(a){return this.trigger("fetched",this),this.total_entries=a.total_entries,e.reduce(a.grantables,function(a,b){return b.id===this.currentUserId?this.total_entries--:(b.organization=this.organization,b.configModel=this.configModel,a.push(b)),a},[],this)},fetch:function(a){return a=a||{},this.trigger("fetching",this),a.error=function(a,b){this.trigger("error",this)}.bind(this),d.Collection.prototype.fetch.call(this,a)},totalCount:function(){return this.total_entries}})},{"./backbone/sync-abort":337,"./group-model":351,"./user-model":373,backbone:"backbone",underscore:"underscore"}],351:[function(a,b,c){var d=a("backbone"),e=a("./users-group-collection");b.exports=d.Model.extend({defaults:{display_name:""},initialize:function(a,b){this.parse(a||{},b)},parse:function(a,b){return this.users=new e(a.users,{group:this,configModel:b.configModel,organization:b.organization}),a}})},{"./users-group-collection":375,backbone:"backbone"}],352:[function(a,b,c){var d=a("./infowindow-definition-model");b.exports=d.extend({defaults:{template_name:"",latlng:[0,0],offset:[28,0],maxHeight:180,autoPan:!0,template:"",content:"",visibility:!1,alternative_names:{},fields:null,width:226,headerColor:{color:{fixed:"#35AAE5",opacity:1}}},TEMPLATES:{infowindow_light:a("../mustache-templates/infowindows/infowindow_light.jst.mustache"),infowindow_dark:a("../mustache-templates/infowindows/infowindow_dark.jst.mustache"),infowindow_color:a("../mustache-templates/infowindows/infowindow_color.jst.mustache"),infowindow_header_with_image:a("../mustache-templates/infowindows/infowindow_header_with_image.jst.mustache"),custom_infowindow_light:a("../mustache-templates/infowindows_custom/infowindow_light.jst.mustache"),custom_infowindow_dark:a("../mustache-templates/infowindows_custom/infowindow_dark.jst.mustache"),custom_infowindow_color:a("../mustache-templates/infowindows_custom/infowindow_color.jst.mustache"),custom_infowindow_header_with_image:a("../mustache-templates/infowindows_custom/infowindow_header_with_image.jst.mustache")},_transformTemplate:function(a){var b=this.get("headerColor").color.fixed;return a.replace("background: #35AAE5","background: "+b)},setTemplate:function(a){var b="undefined"==typeof this.TEMPLATES[a]?"":this.TEMPLATES[a];"infowindow_color"===a&&(b=this._transformTemplate(b));var c={template_name:a,template:b,template_type:"mustache"};""===a&&(c.fields=[]),this.set(c)},isEmptyTemplate:function(){var a=0===this.fieldCount();return this.hasTemplate()&&a},setDefault:function(){this.setTemplate(this.defaults.template_name)}})},{"../mustache-templates/infowindows/infowindow_color.jst.mustache":436,"../mustache-templates/infowindows/infowindow_dark.jst.mustache":437,"../mustache-templates/infowindows/infowindow_header_with_image.jst.mustache":438,"../mustache-templates/infowindows/infowindow_light.jst.mustache":439,"../mustache-templates/infowindows_custom/infowindow_color.jst.mustache":440,"../mustache-templates/infowindows_custom/infowindow_dark.jst.mustache":441,"../mustache-templates/infowindows_custom/infowindow_header_with_image.jst.mustache":442,"../mustache-templates/infowindows_custom/infowindow_light.jst.mustache":443,"./infowindow-definition-model":353}],353:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("jquery");b.exports=d.Model.extend({SYSTEM_COLUMNS:["the_geom","the_geom_webmercator","created_at","updated_at","cartodb_id","cartodb_georef_status"],TEMPLATES:{},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel},clearFields:function(){this.set({fields:[]})},saveFields:function(a){a=a||"old_fields",this.set(a,e.clone(this.get("fields")))},fieldCount:function(){var a=this.get("fields");return a?a.length:0},restoreFields:function(a,b){b=b||"old_fields";var c=this.get(b);a&&(c=c.filter(function(b){return e.contains(a,b.name)})),c&&c.length&&this._setFields(c),this.unset(b)},containsField:function(a){var b=this.get("fields")||[];return e.contains(e(b).pluck("name"),a)},getFieldProperty:function(a,b){if(this.containsField(a)){var c=this.get("fields")||[],d=e.indexOf(e(c).pluck("name"),a);return c[d][b]}return null},setFieldProperty:function(a,b,c){if(this.containsField(a)){var d=this._cloneFields()||[],f=e.indexOf(e(d).pluck("name"),a);d[f][b]=c,this._setFields(d)}return this},_cloneFields:function(){return e(this.get("fields")).map(function(a){return e.clone(a)})},_setFields:function(a){a.sort(function(a,b){return a.position-b.position}),this.set({fields:a})},sortFields:function(){this.get("fields").sort(function(a,b){return a.position-b.position})},_addField:function(a,b){var c=f.Deferred();if(!this.containsField(a)){var d=this.get("fields");d?(b=void 0===b?d.length:b,d.push({name:a,title:!0,position:b})):(b=void 0===b?0:b,this.set("fields",[{name:a,title:!0,position:b}],{silent:!0}))}return c.resolve(),c.promise()},addField:function(a,b){var c=this;return f.when(this._addField(a,b)).then(function(){c.sortFields(),c.trigger("add:fields"),c.trigger("change:fields",c,c.get("fields")),c.trigger("change",c)}),this},removeField:function(a){if(this.containsField(a)){var b=this._cloneFields()||[],c=e.indexOf(e(b).pluck("name"),a);c>=0&&b.splice(c,1),this._setFields(b),this.trigger("remove:fields")}return this},getAlternativeName:function(a){return this.get("alternative_names")&&this.get("alternative_names")[a]},setAlternativeName:function(a,b){var c=e.clone(this.get("alternative_names")||{});c[a]=b,this.set({alternative_names:c}),this.trigger("change:alternative_names")},getFieldPos:function(a){var b=this.getFieldProperty(a,"position");return void 0===b?Number.MAX_VALUE:b},unsetTemplate:function(){this.setTemplate("")},setTemplate:function(a){var b="undefined"==typeof this.TEMPLATES[a]?"":this.TEMPLATES[a],c={template_name:a,template:b,template_type:"mustache"};""===a&&(c.fields=[]),this.set(c)},getTemplate:function(){var a=this.get("template_name");return""!==a?this.TEMPLATES["custom_"+a]:this.get("template")},hasTemplate:function(){return!!this.get("template_name")&&this.TEMPLATES[this.get("template_name")]},isCustomTemplate:function(){return""===this.get("template_name")&&""!==this.get("template")}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],354:[function(a,b,c){var d=a("./infowindow-definition-model");b.exports=d.extend({defaults:{vertical_offset:0,horizontal_offset:0,position:"top|center",template_name:"",template:""},TEMPLATES:{tooltip_dark:a("../mustache-templates/tooltips/tooltip_dark.jst.mustache"),tooltip_light:a("../mustache-templates/tooltips/tooltip_light.jst.mustache"),custom_tooltip_dark:a("../mustache-templates/tooltips_custom/tooltip_dark.jst.mustache"),custom_tooltip_light:a("../mustache-templates/tooltips_custom/tooltip_light.jst.mustache")},setDefault:function(){this.setTemplate(this.defaults.template_name)}})},{"../mustache-templates/tooltips/tooltip_dark.jst.mustache":444,"../mustache-templates/tooltips/tooltip_light.jst.mustache":445,"../mustache-templates/tooltips_custom/tooltip_dark.jst.mustache":446,"../mustache-templates/tooltips_custom/tooltip_light.jst.mustache":447,"./infowindow-definition-model":353}],355:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./backbone/sync-abort"),g=a("../editor/style/style-definition-model"),h=a("../editor/style/style-cartocss-model"),i=a("../editor/layers/layer-content-views/data/data-sql-model"),j=a("./layer-types-and-kinds"),k=a("./infowindow-click-model"),l=a("./infowindow-hover-model"),m=a("../helpers/table-name-utils"),n=["id","order","infowindow","tooltip","error","from_layer_id","from_letter"];b.exports=d.Model.extend({sync:f,parse:function(a,b){a.options=a.options||{};var c=e.defaults(e.pick(a,n),e.omit(a.options,["query","tile_style"]));return c.type=c.type||j.getType(a.kind),a.options.tile_style&&(c.cartocss=a.options.tile_style),a.options.query&&(c.sql=a.options.query),a.infowindow&&(this.infowindowModel||(this.infowindowModel=new k(a.infowindow,{configModel:b.configModel||this._configModel}))),a.tooltip&&(this.tooltipModel||(this.tooltipModel=new l(a.tooltip,{configModel:b.configModel||this._configModel}))),a.options.table_name&&(c.autoStyle=c.autoStyle||!1,this.styleModel||(this.styleModel=new g(a.options.style_properties,{parse:!0}),this.cartocssModel=new h({content:c.cartocss},{history:a.options.cartocss_history||a.options.tile_style_history})),this.sqlModel||(this.sqlModel=new i({content:c.sql},{history:a.options.sql_history}))),c},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.on("change:source change:sql",this._onPosibleLayerSchemaChanged,this),this.styleModel&&this.styleModel.bind("change:type change:animated",function(){(this.styleModel.isAggregatedType()||this.styleModel.isAnimation())&&(this.infowindowModel&&this.infowindowModel.unsetTemplate(),this.tooltipModel&&this.tooltipModel.unsetTemplate())},this)},save:function(a,b){var c={autoStyle:!1};return b&&b.shouldPreserveAutoStyle?delete c.autoStyle:this.get("autoStyle")&&this.styleModel&&this.styleModel.resetPropertiesFromAutoStyle(),a=e.extend({},c,a),d.Model.prototype.save.apply(this,[a,b])},toJSON:function(){var a=e.omit(this.attributes,n.concat(["cartocss","sql","autoStyle"])),b=this.get("cartocss");b&&(a.tile_style=b);var c=this.get("sql");c&&(a.query=c);var d={kind:j.getKind(this.get("type")),options:a},f=this.infowindowModel&&this.infowindowModel.toJSON();e.isEmpty(f)||(d.infowindow=this.infowindowModel.toJSON());var g=this.tooltipModel&&this.tooltipModel.toJSON();e.isEmpty(g)||(d.tooltip=this.tooltipModel.toJSON()),this.styleModel&&!this.styleModel.isAutogenerated()&&(d.options.style_properties=this.styleModel.toJSON()),this.cartocssModel&&(d.options.cartocss_history=this.cartocssModel.getHistory()),this.sqlModel&&(d.options.sql_history=this.sqlModel.getHistory());var h=e.omit(this.attributes,"infowindow","tooltip","options","error","autoStyle");return e.defaults(d,e.pick(h,n))},canBeDeletedByUser:function(){return this.collection.getNumberOfDataLayers()>1&&this.isDataLayer()&&(this._canBeFoldedUnderAnotherLayer()||!this._isAllDataLayersDependingOnAnyAnalysisOfThisLayer())},isOwnerOfAnalysisNode:function(a){return a&&a.letter()===this.get("letter")},ownedPrimaryAnalysisNodes:function(){var a=this.getAnalysisDefinitionNodeModel();return this.isOwnerOfAnalysisNode(a)?a.linkedListBySameLetter():[]},getName:function(){return this.get("name")||this.get("table_name_alias")||this.get("table_name")},getTableName:function(){return this.get("table_name")||""},containsNode:function(a){var b=this.getAnalysisDefinitionNodeModel();return b&&b.containsNode(a)},getAnalysisDefinitionNodeModel:function(){return this.findAnalysisDefinitionNodeModel(this.get("source"))},findAnalysisDefinitionNodeModel:function(a){return this.collection&&this.collection.findAnalysisDefinitionNodeModel(a)},_onPosibleLayerSchemaChanged:function(a,b,c){c&&c.ignoreSchemaChange||(this.infowindowModel&&this.infowindowModel.clearFields(),this.tooltipModel&&this.tooltipModel.clearFields(),this.styleModel&&this.styleModel.resetStyles())},toggleVisible:function(){this.set("visible",!this.get("visible"))},toggleCollapse:function(){this.set("collapsed",!this.get("collapsed"))},hasAnalyses:function(){return this.getNumberOfAnalyses()>0},getNumberOfAnalyses:function(){for(var a=this.getAnalysisDefinitionNodeModel(),b=0;a&&this.isOwnerOfAnalysisNode(a);)a=a.getPrimarySource(),a&&(b+=1);return b},getQualifiedTableName:function(){var a=this.get("user_name")||this.collection.userModel.get("username");return m.getQualifiedTableName(this.getTableName(),a,this.collection.userModel.isInsideOrg())},getColumnNamesFromSchema:function(){return this._getQuerySchemaModel().getColumnNames()},_getQuerySchemaModel:function(){var a=this.getAnalysisDefinitionNodeModel();return a.querySchemaModel},isDataLayer:function(){var a=this.get("type");return j.isCartoDBType(a)||j.isTorqueType(a)},isTorqueLayer:function(){return"torque"===this.get("type")},_canBeFoldedUnderAnotherLayer:function(){var a=this.getAnalysisDefinitionNodeModel();return this.collection.any(function(b){if(b!==this&&b.isDataLayer()){var c=b.getAnalysisDefinitionNodeModel();if(c===a)return!0;var d=e.last(c.linkedListBySameLetter());return d.getPrimarySource()===a}},this)},_isAllDataLayersDependingOnAnyAnalysisOfThisLayer:function(){var a=this.getAnalysisDefinitionNodeModel();if(!a)return!1;if(!this.isOwnerOfAnalysisNode(a))return!1;var b=a.linkedListBySameLetter();return this.collection.chain().filter(function(a){return a!==this&&!!a.get("source")},this).all(function(a){return e.any(b,function(b){return a.containsNode(b)})},this).value()},getAllDependentLayers:function(){for(var a=this,b=0,c=a.collection.models,d=0;d<c.length;d++){var e=c[d],f=!1;if(e!==a){for(var g=e.getAnalysisDefinitionNodeModel();g;)a.isOwnerOfAnalysisNode(g)&&(f=!0),g=g.getPrimarySource();f&&(b+=1)}}return b},matchesAttrs:function(a){return this.get("type")===a.type&&(j.isTiledType(a.type)?this.get("name")===a.name&&this.get("urlTemplate")===a.urlTemplate:j.isGMapsBase(a.type)?this.get("name")===a.name&&this.get("baseType")===a.baseType&&this.get("style")===a.style:!!j.isPlainType(a.type)&&this.get("color")===a.color)},canBeGeoreferenced:function(){var a=function(){var a=this.getAnalysisDefinitionNodeModel();if(a&&"geocoding"===a.get("type"))return!0;for(;a&&this.isOwnerOfAnalysisNode(a);)if(a=a.getPrimarySource(),a&&"geocoding"===a.get("type"))return!0;return!1}.bind(this),b=this.getAnalysisDefinitionNodeModel();return!(a()||b.queryGeometryModel.hasValue()||b.isCustomQueryApplied()||b.queryRowsCollection.isEmpty())}})},{"../editor/layers/layer-content-views/data/data-sql-model":407,"../editor/style/style-cartocss-model":408,"../editor/style/style-definition-model":416,"../helpers/table-name-utils":434,"./backbone/sync-abort":337,"./infowindow-click-model":352,"./infowindow-hover-model":354,"./layer-types-and-kinds":356,backbone:"backbone",underscore:"underscore"}],356:[function(a,b,c){var d="Plain",e="CartoDB",f="Tiled",g="torque",h="GMapsBase",i="WMS",j={background:d,carto:e,gmapsbase:h,tiled:f,torque:g,wms:i};b.exports={getType:function(a){var b=j[a];if(!b)throw new Error("no type found for given kind "+a);return b},getKind:function(a){if(!a)throw new Error("no kind found for given type "+a);var b;for(b in j)if(j[b]===a)break;return b},isKindDataLayer:function(a){var b=j[a];return this.isTypeDataLayer(b)},isTypeDataLayer:function(a){return this.isCartoDBType(a)||this.isTorqueType(a)},isCartoDBType:function(a){return a===e},isTorqueType:function(a){return a===g},isTiledType:function(a){return a===f},isPlainType:function(a){return a===d},isGMapsBase:function(a){return a===h}}},{}],357:[function(a,b,c){var d=a("backbone"),e=a("./asset-model"),f=a("../helpers/required-opts"),g=["configModel","orgId"];b.exports=d.Collection.extend({model:e,url:function(a){var b=this._configModel.get("base_url"),c=this._configModel.urlVersion("organization-assets",a);return b+"/api/"+c+"/organization/"+this._orgId+"/assets"},initialize:function(a,b){f(b,g,this)},deselectAll:function(a){this.each(function(b){b!==a&&"selected"===b.get("state")&&b.set("state","")})}})},{"../helpers/required-opts":432,"./asset-model":335,backbone:"backbone"}],358:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({url:function(){var a=this._configModel.get("base_url");return a+"/api/v1/org"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,e.isEmpty(this.get("owner"))||(this._ownerModel=new d.Model(e.omit(this.get("owner"),"organization")))},getOwnerId:function(){return this._ownerModel&&this._ownerModel.get("id")},getOwnerEmail:function(){return this._ownerModel&&this._ownerModel.get("email")},isOrgAdmin:function(a){return this.getOwnerId()===a.get("id")||!!e.find(this.get("admins"),function(b){return b.id===a.get("id")})}})},{backbone:"backbone",underscore:"underscore"}],359:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../helpers/utils"),g=a("./user-model"),h=a("./organization-model"),i=a("./group-model"),j=a("./acl-item-model"),k="r",l="rw",m=b.exports=d.Model.extend({urlRoot:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("perm");return a+"/api/"+b+"/perm"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.acl=new d.Collection,this.owner=b._userModel,this._generateOwner(),this._generateAcl(),this._initBinds()},_initBinds:function(){this.bind("change:owner",this._generateOwner,this),this.bind("change:acl",this._generateAcl,this)},_generateOwner:function(){this.owner||(this.owner=new g(null,{configModel:this._configModel})),this.owner.set(this.get("owner"))},getOwner:function(){return this.owner},_generateAcl:function(){var a=this;this.acl.reset([],{silent:!0}),e.each(this.get("acl"),function(b){var c;switch(b.type){case"user":c=new g(b.entity,{configModel:a._configModel});break;case"org":c=new h(b.entity,{configModel:a._configModel});break;case"group":c=new i(b.entity,{configModel:a._configModel});break;default:throw new Error("Unknown ACL item type: "+b.type)}this._grantAccess(c,b.access)},this)},cleanPermissions:function(){this.acl.reset()},hasAccess:function(a){return this.hasReadAccess(a)},hasReadAccess:function(a){return!!this.findRepresentableAclItem(a)},hasWriteAccess:function(a){var b=f.result(this.findRepresentableAclItem(a),"get","access");return b===l},canChangeReadAccess:function(a){return this._canChangeAccess(a)},canChangeWriteAccess:function(a){return(!a.isBuilder||a.isBuilder())&&this._canChangeAccess(a,function(a){return f.result(a,"get","access")!==l})},_canChangeAccess:function(a){var b=this.findRepresentableAclItem(a);return this.isOwner(a)||!b||b===this._ownAclItem(a)||f.result(arguments,1,b)||!1},grantWriteAccess:function(a){this._grantAccess(a,l)},grantReadAccess:function(a){this._grantAccess(a,k)},revokeWriteAccess:function(a){this.grantReadAccess(a)},revokeAccess:function(a){var b=this._ownAclItem(a);b&&this.acl.remove(b)},isOwner:function(a){return e.result(this.owner,"id")===e.result(a,"id")},toJSON:function(){return{entity:this.get("entity"),acl:this.acl.toJSON()}},getUsersWithAnyPermission:function(){return this.acl.chain().filter(this._hasTypeUser).map(this._getEntity).value()},isSharedWithOrganization:function(){return this.acl.any(this._hasTypeOrg)},clone:function(){var a=e.clone(this.attributes);return delete a.id,new m(a,{configModel:this._configModel})},overwriteAcl:function(a){this.acl.reset(a.acl.models)},findRepresentableAclItem:function(a){if(this.isOwner(a))return this._newAclItem(a,l);var b=["_ownAclItem","_organizationAclItem","_mostPrivilegedGroupAclItem"];return this._findMostPrivilegedAclItem(b,function(b){return this[b](a)})},_hasTypeUser:function(a){return"user"===a.get("type")},_getEntity:function(a){return a.get("entity")},_hasTypeOrg:function(a){return"org"===a.get("type")},_isOrganization:function(a){return a instanceof h},_ownAclItem:function(a){if(a&&e.isFunction(a.isNew)||console.log("model is required to find an ACL item"),!a.isNew())return this.acl.find(function(b){return b.get("entity").id===a.id})},_organizationAclItem:function(a){var b=e.result(a.collection,"organization")||a.organization;if(b)return this._ownAclItem(b)},_mostPrivilegedGroupAclItem:function(a){var b=e.result(a.groups,"models");if(b)return this._findMostPrivilegedAclItem(b,this._ownAclItem)},_findMostPrivilegedAclItem:function(a,b){for(var c,d=0,e=a[d];e&&f.result(c,"get","access")!==l;e=a[++d])c=b.call(this,e)||c;return c},_grantAccess:function(a,b){var c=this._ownAclItem(a);if(c)c.set("access",b);else{if(c=this._newAclItem(a,b),!c.isValid())throw new Error(b+" is not a valid ACL access");this.acl.add(c)}},_newAclItem:function(a,b){var c;if(a instanceof g)c="user";else if(a instanceof i)c="group";else{if(!this._isOrganization(a))throw new Error("model not recognized as a valid ACL entity "+a);c="org"}return new j({type:c,entity:a,access:b})}});c.READ_ONLY=k,c.READ_WRITE=l},{"../helpers/utils":435,"./acl-item-model":332,"./group-model":351,"./organization-model":358,"./user-model":373,backbone:"backbone",underscore:"underscore"}],360:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f={number:["date"],boolean:["date"],date:["boolean"]},g={string:{string:!1,number:!0,date:!0,boolean:!0},number:{string:!1,number:!1,date:!0,boolean:!0},date:{string:!1,number:!0,date:!1,boolean:!0},boolean:{string:!1,number:!1,date:!0,boolean:!1}},h=["the_geom_webmercator","cartodb_id","the_geom"];b.exports=e.Model.extend({url:function(){if(this._tableName){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("column"),c=a+"/api/"+b+"/tables/"+this._tableName+"/columns/";return this.isNew()||(c+=this.previous("name")||this.get("name")),c}return!1},parse:function(a){return{name:a.name,type:a.cartodb_type||a.type,isNew:!1}},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._tableName=b.tableName,this._configModel=b.configModel},isNew:function(){return this.get("isNew")},isEditable:function(){return!d.contains(h,this.get("name"))},isCartoDBIDColumn:function(){return"cartodb_id"===this.get("name")&&"number"===this.get("type")},isGeometryColumn:function(){return"geometry"===this.get("type")}},{isTypeChangeDestructive:function(a,b){return g[a][b]},isTypeChangeAllowed:function(a,b){var c=f[a]||[];return c=c.concat([a]),!d.contains(c,b)}})},{backbone:"backbone",underscore:"underscore"}],361:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./query-column-model");b.exports=d.Collection.extend({model:function(a,b){var c=b.collection;
return new f(a,{configModel:c._configModel,tableName:c._tableName})},url:function(){if(this._tableName){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("column");return a+"/api/"+b+"/tables/"+this._tableName+"/columns"}return!1},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.querySchemaModel)throw new Error("querySchemaModel is required");this._tableName=b.tableName,this._querySchemaModel=b.querySchemaModel,this._configModel=b.configModel,this._initBinds()},_initBinds:function(){this.bind("add remove change:type change:name",function(){this.reset(),this._querySchemaModel.set("status","unfetched"),this._querySchemaModel.fetch()},this),this._querySchemaModel.bind("change:status",function(a,b){"fetched"===b&&this.reset(this._querySchemaModel.columnsCollection.toJSON())},this)},setTableName:function(a){a&&this._tableName&&(this._tableName=a,this.each(function(b){b._tableName=a}))},addColumn:function(a){a=a||{},this.create({name:"column_"+(new Date).getTime(),type:"string",isNew:!0},e.extend(a,{wait:!0,parse:!1}))}})},{"./query-column-model":360,backbone:"backbone",underscore:"underscore"}],362:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./backbone/sync-abort"),g=d.template("SELECT CASE LOWER(ST_GeometryType(<%= geom_column %>))      WHEN 'st_polygon' THEN 'polygon'      WHEN 'st_multipolygon' THEN 'polygon'      WHEN 'st_multilinestring' THEN 'line'      WHEN 'st_linestring' THEN 'line'      WHEN 'st_multipoint' THEN 'point'      WHEN 'st_point' THEN 'point'      ELSE ''   END AS the_geom FROM (<%= sql %>) __wrapped WHERE <%= geom_column %> IS NOT NULL"),h='column "the_geom" does not exist',i=1024,j={sort_order:"asc",rows_per_page:40,page:0},k={unavailable:"unavailable",unfetched:"unfetched",fetching:"fetching",fetched:"fetched"};b.exports=e.Model.extend({defaults:{query:"",status:k.unavailable,simple_geom:"",ready:!1},sync:f,initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this._addChangeListener()},url:function(){return this._configModel.getSqlApiUrl()},_addChangeListener:function(){this.bind("change",this._onChange,this)},_removeChangeListener:function(){this.unbind("change",this._onChange,this)},isFetched:function(){return this.get("status")===k.fetched},isFetching:function(){return this.get("status")===k.fetching},canFetch:function(){return this.hasQuery()&&this.get("ready")},hasQuery:function(){return!!this.get("query")},shouldFetch:function(){return this.canFetch()&&!this.isFetched()&&!this.isFetching()},resetFetch:function(){this.set("status",k.unfetched)},fetch:function(a){if(this.canFetch()){this.set("status",k.fetching),a=a||{};var b=a&&a.error;return a.data=d.extend(a.data||{},{api_key:this._configModel.get("api_key"),q:this._getSqlApiQueryParam(a.geomColumnName)},j),a.method=this._httpMethod(),a.error=function(c,e){if(e&&"abort"!==e.statusText){var f=e.responseText?JSON.parse(e.responseText).error:[];1===f.length&&f[0]===h?this.fetch(d.extend({},a,{geomColumnName:"the_geom_webmercator"})):(b&&b(f),this.set({simple_geom:"",query_errors:f,status:k.unavailable}))}}.bind(this),e.Model.prototype.fetch.call(this,a)}},parse:function(a){var b;return d.some(a.rows,function(a){return!!(b=a.the_geom)}),{status:k.fetched,simple_geom:b||""}},isNew:function(){return!0},hasValue:function(){return!!this.get("simple_geom")},_onChange:function(){this._removeChangeListener(),this.hasChanged("status")||this.get("status")!==k.fetching?(this.hasChanged("query")||this.hasChanged("ready"))&&this.set("status",this.get("query")?k.unfetched:k.unavailable):this.hasChanged("query")&&this.fetch(),this._addChangeListener()},_getSqlApiQueryParam:function(a){return g({geom_column:a||"the_geom",sql:this.get("query")})},_httpMethod:function(){return this._getSqlApiQueryParam().length>i?"POST":"GET"}})},{"./backbone/sync-abort":337,backbone:"backbone",underscore:"underscore"}],363:[function(a,b,c){var d=a("backbone"),e=a("underscore");b.exports=d.Model.extend({idAttribute:"__id",url:function(){if(this._tableName&&this._configModel){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("record"),c=a+"/api/"+b+"/tables/";if(this.hasWriteAccess(this._userModel)&&!this.isOwner(this._userModel)){var d=this._permissionModel.getOwner(),e=d.get("username");c+=e+"."+this._tableName+"/records"}else c+=this._tableName+"/records";return this.isNew()||(c+="/"+this.get("cartodb_id")),c}return!1},initialize:function(a,b){this.collection=this.collection||{},this._tableName=b.tableName||this.collection._tableName,this._configModel=b.configModel||this.collection._configModel,this._permissionModel=b.permissionModel||this.collection._permissionModel,this._userModel=b.userModel||this.collection._userModel,this._initBinds()},_initBinds:function(){this.bind("error",this._onError,this)},hasWriteAccess:function(a){return!(!a||!this._permissionModel)&&this._permissionModel.hasWriteAccess(a)},isOwner:function(a){return!(!a||!this._permissionModel)&&this._permissionModel.isOwner(a)},isNew:function(){return!this.has("cartodb_id")},isGeomLoaded:function(){try{return JSON.parse(this.get("the_geom")),!0}catch(a){return!1}},fetchRowIfGeomIsNotLoaded:function(a){return this.isGeomLoaded()?void a():void this.fetch({success:a})},_onError:function(){this.set(this.previousAttributes())},sync:function(){this.trigger("loading",this),d.Model.prototype.sync.apply(this,arguments)},parse:function(a){return a.__id||(a.__id=e.uniqueId()),a},toJSON:function(){return e.omit(this.attributes,"__id","the_geom_webmercator")}})},{backbone:"backbone",underscore:"underscore"}],364:[function(a,b,c){var d=a("backbone"),e=a("./query-row-model"),f=a("./backbone/sync-abort"),g=a("underscore"),h=1024,i="select <%= selectedColumns %> from (<%= sql %>) __wrapped",j={unavailable:"unavailable",unfetched:"unfetched",fetching:"fetching",fetched:"fetched"};b.exports=d.Collection.extend({DEFAULT_FETCH_OPTIONS:{rows_per_page:40,sort_order:"asc",page:0},model:e,sync:f,url:function(){return this._configModel.getSqlApiUrl()},initialize:function(a,b){b=b||{},this._tableName=b.tableName,this._querySchemaModel=b.querySchemaModel,this._configModel=b.configModel,this.statusModel=new d.Model({status:j.unavailable}),this._initBinds()},_initBinds:function(){this.listenTo(this._querySchemaModel,"change:query",this._onQuerySchemaQueryChange)},isFetched:function(){return this.statusModel.get("status")===j.fetched},isFetching:function(){return this.statusModel.get("status")===j.fetching},shouldFetch:function(){return!this.isFetched()&&!this.isFetching()&&this.canFetch()},resetFetch:function(){this.statusModel.set("status",j.unfetched)},isEmpty:function(){return 0===this.size()},canFetch:function(){return!!this._querySchemaModel.get("query")&&this._querySchemaModel.get("ready")&&this._querySchemaModel.isFetched()},_onQuerySchemaQueryChange:function(){this.statusModel.set("status","unfetched"),this.reset([],{silent:!0})},_geometryColumnSQL:function(a){return["CASE","WHEN GeometryType("+a+") = 'POINT' THEN","ST_AsGeoJSON("+a+",8)","WHEN ("+a+" IS NULL) THEN","NULL","ELSE","GeometryType("+a+")","END "+a].join(" ")},_getWrappedSQL:function(a){var b=this,c=this._querySchemaModel.columnsCollection.toJSON(),d=g.chain(c).omit(function(b){return g.contains(a,b.name)}).map(function(a,c){return"geometry"===a.type?b._geometryColumnSQL(a.name):'"'+a.name+'"'}).value();return g.template(i)({selectedColumns:d.join(","),sql:this._querySchemaModel.get("query")})},_httpMethod:function(){return this._querySchemaModel.get("query").length>h?"POST":"GET"},fetch:function(a){a=a||{},this.statusModel.set("status",j.fetching);var b=a.data&&a.data.exclude||[];a=a||{},a.data=g.extend({},this.DEFAULT_FETCH_OPTIONS,a.data&&g.omit(a.data,"exclude")||{},{api_key:this._configModel.get("api_key"),q:this._getWrappedSQL(b)}),a.method=this._httpMethod();var c=a.error;a.error=function(a,b){this.trigger("fail",a,b),this.statusModel.set("status",j.unavailable),c&&c(a,b)}.bind(this);var e=a.success;return a.success=function(a,b){this.statusModel.set("status",j.fetched),e&&e(a,b)}.bind(this),a.reset=!0,d.Collection.prototype.fetch.call(this,a)},parse:function(a){return this._parseWithID(a.rows)},reset:function(a,b){var c=[];c=a&&a.rows?a.rows:a,d.Collection.prototype.reset.apply(this,[this._parseWithID(c)])},_parseWithID:function(a){return g.map(a,function(a){return a.__id=g.uniqueId(),a})},addRow:function(a){a=a||{},this.create({__id:g.uniqueId()},g.extend(a,{wait:!0,parse:!0}))},setTableName:function(a){a&&this._tableName&&(this._tableName=a,this.each(function(b){b._tableName=a}))}})},{"./backbone/sync-abort":337,"./query-row-model":363,backbone:"backbone",underscore:"underscore"}],365:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./backbone/sync-abort"),g=a("./query-rows-collection"),h=a("../helpers/sql-utils"),i=d.template("SELECT * FROM <%= tableName %>"),j=d.template("SELECT * FROM (<%= sql %>) __wrapped"),k=1024,l={unavailable:"unavailable",unfetched:"unfetched",fetching:"fetching",fetched:"fetched"};b.exports=e.Model.extend({defaults:{query:"",sort_order:"asc",rows_per_page:0,page:0,status:l.unavailable,ready:!1},sync:f,initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.columnsCollection=new e.Collection([]),this.rowsCollection=new g([]),this.get("status")===l.unavailable&&this._setStatusPerQueryValue(),this._addChangeListener()},url:function(){return this._configModel.getSqlApiUrl()},_addChangeListener:function(){this.bind("change",this._onChange,this)},_removeChangeListener:function(){this.unbind("change",this._onChange,this)},isFetched:function(){return this.get("status")===l.fetched},isFetching:function(){return this.get("status")===l.fetching},canFetch:function(){return this.hasQuery()&&this.get("ready")},hasQuery:function(){return!!this.get("query")},shouldFetch:function(){return this.canFetch()&&!this.isFetched()&&!this.isFetching()},fetch:function(a){if(this.canFetch()){this.set("status",l.fetching),a=a||{};var b=a&&a.error;return a.data=d.extend(a.data||{},{sort_order:this.get("sort_order"),rows_per_page:this.get("rows_per_page"),page:this.get("page"),api_key:this._configModel.get("api_key"),q:this._getSqlApiQueryParam()}),a.method=this._httpMethod(),a.error=function(a,c){if(c&&"abort"!==c.statusText){var d=c.responseText?JSON.parse(c.responseText).error:[];b&&b(d),this.set({query_errors:d,status:l.unavailable})}}.bind(this),e.Model.prototype.fetch.call(this,a)}},parse:function(a){return this.rowsCollection.reset(a.rows),this.columnsCollection.reset(d.map(a.fields,function(a,b){return{name:b,type:a.type}})),{status:l.fetched}},isNew:function(){return!0},hasDefaultQueryFor:function(a){if(!this.hasQuery())return!1;var b=i({tableName:a});return h.isSameQuery(this.get("query"),b)},getColumnNames:function(){return this.columnsCollection.pluck("name")},_onChange:function(){this._removeChangeListener(),this.hasChanged("status")||this.get("status")!==l.fetching?this.hasChanged("query")&&(this.columnsCollection.reset(),this._setStatusPerQueryValue()):this.fetch(),this._addChangeListener()},_setStatusPerQueryValue:function(){this.set("status",this.get("query")?l.unfetched:l.unavailable)},hasDifferentSchemaThan:function(a){return!d.every(a,function(a){var b=this.columnsCollection.findWhere({name:a.name});return b&&(b.get("type")===a.type||null==a.type)},this)},resetDueToAlteredData:function(){this.set("status",l.unfetched),this.trigger("resetDueToAlteredData"),this.fetch()},_getSqlApiQueryParam:function(){return j({sql:this.get("query")})},_httpMethod:function(){return this._getSqlApiQueryParam().length>k?"POST":"GET"},resetFetch:function(){this.set("status",l.unfetched)}})},{"../helpers/sql-utils":433,"./backbone/sync-abort":337,"./query-rows-collection":364,backbone:"backbone",underscore:"underscore"}],366:[function(a,b,c){var d=a("underscore"),e=a("./asset-model");b.exports=e.extend({defaults:{ext:"svg",folder:"maki-icons",host:"https://s3.amazonaws.com",bucket:"com.cartodb.users-assets.production",kind:"marker",name:"",public_url:"",size:"18",state:"idle"},getURLFor:function(a){var b=this.get("host")+"/"+this.get("bucket")+"/"+this.get("folder")+"/"+a,c=this.get("size")?"-"+this.get("size"):"";return b+c+"."+this.get("ext")},toJSON:function(){var a=d.clone(this.attributes);return a.public_url=this.getURLFor(a.icon),a},get:function(a){var b=this.attributes[a];return"public_url"===a&&(b=this.getURLFor(this.attributes.icon)),b}})},{"./asset-model":335,underscore:"underscore"}],367:[function(a,b,c){var d=a("./static-asset-model"),e=a("./assets-collection");b.exports=e.extend({model:d,url:function(){return""},initialize:function(a,b){},parse:function(a,b){return[]}})},{"./assets-collection":336,"./static-asset-model":366}],368:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("jquery"),g=1.2,h=1500,i=9e5,j=15e3;b.exports=d.Model.extend({defaults:{name:"",url:"",state:"",run_at:0,ran_at:0,retried_times:0,interval:0,error_code:0,error_message:"",service_name:"",service_item_id:"",content_guessing:!0,type_guessing:!0},urlRoot:function(){var a=this._configModel.urlVersion("synchronizations"),b=this._configModel.get("base_url");return b+"/api/"+a+"/synchronizations/"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.bind("destroy",function(){this.unset("id")}),this._checkState(),this.bind("change:error_code change:error_message change:state",this._checkState,this)},toJSON:function(){var a=e.clone(this.attributes),b={url:a.url,interval:a.interval,content_guessing:a.content_guessing,type_guessing:a.type_guessing,create_vis:a.create_vis};return"remote"===a.type&&e.extend(b,{remote_visualization_id:a.remote_visualization_id,create_vis:!1,value:a.value}),void 0!==a.id&&(b.id=a.id),a.service_name&&(b.service_name=a.service_name,b.service_item_id=a.service_item_id),b},_checkState:function(){(this.get("error_code")||this.get("error_message"))&&this.set("state","failure")},syncNow:function(a){if(!a)throw new Error("callback is required");f.ajax({url:this.url()+"/sync_now",type:"PUT"}).always(a)},pollCheck:function(a){function b(){c.destroyCheck(),c.fetch({error:function(a,b){c.set({error_message:b.statusText||"",state:"failure"})}}),d*=g,c.pollTimer=setInterval(b,d)}var c=this,d=h;this.pollTimer=setInterval(b,d)},destroyCheck:function(){clearInterval(this.pollTimer)},isSync:function(){return!this.isNew()&&this.get("interval")>0},isSyncing:function(){return"syncing"===this.get("state")||"queued"===this.get("state")},canSyncNow:function(){var a=new Date(this.get("ran_at")),b=new Date,c=i;return!this.isSyncing()&&b.getTime()-a.getTime()>c},linkToTable:function(a){var b=this;a.has("synchronization")&&this.set(a.get("synchronization")),a.bind("change:synchronization",function(){b.set(a.get("synchronization"))},a),a.bind("destroy",function(){b.unbind(null,null,a),b.destroy()},a)}},{SYNC_GAP:i,POLLING_GAP:j})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],369:[function(a,b,c){var d=a("backbone"),e=a("./column-model");b.exports=d.Collection.extend({model:e,initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");if(!b.tableModel)throw new Error("tableModel is required");this._configModel=b.configModel,this._tableModel=b.tableModel},url:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("column");return a+"/api/"+b+"/tables/"+this._tableModel.get("name")+"/columns"}})},{"./column-model":342,backbone:"backbone"}],370:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./table-columns-collection"),g=a("./get-simple-geometry-type"),h=a("./permission-model"),i=a("./synchronization-model"),j=a("../helpers/table-name-utils");b.exports=e.Model.extend({idAttribute:"name",defaults:{fetched:!1,schema:[]},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel},urlRoot:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("table");return a+"/api/"+b+"/tables"},parse:function(a,b){var c=b&&b.configModel||this._configModel;a.table_visualization&&!d.isEmpty(a.table_visualization)&&(a=d.extend({},a.table_visualization,{geometry_types:a.geometry_types})),a.synchronization&&(this._syncModel?this._syncModel.set(a.synchronization):this._syncModel=new i(a.synchronization,{configModel:c})),a.permission&&(this._permissionModel?this._permissionModel.set(a.permission):this._permissionModel=new h(a.permission,{configModel:c}));var e=d.defaults({fetched:!0},a),g=d.map(a.schema,function(a){return{name:a[0],type:a[1]}},this);return this.columnsCollection?this.columnsCollection.reset(g):this.columnsCollection=new f(g,{configModel:c,tableModel:this}),e},isOwner:function(a){return!(!a||!this._permissionModel)&&this._permissionModel.isOwner(a)},getUnqualifiedName:function(){return j.getUnqualifiedName(this.get("name"))},getOwnerName:function(){var a=this.get("name");if(!a)return null;var b=a.split(".");if(2===b.length)return b[0].replace(/"/g,"");if(this._permissionModel){var c=this._permissionModel.getOwner();return c.get("username")}return""},getUnquotedName:function(){var a=this.get("name");return a&&a.replace(/"/g,"")},getGeometryType:function(){var a=this.get("geometry_types"),b=[];if(!d.isArray(a))return[];for(var c in a){var e=a[c];if(e){var f=g(e.toLowerCase());f&&b.push(f)}}return d.uniq(b)},getPermissionModel:function(){return this._permissionModel},isReadOnly:function(a){return this.isSync()||!this.hasWriteAccess(a)},isSync:function(){var a=this.getSyncModel(),b=a&&a.get("id");return!!b},hasWriteAccess:function(a){return!(!a||!this._permissionModel)&&this._permissionModel.hasWriteAccess(a)},getSyncModel:function(){return this._syncModel}})},{"../helpers/table-name-utils":434,"./get-simple-geometry-type":349,"./permission-model":359,"./synchronization-model":368,"./table-columns-collection":369,backbone:"backbone",underscore:"underscore"}],371:[function(a,b,c){var d=a("underscore"),e=a("backbone-undo"),f=30;b.exports={init:function(a,b){if(!a)throw new Error("model is required to initialize undoManager");b=b||{},this.model=a,this.model._undoManager=this.undoManager=new e({maximumStackLength:b.maximumStackLength||f,register:this.model,track:b.track}),this._trackEvents(),this._addMethods(),d.isEmpty(b.history)||(b.track&&this.undoManager.stopTracking(),this._addHistory(b.history),b.track&&this.undoManager.startTracking())},_trackEvents:function(){d.each(["undo","redo"],function(a){this.undoManager.bind(a,function(){this.trigger(a,this.changed,this)},this.model)},this),this.undoManager.stack.bind("add remove reset",function(){this.trigger("unredoChanged",this.changed,this)},this.model)},_addHistory:function(a){var b=this.undoManager.stack;d.each(a,function(c,d){a[d+1]&&b.add({after:a[d+1],before:c,type:"change",undoTypes:this.undoManager.undoTypes,object:this.model,magicFusionIndex:0})},this),b.pointer=b.length-1},_addMethods:function(){d.extend(this.model,{undo:function(){this._undoManager.undo()},redo:function(){this._undoManager.redo()},canUndo:function(){return this._undoManager.isAvailable("undo")},canRedo:function(){return this._undoManager.isAvailable("redo")},getUndoHistory:function(){var a=this._undoManager.stack.toJSON(),b=d.reduce(a,function(a,b,c){return a.push(b.before),a},[],this);return b.push(this.attributes),b}})}}},{"backbone-undo":"backbone-undo",underscore:"underscore"}],372:[function(a,b,c){var d=a("backbone"),e=a("./group-model");b.exports=d.Collection.extend({model:e,initialize:function(a,b){this.organization=b.organization}})},{"./group-model":351,backbone:"backbone"}],373:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./organization-model"),g=a("./user-groups-collection"),h=a("./custom-baselayers-collection"),i=d.Model.extend({urlRoot:function(){var a=this._configModel.get("base_url");return a+"/api/v1/users"},defaults:{avatar_url:"http://cartodb.s3.amazonaws.com/static/public_dashboard_default_avatar.png",username:"",email:""},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,a=a||{},e.isEmpty(this.get("organization"))||(this._organizationModel=new f(this.get("organization"),{configModel:this._configModel,currentUserId:this.id})),this.get("layers")&&(this.layers=new h(this.get("layers"),{configModel:this._configModel,currentUserId:this.id})),this.groups=new g(a.groups,{organization:this._organizationModel})},isViewer:function(){return this.get("viewer")===!0},isBuilder:function(){return!this.isViewer()},canCreateDatasets:function(){return!(!this.get("remaining_byte_quota")||this.get("remaining_byte_quota")<=0)},hasCreateMapsFeature:function(){return this.isBuilder()},canCreateTwitterDataset:function(){return!(this.get("twitter").quota-this.get("twitter").monthly_use<=0&&this.get("twitter").hard_limit)},canStartTrial:function(){return!this.isInsideOrg()&&"FREE"===this.get("account_type")&&this.get("table_count")>0},isActionEnabled:function(a){return this.get("actions")&&this.get("actions")[a]},canCreatePrivateDatasets:function(){var a=this.get("actions");return a&&a.private_tables},isInsideOrg:function(){return!!this._organizationModel&&(!!this._organizationModel.id||this.isOrgOwner())},isOrgOwner:function(){return!!this._organizationModel&&this._organizationModel.getOwnerId()===this.get("id")},isOrgAdmin:function(){return!!this._organizationModel&&this._organizationModel.isOrgAdmin(this)},featureEnabled:function(a){var b=this.get("feature_flags");return!(!b||0===b.length||!a)&&e.contains(b,a)},upgradeContactEmail:function(){return this.isInsideOrg()?this.isOrgOwner()?"enterprise-support@carto.com":this._organizationModel.getOwnerEmail():"support@carto.com"},nameOrUsername:function(){return this.get("name")||this.get("username")},getMaxConcurrentImports:function(){return this.get("limits")&&this.get("limits").concurrent_imports||1},getSchemaName:function(){return this.isInsideOrg()?this.get("username"):"public"},renderData:function(a){var b=this.get("username");return a&&a.id===this.id&&(b=_t("user.you")),{username:b,avatar_url:this.get("avatar_url")}},clone:function(){var a=e.clone(this.attributes);return delete a.id,new i(a,{configModel:this._configModel})},getOrganization:function(){return this._organizationModel}});b.exports=i},{"./custom-baselayers-collection":345,"./organization-model":358,"./user-groups-collection":372,backbone:"backbone",underscore:"underscore"}],374:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=e.Model.extend({sync:function(a,b,c){return e.sync("update",b,c)},url:function(){var a=this._configModel.get("base_url");return a+"/api/v3/notifications/"+this.get("key")},initialize:function(a,b){if(!b.key)throw new Error("key is required");if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.attributes=d.extend({notifications:a},{key:b.key})},getKey:function(a){var b=this.get("notifications")||{};return b[a]},setKey:function(a,b){var c=this.get("notifications")||{};c[a]=b,this.set("notifications",c)}});b.exports=f},{backbone:"backbone",underscore:"underscore"}],375:[function(a,b,c){var d=a("backbone"),e=a("./backbone/sync-abort");b.exports=d.Collection.extend({sync:e,initialize:function(a,b){if(!b.group)throw new Error("group is required");this.group=b.group,this.configModel=b.configModel,this.organization=b.organization},url:function(a){var b=this.configModel.get("base_url"),c=this.configModel.urlVersion("organizationGroups",a);return b+"/api/"+c+"/organization/"+this.organization.id+"/groups/"+this.group.id+"/users"},parse:function(a){return this.total_entries=a.total_entries,this.total_user_entries=a.total_user_entries,a.users},totalCount:function(){return this.total_user_entries}})},{"./backbone/sync-abort":337,backbone:"backbone"}],376:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("./users-group-collection");b.exports={track:function(a){this.acl=a.acl,this.configModel=a.configModel,this.userModel=a.userModel,this.acl.on("reset",this.fetchUsers,this),this.fetchUsers()},fetchUsers:function(){var a=this,b=[];b=e.map(this.acl.where({type:"group"}),function(b){var c=b.get("entity"),e=new d.Deferred;return c.users&&0!==c.users.length?e.resolve():(c.users=new f([],{group:c,configModel:a.configModel,organization:a.userModel.getOrganization()}),c.users.fetch({success:function(){e.resolve()}})),e.promise()},this),d.when.apply(d,b).done(function(){a.acl.trigger("fetch")})}}},{"./users-group-collection":375,jquery:"jquery",underscore:"underscore"}],377:[function(a,b,c){var d=a("backbone"),e=a("./permission-model"),f=["PUBLIC","LINK","PRIVATE","PASSWORD"];b.exports=d.Model.extend({defaults:{visChanges:0},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.get("permission")&&(this._permissionModel=new e(this.get("permission"),{configModel:b.configModel}),this.unset("permission"))},urlRoot:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("visualization");return a+"/api/"+b+"/viz"},mapcapsURL:function(){var a=this._configModel.get("base_url");return a+"/api/v3/viz/"+this.id+"/mapcaps"},embedURL:function(){var a=this._configModel.get("base_url");return a+"/builder/"+this.id+"/embed"},builderURL:function(){var a=this._configModel.get("base_url");return a+"/builder/"+this.id+"/"},vizjsonURL:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("vizjson","read","v3");return a+"/api/"+b+"/viz/"+this.id+"/viz.json"},stateURL:function(){var a=this._configModel.get("base_url");return a+"/api/v3/viz/"+this.id+"/state"},isVisualization:function(){return"derived"===this.get("type")},privacyOptions:function(){return f},recordChange:function(){var a=this.get("visChanges");this.set("visChanges",a+1)},resetChanges:function(){this.set("visChanges",0)},getPermissionModel:function(){return this._permissionModel}})},{"./permission-model":359,backbone:"backbone"}],378:[function(a,b,c){var d=a("backbone");b.exports=d.Model.extend({defaults:{name:""},validate:function(a){if(a)return a.name?void 0:_t("components.modals.maps-metadata.validation.error.name")}})},{backbone:"backbone"}],379:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./table-model"),g=a("./permission-model"),h=a("./synchronization-model"),i=a("../components/likes/likes-model"),j=["PUBLIC","LINK","PRIVATE"];b.exports=d.Model.extend({urlRoot:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("visualization");return a+"/api/"+b+"/viz"},initialize:function(a,b){if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this._initModels()},_initModels:function(){var a=this.get("table");e.isEmpty(this.get("external_source"))||(a=this.get("external_source")),this._tableModel=new f(a,{configModel:this._configModel,parse:!0}),this.get("permission")&&(this._permissionModel=new g(this.get("permission"),{configModel:this._configModel}),this.unset("permission")),this._likesModel=i.newByVisData({vis_id:this.id,liked:this.get("liked"),likes:this.get("likes"),configModel:this._configModel}),this.get("synchronization")&&(this._synchronizationModel=new h(this.get("synchronization"),{configModel:this._configModel}),this._synchronizationModel.linkToTable(this._tableModel))},isVisualization:function(){return!1},getTableModel:function(){return this._tableModel},getLikesModel:function(){return this._likesModel},getPermissionModel:function(){return this._permissionModel},getSynchronizationModel:function(){return this._synchronizationModel},vizjsonURL:function(){var a=this._configModel.get("base_url"),b=this._configModel.urlVersion("vizjson","read","v3");return a+"/api/"+b+"/viz/"+this.id+"/viz.json"},isRaster:function(){return"raster"===this.get("kind")},datasetURL:function(){var a=this._configModel.get("base_url"),b=this.getTableModel().getUnquotedName();return a+"/dataset/"+b},privacyOptions:function(){return j},toJSON:function(){return e.omit(this.attributes,"synchronization","stats","table")}})},{"../components/likes/likes-model":183,"./permission-model":359,"./synchronization-model":368,"./table-model":370,backbone:"backbone",underscore:"underscore"}],380:[function(a,b,c){var d=window.ACTIVE_LOCALE;"en"!==d&&a("moment/locale/"+d);var e=a("../../locale/index"),f=a("node-polyglot"),g=new f({locale:d,phrases:e[d]});window._t=g.t.bind(g);var h=a("jquery"),i=a("underscore"),j=a("backbone"),k=a("./data/config-model"),l=a("./dataset/dataset-content/dataset-content-view"),m=a("./dataset/dataset-options/dataset-options-view"),n=a("./components/modals/modals-service-model"),o=a("./components/metrics/metrics-tracker"),p=a("./data/analysis-definition-node-source-model"),q=a("./data/layer-definition-model"),r=a("./data/table-model"),s=a("./data/visualization-table-model"),t=a("./dataset/dataset-unlock-modal-view"),u=a("./data/editor-model"),v=a("./data/user-model"),w=a("./dataset/dataset-header/dataset-header-view"),x=a("./components/notifier/notifier"),y=a("./data/users-group-fetcher"),z=a("./helpers/sql-utils"),A=a("./components/onboardings/builder-activated/builder-activated-notification-view"),B=a("./data/user-notifications"),C=a("./data/layer-types-and-kinds"),D=window.userData,E=window.visualizationData,F=window.tableData,G=window.layersData,H=window.frontendConfig,I=window.authTokens,J=window.dashboardNotifications,K=new k(i.defaults({base_url:D.base_url,api_key:D.api_key,auth_tokens:I},H)),L=new v(D,{configModel:K}),M=new n,N=new r(F,{parse:!0,configModel:K}),O=new u,P=new j.Router,Q=new s(E,{configModel:K}),R=new j.Collection(G),S=R.find(function(a){var b=a.get("kind");return C.isKindDataLayer(b)}),T=new q(S.toJSON(),{configModel:K,parse:!0});if(T.url=function(){var a=K.get("base_url");return a+"/api/v1/maps/"+E.map_id+"/layers/"+T.id},!T.get("sql")){var U=z.getDefaultSQL(N.getUnqualifiedName(),N.get("permission").owner.username,L.isInsideOrg());T.set("sql",U)}var V=new p({table_name:F.name,query:T.get("sql"),type:"source",id:"dummy-id"},{configModel:K,userModel:L,tableData:i.extend(F,{synchronization:E.synchronization||{}})});y.track({userModel:L,configModel:K,acl:Q.getPermissionModel().acl});var W=V.queryGeometryModel;if(V.isCustomQueryApplied())W.fetch();else{var X=N.getGeometryType();W.set({status:"fetched",simple_geom:X&&X[0]})}x.init({editorModel:O}),o.init({userId:L.get("id"),visId:Q.get("id"),configModel:K});var Y=new w({router:P,modals:M,configModel:K,userModel:L,visModel:Q,analysisDefinitionNodeModel:V,layerDefinitionModel:T});h(".js-info").append(Y.render().el);var Z=new l({el:h(".js-table"),modals:M,userModel:L,visModel:Q,analysisDefinitionNodeModel:V,configModel:K});Z.render();var $=new m({el:h(".js-datasetOptions"),editorModel:O,router:P,modals:M,configModel:K,userModel:L,visModel:Q,analysisDefinitionNodeModel:V,layerDefinitionModel:T});$.render();var _=x.getView();h(".js-notifier").append(_.render().el);var aa=K.get("base_url").replace(window.location.origin,"")+"/dataset/";if(j.history.start({pushState:!0,root:aa}),N.isOwner(L)&&Q.get("locked")&&M.create(function(a){return new t({modalModel:a,visModel:Q,configModel:K,tableName:N.getUnquotedName()})}),!K.get("cartodb_com_hosted")&&L.get("actions").builder_enabled&&L.get("show_builder_activated_message")&&i.isEmpty(J)){var ba=new B(J,{key:"dashboard",configModel:K}),ca=new A({builderActivatedNotification:ba});h(".js-editor").addClass("Editor--topBar"),ca.bind("clean",function(){h(".js-editor").removeClass("Editor--topBar")},this)}},{"../../locale/index":452,"./components/metrics/metrics-tracker":189,"./components/modals/modals-service-model":205,"./components/notifier/notifier":252,"./components/onboardings/builder-activated/builder-activated-notification-view":254,"./data/analysis-definition-node-source-model":334,
"./data/config-model":343,"./data/editor-model":348,"./data/layer-definition-model":355,"./data/layer-types-and-kinds":356,"./data/table-model":370,"./data/user-model":373,"./data/user-notifications":374,"./data/users-group-fetcher":376,"./data/visualization-table-model":379,"./dataset/dataset-content/dataset-content-view":386,"./dataset/dataset-header/dataset-header-view":388,"./dataset/dataset-options/dataset-options-view":396,"./dataset/dataset-unlock-modal-view":400,"./helpers/sql-utils":433,backbone:"backbone",jquery:"jquery","node-polyglot":"node-polyglot",underscore:"underscore"}],381:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../data/undo-manager.js");b.exports=d.Model.extend({defaults:{content:""},initialize:function(a,b){this._history=this._generateHistory(b&&b.history),f.init(this,{track:!0,history:this._history})},_generateHistory:function(a){if(a&&a.length){var b=e.reduce(a,function(a,b){return a.push({content:b}),a},[],this);return b}return!1},getHistory:function(){return e.pluck(this.getUndoHistory(),"content")}})},{"../data/undo-manager.js":371,backbone:"backbone",underscore:"underscore"}],382:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../components/modals/export-data/modal-export-data-view"),f=a("./dataset-content-sync-view"),g=a("./dataset-content-options.tpl"),h=a("../../helpers/required-opts"),i=["analysisDefinitionNodeModel","configModel","modals","userModel"];b.exports=d.extend({className:"Dataset-viewOptions u-flex u-justifySpace u-alignCenter",events:{"click .js-addRow":"_onAddRowClick","click .js-addColumn":"_onAddColumnClick","click .js-export":"_onExportClick"},initialize:function(a){h(a,i,this),this._tableModel=this._analysisDefinitionNodeModel.getTableModel(),this._querySchemaModel=this._analysisDefinitionNodeModel.querySchemaModel,this._queryGeometryModel=this._analysisDefinitionNodeModel.queryGeometryModel,this._syncModel=this._tableModel.getSyncModel(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g({isEditable:!this._analysisDefinitionNodeModel.isReadOnly(),isCustomQueryApplied:this._analysisDefinitionNodeModel.isCustomQueryApplied()})),this._initViews(),this},_initBinds:function(){this.listenTo(this._querySchemaModel,"change:query",this.render),this.listenTo(this._syncModel,"destroy",this.render)},_initViews:function(){if(this._tableModel.isSync()&&this._tableModel.isOwner(this._userModel)){var a=new f({modals:this._modals,syncModel:this._syncModel,tableModel:this._tableModel,querySchemaModel:this._querySchemaModel});this.$(".js-sync").html(a.render().el),this.addView(a)}},_onExportClick:function(){this._modals.create(function(a){return new e({modalModel:a,configModel:this._configModel,fileName:this._tableModel.getUnquotedName(),queryGeometryModel:this._queryGeometryModel})}.bind(this))},_onAddRowClick:function(){this.trigger("addRow",this)},_onAddColumnClick:function(){this.trigger("addColumn",this)}})},{"../../components/modals/export-data/modal-export-data-view":200,"../../helpers/required-opts":432,"./dataset-content-options.tpl":383,"./dataset-content-sync-view":384,"backbone/core-view":454}],383:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="js-sync"></div>\n<div class="js-dataset">\n  <ul class="u-flex u-justifySpace">\n    ',isEditable&&(__p+='\n      <li>\n        <button class="CDB-Text CDB-Size-small is-semibold u-actionTextColor u-upperCase js-addRow">\n          <div class="u-flex u-alignCenter">\n            <svg width="16px" height="18px" viewBox="0 0 16 6" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n              <defs>\n                <path d="M4,3 L4,0 L3,0 L3,3 L0,3 L0,4 L3,4 L3,7 L4,7 L4,4 L7,4 L7,3 L4,3 Z" id="path-1"></path>\n                <mask id="mask-2" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="7" height="7" fill="white">\n                    <use xlink:href="#path-1"></use>\n                </mask>\n              </defs>\n              <g id="Add-Row" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                <use id="Combined-Shape" stroke="#1181FB" mask="url(#mask-2)" stroke-width="2" xlink:href="#path-1"></use>\n                <path d="M16,0 L16,3 L9,3 L9,0 L16,0 Z M10.0020142,1 L10.000989,2.01795972 L14.9926249,2.00301586 L14.9962966,1.00580263 L10.0020142,1 Z" id="Combined-Shape" fill="#1181FB"></path>\n                <path d="M16,4 L16,7 L9,7 L9,4 L16,4 Z M10.0020142,5 L10.000989,6.01795972 L14.9926249,6.00301586 L14.9962966,5.00580263 L10.0020142,5 Z" id="Combined-Shape-Copy" fill="#1181FB"></path>\n              </g>\n            </svg>\n            <span class="u-lSpace">\n              '+(null==(__t=_t("dataset.options.add-row"))?"":_.escape(__t))+'\n            </span>\n          </div>\n        </button>\n      </li>\n      <li class="u-lSpace--xl">\n        <button class="CDB-Text CDB-Size-small is-semibold u-actionTextColor u-upperCase js-addColumn">\n          <div class="u-flex u-alignCenter">\n            <svg width="16px" height="18px" viewBox="0 4 16 6" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n              <g id="Add-Column" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(0.000000, 4.000000)">\n                <path d="M4,3 L4,0 L3,0 L3,3 L0,3 L0,4 L3,4 L3,7 L4,7 L4,4 L7,4 L7,3 L4,3 Z" id="Combined-Shape" fill="#1181FB"></path>\n                <path d="M9,0 L12,0 L12,7 L9,7 L9,0 Z M10,1 L11,1 L11,6 L10,6 L10,1 Z" id="Combined-Shape" fill="#1181FB"></path>\n                <path d="M13,0 L16,0 L16,7 L13,7 L13,0 Z M14,1 L15,1 L15,6 L14,6 L14,1 Z" id="Combined-Shape-Copy-2" fill="#1181FB"></path>\n              </g>\n            </svg>\n            <span class="u-lSpace">\n              '+(null==(__t=_t("dataset.options.add-column"))?"":_.escape(__t))+"\n            </span>\n          </div>\n        </button>\n      </li>\n    "),__p+='\n    <li class="u-lSpace--xl">\n      <button class="CDB-Text CDB-Size-small is-semibold u-actionTextColor u-upperCase is-disabled js-export">\n        <div class="u-flex u-alignCenter">\n          <svg width="11px" height="18px" viewBox="-1 2 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n            <g id="Esport" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(0.000000, 3.000000)" stroke-linecap="square">\n              <path d="M4.5,0.5 L4.5,6.5" id="Line" stroke="#1181FB"></path>\n              <path d="M4.5,7.5 L8.5,3.5" id="Line" stroke="#1181FB"></path>\n              <path d="M4.5,7.5 L0.5,3.5" id="Line" stroke="#1181FB"></path>\n            </g>\n          </svg>\n          <span class="u-lSpace">\n            '+(null==(__t=_t("dataset.options.export"))?"":_.escape(__t))+"\n          </span>\n        </div>\n      </button>\n    </li>\n  </ul>\n</div>\n";return __p}},{underscore:"underscore"}],384:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../components/tipsy-tooltip-view"),f=a("../../components/modals/creation/modal-creation-view"),g=a("../../components/modals/sync-options/sync-options-modal-view"),h=a("../../data/synchronization-model"),i=a("./dataset-content-sync.tpl"),j=a("moment"),k=a("../../helpers/required-opts"),l=["syncModel","tableModel","querySchemaModel","modals"];b.exports=d.extend({tagName:"div",className:"SyncInfo",events:{"click .js-options":"_onClickOptions","click .js-syncNow":"_onClickSyncNow"},initialize:function(a){k(a,l,this),this._startSync=this._startSync.bind(this),this._initBinds(),this._syncModel.isSyncing()&&this._showSyncNowModal()},render:function(){this.clearSubViews();var a=this._syncModel.get("run_at"),b={canSyncNow:this._syncModel.canSyncNow(),fromExternalSource:this._syncModel.get("from_external_source"),ranAt:j(this._syncModel.get("ran_at")||new Date).fromNow(),runAt:j(a).fromNow(),state:this._syncModel.get("state"),errorCode:this._syncModel.get("error_code"),errorMessage:this._syncModel.get("error_message")};(!a||new Date(a)<=new Date)&&(b.runAt=_t("dataset.sync.in-a-moment")),this.$el.html(i(b)).removeClass().addClass(this.className+" is-"+b.state);var c=new e({el:this.$(".js-syncNowDisabled"),title:function(){return _t("dataset.sync.disabled",{gap:h.SYNC_GAP/6e4})}});return this.addView(c),this},_initBinds:function(){this._syncModel.bind("change",this.render,this)},_bindChangeSyncEvent:function(){this._syncModel.bind("change:state",this._finishSync,this)},_unbindChangeSyncEvent:function(){this._syncModel.unbind(null,null,this)},_onClickSyncNow:function(a){a&&this.killEvent(a),this._syncModel.canSyncNow()&&this._showSyncNowModal()},_onClickOptions:function(a){var b=this,c=this._tableModel.getUnqualifiedName();this._modals.create(function(a){return new g({modalModel:a,syncModel:b._syncModel,tableName:c})})},_startSync:function(){this.render(),this._bindChangeSyncEvent(),this._syncModel.pollCheck()},_finishSync:function(){this._syncModel.isSyncing()||(this._unbindChangeSyncEvent(),this._syncModel.destroyCheck(),this._querySchemaModel.set({status:"unfetched",query:"SELECT * FROM "+this._tableModel.getUnquotedName()}),this.render())},_showSyncNowModal:function(a){var b=this,c=this._tableModel.getUnqualifiedName();this._modals.create(function(a){return new f({modalModel:a,loadingTitle:_t("dataset.sync.loading",{tableName:c}),errorTitle:_t("dataset.sync.error",{tableName:c}),runAction:function(c){b._syncModel.set({state:"syncing",error_code:"",error_message:""}),b._syncModel.bind("change:state",function(){b._syncModel.isSyncing()||a.destroy()},b),b._syncModel.syncNow(b._startSync)}})})},clean:function(){this._unbindChangeSyncEvent(),d.prototype.clean.apply(this)}})},{"../../components/modals/creation/modal-creation-view":191,"../../components/modals/sync-options/sync-options-modal-view":239,"../../components/tipsy-tooltip-view":325,"../../data/synchronization-model":368,"../../helpers/required-opts":432,"./dataset-content-sync.tpl":385,"backbone/core-view":454,moment:"moment"}],385:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p class="CDB-Text CDB-Size-small u-secondaryTextColor">\n  <span class="SyncInfo-state SyncInfo-state--small SyncInfo-state--'+(null==(__t=state)?"":_.escape(__t))+' u-rSpace--s"></span>\n  <span class="u-upperCase">\n    ',"success"===state?__p+="\n      "+(null==(__t=_t("dataset.sync.synced",{ranAt:ranAt}))?"":_.escape(__t))+".\n    ":"syncing"===state?__p+="\n      "+(null==(__t=_t("dataset.sync.syncing"))?"":_.escape(__t))+"...\n    ":"failure"===state&&(__p+="\n      "+(null==(__t=_t("dataset.sync.sync-failed"))?"":_.escape(__t))+".\n    "),__p+="\n  </span>\n\n  ","success"===state?__p+="\n    "+(null==(__t=_t("dataset.sync.next",{runAt:runAt}))?"":_.escape(__t))+".\n  ":"syncing"===state?(__p+="\n    ",__p+="\n  "):(errorCode||errorMessage)&&(__p+="\n    "+(null==(__t=_t("dataset.sync.error-code",{errorCode:errorCode}))?"":_.escape(__t))+": "+(null==(__t=errorMessage)?"":_.escape(__t))+".\n  "),__p+="\n\n  ",fromExternalSource||(__p+="\n    ","syncing"!==state&&(__p+='\n      <button class="',__p+=canSyncNow?"u-actionTextColor js-syncNow":"is-disabled js-syncNowDisabled",__p+='">'+(null==(__t=_t("dataset.sync.sync-now"))?"":_.escape(__t))+"</button>.\n    "),__p+="\n  "),__p+="\n\n  ","syncing"!==state&&(__p+='\n    <button class="js-options u-actionTextColor">'+(null==(__t=_t("dataset.sync.view-options"))?"":_.escape(__t))+"</button>.\n  "),__p+="\n</p>\n";return __p}},{underscore:"underscore"}],386:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../components/table/table-manager"),f=a("./dataset-content-options-view"),g=a("../../helpers/required-opts"),h=["analysisDefinitionNodeModel","configModel","modals","userModel","visModel"];b.exports=d.extend({initialize:function(a){g(a,h,this),this.listenTo(this._visModel,"change:name",this._onChangeTableVisName)},render:function(){return this.clearSubViews(),this._initViews(),this},_initViews:function(){this._tableView=e.create({relativePositionated:!0,analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,configModel:this._configModel,modals:this._modals,userModel:this._userModel}),this.addView(this._tableView),this.$el.append(this._tableView.render().el);var a=new f({modals:this._modals,userModel:this._userModel,analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,configModel:this._configModel});a.bind("addColumn",function(){this._tableView.addColumn()},this),a.bind("addRow",function(){this._tableView.addRow()},this),this.addView(a),this.$el.prepend(a.render().el)},_onChangeTableVisName:function(){this._tableView&&this._tableView.getColumnsCollection().setTableName(this._visModel.get("name"))}})},{"../../components/table/table-manager":322,"../../helpers/required-opts":432,"./dataset-content-options-view":382,"backbone/core-view":454}],387:[function(a,b,c){var d=a("underscore"),e=a("../../components/context-menu/context-menu-view"),f=a("../../components/custom-list/custom-list-collection"),g=["ev","isTableOwner","isSync","isCustomQuery","triggerElementID"];b.exports=function(a){d.each(g,function(b){if(void 0===a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this);var b={x:this._ev.clientX,y:this._ev.clientY},c=[{label:_t("dataset.duplicate."+(this._isCustomQuery?"customOption":"option")),val:"duplicate",action:function(){this.trigger("duplicate",this)}}];this._isTableOwner&&(this._isSync||c.push({label:_t("dataset.rename.option"),val:"rename",action:function(){this.trigger("rename",this)}}),c=c.concat([{label:_t("dataset.metadata.option"),val:"metadata",action:function(){this.trigger("metadata",this)}},{label:_t("dataset.lock.option"),val:"lock",action:function(){this.trigger("lock",this)}},{label:_t("dataset.delete.option"),val:"delete",destructive:!0,action:function(){this.trigger("delete",this)}}]));var h=new f(c),i=new e({collection:h,triggerElementID:this._triggerElementID,position:b});return h.bind("change:selected",function(a){var b=a.get("action");b&&b.bind(i)(a)},i),i.model.bind("change:visible",function(a,b){i&&!b&&(h.unbind(null,null,i),i.model.unbind(null,null,i),i.remove())},i),i}},{"../../components/context-menu/context-menu-view":15,"../../components/custom-list/custom-list-collection":23,underscore:"underscore"}],388:[function(a,b,c){var d=a("backbone/core-view"),e=a("./dataset-header.tpl"),f=a("moment"),g=a("../../components/inline-editor/inline-editor-view"),h=a("../../components/tipsy-tooltip-view"),i=a("../operations/table-rename-operation"),j=a("./inline-editor.tpl"),k=a("../../components/modals/confirmation/modal-confirmation-view"),l=a("../../components/modals/remove-dataset/remove-dataset-view"),m=a("../../components/modals/publish/publish-view"),n=a("../../components/privacy-dropdown/privacy-dropdown-view"),o=a("../../components/modals/publish/privacy-collection"),p=a("../../components/modals/publish/create-privacy-options"),q=a("../../components/modals/publish/share-with-view"),r=a("../../components/modals/creation/modal-creation-view"),s=a("../../components/modals/dataset-metadata/dataset-metadata-view"),t=a("../../data/visualization-table-model"),u=a("./rename-confirmation-modal.tpl"),v=a("./create-context-menu"),w=a("../operations/table-duplication-operation"),x=a("../../helpers/required-opts"),y=" | CARTO",z={public:"green",link:"orange",private:"red"},A=["analysisDefinitionNodeModel","configModel","layerDefinitionModel","modals","router","userModel","visModel"];b.exports=d.extend({className:"Editor-HeaderInfoEditor",events:{"click .js-options":"_showContextMenu","click .js-privacy":"_onPrivacyClick"},initialize:function(a){x(a,A,this);var b=p(this._visModel,this._userModel);this._querySchemaModel=this._analysisDefinitionNodeModel.querySchemaModel,this._tableModel=this._analysisDefinitionNodeModel.getTableModel(),this._syncModel=this._tableModel.getSyncModel(),this._privacyCollection=new o(b),this._setDocumentTitle(),this._initBinds()},render:function(){this.clearSubViews();var a=this._visModel.get("privacy"),b=this._tableModel.isOwner(this._userModel),c=this._tableModel._permissionModel,d=c.isOwner(this._userModel)||c.hasWriteAccess(this._userModel);return this.$el.html(e({title:this._tableModel.getUnqualifiedName(),privacy:a,isOwner:this._tableModel.isOwner(this._userModel),isCustomQueryApplied:this._isCustomQueryApplied(),privacyDOMElement:b?"button":"span",isSync:this._tableModel.isSync(),syncState:this._syncModel.get("state"),cssClass:z[a.toLowerCase()],ago:f(this._visModel.get("updated_at")).fromNow(),avatar:this._userModel.get("avatar_url"),isInsideOrg:this._userModel.isInsideOrg(),hasWriteAccess:d})),this._initViews(),this},_initBinds:function(){this.listenTo(this._syncModel,"change:state change:interval destroy",this.render),this.listenTo(this._visModel,"change:name",this._onChangeName),this.listenTo(this._visModel,"change:privacy change:name",this.render),this.listenTo(this._querySchemaModel,"change:query",this.render)},_initViews:function(){var a,b,c=this._tableModel.isOwner(this._userModel);if(this._isDatasetOwner()&&!this._tableModel.isSync()&&(this._inlineEditor=new g({template:j,renderOptions:{name:this._tableModel.getUnqualifiedName()},onEdit:this._onRenameTable.bind(this)}),this.$(".js-name").html(this._inlineEditor.render().el),this.addView(this._inlineEditor)),this._userModel.isInsideOrg()||(a=new n({privacyCollection:this._privacyCollection,visDefinitionModel:this._visModel,userModel:this._userModel,configModel:this._configModel}),this.$(".js-privacyDropdown").html(a.render().el),this.addView(a)),c&&this._userModel.isInsideOrg()&&(b=new q({visDefinitionModel:this._visModel,userModel:this._userModel,action:this._onPrivacyClick.bind(this),separationClass:"u-rSpace--m"}),this.$(".js-share-users").append(b.render().el),this.addView(b)),this._tableModel.isSync()&&this.$(".js-syncState").length){var d=new h({el:this.$(".js-syncState"),gravity:"n",title:function(){return this._getSyncInfo()}.bind(this)});this.addView(d)}},_showContextMenu:function(a){var b=this._tableModel.isOwner(this._userModel),c=this._tableModel.isSync(),d="context-menu-trigger-"+this._tableModel.cid;return this.$(".js-options").attr("id",d),this._menuView&&this._menuView.isVisible()?(this._menuView.hide(),this._menuView.clean(),void delete this._menuView):(this._menuView=v({ev:a,isTableOwner:b,isCustomQuery:this._isCustomQueryApplied(),isSync:c,triggerElementID:d}),this._menuView.bind("rename",function(){this._inlineEditor&&this._inlineEditor.edit()},this),this._menuView.bind("delete",this._deleteDataset,this),this._menuView.bind("duplicate",this._duplicateDataset,this),this._menuView.bind("lock",this._lockDataset,this),this._menuView.bind("metadata",this._metadataDataset,this),this._menuView.show(),void this.addView(this._menuView))},_deleteDataset:function(){var a=this;this._modals.create(function(b){return new l({modalModel:b,userModel:a._userModel,visModel:a._visModel,tableModel:a._tableModel,configModel:a._configModel})})},_duplicateDataset:function(){var a=this,b=this._tableModel.getUnquotedName(),c=this._isCustomQueryApplied()?_t("dataset.duplicate.query"):b;this._modals.create(function(b){return new r({modalModel:b,loadingTitle:_t("dataset.duplicate.loading",{name:c}),errorTitle:_t("dataset.duplicate.error",{name:c}),runAction:function(b){w({query:a._querySchemaModel.get("query"),tableModel:a._tableModel,configModel:a._configModel,onSuccess:function(b){var c=b.get("table_name"),d=new t({id:c,table:{name:c}},{configModel:a._configModel});window.location=d.datasetURL()},onError:function(a){var c=a.get("get_error_text"),d=c&&c.title;b.error&&b.error(d)}})}})})},_lockDataset:function(){var a=this,b=this._tableModel.getUnquotedName();this._modals.create(function(c){return new r({modalModel:c,loadingTitle:_t("dataset.lock.loading",{tableName:b}),errorTitle:_t("dataset.lock.error",{tableName:b}),runAction:function(b){a._visModel.save({locked:!0},{wait:!0,success:function(){window.location=a._configModel.get("base_url")+"/dashboard/datasets"},error:function(){b.error&&b.error()}})}})})},_metadataDataset:function(){var a=this._tableModel.isSync(),b=this;this._modals.create(function(c){return new s({modalModel:c,visDefinitionModel:b._visModel,configModel:b._configModel,isLocked:a})})},_onRenameTable:function(a){var b=this;this._inlineEditor.hide(),a!==this._visModel.get("name")&&this._modals.create(function(c){return new k({modalModel:c,template:u,renderOpts:{tableName:b._visModel.get("name")},runAction:function(){c.destroy(),i({visModel:b._visModel,newName:a,onError:b._onRenameFailed.bind(b)})}})})},_onRenameFailed:function(){this._visModel.set("name",this._visModel.previous("name"),{silent:!0}),this.render()},_onChangeName:function(){var a=this._visModel.get("name");this._analysisDefinitionNodeModel.setTableName(a),this._setDocumentTitle(),this._layerDefinitionModel.save({sql:this._analysisDefinitionNodeModel.getDefaultQuery()}),this._router.navigate(a,{replace:!0})},_onPrivacyClick:function(){var a=this;this._modals.create(function(b){return new m({mapcapsCollection:a._mapcapsCollection,modalModel:b,visDefinitionModel:a._visModel,privacyCollection:a._privacyCollection,userModel:a._userModel,configModel:a._configModel,mode:"share"})})},_getSyncInfo:function(){var a=this._syncModel.get("state");if("success"===a)return _t("dataset.sync.synced",{ranAt:f(this._syncModel.get("ran_at")||new Date).fromNow()});if("failure"===a){var b=this._syncModel.get("error_code"),c=this._syncModel.get("error_message");return _t("dataset.sync.error-code",{errorCode:b})+":"+c}return _t("dataset.sync.syncing")},_setDocumentTitle:function(){document.title=this._tableModel.get("name")+y},_isCustomQueryApplied:function(){return this._analysisDefinitionNodeModel.isCustomQueryApplied()},_isEditable:function(){return!this._analysisDefinitionNodeModel.isReadOnly()},_isDatasetOwner:function(){return this._tableModel.isOwner(this._userModel)}})},{"../../components/inline-editor/inline-editor-view":182,"../../components/modals/confirmation/modal-confirmation-view":190,"../../components/modals/creation/modal-creation-view":191,"../../components/modals/dataset-metadata/dataset-metadata-view":193,"../../components/modals/publish/create-privacy-options":206,"../../components/modals/publish/privacy-collection":207,"../../components/modals/publish/publish-view":212,"../../components/modals/publish/share-with-view":223,"../../components/modals/remove-dataset/remove-dataset-view":237,"../../components/privacy-dropdown/privacy-dropdown-view":268,"../../components/tipsy-tooltip-view":325,"../../data/visualization-table-model":379,"../../helpers/required-opts":432,"../operations/table-duplication-operation":403,"../operations/table-rename-operation":404,"./create-context-menu":387,"./dataset-header.tpl":389,"./inline-editor.tpl":390,"./rename-confirmation-modal.tpl":391,"backbone/core-view":454,moment:"moment"}],389:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Editor-HeaderInfo-inner">\n  <div class="Editor-HeaderInfo-title u-bSpace--m u-flex u-alignCenter">\n    ',isSync&&isOwner&&(__p+='\n      <div class="Editor-HeaderInfo-actions">\n        <span class="SyncInfo-state SyncInfo-state--'+(null==(__t=syncState)?"":_.escape(__t))+' u-rSpace--m js-syncState"></span>\n      </div>\n    '),__p+='\n\n    <div class="Editor-HeaderInfo-titleText is-larger js-name">\n      <h2 class="u-ellipsis CDB-Text CDB-Size-huge is-light">'+(null==(__t=title)?"":_.escape(__t))+'</h2>\n    </div>\n\n    <div class="Editor-HeaderInfo-details u-lSpace">\n      ',hasWriteAccess||(__p+='\n        <span class="Tag CDB-Text CDB-Size-small u-rSpace u-upperCase js-readPermissionTag">'+(null==(__t=_t("dataset.read"))?"":_.escape(__t))+"</span>\n      "),__p+="\n\n      ",isCustomQueryApplied&&(__p+='\n        <span class="Tag Tag--outline Tag-outline--dark CDB-Text CDB-Size-small u-secondaryTextColor u-rSpace">'+(null==(__t=_t("dataset.sql"))?"":_.escape(__t))+"</span>\n      "),__p+='\n\n      <button class="CDB-Shape js-options">\n        <div class="CDB-Shape-threePoints is-blue is-small">\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n        </div>\n      </button>\n    </div>\n  </div>\n\n  <div class="u-bSpace--xl u-flex u-alignCenter">\n    <div class="js-privacyDropdown u-rSpace--m">\n      <'+(null==(__t=privacyDOMElement)?"":_.escape(__t))+' class="u-actionTextColor ',isOwner&&(__p+="js-privacy"),__p+='">\n        <i class="Tag Tag--big Tag-fill Tag-fill--'+(null==(__t=cssClass)?"":_.escape(__t))+' CDB-Text CDB-Size-small u-upperCase">'+(null==(__t=privacy)?"":_.escape(__t))+"</i>\n      </"+(null==(__t=privacyDOMElement)?"":_.escape(__t))+">\n    </div>\n    ",isOwner&&isInsideOrg&&(__p+='\n      <div class="js-share-users"></div>\n    '),__p+='\n    <span class="CDB-Text CDB-Size-medium u-altTextColor">'+(null==(__t=_t("dataset.updated",{ago:ago}))?"":_.escape(__t))+"</span>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],390:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="Inline-editor" title="'+(null==(__t=name)?"":_.escape(__t))+'">\n  <h2 class="CDB-Text CDB-Size-huge is-light u-ellipsis js-title Inline-editor-text is-larger">'+(null==(__t=name)?"":_.escape(__t))+'</h2>\n  <input type="text" name="text" class="Inline-editor-input Inline-editor-input--small CDB-Text CDB-InputText js-input" value="'+(null==(__t=name)?"":_.escape(__t))+'" readonly>\n</div>\n';return __p}},{underscore:"underscore"}],391:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="12px" height="23px" viewBox="0 0 12 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <path d="M3.85948829,15.9093411 L3.85948829,15.113874 C3.85948829,13.9648603 4.03625698,13.0196388 4.38979966,12.2781813 C4.74334234,11.5367237 5.40131468,10.7535402 6.36373642,9.92860729 C7.6993421,8.79923484 8.54144849,7.94976308 8.89008086,7.38016654 C9.23871322,6.81057 9.41302679,6.12313622 9.41302679,5.31784456 C9.41302679,4.3161403 9.09140598,3.54277728 8.44815472,2.99773232 C7.80490345,2.45268735 6.87932296,2.18016896 5.67138547,2.18016896 C4.8955557,2.18016896 4.13937853,2.27100842 3.40283128,2.45269008 C2.66628403,2.63437173 1.82172252,2.96581302 0.869121409,3.44702389 L0,1.45835626 C1.85609907,0.486113893 3.7956444,0 5.81869418,0 C7.69443451,0 9.15277619,0.461562686 10.193763,1.38470191 C11.2347497,2.30784113 11.7552353,3.60905508 11.7552353,5.28838281 C11.7552353,6.0052888 11.6594856,6.63625482 11.4679833,7.18129978 C11.2764811,7.72634475 10.9941422,8.24192009 10.6209582,8.72804127 C10.2477743,9.21416246 9.44249472,9.99734595 8.20509534,11.0776153 C7.21321171,11.9221894 6.55769449,12.6243539 6.23852401,13.1841299 C5.91935354,13.7439058 5.7597707,14.4902624 5.7597707,15.4232223 L5.7597707,15.9093411 L3.85948829,15.9093411 Z M2.95990869,20.3988536 C2.95990869,19.3235103 3.49337277,18.7858468 4.56031694,18.7858468 C5.07600662,18.7858468 5.47388191,18.9242161 5.75395476,19.2009588 C6.0340276,19.4777016 6.17406192,19.8769958 6.17406192,20.3988536 C6.17406192,20.9048974 6.03180483,21.2982616 5.74728639,21.5789578 C5.46276794,21.859654 5.06711542,22 4.56031694,22 C4.09797446,22 3.71565854,21.8754676 3.41335769,21.6263992 C3.11105685,21.3773307 2.95990869,20.9681529 2.95990869,20.3988536 Z" stroke="none" fill="#FEB100" fill-rule="evenodd" opacity="1"></path>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">\n        '+(null==(__t=_t("dataset.rename.title",{tableName:tableName}))?"":_.escape(__t))+'\n      </h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("dataset.rename.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("dataset.rename.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("dataset.rename.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>";return __p}},{underscore:"underscore"}],392:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="CodeMirror-error">\n  <li class="CodeMirror-errorMessage u-lSpace--xl u-rSpace--xl">\n    '+(null==(__t=_t("components.codemirror.syntax-error"))?"":_.escape(__t))+": <span>"+(null==(__t=message)?"":_.escape(__t))+'</span>\n  </li>\n  <li class="CodeMirror-errorDocs">\n    <a href="https://carto.com/docs/cartodb-platform/sql-api/" target="_black">'+(null==(__t=_t("components.codemirror.docs"))?"":_.escape(__t))+"</a>\n  </li>\n</ul>\n";return __p}},{underscore:"underscore"}],393:[function(a,b,c){var d=a("backbone/core-view"),e=a("./dataset-actions.tpl"),f=a("../../components/undo-redo/undo-redo-view"),g=a("../../helpers/required-opts"),h=["mapAction","previewAction","trackModel","editorModel","queryGeometryModel","onApply","onClear","clearSQLModel"];b.exports=d.extend({className:"Dataset-options-actions",events:{"click .js-createMap":"_onCreateMap","click .js-previewMap":"_onPreviewMap"},initialize:function(a){g(a,h,this),this._queryGeometryModel.bind("change:status",this.render,this),this.add_related_model(this._queryGeometryModel)},render:function(){return this.clearSubViews(),this.$el.html(e({hasGeometry:this._queryGeometryModel.hasValue(),canCreateMap:!0})),this._initViews(),this},_initViews:function(){var a=new f({className:"u-rSpace--xl",trackModel:this._trackModel,editorModel:this._editorModel,clearModel:this._clearSQLModel,applyButton:!0,clearButton:!0,onApplyClick:this._onApply.bind(this),onClearClick:this._onClear.bind(this)});this.$(".js-createMap").before(a.render().el),this.addView(a)},_onApply:function(){this._onApply&&this._onApply()},_onClear:function(){this._onClear&&this._onClear()},_onCreateMap:function(){this._mapAction&&this._mapAction()},_onPreviewMap:function(){this._previewAction&&this._previewAction()}})},{"../../components/undo-redo/undo-redo-view":328,"../../helpers/required-opts":432,"./dataset-actions.tpl":395,"backbone/core-view":454}],394:[function(a,b,c){var d=a("backbone/core-view"),e=a("underscore"),f=a("./dataset-actions.tpl"),g={previewAction:!0,queryGeometryModel:!0,mapAction:!1};b.exports=d.extend({className:"Dataset-options-actions",events:{"click .js-createMap":"_onCreateMap","click .js-previewMap":"_onPreviewMap"
},initialize:function(a){e.each(g,function(b,c){if(a[c])this["_"+c]=a[c];else if(b)throw new Error(c+" is required")},this),this._queryGeometryModel.bind("change:status",this.render,this),this.add_related_model(this._queryGeometryModel)},render:function(){return this.clearSubViews(),this.$el.html(f({hasGeometry:this._queryGeometryModel.hasValue(),canCreateMap:!!this._mapAction})),this},_onPreviewMap:function(){this._previewAction&&this._previewAction()},_onCreateMap:function(){this._mapAction&&this._mapAction()}})},{"./dataset-actions.tpl":395,"backbone/core-view":454,underscore:"underscore"}],395:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",hasGeometry&&(__p+='\n  <button class="u-rSpace--xl Dataset-tablePreview js-previewMap">\n    <span class="u-upperCase CDB-Button-Text CDB-Text CDB-Size-small">'+(null==(__t=_t("dataset.preview-map.preview"))?"":_.escape(__t))+"</span>\n  </button>\n"),__p+="\n",canCreateMap&&(__p+='\n  <button class="CDB-Button CDB-Button--primary u-upperCase js-createMap">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-small">'+(null==(__t=_t("dataset.create-map.title"))?"":_.escape(__t))+"</span>\n  </button>\n"),__p+="\n";return __p}},{underscore:"underscore"}],396:[function(a,b,c){var d=a("jquery"),e=a("backbone/core-view"),f=a("../../data/vis-definition-model"),g=a("../../components/modals/creation/modal-creation-view"),h=a("../../components/dataset/dataset-base-view"),i=a("../../helpers/error-parser"),j=a("../../components/view-options/panel-with-options-view"),k=a("../../components/tab-pane/tab-pane-view"),l=a("../../components/tab-pane/tab-pane-collection"),m=a("../../components/toggler/toggler-view"),n=a("./dataset-sql-view"),o=a("./dataset-actions-view"),p=a("./preview-map-view"),q=a("./dataset-actions-edition-view"),r=a("../data-sql-model"),s=a("../../sql-notifications"),t=a("../../components/metrics/metrics-tracker"),u=a("../../helpers/required-opts"),v=["analysisDefinitionNodeModel","configModel","editorModel","layerDefinitionModel","modals","router","userModel","visModel"];b.exports=h.extend({initialize:function(a){if(u(a,v,this),this._querySchemaModel=this._analysisDefinitionNodeModel.querySchemaModel,!this._layerDefinitionModel.sqlModel){var b=this._layerDefinitionModel.options&&this._layerDefinitionModel.options.sql_history;this._layerDefinitionModel.sqlModel=new r({content:this._querySchemaModel.get("query")},{history:b||[]})}h.prototype.initialize.call(this,{layerDefinitionModel:this._layerDefinitionModel,editorModel:this._editorModel,configModel:this._configModel,querySchemaModel:this._querySchemaModel}),this._tableModel=this._analysisDefinitionNodeModel.getTableModel(),this._queryGeometryModel=this._analysisDefinitionNodeModel.queryGeometryModel,this._canCreateMap=this._userModel.hasCreateMapsFeature(),this._parseSQL=this._internalParseSQL.bind(this),s.track(this),this._configPanes(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this._checkClearButton(),this},_initBinds:function(){this.listenTo(this._editorModel,"change:edition",this._onChangeEdition),this.listenTo(this._querySchemaModel,"change:query_errors",this._showErrors),this.listenTo(this._visModel,"change:name",this._onChangeName),this.listenTo(this._sqlModel,"undo redo",function(){this._codemirrorModel.set("content",this._sqlModel.get("content"))})},_onChangeName:function(a,b){this._codemirrorModel.set("content",this._analysisDefinitionNodeModel.getDefaultQuery())},_initViews:function(){var a=this,b=new j({editorModel:a._editorModel,createContentView:function(){return new k({collection:a._collectionPane})},createControlView:function(){return new m({editorModel:a._editorModel,labels:[_t("dataset.data"),_t("dataset.sql")]})},createActionView:function(){return new k({collection:a._collectionPane,createContentKey:"createActionView"})}});this.$el.append(b.render().el),this.addView(b)},_onChangeEdition:function(){this.$el.toggleClass("is-dark",this._editorModel.isEditing());var a=this._editorModel.get("edition"),b=a?1:0;this._collectionPane.at(b).set({selected:!0})},_configPanes:function(){var a=this,b=[{selected:!this._editorModel.get("edition"),createContentView:function(){return new e},createActionView:function(){var b={queryGeometryModel:a._queryGeometryModel,previewAction:a._previewMap.bind(a)};return a._canCreateMap&&(b.mapAction=a._createMap.bind(a)),new o(b)}},{selected:this._editorModel.get("edition"),createContentView:function(){return new n({editorModel:a._editorModel,codemirrorModel:a._codemirrorModel,onApplyEvent:a._parseSQL,layerDefinitionModel:a._layerDefinitionModel,querySchemaModel:a._querySchemaModel})},createActionView:function(){var b={clearSQLModel:a._clearSQLModel,trackModel:a._sqlModel,editorModel:a._editorModel,queryGeometryModel:a._queryGeometryModel,onApply:a._parseSQL,previewAction:a._previewMap.bind(a),onClear:a._clearSQL.bind(a)};return a._canCreateMap&&(b.mapAction=a._createMap.bind(a)),new q(b)}}];this._collectionPane=new l(b)},_runQuery:function(a,b){this._querySchemaModel.set({query:a,status:"unfetched"}),this._queryGeometryModel.set({query:a,simple_geom:"",status:"unfetched"},{silent:!0}),this._querySchemaModel.fetch({success:b}),this._queryGeometryModel.fetch()},_saveSQL:function(){var a=this._codemirrorModel.get("content");this._sqlModel.set("content",a),this._querySchemaModel.set("query_errors",[]),this._tableModel.hasWriteAccess(this._userModel)&&(this._layerDefinitionModel.save({sql:a}),t.track("Applied sql",{dataset_id:this._tableModel.get("id"),sql:a})),s.showNotification({status:"success",info:_t("notifications.sql.success"),closable:!0}),this._checkClearButton()},_defaultSQL:function(){return this._analysisDefinitionNodeModel.getDefaultQuery()},_previewMap:function(){var a=new p({analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,configModel:this._configModel,modals:this._modals,userModel:this._userModel,visModel:this._visModel});d("body").append(a.render().el),this.addView(a)},_createMap:function(){var a=this,b=this._tableModel.getUnquotedName();this._modals.create(function(c){return new g({modalModel:c,loadingTitle:_t("dataset.create-map.loading",{tableName:b}),errorTitle:_t("dataset.create-map.error",{tableName:b}),runAction:function(b){var c=new f({name:a._visModel.get("name")+" "+_t("editor.map")},{configModel:a._configModel});c.save({source_visualization_id:a._visModel.get("id")},{success:function(a){window.location=a.builderURL()},error:function(a,c){b.error&&b.error(i(c))}})}})})}})},{"../../components/dataset/dataset-base-view":36,"../../components/metrics/metrics-tracker":189,"../../components/modals/creation/modal-creation-view":191,"../../components/tab-pane/tab-pane-collection":277,"../../components/tab-pane/tab-pane-view":285,"../../components/toggler/toggler-view":326,"../../components/view-options/panel-with-options-view":330,"../../data/vis-definition-model":377,"../../helpers/error-parser":426,"../../helpers/required-opts":432,"../../sql-notifications":448,"../data-sql-model":381,"./dataset-actions-edition-view":393,"./dataset-actions-view":394,"./dataset-sql-view":397,"./preview-map-view":398,"backbone/core-view":454,jquery:"jquery"}],397:[function(a,b,c){var d=a("backbone/core-view"),e=a("../../components/code-mirror/code-mirror-view"),f=a("./code-mirror-error.tpl"),g=a("../../editor/editor-hints/factory-hints"),h=a("../../editor/editor-hints/sql-hints");b.exports=d.extend({className:"Editor-content Dataset-editor",initialize:function(a){if(!a.codemirrorModel)throw new Error("codemirrorModel is required");if(!a.onApplyEvent)throw new Error("onApplyEvent");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.layerDefinitionModel)throw new Error("layerDefinitionModel is required");this._codemirrorModel=a.codemirrorModel,this._querySchemaModel=a.querySchemaModel,this._layerDefinitionModel=a.layerDefinitionModel,g.init({querySchemaModel:this._querySchemaModel,layerDefinitionModel:this._layerDefinitionModel,tokens:h})},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function(){var a=g.reset().hints;this.codeMirrorView=new e({className:"Dataset-codemirror",model:this._codemirrorModel,hints:a,mode:"text/x-pgsql",tip:_t("editor.data.code-mirror.tip"),errorTemplate:f}),this.codeMirrorView.bind("codeSaved",this._triggerCodeSaved,this),this.addView(this.codeMirrorView),this.$el.append(this.codeMirrorView.render().el)},_triggerCodeSaved:function(a,b){this.options.onApplyEvent&&this.options.onApplyEvent()}})},{"../../components/code-mirror/code-mirror-view":5,"../../editor/editor-hints/factory-hints":405,"../../editor/editor-hints/sql-hints":406,"./code-mirror-error.tpl":392,"backbone/core-view":454}],398:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("cartodb.js"),g=a("../../components/modals/creation/modal-creation-view"),h=a("../../data/vis-definition-model"),i=a("../../helpers/error-parser"),j=a("./preview-map.tpl"),k=a("../../helpers/required-opts"),l=27,m=["analysisDefinitionNodeModel","configModel","modals","userModel","visModel"];b.exports=d.extend({className:"PreviewMap",events:{"click .js-back":"clean","click .js-createMap":"_createMap"},initialize:function(a){k(a,m,this),this._tableModel=this._analysisDefinitionNodeModel.getTableModel(),this._querySchemaModel=this._analysisDefinitionNodeModel.querySchemaModel,this._syncModel=this._tableModel.getSyncModel(),this._canCreateMap=this._userModel.hasCreateMapsFeature(),this._onKeyDown=this._onKeyDown.bind(this),this._initKeydownBinds()},render:function(){return this.$el.html(j({isOwner:this._tableModel.isOwner(this._userModel),isSync:this._tableModel.isSync(),syncState:this._syncModel.get("state"),name:this._tableModel.get("name"),isCustomQueryApplied:this._analysisDefinitionNodeModel.isCustomQueryApplied(),canCreateMap:this._canCreateMap})),this._initViews(),this},_initViews:function(){this._map=f.createVis(this.$(".js-map"),this._visModel.vizjsonURL(),{legends:!1,authToken:this._configModel.get("auth_tokens")})},_initKeydownBinds:function(){e(document).bind("keydown",this._onKeyDown)},_destroyKeydownBinds:function(){e(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function(a){var b=a.which;b===l&&this.clean()},_createMap:function(){var a=this,b=this._tableModel.getUnquotedName();this._modals.create(function(c){return new g({modalModel:c,loadingTitle:_t("dataset.create-map.loading",{tableName:b}),errorTitle:_t("dataset.create-map.error",{tableName:b}),runAction:function(b){var c=new h({name:a._visModel.get("name")+" "+_t("editor.map")},{configModel:a._configModel});c.save({source_visualization_id:a._visModel.get("id")},{success:function(a){window.location=a.builderURL()},error:function(a,c){b.error&&b.error(i(c))}})}})})},clean:function(){this._destroyKeydownBinds(),d.prototype.clean.call(this)}})},{"../../components/modals/creation/modal-creation-view":191,"../../data/vis-definition-model":377,"../../helpers/error-parser":426,"../../helpers/required-opts":432,"./preview-map.tpl":399,"backbone/core-view":454,"cartodb.js":"cartodb.js",jquery:"jquery"}],399:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="PreviewMap-canvas">\n  <div class="PreviewMap-map js-map"></div>\n  <div class="PreviewMap-info u-flex u-justifySpace u-alignCenter js-info">\n    <div class="PreviewMap-infoName u-flex u-alignCenter">\n      ',isSync&&isOwner&&(__p+='\n        <span class="SyncInfo-state SyncInfo-state--'+(null==(__t=syncState)?"":_.escape(__t))+' u-rSpace--m js-syncState"></span>\n      '),__p+='\n      <h2 class="u-ellipsis CDB-Text CDB-Size-large u-rSpace--m is-light">'+(null==(__t=name)?"":_.escape(__t))+"</h2>\n      ",isCustomQueryApplied&&(__p+='\n        <span class="CDB-Tag CDB-Tag--opaque u-secondaryTextColor CDB-Text CDB-Size-medium u-upperCase">'+(null==(__t=_t("dataset.sql"))?"":_.escape(__t))+"</span>\n      "),__p+='\n    </div>\n    <div class="PreviewMap-infoActions">\n      <button class="u-upperCase CDB-Text CDB-Size-small u-lSpace--xl u-actionTextColor js-back">\n        '+(null==(__t=_t("dataset.preview-map.back"))?"":_.escape(__t))+"\n      </button>\n      ",canCreateMap&&(__p+='\n        <button class="CDB-Button CDB-Button--primary u-upperCase u-lSpace--xl js-createMap">\n          <span class="CDB-Button-Text CDB-Text CDB-Size-small">'+(null==(__t=_t("dataset.create-map.title"))?"":_.escape(__t))+"</span>\n        </button>\n      "),__p+="\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],400:[function(a,b,c){var d=a("backbone/core-view"),e=a("jquery"),f=a("underscore"),g=a("../helpers/error-parser"),h=a("./dataset-unlock-modal.tpl"),i=a("../components/loading/render-loading"),j=a("../components/error/error-view"),k=["tableName","visModel","configModel","modalModel"];b.exports=d.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function(a){f.each(k,function(b){if(!a[b])throw new Error(b+" is required");this["_"+b]=a[b]},this),this._onKeyDown=this._onKeyDown.bind(this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(h({tableName:this._tableName})),this},_initBinds:function(){e(document).bind("keydown",this._onKeyDown),this._modalModel.bind("change:show",function(){this._visModel.get("locked")&&this._onCancel()},this),this.add_related_model(this._modalModel)},_disableBinds:function(){e(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function(a){var b=a.which;b===e.ui.keyCode.ENTER&&this._onConfirm()},_renderLoadingView:function(){this.$el.html(i({title:_t("dataset.unlock.loading",{tableName:this._tableName})}))},_renderErrorView:function(a){var b=new j({title:_t("dataset.unlock.error",{tableName:this._tableName}),desc:a});this.$el.html(b.render().el),this.addView(b)},_$content:function(){return this.$(".js-content")},_onConfirm:function(){this._renderLoadingView(),this._visModel.save({locked:!1},{wait:!0,success:function(){this._modalModel.destroy()}.bind(this),error:function(a,b){this._renderErrorView(g(b))}.bind(this)})},_onCancel:function(){window.location=this._configModel.get("base_url")},clean:function(){this._disableBinds(),d.prototype.clean.apply(this)}})},{"../components/error/error-view":37,"../components/loading/render-loading":187,"../helpers/error-parser":426,"./dataset-unlock-modal.tpl":401,"backbone/core-view":454,jquery:"jquery",underscore:"underscore"}],401:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="u-flex u-justifyCenter">\n  <div class="Modal-inner Modal-inner--grid u-flex u-justifyCenter">\n    <div class="Modal-icon">\n      <svg width="16px" height="24px" viewBox="0 5 16 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="lock-open" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(0.000000, 5.000000)">\n          <path d="M14,10.727 L14,5.5 C14,2.467 11.532,0 8.5,0 C5.468,0 3,2.467 3,5.5 L4,5.5 C4,3.019 6.019,1 8.5,1 C10.981,1 13,3.019 13,5.5 L13,9.765 C11.629,8.663 9.892,8 8,8 C3.589,8 0,11.589 0,16 C0,20.411 3.589,24 8,24 C12.411,24 16,20.411 16,16 C16,13.979 15.24,12.136 14,10.727 L14,10.727 Z M8,23 C4.141,23 1,19.86 1,16 C1,12.14 4.141,9 8,9 C11.859,9 15,12.14 15,16 C15,19.86 11.859,23 8,23 L8,23 Z" id="Shape" fill="#000000 "></path>\n          <path d="M8,15 C7.448,15 7,15.449 7,16 C7,16.365 7.207,16.672 7.5,16.847 L7.5,19.5 C7.5,19.776 7.724,20 8,20 C8.276,20 8.5,19.776 8.5,19.5 L8.5,16.847 C8.793,16.672 9,16.365 9,16 C9,15.449 8.552,15 8,15 L8,15 Z" id="Shape" fill="#000000 "></path>\n        </g>\n      </svg>\n    </div>\n    <div>\n      <h2 class=" CDB-Text CDB-Size-huge is-light u-bSpace--xl">'+(null==(__t=_t("dataset.unlock.title",{tableName:tableName}))?"":_.escape(__t))+'</h2>\n      <p class="CDB-Text CDB-Size-large u-altTextColor">'+(null==(__t=_t("dataset.unlock.desc"))?"":_.escape(__t))+'</p>\n      <ul class="Modal-listActions u-flex u-alignCenter">\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--secondary CDB-Button--big js-cancel">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("dataset.unlock.cancel"))?"":_.escape(__t))+'\n            </span>\n          </button>\n        </li>\n        <li class="Modal-listActionsitem">\n          <button class="CDB-Button CDB-Button--primary CDB-Button--big js-confirm">\n            <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium u-upperCase">\n              '+(null==(__t=_t("dataset.unlock.confirm"))?"":_.escape(__t))+"\n            </span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n";return __p}},{underscore:"underscore"}],402:[function(a,b,c){var d=a("../../components/notifier/notifier"),e=a("../../helpers/error-parser");b.exports=function(a){if(!a.visModel)throw new Error("visModel is required");var b=a.visModel,c=a.onSuccess,f=a.onError;b.destroy({wait:!0,success:function(a,b){c&&c(a,b)},error:function(a,c){f&&f(a,c),d.addNotification({status:"error",info:_t("dataset.delete.error",{tableName:b.get("name"),error:e(c)}),closable:!0})}})}},{"../../components/notifier/notifier":252,"../../helpers/error-parser":426}],403:[function(a,b,c){var d=a("../../data/background-importer/import-model");b.exports=function(a){if(!a.tableModel)throw new Error("tableModel is required");if(!a.query)throw new Error("query is required");if(!a.configModel)throw new Error("configModel is required");var b=a.tableModel,c=a.configModel,e=a.query,f=a.onSuccess,g=a.onError,h={table_name:b.getUnqualifiedName()+"_copy",sql:e},i=new d({},{configModel:c});i.save(h,{error:g&&g,success:function(a,b){a.bind("change:state",function(){var b=this.get("state"),c=this.get("success");"failure"===b?g&&g(a):"complete"===b&&c&&f&&f(a)},a)}})}},{"../../data/background-importer/import-model":339}],404:[function(a,b,c){var d=a("../../components/notifier/notifier"),e=a("../../helpers/error-parser");b.exports=function(a){if(!a.visModel)throw new Error("visModel is required");if(!a.newName)throw new Error("newName is required");var b=a.visModel,c=a.newName,f=a.onSuccess,g=a.onError,h=d.addNotification({status:"loading",info:_t("dataset.rename.loading",{tableName:b.get("name")}),closable:!1});b.save({name:c},{wait:!0,success:function(a,c){f&&f(a,c),h.set({status:"success",info:_t("dataset.rename.success",{tableName:b.get("name")}),closable:!0})},error:function(a,c){g&&g(a,c),h.set({status:"error",info:_t("dataset.rename.error",{tableName:b.get("name"),error:e(c)}),closable:!0})}})}},{"../../components/notifier/notifier":252,"../../helpers/error-parser":426}],405:[function(a,b,c){var d=a("underscore"),e=a("../../helpers/table-name-utils"),f={},g=["querySchemaModel","layerDefinitionModel","tokens"],h={tableName:!0,columnsName:!0,keywords:!0};b.exports={init:function(a){if(!a)throw new Error("options are required for hints");this.options=d.defaults(d.pick(a,["tableName","columnsName","keywords"]),h),d.each(g,function(b){this["_"+b]=a[b]},this)},hints:function(){return this.hints},reset:function(){return this.hints=d.union(this._getTableName(),this._getColumns(),this._getKeywords()),this},_getKeywords:function(){return this.options.keywords?this._tokens&&this._memo(this._tokens):[]},_getColumns:function(){if(!this.options.columnsName)return[];var a=this._querySchemaModel.columnsCollection;return a.map(function(a){var b=a.get("name");return{text:b,type:"Column_name"}})},_getTableName:function(){if(!this.options.tableName)return[];var a=this._layerDefinitionModel.getTableName();return a=e.getUnqualifiedName(a),[{text:a,type:"Table_name"}]},_memo:function(a,b){return a in f?f[a]:f[a]=this._make(a,b)},_make:function(a,b){return d.chain(a).map(function(a){return a.keywords.split(" ").map(function(b){return{text:b,type:a.type}})}).flatten().value()}}},{"../../helpers/table-name-utils":434,underscore:"underscore"}],406:[function(a,b,c){b.exports=[{keywords:"alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit",type:"Sql"},{keywords:"ST_GeometryType ST_polygon ST_multipolygon ST_multilinestring ST_linestring ST_multipoint ST_point",type:"Postgis"}]},{}],407:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("../../../../data/undo-manager.js");b.exports=d.Model.extend({defaults:{content:""},initialize:function(a,b){this._history=this._generateHistory(b&&b.history),f.init(this,{track:!0,history:this._history})},_generateHistory:function(a){if(a&&a.length){var b=e.reduce(a,function(a,b){return a.push({content:b}),a},[],this);return b}return!1},getHistory:function(){return e.pluck(this.getUndoHistory(),"content")}})},{"../../../../data/undo-manager.js":371,backbone:"backbone",underscore:"underscore"}],408:[function(a,b,c){var d=a("backbone"),e=a("../../data/undo-manager.js"),f=a("underscore");b.exports=d.Model.extend({defaults:{content:""},initialize:function(a,b){this._history=this._generateHistory(b&&b.history),e.init(this,{track:!0,history:this._history})},_generateHistory:function(a){if(a&&a.length){var b=f.reduce(a,function(a,b){return a.push({content:b}),a},[],this);return b}return!1},getHistory:function(){return f.pluck(this.getUndoHistory(),"content")}})},{"../../data/undo-manager.js":371,backbone:"backbone",underscore:"underscore"}],409:[function(a,b,c){var d=a("underscore"),e=a("./simple-style-defaults");b.exports=d.defaults({generateAttributes:function(a){return d.extend(this._getStyleTypeAttrs(),this._getFillAttrs(a),this._getStrokeAttrs(a),{blending:"lighter"},this._getAggrAttrs(a),this._getAnimatedAttrs(a))},_getStyleTypeAttrs:function(){return{style:"simple"}},_getAnimatedAttrs:function(a){return{animated:{attribute:null,overlap:!1,duration:30,steps:256,trails:2,resolution:4}}},_getAggrAttrs:function(a){return{aggregation:{}}}},e)},{"./simple-style-defaults":413,underscore:"underscore"}],410:[function(a,b,c){var d=a("underscore"),e=a("./simple-style-defaults"),f=a("cartocolor");b.exports=d.defaults({generateAttributes:function(a){return d.extend(this._getFillAttrs(a),this._getAggrAttrs(),this._getAnimatedAttrs(),this._getLabelsAttrs())},_getFillAttrs:function(a){var b={fill:{size:{fixed:45},color:{attribute:"cartodb_id",range:f.ag_Sunset[7],bins:6}}};return b},_getAggrAttrs:function(){return{aggregation:{}}},_getAnimatedAttrs:function(a){return{animated:{attribute:"cartodb_id",overlap:!1,duration:30,steps:1,trails:0,resolution:4}}},_getLabelsAttrs:function(){return{labels:{}}}},e)},{"./simple-style-defaults":413,cartocolor:"cartocolor",underscore:"underscore"}],411:[function(a,b,c){var d=a("underscore"),e=a("./simple-style-defaults"),f=a("../../../data/default-form-styles.json"),g=a("../../../helpers/utils"),h=a("cartocolor");b.exports=d.defaults({_getAggrAttrs:function(a){return{aggregation:{size:10,value:{operator:"count",attribute:""}}}},_getStrokeAttrs:function(a){var b=f.stroke;return{stroke:g.cloneObject(b)}},_getFillAttrs:function(a){var b=h.ag_GrnYl[5];return{fill:{color:{attribute:"agg_value",bins:"5",quantification:"quantiles",range:g.cloneObject(b)}}}}},e)},{"../../../data/default-form-styles.json":347,"../../../helpers/utils":435,"./simple-style-defaults":413,cartocolor:"cartocolor",underscore:"underscore"}],412:[function(a,b,c){var d=a("underscore"),e=a("./simple-style-defaults"),f=a("cartocolor");b.exports=d.defaults({_getAggrAttrs:function(a){return{aggregation:{dataset:"countries",change:"manual",value:{operator:"count",attribute:""}}}},_getFillAttrs:function(a){return{fill:{color:{attribute:"agg_value_density",bins:"5",quantification:"quantiles",range:d.clone(f.Emrld[5])}}}}},e)},{"./simple-style-defaults":413,cartocolor:"cartocolor",underscore:"underscore"}],413:[function(a,b,c){var d=a("underscore"),e=a("./style-defaults"),f=a("../../../data/default-cartography.json"),g=a("../../../data/default-form-styles.json"),h=a("../../../helpers/utils");b.exports=d.defaults({generateAttributes:function(a){return d.extend({},this._getFillAttrs(a),this._getStrokeAttrs(a),{blending:g.blending},this._getAggrAttrs(a),this._getLabelsAttrs())},_getFillAttrs:function(a){var b=f.simple[a].fill;return{fill:h.cloneObject(b)}},_getStrokeAttrs:function(a){var b=f.simple[a].stroke;return{stroke:h.cloneObject(b)}},_getAggrAttrs:function(){var a=g.aggregation;return{aggregation:h.cloneObject(a)}},_getLabelsAttrs:function(){var a=g.labels;return{labels:h.cloneObject(a)}}},e)},{"../../../data/default-cartography.json":346,"../../../data/default-form-styles.json":347,"../../../helpers/utils":435,"./style-defaults":415,underscore:"underscore"}],414:[function(a,b,c){var d=a("underscore"),e=a("./hexabins-aggregation-style-defaults");b.exports=d.defaults({_getAggrAttrs:function(a){return{aggregation:{size:12,value:{operator:"count",attribute:""}}}}},e)},{"./hexabins-aggregation-style-defaults":411,underscore:"underscore"}],415:[function(a,b,c){b.exports={generateAttributes:function(a){return{fill:null,stroke:null,blending:null,aggregation:{},labels:{}}}}},{}],416:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./styles-factory"),g=a("../../data/undo-manager");b.exports=d.Model.extend({parse:function(a){return a=a||{},e.extend({type:a.type,autogenerated:a&&a.autogenerated},a.properties)},initialize:function(a,b){this.get("type")||this.setDefaultPropertiesByType("simple","point"),g.init(this,{track:!0})},resetPropertiesFromAutoStyle:function(){this._stylesPreAutoStyle&&(delete this.attributes.autoStyle,this.set(this._stylesPreAutoStyle),this.removeStylesPreAutoStyle())},removeStylesPreAutoStyle:function(){delete this._stylesPreAutoStyle},setPropertiesFromAutoStyle:function(a){if(!a.definition)throw new Error("definition is required");if(!a.geometryType)throw new Error("geometryType is required");if(!a.widgetId)throw new Error("widgetId is required");this._stylesPreAutoStyle||(this._stylesPreAutoStyle=JSON.parse(JSON.stringify(this.attributes))),delete this.attributes.autoStyle;var b=function(a,b){var c=this.get(a);if(b.color&&b.color.domain){var d=e.compact(e.map(b.color.domain,function(a){return a&&a!==!0?'"'+a.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':a}));b.color.static=!0,b.color.domain=d,b.color.quantification="category",b.color.attribute_type="string"}else b.color.bins=b.color.range.length,b.color.quantification="quantiles",b.color.attribute_type="number";return c=e.extend(c,b)}.bind(this),c=JSON.parse(JSON.stringify(this.attributes));"line"===a.geometryType?c.stroke=b("stroke",a.definition[a.geometryType]):c.fill=b("fill",a.definition[a.geometryType]),this.set(e.extend({type:"simple",autoStyle:a.widgetId},c))},setDefaultPropertiesByType:function(a,b,c){this.set(e.extend({type:a},f.getDefaultStyleAttrsByType(a,b)),{silently:!!c}),c&&this.trigger("style:update")},setFill:function(a){var b=f.getDefaultStyleAttrsByType(a,"point");this.set("fill",b.fill)},applyLastState:function(){this._undoManager.stopTracking(),this.trigger("change"),this._undoManager.startTracking()},resetStyles:function(){this.setDefaultPropertiesByType("none","")},isAutogenerated:function(){return this.get("autogenerated")},isAggregatedType:function(){return e.contains(f.getAggregationTypes(),this.get("type"))},isAnimation:function(){return"animation"===this.get("type")},hasNoneStyles:function(){return"none"===this.get("type")},canApplyAutoStyle:function(){return"simple"===this.get("type")},getColumnsUsedForStyle:function(){var a=[],b=this.get("fill");b&&b.color&&b.color.attribute&&a.push({name:b.color.attribute,type:b.color.attribute_type||"string"}),b&&b.size&&b.size.attribute&&a.push({name:b.size.attribute,type:"number"});var c=this.get("stroke");c&&c.color&&c.color.attribute&&a.push({name:c.color.attribute,type:c.color.attribute_type||"string"}),c&&c.size&&c.size.attribute&&a.push({name:c.size.attribute,type:"number"});var d=this.get("labels");d&&d.attribute&&d.enabled&&a.push({name:d.attribute});var e=this.get("aggregation");return e&&e.value&&e.value.attribute&&a.push({name:e.value.attribute,type:e.value.attribute_type||"string"}),a},toJSON:function(){return{type:this.get("type"),properties:e.omit(this.attributes,"type","autogenerated")}}})},{"../../data/undo-manager":371,"./styles-factory":423,backbone:"backbone",underscore:"underscore"}],417:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="16px" viewBox="718 455 56 16">\n    <g id="animated" transform="translate(718.000000, 455.000000)" class="Style-fill">\n        <rect id="Rectangle-649" x="40" y="0" width="16" height="16" rx="8"></rect>\n        <rect id="Rectangle-649" opacity="0.8" x="30" y="0" width="16" height="16" rx="8"></rect>\n        <rect id="Rectangle-649" opacity="0.6" x="20" y="0" width="16" height="16" rx="8"></rect>\n        <rect id="Rectangle-649" opacity="0.4" x="10" y="0" width="16" height="16" rx="8"></rect>\n        <rect id="Rectangle-649" opacity="0.2" x="0" y="0" width="16" height="16" rx="8"></rect>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],418:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="25px" viewBox="0 0 56 25">\n    <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Aggregation-/-Heatmap" transform="translate(-15.000000, -16.000000)">\n            <g id="Group-7">\n                <g transform="translate(15.000000, 16.000000)">\n                    <g id="Group-2" style="mix-blend-mode: luminosity;" transform="translate(28.000000, 12.500000) rotate(-90.000000) translate(-28.000000, -12.500000) translate(15.500000, -15.500000)" class="Style-fill">\n                        <g id="heat-copy-2" transform="translate(0.000000, 36.000000)">\n                            <circle id="Oval-120" opacity="0.4" cx="6" cy="6" r="6"></circle>\n                            <circle id="Oval-120-Copy" opacity="0.6" cx="6.5" cy="5.5" r="4.03333333"></circle>\n                            <path d="M6.5,8.06666667 C7.91753086,8.06666667 9.06666667,6.91753086 9.06666667,5.5 C9.06666667,4.08246914 7.91753086,2.93333333 6.5,2.93333333 C5.08246914,2.93333333 3.93333333,4.08246914 3.93333333,5.5 C3.93333333,6.91753086 5.08246914,8.06666667 6.5,8.06666667 Z" id="Oval-120-Copy-2" opacity="0.8"></path>\n                            <circle id="Oval-120-Copy-3" cx="6.5" cy="5.5" r="1.1"></circle>\n                        </g>\n                        <g id="heat-copy-2" transform="translate(13.000000, 48.000000)">\n                            <circle id="Oval-120" opacity="0.4" cx="4" cy="4" r="4"></circle>\n                            <circle id="Oval-120-Copy" opacity="0.6" cx="4" cy="4" r="2.93333333"></circle>\n                            <path d="M4,5.86666667 C5.03093153,5.86666667 5.86666667,5.03093153 5.86666667,4 C5.86666667,2.96906847 5.03093153,2.13333333 4,2.13333333 C2.96906847,2.13333333 2.13333333,2.96906847 2.13333333,4 C2.13333333,5.03093153 2.96906847,5.86666667 4,5.86666667 Z" id="Oval-120-Copy-2" opacity="0.8"></path>\n                            <circle id="Oval-120-Copy-3" cx="4" cy="4" r="0.8"></circle>\n                        </g>\n                        <g id="heat-copy-3" transform="translate(0.500000, 0.500000)">\n                            <circle id="Oval-120" opacity="0.4" cx="12" cy="12" r="12"></circle>\n                            <ellipse id="Oval-120-Copy" opacity="0.6" cx="12" cy="12" rx="8.8" ry="8.8"></ellipse>\n                            <path d="M12,17.6 C15.0927946,17.6 17.6,15.0927946 17.6,12 C17.6,8.9072054 15.0927946,6.4 12,6.4 C8.9072054,6.4 6.4,8.9072054 6.4,12 C6.4,15.0927946 8.9072054,17.6 12,17.6 Z" id="Oval-120-Copy-2" opacity="0.8"></path>\n                            <circle id="Oval-120-Copy-3" cx="12" cy="12" r="2.4"></circle>\n                        </g>\n                        <g id="heat" transform="translate(8.000000, 25.000000)">\n                            <path d="M0.0682602115,8.5161863 C0.564222232,12.1776805 3.7025171,15 7.5,15 C11.6421356,15 15,11.6421356 15,7.5 C15,3.35786438 11.6421356,0 7.5,0 C3.35786438,0 0,3.35786438 0,7.5 C0,7.84465272 0.0232475903,8.18387567 0.0682602115,8.5161863 Z" id="Oval-120" opacity="0.4"></path>\n                            <circle id="Oval-120-Copy" opacity="0.6" cx="7.5" cy="7.5" r="5.5"></circle>\n                            <path d="M7.5,11 C9.43299662,11 11,9.43299662 11,7.5 C11,5.56700338 9.43299662,4 7.5,4 C5.56700338,4 4,5.56700338 4,7.5 C4,9.43299662 5.56700338,11 7.5,11 Z" id="Oval-120-Copy-2" opacity="0.8"></path>\n                            <circle id="Oval-120-Copy-3" cx="7.5" cy="7.5" r="1.5"></circle>\n                        </g>\n                    </g>\n                    <g id="Group-8" style="mix-blend-mode: luminosity;" transform="translate(15.000000, 4.000000)">\n                        <path opacity="0.4" d="M6,0.5 C6,0.5 10,4 13,0 C12,2.5 11.5,4.5 11.5,4.5 L10.5,6.5 L7,3.5 L6,0.5 Z" id="Path-494" class="Style-fill"></path>\n                        <path opacity="0.4" d="M21.2158501,6.00893743 C21.2158501,6.00893743 25.2158501,9.50893743 28.2158501,5.50893743 C27.2158501,8.00893743 26.7158501,10.0089374 26.7158501,10.0089374 L25.7158501,12.0089374 L22.2158501,9.00893743 L21.2158501,6.00893743 Z" id="Path-494" class="Style-fill" transform="translate(24.715850, 8.758937) rotate(52.000000) translate(-24.715850, -8.758937) "></path>\n                        <path opacity="0.4" d="M16.9683476,9.30864826 C16.9683476,9.30864826 22.1000758,13.6622016 25.1000758,9.66220164 C24.1000758,12.1622016 23.8307892,14.1229281 23.8307892,14.1229281 L22.8307892,16.1229281 L17.6754544,11.4299685 L16.9683476,9.30864826 Z" id="Path-494" class="Style-fill" transform="translate(21.034212, 12.715788) rotate(-135.000000) translate(-21.034212, -12.715788) "></path>\n                        <path opacity="0.4" d="M6.01244045,6.22463473 C6.01244045,6.22463473 9.69418934,8.6717337 12.6941893,4.6717337 C11.6941893,7.1717337 11.1941893,9.1717337 11.1941893,9.1717337 L10.8665273,11.557349 L9.7765744,13.8621271 L6.01244045,6.22463473 Z" id="Path-494" class="Style-fill" transform="translate(9.353315, 9.266930) rotate(-194.000000) translate(-9.353315, -9.266930) "></path>\n                        <path opacity="0.6" d="M6,7.5 C5.85295664,5.882523 3.5,2.5 3.5,2.5 C3.5,2.5 6.5,5 9,5 C11.5,5 14.5,1 14.5,1 C14.5,1 12.5,4.25504557 12.5,6 C12.5,7.25504557 14.5,10 14.5,10 C14.5,10 12,8 9.5,8 C7,8 4.5,13.5 4.5,13.5 C4.5,13.5 6.18628997,9.54918967 6,7.5 Z" id="Path-497" class="Style-fill"></path>\n                        <path opacity="0.6" d="M19.7830175,9.69012543 C19.6894445,8.07264843 16.7664559,5.429802 16.7664559,5.429802 C16.7664559,5.429802 20.2086087,8.27970692 21.7995178,8.27970692 C23.3904269,8.27970692 26.4566805,5.77970692 26.4566805,5.77970692 C26.4566805,5.77970692 24.4742142,8.43779004 24.4742142,10.1827445 C24.4742142,11.43779 25.8285796,12.5099091 25.8285796,12.5099091 C25.8285796,12.5099091 23.7086087,11.2797069 22.1176996,11.2797069 C20.5267905,11.2797069 17.9729009,15.2555074 17.9729009,15.2555074 C17.9729009,15.2555074 19.9015657,11.7393151 19.7830175,9.69012543 Z" id="Path-497" class="Style-fill" transform="translate(21.611568, 10.342655) rotate(52.000000) translate(-21.611568, -10.342655) "></path>\n                        <path id="Path-499" stroke="#979797"></path>\n                        <polygon id="Path-500" class="Style-fill" points="0.5 12.5 5 7.5 1 4"></polygon>\n                    </g>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>';
return __p}},{underscore:"underscore"}],419:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="52px" height="23px" viewBox="0 0 52 23">\n    <g id="Symbols">\n        <g id="Aggregation-/-Hexabins" transform="translate(-15.000000, -17.000000)" class="Style-fill">\n            <g id="Hexabins">\n                <g transform="translate(15.000000, 17.000000)">\n                    <polygon id="Polygon-1-Copy-4" points="23 11 28 14 28 20 23 23 18 20 18 14"></polygon>\n                    <polygon id="Polygon-1-Copy-8" points="17 0 22 3 22 9 17 12 12 9 12 3"></polygon>\n                    <polygon id="Polygon-1-Copy-8" points="5 0 10 3 10 9 5 12 -1.15463195e-13 9 3.85466323e-09 3"></polygon>\n                    <polygon id="Polygon-1-Copy-13" points="29 0 34 3 34 9 29 12 24 9 24 3"></polygon>\n                    <polygon id="Polygon-1-Copy-15" points="41 0 46 3 46 9 41 12 36 9 36 3"></polygon>\n                    <polygon id="Polygon-1-Copy-14" points="35 11 40 14 40 20 35 23 30 20 30 14"></polygon>\n                    <polygon id="Polygon-1-Copy-14" points="47 11 52 14 52 20 47 23 42 20 42 14"></polygon>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],420:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="24px" viewBox="16 16 56 24">\n    <g id="points" transform="translate(16.000000, 16.000000)"  class="Style-fill">\n        <path d="M6,10 C8.209139,10 10,8.209139 10,6 C10,3.790861 8.209139,2 6,2 C3.790861,2 2,3.790861 2,6 C2,8.209139 3.790861,10 6,10 Z" id="Oval-59"></path>\n        <path d="M52,8 C54.209139,8 56,6.209139 56,4 C56,1.790861 54.209139,0 52,0 C49.790861,0 48,1.790861 48,4 C48,6.209139 49.790861,8 52,8 Z" id="Oval-59-Copy-2"></path>\n        <path d="M52,22 C54.209139,22 56,20.209139 56,18 C56,15.790861 54.209139,14 52,14 C49.790861,14 48,15.790861 48,18 C48,20.209139 49.790861,22 52,22 Z" id="Oval-59-Copy-3"></path>\n        <path d="M4,24 C6.209139,24 8,22.209139 8,20 C8,17.790861 6.209139,16 4,16 C1.790861,16 0,17.790861 0,20 C0,22.209139 1.790861,24 4,24 Z" id="Oval-59-Copy"></path>\n        <path d="M28,8 C30.209139,8 32,6.209139 32,4 C32,1.790861 30.209139,0 28,0 C25.790861,0 24,1.790861 24,4 C24,6.209139 25.790861,8 28,8 Z" id="Oval-59-Copy-4"></path>\n        <path d="M24,20 C26.209139,20 28,18.209139 28,16 C28,13.790861 26.209139,12 24,12 C21.790861,12 20,13.790861 20,16 C20,18.209139 21.790861,20 24,20 Z" id="Oval-59-Copy-4"></path>\n        <path d="M16,16 C18.209139,16 20,14.209139 20,12 C20,9.790861 18.209139,8 16,8 C13.790861,8 12,9.790861 12,12 C12,14.209139 13.790861,16 16,16 Z" id="Oval-59-Copy-4"></path>\n        <path d="M44,12 C46.209139,12 48,10.209139 48,8 C48,5.790861 46.209139,4 44,4 C41.790861,4 40,5.790861 40,8 C40,10.209139 41.790861,12 44,12 Z" id="Oval-59-Copy-4"></path>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],421:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="56px" height="24px" viewBox="0 0 56 24">\n    <g id="Symbols">\n        <g id="Aggregation-/-Admin-Regions" transform="translate(-16.000000, -16.000000)" class="Style-fill">\n            <g id="regions">\n                <g transform="translate(16.000000, 16.000000)">\n                    <polygon id="Rectangle-649" points="9 8 1 0 27 0 27 17 36 17 36.0065918 23.9934082 25 24 9 16"></polygon>\n                    <polygon id="Rectangle-649" points="0 2 7 9 7 17 21 24 0 24 0 15"></polygon>\n                    <polygon id="Rectangle-649" points="29 0 50 0 50 6 56 6 56 24 48 24 38 24 38 15 29 15"></polygon>\n                    <rect id="Rectangle-1933" x="52" y="0" width="4" height="4"></rect>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],422:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg width="58px" height="28px" viewBox="0 0 58 28">\n    <g id="Symbols">\n        <g id="Aggregation-/-Squares" transform="translate(-15.000000, -14.000000)" class="Style-fill">\n            <g id="squares">\n                <g transform="translate(15.000000, 14.000000)">\n                    <rect id="Rectangle-847-Copy-2" x="10" y="0" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-5" x="30" y="20" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-12" x="40" y="20" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-13" x="40" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-8" x="20" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-6" x="30" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-9" x="20" y="20" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-10" x="10" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-10" x="0" y="10" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-10" x="50" y="20" width="8" height="8" rx="1"></rect>\n                    <rect id="Rectangle-847-Copy-11" x="20" y="0" width="8" height="8" rx="1"></rect>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>';return __p}},{underscore:"underscore"}],423:[function(a,b,c){var d=a("underscore"),e=a("./style-defaults/style-defaults"),f=a("./style-defaults/simple-style-defaults"),g=a("./style-defaults/heatmap-style-defaults"),h=a("./style-defaults/animation-style-defaults"),i=a("./style-defaults/squares-aggregation-style-defaults"),j=a("./style-defaults/hexabins-aggregation-style-defaults"),k=a("./style-defaults/regions-aggregation-style-defaults"),l={none:{labelTranslationKey:"editor.style.types.none",checkIfValid:function(a){return!a},defaultStyles:e},simple:{labelTranslationKey:"editor.style.types.simple",iconTemplate:a("./style-icons/points.tpl"),checkIfValid:function(a){return!!a},defaultStyles:f},squares:{labelTranslationKey:"editor.style.types.squares",iconTemplate:a("./style-icons/squares.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:i},hexabins:{labelTranslationKey:"editor.style.types.hexabins",iconTemplate:a("./style-icons/hexabins.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:j},regions:{labelTranslationKey:"editor.style.types.regions",iconTemplate:a("./style-icons/regions.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:k},animation:{labelTranslationKey:"editor.style.types.animation",iconTemplate:a("./style-icons/animated.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:h},heatmap:{labelTranslationKey:"editor.style.types.heatmap",iconTemplate:a("./style-icons/heatmap.tpl"),checkIfValid:function(a){return"point"===a},defaultStyles:g}};b.exports={getDefaultStyleAttrsByType:function(a,b){var c=l[a].defaultStyles;return c.generateAttributes(b)},getStyleTypes:function(a,b){return d.reduce(l,function(c,d,e){return a!==e&&d.checkIfValid&&!d.checkIfValid(b)||c.push({value:e,label:_t(d.labelTranslationKey),iconTemplate:d.iconTemplate}),c},[])},getFormTemplateByType:function(a){return l[a].formTemplate},getAggregationTypes:function(){return["squares","hexabins","regions"]}}},{"./style-defaults/animation-style-defaults":409,"./style-defaults/heatmap-style-defaults":410,"./style-defaults/hexabins-aggregation-style-defaults":411,"./style-defaults/regions-aggregation-style-defaults":412,"./style-defaults/simple-style-defaults":413,"./style-defaults/squares-aggregation-style-defaults":414,"./style-defaults/style-defaults":415,"./style-icons/animated.tpl":417,"./style-icons/heatmap.tpl":418,"./style-icons/hexabins.tpl":419,"./style-icons/points.tpl":420,"./style-icons/regions.tpl":421,"./style-icons/squares.tpl":422,underscore:"underscore"}],424:[function(a,b,c){b.exports=function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],{name:"IE ",version:a[1]||""}):"Chrome"===c[1]&&(a=b.match(/\bOPR\/(\d+)/),null!=a)?{name:"Opera",version:a[1]}:(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),{name:c[0],version:c[1]})}},{}],425:[function(a,b,c){b.exports=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]},{}],426:[function(a,b,c){var d=a("underscore"),e="";b.exports=function(a){if(!a)throw new Error("error is required");try{var b=a.responseText&&a.responseText.trim()&&JSON.parse(a.responseText),c=a.statusText||e;if(b){var f=d.compact(d.map(["errors","error"],function(a){return b[a]&&b[a].join(", ")}));c=f.join(", ")}return c}catch(a){return e}}},{underscore:"underscore"}],427:[function(a,b,c){b.exports=function(a,b){if(!a)throw new Error("all query objects are required");if(!a.querySchemaModel)throw new Error("querySchemaModel is required");if(!a.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!a.queryRowsCollection)throw new Error("queryRowsCollection is required");var c=function(){return a.querySchemaModel.isFetched()&&a.queryGeometryModel.isFetched()&&a.queryRowsCollection.isFetched()},d=function(){if(a.queryRowsCollection.shouldFetch()){var d={};b&&(d.success=b),a.queryRowsCollection.fetch(d)}else c()&&b&&b()},e=a.queryRowsCollection.size();(a.queryGeometryModel.shouldFetch()||0===e&&a.queryRowsCollection.shouldFetch())&&a.queryGeometryModel.fetch(),a.querySchemaModel.shouldFetch()?a.querySchemaModel.fetch({success:d}):d()}},{}],428:[function(a,b,c){var d=a("underscore"),e={top:0,left:0},f=10,g=205,h=244,i=function(a){if(!a.parentView)throw new Error("parentView within params is required");if(!d.isNumber(a.posX))throw new Error("posX within params is required");if(!d.isNumber(a.posY))throw new Error("posY within params is required");var b=a.parentView,c=b.outerHeight(),i=b.outerWidth(),j=a.posX,k=a.posY,l=a.offsetX||0,m=a.offsetY||0,n=a.elementWidth||h,o=a.elementHeight||g,p=e;return j-n>f?(p.left="auto",p.right=i-j+l+"px"):j+n>n&&(p.right="auto",p.left=j+l+"px"),k+o<c?(p.bottom="auto",p.top=k+m+"px"):k+o>c&&(p.top="auto",p.bottom=c-k+m+"px"),p};b.exports=i},{underscore:"underscore"}],429:[function(a,b,c){var d=a("underscore");b.exports={urlForStaticMap:function(a,b,c,d){var e=a.replace("{user}",b._permissionModel.get("owner").username),f="tpl_"+b.get("id").replace(/-/g,"_"),g=e+"/api/v1/map/static/named/"+f+"/"+c+"/"+d+".png"+this._generateAuthTokensParams(b);return g},_generateAuthTokensParams:function(a){var b=a.get("auth_tokens");return b&&b.length>0?"?"+d.map(b,function(a){return"auth_token="+a}).join("&"):""}}},{underscore:"underscore"}],430:[function(a,b,c){function d(a){return 2===a.which||3===a.which}function e(a){return a.metaKey}function f(a){return a.ctrlKey}var g=a("jquery");b.exports=function(a){this.killEvent(a);var b=g(a.target).closest("a").attr("href");if(!b)return!1;if(d(a)||e(a))(f(a)||e(a))&&window.open(b,"_blank");else{var c=this.routerModel||this.options.routerModel;if(!c)throw new Error("routerModel is required");c.navigate(b,{trigger:!0})}}},{jquery:"jquery"}],431:[function(a,b,c){b.exports=function(a){try{var b=JSON.parse(a);return b.coordinates.join(", ")}catch(a){return!1}}},{}],432:[function(a,b,c){var d=a("underscore");b.exports=function(a,b,c){if(void 0===b)throw new Error("Opts are required");d.each(b,function(b){if(void 0===a[b])throw new Error(b+" is required");c["_"+b]=a[b]},c)}},{underscore:"underscore"}],433:[function(a,b,c){var d=a("./table-name-utils");b.exports={isSameQuery:function(a,b){if(null==a||null==b)throw new Error("Needed parameters not provided");var c=function(a){return a.toLowerCase().replace(/\"/g,"").replace(/;/g,"")};return c(a)===c(b)},altersSchema:function(a){return!!a&&(a=this._removeLineBreaks(a.trim()),a.search(/alter\s+[\w\."]+\s+/i)!==-1||a.search(/drop\s+[\w\.\"]+/i)!==-1||a.search(/^vacuum\s+[\w\.\"]+/i)!==-1||a.search(/^create\s+[\w\.\"]+/i)!==-1||a.search(/^reindex\s+[\w\.\"]+/i)!==-1||a.search(/^grant\s+[\w\.\"]+/i)!==-1||a.search(/^revoke\s+[\w\.\"]+/i)!==-1||a.search(/^cluster\s+[\w\.\"]+/i)!==-1||a.search(/^comment\s+on\s+[\w\.\"]+/i)!==-1||a.search(/^explain\s+[\w\.\"]+/i)!==-1)},altersData:function(a){return!!a&&(a=this._removeLineBreaks(a.trim()),this.altersSchema(a)||a.search(/^refresh\s+materialized\s+view\s+[\w\.\"]+/i)!==-1||a.search(/^truncate\s+[\w\.\"]+/i)!==-1||a.search(/insert\s+into/i)!==-1||a.search(/update\s+[\w\.\-"]+\s+.*set/i)!==-1||a.search(/delete\s+from/i)!==-1)},_removeLineBreaks:function(a){return a.replace(/\r?\n|\r/g," ")},getDefaultSQL:function(a,b,c){return this.getDefaultSQLFromTableName(d.getQualifiedTableName(a,b,c))},getDefaultSQLFromTableName:function(a){return"SELECT * FROM "+a}}},{"./table-name-utils":434}],434:[function(a,b,c){b.exports={getUnqualifiedName:function(a){if(!a)return null;var b=a.split(".");return 2===b.length?this._getUnquotedName(b[1]):this._getUnquotedName(a)},getUsername:function(a){if(!a)return null;var b=a.split(".");return 2===b.length?this._getUnquotedName(b[0]):""},_getUnquotedName:function(a){return a&&a.replace(/"/g,"")},_quoteIfNeeded:function(a){var b=/^[a-zA-Z_][a-zA-Z0-9_$]*$/;return a=this._getUnquotedName(a),b.test(a)||(a='"'+a+'"'),a},getQualifiedTableName:function(a,b,c){var d=c&&b?this._quoteIfNeeded(b)+".":"";return d+this._quoteIfNeeded(this.getUnqualifiedName(a))},isSameTableName:function(a,b,c){var d=this._getTableNameParts(a,c),e=this._getTableNameParts(b,c);return d[0]===e[0]&&d[1]===e[1]},_getTableNameParts:function(a,b){var c=this.getUnqualifiedName(a),d=this.getUsername(a)||b;return[d,c]}}},{}],435:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js");b.exports={isURL:function(a){var b=/^((http|https|ftp)\:\/\/)/g;return!!a&&b.test(a)},isBlank:function(a){return!a||/^\s*$/.test(a)},readablizeBytes:function(a,b){if(!a||isNaN(a))return 0;var c=["bytes","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024)),e=(a/Math.pow(1024,Math.floor(d))).toFixed(2);return b&&(e=parseInt(e,10)),e+" "+c[d]},readizableNumber:function(a){return a>=1e9?(a/1e9).toFixed(1)+"G":a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a},formatNumber:function(a){if(!a)return"0";var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")},result:function(a,b){if(null==a)return null;var c=a[b];return d.isFunction(c)?c.apply(a,Array.prototype.slice.call(arguments,2)):c},getFileExtension:function(a){return a?a.substr(a.lastIndexOf(".")+1):""},pad:function(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c},formatDate:function(a){if(!a.time)throw new Error;if(void 0===a.month)throw new Error;if(void 0===a.year)throw new Error;if(!a.day)throw new Error;var b=parseInt(a.month+1,10),c=function(a){return a=String(a),a<10&&1===a.length?"0"+a:a};return""+a.year+"-"+c(b)+"-"+c(a.day)+"T"+a.time+"Z"},rgbToHex:function(a,b,c){function d(a){var b=a.toString(16);return 1===b.length?"0"+b:b}return"#"+d(a)+d(b)+d(c)},isValidHex:function(a){return!!a.match(/(^#?[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i)},hexToRGB:function(a){a||(a="#FFFFFF");var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},hexToRGBA:function(a,b){function c(a){return+(Math.round(a+"e+2")+"e-2")}var d=this.hexToRGB(a);return b=null!=b?c(b):1,d?"rgba("+[d.r,d.g,d.b,b].join(", ")+")":a},stripHTML:function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a&&"string"==typeof a?a.replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""}):""},sanitizeString:function(a){return a.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"_")},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},formatDecimalPositions:function(a){var b,c=+a,d=0;if(isNaN(c)||0===c)return a;b=Math.abs(c),b>10?d=1:b>.01&&(d=Math.min(Math.ceil(Math.abs(Math.log(b)/Math.log(10)))+2,2)),a=a.toFixed(d);var e=a.match(/(\.0+)$/);return e&&(a=a.replace(e[0],"")),a},removeNewLines:function(a){return a.replace(/(\r\n|\n|\r)/gm,"")},endsWith:function(a,b){return a.indexOf(b,a.length-b.length)!==-1},cloneObject:function(a){return a?JSON.parse(JSON.stringify(a)):a},capitalize:function(a){return a?a.charAt(0).toUpperCase()+a.slice(1):a},sanitizeHtml:function(a){return e.core.sanitize.sanitize(a||"")}}},{"cartodb.js":"cartodb.js",underscore:"underscore"}],436:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-header CDB-infowindow-headerBg CDB-infowindow-headerBg--light js-header" style="background: #35AAE5;">\n      {{#loading}}{{/loading}}\n      <ul class="CDB-infowindow-list">\n        {{#content.fields}}\n          {{^index}}\n            <li class="CDB-infowindow-listItem">\n              {{#title}}<h5 class="CDB-infowindow-subtitle">{{title}}</h5>{{/title}}\n              {{#value}}<h4 class="CDB-infowindow-title {{#type}}{{ type }}{{/type}}">{{{ value }}}</h4>{{/value}}\n            </li>\n            {{^value}}{{/value}}\n          {{/index}}\n        {{/content.fields}}\n      </ul>\n    </div>\n    <div class="CDB-infowindow-inner js-inner">\n      {{#loading}}\n        <div class="CDB-Loader js-loader is-visible"></div>\n      {{/loading}}\n      <ul class="CDB-infowindow-list js-content">\n        {{#content.fields}}\n          {{#index}}\n            <li class="CDB-infowindow-listItem">\n              {{#title}}\n                <h5 class="CDB-infowindow-subtitle">{{title}}</h5>\n              {{/title}}\n              {{#value}}\n                <h4 class="CDB-infowindow-title">{{{ value }}}</h4>\n              {{/value}}\n              {{^value}}\n                <h4 class="CDB-infowindow-title">NULL</h4>\n              {{/value}}\n            </li>\n          {{/index}}\n        {{/content.fields}}\n      </ul>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],437:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--dark js-infowindow" style="background:#2E3C43">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        {{#loading}}\n          <div class="CDB-Loader js-loader is-visible"></div>\n        {{/loading}}\n        <ul class="CDB-infowindow-list js-content">\n          {{#content.fields}}\n          <li class="CDB-infowindow-listItem">\n            {{#title}}<h5 class="CDB-infowindow-subtitle">{{title}}</h5>{{/title}}\n            {{#value}}<h4 class="CDB-infowindow-title">{{{ value }}}</h4>{{/value}}\n            {{^value}}<h4 class="CDB-infowindow-title">null</h4>{{/value}}\n          </li>\n          {{/content.fields}}\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],438:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow" data-cover="true">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-header CDB-infowindow-headerMedia js-header js-cover">\n      {{#loading}}<div class="CDB-Loader js-loader"></div>{{/loading}}\n      <div class="CDB-infowindow-mediaTitle">\n        {{#content.fields.1}}\n          {{#value}}\n            <h4 class="CDB-infowindow-title">\n              <span>{{{ value }}}</span>\n            </h4>\n          {{/value}}\n        {{/content.fields.1}}\n      </div>\n    </div>\n    <div class="CDB-infowindow-inner js-inner">\n      {{#loading}}<div class="CDB-Loader js-loader"></div>{{/loading}}\n      <div class="CDB-infowindow-list js-content">\n        {{#content.fields}}\n          {{#index}}\n            <div class="CDB-infowindow-listItem CDB-infowindow-listItem--order{{index}}">\n              {{#title}}<h5 class="CDB-infowindow-subtitle">{{title}}</h5>{{/title}}\n              {{#value}}<h4 class="CDB-infowindow-title">{{{ value }}}</h4>{{/value}}\n              {{^value}}<h4 class="CDB-infowindow-title">null</h4>{{/value}}\n            </div>\n          {{/index}}\n        {{/content.fields}}\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],439:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        {{#loading}}\n          <div class="CDB-Loader js-loader is-visible"></div>\n        {{/loading}}\n        <ul class="CDB-infowindow-list js-content">\n          {{#content.fields}}\n          <li class="CDB-infowindow-listItem">\n            {{#title}}<h5 class="CDB-infowindow-subtitle">{{title}}</h5>{{/title}}\n            {{#value}}<h4 class="CDB-infowindow-title">{{{ value }}}</h4>{{/value}}\n            {{^value}}<h4 class="CDB-infowindow-title">null</h4>{{/value}}\n          </li>\n          {{/content.fields}}\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],440:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-header CDB-infowindow-headerBg CDB-infowindow-headerBg--light js-header" style="background: #35AAE5;">\n      {{#loading}}{{/loading}}\n      <ul class="CDB-infowindow-list">\n        {{#content.fields}}\n          {{^position}}\n        <li class="CDB-infowindow-listItem">\n          {{#title}}\n            {{#alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{alternative_name}}}</h5>\n            {{/alternative_name}}\n            {{^alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{name}}}</h5>\n            {{/alternative_name}}\n          {{/title}}\n          {{#name}}\n          <h4 class="CDB-infowindow-title {{#type}}{{=<% %>=}}{{<%={{ }}=%>{{{ type }}}{{=<% %>=}}}}<%={{ }}=%>{{/type}}">\n            {{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%>\n          </h4>\n          {{/name}}\n        </li>\n          {{/position}}\n        {{/content.fields}}\n      </ul>\n    </div>\n    <div class="CDB-infowindow-inner js-inner">\n      {{#loading}}\n        <div class="CDB-Loader js-loader is-visible"></div>\n      {{/loading}}\n      <ul class="CDB-infowindow-list js-content">\n        {{#content.fields}}\n          {{#position}}\n        <li class="CDB-infowindow-listItem">\n          {{#title}}\n            {{#alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{alternative_name}}}</h5>\n            {{/alternative_name}}\n            {{^alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{name}}}</h5>\n            {{/alternative_name}}\n          {{/title}}\n          <h4 class="CDB-infowindow-title">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n        </li>\n          {{/position}}\n        {{/content.fields}}\n      </ul>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],441:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--dark js-infowindow" style="background:#2E3C43">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        {{#loading}}\n          <div class="CDB-Loader js-loader is-visible"></div>\n        {{/loading}}\n        <ul class="CDB-infowindow-list js-content">\n          {{#content.fields}}\n          <li class="CDB-infowindow-listItem">\n            {{#title}}\n              {{#alternative_name}}\n              <h5 class="CDB-infowindow-subtitle">{{alternative_name}}</h5>\n              {{/alternative_name}}\n              {{^alternative_name}}\n              <h5 class="CDB-infowindow-subtitle">{{name}}</h5>\n              {{/alternative_name}}\n            {{/title}}\n            <h4 class="CDB-infowindow-title">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n          </li>\n          {{/content.fields}}\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],442:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow" data-cover="true">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-header CDB-infowindow-headerMedia js-header js-cover">\n      {{#loading}}<div class="CDB-Loader js-loader"></div>{{/loading}}\n      <div class="CDB-infowindow-mediaTitle">\n        {{#content.fields.1}}\n        <h4 class="CDB-infowindow-title">\n          <span>{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></span>\n        </h4>\n        {{/content.fields.1}}\n      </div>\n    </div>\n    <div class="CDB-infowindow-inner js-inner">\n      {{#loading}}<div class="CDB-Loader js-loader"></div>{{/loading}}\n      <div class="CDB-infowindow-list js-content">\n        {{#content.fields}}\n          {{#position}}\n        <div class="CDB-infowindow-listItem CDB-infowindow-listItem--order{{position}}">\n            {{#title}}\n              {{#alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{alternative_name}}}</h5>\n              {{/alternative_name}}\n              {{^alternative_name}}\n          <h5 class="CDB-infowindow-subtitle">{{{name}}}</h5>\n              {{/alternative_name}}\n            {{/title}}\n          <h4 class="CDB-infowindow-title">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n        </div>\n          {{/position}}\n        {{/content.fields}}\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],443:[function(a,b,c){b.exports='<div class="CDB-infowindow CDB-infowindow--light js-infowindow">\n  <div class="CDB-infowindow-close js-close"></div>\n  <div class="CDB-infowindow-container">\n    <div class="CDB-infowindow-bg">\n      <div class="CDB-infowindow-inner">\n        {{#loading}}\n          <div class="CDB-Loader js-loader is-visible"></div>\n        {{/loading}}\n        <ul class="CDB-infowindow-list js-content">\n          {{#content.fields}}\n          <li class="CDB-infowindow-listItem">\n            {{#title}}\n              {{#alternative_name}}\n              <h5 class="CDB-infowindow-subtitle">{{alternative_name}}</h5>\n              {{/alternative_name}}\n              {{^alternative_name}}\n              <h5 class="CDB-infowindow-subtitle">{{name}}</h5>\n              {{/alternative_name}}\n            {{/title}}\n            <h4 class="CDB-infowindow-title">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n          </li>\n          {{/content.fields}}\n        </ul>\n      </div>\n    </div>\n    <div class="CDB-hook">\n      <div class="CDB-hook-inner"></div>\n    </div>\n  </div>\n</div>\n'},{}],444:[function(a,b,c){b.exports='<div class="CDB-Tooltip CDB-Tooltip--isDark">\n  <ul class="CDB-Tooltip-list">\n    {{#fields}}\n      <li class="CDB-Tooltip-listItem">\n        {{#title}}\n          <h3 class="CDB-Tooltip-listTitle">{{{ title }}}</h3>\n        {{/title}}\n        <h4 class="CDB-Tooltip-listText">{{{ value }}}</h4>\n      </li>\n    {{/fields}}\n  </ul>\n</div>\n'},{}],445:[function(a,b,c){b.exports='<div class="CDB-Tooltip CDB-Tooltip--isLight">\n  <ul class="CDB-Tooltip-list">\n    {{#fields}}\n      <li class="CDB-Tooltip-listItem">\n        {{#title}}\n          <h3 class="CDB-Tooltip-listTitle">{{{ title }}}</h3>\n        {{/title}}\n        <h4 class="CDB-Tooltip-listText">{{{ value }}}</h4>\n      </li>\n    {{/fields}}\n  </ul>\n</div>\n'},{}],446:[function(a,b,c){b.exports='<div class="CDB-Tooltip CDB-Tooltip--isDark">\n  <ul class="CDB-Tooltip-list">\n    {{#content.fields}}\n      <li class="CDB-Tooltip-listItem">\n        {{#title}}\n          <h3 class="CDB-Tooltip-listTitle">{{{ name }}}</h3>\n        {{/title}}\n        <h4 class="CDB-Tooltip-listText">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n      </li>\n    {{/content.fields}}\n  </ul>\n</div>\n'},{}],447:[function(a,b,c){b.exports='<div class="CDB-Tooltip CDB-Tooltip--isLight">\n  <ul class="CDB-Tooltip-list">\n    {{#content.fields}}\n      <li class="CDB-Tooltip-listItem">\n        {{#title}}\n          <h3 class="CDB-Tooltip-listTitle">{{{ name }}}</h3>\n        {{/title}}\n        <h4 class="CDB-Tooltip-listText">{{=<% %>=}}{{<%={{ }}=%>{{{ name }}}{{=<% %>=}}}}<%={{ }}=%></h4>\n      </li>\n    {{/content.fields}}\n  </ul>\n</div>\n'},{}],448:[function(a,b,c){var d=a("underscore"),e=a("./components/notifier/notifier"),f=d.template("<span class='CDB-Text u-errorTextColor'><%- title %></span>"),g="sql-notifications",h={track:function(a){this._notificationId=g},removeNotification:function(){e.removeNotification(this._notificationId)},showNotification:function(a){this._addOrUpdateNotification(this._notificationId,a)},showErrorNotification:function(a){
var b={status:"error",info:_t("notifications.sql.error.body",{body:f({title:_t("notifications.sql.error.title")}),error:this._transformErrors(a)}),closable:!1};this._addOrUpdateNotification(this._notificationId,b)},_transformErrors:function(a){return d.map(a,function(a){return a.message},this).join(". ")},_addOrUpdateNotification:function(a,b){var c=this._getNotification(a);c?c.set(b):this._addNotification(a,b)},_addNotification:function(a,b){b=d.extend({id:a},b),e.addNotification(b)},_getNotification:function(a){return e.getNotification(a)}};b.exports=h},{"./components/notifier/notifier":252,underscore:"underscore"}],449:[function(a,b,c){var d=a("underscore"),e=/^([a-z]+)(\d*)$/,f=function(a,b){if(!a||!a.match)throw new Error("invalid id");var c=a.match(e);if(c[2]=c[2]||-1,c&&3===c.length){var d=c[1],f=parseInt(c[2],10)+b;return d+Math.max(f,0)}throw new Error("invalid id")};b.exports={next:function(a){return f(a,1)},prev:function(a){return f(a,-1)},letter:function(a){if(!a||!d.isString(a))return"";var b=a.match(/^([a-z]+)/);return d.isArray(b)&&b[0]||""},sequence:function(a){if(a&&d.isString(a)){var b=a.match(/(\d+$)/);return d.isArray(b)&&b[0]||void 0}},changeLetter:function(a,b){var c=a.match(/(\d+)$/)[0];return b+c}}},{underscore:"underscore"}],450:[function(a,b,c){b.exports={feedback:"Give us feedback!",user:{you:"You"},months:{january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December"},assets:{"maki-icons":{disclaimer:"<a href='https://github.com/mapbox/maki' target='_blank'>Maki Icons</a>, an open source project by <a href='http://mapbox.com' target='_blank'>Mapbox</a>"}},operators:{count:"COUNT",sum:"SUM",avg:"AVG",min:"MIN",max:"MAX"},"builder-activated-notification":{message:"CARTO Builder has been activated in your account. <a href='https://carto.com/learn/guides' class='onboardingNotification-link'>Learn more</a> about it and let us know what you think or <a href='mailto:builder-support@carto.com' class='onboardingNotification-link'>contact us</a>. Happy mapping!"},"builder-onboarding":{title:"Welcome to Builder,",description:"Discover the new and exciting analyses you can perform with location intelligence.","take-tour":"Take a tour","edit-map":"Edit your map",toolbar:{title:"Toolbar",description:"The toolbar provides options to access your dashboard, edit your map, and configure its settings."},configurator:{title:"Edit pane",description:"Manage all the components of your map: add layers and widgets, import datasets, customize analyses, and change styles."},map:{title:"Map",description:"Your map reflects changes instantly."},widgets:{title:"Widgets pane",description:"The widgets you add to your map appear directly on your visualization."},skip:"skip",next:"next"},"data-onboarding":{title:"Welcome to the layer pane",description:"Analyze, style, and enhance your data with pop-ups and&nbsp;legends.","take-tour":"Take the tour","edit-layer":"Edit layer","layer-options":{title:"Layer options",description:"Layers can be renamed by double-clicking on the layer name, centered by clicking in the crosshair, and exported through their contextual menu."},"data-tab":{title:"Data tab",description:"Style, add analysis, pop-ups, and legends to layers. To further explore your data, add widgets."},"sql-editor":{title:"SQL View",description:"Data layers can be edited and processed by using the SQL view at the bottom of the screen."},"add-geometry":{title:"Add geometries and switch to dataset view",description:"You can switch between map or data view. In map view, you can add points, lines, and polygons.","edit-layer":"Edit layer"},exit:"Exit tour",next:"Next"},"analysis-onboarding":{title:"The Art of Analysis",description:"Build reproducible workflows for analyzing and explaining your data. Analyses turn your maps into Location Intelligence apps.","description-list":{item1:"Different analyses can be chained",item2:"Analyses are dynamic. When the data changes, the analysis is&nbsp;refreshed.",item3:"The original data is not modified by the analysis workflow.",item4:"Some analysis queries add calculated results to columns in your dataset."},done:"Done","add-analysis":"Add analysis","never-show-message":"Don't show me this again."},"style-onboarding":{title:"Style this map!",description:"Apply aggregation styling to maps and define options by geometry attributes or by a column value.",aggregation:{title:"How would you like to aggregate your data?",description:'Map types are called "Aggregation". Add Torque, Heatmap, and other aggregation styles to data.'},style:{title:"Make it beautiful!",description:"Use these options to style your data in beautiful ways. For example, you can create thematic maps by altering the FILL option by value.","short-description":"Use these options to style your data in beautiful ways."},cartocss:{title:"Dress it up with CartoCSS",description:"Further style data by using the CartoCSS view at the bottom of the screen."},"take-tour":"Take the tour","style-layer":"Style layer","never-show-message":"Don't show me this again.",exit:"Exit tour",next:"Next"},"analyses-onboarding":{placeholders:{"layer-name":"NAME OF THE LAYER",clusters:"CLUSTERS",method:"METHOD",percentage:"PERCENTAGE"},done:"Done",finished:"has finished","style-analysis":"Style this analysis","read-more":"Read more in documentation","learn-more":"Learn more","never-show-message":"Don't show me this again.","no-new-columns":"No new columns were created.","geometries-updated":"The geometries in your table were updated","new-column-added":"A new column has been added to your dataset.","new-columns-created":"New columns have been created as a new dataset.","new-column-included":"A new column has been included with your original data.","new-columns-included":"New columns has been included with your original data.","new-columns-included-based-on-input":"New columns have been included with your original data based on the columns chosen for the input.",sampling:{title:"Subsample of rows",description:"A sample of your original table was randomly selected to give approximately a percentage of the rows from your input dataset."},merge:{title:"Join columns from 2nd layer",description:"This analysis performed a columnar JOIN in order to get columns from two different tables."},intersection:{title:"Filter points in polygons",description:"This analysis performs a spatial intersection, returning only the rows from the target layer which intersect with geometries in the source layer.","source-cartodb-id":"This number represents the cartodb_id of the source geometry"},"area-of-influence":{title:"Create areas of influence",description:"Area of influence creates polygons according to the parameters set by the user.","the-geom":"This column was updated to show the area of influence requested."},"aggregate-intersection":{title:"Intersect second layer",description:"This operation performs a spatial intersection and aggregates the geometry values from the target layer that intersect with the geometry of the source layer.","count-vals-density":"This column is added if COUNT was chosen as the aggregation operation","extra-column":"This column is added if {operation_type} is chosen with column {column_name}"},filter:{title:"Row filtering",description:"Row filtering allows you to quickly narrow down the total data you display on a map or input into an analysis node."},"filter-by-node-column":{title:"Filter by layer",description:"Filter by layer allows you to filter the data in your layer by propagating the filters in the attached layer. Now if you filter on widgets added to the first node, the results in the second node would be also filtered."},"spatial-markov-trend":{trend:"The normalized trend for each geometry",trend_up:"The probability that a geometry's value will move to a higher class",trend_down:"The probability that a geometry's value will move to a lower class",volatility:"A measure of the potential for a geometry to possess values in other classes",description:"Trends and volatility are calculated based on the time series data input. Trends calculated from inputs with a longer history are more precise. Inputs for the time column should equally spaced (e.g., all one week/month/year apart)."},moran:{title:"Detect outliers and clusters",description:"Detect outliers and clusters finds areas in your data where clusters of high values or low values exist, as well as areas which are dissimilar from their neighbors.",quads:"Classification of the geometry from the analysis",significance:"The statistical significance of the geometry's classification of one of four quadrant types.",moran:"The local statistic calculated from the Moran's I analysis for each geometry/value in the dataset.",rowid:"The original row id of the geometry (cartodb_id)."},kmeans:{title:"Calculating point clusters","cluster-no":"A numeric identifier for each cluster in your dataset. Values start at 1 and go up to the %{clusters} clusters you requested (or max rows if less).",description:"Point clustering is uses k-means to calculate a predefined number of clusters from your data."},"data-observatory-measure":{title:"Enrich from the Data Observatory","custom-column":"This column contains the data requested from the Data Observatory",description:"The Data Observatory enrichment is the result of the geometry location and the measure requested."},"connect-with-lines":{title:"Connect with lines",description:"Create lines from point datasets using a variety of methods","the-geom":"This column was updated to be lines according to the method chosen.","line-sequential":"This analysis creates a line by connecting all points in the dataset in a specified order","line-source-to-target":"Link a source point to a target point based on a shared attribute","line-to-column":"Create lines from a point to to a geometry stored in another column","line-to-single-point":"Connect the coordinate from latitude and longitude columns to the point geometry (`the_geom`) in your dataset."},"group-points":{title:"Group points into polygons","the-geom":"This column was updated to polygons encompassing the input points.",category:"This will be the category over which the polygons were calculated",description:"Group points into polygons to create new polygons."},georeference:{title:"Georeference","the-geom":"This column, which stores the geographic information in your dataset, has been updated to reflect the boundaries or locations from the inputs specified.",description:"Georeferencing data is a service that uses information from many sources to get the geographical information associated with latitude/longitude columns, city names, postal codes, administrative boundaries, IP addresses, or street addresses."},centroid:{title:"Calculating centroids from geometries",description:"Centroids are calculated from all, groups, or singular geometries. Using the optional parameters of Category, Aggregate, and Weight you can change how they are calculated and what information the result will contain. ","the-geom":"Point geometries representing the centroid(s) of your input data.","aggregated-value":"Stores the aggregate value for each centroid.","non-aggregated-value":"Contains the count of features considered for each centroid",category:"Stores the category value for each centroid from the source dataset"},closest:{description:"Find nearest analysis locates the closest points between two tables.",source_cdb_id:"This column has been created with the related points id from the source table.","the-geom":"This column has been updated with the target table geometries.",title:"Find nearest"}},analyses:{"connect-with-lines":{title:"Connect with lines","short-title":"Connect with lines"},georeference:{title:"Georeference","short-title":"Georeference"},"data-observatory-measure":{title:"Enrich from Data Observatory","short-title":"Data observatory","age-and-gender":"Age and Gender",boundaries:"Boundaries",education:"Education",employment:"Employment",families:"Families",housing:"Housing",income:"Income",language:"Language",migration:"Migration",nationality:"Nationality","population-segments":"Population segments","race-and-ethnicity":"Race and Ethnicity",religion:"Religion",transportation:"Transportation",filters:"Filters"},merge:{title:"Join columns from 2nd layer","short-title":"Join columns"},"filter-by-node-column":{title:"Filter by layer","short-title":"Filter by layer"},centroid:{title:"Centroid from geometries","short-title":"Centroid"},"group-points":{title:"Group points into polygons","short-title":"Group points"},"convex-hull":{title:"Convex Hull","short-title":"Convex Hull"},"concave-hull":{title:"Concave Hull","short-title":"Concave Hull"},"bounding-box":{title:"Bounding Box","short-title":"Bounding Box"},"bounding-circle":{title:"Bounding Circle","short-title":"Bounding Circle"},"area-of-influence":{title:"Create areas of influence","short-title":"AOI"},"filter-intersection":{title:"Filter points in polygons","short-title":"Filter points in polygons"},"aggregate-intersection":{title:"Aggregate intersection","short-title":"Aggregate intersection"},filter:{title:"Filter by column value","short-title":"Filter"},sampling:{title:"Subsample percent of rows","short-title":"Sampling"},kmeans:{title:"Calculate clusters of points","short-title":"Clusters"},"moran-cluster":{title:"Detect outliers and clusters","short-title":"Outliers & clusters"},"spatial-markov-trend":{title:"Predict trends and volatility","short-title":"Trends"},source:"Source",routing:{"short-title":"Routing"}},"analysis-category":{all:"All","analyze-predict":"Analyze and predict","create-clean":"Create and clean","data-transformation":"Transform"},"form-components":{editors:{radio:{true:"True",false:"False",null:"Null"},fill:{customize:"Custom color set",quantification:{title:"Quantification",methods:{jenks:"Jenks",equal:"Equal Interval",headtails:"Heads/Tails",quantiles:"Quantiles",category:"Category"}},bins:"Buckets","input-color":{solid:"Solid",value:"By value",img:"Img"},"input-number":{fixed:"Fixed",value:"By value"},"input-ramp":{buckets:"bucket |||| buckets"},"input-categories":{null:"null",others:"Others"},image:{"recently-title":"Most used",none:"None","show-all":"Show full collections"}}}},data:{"import-model":{"error-title":"There was an error","error-starting-import":"Unfortunately, there was an error starting the import"},"upload-model":{"invalid-import":"Invalid import","one-file":"Unfortunately, only one file is allowed per upload","file-defined":"File name should be defined","file-extension":"Unfortunately, this file extension is not allowed","file-size":"Unfortunately, the size of the file is bigger than your remaining quota","visualization-id":"The remote visualization id was not specified","remote-file-size":"Unfortunately, the size of the remote dataset is bigger than your remaining quota","url-invalid":"Unfortunately, the URL provided is not valid","error-happened":"There was an error","connection-error":"Unfortunately, there was a connection error","twitter-dates-invalid":"Twitter dates are not valid","twitter-dates-empty":"Twitter dates are empty","twitter-categories-invalid":"Twitter categories are not valid","twitter-data":"Twitter data is empty","dataset-copy-undefined":"Dataset copy is not defined","query-undefined":"Query is not provided"},"analysis-definition-node-model":{validation:{"missing-required":"Required","invalid-source":"Invalid source","invalid-value":"Invalid value","invalid-enum":"Invalid value, must be any of %{expectedValues}"}}},components:{geocoding:{"geocoding-error-details":{close:"close",description:"There was a problem georeferencing your data",title:"Geocoding Error","try-again":"Please try again and if the problem persists, <a href='mailto:support@carto.com?subject=Geocoding error with id:%{id}'>contact us</a> with the following code:","view-dataset":"view dataset"},"geocoding-success-detail":{"amount-charged":"<strong>$%{price}</strong> will be charged to your account","credits-consumed":"You have consumed all your credits during this billing cycle, price is $%{price} / 1,000 extra credits.",description:"We've successfully geocoded <%- realRowsFormatted %> <%- geometryType %> of <%- processableRowsFormatted %>. |||| We've successfully geocoded <%- realRowsFormatted %> <%- geometryType %>s of <%- processableRowsFormatted %>.",explanation:"Rows that are not geocoded could have errors in their column values, or dont exist in our data. Try geocoding again and check the 'override all values' to try again.","no-extra-charge":"No extra charges have been done",remainingQuotaFormatted:"You still have %{remainingQuotaFormatted} credits left for this month.",title:"Data geocoded","try-again":"Unsuccessful rows don't count against your quota, so we encourage you to take a look and try again.","view-dataset":"view dataset"},"geocoding-no-result-details":{close:"close",description:"These rows contained empty values or perhaps we just didn't know what the values meant. We encourage you to take a look and try again.",title:"No rows were georeferenced","view-dataset":"view dataset"}},"background-importer":{"background-importer-item":{completed:"completed","error-connecting":"<span class='u-errorTextColor'>Error connecting</span> %{name}",from:"from",show:"show"},"warnings-details":{"continue-btn":"Continue","find-connected-datasets":"You can find all the connected datasets under the datasets section.","no-more-datasets":"No more than %{maxTablesPerImport} datasets can be imported from a single file.","unable-to-import-datasets":"Unable to import all datasets in file"},"partial-import-details":{"find-connected-datasets":"You can find all the connected datasets under the datasets section.","continue-btn":"Continue","too-many-datasets":"NOTE: The file you uploaded contained too many datasets. No more than %{maxTablesPerImport} datasets can be imported from a single file.","unable-to-import-as-layers":"Unable to add all imported datasets as layers","upgrade-your-account":"<a href='https://carto.com/pricing/'>Upgrade your account</a> to add more than %{userMaxLayers} layers to your maps."},"connector-warning-details":{"continue-btn":"Continue","too-many-rows":"You may have reached the maximum limit.","unable-to-import-all-rows":"For a database connector import, the number of rows allowed is %{maxRowsPerConnectorImport}. Some of your data may not be imported."},"error-details":{"check-errors":"Check errors","check-url":"Check that the URL you provided is OK",close:"close","dont-panic":"Dont panic, here's some info that might help","remote-server-code":"The remote server returned a <span class='ErrorDetails-itemTextStrong'>%{httpResponseCode}</span> code.","send-us-the-error-code":"Persisting error? Please <a href='mailto:support@carto.com'>send us</a> the following code","unknown-error":"An unknown error has happened"},"upgrade-errors":{8001:{description:"Remove some of your datasets to gain available space or upgrade your account",info:"Keep your data and get a larger quota by upgrading your plan",title:"Your quota has run out"},8005:{description:"Remove any layer or upgrade your account",info:"Keep your maps and get more layer count quota by upgrading your plan",title:"You have reached your layer count limit"},upgrade:"upgrade"},"twitter-import-details":{"new-type-created":"We've created a new dataset containing a total of %{datasetTotalRowsFormatted}<br/>tweet%{tweetPlural} with your search terms","credit-left":"You still have %{availableTweetsFormatted} credit left for this billing cycle.","credits-left":"You still have %{availableTweetsFormatted} credits left for this billing cycle.","no-more-credits":"You have consumed all your credits during this billing cycle (price is $%{blockPriceFormatted}/%{blockSizeFormatted} extra credits).","twitter-import-title":"Your Twitter dataset is created","tweet-cost":{free:"No extra charges have been applied",paid:"$%{tweetsCostFormatted} will be charged to your account"},errors:{"no-results":"Your search query was correct but returned no results, \n please try with a different set of parameters before running it again"}},"background-geocoding-item":{geocoded:"%{realRowsFormatted}/%{processableRowsFormatted} row geocoded |||| %{realRowsFormatted}/%{processableRowsFormatted} rows geocoded","geocoded-by-lat-lng":"Geocoded by latitude and longitude",geocoding:"Geocoding %{tableName} dataset",show:"show","rows-geocoded":{"without-dataset":"%{realRowsFormatted} row geocoded |||| %{realRowsFormatted} rows geocoded","in-dataset":"%{realRowsFormatted} row geocoded in %{tableName} dataset|||| %{realRowsFormatted} rows geocoded in %{tableName} dataset"},errors:{"no-rows-geocoded":{"without-dataset":"No rows geocoded","in-dataset":"No rows geocoded in %{tableName} dataset"},"geocoding-layer":"Ouch! There was an error geocoding %{tableName} layer"}},"background-import-limit":{hurry:"In a hurry? <a href='%{upgradeUrl}'>Upgrade your account</a> to import several files at a time","one-file":"Unfortunately, you can only import up to %{importQuota} files at the same time"},"free-trial":"Get a %{days} day free trial",connecting:"Connecting",dataset:"dataset",geocoding:"Geocoding",working:"Working"},"likes-pluralize":"like |||| likes","custom-list":{placeholder:"Search by %{typeLabel}","no-items":"There are no %{typeLabel} items","no-results":"No %{typeLabel} results found with '%{query}'","add-custom-result":"Add custom value"},datepicker:{"dates-placeholder":"Choose your dates","get-last":"Get last",hour:"hour",min:"min",from:"from",to:"to",or:"or","days-pluralize":"1 day |||| %{smart_count} days","weeks-pluralize":"1 week |||| %{smart_count} weeks","hours-pluralize":"hour week |||| %{smart_count} hours","gmt-convertion":"Date will be converted to GMT +0","invalid-date":"Invalid date"},taglist:{none:"No tags",placeholder:"Add tags"},"pagination-search":{filter:{search:"Search",placeholder:"Search by username or email"},loading:{title:"Loading..."},error:{title:"Error",desc:"Oops there was an error."},"no-results":{title:"Oh! No results",desc:"Unfortunately we could not find anything with these parameters"}},modals:{"editor-vis-warning":{title:"You are about to open an Editor map with the new Builder",explanation:"Builder offers an easy-to-use and intuitive drag and drop functionality to analyze and visualize your data. However, some of the old Editor features, such as overlays, are not currently available in Builder.",question:"Opening your map in Builder may cause the loss of any feature not supported yet. Are you sure you want to continue?","go-back":"No, go back to dashboard",open:"Yes, open with Builder",duplicate:"duplicate and open with Builder","opening-title":"Opening %{name} with Builder"},"add-basemap":{"modal-title":"Add a custom basemap","modal-desc":"Select from these great resources","adding-basemap":"Adding new basemap","add-basemap-error":"Could not add basemap","add-btn":"Add basemap","cancel-btn":"Cancel",validating:"Validating",saving:"Saving layer",fetching:"Fetching layers","get-layers":"Get layers",xyz:{insert:"Insert your XYZ URL",enter:"Enter a URL","not-valid":"Insert a valid XYZ URL",eg:"E.g.",tms:"TMS","couldnt-validate":"We couldn't validate this. If you're sure it contains data click \"add basemap\""},mapbox:{insert:"Insert your Mapbox URL",enter:"Enter your map ID/URL","enter-token":"Enter your access token",error:"Error retrieving your basemap. Please check your access token.",invalid:"This URL is not valid."},wms:{insert:"Insert your WMS/WMTS URL",invalid:"The URL is either invalid or contains unsupported projections","see-docs":"see docs","oh-no":"Oh! No results",unfortunately:"Unfortunately, we couldn't find a layer that matched your search term","tables-pluralize":"table |||| tables",placeholder:"%{layersFoundCount} %{layersFoundCountPluralize} found, %{layersAvailableCount} %{layersAvailableCountPluralize} available"},tilejson:{insert:"Insert your TileJSON URL",invalid:"Invalid URL, please make sure it is correct"},nasa:{select:"Select a date from which you want a NASA Worldview basemap",day:"Day",night:"Night","cant-select":"You can't select a date in night mode"}},"export-data":{title:"Export data",desc:"Select the preferred file format","no-geometry":"To download any geospatial format like SHP, KML or GeoJSON don't forget to select the_geom on your query.",loading:{geometry:"Checking geometries...",preparing:"Preparing content..."},errors:{title:"There was an error","geometry-error":"We can't read data geometries",unknown:"An error occurred"},cancel:"Cancel",download:"Download"},"maps-metadata":{"modal-title":"Map metadata","modal-desc":"Edit the attributes of your map","back-btn":"GO BACK","save-btn":"Save","cancel-btn":"Cancel",form:{name:"Map Name","name-placeholder":"Type your name here",description:"Description","description-placeholder":"Type your description here",tags:"Tags",markdown:"Markdown supported"},validation:{error:{name:"Name can't be blank"}},error:{title:"We couldn't save your data",subtitle:"We had an error trying to save your data: <span class='CDB-Text is-semibold'>%{error}</span>"},loading:"Saving your data...",success:"<span class='CDB-Text is-semibold'>Metadata</span> for %{name} map <span class='CDB-Text is-semibold'>was saved</span>."},"dataset-metadata":{"modal-title":"Dataset metadata","modal-desc":"Edit the attributes of your dataset","back-btn":"GO BACK","save-btn":"Save","cancel-btn":"Cancel",form:{name:"Dataset Name","name-placeholder":"Type your name here",description:"Description","description-placeholder":"Type your description here",attributions:"Attributions","attributions-placeholder":"Type your attributions here",tags:"Tags",source:"Source","source-placeholder":"Enter the source of the data",license:"License",markdown:"Markdown supported"},validation:{error:{name:"Name can't be blank"}},error:{title:"We couldn't save your data",subtitle:"We had an error trying to save your data: <span class='CDB-Text is-semibold'>%{error}</span>"},loading:"Saving your data...",success:"<span class='CDB-Text is-semibold'>Metadata</span> for %{name} dataset <span class='CDB-Text is-semibold'>was saved</span>."},publish:{"done-btn":"Done","update-btn":"Update","publish-btn":"Publish","publishing-btn":"Publishing","updating-btn":"Updating",menu:{share:"Share with colleagues",publish:"publish"},privacy:{privacy:"privacy",cta:{title:"Want some privacy?","desc-trial":"Check our plans with 14 days trial","desc-notrial":"Upgrade your account!"},public:{type:"PUBLIC",title:"Public",body:"Everyone can view your table and download it"},link:{type:"LINK",title:"Only accessible with link",body:"Only the people with a shared link can view the data"},password:{type:"PASSWORD",title:"Password",body:"Set a password and share only with specific people",placeholder:"Type your password"},private:{type:"PRIVATE",title:"Private",body:"Nobody can access this dataset"},error:{title:"We couldn't save your data",subtitle:"We had an internal error trying to save your data. We recommend you try again."},upgrade:{title:"Interested in sharing within your organization?",desc:"%{contact} to try one of our Enterprise plans",contact:"Contact us",mail:"sales@carto.com"},loading:"Saving your data..."},share:{published:"Published %{when}",unpublished:"Never published.","last-published":"Last updated %{date}","unpublished-header":"Click on Publish to start sharing your map on the web","unpublished-subheader":"From the moment you click on publish, you will need to use this window to update your changes on the public version.",upgradeLabel:"Upgrade",upgradeLink:"https://carto.com/pricing/#pricing-standard",upgrade:"%{upgradeLink} to share with your colleagues?",private:"PRIVATE","get-link":{title:"Get the link",body:"Send to your friends, coworkers, or post it in your social networks.",link:"",copy:"COPY",select:"SELECT",private:{body:"Your map is %{private} Change privacy to get the link"}},embed:{title:"Embed it",body:"Insert your map into your blog, website, or simple application.",link:"Get a simple URL.",copy:"COPY",select:"SELECT",private:{body:"Your map is %{private} Change privacy to embed map"}},cartodbjs:{title:"CARTO.js",body:"Add your map to your applications using this URL.",link:"Read more.",copy:"COPY",select:"SELECT"},"mobile-sdk":{title:"CARTO Mobile SDK",body:"Add your map to your native mobile applications using this line of code.",link:"Read more.",copy:"COPY",select:"SELECT"},error:{title:"We couldn't save your data",subtitle:"We had an internal error trying to save your data. We recommend you try again."},loading:"Saving your data...",organization:{title:"Default settings for your Organization",desc:"New users will have this permission"},role:{viewer:"Viewer",builder:"Builder"},tooltip:{group:"Access is inherited from group %{name}",org:"Access is inherited from organization"},toggle:{read:"Read",write:"Write"},"add-people":"Add people"}},"assets-picker":{browse:"Browse","delete-image":"Delete image","delete-images":"Delete images","deselect-all":"Deselect all","drag-and-drop":"Drag & drop your file","error-desc":"Please, go back and try again. If the problem persists contact us at <a href='mailto:support@carto.com'>support@carto.com</a>","go-back":"Go back","incorrect-url":"Error. Your URL doesnt look correct.",loading:"Loading",or:"or","select-all":"Select all",submit:"submit","upload-desc":"Paste a URL or select a file like JPG, GIF, PNG, SVG","upload-file-url":"Upload a file or a URL"},"add-asset":{icons:"Icons","modal-desc":"or just use our nice selection","modal-title":"Select marker image","set-image":"Set image","upload-file":"Upload file","upload-asset":"Upload asset","upload-image":"Upload your image","your-uploads":"Your uploads","organization-uploads":"Organization uploads"},"add-analysis":{"modal-title":"Add a new analysis","modal-desc":"Select the analysis you want to add","loading-title":"Loading options","add-btn":"Add analysis","disabled-option-desc":"Your layer's geometries are %{simpleGeometryType} and this analysis needs %{requiredInputGeometries}","unknown-geometry-type":"unknown","info-analysis":"Info about analysis","option-types":{"connect-with-lines":{title:"Connect with lines",desc:"Create lines from point datasets using a variety of methods"},"group-points":{title:"Group points into polygons",desc:"Aggregate points into polygons such as convex hulls or bounding boxes."},"aggregate-intersection":{title:"Intersect second layer",desc:"Intersect with a second layer and calculate aggregations on the fly."},"area-of-influence":{title:"Create areas of influence",desc:"Use travel time (e.g. walking or driving) or distance to calculate areas of influence from points."},georeference:{title:"Georeference",desc:"Use street addresses, city names, or other location text to generate point geometries."},"filter-intersection":{title:"Filter points in polygons",desc:"Filter points intersecting your polygons layer, and augment those with your polygons columns."},filter:{title:"Filter by column value",desc:"Keep or discard rows according to a custom criteria."},merge:{title:"Join columns from 2nd layer",desc:"Join columns from a second layer by linking a shared value found in both datasets."},"moran-cluster":{title:"Detect outliers and clusters",desc:"Use Moran's I to find high (HL) and low (LH) outliers and high (HH) and low (LL) clusters.","high-low":"High-Low (HL)","high-high":"High-High (HH)","low-high":"Low-High (LH)","low-low":"Low-Low (LL)"},kmeans:{title:"Calculate clusters of points",desc:"Spatially separate a layer of points into a specified number (N) of groups."},centroid:{title:"Find centroid of geometries",desc:"Calculate a direct or weighted centroid based on all rows of a layer or by categories."},"filter-by-node-column":{title:"Filter by layer",desc:"Filter your layer depending on a second layer such that widgets will effect both."
},sampling:{title:"Subsample percent of rows",desc:"Subsample the rows in a dataset based on a specified percent."},"spatial-markov-trend":{title:"Predict trends and volatility",desc:"Predict probability of upward and downward trends using spatial Markov chains."},"data-observatory-measure":{title:"Enrich from Data Observatory",desc:"Add a new column with contextual demographic and economic measures."},"deprecated-sql-function":{title:"SQL Function",desc:"Run your custom SQL function"}}},"add-widgets":{"modal-title":"Add new widgets","modal-desc":"Select the widgets you want to add","continue-btn":"Continue","loading-title":"Loading columns","tab-pane":{"histogram-label":"Histogram","category-label":"Category","formula-label":"Formula","time-series-label":"Time-series"},"percentage-in-top-cats":"% in top 10 cat","time-series-no-option-title":"None","time-series-no-option-desc":"This option won't show your time-series widget"},"add-layer":{"modal-title":"Add a new layer","modal-desc":"Select an existing dataset or connect a new one",navigation:{search:"Search","search-placeholder":"by name, description, or :tag","connect-dataset":"Connect dataset","shared-with-you":"Shared with you","data-library":"Data library","create-empty-map":"Create empty map","create-empty-dataset":"Create empty dataset","create-empty-addLayer":"Add an empty layer","dataset-pluralize":"Dataset |||| Datasets"},"create-loading-title":"Creating an empty dataset","adding-new-layer":"Adding new layer","add-layer-error":"Could not add layer",imports:{"ask-for-demo":"ask for demo",connector:"connector","demo-email-title":"I am interested in the %{name} connector","demo-email-desc":"Hi, I am interested in testing the %{name} connector. Please contact me to schedule a demo of this feature.","tab-options-error":{"no-key":"%{name} key is not specified and the panel can't be enabled","not-allowed":"%{name} data source is not available for your plan. Please upgrade.","limits-reached":"You've reached the limits for your account. Please upgrade.","no-credits":"You've reached the available %{name} credits for your account this month."},"member-pluralize":"member |||| members","item-pluralize":"item |||| items","form-import":{browse:"Browse","drag-and-drop":"Drag & drop your file","error-desc":"Error. Your URL doesnt look correct.",format:"Format",or:"or",title:"Enter a URL",desc:"Paste a URL and start the import",submit:"submit"},"header-import":{"import-url":"Import your data from a %{brand} URL","file-selected":"File selected","paste-url":"Paste a URL %{fileEnabled} ","select-a-file":"or select a file like CSV, XLS, ZIP, KML, GPX,","see-all-formats":"see all formats","sync-enabled":"Keep it synchronized with the source","sync-disabled":"Sync options are not available","type-selected":"%{brand} selected","type-import":"%{brand} import","upload-file-url":"Upload a file or a URL |||| Upload a URL"},"service-import":{and:"and","account-connected":"Account connected","connect-with":"Connect with %{title}",choose:"Choose",connect:"Connect","found-in":"%{size} %{pluralize} found in %{title}","item-selected":"Item selected","many-more-formats":"many more formats","no-results-title":"Oouch! There are no results","no-results-desc":"We haven't found any valid file from your account","state-idle-login":"Login to your account and select any item.","state-error":"We are sorry that you cant connect to your %{title} account. Be sure you have any pop-up blockers deactivated for this website.","state-token":"Checking Token.","state-oauth":"Requesting oAuth.","state-retrieving":"A list of your %{title} files will be displayed in a moment.","state-selected-sync":"You can choose when to sync the file.","state-selected-instagram":"A map containing all your georeferenced photos will be created","state-selected-no-sync":"Sync options are not available.",supported:"supported","try-again":"Try again"},"selected-state":{"sync-my-data":"Sync my data",never:"Never","every-hour":"Every hour","every-day":"Every day","every-week":"Every week","every-month":"Every month","free-trial":"%{days} day free trial","more-features":"more features","upgrade-desc":"Upgrade your account to get sync options and %{features}",upgrade:"upgrade"},twitter:{category:"Category","credits-consumed":"Twitter credits for this period consumed - %{extraTweets} will be charged","credits-left":"%{per}% of your %{remainingFormatted} Twitter credits left","credits-no-limit":"No limits - %{extraTweets} will be charged","extra-tweets":"extra tweets","fallback-title":"Enable the %{brand} connector","fallback-desc":"The %{brand} connector allows you to map %{brand} data activity related to your brand, event, or any term you may be interested in.","from-to":"From / to","terms-desc":"Enter up to four search terms using the category fields.","terms-placeholder":"Insert your terms separated by commas",title:"Twitter trends","twitter-gmt":"Time is in GMT+0",use:"Use","your-gmt":"You are in GMT"},arcgis:{"fallback-desc":"Enable the %{brand} connector in your account to connect your %{brand} data to CARTO and mantain it in sync with the source.","input-placeholder":"Paste your %{brand} table URL here","url-desc":"To retrieve a particular layer, add the layer index at the end of the URL","import-data":"Import your data from a %{brand} instance","sync-options":"Sync options only available for a layer"},instagram:{"fallback-desc":"Enable the %{brand} connector to map your photos or videos from your account in CARTO."},box:{"fallback-desc":"Enable the %{brand} connector in your account to map your %{brand} files in CARTO or mantain your CARTO maps in sync with your Box data."},mailchimp:{"campaign-selected":"%{brand} campaign selected","fallback-desc":"Enable the %{brand} connector in your account to map your user lists from %{brand} in CARTO or mantain your CARTO maps in sync with your %{brand} data.","map-campaign":"Map your %{brand} campaigns","state-idle":"Connect your %{brand} account to select any of your campaigns.","state-error":"We are sorry, there has been an error while connecting to your %{brand} account. Just in case it helps, be sure you have the pop-up blocker deactivated for this website.","state-token":"Checking %{brand} token.","state-oauth":"Requesting oAuth.","state-retrieving":"A list of your %{brand} campaigns will be displayed in a moment.","state-selected":"Campaign selected."},salesforce:{"fallback-desc":"Enable the %{brand} connector in your account to map your user lists from %{brand} in CARTO or mantain your CARTO maps in sync with your %{brand} data.","input-placeholder":"Paste your %{brand} URL here"}},datasets:{item:{"sync-failed":"Sync failed, the last attempt was",syncing:"Syncing",synced:"Synced",read:"read",from:"from",by:"by","no-description":"No description","rows-pluralize":"row |||| rows","tags-more":"and %{tagsCount} more","no-tags":"No tags"},loading:"Loading",searching:"Searching",error:{title:"Ouch! There has been an error loading your datasets",desc:"If the problem persists contact us at"},"no-datasets":{title:"You have not connected any datasets yet",desc:"You can %{connectDataset} or %{search} in all our data library","connect-datasets":"connect datasets",search:"search"},"no-results":{desc:"There are no results in this page",found:"found","there-are-no":"There are no","no-fun":"No %{type}, no fun"}},footer:{"guessing-desc":"Let CARTO automatically guess data types and content on import.","twitter-desc":"To get access to historical data (older than 30 days) you need to","contact-team":"contact our team","privacy-upgrade":"You cannot change the privacy of your new datasets. Click here to upgrade your account.","privacy-change":"Your new dataset will be %{privacy}","privacy-click":"Click to change it to %{nextPrivacy}","privacy-change-banned":"You cannot change the privacy of your new datasets.","add-layer":"Add layer"}},"edit-feature":{confirmation:{title:"This geometry is too big to edit from the web",desc:"Editing this geometry could freeze or crash your browser, and you could lose your work. We encourage you to edit this feature through the API.",cancel:"Cancel",continue:"Ok, continue"},delete:{title:"You are about to delete a feature",desc:"Are you sure you want to delete it?",cancel:"Cancel",confirm:"Ok, delete it"}}},error:{"default-title":"Oops, there was a problem","default-desc":"Reload the page again. If the problem persists contact us at <a href='mailto:support@carto.com'>support@carto.com</a>"},"backbone-forms":{select:{placeholder:"Select a %{keyAttr}",loading:"loading",empty:"No values",selected:"%{count} selected"},operators:{"count-message":"If you select 'COUNT' all columns are selected"},"interval-error":"Value must be between %{minValue} and %{maxValue}","copy-button":"COPY","data-observatory":{dropdown:{measurement:{search:"Search...",type:"measurements"},filter:{header:"Filter measurements by",type:"filters"}}}},codemirror:{"no-errors":"No errors",docs:"DOCS","syntax-error":"Syntax error",line:"Line"},"undo-redo":{clear:"CLEAR",apply:"APPLY"},table:{columns:{"change-type":{confirm:"ok, change it",cancel:"Cancel",desc:"Maps using this column will be affected and unconvertible data will be lost. Are you sure?",error:"There was an error changing %{columnName} column: %{error}",loading:"Changing %{columnName} column...",title:"%{columnName} column will change to %{newType}",success:"Column %{columnName} changed to %{newType}"},create:{loading:"Adding new column...",error:"Error adding new column: %{error}",success:"%{columnName} column added"},destroy:{cancel:"Cancel",confirm:"Ok, delete it",desc:"Maps using this column will be affected, are you sure you want to delete it?",error:"Error deleting %{columnName} column: %{error}",loading:"Removing your column %{columnName}...",success:"%{columnName} column deleted",title:"You are about to delete %{columnName} column "},rename:{cancel:"Cancel",confirm:"ok, rename it",desc:"Maps using this column will be affected, are you sure you want to rename it?",error:"Error renaming column %{columnName} to %{newName}: %{error}",loading:"Renaming your column %{columnName} to %{newName}...",success:"Column %{columnName} renamed to %{newName}",title:"You are about to rename column %{columnName} to %{newName}"},options:{order:"Order",rename:"Rename column",change:"Change data type",create:"Add new column",delete:"Delete this column..."},types:{boolean:"Boolean",date:"Date",number:"Number",string:"String"}},rows:{loading:{title:"Loading rows..."},error:{title:"There was an error...",desc:"It was not possible to obtain any results, check the query applied"},result:{"no-page-title":"Ouch! Sorry","no-page-desc":"This page %{page} doesn't contain any results...","no-results-title":"There is no data","no-results-desc":"","no-results-button":""},options:{copy:"Copy cell value",create:"Add new row",edit:"Edit this cell",delete:"Delete this row..."},create:{loading:"Adding new row...",error:"Error adding new row: %{error}",success:"New row added"},edit:{loading:"Editing %{attribute} with cartodb_id %{cartodbId}...",error:"Error editing %{attribute} with cartodb_id %{cartodbId}: %{error}",success:"Edited %{attribute} with cartodb_id %{cartodbId}"},destroy:{cancel:"Cancel",confirm:"ok, delete",desc:"Are you sure you want to delete it?",error:"Error deleting row with cartodb_id %{cartodb_id}: %{error}",loading:"Removing your row with cartodb_id %{cartodb_id}...",success:"Row with cartodb_id %{cartodb_id} deleted",title:"You are about to delete row with cartodb_id %{cartodb_id}"},paginator:{error:"There was an error with pagination: %{error}",to:"to"}}}},dataset:{sql:"SQL",data:"Metadata",updated:"Updated %{ago}",read:"Read",options:{"add-row":"Add row","add-column":"Add column",export:"Export"},"preview-map":{preview:"preview",back:"back"},"create-map":{title:"Create map",loading:"Creating a map from %{tableName}",error:"There was an error creating the map"},delete:{option:"Delete dataset...",cancel:"Cancel",confirm:"Ok, delete it",desc:"The deleted dataset cannot be recovered, be sure before proceeding. We recommend you to export your dataset before deleting it.",error:"Error deleting %{tableName}: %{error}",loading:"Deleting your dataset %{tableName}...",title:"You are about to delete the %{tableName} dataset","affected-vis-count":"%{smart_count} map affected |||| %{smart_count} maps affected","affected-vis-count-extended":"%{affectedVisCount} maps affected, some of them are","affected-entities-count":"%{smart_count} user will lose access |||| %{smart_count} users will lose access","affected-entities-count-extended":"%{affectedEntitiesCount} users will lose access, some of them are","whole-organization-affected":"All users from your organization will be affected"},metadata:{option:"Edit metadata",error:"There was an error edititng metadata of your dataset %{name}",loading:"Editing metadata of your dataset %{name}..."},duplicate:{option:"Duplicate dataset",query:"applied query",customOption:"Create Dataset from query",error:"There was an error duplicating %{name}",loading:"Duplicating your dataset %{name}..."},lock:{option:"Lock dataset",error:"There was an error locking %{tableName}",loading:"Locking your dataset %{tableName}..."},rename:{option:"Rename dataset",cancel:"Cancel",confirm:"ok, rename it",desc:"If you are accessing this dataset via API, don't forget to use the new name in your API calls afterwards.",error:"Error renaming %{tableName}: %{error}",loading:"Renaming your dataset %{tableName}...",success:"Dataset %{tableName} renamed",title:"Renaming %{tableName} will affect your API calls, maps, analyses, ..."},sync:{"in-a-moment":"in a few moments",synced:"Synced %{ranAt}",syncing:"Syncing",loading:"Syncing dataset %{tableName}","sync-failed":"Sync failed",next:"Next will be %{runAt}","error-code":"Error code %{errorCode}","sync-now":"Sync now","view-options":"View options",disabled:"You will be able to sync manually %{gap} minutes after your last synchronization",title:"Sync dataset options",desc:"Your dataset is in sync with a %{service} file: <br/>%{url}",label:"Sync my data",error:"There was an error setting the interval",confirm:"Save",cancel:"Cancel"},unlock:{cancel:"back to dashboard",confirm:"ok, unlock it",desc:"That means you need to unlock it before doing anything. Are you sure?",error:"Error unlocking %{tableName}: %{error}",loading:"Unlocking your dataset %{tableName}...",success:"Dataset %{tableName} unlocked",title:"Your dataset %{tableName} is locked."}},editor:{map:"map",map_name:"%{name} map",published:"Published %{when}",unpublished:"Map not published yet",map_pluralize:"%{smart_count} map |||| %{smart_count} maps",button_add:"Add",button_share:"SHARE","unpublished-changes":"Unpublished changes","error-query":{body:"Errors found in your SQL query. %{action} before continuing.",label:"Fix them"},settings:{"menu-tab-pane-labels":{preview:"Preview",snapshots:"Snapshots"},preview:{mode:{title:"Mode"},options:{title:"Map Options",subtitle:"Components that are shown in the map",description:{title:"Components",subtitle:"Change map elements"},elements:{search:"Search box",zoom:"Zoom controls",fullscreen:"Fullscreen",scrollwheel:"Scroll wheel zoom",layer_selector:"Layer selector",logo:"CARTO Logo",widgets:"Widgets column",legends:"Legends",dashboard_menu:"Show toolbar"}}}},maps:{options:{duplicate:"Duplicate","edit-metadata":"Edit metadata","export-image":"Export image","export-map":"Download map",remove:"Delete map",rename:"Rename"},duplicate:{error:"There was an error duplicating %{name}",loading:"Duplicating your map %{name}..."},delete:{confirm:"Ok, delete it",cancel:"Cancel",desc:"The deleted map cannot be recovered, be sure before proceeding.",title:"You are about to delete map %{name}",error:"Error deleting map %{name}: %{error}",loading:"Removing the map %{name}...",success:"Map %{name} deleted"},"export-image":{title:"Export as image",export:"Export",generating:"Generating",disclaimer:{title:"Disclaimer",body:"Legends and widgets won't be exported as part of the image"},download:"Download",errors:{"try-again":"Please, try again. If the problem persists, contact support","error-attribution":"Error generating attribution.","error-basemap":"Error loading basemap.","error-image":"Error generating image."}},export:{confirmation:{confirm:"Download",cancel:"Cancel",desc:"This map, and the connected data, will be downloaded as a .carto file",title:'Download "%{name}"'},download:{confirm:"Download",tip:"Tip: Allow pop-ups from CARTO in your web browser.",desc:"Click Download to begin the .carto file download.",title:"Ready to Download"},error:{title:"An error occured while exporting your map",desc:"Please try again. If the problem persists, please contact support"}},rename:{loading:"Renaming map...",success:"Map renamed to %{name}",error:"Error renaming map %{name}: %{error}"}},"tab-pane":{layers:{"title-label":"Layers",georeference:{title:"Layer not georeferenced",body:"The layer <span class='CDB-Text is-semibold'>%{name}</span> include non-georeferenced data."}},elements:{"title-label":"Elements"},widgets:{"title-label":"Widgets"}},elements:{message:"Unfortunately, map overlays are not available yet, but they will be very soon. Stay tuned!"},layers:{options:{rename:"Rename",delete:"Delete layer",collapse:"Collapse",expand:"Expand",export:"Export data",hide:"Hide layer",show:"Show layer",edit:"Edit layer","center-map":"Center map on layer"},"drag-n-drop-analysis":{"upgrade-max-layers-err":"%{a_start}Upgrade your account%{a_end} to add more than %{userMaxLayers} layers to your maps."},rename:{loading:"Renaming layer",success:"Layer renamed to %{name}",error:"<span class='u-errorTextColor'>Error renaming layer</span> %{name}: %{error}"},moveTorqueLayer:{loading:"Moving torque layer to first position...",success:"Layer moved",error:"Error moving the layer..."},delete:{confirm:"Ok, delete it",cancel:"Cancel",desc:"<span class='CDB-Text u-mainTextColor is-semibold'>%{layerVisName}</span> will be affected, are you sure you want to delete it?",title:"You are about to delete the layer %{layerName}",error:"<span class='u-errorTextColor'>Error deleting layer</span>: %{error}",loading:"Removing layer",success:"Layer deleted correctly.",widgets:"one widget |||| %{smart_count} widgets",analyses:"one analysis |||| %{smart_count} analyses",layers:"one layer |||| %{smart_count} layers","affected-items":"Deleting this layer affects",and:"and","link-to-export":"Before deleting the layer, you can <a href='#' data-event='exportMapAction'>export as .CARTO file</a>"},layer:{animated:"Animated",heatmap:"Pixel",analysis:"Analysis","add-analysis":"Add analysis","analyses-count":"%{smart_count} Analysis |||| %{smart_count} Analyses","widgets-count":"%{smart_count} Widget |||| %{smart_count} Widgets","add-layer":"Add layer",delete:"Delete","cancel-delete-analysis":"Cancel"},basemap:{"remove-baselayer":"Remove baselayer","custom-basemap":"Custom basemap","title-label":"Basemap",by:"by",category:{"title-label":"Source","select-category":"Select source"},style:{"title-label":"Style","select-style":"Select style",color:"Color"},saving:{loading:"Saving new basemap...",error:"Error saving new basemap.",success:"Basemap saved successfully."}},labels:{"title-label":"Labels"},color:{"title-label":"Color"},image:{"title-label":"Image"},gmaps:{"title-label":"Google Maps"},"menu-tab-pane-labels":{data:"Data",analyses:"Analysis",style:"Style",infowindow:"Pop-up",legends:"Legend"},"infowindow-menu-tab-pane-labels":{click:"Click",hover:"Hover"},"analysis-form":{"merge-type":{left:"Returns all rows from #1, with the matching rows in #2 or NULL when there is no match.",inner:"Returns the result of #1 intersecting #2 (i.e. the inner part of a Venn diagram intersection)"},"admin-region":"Admin. Region",aggregate:"Aggregate","aggregate-by":"Aggregate by","aggregate-by-help":"Will calculate aggregate values for each centroid","aggregate-column":"Aggregate column","all-to-all":"All to all","allow-holes":"Allow holes","apply-btn":"Apply",asc:"ASC",bicycle:"Bicycle",boundaries:"Boundaries","bounding-box":"Bounding Box","bounding-circle":"Bounding Circle",by:"By","by-bike":"bike","by-car":"car","by-walk":"walk",car:"Car","categorize-by":"Categorize by","categorize-by-help":"If selected a centroid will be found for each category","category-column":"Category column",city:"City","clusters-num":"# of clusters",column:"Column",columns:"Columns","concave-hull":"Concave Hull","confirm-analysis":"Confirm","convex-hull":"Convex Hull",country:"Country","create-btn":"Apply","data-observatory-measurement-area":"Country","data-observatory-measurement-column":"New col. name","data-observatory-measurement-column-help":"Adds a new column to your layer to store result","data-observatory-measurement-desc":"enrich your data","data-observatory-measurement-measurement":"Measurement","data-observatory-measurement-refine":"Choose a measure","data-observatory-measurement-segments":"Segments","define-columns":"Define column to find similarities with","define-reference-and-target":"Define reference and target layers","define-two-layers":"Define two layers",denominator:"Denominator","denominator-help":"A column to normalize the target column","deprecated-sql-function":{"choose-function":"Choose the function to run on this node","choose-function-small":"Choose function","define-params":"define your parameters below",function:"function",input:"input",params:"Your Function's Parameters",target:"target node",title:"SQL Function"},desc:"DESC",direction:"Direction","disabled-by-config":"This analysis type is disabled",dissolved:"Dissolved","dissolved-help":"Combine polygons tracts which have equal ranges",distance:"Distance","enter-latitude":"Enter latitude","enter-longitude":"Enter longitude",filter:"Filter","filter-aggregate":"Aggregate your results","filter-column":"Filter column","foreign-keys":"Foreign Keys","geometry-from":"Geometry from",georeference:{"postal-code-help":"Select a column with postal codes","admin-region-help":"Select a column with region names","admin-region-extended-help":"Specify an admin. region or select a column with region names","admin-region":"Admin. Regions","city-help":"Select a column with city names","city-extended-help":"Specify a city or select a column with city names",city:"Cities","country-help":"Select a column with country names","country-extended-help":"Specify a country or select a column with country names",country:"Countries","enter-city-name":"Or enter city name","enter-country-name":"Or enter country name","enter-region-name":"Or enter region name","enter-state-name":"Or enter state name","ip-address-column":"IP Address","ip-address-help":"Select a column with IP addresses","ip-address":"IP Addresses","long-lat":"Longitude and Latitude","postal-code":"Postal Codes","select-a-country":"Select a country column","select-admin":"Select a region column","select-city":"Select a city column","select-country":"Select country column","select-ip":"Select an IP column","select-latitude":"Select a latitude column","select-longitude":"Select a longitude column","select-postal-code":"Select a postal code column","select-state":"Select state column","select-street-address":"Select an address column","state-help":"Specify a state or select a column with state names","street-address-column":"Street Address","street-address-column-help":"Select a column with street addresses","street-address-help":"Use columns or free text to compose your address schema. <a href='https://carto.com/learn/guides/analysis/geocode-street-addresses-into-point-geometries' target='_blank'>More info.</a>","street-address":"Street Addresses",advance:"Advanced mode",normal:"Normal mode"},"group-by":"Group by",hide:"Hide",inner:"Inner",input:"Input","input-layer":"Define your input layer","input-num":"Input #%{num}",intact:"Intact","intact-help":"Keep all polygon tracts as individual polygons","join-type":"Join Type","keep-columns":"Select the columns you want to keep","key-columns":"Key columns","key-columns-desc":"Choose similar columns to relate them",kilometers:"km",latitude:"Latitude",left:"Left","line-sequential":"Sequential","line-source-to-target":"To Source","line-to-column":"To Column","line-to-single-point":"To Single Point","link-layer":"Link to col.","link-layer-desc":"Specify a second layer to filter by","linked-layer":"Filter by layer",loading:"loading",longitude:"Longitude",max:"Max","measure-by":"Measure by",meters:"m",method:"Method",miles:"mi",min:"Min",mode:"Mode","find-nearest":{categorized:"Per group","categorized-help":"Calculate results per each category of the chosen column",criteria:"Select the target point layer","define-params":"Define your parameters","define-params-desc":"Define and categorize the number of results",input:"input","max-results":"max results","modal-desc":"Find nearest analysis locates the closest points between two tables.","modal-title":"Find nearest",target:"target",title:"Find nearest"},neighbors:"Neighbors","neighbors-help":"Define the local neighborhood as this many nearest-neighbors",no:"No","no-coincidence":"When no coincidence no row will be added","should-match":"Column types should match",numerator:"Target column","numerator-help":"Measure spatial autocorrelation of this column",operation:"Operation",order:"Order","order-by":"Order by","order-results":"Order your results",parameters:"Parameters","parameters-description":"Tune your analysis",permutations:"Permutations","placeholder-text":"You have not added any analysis yet. Add an analysis to discover new things.",points_source:"Point source",polygons_source:"Polygon source","postal-code":"Postal Code",quota:{title:"confirm your analysis",loading:"Obtaining your quotas...","credits-left-body":"This might incur into an extra cost. Extra credits will be charged at $%{blockPrice}/%{blockSize}.","credits-left-message":"%{smart_count} credit left |||| %{smart_count} credits left","enough-quota":"You need to use approximately %{credits} of your credits.","hard-limit-not-enough-quota":"We're sorry the current quota is insufficient to enrich your data. Rows will be set to null and analysis may not complete. Please %{contact} us to extend your quota for this function.","soft-limit-enough-quota":"We're sorry the current quota is insufficient to enrich your data. This might need about %{credits} extra credits. Extra credits will be charged at $%{blockPrice}/%{blockSize}.","no-quota-assigned-body":"To get access to the %{analysis} function, %{contact}.","no-credits-body":"You have consumed all your credits during this billing cycle. %{contact} to get some more.","no-credits-message":"No credits available","contact-message":{"no-credits":{regular:"Contact us",organization:"Contact your organization admin"},"no-quota-assigned":{regular:"contact our team",organization:"contact your organization admin"}},emails:{support:"support@carto.com",saas:"sales@carto.com"},"quota-error-title":"Error","quota-fetch-error":"There was an error obtaining your quota: %{error}.","quota-dataservice-down":"Dataservices API unreacheable.",cancel:"Cancel",confirm:"confirm","analysis-type":{routing:"Routing","trade-area":"Trade area","georeference-street-address":"Georeference street address","data-observatory-measure":"Data Observatory"}},public_transport:"Public transport",radius:"Distance","reference-layer-pluralize":"Define your reference layer |||| Define your reference layers",result:"Result",right:"Right",sampling:"Sampling","sampling-desc":"Select a sample of the data","sampling-rate":"% of data ","search-by-column-name":"Search by column name","second-geom-required":"This analysis requires a second geometry column","select-column":"Select a column","select-type":"Select data type","setup-analysis":"Setup analysis",show:"Show",significance:"Significance","significance-help":"Filter outliers and clusters to this significance. Smaller numbers are more significant.",source:"Source","source-col":"Source col.","source-column":"Source column","spatial-markov-trend-desc":"select a column for each time period","spatial-markov-trend-time-columns":"Input columns","spatial-markov-trend-time-columns-help":"Each column should contain values for a time period",state:"State",target:"Target","target-layer":"Target layer","intersection-layer":"Intersect layer","filtering-layer":"Filtering layer","base-layer":"Base layer","target-col":"Target col.","target-column":"Target column","target-percent":"Target percent","target-percent-help":"Convex hull lookalike",time:"Time","time-seconds":"Time (Seconds)","to-closest":"To closest","top-range":"Top range",tracts:"Tracts","tracts-help":"Number of AOIs evenly spaced between 0 and RADIUS","tune-analysis":"Tune your analysis","tune-centroid":"Tune your centroid","tune-clusters":"Tune your clusters",units:"Units",type:"Type",value:"Value","value-aggregation":"Value aggregation","value-aggregation-desc":"Aggregate the desired value in your polygon(s)","value-aggregation-centroids":"Aggregate the desired value in your centroid(s)","valid-type":"This kind of data is not valid for this type",walk:"Walk",weight:"Weight","weight-column":"Weight column","weight-type":"Weight type","weighted-by":"Weighted by","weighted-by-help":"Weights contribution by a value for each point",workflow:"Your workflow","write-max-value":"Write max value","write-min-value":"Write min value",yes:"Yes"},infowindow:{"select-fields":"Select fields","no-fields":"You havent selected any fields to be shown in the popup.","placeholder-interactivity-text":"Popups are disabled because interactivity is not available for this layer.","placeholder-columns-text":"Popups are disabled because there are no columns available for this layer.","placeholder-geometry":"There's no geometry in your data to add a popup.",style:{"title-label":"Style","select-style":"Select style","window-size":"Window size","header-color":"Header color",none:"None",custom:"Custom",infowindow_light:"Light",infowindow_dark:"Dark",infowindow_color:"Color",infowindow_header_with_image:"Image"},items:{"title-label":"Show items",description:"Add items"}},tooltip:{style:{none:"None",custom:"Custom",tooltip_light:"Light",tooltip_dark:"Dark"},items:{"title-label":"Show items",description:"Add items"}},"filter-options":{top:"Top",bottom:"Bottom",between:"Between","is-equal-to":"Is equal to","is-greater-than":"Is greater than","is-less-than":"Is less than"},notifier:{"center-map":{loading:"Calculating coordinates...",success:"Map centered",error:"Error centering map"}},georeference:{"manually-add":"Please georeference or manually add data to visualize.","georeference-button":"Georeference",visualize:"Layer doesn't have geometry"}},data:{"no-geometry-data":"Your dataset doesn't contain any geometry data.",stats:{"add-widget":"Add as a widget",edit:"EDIT","top-cat":"% in top 10 cat.",trues:"% true",null:"% null","number-of":"%{geometry} count","geometry-fallback":"features"},"data-toggle":{values:"VALUES",cartocss:"SQL"},"code-mirror":{tip:"CMD + S to apply your query. CTRL + Space to autocomplete."},notifier:{"sql-alter-loading":"Modifying table","sql-alter-error":"Error in SQL query.","sql-alter-success":"Modification applied.","sql-applying":"Applying query","sql-error":"Error in SQL query.","sql-success":"SQL query applied."},messages:{"sql-readonly":{title:"SQL READ-ONLY",body:"You just applied an analysis to this layer. The SQL is now read- only.",accept:"CLOSE"},"empty-data":{title:"NO DATA AVAILABLE",body:"There is no data available to be displayed."}}},infowindow:{apply:"APPLY","html-toggle":{values:"VALUES",html:"HTML"},"code-mirror":{save:"CMD + S to apply your html.",errors:{empty:"Template can't be empty."}},messages:{"custom-html-applied":{title:"CUSTOM HTML APPLIED",body:"You just applied custom html with HTML editor. You can continue and clean all html.",accept:"CONTINUE"},"layer-hidden":{title:"LAYER HIDDEN",body:"This layer is hidden, changes will not be shown until you make it visible.",
show:"SHOW"}}},"export-image":{"invalid-dimension":"Invalid dimension (%{limit}x%{limit}px)",properties:{width:"width",height:"height",size:"Size","size-subtitle":"Manually enter the image size",format:"Format","format-subtitle":"Choose a lossless (PNG) or lossy (JPG) format",options:"Options","options-subtitle":"Configure display options"}},legend:{"no-geometry-data":"There's no geometry in your data to add a legend.","data-toggle":{values:"VALUES",html:"HTML"},"code-mirror":{save:"CMD + S to apply your html.",errors:{empty:"Template can't be empty."},"pre-html":"<!-- insert your custom html code above this line -->","post-html":"<!-- insert your custom html code below this line -->"},"menu-tab-pane-labels":{color:"color",size:"size"},messages:{"custom-legend":{title:"CUSTOM LEGEND APPLIED",body:"You just applied custom html with HTML editor. You can continue and clean all html.",accept:"Delete custom html"},"layer-hidden":{title:"LAYER HIDDEN",body:"This layer is hidden. Changes won't be shown until you make it visible.",show:"SHOW"},"legends-disabled":{title:"LEGENDS DISABLED",body:"The legends setting is disabled. Changes made will not be shown until you enable legends.",show:"ENABLE"}},types:{none:"none",category:"category",gradient:"gradient",bubble:"bubble",custom:"custom"},"legend-form":{type:{title:"Select Style"},properties:{title:"Creating your legend",subtitle:"Add items"},add:"Add item",title:"Title",fill:"Fill","by-size":"By Size","by-color":"By Color",untitled:"Untitled",prefix:"Prefix",suffix:"Suffix","left-label":"Left Label","right-label":"Right Label","top-label":"Top Label","bottom-label":"Bottom Label","custom-label-placeholder":"Override dynamic value"},"pixel-title":"Amount"},style:{types:{none:"-",simple:"none",hexabins:"hexbins",squares:"squares",regions:"Adm. Regions",heatmap:"pixel",animation:"animated"},"style-form":{type:{"title-label":"Aggregation"},aggregation:{"title-label":"Aggregation Options",desc:"Configure how the aggregation works"},properties:{"title-label-point":"Style","title-label-line":"Lines style","title-label-polygon":"Polygons style","placeholder-text":"There's no geometry in your data that could be styled.",georeference:"Georeference",desc:"Change the visualization"},unanimatable:{desc:"Not any numeric or date column found in your data.",body:"You can change your column's type in the %{link}.",label:"table view"}},"code-mirror":{save:"CMD + S to apply your styles."},"style-toggle":{values:"VALUES",cartocss:"CARTOCSS"},messages:{fetched:"Schema fetched, select a style",fetching:"Schema is being fetched, when it is done, different styles will be avaiable",unavailable:"There was a problem getting schema, try to reload",none:"Your styles were reset, choose new styles for your layer, or go back to your previous style.","cartocss-applied":{title:"CARTOCSS APPLIED",body:"You just applied styles with CartoCSS. You can continue or clear all styles.",continue:"CONTINUE",clear:"CLEAR"},"layer-hidden":{title:"LAYER HIDDEN",body:"This layer is hidden, changes won't be shown until you make it visible.",show:"SHOW"},"torque-exists":{title:"TORQUE LAYER",body:"There is already a torque layer in the layers collection. If you continue, this layer will use the default style.",continue:"CONTINUE",cancel:"CANCEL"}},components:{fill:"Fill",stroke:{label:"Stroke",fetching:"Loading node schema...",unavailable:"Error getting node schema",error:"There was an error fetching node schema..."},blending:{label:"Blending",options:{none:"none",darken:"darken",lighten:"lighten",lighter:"lighter","color-dodge":"color-dodge","color-burn":"color-burn",multiply:"multiply",screen:"screen",overlay:"overlay","src-over":"src-over","source-over":"source-over",xor:"xor"}},type:{label:"Type",options:{heatmap:"Heatmap",points:"Points"}},"aggregation-value":"Operation","aggregation-size":{label:"Size",help:"In pixels"},"aggregation-dataset":"Admin. level","labels-enabled":{label:"labels","not-with-animated":"It won't be available with animations"},"labels-attribute":{label:"column",fetching:"Loading node schema...",unavailable:"Error getting node schema",error:"There was an error fetching node schema..."},"labels-font":"font","labels-offset":"offset","labels-fill":"size/color","labels-overlap":{label:"overlap",options:{true:"True",false:"False"}},"labels-halo":"halo","labels-placement":{label:"placement",options:{point:"point",line:"line",vertex:"vertex",interior:"interior"}},"animated-enabled":{label:"animated","already-one-torque":"There is already a torque layer in your map","not-with-labels":"It won't be available with labels"},"animated-attribute":{label:"column",fetching:"Loading node schema...",unavailable:"Error getting node schema",error:"There was an error fetching node schema..."},"animated-overlap":{label:"overlap",options:{true:"Accum.",false:"None"}},"animated-trails":"trails","animated-resolution":"resolution","animated-steps":"steps","animated-duration":"duration"}},widgets:{"no-geometry-data":"Your dataset lacks geometry data, it is not possible to add a widget.",options:{remove:"Delete...",rename:"Rename",edit:"Edit"},delete:{confirm:"Ok, delete it",cancel:"Cancel",desc:"The widget cannot be recovered, be sure before proceeding.",title:"You are about to delete the widget %{name}",error:"Error deleting widget %{name}: %{error}",loading:"Removing the widget %{name}...",success:"Widget %{name} deleted"},"widgets-view":{add_widget:"Add widget"},"widgets-types":{histogram:"Histogram",category:"Category",formula:"Formula","time-series":"Time series"},"widgets-form":{"placeholder-text":"You have not added any widgets yet. Add widgets to discover new things.",type:{"title-label":"Type",description:"Choose the widget type",category:"Category",formula:"Formula",histogram:"Histogram",time_series:"Time Series"},data:{"columns-unavailable":"No columns available",aggregation:"Aggregation",aggregation_column:"Aggregation Column",bins:"Buckets",column:"Column",description:"Configure your values",end:"End",loading:"loading",operation:"Operation",prefix:"Prefix",start:"Start",suffix:"Suffix",title:"Title","title-label":"Data",value:"Value","aggregate-by":"aggregate by","operation-column":"operation column"},style:{"custom-categories":"Custom categ.","custom-disabled":"If an aggregated style is applied, auto style is disabled","custom-help":"Represent the widget's values with custom colors in the map","custom-ramp":"Custom ramp",define:"Define how your widget interacts with the data",description:"Description",fill:"Fill",no:"No",sync_on_bbox_change:"Dynamic",sync_on_data_change:"Unfiltered","title-label":"Behavior",yes:"Yes"}}},"edit-feature":{features:{point:"point",line:"line",polygon:"polygon"},"loading-state":"Requesting feature data...","error-state":"There was an error requesting feature data","overlay-text":"Start clicking on the map to draw your %{featureType}",add:"Add",save:"Save",attributes:"Attributes","attributes-columns":"Change column names and type in table mode",cancel:"Cancel",geometry:"Geometry","geometry-edit":"You can also edit it on the map","geometry-disabled":"Not available for hidden or read only layers","out-of-bounds-lng":"Longitude is out of bounds [-180, 180]","out-of-bounds-lat":"Latitude is out of bounds [-90, 90]","valid-lng":"Must be a valid longitude","valid-lat":"Must be a valid latitude",valid:"Only numbers allowed",delete:"Delete %{featureType}",edit:"Edit %{featureType}",analysis:"layers with analysis nodes","custom-sql":"layers with custom SQL applied",sync:"read only layers",disabled:"Feature editing is disabled in %{disabledLayerType}. To edit the data, export this layer and import it as a new layer."}},notifications:{vis:{failed:{title:"This map couldn't be rendered",body:"Please refresh the page and contact us if the error persists"}},analysis:{waiting:"Analysis %{nodeId} enqueued...",running:"Analysis %{nodeId} running...",completed:"Analysis %{nodeId} completed",failed:"Analysis %{nodeId} failed",removed:"Analysis %{nodeId} deleted",contact:{label:"contact us",mail:"support@carto.com"},sample:"sample",errors:{timeout:"Your analysis has taken too long. Try to %{sample} your data or %{contact} for further assistance","without-geom-webmercator":'The column "the_geom_webmercator" does not exist'}},widgets:{delete:"Widget deleted correctly.",success:"Widget successfully added",error:{title:"Error adding widget:",body:"%{body} %{error}"},loading:"Adding widget",updating:"Updating widget",restoring:"Restoring widgets",restored:"Widgets restored"},layer:{error:"Layer error: %{error}",added:"Layer added successfully"},cartocss:{error:{body:"%{body} %{error}",title:"Error in CartoCSS styles:"},success:"CartoCSS applied"},sql:{"alter-loading":"Modifying table","alter-success":"Modification applied",applying:"Applying query",error:{body:"%{body} %{error}",title:"Error in SQL query:"},success:"SQL query applied"},"edit-feature":{edit:{loading:"Requesting geometry data...",error:"There was an error requesting geometry data"},error:{body:"%{body} %{error}"},destroy:{loading:"Deleting geometry",error:"Error deleting geometry",success:"Geometry deleted correctly"},save:{loading:"Saving geometry",error:"Error saving geometry",success:"Geometry successfully saved"},adding:"Adding geometry"}}}},{}],451:[function(a,b,c){b.exports={editor:{map:"mapa",map_name:"%{name} mapa",map_pluralize:"%{smart_count} mapa |||| %{smart_count} mapas"}}},{}],452:[function(a,b,c){b.exports={en:a("./en.json"),sw:a("./sw.json"),es:a("./es.json")}},{"./en.json":450,"./es.json":451,"./sw.json":453}],453:[function(a,b,c){b.exports={editor:{map:"karta",map_name:"%{name} karta",map_pluralize:"%{smart_count} karta |||| %{smart_count} kartor"}}},{}],454:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=e.View.extend({classLabel:"cdb.core.View",constructor:function(a){this.options=d.defaults(a,this.options),this._models=[],this._subviews={},e.View.call(this,a),f.viewCount++,f.views[this.cid]=this,this._created_at=new Date},add_related_model:function(a){if(!a)throw new Error("added non valid model");this._models.push(a)},addView:function(a){this._subviews[a.cid]=a,a._parent=this},removeView:function(a){delete this._subviews[a.cid]},clearSubViews:function(){d(this._subviews).each(function(a){a.clean()}),this._subviews={}},clean:function(){return this.trigger("clean"),this.clearSubViews(),this._parent&&(this._parent.removeView(this),this._parent=null),this.remove(),this.allOff(),f.viewCount--,delete f.views[this.cid],this},allOff:function(){this.off(),this.model&&this.model.off&&this.model.off(null,null,this);var a=this;d(this._models).each(function(b){b.off(null,null,a)}),this._models=[]},show:function(){this.$el.show()},hide:function(){this.$el.hide()},retrigger:function(a,b,c){c||(c=a);var d=this;b.bind&&b.bind(a,function(){d.trigger(c)},d),this.add_related_model(b)},killEvent:function(a){a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation()},cleanTooltips:function(){this.$(".tipsy").remove()}},{viewCount:0,views:{},extendEvents:function(a){return function(){return d.extend(a,this.constructor.__super__.events)}},runChecker:function(){d.each(f.views,function(a){d.each(a,function(b,c){"_parent"!==c&&a.hasOwnProperty(c)&&b instanceof f&&void 0===a._subviews[b.cid]&&(console.log("========="),console.log("untracked view: "),console.log(b.el),console.log("parent"),console.log(a.el),console.log(" "))})})}});b.exports=f},{backbone:"backbone",underscore:"underscore"}],455:[function(a,b,c){!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(b,d){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,!(!b.href||!f||"map"!==e.nodeName.toLowerCase())&&(g=a("img[usemap='#"+f+"']")[0],!!g&&c(g))):(/^(input|select|textarea|button|object)$/.test(h)?!b.disabled:"a"===h?b.href||d:d)&&c(b)}function c(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}function d(a){for(var b,c;a.length&&a[0]!==document;){if(b=a.css("position"),("absolute"===b||"relative"===b||"fixed"===b)&&(c=parseInt(a.css("zIndex"),10),!isNaN(c)&&0!==c))return c;a=a.parent()}return 0}function e(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},a.extend(this._defaults,this.regional[""]),this.regional.en=a.extend(!0,{},this.regional[""]),this.regional["en-US"]=a.extend(!0,{},this.regional.en),this.dpDiv=f(a("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function f(b){var c="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return b.delegate(c,"mouseout",function(){a(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&a(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&a(this).removeClass("ui-datepicker-next-hover")}).delegate(c,"mouseover",g)}function g(){a.datepicker._isDisabledDatepicker(r.inline?r.dpDiv.parent()[0]:r.input[0])||(a(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),a(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&a(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&a(this).addClass("ui-datepicker-next-hover"))}function h(b,c){a.extend(b,c);for(var d in c)null==c[d]&&(b[d]=c[d]);return b}function i(a){return function(){var b=this.element.val();a.apply(this,arguments),this._refresh(),b!==this.element.val()&&this._trigger("change")}}a.ui=a.ui||{},a.extend(a.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({scrollParent:function(b){var c=this.css("position"),d="absolute"===c,e=b?/(auto|scroll|hidden)/:/(auto|scroll)/,f=this.parents().filter(function(){var b=a(this);return(!d||"static"!==b.css("position"))&&e.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return"fixed"!==c&&f.length?f:a(this[0].ownerDocument||document)},uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(c){return b(c,!isNaN(a.attr(c,"tabindex")))},tabbable:function(c){var d=a.attr(c,"tabindex"),e=isNaN(d);return(e||d>=0)&&b(c,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(b,c){function d(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),f&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var e="Width"===c?["Left","Right"]:["Top","Bottom"],f=c.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+c]=function(b){return void 0===b?g["inner"+c].call(this):this.each(function(){a(this).css(f,d(this,b)+"px")})},a.fn["outer"+c]=function(b,e){return"number"!=typeof b?g["outer"+c].call(this,b):this.each(function(){a(this).css(f,d(this,b,!0,e)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),disableSelection:function(){var a="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(a+".ui-disableSelection",function(a){a.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(b){if(void 0!==b)return this.css("zIndex",b);if(this.length)for(var c,d,e=a(this[0]);e.length&&e[0]!==document;){if(c=e.css("position"),("absolute"===c||"relative"===c||"fixed"===c)&&(d=parseInt(e.css("zIndex"),10),!isNaN(d)&&0!==d))return d;e=e.parent()}return 0}}),a.ui.plugin={add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c,d){var e,f=a.plugins[b];if(f&&(d||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(e=0;e<f.length;e++)a.options[f[e][0]]&&f[e][1].apply(a.element,c)}};var j=0,k=Array.prototype.slice;a.cleanData=function(b){return function(c){var d,e,f;for(f=0;null!=(e=c[f]);f++)try{d=a._data(e,"events"),d&&d.remove&&a(e).triggerHandler("remove")}catch(a){}b(c)}}(a.cleanData),a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];return b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g),g},a.widget.extend=function(b){for(var c,d,e=k.call(arguments,1),f=0,g=e.length;f<g;f++)for(c in e[f])d=e[f][c],e[f].hasOwnProperty(c)&&void 0!==d&&(a.isPlainObject(d)?b[c]=a.isPlainObject(b[c])?a.widget.extend({},b[c],d):a.widget.extend({},d):b[c]=d);return b},a.widget.bridge=function(b,c){var d=c.prototype.widgetFullName||b;a.fn[b]=function(e){var f="string"==typeof e,g=k.call(arguments,1),h=this;return f?this.each(function(){var c,f=a.data(this,d);return"instance"===e?(h=f,!1):f?a.isFunction(f[e])&&"_"!==e.charAt(0)?(c=f[e].apply(f,g),c!==f&&void 0!==c?(h=c&&c.jquery?h.pushStack(c.get()):c,!1):void 0):a.error("no such method '"+e+"' for "+b+" widget instance"):a.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+e+"'")}):(g.length&&(e=a.widget.extend.apply(null,[e].concat(g))),this.each(function(){var b=a.data(this,d);b?(b.option(e||{}),b._init&&b._init()):a.data(this,d,new c(e,this))})),h}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,c){c=a(c||this.defaultElement||this)[0],this.element=a(c),this.uuid=j++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=a(),this.hoverable=a(),this.focusable=a(),c!==this&&(a.data(c,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===c&&this.destroy()}}),this.document=a(c.style?c.ownerDocument:c.document||c),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(b,c){var d,e,f,g=b;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof b)if(g={},d=b.split("."),b=d.shift(),d.length){for(e=g[b]=a.widget.extend({},this.options[b]),f=0;f<d.length-1;f++)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b=d.pop(),1===arguments.length)return void 0===e[b]?null:e[b];e[b]=c}else{if(1===arguments.length)return void 0===this.options[b]?null:this.options[b];g[b]=c}return this._setOptions(g),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!b),b&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){if(b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof g?f[g]:g).apply(f,arguments)}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^([\w:-]*)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(b,c){c=(c||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,b.unbind(c).undelegate(c),this.bindings=a(this.bindings.not(b).get()),this.focusable=a(this.focusable.not(b).get()),this.hoverable=a(this.hoverable.not(b).get())},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}});var l=(a.widget,!1);a(document).mouseup(function(){l=!1});a.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(!l){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var c=this,d=1===b.which,e=!("string"!=typeof this.options.cancel||!b.target.nodeName)&&a(b.target).closest(this.options.cancel).length;return!(d&&!e&&this._mouseCapture(b))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(b)!==!1,!this._mouseStarted)?(b.preventDefault(),!0):(!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return c._mouseMove(a)},this._mouseUpDelegate=function(a){return c._mouseUp(a)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),l=!0,!0))}},_mouseMove:function(b){if(this._mouseMoved){if(a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button)return this._mouseUp(b);if(!b.which)return this._mouseUp(b)}return(b.which||b.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),l=!1,!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});!function(){function b(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function c(b,c){return parseInt(a.css(b,c),10)||0}function d(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var e,f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(void 0!==e)return e;var b,c,d=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),f=d.children()[0];return a("body").append(d),b=f.offsetWidth,d.css("overflow","scroll"),c=f.offsetWidth,b===c&&(c=d[0].clientWidth),d.remove(),e=b-c},getScrollInfo:function(b){var c=b.isWindow||b.isDocument?"":b.element.css("overflow-x"),d=b.isWindow||b.isDocument?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:e,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d||e?c.width():c.outerWidth(),height:d||e?c.height():c.outerHeight()}}},a.fn.position=function(e){if(!e||!e.of)return o.apply(this,arguments);e=a.extend({},e);var n,p,q,r,s,t,u=a(e.of),v=a.position.getWithinInfo(e.within),w=a.position.getScrollInfo(v),x=(e.collision||"flip").split(" "),y={};return t=d(u),u[0].preventDefault&&(e.at="left top"),p=t.width,q=t.height,r=t.offset,s=a.extend({},r),a.each(["my","at"],function(){var a,b,c=(e[this]||"").split(" ");1===c.length&&(c=j.test(c[0])?c.concat(["center"]):k.test(c[0])?["center"].concat(c):["center","center"]),c[0]=j.test(c[0])?c[0]:"center",c[1]=k.test(c[1])?c[1]:"center",a=l.exec(c[0]),b=l.exec(c[1]),y[this]=[a?a[0]:0,b?b[0]:0],e[this]=[m.exec(c[0])[0],m.exec(c[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===e.at[0]?s.left+=p:"center"===e.at[0]&&(s.left+=p/2),"bottom"===e.at[1]?s.top+=q:"center"===e.at[1]&&(s.top+=q/2),n=b(y.at,p,q),s.left+=n[0],s.top+=n[1],this.each(function(){var d,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=c(this,"marginLeft"),t=c(this,"marginTop"),z=l+o+c(this,"marginRight")+w.width,A=m+t+c(this,"marginBottom")+w.height,B=a.extend({},s),C=b(y.my,k.outerWidth(),k.outerHeight());"right"===e.my[0]?B.left-=l:"center"===e.my[0]&&(B.left-=l/2),"bottom"===e.my[1]?B.top-=m:"center"===e.my[1]&&(B.top-=m/2),B.left+=C[0],B.top+=C[1],f||(B.left=i(B.left),B.top=i(B.top)),d={marginLeft:o,marginTop:t},a.each(["left","top"],function(b,c){a.ui.position[x[b]]&&a.ui.position[x[b]][c](B,{targetWidth:p,targetHeight:q,elemWidth:l,elemHeight:m,collisionPosition:d,collisionWidth:z,collisionHeight:A,offset:[n[0]+C[0],n[1]+C[1]],my:e.my,at:e.at,within:v,elem:k})}),e.using&&(j=function(a){var b=r.left-B.left,c=b+p-l,d=r.top-B.top,f=d+q-m,i={target:{element:u,left:r.left,top:r.top,width:p,height:q},element:{element:k,left:B.left,top:B.top,width:l,height:m},horizontal:c<0?"left":b>0?"right":"center",vertical:f<0?"top":d>0?"bottom":"middle"};p<l&&h(b+c)<p&&(i.horizontal="center"),q<m&&h(d+f)<q&&(i.vertical="middle"),g(h(b),h(c))>g(h(d),h(f))?i.important="horizontal":i.important="vertical",e.using.call(this,a,i)}),k.offset(a.extend(B,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&j<=0?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):j>0&&i<=0?a.left=e:i>j?a.left=e+f-b.collisionWidth:a.left=e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left);
},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&j<=0?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):j>0&&i<=0?a.top=e:i>j?a.top=e+f-b.collisionHeight:a.top=e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];k<0?(c=a.left+m+n+o+b.collisionWidth-g-f,(c<0||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];k<0?(d=a.top+n+o+p+b.collisionHeight-g-f,(d<0||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,g,h=document.getElementsByTagName("body")[0],i=document.createElement("div");b=document.createElement(h?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},h&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(g in d)b.style[g]=d[g];b.appendChild(i),c=h||document.documentElement,c.insertBefore(b,c.firstChild),i.style.cssText="position: absolute; left: 10.7432222px;",e=a(i).offset().left,f=e>10&&e<11,b.innerHTML="",c.removeChild(b)}()}();a.ui.position,a.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var b=this.options;this.prevShow=this.prevHide=a(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),b.collapsible||b.active!==!1&&null!=b.active||(b.active=0),this._processPanels(),b.active<0&&(b.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():a()}},_createIcons:function(){var b=this.options.icons;b&&(a("<span>").addClass("ui-accordion-header-icon ui-icon "+b.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(b.header).addClass(b.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var a;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),a=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&a.css("height","")},_setOption:function(a,b){return"active"===a?void this._activate(b):("event"===a&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(b)),this._super(a,b),"collapsible"!==a||b||this.options.active!==!1||this._activate(0),"icons"===a&&(this._destroyIcons(),b&&this._createIcons()),void("disabled"===a&&(this.element.toggleClass("ui-state-disabled",!!b).attr("aria-disabled",b),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!b))))},_keydown:function(b){if(!b.altKey&&!b.ctrlKey){var c=a.ui.keyCode,d=this.headers.length,e=this.headers.index(b.target),f=!1;switch(b.keyCode){case c.RIGHT:case c.DOWN:f=this.headers[(e+1)%d];break;case c.LEFT:case c.UP:f=this.headers[(e-1+d)%d];break;case c.SPACE:case c.ENTER:this._eventHandler(b);break;case c.HOME:f=this.headers[0];break;case c.END:f=this.headers[d-1]}f&&(a(b.target).attr("tabIndex",-1),a(f).attr("tabIndex",0),f.focus(),b.preventDefault())}},_panelKeyDown:function(b){b.keyCode===a.ui.keyCode.UP&&b.ctrlKey&&a(b.currentTarget).prev().focus()},refresh:function(){var b=this.options;this._processPanels(),b.active===!1&&b.collapsible===!0||!this.headers.length?(b.active=!1,this.active=a()):b.active===!1?this._activate(0):this.active.length&&!a.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(b.active=!1,this.active=a()):this._activate(Math.max(0,b.active-1)):b.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var a=this.headers,b=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),b&&(this._off(a.not(this.headers)),this._off(b.not(this.panels)))},_refresh:function(){var b,c=this.options,d=c.heightStyle,e=this.element.parent();this.active=this._findActive(c.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var b=a(this),c=b.uniqueId().attr("id"),d=b.next(),e=d.uniqueId().attr("id");b.attr("aria-controls",e),d.attr("aria-labelledby",c)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(c.event),"fill"===d?(b=e.height(),this.element.siblings(":visible").each(function(){var c=a(this),d=c.css("position");"absolute"!==d&&"fixed"!==d&&(b-=c.outerHeight(!0))}),this.headers.each(function(){b-=a(this).outerHeight(!0)}),this.headers.next().each(function(){a(this).height(Math.max(0,b-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")):"auto"===d&&(b=0,this.headers.next().each(function(){b=Math.max(b,a(this).css("height","").height())}).height(b))},_activate:function(b){var c=this._findActive(b)[0];c!==this.active[0]&&(c=c||this.active[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return"number"==typeof b?this.headers.eq(b):a()},_setupEvents:function(b){var c={keydown:"_keydown"};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,c),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget),f=e[0]===d[0],g=f&&c.collapsible,h=g?a():e.next(),i=d.next(),j={oldHeader:d,oldPanel:i,newHeader:g?a():e,newPanel:h};b.preventDefault(),f&&!c.collapsible||this._trigger("beforeActivate",b,j)===!1||(c.active=!g&&this.headers.index(e),this.active=f?a():e,this._toggle(j),d.removeClass("ui-accordion-header-active ui-state-active"),c.icons&&d.children(".ui-accordion-header-icon").removeClass(c.icons.activeHeader).addClass(c.icons.header),f||(e.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),c.icons&&e.children(".ui-accordion-header-icon").removeClass(c.icons.header).addClass(c.icons.activeHeader),e.next().addClass("ui-accordion-content-active")))},_toggle:function(b){var c=b.newPanel,d=this.prevShow.length?this.prevShow:b.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=c,this.prevHide=d,this.options.animate?this._animate(c,d,b):(d.hide(),c.show(),this._toggleComplete(b)),d.attr({"aria-hidden":"true"}),d.prev().attr({"aria-selected":"false","aria-expanded":"false"}),c.length&&d.length?d.prev().attr({tabIndex:-1,"aria-expanded":"false"}):c.length&&this.headers.filter(function(){return 0===parseInt(a(this).attr("tabIndex"),10)}).attr("tabIndex",-1),c.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(a,b,c){var d,e,f,g=this,h=0,i=a.css("box-sizing"),j=a.length&&(!b.length||a.index()<b.index()),k=this.options.animate||{},l=j&&k.down||k,m=function(){g._toggleComplete(c)};return"number"==typeof l&&(f=l),"string"==typeof l&&(e=l),e=e||l.easing||k.easing,f=f||l.duration||k.duration,b.length?a.length?(d=a.show().outerHeight(),b.animate(this.hideProps,{duration:f,easing:e,step:function(a,b){b.now=Math.round(a)}}),void a.hide().animate(this.showProps,{duration:f,easing:e,complete:m,step:function(a,c){c.now=Math.round(a),"height"!==c.prop?"content-box"===i&&(h+=c.now):"content"!==g.options.heightStyle&&(c.now=Math.round(d-b.outerHeight()-h),h=0)}})):b.animate(this.hideProps,f,e,m):a.animate(this.showProps,f,e,m)},_toggleComplete:function(a){var b=a.oldPanel;b.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),b.length&&(b.parent()[0].className=b.parent()[0].className),this._trigger("activate",null,a)}}),a.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(a){a.preventDefault()},"click .ui-menu-item":function(b){var c=a(b.target);!this.mouseHandled&&c.not(".ui-state-disabled").length&&(this.select(b),b.isPropagationStopped()||(this.mouseHandled=!0),c.has(".ui-menu").length?this.expand(b):!this.element.is(":focus")&&a(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(b){if(!this.previousFilter){var c=a(b.currentTarget);c.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(b,c)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(a,b){var c=this.active||this.element.find(this.options.items).eq(0);b||this.focus(a,c)},blur:function(b){this._delay(function(){a.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(b)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(a){this._closeOnDocumentClick(a)&&this.collapseAll(a),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var b=a(this);b.data("ui-menu-submenu-carat")&&b.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(b){var c,d,e,f,g=!0;switch(b.keyCode){case a.ui.keyCode.PAGE_UP:this.previousPage(b);break;case a.ui.keyCode.PAGE_DOWN:this.nextPage(b);break;case a.ui.keyCode.HOME:this._move("first","first",b);break;case a.ui.keyCode.END:this._move("last","last",b);break;case a.ui.keyCode.UP:this.previous(b);break;case a.ui.keyCode.DOWN:this.next(b);break;case a.ui.keyCode.LEFT:this.collapse(b);break;case a.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(b);break;case a.ui.keyCode.ENTER:case a.ui.keyCode.SPACE:this._activate(b);break;case a.ui.keyCode.ESCAPE:this.collapse(b);break;default:g=!1,d=this.previousFilter||"",e=String.fromCharCode(b.keyCode),f=!1,clearTimeout(this.filterTimer),e===d?f=!0:e=d+e,c=this._filterMenuItems(e),c=f&&c.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):c,c.length||(e=String.fromCharCode(b.keyCode),c=this._filterMenuItems(e)),c.length?(this.focus(b,c),this.previousFilter=e,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}g&&b.preventDefault()},_activate:function(a){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(a):this.select(a))},refresh:function(){var b,c,d=this,e=this.options.icons.submenu,f=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),f.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var b=a(this),c=b.parent(),d=a("<span>").addClass("ui-menu-icon ui-icon "+e).data("ui-menu-submenu-carat",!0);c.attr("aria-haspopup","true").prepend(d),b.attr("aria-labelledby",c.attr("id"))}),b=f.add(this.element),c=b.find(this.options.items),c.not(".ui-menu-item").each(function(){var b=a(this);d._isDivider(b)&&b.addClass("ui-widget-content ui-menu-divider")}),c.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),c.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!a.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(a,b){"icons"===a&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(b.submenu),"disabled"===a&&this.element.toggleClass("ui-state-disabled",!!b).attr("aria-disabled",b),this._super(a,b)},focus:function(a,b){var c,d;this.blur(a,a&&"focus"===a.type),this._scrollIntoView(b),this.active=b.first(),d=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",d.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),a&&"keydown"===a.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),c=b.children(".ui-menu"),c.length&&a&&/^mouse/.test(a.type)&&this._startOpening(c),this.activeMenu=b.parent(),this._trigger("focus",a,{item:b})},_scrollIntoView:function(b){var c,d,e,f,g,h;this._hasScroll()&&(c=parseFloat(a.css(this.activeMenu[0],"borderTopWidth"))||0,d=parseFloat(a.css(this.activeMenu[0],"paddingTop"))||0,e=b.offset().top-this.activeMenu.offset().top-c-d,f=this.activeMenu.scrollTop(),g=this.activeMenu.height(),h=b.outerHeight(),e<0?this.activeMenu.scrollTop(f+e):e+h>g&&this.activeMenu.scrollTop(f+e-g+h))},blur:function(a,b){b||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",a,{item:this.active}))},_startOpening:function(a){clearTimeout(this.timer),"true"===a.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(a)},this.delay))},_open:function(b){var c=a.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(b.parents(".ui-menu")).hide().attr("aria-hidden","true"),b.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(c)},collapseAll:function(b,c){clearTimeout(this.timer),this.timer=this._delay(function(){var d=c?this.element:a(b&&b.target).closest(this.element.find(".ui-menu"));d.length||(d=this.element),this._close(d),this.blur(b),this.activeMenu=d},this.delay)},_close:function(a){a||(a=this.active?this.active.parent():this.element),a.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(b){return!a(b.target).closest(".ui-menu").length},_isDivider:function(a){return!/[^\-\u2014\u2013\s]/.test(a.text())},collapse:function(a){var b=this.active&&this.active.parent().closest(".ui-menu-item",this.element);b&&b.length&&(this._close(),this.focus(a,b))},expand:function(a){var b=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();b&&b.length&&(this._open(b.parent()),this._delay(function(){this.focus(a,b)}))},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,c){var d;this.active&&(d="first"===a||"last"===a?this.active["first"===a?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[a+"All"](".ui-menu-item").eq(0)),d&&d.length&&this.active||(d=this.activeMenu.find(this.options.items)[b]()),this.focus(c,d)},nextPage:function(b){var c,d,e;return this.active?void(this.isLastItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return c=a(this),c.offset().top-d-e<0}),this.focus(b,c)):this.focus(b,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(b)},previousPage:function(b){var c,d,e;return this.active?void(this.isFirstItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return c=a(this),c.offset().top-d+e>0}),this.focus(b,c)):this.focus(b,this.activeMenu.find(this.options.items).first()))):void this.next(b)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(b){this.active=this.active||a(b.target).closest(".ui-menu-item");var c={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(b,!0),this._trigger("select",b,c)},_filterMenuItems:function(b){var c=b.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),d=new RegExp("^"+c,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return d.test(a.trim(a(this).text()))})}});a.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var b,c,d,e=this.element[0].nodeName.toLowerCase(),f="textarea"===e,g="input"===e;this.isMultiLine=!!f||!g&&this.element.prop("isContentEditable"),this.valueMethod=this.element[f||g?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(e){if(this.element.prop("readOnly"))return b=!0,d=!0,void(c=!0);b=!1,d=!1,c=!1;var f=a.ui.keyCode;switch(e.keyCode){case f.PAGE_UP:b=!0,this._move("previousPage",e);break;case f.PAGE_DOWN:b=!0,this._move("nextPage",e);break;case f.UP:b=!0,this._keyEvent("previous",e);break;case f.DOWN:b=!0,this._keyEvent("next",e);break;case f.ENTER:this.menu.active&&(b=!0,e.preventDefault(),this.menu.select(e));break;case f.TAB:this.menu.active&&this.menu.select(e);break;case f.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(e),e.preventDefault());break;default:c=!0,this._searchTimeout(e)}},keypress:function(d){if(b)return b=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||d.preventDefault());if(!c){var e=a.ui.keyCode;switch(d.keyCode){case e.PAGE_UP:this._move("previousPage",d);break;case e.PAGE_DOWN:this._move("nextPage",d);break;case e.UP:this._keyEvent("previous",d);break;case e.DOWN:this._keyEvent("next",d)}}},input:function(a){return d?(d=!1,void a.preventDefault()):void this._searchTimeout(a)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(a){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(a),void this._change(a))}}),this._initSource(),this.menu=a("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(b){b.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var c=this.menu.element[0];a(b.target).closest(".ui-menu-item").length||this._delay(function(){var b=this;this.document.one("mousedown",function(d){d.target===b.element[0]||d.target===c||a.contains(c,d.target)||b.close()})})},menufocus:function(b,c){var d,e;return this.isNewMenu&&(this.isNewMenu=!1,b.originalEvent&&/^mouse/.test(b.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){a(b.target).trigger(b.originalEvent)})):(e=c.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",b,{item:e})&&b.originalEvent&&/^key/.test(b.originalEvent.type)&&this._value(e.value),d=c.item.attr("aria-label")||e.value,void(d&&a.trim(d).length&&(this.liveRegion.children().hide(),a("<div>").text(d).appendTo(this.liveRegion))))},menuselect:function(a,b){var c=b.item.data("ui-autocomplete-item"),d=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=d,this._delay(function(){this.previous=d,this.selectedItem=c})),!1!==this._trigger("select",a,{item:c})&&this._value(c.value),this.term=this._value(),this.close(a),this.selectedItem=c}}),this.liveRegion=a("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(a,b){this._super(a,b),"source"===a&&this._initSource(),"appendTo"===a&&this.menu.element.appendTo(this._appendTo()),"disabled"===a&&b&&this.xhr&&this.xhr.abort()},_appendTo:function(){var b=this.options.appendTo;return b&&(b=b.jquery||b.nodeType?a(b):this.document.find(b).eq(0)),b&&b[0]||(b=this.element.closest(".ui-front")),b.length||(b=this.document[0].body),b},_initSource:function(){var b,c,d=this;a.isArray(this.options.source)?(b=this.options.source,this.source=function(c,d){d(a.ui.autocomplete.filter(b,c.term))}):"string"==typeof this.options.source?(c=this.options.source,this.source=function(b,e){d.xhr&&d.xhr.abort(),d.xhr=a.ajax({url:c,data:b,dataType:"json",success:function(a){e(a)},error:function(){e([])}})}):this.source=this.options.source},_searchTimeout:function(a){clearTimeout(this.searching),this.searching=this._delay(function(){var b=this.term===this._value(),c=this.menu.element.is(":visible"),d=a.altKey||a.ctrlKey||a.metaKey||a.shiftKey;b&&(!b||c||d)||(this.selectedItem=null,this.search(null,a))},this.options.delay)},search:function(a,b){return a=null!=a?a:this._value(),this.term=this._value(),a.length<this.options.minLength?this.close(b):this._trigger("search",b)!==!1?this._search(a):void 0},_search:function(a){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:a},this._response())},_response:function(){var b=++this.requestIndex;return a.proxy(function(a){b===this.requestIndex&&this.__response(a),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(a){a&&(a=this._normalize(a)),this._trigger("response",null,{content:a}),!this.options.disabled&&a&&a.length&&!this.cancelSearch?(this._suggest(a),this._trigger("open")):this._close()},close:function(a){this.cancelSearch=!0,this._close(a)},_close:function(a){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",a))},_change:function(a){this.previous!==this._value()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(b){return b.length&&b[0].label&&b[0].value?b:a.map(b,function(b){return"string"==typeof b?{label:b,value:b}:a.extend({},b,{label:b.label||b.value,value:b.value||b.label})})},_suggest:function(b){var c=this.menu.element.empty();this._renderMenu(c,b),this.isNewMenu=!0,this.menu.refresh(),c.show(),this._resizeMenu(),c.position(a.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(b,c){var d=this;a.each(c,function(a,c){d._renderItemData(b,c)})},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-autocomplete-item",b)},_renderItem:function(b,c){return a("<li>").text(c.label).appendTo(b)},_move:function(a,b){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(a)||this.menu.isLastItem()&&/^next/.test(a)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[a](b):void this.search(null,b)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(a,b){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(a,b),b.preventDefault())}}),a.extend(a.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(b,c){var d=new RegExp(a.ui.autocomplete.escapeRegex(c),"i");return a.grep(b,function(a){return d.test(a.label||a.value||a)})}}),a.widget("ui.autocomplete",a.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(a){return a+(a>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(b){var c;this._superApply(arguments),this.options.disabled||this.cancelSearch||(c=b&&b.length?this.options.messages.results(b.length):this.options.messages.noResults,this.liveRegion.children().hide(),a("<div>").text(c).appendTo(this.liveRegion))}});var m,n=(a.ui.autocomplete,"ui-button ui-widget ui-state-default ui-corner-all"),o="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",p=function(){var b=a(this);setTimeout(function(){b.find(":ui-button").button("refresh")},1)},q=function(b){var c=b.name,d=b.form,e=a([]);return c&&(c=c.replace(/'/g,"\\'"),e=d?a(d).find("[name='"+c+"'][type=radio]"):a("[name='"+c+"'][type=radio]",b.ownerDocument).filter(function(){return!this.form})),e};a.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,p),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var b=this,c=this.options,d="checkbox"===this.type||"radio"===this.type,e=d?"":"ui-state-active";null===c.label&&(c.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(n).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){c.disabled||this===m&&a(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){c.disabled||a(this).removeClass(e)}).bind("click"+this.eventNamespace,function(a){c.disabled&&(a.preventDefault(),a.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),d&&this.element.bind("change"+this.eventNamespace,function(){b.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(c.disabled)return!1}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(c.disabled)return!1;a(this).addClass("ui-state-active"),b.buttonElement.attr("aria-pressed","true");var d=b.element[0];q(d).not(d).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return!c.disabled&&(a(this).addClass("ui-state-active"),m=this,void b.document.one("mouseup",function(){m=null}))}).bind("mouseup"+this.eventNamespace,function(){return!c.disabled&&void a(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(b){return!c.disabled&&void(b.keyCode!==a.ui.keyCode.SPACE&&b.keyCode!==a.ui.keyCode.ENTER||a(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){a(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(b){b.keyCode===a.ui.keyCode.SPACE&&a(this).click()})),this._setOption("disabled",c.disabled),this._resetButton()},_determineButtonType:function(){var a,b,c;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(a=this.element.parents().last(),b="label[for='"+this.element.attr("id")+"']",this.buttonElement=a.find(b),this.buttonElement.length||(a=a.length?a.siblings():this.element.siblings(),this.buttonElement=a.filter(b),this.buttonElement.length||(this.buttonElement=a.find(b))),this.element.addClass("ui-helper-hidden-accessible"),c=this.element.is(":checked"),c&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",c)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(n+" ui-state-active "+o).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(a,b){return this._super(a,b),"disabled"===a?(this.widget().toggleClass("ui-state-disabled",!!b),this.element.prop("disabled",!!b),void(b&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")))):void this._resetButton()},refresh:function(){var b=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");
b!==this.options.disabled&&this._setOption("disabled",b),"radio"===this.type?q(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var b=this.buttonElement.removeClass(o),c=a("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),d=this.options.icons,e=d.primary&&d.secondary,f=[];d.primary||d.secondary?(this.options.text&&f.push("ui-button-text-icon"+(e?"s":d.primary?"-primary":"-secondary")),d.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+d.primary+"'></span>"),d.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+d.secondary+"'></span>"),this.options.text||(f.push(e?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||b.attr("title",a.trim(c)))):f.push("ui-button-text-only"),b.addClass(f.join(" "))}}),a.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(a,b){"disabled"===a&&this.buttons.button("option",a,b),this._super(a,b)},refresh:function(){var b="rtl"===this.element.css("direction"),c=this.element.find(this.options.items),d=c.filter(":ui-button");c.not(":ui-button").button(),d.button("refresh"),this.buttons=c.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(b?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}});a.ui.button;a.extend(a.ui,{datepicker:{version:"1.11.4"}});var r;a.extend(e.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(a){return h(this._defaults,a||{}),this},_attachDatepicker:function(b,c){var d,e,f;d=b.nodeName.toLowerCase(),e="div"===d||"span"===d,b.id||(this.uuid+=1,b.id="dp"+this.uuid),f=this._newInst(a(b),e),f.settings=a.extend({},c||{}),"input"===d?this._connectDatepicker(b,f):e&&this._inlineDatepicker(b,f)},_newInst:function(b,c){var d=b[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:d,input:b,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:c,dpDiv:c?f(a("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(b,c){var d=a(b);c.append=a([]),c.trigger=a([]),d.hasClass(this.markerClassName)||(this._attachments(d,c),d.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(c),a.data(b,"datepicker",c),c.settings.disabled&&this._disableDatepicker(b))},_attachments:function(b,c){var d,e,f,g=this._get(c,"appendText"),h=this._get(c,"isRTL");c.append&&c.append.remove(),g&&(c.append=a("<span class='"+this._appendClass+"'>"+g+"</span>"),b[h?"before":"after"](c.append)),b.unbind("focus",this._showDatepicker),c.trigger&&c.trigger.remove(),d=this._get(c,"showOn"),"focus"!==d&&"both"!==d||b.focus(this._showDatepicker),"button"!==d&&"both"!==d||(e=this._get(c,"buttonText"),f=this._get(c,"buttonImage"),c.trigger=a(this._get(c,"buttonImageOnly")?a("<img/>").addClass(this._triggerClass).attr({src:f,alt:e,title:e}):a("<button type='button'></button>").addClass(this._triggerClass).html(f?a("<img/>").attr({src:f,alt:e,title:e}):e)),b[h?"before":"after"](c.trigger),c.trigger.click(function(){return a.datepicker._datepickerShowing&&a.datepicker._lastInput===b[0]?a.datepicker._hideDatepicker():a.datepicker._datepickerShowing&&a.datepicker._lastInput!==b[0]?(a.datepicker._hideDatepicker(),a.datepicker._showDatepicker(b[0])):a.datepicker._showDatepicker(b[0]),!1}))},_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b,c,d,e,f=new Date(2009,11,20),g=this._get(a,"dateFormat");g.match(/[DM]/)&&(b=function(a){for(c=0,d=0,e=0;e<a.length;e++)a[e].length>c&&(c=a[e].length,d=e);return d},f.setMonth(b(this._get(a,g.match(/MM/)?"monthNames":"monthNamesShort"))),f.setDate(b(this._get(a,g.match(/DD/)?"dayNames":"dayNamesShort"))+20-f.getDay())),a.input.attr("size",this._formatDate(a,f).length)}},_inlineDatepicker:function(b,c){var d=a(b);d.hasClass(this.markerClassName)||(d.addClass(this.markerClassName).append(c.dpDiv),a.data(b,"datepicker",c),this._setDate(c,this._getDefaultDate(c),!0),this._updateDatepicker(c),this._updateAlternate(c),c.settings.disabled&&this._disableDatepicker(b),c.dpDiv.css("display","block"))},_dialogDatepicker:function(b,c,d,e,f){var g,i,j,k,l,m=this._dialogInst;return m||(this.uuid+=1,g="dp"+this.uuid,this._dialogInput=a("<input type='text' id='"+g+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),a("body").append(this._dialogInput),m=this._dialogInst=this._newInst(this._dialogInput,!1),m.settings={},a.data(this._dialogInput[0],"datepicker",m)),h(m.settings,e||{}),c=c&&c.constructor===Date?this._formatDate(m,c):c,this._dialogInput.val(c),this._pos=f?f.length?f:[f.pageX,f.pageY]:null,this._pos||(i=document.documentElement.clientWidth,j=document.documentElement.clientHeight,k=document.documentElement.scrollLeft||document.body.scrollLeft,l=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[i/2-100+k,j/2-150+l]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),m.settings.onSelect=d,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),a.blockUI&&a.blockUI(this.dpDiv),a.data(this._dialogInput[0],"datepicker",m),this},_destroyDatepicker:function(b){var c,d=a(b),e=a.data(b,"datepicker");d.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),a.removeData(b,"datepicker"),"input"===c?(e.append.remove(),e.trigger.remove(),d.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==c&&"span"!==c||d.removeClass(this.markerClassName).empty(),r===e&&(r=null))},_enableDatepicker:function(b){var c,d,e=a(b),f=a.data(b,"datepicker");e.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),"input"===c?(b.disabled=!1,f.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==c&&"span"!==c||(d=e.children("."+this._inlineClass),d.children().removeClass("ui-state-disabled"),d.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=a.map(this._disabledInputs,function(a){return a===b?null:a}))},_disableDatepicker:function(b){var c,d,e=a(b),f=a.data(b,"datepicker");e.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),"input"===c?(b.disabled=!0,f.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==c&&"span"!==c||(d=e.children("."+this._inlineClass),d.children().addClass("ui-state-disabled"),d.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=a.map(this._disabledInputs,function(a){return a===b?null:a}),this._disabledInputs[this._disabledInputs.length]=b)},_isDisabledDatepicker:function(a){if(!a)return!1;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]===a)return!0;return!1},_getInst:function(b){try{return a.data(b,"datepicker")}catch(a){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(b,c,d){var e,f,g,i,j=this._getInst(b);return 2===arguments.length&&"string"==typeof c?"defaults"===c?a.extend({},a.datepicker._defaults):j?"all"===c?a.extend({},j.settings):this._get(j,c):null:(e=c||{},"string"==typeof c&&(e={},e[c]=d),void(j&&(this._curInst===j&&this._hideDatepicker(),f=this._getDateDatepicker(b,!0),g=this._getMinMaxDate(j,"min"),i=this._getMinMaxDate(j,"max"),h(j.settings,e),null!==g&&void 0!==e.dateFormat&&void 0===e.minDate&&(j.settings.minDate=this._formatDate(j,g)),null!==i&&void 0!==e.dateFormat&&void 0===e.maxDate&&(j.settings.maxDate=this._formatDate(j,i)),"disabled"in e&&(e.disabled?this._disableDatepicker(b):this._enableDatepicker(b)),this._attachments(a(b),j),this._autoSize(j),this._setDate(j,f),this._updateAlternate(j),this._updateDatepicker(j))))},_changeDatepicker:function(a,b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){var b=this._getInst(a);b&&this._updateDatepicker(b)},_setDateDatepicker:function(a,b){var c=this._getInst(a);c&&(this._setDate(c,b),this._updateDatepicker(c),this._updateAlternate(c))},_getDateDatepicker:function(a,b){var c=this._getInst(a);return c&&!c.inline&&this._setDateFromField(c,b),c?this._getDate(c):null},_doKeyDown:function(b){var c,d,e,f=a.datepicker._getInst(b.target),g=!0,h=f.dpDiv.is(".ui-datepicker-rtl");if(f._keyEvent=!0,a.datepicker._datepickerShowing)switch(b.keyCode){case 9:a.datepicker._hideDatepicker(),g=!1;break;case 13:return e=a("td."+a.datepicker._dayOverClass+":not(."+a.datepicker._currentClass+")",f.dpDiv),e[0]&&a.datepicker._selectDay(b.target,f.selectedMonth,f.selectedYear,e[0]),c=a.datepicker._get(f,"onSelect"),c?(d=a.datepicker._formatDate(f),c.apply(f.input?f.input[0]:null,[d,f])):a.datepicker._hideDatepicker(),!1;case 27:a.datepicker._hideDatepicker();break;case 33:a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 34:a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,"stepMonths"),"M");break;case 35:(b.ctrlKey||b.metaKey)&&a.datepicker._clearDate(b.target),g=b.ctrlKey||b.metaKey;break;case 36:(b.ctrlKey||b.metaKey)&&a.datepicker._gotoToday(b.target),g=b.ctrlKey||b.metaKey;break;case 37:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,h?1:-1,"D"),g=b.ctrlKey||b.metaKey,b.originalEvent.altKey&&a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 38:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,-7,"D"),g=b.ctrlKey||b.metaKey;break;case 39:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,h?-1:1,"D"),g=b.ctrlKey||b.metaKey,b.originalEvent.altKey&&a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,"stepMonths"),"M");break;case 40:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,7,"D"),g=b.ctrlKey||b.metaKey;break;default:g=!1}else 36===b.keyCode&&b.ctrlKey?a.datepicker._showDatepicker(this):g=!1;g&&(b.preventDefault(),b.stopPropagation())},_doKeyPress:function(b){var c,d,e=a.datepicker._getInst(b.target);if(a.datepicker._get(e,"constrainInput"))return c=a.datepicker._possibleChars(a.datepicker._get(e,"dateFormat")),d=String.fromCharCode(null==b.charCode?b.keyCode:b.charCode),b.ctrlKey||b.metaKey||d<" "||!c||c.indexOf(d)>-1},_doKeyUp:function(b){var c,d=a.datepicker._getInst(b.target);if(d.input.val()!==d.lastVal)try{c=a.datepicker.parseDate(a.datepicker._get(d,"dateFormat"),d.input?d.input.val():null,a.datepicker._getFormatConfig(d)),c&&(a.datepicker._setDateFromField(d),a.datepicker._updateAlternate(d),a.datepicker._updateDatepicker(d))}catch(a){}return!0},_showDatepicker:function(b){if(b=b.target||b,"input"!==b.nodeName.toLowerCase()&&(b=a("input",b.parentNode)[0]),!a.datepicker._isDisabledDatepicker(b)&&a.datepicker._lastInput!==b){var c,e,f,g,i,j,k;c=a.datepicker._getInst(b),a.datepicker._curInst&&a.datepicker._curInst!==c&&(a.datepicker._curInst.dpDiv.stop(!0,!0),c&&a.datepicker._datepickerShowing&&a.datepicker._hideDatepicker(a.datepicker._curInst.input[0])),e=a.datepicker._get(c,"beforeShow"),f=e?e.apply(b,[b,c]):{},f!==!1&&(h(c.settings,f),c.lastVal=null,a.datepicker._lastInput=b,a.datepicker._setDateFromField(c),a.datepicker._inDialog&&(b.value=""),a.datepicker._pos||(a.datepicker._pos=a.datepicker._findPos(b),a.datepicker._pos[1]+=b.offsetHeight),g=!1,a(b).parents().each(function(){return g|="fixed"===a(this).css("position"),!g}),i={left:a.datepicker._pos[0],top:a.datepicker._pos[1]},a.datepicker._pos=null,c.dpDiv.empty(),c.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),a.datepicker._updateDatepicker(c),i=a.datepicker._checkOffset(c,i,g),c.dpDiv.css({position:a.datepicker._inDialog&&a.blockUI?"static":g?"fixed":"absolute",display:"none",left:i.left+"px",top:i.top+"px"}),c.inline||(j=a.datepicker._get(c,"showAnim"),k=a.datepicker._get(c,"duration"),c.dpDiv.css("z-index",d(a(b))+1),a.datepicker._datepickerShowing=!0,a.effects&&a.effects.effect[j]?c.dpDiv.show(j,a.datepicker._get(c,"showOptions"),k):c.dpDiv[j||"show"](j?k:null),a.datepicker._shouldFocusInput(c)&&c.input.focus(),a.datepicker._curInst=c))}},_updateDatepicker:function(b){this.maxRows=4,r=b,b.dpDiv.empty().append(this._generateHTML(b)),this._attachHandlers(b);var c,d=this._getNumberOfMonths(b),e=d[1],f=17,h=b.dpDiv.find("."+this._dayOverClass+" a");h.length>0&&g.apply(h.get(0)),b.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),e>1&&b.dpDiv.addClass("ui-datepicker-multi-"+e).css("width",f*e+"em"),b.dpDiv[(1!==d[0]||1!==d[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),b.dpDiv[(this._get(b,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),b===a.datepicker._curInst&&a.datepicker._datepickerShowing&&a.datepicker._shouldFocusInput(b)&&b.input.focus(),b.yearshtml&&(c=b.yearshtml,setTimeout(function(){c===b.yearshtml&&b.yearshtml&&b.dpDiv.find("select.ui-datepicker-year:first").replaceWith(b.yearshtml),c=b.yearshtml=null},0))},_shouldFocusInput:function(a){return a.input&&a.input.is(":visible")&&!a.input.is(":disabled")&&!a.input.is(":focus")},_checkOffset:function(b,c,d){var e=b.dpDiv.outerWidth(),f=b.dpDiv.outerHeight(),g=b.input?b.input.outerWidth():0,h=b.input?b.input.outerHeight():0,i=document.documentElement.clientWidth+(d?0:a(document).scrollLeft()),j=document.documentElement.clientHeight+(d?0:a(document).scrollTop());return c.left-=this._get(b,"isRTL")?e-g:0,c.left-=d&&c.left===b.input.offset().left?a(document).scrollLeft():0,c.top-=d&&c.top===b.input.offset().top+h?a(document).scrollTop():0,c.left-=Math.min(c.left,c.left+e>i&&i>e?Math.abs(c.left+e-i):0),c.top-=Math.min(c.top,c.top+f>j&&j>f?Math.abs(f+h):0),c},_findPos:function(b){for(var c,d=this._getInst(b),e=this._get(d,"isRTL");b&&("hidden"===b.type||1!==b.nodeType||a.expr.filters.hidden(b));)b=b[e?"previousSibling":"nextSibling"];return c=a(b).offset(),[c.left,c.top]},_hideDatepicker:function(b){var c,d,e,f,g=this._curInst;!g||b&&g!==a.data(b,"datepicker")||this._datepickerShowing&&(c=this._get(g,"showAnim"),d=this._get(g,"duration"),e=function(){a.datepicker._tidyDialog(g)},a.effects&&(a.effects.effect[c]||a.effects[c])?g.dpDiv.hide(c,a.datepicker._get(g,"showOptions"),d,e):g.dpDiv["slideDown"===c?"slideUp":"fadeIn"===c?"fadeOut":"hide"](c?d:null,e),c||e(),this._datepickerShowing=!1,f=this._get(g,"onClose"),f&&f.apply(g.input?g.input[0]:null,[g.input?g.input.val():"",g]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),a.blockUI&&(a.unblockUI(),a("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(b){if(a.datepicker._curInst){var c=a(b.target),d=a.datepicker._getInst(c[0]);(c[0].id===a.datepicker._mainDivId||0!==c.parents("#"+a.datepicker._mainDivId).length||c.hasClass(a.datepicker.markerClassName)||c.closest("."+a.datepicker._triggerClass).length||!a.datepicker._datepickerShowing||a.datepicker._inDialog&&a.blockUI)&&(!c.hasClass(a.datepicker.markerClassName)||a.datepicker._curInst===d)||a.datepicker._hideDatepicker()}},_adjustDate:function(b,c,d){var e=a(b),f=this._getInst(e[0]);this._isDisabledDatepicker(e[0])||(this._adjustInstDate(f,c+("M"===d?this._get(f,"showCurrentAtPos"):0),d),this._updateDatepicker(f))},_gotoToday:function(b){var c,d=a(b),e=this._getInst(d[0]);this._get(e,"gotoCurrent")&&e.currentDay?(e.selectedDay=e.currentDay,e.drawMonth=e.selectedMonth=e.currentMonth,e.drawYear=e.selectedYear=e.currentYear):(c=new Date,e.selectedDay=c.getDate(),e.drawMonth=e.selectedMonth=c.getMonth(),e.drawYear=e.selectedYear=c.getFullYear()),this._notifyChange(e),this._adjustDate(d)},_selectMonthYear:function(b,c,d){var e=a(b),f=this._getInst(e[0]);f["selected"+("M"===d?"Month":"Year")]=f["draw"+("M"===d?"Month":"Year")]=parseInt(c.options[c.selectedIndex].value,10),this._notifyChange(f),this._adjustDate(e)},_selectDay:function(b,c,d,e){var f,g=a(b);a(e).hasClass(this._unselectableClass)||this._isDisabledDatepicker(g[0])||(f=this._getInst(g[0]),f.selectedDay=f.currentDay=a("a",e).html(),f.selectedMonth=f.currentMonth=c,f.selectedYear=f.currentYear=d,this._selectDate(b,this._formatDate(f,f.currentDay,f.currentMonth,f.currentYear)))},_clearDate:function(b){var c=a(b);this._selectDate(c,"")},_selectDate:function(b,c){var d,e=a(b),f=this._getInst(e[0]);c=null!=c?c:this._formatDate(f),f.input&&f.input.val(c),this._updateAlternate(f),d=this._get(f,"onSelect"),d?d.apply(f.input?f.input[0]:null,[c,f]):f.input&&f.input.trigger("change"),f.inline?this._updateDatepicker(f):(this._hideDatepicker(),this._lastInput=f.input[0],"object"!=typeof f.input[0]&&f.input.focus(),this._lastInput=null)},_updateAlternate:function(b){var c,d,e,f=this._get(b,"altField");f&&(c=this._get(b,"altFormat")||this._get(b,"dateFormat"),d=this._getDate(b),e=this.formatDate(c,d,this._getFormatConfig(b)),a(f).each(function(){a(this).val(e)}))},noWeekends:function(a){var b=a.getDay();return[b>0&&b<6,""]},iso8601Week:function(a){var b,c=new Date(a.getTime());return c.setDate(c.getDate()+4-(c.getDay()||7)),b=c.getTime(),c.setMonth(0),c.setDate(1),Math.floor(Math.round((b-c)/864e5)/7)+1},parseDate:function(b,c,d){if(null==b||null==c)throw"Invalid arguments";if(c="object"==typeof c?c.toString():c+"",""===c)return null;var e,f,g,h,i=0,j=(d?d.shortYearCutoff:null)||this._defaults.shortYearCutoff,k="string"!=typeof j?j:(new Date).getFullYear()%100+parseInt(j,10),l=(d?d.dayNamesShort:null)||this._defaults.dayNamesShort,m=(d?d.dayNames:null)||this._defaults.dayNames,n=(d?d.monthNamesShort:null)||this._defaults.monthNamesShort,o=(d?d.monthNames:null)||this._defaults.monthNames,p=-1,q=-1,r=-1,s=-1,t=!1,u=function(a){var c=e+1<b.length&&b.charAt(e+1)===a;return c&&e++,c},v=function(a){var b=u(a),d="@"===a?14:"!"===a?20:"y"===a&&b?4:"o"===a?3:2,e="y"===a?d:1,f=new RegExp("^\\d{"+e+","+d+"}"),g=c.substring(i).match(f);if(!g)throw"Missing number at position "+i;return i+=g[0].length,parseInt(g[0],10)},w=function(b,d,e){var f=-1,g=a.map(u(b)?e:d,function(a,b){return[[b,a]]}).sort(function(a,b){return-(a[1].length-b[1].length)});if(a.each(g,function(a,b){var d=b[1];if(c.substr(i,d.length).toLowerCase()===d.toLowerCase())return f=b[0],i+=d.length,!1}),f!==-1)return f+1;throw"Unknown name at position "+i},x=function(){if(c.charAt(i)!==b.charAt(e))throw"Unexpected literal at position "+i;i++};for(e=0;e<b.length;e++)if(t)"'"!==b.charAt(e)||u("'")?x():t=!1;else switch(b.charAt(e)){case"d":r=v("d");break;case"D":w("D",l,m);break;case"o":s=v("o");break;case"m":q=v("m");break;case"M":q=w("M",n,o);break;case"y":p=v("y");break;case"@":h=new Date(v("@")),p=h.getFullYear(),q=h.getMonth()+1,r=h.getDate();break;case"!":h=new Date((v("!")-this._ticksTo1970)/1e4),p=h.getFullYear(),q=h.getMonth()+1,r=h.getDate();break;case"'":u("'")?x():t=!0;break;default:x()}if(i<c.length&&(g=c.substr(i),!/^\s+/.test(g)))throw"Extra/unparsed characters found in date: "+g;if(p===-1?p=(new Date).getFullYear():p<100&&(p+=(new Date).getFullYear()-(new Date).getFullYear()%100+(p<=k?0:-100)),s>-1)for(q=1,r=s;;){if(f=this._getDaysInMonth(p,q-1),r<=f)break;q++,r-=f}if(h=this._daylightSavingAdjust(new Date(p,q-1,r)),h.getFullYear()!==p||h.getMonth()+1!==q||h.getDate()!==r)throw"Invalid date";return h},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(a,b,c){if(!b)return"";var d,e=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,g=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,h=(c?c.monthNames:null)||this._defaults.monthNames,i=function(b){var c=d+1<a.length&&a.charAt(d+1)===b;return c&&d++,c},j=function(a,b,c){var d=""+b;if(i(a))for(;d.length<c;)d="0"+d;return d},k=function(a,b,c,d){return i(a)?d[b]:c[b]},l="",m=!1;if(b)for(d=0;d<a.length;d++)if(m)"'"!==a.charAt(d)||i("'")?l+=a.charAt(d):m=!1;else switch(a.charAt(d)){case"d":l+=j("d",b.getDate(),2);break;case"D":l+=k("D",b.getDay(),e,f);break;case"o":l+=j("o",Math.round((new Date(b.getFullYear(),b.getMonth(),b.getDate()).getTime()-new Date(b.getFullYear(),0,0).getTime())/864e5),3);break;case"m":l+=j("m",b.getMonth()+1,2);break;case"M":l+=k("M",b.getMonth(),g,h);break;case"y":l+=i("y")?b.getFullYear():(b.getYear()%100<10?"0":"")+b.getYear()%100;break;case"@":l+=b.getTime();break;case"!":l+=1e4*b.getTime()+this._ticksTo1970;break;case"'":i("'")?l+="'":m=!0;break;default:l+=a.charAt(d)}return l},_possibleChars:function(a){var b,c="",d=!1,e=function(c){var d=b+1<a.length&&a.charAt(b+1)===c;return d&&b++,d};for(b=0;b<a.length;b++)if(d)"'"!==a.charAt(b)||e("'")?c+=a.charAt(b):d=!1;else switch(a.charAt(b)){case"d":case"m":case"y":case"@":c+="0123456789";break;case"D":case"M":return null;case"'":e("'")?c+="'":d=!0;break;default:c+=a.charAt(b)}return c},_get:function(a,b){return void 0!==a.settings[b]?a.settings[b]:this._defaults[b]},_setDateFromField:function(a,b){if(a.input.val()!==a.lastVal){var c=this._get(a,"dateFormat"),d=a.lastVal=a.input?a.input.val():null,e=this._getDefaultDate(a),f=e,g=this._getFormatConfig(a);try{f=this.parseDate(c,d,g)||e}catch(a){d=b?"":d}a.selectedDay=f.getDate(),a.drawMonth=a.selectedMonth=f.getMonth(),a.drawYear=a.selectedYear=f.getFullYear(),a.currentDay=d?f.getDate():0,a.currentMonth=d?f.getMonth():0,a.currentYear=d?f.getFullYear():0,this._adjustInstDate(a)}},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(b,c,d){var e=function(a){var b=new Date;return b.setDate(b.getDate()+a),b},f=function(c){try{return a.datepicker.parseDate(a.datepicker._get(b,"dateFormat"),c,a.datepicker._getFormatConfig(b))}catch(a){}for(var d=(c.toLowerCase().match(/^c/)?a.datepicker._getDate(b):null)||new Date,e=d.getFullYear(),f=d.getMonth(),g=d.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,i=h.exec(c);i;){switch(i[2]||"d"){case"d":case"D":g+=parseInt(i[1],10);break;case"w":case"W":g+=7*parseInt(i[1],10);break;case"m":case"M":f+=parseInt(i[1],10),g=Math.min(g,a.datepicker._getDaysInMonth(e,f));break;case"y":case"Y":e+=parseInt(i[1],10),g=Math.min(g,a.datepicker._getDaysInMonth(e,f))}i=h.exec(c)}return new Date(e,f,g)},g=null==c||""===c?d:"string"==typeof c?f(c):"number"==typeof c?isNaN(c)?d:e(c):new Date(c.getTime());return g=g&&"Invalid Date"===g.toString()?d:g,g&&(g.setHours(0),g.setMinutes(0),g.setSeconds(0),g.setMilliseconds(0)),this._daylightSavingAdjust(g)},_daylightSavingAdjust:function(a){return a?(a.setHours(a.getHours()>12?a.getHours()+2:0),a):null},_setDate:function(a,b,c){var d=!b,e=a.selectedMonth,f=a.selectedYear,g=this._restrictMinMax(a,this._determineDate(a,b,new Date));a.selectedDay=a.currentDay=g.getDate(),a.drawMonth=a.selectedMonth=a.currentMonth=g.getMonth(),a.drawYear=a.selectedYear=a.currentYear=g.getFullYear(),e===a.selectedMonth&&f===a.selectedYear||c||this._notifyChange(a),this._adjustInstDate(a),a.input&&a.input.val(d?"":this._formatDate(a))},_getDate:function(a){var b=!a.currentYear||a.input&&""===a.input.val()?null:this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return b},_attachHandlers:function(b){var c=this._get(b,"stepMonths"),d="#"+b.id.replace(/\\\\/g,"\\");b.dpDiv.find("[data-handler]").map(function(){var b={prev:function(){a.datepicker._adjustDate(d,-c,"M")},next:function(){a.datepicker._adjustDate(d,+c,"M")},hide:function(){a.datepicker._hideDatepicker()},today:function(){a.datepicker._gotoToday(d)},selectDay:function(){return a.datepicker._selectDay(d,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return a.datepicker._selectMonthYear(d,this,"M"),!1},selectYear:function(){return a.datepicker._selectMonthYear(d,this,"Y"),!1}};a(this).bind(this.getAttribute("data-event"),b[this.getAttribute("data-handler")])})},_generateHTML:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=new Date,P=this._daylightSavingAdjust(new Date(O.getFullYear(),O.getMonth(),O.getDate())),Q=this._get(a,"isRTL"),R=this._get(a,"showButtonPanel"),S=this._get(a,"hideIfNoPrevNext"),T=this._get(a,"navigationAsDateFormat"),U=this._getNumberOfMonths(a),V=this._get(a,"showCurrentAtPos"),W=this._get(a,"stepMonths"),X=1!==U[0]||1!==U[1],Y=this._daylightSavingAdjust(a.currentDay?new Date(a.currentYear,a.currentMonth,a.currentDay):new Date(9999,9,9)),Z=this._getMinMaxDate(a,"min"),$=this._getMinMaxDate(a,"max"),_=a.drawMonth-V,aa=a.drawYear;if(_<0&&(_+=12,aa--),$)for(b=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-U[0]*U[1]+1,$.getDate())),b=Z&&b<Z?Z:b;this._daylightSavingAdjust(new Date(aa,_,1))>b;)_--,_<0&&(_=11,aa--);for(a.drawMonth=_,a.drawYear=aa,c=this._get(a,"prevText"),c=T?this.formatDate(c,this._daylightSavingAdjust(new Date(aa,_-W,1)),this._getFormatConfig(a)):c,d=this._canAdjustMonth(a,-1,aa,_)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+c+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"e":"w")+"'>"+c+"</span></a>":S?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+c+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"e":"w")+"'>"+c+"</span></a>",e=this._get(a,"nextText"),e=T?this.formatDate(e,this._daylightSavingAdjust(new Date(aa,_+W,1)),this._getFormatConfig(a)):e,f=this._canAdjustMonth(a,1,aa,_)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+e+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"w":"e")+"'>"+e+"</span></a>":S?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+e+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"w":"e")+"'>"+e+"</span></a>",g=this._get(a,"currentText"),h=this._get(a,"gotoCurrent")&&a.currentDay?Y:P,g=T?this.formatDate(g,h,this._getFormatConfig(a)):g,i=a.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(a,"closeText")+"</button>",j=R?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Q?i:"")+(this._isInRange(a,h)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+g+"</button>":"")+(Q?"":i)+"</div>":"",k=parseInt(this._get(a,"firstDay"),10),k=isNaN(k)?0:k,l=this._get(a,"showWeek"),m=this._get(a,"dayNames"),n=this._get(a,"dayNamesMin"),o=this._get(a,"monthNames"),p=this._get(a,"monthNamesShort"),q=this._get(a,"beforeShowDay"),r=this._get(a,"showOtherMonths"),s=this._get(a,"selectOtherMonths"),t=this._getDefaultDate(a),u="",w=0;w<U[0];w++){for(x="",this.maxRows=4,y=0;y<U[1];y++){if(z=this._daylightSavingAdjust(new Date(aa,_,a.selectedDay)),A=" ui-corner-all",B="",X){if(B+="<div class='ui-datepicker-group",U[1]>1)switch(y){case 0:B+=" ui-datepicker-group-first",A=" ui-corner-"+(Q?"right":"left");break;case U[1]-1:B+=" ui-datepicker-group-last",A=" ui-corner-"+(Q?"left":"right");break;default:B+=" ui-datepicker-group-middle",A=""}B+="'>"}for(B+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+A+"'>"+(/all|left/.test(A)&&0===w?Q?f:d:"")+(/all|right/.test(A)&&0===w?Q?d:f:"")+this._generateMonthYearHeader(a,_,aa,Z,$,w>0||y>0,o,p)+"</div><table class='ui-datepicker-calendar'><thead><tr>",C=l?"<th class='ui-datepicker-week-col'>"+this._get(a,"weekHeader")+"</th>":"",v=0;v<7;v++)D=(v+k)%7,C+="<th scope='col'"+((v+k+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+m[D]+"'>"+n[D]+"</span></th>";for(B+=C+"</tr></thead><tbody>",E=this._getDaysInMonth(aa,_),aa===a.selectedYear&&_===a.selectedMonth&&(a.selectedDay=Math.min(a.selectedDay,E)),F=(this._getFirstDayOfMonth(aa,_)-k+7)%7,G=Math.ceil((F+E)/7),H=X&&this.maxRows>G?this.maxRows:G,this.maxRows=H,I=this._daylightSavingAdjust(new Date(aa,_,1-F)),J=0;J<H;J++){for(B+="<tr>",K=l?"<td class='ui-datepicker-week-col'>"+this._get(a,"calculateWeek")(I)+"</td>":"",v=0;v<7;v++)L=q?q.apply(a.input?a.input[0]:null,[I]):[!0,""],M=I.getMonth()!==_,N=M&&!s||!L[0]||Z&&I<Z||$&&I>$,K+="<td class='"+((v+k+6)%7>=5?" ui-datepicker-week-end":"")+(M?" ui-datepicker-other-month":"")+(I.getTime()===z.getTime()&&_===a.selectedMonth&&a._keyEvent||t.getTime()===I.getTime()&&t.getTime()===z.getTime()?" "+this._dayOverClass:"")+(N?" "+this._unselectableClass+" ui-state-disabled":"")+(M&&!r?"":" "+L[1]+(I.getTime()===Y.getTime()?" "+this._currentClass:"")+(I.getTime()===P.getTime()?" ui-datepicker-today":""))+"'"+(M&&!r||!L[2]?"":" title='"+L[2].replace(/'/g,"&#39;")+"'")+(N?"":" data-handler='selectDay' data-event='click' data-month='"+I.getMonth()+"' data-year='"+I.getFullYear()+"'")+">"+(M&&!r?"&#xa0;":N?"<span class='ui-state-default'>"+I.getDate()+"</span>":"<a class='ui-state-default"+(I.getTime()===P.getTime()?" ui-state-highlight":"")+(I.getTime()===Y.getTime()?" ui-state-active":"")+(M?" ui-priority-secondary":"")+"' href='#'>"+I.getDate()+"</a>")+"</td>",I.setDate(I.getDate()+1),I=this._daylightSavingAdjust(I);B+=K+"</tr>"}_++,_>11&&(_=0,aa++),B+="</tbody></table>"+(X?"</div>"+(U[0]>0&&y===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=B}u+=x}return u+=j,a._keyEvent=!1,u},_generateMonthYearHeader:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q=this._get(a,"changeMonth"),r=this._get(a,"changeYear"),s=this._get(a,"showMonthAfterYear"),t="<div class='ui-datepicker-title'>",u="";if(f||!q)u+="<span class='ui-datepicker-month'>"+g[b]+"</span>";else{for(i=d&&d.getFullYear()===c,j=e&&e.getFullYear()===c,u+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",k=0;k<12;k++)(!i||k>=d.getMonth())&&(!j||k<=e.getMonth())&&(u+="<option value='"+k+"'"+(k===b?" selected='selected'":"")+">"+h[k]+"</option>");u+="</select>"}if(s||(t+=u+(!f&&q&&r?"":"&#xa0;")),!a.yearshtml)if(a.yearshtml="",f||!r)t+="<span class='ui-datepicker-year'>"+c+"</span>";else{for(l=this._get(a,"yearRange").split(":"),m=(new Date).getFullYear(),n=function(a){var b=a.match(/c[+\-].*/)?c+parseInt(a.substring(1),10):a.match(/[+\-].*/)?m+parseInt(a,10):parseInt(a,10);return isNaN(b)?m:b},o=n(l[0]),p=Math.max(o,n(l[1]||"")),o=d?Math.max(o,d.getFullYear()):o,p=e?Math.min(p,e.getFullYear()):p,a.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";o<=p;o++)a.yearshtml+="<option value='"+o+"'"+(o===c?" selected='selected'":"")+">"+o+"</option>";
a.yearshtml+="</select>",t+=a.yearshtml,a.yearshtml=null}return t+=this._get(a,"yearSuffix"),s&&(t+=(!f&&q&&r?"":"&#xa0;")+u),t+="</div>"},_adjustInstDate:function(a,b,c){var d=a.drawYear+("Y"===c?b:0),e=a.drawMonth+("M"===c?b:0),f=Math.min(a.selectedDay,this._getDaysInMonth(d,e))+("D"===c?b:0),g=this._restrictMinMax(a,this._daylightSavingAdjust(new Date(d,e,f)));a.selectedDay=g.getDate(),a.drawMonth=a.selectedMonth=g.getMonth(),a.drawYear=a.selectedYear=g.getFullYear(),"M"!==c&&"Y"!==c||this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max"),e=c&&b<c?c:b;return d&&e>d?d:e},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");b&&b.apply(a.input?a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){var b=this._get(a,"numberOfMonths");return null==b?[1,1]:"number"==typeof b?[1,b]:b},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return new Date(a,b,1).getDay()},_canAdjustMonth:function(a,b,c,d){var e=this._getNumberOfMonths(a),f=this._daylightSavingAdjust(new Date(c,d+(b<0?b:e[0]*e[1]),1));return b<0&&f.setDate(this._getDaysInMonth(f.getFullYear(),f.getMonth())),this._isInRange(a,f)},_isInRange:function(a,b){var c,d,e=this._getMinMaxDate(a,"min"),f=this._getMinMaxDate(a,"max"),g=null,h=null,i=this._get(a,"yearRange");return i&&(c=i.split(":"),d=(new Date).getFullYear(),g=parseInt(c[0],10),h=parseInt(c[1],10),c[0].match(/[+\-].*/)&&(g+=d),c[1].match(/[+\-].*/)&&(h+=d)),(!e||b.getTime()>=e.getTime())&&(!f||b.getTime()<=f.getTime())&&(!g||b.getFullYear()>=g)&&(!h||b.getFullYear()<=h)},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff");return b="string"!=typeof b?b:(new Date).getFullYear()%100+parseInt(b,10),{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,"monthNames")}},_formatDate:function(a,b,c,d){b||(a.currentDay=a.selectedDay,a.currentMonth=a.selectedMonth,a.currentYear=a.selectedYear);var e=b?"object"==typeof b?b:this._daylightSavingAdjust(new Date(d,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),e,this._getFormatConfig(a))}}),a.fn.datepicker=function(b){if(!this.length)return this;a.datepicker.initialized||(a(document).mousedown(a.datepicker._checkExternalClick),a.datepicker.initialized=!0),0===a("#"+a.datepicker._mainDivId).length&&a("body").append(a.datepicker.dpDiv);var c=Array.prototype.slice.call(arguments,1);return"string"!=typeof b||"isDisabled"!==b&&"getDate"!==b&&"widget"!==b?"option"===b&&2===arguments.length&&"string"==typeof arguments[1]?a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(c)):this.each(function(){"string"==typeof b?a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this].concat(c)):a.datepicker._attachDatepicker(this,b)}):a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(c))},a.datepicker=new e,a.datepicker.initialized=!1,a.datepicker.uuid=(new Date).getTime(),a.datepicker.version="1.11.4";a.datepicker;a.widget("ui.draggable",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(a,b){this._super(a,b),"handle"===a&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(b){var c=this.options;return this._blurActiveElement(b),!(this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(b),!!this.handle&&(this._blockFrames(c.iframeFix===!0?"iframe":c.iframeFix),!0))},_blockFrames:function(b){this.iframeBlocks=this.document.find(b).map(function(){var b=a(this);return a("<div>").css("position","absolute").appendTo(b.parent()).outerWidth(b.outerWidth()).outerHeight(b.outerHeight()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(b){var c=this.document[0];if(this.handleElement.is(b.target))try{c.activeElement&&"body"!==c.activeElement.nodeName.toLowerCase()&&a(c.activeElement).blur()}catch(a){}},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===a(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(b),this.originalPosition=this.position=this._generatePosition(b,!1),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._normalizeRightBottom(),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_refreshOffsets:function(a){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:a.pageX-this.offset.left,top:a.pageY-this.offset.top}},_mouseDrag:function(b,c){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b,!0),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1},_mouseUp:function(b){return this._unblockFrames(),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),this.handleElement.is(b.target)&&this.element.focus(),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return!this.options.handle||!!a(b.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper),e=d?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return e.parents("body").length||e.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d&&e[0]===this.element[0]&&this._setPositionRelative(),e[0]===this.element[0]||/(fixed|absolute)/.test(e.css("position"))||e.css("position","absolute"),e},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_isRootNode:function(a){return/(html|body)/i.test(a.tagName)||a===this.document[0]},_getParentOffset:function(){var b=this.offsetParent.offset(),c=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==c&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var a=this.element.position(),b=this._isRootNode(this.scrollParent[0]);return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+(b?0:this.scrollParent.scrollTop()),left:a.left-(parseInt(this.helper.css("left"),10)||0)+(b?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options,f=this.document[0];return this.relativeContainer=null,e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(f).width()-this.helperProportions.width-this.margins.left,(a(f).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b=/(scroll|auto)/.test(c.css("overflow")),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=c))):void(this.containment=null)},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"===a?1:-1,d=this._isRootNode(this.scrollParent[0]);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.offset.scroll.top:d?0:this.offset.scroll.top)*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.offset.scroll.left:d?0:this.offset.scroll.left)*c}},_generatePosition:function(a,b){var c,d,e,f,g=this.options,h=this._isRootNode(this.scrollParent[0]),i=a.pageX,j=a.pageY;return h&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),b&&(this.containment&&(this.relativeContainer?(d=this.relativeContainer.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,a.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),a.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),a.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),a.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f),"y"===g.axis&&(i=this.originalPageX),"x"===g.axis&&(j=this.originalPageY)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:h?0:this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:h?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d,this],!0),/^(drag|start|stop)/.test(b)&&(this.positionAbs=this._convertPositionTo("absolute"),d.offset=this.positionAbs),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c,d){var e=a.extend({},c,{item:d.element});d.sortables=[],a(d.options.connectToSortable).each(function(){var c=a(this).sortable("instance");c&&!c.options.disabled&&(d.sortables.push(c),c.refreshPositions(),c._trigger("activate",b,e))})},stop:function(b,c,d){var e=a.extend({},c,{item:d.element});d.cancelHelperRemoval=!1,a.each(d.sortables,function(){var a=this;a.isOver?(a.isOver=0,d.cancelHelperRemoval=!0,a.cancelHelperRemoval=!1,a._storedCSS={position:a.placeholder.css("position"),top:a.placeholder.css("top"),left:a.placeholder.css("left")},a._mouseStop(b),a.options.helper=a.options._helper):(a.cancelHelperRemoval=!0,a._trigger("deactivate",b,e))})},drag:function(b,c,d){a.each(d.sortables,function(){var e=!1,f=this;f.positionAbs=d.positionAbs,f.helperProportions=d.helperProportions,f.offset.click=d.offset.click,f._intersectsWith(f.containerCache)&&(e=!0,a.each(d.sortables,function(){return this.positionAbs=d.positionAbs,this.helperProportions=d.helperProportions,this.offset.click=d.offset.click,this!==f&&this._intersectsWith(this.containerCache)&&a.contains(f.element[0],this.element[0])&&(e=!1),e})),e?(f.isOver||(f.isOver=1,d._parent=c.helper.parent(),f.currentItem=c.helper.appendTo(f.element).data("ui-sortable-item",!0),f.options._helper=f.options.helper,f.options.helper=function(){return c.helper[0]},b.target=f.currentItem[0],f._mouseCapture(b,!0),f._mouseStart(b,!0,!0),f.offset.click.top=d.offset.click.top,f.offset.click.left=d.offset.click.left,f.offset.parent.left-=d.offset.parent.left-f.offset.parent.left,f.offset.parent.top-=d.offset.parent.top-f.offset.parent.top,d._trigger("toSortable",b),d.dropped=f.element,a.each(d.sortables,function(){this.refreshPositions()}),d.currentItem=d.element,f.fromOutside=d),f.currentItem&&(f._mouseDrag(b),c.position=f.position)):f.isOver&&(f.isOver=0,f.cancelHelperRemoval=!0,f.options._revert=f.options.revert,f.options.revert=!1,f._trigger("out",b,f._uiHash(f)),f._mouseStop(b,!0),f.options.revert=f.options._revert,f.options.helper=f.options._helper,f.placeholder&&f.placeholder.remove(),c.helper.appendTo(d._parent),d._refreshOffsets(b),c.position=d._generatePosition(b,!0),d._trigger("fromSortable",b),d.dropped=!1,a.each(d.sortables,function(){this.refreshPositions()}))})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c,d){var e=a("body"),f=d.options;e.css("cursor")&&(f._cursor=e.css("cursor")),e.css("cursor",f.cursor)},stop:function(b,c,d){var e=d.options;e._cursor&&a("body").css("cursor",e._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("opacity")&&(f._opacity=e.css("opacity")),e.css("opacity",f.opacity)},stop:function(b,c,d){var e=d.options;e._opacity&&a(c.helper).css("opacity",e._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(a,b,c){c.scrollParentNotHidden||(c.scrollParentNotHidden=c.helper.scrollParent(!1)),c.scrollParentNotHidden[0]!==c.document[0]&&"HTML"!==c.scrollParentNotHidden[0].tagName&&(c.overflowOffset=c.scrollParentNotHidden.offset())},drag:function(b,c,d){var e=d.options,f=!1,g=d.scrollParentNotHidden[0],h=d.document[0];g!==h&&"HTML"!==g.tagName?(e.axis&&"x"===e.axis||(d.overflowOffset.top+g.offsetHeight-b.pageY<e.scrollSensitivity?g.scrollTop=f=g.scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(g.scrollTop=f=g.scrollTop-e.scrollSpeed)),e.axis&&"y"===e.axis||(d.overflowOffset.left+g.offsetWidth-b.pageX<e.scrollSensitivity?g.scrollLeft=f=g.scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(g.scrollLeft=f=g.scrollLeft-e.scrollSpeed))):(e.axis&&"x"===e.axis||(b.pageY-a(h).scrollTop()<e.scrollSensitivity?f=a(h).scrollTop(a(h).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(h).scrollTop())<e.scrollSensitivity&&(f=a(h).scrollTop(a(h).scrollTop()+e.scrollSpeed))),e.axis&&"y"===e.axis||(b.pageX-a(h).scrollLeft()<e.scrollSensitivity?f=a(h).scrollLeft(a(h).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(h).scrollLeft())<e.scrollSensitivity&&(f=a(h).scrollLeft(a(h).scrollLeft()+e.scrollSpeed)))),f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c,d){var e=d.options;d.snapElements=[],a(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!==d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=d.options,p=o.snapTolerance,q=c.offset.left,r=q+d.helperProportions.width,s=c.offset.top,t=s+d.helperProportions.height;for(m=d.snapElements.length-1;m>=0;m--)i=d.snapElements[m].left-d.margins.left,j=i+d.snapElements[m].width,k=d.snapElements[m].top-d.margins.top,l=k+d.snapElements[m].height,r<i-p||q>j+p||t<k-p||s>l+p||!a.contains(d.snapElements[m].item.ownerDocument,d.snapElements[m].item)?(d.snapElements[m].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=!1):("inner"!==o.snapMode&&(e=Math.abs(k-t)<=p,f=Math.abs(l-s)<=p,g=Math.abs(i-r)<=p,h=Math.abs(j-q)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k-d.helperProportions.height,left:0}).top),f&&(c.position.top=d._convertPositionTo("relative",{top:l,left:0}).top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i-d.helperProportions.width}).left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j}).left)),n=e||f||g||h,"outer"!==o.snapMode&&(e=Math.abs(k-s)<=p,f=Math.abs(l-t)<=p,g=Math.abs(i-q)<=p,h=Math.abs(j-r)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k,left:0}).top),f&&(c.position.top=d._convertPositionTo("relative",{top:l-d.helperProportions.height,left:0}).top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i}).left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j-d.helperProportions.width}).left)),!d.snapElements[m].snapping&&(e||f||g||h||n)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=e||f||g||h||n)}}),a.ui.plugin.add("draggable","stack",{start:function(b,c,d){var e,f=d.options,g=a.makeArray(a(f.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});g.length&&(e=parseInt(a(g[0]).css("zIndex"),10)||0,a(g).each(function(b){a(this).css("zIndex",e+b)}),this.css("zIndex",e+g.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("zIndex")&&(f._zIndex=e.css("zIndex")),e.css("zIndex",f.zIndex)},stop:function(b,c,d){var e=d.options;e._zIndex&&a(c.helper).css("zIndex",e._zIndex)}});a.ui.draggable;a.widget("ui.resizable",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(a){return parseInt(a,10)||0},_isNumber:function(a){return!isNaN(parseInt(a,10))},_hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0||(b[d]=1,e=b[d]>0,b[d]=0,e)},_create:function(){var b,c,d,e,f,g=this,h=this.options;if(this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=h.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=a(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),b=this.handles.split(","),this.handles={},c=0;c<b.length;c++)d=a.trim(b[c]),f="ui-resizable-"+d,e=a("<div class='ui-resizable-handle "+f+"'></div>"),e.css({zIndex:h.zIndex}),"se"===d&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[d]=".ui-resizable-"+d,this.element.append(e);this._renderAxis=function(b){var c,d,e,f;b=b||this.element;for(c in this.handles)this.handles[c].constructor===String?this.handles[c]=this.element.children(this.handles[c]).first().show():(this.handles[c].jquery||this.handles[c].nodeType)&&(this.handles[c]=a(this.handles[c]),this._on(this.handles[c],{mousedown:g._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(d=a(this.handles[c],this.element),f=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(e,f),this._proportionallyResize()),this._handles=this._handles.add(this.handles[c])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){g.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),g.axis=e&&e[1]?e[1]:"se")}),h.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").mouseenter(function(){h.disabled||(a(this).removeClass("ui-resizable-autohide"),g._handles.show())}).mouseleave(function(){h.disabled||g.resizing||(a(this).addClass("ui-resizable-autohide"),g._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var b,c=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove()),this.originalElement.css("resize",this.originalResizeStyle),c(this.originalElement),this},_mouseCapture:function(b){var c,d,e=!1;for(c in this.handles)d=a(this.handles[c])[0],(d===b.target||a.contains(d,b.target))&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(b){var c,d,e,f=this.options,g=this.element;return this.resizing=!0,this._renderProxy(),c=this._num(this.helper.css("left")),d=this._num(this.helper.css("top")),f.containment&&(c+=a(f.containment).scrollLeft()||0,d+=a(f.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:c,top:d},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:g.width(),height:g.height()},this.originalSize=this._helper?{width:g.outerWidth(),height:g.outerHeight()}:{width:g.width(),height:g.height()},this.sizeDiff={width:g.outerWidth()-g.width(),height:g.outerHeight()-g.height()},this.originalPosition={left:c,top:d},this.originalMousePosition={left:b.pageX,top:b.pageY},this.aspectRatio="number"==typeof f.aspectRatio?f.aspectRatio:this.originalSize.width/this.originalSize.height||1,e=a(".ui-resizable-"+this.axis).css("cursor"),a("body").css("cursor","auto"===e?this.axis+"-resize":e),g.addClass("ui-resizable-resizing"),this._propagate("start",b),!0},_mouseDrag:function(b){var c,d,e=this.originalMousePosition,f=this.axis,g=b.pageX-e.left||0,h=b.pageY-e.top||0,i=this._change[f];return this._updatePrevProperties(),!!i&&(c=i.apply(this,[b,g,h]),this._updateVirtualBoundaries(b.shiftKey),(this._aspectRatio||b.shiftKey)&&(c=this._updateRatio(c,b)),c=this._respectSize(c,b),this._updateCache(c),this._propagate("resize",b),d=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),a.isEmptyObject(d)||(this._updatePrevProperties(),this._trigger("resize",b,this.ui()),this._applyChanges()),!1)},_mouseStop:function(b){this.resizing=!1;var c,d,e,f,g,h,i,j=this.options,k=this;return this._helper&&(c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),e=d&&this._hasScroll(c[0],"left")?0:k.sizeDiff.height,f=d?0:k.sizeDiff.width,g={width:k.helper.width()-f,height:k.helper.height()-e},h=parseInt(k.element.css("left"),10)+(k.position.left-k.originalPosition.left)||null,i=parseInt(k.element.css("top"),10)+(k.position.top-k.originalPosition.top)||null,j.animate||this.element.css(a.extend(g,{top:i,left:h})),k.helper.height(k.size.height),k.helper.width(k.size.width),this._helper&&!j.animate&&this._proportionallyResize()),a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var a={};return this.position.top!==this.prevPosition.top&&(a.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(a.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(a.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(a.height=this.size.height+"px"),this.helper.css(a),a},_updateVirtualBoundaries:function(a){var b,c,d,e,f,g=this.options;f={minWidth:this._isNumber(g.minWidth)?g.minWidth:0,maxWidth:this._isNumber(g.maxWidth)?g.maxWidth:1/0,minHeight:this._isNumber(g.minHeight)?g.minHeight:0,maxHeight:this._isNumber(g.maxHeight)?g.maxHeight:1/0},(this._aspectRatio||a)&&(b=f.minHeight*this.aspectRatio,d=f.minWidth/this.aspectRatio,c=f.maxHeight*this.aspectRatio,e=f.maxWidth/this.aspectRatio,b>f.minWidth&&(f.minWidth=b),d>f.minHeight&&(f.minHeight=d),c<f.maxWidth&&(f.maxWidth=c),e<f.maxHeight&&(f.maxHeight=e)),this._vBoundaries=f},_updateCache:function(a){this.offset=this.helper.offset(),this._isNumber(a.left)&&(this.position.left=a.left),this._isNumber(a.top)&&(this.position.top=a.top),this._isNumber(a.height)&&(this.size.height=a.height),this._isNumber(a.width)&&(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,c=this.size,d=this.axis;return this._isNumber(a.height)?a.width=a.height*this.aspectRatio:this._isNumber(a.width)&&(a.height=a.width/this.aspectRatio),"sw"===d&&(a.left=b.left+(c.width-a.width),a.top=null),"nw"===d&&(a.top=b.top+(c.height-a.height),a.left=b.left+(c.width-a.width)),a},_respectSize:function(a){var b=this._vBoundaries,c=this.axis,d=this._isNumber(a.width)&&b.maxWidth&&b.maxWidth<a.width,e=this._isNumber(a.height)&&b.maxHeight&&b.maxHeight<a.height,f=this._isNumber(a.width)&&b.minWidth&&b.minWidth>a.width,g=this._isNumber(a.height)&&b.minHeight&&b.minHeight>a.height,h=this.originalPosition.left+this.originalSize.width,i=this.position.top+this.size.height,j=/sw|nw|w/.test(c),k=/nw|ne|n/.test(c);return f&&(a.width=b.minWidth),g&&(a.height=b.minHeight),d&&(a.width=b.maxWidth),e&&(a.height=b.maxHeight),f&&j&&(a.left=h-b.minWidth),d&&j&&(a.left=h-b.maxWidth),g&&k&&(a.top=i-b.minHeight),e&&k&&(a.top=i-b.maxHeight),a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null,a},_getPaddingPlusBorderDimensions:function(a){for(var b=0,c=[],d=[a.css("borderTopWidth"),a.css("borderRightWidth"),a.css("borderBottomWidth"),a.css("borderLeftWidth")],e=[a.css("paddingTop"),a.css("paddingRight"),a.css("paddingBottom"),a.css("paddingLeft")];b<4;b++)c[b]=parseInt(d[b],10)||0,c[b]+=parseInt(e[b],10)||0;return{height:c[0]+c[2],width:c[1]+c[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var a,b=0,c=this.helper||this.element;b<this._proportionallyResizeElements.length;b++)a=this._proportionallyResizeElements[b],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(a)),
a.css({height:c.height()-this.outerDimensions.height||0,width:c.width()-this.outerDimensions.width||0})},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset(),this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){var c=this.originalSize,d=this.originalPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this.originalSize,e=this.originalPosition;return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"resize"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).resizable("instance"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&c._hasScroll(e[0],"left")?0:c.sizeDiff.height,h=f?0:c.sizeDiff.width,i={width:c.size.width-h,height:c.size.height-g},j=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,k=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(i,k&&j?{top:k,left:j}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),10)};e&&e.length&&a(e[0]).css({width:d.width,height:d.height}),c._updateCache(d),c._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(){var b,c,d,e,f,g,h,i=a(this).resizable("instance"),j=i.options,k=i.element,l=j.containment,m=l instanceof a?l.get(0):/parent/.test(l)?k.parent().get(0):l;m&&(i.containerElement=a(m),/document/.test(l)||l===document?(i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}):(b=a(m),c=[],a(["Top","Right","Left","Bottom"]).each(function(a,d){c[a]=i._num(b.css("padding"+d))}),i.containerOffset=b.offset(),i.containerPosition=b.position(),i.containerSize={height:b.innerHeight()-c[3],width:b.innerWidth()-c[1]},d=i.containerOffset,e=i.containerSize.height,f=i.containerSize.width,g=i._hasScroll(m,"left")?m.scrollWidth:f,h=i._hasScroll(m)?m.scrollHeight:e,i.parentData={element:m,left:d.left,top:d.top,width:g,height:h}))},resize:function(b){var c,d,e,f,g=a(this).resizable("instance"),h=g.options,i=g.containerOffset,j=g.position,k=g._aspectRatio||b.shiftKey,l={top:0,left:0},m=g.containerElement,n=!0;m[0]!==document&&/static/.test(m.css("position"))&&(l=i),j.left<(g._helper?i.left:0)&&(g.size.width=g.size.width+(g._helper?g.position.left-i.left:g.position.left-l.left),k&&(g.size.height=g.size.width/g.aspectRatio,n=!1),g.position.left=h.helper?i.left:0),j.top<(g._helper?i.top:0)&&(g.size.height=g.size.height+(g._helper?g.position.top-i.top:g.position.top),k&&(g.size.width=g.size.height*g.aspectRatio,n=!1),g.position.top=g._helper?i.top:0),e=g.containerElement.get(0)===g.element.parent().get(0),f=/relative|absolute/.test(g.containerElement.css("position")),e&&f?(g.offset.left=g.parentData.left+g.position.left,g.offset.top=g.parentData.top+g.position.top):(g.offset.left=g.element.offset().left,g.offset.top=g.element.offset().top),c=Math.abs(g.sizeDiff.width+(g._helper?g.offset.left-l.left:g.offset.left-i.left)),d=Math.abs(g.sizeDiff.height+(g._helper?g.offset.top-l.top:g.offset.top-i.top)),c+g.size.width>=g.parentData.width&&(g.size.width=g.parentData.width-c,k&&(g.size.height=g.size.width/g.aspectRatio,n=!1)),d+g.size.height>=g.parentData.height&&(g.size.height=g.parentData.height-d,k&&(g.size.width=g.size.height*g.aspectRatio,n=!1)),n||(g.position.left=g.prevPosition.left,g.position.top=g.prevPosition.top,g.size.width=g.prevSize.width,g.size.height=g.prevSize.height)},stop:function(){var b=a(this).resizable("instance"),c=b.options,d=b.containerOffset,e=b.containerPosition,f=b.containerElement,g=a(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,j=g.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j}),b._helper&&!c.animate&&/static/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j})}}),a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).resizable("instance"),c=b.options;a(c.alsoResize).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})},resize:function(b,c){var d=a(this).resizable("instance"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0};a(e.alsoResize).each(function(){var b=a(this),d=a(this).data("ui-resizable-alsoresize"),e={},f=b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(f,function(a,b){var c=(d[b]||0)+(h[b]||0);c&&c>=0&&(e[b]=c||null)}),b.css(e)})},stop:function(){a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).resizable("instance"),c=b.options,d=b.size;b.ghost=b.originalElement.clone(),b.ghost.css({opacity:.25,display:"block",position:"relative",height:d.height,width:d.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof c.ghost?c.ghost:""),b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).resizable("instance");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).resizable("instance");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(){var b,c=a(this).resizable("instance"),d=c.options,e=c.size,f=c.originalSize,g=c.originalPosition,h=c.axis,i="number"==typeof d.grid?[d.grid,d.grid]:d.grid,j=i[0]||1,k=i[1]||1,l=Math.round((e.width-f.width)/j)*j,m=Math.round((e.height-f.height)/k)*k,n=f.width+l,o=f.height+m,p=d.maxWidth&&d.maxWidth<n,q=d.maxHeight&&d.maxHeight<o,r=d.minWidth&&d.minWidth>n,s=d.minHeight&&d.minHeight>o;d.grid=i,r&&(n+=j),s&&(o+=k),p&&(n-=j),q&&(o-=k),/^(se|s|e)$/.test(h)?(c.size.width=n,c.size.height=o):/^(ne)$/.test(h)?(c.size.width=n,c.size.height=o,c.position.top=g.top-m):/^(sw)$/.test(h)?(c.size.width=n,c.size.height=o,c.position.left=g.left-l):((o-k<=0||n-j<=0)&&(b=c._getPaddingPlusBorderDimensions(this)),o-k>0?(c.size.height=o,c.position.top=g.top-m):(o=k-b.height,c.size.height=o,c.position.top=g.top+f.height-o),n-j>0?(c.size.width=n,c.position.left=g.left-l):(n=j-b.width,c.size.width=n,c.position.left=g.left+f.width-n))}});a.ui.resizable,a.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(b){var c=a(this).css(b).offset().top;c<0&&a(this).css("top",b.top-c)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&a.fn.draggable&&this._makeDraggable(),this.options.resizable&&a.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var b=this.options.appendTo;return b&&(b.jquery||b.nodeType)?a(b):this.document.find(b||"body").eq(0)},_destroy:function(){var a,b=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),a=b.parent.children().eq(b.index),a.length&&a[0]!==this.element[0]?a.before(this.element):b.parent.append(this.element)},widget:function(){return this.uiDialog},disable:a.noop,enable:a.noop,close:function(b){var c,d=this;if(this._isOpen&&this._trigger("beforeClose",b)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{c=this.document[0].activeElement,c&&"body"!==c.nodeName.toLowerCase()&&a(c).blur()}catch(a){}this._hide(this.uiDialog,this.options.hide,function(){d._trigger("close",b)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(b,c){var d=!1,e=this.uiDialog.siblings(".ui-front:visible").map(function(){return+a(this).css("z-index")}).get(),f=Math.max.apply(null,e);return f>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",f+1),d=!0),d&&!c&&this._trigger("focus",b),d},open:function(){var b=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=a(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){b._focusTabbable(),b._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var a=this._focusedElement;a||(a=this.element.find("[autofocus]")),a.length||(a=this.element.find(":tabbable")),a.length||(a=this.uiDialogButtonPane.find(":tabbable")),a.length||(a=this.uiDialogTitlebarClose.filter(":tabbable")),a.length||(a=this.uiDialog),a.eq(0).focus()},_keepFocus:function(b){function c(){var b=this.document[0].activeElement,c=this.uiDialog[0]===b||a.contains(this.uiDialog[0],b);c||this._focusTabbable()}b.preventDefault(),c.call(this),this._delay(c)},_createWrapper:function(){this.uiDialog=a("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(b){if(this.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE)return b.preventDefault(),void this.close(b);if(b.keyCode===a.ui.keyCode.TAB&&!b.isDefaultPrevented()){var c=this.uiDialog.find(":tabbable"),d=c.filter(":first"),e=c.filter(":last");b.target!==e[0]&&b.target!==this.uiDialog[0]||b.shiftKey?b.target!==d[0]&&b.target!==this.uiDialog[0]||!b.shiftKey||(this._delay(function(){e.focus()}),b.preventDefault()):(this._delay(function(){d.focus()}),b.preventDefault())}},mousedown:function(a){this._moveToTop(a)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var b;this.uiDialogTitlebar=a("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(b){a(b.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=a("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(a){a.preventDefault(),this.close(a)}}),b=a("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(b),this.uiDialog.attr({"aria-labelledby":b.attr("id")})},_title:function(a){this.options.title||a.html("&#160;"),a.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=a("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=a("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var b=this,c=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),a.isEmptyObject(c)||a.isArray(c)&&!c.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(a.each(c,function(c,d){var e,f;d=a.isFunction(d)?{click:d,text:c}:d,d=a.extend({type:"button"},d),e=d.click,d.click=function(){e.apply(b.element[0],arguments)},f={icons:d.icons,text:d.showText},delete d.icons,delete d.showText,a("<button></button>",d).button(f).appendTo(b.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var c=this,d=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,e){a(this).addClass("ui-dialog-dragging"),c._blockFrames(),c._trigger("dragStart",d,b(e))},drag:function(a,d){c._trigger("drag",a,b(d))},stop:function(e,f){var g=f.offset.left-c.document.scrollLeft(),h=f.offset.top-c.document.scrollTop();d.position={my:"left top",at:"left"+(g>=0?"+":"")+g+" top"+(h>=0?"+":"")+h,of:c.window},a(this).removeClass("ui-dialog-dragging"),c._unblockFrames(),c._trigger("dragStop",e,b(f))}})},_makeResizable:function(){function b(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}var c=this,d=this.options,e=d.resizable,f=this.uiDialog.css("position"),g="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:d.maxWidth,maxHeight:d.maxHeight,minWidth:d.minWidth,minHeight:this._minHeight(),handles:g,start:function(d,e){a(this).addClass("ui-dialog-resizing"),c._blockFrames(),c._trigger("resizeStart",d,b(e))},resize:function(a,d){c._trigger("resize",a,b(d))},stop:function(e,f){var g=c.uiDialog.offset(),h=g.left-c.document.scrollLeft(),i=g.top-c.document.scrollTop();d.height=c.uiDialog.height(),d.width=c.uiDialog.width(),d.position={my:"left top",at:"left"+(h>=0?"+":"")+h+" top"+(i>=0?"+":"")+i,of:c.window},a(this).removeClass("ui-dialog-resizing"),c._unblockFrames(),c._trigger("resizeStop",e,b(f))}}).css("position",f)},_trackFocus:function(){this._on(this.widget(),{focusin:function(b){this._makeFocusTarget(),this._focusedElement=a(b.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var b=this._trackingInstances(),c=a.inArray(this,b);c!==-1&&b.splice(c,1)},_trackingInstances:function(){var a=this.document.data("ui-dialog-instances");return a||(a=[],this.document.data("ui-dialog-instances",a)),a},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(){var a=this.uiDialog.is(":visible");a||this.uiDialog.show(),this.uiDialog.position(this.options.position),a||this.uiDialog.hide()},_setOptions:function(b){var c=this,d=!1,e={};a.each(b,function(a,b){c._setOption(a,b),a in c.sizeRelatedOptions&&(d=!0),a in c.resizableRelatedOptions&&(e[a]=b)}),d&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",e)},_setOption:function(a,b){var c,d,e=this.uiDialog;"dialogClass"===a&&e.removeClass(this.options.dialogClass).addClass(b),"disabled"!==a&&(this._super(a,b),"appendTo"===a&&this.uiDialog.appendTo(this._appendTo()),"buttons"===a&&this._createButtons(),"closeText"===a&&this.uiDialogTitlebarClose.button({label:""+b}),"draggable"===a&&(c=e.is(":data(ui-draggable)"),c&&!b&&e.draggable("destroy"),!c&&b&&this._makeDraggable()),"position"===a&&this._position(),"resizable"===a&&(d=e.is(":data(ui-resizable)"),d&&!b&&e.resizable("destroy"),d&&"string"==typeof b&&e.resizable("option","handles",b),d||b===!1||this._makeResizable()),"title"===a&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var a,b,c,d=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),d.minWidth>d.width&&(d.width=d.minWidth),a=this.uiDialog.css({height:"auto",width:d.width}).outerHeight(),b=Math.max(0,d.minHeight-a),c="number"==typeof d.maxHeight?Math.max(0,d.maxHeight-a):"none","auto"===d.height?this.element.css({minHeight:b,maxHeight:c,height:"auto"}):this.element.height(Math.max(0,d.height-a)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var b=a(this);return a("<div>").css({position:"absolute",width:b.outerWidth(),height:b.outerHeight()}).appendTo(b.parent()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(b){return!!a(b.target).closest(".ui-dialog").length||!!a(b.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var b=!0;this._delay(function(){b=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(a){b||this._allowInteraction(a)||(a.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=a("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var a=this.document.data("ui-dialog-overlays")-1;a?this.document.data("ui-dialog-overlays",a):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}});a.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b,c=this.options,d=c.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(d)?d:function(a){return a.is(d)},this.proportions=function(){return arguments.length?void(b=arguments[0]):b?b:b={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(c.scope),c.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(b){a.ui.ddmanager.droppables[b]=a.ui.ddmanager.droppables[b]||[],a.ui.ddmanager.droppables[b].push(this)},_splice:function(a){for(var b=0;b<a.length;b++)a[b]===this&&a.splice(b,1)},_destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];this._splice(b),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){if("accept"===b)this.accept=a.isFunction(c)?c:function(a){return a.is(c)};else if("scope"===b){var d=a.ui.ddmanager.droppables[this.options.scope];this._splice(d),this._addToManager(c)}this._super(b,c)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return!(!d||(d.currentItem||d.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var c=a(this).droppable("instance");if(c.options.greedy&&!c.options.disabled&&c.options.scope===d.options.scope&&c.accept.call(c.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(c,{offset:c.element.offset()}),c.options.tolerance,b))return e=!0,!1}),!e&&(!!this.accept.call(this.element[0],d.currentItem||d.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element)))},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(){function a(a,b,c){return a>=b&&a<b+c}return function(b,c,d,e){if(!c.offset)return!1;var f=(b.positionAbs||b.position.absolute).left+b.margins.left,g=(b.positionAbs||b.position.absolute).top+b.margins.top,h=f+b.helperProportions.width,i=g+b.helperProportions.height,j=c.offset.left,k=c.offset.top,l=j+c.proportions().width,m=k+c.proportions().height;switch(d){case"fit":return j<=f&&h<=l&&k<=g&&i<=m;case"intersect":return j<f+b.helperProportions.width/2&&h-b.helperProportions.width/2<l&&k<g+b.helperProportions.height/2&&i-b.helperProportions.height/2<m;case"pointer":return a(e.pageY,k,c.proportions().height)&&a(e.pageX,j,c.proportions().width);case"touch":return(g>=k&&g<=m||i>=k&&i<=m||g<k&&i>m)&&(f>=j&&f<=l||h>=j&&h<=l||f<j&&h>l);default:return!1}}}(),a.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;d<f.length;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){for(e=0;e<h.length;e++)if(h[e]===f[d].element[0]){f[d].proportions().height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions({width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight}))}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance,c)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance,c),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a(this).droppable("instance").options.scope===e}),f.length&&(d=a(f[0]).droppable("instance"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}};var s=(a.ui.droppable,"ui-effects-"),t=a;a.effects={effect:{}},function(a,b){function c(a,b,c){var d=l[b.type]||{};return null==a?c||!b.def?null:b.def:(a=d.floor?~~a:parseFloat(a),isNaN(a)?b.def:d.mod?(a+d.mod)%d.mod:0>a?0:d.max<a?d.max:a)}function d(b){var c=j(),d=c._rgba=[];return b=b.toLowerCase(),o(i,function(a,e){var f,g=e.re.exec(b),h=g&&e.parse(g),i=e.space||"rgba";if(h)return f=c[i](h),c[k[i].cache]=f[k[i].cache],d=c._rgba=f._rgba,!1}),d.length?("0,0,0,0"===d.join()&&a.extend(d,f.transparent),c):f[b]}function e(a,b,c){return c=(c+1)%1,6*c<1?a+(b-a)*c*6:2*c<1?b:3*c<2?a+(b-a)*(2/3-c)*6:a}var f,g="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",h=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],j=a.Color=function(b,c,d,e){return new a.Color.fn.parse(b,c,d,e)},k={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},l={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},m=j.support={},n=a("<p>")[0],o=a.each;n.style.cssText="background-color:rgba(1,1,1,.5)",m.rgba=n.style.backgroundColor.indexOf("rgba")>-1,o(k,function(a,b){b.cache="_"+a,b.props.alpha={idx:3,type:"percent",def:1}}),j.fn=a.extend(j.prototype,{parse:function(e,g,h,i){if(e===b)return this._rgba=[null,null,null,null],this;(e.jquery||e.nodeType)&&(e=a(e).css(g),g=b);var l=this,m=a.type(e),n=this._rgba=[];return g!==b&&(e=[e,g,h,i],m="array"),"string"===m?this.parse(d(e)||f._default):"array"===m?(o(k.rgba.props,function(a,b){n[b.idx]=c(e[b.idx],b)}),this):"object"===m?(e instanceof j?o(k,function(a,b){e[b.cache]&&(l[b.cache]=e[b.cache].slice())}):o(k,function(b,d){var f=d.cache;o(d.props,function(a,b){if(!l[f]&&d.to){if("alpha"===a||null==e[a])return;l[f]=d.to(l._rgba)}l[f][b.idx]=c(e[a],b,!0)}),l[f]&&a.inArray(null,l[f].slice(0,3))<0&&(l[f][3]=1,d.from&&(l._rgba=d.from(l[f])))}),this):void 0},is:function(a){var b=j(a),c=!0,d=this;return o(k,function(a,e){var f,g=b[e.cache];return g&&(f=d[e.cache]||e.to&&e.to(d._rgba)||[],o(e.props,function(a,b){if(null!=g[b.idx])return c=g[b.idx]===f[b.idx]})),c}),c},_space:function(){var a=[],b=this;return o(k,function(c,d){b[d.cache]&&a.push(c)}),a.pop()},transition:function(a,b){var d=j(a),e=d._space(),f=k[e],g=0===this.alpha()?j("transparent"):this,h=g[f.cache]||f.to(g._rgba),i=h.slice();return d=d[f.cache],o(f.props,function(a,e){var f=e.idx,g=h[f],j=d[f],k=l[e.type]||{};null!==j&&(null===g?i[f]=j:(k.mod&&(j-g>k.mod/2?g+=k.mod:g-j>k.mod/2&&(g-=k.mod)),i[f]=c((j-g)*b+g,e)))}),this[e](i)},blend:function(b){if(1===this._rgba[3])return this;var c=this._rgba.slice(),d=c.pop(),e=j(b)._rgba;return j(a.map(c,function(a,b){return(1-d)*e[b]+d*a}))},toRgbaString:function(){var b="rgba(",c=a.map(this._rgba,function(a,b){return null==a?b>2?1:0:a});return 1===c[3]&&(c.pop(),b="rgb("),b+c.join()+")"},toHslaString:function(){var b="hsla(",c=a.map(this.hsla(),function(a,b){return null==a&&(a=b>2?1:0),b&&b<3&&(a=Math.round(100*a)+"%"),a});return 1===c[3]&&(c.pop(),b="hsl("),b+c.join()+")"},toHexString:function(b){var c=this._rgba.slice(),d=c.pop();return b&&c.push(~~(255*d)),"#"+a.map(c,function(a){return a=(a||0).toString(16),1===a.length?"0"+a:a}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),j.fn.parse.prototype=j.fn,k.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b,c,d=a[0]/255,e=a[1]/255,f=a[2]/255,g=a[3],h=Math.max(d,e,f),i=Math.min(d,e,f),j=h-i,k=h+i,l=.5*k;return b=i===h?0:d===h?60*(e-f)/j+360:e===h?60*(f-d)/j+120:60*(d-e)/j+240,c=0===j?0:l<=.5?j/k:j/(2-k),[Math.round(b)%360,c,l,null==g?1:g]},k.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/360,c=a[1],d=a[2],f=a[3],g=d<=.5?d*(1+c):d+c-d*c,h=2*d-g;return[Math.round(255*e(h,g,b+1/3)),Math.round(255*e(h,g,b)),Math.round(255*e(h,g,b-1/3)),f]},o(k,function(d,e){var f=e.props,g=e.cache,i=e.to,k=e.from;j.fn[d]=function(d){if(i&&!this[g]&&(this[g]=i(this._rgba)),d===b)return this[g].slice();var e,h=a.type(d),l="array"===h||"object"===h?d:arguments,m=this[g].slice();return o(f,function(a,b){var d=l["object"===h?a:b.idx];null==d&&(d=m[b.idx]),m[b.idx]=c(d,b)}),k?(e=j(k(m)),e[g]=m,e):j(m)},o(f,function(b,c){j.fn[b]||(j.fn[b]=function(e){var f,g=a.type(e),i="alpha"===b?this._hsla?"hsla":"rgba":d,j=this[i](),k=j[c.idx];return"undefined"===g?k:("function"===g&&(e=e.call(this,k),g=a.type(e)),null==e&&c.empty?this:("string"===g&&(f=h.exec(e),f&&(e=k+parseFloat(f[2])*("+"===f[1]?1:-1))),j[c.idx]=e,this[i](j)))})})}),j.hook=function(b){var c=b.split(" ");o(c,function(b,c){a.cssHooks[c]={set:function(b,e){var f,g,h="";if("transparent"!==e&&("string"!==a.type(e)||(f=d(e)))){if(e=j(f||e),!m.rgba&&1!==e._rgba[3]){for(g="backgroundColor"===c?b.parentNode:b;(""===h||"transparent"===h)&&g&&g.style;)try{h=a.css(g,"backgroundColor"),g=g.parentNode}catch(a){}e=e.blend(h&&"transparent"!==h?h:"_default")}e=e.toRgbaString()}try{b.style[c]=e}catch(a){}}},a.fx.step[c]=function(b){b.colorInit||(b.start=j(b.elem,c),b.end=j(b.end),b.colorInit=!0),a.cssHooks[c].set(b.elem,b.start.transition(b.end,b.pos))}})},j.hook(g),a.cssHooks.borderColor={expand:function(a){var b={};return o(["Top","Right","Bottom","Left"],function(c,d){b["border"+d+"Color"]=a}),b}},f=a.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],
_default:"#ffffff"}}(t),function(){function b(b){var c,d,e=b.ownerDocument.defaultView?b.ownerDocument.defaultView.getComputedStyle(b,null):b.currentStyle,f={};if(e&&e.length&&e[0]&&e[e[0]])for(d=e.length;d--;)c=e[d],"string"==typeof e[c]&&(f[a.camelCase(c)]=e[c]);else for(c in e)"string"==typeof e[c]&&(f[c]=e[c]);return f}function c(b,c){var d,f,g={};for(d in c)f=c[d],b[d]!==f&&(e[d]||!a.fx.step[d]&&isNaN(parseFloat(f))||(g[d]=f));return g}var d=["add","remove","toggle"],e={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(b,c){a.fx.step[c]=function(a){("none"!==a.end&&!a.setAttr||1===a.pos&&!a.setAttr)&&(t.style(a.elem,c,a.end),a.setAttr=!0)}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a.effects.animateClass=function(e,f,g,h){var i=a.speed(f,g,h);return this.queue(function(){var f,g=a(this),h=g.attr("class")||"",j=i.children?g.find("*").addBack():g;j=j.map(function(){var c=a(this);return{el:c,start:b(this)}}),f=function(){a.each(d,function(a,b){e[b]&&g[b+"Class"](e[b])})},f(),j=j.map(function(){return this.end=b(this.el[0]),this.diff=c(this.start,this.end),this}),g.attr("class",h),j=j.map(function(){var b=this,c=a.Deferred(),d=a.extend({},i,{queue:!1,complete:function(){c.resolve(b)}});return this.el.animate(this.diff,d),c.promise()}),a.when.apply(a,j.get()).done(function(){f(),a.each(arguments,function(){var b=this.el;a.each(this.diff,function(a){b.css(a,"")})}),i.complete.call(g[0])})})},a.fn.extend({addClass:function(b){return function(c,d,e,f){return d?a.effects.animateClass.call(this,{add:c},d,e,f):b.apply(this,arguments)}}(a.fn.addClass),removeClass:function(b){return function(c,d,e,f){return arguments.length>1?a.effects.animateClass.call(this,{remove:c},d,e,f):b.apply(this,arguments)}}(a.fn.removeClass),toggleClass:function(b){return function(c,d,e,f,g){return"boolean"==typeof d||void 0===d?e?a.effects.animateClass.call(this,d?{add:c}:{remove:c},e,f,g):b.apply(this,arguments):a.effects.animateClass.call(this,{toggle:c},d,e,f)}}(a.fn.toggleClass),switchClass:function(b,c,d,e,f){return a.effects.animateClass.call(this,{add:c,remove:b},d,e,f)}})}(),function(){function b(b,c,d,e){return a.isPlainObject(b)&&(c=b,b=b.effect),b={effect:b},null==c&&(c={}),a.isFunction(c)&&(e=c,d=null,c={}),("number"==typeof c||a.fx.speeds[c])&&(e=d,d=c,c={}),a.isFunction(d)&&(e=d,d=null),c&&a.extend(b,c),d=d||c.duration,b.duration=a.fx.off?0:"number"==typeof d?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default,b.complete=e||c.complete,b}function c(b){return!(b&&"number"!=typeof b&&!a.fx.speeds[b])||("string"==typeof b&&!a.effects.effect[b]||(!!a.isFunction(b)||"object"==typeof b&&!b.effect))}a.extend(a.effects,{version:"1.11.4",save:function(a,b){for(var c=0;c<b.length;c++)null!==b[c]&&a.data(s+b[c],a[0].style[b[c]])},restore:function(a,b){var c,d;for(d=0;d<b.length;d++)null!==b[d]&&(c=a.data(s+b[d]),void 0===c&&(c=""),a.css(b[d],c))},setMode:function(a,b){return"toggle"===b&&(b=a.is(":hidden")?"show":"hide"),b},getBaseline:function(a,b){var c,d;switch(a[0]){case"top":c=0;break;case"middle":c=.5;break;case"bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case"left":d=0;break;case"center":d=.5;break;case"right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),float:b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),e={width:b.width(),height:b.height()},f=document.activeElement;try{f.id}catch(a){f=document.body}return b.wrap(d),(b[0]===f||a.contains(b[0],f))&&a(f).focus(),d=b.parent(),"static"===b.css("position")?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,d){c[d]=b.css(d),isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),b.css(e),d.css(c).show()},removeWrapper:function(b){var c=document.activeElement;return b.parent().is(".ui-effects-wrapper")&&(b.parent().replaceWith(b),(b[0]===c||a.contains(b[0],c))&&a(c).focus()),b},setTransition:function(b,c,d,e){return e=e||{},a.each(c,function(a,c){var f=b.cssUnit(c);f[0]>0&&(e[c]=f[0]*d+f[1])}),e}}),a.fn.extend({effect:function(){function c(b){function c(){a.isFunction(f)&&f.call(e[0]),a.isFunction(b)&&b()}var e=a(this),f=d.complete,h=d.mode;(e.is(":hidden")?"hide"===h:"show"===h)?(e[h](),c()):g.call(e[0],d,c)}var d=b.apply(this,arguments),e=d.mode,f=d.queue,g=a.effects.effect[d.effect];return a.fx.off||!g?e?this[e](d.duration,d.complete):this.each(function(){d.complete&&d.complete.call(this)}):f===!1?this.each(c):this.queue(f||"fx",c)},show:function(a){return function(d){if(c(d))return a.apply(this,arguments);var e=b.apply(this,arguments);return e.mode="show",this.effect.call(this,e)}}(a.fn.show),hide:function(a){return function(d){if(c(d))return a.apply(this,arguments);var e=b.apply(this,arguments);return e.mode="hide",this.effect.call(this,e)}}(a.fn.hide),toggle:function(a){return function(d){if(c(d)||"boolean"==typeof d)return a.apply(this,arguments);var e=b.apply(this,arguments);return e.mode="toggle",this.effect.call(this,e)}}(a.fn.toggle),cssUnit:function(b){var c=this.css(b),d=[];return a.each(["em","px","%","pt"],function(a,b){c.indexOf(b)>0&&(d=[parseFloat(c),b])}),d}})}(),function(){var b={};a.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,c){b[c]=function(b){return Math.pow(b,a+2)}}),a.extend(b,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){for(var b,c=4;a<((b=Math.pow(2,--c))-1)/11;);return 1/Math.pow(4,3-c)-7.5625*Math.pow((3*b-2)/22-a,2)}}),a.each(b,function(b,c){a.easing["easeIn"+b]=c,a.easing["easeOut"+b]=function(a){return 1-c(1-a)},a.easing["easeInOut"+b]=function(a){return a<.5?c(2*a)/2:1-c(a*-2+2)/2}})}();a.effects,a.effects.effect.blind=function(b,c){var d,e,f,g=a(this),h=/up|down|vertical/,i=/up|left|vertical|horizontal/,j=["position","top","bottom","left","right","height","width"],k=a.effects.setMode(g,b.mode||"hide"),l=b.direction||"up",m=h.test(l),n=m?"height":"width",o=m?"top":"left",p=i.test(l),q={},r="show"===k;g.parent().is(".ui-effects-wrapper")?a.effects.save(g.parent(),j):a.effects.save(g,j),g.show(),d=a.effects.createWrapper(g).css({overflow:"hidden"}),e=d[n](),f=parseFloat(d.css(o))||0,q[n]=r?e:0,p||(g.css(m?"bottom":"right",0).css(m?"top":"left","auto").css({position:"absolute"}),q[o]=r?f:e+f),r&&(d.css(n,0),p||d.css(o,f+e)),d.animate(q,{duration:b.duration,easing:b.easing,queue:!1,complete:function(){"hide"===k&&g.hide(),a.effects.restore(g,j),a.effects.removeWrapper(g),c()}})},a.effects.effect.bounce=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","height","width"],i=a.effects.setMode(g,b.mode||"effect"),j="hide"===i,k="show"===i,l=b.direction||"up",m=b.distance,n=b.times||5,o=2*n+(k||j?1:0),p=b.duration/o,q=b.easing,r="up"===l||"down"===l?"top":"left",s="up"===l||"left"===l,t=g.queue(),u=t.length;for((k||j)&&h.push("opacity"),a.effects.save(g,h),g.show(),a.effects.createWrapper(g),m||(m=g["top"===r?"outerHeight":"outerWidth"]()/3),k&&(f={opacity:1},f[r]=0,g.css("opacity",0).css(r,s?2*-m:2*m).animate(f,p,q)),j&&(m/=Math.pow(2,n-1)),f={},f[r]=0,d=0;d<n;d++)e={},e[r]=(s?"-=":"+=")+m,g.animate(e,p,q).animate(f,p,q),m=j?2*m:m/2;j&&(e={opacity:0},e[r]=(s?"-=":"+=")+m,g.animate(e,p,q)),g.queue(function(){j&&g.hide(),a.effects.restore(g,h),a.effects.removeWrapper(g),c()}),u>1&&t.splice.apply(t,[1,0].concat(t.splice(u,o+1))),g.dequeue()},a.effects.effect.clip=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","height","width"],i=a.effects.setMode(g,b.mode||"hide"),j="show"===i,k=b.direction||"vertical",l="vertical"===k,m=l?"height":"width",n=l?"top":"left",o={};a.effects.save(g,h),g.show(),d=a.effects.createWrapper(g).css({overflow:"hidden"}),e="IMG"===g[0].tagName?d:g,f=e[m](),j&&(e.css(m,0),e.css(n,f/2)),o[m]=j?f:0,o[n]=j?0:f/2,e.animate(o,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){j||g.hide(),a.effects.restore(g,h),a.effects.removeWrapper(g),c()}})},a.effects.effect.drop=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","opacity","height","width"],g=a.effects.setMode(e,b.mode||"hide"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i?"pos":"neg",l={opacity:h?1:0};a.effects.save(e,f),e.show(),a.effects.createWrapper(e),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0)/2,h&&e.css("opacity",0).css(j,"pos"===k?-d:d),l[j]=(h?"pos"===k?"+=":"-=":"pos"===k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})},a.effects.effect.explode=function(b,c){function d(){t.push(this),t.length===l*m&&e()}function e(){n.css({visibility:"visible"}),a(t).remove(),p||n.hide(),c()}var f,g,h,i,j,k,l=b.pieces?Math.round(Math.sqrt(b.pieces)):3,m=l,n=a(this),o=a.effects.setMode(n,b.mode||"hide"),p="show"===o,q=n.show().css("visibility","hidden").offset(),r=Math.ceil(n.outerWidth()/m),s=Math.ceil(n.outerHeight()/l),t=[];for(f=0;f<l;f++)for(i=q.top+f*s,k=f-(l-1)/2,g=0;g<m;g++)h=q.left+g*r,j=g-(m-1)/2,n.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-g*r,top:-f*s}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:r,height:s,left:h+(p?j*r:0),top:i+(p?k*s:0),opacity:p?0:1}).animate({left:h+(p?0:j*r),top:i+(p?0:k*s),opacity:p?1:0},b.duration||500,b.easing,d)},a.effects.effect.fade=function(b,c){var d=a(this),e=a.effects.setMode(d,b.mode||"toggle");d.animate({opacity:e},{queue:!1,duration:b.duration,easing:b.easing,complete:c})},a.effects.effect.fold=function(b,c){var d,e,f=a(this),g=["position","top","bottom","left","right","height","width"],h=a.effects.setMode(f,b.mode||"hide"),i="show"===h,j="hide"===h,k=b.size||15,l=/([0-9]+)%/.exec(k),m=!!b.horizFirst,n=i!==m,o=n?["width","height"]:["height","width"],p=b.duration/2,q={},r={};a.effects.save(f,g),f.show(),d=a.effects.createWrapper(f).css({overflow:"hidden"}),e=n?[d.width(),d.height()]:[d.height(),d.width()],l&&(k=parseInt(l[1],10)/100*e[j?0:1]),i&&d.css(m?{height:0,width:k}:{height:k,width:0}),q[o[0]]=i?e[0]:k,r[o[1]]=i?e[1]:0,d.animate(q,p,b.easing).animate(r,p,b.easing,function(){j&&f.hide(),a.effects.restore(f,g),a.effects.removeWrapper(f),c()})},a.effects.effect.highlight=function(b,c){var d=a(this),e=["backgroundImage","backgroundColor","opacity"],f=a.effects.setMode(d,b.mode||"show"),g={backgroundColor:d.css("backgroundColor")};"hide"===f&&(g.opacity=0),a.effects.save(d,e),d.show().css({backgroundImage:"none",backgroundColor:b.color||"#ffff99"}).animate(g,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===f&&d.hide(),a.effects.restore(d,e),c()}})},a.effects.effect.size=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","width","height","overflow","opacity"],i=["position","top","bottom","left","right","overflow","opacity"],j=["width","height","overflow"],k=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],m=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],n=a.effects.setMode(g,b.mode||"effect"),o=b.restore||"effect"!==n,p=b.scale||"both",q=b.origin||["middle","center"],r=g.css("position"),s=o?h:i,t={height:0,width:0,outerHeight:0,outerWidth:0};"show"===n&&g.show(),d={height:g.height(),width:g.width(),outerHeight:g.outerHeight(),outerWidth:g.outerWidth()},"toggle"===b.mode&&"show"===n?(g.from=b.to||t,g.to=b.from||d):(g.from=b.from||("show"===n?t:d),g.to=b.to||("hide"===n?t:d)),f={from:{y:g.from.height/d.height,x:g.from.width/d.width},to:{y:g.to.height/d.height,x:g.to.width/d.width}},"box"!==p&&"both"!==p||(f.from.y!==f.to.y&&(s=s.concat(l),g.from=a.effects.setTransition(g,l,f.from.y,g.from),g.to=a.effects.setTransition(g,l,f.to.y,g.to)),f.from.x!==f.to.x&&(s=s.concat(m),g.from=a.effects.setTransition(g,m,f.from.x,g.from),g.to=a.effects.setTransition(g,m,f.to.x,g.to))),"content"!==p&&"both"!==p||f.from.y!==f.to.y&&(s=s.concat(k).concat(j),g.from=a.effects.setTransition(g,k,f.from.y,g.from),g.to=a.effects.setTransition(g,k,f.to.y,g.to)),a.effects.save(g,s),g.show(),a.effects.createWrapper(g),g.css("overflow","hidden").css(g.from),q&&(e=a.effects.getBaseline(q,d),g.from.top=(d.outerHeight-g.outerHeight())*e.y,g.from.left=(d.outerWidth-g.outerWidth())*e.x,g.to.top=(d.outerHeight-g.to.outerHeight)*e.y,g.to.left=(d.outerWidth-g.to.outerWidth)*e.x),g.css(g.from),"content"!==p&&"both"!==p||(l=l.concat(["marginTop","marginBottom"]).concat(k),m=m.concat(["marginLeft","marginRight"]),j=h.concat(l).concat(m),g.find("*[width]").each(function(){var c=a(this),d={height:c.height(),width:c.width(),outerHeight:c.outerHeight(),outerWidth:c.outerWidth()};o&&a.effects.save(c,j),c.from={height:d.height*f.from.y,width:d.width*f.from.x,outerHeight:d.outerHeight*f.from.y,outerWidth:d.outerWidth*f.from.x},c.to={height:d.height*f.to.y,width:d.width*f.to.x,outerHeight:d.height*f.to.y,outerWidth:d.width*f.to.x},f.from.y!==f.to.y&&(c.from=a.effects.setTransition(c,l,f.from.y,c.from),c.to=a.effects.setTransition(c,l,f.to.y,c.to)),f.from.x!==f.to.x&&(c.from=a.effects.setTransition(c,m,f.from.x,c.from),c.to=a.effects.setTransition(c,m,f.to.x,c.to)),c.css(c.from),c.animate(c.to,b.duration,b.easing,function(){o&&a.effects.restore(c,j)})})),g.animate(g.to,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){0===g.to.opacity&&g.css("opacity",g.from.opacity),"hide"===n&&g.hide(),a.effects.restore(g,s),o||("static"===r?g.css({position:"relative",top:g.to.top,left:g.to.left}):a.each(["top","left"],function(a,b){g.css(b,function(b,c){var d=parseInt(c,10),e=a?g.to.left:g.to.top;return"auto"===c?e+"px":d+e+"px"})})),a.effects.removeWrapper(g),c()}})},a.effects.effect.scale=function(b,c){var d=a(this),e=a.extend(!0,{},b),f=a.effects.setMode(d,b.mode||"effect"),g=parseInt(b.percent,10)||(0===parseInt(b.percent,10)?0:"hide"===f?0:100),h=b.direction||"both",i=b.origin,j={height:d.height(),width:d.width(),outerHeight:d.outerHeight(),outerWidth:d.outerWidth()},k={y:"horizontal"!==h?g/100:1,x:"vertical"!==h?g/100:1};e.effect="size",e.queue=!1,e.complete=c,"effect"!==f&&(e.origin=i||["middle","center"],e.restore=!0),e.from=b.from||("show"===f?{height:0,width:0,outerHeight:0,outerWidth:0}:j),e.to={height:j.height*k.y,width:j.width*k.x,outerHeight:j.outerHeight*k.y,outerWidth:j.outerWidth*k.x},e.fade&&("show"===f&&(e.from.opacity=0,e.to.opacity=1),"hide"===f&&(e.from.opacity=1,e.to.opacity=0)),d.effect(e)},a.effects.effect.puff=function(b,c){var d=a(this),e=a.effects.setMode(d,b.mode||"hide"),f="hide"===e,g=parseInt(b.percent,10)||150,h=g/100,i={height:d.height(),width:d.width(),outerHeight:d.outerHeight(),outerWidth:d.outerWidth()};a.extend(b,{effect:"scale",queue:!1,fade:!0,mode:e,complete:c,percent:f?g:100,from:f?i:{height:i.height*h,width:i.width*h,outerHeight:i.outerHeight*h,outerWidth:i.outerWidth*h}}),d.effect(b)},a.effects.effect.pulsate=function(b,c){var d,e=a(this),f=a.effects.setMode(e,b.mode||"show"),g="show"===f,h="hide"===f,i=g||"hide"===f,j=2*(b.times||5)+(i?1:0),k=b.duration/j,l=0,m=e.queue(),n=m.length;for(!g&&e.is(":visible")||(e.css("opacity",0).show(),l=1),d=1;d<j;d++)e.animate({opacity:l},k,b.easing),l=1-l;e.animate({opacity:l},k,b.easing),e.queue(function(){h&&e.hide(),c()}),n>1&&m.splice.apply(m,[1,0].concat(m.splice(n,j+1))),e.dequeue()},a.effects.effect.shake=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","height","width"],g=a.effects.setMode(e,b.mode||"effect"),h=b.direction||"left",i=b.distance||20,j=b.times||3,k=2*j+1,l=Math.round(b.duration/k),m="up"===h||"down"===h?"top":"left",n="up"===h||"left"===h,o={},p={},q={},r=e.queue(),s=r.length;for(a.effects.save(e,f),e.show(),a.effects.createWrapper(e),o[m]=(n?"-=":"+=")+i,p[m]=(n?"+=":"-=")+2*i,q[m]=(n?"-=":"+=")+2*i,e.animate(o,l,b.easing),d=1;d<j;d++)e.animate(p,l,b.easing).animate(q,l,b.easing);e.animate(p,l,b.easing).animate(o,l/2,b.easing).queue(function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}),s>1&&r.splice.apply(r,[1,0].concat(r.splice(s,k+1))),e.dequeue()},a.effects.effect.slide=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","width","height"],g=a.effects.setMode(e,b.mode||"show"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i,l={};a.effects.save(e,f),e.show(),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0),a.effects.createWrapper(e).css({overflow:"hidden"}),h&&e.css(j,k?isNaN(d)?"-"+d:-d:d),l[j]=(h?k?"+=":"-=":k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})},a.effects.effect.transfer=function(b,c){var d=a(this),e=a(b.to),f="fixed"===e.css("position"),g=a("body"),h=f?g.scrollTop():0,i=f?g.scrollLeft():0,j=e.offset(),k={top:j.top-h,left:j.left-i,height:e.innerHeight(),width:e.innerWidth()},l=d.offset(),m=a("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(b.className).css({top:l.top-h,left:l.left-i,height:d.innerHeight(),width:d.innerWidth(),position:f?"fixed":"absolute"}).animate(k,b.duration,b.easing,function(){m.remove(),c()})},a.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=a("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(a){return void 0===a?this.options.value:(this.options.value=this._constrainedValue(a),void this._refreshValue())},_constrainedValue:function(a){return void 0===a&&(a=this.options.value),this.indeterminate=a===!1,"number"!=typeof a&&(a=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,a))},_setOptions:function(a){var b=a.value;delete a.value,this._super(a),this.options.value=this._constrainedValue(b),this._refreshValue()},_setOption:function(a,b){"max"===a&&(b=Math.max(this.min,b)),"disabled"===a&&this.element.toggleClass("ui-state-disabled",!!b).attr("aria-disabled",b),this._super(a,b)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var b=this.options.value,c=this._percentage();this.valueDiv.toggle(this.indeterminate||b>this.min).toggleClass("ui-corner-right",b===this.options.max).width(c.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=a("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":b}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==b&&(this.oldValue=b,this._trigger("change")),b===this.options.max&&this._trigger("complete")}}),a.widget("ui.selectable",a.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var b,c=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){b=a(c.options.filter,c.element[0]),b.addClass("ui-selectee"),b.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=b.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(b){var c=this,d=this.options;this.opos=[b.pageX,b.pageY],this.options.disabled||(this.selectees=a(d.filter,this.element[0]),this._trigger("start",b),a(d.appendTo).append(this.helper),this.helper.css({left:b.pageX,top:b.pageY,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,b.metaKey||b.ctrlKey||(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().addBack().each(function(){var d,e=a.data(this,"selectable-item");if(e)return d=!b.metaKey&&!b.ctrlKey||!e.$element.hasClass("ui-selected"),e.$element.removeClass(d?"ui-unselecting":"ui-selected").addClass(d?"ui-selecting":"ui-unselecting"),e.unselecting=!d,e.selecting=d,e.selected=d,d?c._trigger("selecting",b,{selecting:e.element}):c._trigger("unselecting",b,{unselecting:e.element}),!1}))},_mouseDrag:function(b){if(this.dragged=!0,!this.options.disabled){var c,d=this,e=this.options,f=this.opos[0],g=this.opos[1],h=b.pageX,i=b.pageY;return f>h&&(c=h,h=f,f=c),g>i&&(c=i,i=g,g=c),this.helper.css({left:f,top:g,width:h-f,height:i-g}),this.selectees.each(function(){var c=a.data(this,"selectable-item"),j=!1;c&&c.element!==d.element[0]&&("touch"===e.tolerance?j=!(c.left>h||c.right<f||c.top>i||c.bottom<g):"fit"===e.tolerance&&(j=c.left>f&&c.right<h&&c.top>g&&c.bottom<i),j?(c.selected&&(c.$element.removeClass("ui-selected"),c.selected=!1),c.unselecting&&(c.$element.removeClass("ui-unselecting"),c.unselecting=!1),c.selecting||(c.$element.addClass("ui-selecting"),c.selecting=!0,d._trigger("selecting",b,{selecting:c.element}))):(c.selecting&&((b.metaKey||b.ctrlKey)&&c.startselected?(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.$element.addClass("ui-selected"),c.selected=!0):(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.startselected&&(c.$element.addClass("ui-unselecting"),c.unselecting=!0),d._trigger("unselecting",b,{unselecting:c.element}))),c.selected&&(b.metaKey||b.ctrlKey||c.startselected||(c.$element.removeClass("ui-selected"),c.selected=!1,c.$element.addClass("ui-unselecting"),c.unselecting=!0,d._trigger("unselecting",b,{unselecting:c.element})))))}),!1}},_mouseStop:function(b){var c=this;return this.dragged=!1,a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove(),!1}}),a.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var a=this.element.uniqueId().attr("id");this.ids={element:a,button:a+"-button",menu:a+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var b=this;this.label=a("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(a){this.button.focus(),a.preventDefault()}}),this.element.hide(),this.button=a("<span>",{class:"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),a("<span>",{class:"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=a("<span>",{class:"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){b.menuItems||b._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var b=this;this.menu=a("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=a("<div>",{class:"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(a,c){a.preventDefault(),b._setSelection(),b._select(c.item.data("ui-selectmenu-item"),a)},focus:function(a,c){var d=c.item.data("ui-selectmenu-item");null!=b.focusIndex&&d.index!==b.focusIndex&&(b._trigger("focus",a,{item:d}),b.isOpen||b._select(d,a)),b.focusIndex=d.index,b.button.attr("aria-activedescendant",b.menuItems.eq(d.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var a,b=this.element.find("option");b.length&&(this._parseOptions(b),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),a=this._getSelectedItem(),this.menuInstance.focus(null,a),this._setAria(a.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(a){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",a))},_position:function(){this.menuWrap.position(a.extend({of:this.button},this.options.position))},close:function(a){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",a))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(b,c){var d=this,e="";a.each(c,function(c,f){f.optgroup!==e&&(a("<li>",{class:"ui-selectmenu-optgroup ui-menu-divider"+(f.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:f.optgroup}).appendTo(b),e=f.optgroup),d._renderItemData(b,f)})},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-selectmenu-item",b)},_renderItem:function(b,c){var d=a("<li>");return c.disabled&&d.addClass("ui-state-disabled"),this._setText(d,c.label),d.appendTo(b)},_setText:function(a,b){b?a.text(b):a.html("&#160;")},_move:function(a,b){var c,d,e=".ui-menu-item";this.isOpen?c=this.menuItems.eq(this.focusIndex):(c=this.menuItems.eq(this.element[0].selectedIndex),e+=":not(.ui-state-disabled)"),d="first"===a||"last"===a?c["first"===a?"prevAll":"nextAll"](e).eq(-1):c[a+"All"](e).eq(0),d.length&&this.menuInstance.focus(b,d)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(a){this[this.isOpen?"close":"open"](a)},_setSelection:function(){var a;this.range&&(window.getSelection?(a=window.getSelection(),a.removeAllRanges(),a.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(b){this.isOpen&&(a(b.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(b))}},_buttonEvents:{mousedown:function(){var a;window.getSelection?(a=window.getSelection(),a.rangeCount&&(this.range=a.getRangeAt(0))):this.range=document.selection.createRange()},click:function(a){this._setSelection(),this._toggle(a)},keydown:function(b){var c=!0;switch(b.keyCode){case a.ui.keyCode.TAB:case a.ui.keyCode.ESCAPE:this.close(b),c=!1;break;case a.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(b);break;case a.ui.keyCode.UP:b.altKey?this._toggle(b):this._move("prev",b);break;case a.ui.keyCode.DOWN:b.altKey?this._toggle(b):this._move("next",b);break;case a.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(b):this._toggle(b);break;case a.ui.keyCode.LEFT:this._move("prev",b);break;case a.ui.keyCode.RIGHT:this._move("next",b);break;case a.ui.keyCode.HOME:case a.ui.keyCode.PAGE_UP:this._move("first",b);break;case a.ui.keyCode.END:case a.ui.keyCode.PAGE_DOWN:this._move("last",b);break;default:this.menu.trigger(b),c=!1}c&&b.preventDefault()}},_selectFocusedItem:function(a){var b=this.menuItems.eq(this.focusIndex);b.hasClass("ui-state-disabled")||this._select(b.data("ui-selectmenu-item"),a)},_select:function(a,b){var c=this.element[0].selectedIndex;this.element[0].selectedIndex=a.index,this._setText(this.buttonText,a.label),this._setAria(a),this._trigger("select",b,{item:a}),a.index!==c&&this._trigger("change",b,{item:a}),this.close(b)},_setAria:function(a){var b=this.menuItems.eq(a.index).attr("id");this.button.attr({"aria-labelledby":b,"aria-activedescendant":b}),this.menu.attr("aria-activedescendant",b)},_setOption:function(a,b){"icons"===a&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(b.button),this._super(a,b),"appendTo"===a&&this.menuWrap.appendTo(this._appendTo()),"disabled"===a&&(this.menuInstance.option("disabled",b),this.button.toggleClass("ui-state-disabled",b).attr("aria-disabled",b),this.element.prop("disabled",b),b?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===a&&this._resizeButton()},_appendTo:function(){var b=this.options.appendTo;return b&&(b=b.jquery||b.nodeType?a(b):this.document.find(b).eq(0)),b&&b[0]||(b=this.element.closest(".ui-front")),b.length||(b=this.document[0].body),b},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var a=this.options.width;a||(a=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(a)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(b){var c=[];b.each(function(b,d){var e=a(d),f=e.parent("optgroup");c.push({element:e,index:b,value:e.val(),label:e.text(),optgroup:f.attr("label")||"",disabled:f.prop("disabled")||e.prop("disabled")})}),this.items=c},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),a.widget("ui.slider",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{
animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var b,c,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",g=[];for(c=d.values&&d.values.length||1,e.length>c&&(e.slice(c).remove(),e=e.slice(0,c)),b=e.length;b<c;b++)g.push(f);this.handles=e.add(a(g.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(b){a(this).data("ui-slider-handle-index",b)})},_createRange:function(){var b=this.options,c="";b.range?(b.range===!0&&(b.values?b.values.length&&2!==b.values.length?b.values=[b.values[0],b.values[0]]:a.isArray(b.values)&&(b.values=b.values.slice(0)):b.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=a("<div></div>").appendTo(this.element),c="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(c+("min"===b.range||"max"===b.range?" ui-slider-range-"+b.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(b){var c,d,e,f,g,h,i,j,k=this,l=this.options;return!l.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),c={x:b.pageX,y:b.pageY},d=this._normValueFromMouse(c),e=this._valueMax()-this._valueMin()+1,this.handles.each(function(b){var c=Math.abs(d-k.values(b));(e>c||e===c&&(b===k._lastChangedValue||k.values(b)===l.min))&&(e=c,f=a(this),g=b)}),h=this._start(b,g),h!==!1&&(this._mouseSliding=!0,this._handleIndex=g,f.addClass("ui-state-active").focus(),i=f.offset(),j=!a(b.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=j?{left:0,top:0}:{left:b.pageX-i.left-f.width()/2,top:b.pageY-i.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,g,d),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return"horizontal"===this.orientation?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),d<0&&(d=0),"vertical"===this.orientation&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),2===this.options.values.length&&this.options.range===!0&&(0===b&&c>d||1===b&&c<d)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._lastChangedValue=b,this._trigger("change",a,c)}},value:function(a){return arguments.length?(this.options.value=this._trimAlignValue(a),this._refreshValue(),void this._change(null,0)):this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)return this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),void this._change(null,b);if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();for(d=this.options.values,e=arguments[0],f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;switch("range"===b&&this.options.range===!0&&("min"===c?(this.options.value=this._values(0),this.options.values=null):"max"===c&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),a.isArray(this.options.values)&&(e=this.options.values.length),"disabled"===b&&this.element.toggleClass("ui-state-disabled",!!c),this._super(b,c),b){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===c?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),d=0;d<e;d+=1)this._change(null,d);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b);if(this.options.values&&this.options.values.length){for(c=this.options.values.slice(),d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c}return[]},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return 2*Math.abs(c)>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_calculateNewMax:function(){var a=this.options.max,b=this._valueMin(),c=this.options.step,d=Math.floor(+(a-b).toFixed(this._precision())/c)*c;a=d+b,this.max=parseFloat(a.toFixed(this._precision()))},_precision:function(){var a=this._precisionOf(this.options.step);return null!==this.options.min&&(a=Math.max(a,this._precisionOf(this.options.min))),a},_precisionOf:function(a){var b=a.toString(),c=b.indexOf(".");return c===-1?0:b.length-c-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var b,c,d,e,f,g=this.options.range,h=this.options,i=this,j=!this._animateOff&&h.animate,k={};this.options.values&&this.options.values.length?this.handles.each(function(d){c=(i.values(d)-i._valueMin())/(i._valueMax()-i._valueMin())*100,k["horizontal"===i.orientation?"left":"bottom"]=c+"%",a(this).stop(1,1)[j?"animate":"css"](k,h.animate),i.options.range===!0&&("horizontal"===i.orientation?(0===d&&i.range.stop(1,1)[j?"animate":"css"]({left:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({width:c-b+"%"},{queue:!1,duration:h.animate})):(0===d&&i.range.stop(1,1)[j?"animate":"css"]({bottom:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({height:c-b+"%"},{queue:!1,duration:h.animate}))),b=c}):(d=this.value(),e=this._valueMin(),f=this._valueMax(),c=f!==e?(d-e)/(f-e)*100:0,k["horizontal"===this.orientation?"left":"bottom"]=c+"%",this.handle.stop(1,1)[j?"animate":"css"](k,h.animate),"min"===g&&"horizontal"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({width:c+"%"},h.animate),"max"===g&&"horizontal"===this.orientation&&this.range[j?"animate":"css"]({width:100-c+"%"},{queue:!1,duration:h.animate}),"min"===g&&"vertical"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({height:c+"%"},h.animate),"max"===g&&"vertical"===this.orientation&&this.range[j?"animate":"css"]({height:100-c+"%"},{queue:!1,duration:h.animate}))},_handleEvents:{keydown:function(b){var c,d,e,f,g=a(b.target).data("ui-slider-handle-index");switch(b.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(b.preventDefault(),!this._keySliding&&(this._keySliding=!0,a(b.target).addClass("ui-state-active"),c=this._start(b,g),c===!1))return}switch(f=this.options.step,d=e=this.options.values&&this.options.values.length?this.values(g):this.value(),b.keyCode){case a.ui.keyCode.HOME:e=this._valueMin();break;case a.ui.keyCode.END:e=this._valueMax();break;case a.ui.keyCode.PAGE_UP:e=this._trimAlignValue(d+(this._valueMax()-this._valueMin())/this.numPages);break;case a.ui.keyCode.PAGE_DOWN:e=this._trimAlignValue(d-(this._valueMax()-this._valueMin())/this.numPages);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(d===this._valueMax())return;e=this._trimAlignValue(d+f);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(d===this._valueMin())return;e=this._trimAlignValue(d-f)}this._slide(b,g,e)},keyup:function(b){var c=a(b.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(b,c),this._change(b,c),a(b.target).removeClass("ui-state-active"))}}}),a.widget("ui.sortable",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(a,b,c){return a>=b&&a<b+c},_isFloating:function(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(a,b){this._super(a,b),"handle"===a&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),a.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(b),a(b.target).parents().each(function(){if(a.data(this,f.widgetName+"-item")===f)return d=a(this),!1}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),!!d&&(!(this.options.handle&&!c&&(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),!e))&&(this.currentItem=d,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-this.document.scrollTop()<g.scrollSensitivity?h=this.document.scrollTop(this.document.scrollTop()-g.scrollSpeed):this.window.height()-(b.pageY-this.document.scrollTop())<g.scrollSensitivity&&(h=this.document.scrollTop(this.document.scrollTop()+g.scrollSpeed)),b.pageX-this.document.scrollLeft()<g.scrollSensitivity?h=this.document.scrollLeft(this.document.scrollLeft()-g.scrollSpeed):this.window.width()-(b.pageX-this.document.scrollLeft())<g.scrollSensitivity&&(h=this.document.scrollLeft(this.document.scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&!(e===this.currentItem[0]||this.placeholder[1===f?"next":"prev"]()[0]===e||a.contains(this.placeholder[0],e)||"semi-dynamic"===this.options.type&&a.contains(this.element[0],e))){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&d+j<i,m="y"===this.options.axis||b+k>f&&b+k<g,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(a){var b="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height),c="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width),d=b&&c,e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return!!d&&(this.floating?f&&"right"===f||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(a){var b=this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),c=this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),d=this._getDragVerticalDirection(),e=this._getDragHorizontalDirection();return this.floating&&e?"right"===e&&c||"left"===e&&!c:d&&("down"===d&&b||"up"===d&&!b)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){function c(){h.push(this)}var d,e,f,g,h=[],i=[],j=this._connectWith();if(j&&b)for(d=j.length-1;d>=0;d--)for(f=a(j[d],this.document[0]),e=f.length-1;e>=0;e--)g=a.data(f[e],this.widgetFullName),g&&g!==this&&!g.options.disabled&&i.push([a.isFunction(g.options.items)?g.options.items.call(g.element):a(g.options.items,g.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),g]);for(i.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),d=i.length-1;d>=0;d--)i[d][0].each(c);return a(h)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c],this.document[0]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;d<j;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===d?b._createTrPlaceholder(b.currentItem.find("tr").eq(0),a("<tr>",b.document[0]).appendTo(e)):"tr"===d?b._createTrPlaceholder(b.currentItem,e):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){c&&!d.forcePlaceholderSize||(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_createTrPlaceholder:function(b,c){var d=this;b.children().each(function(){a("<td>&#160;</td>",d.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(c)})},_contactContainers:function(b){var c,d,e,f,g,h,i,j,k,l,m=null,n=null;for(c=this.containers.length-1;c>=0;c--)if(!a.contains(this.currentItem[0],this.containers[c].element[0]))if(this._intersectsWith(this.containers[c].containerCache)){if(m&&a.contains(this.containers[c].element[0],m.element[0]))continue;m=this.containers[c],n=c}else this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",b,this._uiHash(this)),this.containers[c].containerCache.over=0);if(m)if(1===this.containers.length)this.containers[n].containerCache.over||(this.containers[n]._trigger("over",b,this._uiHash(this)),this.containers[n].containerCache.over=1);else{for(e=1e4,f=null,k=m.floating||this._isFloating(this.currentItem),g=k?"left":"top",h=k?"width":"height",l=k?"clientX":"clientY",d=this.items.length-1;d>=0;d--)a.contains(this.containers[n].element[0],this.items[d].item[0])&&this.items[d].item[0]!==this.currentItem[0]&&(i=this.items[d].item.offset()[g],j=!1,b[l]-i>this.items[d][h]/2&&(j=!0),Math.abs(b[l]-i)<e&&(e=Math.abs(b[l]-i),f=this.items[d],this.direction=j?"up":"down"));if(!f&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[n])return void(this.currentContainer.containerCache.over||(this.containers[n]._trigger("over",b,this._uiHash()),this.currentContainer.containerCache.over=1));f?this._rearrange(b,f,null,!0):this._rearrange(b,null,this.containers[n].element,!0),this._trigger("change",b,this._uiHash()),this.containers[n]._trigger("change",b,this._uiHash(this)),this.currentContainer=this.containers[n],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",b,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),d[0].style.width&&!c.forceHelperSize||d.width(this.currentItem.width()),d[0].style.height&&!c.forceHelperSize||d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),"document"!==e.containment&&"window"!==e.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===e.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===e.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),
{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function c(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var d,e=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(d in this._storedCSS)"auto"!==this._storedCSS[d]&&"static"!==this._storedCSS[d]||(this._storedCSS[d]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||e.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),d=this.containers.length-1;d>=0;d--)b||e.push(c("deactivate",this,this.containers[d])),this.containers[d].containerCache.over&&(e.push(c("out",this,this.containers[d])),this.containers[d].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!b){for(d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}}),a.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var b={},c=this.element;return a.each(["min","max","step"],function(a,d){var e=c.attr(d);void 0!==e&&e.length&&(b[d]=e)}),b},_events:{keydown:function(a){this._start(a)&&this._keydown(a)&&a.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(a){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",a)))},mousewheel:function(a,b){if(b){if(!this.spinning&&!this._start(a))return!1;this._spin((b>0?1:-1)*this.options.step,a),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(a)},100),a.preventDefault()}},"mousedown .ui-spinner-button":function(b){function c(){var a=this.element[0]===this.document[0].activeElement;a||(this.element.focus(),this.previous=d,this._delay(function(){this.previous=d}))}var d;d=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),b.preventDefault(),c.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,c.call(this)}),this._start(b)!==!1&&this._repeat(null,a(b.currentTarget).hasClass("ui-spinner-up")?1:-1,b)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(b){if(a(b.currentTarget).hasClass("ui-state-active"))return this._start(b)!==!1&&void this._repeat(null,a(b.currentTarget).hasClass("ui-spinner-up")?1:-1,b)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var a=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=a.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*a.height())&&a.height()>0&&a.height(a.height()),this.options.disabled&&this.disable()},_keydown:function(b){var c=this.options,d=a.ui.keyCode;switch(b.keyCode){case d.UP:return this._repeat(null,1,b),!0;case d.DOWN:return this._repeat(null,-1,b),!0;case d.PAGE_UP:return this._repeat(null,c.page,b),!0;case d.PAGE_DOWN:return this._repeat(null,-c.page,b),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(a){return!(!this.spinning&&this._trigger("start",a)===!1)&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(a,b,c){a=a||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,b,c)},a),this._spin(b*this.options.step,c)},_spin:function(a,b){var c=this.value()||0;this.counter||(this.counter=1),c=this._adjustValue(c+a*this._increment(this.counter)),this.spinning&&this._trigger("spin",b,{value:c})===!1||(this._value(c),this.counter++)},_increment:function(b){var c=this.options.incremental;return c?a.isFunction(c)?c(b):Math.floor(b*b*b/5e4-b*b/500+17*b/200+1):1},_precision:function(){var a=this._precisionOf(this.options.step);return null!==this.options.min&&(a=Math.max(a,this._precisionOf(this.options.min))),a},_precisionOf:function(a){var b=a.toString(),c=b.indexOf(".");return c===-1?0:b.length-c-1},_adjustValue:function(a){var b,c,d=this.options;return b=null!==d.min?d.min:0,c=a-b,c=Math.round(c/d.step)*d.step,a=b+c,a=parseFloat(a.toFixed(this._precision())),null!==d.max&&a>d.max?d.max:null!==d.min&&a<d.min?d.min:a},_stop:function(a){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",a))},_setOption:function(a,b){if("culture"===a||"numberFormat"===a){var c=this._parse(this.element.val());return this.options[a]=b,void this.element.val(this._format(c))}"max"!==a&&"min"!==a&&"step"!==a||"string"==typeof b&&(b=this._parse(b)),"icons"===a&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(b.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(b.down)),this._super(a,b),"disabled"===a&&(this.widget().toggleClass("ui-state-disabled",!!b),this.element.prop("disabled",!!b),this.buttons.button(b?"disable":"enable"))},_setOptions:i(function(a){this._super(a)}),_parse:function(a){return"string"==typeof a&&""!==a&&(a=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(a,10,this.options.culture):+a),""===a||isNaN(a)?null:a},_format:function(a){return""===a?"":window.Globalize&&this.options.numberFormat?Globalize.format(a,this.options.numberFormat,this.options.culture):a},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var a=this.value();return null!==a&&a===this._adjustValue(a)},_value:function(a,b){var c;""!==a&&(c=this._parse(a),null!==c&&(b||(c=this._adjustValue(c)),a=this._format(c))),this.element.val(a),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:i(function(a){this._stepUp(a)}),_stepUp:function(a){this._start()&&(this._spin((a||1)*this.options.step),this._stop())},stepDown:i(function(a){this._stepDown(a)}),_stepDown:function(a){this._start()&&(this._spin((a||1)*-this.options.step),this._stop())},pageUp:i(function(a){this._stepUp((a||1)*this.options.page)}),pageDown:i(function(a){this._stepDown((a||1)*this.options.page)}),value:function(a){return arguments.length?void i(this._value).call(this,a):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),a.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var a=/#.*$/;return function(b){var c,d;b=b.cloneNode(!1),c=b.href.replace(a,""),d=location.href.replace(a,"");try{c=decodeURIComponent(c)}catch(a){}try{d=decodeURIComponent(d)}catch(a){}return b.hash.length>1&&c===d}}(),_create:function(){var b=this,c=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",c.collapsible),this._processTabs(),c.active=this._initialActive(),a.isArray(c.disabled)&&(c.disabled=a.unique(c.disabled.concat(a.map(this.tabs.filter(".ui-state-disabled"),function(a){return b.tabs.index(a)}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(c.active):this.active=a(),this._refresh(),this.active.length&&this.load(c.active)},_initialActive:function(){var b=this.options.active,c=this.options.collapsible,d=location.hash.substring(1);return null===b&&(d&&this.tabs.each(function(c,e){if(a(e).attr("aria-controls")===d)return b=c,!1}),null===b&&(b=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==b&&b!==-1||(b=!!this.tabs.length&&0)),b!==!1&&(b=this.tabs.index(this.tabs.eq(b)),b===-1&&(b=!c&&0)),!c&&b===!1&&this.anchors.length&&(b=0),b},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):a()}},_tabKeydown:function(b){var c=a(this.document[0].activeElement).closest("li"),d=this.tabs.index(c),e=!0;if(!this._handlePageNav(b)){switch(b.keyCode){case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:d++;break;case a.ui.keyCode.UP:case a.ui.keyCode.LEFT:e=!1,d--;break;case a.ui.keyCode.END:d=this.anchors.length-1;break;case a.ui.keyCode.HOME:d=0;break;case a.ui.keyCode.SPACE:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d);case a.ui.keyCode.ENTER:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d!==this.options.active&&d);default:return}b.preventDefault(),clearTimeout(this.activating),d=this._focusNextTab(d,e),b.ctrlKey||b.metaKey||(c.attr("aria-selected","false"),this.tabs.eq(d).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",d)},this.delay))}},_panelKeydown:function(b){this._handlePageNav(b)||b.ctrlKey&&b.keyCode===a.ui.keyCode.UP&&(b.preventDefault(),this.active.focus())},_handlePageNav:function(b){return b.altKey&&b.keyCode===a.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):b.altKey&&b.keyCode===a.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(b,c){function d(){return b>e&&(b=0),b<0&&(b=e),b}for(var e=this.tabs.length-1;a.inArray(d(),this.options.disabled)!==-1;)b=c?b+1:b-1;return b},_focusNextTab:function(a,b){return a=this._findNextTab(a,b),this.tabs.eq(a).focus(),a},_setOption:function(a,b){return"active"===a?void this._activate(b):"disabled"===a?void this._setupDisabled(b):(this._super(a,b),"collapsible"===a&&(this.element.toggleClass("ui-tabs-collapsible",b),b||this.options.active!==!1||this._activate(0)),"event"===a&&this._setupEvents(b),void("heightStyle"===a&&this._setupHeightStyle(b)))},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var b=this.options,c=this.tablist.children(":has(a[href])");b.disabled=a.map(c.filter(".ui-state-disabled"),function(a){return c.index(a)}),this._processTabs(),b.active!==!1&&this.anchors.length?this.active.length&&!a.contains(this.tablist[0],this.active[0])?this.tabs.length===b.disabled.length?(b.active=!1,this.active=a()):this._activate(this._findNextTab(Math.max(0,b.active-1),!1)):b.active=this.tabs.index(this.active):(b.active=!1,this.active=a()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var b=this,c=this.tabs,d=this.anchors,e=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(b){a(this).is(".ui-state-disabled")&&b.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){a(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return a("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=a(),this.anchors.each(function(c,d){var e,f,g,h=a(d).uniqueId().attr("id"),i=a(d).closest("li"),j=i.attr("aria-controls");b._isLocal(d)?(e=d.hash,g=e.substring(1),f=b.element.find(b._sanitizeSelector(e))):(g=i.attr("aria-controls")||a({}).uniqueId()[0].id,e="#"+g,f=b.element.find(e),f.length||(f=b._createPanel(g),f.insertAfter(b.panels[c-1]||b.tablist)),f.attr("aria-live","polite")),f.length&&(b.panels=b.panels.add(f)),j&&i.data("ui-tabs-aria-controls",j),i.attr({"aria-controls":g,"aria-labelledby":h}),f.attr("aria-labelledby",h)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),c&&(this._off(c.not(this.tabs)),this._off(d.not(this.anchors)),this._off(e.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(b){return a("<div>").attr("id",b).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(b){a.isArray(b)&&(b.length?b.length===this.anchors.length&&(b=!0):b=!1);for(var c,d=0;c=this.tabs[d];d++)b===!0||a.inArray(d,b)!==-1?a(c).addClass("ui-state-disabled").attr("aria-disabled","true"):a(c).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=b},_setupEvents:function(b){var c={};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(a){a.preventDefault()}}),this._on(this.anchors,c),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(b){var c,d=this.element.parent();"fill"===b?(c=d.height(),c-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var b=a(this),d=b.css("position");"absolute"!==d&&"fixed"!==d&&(c-=b.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){c-=a(this).outerHeight(!0)}),this.panels.each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")):"auto"===b&&(c=0,this.panels.each(function(){c=Math.max(c,a(this).height("").height())}).height(c))},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget),f=e.closest("li"),g=f[0]===d[0],h=g&&c.collapsible,i=h?a():this._getPanelForTab(f),j=d.length?this._getPanelForTab(d):a(),k={oldTab:d,oldPanel:j,newTab:h?a():f,newPanel:i};b.preventDefault(),f.hasClass("ui-state-disabled")||f.hasClass("ui-tabs-loading")||this.running||g&&!c.collapsible||this._trigger("beforeActivate",b,k)===!1||(c.active=!h&&this.tabs.index(f),this.active=g?a():f,this.xhr&&this.xhr.abort(),j.length||i.length||a.error("jQuery UI Tabs: Mismatching fragment identifier."),i.length&&this.load(this.tabs.index(f),b),this._toggle(b,k))},_toggle:function(b,c){function d(){f.running=!1,f._trigger("activate",b,c)}function e(){c.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),g.length&&f.options.show?f._show(g,f.options.show,d):(g.show(),d())}var f=this,g=c.newPanel,h=c.oldPanel;this.running=!0,h.length&&this.options.hide?this._hide(h,this.options.hide,function(){c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),e()}):(c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),h.hide(),e()),h.attr("aria-hidden","true"),c.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),g.length&&h.length?c.oldTab.attr("tabIndex",-1):g.length&&this.tabs.filter(function(){return 0===a(this).attr("tabIndex")}).attr("tabIndex",-1),g.attr("aria-hidden","false"),c.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(b){var c,d=this._findActive(b);d[0]!==this.active[0]&&(d.length||(d=this.active),c=d.find(".ui-tabs-anchor")[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return b===!1?a():this.tabs.eq(b)},_getIndex:function(a){return"string"==typeof a&&(a=this.anchors.index(this.anchors.filter("[href$='"+a+"']"))),a},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){a.data(this,"ui-tabs-destroy")?a(this).remove():a(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var b=a(this),c=b.data("ui-tabs-aria-controls");c?b.attr("aria-controls",c).removeData("ui-tabs-aria-controls"):b.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(b){var c=this.options.disabled;c!==!1&&(void 0===b?c=!1:(b=this._getIndex(b),c=a.isArray(c)?a.map(c,function(a){return a!==b?a:null}):a.map(this.tabs,function(a,c){return c!==b?c:null})),this._setupDisabled(c))},disable:function(b){var c=this.options.disabled;if(c!==!0){if(void 0===b)c=!0;else{if(b=this._getIndex(b),a.inArray(b,c)!==-1)return;c=a.isArray(c)?a.merge([b],c).sort():[b]}this._setupDisabled(c)}},load:function(b,c){b=this._getIndex(b);var d=this,e=this.tabs.eq(b),f=e.find(".ui-tabs-anchor"),g=this._getPanelForTab(e),h={tab:e,panel:g},i=function(a,b){"abort"===b&&d.panels.stop(!1,!0),e.removeClass("ui-tabs-loading"),g.removeAttr("aria-busy"),a===d.xhr&&delete d.xhr};this._isLocal(f[0])||(this.xhr=a.ajax(this._ajaxSettings(f,c,h)),this.xhr&&"canceled"!==this.xhr.statusText&&(e.addClass("ui-tabs-loading"),g.attr("aria-busy","true"),this.xhr.done(function(a,b,e){setTimeout(function(){g.html(a),d._trigger("load",c,h),i(e,b)},1)}).fail(function(a,b){setTimeout(function(){i(a,b)},1)})))},_ajaxSettings:function(b,c,d){var e=this;return{url:b.attr("href"),beforeSend:function(b,f){return e._trigger("beforeLoad",c,a.extend({jqXHR:b,ajaxSettings:f},d))}}},_getPanelForTab:function(b){var c=a(b).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+c))}}),a.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var b=a(this).attr("title")||"";return a("<a>").text(b).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(b,c){var d=(b.attr("aria-describedby")||"").split(/\s+/);d.push(c),b.data("ui-tooltip-id",c).attr("aria-describedby",a.trim(d.join(" ")))},_removeDescribedBy:function(b){var c=b.data("ui-tooltip-id"),d=(b.attr("aria-describedby")||"").split(/\s+/),e=a.inArray(c,d);e!==-1&&d.splice(e,1),b.removeData("ui-tooltip-id"),d=a.trim(d.join(" ")),d?b.attr("aria-describedby",d):b.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=a("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(b,c){var d=this;return"disabled"===b?(this[c?"_disable":"_enable"](),void(this.options[b]=c)):(this._super(b,c),void("content"===b&&a.each(this.tooltips,function(a,b){d._updateContent(b.element)})))},_disable:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur");e.target=e.currentTarget=d.element[0],b.close(e,!0)}),this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.is("[title]")&&b.data("ui-tooltip-title",b.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.data("ui-tooltip-title")&&b.attr("title",b.data("ui-tooltip-title"))})},open:function(b){var c=this,d=a(b?b.target:this.element).closest(this.options.items);d.length&&!d.data("ui-tooltip-id")&&(d.attr("title")&&d.data("ui-tooltip-title",d.attr("title")),d.data("ui-tooltip-open",!0),b&&"mouseover"===b.type&&d.parents().each(function(){var b,d=a(this);d.data("ui-tooltip-open")&&(b=a.Event("blur"),b.target=b.currentTarget=this,c.close(b,!0)),d.attr("title")&&(d.uniqueId(),c.parents[this.id]={element:this,title:d.attr("title")},d.attr("title",""))}),this._registerCloseHandlers(b,d),this._updateContent(d,b))},_updateContent:function(a,b){var c,d=this.options.content,e=this,f=b?b.type:null;return"string"==typeof d?this._open(b,a,d):(c=d.call(a[0],function(c){e._delay(function(){a.data("ui-tooltip-open")&&(b&&(b.type=f),this._open(b,a,c))})}),void(c&&this._open(b,a,c)))},_open:function(b,c,d){function e(a){j.of=a,g.is(":hidden")||g.position(j)}var f,g,h,i,j=a.extend({},this.options.position);if(d){if(f=this._find(c))return void f.tooltip.find(".ui-tooltip-content").html(d);c.is("[title]")&&(b&&"mouseover"===b.type?c.attr("title",""):c.removeAttr("title")),f=this._tooltip(c),g=f.tooltip,this._addDescribedBy(c,g.attr("id")),g.find(".ui-tooltip-content").html(d),this.liveRegion.children().hide(),d.clone?(i=d.clone(),i.removeAttr("id").find("[id]").removeAttr("id")):i=d,a("<div>").html(i).appendTo(this.liveRegion),this.options.track&&b&&/^mouse/.test(b.type)?(this._on(this.document,{mousemove:e}),e(b)):g.position(a.extend({of:c},this.options.position)),g.hide(),this._show(g,this.options.show),this.options.show&&this.options.show.delay&&(h=this.delayedShow=setInterval(function(){g.is(":visible")&&(e(j.of),clearInterval(h))},a.fx.interval)),this._trigger("open",b,{tooltip:g})}},_registerCloseHandlers:function(b,c){var d={keyup:function(b){if(b.keyCode===a.ui.keyCode.ESCAPE){var d=a.Event(b);d.currentTarget=c[0],this.close(d,!0)}}};c[0]!==this.element[0]&&(d.remove=function(){this._removeTooltip(this._find(c).tooltip)}),b&&"mouseover"!==b.type||(d.mouseleave="close"),b&&"focusin"!==b.type||(d.focusout="close"),this._on(!0,c,d)},close:function(b){var c,d=this,e=a(b?b.currentTarget:this.element),f=this._find(e);return f?(c=f.tooltip,void(f.closing||(clearInterval(this.delayedShow),e.data("ui-tooltip-title")&&!e.attr("title")&&e.attr("title",e.data("ui-tooltip-title")),this._removeDescribedBy(e),f.hiding=!0,c.stop(!0),this._hide(c,this.options.hide,function(){d._removeTooltip(a(this))}),e.removeData("ui-tooltip-open"),this._off(e,"mouseleave focusout keyup"),e[0]!==this.element[0]&&this._off(e,"remove"),this._off(this.document,"mousemove"),b&&"mouseleave"===b.type&&a.each(this.parents,function(b,c){a(c.element).attr("title",c.title),delete d.parents[b]}),f.closing=!0,this._trigger("close",b,{tooltip:c}),f.hiding||(f.closing=!1)))):void e.removeData("ui-tooltip-open")},_tooltip:function(b){var c=a("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),d=c.uniqueId().attr("id");return a("<div>").addClass("ui-tooltip-content").appendTo(c),c.appendTo(this.document[0].body),this.tooltips[d]={element:b,tooltip:c}},_find:function(a){var b=a.data("ui-tooltip-id");return b?this.tooltips[b]:null},_removeTooltip:function(a){a.remove(),delete this.tooltips[a.attr("id")]},_destroy:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur"),f=d.element;e.target=e.currentTarget=f[0],b.close(e,!0),a("#"+c).remove(),f.data("ui-tooltip-title")&&(f.attr("title")||f.attr("title",f.data("ui-tooltip-title")),f.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})})},{}],456:[function(a,b,c){(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a){this.el=a,this.dragleave=b(this.dragleave,this),this.dragenter=b(this.dragenter,this),this.supportsEventConstructors()&&(this.first=!1,this.second=!1,this.el.addEventListener("dragenter",this.dragenter,!1),this.el.addEventListener("dragleave",this.dragleave,!1))}return a.prototype.dragenter=function(a){return this.first?this.second=!0:(this.first=!0,this.el.dispatchEvent(new CustomEvent("dragster:enter",{bubbles:!0,cancelable:!0,detail:{dataTransfer:a.dataTransfer}})))},a.prototype.dragleave=function(a){if(this.second?this.second=!1:this.first&&(this.first=!1),!this.first&&!this.second)return this.el.dispatchEvent(new CustomEvent("dragster:leave",{bubbles:!0,cancelable:!0,detail:{dataTransfer:a.dataTransfer}}))},a.prototype.removeListeners=function(){return this.el.removeEventListener("dragenter",this.dragenter,!1),this.el.removeEventListener("dragleave",this.dragleave,!1)},a.prototype.supportsEventConstructors=function(){try{new CustomEvent("z")}catch(a){return!1}return!0},a.prototype.reset=function(){return this.first=!1,this.second=!1},a}(),window.Dragster=a}).call(this)},{}],457:[function(a,b,c){(function(){var a,c,d,e,f,g,h,i,j=[].slice,k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};h=function(){},c=function(){function a(){}return a.prototype.addEventListener=a.prototype.on,a.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},this._callbacks[a]||(this._callbacks[a]=[]),this._callbacks[a].push(b),this},a.prototype.emit=function(){var a,b,c,d,e,f;if(d=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],this._callbacks=this._callbacks||{},c=this._callbacks[d])for(e=0,f=c.length;e<f;e++)b=c[e],b.apply(this,a);return this},a.prototype.removeListener=a.prototype.off,a.prototype.removeAllListeners=a.prototype.off,a.prototype.removeEventListener=a.prototype.off,a.prototype.off=function(a,b){var c,d,e,f,g;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(d=this._callbacks[a],!d)return this;if(1===arguments.length)return delete this._callbacks[a],this;for(e=f=0,g=d.length;f<g;e=++f)if(c=d[e],c===b){d.splice(e,1);break}return this},a}(),a=function(a){function b(a,c){var e,f,g;if(this.element=a,this.version=b.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(b.instances.push(this),this.element.dropzone=this,e=null!=(g=b.optionsForElement(this.element))?g:{},this.options=d({},this.defaultOptions,e,null!=c?c:{}),this.options.forceFallback||!b.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(f=this.getExistingFallback())&&f.parentNode&&f.parentNode.removeChild(f),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=b.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=b.getElements(this.options.clickable,"clickable")),this.init()}var d,e;return l(b,a),b.prototype.Emitter=c,b.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],b.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",
dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(a,b){return b()},init:function(){return h},forceFallback:!1,fallback:function(){var a,c,d,e,f,g;for(this.element.className=""+this.element.className+" dz-browser-not-supported",g=this.element.getElementsByTagName("div"),e=0,f=g.length;e<f;e++)a=g[e],/(^| )dz-message($| )/.test(a.className)&&(c=a,a.className="dz-message");return c||(c=b.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(c)),d=c.getElementsByTagName("span")[0],d&&(d.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(a){var b,c,d;return b={srcX:0,srcY:0,srcWidth:a.width,srcHeight:a.height},c=a.width/a.height,b.optWidth=this.options.thumbnailWidth,b.optHeight=this.options.thumbnailHeight,null==b.optWidth&&null==b.optHeight?(b.optWidth=b.srcWidth,b.optHeight=b.srcHeight):null==b.optWidth?b.optWidth=c*b.optHeight:null==b.optHeight&&(b.optHeight=1/c*b.optWidth),d=b.optWidth/b.optHeight,a.height<b.optHeight||a.width<b.optWidth?(b.trgHeight=b.srcHeight,b.trgWidth=b.srcWidth):c>d?(b.srcHeight=a.height,b.srcWidth=b.srcHeight*d):(b.srcWidth=a.width,b.srcHeight=b.srcWidth/d),b.srcX=(a.width-b.srcWidth)/2,b.srcY=(a.height-b.srcHeight)/2,b},drop:function(a){return this.element.classList.remove("dz-drag-hover")},dragstart:h,dragend:function(a){return this.element.classList.remove("dz-drag-hover")},dragenter:function(a){return this.element.classList.add("dz-drag-hover")},dragover:function(a){return this.element.classList.add("dz-drag-hover")},dragleave:function(a){return this.element.classList.remove("dz-drag-hover")},paste:h,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(a.previewElement=b.createElement(this.options.previewTemplate.trim()),a.previewTemplate=a.previewElement,this.previewsContainer.appendChild(a.previewElement),l=a.previewElement.querySelectorAll("[data-dz-name]"),f=0,i=l.length;f<i;f++)c=l[f],c.textContent=a.name;for(m=a.previewElement.querySelectorAll("[data-dz-size]"),g=0,j=m.length;g<j;g++)c=m[g],c.innerHTML=this.filesize(a.size);for(this.options.addRemoveLinks&&(a._removeLink=b.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),a.previewElement.appendChild(a._removeLink)),d=function(c){return function(d){return d.preventDefault(),d.stopPropagation(),a.status===b.UPLOADING?b.confirm(c.options.dictCancelUploadConfirmation,function(){return c.removeFile(a)}):c.options.dictRemoveFileConfirmation?b.confirm(c.options.dictRemoveFileConfirmation,function(){return c.removeFile(a)}):c.removeFile(a)}}(this),n=a.previewElement.querySelectorAll("[data-dz-remove]"),o=[],h=0,k=n.length;h<k;h++)e=n[h],o.push(e.addEventListener("click",d));return o}},removedfile:function(a){var b;return a.previewElement&&null!=(b=a.previewElement)&&b.parentNode.removeChild(a.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(a,b){var c,d,e,f;if(a.previewElement){for(a.previewElement.classList.remove("dz-file-preview"),f=a.previewElement.querySelectorAll("[data-dz-thumbnail]"),d=0,e=f.length;d<e;d++)c=f[d],c.alt=a.name,c.src=b;return setTimeout(function(b){return function(){return a.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(a,b){var c,d,e,f,g;if(a.previewElement){for(a.previewElement.classList.add("dz-error"),"String"!=typeof b&&b.error&&(b=b.error),f=a.previewElement.querySelectorAll("[data-dz-errormessage]"),g=[],d=0,e=f.length;d<e;d++)c=f[d],g.push(c.textContent=b);return g}},errormultiple:h,processing:function(a){if(a.previewElement&&(a.previewElement.classList.add("dz-processing"),a._removeLink))return a._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:h,uploadprogress:function(a,b,c){var d,e,f,g,h;if(a.previewElement){for(g=a.previewElement.querySelectorAll("[data-dz-uploadprogress]"),h=[],e=0,f=g.length;e<f;e++)d=g[e],"PROGRESS"===d.nodeName?h.push(d.value=b):h.push(d.style.width=""+b+"%");return h}},totaluploadprogress:h,sending:h,sendingmultiple:h,success:function(a){if(a.previewElement)return a.previewElement.classList.add("dz-success")},successmultiple:h,canceled:function(a){return this.emit("error",a,"Upload canceled.")},canceledmultiple:h,complete:function(a){if(a._removeLink&&(a._removeLink.textContent=this.options.dictRemoveFile),a.previewElement)return a.previewElement.classList.add("dz-complete")},completemultiple:h,maxfilesexceeded:h,maxfilesreached:h,queuecomplete:h,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},d=function(){var a,b,c,d,e,f,g;for(d=arguments[0],c=2<=arguments.length?j.call(arguments,1):[],f=0,g=c.length;f<g;f++){b=c[f];for(a in b)e=b[a],d[a]=e}return d},b.prototype.getAcceptedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],a.accepted&&e.push(a);return e},b.prototype.getRejectedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],a.accepted||e.push(a);return e},b.prototype.getFilesWithStatus=function(a){var b,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;c<d;c++)b=e[c],b.status===a&&f.push(b);return f},b.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(b.QUEUED)},b.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(b.UPLOADING)},b.prototype.getActiveFiles=function(){var a,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;c<d;c++)a=e[c],a.status!==b.UPLOADING&&a.status!==b.QUEUED||f.push(a);return f},b.prototype.init=function(){var a,c,d,e,f,g,h;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(b.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(d=function(a){return function(){return a.hiddenFileInput&&document.body.removeChild(a.hiddenFileInput),a.hiddenFileInput=document.createElement("input"),a.hiddenFileInput.setAttribute("type","file"),(null==a.options.maxFiles||a.options.maxFiles>1)&&a.hiddenFileInput.setAttribute("multiple","multiple"),a.hiddenFileInput.className="dz-hidden-input",null!=a.options.acceptedFiles&&a.hiddenFileInput.setAttribute("accept",a.options.acceptedFiles),null!=a.options.capture&&a.hiddenFileInput.setAttribute("capture",a.options.capture),a.hiddenFileInput.style.visibility="hidden",a.hiddenFileInput.style.position="absolute",a.hiddenFileInput.style.top="0",a.hiddenFileInput.style.left="0",a.hiddenFileInput.style.height="0",a.hiddenFileInput.style.width="0",document.body.appendChild(a.hiddenFileInput),a.hiddenFileInput.addEventListener("change",function(){var b,c,e,f;if(c=a.hiddenFileInput.files,c.length)for(e=0,f=c.length;e<f;e++)b=c[e],a.addFile(b);return d()})}}(this))(),this.URL=null!=(g=window.URL)?g:window.webkitURL,h=this.events,e=0,f=h.length;e<f;e++)a=h[e],this.on(a,this.options[a]);return this.on("uploadprogress",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("canceled",function(a){return function(b){return a.emit("complete",b)}}(this)),this.on("complete",function(a){return function(b){if(0===a.getUploadingFiles().length&&0===a.getQueuedFiles().length)return setTimeout(function(){return a.emit("queuecomplete")},0)}}(this)),c=function(a){return a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(a){return function(b){return a.emit("dragstart",b)}}(this),dragenter:function(a){return function(b){return c(b),a.emit("dragenter",b)}}(this),dragover:function(a){return function(b){var d;try{d=b.dataTransfer.effectAllowed}catch(a){}return b.dataTransfer.dropEffect="move"===d||"linkMove"===d?"move":"copy",c(b),a.emit("dragover",b)}}(this),dragleave:function(a){return function(b){return a.emit("dragleave",b)}}(this),drop:function(a){return function(b){return c(b),a.drop(b)}}(this),dragend:function(a){return function(b){return a.emit("dragend",b)}}(this)}}],this.clickableElements.forEach(function(a){return function(c){return a.listeners.push({element:c,events:{click:function(d){if(c!==a.element||d.target===a.element||b.elementInside(d.target,a.element.querySelector(".dz-message")))return a.hiddenFileInput.click()}}})}}(this)),this.enable(),this.options.init.call(this)},b.prototype.destroy=function(){var a;return this.disable(),this.removeAllFiles(!0),(null!=(a=this.hiddenFileInput)?a.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,b.instances.splice(b.instances.indexOf(this),1)},b.prototype.updateTotalUploadProgress=function(){var a,b,c,d,e,f,g,h;if(d=0,c=0,a=this.getActiveFiles(),a.length){for(h=this.getActiveFiles(),f=0,g=h.length;f<g;f++)b=h[f],d+=b.upload.bytesSent,c+=b.upload.total;e=100*d/c}else e=100;return this.emit("totaluploadprogress",e,c,d)},b.prototype._getParamName=function(a){return"function"==typeof this.options.paramName?this.options.paramName(a):""+this.options.paramName+(this.options.uploadMultiple?"["+a+"]":"")},b.prototype.getFallbackForm=function(){var a,c,d,e;return(a=this.getExistingFallback())?a:(d='<div class="dz-fallback">',this.options.dictFallbackText&&(d+="<p>"+this.options.dictFallbackText+"</p>"),d+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',c=b.createElement(d),"FORM"!==this.element.tagName?(e=b.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),e.appendChild(c)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=e?e:c)},b.prototype.getExistingFallback=function(){var a,b,c,d,e,f;for(b=function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)if(b=a[c],/(^| )fallback($| )/.test(b.className))return b},f=["div","form"],d=0,e=f.length;d<e;d++)if(c=f[d],a=b(this.element.getElementsByTagName(c)))return a},b.prototype.setupEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;d<e;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.addEventListener(b,c,!1));return e}());return g},b.prototype.removeEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;d<e;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.removeEventListener(b,c,!1));return e}());return g},b.prototype.disable=function(){var a,b,c,d,e;for(this.clickableElements.forEach(function(a){return a.classList.remove("dz-clickable")}),this.removeEventListeners(),d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(this.cancelUpload(a));return e},b.prototype.enable=function(){return this.clickableElements.forEach(function(a){return a.classList.add("dz-clickable")}),this.setupEventListeners()},b.prototype.filesize=function(a){var b,c,d,e,f,g,h,i;for(g=["TB","GB","MB","KB","b"],d=e=null,c=h=0,i=g.length;h<i;c=++h)if(f=g[c],b=Math.pow(this.options.filesizeBase,4-c)/10,a>=b){d=a/Math.pow(this.options.filesizeBase,4-c),e=f;break}return d=Math.round(10*d)/10,"<strong>"+d+"</strong> "+e},b.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},b.prototype.drop=function(a){var b,c;a.dataTransfer&&(this.emit("drop",a),b=a.dataTransfer.files,b.length&&(c=a.dataTransfer.items,c&&c.length&&null!=c[0].webkitGetAsEntry?this._addFilesFromItems(c):this.handleFiles(b)))},b.prototype.paste=function(a){var b,c;if(null!=(null!=a&&null!=(c=a.clipboardData)?c.items:void 0))return this.emit("paste",a),b=a.clipboardData.items,b.length?this._addFilesFromItems(b):void 0},b.prototype.handleFiles=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;c<d;c++)b=a[c],e.push(this.addFile(b));return e},b.prototype._addFilesFromItems=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;d<e;d++)c=a[d],null!=c.webkitGetAsEntry&&(b=c.webkitGetAsEntry())?b.isFile?f.push(this.addFile(c.getAsFile())):b.isDirectory?f.push(this._addFilesFromDirectory(b,b.name)):f.push(void 0):null!=c.getAsFile&&(null==c.kind||"file"===c.kind)?f.push(this.addFile(c.getAsFile())):f.push(void 0);return f},b.prototype._addFilesFromDirectory=function(a,b){var c,d;return c=a.createReader(),d=function(a){return function(c){var d,e,f;for(e=0,f=c.length;e<f;e++)d=c[e],d.isFile?d.file(function(c){if(!a.options.ignoreHiddenFiles||"."!==c.name.substring(0,1))return c.fullPath=""+b+"/"+c.name,a.addFile(c)}):d.isDirectory&&a._addFilesFromDirectory(d,""+b+"/"+d.name)}}(this),c.readEntries(d,function(a){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(a):void 0})},b.prototype.accept=function(a,c){return a.size>1024*this.options.maxFilesize*1024?c(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(a.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):b.isValidFile(a,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(c(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",a)):this.options.accept.call(this,a,c):c(this.options.dictInvalidFileType)},b.prototype.addFile=function(a){return a.upload={progress:0,total:a.size,bytesSent:0},this.files.push(a),a.status=b.ADDED,this.emit("addedfile",a),this._enqueueThumbnail(a),this.accept(a,function(b){return function(c){return c?(a.accepted=!1,b._errorProcessing([a],c)):(a.accepted=!0,b.options.autoQueue&&b.enqueueFile(a)),b._updateMaxFilesReachedClass()}}(this))},b.prototype.enqueueFiles=function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)b=a[c],this.enqueueFile(b);return null},b.prototype.enqueueFile=function(a){if(a.status!==b.ADDED||a.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(a.status=b.QUEUED,this.options.autoProcessQueue)return setTimeout(function(a){return function(){return a.processQueue()}}(this),0)},b.prototype._thumbnailQueue=[],b.prototype._processingThumbnail=!1,b.prototype._enqueueThumbnail=function(a){if(this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(a),setTimeout(function(a){return function(){return a._processThumbnailQueue()}}(this),0)},b.prototype._processThumbnailQueue=function(){if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(a){return function(){return a._processingThumbnail=!1,a._processThumbnailQueue()}}(this))},b.prototype.removeFile=function(a){if(a.status===b.UPLOADING&&this.cancelUpload(a),this.files=i(this.files,a),this.emit("removedfile",a),0===this.files.length)return this.emit("reset")},b.prototype.removeAllFiles=function(a){var c,d,e,f;for(null==a&&(a=!1),f=this.files.slice(),d=0,e=f.length;d<e;d++)c=f[d],(c.status!==b.UPLOADING||a)&&this.removeFile(c);return null},b.prototype.createThumbnail=function(a,b){var c;return c=new FileReader,c.onload=function(d){return function(){return"image/svg+xml"===a.type?(d.emit("thumbnail",a,c.result),void(null!=b&&b())):d.createThumbnailFromUrl(a,c.result,b)}}(this),c.readAsDataURL(a)},b.prototype.createThumbnailFromUrl=function(a,b,c){var d;return d=document.createElement("img"),d.onload=function(b){return function(){var e,f,h,i,j,k,l,m;if(a.width=d.width,a.height=d.height,h=b.options.resize.call(b,a),null==h.trgWidth&&(h.trgWidth=h.optWidth),null==h.trgHeight&&(h.trgHeight=h.optHeight),e=document.createElement("canvas"),f=e.getContext("2d"),e.width=h.trgWidth,e.height=h.trgHeight,g(f,d,null!=(j=h.srcX)?j:0,null!=(k=h.srcY)?k:0,h.srcWidth,h.srcHeight,null!=(l=h.trgX)?l:0,null!=(m=h.trgY)?m:0,h.trgWidth,h.trgHeight),i=e.toDataURL("image/png"),b.emit("thumbnail",a,i),null!=c)return c()}}(this),null!=c&&(d.onerror=c),d.src=b},b.prototype.processQueue=function(){var a,b,c,d;if(b=this.options.parallelUploads,c=this.getUploadingFiles().length,a=c,!(c>=b)&&(d=this.getQueuedFiles(),d.length>0)){if(this.options.uploadMultiple)return this.processFiles(d.slice(0,b-c));for(;a<b;){if(!d.length)return;this.processFile(d.shift()),a++}}},b.prototype.processFile=function(a){return this.processFiles([a])},b.prototype.processFiles=function(a){var c,d,e;for(d=0,e=a.length;d<e;d++)c=a[d],c.processing=!0,c.status=b.UPLOADING,this.emit("processing",c);return this.options.uploadMultiple&&this.emit("processingmultiple",a),this.uploadFiles(a)},b.prototype._getFilesWithXhr=function(a){var b,c;return c=function(){var c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;c<d;c++)b=e[c],b.xhr===a&&f.push(b);return f}.call(this)},b.prototype.cancelUpload=function(a){var c,d,e,f,g,h,i;if(a.status===b.UPLOADING){for(d=this._getFilesWithXhr(a.xhr),e=0,g=d.length;e<g;e++)c=d[e],c.status=b.CANCELED;for(a.xhr.abort(),f=0,h=d.length;f<h;f++)c=d[f],this.emit("canceled",c);this.options.uploadMultiple&&this.emit("canceledmultiple",d)}else(i=a.status)!==b.ADDED&&i!==b.QUEUED||(a.status=b.CANCELED,this.emit("canceled",a),this.options.uploadMultiple&&this.emit("canceledmultiple",[a]));if(this.options.autoProcessQueue)return this.processQueue()},e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?j.call(arguments,1):[],"function"==typeof b?b.apply(this,a):b},b.prototype.uploadFile=function(a){return this.uploadFiles([a])},b.prototype.uploadFiles=function(a){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;for(w=new XMLHttpRequest,x=0,B=a.length;x<B;x++)c=a[x],c.xhr=w;p=e(this.options.method,a),u=e(this.options.url,a),w.open(p,u,!0),w.withCredentials=!!this.options.withCredentials,s=null,g=function(b){return function(){var d,e,f;for(f=[],d=0,e=a.length;d<e;d++)c=a[d],f.push(b._errorProcessing(a,s||b.options.dictResponseError.replace("{{statusCode}}",w.status),w));return f}}(this),t=function(b){return function(d){var e,f,g,h,i,j,k,l,m;if(null!=d)for(f=100*d.loaded/d.total,g=0,j=a.length;g<j;g++)c=a[g],c.upload={progress:f,total:d.total,bytesSent:d.loaded};else{for(e=!0,f=100,h=0,k=a.length;h<k;h++)c=a[h],100===c.upload.progress&&c.upload.bytesSent===c.upload.total||(e=!1),c.upload.progress=f,c.upload.bytesSent=c.upload.total;if(e)return}for(m=[],i=0,l=a.length;i<l;i++)c=a[i],m.push(b.emit("uploadprogress",c,f,c.upload.bytesSent));return m}}(this),w.onload=function(c){return function(d){var e;if(a[0].status!==b.CANCELED&&4===w.readyState){if(s=w.responseText,w.getResponseHeader("content-type")&&~w.getResponseHeader("content-type").indexOf("application/json"))try{s=JSON.parse(s)}catch(a){d=a,s="Invalid JSON response from server."}return t(),200<=(e=w.status)&&e<300?c._finished(a,s,d):g()}}}(this),w.onerror=function(c){return function(){if(a[0].status!==b.CANCELED)return g()}}(this),r=null!=(G=w.upload)?G:w,r.onprogress=t,j={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&d(j,this.options.headers);for(h in j)i=j[h],w.setRequestHeader(h,i);if(f=new FormData,this.options.params){H=this.options.params;for(o in H)v=H[o],f.append(o,v)}for(y=0,C=a.length;y<C;y++)c=a[y],this.emit("sending",c,w,f);if(this.options.uploadMultiple&&this.emit("sendingmultiple",a,w,f),"FORM"===this.element.tagName)for(I=this.element.querySelectorAll("input, textarea, select, button"),z=0,D=I.length;z<D;z++)if(l=I[z],m=l.getAttribute("name"),n=l.getAttribute("type"),"SELECT"===l.tagName&&l.hasAttribute("multiple"))for(J=l.options,A=0,E=J.length;A<E;A++)q=J[A],q.selected&&f.append(m,q.value);else(!n||"checkbox"!==(K=n.toLowerCase())&&"radio"!==K||l.checked)&&f.append(m,l.value);for(k=F=0,L=a.length-1;0<=L?F<=L:F>=L;k=0<=L?++F:--F)f.append(this._getParamName(k),a[k],a[k].name);return w.send(f)},b.prototype._finished=function(a,c,d){var e,f,g;for(f=0,g=a.length;f<g;f++)e=a[f],e.status=b.SUCCESS,this.emit("success",e,c,d),this.emit("complete",e);if(this.options.uploadMultiple&&(this.emit("successmultiple",a,c,d),this.emit("completemultiple",a)),this.options.autoProcessQueue)return this.processQueue()},b.prototype._errorProcessing=function(a,c,d){var e,f,g;for(f=0,g=a.length;f<g;f++)e=a[f],e.status=b.ERROR,this.emit("error",e,c,d),this.emit("complete",e);if(this.options.uploadMultiple&&(this.emit("errormultiple",a,c,d),this.emit("completemultiple",a)),this.options.autoProcessQueue)return this.processQueue()},b}(c),a.version="4.0.1",a.options={},a.optionsForElement=function(b){return b.getAttribute("id")?a.options[d(b.getAttribute("id"))]:void 0},a.instances=[],a.forElement=function(a){if("string"==typeof a&&(a=document.querySelector(a)),null==(null!=a?a.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return a.dropzone},a.autoDiscover=!0,a.discover=function(){var b,c,d,e,f,g;for(document.querySelectorAll?d=document.querySelectorAll(".dropzone"):(d=[],b=function(a){var b,c,e,f;for(f=[],c=0,e=a.length;c<e;c++)b=a[c],/(^| )dropzone($| )/.test(b.className)?f.push(d.push(b)):f.push(void 0);return f},b(document.getElementsByTagName("div")),b(document.getElementsByTagName("form"))),g=[],e=0,f=d.length;e<f;e++)c=d[e],a.optionsForElement(c)!==!1?g.push(new a(c)):g.push(void 0);return g},a.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],a.isBrowserSupported=function(){var b,c,d,e,f;if(b=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(f=a.blacklistedBrowsers,d=0,e=f.length;d<e;d++)c=f[d],c.test(navigator.userAgent)&&(b=!1);else b=!1;else b=!1;return b},i=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;d<e;d++)c=a[d],c!==b&&f.push(c);return f},d=function(a){return a.replace(/[\-_](\w)/g,function(a){return a.charAt(1).toUpperCase()})},a.createElement=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.childNodes[0]},a.elementInside=function(a,b){if(a===b)return!0;for(;a=a.parentNode;)if(a===b)return!0;return!1},a.getElement=function(a,b){var c;if("string"==typeof a?c=document.querySelector(a):null!=a.nodeType&&(c=a),null==c)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector or a plain HTML element.");return c},a.getElements=function(a,b){var c,d,e,f,g,h,i,j;if(a instanceof Array){e=[];try{for(f=0,h=a.length;f<h;f++)d=a[f],e.push(this.getElement(d,b))}catch(a){c=a,e=null}}else if("string"==typeof a)for(e=[],j=document.querySelectorAll(a),g=0,i=j.length;g<i;g++)d=j[g],e.push(d);else null!=a.nodeType&&(e=[a]);if(null==e||!e.length)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return e},a.confirm=function(a,b,c){return window.confirm(a)?b():null!=c?c():void 0},a.isValidFile=function(a,b){var c,d,e,f,g;if(!b)return!0;for(b=b.split(","),d=a.type,c=d.replace(/\/.*$/,""),f=0,g=b.length;f<g;f++)if(e=b[f],e=e.trim(),"."===e.charAt(0)){if(a.name.toLowerCase().indexOf(e.toLowerCase(),a.name.length-e.length)!==-1)return!0}else if(/\/\*$/.test(e)){if(c===e.replace(/\/.*$/,""))return!0}else if(d===e)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(b){return this.each(function(){return new a(this,b)})}),"undefined"!=typeof b&&null!==b?b.exports=a:window.Dropzone=a,a.ADDED="added",a.QUEUED="queued",a.ACCEPTED=a.QUEUED,a.UPLOADING="uploading",a.PROCESSING=a.UPLOADING,a.CANCELED="canceled",a.ERROR="error",a.SUCCESS="success",f=function(a){var b,c,d,e,f,g,h,i,j,k;for(h=a.naturalWidth,g=a.naturalHeight,c=document.createElement("canvas"),c.width=1,c.height=g,d=c.getContext("2d"),d.drawImage(a,0,0),e=d.getImageData(0,0,1,g).data,k=0,f=g,i=g;i>k;)b=e[4*(i-1)+3],0===b?f=i:k=i,i=f+k>>1;return j=i/g,0===j?1:j},g=function(a,b,c,d,e,g,h,i,j,k){var l;return l=f(b),a.drawImage(b,c,d,e,g,h,i,j,k/l)},e=function(a,b){var c,d,e,f,g,h,i,j,k;if(e=!1,k=!0,d=a.document,j=d.documentElement,c=d.addEventListener?"addEventListener":"attachEvent",i=d.addEventListener?"removeEventListener":"detachEvent",h=d.addEventListener?"":"on",f=function(c){if("readystatechange"!==c.type||"complete"===d.readyState)return("load"===c.type?a:d)[i](h+c.type,f,!1),!e&&(e=!0)?b.call(a,c.type||c):void 0},g=function(){var a;try{j.doScroll("left")}catch(b){return a=b,void setTimeout(g,50)}return f("poll")},"complete"!==d.readyState){if(d.createEventObject&&j.doScroll){try{k=!a.frameElement}catch(a){}k&&g()}return d[c](h+"DOMContentLoaded",f,!1),d[c](h+"readystatechange",f,!1),a[c](h+"load",f,!1)}},a._autoDiscoverFunction=function(){if(a.autoDiscover)return a.discover()},e(window,a._autoDiscoverFunction)}).call(this)},{}],458:[function(a,b,c){!function(a){function b(a,b){return"function"==typeof a?a.call(b):a}function c(a){for(;a=a.parentNode;)if(a==document)return!0;return!1}function d(b,c){this.$element=a(b),this.options=c,this.enabled=!0,this.fixTitle()}var e=6;d.prototype={show:function(){var c=this.getTitle();if(c&&this.enabled){var d=this.tip();d.find(".tipsy-inner")[this.options.html?"html":"text"](c),d[0].className="tipsy",d.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body),this.options.className&&d.addClass(b(this.options.className,this.$element[0]));var f,g=a.extend({},this.$element.offset(),{width:this.$element[0].getBoundingClientRect().width,height:this.$element[0].getBoundingClientRect().height}),h=d[0].offsetWidth,i=d[0].offsetHeight,j=b(this.options.gravity,this.$element[0]);switch(j.charAt(0)){case"n":f={top:g.top+g.height+this.options.offset,left:g.left+g.width/2-h/2},mo={top:parseInt(g.top+g.height+this.options.offset+e),opacity:this.options.opacity};break;case"s":f={top:g.top-i-this.options.offset,left:g.left+g.width/2-h/2},mo={top:parseInt(g.top-i-this.options.offset-e),opacity:this.options.opacity};break;case"e":f={top:g.top+g.height/2-i/2,left:g.left-h-this.options.offset},mo={left:parseInt(g.left-h-this.options.offset-e),opacity:this.options.opacity};break;case"w":f={top:g.top+g.height/2-i/2,left:g.left+g.width+this.options.offset},mo={left:parseInt(g.left+g.width+this.options.offset+e),opacity:this.options.opacity}}2==j.length&&("w"==j.charAt(1)?f.left=g.left+g.width/2-15:f.left=g.left+g.width/2-h+15),d.css(f).addClass("tipsy-"+j),d.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+j.charAt(0),this.options.fade?d.stop().css({opacity:0,display:"block",visibility:"visible"}).animate(mo,200):d.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){switch(gravity=b(this.options.gravity,this.$element[0]),gravity.charAt(0)){case"n":mo={top:parseInt(this.tip().css("top"))+e,opacity:0};break;case"s":mo={top:parseInt(this.tip().css("top"))-e,opacity:0};break;case"e":mo={left:parseInt(this.tip().css("left"))-e,opacity:0};break;case"w":mo={left:parseInt(this.tip().css("left"))+e,opacity:0}}this.options.fade?this.tip().stop().animate(mo,200,function(){a(this).remove()}):this.tip().remove()},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("original-title"))&&a.attr("original-title",a.attr("title")||"").removeAttr("title")},getTitle:function(){var a,b=this.$element,c=this.options;this.fixTitle();var a,c=this.options;return"string"==typeof c.title?a=b.attr("title"==c.title?"original-title":c.title):"function"==typeof c.title&&(a=c.title.call(b[0])),a=(""+a).replace(/(^\s*|\s*$)/,""),a||c.fallback},tip:function(){return this.$tip||(this.$tip=a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},remove:function(){this.enabled=!1,this.$tip&&this.$tip.remove()},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled;
}},a.fn.tipsy=function(b){function c(c){var e=a.data(c,"tipsy");return e||(e=new d(c,a.fn.tipsy.elementOptions(c,b)),a.data(c,"tipsy",e)),e}function e(){var a=c(this);a.hoverState="in",0==b.delayIn?a.show():(a.fixTitle(),setTimeout(function(){"in"==a.hoverState&&a.show()},b.delayIn))}function f(){var a=c(this);a.hoverState="out",0==b.delayOut?a.hide():setTimeout(function(){"out"==a.hoverState&&a.hide()},b.delayOut)}if(b===!0)return this.data("tipsy");if("string"==typeof b){var g=this.data("tipsy");return g&&g[b](),this}if(b=a.extend({},a.fn.tipsy.defaults,b),b.live||this.each(function(){c(this)}),"manual"!=b.trigger){var h=b.live?"live":"bind",i="hover"==b.trigger?"mouseenter":"focus",j="hover"==b.trigger?"mouseleave":"blur";this[h](i,e)[h](j,f)}return this},a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},a.fn.tipsy.revalidate=function(){a(".tipsy").each(function(){var b=a.data(this,"tipsy-pointee");b&&c(b)||a(this).remove()})},a.fn.tipsy.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c},a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"},a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"},a.fn.tipsy.autoBounds=function(b,c){return function(){var d={ns:c[0],ew:c.length>1&&c[1]},e=a(document).scrollTop()+b,f=a(document).scrollLeft()+b,g=a(this);return g.offset().top<e&&(d.ns="n"),g.offset().left<f&&(d.ew="w"),a(window).width()+a(document).scrollLeft()-g.offset().left<b&&(d.ew="e"),a(window).height()+a(document).scrollTop()-g.offset().top<b&&(d.ns="s"),d.ns+(d.ew?d.ew:"")}}}(jQuery)},{}],459:[function(a,b,c){!function(a){a.widget("ui.tagit",{options:{allowDuplicates:!1,caseSensitive:!0,fieldName:"tags",placeholderText:null,readOnly:!1,removeConfirmation:!1,tagLimit:null,availableTags:[],autocomplete:{},showAutocompleteOnFocus:!1,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,animate:!0,tabIndex:null,beforeTagAdded:null,afterTagAdded:null,beforeTagRemoved:null,afterTagRemoved:null,onTagClicked:null,onTagLimitExceeded:null,onTagAdded:null,onTagRemoved:null,tagSource:null,onSubmitTags:null,onFocus:null,onBlur:null},_create:function(){var b=this;this.element.is("input")?(this.tagList=a("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.addClass("tagit-hidden-field")):this.tagList=this.element.find("ul, ol").andSelf().last(),this.tagInput=a('<input type="text" />').addClass("ui-widget-content"),this.options.readOnly&&this.tagInput.attr("disabled","disabled"),this.options.tabIndex&&this.tagInput.attr("tabindex",this.options.tabIndex),this.options.placeholderText&&this.tagInput.attr("placeholder",this.options.placeholderText),this.options.autocomplete.source||(this.options.autocomplete.source=function(b,c){var d=b.term.toLowerCase(),e=a.grep(this.options.availableTags,function(a){return 0===a.toLowerCase().indexOf(d)});this.options.allowDuplicates||(e=this._subtractArray(e,this.assignedTags())),c(e)}),this.options.showAutocompleteOnFocus&&(this.tagInput.focus(function(a,c){b._showAutocomplete()}),"undefined"==typeof this.options.autocomplete.minLength&&(this.options.autocomplete.minLength=0)),a.isFunction(this.options.autocomplete.source)&&(this.options.autocomplete.source=a.proxy(this.options.autocomplete.source,this)),a.isFunction(this.options.tagSource)&&(this.options.tagSource=a.proxy(this.options.tagSource,this)),this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(a('<li class="tagit-new"></li>').append(this.tagInput)).click(function(c){var d=a(c.target);if(d.hasClass("tagit-label")){var e=d.closest(".tagit-choice");e.hasClass("removed")||b._trigger("onTagClicked",c,{tag:e,tagLabel:b.tagLabel(e)})}else b.tagInput.focus()});var c=!1;if(this.options.singleField)if(this.options.singleFieldNode){var d=a(this.options.singleFieldNode),e=d.val().split(this.options.singleFieldDelimiter);d.val(""),a.each(e,function(a,d){b.createTag(d,null,!0),c=!0})}else this.options.singleFieldNode=a('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />'),this.tagList.after(this.options.singleFieldNode);if(c||this.tagList.children("li").each(function(){a(this).hasClass("tagit-new")||(b.createTag(a(this).text(),a(this).attr("class"),!0),a(this).remove())}),this.tagInput.keydown(function(c){if(c.which==a.ui.keyCode.BACKSPACE&&""===b.tagInput.val()){var d=b._lastTag();!b.options.removeConfirmation||d.hasClass("remove")?b.removeTag(d):b.options.removeConfirmation&&d.addClass("remove ui-state-highlight")}else b.options.removeConfirmation?b._lastTag().removeClass("remove ui-state-highlight"):c.which==a.ui.keyCode.ENTER&&""===b.tagInput.val()&&b._trigger("onSubmitTags",null,b.tagList);(c.which===a.ui.keyCode.COMMA&&c.shiftKey===!1||c.which===a.ui.keyCode.ENTER||c.which==a.ui.keyCode.TAB&&""!==b.tagInput.val()||c.which==a.ui.keyCode.SPACE&&b.options.allowSpaces!==!0&&('"'!=a.trim(b.tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==a.trim(b.tagInput.val()).charAt(0)&&'"'==a.trim(b.tagInput.val()).charAt(a.trim(b.tagInput.val()).length-1)&&a.trim(b.tagInput.val()).length-1!==0))&&(c.which===a.ui.keyCode.ENTER&&""===b.tagInput.val()||c.preventDefault(),b.options.autocomplete.autoFocus&&b.tagInput.data("autocomplete-open")||(b.tagInput.autocomplete("close"),b.createTag(b._cleanedInput())))}).blur(function(a){b._trigger("onBlur",null,null),b.tagInput.data("autocomplete-open")||b.createTag(b._cleanedInput())}).focus(function(a){b._trigger("onFocus",null,null)}),this.options.availableTags||this.options.tagSource||this.options.autocomplete.source){var f={select:function(a,c){return b.createTag(c.item.value),!1}};a.extend(f,this.options.autocomplete),f.source=this.options.tagSource||f.source,this.tagInput.autocomplete(f).bind("autocompleteopen.tagit",function(a,c){b.tagInput.data("autocomplete-open",!0)}).bind("autocompleteclose.tagit",function(a,c){b.tagInput.data("autocomplete-open",!1)}),this.tagInput.autocomplete("widget").addClass("tagit-autocomplete")}},destroy:function(){return a.Widget.prototype.destroy.call(this),this.element.unbind(".tagit"),this.tagList.unbind(".tagit"),this.tagInput.removeData("autocomplete-open"),this.tagList.removeClass(["tagit","ui-widget","ui-widget-content","ui-corner-all","tagit-hidden-field"].join(" ")),this.element.is("input")?(this.element.removeClass("tagit-hidden-field"),this.tagList.remove()):(this.element.children("li").each(function(){a(this).hasClass("tagit-new")?a(this).remove():(a(this).removeClass(["tagit-choice","ui-widget-content","ui-state-default","ui-state-highlight","ui-corner-all","remove","tagit-choice-editable","tagit-choice-read-only"].join(" ")),a(this).text(a(this).children(".tagit-label").text()))}),this.singleFieldNode&&this.singleFieldNode.remove()),this},_cleanedInput:function(){return a.trim(this.tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.find(".tagit-choice:last:not(.removed)")},_tags:function(){return this.tagList.find(".tagit-choice:not(.removed)")},assignedTags:function(){var b=this,c=[];return this.options.singleField?(c=a(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),""===c[0]&&(c=[])):this._tags().each(function(){c.push(b.tagLabel(this))}),c},_updateSingleTagsField:function(b){a(this.options.singleFieldNode).val(b.join(this.options.singleFieldDelimiter)).trigger("change")},_subtractArray:function(b,c){for(var d=[],e=0;e<b.length;e++)a.inArray(b[e],c)==-1&&d.push(b[e]);return d},tagLabel:function(b){return this.options.singleField?a(b).find(".tagit-label:first").text():a(b).find("input:first").val()},_showAutocomplete:function(){this.tagInput.autocomplete("search","")},_findTagByLabel:function(b){var c=this,d=null;return this._tags().each(function(e){if(c._formatStr(b)==c._formatStr(c.tagLabel(this)))return d=a(this),!1}),d},_isNew:function(a){return!this._findTagByLabel(a)},_formatStr:function(b){return this.options.caseSensitive?b:a.trim(b.toLowerCase())},_effectExists:function(b){return Boolean(a.effects&&(a.effects[b]||a.effects.effect&&a.effects.effect[b]))},createTag:function(b,c,d){var e=this;if(b=a.trim(b),this.options.preprocessTag&&(b=this.options.preprocessTag(b)),""===b)return!1;if(!this.options.allowDuplicates&&!this._isNew(b)){var f=this._findTagByLabel(b);return this._trigger("onTagExists",null,{existingTag:f,duringInitialization:d})!==!1&&this._effectExists("highlight")&&f.effect("highlight"),!1}if(this.options.tagLimit&&this._tags().length>=this.options.tagLimit)return this._trigger("onTagLimitExceeded",null,{duringInitialization:d}),!1;var g=a(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(b),h=a("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(c).append(g);if(this.options.readOnly)h.addClass("tagit-choice-read-only");else{h.addClass("tagit-choice-editable");var i=a("<span></span>").addClass("ui-icon ui-icon-close"),j=a('<a><span class="text-icon"></span></a>').addClass("tagit-close").append(i).click(function(a){e.removeTag(h)});h.append(j)}if(!this.options.singleField){var k=g.html();h.append('<input type="hidden" value="'+k+'" name="'+this.options.fieldName+'" class="tagit-hidden-field" />')}if(this._trigger("beforeTagAdded",null,{tag:h,tagLabel:this.tagLabel(h),duringInitialization:d})!==!1){if(this.options.singleField){var l=this.assignedTags();l.push(b),this._updateSingleTagsField(l)}this._trigger("onTagAdded",null,h),this.tagInput.val(""),this.tagInput.parent().before(h),this._trigger("afterTagAdded",null,{tag:h,tagLabel:this.tagLabel(h),duringInitialization:d}),this.options.showAutocompleteOnFocus&&!d&&setTimeout(function(){e._showAutocomplete()},0)}},removeTag:function(b,c){if(c="undefined"==typeof c?this.options.animate:c,b=a(b),this._trigger("onTagRemoved",null,b),this._trigger("beforeTagRemoved",null,{tag:b,tagLabel:this.tagLabel(b)})!==!1){if(this.options.singleField){var d=this.assignedTags(),e=this.tagLabel(b);d=a.grep(d,function(a){return a!=e}),this._updateSingleTagsField(d)}if(c){b.addClass("removed");var f=this._effectExists("blind")?["blind",{direction:"horizontal"},"fast"]:["fast"],g=this;f.push(function(){b.remove(),g._trigger("afterTagRemoved",null,{tag:b,tagLabel:g.tagLabel(b)})}),b.fadeOut("fast").hide.apply(b,f).dequeue()}else b.remove(),this._trigger("afterTagRemoved",null,{tag:b,tagLabel:this.tagLabel(b)})}},removeTagByLabel:function(a,b){var c=this._findTagByLabel(a);if(!c)throw"No such tag exists with the name '"+a+"'";this.removeTag(c,b)},removeAll:function(){var a=this;this._tags().each(function(b,c){a.removeTag(c,!1)})}})}(jQuery)},{}]},{},[380]);
//# sourceMappingURL=dataset.js.map