{"version":3,"sources":["node_modules/browser-pack/_prelude.js","lib/assets/javascripts/cartodb/common/dialogs/export/export_view.js","lib/assets/javascripts/cartodb/common/dialogs/export/public_export_view.js","lib/assets/javascripts/cartodb/common/view_factory.js","lib/assets/javascripts/cartodb/common/view_helpers/random_quote.js","lib/assets/javascripts/cartodb/common/views/base_dialog/view.js","lib/assets/javascripts/cartodb/common/views/likes/view.js","lib/assets/javascripts/cartodb/common/views/mapcard_preview.js","lib/assets/javascripts/cartodb/public_common/user_industries/dropdown_view.js","lib/assets/javascripts/cartodb/public_common/user_industries_view.js","lib/assets/javascripts/cartodb/public_common/user_meta_view.js","lib/assets/javascripts/cartodb/public_common/user_settings/dropdown_view.js","lib/assets/javascripts/cartodb/public_common/user_settings_view.js","lib/assets/javascripts/cartodb/public_table.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_","window","global","$","cdb","BaseDialog","extend","_CSV_FILTER","_MAX_SQL_GET_LENGTH","events","extendEvents","click .js-option:not(.is-disabled)","formats","format","fetcher","geomRequired","illustrationIconModifier","label","initialize","this","options","clean_on_hide","table_id","model","id","elder","bindAll","baseUrl","config","getSqlApiUrl","bind","refresh","getFormat","_export","ev","killEvent","$button","currentTarget","formatName","data","getBaseOptions","filename","get","user_data","api_key","getPlainSql","sql","sqlView","getSQL","getGeomFilteredSql","isGeoreferenced","replace","_fetch","_showElAndHideRest","val","email","god","trigger","location","attr","serialize","_fetchGET","submit","autoClose","close","html","showError","error","getTemplate","msg","url","getError","content","json","JSON","parse","indexOf","checkInterval","self","w","open","onload","clearInterval","document","body","textContent","focus","setInterval","closed","fetch","fetchCSV","removeAttr","fetchSVG","render_content","isBoolean","preparingDownloadContent","_renderLoadingContent","title","quote","editor","randomQuote","classNameToShow","forEach","className","ExportView","click .js-bounds","click .cancel","click .close","set","bounds","_setBoundsCheckbox","_changeBounds","toggleClass","_toggleBounds","split","hasBounds","createDialogByTemplate","templateOrStr","templateData","dialogOptions","createDialogByView","createByTemplate","viewOpts","template","isString","templates","view","core","View","render","$el","createByList","views","listView","clearSubViews","each","addView","append","contentView","enter_to_confirm","el","quotes","author","Math","round","random","ui","common","Dialog","overrideDefaults","template_name","triggerDialogEvents","defaults","_setBodyForDialogMode","show","prototype","apply","arguments","removeClass","activeElement","blur","addClass","_isSticky","sticky","_cancel","undefined","hide","skipCancelCallback","setTimeout","cancel","_ok","ok","action","tagName","click","likes","size","show_count","show_label","class","_classNames","href","_hrefLocation","login_url","classNames","push","_animate","one","join","_toggleLike","toggleLiked","width","height","privacy","username","visId","mapsApiResource","authTokens","_TEMPLATES","regular","cdn","name","console","log","load","_startLoader","_loadFromVisId","_generateImageTemplate","protocol","_isHTTPS","cdnConfig","tpl","_generateAuthTokensParams","_loadImage","map","loadURL","$img","fadeIn","_onError","_stopLoader","_onSuccess","$error","img","Image","onerror","src","err","admin","DropdownMenu","template_base","clean","target","unbind","_handleClick","constructor","__super__","IndustriesDropdown","click .js-dropdown-target","_createDropdown","vertical_offset","horizontal_offset","horizontal_position","tick","on","click .js-Navmenu-editLink--more","$metaList","$moreLink","_toggleMeta","_onClickMoreLink","slideDown","slideUp","user","userUrl","viewUrl","isOrgOwner","dashboardUrl","dashboard","publicProfileUrl","publicProfile","accountSettingsUrl","accountSettings","logoutUrl","logout","SettingsDropdown","datasetsUrl","datasets","mapsUrl","maps","avatarUrl","UserSettingsView","UserIndustriesView","MapCardPreview","LikeView","UserMetaView","PublicExportView","ViewFactory","init","namespace","base_url","Model","active","authenticatedUser","AuthenticatedUser","User","attributes","userSettingsView","owner_username","css","mapCardPreview","find","getMapsResourceName","likeModel","Like","newByVisData","likeable","vis_id","likeView"],"mappings":"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","file":"new_public_table.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null);\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\nvar cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar BaseDialog = require('../../views/base_dialog/view');\n\n/**\n * shows a dialog to get the table exported\n * new ExportDialog({\n *  table: table_model\n * })\n *\n * (Migrated almost-as-is from old editor to not break functionality)\n */\nmodule.exports = BaseDialog.extend({\n\n  _CSV_FILTER: \"SELECT * FROM (%%sql%%) as subq \",\n  _MAX_SQL_GET_LENGTH: 1000,\n  events: BaseDialog.extendEvents({\n    'click .js-option:not(.is-disabled)': '_export'\n  }),\n\n  /**\n   * Allowed formats on the exporter\n   * @type {Array}\n   */\n  formats: [\n    {format: 'csv', fetcher: 'fetchCSV', geomRequired: false, illustrationIconModifier: 'IllustrationIcon--neutral' },\n    {format: 'shp', fetcher: 'fetch', geomRequired: true, illustrationIconModifier: 'IllustrationIcon--magenta' },\n    {format: 'kml', fetcher: 'fetch', geomRequired: true, illustrationIconModifier: 'IllustrationIcon--sunrise' },\n    {format: 'geojson', label: 'geo json', fetcher: 'fetch', geomRequired: true, illustrationIconModifier: 'IllustrationIcon--cyan' },\n    {format: 'svg', fetcher: 'fetchSVG', geomRequired: true, illustrationIconModifier: 'IllustrationIcon--royalDark' }\n  ],\n\n  initialize: function() {\n    _.extend(this.options, {\n      clean_on_hide: true,\n      table_id: this.model.id\n    });\n    this.elder('initialize');\n    _.bindAll(this, '_export');\n    this.baseUrl = cdb.config.getSqlApiUrl();\n    this.model.bind('change:geometry_types', this.refresh, this);\n  },\n\n  /**\n   * search a format based on its name in the format array\n   * @param  {string} format Format name\n   * @return {Object}\n   */\n  getFormat: function(format) {\n    for(var n in this.formats) {\n      if(this.formats[n].format === format) {\n        return this.formats[n]\n      }\n    }\n  },\n\n  /**\n   * Answer to button event and lauchn the export method associated to that format\n   * @param  {Event} ev\n   */\n  _export: function(ev) {\n    this.killEvent(ev);\n    var $button = $(ev.currentTarget);\n    var formatName = $button.data('format');\n    var format = this.getFormat(formatName);\n    this[format.fetcher](formatName);\n  },\n\n\n  /**\n   * Create a dictionary with the options shared between all the methods\n   * @return {Object}\n   */\n  getBaseOptions: function() {\n    var options = {};\n    options.filename = this.model.get('name');\n\n    if (this.options.user_data) {\n      options.api_key = this.options.user_data.api_key;\n    }\n\n    return options;\n  },\n\n  /**\n   * Returns the base sql to retrieve the data\n   * @return {string}\n   */\n  getPlainSql: function() {\n    if(this.options.sql) {\n      sql = this.options.sql;\n    } else {\n      if(this.model.sqlView) {\n        sql = this.model.sqlView.getSQL();\n      } else {\n        sql = \"select * from \" + this.model.get('name')\n      }\n    }\n    return sql;\n  },\n\n  /**\n   * Returns a specific sql filtered by the_geom, used on CSV exports\n   * @return {string}\n   */\n  getGeomFilteredSql: function() {\n    var sql = this.getPlainSql();\n    // if we have \"the_geom\" in our current schema, we apply a custom sql\n    if(this.model.isGeoreferenced()) {\n      return this._CSV_FILTER.replace(/%%sql%%/g, sql);\n    }\n    // Otherwise, we apply regular sql\n    return sql;\n  },\n\n  /**\n   * Populates the hidden form with the format related values and submits them to get the file\n   * @param  {Object} options Base options\n   * @param  {String} sql Sql of the document to be retrieved\n   */\n  _fetch: function(options, sql) {\n    this._showElAndHideRest('.js-preparing-download');\n    this.$('.format').val(options.format);\n    this.$('.q').val(sql);\n    this.$('.filename').val(options.filename);\n    this.$('.api_key').val(options.api_key);\n\n    if (options.format === 'csv') {\n      this.$('.skipfields').val(\"the_geom_webmercator\");\n    } else {\n      this.$('.skipfields').val(\"the_geom,the_geom_webmercator\");\n    }\n\n    if (window.user_data && window.user_data.email) {\n      // Event tracking \"Exported table data\"\n      cdb.god.trigger('metrics', 'export_table', {\n        email: window.user_data.email\n      });\n    }\n\n    // check if the sql is big or not, and send the request as a verb or other. This is a HACK.\n    if (sql.length < this._MAX_SQL_GET_LENGTH) {\n      var location = this.$('form').attr('action') + '?' + this.$('form').serialize()\n      this._fetchGET(location);\n    } else {\n      // I can't find a way of making the iframe trigger load event when its get a form posted,\n      // so we need to leave like it was until\n      this.submit();\n    }\n\n    this.$('.db').attr('disabled', 'disabled');\n    this.$('.skipfields').attr('disabled', 'disabled');\n\n    if (this.options.autoClose) {\n      this.close();\n      this.trigger('generating', this.$('.js-preparing-download').html());\n    }\n\n  },\n\n  showError: function(error) {\n    this.$('.js-error').html(\n      this.getTemplate('common/templates/fail')({\n        msg: error\n      })\n    );\n    this._showElAndHideRest('.js-error');\n  },\n\n  _fetchGET: function(url) {\n    function getError(content) {\n      // sql api returns a json when it fails\n      // but if the browser is running some plugin that\n      // formats it, the window content is the html\n      // so search for the word \"error\"\n      var error = null;\n      try {\n        var json = JSON.parse(content);\n        error = json.error[0];\n      } catch(e) {\n        if (content && content.indexOf('error') !== -1) {\n          error = \"an error occurred\";\n        }\n      }\n      return error;\n    }\n\n    var self = this;\n    var checkInterval;\n\n    var w = window.open(url);\n    w.onload = function() {\n      clearInterval(checkInterval);\n      var error = getError(w.document.body.textContent);\n      if(error) {\n        self.showError(error);\n      } else {\n        self.close();\n      }\n      w.close();\n    };\n    window.focus();\n    checkInterval = setInterval(function check() {\n      // safari needs to check the body because it never\n      // calls onload\n      if (w.closed || (w.document && w.document.body.textContent.length === 0)) {\n        self.close();\n        clearInterval(checkInterval);\n      }\n    }, 100);\n  },\n\n  /**\n   * Submits the form. This method is separated to ease the testing\n   */\n  submit: function() {\n    this.$('form').submit();\n  },\n\n  /**\n   * Base fetch, for the formats that don't require special threatment\n   * @param  {String} formatName\n   */\n  fetch: function(formatName) {\n    var options = this.getBaseOptions();\n    options.format = formatName;\n    var sql = this.getPlainSql();\n    this._fetch(options, sql);\n  },\n\n  /**\n   * Gets the options needed for csv format and fetch the document\n   * @param  {String} formatName\n   */\n  fetchCSV: function() {\n    var options = this.getBaseOptions();\n    options.format = 'csv';\n    var sql = this.getGeomFilteredSql();\n    this.$('.skipfields').removeAttr('disabled');\n    this._fetch(options, sql);\n  },\n  /**\n   * Gets the options needed for svg format and fetch the document\n   * @param  {String} formatName\n   */\n  fetchSVG: function(){\n    this.$('.db').removeAttr('disabled');\n    this.fetch('svg');\n  },\n  /**\n   * Returns the html populated with current data\n   * @return {String}\n   */\n  render_content: function() {\n    var isGeoreferenced = this.model.isGeoreferenced();\n    if (_.isBoolean(isGeoreferenced)) {\n      return this.getTemplate('common/dialogs/export/export_template')({\n        preparingDownloadContent: this._renderLoadingContent('We are preparing your download. Depending on the size, it could take some time.'),\n        formats: this.formats,\n        url: this.baseUrl,\n        isGeoreferenced: isGeoreferenced\n      });\n    } else {\n      return this._renderLoadingContent('Checking georeferences…');\n    }\n  },\n\n  refresh: function() {\n    this.$('.content').html(this.render_content());\n  },\n\n  _renderLoadingContent: function(title) {\n    return this.getTemplate('common/templates/loading')({\n      title: title,\n      quote: cdb.editor.randomQuote()\n    });\n  },\n\n  _showElAndHideRest: function(classNameToShow) {\n    [\n      '.js-start',\n      '.js-preparing-download',\n      '.js-error'\n    ].forEach(function(className) {\n      this.$(className)[ className === classNameToShow ? 'show' : 'hide' ]();\n    }, this);\n  }\n\n});\n","var _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null);\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\nvar cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar ExportView = require('./export_view');\n\n/**\n *  Shows a dialog to get the public table exported\n *\n *  new PublicExportView({\n *    table: table_model\n *  })\n *\n */\nmodule.exports = ExportView.extend({\n\n  // Events have to be extended from export view parent\n  events: {\n    'click .js-option:not(.is-disabled)': '_export',\n    'click .js-bounds': '_changeBounds',\n    'click .cancel': '_cancel',\n    'click .close': '_cancel'\n  },\n\n  initialize: function() {\n    this.elder('initialize');\n    this.model.set('bounds', this.options.bounds);\n    this.model.bind('change:bounds', this._setBoundsCheckbox, this);\n  },\n\n  _changeBounds: function() {\n    this.model.set('bounds', !this.model.get('bounds'));\n  },\n\n  _setBoundsCheckbox: function() {\n    this.$('.js-bounds .Checkbox-input').toggleClass('is-checked', !!this.model.get('bounds'));\n  },\n\n  /**\n   * Toggle the bounds option to download the intersect or all the geometries\n   * @param  {Event} ev\n   */\n  _toggleBounds: function(ev) {\n    this.killEvent(ev);\n    var $button = $(ev.currentTarget);\n    var formatName = $button.data('format');\n    var format = this.getFormat(formatName);\n    this[format.fetcher](formatName);\n  },\n\n  /**\n   * Create a dictionary with the options shared between all the methods\n   * @return {Object}\n   */\n  getBaseOptions: function() {\n    var options = {};\n    options.filename = this.model.get('name');\n\n    // Keep dataset part in user.dataset names\n    if (options.filename.indexOf('.') != -1) {\n      options.filename = options.filename.split('.')[1];\n    }\n    \n    if (this.options.user_data) {\n      options.api_key = this.options.user_data.api_key;\n    }\n\n    return options;\n  },\n\n  /**\n   * Returns the base sql to retrieve the data\n   * @return {string}\n   */\n  getPlainSql: function() {\n    if(this.options.sql) {\n      sql = this.options.sql;\n    } else {\n      if(this.model.sqlView && this.model.get('bounds')) {\n        sql = this.model.sqlView.getSQL();\n      } else {\n        sql = \"select * from \" + this.model.get('name')\n      }\n    }\n    return sql;\n  },\n\n  /**\n   * Returns the html populated with current data\n   * @return {String}\n   */\n  render_content: function() {\n    var isGeoreferenced = this.model.isGeoreferenced();\n    var hasBounds = this.model.get('bounds');\n\n    if (_.isBoolean(isGeoreferenced)) {\n      return this.getTemplate('common/dialogs/export/public_export_template')({\n        preparingDownloadContent: this._renderLoadingContent('We are preparing your download. Depending on the size, it could take some time.'),\n        formats: this.formats,\n        url: this.baseUrl,\n        isGeoreferenced: isGeoreferenced,\n        hasBounds: hasBounds\n      });\n    } else {\n      return this._renderLoadingContent('Checking georeferences…');\n    }\n  }\n\n});\n","var _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null);\nvar cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar BaseDialog = require('./views/base_dialog/view');\n\n/**\n * Convenient factory to create views without having to create new files.\n */\nmodule.exports = {\n\n  createDialogByTemplate: function(templateOrStr, templateData, dialogOptions) {\n    return this.createDialogByView(this.createByTemplate(templateOrStr, templateData), dialogOptions);\n  },\n\n  /**\n   * @return {Object} instance of cdb.core.View, which takes two params of template and templateData\n   */\n  createByTemplate: function(templateOrStr, templateData, viewOpts) {\n    var template = _.isString(templateOrStr) ? cdb.templates.getTemplate(templateOrStr) : templateOrStr;\n\n    var view = new cdb.core.View(viewOpts);\n    view.render = function() {\n      this.$el.html(\n        template(templateData)\n      );\n      return this;\n    };\n\n    return view;\n  },\n\n  /**\n   * Creates a view that holds a list of views to be rendered.\n   * @param {Array} list of View object, i.e. have a render method, $el, and clean method.\n   * @param {Object,undefined} viewOpts view options, .e.g {className: 'Whatever'}\n   * @return {Object} A view\n   */\n  createByList: function(views, viewOpts) {\n    var listView = new cdb.core.View(viewOpts);\n    listView.render = function() {\n      this.clearSubViews();\n      _.each(views, function(view) {\n        this.addView(view);\n        this.$el.append(view.render().$el);\n      }, this);\n      return this;\n    };\n    return listView;\n  },\n\n  createDialogByView: function(contentView, dialogOptions) {\n\n    var options = _.extend({ clean_on_hide: true, enter_to_confirm: true }, dialogOptions);\n\n    return new (BaseDialog.extend({\n      initialize: function() {\n        this.elder('initialize');\n        this.addView(contentView);\n      },\n\n      render_content: function() {\n        return contentView.render().el;\n      }\n    }))(options);\n  }\n};\n","/**\n * Random quote\n */\nmodule.exports = function() {\n\n  var template  = _.template('<p class=\"CDB-Text CDB-Size-medium u-altTextColor\">\"<%= quote %>\"</p><% if (author) { %><p class=\"CDB-Text CDB-Size-medium u-altTextColor u-tSpace\"><em>– <%- author %></em></p><% } %>');\n\n  var quotes = [\n    { quote: \"Geographers never get lost. They just do accidental field work.\", author: \"Nicholas Chrisman\" },\n    { quote: \"Geography is just physics slowed down, with a couple of trees stuck in it.\", author: \"Terry Pratchett\" },\n    { quote: \"Not all those who wander are lost.\", author: \"J. R. R. Tolkien\" },\n    { quote: \"In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City.\", author: \"Jorge Luis Borges\" },\n    { quote: \"X marks the spot\", author: \"Indiana Jones\" },\n    { quote: \"It's turtles all the way down.\", author: null },\n    { quote: \"Remember: no matter where you go, there you are.\", author: null },\n    { quote: \"Without geography, you're nowhere!\", author: \"Jimmy Buffett\" },\n    { quote: \"our earth is a globe / whose surface we probe /<br />no map can replace her / but just try to trace her\", author: \"Steve Waterman\" },\n    { quote: \"Everything happens somewhere.\", author: \"Doctor Who\" },\n    { quote: \"A map is the greatest of all epic poems. Its lines and colors show the realization of great dreams.\", author: \"Gilbert H. Grosvenor\" },\n    { quote: \"Everything is related to everything else,<br />but near things are more related than distant things.\", author: \"Tobler's first law of geography\" },\n    { quote: \"Hic Sunt Dracones\", author: null },\n    { quote: \"Here be dragons\", author: null },\n    { quote: \"Stand in the place where you live / Now face North /<br/>Think about direction / Wonder why you haven't before\", author: \"R.E.M\" },\n    { quote: \"The virtue of maps, they show what can be done with limited space, they foresee that everything can happen therein.\", author: \"José Saramago\" }\n  ];\n\n  var r = Math.round(Math.random() * (quotes.length - 1));\n\n  return template(quotes[r]);\n};\n","var cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null);\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\n\nvar BaseDialog = cdb.ui.common.Dialog;\n\n/**\n * Abstract view for a dialog, a kind of view that takes up the full screen overlaying any previous content.\n *\n * To be extended for a specific use-case.\n * It inherits from CartoDB.js' Dialog view so has some particular behavior/convention of how to be used, see example\n *\n * Example of how to use:\n *   // Extend this view\n *   var MyDialog = BaseDialog.extend({\n *     render_content: function() {\n *       return 'Hello world!';\n *     }\n *   });\n *\n *   // Create instance object.\n *   var dialog = new MyDialog();\n *\n *   // To render & show initially (only to be called once):\n *   dialog.appendToBody();\n */\nmodule.exports = BaseDialog.extend({\n\n  className: 'Dialog is-opening',\n\n  overrideDefaults: {\n    template_name: 'common/views/base_dialog/template',\n    triggerDialogEvents: true\n  },\n\n  initialize: function() {\n    // Override defaults of parent\n    _.defaults(this.options, this.overrideDefaults);\n    this.elder('initialize');\n    this.bind('show', this._setBodyForDialogMode.bind(this, 'add'));\n    this.bind('hide', this._setBodyForDialogMode.bind(this, 'remove'));\n  },\n\n  show: function() {\n    BaseDialog.prototype.show.apply(this, arguments);\n    this.trigger('show');\n    if (this.options.triggerDialogEvents) {\n      cdb.god.trigger('dialogOpened');\n    }\n    this.$el.removeClass('is-closing');\n\n    // Blur current element (e.g. a <a> tag that was clicked to open this window)\n    if (document.activeElement) {\n      document.activeElement.blur();\n    }\n  },\n\n  render: function() {\n    BaseDialog.prototype.render.apply(this, arguments);\n    this.$('.content').addClass('is-newContent');\n\n    if (this._isSticky()) {\n      this.$el.addClass('is-sticky');\n    }\n\n    this.show();\n    return this;\n  },\n\n  _isSticky: function() {\n    return this.options && this.options.sticky;\n  },\n\n  close: function() {\n    this._cancel(undefined, true);\n  },\n\n  /**\n   * @override cdb.ui.common.Dialog.prototype.open for animated opening\n   */\n  open: function() {\n    BaseDialog.prototype.open.apply(this, arguments);\n    this.show();\n  },\n\n  /**\n   * @override cdb.ui.common.Dialog.prototype.hide to implement animation\n   */\n  hide: function() {\n    BaseDialog.prototype.hide.apply(this, arguments);\n    this.trigger('hide');\n  },\n\n  /**\n   * @override cdb.ui.common.Dialog.prototype._cancel to implement animation upon closing the dialog and to handle hide event.\n   */\n  _cancel: function(ev, skipCancelCallback) {\n    if (ev) this.killEvent(ev);\n\n    if (this._isSticky()) {\n      return;\n    }\n\n    this.$el.removeClass('is-opening').addClass('is-closing');\n\n    // Use timeout instead of event listener on animation since the event triggered differs depending on browser\n    // Timing won't perhaps be 100% accurate but it's good enough\n    // The timeout should match the .Dialog.is-closing animation duration.\n    var self = this;\n    setTimeout(function() {\n      // from original _cancel\n      if (self.cancel && !skipCancelCallback) {\n        self.cancel();\n      }\n      BaseDialog.prototype.hide.call(self);\n    }, 80); //ms\n\n    // Trigger events immediately, don't wait for the timeout above\n    this.trigger('hide');\n    if (this.options.triggerDialogEvents) {\n      cdb.god.trigger('dialogClosed');\n    }\n  },\n\n  /**\n   * @override cdb.ui.common.Dialog.prototype._ok to not hide dialog by default if there's an ok method defined.\n   */\n  _ok: function(ev) {\n    this.killEvent(ev);\n    if (this.ok) {\n      this.ok();\n    } else {\n      this.close();\n    }\n  },\n\n  _setBodyForDialogMode: function(action) {\n    $('body')[action + 'Class']('is-inDialog');\n  }\n\n});\n","var cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\n\n/**\n * Responsible for likes (♥ 123) and its toggling behaviour.\n */\nmodule.exports = cdb.core.View.extend({\n  tagName: 'a',\n\n  events: {\n    'click': '_toggleLike'\n  },\n\n  initialize: function() {\n    this.template = cdb.templates.getTemplate('common/views/likes/template');\n    this.model.bind('change:likeable change:liked change:likes error', this.render, this);\n  },\n\n  render: function() {\n    this.$el.html(\n      this.template({\n        likes: this.model.get(\"likes\"),\n        size: this.model.get(\"size\"),\n        show_count: this.model.get(\"show_count\"),\n        show_label: this.model.get(\"show_label\")\n      })\n    )\n    .attr({\n      class: this._classNames(),\n      href: this._hrefLocation()\n    });\n\n    return this;\n  },\n\n  _hrefLocation: function() {\n    var href = \"#/like\";\n\n    if (!this.model.get('likeable')) {\n      href = window.login_url;\n    }\n\n    return href;\n  },\n\n  _classNames: function() {\n    var classNames = ['LikesIndicator'];\n\n    if (this.model.get('likeable')) {\n      classNames.push('is-likeable');\n    }\n\n    if (this.model.get('liked')) {\n      classNames.push('is-liked');\n    }\n\n    if (this._animate) {\n      classNames.push('is-animated');\n      this.$el.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function() {\n        // unset animate and force re-render to avoid race conditions\n        this._animate = false;\n        this.render();\n      }.bind(this));\n    }\n\n    return classNames.join(' ');\n  },\n\n  _toggleLike: function(ev) {\n    if (this.model.get('likeable')) {\n      this.killEvent(ev);\n\n      this._animate = true;\n      this.model.toggleLiked();\n    }\n  }\n});\n","var $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\nvar cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null);\n\n/**\n *  MapCard previews\n *\n */\n\nmodule.exports = cdb.core.View.extend({\n\n  options: {\n    width: 300,\n    height: 170,\n    privacy: 'PUBLIC',\n    username: '',\n    visId: '',\n    mapsApiResource: '',\n    className: '',\n    authTokens: []\n  },\n\n  _TEMPLATES: {\n    // Using <%= %> instead of <%- %> because if not / characters (for example) will be escaped\n    regular: '<%- protocol %>://<%= mapsApiResource %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>',\n    cdn: '<%- protocol %>://<%- cdn %>/<%- username %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>'\n  },\n\n  initialize: function() {\n    _.each(['visId', 'mapsApiResource', 'username'], function(name) {\n      if (!this.options[name]) {\n        console.log(name + ' is required for Static Map instantiation');\n      }\n    }, this);\n  },\n\n  load: function() {\n    this._startLoader();\n    this._loadFromVisId();\n\n    return this;\n  },\n\n  _generateImageTemplate: function() {\n    return 'tpl_' + this.options.visId.replace(/-/g, '_');\n  },\n\n  _loadFromVisId: function() {\n    var protocol = this._isHTTPS() ? 'https': 'http';\n    var cdnConfig = cdb.config.get('cdn_url');\n    var template = _.template(cdnConfig ? this._TEMPLATES['cdn'] : this._TEMPLATES['regular']);\n\n    var options = {\n      protocol: protocol,\n      username: this.options.username,\n      mapsApiResource: this.options.mapsApiResource,\n      tpl: this._generateImageTemplate(),\n      width: this.options.width,\n      height: this.options.height,\n      authTokens: this._generateAuthTokensParams()\n    };\n\n    if (cdnConfig) {\n      options = _.extend(options, { cdn: cdnConfig[protocol] });\n    }\n\n    var url = template(options);\n\n    this._loadImage({}, url);\n  },\n\n  _generateAuthTokensParams: function () {\n    var authTokens = this.options.authTokens;\n    if (authTokens && authTokens.length > 0) {\n      return '?' + _.map(authTokens, function (t) { return 'auth_token=' + t; }).join('&');\n    } else {\n      return '';\n    }\n  },\n\n  _isHTTPS: function() {\n    return location.protocol.indexOf(\"https\") === 0;\n  },\n\n  loadURL: function(url) {\n    var $img = $('<img class=\"MapCard-preview\" src=\"' + url + '\" />');\n    this.$el.append($img);\n\n    if (this.options.className) {\n      $img.addClass(this.options.className);\n    }\n\n    $img.fadeIn(250);\n  },\n\n  showError: function() {\n    this._onError();\n  },\n\n  _startLoader: function() {\n    this.$el.addClass(\"is-loading\");\n  },\n\n  _stopLoader: function() {\n    this.$el.removeClass(\"is-loading\");\n  },\n\n  _onSuccess: function(url) {\n    this._stopLoader();\n    this.loadURL(url);\n    this.trigger(\"loaded\", url);\n  },\n\n  _onError: function(error) {\n    this._stopLoader();\n    this.$el.addClass(\"has-error\");\n    var $error = $('<div class=\"MapCard-error\" />');\n    this.$el.append($error);\n    $error.fadeIn(250);\n    this.trigger(\"error\");\n  },\n\n  _loadImage: function(error, url) {\n    var self = this;\n    var img  = new Image();\n\n    img.onerror = function() {\n      self._onError(error);\n    };\n\n    img.onload = function() {\n      self._onSuccess(url);\n    };\n\n    try {\n      img.src = url;\n    } catch(err) {\n      this._onError(err);\n    }\n  }\n\n});\n","var cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\ncdb.admin = (typeof window !== \"undefined\" ? window['cdb']['admin'] : typeof global !== \"undefined\" ? global['cdb']['admin'] : null);\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\n\n/**\n * The content of the dropdown menu opened by the industries link in the header, e.g.:\n *   CartoDB, Industries, Explore, Pricing\n *             ______/\\____\n *            |            |\n *            |    this    |\n *            |____________|\n */\nmodule.exports = cdb.admin.DropdownMenu.extend({\n  className: 'CDB-Text Dropdown Dropdown--public',\n\n  initialize: function() {\n    this.elder('initialize');\n    this.template_base = cdb.templates.getTemplate('public_common/user_industries/dropdown_template');\n\n    // Necessary to hide dialog on click outside popup, for example.\n    cdb.god.bind('closeDialogs', this.hide, this);\n  },\n\n  render: function() {\n    this.$el.html(this.template_base());\n\n    // TODO: taken from existing code, how should dropdowns really be added to the DOM?\n    $('body').append(this.el);\n\n    return this;\n  },\n\n  clean: function() {\n    // Until https://github.com/CartoDB/cartodb.js/issues/238 is resolved:\n    $(this.options.target).unbind('click', this._handleClick);\n    this.constructor.__super__.clean.apply(this);\n  }\n\n});\n","var cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar IndustriesDropdown = require('./user_industries/dropdown_view');\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\n\n/**\n * View to render the user industries section in the header.\n * Expected to be created from existing DOM element.\n */\nmodule.exports = cdb.core.View.extend({\n\n  events: {\n    'click .js-dropdown-target': '_createDropdown'\n  },\n\n  _createDropdown: function(ev) {\n    this.killEvent(ev);\n    cdb.god.trigger('closeDialogs');\n\n    var view = new IndustriesDropdown({\n      target: $(ev.target),\n      vertical_offset: -10,\n      horizontal_offset: $(ev.target).width()-100,\n      horizontal_position: 'left',\n      tick: 'center'\n    });\n    view.render();\n\n    view.on('onDropdownHidden', function() {\n      view.clean();\n    }, this);\n\n    view.open();\n  }\n\n});\n","var cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\n\n/**\n * View to interact with the share buttons in the content.\n *\n * - Twitter code from https://dev.twitter.com/web/intents\n *\n */\nmodule.exports = cdb.core.View.extend({\n\n  events: {\n    'click .js-Navmenu-editLink--more': '_onClickMoreLink'\n  },\n\n  initialize: function() {\n    this.$metaList = this.$('.js-PublicMap-metaList--mobile');\n    this.$moreLink = this.$('.js-Navmenu-editLink--more');\n\n    this.model.on(\"change:active\", this._toggleMeta, this);\n  },\n\n  _onClickMoreLink: function(e) {\n    this.model.set('active', !this.model.get('active'));\n  },\n\n  _toggleMeta: function() {\n    if (this.model.get('active')) {\n      this.$moreLink.html('Less info');\n      this.$metaList.slideDown(250);\n    } else {\n      this.$moreLink.html('More info');\n      this.$metaList.slideUp(250);\n    }\n  }\n\n});\n","var cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\ncdb.admin = (typeof window !== \"undefined\" ? window['cdb']['admin'] : typeof global !== \"undefined\" ? global['cdb']['admin'] : null);\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\n\n/**\n * The content of the dropdown menu opened by the user avatar in the top-right of the header, e.g.:\n *   Explore, Learn, ♞\n *             ______/\\____\n *            |            |\n *            |    this    |\n *            |____________|\n */\nmodule.exports = cdb.admin.DropdownMenu.extend({\n  className: 'CDB-Text Dropdown',\n\n  initialize: function() {\n    this.elder('initialize');\n    this.template_base = cdb.templates.getTemplate('public_common/user_settings/dropdown_template');\n\n    // Necessary to hide dialog on click outside popup, for example.\n    cdb.god.bind('closeDialogs', this.hide, this);\n  },\n\n  render: function() {\n    var user = this.model;\n    var userUrl = user.viewUrl();\n\n    this.$el.html(this.template_base({\n      name: user.get('name') || user.get('username'),\n      email: user.get('email'),\n      isOrgOwner: user.isOrgOwner(),\n      dashboardUrl: userUrl.dashboard(),\n      publicProfileUrl: userUrl.publicProfile(),\n      accountSettingsUrl: userUrl.accountSettings(),\n      logoutUrl: userUrl.logout()\n    }));\n\n    // TODO: taken from existing code, how should dropdowns really be added to the DOM?\n    $('body').append(this.el);\n\n    return this;\n  },\n\n  clean: function() {\n    // Until https://github.com/CartoDB/cartodb.js/issues/238 is resolved:\n    $(this.options.target).unbind('click', this._handleClick);\n    this.constructor.__super__.clean.apply(this);\n  }\n\n});\n","var cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar SettingsDropdown = require('./user_settings/dropdown_view');\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\n\n/**\n * View to render the user settings section in the header.\n * Expected to be created from existing DOM element.\n */\nmodule.exports = cdb.core.View.extend({\n\n  events: {\n    'click .js-dropdown-target': '_createDropdown'\n  },\n\n  render: function() {\n    var dashboardUrl = this.model.viewUrl().dashboard();\n    var datasetsUrl = dashboardUrl.datasets();\n    var mapsUrl = dashboardUrl.maps();\n\n    this.$el.html(\n      cdb.templates.getTemplate('public_common/user_settings_template')({\n        avatarUrl: this.model.get('avatar_url'),\n        mapsUrl: mapsUrl,\n        datasetsUrl: datasetsUrl\n      })\n    );\n\n    return this;\n  },\n\n  _createDropdown: function(ev) {\n    this.killEvent(ev);\n    cdb.god.trigger('closeDialogs');\n\n    var view = new SettingsDropdown({\n      target: $(ev.target),\n      model: this.model, // user\n      horizontal_offset: 18\n    });\n    view.render();\n\n    view.on('onDropdownHidden', function() {\n      view.clean();\n    }, this);\n\n    view.open();\n  }\n\n});\n","var $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\nvar cdb = (typeof window !== \"undefined\" ? window['cdb'] : typeof global !== \"undefined\" ? global['cdb'] : null);\nvar UserSettingsView = require('./public_common/user_settings_view');\nvar UserIndustriesView = require('./public_common/user_industries_view');\nvar MapCardPreview = require('./common/views/mapcard_preview');\nvar LikeView = require('./common/views/likes/view');\nvar UserMetaView = require('./public_common/user_meta_view');\n\n/*\n * needed for new modals to be used in older js views,\n * cdb.editor namespace is needed for dependencies in export view\n *\n */\n\ncdb.editor = {\n  PublicExportView: require('./common/dialogs/export/public_export_view'),\n  randomQuote: require('./common/view_helpers/random_quote.js'),\n  ViewFactory: require('./common/view_factory')\n}\n\n$(function() {\n  cdb.init(function() {\n    cdb.templates.namespace = 'cartodb/';\n    cdb.config.set(window.config);\n    cdb.config.set('url_prefix', window.base_url);\n\n    var userIndustriesView = new UserIndustriesView({\n      el: $('.js-user-industries')\n    });\n\n    var userMetaView = new UserMetaView({\n      el: $('.js-user-meta'),\n      model: new cdb.core.Model({\n        active: false\n      })\n    });\n\n    $(document.body).bind('click', function() {\n      cdb.god.trigger('closeDialogs');\n    });\n\n    var authenticatedUser = new cdb.open.AuthenticatedUser();\n    authenticatedUser.bind('change', function() {\n      if (authenticatedUser.get('username')) {\n        var user = new cdb.admin.User(authenticatedUser.attributes);\n        var userSettingsView = new UserSettingsView({\n          el: $('.js-user-settings'),\n          model: user\n        });\n        userSettingsView.render();\n\n        $('.js-login').hide();\n        $('.js-learn').show();\n\n        if (user.get('username') === window.owner_username) {\n          // Show \"Edit in CartoDB\" button if logged user\n          // is the map owner ;)\n          $('.js-edit').css('display', 'inline-block');\n          $('.js-oneclick').hide();\n        }\n      }\n    });\n\n    $('.MapCard').each(function() {\n      var visId = $(this).data('visId');\n      if (visId) {\n        var username = $(this).data('visOwnerName');\n        var mapCardPreview = new MapCardPreview({\n          el: $(this).find('.js-header'),\n          visId: $(this).data('visId'),\n          username: username,\n          mapsApiResource: cdb.config.getMapsResourceName(username)\n        });\n        mapCardPreview.load();\n      }\n    });\n\n    $('.js-likes').each(function() {\n      var likeModel = cdb.admin.Like.newByVisData({\n        likeable: false,\n        vis_id: $(this).data('vis-id'),\n        likes: $(this).data('likes-count'),\n        size: $(this).data('likes-size')\n      });\n      authenticatedUser.bind('change', function() {\n        if (authenticatedUser.get('username')) {\n          likeModel.bind('loadModelCompleted', function() {\n            likeModel.set('likeable', true);\n          });\n          likeModel.fetch();\n        }\n      });\n      var likeView = new LikeView({\n        el: this,\n        model: likeModel\n      });\n      likeView.render();\n    });\n\n    authenticatedUser.fetch();\n  });\n\n});\n"]}