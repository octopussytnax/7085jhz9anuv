/*! v4.7.15 - 2017-05-30 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null;"undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=d.Model.extend({url:function(a){var b=c.config.urlVersion("asset",a);return"/api/"+b+"/users/"+this.userId+"/assets"},fileAttribute:"filename",initialize:function(a,b){if(!b.userId)throw new Error("user id is required");this.userId=b.userId}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./asset_model.js");b.exports=d.core.View.extend({options:{avatarAcceptedExtensions:["jpeg","jpg","png","gif"]},initialize:function(){this.renderModel=this.options.renderModel,this.model=new d.core.Model({state:"idle"}),this.template=d.templates.getTemplate("common/views/avatar_selector_view"),this._initBinds()},render:function(){return this._destroyFileInput(),this.clearSubViews(),this.$el.html(this.template({state:this.model.get("state"),name:this.renderModel.get("name"),inputName:this.renderModel.get("inputName"),avatarURL:this.renderModel.get("avatar_url"),avatarAcceptedExtensions:this._formatAvatarAcceptedExtensions(this.options.avatarAcceptedExtensions)})),this._renderFileInput(),this},_initBinds:function(){_.bindAll(this,"_onInputChange","_onSuccess","_onError"),this.model.bind("change",this.render,this)},_destroyFileInput:function(){var a=this.$(":file");a.unbind("change",this._onInputChange,this),a.filestyle("destroy")},_renderFileInput:function(){var a=this.$(":file"),b={buttonText:"Choose image"};"loading"===this.model.get("state")&&(b.disabled=!0),a.filestyle(b),a.bind("change",this._onInputChange)},_onInputChange:function(){var a=this.$(":file").prop("files"),b=new e(null,{userId:this.renderModel.get("id")});b.save({kind:"orgavatar",filename:a},{success:this._onSuccess,error:this._onError}),this.model.set("state","loading")},_onSuccess:function(a,b){this.renderModel.set("avatar_url",b.public_url),this.model.set("state","success")},_onError:function(){this.model.set("state","error")},clean:function(){this._destroyFileInput(),this.elder("clean")},_formatAvatarAcceptedExtensions:function(a){for(var b=[],c=0;c<a.length;c++)b[c]="image/"+a[c];return b.join(",")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./asset_model.js":1}],3:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./views/base_dialog/view");b.exports=e.extend({options:{authenticityToken:""},events:e.extendEvents({"submit .js-form":"close"}),className:"Dialog is-opening",initialize:function(){this.elder("initialize"),this.template=d.templates.getTemplate("common/views/delete_organization"),this._userModel=this.options.user},render_content:function(){return this.template({formAction:d.config.prefixUrl()+"/organization",authenticityToken:this.options.authenticityToken,passwordNeeded:!!this._userModel.get("needs_password_confirmation")})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./views/base_dialog/view":16}],4:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,g=a("../../views/base_dialog/view.js"),h=a("../../views/paged_search/paged_search_view"),i=a("../../paged_search_model"),j=a("../../view_helpers/random_quote"),k=a("../../../organization/groups_admin/group_users_list_view");b.exports=g.extend({initialize:function(){e.each(["group","orgUsers"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this.elder("initialize"),this.model=new f.core.Model,this.options.orgUsers.excludeCurrentUser(!1),this._initBinds(),this._initViews()},clean:function(){this.options.orgUsers.restoreExcludeCurrentUser(),this.elder("clean")},render:function(){return g.prototype.render.apply(this,arguments),this._onChangeSelected(),this.$(".content").addClass("Dialog-contentWrapper"),this},render_content:function(){switch(this.model.get("state")){case"saving":return this.getTemplate("common/templates/loading")({title:"Adding users to group",quote:j()});case"saveFail":return this.getTemplate("common/templates/fail")({msg:""});default:var a=d(this.getTemplate("common/dialogs/add_group_users/add_group_users")({}));return a.find(".js-dlg-body").replaceWith(this._PagedSearchView.render().el),a}},ok:function(){var a=this._selectedUsers();if(a.length>0){this.model.set("state","saving");var b=e.pluck(a,"id"),c=this;this.options.group.users.addInBatch(b).done(function(){c.options.group.users.add(a),c.close()}).fail(function(){c.model.set("state","saveFail")})}},_initViews:function(){this._PagedSearchView=new h({isUsedInDialog:!0,pagedSearchModel:new i({per_page:50,order:"username"}),collection:this.options.orgUsers,createListView:this._createUsersListView.bind(this)}),this.addView(this._PagedSearchView)},_createUsersListView:function(){return new k({users:this.options.orgUsers})},_initBinds:function(){this.options.orgUsers.on("change:selected",this._onChangeSelected,this),this.add_related_model(this.options.orgUsers),this.model.on("change:state",this.render,this)},_onChangeSelected:function(){this.$(".ok").toggleClass("is-disabled",0===this._selectedUsers().length)},_selectedUsers:function(){return this.options.orgUsers.where({selected:!0})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../organization/groups_admin/group_users_list_view":41,"../../paged_search_model":6,"../../view_helpers/random_quote":15,"../../views/base_dialog/view.js":16,"../../views/paged_search/paged_search_view":26}],5:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,d=function(a){this.name=a||"cartodb",!localStorage.getItem(this.name)&&this.isEnabled()&&localStorage.setItem(this.name,"{}")};d.prototype.isEnabled=function(){try{return localStorage.setItem("checking","test"),localStorage.removeItem("checking"),!0}catch(a){return!1}},d.prototype.get=function(a){if(!this.isEnabled())return!1;if(void 0===a)return JSON.parse(localStorage.getItem(this.name));var b=JSON.parse(localStorage.getItem(this.name));return b[a]},d.prototype.search=function(a){if(!this.isEnabled())return null;var b=JSON.parse(localStorage.getItem(this.name));for(var c in b)if(b[c][a])return b[c][a];return null},d.prototype.set=function(a){if(!this.isEnabled())return null;var b=c.extend(this.get(),a);return localStorage.setItem(this.name,JSON.stringify(b))},d.prototype.add=function(a){return this.set(a)},d.prototype.remove=function(a){if(!this.isEnabled())return null;var b=c.omit(this.get(),a);return localStorage.setItem(this.name,JSON.stringify(b))},d.prototype.destroy=function(){delete localStorage.removeItem(this.name)},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({defaults:{per_page:20,page:1},fetch:function(a){return a.trigger("fetching"),a.fetch({data:this.attributes})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null,e=d.Router.extend({navigate:function(){throw new Error("router.enableAfterMainView({ ... }) must be called before you can navigate")},enableAfterMainView:function(){this.navigate=function(a,b){d.Router.prototype.navigate.call(this,this.normalizeFragmentOrUrl(a),b)},d.history.start({pushState:!0,root:this.rootPath()+"/"})},rootPath:function(){throw new Error("implement rootPath in child router (no trailing slash)")},normalizeFragmentOrUrl:function(a){throw new Error("implement normalizeFragmentOrUrl in child router")}});e.supportTrailingSlashes=function(a){return c.reduce(a,function(a,b,c){return a[c]=b,a[c+"/"]=b,a},{})},b.exports=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(a,b,c){(function(c){var d=a("perfect-scrollbar"),e=a("./scroll.tpl"),f=window.MutationObserver,g="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;b.exports=g.core.View.extend({tagName:"div",className:"ScrollView",initialize:function(a){if(!a.createContentView)throw new Error("A factory createContentView function is required");this.options=a||{},this._type=a.type||"vertical",this._maxScroll=0},render:function(){this.clearSubViews(),this._html();var a=this.options.createContentView.call(this);return this._contentContainer().append(a.render().el),this.addView(a),this._applyScroll(),this._updateScrollWhenExist(),this},_html:function(){this.$el.html(e({type:this._type})),"horizontal"===this._type&&this.$el.addClass("ScrollView--horizontal")},_contentContainer:function(){return this.$(".js-content")},_wrapperContainer:function(){return this.$(".js-wrapper")},_updateScrollWhenExist:function(){if(f){var a=document.body,b=this._wrapperContainer().get(0),c=function(){a.contains(b)&&(d.update(b),e.disconnect())},e=new f(c);c();var g={subtree:!0,childList:!0};e.observe(a,g)}},_applyScroll:function(){d.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,suppressScrollX:"vertical"===this._type,suppressScrollY:"horizontal"===this._type})},destroyScroll:function(){d.destroy(this._wrapperContainer().get(0))},clean:function(){this.destroyScroll(),g.core.View.prototype.clean.call(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./scroll.tpl":9,"perfect-scrollbar":70}],9:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ScrollView-wrapper js-wrapper js-perfect-scroll">\n  <div class="ScrollView-content js-content"></div>\n</div>\n';return __p}},{underscore:94}],10:[function(a,b,c){b.exports=cdb.core.View.extend({initialize:function(){this.user=this.options.user,this.template=cdb.templates.getTemplate("common/views/support_banner")},render:function(){return this.$el.html(this.template({userType:this._getUserType(),orgDisplayEmail:this._getOrgAdminEmail(),isViewer:this.user.isViewer()})),this},_getUserType:function(){var a=this.user.get("account_type").toLowerCase();return this.user.isOrgOwner()?"org_admin":this.user.isInsideOrg()?"org":"internal"===a||"partner"===a||"ambassador"===a?"internal":"free"!==a?"client":"regular"},_getOrgAdminEmail:function(){return this.user.isInsideOrg()?this.user.organization.display_email:null}})},{}],11:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./views/base_dialog/view");b.exports={createDialogByTemplate:function(a,b,c){return this.createDialogByView(this.createByTemplate(a,b),c)},createByTemplate:function(a,b,c){var f=d.isString(a)?e.templates.getTemplate(a):a,g=new e.core.View(c);return g.render=function(){return this.$el.html(f(b)),this},g},createByList:function(a,b){var c=new e.core.View(b);return c.render=function(){return this.clearSubViews(),d.each(a,function(a){this.addView(a),this.$el.append(a.render().$el)},this),this},c},createDialogByView:function(a,b){var c=d.extend({clean_on_hide:!0,enter_to_confirm:!0},b);return new(f.extend({initialize:function(){this.elder("initialize"),this.addView(a)},render_content:function(){return a.render().el}}))(c)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./views/base_dialog/view":16}],12:[function(a,b,c){var d=function(a){return this instanceof d?(this.bytes=a,0==a?this.unit=0:this.unit=parseInt(Math.floor(Math.log(a)/Math.log(1024))),this):new d(a)};d.prototype.size=function(){return this.bytes/Math.pow(1024,this.unit)},d.prototype.UNIT_SUFFIXES=["B","kB","MB","GB","TB"],d.prototype.suffix=function(){return this.UNIT_SUFFIXES[this.unit]},d.prototype.toString=function(a){var b=this.size();if(a){var c=Math.pow(10,a);b=Math.floor(b*c)/c}else b=Math.floor(b);return b+this.suffix()},b.exports=d},{}],13:[function(a,b,c){(function(a){function c(a){return 2===a.which||3===a.which}function d(a){return a.metaKey}function e(a){return a.ctrlKey}var f="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=function(a){this.killEvent(a);var b=f(a.target).closest("a").attr("href");return!!b&&void(c(a)||d(a)?(e(a)||d(a))&&window.open(b,"_blank"):(this.router||this.options.router).navigate(b,{trigger:!0}))}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(a,b,c){var d=function(a,b,c){return 2===arguments.length?d.call(this,arguments[0],arguments[0]+"s",arguments[1]):1===c?a:b};d.prefixWithCount=function(a,b,c){return d("1 "+a,c+" "+b,c)},b.exports=d},{}],15:[function(a,b,c){b.exports=function(){var a=_.template('<p class="CDB-Text CDB-Size-medium u-altTextColor">"<%= quote %>"</p><% if (author) { %><p class="CDB-Text CDB-Size-medium u-altTextColor u-tSpace"><em>– <%- author %></em></p><% } %>'),b=[{quote:"Geographers never get lost. They just do accidental field work.",author:"Nicholas Chrisman"},{quote:"Geography is just physics slowed down, with a couple of trees stuck in it.",author:"Terry Pratchett"},{quote:"Not all those who wander are lost.",author:"J. R. R. Tolkien"},{quote:"In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City.",author:"Jorge Luis Borges"},{quote:"X marks the spot",author:"Indiana Jones"},{quote:"It's turtles all the way down.",author:null},{quote:"Remember: no matter where you go, there you are.",author:null},{quote:"Without geography, you're nowhere!",author:"Jimmy Buffett"},{quote:"our earth is a globe / whose surface we probe /<br />no map can replace her / but just try to trace her",author:"Steve Waterman"},{quote:"Everything happens somewhere.",author:"Doctor Who"},{quote:"A map is the greatest of all epic poems. Its lines and colors show the realization of great dreams.",author:"Gilbert H. Grosvenor"},{quote:"Everything is related to everything else,<br />but near things are more related than distant things.",author:"Tobler's first law of geography"},{quote:"Hic Sunt Dracones",author:null},{quote:"Here be dragons",author:null},{quote:"Stand in the place where you live / Now face North /<br/>Think about direction / Wonder why you haven't before",author:"R.E.M"},{quote:"The virtue of maps, they show what can be done with limited space, they foresee that everything can happen therein.",author:"José Saramago"}],c=Math.round(Math.random()*(b.length-1));return a(b[c])}},{}],16:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null,f=c.ui.common.Dialog;b.exports=f.extend({className:"Dialog is-opening",overrideDefaults:{template_name:"common/views/base_dialog/template",triggerDialogEvents:!0},initialize:function(){d.defaults(this.options,this.overrideDefaults),this.elder("initialize"),this.bind("show",this._setBodyForDialogMode.bind(this,"add")),this.bind("hide",this._setBodyForDialogMode.bind(this,"remove"))},show:function(){f.prototype.show.apply(this,arguments),this.trigger("show"),this.options.triggerDialogEvents&&c.god.trigger("dialogOpened"),this.$el.removeClass("is-closing"),document.activeElement&&document.activeElement.blur()},render:function(){return f.prototype.render.apply(this,arguments),this.$(".content").addClass("is-newContent"),this._isSticky()&&this.$el.addClass("is-sticky"),this.show(),this},_isSticky:function(){return this.options&&this.options.sticky},close:function(){this._cancel(void 0,!0)},open:function(){f.prototype.open.apply(this,arguments),this.show()},hide:function(){f.prototype.hide.apply(this,arguments),this.trigger("hide")},_cancel:function(a,b){if(a&&this.killEvent(a),!this._isSticky()){this.$el.removeClass("is-opening").addClass("is-closing");var d=this;setTimeout(function(){d.cancel&&!b&&d.cancel(),f.prototype.hide.call(d)},80),this.trigger("hide"),this.options.triggerDialogEvents&&c.god.trigger("dialogClosed")}},_ok:function(a){this.killEvent(a),this.ok?this.ok():this.close()},_setBodyForDialogMode:function(a){e("body")[a+"Class"]("is-inDialog")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("../../../view_helpers/navigate_through_router");b.exports=d.admin.DropdownMenu.extend({className:"Dropdown BreadcrumbsDropdown",events:{"click a":"_navigateToLinksHref"},initialize:function(){if(this.elder("initialize"),!this.options.viewModel)throw new Error("viewModel must be provided");this.viewModel=this.options.viewModel,this.router=this.options.router},render:function(){var a=this.model.viewUrl().dashboard(),b=a.datasets(),c=a.deepInsights(),f=a.maps();return this.$el.html(this.template_base({avatarUrl:this.model.get("avatar_url"),userName:this.model.get("username"),mapsUrl:f,datasetsUrl:b,deepInsightsUrl:c,lockedDatasetsUrl:b.lockedItems(),lockedMapsUrl:f.lockedItems(),isDeepInsights:this.viewModel.isDisplayingDeepInsights(),isDatasets:this.viewModel.isDisplayingDatasets(),isMaps:this.viewModel.isDisplayingMaps(),isLocked:this.viewModel.isDisplayingLockedItems()})),d.god.bind("closeDialogs",this.hide,this),e("body").append(this.el),this},_navigateToLinksHref:function(){this.hide(),this.options.router&&f.apply(this,arguments)},clean:function(){e(this.options.target).unbind("click",this._handleClick),this.constructor.__super__.clean.apply(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_helpers/navigate_through_router":13}],18:[function(a,b,c){(function(c){var d=("undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,"undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,"undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null),e=a("./model"),f=a("./organization-model");b.exports=d.Collection.extend({model:function(a,b){return"org_notification"===a.type?new f(a,b):new e(a)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./model":20,"./organization-model":21}],19:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("../../../scroll/scroll-view"),f=a("../../../../common/view_factory");b.exports=d.admin.DropdownMenu.extend({className:"Dropdown",initialize:function(){d.admin.DropdownMenu.prototype.initialize.apply(this,arguments),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(this.template_base()),this._renderDropdown(),this._checkScroll(),$("body").append(this.el),this},_renderDropdown:function(){this.dropdown_content=f.createByTemplate("common/views/dashboard_header/notifications/templates/dropdown_content",{items:this.collection.toJSON(),unreadItems:this.collection.filter(function(a){return!a.get("opened")}).length}),this.addView(this.dropdown_content),this.$(".js-content").html(this.dropdown_content.render().el)},_checkScroll:function(){setTimeout(function(){if(this.$el.height()>=300){var a=new e({createContentView:function(){return this.dropdown_content}.bind(this)});this.addView(a),this.$el.addClass("Dropdown--withScroll"),this.$(".js-content").html(a.render().el)}}.bind(this),301)},_initBinds:function(){d.god.bind("closeDialogs",this.hide,this),this.add_related_model(d.god)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../common/view_factory":11,"../../../scroll/scroll-view":8}],20:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;"undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=c.core.Model.extend({defaults:{type:"",message:"",opened:!1}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],21:[function(a,b,c){var d=a("./model");b.exports=d.extend({url:function(a){return"/api/v3/users/"+this._userId+"/notifications/"+this.id+"?api_key="+this._apiKey},initialize:function(a,b){if(!b.userId)throw new Error("user Id is required");if(!b.apiKey)throw new Error("apiKey is required");this._userId=b.userId,this._apiKey=b.apiKey},markAsRead:function(){this.save({notification:{read_at:new Date}})}})},{"./model":20}],22:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("./collection"),g=a("./dropdown_view");b.exports=d.core.View.extend({attributes:{href:"#/notifications"},tagName:"a",className:"UserNotifications",events:{click:"_openNotifications"},initialize:function(){this.user=this.options.user,this.localStorage=this.options.localStorage,this.template=d.templates.getTemplate("common/views/dashboard_header/notifications/templates/user_notifications"),this.collection=new f,this.collection.reset(this._generateCollection(),{userId:this.user.get("id"),apiKey:this.user.get("api_key"),silent:!0}),this._initBinds()},render:function(){var a=this.collection.filter(function(a){return!a.get("opened")}).length;return this.$el.html(this.template({notificationsCount:a})),this.$el.toggleClass("has--alerts",a>0),this},_initBinds:function(){this.user.bind("change",this._onUserChange,this),this.collection.bind("reset",this.render,this),this.collection.bind("remove",this.render,this),this.add_related_model(this.user),this.add_related_model(this.collection)},_onUserChange:function(){this.collection.reset(this._generateCollection(),{userId:this.user.get("id"),apiKey:this.user.get("api_key")}),this.render()},_generateCollection:function(){var a=[],b={},c=this.user.viewUrl();if(b.isInsideOrg=this.user.isInsideOrg(),b.isOrgOwner=this.user.isOrgOwner(),b.accountType=this.user.get("account_type").toLowerCase(),b.remainingQuota=this.user.get("remaining_byte_quota"),b.publicProfileUrl=c.publicProfile(),b.bytesQuota=this.user.get("quota_in_bytes"),b.userType="regular",b.upgradeUrl=window.upgrade_url||"",b.upgradeContactEmail=this.user.upgradeContactEmail(),b.trialEnd=this.user.get("trial_ends_at")&&moment(this.user.get("trial_ends_at")).format("YYYY-MM-DD"),b.userName=this.user.get("name")||this.user.get("username"),b.isInsideOrg&&!b.isOrgOwner?b.userType="org":b.isOrgOwner?b.userType="admin":"internal"!==b.accountType&&"partner"!==b.accountType&&"ambassador"!==b.accountType||(b.userType="internal"),!b.isInsideOrg&&"free"===b.accountType&&this.user.get("table_count")>0?a.push({iconFont:"CDB-IconFont-gift",severity:"NotificationsDropdown-itemIcon--positive",type:"try_trial",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/try_trial")(b),opened:this.localStorage.get("notification.try_trial")}):this.localStorage.remove("notification.try_trial"),b.remainingQuota<=0?a.push({iconFont:"CDB-IconFont-barometer",severity:"NotificationsDropdown-itemIcon--negative",type:"limits_exceeded",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/limits_exceeded")(b),opened:this.localStorage.get("notification.limits_exceeded")}):this.localStorage.remove("notification.limits_exceeded"),100*b.remainingQuota/b.bytesQuota<20?a.push({iconFont:"CDB-IconFont-barometer",severity:"NotificationsDropdown-itemIcon--alert",type:"close_limits",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/close_limits")(b),opened:this.localStorage.get("notification.close_limits")}):this.localStorage.remove("notification.close_limits"),this.user.get("show_upgraded_message")?a.push({iconFont:"CDB-IconFont-heartFill",severity:"NotificationsDropdown-itemIcon--positive",type:"upgraded_message",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/upgraded_message")(b),opened:this.localStorage.get("notification.upgraded_message")}):this.localStorage.remove("notification.upgraded_message"),this.user.get("show_trial_reminder")?a.push({iconFont:"CDB-IconFont-clock",severity:"NotificationsDropdown-itemIcon--alert",type:"trial_ends_soon",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/trial_ends_soon")(b),opened:this.localStorage.get("notification.trial_ends_soon")}):this.localStorage.remove("notification.trial_ends_soon"),window.organization_notifications)for(var e=0;e<window.organization_notifications.length;e++){var f=window.organization_notifications[e],g=f.icon?"CDB-IconFont-"+f.icon:"CDB-IconFont-alert";a.push({iconFont:g,severity:"NotificationsDropdown-itemIcon--alert",id:f.id,msg:f.html_body,read_at:f.read_at,type:"org_notification"})}return a},_openNotifications:function(a){if(a&&this.killEvent(a),this.notification)return this.notification.hide(),delete this.notification,this;var b=this.notification=new g({target:this.$el,collection:this.collection,horizontal_offset:5,vertical_offset:-5,template_base:"common/views/dashboard_header/notifications/templates/dropdown"});e(b.options.target).unbind("click",b._handleClick),this._closeAnyOtherOpenDialogs(),b.on("onDropdownHidden",function(){this._onDropdownHidden(b)},this),b.render(),b.open(),this.addView(b)},_onDropdownHidden:function(a){var b=this;this.collection.each(function(a){if("org_notification"===a.get("type"))a.markAsRead();else if(a.get("type")){a.set("opened",!0);var c={};c["notification."+a.get("type")]=!0,b.localStorage.set(c)}}),this.collection.reset(),a.clean(),this.removeView(a),this.$el.removeClass("has--alerts"),delete this.notification},_closeAnyOtherOpenDialogs:function(){d.god.trigger("closeDialogs")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./collection":18,"./dropdown_view":19}],23:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("../../view_helpers/bytes_to_size");b.exports=d.admin.DropdownMenu.extend({className:"Dropdown",initialize:function(){if(this.elder("initialize"),!this.model)throw new Error("model is required");this.template_base=d.templates.getTemplate("common/views/dashboard_header/settings_dropdown")},shortDisplayName:function(a){var b=a.get("account_type_display_name"),c=_.isUndefined(b)?a.get("account_type"):b;return _.isUndefined(c)?c:(c=c.toLowerCase(),"organization user"===c?"org. user":c.replace(/lump-sum/gi,"- A").replace(/academic/gi,"aca.").replace(/ - Monthly/i," - M").replace(/ - Annual/i," - A").replace(/Non-Profit/i,"NP").replace(/On-premises/i,"OP").replace(/Internal use engine/i,"engine").replace(/Lite/i,"L").replace(/Cloud Engine &/i,"C. Engine &").replace(/& Enterprise Builder/i,"& E. Builder").replace(/CARTO for /i,"").replace(/CARTO /i,""))},render:function(){var a=this.model,b=a.get("db_size_in_bytes"),c=a.get("quota_in_bytes"),g=Math.round(b/c*100),h="";g>80&&g<90?h="is--inAlert":g>89&&(h="is--inDanger");var i=this.shortDisplayName(a),j=this.model.viewUrl(),k=window.upgrade_url||d.config.get("upgrade_url")||"";return this.$el.html(this.template_base({name:a.get("name")||a.get("username"),email:a.get("email"),accountType:i,isOrgAdmin:a.isOrgAdmin(),usedDataStr:f(b).toString(2),usedDataPct:g,progressBarClass:h,availableDataStr:f(c).toString(2),showUpgradeLink:k&&(a.isOrgOwner()||!a.isInsideOrg())&&!d.config.get("cartodb_com_hosted"),upgradeUrl:k,publicProfileUrl:j.publicProfile(),apiKeysUrl:j.apiKeys(),organizationUrl:j.organization(),accountSettingsUrl:j.accountSettings(),logoutUrl:j.logout(),isViewer:a.isViewer(),isBuilder:a.isBuilder(),orgDisplayEmail:a.isInsideOrg()?a.organization.display_email:null,engineEnabled:a.get("actions").engine_enabled,mobileAppsEnabled:a.get("actions").mobile_sdk_enabled})),d.god.bind("closeDialogs",this.hide,this),e("body").append(this.el),this},clean:function(){e(this.options.target).unbind("click",this._handleClick),this.constructor.__super__.clean.apply(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/bytes_to_size":12}],24:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;"undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=c.core.View.extend({initialize:function(){this.user=this.model,this.template_base=c.templates.getTemplate("common/views/dashboard_header/user_support_template")},render:function(){return this.$el.html(this.template_base({userType:this._getUserType()})),this},_getUserType:function(){var a=this.user.get("account_type").toLowerCase();return this.user.isInsideOrg()?"org":"internal"===a||"partner"===a||"ambassador"===a?"internal":"free"!==a?"client":"regular"}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./dashboard_header/settings_dropdown_view"),g=a("./dashboard_header/breadcrumbs/dropdown_view"),h=a("./dashboard_header/notifications/view"),i=a("./dashboard_header/user_support_view");b.exports=e.core.View.extend({events:{"click .js-breadcrumb-dropdown":"_createBreadcrumbsDropdown","click .js-settings-dropdown":"_createSettingsDropdown"},initialize:function(){if(!this.options.el)throw new Error("el element is required");if(!this.options.viewModel)throw new Error("viewModel is required");this._viewModel=this.options.viewModel,this.router=this.options.router,this._initBinds()},render:function(){return this.clearSubViews(),this._renderBreadcrumbsDropdownLink(),this._renderSupportLink(),this._renderNotifications(),this._renderLogoLink(),this},_initBinds:function(){this._viewModel.bind("change",this._renderBreadcrumbsDropdownLink,this),
this.router&&(this.router.model.bind("change",this._onRouterChange,this),this.add_related_model(this.router.model)),this.collection&&(this.collection.bind("reset",this._stopLogoAnimation,this),this.collection.bind("error",this._onCollectionError,this),this.add_related_model(this.collection)),this.add_related_model(this._viewModel)},_onCollectionError:function(a,b,c){(!b||b&&"abort"!==b.statusText)&&this._stopLogoAnimation()},_onRouterChange:function(a,b){b&&b.changes&&!b.changes.content_type&&this.collection.total_user_entries>0&&this._startLogoAnimation()},_startLogoAnimation:function(){this.$(".Logo").addClass("is-loading")},_stopLogoAnimation:function(){this.$(".Logo").removeClass("is-loading")},_renderBreadcrumbsDropdownLink:function(){this.$(".js-breadcrumb-dropdown").html(e.templates.getTemplate("common/views/dashboard_header/breadcrumbs/dropdown_link")({title:this._viewModel.breadcrumbTitle(),dropdownEnabled:this._viewModel.isBreadcrumbDropdownEnabled()}))},_renderNotifications:function(){var a=new h({user:this.model,localStorage:this.options.localStorage});this.$(".js-user-notifications").html(a.render().el),this.addView(a)},_renderSupportLink:function(){var a=new i({el:d(".js-user-support"),model:this.model});a.render()},_renderLogoLink:function(){var a=e.templates.getTemplate("common/views/dashboard_header/logo");this.$(".js-logo").html(a({homeUrl:this.model.viewUrl().dashboard(),googleEnabled:this.model.featureEnabled("google_maps")}))},_createSettingsDropdown:function(a){this.killEvent(a),this._setupDropdown(new f({target:d(a.target),model:this.model,horizontal_offset:18}))},_createBreadcrumbsDropdown:function(a){this._viewModel.isBreadcrumbDropdownEnabled()&&(this.killEvent(a),this._setupDropdown(new g({target:d(a.target),model:this.model,viewModel:this._viewModel,router:this.router,horizontal_offset:-110,tick:"center",template_base:"common/views/dashboard_header/breadcrumbs/dropdown"})))},_setupDropdown:function(a){this._closeAnyOtherOpenDialogs(),this.addView(a),a.on("onDropdownHidden",function(){a.clean()},this),a.render(),a.open()},_closeAnyOtherOpenDialogs:function(){e.god.trigger("closeDialogs")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./dashboard_header/breadcrumbs/dropdown_view":17,"./dashboard_header/notifications/view":22,"./dashboard_header/settings_dropdown_view":23,"./dashboard_header/user_support_view":24}],26:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,g="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,h=a("../pagination/model"),i=a("../../view_helpers/random_quote"),j=a("../../view_factory"),k=a("../pagination/view");b.exports=d.core.View.extend({events:{"click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","keydown .js-search-input":"_onKeyDown","submit .js-search-form":"killEvent"},initialize:function(){e.each(["collection","pagedSearchModel","createListView"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this.collection=this.options.collection,this.options.noResults=this.options.noResults||{};var a=this.options.pagedSearchModel;this.paginationModel=new h({current_page:a.get("page"),total_count:this.collection.totalCount()||0,per_page:a.get("per_page")}),this.elder("initialize"),this._initBinds(),this.options.pagedSearchModel.fetch(this.collection)},render:function(){return this.clearSubViews(),this._renderContent(this.getTemplate("common/views/paged_search/paged_search")({thinFilters:this.options.thinFilters,q:this.options.pagedSearchModel.get("q")})),this._initViews(),this._$cleanSearchBtn().hide(),this._renderExtraFilters(),this},_renderExtraFilters:function(){this.options.filtersExtrasView&&this.options.filtersExtrasView&&this.$(".js-filters").append(this.options.filtersExtrasView.render().el)},_renderContent:function(a){this.options.isUsedInDialog&&(a=this.getTemplate("common/views/paged_search/paged_search_dialog_wrapper")({htmlToWrap:a})),this.$el.html(a),this.options.isUsedInDialog&&(this.$el.addClass("Dialog-expandedSubContent"),this._$tabPane().addClass("Dialog-bodyInnerExpandedWithSubFooter"))},_initBinds:function(){this.collection.bind("fetching",function(){this._toggleCleanSearchBtn(),this._activatePane("loading")},this),this.collection.bind("error",function(a){(!a||a&&"abort"!==a.statusText)&&this._activatePane("error"),this._toggleCleanSearchBtn()},this),this.collection.bind("reset",function(a){this.paginationModel.set({total_count:this.collection.totalCount(),current_page:this.options.pagedSearchModel.get("page")}),this._activatePane(this.collection.totalCount()>0?"list":"no_results"),this._toggleCleanSearchBtn()},this),this.paginationModel.bind("change:current_page",function(a,b){this.options.pagedSearchModel.set("page",b),this.options.pagedSearchModel.fetch(this.collection)},this),this.add_related_model(this.options.pagedSearchModel),this.add_related_model(this.collection),this.add_related_model(this.paginationModel)},_toggleCleanSearchBtn:function(){this._$cleanSearchBtn().toggle(!!this.options.pagedSearchModel.get("q"))},_initViews:function(){this._panes=new d.ui.common.TabPane({el:this._$tabPane()}),this.addView(this._panes),this._panes.addTab("list",j.createByList([this._createListView(),new k({className:"CDB-Text CDB-Size-medium Pagination Pagination--shareList",model:this.paginationModel})])),this._panes.addTab("error",j.createByTemplate("common/templates/fail",{msg:""})),this._panes.addTab("no_results",j.createByTemplate("common/templates/no_results",{icon:this.options.noResults.icon||"CDB-IconFont-defaultUser",title:this.options.noResults.title||"Oh! No results",msg:this.options.noResults.msg||"Unfortunately we could not find anything with these parameters"})),this._panes.addTab("loading",j.createByTemplate("common/templates/loading",{title:"Searching",quote:i()})),this.options.pagedSearchModel.get("q")&&this._focusSearchInput(),this._activatePane(this._chooseActivePaneName(this.collection.totalCount()))},_createListView:function(){var a=this.options.createListView();return a instanceof d.core.View?a:(d.log.error("createListView function must return a view"),new d.core.View)},_activatePane:function(a){this._panes&&this._panes.size()>0&&this._panes.active(a).render()},_chooseActivePaneName:function(a){return 0===a?"no_results":a>0?"list":"loading"},_focusSearchInput:function(){this._$searchInput().focus().val(this._$searchInput().val())},_onSearchClick:function(a){this.killEvent(a),this._$searchInput().focus()},_onCleanSearchClick:function(a){this.killEvent(a),this._cleanSearch()},_onKeyDown:function(a){var b=a.keyCode==f.ui.keyCode.ENTER,c=a.keyCode==f.ui.keyCode.ESCAPE;b?(this.killEvent(a),this._submitSearch()):c&&(this.killEvent(a),this.options.pagedSearchModel.get("q")&&this._cleanSearch())},_submitSearch:function(a){this._makeNewSearch(g.stripHTML(this._$searchInput().val().trim()))},_cleanSearch:function(){this._$searchInput().val(""),this._makeNewSearch()},_makeNewSearch:function(a){this.options.pagedSearchModel.set({q:a,page:1}),this.options.pagedSearchModel.fetch(this.collection)},_$searchInput:function(){return this.$(".js-search-input")},_$cleanSearchBtn:function(){return this.$(".js-clean-search")},_$tabPane:function(){return this.$(".js-tab-pane")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_factory":11,"../../view_helpers/random_quote":15,"../pagination/model":27,"../pagination/view":28}],27:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=c.core.Model.extend({defaults:{total_count:0,per_page:10,current_page:1,display_count:5,extras_display_count:1,url_to:void 0},pagesCount:function(){return Math.max(Math.ceil(this.get("total_count")/this.get("per_page")),1)},isCurrentPage:function(a){return this.get("current_page")===a},shouldBeVisible:function(){var a=this.pagesCount();return this.get("total_count")>0&&a>1&&this.get("current_page")<=a},urlTo:function(a){if(this.hasUrl())return this.get("url_to")(a)},hasUrl:function(){return"function"==typeof this.get("url_to")},pagesToDisplay:function(){var a;return a=this._inLowRange()?1:this._inHighRange()?this.get("current_page")-this._startOffset():this.pagesCount()-this.get("display_count")+1,a=Math.max(a,1),this._withExtraPages(d.range(a,this._rangeEnd(a)))},_withExtraPages:function(a){var b=this.pagesCount(),c=this.get("extras_display_count"),e=d.range(1,c+1),f=d.range(b-c+1,b+1),g=a[0]-e.slice(-1)[0];2===g?e.push(a[0]-1):g>2&&e.push(-1);var h=f[0]-a.slice(-1);return 2===h&&f.unshift(f[0]-1),h>2&&f.unshift(-2),d.union(e,a,f)},_inLowRange:function(){return this.get("current_page")<this._startOffset()},_inHighRange:function(){return this.get("current_page")<this._highBoundary()},_highBoundary:function(){return this.pagesCount()-this._startOffset()},_startOffset:function(){return Math.floor(this.get("display_count")/2)},_rangeEnd:function(a){return Math.min(a+this.get("display_count"),this.pagesCount()+1)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("../../view_helpers/navigate_through_router");b.exports=d.core.View.extend({className:"Pagination CDB-Text CDB-Size-medium",events:{"click a":"_paginate"},initialize:function(){if(this.template=d.templates.getTemplate("common/views/pagination/template"),this.router=this.options.router,this.router&&!this.model.hasUrl())throw new Error("since router is set the model must have a url method set too");this.model.bind("change",this.render,this)},render:function(){return this.model.shouldBeVisible()?(this.$el.html(this.template({m:this.model,pagesCount:this.model.pagesCount(),currentPage:this.model.get("current_page")})),this.$el.addClass(this.className),this.delegateEvents()):this.$el.html(""),this},_paginate:function(a){this.router?f.apply(this,arguments):this.model.hasUrl()||this.killEvent(a);var b=e(a.target).data("page");this.model.set("current_page",b)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/navigate_through_router":13}],29:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../common/views/base_dialog/view"),f="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null;b.exports=e.extend({events:function(){return f.extend({},e.prototype.events,{"click .js-ok":"_regenerateKeys"})},initialize:function(){this.elder("initialize"),this.template=d.templates.getTemplate("keys/views/regenerate_keys_dialog")},render_content:function(){return this.template({type:this.options.type,scope:this.options.scope,form_action:this.options.form_action,authenticity_token:this.options.authenticity_token,method:this.options.method||"post"})},_regenerateKeys:function(){this.trigger("done"),this.close()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/views/base_dialog/view":16}],30:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=d.core.View.extend({events:{click:"_openPicker"},initialize:function(){this.model=new d.core.Model({color:this.options.color}),this._initBinds()},_initBinds:function(){this.model.bind("change:color",this._onChangeColor,this)},_onChangeColor:function(){var a=this.model.get("color");this.$el.css("background-color",a),this.trigger("colorChosen",a,this)},_createPicker:function(){this.colorPicker=new d.admin.ColorPicker({className:"dropdown color_picker border",target:this.$el,vertical_position:"up",horizontal_position:"left",vertical_offset:5,horizontal_offset:17,tick:"left",dragUpdate:!0}).bind("colorChosen",this._setColor,this),this._bindPicker(),this.addView(this.colorPicker)},_openPicker:function(a){return this.killEvent(a),this.colorPicker?(this._destroyPicker(),!1):void(this.colorPicker||(this._createPicker(),c("body").append(this.colorPicker.render().el),this.colorPicker.init(this.model.get("color"))))},_destroyPicker:function(){this.colorPicker&&(this._unbindPicker(),this.removeView(this.colorPicker),this.colorPicker.hide(),delete this.colorPicker)},_bindPicker:function(){d.god.bind("closeDialogs",this._destroyPicker,this)},_unbindPicker:function(){d.god.unbind("closeDialogs",this._destroyPicker,this)},_setColor:function(a,b){a&&this.model.set("color",a),b&&this._destroyPicker()},clean:function(){this._destroyPicker(),this.elder("clean")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../common/views/base_dialog/view");b.exports=e.extend({options:{authenticityToken:"",organizationUser:{}},className:"Dialog is-opening",initialize:function(){this.elder("initialize"),this.template=d.templates.getTemplate("organization/views/delete_org_user")},render_content:function(){return this.template({username:this.options.organizationUser.get("username"),formAction:d.config.prefixUrl()+"/organization/users/"+this.options.organizationUser.get("username"),authenticityToken:this.options.authenticityToken})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/views/base_dialog/view":16}],32:[function(a,b,c){(function(b){var c="undefined"!=typeof window?window.$:"undefined"!=typeof b?b.$:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof b?b.cdb:null,e=a("../common/views/dashboard_header_view"),f=a("../common/support_view"),g=a("./header_view_model"),h=a("../common/local_storage"),i=a("./organization_user_form"),j=a("./organization_user_quota"),k=a("./delete_org_user_view"),l=a("../common/delete_organization_view"),m=a("../common/avatar_selector_view"),n=a("./color_picker_view"),o=a("./organization_users/organization_users_view"),p=/^[a-zA-Z0-9][a-zA-Z0-9-_]{0,61}[a-zA-Z0-9]{0,1}\.([a-zA-Z]{1,6}|[a-zA-Z0-9-]{1,30}\.[a-zA-Z]{2,3})$/,q=a("../keys/regenerate_keys_dialog_view"),r=a("./groups_admin/router"),s=a("./groups_admin/groups_main_view"),t=a("./flash_message_model"),u=a("./flash_message_view"),v=a("./icon_picker/organization_icon_picker_view"),w=a("./organization_notification/organization_notification_view");window.trackJs&&window.trackJs.configure({userId:window.user_data.username}),c(function(){d.init(function(){var a=this,b=window.user_data,x=window.organization_user_data,y=window.organization_data;d.templates.namespace="cartodb/",d.config.set("url_prefix",b.base_url),d.config.set(window.config),c(document.body).bind("click",function(){d.god.trigger("closeDialogs")});var z,A,B,C=new d.admin.User(b);x&&(z=new d.admin.User(x)),y&&(A=new d.admin.Organization(y),B=A.users);var D=new e({el:c("#header"),model:C,currentUserUrl:C.viewUrl(),viewModel:new g,localStorage:new h});D.render();var E=new t,F=new u({model:E});F.render(),F.$el.insertAfter(D.$el);var G=new f({el:c("#support-banner"),user:C});if(G.render(),this.$(".js-avatarSelector").length>0){var H=new m({el:this.$(".js-avatarSelector"),renderModel:new d.core.Model({inputName:this.$(".js-fileAvatar").attr("name"),name:C.organization.get("name"),avatar_url:C.organization.get("avatar_url"),id:C.get("id")}),avatarAcceptedExtensions:window.avatar_valid_extensions});H.render()}if(c("[data-title]").each(function(a,b){new d.common.TipsyTooltip({el:b,title:function(){return c(this).attr("data-title")}})}),this.$(".js-colorPicker").length>0&&new n({el:this.$(".js-colorPicker"),color:this.$(".js-colorPicker").data("color")}).bind("colorChosen",function(a){this.$(".js-colorInput").val(a)},this),this.$(".js-iconPicker").length>0&&(this.icon_picker_view=new v({el:this.$(".js-iconPicker"),orgId:C.organization.get("id")})),this.$(".js-domains").length>0&&this.$(".js-domainsList").tagit({allowSpaces:!1,singleField:!0,singleFieldNode:this.$(".js-whitelist"),fieldName:this.$(".js-whitelist").attr("name"),tagLimit:10,readOnly:!1,onBlur:function(){a.$(".js-domains").removeClass("is-focus"),c(".tagit-choice").length>0?c(".js-placeholder").hide():c(".js-placeholder").show(),c(".tagit-new").length>0&&c(".tagit-new input").val("")},onFocus:function(){a.$(".js-domains").addClass("is-focus"),c(".js-placeholder").hide()},beforeTagAdded:function(a,b){return!!p.test(b.tagLabel)&&void(c(".tagit-choice").length>0?c(".js-placeholder").hide():c(".js-placeholder").show())},afterTagAdded:function(a,b){c(".tagit-choice").length>0?c(".js-placeholder").hide():c(".js-placeholder").show()}}),z&&(this.organization_user_form=new i({el:this.$(".js-organizationUserForm"),model:z})),z&&(this.organization_user_quota=new j({el:this.$(".js-userQuota"),model:z})),1===this.$(".js-orgUsersList").length&&(this.organizationUsersView=new o({el:this.$(".js-orgUsersList"),organization:A,organizationUsers:B,currentUser:C}),this.organizationUsersView.render()),this.$(".js-deleteAccount").length>0&&window.authenticity_token&&this.$(".js-deleteAccount").click(function(a){a&&a.preventDefault(),new k({organizationUser:z,authenticityToken:window.authenticity_token,clean_on_hide:!1}).appendToBody()}),this.$(".js-deleteOrganization").length>0&&window.authenticity_token&&this.$(".js-deleteOrganization").click(function(a){a&&a.preventDefault(),new l({authenticityToken:window.authenticity_token,clean_on_hide:!0,user:C}).appendToBody()}),this.$(".js-OrganizationNotification").length>0){var I=c("[name=authenticity_token][value]").get(0).value;this.organization_notification_view=new w({el:this.$(".js-OrganizationNotification"),authenticityToken:I}),this.organization_notification_view.render()}var J=function(a,b,d){a&&a.preventDefault();var e=c("[name=authenticity_token][value]").get(0).value,f=new q({type:"api",scope:b,form_action:d,authenticity_token:e});f.appendToBody()},K=function(){var a=c(".js-userViewerOption:checked").val();"true"===a?(c(".user-quotas").hide(),c(".js-org-admin-row").hide(),c("#org_admin").prop("checked",!1)):(c(".user-quotas").show(),c(".js-org-admin-row").show())};K(),c(".js-userViewerOption").bind("change",function(a){K()}),c(".js-regenerateOrgUsersApiKey").bind("click",function(a){var b=c(this).attr("data-current_username");J(a,"organization","/u/"+b+"/organization/regenerate_api_keys")}),c(".js-regenerateOrgUserApiKey").bind("click",function(a){var b=c(this).attr("data-username"),d=c(this).attr("data-current_username");J(a,"organization_user","/u/"+d+"/organization/users/"+b+"/regenerate_api_key")});var L=c(".js-groups-content");if(L){if(!C.isOrgAdmin())return window.location=C.viewUrl().accountSettings(),!1;var M=new d.admin.OrganizationGroups([],{organization:C.organization}),N=new r({rootUrl:C.viewUrl().organization().groups(),flashMessageModel:E,groups:M,user:C}),O=new s({el:L,groups:M,router:N,user:C});O.render(),window.groups=O,N.enableAfterMainView()}})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/avatar_selector_view":2,"../common/delete_organization_view":3,"../common/local_storage":5,"../common/support_view":10,"../common/views/dashboard_header_view":25,"../keys/regenerate_keys_dialog_view":29,"./color_picker_view":30,"./delete_org_user_view":31,"./flash_message_model":33,"./flash_message_view":34,"./groups_admin/groups_main_view":46,"./groups_admin/router":47,"./header_view_model":49,"./icon_picker/organization_icon_picker_view":56,"./organization_notification/organization_notification_view":60,"./organization_user_form":62,"./organization_user_quota":63,"./organization_users/organization_users_view":69}],33:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({defaults:{msg:"",display:!1},shouldDisplay:function(){return this.get("display")&&!!this.get("msg")},show:function(a){return this.set({display:!0,msg:a})},hide:function(){this.set("display",!1)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({className:"FlashMessage FlashMessage--error CDB-Text",initialize:function(){if(!this.model)throw new Error("model is required");this._template=c.templates.getTemplate("organization/flash_message"),this.model.on("change",this.render,this)},render:function(){return this.$el.toggle(this.model.shouldDisplay()),this.$el.html(this._html()),this},_html:function(){return this._template({str:this.model.get("msg")})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("../../common/dialogs/add_group_users/add_group_users_view"),g=a("../../common/view_factory"),h=a("../../common/view_helpers/random_quote");b.exports=e.core.View.extend({className:"Filters-group",events:{"click .js-add-users":"_onClickAddUsers","click .js-rm-users":"_onClickRemoveUsers"},initialize:function(){d.each(["group","orgUsers"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this.options.group.users.on("change:selected",this._onChangeSelectedUser,this),this.options.group.users.on("add remove reset",this.render,this),this.add_related_model(this.options.group.users)},render:function(){return this.$el.html(this.getTemplate("organization/groups_admin/add_or_remove_group_users_filters_extra")({})),this},_onClickAddUsers:function(a){this.killEvent(a),this._openAddGroupsUsersDialog()},_openAddGroupsUsersDialog:function(){var a=new f({group:this.options.group,orgUsers:this.options.orgUsers});a.appendToBody()},_onChangeSelectedUser:function(){var a=this._selectedUsers().length>0;this.$(".js-add-users").toggle(!a),this.$(".js-rm-users").toggle(a)},_onClickRemoveUsers:function(a){this.killEvent(a);var b=this._selectedUsers();if(b.length>0){var c=d.pluck(b,"id"),e=g.createDialogByTemplate("common/templates/loading",{title:"Removing users",quote:h()});e.appendToBody(),this.options.group.users.removeInBatch(c).always(function(){e.close()}).fail(function(){var a=g.createDialogByTemplate("common/templates/fail",{msg:""});a.appendToBody()})}},_selectedUsers:function(){return this.options.group.users.where({selected:!0})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/dialogs/add_group_users/add_group_users_view":4,"../../common/view_factory":11,"../../common/view_helpers/random_quote":15}],36:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("../../common/view_helpers/random_quote");b.exports=e.core.View.extend({tagName:"form",events:{"click .js-create":"_onClickCreate","submit form":"_onClickCreate","keyup .js-name":"_onChangeName"},initialize:function(){d.each(["group","onCreated","flashMessageModel"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this.model=new e.core.Model,this._initBinds()},render:function(){return this.model.get("isLoading")?this.$el.html(this.getTemplate("common/templates/loading")({title:"Creating group",quote:f()})):this.$el.html(this.getTemplate("organization/groups_admin/create_group")({})),this},_initBinds:function(){this.model.on("change:isLoading",this.render,this)},_onClickCreate:function(a){this.killEvent(a);var b=this._name();b&&(this.model.set("isLoading",!0),this.options.group.save({display_name:b},{wait:!0,success:this.options.onCreated,error:this._showErrors.bind(this)}))},_showErrors:function(a,b,c){this.model.set("isLoading",!1);var d;try{d=b&&JSON.parse(b.responseText).errors.join(". ")}catch(a){d="Could not create group for some unknown reason, please try again"}this.options.flashMessageModel.show(d)},_onChangeName:function(){this.options.flashMessageModel.hide(),this.$(".js-create").toggleClass("is-disabled",0===this._name().length)},_name:function(){return this.$(".js-name").val()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/random_quote":15}],37:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("../../common/view_helpers/random_quote");b.exports=e.core.View.extend({tagName:"form",events:{"click .js-delete":"_onClickDelete","click .js-save":"_onClickSave","submit form":"_onClickSave","keyup .js-name":"_onChangeName"},initialize:function(){d.each(["group","onSaved","onDeleted","flashMessageModel"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this.model=new e.core.Model,this._initBinds()},render:function(){return this.model.get("isLoading")?this.$el.html(this.getTemplate("common/templates/loading")({title:this.model.get("loadingText"),quote:f()})):this.$el.html(this.getTemplate("organization/groups_admin/edit_group")({displayName:this.options.group.get("display_name")})),this},_initBinds:function(){this.model.on("change:isLoading",this.render,this)},_onClickSave:function(a){this.killEvent(a);var b=this._name();b&&b!==this.options.group.get("display_name")&&(this._setLoading("Saving changes"),this.options.group.save({display_name:b},{wait:!0,success:this.options.onSaved,error:this._showErrors.bind(this)}))},_onClickDelete:function(a){this.killEvent(a),this._setLoading("Deleting group"),this.options.group.destroy({wait:!0,success:this.options.onDeleted,error:this._showErrors.bind(this)})},_setLoading:function(a){this.options.flashMessageModel.hide(),this.model.set({isLoading:!!a,loadingText:a})},_showErrors:function(a,b,c){this._setLoading("");var d;try{d=b&&JSON.parse(b.responseText).errors.join(". ")}catch(a){d="Could not update group for some unknown reason, please try again"}this.options.flashMessageModel.show(d)},_onChangeName:function(){this.$(".js-save").toggleClass("is-disabled",0===this._name().length),this.options.flashMessageModel.hide()},_name:function(){return this.$(".js-name").val()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/random_quote":15}],38:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("../../common/view_factory"),g=a("../../common/view_helpers/random_quote");b.exports=e.core.View.extend({className:"Filters-group",events:{"click .js-add-users":"_onClickAddUsers"},initialize:function(){d.each(["groupUsers","orgUsers"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this.options.orgUsers.on("change:selected",this._onChangeSelectedUser,this),this.add_related_model(this.options.orgUsers)},render:function(){return this.$el.html(this.getTemplate("organization/groups_admin/empty_group_filters_extra")({})),this},_onChangeSelectedUser:function(){this.$(".js-add-users").toggleClass("is-disabled",0===this._selectedUsers().length)},_onClickAddUsers:function(a){this.killEvent(a);var b=this._selectedUsers();if(b.length>0){var c=d.pluck(b,"id"),e=this._createLoadingView();e.appendToBody(),this.options.groupUsers.addInBatch(c).always(function(){e.close()}).fail(function(){f.createDialogByTemplate("common/templates/fail",{msg:""}).appendToBody()})}},_createLoadingView:function(){return f.createDialogByTemplate("common/templates/loading",{title:"Adding users",quote:g()})},_selectedUsers:function(){return this.options.orgUsers.where({selected:!0})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_factory":11,"../../common/view_helpers/random_quote":15}],39:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,g=a("../../common/view_helpers/pluralize_string");b.exports=f.core.View.extend({initialize:function(){e.each(["group","urls"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this._initBinds()},render:function(){this._$orgSubheader().hide();var a=this.options.group,b=a.isNew(),c={backUrl:this.options.urls.root,title:a.get("display_name")||"Create new group",isNewGroup:b,usersUrl:!1};if(b)c.editUrl=window.location,c.editUrl.isCurrent=!0;else{c.editUrl=this.options.urls.edit,c.usersUrl=this.options.urls.users;var d=a.users.length;c.usersLabel=0===d?"Users":d+" "+g("User","Users",d),this.options.urls.users.isCurrent||(c.backUrl=this.options.urls.users)}return this.$el.html(this.getTemplate("organization/groups_admin/group_header")(c)),this},clean:function(){this._$orgSubheader().show(),f.core.View.prototype.clean.call(this)},_$orgSubheader:function(){return d(".js-org-subheader")},_initBinds:function(){var a=this.options.group;a.on("change:display_name",this.render,this),this.add_related_model(a),a.users.on("reset add remove",this.render,this),this.add_related_model(a.users)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/pluralize_string":14}],40:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("../../common/view_helpers/pluralize_string");b.exports=e.core.View.extend({tagName:"li",className:"OrganizationList-user is-selectable",events:{click:"_onClick"},initialize:function(){d.each(["model"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this._initBinds()},render:function(){return this.$el.html(this.getTemplate("organization/groups_admin/group_user")({avatarUrl:this.model.get("avatar_url"),username:this.model.get("username"),email:this.model.get("email"),maps_count:f.prefixWithCount("map","maps",this.model.get("all_visualization_count")),table_count:f.prefixWithCount("dataset","datasets",this.model.get("table_count"))})),this},_initBinds:function(){this.model.on("change:selected",this._onChangeSelected,this)},_onChangeSelected:function(a,b){this.$el.toggleClass("is-selected",!!b)},_onClick:function(a){this.killEvent(a),this.model.set("selected",!this.model.get("selected"))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/pluralize_string":14}],41:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./group_user_view");b.exports=e.core.View.extend({tagName:"ul",className:"OrganizationList",initialize:function(){d.each(["users"],function(a){if(!this.options[a])throw new Error(a+" is required");
},this),this.options.users.bind("reset add remove",this.render,this),this.add_related_model(this.options.users)},render:function(){return this.clearSubViews(),this._renderUsers(),this},_renderUsers:function(){this.options.users.each(this._createUserView,this)},_createUserView:function(a){var b=new f({model:a});this.addView(b),this.$el.append(b.render().el)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./group_user_view":40}],42:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("../../common/views/paged_search/paged_search_view"),g=a("../../common/paged_search_model"),h=a("../../common/view_factory"),i=a("../../common/view_helpers/random_quote"),j=a("./add_or_remove_group_users_filters_extra_view"),k=a("./empty_group_filters_extra_view"),l=a("./group_users_list_view");b.exports=e.core.View.extend({initialize:function(){d.each(["group","orgUsers"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this._groupUsers=this.options.group.users,this._orgUsers=this.options.orgUsers,this._orgUsers.excludeCurrentUser(!1),this._hasPrefetchedGroupUsers=!1,this.model=new e.core.Model({hasPrefetchedGroupUsers:!1,lastRendered:null}),this._groupUsers.bind("reset",this._onResetGroupUsers,this),this.add_related_model(this._groupUsers);var a=this;this._groupUsers.fetch({success:function(){a.model.set("hasPrefetchedGroupUsers",!0),a.render()}})},render:function(){this.clearSubViews(),this.$el.empty();var a;return a=this.model.get("hasPrefetchedGroupUsers")?this._groupUsers.totalCount()>0?this._createViewForGroupUsers():this._createViewForEmptyGroup():this._createInitialPreloadingView(),this.addView(a),this.$el.append(a.render().el),this},clean:function(){this._orgUsers.restoreExcludeCurrentUser(),this.elder("clean")},_createInitialPreloadingView:function(){return h.createByTemplate("common/templates/loading",{title:"Getting users",quote:i()})},_createViewForGroupUsers:function(){this.model.set("lastRendered","groupUsers");var a=new j({group:this.options.group,orgUsers:this._orgUsers});return this.addView(a),new f({pagedSearchModel:new g,collection:this._groupUsers,createListView:this._createGroupUsersListView.bind(this,this._groupUsers),thinFilters:!0,filtersExtrasView:a})},_createViewForEmptyGroup:function(){this.model.set("lastRendered","empty");var a=new k({groupUsers:this._groupUsers,orgUsers:this._orgUsers});return this.addView(a),new f({pagedSearchModel:new g,collection:this._orgUsers,createListView:this._createGroupUsersListView.bind(this,this._orgUsers),thinFilters:!0,filtersExtrasView:a})},_createGroupUsersListView:function(a){return new l({users:a})},_onResetGroupUsers:function(){var a=this.model.get("lastRendered"),b=this._groupUsers.totalCount();"empty"===a?b>0&&this.render():"groupUsers"===a&&0===b&&this.render()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/paged_search_model":6,"../../common/view_factory":11,"../../common/view_helpers/random_quote":15,"../../common/views/paged_search/paged_search_view":26,"./add_or_remove_group_users_filters_extra_view":35,"./empty_group_filters_extra_view":38,"./group_users_list_view":41}],43:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("../../common/view_helpers/pluralize_string");b.exports=e.core.View.extend({tagName:"li",className:"OrganizationList-user",_PREVIEW_COUNT:3,initialize:function(){d.each(["model","url"],function(a){if(!this.options[a])throw new Error(a+" is required")},this)},render:function(){var a=this.model.get("shared_maps_count"),b=this.model.get("shared_tables_count");return this.$el.html(this.getTemplate("organization/groups_admin/group")({displayName:this.model.get("display_name"),sharedMapsCount:f("1 shared map",a+" shared maps",a),sharedDatasetsCount:f("1 shared dataset",b+" shared datasets",b),url:this.options.url,previewUsers:this.model.users.toArray().slice(0,this._PREVIEW_COUNT),usersCount:Math.max(this.model.users.length-this._PREVIEW_COUNT,0)})),this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/pluralize_string":14}],44:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./groups_list_view"),g=a("../../common/views/paged_search/paged_search_view"),h=a("../../common/paged_search_model"),i=a("../../common/view_factory");b.exports=e.core.View.extend({initialize:function(){d.each(["groups","router","newGroupUrl"],function(a){if(!this.options[a])throw new Error(a+" is required")},this)},render:function(){this.clearSubViews();var a=new g({pagedSearchModel:new h({fetch_users:!0,fetch_shared_maps_count:!0,fetch_shared_tables_count:!0}),collection:this.options.groups,createListView:this._createGroupsView.bind(this),thinFilters:!0,filtersExtrasView:this._createFiltersExtraView(),noResults:{icon:"CDB-IconFont-group",title:"You have not created any groups yet",msg:"Creating groups enables you to visualize and search for user members assigned to a business group or team in your organization."}});return this.addView(a),this.$el.empty(),this.$el.append(a.render().el),this},_createGroupsView:function(){return new f({groups:this.options.groups,newGroupUrl:this.options.newGroupUrl})},_createFiltersExtraView:function(){return i.createByTemplate("organization/groups_admin/groups_index_filters_extra",{createGroupUrl:this.options.router.rootUrl.urlToPath("new")},{className:"Filters-group"})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/paged_search_model":6,"../../common/view_factory":11,"../../common/views/paged_search/paged_search_view":26,"./groups_list_view":45}],45:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./group_view"),g=a("../../common/view_factory");b.exports=e.core.View.extend({initialize:function(){d.each(["groups"],function(a){if(d.isUndefined(this.options[a]))throw new Error(a+" is required")},this)},render:function(){return this.clearSubViews(),this.$el.empty(),this._renderGroupsView(),this},_renderGroupsView:function(){var a=g.createByList(this._createGroupViews(),{tagName:"ul",className:"OrganizationList"});this.addView(a),this.$el.append(a.render().el)},_createGroupViews:function(){return this.options.groups.map(function(a){return new f({model:a,url:this.options.newGroupUrl(a)})},this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_factory":11,"./group_view":43}],46:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,g=a("../../common/view_helpers/navigate_through_router");b.exports=f.core.View.extend({events:{click:"_onClick"},initialize:function(){e.each(["router"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(this._contentView().render().el),this},_initBinds:function(){this.options.router.model.bind("change:view",this._onChangeView,this),this.add_related_model(this.options.router.model)},_onChangeView:function(a){a.previous("view").clean(),this.render()},_contentView:function(){return this.options.router.model.get("view")},_onClick:function(a){if(this._isEventTriggeredOutsideOf(a,".Dialog")&&f.god.trigger("closeDialogs"),!this._isEventTriggeredOutsideOf(a,"a")){var b=d(a.target).closest("a").attr("href");this.options.router.isWithinCurrentRoutes(b)&&g.apply(this,arguments)}},_isEventTriggeredOutsideOf:function(a,b){return 0===d(a.target).closest(b).length}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/navigate_through_router":13}],47:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e=a("../../common/router"),f=a("./router_model"),g=a("./group_header_view"),h=a("./groups_index_view"),i=a("./create_group_view"),j=a("./group_users_view"),k=a("./edit_group_view"),l=a("../../common/view_factory");b.exports=e.extend({routes:e.supportTrailingSlashes({"":"renderGroupsIndex",new:"renderCreateGroup",":id":"renderGroupUsers",":id/edit":"renderEditGroup","*prefix/groups":"renderGroupsIndex"}),initialize:function(a){d.each(["rootUrl","groups","user","flashMessageModel"],function(b){if(!a[b])throw new Error(b+" is required")},this),this.model=new f,this.user=a.user,this.groups=a.groups,this.flashMessageModel=a.flashMessageModel,this.rootUrl=a.rootUrl,this.rootPath=this.rootUrl.pathname.bind(this.rootUrl),this.model.createLoadingView("Loading view"),this.model.on("change",this._onChange,this)},normalizeFragmentOrUrl:function(a){return a?a.toString().replace(this.rootUrl.toString(),""):""},isWithinCurrentRoutes:function(a){return a.indexOf(this.rootUrl.pathname())!==-1},renderGroupsIndex:function(){this.model.set("view",new h({newGroupUrl:this._groupUrl.bind(this),groups:this.groups,router:this}))},renderCreateGroup:function(){var a=this.groups.newGroupById(),b=this;this.model.set("view",l.createByList([b._createGroupHeader(a),new i({flashMessageModel:b.flashMessageModel,group:a,onCreated:b._navigateToGroup.bind(b,a)})]))},renderGroupUsers:function(a){var b=this;this.model.createGroupView(this.groups,a,function(a){return l.createByList([b._createGroupHeader(a,"group_users"),new j({group:a,orgUsers:b.user.organization.users})])})},renderEditGroup:function(a){var b=this;this.model.createGroupView(this.groups,a,function(a){return l.createByList([b._createGroupHeader(a,"edit_group"),new k({flashMessageModel:b.flashMessageModel,group:a,onSaved:b._navigateToGroup.bind(b,a),onDeleted:b.navigate.bind(b,b.rootUrl,{trigger:!0})})])})},_navigateToGroup:function(a){this.navigate(this.rootUrl.urlToPath(a.id),{trigger:!0})},_groupUrl:function(a,b){var c=a.id;return b&&(c+="/"+b),this.rootUrl.urlToPath(c)},_createGroupHeader:function(a,b){var c={root:this.rootUrl,users:this._groupUrl(a),edit:this._groupUrl(a,"edit")};return c.users.isCurrent="group_users"===b,c.edit.isCurrent="edit_group"===b,new g({group:a,urls:c})},_onChange:function(){this.flashMessageModel.hide()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/router":7,"../../common/view_factory":11,"./create_group_view":36,"./edit_group_view":37,"./group_header_view":39,"./group_users_view":42,"./groups_index_view":44,"./router_model":48}],48:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../common/view_factory"),f=a("../../common/view_helpers/random_quote");b.exports=d.core.Model.extend({defaults:{view:""},createGroupView:function(a,b,c){var d=this,e=a.newGroupById(b);c=c.bind(this,e);var f=function(){d.set("view",c())};e.get("display_name")?f():(this.createLoadingView("Loading group details"),e.fetch({data:{fetch_users:!0},success:function(){a.add(e),f()},error:this.createErrorView.bind(this)}))},createLoadingView:function(a){this.set("view",e.createByTemplate("common/templates/loading",{title:a,quote:f()}))},createErrorView:function(){this.set("view",e.createByTemplate("common/templates/fail",{msg:""}))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_factory":11,"../../common/view_helpers/random_quote":15}],49:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({breadcrumbTitle:function(){return"Configuration"},isBreadcrumbDropdownEnabled:function(){return!1},isDisplayingDatasets:function(){return!1},isDisplayingMaps:function(){return!1},isDisplayingLockedItems:function(){return!1}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],50:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../../../../javascripts/cartodb/common/views/base_dialog/view"),f=a("../icons/organization_icons_view");b.exports=e.extend({className:"Dialog Modal IconPickerDialog",events:e.extendEvents({"click .js-addIcon":"_onAddIconClicked"}),initialize:function(){if(!this.options.orgId)throw new Error("Organization ID is required.");this._orgId=this.options.orgId,this.elder("initialize"),this._template=d.templates.getTemplate("organization/icon_picker/icon_picker_dialog/icon_picker_dialog_template")},render:function(){return this.clearSubViews(),e.prototype.render.call(this),this.$(".content").addClass("Dialog-content--expanded"),this._initViews(),this},_initViews:function(){this.icon_picker=new f({el:this.$(".js-dialogIconPicker"),orgId:this._orgId}),this.addView(this.icon_picker),this.icon_picker.model.on("change:isProcessRunning",this._onIsProcessRunningChanged,this)},_onIsProcessRunningChanged:function(){var a=this.icon_picker.model.get("isProcessRunning");a?this.$el.css("pointer-events","none"):this.$el.css("pointer-events","auto")},render_content:function(){return this._template()},_onAddIconClicked:function(a){this.killEvent(a),this._hideErrorMessage(),this.$(".js-inputFile").trigger("click")},_hideErrorMessage:function(){this._hide(".js-errorMessage")},_hide:function(a){this.$(a).addClass("is-hidden")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../../javascripts/cartodb/common/views/base_dialog/view":16,"../icons/organization_icons_view":55}],51:[function(a,b,c){var d=a("../../../../../javascripts/cartodb/common/views/base_dialog/view");b.exports=d.extend({initialize:function(){if(!this.options.okCallback)throw new Error("Callback for OK action is mandatory.");this.elder("initialize"),this._numOfIcons=this.options.numOfIcons||0,this._okCallback=this.options.okCallback},render_content:function(){return this.getTemplate("organization/icon_picker/icons/delete_icons_modal")({numOfIcons:this._numOfIcons})},ok:function(){this._okCallback(),this.close()}})},{"../../../../../javascripts/cartodb/common/views/base_dialog/view":16}],52:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,f=a("./organization_icon_model");b.exports=e.Collection.extend({model:f,url:function(a){var b=d.config.urlVersion("organization-assets",a);return"/api/"+b+"/organization/"+this._orgId+"/assets"},initialize:function(a,b){if(!b.orgId)throw new Error("Organization ID is required");this._orgId=b.orgId}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./organization_icon_model":53}],53:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=c.Model.extend({defaults:{selected:!1,visible:!1,deleted:!1},fileAttribute:"resource",save:function(a,b){return b||(b={}),a||(a=d.clone(this.attributes)),a=d.omit(a,["selected","visible","deleted"]),b.data=JSON.stringify(a),c.Model.prototype.save.call(this,a,b)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],54:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=d.core.View.extend({tagName:"li",className:"IconList-item IconList-item--small",events:{click:"_onClick"},initialize:function(a){if(c.isUndefined(a.model))throw new Error("An organization icon model is mandatory.");this._template=d.templates.getTemplate("organization/icon_picker/icons/organization_icon"),this._initBinds()},render:function(){return this.$el.html(this._template({url:this.model.get("public_url")})),this},_initBinds:function(){this.model.on("change:selected",this._onSelectedChanged,this),this.model.on("change:deleted",this._onDeletedChanged,this)},_onClick:function(){this.model.set("selected",!this.model.get("selected"))},_onSelectedChanged:function(){this.$el.toggleClass("is-selected",this.model.get("selected"))},_onDeletedChanged:function(){this.model.get("deleted")&&this.$el.remove()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],55:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./organization_icon_collection"),g=a("./organization_icon_view"),h=a("./delete_icons_dialog_view");b.exports=e.core.View.extend({events:{"click .js-addIcon":"_onAddIconClicked","click .js-selectAllIcons":"_onSelectAllIconsClicked","click .js-deselectAllIcons":"_onDeselectAllIconsClicked","click .js-deleteIcons":"_onDeleteIconsClicked","change .js-inputFile":"_onFileSelected"},initialize:function(){if(!this.options.orgId)throw new Error("Organization ID is required.");this._orgId=this.options.orgId,this.template=e.templates.getTemplate("organization/icon_picker/icons/organization_icons_template"),this.model=new e.core.Model({isProcessRunning:!1}),this._iconCollection=new f(null,{orgId:this._orgId}),this._numOfUploadingProcesses=0,this._numOfDeletingProcesses=0,this._fetchErrorMessage="Error fetching organization icons. Please refresh the page.",this._runningMessage="",this.render(),this._fetchAllIcons(),this._initBinds()},render:function(){return this.$el.html(this.template()),this},_initBinds:function(){this._iconCollection.on("change:selected",this._refreshActions,this),this.model.on("change:isProcessRunning",this._onProcessRunningChanged,this),this.add_related_model(this._iconCollection)},_fetchAllIcons:function(){this._iconCollection.fetch({success:this._renderAllIcons.bind(this),error:this._onFetchIconsError.bind(this)})},_renderAllIcons:function(){d.each(this._iconCollection.models,function(a){this._addIconElement(a)},this)},_onFetchIconsError:function(){this._showErrorMessage(this._fetchErrorMessage)},_renderIcon:function(a){var b=new g({model:a});b.render(),a.set("visible",!0),this.$(".js-items").append(b.$el)},_addIconElement:function(a){this._renderIcon(a)},_onAddIconClicked:function(a){this.killEvent(a),this._hideErrorMessage(),this.$(".js-inputFile").trigger("click")},_parseResponseText:function(a){if(a&&a.responseText)try{var b=JSON.parse(a.responseText);if(b&&b.errors&&"string"==typeof b.errors)return b.errors}catch(a){}return""},_getSelectedFiles:function(){return this.$(".js-inputFile").prop("files")},_onFileSelected:function(){var a=this._getSelectedFiles();d.each(a,function(a){this._iconCollection.create({kind:"organization_asset",resource:a},{beforeSend:this._beforeIconUpload.bind(this),success:this._onIconUploaded.bind(this),error:this._onIconUploadError.bind(this),complete:this._onIconUploadComplete.bind(this)})},this)},_beforeIconUpload:function(){this._numOfUploadingProcesses++,this._numOfUploadingProcesses>0&&(this._runningMessage="Uploading icons...",this.model.set("isProcessRunning",!0))},_onIconUploaded:function(a){this._resetFileSelection(),this._addIconElement(a)},_onIconUploadError:function(a,b){var c=this._parseResponseText(b);this._resetFileSelection(),this._showErrorMessage(this._uploadErrorMessage(c))},_onIconUploadComplete:function(){this._numOfUploadingProcesses--,this._numOfUploadingProcesses<=0&&this.model.set("isProcessRunning",!1)},_resetFileSelection:function(){this.$(".js-inputFile").val("")},_show:function(a){this.$(a).removeClass("is-hidden")},_hide:function(a){this.$(a).addClass("is-hidden")},_refreshActions:function(){if(!this.model.get("isProcessRunning")){var a=Math.min(this._iconCollection.length),b=this._getNumberOfSelectedIcons(),c=1===b?"1 icon selected":""+b+" icons selected";this.$(".js-iconMainLabel").text(c),0===b?(this.$(".js-iconMainLabel").text(""),this._hide(".js-iconMainLabel, .js-selectAllIcons, .js-deselectAllIcons, .js-deleteIcons"),this._show(".js-iconsInfo")):b<a?(this._show(".js-iconMainLabel, .js-selectAllIcons, .js-deleteIcons"),this._hide(".js-deselectAllIcons, .js-iconsInfo")):(this._show(".js-iconMainLabel, .js-deselectAllIcons, .js-deleteIcons"),this._hide(".js-selectAllIcons, .js-iconsInfo")),b>1?this.$(".js-deleteIcons a").text("Delete icons..."):1===b&&this.$(".js-deleteIcons a").text("Delete icon...")}},_hideActions:function(){this._hide(".js-selectAllIcons, .js-deselectAllIcons, .js-deleteIcons, .js-iconsInfo")},_onDeselectAllIconsClicked:function(a){a.preventDefault(),this._iconCollection.each(function(a){a.set("selected",!1)})},_onSelectAllIconsClicked:function(a){a.preventDefault(),this._iconCollection.each(function(a){a.get("visible")&&a.set("selected",!0)})},_onDeleteIconsClicked:function(a){a.preventDefault(),this._openDeleteIconsDialog()},_bindDeleteIconsDialog:function(){e.god.bind("closeDialogs:delete",this._destroyDeleteIconsDialog,this)},_unbindDeleteIconsDialog:function(){e.god.unbind("closeDialogs:delete",this._destroyDeleteIconsDialog,this)},_openDeleteIconsDialog:function(a){this.killEvent(a),e.god.trigger("closeDialogs:delete"),this.delete_icons_dialog=new h({numOfIcons:this._getNumberOfSelectedIcons(),okCallback:this._deleteIcons.bind(this)}),this.delete_icons_dialog.appendToBody(),this._bindDeleteIconsDialog(),this.addView(this.delete_icons_dialog)},_deleteIcons:function(){this._hideErrorMessage();var a=this._iconCollection.where({selected:!0});d.each(a,function(a){a.destroy({beforeSend:this._beforeIconDelete.bind(this),success:this._onIconDeleted.bind(this),error:this._onIconDeleteError.bind(this),complete:this._onIconDeleteComplete.bind(this)})},this)},_destroyDeleteIconsDialog:function(){this.delete_icons_dialog&&(this._unbindDeleteIconsDialog(),this.delete_icons_dialog.remove(),this.removeView(this.delete_icons_dialog),this.delete_icons_dialog.hide(),delete this.delete_icons_dialog)},_getNumberOfSelectedIcons:function(){return this._iconCollection.where({selected:!0}).length},_beforeIconDelete:function(){this._numOfDeletingProcesses++,this._numOfDeletingProcesses>0&&(this._runningMessage="Deleting icons...",this.model.set("isProcessRunning",!0))},_onIconDeleted:function(a){a.set("deleted",!0),this._addExtraIcon()},_onIconDeleteError:function(a,b){var c=this._parseResponseText(b);this._iconCollection.add(a),this._resetSelection(),this._showErrorMessage(this._deleteErrorMessage(c))},_onIconDeleteComplete:function(){this._numOfDeletingProcesses--,this._numOfDeletingProcesses<=0&&this.model.set("isProcessRunning",!1)},_showSpinner:function(a){a?(this._hide(".js-plusSign"),this._show(".js-spinner")):(this._show(".js-plusSign"),this._hide(".js-spinner"))},_showErrorMessage:function(a){this.$(".js-errorMessage label").text(a),this._show(".js-errorMessage")},_hideErrorMessage:function(){this._hide(".js-errorMessage")},_resetSelection:function(){this._iconCollection.each(function(a){a.set("selected",!1)}),this._refreshActions()},_addExtraIcon:function(){var a=!1;this._iconCollection.each(function(b){b.get("visible")||a||(this._addIconElement(b),a=!0)},this)},_onProcessRunningChanged:function(){var a=this.model.get("isProcessRunning");this._showSpinner(a),a?(this.$el.css("pointer-events","none"),this._hideActions(),this.$(".js-runningInfo").text(this._runningMessage),this._show(".js-runningInfo")):(this.$(".js-runningInfo").text(""),this._hide(".js-runningInfo"),this._refreshActions(),e.god.trigger("refreshCollection",{cid:this.cid}),this.$el.css("pointer-events","auto"))},_uploadErrorMessage:function(a){var b="Error uploading your image. ";return a&&(b+="[ "+a+" ]. "),b+="Please try again."},_deleteErrorMessage:function(a){var b="Error deleting your image. ";return a&&(b+="[ "+a+" ]. "),b+="Please try again."}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./delete_icons_dialog_view":51,"./organization_icon_collection":52,"./organization_icon_view":54}],56:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./icons/organization_icons_view"),f=a("./icons/organization_icon_collection"),g=a("./icons/organization_icon_view"),h=a("./icon_picker_dialog/icon_picker_dialog_view");b.exports=e.extend({events:e.extendEvents({"click .js-viewAllIcons":"_onViewAllIconsClicked"}),initialize:function(){if(!this.options.orgId)throw new Error("Organization ID is required.");this._orgId=this.options.orgId,this._maxIcons=23,this.template=d.templates.getTemplate("organization/icon_picker/organization_icon_picker_template"),this.model=new d.core.Model({isProcessRunning:!1}),this._iconCollection=new f(null,{orgId:this._orgId}),this._numOfUploadingProcesses=0,this._numOfDeletingProcesses=0,this._fetchErrorMessage="Error fetching organization icons. Please refresh the page.",this._runningMessage="",this.render(),this._fetchAllIcons(),this._initBinds()},_initBinds:function(){this._iconCollection.on("change:selected",this._refreshActions,this),this.model.on("change:isProcessRunning",this._onProcessRunningChanged,this),d.god.bind("refreshCollection",this._refreshCollection,this)},_refreshCollection:function(a){a.cid&&this.cid!==a.cid&&(this.render(),this._fetchAllIcons())},_renderIcon:function(a){if(a.get("index")<this._maxIcons){var b=new g({model:a});b.render(),a.set("visible",!0),this.$(".js-items").append(b.$el)}},_addIconElement:function(a){a.set("index",this._getIconIndex(a)),this._renderIcon(a),this._refreshActions()},_refreshActions:function(){if(!this.model.get("isProcessRunning")){var a=Math.min(this._maxIcons,this._iconCollection.length),b=this._getNumberOfSelectedIcons(),c=1===b?"1 icon selected":""+b+" icons selected";this.$(".js-iconMainLabel").text(c),0===b?(this.$(".js-iconMainLabel").text("Icons"),this._hide(".js-selectAllIcons, .js-deselectAllIcons, .js-deleteIcons"),this._show(".js-iconsInfo")):b<a?(this._show(".js-selectAllIcons, .js-deleteIcons"),this._hide(".js-deselectAllIcons, .js-iconsInfo")):(this._hide(".js-selectAllIcons, .js-iconsInfo"),this._show(".js-deselectAllIcons, .js-deleteIcons")),b>1?this.$(".js-deleteIcons a").text("Delete icons..."):1===b&&this.$(".js-deleteIcons a").text("Delete icon..."),this._iconCollection.length>this._maxIcons?this._show(".js-viewAllIcons"):this._hide(".js-viewAllIcons")}},_hideActions:function(){this._hide(".js-selectAllIcons, .js-deselectAllIcons, .js-deleteIcons, .js-iconsInfo, .js-viewAllIcons")},_getIconIndex:function(a){return this._iconCollection.indexOf(a)},_addExtraIcon:function(){var a=!1;this._iconCollection.each(function(b){var c=this._getIconIndex(b);c<this._maxIcons&&!b.get("visible")&&!a&&(this._addIconElement(b),a=!0)},this)},_bindIconsPicker:function(){d.god.bind("closeDialogs:icons",this._destroyPicker,this)},_unbindIconsPicker:function(){d.god.unbind("closeDialogs:icons",this._destroyPicker,this)},_destroyPicker:function(){this.icon_picker_dialog&&(this._unbindIconsPicker(),this.icon_picker_dialog.remove(),this.removeView(this.icon_picker_dialog),this.icon_picker_dialog.hide(),delete this.icon_picker_dialog)},_onViewAllIconsClicked:function(a){this.killEvent(a),d.god.trigger("closeDialogs:icons"),this.icon_picker_dialog=new h({orgId:this._orgId}),this.icon_picker_dialog.appendToBody(),this._bindIconsPicker(),this.addView(this.icon_picker_dialog)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./icon_picker_dialog/icon_picker_dialog_view":50,"./icons/organization_icon_collection":52,"./icons/organization_icon_view":54,"./icons/organization_icons_view":55}],57:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../common/views/base_dialog/view"),f=a("../../common/view_helpers/random_quote"),g=a("../../common/view_factory"),h=a("./invite_users_form_view");b.exports=e.extend({className:"Dialog is-opening InviteUsers",initialize:function(){this.elder("initialize"),this.organization=this.options.organization,this.organizationUsers=this.options.organizationUsers,this.model=new d.admin.Organization.Invites({},{organizationId:this.organization.id,enable_organization_signup:!1}),this.template=d.templates.getTemplate("organization/invite_users/invite_users_dialog_template")},render:function(){return this.clearSubViews(),e.prototype.render.call(this),this.$(".content").addClass("Dialog-content--expanded"),this._initViews(),this},render_content:function(){return this.template()},_initViews:function(){this._panes=new d.ui.common.TabPane({el:this.$(".js-content")}),this._form=new h({model:this.model,organization:this.organization,organizationUsers:this.organizationUsers,el:this.$(".js-form")}),this._form.bind("onSubmit",this._sendInvites,this),this._panes.addTab("form",this._form.render()),this._panes.addTab("loading",g.createByTemplate("common/templates/loading",{title:"Sending invites...",quote:f()}).render()),this._panes.addTab("error",g.createByTemplate("common/templates/fail",{msg:"Sorry, something went wrong."}).render()),this._panes.active("form")},_sendInvites:function(){var a=this;this._panes.active("loading"),this.model.save(null,{success:function(){a.close()},error:function(b,c){try{var d=JSON.parse(c.responseText).errors.users_emails[0];a._form.showSubmitError(d),a._panes.active("form")}catch(b){a._panes.active("error")}}})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_factory":11,"../../common/view_helpers/random_quote":15,"../../common/views/base_dialog/view":16,"./invite_users_form_view":58}],58:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,e="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof a?a.cdb.Utils:null;b.exports=d.core.View.extend({events:{"submit .js-invitesForm":"_onSubmit","keyup .js-welcomeText":"_onTextareaChange","click .js-enableSignInButton":"_signInEnabledMessage"},initialize:function(){this.organizationUsers=this.options.organizationUsers,this.organization=this.options.organization,this.template=d.templates.getTemplate("organization/invite_users/invite_users_form_template"),this._initBinds()},render:function(){return this.$el.html(this.template({welcomeText:this.model.get("welcome_text"),signupEnabled:this.organization.get("signup_enabled"),viewerEnabled:this.organization.get("viewer_seats")>0})),this._toggleEmailError(!1),this._initViews(),this},_renderFlashMessage:function(){var a=d.templates.getTemplate("organization/invite_users/invite_users_flash_message_template");this.$(".js-signInMessageContainer").html(a()),this.$(".js-flashSuccess").hide()},_initBinds:function(){this.model.bind("change",this._onChange,this)},_initViews:function(){var a=this,b=this.organizationUsers.pluck("email");this.$(".js-tagsList").tagit({allowSpaces:!0,placeholderText:this.$(".js-tags").data("title"),onBlur:function(){a.$(".js-tags").removeClass("is-focus");
},onFocus:function(){a.$(".js-tags").addClass("is-focus")},beforeTagAdded:function(d,f){var g=f.tagLabel;return a._removeSubmitError(),!!e.isValidEmail(g)&&(c.contains(b,g)?(a._toggleEmailError(!0),!1):void a._toggleEmailError(!1))},beforeTagRemoved:function(){a._removeSubmitError()},afterTagRemoved:function(b,c){a._updateUsers()},afterTagAdded:function(b,c){a._updateUsers()},onSubmitTags:function(b,c){return b.preventDefault(),a._onSubmit(),!1}}),this.organization.get("signup_enabled")||this._renderFlashMessage()},_onTextareaChange:function(){this.model.set("welcome_text",this.$(".js-welcomeText").val())},_updateUsers:function(){this.model.set("users_emails",this.$(".js-tagsList").tagit("assignedTags"))},_onSubmit:function(a){a&&this.killEvent(a);var b=this.model.get("users_emails");b.length>0&&(this.model.set("welcome_text",this.$(".js-welcomeText").val()),this.model.set("viewer",this.$("[name=viewer]").get(0).checked),this.trigger("onSubmit",this))},_signInEnabledMessage:function(){this.$(".js-signInMessage").addClass("FlashMessage--success"),this.$(".js-flashNotice").hide(),this.$(".js-flashSuccess").show(),this.model.set("enable_organization_signup",!0)},_toggleEmailError:function(a){this.$(".js-emailError")[a?"show":"hide"]()},showSubmitError:function(a){var b=this.$(".js-serverError");0===b.length&&this.$(".js-emailError").after('<p class="Form-rowInfoText Form-rowInfoText--error Form-rowInfoText--multipleLines js-serverError">'+a+"</p>")},_removeSubmitError:function(){this.$(".js-serverError").remove()},_onChange:function(){var a=this.model.get("users_emails"),b=this.model.get("welcome_text");this.$(".js-submit").toggleClass("is-disabled",0===a.length||!b)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],59:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../common/views/base_dialog/view"),f=a("../../common/view_helpers/random_quote"),g=a("../../common/view_factory");b.exports=e.extend({options:{authenticityToken:"",organizationUser:{}},events:e.extendEvents({"click .js-ok":"_ok","click .js-cancel":"_cancel"}),className:"Dialog is-opening",initialize:function(){this.elder("initialize"),this.template=d.templates.getTemplate("organization/organization_notification/delete_notification_dialog")},render_content:function(){return this.template({formAction:d.config.prefixUrl()+"/organization/notifications/"+this.options.notificationId,authenticityToken:this.options.authenticityToken})},ok:function(){var a=g.createDialogByTemplate("common/templates/loading",{title:"Removing…",quote:f()});a.appendToBody(),this.submit(),this.close()},submit:function(){this.$("form").submit()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_factory":11,"../../common/view_helpers/random_quote":15,"../../common/views/base_dialog/view":16}],60:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("./delete_notification_dialog_view"),g=a("./send_button_view"),h=a("markdown");b.exports=d.core.View.extend({events:{"click .js-resend":"_onClickResend","click .js-remove":"_onClickRemove","keydown .js-textarea":"_onTextareaKeydown","input .js-textarea":"_updateCounter","propertychange .js-textarea":"_updateCounter"},render:function(){return this.$textarea=this.$("#carto_notification_body"),this._initViews(),this._updateCounter(),this},_initViews:function(){this.sendButton=new g,this.$(".js-send").html(this.sendButton.render().el),this.addView(this.sendButton),this.sendButton.bind("submitForm",this._submitForm,this)},_submitForm:function(){navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?this.$("form").clone().appendTo("body").submit():this.$("form").submit()},_updateCounter:function(){var a=e(h.toHTML(this.$textarea.val())).text().length;this.sendButton.updateCounter(a)},_onClickResend:function(a){var b=e(a.target).closest(".js-NotificationsList-item"),c=b.find(".js-html_body").data("body"),d=b.find(".js-recipients").data("recipients");this.$textarea.val(c),this.$('input[name="carto_notification[recipients]"]').prop("checked",!1),this.$('input[name="carto_notification[recipients]"][value="'+d+'"]').prop("checked",!0),e("body").animate({scrollTop:0}),this._updateCounter()},_onTextareaKeydown:function(a){13===a.keyCode&&a.metaKey&&this.sendButton.onUpdate()},_destroyRemoveNotificationDialog:function(){this.remove_notification_dialog&&(this._unbindRemoveNotificationDialog(),this.remove_notification_dialog.remove(),this.removeView(this.remove_notification_dialog),this.remove_notification_dialog.hide(),delete this.remove_notification_dialog)},_bindRemoveNotificationDialog:function(){d.god.bind("closeDialogs:delete",this._destroyRemoveNotificationDialog,this)},_unbindRemoveNotificationDialog:function(){d.god.unbind("closeDialogs:delete",this._destroyRemoveNotificationDialog,this)},_onClickRemove:function(a){d.god.trigger("closeDialogs:delete");var b=e(a.target);this.remove_notification_dialog=new f({authenticityToken:this.options.authenticityToken,notificationId:b.data("id")}),this.remove_notification_dialog.appendToBody(),this._bindRemoveNotificationDialog(),this.addView(this.remove_notification_dialog)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./delete_notification_dialog_view":59,"./send_button_view":61,markdown:98}],61:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null,e=140;b.exports=c.core.View.extend({className:"FormAccount-rowData",events:{"click .js-button":"onUpdate"},initialize:function(a){this.template=c.templates.getTemplate("organization/organization_notification/send_button"),this.model=new d.Model({status:"idle",counter:0}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(this.template({isLoading:this._isLoading(),isDisabled:this._isDisabled(),isNegative:this._isNegative(),counter:e-this.model.get("counter")})),this},updateCounter:function(a){this.model.set("counter",a)},_initBinds:function(){this.model.bind("change",this.render,this)},_isNegative:function(){return this.model.get("counter")>e},_isDisabled:function(){return 0===this.model.get("counter")||this._isNegative()||this._isLoading()},_isLoading:function(){return"loading"===this.model.get("status")},_submit:function(){this.trigger("submitForm")},onUpdate:function(){return!this._isDisabled()&&(this._submit(),void this.model.set({status:"loading"}))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],62:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{submit:"_validateFormSubmit"},_validateFormSubmit:function(a){if(this.$(".js-userQuotaError").length>0)return!1}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],63:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./organization_user_quota_slider"),f=a("./organization_user_quota_slider_input");b.exports=d.core.View.extend({initialize:function(){this.userQuotaSlider=new e({el:this.$(".js-userQuotaSlider"),model:this.model}),this.addView(this.userQuotaSlider),this.userQuotaSliderInput=new f({el:this.$(".js-userQuotaSliderInput"),model:this.model}),this.addView(this.userQuotaSliderInput),this._initBinds()},_initBinds:function(){this.model.bind("change:quota_in_bytes",this._onQuotaChange,this)},_onQuotaChange:function(a,b){this.$("#user_quota").val(b)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./organization_user_quota_slider":64,"./organization_user_quota_slider_input":65}],64:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=d.core.View.extend({events:{"hover .js-quotaProgressSlider":"_showTooltip"},initialize:function(){this._initBinds(),this._initViews()},_initBinds:function(){this.model.bind("change:quota_in_bytes",this._onQuotaChange,this)},_initViews:function(){var a=104857600/this.model.organization.get("available_quota_for_user");this.$(".js-slider").slider({max:100,min:a,step:1,value:this.model.assignedQuotaPercentage(),range:"min",orientation:"horizontal",slide:this._onSlideChange.bind(this)}),c(".ui-slider-handle").addClass("js-quotaProgressSlider")},_onSlideChange:function(a,b){var d=Math.max(Math.floor(this.model.organization.get("available_quota_for_user")*b.value/100),1),e=100*d/this.model.organization.get("available_quota_for_user");if(!(b.value>=this.model.usedQuotaPercentage()))return!1;this.$(".ui-slider-range").css("width",e+"%"),this.$(".js-quotaProgressSlider").css("left",e+"%");var f=c(".js-quotaProgressSlider").offset().left-c(".js-orgUserQuotaTooltip").outerWidth()/2+c(".js-quotaProgressSlider").outerWidth()/2;c(".js-orgUserQuotaTooltip").css("left",f),this.model.set("quota_in_bytes",d)},_onQuotaChange:function(){this.model.assignedQuotaPercentage()>=this.model.usedQuotaPercentage()&&(c(".ui-slider-range").css("width",Math.min(this.model.assignedQuotaPercentage(),100)+"%"),c(".js-quotaProgressSlider").css("left",Math.min(this.model.assignedQuotaPercentage(),100)+"%"))},_showTooltip:function(){var a=this.model;this.addView(new d.common.TipsyTooltip({el:c(".js-quotaProgressSlider"),className:"js-orgUserQuotaTooltip",title:function(){return a.assignedQuotaPercentage().toFixed(0)+"% of the available org quota"}}))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],65:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=d.core.View.extend({events:{"keyup .js-assignedSize":"_onKeyup"},initialize:function(){this._initBinds(),this._initViews()},_initBinds:function(){this.model.bind("change:quota_in_bytes",this._onQuotaChange,this)},_initViews:function(){var a=Math.max(Math.floor(this.model.get("quota_in_bytes")/1024/1024).toFixed(0),1);this.$(".js-assignedSize").val(a)},_onQuotaChange:function(){this.$(".js-assignedSize").val(Math.max(this.model.assignedQuotaInRoundedMb(),1))},_onKeyup:function(){var a=Math.max(Math.floor(1048576*this.$(".js-assignedSize").val()),1048576),b=100*a/this.model.organization.get("available_quota_for_user"),d='<p class="FormAccount-rowInfoText FormAccount-rowInfoText--error js-userQuotaError">Invalid quota, insert a valid one.</p>';isNaN(b)||this.model.set("quota_in_bytes",a),isNaN(b)||this.model.get("quota_in_bytes")>this.model.organization.get("available_quota_for_user")||this.model.get("quota_in_bytes")<this.model.get("db_size_in_bytes")?(this.$(".js-assignedSize").addClass("has-error"),0===this.$(".js-userQuotaError").length&&c(".js-userQuotaSliderInput").append(d)):(this.$(".js-assignedSize").removeClass("has-error"),this.$(".js-userQuotaError").remove())}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],66:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,f=a("../../common/view_helpers/pluralize_string");b.exports=d.core.View.extend({className:"OrganizationList-user",tagName:"li",initialize:function(){this.template=d.templates.getTemplate("organization/organization_users/organization_user")},render:function(){return this.$el.html(this.template({totalPer:this.options.totalPer,userPer:this.options.userPer,usedPer:this.options.usedPer,isOwner:this.options.isOwner,isAdmin:this.options.isAdmin,isViewer:this.options.isViewer,editable:this.options.editable,url:this.options.url,sizeOnBytes:e.readablizeBytes(this.model.get("db_size_in_bytes")),quotaInBytes:e.readablizeBytes(this.model.get("quota_in_bytes")),avatarUrl:this.model.get("avatar_url"),username:this.model.get("username"),user_email:this.model.get("email"),table_count:f.prefixWithCount("Dataset","Datasets",this.model.get("table_count")),maps_count:f.prefixWithCount("Map","Maps",this.model.get("all_visualization_count"))})),this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/pluralize_string":14}],67:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({className:"Form-footer",initialize:function(){this.template=c.templates.getTemplate("organization/organization_users/organization_users_footer"),this._initBinds()},render:function(){return this.$el.html(this.template({seats:this.model.get("seats"),users:this.options.organizationUsers.totalCount(),newUserUrl:this.model.viewUrl().create(),upgradeUrl:window.upgrade_url,customHosted:c.config.get("cartodb_com_hosted")})),this},_initBinds:function(){this.model.bind("change:total_users",this.render,this),this.options.organizationUsers.bind("reset",this.render,this),this.add_related_model(this.options.organizationUsers)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],68:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("../../common/views/pagination/view"),g=a("./organization_user_view");b.exports=d.core.View.extend({initialize:function(){this.organization=this.options.organization,this.paginationModel=this.options.paginationModel,this.currentUser=this.options.currentUser,this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var a=e("<ul>").addClass("OrganizationList");this.$el.append(a);var b=0;this.collection.each(function(c){var d=100*c.get("quota_in_bytes")/this.organization.get("quota_in_bytes"),e=100*c.get("db_size_in_bytes")/this.organization.get("quota_in_bytes");c.organization=this.organization;var f=new g({model:c,isOwner:c.isOrgOwner(),isAdmin:c.isOrgAdmin(),isViewer:c.get("viewer"),editable:this.currentUser.isOrgOwner()||this.currentUser.id===c.id||!c.isOrgAdmin(),userPer:d,usedPer:e,totalPer:b,url:this.organization.viewUrl().edit(c)});a.append(f.render().el),this.addView(f),b+=d},this);var c=e("<div>").addClass("OrganizationList-paginator");this.$el.append(c);var d=new f({model:this.paginationModel});return c.append(d.render().el),this.addView(d),this},_initBinds:function(){this.collection.bind("reset",this.render,this),this.add_related_model(this.collection)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/views/pagination/view":28,"./organization_user_view":66}],69:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,g=a("./organization_users_list_view"),h=a("./organization_users_footer_view"),i=a("../../common/paged_search_model"),j=a("../../common/views/pagination/model"),k=a("../../common/view_helpers/random_quote"),l=a("../../common/view_factory"),m=a("../invite_users/invite_users_dialog_view");b.exports=d.core.View.extend({events:{"click .js-addUserOptions":"_openAddUserDropdown","click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","keydown .js-search-input":"_onKeyDown","submit .js-search-form":"killEvent"},initialize:function(){this.organization=this.options.organization,this.organizationUsers=this.options.organizationUsers,this.currentUser=this.options.currentUser,this.pagedSearchModel=new i({per_page:50,order:"username"}),this.paginationModel=new j({current_page:this.pagedSearchModel.get("page"),total_count:this.organizationUsers.totalCount(),per_page:this.pagedSearchModel.get("per_page")}),this.template=d.templates.getTemplate("organization/organization_users/organization_users"),this._initBinds(),this.pagedSearchModel.fetch(this.organizationUsers)},render:function(){return this.clearSubViews(),this.$el.html(this.template({seats:this.organization.get("seats"),assigned_seats:this.organization.get("assigned_seats"),viewer_seats:this.organization.get("viewer_seats"),assigned_viewer_seats:this.organization.get("assigned_viewer_seats"),newUserUrl:this.organization.viewUrl().create()})),this._initViews(),this},_initBinds:function(){this.organizationUsers.bind("fetching",function(){this._panes&&this._panes.active("loading")},this),this.organizationUsers.bind("error",function(a){(!a||a&&"abort"!==a.statusText)&&this._panes.active("error")},this),this.organizationUsers.bind("reset",function(a){var b=a.totalCount();this.paginationModel.set({total_count:b,current_page:this.pagedSearchModel.get("page")}),this._panes&&this._panes.active(b>0?"users":"no_results")},this),this.organizationUsers.bind("reset error loading",function(a){this[this.pagedSearchModel.get("q")?"_showCleanSearchButton":"_hideCleanSearchButton"]()},this),this.paginationModel.bind("change:current_page",function(a){var b=a.get("current_page");this.pagedSearchModel.set("page",b),this.pagedSearchModel.fetch(this.organizationUsers)},this),this.add_related_model(this.organizationUsers),this.add_related_model(this.paginationModel)},_initViews:function(){this._panes=new d.ui.common.TabPane({el:this.$(".js-organizationUsersPanes")}),this.addView(this._panes),this._panes.addTab("users",new g({organization:this.organization,collection:this.organizationUsers,paginationModel:this.paginationModel,currentUser:this.currentUser}).render()),this._panes.addTab("error",l.createByTemplate("common/templates/fail",{msg:""}).render()),this._panes.addTab("no_results",l.createByTemplate("common/templates/no_results",{icon:"CDB-IconFont-defaultUser",title:"Oh! No results",msg:"Unfortunately we haven't found any user with these parameters"}).render()),this._panes.addTab("loading",l.createByTemplate("common/templates/loading",{title:"Getting users…",quote:k()}).render());var a=new h({model:this.organization,organizationUsers:this.organizationUsers});this.addView(a),this.$el.append(a.render().el);var b="loading";0===this.organizationUsers.totalCount()?b="no_results":this.organizationUsers.totalCount()>0&&(b="users"),this._panes.active(b)},_openAddUserDropdown:function(a){var b=this;return this.killEvent(a),this.dropdown?void this._closeDropdown():(this.dropdown=new d.admin.DropdownMenu({className:"Dropdown border",target:e(a.target),width:120,template_base:"organization/organization_users/add_users_template",vertical_position:"down",horizontal_position:"right",horizontal_offset:0,vertical_offset:-10,createUrl:this.organization.viewUrl().create(),tick:"right"}),this.dropdown.bind("optionClicked",function(a){var b=e(a.target);b.hasClass("js-inviteUser")&&(a.preventDefault(),this._onInviteClick())},this),e("body").append(this.dropdown.render().el),d.god.bind("closeDialogs",function(){b._closeDropdown()},this.dropdown),void this.dropdown.open(a))},_closeDropdown:function(){if(this.dropdown){var a=this;d.god.unbind(null,null,this.dropdown),this.dropdown.hide(function(){a.dropdown.clean(),delete a.dropdown})}},_showCleanSearchButton:function(){this.$(".js-clean-search").show()},_hideCleanSearchButton:function(){this.$(".js-clean-search").hide()},_focusSearchInput:function(){var a=this._$searchInput();a.focus().val(a.val())},_onSearchClick:function(a){a&&this.killEvent(a),this._$searchInput().focus()},_onCleanSearchClick:function(a){this.killEvent(a),this._cleanSearch()},_onKeyDown:function(a){var b=a.keyCode===e.ui.keyCode.ENTER,c=a.keyCode===e.ui.keyCode.ESCAPE;b?(this.killEvent(a),this._submitSearch()):c&&(this.killEvent(a),this.pagedSearchModel.get("q")&&this._cleanSearch())},_submitSearch:function(a){var b=this._$searchInput().val().trim();this.pagedSearchModel.set({q:f.stripHTML(b),page:1}),this.pagedSearchModel.fetch(this.organizationUsers)},_$searchInput:function(){return this.$(".js-search-input")},_cleanSearch:function(){this._$searchInput().val(""),this.pagedSearchModel.set({q:"",page:1}),this.pagedSearchModel.fetch(this.organizationUsers)},_onInviteClick:function(){this.dialog=new m({clean_on_hide:!0,enter_to_confirm:!1,organization:this.organization,organizationUsers:this.organizationUsers}).appendToBody()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/paged_search_model":6,"../../common/view_factory":11,"../../common/view_helpers/random_quote":15,"../../common/views/pagination/model":27,"../invite_users/invite_users_dialog_view":57,"./organization_users_footer_view":67,"./organization_users_list_view":68}],70:[function(a,b,c){"use strict";b.exports=a("./src/js/main")},{"./src/js/main":76}],71:[function(a,b,c){"use strict";function d(a,b){var c=a.className.split(" ");c.indexOf(b)<0&&c.push(b),a.className=c.join(" ")}function e(a,b){var c=a.className.split(" "),d=c.indexOf(b);d>=0&&c.splice(d,1),a.className=c.join(" ")}c.add=function(a,b){a.classList?a.classList.add(b):d(a,b)},c.remove=function(a,b){a.classList?a.classList.remove(b):e(a,b)},c.list=function(a){return a.classList?Array.prototype.slice.apply(a.classList):a.className.split(" ")}},{}],72:[function(a,b,c){"use strict";function d(a,b){return window.getComputedStyle(a)[b]}function e(a,b,c){return"number"==typeof c&&(c=c.toString()+"px"),a.style[b]=c,a}function f(a,b){for(var c in b){var d=b[c];"number"==typeof d&&(d=d.toString()+"px"),a.style[c]=d}return a}var g={};g.e=function(a,b){var c=document.createElement(a);return c.className=b,c},g.appendTo=function(a,b){return b.appendChild(a),a},g.css=function(a,b,c){return"object"==typeof b?f(a,b):"undefined"==typeof c?d(a,b):e(a,b,c)},g.matches=function(a,b){return"undefined"!=typeof a.matches?a.matches(b):"undefined"!=typeof a.matchesSelector?a.matchesSelector(b):"undefined"!=typeof a.webkitMatchesSelector?a.webkitMatchesSelector(b):"undefined"!=typeof a.mozMatchesSelector?a.mozMatchesSelector(b):"undefined"!=typeof a.msMatchesSelector?a.msMatchesSelector(b):void 0},g.remove=function(a){"undefined"!=typeof a.remove?a.remove():a.parentNode&&a.parentNode.removeChild(a)},g.queryChildren=function(a,b){return Array.prototype.filter.call(a.childNodes,function(a){return g.matches(a,b)})},b.exports=g},{}],73:[function(a,b,c){"use strict";var d=function(a){this.element=a,this.events={}};d.prototype.bind=function(a,b){"undefined"==typeof this.events[a]&&(this.events[a]=[]),this.events[a].push(b),this.element.addEventListener(a,b,!1)},d.prototype.unbind=function(a,b){var c="undefined"!=typeof b;this.events[a]=this.events[a].filter(function(d){return!(!c||d===b)||(this.element.removeEventListener(a,d,!1),!1)},this)},d.prototype.unbindAll=function(){for(var a in this.events)this.unbind(a)};var e=function(){this.eventElements=[]};e.prototype.eventElement=function(a){var b=this.eventElements.filter(function(b){return b.element===a})[0];return"undefined"==typeof b&&(b=new d(a),this.eventElements.push(b)),b},e.prototype.bind=function(a,b,c){this.eventElement(a).bind(b,c)},e.prototype.unbind=function(a,b,c){this.eventElement(a).unbind(b,c)},e.prototype.unbindAll=function(){for(var a=0;a<this.eventElements.length;a++)this.eventElements[a].unbindAll()},e.prototype.once=function(a,b,c){var d=this.eventElement(a),e=function(a){d.unbind(b,e),c(a)};d.bind(b,e)},b.exports=e},{}],74:[function(a,b,c){"use strict";b.exports=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}()},{}],75:[function(a,b,c){"use strict";var d=a("./class"),e=a("./dom"),f=c.toInt=function(a){return parseInt(a,10)||0},g=c.clone=function(a){if(a){if(Array.isArray(a))return a.map(g);if("object"==typeof a){var b={};for(var c in a)b[c]=g(a[c]);return b}return a}return null};c.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}},c.extend=function(a,b){var c=g(a);for(var d in b)c[d]=g(b[d]);return c},c.isEditable=function(a){return e.matches(a,"input,[contenteditable]")||e.matches(a,"select,[contenteditable]")||e.matches(a,"textarea,[contenteditable]")||e.matches(a,"button,[contenteditable]")},c.removePsClasses=function(a){for(var b=d.list(a),c=0;c<b.length;c++){var e=b[c];0===e.indexOf("ps-")&&d.remove(a,e)}},c.outerWidth=function(a){return f(e.css(a,"width"))+f(e.css(a,"paddingLeft"))+f(e.css(a,"paddingRight"))+f(e.css(a,"borderLeftWidth"))+f(e.css(a,"borderRightWidth"))},c.startScrolling=function(a,b){d.add(a,"ps-in-scrolling"),"undefined"!=typeof b?d.add(a,"ps-"+b):(d.add(a,"ps-x"),d.add(a,"ps-y"))},c.stopScrolling=function(a,b){d.remove(a,"ps-in-scrolling"),"undefined"!=typeof b?d.remove(a,"ps-"+b):(d.remove(a,"ps-x"),d.remove(a,"ps-y"))},c.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":71,"./dom":72}],76:[function(a,b,c){"use strict";var d=a("./plugin/destroy"),e=a("./plugin/initialize"),f=a("./plugin/update");b.exports={initialize:e,update:f,destroy:d}},{"./plugin/destroy":79,"./plugin/initialize":87,"./plugin/update":92}],77:[function(a,b,c){"use strict";var d=a("./update"),e=window.MutationObserver,f=a("./instances"),g=function(a){var b=document.createEvent("Event");return b.initEvent(a,!0,!0),b};b.exports=function(a){if(null!==e&&void 0!==e){var b=f.get(a),c=function(){d(a),a.dispatchEvent(g("ps-dom-change"))};b.observer=new e(c),c();var h={childList:!0,subtree:!0};b.observer.observe(a,h)}}},{"./instances":88,"./update":92}],78:[function(a,b,c){"use strict";b.exports={handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default",autoupdate:!0}},{}],79:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/dom"),f=a("./instances");b.exports=function(a){var b=f.get(a);b&&(b.observer&&b.observer.disconnect(),b.event.unbindAll(),e.remove(b.scrollbarX),e.remove(b.scrollbarY),e.remove(b.scrollbarXRail),e.remove(b.scrollbarYRail),d.removePsClasses(a),f.remove(a))}},{"../lib/dom":72,"../lib/helper":75,"./instances":88}],80:[function(a,b,c){"use strict";function d(a,b){function c(a){return a.getBoundingClientRect()}var d=function(a){a.stopPropagation()};b.event.bind(b.scrollbarY,"click",d),b.event.bind(b.scrollbarYRail,"click",function(d){var e=d.pageY-window.pageYOffset-c(b.scrollbarYRail).top,h=e>b.scrollbarYTop?1:-1;g(a,"top",a.scrollTop+h*b.containerHeight),f(a),d.stopPropagation()}),b.event.bind(b.scrollbarX,"click",d),b.event.bind(b.scrollbarXRail,"click",function(d){var e=d.pageX-window.pageXOffset-c(b.scrollbarXRail).left,h=e>b.scrollbarXLeft?1:-1;g(a,"left",a.scrollLeft+h*b.containerWidth),f(a),d.stopPropagation()})}var e=a("../instances"),f=a("../update-geometry"),g=a("../update-scroll");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":88,"../update-geometry":90,"../update-scroll":91}],81:[function(a,b,c){"use strict";function d(a,b){function c(c){var e=d+c*b.railXRatio,g=Math.max(0,b.scrollbarXRail.getBoundingClientRect().left)+b.railXRatio*(b.railXWidth-b.scrollbarXWidth);e<0?b.scrollbarXLeft=0:e>g?b.scrollbarXLeft=g:b.scrollbarXLeft=e;var h=f.toInt(b.scrollbarXLeft*(b.contentWidth-b.containerWidth)/(b.containerWidth-b.railXRatio*b.scrollbarXWidth))-b.negativeScrollAdjustment;j(a,"left",h)}var d=null,e=null,h=function(b){c(b.pageX-e),i(a),b.stopPropagation(),b.preventDefault()},k=function(){f.stopScrolling(a,"x"),b.event.unbind(b.ownerDocument,"mousemove",h)};b.event.bind(b.scrollbarX,"mousedown",function(c){e=c.pageX,d=f.toInt(g.css(b.scrollbarX,"left"))*b.railXRatio,f.startScrolling(a,"x"),b.event.bind(b.ownerDocument,"mousemove",h),b.event.once(b.ownerDocument,"mouseup",k),c.stopPropagation(),c.preventDefault()})}function e(a,b){function c(c){var e=d+c*b.railYRatio,g=Math.max(0,b.scrollbarYRail.getBoundingClientRect().top)+b.railYRatio*(b.railYHeight-b.scrollbarYHeight);e<0?b.scrollbarYTop=0:e>g?b.scrollbarYTop=g:b.scrollbarYTop=e;var h=f.toInt(b.scrollbarYTop*(b.contentHeight-b.containerHeight)/(b.containerHeight-b.railYRatio*b.scrollbarYHeight));j(a,"top",h)}var d=null,e=null,h=function(b){c(b.pageY-e),i(a),b.stopPropagation(),b.preventDefault()},k=function(){f.stopScrolling(a,"y"),b.event.unbind(b.ownerDocument,"mousemove",h)};b.event.bind(b.scrollbarY,"mousedown",function(c){e=c.pageY,d=f.toInt(g.css(b.scrollbarY,"top"))*b.railYRatio,f.startScrolling(a,"y"),b.event.bind(b.ownerDocument,"mousemove",h),b.event.once(b.ownerDocument,"mouseup",k),c.stopPropagation(),c.preventDefault()})}var f=a("../../lib/helper"),g=a("../../lib/dom"),h=a("../instances"),i=a("../update-geometry"),j=a("../update-scroll");b.exports=function(a){var b=h.get(a);d(a,b),e(a,b)}},{"../../lib/dom":72,"../../lib/helper":75,"../instances":88,"../update-geometry":90,"../update-scroll":91}],82:[function(a,b,c){"use strict";function d(a,b){function c(c,d){var e=a.scrollTop;if(0===c){if(!b.scrollbarYActive)return!1;if(0===e&&d>0||e>=b.contentHeight-b.containerHeight&&d<0)return!b.settings.wheelPropagation}var f=a.scrollLeft;if(0===d){if(!b.scrollbarXActive)return!1;if(0===f&&c<0||f>=b.contentWidth-b.containerWidth&&c>0)return!b.settings.wheelPropagation}return!0}var d=!1;b.event.bind(a,"mouseenter",function(){d=!0}),b.event.bind(a,"mouseleave",function(){d=!1});var g=!1;b.event.bind(b.ownerDocument,"keydown",function(j){if(!(j.isDefaultPrevented&&j.isDefaultPrevented()||j.defaultPrevented)){var k=f.matches(b.scrollbarX,":focus")||f.matches(b.scrollbarY,":focus");if(d||k){var l=document.activeElement?document.activeElement:b.ownerDocument.activeElement;if(l){if("IFRAME"===l.tagName)l=l.contentDocument.activeElement;else for(;l.shadowRoot;)l=l.shadowRoot.activeElement;if(e.isEditable(l))return}var m=0,n=0;switch(j.which){case 37:m=j.metaKey?-b.contentWidth:j.altKey?-b.containerWidth:-30;break;case 38:n=j.metaKey?b.contentHeight:j.altKey?b.containerHeight:30;break;case 39:m=j.metaKey?b.contentWidth:j.altKey?b.containerWidth:30;break;case 40:n=j.metaKey?-b.contentHeight:j.altKey?-b.containerHeight:-30;break;case 33:n=90;break;case 32:n=j.shiftKey?90:-90;break;case 34:n=-90;break;case 35:n=j.ctrlKey?-b.contentHeight:-b.containerHeight;break;case 36:n=j.ctrlKey?a.scrollTop:b.containerHeight;break;default:return}i(a,"top",a.scrollTop-n),i(a,"left",a.scrollLeft+m),h(a),g=c(m,n),g&&j.preventDefault()}}})}var e=a("../../lib/helper"),f=a("../../lib/dom"),g=a("../instances"),h=a("../update-geometry"),i=a("../update-scroll");b.exports=function(a){var b=g.get(a);d(a,b)}},{"../../lib/dom":72,"../../lib/helper":75,"../instances":88,"../update-geometry":90,"../update-scroll":91}],83:[function(a,b,c){"use strict";function d(a,b){function c(c,d){var e=a.scrollTop;if(0===c){if(!b.scrollbarYActive)return!1;if(0===e&&d>0||e>=b.contentHeight-b.containerHeight&&d<0)return!b.settings.wheelPropagation}var f=a.scrollLeft;if(0===d){
if(!b.scrollbarXActive)return!1;if(0===f&&c<0||f>=b.contentWidth-b.containerWidth&&c>0)return!b.settings.wheelPropagation}return!0}function d(a){var b=a.deltaX,c=-1*a.deltaY;return"undefined"!=typeof b&&"undefined"!=typeof c||(b=-1*a.wheelDeltaX/6,c=a.wheelDeltaY/6),a.deltaMode&&1===a.deltaMode&&(b*=10,c*=10),b!==b&&c!==c&&(b=0,c=a.wheelDelta),a.shiftKey?[-c,-b]:[b,c]}function e(b,c){var d=a.querySelector("textarea:hover, select[multiple]:hover, .ps-child:hover");if(d){if(!window.getComputedStyle(d).overflow.match(/(scroll|auto)/))return!1;var e=d.scrollHeight-d.clientHeight;if(e>0&&!(0===d.scrollTop&&c>0||d.scrollTop===e&&c<0))return!0;var f=d.scrollLeft-d.clientWidth;if(f>0&&!(0===d.scrollLeft&&b<0||d.scrollLeft===f&&b>0))return!0}return!1}function h(h){var j=d(h),k=j[0],l=j[1];e(k,l)||(i=!1,b.settings.useBothWheelAxes?b.scrollbarYActive&&!b.scrollbarXActive?(l?g(a,"top",a.scrollTop-l*b.settings.wheelSpeed):g(a,"top",a.scrollTop+k*b.settings.wheelSpeed),i=!0):b.scrollbarXActive&&!b.scrollbarYActive&&(k?g(a,"left",a.scrollLeft+k*b.settings.wheelSpeed):g(a,"left",a.scrollLeft-l*b.settings.wheelSpeed),i=!0):(g(a,"top",a.scrollTop-l*b.settings.wheelSpeed),g(a,"left",a.scrollLeft+k*b.settings.wheelSpeed)),f(a),i=i||c(k,l),i&&(h.stopPropagation(),h.preventDefault()))}var i=!1;"undefined"!=typeof window.onwheel?b.event.bind(a,"wheel",h):"undefined"!=typeof window.onmousewheel&&b.event.bind(a,"mousewheel",h)}var e=a("../instances"),f=a("../update-geometry"),g=a("../update-scroll");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":88,"../update-geometry":90,"../update-scroll":91}],84:[function(a,b,c){"use strict";function d(a,b){b.event.bind(a,"scroll",function(){f(a)})}var e=a("../instances"),f=a("../update-geometry");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":88,"../update-geometry":90}],85:[function(a,b,c){"use strict";function d(a,b){function c(){var a=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===a.toString().length?null:a.getRangeAt(0).commonAncestorContainer}function d(){j||(j=setInterval(function(){return f.get(a)?(h(a,"top",a.scrollTop+k.top),h(a,"left",a.scrollLeft+k.left),void g(a)):void clearInterval(j)},50))}function i(){j&&(clearInterval(j),j=null),e.stopScrolling(a)}var j=null,k={top:0,left:0},l=!1;b.event.bind(b.ownerDocument,"selectionchange",function(){a.contains(c())?l=!0:(l=!1,i())}),b.event.bind(window,"mouseup",function(){l&&(l=!1,i())}),b.event.bind(window,"keyup",function(){l&&(l=!1,i())}),b.event.bind(window,"mousemove",function(b){if(l){var c={x:b.pageX,y:b.pageY},f={left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth,top:a.offsetTop,bottom:a.offsetTop+a.offsetHeight};c.x<f.left+3?(k.left=-5,e.startScrolling(a,"x")):c.x>f.right-3?(k.left=5,e.startScrolling(a,"x")):k.left=0,c.y<f.top+3?(f.top+3-c.y<5?k.top=-5:k.top=-20,e.startScrolling(a,"y")):c.y>f.bottom-3?(c.y-f.bottom+3<5?k.top=5:k.top=20,e.startScrolling(a,"y")):k.top=0,0===k.top&&0===k.left?i():d()}})}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){var b=f.get(a);d(a,b)}},{"../../lib/helper":75,"../instances":88,"../update-geometry":90,"../update-scroll":91}],86:[function(a,b,c){"use strict";function d(a,b,c,d){function e(c,d){var e=a.scrollTop,f=a.scrollLeft,g=Math.abs(c),h=Math.abs(d);if(h>g){if(d<0&&e===b.contentHeight-b.containerHeight||d>0&&0===e)return!b.settings.swipePropagation}else if(g>h&&(c<0&&f===b.contentWidth-b.containerWidth||c>0&&0===f))return!b.settings.swipePropagation;return!0}function i(b,c){h(a,"top",a.scrollTop-c),h(a,"left",a.scrollLeft-b),g(a)}function j(){u=!0}function k(){u=!1}function l(a){return a.targetTouches?a.targetTouches[0]:a}function m(a){return!(!a.targetTouches||1!==a.targetTouches.length)||!(!a.pointerType||"mouse"===a.pointerType||a.pointerType===a.MSPOINTER_TYPE_MOUSE)}function n(a){if(m(a)){v=!0;var b=l(a);q.pageX=b.pageX,q.pageY=b.pageY,r=(new Date).getTime(),null!==t&&clearInterval(t),a.stopPropagation()}}function o(a){var c=a.target,d=c&&c.getAttribute&&c.getAttribute("class")||"";if(!d.match(/ps-prevent-touchmove/)&&(!v&&b.settings.swipePropagation&&n(a),!u&&v&&m(a))){var f=l(a),g={pageX:f.pageX,pageY:f.pageY},h=g.pageX-q.pageX,j=g.pageY-q.pageY;i(h,j),q=g;var k=(new Date).getTime(),o=k-r;o>0&&(s.x=h/o,s.y=j/o,r=k),e(h,j)&&(a.stopPropagation(),a.preventDefault())}}function p(){!u&&v&&(v=!1,clearInterval(t),t=setInterval(function(){return f.get(a)&&(s.x||s.y)?Math.abs(s.x)<.01&&Math.abs(s.y)<.01?void clearInterval(t):(i(30*s.x,30*s.y),s.x*=.8,void(s.y*=.8)):void clearInterval(t)},10))}var q={},r=0,s={},t=null,u=!1,v=!1;c?(b.event.bind(window,"touchstart",j),b.event.bind(window,"touchend",k),b.event.bind(a,"touchstart",n),b.event.bind(a,"touchmove",o),b.event.bind(a,"touchend",p)):d&&(window.PointerEvent?(b.event.bind(window,"pointerdown",j),b.event.bind(window,"pointerup",k),b.event.bind(a,"pointerdown",n),b.event.bind(a,"pointermove",o),b.event.bind(a,"pointerup",p)):window.MSPointerEvent&&(b.event.bind(window,"MSPointerDown",j),b.event.bind(window,"MSPointerUp",k),b.event.bind(a,"MSPointerDown",n),b.event.bind(a,"MSPointerMove",o),b.event.bind(a,"MSPointerUp",p)))}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){if(e.env.supportsTouch||e.env.supportsIePointer){var b=f.get(a);d(a,b,e.env.supportsTouch,e.env.supportsIePointer)}}},{"../../lib/helper":75,"../instances":88,"../update-geometry":90,"../update-scroll":91}],87:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/class"),f=a("./instances"),g=a("./update-geometry"),h=a("./autoupdate"),i=a("./resizer"),j={"click-rail":a("./handler/click-rail"),"drag-scrollbar":a("./handler/drag-scrollbar"),keyboard:a("./handler/keyboard"),wheel:a("./handler/mouse-wheel"),touch:a("./handler/touch"),selection:a("./handler/selection")},k=a("./handler/native-scroll");b.exports=function(a,b){b="object"==typeof b?b:{},e.add(a,"ps-container");var c=f.add(a);c.settings=d.extend(c.settings,b),e.add(a,"ps-theme-"+c.settings.theme),c.settings.handlers.forEach(function(b){j[b](a)}),k(a),g(a),c.settings.autoupdate&&(h(a),i(a))}},{"../lib/class":71,"../lib/helper":75,"./autoupdate":77,"./handler/click-rail":80,"./handler/drag-scrollbar":81,"./handler/keyboard":82,"./handler/mouse-wheel":83,"./handler/native-scroll":84,"./handler/selection":85,"./handler/touch":86,"./instances":88,"./resizer":89,"./update-geometry":90}],88:[function(a,b,c){"use strict";function d(a){function b(){i.add(a,"ps-focus")}function c(){i.remove(a,"ps-focus")}var d=this;d.settings=h.clone(j),d.containerWidth=null,d.containerHeight=null,d.contentWidth=null,d.contentHeight=null,d.isRtl="rtl"===k.css(a,"direction"),d.isNegativeScroll=function(){var b=a.scrollLeft,c=null;return a.scrollLeft=-1,c=a.scrollLeft<0,a.scrollLeft=b,c}(),d.negativeScrollAdjustment=d.isNegativeScroll?a.scrollWidth-a.clientWidth:0,d.event=new l,d.ownerDocument=a.ownerDocument||document,d.scrollbarXRail=k.appendTo(k.e("div","ps-scrollbar-x-rail"),a),d.scrollbarX=k.appendTo(k.e("div","ps-scrollbar-x"),d.scrollbarXRail),d.scrollbarX.setAttribute("tabindex",0),d.event.bind(d.scrollbarX,"focus",b),d.event.bind(d.scrollbarX,"blur",c),d.scrollbarXActive=null,d.scrollbarXWidth=null,d.scrollbarXLeft=null,d.scrollbarXBottom=h.toInt(k.css(d.scrollbarXRail,"bottom")),d.isScrollbarXUsingBottom=d.scrollbarXBottom===d.scrollbarXBottom,d.scrollbarXTop=d.isScrollbarXUsingBottom?null:h.toInt(k.css(d.scrollbarXRail,"top")),d.railBorderXWidth=h.toInt(k.css(d.scrollbarXRail,"borderLeftWidth"))+h.toInt(k.css(d.scrollbarXRail,"borderRightWidth")),k.css(d.scrollbarXRail,"display","block"),d.railXMarginWidth=h.toInt(k.css(d.scrollbarXRail,"marginLeft"))+h.toInt(k.css(d.scrollbarXRail,"marginRight")),k.css(d.scrollbarXRail,"display",""),d.railXWidth=null,d.railXRatio=null,d.scrollbarYRail=k.appendTo(k.e("div","ps-scrollbar-y-rail"),a),d.scrollbarY=k.appendTo(k.e("div","ps-scrollbar-y"),d.scrollbarYRail),d.scrollbarY.setAttribute("tabindex",0),d.event.bind(d.scrollbarY,"focus",b),d.event.bind(d.scrollbarY,"blur",c),d.scrollbarYActive=null,d.scrollbarYHeight=null,d.scrollbarYTop=null,d.scrollbarYRight=h.toInt(k.css(d.scrollbarYRail,"right")),d.isScrollbarYUsingRight=d.scrollbarYRight===d.scrollbarYRight,d.scrollbarYLeft=d.isScrollbarYUsingRight?null:h.toInt(k.css(d.scrollbarYRail,"left")),d.scrollbarYOuterWidth=d.isRtl?h.outerWidth(d.scrollbarY):null,d.railBorderYWidth=h.toInt(k.css(d.scrollbarYRail,"borderTopWidth"))+h.toInt(k.css(d.scrollbarYRail,"borderBottomWidth")),k.css(d.scrollbarYRail,"display","block"),d.railYMarginHeight=h.toInt(k.css(d.scrollbarYRail,"marginTop"))+h.toInt(k.css(d.scrollbarYRail,"marginBottom")),k.css(d.scrollbarYRail,"display",""),d.railYHeight=null,d.railYRatio=null}function e(a){return a.getAttribute("data-ps-id")}function f(a,b){a.setAttribute("data-ps-id",b)}function g(a){a.removeAttribute("data-ps-id")}var h=a("../lib/helper"),i=a("../lib/class"),j=a("./default-setting"),k=a("../lib/dom"),l=a("../lib/event-manager"),m=a("../lib/guid"),n={};c.add=function(a){var b=m();return f(a,b),n[b]=new d(a),n[b]},c.remove=function(a){delete n[e(a)],g(a)},c.get=function(a){return n[e(a)]}},{"../lib/class":71,"../lib/dom":72,"../lib/event-manager":73,"../lib/guid":74,"../lib/helper":75,"./default-setting":78}],89:[function(a,b,c){"use strict";var d=a("./update"),e=a("./instances"),f=a("../lib/helper");b.exports=function(a){var b=e.get(a),c=function(){d(a)};b.event.bind(window,"resize",f.debounce(c,60))}},{"../lib/helper":75,"./instances":88,"./update":92}],90:[function(a,b,c){"use strict";function d(a,b){return a.settings.minScrollbarLength&&(b=Math.max(b,a.settings.minScrollbarLength)),a.settings.maxScrollbarLength&&(b=Math.min(b,a.settings.maxScrollbarLength)),b}function e(a,b){var c={width:b.railXWidth};b.isRtl?c.left=b.negativeScrollAdjustment+a.scrollLeft+b.containerWidth-b.contentWidth:c.left=a.scrollLeft,b.isScrollbarXUsingBottom?c.bottom=b.scrollbarXBottom-a.scrollTop:c.top=b.scrollbarXTop+a.scrollTop,h.css(b.scrollbarXRail,c);var d={top:a.scrollTop,height:b.railYHeight};b.isScrollbarYUsingRight?b.isRtl?d.right=b.contentWidth-(b.negativeScrollAdjustment+a.scrollLeft)-b.scrollbarYRight-b.scrollbarYOuterWidth:d.right=b.scrollbarYRight-a.scrollLeft:b.isRtl?d.left=b.negativeScrollAdjustment+a.scrollLeft+2*b.containerWidth-b.contentWidth-b.scrollbarYLeft-b.scrollbarYOuterWidth:d.left=b.scrollbarYLeft+a.scrollLeft,h.css(b.scrollbarYRail,d),h.css(b.scrollbarX,{left:b.scrollbarXLeft,width:b.scrollbarXWidth-b.railBorderXWidth}),h.css(b.scrollbarY,{top:b.scrollbarYTop,height:b.scrollbarYHeight-b.railBorderYWidth})}var f=a("../lib/helper"),g=a("../lib/class"),h=a("../lib/dom"),i=a("./instances"),j=a("./update-scroll");b.exports=function(a){var b=i.get(a);b.containerWidth=a.clientWidth,b.containerHeight=a.clientHeight,b.contentWidth=a.scrollWidth,b.contentHeight=a.scrollHeight;var c;a.contains(b.scrollbarXRail)||(c=h.queryChildren(a,".ps-scrollbar-x-rail"),c.length>0&&c.forEach(function(a){h.remove(a)}),h.appendTo(b.scrollbarXRail,a)),a.contains(b.scrollbarYRail)||(c=h.queryChildren(a,".ps-scrollbar-y-rail"),c.length>0&&c.forEach(function(a){h.remove(a)}),h.appendTo(b.scrollbarYRail,a)),!b.settings.suppressScrollX&&b.containerWidth+b.settings.scrollXMarginOffset<b.contentWidth?(b.scrollbarXActive=!0,b.railXWidth=b.containerWidth-b.railXMarginWidth,b.railXRatio=b.containerWidth/b.railXWidth,b.scrollbarXWidth=d(b,f.toInt(b.railXWidth*b.containerWidth/b.contentWidth)),b.scrollbarXLeft=f.toInt((b.negativeScrollAdjustment+a.scrollLeft)*(b.railXWidth-b.scrollbarXWidth)/(b.contentWidth-b.containerWidth))):b.scrollbarXActive=!1,!b.settings.suppressScrollY&&b.containerHeight+b.settings.scrollYMarginOffset<b.contentHeight?(b.scrollbarYActive=!0,b.railYHeight=b.containerHeight-b.railYMarginHeight,b.railYRatio=b.containerHeight/b.railYHeight,b.scrollbarYHeight=d(b,f.toInt(b.railYHeight*b.containerHeight/b.contentHeight)),b.scrollbarYTop=f.toInt(a.scrollTop*(b.railYHeight-b.scrollbarYHeight)/(b.contentHeight-b.containerHeight))):b.scrollbarYActive=!1,b.scrollbarXLeft>=b.railXWidth-b.scrollbarXWidth&&(b.scrollbarXLeft=b.railXWidth-b.scrollbarXWidth),b.scrollbarYTop>=b.railYHeight-b.scrollbarYHeight&&(b.scrollbarYTop=b.railYHeight-b.scrollbarYHeight),e(a,b),b.scrollbarXActive?g.add(a,"ps-active-x"):(g.remove(a,"ps-active-x"),b.scrollbarXWidth=0,b.scrollbarXLeft=0,j(a,"left",0)),b.scrollbarYActive?g.add(a,"ps-active-y"):(g.remove(a,"ps-active-y"),b.scrollbarYHeight=0,b.scrollbarYTop=0,j(a,"top",0))}},{"../lib/class":71,"../lib/dom":72,"../lib/helper":75,"./instances":88,"./update-scroll":91}],91:[function(a,b,c){"use strict";var d,e,f=a("./instances"),g=function(a){var b=document.createEvent("Event");return b.initEvent(a,!0,!0),b};b.exports=function(a,b,c){if("undefined"==typeof a)throw"You must provide an element to the update-scroll function";if("undefined"==typeof b)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof c)throw"You must provide a value to the update-scroll function";"top"===b&&c<=0&&(a.scrollTop=c=0,a.dispatchEvent(g("ps-y-reach-start"))),"left"===b&&c<=0&&(a.scrollLeft=c=0,a.dispatchEvent(g("ps-x-reach-start")));var h=f.get(a);"top"===b&&c>=h.contentHeight-h.containerHeight&&(c=h.contentHeight-h.containerHeight,c-a.scrollTop<=1?c=a.scrollTop:a.scrollTop=c,a.dispatchEvent(g("ps-y-reach-end"))),"left"===b&&c>=h.contentWidth-h.containerWidth&&(c=h.contentWidth-h.containerWidth,c-a.scrollLeft<=1?c=a.scrollLeft:a.scrollLeft=c,a.dispatchEvent(g("ps-x-reach-end"))),d||(d=a.scrollTop),e||(e=a.scrollLeft),"top"===b&&c<d&&a.dispatchEvent(g("ps-scroll-up")),"top"===b&&c>d&&a.dispatchEvent(g("ps-scroll-down")),"left"===b&&c<e&&a.dispatchEvent(g("ps-scroll-left")),"left"===b&&c>e&&a.dispatchEvent(g("ps-scroll-right")),"top"===b&&(a.scrollTop=d=c,a.dispatchEvent(g("ps-scroll-y"))),"left"===b&&(a.scrollLeft=e=c,a.dispatchEvent(g("ps-scroll-x")))}},{"./instances":88}],92:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/dom"),f=a("./instances"),g=a("./update-geometry"),h=a("./update-scroll");b.exports=function(a){var b=f.get(a);b&&(b.negativeScrollAdjustment=b.isNegativeScroll?a.scrollWidth-a.clientWidth:0,e.css(b.scrollbarXRail,"display","block"),e.css(b.scrollbarYRail,"display","block"),b.railXMarginWidth=d.toInt(e.css(b.scrollbarXRail,"marginLeft"))+d.toInt(e.css(b.scrollbarXRail,"marginRight")),b.railYMarginHeight=d.toInt(e.css(b.scrollbarYRail,"marginTop"))+d.toInt(e.css(b.scrollbarYRail,"marginBottom")),e.css(b.scrollbarXRail,"display","none"),e.css(b.scrollbarYRail,"display","none"),g(a),h(a,"top",a.scrollTop),h(a,"left",a.scrollLeft),e.css(b.scrollbarXRail,"display",""),e.css(b.scrollbarYRail,"display",""))}},{"../lib/dom":72,"../lib/helper":75,"./instances":88,"./update-geometry":90,"./update-scroll":91}],93:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.prependListener=k,n.prependOnceListener=k,n.listeners=function(a){return[]},n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],94:[function(a,b,c){(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&f<g;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=v(d,f,4);var g=!C(c)&&u.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function d(a){return function(b,c,d){c=w(c,d);for(var e=B(b),f=a>0?0:e-1;f>=0&&f<e;f+=a)if(c(b[f],f,b))return f;return-1}}function e(a,b,c){return function(d,e,f){var g=0,h=B(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(m.call(d,g,h),u.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&f<h;f+=a)if(d[f]===e)return f;return-1}}function f(a,b){var c=H.length,d=a.constructor,e=u.isFunction(d)&&d.prototype||j,f="constructor";for(u.has(a,f)&&!u.contains(b,f)&&b.push(f);c--;)f=H[c],f in a&&a[f]!==e[f]&&!u.contains(b,f)&&b.push(f)}var g=this,h=g._,i=Array.prototype,j=Object.prototype,k=Function.prototype,l=i.push,m=i.slice,n=j.toString,o=j.hasOwnProperty,p=Array.isArray,q=Object.keys,r=k.bind,s=Object.create,t=function(){},u=function(a){return a instanceof u?a:this instanceof u?void(this._wrapped=a):new u(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=u),c._=u):g._=u,u.VERSION="1.8.3";var v=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},w=function(a,b,c){return null==a?u.identity:u.isFunction(a)?v(a,b,c):u.isObject(a)?u.matcher(a):u.property(a)};u.iteratee=function(a,b){return w(a,b,1/0)};var x=function(a,b){return function(c){var d=arguments.length;if(d<2||null==c)return c;for(var e=1;e<d;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;i<h;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},y=function(a){if(!u.isObject(a))return{};if(s)return s(a);t.prototype=a;var b=new t;return t.prototype=null,b},z=function(a){return function(b){return null==b?void 0:b[a]}},A=Math.pow(2,53)-1,B=z("length"),C=function(a){var b=B(a);return"number"==typeof b&&b>=0&&b<=A};u.each=u.forEach=function(a,b,c){b=v(b,c);var d,e;if(C(a))for(d=0,e=a.length;d<e;d++)b(a[d],d,a);else{var f=u.keys(a);for(d=0,e=f.length;d<e;d++)b(a[f[d]],f[d],a)}return a},u.map=u.collect=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=Array(e),g=0;g<e;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},u.reduce=u.foldl=u.inject=a(1),u.reduceRight=u.foldr=a(-1),u.find=u.detect=function(a,b,c){var d;if(d=C(a)?u.findIndex(a,b,c):u.findKey(a,b,c),void 0!==d&&d!==-1)return a[d]},u.filter=u.select=function(a,b,c){var d=[];return b=w(b,c),u.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},u.reject=function(a,b,c){return u.filter(a,u.negate(w(b)),c)},u.every=u.all=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},u.some=u.any=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},u.contains=u.includes=u.include=function(a,b,c,d){return C(a)||(a=u.values(a)),("number"!=typeof c||d)&&(c=0),u.indexOf(a,b,c)>=0},u.invoke=function(a,b){var c=m.call(arguments,2),d=u.isFunction(b);return u.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},u.pluck=function(a,b){return u.map(a,u.property(b))},u.where=function(a,b){return u.filter(a,u.matcher(b))},u.findWhere=function(a,b){return u.find(a,u.matcher(b))},u.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;h<i;h++)d=a[h],d>f&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},u.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;h<i;h++)d=a[h],d<f&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(e<g||e===1/0&&f===1/0)&&(f=a,g=e)});return f},u.shuffle=function(a){for(var b,c=C(a)?a:u.values(a),d=c.length,e=Array(d),f=0;f<d;f++)b=u.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},u.sample=function(a,b,c){return null==b||c?(C(a)||(a=u.values(a)),a[u.random(a.length-1)]):u.shuffle(a).slice(0,Math.max(0,b))},u.sortBy=function(a,b,c){return b=w(b,c),u.pluck(u.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var D=function(a){return function(b,c,d){var e={};return c=w(c,d),u.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};u.groupBy=D(function(a,b,c){u.has(a,c)?a[c].push(b):a[c]=[b]}),u.indexBy=D(function(a,b,c){a[c]=b}),u.countBy=D(function(a,b,c){u.has(a,c)?a[c]++:a[c]=1}),u.toArray=function(a){return a?u.isArray(a)?m.call(a):C(a)?u.map(a,u.identity):u.values(a):[]},u.size=function(a){return null==a?0:C(a)?a.length:u.keys(a).length},u.partition=function(a,b,c){b=w(b,c);var d=[],e=[];return u.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},u.first=u.head=u.take=function(a,b,c){if(null!=a)return null==b||c?a[0]:u.initial(a,a.length-b)},u.initial=function(a,b,c){return m.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},u.last=function(a,b,c){if(null!=a)return null==b||c?a[a.length-1]:u.rest(a,Math.max(0,a.length-b))},u.rest=u.tail=u.drop=function(a,b,c){return m.call(a,null==b||c?1:b)},u.compact=function(a){return u.filter(a,u.identity)};var E=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=B(a);g<h;g++){var i=a[g];if(C(i)&&(u.isArray(i)||u.isArguments(i))){b||(i=E(i,b,c));var j=0,k=i.length;for(e.length+=k;j<k;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};u.flatten=function(a,b){return E(a,b,!1)},u.without=function(a){return u.difference(a,m.call(arguments,1))},u.uniq=u.unique=function(a,b,c,d){u.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=w(c,d));for(var e=[],f=[],g=0,h=B(a);g<h;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?u.contains(f,j)||(f.push(j),e.push(i)):u.contains(e,i)||e.push(i)}return e},u.union=function(){return u.uniq(E(arguments,!0,!0))},u.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=B(a);d<e;d++){var f=a[d];if(!u.contains(b,f)){for(var g=1;g<c&&u.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},u.difference=function(a){var b=E(arguments,!0,!0,1);return u.filter(a,function(a){return!u.contains(b,a)})},u.zip=function(){return u.unzip(arguments)},u.unzip=function(a){for(var b=a&&u.max(a,B).length||0,c=Array(b),d=0;d<b;d++)c[d]=u.pluck(a,d);return c},u.object=function(a,b){for(var c={},d=0,e=B(a);d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},u.findIndex=d(1),u.findLastIndex=d(-1),u.sortedIndex=function(a,b,c,d){c=w(c,d,1);for(var e=c(b),f=0,g=B(a);f<g;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},u.indexOf=e(1,u.findIndex,u.sortedIndex),u.lastIndexOf=e(-1,u.findLastIndex),u.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;f<d;f++,a+=c)e[f]=a;return e};var F=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=y(a.prototype),g=a.apply(f,e);return u.isObject(g)?g:f};u.bind=function(a,b){if(r&&a.bind===r)return r.apply(a,m.call(arguments,1));if(!u.isFunction(a))throw new TypeError("Bind must be called on a function");var c=m.call(arguments,2),d=function(){return F(a,d,b,this,c.concat(m.call(arguments)))};return d},u.partial=function(a){var b=m.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;g<e;g++)f[g]=b[g]===u?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return F(a,c,this,this,f)};return c},u.bindAll=function(a){var b,c,d=arguments.length;if(d<=1)throw new Error("bindAll must be passed function names");for(b=1;b<d;b++)c=arguments[b],a[c]=u.bind(a[c],a);return a},u.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return u.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},u.delay=function(a,b){var c=m.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},u.defer=u.partial(u.delay,u,1),u.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:u.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=u.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},u.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=u.now()-g;j<b&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=u.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},u.wrap=function(a,b){return u.partial(b,a)},u.negate=function(a){return function(){return!a.apply(this,arguments)}},u.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},u.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},u.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),a<=1&&(b=null),c}},u.once=u.partial(u.before,2);var G=!{toString:null}.propertyIsEnumerable("toString"),H=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];u.keys=function(a){if(!u.isObject(a))return[];if(q)return q(a);var b=[];for(var c in a)u.has(a,c)&&b.push(c);return G&&f(a,b),b},u.allKeys=function(a){if(!u.isObject(a))return[];var b=[];for(var c in a)b.push(c);return G&&f(a,b),b},u.values=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},u.mapObject=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=e.length,g={},h=0;h<f;h++)d=e[h],g[d]=b(a[d],d,a);return g},u.pairs=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=[b[e],a[b[e]]];return d},u.invert=function(a){for(var b={},c=u.keys(a),d=0,e=c.length;d<e;d++)b[a[c[d]]]=c[d];return b},u.functions=u.methods=function(a){var b=[];for(var c in a)u.isFunction(a[c])&&b.push(c);return b.sort()},u.extend=x(u.allKeys),u.extendOwn=u.assign=x(u.keys),u.findKey=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=0,g=e.length;f<g;f++)if(d=e[f],b(a[d],d,a))return d},u.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;u.isFunction(b)?(e=u.allKeys(g),d=v(b,c)):(e=E(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;h<i;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},u.omit=function(a,b,c){if(u.isFunction(b))b=u.negate(b);else{var d=u.map(E(arguments,!1,!1,1),String);b=function(a,b){return!u.contains(d,b)}}return u.pick(a,b,c)},u.defaults=x(u.allKeys,!0),u.create=function(a,b){var c=y(a);return b&&u.extendOwn(c,b),c},u.clone=function(a){return u.isObject(a)?u.isArray(a)?a.slice():u.extend({},a):a},u.tap=function(a,b){return b(a),a},u.isMatch=function(a,b){var c=u.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;f<d;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var I=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof u&&(a=a._wrapped),b instanceof u&&(b=b._wrapped);var e=n.call(a);if(e!==n.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(u.isFunction(g)&&g instanceof g&&u.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!I(a[i],b[i],c,d))return!1}else{var j,k=u.keys(a);if(i=k.length,u.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!u.has(b,j)||!I(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};u.isEqual=function(a,b){return I(a,b)},u.isEmpty=function(a){return null==a||(C(a)&&(u.isArray(a)||u.isString(a)||u.isArguments(a))?0===a.length:0===u.keys(a).length)},u.isElement=function(a){return!(!a||1!==a.nodeType)},u.isArray=p||function(a){return"[object Array]"===n.call(a)},u.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},u.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){u["is"+a]=function(b){return n.call(b)==="[object "+a+"]"}}),u.isArguments(arguments)||(u.isArguments=function(a){return u.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(u.isFunction=function(a){return"function"==typeof a||!1}),u.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},u.isNaN=function(a){return u.isNumber(a)&&a!==+a},u.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===n.call(a)},u.isNull=function(a){return null===a},u.isUndefined=function(a){return void 0===a},u.has=function(a,b){return null!=a&&o.call(a,b)},u.noConflict=function(){return g._=h,this},u.identity=function(a){return a},u.constant=function(a){return function(){return a}},u.noop=function(){},u.property=z,u.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},u.matcher=u.matches=function(a){return a=u.extendOwn({},a),function(b){return u.isMatch(b,a)}},u.times=function(a,b,c){var d=Array(Math.max(0,a));b=v(b,c,1);for(var e=0;e<a;e++)d[e]=b(e);return d},u.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},u.now=Date.now||function(){return(new Date).getTime()};var J={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},K=u.invert(J),L=function(a){var b=function(b){return a[b]},c="(?:"+u.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};u.escape=L(J),u.unescape=L(K),u.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),u.isFunction(d)?d.call(a):d};var M=0;u.uniqueId=function(a){var b=++M+"";return a?a+b:b},u.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(a){return"\\"+O[a]};u.template=function(a,b,c){!b&&c&&(b=c),b=u.defaults({},b,u.templateSettings);var d=RegExp([(b.escape||N).source,(b.interpolate||N).source,(b.evaluate||N).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(P,Q),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(a){throw a.source=f,a}var h=function(a){return g.call(this,a,u)},i=b.variable||"obj";return h.source="function("+i+"){\n"+f+"}",h},u.chain=function(a){var b=u(a);return b._chain=!0,b};var R=function(a,b){return a._chain?u(b).chain():b;
};u.mixin=function(a){u.each(u.functions(a),function(b){var c=u[b]=a[b];u.prototype[b]=function(){var a=[this._wrapped];return l.apply(a,arguments),R(this,c.apply(u,a))}})},u.mixin(u),u.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=i[a];u.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],R(this,c)}}),u.each(["concat","join","slice"],function(a){var b=i[a];u.prototype[a]=function(){return R(this,b.apply(this._wrapped,arguments))}}),u.prototype.value=function(){return this._wrapped},u.prototype.valueOf=u.prototype.toJSON=u.prototype.value,u.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return u})}).call(this)},{}],95:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],96:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],97:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(d<0)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return a<10?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];c<f;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":96,_process:93,inherits:95}],98:[function(b,c,d){!function(c){function d(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function e(){var a=b("util");return"Markdown.mk_block( "+a.inspect(this.toString())+", "+a.inspect(this.trailing)+", "+a.inspect(this.lineNumber)+" )"}function f(a){for(var b=0,c=-1;(c=a.indexOf("\n",c+1))!==-1;)b++;return b}function g(a,b){function c(a){this.len_after=a,this.name="close_"+b}var d=a+"_state",e="strong"==a?"em_state":"strong_state";return function(f,g){if(this[d][0]==b)return this[d].shift(),[f.length,new c(f.length-b.length)];var h=this[e].slice(),i=this[d].slice();this[d].unshift(b);var j=this.processInline(f.substr(b.length)),k=j[j.length-1];this[d].shift();if(k instanceof c){j.pop();var l=f.length-k.len_after;return[l,[a].concat(j)]}return this[e]=h,this[d]=i,[b.length,b]}}function h(a){for(var b=a.split(""),c=[""],d=!1;b.length;){var e=b.shift();switch(e){case" ":d?c[c.length-1]+=e:c.push("");break;case"'":case'"':d=!d;break;case"\\":e=b.shift();default:c[c.length-1]+=e}}return c}function i(a){return r(a)&&a.length>1&&"object"==typeof a[1]&&!r(a[1])?a[1]:void 0}function j(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function k(a){if("string"==typeof a)return j(a);var b=a.shift(),c={},d=[];for(!a.length||"object"!=typeof a[0]||a[0]instanceof Array||(c=a.shift());a.length;)d.push(k(a.shift()));var e="";for(var f in c)e+=" "+f+'="'+j(c[f])+'"';return"img"==b||"br"==b||"hr"==b?"<"+b+e+"/>":"<"+b+e+">"+d.join("")+"</"+b+">"}function l(a,b,c){var d;c=c||{};var e=a.slice(0);"function"==typeof c.preprocessTreeNode&&(e=c.preprocessTreeNode(e,b));var f=i(e);if(f){e[1]={};for(d in f)e[1][d]=f[d];f=e[1]}if("string"==typeof e)return e;switch(e[0]){case"header":e[0]="h"+e[1].level,delete e[1].level;break;case"bulletlist":e[0]="ul";break;case"numberlist":e[0]="ol";break;case"listitem":e[0]="li";break;case"para":e[0]="p";break;case"markdown":e[0]="html",f&&delete f.references;break;case"code_block":e[0]="pre",d=f?2:1;var g=["code"];g.push.apply(g,e.splice(d,e.length-d)),e[d]=g;break;case"inlinecode":e[0]="code";break;case"img":e[1].src=e[1].href,delete e[1].href;break;case"linebreak":e[0]="br";break;case"link":e[0]="a";break;case"link_ref":e[0]="a";var h=b[f.ref];if(!h)return f.original;delete f.ref,f.href=h.href,h.title&&(f.title=h.title),delete f.original;break;case"img_ref":e[0]="img";var h=b[f.ref];if(!h)return f.original;delete f.ref,f.src=h.href,h.title&&(f.title=h.title),delete f.original}if(d=1,f){for(var j in e[1]){d=2;break}1===d&&e.splice(d,1)}for(;d<e.length;++d)e[d]=l(e[d],b,c);return e}function m(a){for(var b=i(a)?2:1;b<a.length;)"string"==typeof a[b]?b+1<a.length&&"string"==typeof a[b+1]?a[b]+=a.splice(b+1,1)[0]:++b:(m(a[b]),++b)}var n=c.Markdown=function(a){switch(typeof a){case"undefined":this.dialect=n.dialects.Gruber;break;case"object":this.dialect=a;break;default:if(!(a in n.dialects))throw new Error("Unknown Markdown dialect '"+String(a)+"'");this.dialect=n.dialects[a]}this.em_state=[],this.strong_state=[],this.debug_indent=""};c.parse=function(a,b){var c=new n(b);return c.toTree(a)},c.toHTML=function(a,b,d){var e=c.toHTMLTree(a,b,d);return c.renderJsonML(e)},c.toHTMLTree=function(a,b,c){"string"==typeof a&&(a=this.parse(a,b));var d=i(a),e={};d&&d.references&&(e=d.references);var f=l(a,e,c);return m(f),f};var o=n.mk_block=function(a,b,c){1==arguments.length&&(b="\n\n");var f=new String(a);return f.trailing=b,f.inspect=e,f.toSource=d,void 0!=c&&(f.lineNumber=c),f};n.prototype.split_blocks=function(a,b){a=a.replace(/(\r\n|\n|\r)/g,"\n");var c,d=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,e=[],g=1;for(null!=(c=/^(\s*\n)/.exec(a))&&(g+=f(c[0]),d.lastIndex=c[0].length);null!==(c=d.exec(a));)"\n#"==c[2]&&(c[2]="\n",d.lastIndex--),e.push(o(c[1],c[2],g)),g+=f(c[0]);return e},n.prototype.processBlock=function(a,b){var c=this.dialect.block,d=c.__order__;if("__call__"in c)return c.__call__.call(this,a,b);for(var e=0;e<d.length;e++){var f=c[d[e]].call(this,a,b);if(f)return(!r(f)||f.length>0&&!r(f[0]))&&this.debug(d[e],"didn't return a proper array"),f}return[]},n.prototype.processInline=function(a){return this.dialect.inline.__call__.call(this,String(a))},n.prototype.toTree=function(a,b){var c=a instanceof Array?a:this.split_blocks(a),d=this.tree;try{for(this.tree=b||this.tree||["markdown"];c.length;){var e=this.processBlock(c.shift(),c);e.length&&this.tree.push.apply(this.tree,e)}return this.tree}finally{b&&(this.tree=d)}},n.prototype.debug=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,a),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,a)},n.prototype.loop_re_over_block=function(a,b,c){for(var d,e=b.valueOf();e.length&&null!=(d=a.exec(e));)e=e.substr(d[0].length),c.call(this,d);return e},n.dialects={},n.dialects.Gruber={block:{atxHeader:function(a,b){var c=a.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(c){var d=["header",{level:c[1].length}];return Array.prototype.push.apply(d,this.processInline(c[2])),c[0].length<a.length&&b.unshift(o(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},setextHeader:function(a,b){var c=a.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(c){var d="="===c[2]?1:2,e=["header",{level:d},c[1]];return c[0].length<a.length&&b.unshift(o(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[e]}},code:function(a,b){var c=[],d=/^(?: {0,3}\t| {4})(.*)\n?/;if(a.match(d)){a:for(;;){var e=this.loop_re_over_block(d,a.valueOf(),function(a){c.push(a[1])});if(e.length){b.unshift(o(e,a.trailing));break a}if(!b.length)break a;if(!b[0].match(d))break a;c.push(a.trailing.replace(/[^\n]/g,"").substring(2)),a=b.shift()}return[["code_block",c.join("\n")]]}},horizRule:function(a,b){var c=a.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(c){var d=[["hr"]];return c[1]&&d.unshift.apply(d,this.processBlock(c[1],[])),c[3]&&b.unshift(o(c[3])),d}},lists:function(){function a(a){return new RegExp("(?:^("+i+"{0,"+a+"} {0,3})("+f+")\\s+)|(^"+i+"{0,"+(a-1)+"}[ ]{0,4})")}function b(a){return a.replace(/ {0,3}\t/g,"    ")}function c(a,b,c,d){if(b)return void a.push(["para"].concat(c));var e=a[a.length-1]instanceof Array&&"para"==a[a.length-1][0]?a[a.length-1]:a;d&&a.length>1&&c.unshift(d);for(var f=0;f<c.length;f++){var g=c[f],h="string"==typeof g;h&&e.length>1&&"string"==typeof e[e.length-1]?e[e.length-1]+=g:e.push(g)}}function d(a,b){for(var c=new RegExp("^("+i+"{"+a+"}.*?\\n?)*$"),d=new RegExp("^"+i+"{"+a+"}","gm"),e=[];b.length>0&&c.exec(b[0]);){var f=b.shift(),g=f.replace(d,"");e.push(o(g,f.trailing,f.lineNumber))}return e}function e(a,b,c){var d=a.list,e=d[d.length-1];if(!(e[1]instanceof Array&&"para"==e[1][0]))if(b+1==c.length)e.push(["para"].concat(e.splice(1,e.length-1)));else{var f=e.pop();e.push(["para"].concat(e.splice(1,e.length-1)),f)}}var f="[*+-]|\\d+\\.",g=/[*+-]/,h=new RegExp("^( {0,3})("+f+")[ \t]+"),i="(?: {0,3}\\t| {4})";return function(f,i){function j(a){var b=g.exec(a[2])?["bulletlist"]:["numberlist"];return n.push({list:b,indent:a[1]}),b}var k=f.match(h);if(k){for(var l,m,n=[],o=j(k),p=!1,r=[n[0].list];;){for(var s=f.split(/(?=\n)/),t="",u=0;u<s.length;u++){var v="",w=s[u].replace(/^\n/,function(a){return v=a,""}),x=a(n.length);if(k=w.match(x),void 0!==k[1]){t.length&&(c(l,p,this.processInline(t),v),p=!1,t=""),k[1]=b(k[1]);var y=Math.floor(k[1].length/4)+1;if(y>n.length)o=j(k),l.push(o),l=o[1]=["listitem"];else{var z=!1;for(m=0;m<n.length;m++)if(n[m].indent==k[1]){o=n[m].list,n.splice(m+1,n.length-(m+1)),z=!0;break}z||(y++,y<=n.length?(n.splice(y,n.length-y),o=n[y-1].list):(o=j(k),l.push(o))),l=["listitem"],o.push(l)}v=""}w.length>k[0].length&&(t+=v+w.substr(k[0].length))}t.length&&(c(l,p,this.processInline(t),v),p=!1,t="");var A=d(n.length,i);A.length>0&&(q(n,e,this),l.push.apply(l,this.toTree(A,[])));var B=i[0]&&i[0].valueOf()||"";if(!B.match(h)&&!B.match(/^ /))break;f=i.shift();var C=this.dialect.block.horizRule(f,i);if(C){r.push.apply(r,C);break}q(n,e,this),p=!0}return r}}}(),blockquote:function(a,b){if(a.match(/^>/m)){var c=[];if(">"!=a[0]){for(var d=a.split(/\n/),e=[],f=a.lineNumber;d.length&&">"!=d[0][0];)e.push(d.shift()),f++;var g=o(e.join("\n"),"\n",a.lineNumber);c.push.apply(c,this.processBlock(g,[])),a=o(d.join("\n"),a.trailing,f)}for(;b.length&&">"==b[0][0];){var h=b.shift();a=o(a+a.trailing+h,h.trailing,a.lineNumber)}var j=a.replace(/^> ?/gm,""),k=(this.tree,this.toTree(j,["blockquote"])),l=i(k);return l&&l.references&&(delete l.references,s(l)&&k.splice(1,1)),c.push(k),c}},referenceDefn:function(a,b){var c=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(a.match(c)){i(this.tree)||this.tree.splice(1,0,{});var d=i(this.tree);void 0===d.references&&(d.references={});var e=this.loop_re_over_block(c,a,function(a){a[2]&&"<"==a[2][0]&&">"==a[2][a[2].length-1]&&(a[2]=a[2].substring(1,a[2].length-1));var b=d.references[a[1].toLowerCase()]={href:a[2]};void 0!==a[4]?b.title=a[4]:void 0!==a[5]&&(b.title=a[5])});return e.length&&b.unshift(o(e,a.trailing)),[]}},para:function(a,b){return[["para"].concat(this.processInline(a))]}}},n.dialects.Gruber.inline={__oneElement__:function(a,b,c){var d,e;b=b||this.dialect.inline.__patterns__;var f=new RegExp("([\\s\\S]*?)("+(b.source||b)+")");if(d=f.exec(a),!d)return[a.length,a];if(d[1])return[d[1].length,d[1]];var e;return d[2]in this.dialect.inline&&(e=this.dialect.inline[d[2]].call(this,a.substr(d.index),d,c||[])),e=e||[d[2].length,d[2]]},__call__:function(a,b){function c(a){"string"==typeof a&&"string"==typeof e[e.length-1]?e[e.length-1]+=a:e.push(a)}for(var d,e=[];a.length>0;)d=this.dialect.inline.__oneElement__.call(this,a,b,e),a=a.substr(d.shift()),q(d,c);return e},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(a){return this.dialect.inline.__escape__.exec(a)?[2,a.charAt(1)]:[1,"\\"]},"![":function(a){var b=a.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(b){b[2]&&"<"==b[2][0]&&">"==b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1)),b[2]=this.dialect.inline.__call__.call(this,b[2],/\\/)[0];var c={alt:b[1],href:b[2]||""};return void 0!==b[4]&&(c.title=b[4]),[b[0].length,["img",c]]}return b=a.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),b?[b[0].length,["img_ref",{alt:b[1],ref:b[2].toLowerCase(),original:b[0]}]]:[2,"!["]},"[":function a(b){var c=String(b),d=n.DialectHelpers.inline_until_char.call(this,b.substr(1),"]");if(!d)return[1,"["];var a,e,f=1+d[0],g=d[1];b=b.substr(f);var h=b.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(h){var i=h[1];if(f+=h[0].length,i&&"<"==i[0]&&">"==i[i.length-1]&&(i=i.substring(1,i.length-1)),!h[3])for(var j=1,k=0;k<i.length;k++)switch(i[k]){case"(":j++;break;case")":0==--j&&(f-=i.length-k,i=i.substring(0,k))}return i=this.dialect.inline.__call__.call(this,i,/\\/)[0],e={href:i||""},void 0!==h[3]&&(e.title=h[3]),a=["link",e].concat(g),[f,a]}return h=b.match(/^\s*\[(.*?)\]/),h?(f+=h[0].length,e={ref:(h[1]||String(g)).toLowerCase(),original:c.substr(0,f)},a=["link_ref",e].concat(g),[f,a]):1==g.length&&"string"==typeof g[0]?(e={ref:g[0].toLowerCase(),original:c.substr(0,f)},a=["link_ref",e,g[0]],[f,a]):[1,"["]},"<":function(a){var b;return null!=(b=a.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?b[3]?[b[0].length,["link",{href:"mailto:"+b[3]},b[3]]]:"mailto"==b[2]?[b[0].length,["link",{href:b[1]},b[1].substr("mailto:".length)]]:[b[0].length,["link",{href:b[1]},b[1]]]:[1,"<"]},"`":function(a){var b=a.match(/(`+)(([\s\S]*?)\1)/);return b&&b[2]?[b[1].length+b[2].length,["inlinecode",b[3]]]:[1,"`"]},"  \n":function(a){return[3,["linebreak"]]}},n.dialects.Gruber.inline["**"]=g("strong","**"),n.dialects.Gruber.inline.__=g("strong","__"),n.dialects.Gruber.inline["*"]=g("em","*"),n.dialects.Gruber.inline._=g("em","_"),n.buildBlockOrder=function(a){var b=[];for(var c in a)"__order__"!=c&&"__call__"!=c&&b.push(c);a.__order__=b},n.buildInlinePatterns=function(a){var b=[];for(var c in a)if(!c.match(/^__.*__$/)){var d=c.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");b.push(1==c.length?d:"(?:"+d+")")}b=b.join("|"),a.__patterns__=b;var e=a.__call__;a.__call__=function(a,c){return void 0!=c?e.call(this,a,c):e.call(this,a,b)}},n.DialectHelpers={},n.DialectHelpers.inline_until_char=function(a,b){for(var c=0,d=[];;){if(a.charAt(c)==b)return c++,[c,d];if(c>=a.length)return null;var e=this.dialect.inline.__oneElement__.call(this,a.substr(c));c+=e[0],d.push.apply(d,e.slice(1))}},n.subclassDialect=function(a){function b(){}function c(){}return b.prototype=a.block,c.prototype=a.inline,{block:new b,inline:new c}},n.buildBlockOrder(n.dialects.Gruber.block),n.buildInlinePatterns(n.dialects.Gruber.inline),n.dialects.Maruku=n.subclassDialect(n.dialects.Gruber),n.dialects.Maruku.processMetaHash=function(a){for(var b=h(a),c={},d=0;d<b.length;++d)if(/^#/.test(b[d]))c.id=b[d].substring(1);else if(/^\./.test(b[d]))c.class?c.class=c.class+b[d].replace(/./," "):c.class=b[d].substring(1);else if(/\=/.test(b[d])){var e=b[d].split(/\=/);c[e[0]]=e[1]}return c},n.dialects.Maruku.block.document_meta=function(a,b){if(!(a.lineNumber>1)&&a.match(/^(?:\w+:.*\n)*\w+:.*$/)){i(this.tree)||this.tree.splice(1,0,{});var c=a.split(/\n/);for(p in c){var d=c[p].match(/(\w+):\s*(.*)$/),e=d[1].toLowerCase(),f=d[2];this.tree[1][e]=f}return[]}},n.dialects.Maruku.block.block_meta=function(b,c){var d=b.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(d){var e,f=this.dialect.processMetaHash(d[2]);if(""===d[1]){var g=this.tree[this.tree.length-1];if(e=i(g),"string"==typeof g)return;e||(e={},g.splice(1,0,e));for(a in f)e[a]=f[a];return[]}var h=b.replace(/\n.*$/,""),j=this.processBlock(h,[]);e=i(j[0]),e||(e={},j[0].splice(1,0,e));for(a in f)e[a]=f[a];return j}},n.dialects.Maruku.block.definition_list=function(a,b){var c,d,e=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,f=["dl"];if(d=a.match(e)){for(var g=[a];b.length&&e.exec(b[0]);)g.push(b.shift());for(var h=0;h<g.length;++h){var d=g[h].match(e),i=d[1].replace(/\n$/,"").split(/\n/),j=d[2].split(/\n:\s+/);for(c=0;c<i.length;++c)f.push(["dt",i[c]]);for(c=0;c<j.length;++c)f.push(["dd"].concat(this.processInline(j[c].replace(/(\n)\s+/,"$1"))))}return[f]}},n.dialects.Maruku.block.table=function a(b,c){var d,e,f=function(a,b){b=b||"\\s",b.match(/^[\\|\[\]{}?*.+^$]$/)&&(b="\\"+b);for(var c,d=[],e=new RegExp("^((?:\\\\.|[^\\\\"+b+"])*)"+b+"(.*)");c=a.match(e);)d.push(c[1]),a=c[2];return d.push(a),d},g=/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,h=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;if(e=b.match(g))e[3]=e[3].replace(/^\s*\|/gm,"");else if(!(e=b.match(h)))return;var a=["table",["thead",["tr"]],["tbody"]];e[2]=e[2].replace(/\|\s*$/,"").split("|");var i=[];for(q(e[2],function(a){a.match(/^\s*-+:\s*$/)?i.push({align:"right"}):a.match(/^\s*:-+\s*$/)?i.push({align:"left"}):a.match(/^\s*:-+:\s*$/)?i.push({align:"center"}):i.push({})}),e[1]=f(e[1].replace(/\|\s*$/,""),"|"),d=0;d<e[1].length;d++)a[1][1].push(["th",i[d]||{}].concat(this.processInline(e[1][d].trim())));return q(e[3].replace(/\|\s*$/gm,"").split("\n"),function(b){var c=["tr"];for(b=f(b,"|"),d=0;d<b.length;d++)c.push(["td",i[d]||{}].concat(this.processInline(b[d].trim())));a[2].push(c)},this),[a]},n.dialects.Maruku.inline["{:"]=function(a,b,c){if(!c.length)return[2,"{:"];var d=c[c.length-1];if("string"==typeof d)return[2,"{:"];var e=a.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!e)return[2,"{:"];var f=this.dialect.processMetaHash(e[1]),g=i(d);g||(g={},d.splice(1,0,g));for(var h in f)g[h]=f[h];return[e[0].length,""]},n.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,n.buildBlockOrder(n.dialects.Maruku.block),n.buildInlinePatterns(n.dialects.Maruku.inline);var q,r=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)};q=Array.prototype.forEach?function(a,b,c){return a.forEach(b,c)}:function(a,b,c){for(var d=0;d<a.length;d++)b.call(c||a,a[d],d,a)};var s=function(a){for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0};c.renderJsonML=function(a,b){b=b||{},b.root=b.root||!1;var c=[];if(b.root)c.push(k(a));else for(a.shift(),!a.length||"object"!=typeof a[0]||a[0]instanceof Array||a.shift();a.length;)c.push(k(a.shift()));return c.join("\n\n")}}(function(){return"undefined"==typeof d?(window.markdown={},window.markdown):d}())},{util:97}]},{},[32]);
//# sourceMappingURL=organization.js.map