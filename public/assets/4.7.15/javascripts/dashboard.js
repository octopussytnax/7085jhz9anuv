/*! v4.7.15 - 2017-05-30 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./models/imports_collection"),f=a("./models/geocodings_collection"),g=a("./models/analysis_collection"),h=3e3;b.exports=d.core.Model.extend({defaults:{showGeocodingDatasetURLButton:!1,showSuccessDetailsButton:!0,geocodingsPolling:!1,importsPolling:!1},initialize:function(a,b){this.user=b.user,this.vis=b.vis,this.importsCollection=b.importsCollection||new e(null,{user:this.user}),this.geocodingsCollection=b.geocodingsCollection||new f(null,{user:this.user,vis:this.vis}),this.analysisCollection=b.anaylysisCollection||new g(null,{user:this.user}),this._initBinds(),this.startPollings()},_initBinds:function(){this.importsCollection.bind("change:state",function(a){this.trigger("change",a,this),this._onImportsStateChange(a)},this),this.importsCollection.bind("remove",function(a){this.trigger("importRemoved",a,this)},this),this.importsCollection.bind("add",function(a){this.trigger("importAdded",a,this)},this),this.geocodingsCollection.bind("change:state",function(a){this.trigger("change",a,this),this._onGeocodingsStateChange(a)},this),this.geocodingsCollection.bind("remove",function(a){this.trigger("geocodingRemoved",a,this)},this),this.geocodingsCollection.bind("add",function(a){this.trigger("geocodingAdded",a,this)},this),this.analysisCollection.bind("reset",function(){this.analysisCollection.size()>0?this.trigger("analysisAdded",this.analysisCollection,this):this.trigger("analysisRemoved",this.analysisCollection,this)},this),this.analysisCollection.bind("change:state",function(a){this._onAnalysisStateChange(a,this.analysisCollection)},this)},getTotalFailedItems:function(){return this.importsCollection.failedItems().length+this.geocodingsCollection.failedItems().length},removeImportItem:function(a){return!!a&&void this.importsCollection.remove(a)},addImportItem:function(a){return!!a&&void this.importsCollection.add(a)},removeGeocodingItem:function(a){return!(!a||!this.canAddImport())&&void this.geocodingsCollection.remove(a)},addGeocodingItem:function(a){return!(!a||!this.canAddGeocoding())&&void this.geocodingsCollection.add(a)},removeAnalysis:function(){this.analysisCollection.destroyCheck(),this.analysisCollection.reset()},addAnalysis:function(a){return!(!a||!this.canAddAnalysis())&&void this.analysisCollection.reset(a)},canAddImport:function(){return this.importsCollection.canImport()},canAddGeocoding:function(){return this.geocodingsCollection.canGeocode()},canAddAnalysis:function(){return this.analysisCollection.canStartPecan()},getTotalImports:function(){return this.importsCollection.size()},getTotalGeocodings:function(){return this.geocodingsCollection.size()},getTotalAnalysis:function(){return this.analysisCollection.size()>0?1:0},getTotalPollings:function(){return this.importsCollection.size()+this.geocodingsCollection.size()+(this.analysisCollection.isAnalyzing()?1:0)},stopPollings:function(){this.get("geocodingsPolling")&&this.geocodingsCollection.destroyCheck(),this.get("importsPolling")&&this.importsCollection.destroyCheck()},startPollings:function(){var a=this;setTimeout(function(){a.get("geocodingsPolling")&&a.geocodingsCollection.pollCheck(),a.get("importsPolling")&&a.importsCollection.pollCheck()},h)},_onImportsStateChange:function(){},_onGeocodingsStateChange:function(){},_onAnalysisStateChange:function(){},clean:function(){this.importsCollection.unbind(null,null,this),this.geocodingsCollection.unbind(null,null,this),this.analysisCollection.unbind(null,null,this),this.elder("clean")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./models/analysis_collection":3,"./models/geocodings_collection":6,"./models/imports_collection":9}],2:[function(a,b,c){(function(c){var d=("undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,"undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null),e=a("./views/imports/background_import_item_view"),f=a("./views/analysis/background_analysis_item_view"),g=a("./views/geocodings/background_geocoding_item_view"),h=a("./views/imports/background_import_limit_view"),i=a("./models/imports_model"),j=(a("./models/geocoding_model"),a("./background_polling_model")),k=a("./views/background_polling_header_view");b.exports=d.core.View.extend({className:"BackgroundPolling",initialize:function(){this.user=this.options.user,this.createVis=this.options.createVis,this.vis=this.options.vis,this.model||(this.model=new j({},{user:this.user})),this.template=d.templates.getTemplate("common/background_polling/background_polling"),this._initBinds()},render:function(){return this.$el.html(this.template()),this._initViews(),this},_initBinds:function(){this.model.bind("importAdded",this._addImport,this),this.model.bind("geocodingAdded",this._addGeocoding,this),this.model.bind("analysisAdded",this._addAnalysis,this),this.model.bind("analysisAdded analysisRemoved importAdded importRemoved geocodingAdded geocodingRemoved",this._checkPollingsSize,this),d.god.bind("importByUploadData",this._addDataset,this),d.god.bind("fileDropped",this._onDroppedFile,this),this.add_related_model(d.god)},_initViews:function(){var a=new k({model:this.model});this.$el.prepend(a.render().el),this.addView(a)},_checkPollingsSize:function(){this.model.getTotalPollings()>0?this.show():this.hide()},_addAnalysis:function(a){this._analysisItem&&this._analysisItem.clean(),this._analysisItem=new f({collection:a,vis:this.vis,user:this.user}),this._analysisItem.bind("remove",function(a){this.model.removeAnalysis()},this),this.$(".js-list").prepend(this._analysisItem.render().el),this.addView(this._analysisItem)},_addGeocoding:function(a){var b=new g({showGeocodingDatasetURLButton:this.model.get("showGeocodingDatasetURLButton"),model:a,user:this.user});b.bind("remove",function(a){this.model.removeGeocodingItem(a)},this),this.$(".js-list").prepend(b.render().el),this.addView(b),this.enable()},_addImport:function(a){var b=new e({showSuccessDetailsButton:this.model.get("showSuccessDetailsButton"),model:a,user:this.user});b.bind("remove",function(a){this.model.removeImportItem(a)},this),this.$(".js-list").prepend(b.render().el),this.addView(b),this.enable()},_addDataset:function(a){a&&this._addImportsItem(a)},_onDroppedFile:function(a){a&&this._addImportsItem({type:"file",value:a,create_vis:this.createVis})},_addImportsItem:function(a){if(!this.model.canAddImport())return this._addLimitItem(),!1;this._removeLimitItem();var b=new i({},{upload:a,user:this.user});this.model.addImportItem(b)},_addLimitItem:function(){if(!this._importLimit){var a=new h({user:this.user});this.$(".js-list").prepend(a.render().el),this.addView(a),this._importLimit=a}},_removeLimitItem:function(){var a=this._importLimit;a&&(a.clean(),this.removeView(a),delete this._importLimit)},enable:function(){this.model.startPollings()},disable:function(){this.model.stopPollings()},show:function(){this.$el.addClass("is-visible")},hide:function(){this.$el.removeClass("is-visible")},clean:function(){this.disable(),this.elder("clean")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./background_polling_model":1,"./models/geocoding_model":4,"./models/imports_model":10,"./views/analysis/background_analysis_item_view":15,"./views/background_polling_header_view":17,"./views/geocodings/background_geocoding_item_view":18,"./views/imports/background_import_item_view":20,"./views/imports/background_import_limit_view":21}],3:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("cartodb-pecan"),g=a("./pecan_model"),h=5;b.exports=d.Collection.extend({model:g,initialize:function(a,b){this.user=b.user,this._initBinds()},_initBinds:function(){this.bind("reset",this.pollCheck,this)},canStartPecan:function(){return this.getTotalAnalysis()===this.getCompletedAnalysis()},pollCheck:function(){this._nextAnalysisItems&&e.each(this._nextAnalysisItems,function(a){a.unbind(null,null,this)},this);var a=e.first(this.where({state:"idle"}),h);a.length>0&&(this._nextAnalysisItems=a,e.each(this._nextAnalysisItems,function(a){this.user.featureEnabled("pecan_debugging")&&a.bind("print_stats",function(a){this._printStats(a)},this),a.bind("change:state",function(a,b){if(a.isAnalyzed()){var c=e.find(this._nextAnalysisItems,function(a){return!a.isAnalyzed()});c||this.pollCheck()}},this),a.getData()},this))},_printStats:function(a){var b=a.column,c=a.type,d=a.weight,e=a.skew,g=a.distinct,h=a.count,i=a.null_ratio,j=a.dist_type,k=(d+f.getWeightFromShape(j))/2,l=g/h*100;cdb.log.info("%cAnalyzing %c"+b,"text-decoration:underline; font-weight:bold","text-decoration:underline; font-weight:normal"),cdb.log.info("%c · %ctype%c = "+c,"color:#666;","color: #666; font-weight:bold;","color: #666; font-weight:normal"),cdb.log.info("%c · %cdistinctPercentage%c = "+l,"color:#666;","color: #666; font-weight:bold;","color: #666; font-weight:normal"),cdb.log.info("%c · %ccount%c = "+h,"color:#666;","color: #666; font-weight:bold;","color: #666; font-weight:normal;"),cdb.log.info("%c · %cnull ratio%c = "+i,"color:#666;","color: #666; font-weight:bold;","color: #666; font-weight:normal;"),j&&(cdb.log.info("%c · %cdist_type%c = "+j,"color:#666;","color: #666; font-weight:bold;","color: #666; font-weight:normal;"),cdb.log.info("%c · %ccalc_weight%c = "+k,"color:#666;","color: #666; font-weight:bold;","color: #666; font-weight:normal;")),e&&cdb.log.info("%c · %cskew%c: "+e.toFixed(2),"color:#666;","color: #666; font-weight:bold;","color: #666; font-weight:normal;"),d&&cdb.log.info("%c · %cweight%c: "+d.toFixed(2),"color: #666;","color:#666; font-weight:bold;","color:#666;font-weight:normal"),a.density&&cdb.log.info("%c · %cdensity%c: "+a.density,"color:#666;","color: #666; font-weight:bold;","color: #666; font-weight:normal;")},destroyCheck:function(){var a=this.where({state:"idle"});this.remove(a)},failedItems:function(){},getTotalAnalysis:function(){return this.size()},getSuccessfullyAnalysedColumns:function(){return this.where({success:!0}).length},getCompletedAnalysis:function(){return this.where({state:"analyzed"}).length},isAnalyzing:function(){return this.getCompletedAnalysis()!==this.getTotalAnalysis()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./pecan_model":11,"cartodb-pecan":163}],4:[function(a,b,c){(function(c){var d=("undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,"undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null),e=a("./geocoding_model_poller");b.exports=cdb.core.Model.extend({options:{startPollingAutomatically:!0},defaults:{kind:"",formatter:"",table_name:"",state:""},url:function(a){var b=cdb.config.urlVersion("geocoding",a),c="/api/"+b+"/geocodings/";return this.isNew()?c:c+this.id},setUrlRoot:function(a){this.urlRoot=a},initialize:function(a){this._initBinds(),d.extend(this.options,a),this.poller=new e(this),this.options.startPollingAutomatically&&this._checkModel()},_initBinds:function(){this.bind("change:id",this._checkModel,this)},_checkModel:function(){this.get("id")?this.pollCheck():this._saveModel()},_saveModel:function(){var a=this;this.isNew()&&this.save({},{error:function(){a.set({state:"failed",error:{title:"Oops, there was a problem",description:"Unfortunately there was an error starting the geocoder"}})}})},pollCheck:function(){this.poller.start()},destroyCheck:function(){this.poller.stop()},getError:function(){return this.get("error")},hasFailed:function(){var a=this.get("state");return"failed"===a||"reset"===a||"cancelled"===a},hasCompleted:function(){return"finished"===this.get("state")},isOngoing:function(){return!this.hasCompleted()&&!this.hasFailed()},cancelGeocoding:function(){this.save({state:"cancelled"},{wait:!0})},resetGeocoding:function(){this.set("state","reset")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./geocoding_model_poller":5}],5:[function(a,b,c){var d=a("./poller"),e=function(a){var b=2e3,c={interval:b,stopWhen:function(a){return a.hasFailed()||a.hasCompleted()},error:function(a){a.trigger("change")}};d.call(this,a,c)};e.prototype=_.extend({},d.prototype),b.exports=e},{"./poller":12}],6:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=6e4,g=a("./geocoding_model");b.exports=d.Collection.extend({model:g,url:function(a){var b=cdb.config.urlVersion("geocoding",a);return"/api/"+b+"/geocodings"},initialize:function(a,b){this.user=b.user,this.vis=b.vis},parse:function(a){var b=this;return e.each(a.geocodings,function(a){var c=b.filter(function(b){return b.get("id")===a.id});0===c.length&&b._checkOngoingGeocoding(new g(a,{startPollingAutomatically:!1}))}),this.models},_checkOngoingGeocoding:function(a){if(this.vis){var b=this;this.vis.map.layers.each(function(c){c.table&&c.table.id===a.get("table_name")&&(b.add(a),a.pollCheck())})}else this.add(a),a.pollCheck()},canGeocode:function(){return!this.any(function(a){return a.isOngoing()})},fetchGeocodings:function(){var a=this;this.fetch({error:function(b){a.destroyCheck()}})},pollCheck:function(a){if(!this.pollTimer){var b=this;this.pollTimer=setInterval(function(){b.fetchGeocodings()},f),this.fetchGeocodings()}},destroyCheck:function(){clearInterval(this.pollTimer),delete this.pollTimer},failedItems:function(){return this.filter(function(a){return a.hasFailed()})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./geocoding_model":4}],7:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null,f=a("./import_model_poller");b.exports=d.core.Model.extend({url:function(a){var b=d.config.urlVersion("import",a),c="/api/"+b+"/imports";return this.isNew()?c:c+"/"+this.id},idAttribute:"item_queue_id",initialize:function(){this._initBinds(),this.poller=new f(this)},_initBinds:function(){this.bind("change:item_queue_id",this._checkQueueId,this)},createImport:function(a){var b=this._prepareData(a);this[0===b.interval?"_createRegularImport":"_createSyncImport"](b)},_checkQueueId:function(){this.get("item_queue_id")&&this.pollCheck()},_prepareData:function(a){var b={create_vis:a.create_vis,privacy:a.privacy},c=a.type;"remote"!==c&&_.extend(b,{type_guessing:a.type_guessing,content_guessing:a.content_guessing,interval:a.interval});var d=a.service_name;if("url"===c&&_.extend(b,{url:a.value}),"remote"===c&&_.extend(b,{type:"remote",interval:null,remote_visualization_id:a.remote_visualization_id,create_vis:!1,value:a.value}),"sql"===c&&_.extend(b,{table_name:a.table_name,sql:a.value}),"duplication"===c&&_.extend(b,{table_name:a.table_name,table_copy:a.value}),"service"===c){var e="twitter_search"===d?JSON.stringify(a.service_item_id):a.service_item_id;a.user_defined_limits&&(b.user_defined_limits=a.user_defined_limits),_.extend(b,{value:a.value,service_name:a.service_name,service_item_id:e})}return b},_createSyncImport:function(a){var b=this,c=new e.TableSynchronization(a);c.save(null,{success:function(a){b.set("item_queue_id",a.get("data_import").item_queue_id)},error:function(a,c,d){b._setErrorState(c)}})},_createRegularImport:function(a){var b=this;this.save(a,{error:function(a,c,d){b._setErrorState(c)}})},_setErrorState:function(a){var b;try{b=a&&JSON.parse(a.responseText).errors.imports}catch(a){b="Unfortunately there was an error starting the import"}this.set({state:"failure",get_error_text:{title:"There was an error",what_about:b}})},pollCheck:function(){this.poller.start()},destroyCheck:function(){this.poller.stop()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./import_model_poller":8}],8:[function(a,b,c){var d=a("./poller"),e=function(a){var b=2e3,c=2.5,e=30,f={interval:function(a){return a>=e?b*c:b},stopWhen:function(a){var b=a.get("state");return"complete"===b||"failure"===b}};d.call(this,a,f)};e.prototype=_.extend({},d.prototype),b.exports=e},{"./poller":12}],9:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=3e4,g=a("./imports_model");b.exports=d.Collection.extend({model:g,url:function(a){var b=cdb.config.urlVersion("import",a);return"/api/"+b+"/imports"},initialize:function(a,b){this.user=b.user},parse:function(a){var b=this;return 0===a.imports.length?this.destroyCheck():e.each(a.imports,function(a){var c=b.filter(function(b){return b.imp.get("item_queue_id")===a});0===c.length&&b.add(new g({id:a},{user:b.user}))}),this.models},canImport:function(){var a=this.user.getMaxConcurrentImports(),b=this.size(),c=0;return this.each(function(a){(a.hasFailed()||a.hasCompleted())&&++c}),b-c<a},pollCheck:function(a){if(!this.pollTimer){var b=this;this.pollTimer=setInterval(function(){b.fetch()},f||2e3),this.fetch()}},destroyCheck:function(){clearInterval(this.pollTimer),delete this.pollTimer},failedItems:function(){return this.filter(function(a){return a.hasFailed()})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./imports_model":10}],10:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("./import_model"),g=a("./upload_model");b.exports=d.core.Model.extend({defaults:{step:"upload",state:""},initialize:function(a,b){e.isEmpty(b)&&(b={}),this.user=b&&b.user,this.upl=new g(b.upload,{user:this.user}),this.imp=new f(b.import),this._initBinds(),this._checkStatus()},_initBinds:function(){this.bind("change:import",this._onImportChange,this),this.bind("change:upload",this._onUploadChange,this),this.bind("change:id",this._onIdChange,this),this.imp.bind("change",function(){this.trigger("change:import"),this.trigger("change")},this),this.upl.bind("change",function(){this.trigger("change:upload"),this.trigger("change")},this)},_destroyBinds:function(){this.upl.unbind(null,null,this),this.imp.unbind(null,null,this)},_onIdChange:function(){var a=this.get("id");a&&this.imp.set("item_queue_id",a),this.set("step","import")},_onUploadChange:function(a,b){if("upload"===this.get("step")){var c=this.upl.get("item_queue_id"),d=this.upl.get("state");c&&this.set("id",c),d&&this.set("state",d)}},_onImportChange:function(){if("import"===this.get("step")){var a=this.imp.get("state");a&&this.set("state",a)}},_checkStatus:function(){return this.get("id")||this.upl.isValid()?void("file"===this.upl.get("type")?this.upl.upload():this.get("id")?(this.set("step","import"),this.imp.set("item_queue_id",this.get("id"))):this.imp.get("item_queue_id")||""===this.upl.get("type")||(this.set("step","import"),this.imp.createImport(this.upl.toJSON()))):void this.trigger("change:upload")},pause:function(){this.stopUpload(),this.stopImport()},hasFailed:function(){var a=this.get("state"),b=this.get("step");return"import"===b&&"failure"===a||"upload"===b&&"error"===a},hasCompleted:function(){return"import"===this.get("step")&&this.imp&&"complete"===this.imp.get("state")},getWarnings:function(){var a=this.get("step");return"import"===a?this.imp.get("warnings"):""},getError:function(){if(this.hasFailed()){var a=this.get("step");return e.extend({error_code:this["upload"===a?"upl":"imp"].get("error_code"),item_queue_id:"import"===a?this.imp.get("id"):"",original_url:"import"===a?this.imp.get("original_url"):"",data_type:"import"===a?this.imp.get("data_type"):"",http_response_code:"import"===a?this.imp.get("http_response_code"):"",http_response_code_message:"import"===a?this.imp.get("http_response_code_message"):""},this["upload"===a?"upl":"imp"].get("get_error_text"))}return{title:"",what_about:"",error_code:""}},importedVis:function(){return this.get("import").derived_visualization_id?this._getMapVis():this._getDatasetVis()},_getMapVis:function(){var a=this.imp.get("derived_visualization_id");return!!a&&this._createVis({type:"derived",id:a})},_getDatasetVis:function(){var a=this.imp.get("table_name");return!!a&&this._createVis({type:"table",table:{name:a}})},_createVis:function(a){var b=new d.admin.Visualization(a);return b.permission.owner=this.user,b},setError:function(a){var b=this.get("step"),c=this["upload"===b?"upl":"imp"];this.stopUpload(),this.stopImport(),c.set(a),this.set("state","error")},stopUpload:function(){this.upl.stopUpload()},stopImport:function(){this.imp.destroyCheck()},get:function(a){return"upload"===a?this.upl.toJSON():"import"===a?this.imp.toJSON():d.core.Model.prototype.get.call(this,a)},toJSON:function(){return{step:this.get("step"),id:this.get("id"),state:this.get("state"),upload:this.upl.toJSON(),import:this.imp.toJSON()}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./import_model":7,"./upload_model":14}],11:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("cartodb-pecan");b.exports=e.core.Model.extend({_PRINT_STATS:!0,defaults:{table_id:"",column:"",state:"idle"},initialize:function(){d.bindAll(this,"_onDescribe"),this.sql=e.admin.SQL(),this.query="SELECT * FROM "+this.get("table_id")},getData:function(){this.sql.describe(this.query,this.get("column"),{},this._onDescribe)},_onDescribe:function(a){var b={state:"analyzed",success:!1};this._PRINT_STATS&&this.trigger("print_stats",a,this);var c=f.hasEnoughToGuess({stats:a,isPointGeometryType:"point"===this.get("geometry_type")});if(c){var e=f.guessMap({tableName:this.get("table_id"),column:{stats:a,geometryType:this.get("geometry_type"),bbox:this.get("bbox")},dependencies:{underscore:d}});if(e){var g={sql:this.query,success:!0};b=d.extend(b,g,a,e)}}"geom"===a.type&&a.bbox&&(b.bbox=a.bbox),this.set(b)},isAnalyzed:function(){return"analyzed"===this.get("state")},hasFailed:function(){return"failed"===this.get("state")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"cartodb-pecan":163}],12:[function(a,b,c){var d=function(a,b){this.model=a,this.numberOfRequests=0,this.polling=!1,this.interval=b.interval,"function"!=typeof this.interval&&(this.interval=function(){return b.interval}),this.stopWhen=b.stopWhen,this.error=b.error,this.autoStart=b.autoStart,this.autoStart&&this.start()};d.prototype.start=function(){this.timeout||this._scheduleFetch()},d.prototype._scheduleFetch=function(){this.timeout=setTimeout(this._fetch.bind(this),this.interval(this.numberOfRequests))},d.prototype._fetch=function(){var a=this;a.polling||(a.polling=!0,a.model.fetch({success:function(){a.polling=!1,a.numberOfRequests++,a._continuePolling()&&a._scheduleFetch()},error:function(b){_.isFunction(a.error)&&a.error(a.model)}}))},d.prototype._continuePolling=function(){return!this.stopWhen||_.isFunction(this.stopWhen)&&!this.stopWhen(this.model)},d.prototype.stop=function(){this.polling=!1,clearTimeout(this.timeout),delete this.timeout},b.exports=d},{}],13:[function(a,b,c){b.exports={uploadStates:["enqueued","pending","importing","uploading","guessing","unpacking","getting","creating","complete"],fileExtensions:["csv","xls","xlsx","zip","kml","geojson","json","ods","kmz","tsv","gpx","tar","gz","tgz","osm","bz2","tif","tiff","txt","sql","rar","carto","gpkg"],fileTimesBigger:3}},{}],14:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,e=a("./upload_config"),f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,g="undefined"!=typeof window?window.moment:"undefined"!=typeof c?c.moment:null,h="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null;b.exports=d.Model.extend({url:"/api/v1/imports",fileAttribute:"filename",defaults:{type:"",value:"",interval:0,privacy:"",progress:0,state:"idle",service_item_id:"",service_name:"",option:"",content_guessing:!0,type_guessing:!0,create_vis:!0},initialize:function(a,b){this.user=b&&b.user,this._initBinds(),this._validate(this.attributes,{validate:!0})},isValidToUpload:function(){return this.get("value")&&"error"!==this.get("state")},setFresh:function(a){a&&!h.isEmpty(a)?this.set(h.omit(a,"create_vis")):this.clear()},_initBinds:function(){this.bind("progress",function(a){this.set({progress:100*a,state:"uploading"})},this),this.bind("change:value",function(){"error"===this.get("state")&&(this.set({state:"idle"}),this.unset("get_error_text",{silent:!0}))},this),this.bind("error invalid",function(a,b){this.set({state:"error",error_code:b&&b.error_code||"",get_error_text:{title:"Invalid import",what_about:b&&b.msg||""}},{silent:!0}),this.trigger("change")},this)},validate:function(a){if(a){if("file"===a.type){if(a.value&&a.value.length)return{msg:"Unfortunately only one file is allowed per upload"};var b=a.value.name;if(!b)return{msg:"File name should be defined"};var c=b.substr(b.lastIndexOf(".")+1);if(c&&(c=c.toLowerCase()),!h.contains(e.fileExtensions,c))return{msg:"Unfortunately this file extension is not allowed"};if(this.user&&this.user.get("remaining_byte_quota")*e.fileTimesBigger<a.value.size)return{msg:"Unfortunately the size of the file is bigger than your remaining quota",error_code:8001}}if("remote"===a.type){if(!a.remote_visualization_id)return{msg:"The remote visualization id was not specified"};if(this.user&&a.size&&this.user.get("remaining_byte_quota")*e.fileTimesBigger<a.size)return{msg:"Unfortunately the size of the remote dataset is bigger than your remaining quota",error_code:8001}}if("url"===a.type&&!f.isURL(a.value))return{msg:"Unfortunately the URL provided is not valid"};if("sql"===a.type&&!a.value)return{msg:"Query is not provided"};if("duplication"===a.type&&!a.value)return{msg:"Dataset copy is not defined"};if("service"===a.type&&"twitter_search"===a.service_name){var d=a.service_item_id;if(!d||h.isEmpty(d))return{msg:"Twitter data is empty"};if(h.isEmpty(d.categories))return{msg:"Twitter categories are not valid"};var i=d.dates;if(!i||h.isEmpty(i))return{msg:"Twitter dates are empty"};var j=g(i.fromDate)<=g(new Date);if(!i.fromDate||!i.toDate||!j)return{msg:"Twitter dates are not valid"}}}},isValid:function(){return this.get("value")&&"error"!==this.get("state")},upload:function(){if("file"===this.get("type")){var a=this;this.xhr=this.save({filename:this.get("value")},{success:function(a){a.set("state","uploaded")},error:function(b,c){var d="Unfortunately there was a connection error";if(c&&429===c.status){var e=JSON.parse(c.responseText);d=e.errors.imports}a.set({state:"error",get_error_text:{title:"There was an error",what_about:d}})},complete:function(){delete a.xhr}})}},stopUpload:function(){this.xhr&&this.xhr.abort()},setGuessing:function(a){this.set({type_guessing:a,content_guessing:a})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./upload_config":13}],15:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=(a("../../../view_factory"),a("../../../dialogs/pecan/pecan_dialog_view"));b.exports=d.core.View.extend({className:"ImportItem",tagName:"li",events:{"click .js-abort":"_removeItem","click .js-show_dialog":"_showDialog","click .js-close":"_removeItem"},initialize:function(){this.user=this.options.user,this.vis=this.options.vis,this.template=d.templates.getTemplate("common/background_polling/views/analysis/background_analysis_item"),this._initBinds()},render:function(){var a=this.collection.getTotalAnalysis(),b=this.collection.getCompletedAnalysis(),c=this.collection.getSuccessfullyAnalysedColumns(),d={totalSuccess:c,totalItems:a,totalAnalyzed:b,progress:b/a*100};return this.$el.html(this.template(d)),this},_initBinds:function(){this.collection.bind("change:state",this._onChangeState,this),this.add_related_model(this.collection)},_onChangeState:function(){var a=this.collection.getTotalAnalysis(),b=this.collection.getCompletedAnalysis(),c=this.collection.getSuccessfullyAnalysedColumns();this.render(),b===a&&0===c&&this._removeItem()},_showDialog:function(){var a=new e({clean_on_hide:!0,vis:this.vis,collection:this.collection,user:this.user});a.appendToBody()},_skip:function(){var a,b=this.vis.get("active_layer_id"),c=this.vis.map.layers.where({id:b});c&&(a=c[0].table.get("name"));var d="pecan_"+this.user.get("username")+"_"+a;localStorage[d]=!0},_removeItem:function(){this.trigger("remove",this.collection,this),this._skip(),this.clean()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../dialogs/pecan/pecan_dialog_view":84,"../../../view_factory":108}],16:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({tagName:"h3",className:"CDB-Text CDB-Size-large u-lSpace--xl",initialize:function(){this.template=c.templates.getTemplate("common/background_polling/views/background_polling_header_title"),this._initBinds()},render:function(){return this.$el.html(this.template({imports:this.model.getTotalImports(),geocodings:this.model.getTotalGeocodings(),analysis:this.model.getTotalAnalysis(),totalPollings:this.model.getTotalPollings()})),this},_initBinds:function(){this.model.bind("change analysisAdded analysisRemoved importAdded importRemoved geocodingAdded geocodingRemoved",this.render,this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./background_polling_header_title_view");b.exports=d.core.View.extend({className:"BackgroundPolling-header",initialize:function(){this.template=d.templates.getTemplate("common/background_polling/views/background_polling_header"),this._initBinds()},render:function(){return this.$el.html(this.template()),this._initViews(),this._updateBadges(),this},_initBinds:function(){this.model.bind("change importAdded importRemoved geocodingAdded geocodingRemoved",this._updateBadges,this)},_initViews:function(){var a=new e({model:this.model});this.$el.append(a.render().el),this.addView(a)},_updateBadges:function(){var a=this.model.getTotalFailedItems();if(0===this.$(".BackgroundPolling-headerBadgeCount").length&&a>0){var b=$("<span>").addClass("BackgroundPolling-headerBadgeCount Badge Badge--negative CDB-Text CDB-Size-small").text(a);this.$(".BackgroundPolling-headerBadge").append(b).addClass("has-failures")}else this.$(".BackgroundPolling-headerBadgeCount").length>0&&a>0?this.$(".BackgroundPolling-headerBadgeCount").text(a):0===a&&(this.$(".BackgroundPolling-headerBadgeCount").remove(),this.$(".BackgroundPolling-headerBadge").removeClass("has-failures"));var c=this.model.getTotalGeocodings(),d=c>0&&c===this.model.getTotalPollings();this.$(".js-icon").toggleClass("CDB-IconFont-marker",d),this.$(".js-icon").toggleClass("CDB-IconFont-cloud",!d);
}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./background_polling_header_title_view":16}],18:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,g=a("../../../view_helpers/pluralize_string"),h=a("./geocoding_result_details_view");b.exports=d.core.View.extend({className:"ImportItem",tagName:"li",events:{"click .js-abort":"_cancelGeocoding","click .js-info":"_showDetails","click .js-close":"_removeGeocoding"},initialize:function(){this.user=this.options.user,this.template=d.templates.getTemplate("common/background_polling/views/geocodings/background_geocoding_item"),this._initBinds()},render:function(){var a=this.model.get("processed_rows")||0,b=this.model.get("processable_rows")||0,c=this.model.get("real_rows")||0,d=this.model.get("latitude_column")&&this.model.get("longitude_column"),h={realRows:c,tableName:this.model.get("table_name"),canCancel:e.isFunction(this.model.cancelGeocoding),hasFailed:this.model.hasFailed(),hasCompleted:this.model.hasCompleted(),processedRows:a,processableRows:b,processableRowsFormatted:f.formatNumber(b),realRowsPluralize:g("row","rows",this.model.get("real_rows")),realRowsFormatted:f.formatNumber(c),processableRowsPluralize:g("row","rows",b),width:c>0?b/c:100,isLatLngType:d};return this.$el.html(this.template(h)),this},_initBinds:function(){this.model.bind("change",this.render,this),this.model.bind("remove",this.clean,this)},_cancelGeocoding:function(){this.model.cancelGeocoding()},_removeGeocoding:function(){this.trigger("remove",this.model,this),this.clean()},_showDetails:function(){new h({clean_on_hide:!0,user:this.user,model:this.model,showGeocodingDatasetURLButton:this.options.showGeocodingDatasetURLButton}).appendToBody()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_helpers/pluralize_string":111,"./geocoding_result_details_view":19}],19:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../../views/base_dialog/view"),f=a("../../../view_helpers/pluralize_string"),g="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null;b.exports=e.extend({className:"Dialog BackgroundPollingDetails is-opening",initialize:function(){this.elder("initialize"),this.user=this.options.user},render_content:function(){var a,b=this.model.get("error")||{},c=this.model.get("processed_rows")||0,e=this.model.get("processable_rows")||0,h=this.model.get("real_rows")||0,i=this.model.get("geometry_type")||"point",j=this.model.get("price"),k=void 0!==j&&null!==j,l=this.user.featureEnabled("google_maps");if(this.user&&this.model.get("table_name")){var m=new d.admin.Visualization({type:"table",table:{name:this.model.get("table_name")}});m.permission.owner=this.user,a=encodeURI(m.viewUrl(this.user).edit())}var n="common/background_polling/views/geocodings/";return n+=this.model.hasCompleted()?0===h?"geocoding_no_result_details":"geocoding_success_details":"geocoding_error_details",d.templates.getTemplate(n)({id:this.model.get("id"),geometryTypePluralize:f(i,i+"s",e),geometryType:i,remainingQuotaFormatted:g.formatNumber(this.model.get("remaining_quota")),googleUser:l,tableName:this.model.get("table_name"),state:this.model.get("state")||"",blockPrice:this.user.get("geocoding").block_price,realRows:h,realRowsFormatted:g.formatNumber(h),processedRows:c,processableRows:e,processableRowsFormatted:g.formatNumber(e),hasPrice:k,price:j,customHosted:d.config.get("cartodb_com_hosted"),errorDescription:b.description,showGeocodingDatasetURLButton:this.options.showGeocodingDatasetURLButton&&a,datasetURL:a})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_helpers/pluralize_string":111,"../../../views/base_dialog/view":113}],20:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../models/upload_config"),f=a("../../../views/error_details_view"),g=a("../../../views/warnings_details_view"),h=a("../../../view_factory"),i=a("./twitter_import_details_view");b.exports=d.core.View.extend({className:"ImportItem",tagName:"li",events:{"click .js-abort":"_removeItem","click .js-show_error":"_showImportError","click .js-show_warnings":"_showImportWarnings","click .js-show_stats":"_showImportStats","click .js-close":"_removeItem"},initialize:function(){this.user=this.options.user,this._showSuccessDetailsButton=this.options.showSuccessDetailsButton,this.template=d.templates.getTemplate("common/background_polling/views/imports/background_import_item"),this._initBinds()},render:function(){var a=this.model.get("upload"),b=this.model.get("import"),c={name:"",state:this.model.get("state"),progress:"",service:"",step:this.model.get("step"),url:"",failed:this.model.hasFailed(),completed:this.model.hasCompleted(),warnings:this.model.getWarnings(),showSuccessDetailsButton:this._showSuccessDetailsButton,tables_created_count:b.tables_created_count};if("complete"===c.state){var d=this.model.importedVis();d&&(c.url=encodeURI(d.viewUrl(this.user).edit()))}return a.type?("file"===a.type&&(a.value.length>1?c.name=a.value.length+" files":c.name=a.value.name),"url"!==a.type&&"remote"!==a.type||(c.name=a.value),"service"===a.type&&(c.name=a.value&&a.value.filename||""),"twitter_search"===a.service_name&&(c.name="Twitter import"),"sql"===a.type&&(c.name="SQL"),"duplication"===a.type&&(c.name=a.table_name||a.value)):c.name=b.display_name||b.item_queue_id||"import",c.service=a.service_name,"upload"===this.model.get("step")?c.progress=this.model.get("upload").progress:c.progress=e.uploadStates.indexOf(c.state)/e.uploadStates.length*100,this.$el.html(this.template(c)),this},_initBinds:function(){this.model.bind("change",this.render,this),this.model.bind("remove",this.clean,this)},_removeItem:function(){this.trigger("remove",this.model,this),this.model.pause(),this.clean()},_showImportStats:function(){new i({clean_on_hide:!0,user:this.user,model:this.model}).appendToBody()},_showImportError:function(){var a=h.createDialogByView(new f({err:this.model.getError(),user:this.user}));a.appendToBody()},_showImportWarnings:function(){var a=h.createDialogByView(new g({warnings:this.model.getWarnings(),user:this.user}));a.appendToBody()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_factory":108,"../../../views/error_details_view":125,"../../../views/warnings_details_view":131,"../../models/upload_config":13,"./twitter_import_details_view":22}],21:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({className:"ImportItem ImportItem--sticky",tagName:"li",initialize:function(){this.user=this.options.user,this.template=c.templates.getTemplate("common/background_polling/views/imports/background_import_limit")},render:function(){var a=this.user.getMaxConcurrentImports(),b=!c.config.get("cartodb_com_hosted")&&1===a;return this.$el.html(this.template({upgradeUrl:window.upgrade_url,isUpgradeable:b,importQuota:a})),this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../../views/base_dialog/view"),f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null;b.exports=e.extend({className:"Dialog TwitterImportDetails is-opening",initialize:function(){this.elder("initialize"),this.user=this.options.user,this.template=d.templates.getTemplate("common/background_polling/views/imports/twitter_import_details")},render_content:function(){var a=this.model.get("import"),b=this.user.get("twitter"),c=b.quota-b.monthly_use,d=this.model.importedVis(),e=d&&encodeURI(d.viewUrl(this.user).edit())||"",g={type:d&&"table"===d.get("type")?"dataset":"map",mapURL:e,datasetTotalRows:a.tweets_georeferenced,datasetTotalRowsFormatted:f.formatNumber(a.tweets_georeferenced),tweetsCost:a.tweets_cost,tweetsCostFormatted:f.formatNumber(a.tweets_cost),availableTweets:c,availableTweetsFormatted:f.formatNumber(c),tweetsOverquota:a.tweets_overquota,tweetsOverquotaFormatted:f.formatNumber(a.tweets_overquota),blockSizeFormatted:f.formatNumber(b.block_size),blockPriceFormatted:f.formatNumber(b.block_price)};return this.template(g)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../views/base_dialog/view":113}],23:[function(a,b,c){(function(c){var d=a("queue-async"),e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null;b.exports=function(a){var b=d(a.howManyInParallel);e.each(a.items,function(c){b.defer(function(b){a.processItem(c,b)})}),b.awaitAll(function(b){b?a.fail(b):a.done()})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"queue-async":187}],24:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../../views/base_dialog/view"),g=a("../../view_helpers/pluralize_string"),h=a("../../view_helpers/random_quote");b.exports=f.extend({events:function(){return e.extend({},f.prototype.events,{"click .js-ok":"_ok"})},initialize:function(){this.elder("initialize"),this.options.template=this.options.template||d.templates.getTemplate("common/dialogs/change_lock/templates/dashboard"),this.model.bind("change",function(){"ProcessItemsDone"===this.model.get("state")?this.close():this.render()},this)},render_content:function(){return this["_render"+this.model.get("state")]()},_renderConfirmChangeLock:function(){var a=this.model.get("items").length,b=this.model.get("initialLockValue");return this.options.template({model:this.model,itemsCount:a,ownerName:this.options.ownerName,isOwner:this.options.isOwner,thisOrTheseStr:1===a?"this":"these",itOrThemStr:1===a?"it":"them",areLocked:b,positiveOrNegativeStr:b?"positive":"alert",lockOrUnlockStr:b?"unlock":"lock",contentTypePluralized:g("datasets"===this.model.get("contentType")?"dataset":"map",this.model.get("contentType"),a)})},_ok:function(a){this.killEvent(a),this.model.inverseLock(),this.render()},_renderProcessingItems:function(){var a=this.model.get("initialLockValue")?"Unlocking":"Locking";return d.templates.getTemplate("common/templates/loading")({title:a+" "+g("datasets"===this.model.get("contentType")?"dataset":"map",this.model.get("items").length)+"…",quote:h()})},_renderProcessItemsFail:function(){var a=this.model.get("initialLockValue")?"unlock":"lock";return d.templates.getTemplate("common/templates/fail")({msg:"Failed to "+a+" all items"})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/pluralize_string":111,"../../view_helpers/random_quote":112,"../../views/base_dialog/view":113}],25:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,f=a("../../batch_process_items");b.exports=d.core.Model.extend({defaults:{state:"ConfirmChangeLock",initialLockValue:!1,contentType:"datasets",items:void 0},initialize:function(a){if(this.elder("initialize"),this.set("items",new e.Collection(a.items)),this.get("items").chain().map(function(a){return a.get("locked")}).uniq().value().length>1){var b="It is assumed that all items have the same locked state, a user should never be able to select a mixed item with current UI. If you get an error with this message something is broken";if(!window.trackJs||!window.trackJs.track)throw new Error(b);window.trackJs.track(b)}this.set("initialLockValue",this.get("items").at(0).get("locked"))},inverseLock:function(){this.set("state","ProcessingItems"),f({howManyInParallel:5,items:this.get("items").toArray(),processItem:this._lockItem.bind(this,!this.get("initialLockValue")),done:this.set.bind(this,"state","ProcessItemsDone"),fail:this.set.bind(this,"state","ProcessItemsFail")})},_lockItem:function(a,b,c){b.save({locked:a}).done(function(){c()}).fail(function(){c("something failed")})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../batch_process_items":23}],26:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./start_view"),f=a("./options_collection"),g=a("../../views/base_dialog/view"),h=a("../../view_helpers/random_quote"),i=a("../../view_factory"),j=a("./share/share_view"),k=g.extend({initialize:function(){this.elder("initialize"),this._privacyOptions=f.byVisAndUser(this.options.vis,this.options.user),this._initViews(),this._initBinds()},render_content:function(){return this._panes.getActivePane().render().el},ok:function(){var a=this._privacyOptions.selectedOption();if(a.canSave()){var b=this;this._panes.active("saving"),a.saveToVis(this.options.vis,{success:function(){b.close()},error:function(){b._panes.active("saveFail")}})}},_initViews:function(){this._panes=new d.ui.common.TabPane({el:this.el}),this.addView(this._panes),this._panes.addTab("start",new e({privacyOptions:this._privacyOptions,user:this.options.user,vis:this.options.vis})),this._panes.addTab("saving",i.createByTemplate("common/templates/loading",{title:"Saving privacy…",quote:h()}).render()),this._panes.addTab("saveFail",i.createByTemplate("common/templates/fail",{msg:""}).render()),this._panes.active("start")},_initBinds:function(){this._panes.bind("tabEnabled",this.render,this),this._panes.getPane("start").bind("clickedShare",this._openShareDialog,this)},_openShareDialog:function(){var a=new j({clean_on_hide:!0,enter_to_confirm:!0,user:this.options.user,vis:this.options.vis,ChangePrivacyView:k});this.close(),a.appendToBody()}});b.exports=k}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_factory":108,"../../view_helpers/random_quote":112,"../../views/base_dialog/view":113,"./options_collection":28,"./share/share_view":35,"./start_view":37}],27:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=c.core.Model.extend({defaults:{privacy:"PUBLIC",disabled:!1,selected:!1,password:void 0},validate:function(a){if(a.disabled&&a.selected)return"Option can not be disabled and selected at the same time"},classNames:function(){return d.chain(["disabled","selected"]).map(function(a){return this.attributes[a]?"is-"+a:void 0},this).compact().value().join(" ")},canSave:function(){return!this.get("disabled")},saveToVis:function(a,b){return a.save(this._attrsToSave(),d.extend({wait:!0},b))},_attrsToSave:function(){return d.pick(this.attributes,"privacy","password")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("./option_model"),g=a("./password_option_model"),h=[{privacy:"PUBLIC",illustrationType:"positive",iconFontType:"unlock",title:"Public",desc:"Everyone can view and download it",alwaysEnable:!0},{privacy:"LINK",illustrationType:"alert",iconFontType:"unlock",title:"With link",desc:"Only the people with the link can view it"},{privacy:"PASSWORD",illustrationType:"alert",iconFontType:"unlockWithEllipsis",title:"Password protected",desc:"Only the people with the password can view it"},{privacy:"PRIVATE",illustrationType:"negative",iconFontType:"lock",title:"Private",desc:"Only you can access it"}];b.exports=d.Collection.extend({model:function(a,b){return"PASSWORD"===a.privacy?new g(a,b):new f(a,b)},initialize:function(){this.bind("change:selected",this._deselectLastSelected,this)},selectedOption:function(){return this.find(function(a){return a.get("selected")})},passwordOption:function(){return this.find(function(a){return"PASSWORD"===a.get("privacy")})},_deselectLastSelected:function(a,b){b&&this.each(function(b){b!==a&&b.set({selected:!1},{silent:!0})})}},{byVisAndUser:function(a,b){var c=b.get("actions")[a.isVisualization()?"private_maps":"private_tables"],d=a.get("privacy"),f=a.privacyOptions();return new this(e.chain(h).filter(function(a){return e.contains(f,a.privacy)}).map(function(a){return e.defaults({selected:a.privacy===d,disabled:!(a.alwaysEnable||c)},a)}).value())}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./option_model":27,"./password_option_model":29}],29:[function(a,b,c){(function(c){var d=("undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,"undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null),e=a("./option_model"),f=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.set("password",f.DEFAULT_FAKE_PASSWORD)},_attrsToSave:function(){var a=e.prototype._attrsToSave.call(this);return a.password===f.DEFAULT_FAKE_PASSWORD&&delete a.password,a},canSave:function(){return e.prototype.canSave.call(this)&&!d.isEmpty(this.get("password"))}},{DEFAULT_FAKE_PASSWORD:"!@#!@#"});b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./option_model":27}],30:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e=("undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,"undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null),f=a("./permission_view"),g=a("./user_details_view"),h=a("./group_details_view"),i=a("../../../view_factory");b.exports=e.core.View.extend({initialize:function(){d.each(["model","collection","pagedSearchModel"],function(a){if(d.isUndefined(this.options[a]))throw new Error(a+" is required")},this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.options.pagedSearchModel.get("q")||this._renderOrganizationPermissionView(),this._renderGrantablesViews(),this},_initBinds:function(){this.collection.bind("reset",this.render,this),this.add_related_model(this.collection),this.options.pagedSearchModel.on("change:q",this.render,this),this.add_related_model(this.options.pagedSearchModel)},_renderGrantablesViews:function(){var a=this.model.get("vis").tableMetadata().dependentVisualizations();this.collection.each(function(b){this._appendView(new f({model:b.entity,permission:this.model.get("permission"),isWriteAccessTogglerAvailable:this.model.isWriteAccessTogglerAvailable(),detailsView:this._createDetailsView(this._detailsViewOpts.bind(this,a,b.entity),b)}))},this)},_renderOrganizationPermissionView:function(){this._appendView(new f({model:this.model.get("organization"),permission:this.model.get("permission"),isWriteAccessTogglerAvailable:this.model.isWriteAccessTogglerAvailable(),detailsView:i.createByTemplate("common/dialogs/change_privacy/share/details",{avatarUrl:!1,willRevokeAccess:!1,title:"Default settings for your Organization",desc:"New users will have this permission",roleLabel:!1},{className:"ChangePrivacy-shareListItemInfo"})}))},_appendView:function(a){this.$el.append(a.render().el),this.addView(a)},_createDetailsView:function(a,b){var c=b.get("type");switch(c){case"user":return new g(a([b.id]));case"group":return new h(a(b.entity.users.chain().reject(this._isCurrentUser).pluck("id").value()));default:return e.log.error("No details view for grantable model of type "+c),new e.core.View(a())}},_detailsViewOpts:function(a,b,c){return{className:"ChangePrivacy-shareListItemInfo",model:b,permission:this.model.get("permission"),isUsingVis:d.any(a,function(a){return d.any(c,function(b){return b===a.permission.owner.id})})}},_isCurrentUser:function(a){return a.id===e.config.get("user").id}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_factory":108,"./group_details_view":31,"./permission_view":33,"./user_details_view":36}],31:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("../../../view_helpers/pluralize_string");b.exports=e.core.View.extend({initialize:function(){d.each(["permission","isUsingVis"],function(a){if(d.isUndefined(this.options[a]))throw new Error(a+" is required")},this)},render:function(){return this.$el.html(this.getTemplate("common/dialogs/change_privacy/share/details")({willRevokeAccess:this._willRevokeAccess(),avatarUrl:this.model.get("avatar_url"),title:this.model.get("display_name"),desc:this._desc(),roleLabel:!1})),this},_desc:function(){var a=this.model.users.length,b=f.prefixWithCount("member","members",a);return this._willRevokeAccess()?b+". "+f("Member's","Members'",a)+" maps will be affected":this.options.isUsingVis?b+". "+f("Member is","Members are",a)+" using this dataset":b},_willRevokeAccess:function(){return this.options.isUsingVis&&!this.options.permission.hasReadAccess(this.model)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_helpers/pluralize_string":111}],32:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=d.core.View.extend({tagName:"span",events:{"mouseover .js-toggler.is-disabled":"_onHoverDisabledToggler","mouseout .js-toggler":"_closeTooltip","mouseleave .js-toggler":"_closeTooltip","change .js-input":"_onChangeInput"},initialize:function(){c.each(["model","permission","hasAccess","canChangeAccess","toggleAccess","label"],function(a){if(c.isUndefined(this.options[a]))throw new Error(a+" is required")},this)},render:function(){return this.clearSubViews(),this.$el.html(d.templates.getTemplate("common/dialogs/change_privacy/share/permission_toggler")({cid:this.cid,hasAccess:this.options.hasAccess(),canChangeAccess:this.options.canChangeAccess(),label:this.options.label})),this},_onChangeInput:function(){this.options.toggleAccess()},_onHoverDisabledToggler:function(a){var b=this.options.permission.findRepresentableAclItem(this.model);b&&!b.isOwn(this.model)&&this._tooltipView().showTipsy()},_closeTooltip:function(){this._tooltipView().hideTipsy()},_tooltipView:function(a){return this._tooltip||(this._tooltip=this._newTooltipView(),this.addView(this._tooltip)),this._tooltip},_newTooltipView:function(a){return new d.common.TipsyTooltip({el:this.$(".js-toggler"),trigger:"manual",title:this._inheritedAccessTooltipText.bind(this)})},_inheritedAccessTooltipText:function(){var a=this.options.permission.findRepresentableAclItem(this.model),b=a.get("type");switch(b){case"group":return"Access is inherited from group "+a.get("entity").get("name");case"org":return"Access is inherited from organization";default:return d.log.error("Trying to display inherited access for an unrecognized type "+b),""}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],33:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./permission_toggler_view"),g=a("../../../view_factory");b.exports=e.core.View.extend({className:"ChangePrivacy-shareListItem",initialize:function(){d.each(["model","permission","isWriteAccessTogglerAvailable","detailsView"],function(a){if(d.isUndefined(this.options[a]))throw new Error(a+" is required")},this),this._initBinds()},_initBinds:function(){this.options.permission.acl.bind("add remove reset change",this.render,this),this.add_related_model(this.options.permission)},render:function(){return this.clearSubViews(),this._renderDetails(),this._renderAccessTogglers(),this},_renderDetails:function(){this._renderView(this.options.detailsView)},_renderAccessTogglers:function(){var a=[this._newReadToggler()];this.options.isWriteAccessTogglerAvailable&&a.unshift(this._newWriteToggler()),this._renderView(g.createByList(a))},_newWriteToggler:function(){var a=this.options.permission;return new f({className:"ChangePrivacy-shareListItemTogglerContainer",model:this.model,permission:a,label:"Write",hasAccess:a.hasWriteAccess.bind(a,this.model),canChangeAccess:a.canChangeWriteAccess.bind(a,this.model),toggleAccess:this._toggleWrite.bind(this)})},_newReadToggler:function(){var a=this.options.permission;return new f({model:this.model,permission:a,label:"Read",hasAccess:a.hasReadAccess.bind(a,this.model),canChangeAccess:a.canChangeReadAccess.bind(a,this.model),toggleAccess:this._toggleRead.bind(this)})},_renderView:function(a){this.addView(a),this.$el.append(a.render().el)},_toggleWrite:function(){var a=this.options.permission;a.canChangeWriteAccess(this.model)&&(a.hasWriteAccess(this.model)?a.revokeWriteAccess(this.model):a.grantWriteAccess(this.model))},_toggleRead:function(){var a=this.options.permission;a.canChangeReadAccess(this.model)&&(a.hasReadAccess(this.model)?a.revokeAccess(this.model):a.grantReadAccess(this.model))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_factory":108,"./permission_toggler_view":32}],34:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;"undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=c.core.Model.extend({defaults:{vis:void 0,permission:void 0,organization:void 0},initialize:function(a){if(!a.vis)throw new Error("vis is required");if(!a.organization)throw new Error("organization is required");var b=this.get("vis");if(this.set("permission",b.permission.clone()),!b.isVisualization()){var c=this;b.tableMetadata().fetch({silent:!0,success:function(){c.trigger("all")}})}},name:function(){return this.get("vis").get("name")},isWriteAccessTogglerAvailable:function(){return!this.get("vis").isVisualization()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=("undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,a("../../../views/base_dialog/view")),g=a("../../../view_helpers/random_quote"),h=a("../../../view_factory"),i=a("../../../paged_search_model"),j=a("../../../views/paged_search/paged_search_view"),k=a("./share_model"),l=a("./grantables_view");b.exports=f.extend({events:f.extendEvents({"click .js-back":"_openChangePrivacy"}),initialize:function(){if(!this.options.ChangePrivacyView)throw new Error("ChangePrivacyView is required");this.user=this.options.user,this.organization=this.user.organization,this.model=new k({vis:this.options.vis,organization:this.organization}),this.elder("initialize"),this._initViews(),this._initBinds()},render:function(){return f.prototype.render.apply(this,arguments),this.$(".content").addClass("Dialog-content--expanded"),this},render_content:function(){return[this._htmlNode(d.templates.getTemplate("common/dialogs/change_privacy/share/share_header")({name:this.options.vis.get("name")})),this._grantablesView.render().el,this._htmlNode(d.templates.getTemplate("common/dialogs/change_privacy/share/share_footer")())]},ok:function(){var a=h.createDialogByTemplate("common/templates/loading",{title:"Sharing…",quote:g()});a.appendToBody();var b=this.options.vis.permission;b.overwriteAcl(this.model.get("permission")),b.save().always(function(){a.close()}).fail(function(){var a=h.createDialogByTemplate("common/templates/fail",{msg:""});a.appendToBody()}).done(this._openChangePrivacy.bind(this))},_initViews:function(){var a=this.model,b=this.organization.grantables,c=new i({per_page:50,order:"name"});this._grantablesView=new j({isUsedInDialog:!0,pagedSearchModel:c,collection:b,createListView:function(){return new l({model:a,collection:b,pagedSearchModel:c})}})},_initBinds:function(){this.model.on("all",this._grantablesView.render,this._grantablesView)},_htmlNode:function(a){return e(a)[0]},_openChangePrivacy:function(){var a=new this.options.ChangePrivacyView({clean_on_hide:!0,enter_to_confirm:!0,vis:this.options.vis,user:this.user});a.appendToBody(),this.close()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../paged_search_model":99,"../../../view_factory":108,"../../../view_helpers/random_quote":112,"../../../views/base_dialog/view":113,"../../../views/paged_search/paged_search_view":128,"./grantables_view":30,"./share_model":34}],36:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=d.core.View.extend({initialize:function(){c.each(["permission","isUsingVis"],function(a){if(c.isUndefined(this.options[a]))throw new Error(a+" is required")},this)},render:function(){return this.$el.html(this.getTemplate("common/dialogs/change_privacy/share/details")({willRevokeAccess:this._willRevokeAccess(),avatarUrl:this.model.get("avatar_url"),title:this.model.get("username"),desc:this._desc(),roleLabel:this.model.get("viewer")?"Viewer":"Builder"})),this},_desc:function(){var a=this.model.get("email");return this._willRevokeAccess()?a+". User's maps will be affected":this.options.isUsingVis?a+". User is using this dataset":a},_willRevokeAccess:function(){return this.options.isUsingVis&&!this.options.permission.hasReadAccess(this.model)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,g=a("../../view_helpers/pluralize_string"),h="is-disabled",i=5;b.exports=d.core.View.extend({events:{"click .js-option":"_onClickOption","click .js-share":"_onClickShare","keyup .js-password-input":"_onKeyUpPasswordInput"},initialize:function(){if(this.elder("initialize"),!this.options.privacyOptions)throw new Error("privacyOptions is required");if(!this.options.user)throw new Error("user is required");if(!this.options.vis)throw new Error("vis is required");this.template=d.templates.getTemplate("common/dialogs/change_privacy/start"),this._initBinds()},render:function(){var a=this.options.privacyOptions.passwordOption(),b=a?a.get("password"):"",c=this.options.privacyOptions.selectedOption(),f=d.config.get("upgrade_url"),j=this.options.vis.permission.getUsersWithAnyPermission();return this.$el.html(this.template({vis:this.options.vis,privacyOptions:this.options.privacyOptions,password:b,saveBtnClassNames:c.canSave()?"":h,showUpgradeBanner:f&&this.options.privacyOptions.any(function(a){return!!a.get("disabled")}),upgradeUrl:f,showTrial:this.options.user.canStartTrial(),showShareBanner:this.options.user.organization,sharedEntitiesCount:j.length,personOrPeopleStr:g("person","people",j.length),
sharedEntitiesSampleCount:i,sharedEntitiesSample:e.take(j,i),sharedWithOrganization:this.options.vis.permission.isSharedWithOrganization()})),this.delegateEvents(),this},_initBinds:function(){this.options.privacyOptions.bind("change:selected change:disabled",this.render,this),this.options.privacyOptions.bind("change:password",this._onChangePassword,this),this.add_related_model(this.options.privacyOptions)},_onClickOption:function(a){var b=f(a.target).closest(".js-option").data("index"),c=this.options.privacyOptions.at(b);c.get("disabled")||c.set("selected",!0);var d=this.options.privacyOptions.passwordOption();c===d?this.$(".js-password-input").val("").focus().keyup():d&&this.$(".js-password-input").val(d.get("password"))},_onChangePassword:function(){this.$(".ok").toggleClass(h,!this.options.privacyOptions.selectedOption().canSave())},_onKeyUpPasswordInput:function(a){this.options.privacyOptions.passwordOption().set("password",a.target.value)},_onClickShare:function(a){this.killEvent(a),this.trigger("clickedShare")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/pluralize_string":111}],38:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./create_header"),f=a("./create_footer"),g=a("./create_listing"),h=a("./create_loading"),i=a("./listing/navigation_view");b.exports=d.core.View.extend({events:{click:"_onClickContent"},initialize:function(){this.user=this.options.user,this._initBinds()},render:function(){return this.clearSubViews(),this._initViews(),this._setOption(),this},_initViews:function(){var a=new e({el:this.$(".CreateDialog-header"),user:this.user,model:this.model});a.render(),this.addView(a);var b=new i({el:this.$(".js-navigation"),user:this.user,routerModel:this.model.visFetchModel,createModel:this.model,collection:this.model.collection});b.render(),this.addView(b);var c=new f({el:this.$(".CreateDialog-footer"),user:this.user,createModel:this.model});c.render(),this.addView(c),this.createPane=new d.ui.common.TabPane({el:this.$(".Dialog-body--create")}),this.createPane.bind("tabEnabled",function(a){b["listing"===a?"show":"hide"]()},this),this.addView(this.createPane);var j=new h({user:this.user,createModel:this.model});j.render(),this.createPane.addTab("loading",j),this._createListing=new g({user:this.user,createModel:this.model}),this._createListing.render(),this.createPane.addTab("listing",this._createListing),this.addView(this._createListing),this.model.set("option","listing")},_setOption:function(){this.createPane.active(this.model.getOption())},_initBinds:function(){_.bindAll(this,"_onScrollContent"),this.model.bind("change:option",this._setOption,this),this.model.bind("change:option",this._maybeShowOnboarding,this),this.$(".Dialog-body--create").bind("scroll",this._onScrollContent)},_maybeShowOnboarding:function(){this._onboardingView&&this.model.showOnboarding()&&(this._createListing.$el.append(this._onboardingView.render().el),this._onboardingView.show())},_onClickContent:function(){d.god.trigger("closeDialogs")},_onScrollContent:function(){var a=this.$(".Dialog-body--create").scrollTop()>0;this.$(".js-navigation").toggleClass("with-long-separator",!!a)},clean:function(){this.$(".Dialog-body--create").unbind("scroll",this._onScrollContent),this.elder("clean")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./create_footer":40,"./create_header":41,"./create_listing":42,"./create_loading":43,"./listing/navigation_view":79}],39:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../background_polling/models/upload_model"),f=a("../../visualizations_fetch_model");b.exports=d.core.Model.extend({defaults:{type:"dataset",option:"listing",listing:"import"},initialize:function(a,b){this.user=b.user,this.upload=new e({create_vis:!1},{user:this.user}),this.selectedDatasets=new Backbone.Collection,this.collection=new d.admin.Visualizations,this.visFetchModel=new f({content_type:"datasets",library:this.showLibrary()}),this._initBinds()},viewsReady:function(){},showLibrary:function(){return!0},showDatasets:function(){return!1},canSelect:function(){return!0},getOption:function(){var a=this.get("option"),b=a.split(".");return b.length>0?b[0]:""},getImportState:function(){var a=this.get("option"),b=a.split(".");return b.length>0&&b.length<4&&"listing"===b[0]&&"import"===b[1]?b[2]:""},showGuessingToggler:function(){return!0},showPrivacyToggler:function(){return!0},startUpload:function(){d.god.trigger("importByUploadData",this.upload.toJSON())},setActiveImportPane:function(a){a&&"import"===this.get("listing")&&this.getImportState()!==a&&this.set("option","listing.import."+a)},isMapType:function(){return!1},createFromScratch:function(){this.trigger("creatingDataset","dataset",this),this.set("option","loading");var a=this,b=new d.admin.CartoDBTableMetadata;b.save({},{success:function(b){a.trigger("datasetCreated",b,a)},error:function(b,c){a.trigger("datasetError",c,a)}})},_initBinds:function(){this.upload.bind("change",function(){this.trigger("change:upload",this)},this),this.collection.bind("change:selected",this._onItemSelected,this),this.visFetchModel.bind("change",this._fetchCollection,this),this.bind("change:option",this._maybePrefetchDatasets,this),this.bind("change:listing",this._maybePrefetchDatasets,this)},_maybePrefetchDatasets:function(){var a="datasets"===this.get("listing");!a||this.get("collectionFetched")||this.visFetchModel.isSearching()||(this.set("collectionFetched",!0),this._fetchCollection())},_selectedItems:function(){return this.collection.where({selected:!0})},_fetchCollection:function(){var a=this.visFetchModel.attributes;this.collection.options.set({locked:"",q:a.q,page:a.page||1,tags:a.tag,per_page:this.collection._TABLES_PER_PAGE,shared:a.shared,only_liked:a.liked,order:"updated_at",type:"",types:a.library?"remote":"table",exclude_raster:!0}),this.collection.fetch()},_onItemSelected:function(a){if("remote"===a.get("type")){var b=new d.admin.CartoDBTableMetadata(a.get("external_source")),c={type:"remote",value:a.get("name"),remote_visualization_id:a.get("id"),size:b.get("size"),create_vis:!1};d.god.trigger("importByUploadData",c)}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../background_polling/models/upload_model":14,"../../visualizations_fetch_model":132}],40:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./footer/guessing_toggler_view"),f=a("./footer/privacy_toggler_view");b.exports=d.core.View.extend({events:{"click .js-templates":"_goToTemplates","click .js-create_map":"_createMap","click .js-connect":"_connectDataset","click .js-videoTutorial":"_startTutorial"},initialize:function(){this.user=this.options.user,this.createModel=this.options.createModel,this.guessingModel=new d.core.Model({guessing:!0}),this.privacyModel=new d.core.Model({privacy:this.user.canCreatePrivateDatasets()?"PRIVATE":"PUBLIC"}),this.template=d.templates.getTemplate("common/views/create/create_footer"),this._initBinds()},render:function(){this.clearSubViews();var a=window.upgrade_url&&!d.config.get("cartodb_com_hosted")&&(!this.user.isInsideOrg()||this.user.isOrgOwner());return this.$el.html(this.template({isMapType:this.createModel.isMapType(),option:this.createModel.getOption(),listingState:this.createModel.get("listing"),isLibrary:this.createModel.visFetchModel.get("library"),importState:this.createModel.getImportState(),isUploadValid:this.createModel.upload.isValidToUpload(),selectedDatasetsCount:this.createModel.selectedDatasets.length,maxSelectedDatasets:this.user.getMaxLayers(),mapTemplate:this.createModel.get("mapTemplate"),userCanUpgrade:a,upgradeUrl:window.upgrade_url,currentUrl:window.location.href})),this._initViews(),this},_initBinds:function(){this.createModel.bind("change:upload",this.render,this),this.createModel.bind("change:option",this.render,this),this.createModel.bind("change:listing",this.render,this),this.createModel.selectedDatasets.bind("all",this.render,this),this.createModel.visFetchModel.bind("change:library",this.render,this),this.add_related_model(this.createModel),this.add_related_model(this.createModel.selectedDatasets),this.add_related_model(this.createModel.visFetchModel)},_initViews:function(){this.guessingTogglerView=new e({model:this.guessingModel,createModel:this.createModel}),this.$(".js-footer-info").append(this.guessingTogglerView.render().el),this.addView(this.guessingTogglerView),this.privacyTogglerView=new f({model:this.privacyModel,user:this.user,createModel:this.createModel}),this.$(".js-footerActions").prepend(this.privacyTogglerView.render().el),this.addView(this.privacyTogglerView)},_connectDataset:function(){this.createModel.upload.isValidToUpload()&&(this.createModel.showPrivacyToggler()&&this.createModel.upload.set("privacy",this.privacyModel.get("privacy")),this.createModel.upload.setGuessing(this.guessingModel.get("guessing")),this.createModel.startUpload())},_startTutorial:function(){this.createModel.startTutorial()},_goToTemplates:function(a){a&&a.preventDefault(),this.createModel.set("option","templates")},_createMap:function(){var a=this.createModel.selectedDatasets;a.length>0&&a.length<=this.user.getMaxLayers()&&this.createModel.createMap()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./footer/guessing_toggler_view":46,"./footer/privacy_toggler_view":47}],41:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({initialize:function(){this.user=this.options.user,this.template=c.templates.getTemplate("common/views/create/create_header"),this._initBinds()},render:function(){return this.$el.html(this.template({type:this.model.get("type"),option:this.model.getOption()})),this},_initBinds:function(){this.model.bind("change:option",this.render,this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],42:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./listing/datasets_view"),f=a("./listing/imports_view");b.exports=d.core.View.extend({className:"CreateDialog-listing CreateDialog-listing--noPaddingTop",initialize:function(){this.user=this.options.user,this.createModel=this.options.createModel,this.template=d.templates.getTemplate("common/views/create/create_listing"),this.createModel.bind("change:listing",this._onChangeListing.bind(this)),this.add_related_model(this.createModel),this._onChangeListing()},render:function(){return this.clearSubViews(),this.$el.html(this.template()),this._initViews(),this},_onChangeListing:function(){this.listingPane&&this.listingPane.active(this.createModel.get("listing"))},_initViews:function(){this.listingPane=new d.ui.common.TabPane({el:this.$(".ListingContent")}),this.addView(this.listingPane);var a=new e({defaultUrl:this.user.viewUrl().dashboard().datasets(),user:this.user,createModel:this.createModel,routerModel:this.createModel.visFetchModel,collection:this.createModel.collection});if(a.render(),this._addListingPane("datasets",a),this.user.canCreateDatasets()){var b=new f({user:this.user,createModel:this.createModel});b.render(),this._addListingPane("import",b)}},_addListingPane:function(a,b){this.listingPane.addTab(a,b,{active:this.createModel.get("listing")===a})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./listing/datasets_view":53,"./listing/imports_view":78}],43:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../../view_helpers/random_quote");b.exports=d.core.View.extend({className:"IntermediateInfo",tagName:"div",initialize:function(){this.createModel=this.options.createModel,this.user=this.options.user,this.model=new d.core.Model({state:"loading",type:"dataset"}),this._initBinds()},render:function(){var a=this.model.get("currentImport"),b={createModelType:this.createModel.get("type"),type:this.model.get("type"),state:this.model.get("state"),currentImport:a,currentImportName:a&&(a.upl.get("service_item_id")||a.upl.get("value")),tableIdsArray:this.model.get("tableIdsArray"),selectedDatasets:this.createModel.selectedDatasets,upgradeUrl:window.upgrade_url,freeTrial:this.user.get("show_trial_reminder"),quote:f()};if(a&&(b.err=a.getError(),b.err.item_queue_id=a.get("id")),"error"===b.state){var c=b.err&&b.err.error_code&&"8001"==b.err.error_code,e=!d.config.get("cartodb_com_hosted")&&(!this.user.isInsideOrg()||this.user.isOrgOwner());this.template=d.templates.getTemplate(c&&e?"common/views/create/create_loading_upgrade":"common/views/create/create_loading_error")}else this.template=d.templates.getTemplate("common/views/create/create_loading");return this.$el.html(this.template(b)),this},_initBinds:function(){this.model.bind("change:state change:tableIdsArray change:currentImport",this.render,this),this.createModel.bind("datasetError",this._onDatasetError,this),this.createModel.bind("creatingDataset",this._creatingDataset,this),this.createModel.bind("importingRemote",this._importingRemote,this),this.createModel.bind("importFailed",this._onImportFailed,this),this.createModel.bind("creatingMap",this._creatingMap,this),this.createModel.bind("mapError",this._onMapError,this),this.add_related_model(this.createModel)},_creatingDataset:function(){this.model.set({type:"dataset",state:"loading"})},_onDatasetError:function(){this.model.set({type:"dataset",state:"error"})},_importingRemote:function(a){this.model.set(e.extend(a.toJSON(),{state:"importing"}))},_onImportFailed:function(a){this.model.set(e.extend(a.toJSON(),{state:"error"}))},_creatingMap:function(a){this.model.set(e.extend(a.toJSON(),{state:"creating"}))},_onMapError:function(a){this.model.set(e.extend(a.toJSON(),{state:"error"}))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/random_quote":112}],44:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../../background_polling/models/imports_model"),g=a("../../background_polling/models/upload_model"),h=a("../../visualizations_fetch_model");b.exports=d.core.Model.extend({defaults:{type:"map",option:"listing",currentImport:null,tableIdsArray:[],listing:"datasets"},_DEFAULT_MAP_NAME:"Untitled Map",initialize:function(a,b){this.user=b.user,this.upload=new g({create_vis:!0},{user:this.user}),this.selectedDatasets=new Backbone.Collection(b.selectedItems),this.collection=new d.admin.Visualizations,this.vis=new d.admin.Visualization({name:"Untitled map"}),this.visFetchModel=new h({content_type:"datasets",library:this.showLibrary()}),this._initBinds()},viewsReady:function(){this.selectedDatasets.isEmpty()?this._maybePrefetchDatasets():this.createMap()},showLibrary:function(){return!1},showDatasets:function(){return!0},canSelect:function(a){return!!a.get("selected")||this.selectedDatasets.length<this.user.getMaxLayers()},getOption:function(){var a=this.get("option"),b=a.split(".");return b.length>0?b[0]:""},getImportState:function(){var a=this.get("option"),b=a.split(".");return b.length>0&&b.length<4&&"listing"===b[0]&&"import"===b[1]?b[2]:""},showGuessingToggler:function(){return!0},showPrivacyToggler:function(){return"import"===this.get("listing")},setActiveImportPane:function(a){a&&"import"===this.get("listing")&&this.getImportState()!==a&&this.set("option","listing.import."+a)},isMapType:function(){return!0},startTutorial:function(){this.trigger("startTutorial",this)},startUpload:function(){d.god.trigger("importByUploadData",this.upload.toJSON())},createMap:function(){0!==this.selectedDatasets.length&&(this.set("option","loading"),this._checkCollection())},createFromScratch:function(){this.trigger("creatingDataset","dataset",this),this.set("option","loading");var a=this,b=new d.admin.CartoDBTableMetadata;b.save({},{success:function(b){a.trigger("datasetCreated",b,a)},error:function(b,c){a.trigger("datasetError",c,a)}})},_initBinds:function(){this.upload.bind("change",function(){this.trigger("change:upload",this)},this),this.bind("change:option",this._onOptionChange,this),this.collection.bind("change:selected",function(a,b){this.selectedDatasets[b?"add":"remove"](a)},this),this.collection.bind("reset",function(){this.selectedDatasets.each(function(a){var b=this.collection.get(a.id);b&&b.set("selected",!0)},this)},this),this.visFetchModel.bind("change",this._fetchCollection,this),this.selectedDatasets.isEmpty()&&(this.bind("change:option",this._maybePrefetchDatasets,this),this.bind("change:listing",this._maybePrefetchDatasets,this))},_maybePrefetchDatasets:function(){var a="datasets"===this.get("listing");!a||this.get("collectionFetched")||this.visFetchModel.isSearching()||(this.set("collectionFetched",!0),this._fetchCollection())},_fetchCollection:function(){var a,b=this.visFetchModel.attributes;a=this.visFetchModel.isSearching()?"table,remote":b.library?"remote":"table",this.collection.options.set({locked:"",q:b.q,page:b.page||1,tags:b.tag,per_page:this.collection._TABLES_PER_PAGE,shared:b.shared,only_liked:b.liked,order:"updated_at",type:"",types:a,exclude_raster:!0}),this.collection.fetch()},_selectedItems:function(){return this.selectedDatasets},_checkCollection:function(){this.selectedDatasets.length>0?this._importDataset(this.selectedDatasets.pop()):(this.set("currentImport",""),this._createMap())},_importDataset:function(a){var b=e.clone(this.get("tableIdsArray"));if("remote"===a.get("type")){var c={create_vis:!1,type:"remote",value:a.get("name"),remote_visualization_id:a.get("id"),size:a.get("external_source")?a.get("external_source").size:void 0},d=new f({},{upload:c,user:this.user});this.set("currentImport",e.clone(d)),this.trigger("importingRemote",this),d.bind("change:state",function(a){if(a.hasCompleted()){var c=a.imp.toJSON();b.push(c.table_name),this.set("tableIdsArray",b),this._checkCollection(),this.trigger("importCompleted",this)}a.hasFailed()&&this.trigger("importFailed",this)},this),d.hasFailed()&&this.trigger("importFailed",this)}else{var g=a.tableMetadata();b.push(g.get("name")),this.set({currentImport:"",tableIdsArray:b}),this._checkCollection()}},_createMap:function(){var a=this,b=new d.admin.Visualization({name:this._DEFAULT_MAP_NAME,type:"derived"});this.trigger("creatingMap",this),b.save({tables:this.get("tableIdsArray")},{success:function(){a._redirectTo(b.viewUrl(a.user).edit().toString())},error:function(){a.trigger("mapError",a)}})},_redirectTo:function(a){window.location=a}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../background_polling/models/imports_model":10,"../../background_polling/models/upload_model":14,"../../visualizations_fetch_model":132}],45:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../views/base_dialog/view"),f=a("./create_content");b.exports=e.extend({className:"Dialog is-opening CreateDialog",initialize:function(){this.elder("initialize"),this.user=this.options.user,this.template=d.templates.getTemplate("common/views/create/dialog_template"),this._initBinds()},render:function(){return e.prototype.render.call(this),this.$(".content").addClass("Dialog-content--expanded"),this._initViews(),this},render_content:function(){return this.template()},_initBinds:function(){d.god.bind("importByUploadData",this.close,this),this.add_related_model(d.god)},_initViews:function(){var a=new f({el:this.$el,model:this.model,user:this.user});a.render(),this.addView(a)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../views/base_dialog/view":113,"./create_content":38}],46:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{"click .js-toggle":"_toggle"},initialize:function(){this.elder("initialize"),this.createModel=this.options.createModel,this.template=c.templates.getTemplate("common/dialogs/create/footer/guessing_toggler"),this._initBinds()},render:function(){var a="";return this.createModel.showGuessingToggler()&&(a=this.template({isGuessingEnabled:this.model.get("guessing"),importState:this.createModel.getImportState(),isUploadValid:this.createModel.upload.isValidToUpload(),customHosted:c.config.get("cartodb_com_hosted")})),this.$el.html(a),this},_initBinds:function(){this.createModel.bind("change",this.render,this),this.model.bind("change",this.render,this),this.add_related_model(this.createModel)},_toggle:function(){var a=!this.model.get("guessing");this.model.set("guessing",a)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],47:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=c.core.View.extend({events:{click:"_onClick"},initialize:function(){this.user=this.options.user,this.createModel=this.options.createModel,this.template=c.templates.getTemplate("common/dialogs/create/footer/privacy_toggler_template"),this._initBinds()},render:function(){if(this.clearSubViews(),this.$el.empty(),this.createModel.showPrivacyToggler()){var a=this.user.canCreatePrivateDatasets(),b=this.model.get("privacy"),d="PUBLIC"===b?"PRIVATE":"PUBLIC",e="PUBLIC"===b?"unlock":"lock",f=c.config.get("upgrade_url")||window.upgrade_url,g=!c.config.get("cartodb_com_hosted")&&!a&&f;this.$el.html(this.template({privacy:b,isDisabled:!a,canUpgrade:g,nextPrivacy:d,upgradeUrl:f,icon:e})),this._initViews()}return this},_initBinds:function(){this.model.bind("change:privacy",this.render,this)},_initViews:function(){this.addView(new c.common.TipsyTooltip({el:this.$(".js-toggler"),html:!0,title:function(){return d(this).attr("data-title")}}))},_onClick:function(){if(this.user.canCreatePrivateDatasets()){var a=this.model.get("privacy");return void this.model.set("privacy","PUBLIC"===a?"PRIVATE":"PUBLIC")}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("../../../../../common/view_helpers/random_quote");b.exports=d.core.View.extend({events:{"click .js-connect":"_onConnectClick"},initialize:function(){if(!this.options.defaultUrl)throw new Error("defaultUrl is required");this.user=this.options.user,this.routerModel=this.options.routerModel,this.template=d.templates.getTemplate(this.options.template),this._initBinds()},render:function(){var a=this.routerModel.get("content_type");return this.$el.html(this.template({defaultUrl:this.options.defaultUrl,page:this.routerModel.get("page"),tag:this.routerModel.get("tag"),q:this.routerModel.get("q"),shared:this.routerModel.get("shared"),locked:this.routerModel.get("locked"),library:this.routerModel.get("library"),quote:e(),type:a,totalItems:this.collection.size(),totalEntries:this.collection.total_entries})),this},_initBinds:function(){this.routerModel.bind("change",this.render,this),this.collection.bind("reset",this.render,this),this.add_related_model(this.routerModel),this.add_related_model(this.collection)},_onConnectClick:function(){this.trigger("connectDataset",this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../../common/view_helpers/random_quote":112}],49:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.moment:"undefined"!=typeof c?c.moment:null,f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,g=a("../../../../view_helpers/pluralize_string"),h=a("../../../../views/likes/view");b.exports=d.core.View.extend({tagName:"li",className:"DatasetsList-item DatasetsList-item--selectable",events:{"click .js-tag-link":"_onTagClick",click:"_toggleSelected"},initialize:function(){this.user=this.options.user,this.routerModel=this.options.createModel.visFetchModel,this.template=d.templates.getTemplate("common/views/create/listing/dataset_item"),this.table=new d.admin.CartoDBTableMetadata(this.model.get("table")),this.model.on("change",this.render,this)},render:function(){var a=this.model,b=this.table,c=a.get("tags")||[],d=a.get("description")&&f.stripHTML(markdown.toHTML(a.get("description")))||"",h={isRaster:"raster"===a.get("kind"),geometryType:b.geomColumnTypes().length>0?b.geomColumnTypes()[0]:"",title:a.get("name"),isOwner:a.permission.isOwner(this.user),owner:a.permission.owner.renderData(this.user),showPermissionIndicator:!a.permission.hasWriteAccess(this.user),description:d,privacy:a.get("privacy").toLowerCase(),likes:a.get("likes")||0,timeDiff:e(a.get("updated_at")).fromNow(),tags:c,tagsCount:c.length,maxTagsToShow:3,rowCount:void 0,datasetSize:void 0,syncStatus:void 0,syncRanAt:void 0},i=b.get("row_count");i>=0&&(h.rowCount=i<1e4?f.formatNumber(i):f.readizableNumber(i),h.pluralizedRows=g("Row",i));var j=b.get("size");return j>=0&&(h.datasetSize=f.readablizeBytes(j,!0)),_.isEmpty(a.get("synchronization"))||(h.syncRanAt=e(a.get("synchronization").ran_at||new Date).fromNow(),h.syncStatus=a.get("synchronization").state),this.$el.html(this.template(h)),this._renderLikesIndicator(),this._renderTooltips(),this.$el[a.get("selected")?"addClass":"removeClass"]("is--selected"),this},_renderLikesIndicator:function(){var a=new h({model:this.model.like});this.$(".js-likes-indicator").replaceWith(a.render().el),this.addView(a)},_renderTooltips:function(){_.isEmpty(this.model.get("synchronization"))||this.addView(new d.common.TipsyTooltip({el:this.$(".DatasetsList-itemStatus"),title:function(a){return $(this).attr("data-title")}}))},_onTagClick:function(a){var b=$(a.target).val();b&&this.routerModel.set("tag",b)},_toggleSelected:function(a){"A"!==a.target.tagName&&(this.killEvent(a),this.options.createModel.canSelect(this.model)&&this.model.set("selected",!this.model.get("selected")))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../view_helpers/pluralize_string":111,"../../../../views/likes/view":126}],50:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../../../views/pagination/model"),f=a("../../../../views/pagination/view");b.exports=d.core.View.extend({className:"DatasetsPaginator",initialize:function(){this.routerModel=this.options.routerModel,this.collection=this.options.collection,this.model=new e({current_page:this.routerModel.get("page")}),this._initBinds(),this._initViews()},render:function(){return this.clearSubViews(),this.$el.append(this.paginationView.render().el),this},_initBinds:function(){this.model.bind("change",this.render,this),this.model.bind("change:current_page",function(){this.routerModel.set("page",this.model.get("current_page"))},this),this.collection.bind("reset",this._updatePaginationModelByCollection,this),this.routerModel.bind("change:page",this._updatePaginationModelByRouterModel,this),this.add_related_model(this.routerModel),this.add_related_model(this.collection),this.add_related_model(this.model)},_initViews:function(){this.paginationView=new f({model:this.model}),this.addView(this.paginationView)},_updatePaginationModelByCollection:function(){this.model.set({per_page:this.collection.options.get("per_page"),total_count:this.collection.total_entries})},_updatePaginationModelByRouterModel:function(){this.model.set("current_page",this.routerModel.get("page"))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../views/pagination/model":129,"../../../../views/pagination/view":130}],51:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("./dataset_item_view"),g="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,h=a("../../../../background_polling/models/upload_config"),i=a("../../../../view_helpers/pluralize_string");b.exports=f.extend({tagName:"li",className:"DatasetsList-item",events:{"click .js-tag-link":"_onTagClick",click:"_toggleSelected"},initialize:function(){this.elder("initialize"),this.template=d.templates.getTemplate("common/views/create/listing/remote_dataset_item"),this.table=new d.admin.CartoDBTableMetadata(this.model.get("external_source"))},render:function(){var a=this.model,b=this.table,c=a.get("tags")||[],d=a.get("description")&&g.stripHTML(markdown.toHTML(a.get("description")))||"",e=a.get("source")&&markdown.toHTML(a.get("source"))||"",f={isRaster:"raster"===a.get("kind"),geometryType:b.geomColumnTypes().length>0?b.geomColumnTypes()[0]:"",title:a.get("display_name")||a.get("name"),source:e,description:d,timeDiff:moment(a.get("updated_at")).fromNow(),tags:c,tagsCount:c.length,routerModel:this.routerModel,maxTagsToShow:3,canImportDataset:this._canImportDataset(),rowCount:void 0,datasetSize:void 0},h=b.get("row_count");h>=0&&(f.rowCount=h<1e4?g.formatNumber(h):g.readizableNumber(h),f.pluralizedRows=i("Row",h));var j=b.get("size");return j>=0&&(f.datasetSize=g.readablizeBytes(j,!(j.toString().length>9))),this.$el.html(this.template(f)),this._setItemClasses(),this._renderTooltips(),this},_setItemClasses:function(){this.$el[this.model.get("selected")?"addClass":"removeClass"]("is--selected"),this.$el[this._canImportDataset()?"addClass":"removeClass"]("DatasetsList-item--selectable"),this.$el[this._canImportDataset()?"removeClass":"addClass"]("DatasetsList-item--banned")},_renderTooltips:function(){this.addView(new d.common.TipsyTooltip({el:this.$(".DatasetsList-itemStatus"),title:function(a){return e(this).attr("data-title")}}))},_onTagClick:function(a){a&&this.killEvent(a);var b=e(a.target).val();b&&this.routerModel.set({tag:b,library:!0})},_canImportDataset:function(){var a=this.table.get("size")||0;return this.user.get("remaining_byte_quota")*h.fileTimesBigger>=a&&this.user.get("limits").import_file_size>a},_toggleSelected:function(a){"A"!==a.target.tagName&&(this.killEvent(a),this._canImportDataset()&&this.options.createModel.canSelect(this.model)&&this.model.set("selected",!this.model.get("selected")))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../background_polling/models/upload_config":13,"../../../../view_helpers/pluralize_string":111,"./dataset_item_view":49}],52:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./datasets/dataset_item_view"),f=a("./datasets/remote_dataset_item_view");b.exports=d.core.View.extend({tagName:"ul",className:"DatasetsList",events:{},_ITEMS:{remotes:f,datasets:e},initialize:function(){this.user=this.options.user,this.createModel=this.options.createModel,this.collection.bind("reset",this.render,this),this.add_related_model(this.collection)},render:function(){return this.clearSubViews(),this.collection.each(this._addItem,this),this},_addItem:function(a,b){
var c="remote"===a.get("type")?"remotes":"datasets",d=new this._ITEMS[c]({model:a,createModel:this.createModel,user:this.user});this.addView(d),this.$el.append(d.render().el)},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./datasets/dataset_item_view":49,"./datasets/remote_dataset_item_view":51}],53:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("./datasets_list_view"),g=a("./datasets/content_result_view"),h=a("./datasets/datasets_paginator_view");b.exports=d.core.View.extend({initialize:function(){this.user=this.options.user,this.createModel=this.options.createModel,this.routerModel=this.options.routerModel,this._initViews(),this._initBindings()},_initBindings:function(){this.routerModel.bind("change",this._onRouterChange,this),this.collection.bind("loading",this._onDataLoading,this),this.collection.bind("reset",this._onDataFetched,this),this.collection.bind("error",function(a){(!a||a&&"abort"!==a.statusText)&&this._onDataError()},this),this.add_related_model(this.routerModel),this.add_related_model(this.createModel),this.add_related_model(this.collection)},_initViews:function(){this.controlledViews={},this.enabledViews=[];var a=new g({className:"ContentResult no-datasets",user:this.user,defaultUrl:this.options.defaultUrl,routerModel:this.routerModel,collection:this.collection,template:"common/views/create/listing/content_no_datasets"});a.bind("connectDataset",function(){this.user.canCreateDatasets()&&this.createModel.set("listing","import")},this),a.render().hide(),this.controlledViews.no_datasets=a,this.$el.append(a.el),this.addView(a);var b=new f({user:this.user,createModel:this.createModel,routerModel:this.routerModel,collection:this.collection});this.controlledViews.list=b,this.$el.append(b.render().el),this.addView(b);var c=new g({defaultUrl:this.options.defaultUrl,routerModel:this.routerModel,collection:this.collection,template:"common/views/create/listing/datasets_no_result"});c.render().hide(),this.controlledViews.no_results=c,this.$el.append(c.el),this.addView(c);var d=new g({defaultUrl:this.options.defaultUrl,routerModel:this.routerModel,collection:this.collection,template:"common/views/create/listing/datasets_error"});d.render().hide(),this.controlledViews.error=d,this.$el.append(d.el),this.addView(d);var e=new g({defaultUrl:this.options.defaultUrl,routerModel:this.routerModel,collection:this.collection,template:"common/views/create/listing/datasets_loader"});this.controlledViews.main_loader=e,this.$el.append(e.render().el),this.addView(e);var i=new h({routerModel:this.routerModel,collection:this.collection});this.controlledViews.content_footer=i,this.$el.append(i.render().el),this.addView(i)},_onRouterChange:function(){this._hideBlocks(),this._showBlocks(["main_loader"])},_onDataFetched:function(){var a=["content_footer"],b=this.routerModel.get("tag"),c=this.routerModel.get("q"),d=this.routerModel.get("shared"),e=this.routerModel.get("locked"),f=this.routerModel.get("library");if(f&&0===this.collection.total_user_entries&&a.push("no_datasets"),0===this.collection.size())if(b||c||"no"!==d||e)a.push("no_results");else{if(!f)return void this._goToLibrary();a.push("no_results")}else a.push("list");this._hideBlocks(),this._showBlocks(a)},_onDataLoading:function(){this._hideBlocks(),this._showBlocks(["main_loader"])},_onDataError:function(a){this._hideBlocks(),this._showBlocks(["error"])},_showBlocks:function(a){var b=this;a?e.each(a,function(a){b.controlledViews[a]&&(b.controlledViews[a].show(),b.enabledViews.push(a))}):(b.enabledViews=[],e.each(this.controlledViews,function(a){a.show(),b.enabledViews.push(a)}))},_goToLibrary:function(){this.routerModel.set({shared:"no",library:!0,page:1})},_hideBlocks:function(a){var b=this;a?e.each(a,function(a){b.controlledViews[a]&&(b.controlledViews[a].hide(),b.enabledViews=e.without(b.enabledViews,a))}):(e.each(this.controlledViews,function(a){a.hide()}),b.enabledViews=[])},_isBlockEnabled:function(a){return!!a&&e.contains(this.enabledViews,a)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./datasets/content_result_view":48,"./datasets/datasets_paginator_view":50,"./datasets_list_view":52}],54:[function(a,b,c){var d=a("./imports/service_import/import_service_view"),e=a("./imports/twitter_import/import_twitter_view"),f=a("./imports/import_data_view"),g=a("./imports/import_arcgis_view");b.exports={File:{className:f,enabled:function(a,b){return!0},name:"file",title:"Data file",options:{type:"url",fileEnabled:!0,acceptSync:!0}},GDrive:{className:d,enabled:function(a,b){return!!a.get("oauth_gdrive")},name:"gdrive",title:"Google Drive",options:{service:"gdrive",fileExtensions:["Google SpreadSheet","CSV"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"size",format:"size",key:!0}]}}}},Dropbox:{className:d,enabled:function(a,b){return!!a.get("oauth_dropbox")},name:"dropbox",title:"Dropbox",options:{service:"dropbox",fileExtensions:["CSV","XLS"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"id",format:""},{name:"size",format:"size",key:!0}],separator:"-"}}}},Box:{className:d,enabled:function(a,b){return!!a.get("oauth_box")},name:"box",title:"Box",fallback:"common/views/create/listing/import_box_fallback",options:{service:"box",fileExtensions:["CSV","XLS"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"size",format:"size",key:!0}],separator:"-"}}}},Twitter:{className:e,enabled:function(a,b){return b.twitter.enabled&&!!a.get("datasource_search_twitter")},fallback:"common/views/create/listing/import_twitter_fallback",name:"twitter",title:"Twitter"},Mailchimp:{className:d,enabled:function(a,b){return b.mailchimp.enabled&&!!a.get("oauth_mailchimp")},fallback:"common/views/create/listing/import_mailchimp_fallback",name:"mailchimp",title:"MailChimp",options:{service:"mailchimp",fileExtensions:[],acceptSync:!0,showAvailableFormats:!1,headerTemplate:"common/views/create/listing/import_types/data_header_mailchimp",fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"member_count",format:"number",key:!0}],itemName:"member",separator:""}}}},Arcgis:{className:g,enabled:function(a,b){return a.get("arcgis_enabled")},fallback:"common/views/create/listing/import_arcgis_fallback",name:"arcgis",title:"ArcGIS Server&trade;"},Salesforce:{className:f,enabled:function(a,b){return a.get("salesforce_enabled")},fallback:"common/views/create/listing/import_salesforce_fallback",name:"salesforce",title:"Salesforce",options:{type:"service",service_name:"salesforce",acceptSync:!0,formTemplate:"common/views/create/listing/import_types/data_form_salesforce",headerTemplate:"common/views/create/listing/import_types/data_header_salesforce"}}}},{"./imports/import_arcgis_view":58,"./imports/import_data_view":59,"./imports/service_import/import_service_view":63,"./imports/twitter_import/import_twitter_view":73}],55:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;c.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof a?a.cdb.admin:null,b.exports=c.core.View.extend({options:{template:"",fileEnabled:!1},events:{"keyup .js-textInput":"_onTextChanged","submit .js-form":"_onSubmitForm"},initialize:function(){this.user=this.options.user,this.template=c.templates.getTemplate(this.options.template||"common/views/create/listing/import_types/data_form"),this._initBinds(),this._checkVisibility()},render:function(){return this.$el.html(this.template(this.options)),this._initViews(),this},_initBinds:function(){this.model.bind("change:state",this._checkVisibility,this)},_initViews:function(){if(this.options.fileEnabled){var a=this;this.$(".js-fileInput").bind("change",function(b){this.files&&this.files.length>0&&a._onFileChanged(this.files),this.value=""}),this._initDropzone()}},_initDropzone:function(){var a=$("html")[0],b=this;this.dragster=new Dragster(a),$(a).bind("dragster:enter",function(a){b._showDropzone()}),$(a).bind("dragster:leave",function(a){b._hideDropzone()}),a.dropzone||(this.dropzone=new Dropzone(a,{url:":)",autoProcessQueue:!1,previewsContainer:!1}),this.dropzone.on("dragover",function(){b._showDropzone()}),this.dropzone.on("drop",function(a){var c=a.dataTransfer.files;b._onFileChanged(c),b._hideDropzone()}))},_destroyDropzone:function(){var a=$("html")[0];this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),$(a).unbind("dragster:enter dragster:leave")),this.dropzone&&this.dropzone.destroy()},_setValidFileExtensions:function(a){return RegExp("(.|/)("+a.join("|")+")$","i")},_onTextChanged:function(){var a=this.$(".js-textInput").val();a||this._hideTextError()},_onFileChanged:function(a){this.trigger("fileSelected",this),a&&1===a.length&&(a=a[0]),this.model.set({type:"file",value:a}),"error"!==this.model.get("state")?(this._hideFileError(),this.model.set("state","selected")):this._showFileError()},_showTextError:function(){this.$(".Form-inputError").addClass("is-visible")},_hideTextError:function(){this.$(".Form-inputError").removeClass("is-visible")},_showDropzone:function(){this.$(".Form-upload").addClass("is-dropping"),this._hideFileError()},_hideDropzone:function(){this.$(".Form-upload").removeClass("is-dropping")},_showFileError:function(){"error"===this.model.get("state")&&(this.$(".js-fileError").text(this.model.get("get_error_text").what_about).show(),this.$(".js-fileLabel").hide(),this.$(".js-fileButton").addClass("Button--negative"))},_hideFileError:function(){this.$(".js-fileError").hide(),this.$(".js-fileLabel").show(),this.$(".js-fileButton").removeClass("Button--negative")},_onSubmitForm:function(a){a&&this.killEvent(a);var b=this.$(".js-textInput").val();if(!b)return void this._hideTextError();this.trigger("urlSelected",this);var c=this.model.get("service_name")?"service":"url";this.model.set({type:c,value:b,service_item_id:b,state:"idle"}),"error"!==this.model.get("state")?(this._hideFileError(),this._hideTextError(),this.model.set("state","selected")):this._showTextError()},_checkVisibility:function(){var a=this.model.get("state");this["selected"!==a?"show":"hide"]()},clean:function(){this._destroyDropzone(),this.$(".js-fileInput").unbind("change"),this.elder("clean")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{"click .js-back":"_goToStart"},options:{fileEnabled:!1,acceptSync:!1},initialize:function(){this.user=this.options.user,this.template=c.templates.getTemplate(this.options.template||"common/views/create/listing/import_types/data_header"),this._initBinds(),this._checkVisibility()},render:function(){var a=this.options.acceptSync&&this.user.get("actions")&&this.user.get("actions").sync_tables&&"file"!==this.model.get("type");return this.$el.html(this.template({type:this.model.get("type"),fileEnabled:this.options.fileEnabled,acceptSync:a,state:this.model.get("state")})),this._checkVisibility(),this},_initBinds:function(){this.model.bind("change:state",this.render,this)},_checkVisibility:function(){this.show()},_goToStart:function(){this.model.set("state","idle")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],57:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,f=a("./import_selected_dataset_view");b.exports=f.extend({render:function(){var a=this.options.fileAttrs.title&&this.model.get("value")[this.options.fileAttrs.title]||this.model.get("value"),b=this._genDescription(),c=this.options.fileAttrs.ext?e.getFileExtension(a):"";this.options.fileAttrs.ext&&(a=a&&a.replace("."+c,""));var f=window.upgrade_url,g=this.user.get("actions")&&this.user.get("actions").sync_tables,h=d.config.get("cartodb_com_hosted");return this.$el.html(this.template({title:a,description:b,ext:c,interval:this.model.get("interval"),importCanSync:this.options.acceptSync&&this._isArcGISLayer(a),userCanSync:g,showTrial:this.user.canStartTrial(),showUpgrade:!g&&!h&&f&&!this.user.isInsideOrg(),upgradeUrl:f})),this},_isArcGISLayer:function(a){return a.search(/([0-9]+\/|[0-9]+)/)!==-1}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./import_selected_dataset_view":62}],58:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("./data_import/data_form_view"),f=a("./data_import/data_header_view"),g=a("./import_arcgis_selected_dataset_view"),h=a("./import_data_view");b.exports=h.extend({options:{fileExtensions:[],type:"service",service:"arcgis",acceptSync:!0,fileEnabled:!1,fileAttrs:{ext:!1,title:"",description:""}},_initViews:function(){var a=new f({el:this.$(".ImportPanel-header"),model:this.model,user:this.user,collection:this.collection,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:"common/views/create/listing/import_types/data_header_arcgis"});a.render(),this.addView(a);var b=new g({el:this.$(".DatasetSelected"),user:this.user,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs});b.render(),this.addView(b);var c=new e({el:this.$(".ImportPanel-form"),user:this.user,model:this.model,template:"common/views/create/listing/import_types/data_form_arcgis",fileEnabled:this.options.fileEnabled});c.render(),this.addView(c)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./data_import/data_form_view":55,"./data_import/data_header_view":56,"./import_arcgis_selected_dataset_view":57,"./import_data_view":59}],59:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("./import_default_view"),f=a("../../../../background_polling/models/upload_model"),g=a("./data_import/data_form_view"),h=a("./data_import/data_header_view"),i=a("./import_selected_dataset_view");b.exports=e.extend({options:{fileExtensions:[],type:"url",service:"",acceptSync:!1,fileEnabled:!1,formTemplate:"",headerTemplate:"",fileAttrs:{}},className:"ImportPanel ImportDataPanel",initialize:function(){this.user=this.options.user,this.model=new f({type:this.options.type,service_name:this.options.service},{user:this.user}),this.template=d.templates.getTemplate("common/views/create/listing/import_types/import_data"),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(this.template()),this._initViews(),this},_initViews:function(){var a=new h({el:this.$(".ImportPanel-header"),model:this.model,user:this.user,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:this.options.headerTemplate});a.render(),this.addView(a);var b=new i({el:this.$(".DatasetSelected"),user:this.user,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs});b.render(),this.addView(b);var c=new g({el:this.$(".ImportPanel-form"),user:this.user,model:this.model,template:this.options.formTemplate,fileEnabled:this.options.fileEnabled});c.bind("fileSelected",function(){b.setOptions({acceptSync:!1,fileAttrs:{ext:!0,title:"name",description:{content:[{name:"size",format:"size"}]}}})}),c.bind("urlSelected",function(){b.setOptions({acceptSync:!0,fileAttrs:{ext:!1,title:"",description:""}})}),c.render(),this.addView(c)},_initBinds:function(){this.model.bind("change:state",this._checkState,this),this.model.bind("change",this._triggerChange,this)},_checkState:function(){"selected"===this.model.previous("state")&&this.model.set({type:void 0,value:"",service_name:"",service_item_id:"",interval:0})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../background_polling/models/upload_model":14,"./data_import/data_form_view":55,"./data_import/data_header_view":56,"./import_default_view":61,"./import_selected_dataset_view":62}],60:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({className:"ImportPanel",initialize:function(){this.template=c.templates.getTemplate(this.options.template||"common/views/create/listing/import_default_fallback")},render:function(){this.$el.append(this.template())}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],61:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../../../background_polling/models/upload_model");b.exports=d.core.View.extend({initialize:function(){this.user=this.options.user,this.model=new e(null,{user:this.user}),this._initBinds()},_initBinds:function(){this.model.bind("change",this._triggerChange,this)},_triggerChange:function(){this.trigger("change",this.model.toJSON(),this)},getModelData:function(){return this.model?this.model.toJSON():{}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../background_polling/models/upload_model":14}],62:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,f=a("../../../../view_helpers/pluralize_string");b.exports=d.core.View.extend({className:"DatasetSelected",_FORMATTERS:{size:e.readablizeBytes,number:e.formatNumber},options:{acceptSync:!1,fileAttrs:{ext:!1,title:"",description:{content:[{name:"id",format:""}],itemName:"",separator:""}}},events:{"click .js-interval-0":"_onIntervalZero","click .js-interval-1":"_onIntervalHour","click .js-interval-2":"_onIntervalDay","click .js-interval-3":"_onIntervalWeek","click .js-interval-4":"_onIntervalMonth"},initialize:function(){this.user=this.options.user,this.template=d.templates.getTemplate("common/views/create/listing/import_selected_dataset"),this._initBinds(),this._checkVisibility()},render:function(){var a=this.options.fileAttrs.title&&this.model.get("value")[this.options.fileAttrs.title]||this.model.get("value"),b=this._genDescription(),c=this.options.fileAttrs.ext?e.getFileExtension(a):"";this.options.fileAttrs.ext&&(a=a&&a.replace("."+c,""));var f=window.upgrade_url,g=this.user.get("actions")&&this.user.get("actions").sync_tables,h=d.config.get("cartodb_com_hosted");return this.$el.html(this.template({title:a,description:b,ext:c,interval:this.model.get("interval"),importCanSync:this.options.acceptSync,userCanSync:g,showTrial:this.user.canStartTrial(),showUpgrade:!g&&!h&&f&&!this.user.isInsideOrg(),upgradeUrl:f})),this},_initBinds:function(){this.model.bind("change:value",this.render,this),this.model.bind("change:interval",this.render,this),this.model.bind("change:state",this._checkVisibility,this)},_genDescription:function(){if(this.options.fileAttrs&&this.options.fileAttrs.description){var a=this.options.fileAttrs.description,b="",c="",d=this;return a.content&&a.content.length>0&&_.each(a.content,function(e,f){f>0&&a.separator&&(c+=" "+a.separator+" ");var g=d.model.get("value")[e.name],h=e.format&&d._FORMATTERS[e.format];c+=h&&h(g)||g,e.key&&(b=e.name)}),a.itemName&&b&&(c+=" "+(a.itemName&&f(a.itemName,b)||"")),c}return""},_onIntervalZero:function(){this.model.set("interval",0)},_onIntervalHour:function(){this.options.acceptSync&&this.user.get("actions").sync_tables&&this.model.set("interval",3600)},_onIntervalDay:function(){this.options.acceptSync&&this.user.get("actions").sync_tables&&this.model.set("interval",86400)},_onIntervalWeek:function(){this.options.acceptSync&&this.user.get("actions").sync_tables&&this.model.set("interval",604800)},_onIntervalMonth:function(){this.options.acceptSync&&this.user.get("actions").sync_tables&&this.model.set("interval",2592e3)},setOptions:function(a){a&&!_.isEmpty(a)&&_.extend(this.options,a)},_checkVisibility:function(){var a=this.model.get("state");"selected"===a?this.show():this.hide()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../view_helpers/pluralize_string":111}],63:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("../import_default_view"),f=a("../../../../../background_polling/models/upload_model"),g=a("./service_header_view"),h=a("./service_loader_view"),i=a("./service_list_view"),j=a("../import_selected_dataset_view"),k=a("../../../../../service_models/service_token_model"),l=a("../../../../../service_models/service_oauth_model"),m=a("./service_items_collection");b.exports=e.extend({_DATASOURCE_NAME:"",_WINDOW_INTERVAL:1e3,className:"ImportPanel ImportPanelService",options:{service:"",showAvailableFormats:!1,fileExtensions:[],acceptSync:!1,fileAttrs:{ext:!1,title:"filename",description:"<%- size %>",formatDescription:"size",headerTemplate:""}},initialize:function(){return this.options.service?(this._DATASOURCE_NAME=this.options.service,this.user=this.options.user,this.model=new f({type:"service",service_name:this._DATASOURCE_NAME},{user:this.user}),this.template=d.templates.getTemplate("common/views/create/listing/import_types/import_service"),this._initModels(),void this._initBinds()):(d.log.info("Service provider not set for import panel!"),!1)},render:function(){return this.clearSubViews(),this.$el.html(this.template(this.options)),this._initViews(),this},_initModels:function(){this.token=new k(null,{datasource_name:this._DATASOURCE_NAME}),this.service=new l(null,{datasource_name:this._DATASOURCE_NAME}),this.collection=new m(null,{datasource_name:this._DATASOURCE_NAME})},_initBinds:function(){this.model.bind("change",this._triggerChange,this),this.model.bind("change:state",this._checkState,this),this.token.bind("change:oauth_valid",this._onOauthChange,this),this.service.bind("change:url",this._openWindow,this),this.add_related_model(this.service),this.add_related_model(this.token)},_initViews:function(){var a=new g({el:this.$(".ImportPanel-header"),user:this.user,model:this.model,collection:this.collection,title:this.options.title,showAvailableFormats:this.options.showAvailableFormats,fileExtensions:this.options.fileExtensions,acceptSync:this.options.acceptSync,template:this.options.headerTemplate});a.render(),this.addView(a);var b=new h({el:this.$(".ServiceLoader"),model:this.model,token:this.token,service:this.service});b.render(),this.addView(b);var c=new i({el:this.$(".ServiceList"),model:this.model,collection:this.collection,title:this.options.title,fileAttrs:this.options.fileAttrs});c.render(),this.addView(c);var d=new j({el:this.$(".ServiceSelected"),user:this.user,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs});d.render(),this.addView(d)},_onOauthChange:function(){this.token.get("oauth_valid")&&this._getFiles()},_getFiles:function(){var a=this;this.model.set("state","retrieving"),this.collection.fetch({error:function(){a.model.set("state","error")},success:function(){a.model.set("state","list")}})},_checkState:function(){if("list"===this.model.get("state")&&1===this.collection.size()){var a=this.collection.at(0);this.model.set({state:"selected",value:a.toJSON(),service_item_id:a.get("id")})}"selected"!==this.model.get("state")&&this.model.set({value:"",service_item_id:"",interval:0})},_openWindow:function(){var a=this.service.get("url"),b=this,c=window.open(a,null,"menubar=no,toolbar=no,width=600,height=495"),d=window.setInterval(function(){c&&c.closed?(b._getFiles(),clearInterval(d)):c||(b.model.set("state","error"),clearInterval(d))},this._WINDOW_INTERVAL)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../../background_polling/models/upload_model":14,"../../../../../service_models/service_oauth_model":103,"../../../../../service_models/service_token_model":104,"../import_default_view":61,"../import_selected_dataset_view":62,"./service_header_view":64,"./service_items_collection":67,"./service_list_view":69,"./service_loader_view":70}],64:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{"click .js-back":"_goToList"},options:{title:"Service",showAvailableFormats:!1,acceptSync:!1,fileExtensions:[],template:""},initialize:function(){this.user=this.options.user,this.template=c.templates.getTemplate(this.options.template||"common/views/create/listing/import_types/service_header"),this._initBinds()},render:function(){return this.$el.html(this.template({items:this.collection.size(),service_name:this.model.get("service_name"),showAvailableFormats:this.options.showAvailableFormats,fileExtensions:this.options.fileExtensions,acceptSync:this.options.acceptSync&&this.user.get("actions").sync_tables,state:this.model.get("state"),title:this.options.title})),this._checkVisibility(),this},_initBinds:function(){this.model.bind("change:state",this.render,this)},_checkVisibility:function(){var a=this.model.get("state");this["list"!==a?"show":"hide"]()},_goToList:function(){this.model.set("state","list")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],65:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof a?a.cdb.Utils:null;b.exports={formatSize:function(a){return a&&a>0?c.readablizeBytes(a):"Unknown"}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],66:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({defaults:{id:"",filename:"",checksum:"",service:"",size:"",title:""}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],67:[function(a,b,c){(function(c){var d=a("./service_item_model.js"),e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null;b.exports=e.Collection.extend({_DATASOURCE_NAME:"dropbox",model:d,initialize:function(a,b){b.datasource_name&&(this._DATASOURCE_NAME=b.datasource_name)},fetch:function(){return this.trigger("fetch",this),e.Collection.prototype.fetch.apply(this,arguments)},parse:function(a){return a.files},url:function(a){var b=cdb.config.urlVersion("imports_service",a);return"/api/"+b+"/imports/service/"+this._DATASOURCE_NAME+"/list_files"}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./service_item_model.js":66}],68:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,f=a("./service_item_description_format"),g=a("../../../../../view_helpers/pluralize_string");b.exports=d.core.View.extend({options:{title:"",fileAttrs:{ext:!1,title:"filename",description:"size",itemName:"file",formatDescription:""}},_FORMATTERS:{size:f.formatSize,number:e.formatNumber},className:"ServiceList-item",tagName:"li",events:{"click .js-choose":"_onSelectItem"},initialize:function(){this.template=d.templates.getTemplate("common/views/create/listing/import_types/service_list_item")},render:function(){var a=this.model.get(this.options.fileAttrs.title),b=this._genDescription(),c=this.options.fileAttrs.ext?e.getFileExtension(a):"";return this.options.fileAttrs.ext&&(a=a&&a.replace("."+c,"")),this.$el.html(this.template({name:this.options.title,ext:c,title:a,description:b})),this},_genDescription:function(){if(this.options.fileAttrs&&this.options.fileAttrs.description){var a=this.options.fileAttrs.description,b="",c="",d=this;return a.content&&a.content.length>0&&_.each(a.content,function(e,f){f>0&&a.separator&&(c+=" "+a.separator+" ");var g=d.model.get(e.name),h=e.format&&d._FORMATTERS[e.format];c+=h&&h(g)||g,e.key&&(b=e.name)}),a.itemName&&b&&(c+=" "+(a.itemName&&g(a.itemName,b)||"")),c}return""},_onSelectItem:function(){this.trigger("selected",this.model,this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../../view_helpers/pluralize_string":111,"./service_item_description_format":65}],69:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./service_list_item_view"),f=a("../../../../../view_helpers/pluralize_string");b.exports=d.core.View.extend({_TEXTS:{item:_t("item")},options:{title:"service",fileAttrs:{}},initialize:function(){this.template=d.templates.getTemplate("common/views/create/listing/import_types/service_list"),this._initBinds(),this._checkVisibility()},render:function(){this.clearSubViews();var a=this.collection.size();return this.$el.html(this.template({size:a,title:this.options.title,pluralize:f(this._TEXTS.item,a)})),this.collection.size()>0&&this.collection.each(this._addItem,this),this},_initBinds:function(){this.collection.bind("reset",this.render,this),this.model.bind("change:state",this._checkVisibility,this),this.add_related_model(this.collection)},_addItem:function(a){var b=new e({model:a,title:this.options.title,fileAttrs:this.options.fileAttrs});b.bind("selected",this._onSelectedItem,this),this.$(".ServiceList-items").append(b.render().el),this.addView(b)},_onSelectedItem:function(a){this.model.set({state:"selected",value:a.toJSON(),service_item_id:a.get("id")})},_checkVisibility:function(){var a=this.model.get("state");"list"===a?this.show():this.hide()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../../view_helpers/pluralize_string":111,"./service_list_item_view":68}],70:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{"click .js-connect":"_checkToken"},initialize:function(){this.token=this.options.token,this.service=this.options.service,this.template=c.templates.getTemplate("common/views/create/listing/import_types/service_loader"),this._initBinds(),this._checkVisibility()},render:function(){return this.$el.html(this.template({state:this.model.get("state")})),this},_initBinds:function(){this.model.bind("change:state",this.render,this),this.model.bind("change:state",this._checkVisibility,this)},_checkToken:function(){var a=this;this.model.set("state","token");var a=this;this.token.fetch({success:function(b){b.get("oauth_valid")||a._getOauthURL()},error:function(b){a._getOauthURL()}})},_checkVisibility:function(){var a=this.model.get("state");"list"!==a&&"selected"!==a?this.show():this.hide()},_getOauthURL:function(){var a=this;this.model.set("state","oauth"),this.service.set({url:""},{silent:!0}),this.service.fetch({
error:function(){a.model.set("state","error")}})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],71:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;c.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof a?a.cdb.admin:null;var d="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof a?a.cdb.Utils:null;b.exports=c.core.View.extend({initialize:function(){this.user=this.options.user,this._initBinds(),this.template=c.templates.getTemplate("common/views/create/listing/import_types/credits_info")},render:function(){var a=this.user.get("twitter"),b=a.quota-a.monthly_use,c=Math.min(100,Math.ceil(100*this.model.get("value")/b));return this.$el.html(this.template({value:this.model.get("value"),remaining:b,per:c,hardLimit:a.hard_limit,remainingFormatted:d.formatNumber(b),quota:a.quota,block_price:a.block_price,block_size:d.readizableNumber(a.block_size)})),this},_initBinds:function(){this.model.bind("change",this.render,this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],72:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("./credits_info_view");b.exports=d.core.View.extend({_DEFAULT_PER_VALUE:80,_MIN_PER_VALUE:1,initialize:function(){this.user=this.options.user,this.model=new d.core.Model,this._initBinds(),this._setModel()},render:function(){return this.clearSubViews(),this.$(".js-slider").slider("destroy"),this._initViews(),this},_initBinds:function(){_.bindAll(this,"_onSlideChange"),this.model.bind("change:value",this._onValueChange,this)},_setModel:function(){var a=this.user.get("twitter"),b=a.quota-a.monthly_use,c=this._MIN_PER_VALUE*b/100,d=b*this._DEFAULT_PER_VALUE/100,e=b>0?d:b+1;this.model.set({max:a.hard_limit?b:b+1,min:c,step:c,value:b>0?e:a.quota,disabled:!(b>0)})},_initViews:function(){this.$(".js-slider").slider(_.extend({range:"min",orientation:"horizontal",slide:this._onSlideChange,change:this._onSlideChange},this.model.attributes));var a=new e({el:this.$(".js-info"),user:this.user,model:this.model});a.render(),this.addView(a)},_onSlideChange:function(a,b){this.model.set("value",b.value)},_onValueChange:function(){this.trigger("maxCreditsChange",this.getMaxCredits(),this)},getMaxCredits:function(){var a=this.user.get("twitter"),b=a.quota-a.monthly_use,c=this.model.get("value");return c>b?0:c}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./credits_info_view":71}],73:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../../../../../dialogs/create/listing/imports/import_default_view"),g=a("../../../../../background_polling/models/upload_model"),h=a("../../../../../views/date_pickers/dates_range_picker"),i=a("../../../../../dialogs/create/listing/imports/twitter_import/twitter_categories/twitter_categories_view"),j=a("./credits_usage_view.js");b.exports=f.extend({options:{acceptSync:!1,type:"service",service:"twitter_search"},className:"ImportPanel ImportTwitterPanel",initialize:function(){this.user=this.options.user,this.model=new g({type:this.options.type,service_name:this.options.service},{user:this.user}),this.template=d.templates.getTemplate("common/views/create/listing/import_types/import_twitter"),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(this.template()),this._initViews(),this},_initViews:function(){var a=this.categories=new i;a.bind("changeCategory",this._setModel,this),this.$(".ImportTwitterPanel-cagetories").append(a.render().el),this.addView(a);var b=this.datepicker=new h({className:"DatePicker DatePicker--withBorder"});b.bind("changeDate",this._setModel,this),this.$(".js-picker").append(b.render().el),this.addView(b);var c=this.creditsUsage=new j({el:this.$(".CreditsUsage"),user:this.user});c.bind("maxCreditsChange",this._setModel,this),c.render(),this.addView(c),this._setModel()},_initBinds:function(){this.model.bind("change",this._triggerChange,this)},_getCategories:function(){var a=this.categories.getCategories();return e.filter(a,function(a){return a.category&&a.terms.length>0})},_getDates:function(){return this.datepicker.getDates()},_getMaxCredits:function(){return this.creditsUsage.getMaxCredits()},_setModel:function(){var a=this._getCategories(),b=this._getDates(),c=this._getMaxCredits(),d={categories:a,dates:b};this.model.set({value:d,service_item_id:d,user_defined_limits:{twitter_credits_limit:c}})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../../background_polling/models/upload_model":14,"../../../../../dialogs/create/listing/imports/import_default_view":61,"../../../../../dialogs/create/listing/imports/twitter_import/twitter_categories/twitter_categories_view":75,"../../../../../views/date_pickers/dates_range_picker":124,"./credits_usage_view.js":72}],74:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,e=a("./twitter_category_model");b.exports=d.Collection.extend({model:e})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./twitter_category_model":76}],75:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("./twitter_categories_collection"),f=a("./twitter_category_model"),g=a("./twitter_category_view");b.exports=d.core.View.extend({_MAX_CATEGORIES:4,_MAX_TERMS:29,initialize:function(){var a=this._generateCategory();this.collection=new e([a]),this._initBinds()},render:function(){return this.clearSubViews(),this.collection.each(this._addCategory,this),this},_initBinds:function(){this.collection.bind("change",this._manageCategories,this),this.collection.bind("change",this._onCategoryChange,this),this.add_related_model(this.collection)},_manageCategories:function(){var a=this.collection.size(),b=this.collection.filter(function(a){return 0===a.get("terms").length});if(0===b.length&&a<this._MAX_CATEGORIES){var c=this._generateCategory();return this.collection.add(c),this._addCategory(c),!1}if(b.length>0){var c=_.first(b),d=_.find(this._subviews,function(a){return c.cid===a.model.cid}),e=d.$el.index();if(1===a)return!1;if(e===a-1)return!1;e!==a-1&&b.length>1&&(c=b[1],d=_.find(this._subviews,function(a){return c.cid===a.model.cid}),this._removeCategory(d)),this._setCategoryIndex()}},_setCategoryIndex:function(){var a=this;this.$(".twitter-category").each(function(b,c){var d=$(c).find(".js-category").text().replace("Category ","");if(d!==b+1){var e=a.collection.find(function(a){return a.get("category")===d});e.set("category",(b+1).toString())}})},_generateCategory:function(){return new f({terms:[],category:(this.collection?this.collection.size()+1:1).toString()})},_addCategory:function(a){var b=new g({model:a});b.bind("submit",this._onCategorySubmit,this),b.bind("limit",this._onCategoryLimit,this),b.bind("nolimit",this._onCategoryNoLimit,this),this.$el.append(b.render().el),this.addView(b),this.trigger("addCategory")},_removeCategory:function(a){a.hide(),a.clean(),a.model.destroy(),this.trigger("removeCategory")},_onCategorySubmit:function(){this.trigger("submitCategory",this.collection.toJSON(),this)},_onCategoryLimit:function(){this.trigger("limitCategory",this.collection.toJSON(),this)},_onCategoryNoLimit:function(){this.trigger("noLimitCategory",this.collection.toJSON(),this)},_onCategoryChange:function(){this.trigger("changeCategory",this.collection.toJSON(),this)},getCategories:function(){return this.collection.toJSON()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./twitter_categories_collection":74,"./twitter_category_model":76,"./twitter_category_view":77}],76:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({_MAX_COUNTER:1014,_CHAR_MAP:{" ":2,"-":2,_:2,".":2},defaults:{terms:[],category:"",counter:1014},initialize:function(){this._initBinds()},_initBinds:function(){this.bind("change:terms",this._setCounter,this)},_setCounter:function(){var a=this._MAX_COUNTER,b=this;this.get("terms").length>1&&(a-=4*(this.get("terms").length-1)),_.each(this.get("terms"),function(c){_.each(c,function(c){void 0!==b._CHAR_MAP[c]?a-=b._CHAR_MAP[c]:a--})}),this.set("counter",Math.max(0,a))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],77:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({className:"TwitterCategory",_MAX_CATEGORIES:4,_MAX_TERMS:29,events:{"keydown .js-terms":"_onInputChange","keypress .js-terms":"_onInputChange","keyup .js-terms":"_onInputChange"},initialize:function(){this.template=c.templates.getTemplate("common/views/create/listing/import_types/twitter_category"),this._initBinds()},render:function(){return this.$el.append(this.template({terms:this.model.get("terms"),category:this.model.get("category"),counter:this.model.get("counter")})),this.show(),this},_initBinds:function(){_.bindAll(this,"_onInputChange"),this.model.bind("change:category",this._onCategoryChange,this)},_onCategoryChange:function(){this.$(".js-category").text("Category "+this.model.get("category"))},_onInputChange:function(a){var b=$(a.target).val();if(13===a.keyCode)return a.preventDefault(),this.trigger("submit",this.model,this),!1;if(this.$(".CDB-IconFont-twitter")[b.length>0?"addClass":"removeClass"]("is-highlighted"),(0===this.model.get("counter")||this.model.get("terms").length>this._MAX_TERMS)&&37!==a.keyCode&&39!==a.keyCode&&8!==a.keyCode&&b.length>0)return this.killEvent(a),this.trigger("limit",this.model,this),!1;this.trigger("nolimit",this.model,this);var c=$(a.target),b=c.val(),d={};b=b?b.split(","):[],d.terms=b,this.model.set(d)},show:function(){this.$el.addClass("enabled")},hide:function(){this.$el.removeClass("enabled")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],78:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("./import_options"),f=a("./imports/import_default_fallback_view"),g="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null;b.exports=d.core.View.extend({className:"ImportOptions",_TABS_PER_ROW:5,_DEFAULT_IMPORT:"file",_IMPORT_OPTIONS:e,_TEXTS:{key:_t("<%- name %> key is not specified and panel can't be enabled"),account:_t("<%- name %> data source is not available in your plan. Please upgrade"),limits:_t("You've reached the limits for your account. Please upgrade"),credits:_t("You've reached the available <%- name %> credits for your account this month")},events:{"click .js-goNext":"_moveNextTabs","click .js-goPrev":"_movePrevTabs"},initialize:function(){this.user=this.options.user,this.model=new d.core.Model({page:1,maxPages:0}),this.createModel=this.options.createModel,this.template=d.templates.getTemplate("common/views/create/listing/import_view")},render:function(){return this._destroyBinds(),this.clearSubViews(),this.$el.empty(),this.$el.append(this.template()),this._genTabs(),this._genTabsNavigation(),this._genPanes(),this._initBinds(),this._setOption(),this},_genTabs:function(){var a="",b=d.templates.getTemplate("common/views/create/listing/import_tab");g.each(this._IMPORT_OPTIONS,function(c){!g.isEmpty(c)&&c.enabled(d.config,this.user_data)&&(a+=b(c))}),this.$(".ImportOptions-tabsList").append(a),this.importTabs=new d.admin.Tabs({el:this.$(".ImportOptions-tabsList"),slash:!0}),this.addView(this.importTabs)},_genTabsNavigation:function(){var a=this.$(".ImportOptions-tab").size();a<=1&&this.$(".ImportOptions-tabs").hide(),this.model.set("maxPages",Math.ceil(a/this._TABS_PER_ROW)),this._checkTabsNavigation(),this.model.get("maxPages")<=1&&this.$(".ImportOptions-navigation").hide()},_moveNextTabs:function(){var a=this.model.get("page"),b=this.model.get("maxPages");a<b&&this.model.set("page",a+1)},_movePrevTabs:function(){var a=this.model.get("page");a>1&&this.model.set("page",a-1)},_moveTabsNavigation:function(){var a=this.model.get("page"),b=800;this.$(".ImportOptions-tabsList").css("margin-left","-"+b*(a-1)+"px"),this._checkTabsNavigation()},_checkTabsNavigation:function(){var a=this.model.get("page"),b=this.model.get("maxPages");this.$(".js-goPrev")[a>1?"removeClass":"addClass"]("is-disabled"),this.$(".js-goNext")[a<b?"removeClass":"addClass"]("is-disabled")},_genPanes:function(){var a=this;this.importPanes=new d.ui.common.TabPane({el:this.$(".ImportOptions-panes")}),this.addView(this.importPanes),this.importTabs.linkToPanel(this.importPanes),g.each(this._IMPORT_OPTIONS,function(b,c){var d="",e=a["_check"+c+"Import"],h=e&&e(b,a);!h&&void 0!==h||g.isEmpty(b)?b.fallback&&(d=new f({template:b.fallback})):d=new b.className(g.extend(b.options||{},{user:a.user,title:b.title})),d&&(d.render(),d.bind("change",a._setUploadModel,a),a.importPanes.addTab(b.name,d),a.addView(d))})},_checkGDriveImport:function(a,b){return!!d.config.get("oauth_gdrive")||(b._setFailedTab("gdrive","key"),!1)},_checkDropboxImport:function(a,b){return!!d.config.get("oauth_dropbox")||(b._setFailedTab("dropbox","key"),!1)},_checkBoxImport:function(a,b){return!!d.config.get("oauth_box")||(b._setFailedTab("box","key"),!1)},_checkTwitterImport:function(a,b){return d.config.get("datasource_search_twitter")?!!b.user.get("twitter").enabled&&(!(b.user.get("twitter").quota-b.user.get("twitter").monthly_use<=0&&b.user.get("twitter").hard_limit)||(b._setFailedTab("twitter","credits"),!1)):(b._setFailedTab("twitter","key"),!1)},_checkInstagramImport:function(a,b){return!!b.user.featureEnabled("instagram_import")&&(!!d.config.get("oauth_instagram")||(b._setFailedTab("instagram","key"),!1))},_checkSalesforceImport:function(a,b){return!!b.user.get("salesforce").enabled},_checkMailchimpImport:function(a,b){return d.config.get("oauth_mailchimp")?!!b.user.featureEnabled("mailchimp_import"):(b._setFailedTab("mailchimp","key"),!1)},_setFailedTab:function(a,b){var c=this.importTabs.getTab(a);c.addClass("disabled"),this._createTooltip(a,b)},_createTooltip:function(a,b){var c=this,e=this.importTabs.getTab(a),f=new d.common.TipsyTooltip({el:e,title:function(){return g.template(c._TEXTS[b])({name:a})}});this.addView(f)},_setUploadModel:function(a){this.createModel.upload.setFresh(a)},_initBinds:function(){this.model.bind("change:page",this._moveTabsNavigation,this),this.importPanes&&this.importPanes.bind("tabEnabled",this._onTabChange,this)},_destroyBinds:function(){this.importPanes&&this.importPanes.unbind("tabEnabled",null,this)},_setOption:function(){this.importPanes.active(this._DEFAULT_IMPORT),this._updateImportOption()},_updateImportOption:function(){this.createModel.setActiveImportPane(this.importPanes.activeTab)},_onTabChange:function(a){var b=this.importPanes.getPane(a),c=b.getModelData&&b.getModelData();c?this._setUploadModel(c):this._setUploadModel({}),this._updateImportOption()},clean:function(){this._destroyBinds(),d.core.View.prototype.clean.call(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./import_options":54,"./imports/import_default_fallback_view":60}],79:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,g=a("../../../view_helpers/pluralize_string");b.exports=d.core.View.extend({events:{"submit .js-search-form":"_submitSearch","keydown .js-search-form":"_onSearchKeyDown","click .js-search-form":"killEvent","click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","click .js-shared":"_onSharedClick","click .js-library":"_onLibraryClick","click .js-connect":"_onConnectClick","click .js-datasets":"_onDatasetsClick","click .js-create_empty":"_onCreateEmptyClick"},_TEXTS:{createFromScratchLabel:{map:"Create empty map",dataset:"Create empty dataset",addLayer:"Add an empty layer"}},initialize:function(){this.routerModel=this.options.routerModel,this.createModel=this.options.createModel,this.user=this.options.user,this.template=d.templates.getTemplate("common/views/create/listing/navigation"),this.model=new d.core.Model,this._preRender(),this._initBinds()},_preRender:function(){var a=$("<div>").addClass("u-inner"),b=$("<div>").addClass("Filters-inner");this.$el.append(a.append(b))},render:function(a,b){this.clearSubViews();var c=this._selectedItems().length,d=b&&b.changes&&b.changes.content_type,f=this.createModel.get("type");return this.$(".Filters-inner").html(this.template(e.extend({createModel:this.createModel,canCreateDataset:this.user.canCreateDatasets(),listing:this.createModel.get("listing"),isInsideOrg:this.user.isInsideOrg(),selectedItemsCount:c,maxLayersByMap:this.user.getMaxLayers(),totalShared:d?0:this.collection.total_shared,totalItems:d?0:this.collection.total_user_entries,pageItems:this.collection.size(),routerModel:this.routerModel,pluralizedContentType:g("dataset",d?0:this.collection.total_user_entries),pluralizedContentTypeSelected:g("dataset",c),createFromScratchLabel:this._TEXTS.createFromScratchLabel[f]},this.routerModel.attributes))),this._animate(),this.routerModel.isSearching()&&this._focusSearchInput(),this},_initBinds:function(){this.model.on("change:isSearchEnabled",this._onChangeIsSearchEnabled,this),this.createModel.bind("change:listing",this.render,this),this.routerModel.bind("change",this.render,this),this.collection.bind("reset",this.render,this),d.god.bind("closeDialogs",this._animate,this),this.add_related_model(d.god),this.add_related_model(this.createModel),this.add_related_model(this.collection),this.add_related_model(this.routerModel)},_onChangeIsSearchEnabled:function(a,b){this._enableSearchUI(b),this.routerModel.isSearching()?this._cleanSearch():b&&(this._$searchInput().val(""),this._focusSearchInput())},_$searchInput:function(){return this.$(".js-search-input")},_focusSearchInput:function(){this._$searchInput().select().focus()},_onSearchKeyDown:function(a){27===a.keyCode&&(this.killEvent(a),this._cleanSearch())},_selectedItems:function(){return this.collection.where({selected:!0})},_animate:function(){this._enableSearchUI(!!this.routerModel.isSearching());var a=this.routerModel.get("library"),b="datasets"===this.createModel.get("listing"),c=this.collection.total_user_entries>0;this.$el.toggleClass("no-shadow",a&&!c&&b)},_enableSearchUI:function(a){this.$(".js-search-field").toggle(a),this.$(".js-links-list").toggleClass("is-hidden",a),this.$(".js-order-list").toggleClass("is-hidden",a)},_onDatasetsClick:function(){this.routerModel.set({shared:"no",library:!1,page:1}),this.createModel.set("listing","datasets")},_onSharedClick:function(){this.routerModel.set({shared:"only",library:!1,page:1}),this.createModel.set("listing","datasets")},_onLibraryClick:function(){this.routerModel.set({shared:"no",library:!0,page:1}),this.createModel.set("listing","datasets"),d.god.trigger("metrics","common_data",{email:window.user_data.email})},_onConnectClick:function(){this.user.canCreateDatasets()&&this.createModel.set("listing","import")},_onCreateEmptyClick:function(){this.user.canCreateDatasets()&&this.createModel.createFromScratch()},_onSearchClick:function(a){a&&this.killEvent(a),this.model.set("isSearchEnabled",!this.model.get("isSearchEnabled"))},_onCleanSearchClick:function(a){a&&a.preventDefault(),this._cleanSearch()},_cleanSearch:function(){this.routerModel.set({q:"",tag:"",shared:"no",library:this.createModel.showLibrary()}),this.model.set("isSearchEnabled",!1)},_submitSearch:function(a){a&&this.killEvent(a);var b=f.stripHTML(this.$(".js-search-input").val().trim(),""),c=0===b.search(":")?b.replace(":",""):"",d=0!==b.search(":")?b:"";this.routerModel.set({page:1,tag:c,q:d,shared:"yes"}),this.createModel.set("listing","datasets")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_helpers/pluralize_string":111}],80:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../views/base_dialog/view"),f=a("../view_helpers/pluralize_string"),g=a("../view_helpers/random_quote"),h=a("../views/mapcard_preview"),i="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,j="undefined"!=typeof window?window.moment:"undefined"!=typeof c?c.moment:null,k=3,l=3;b.exports=e.extend({initialize:function(){if(this.elder("initialize"),!this.options.viewModel)throw new TypeError("viewModel is required");if(!this.options.user)throw new TypeError("user is required");this._viewModel=this.options.viewModel,this._viewModel.loadPrerequisites(),this._viewModel.bind("change",function(){"DeleteItemsDone"===this._viewModel.state()?this.close():this.render()},this),this.add_related_model(this._viewModel)},render:function(){return e.prototype.render.call(this),this._loadMapPreviews(),this},render_content:function(){return this["_render"+this._viewModel.state()]()},_renderLoadingPrerequisites:function(){return d.templates.getTemplate("common/templates/loading")({title:"Checking what consequences deleting the selected "+this._pluralizedContentType()+" would have...",quote:g()})},_renderLoadPrerequisitesFail:function(){return d.templates.getTemplate("common/templates/fail")({msg:"Failed to check consequences of deleting the selected "+this._pluralizedContentType()})},_renderConfirmDeletion:function(){var a=this._viewModel.affectedEntities(),b=this._viewModel.affectedVisData();return d.templates.getTemplate("common/dialogs/delete_items_view_template")({firstItemName:this._getFirstItemName(),selectedCount:this._viewModel.length,isDatasets:this._viewModel.isDeletingDatasets(),pluralizedContentType:this._pluralizedContentType(),affectedEntitiesCount:a.length,affectedEntitiesSample:a.slice(0,k),affectedEntitiesSampleCount:k,affectedVisCount:b.length,pluralizedMaps:f("map",b.length),affectedVisVisibleCount:l,visibleAffectedVis:this._prepareVisibleAffectedVisForTemplate(b.slice(0,l))})},_prepareVisibleAffectedVisForTemplate:function(a){return a.map(function(a){var b=new d.admin.Visualization(a),c=b.permission.owner;return{visId:b.get("id"),name:b.get("name"),url:b.viewUrl(this.options.user).edit(),owner:c,ownerName:c.get("username"),isOwner:b.permission.isOwner(this.options.user),showPermissionIndicator:!b.permission.hasWriteAccess(this.options.user),timeDiff:j(b.get("updated_at")).fromNow()}},this)},ok:function(){this._viewModel.deleteItems(),this.render()},_loadMapPreviews:function(){var a=this;this.$el.find(".MapCard").each(function(){var b=i(this).data("visOwnerName"),c=new h({el:i(this).find(".js-header"),width:298,height:130,mapsApiResource:d.config.getMapsResourceName(b),visId:i(this).data("visId"),username:b}).load();a.addView(c)})},_renderDeletingItems:function(){return d.templates.getTemplate("common/templates/loading")({title:"Deleting the selected "+this._pluralizedContentType()+"...",quote:g()})},_renderDeleteItemsFail:function(){var a=this._viewModel.errorMessage().replace(/\n/g,"<br>");return"something failed"===a&&(a=""),d.templates.getTemplate("common/templates/fail")({msg:"Failed to delete the selected "+this._pluralizedContentType()+". "+a})},_pluralizedContentType:function(){return f(this._viewModel.isDeletingDatasets()?"dataset":"map",this._viewModel.length)},_getFirstItemName:function(){if(this.options.viewModel){var a=this.options.viewModel.at(0);return a?a.get("name"):void 0}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../view_helpers/pluralize_string":111,"../view_helpers/random_quote":112,"../views/base_dialog/view":113,"../views/mapcard_preview":127}],81:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,e=a("../../common/batch_process_items");b.exports=d.Collection.extend({initialize:function(a,b){if(!b.contentType)throw new TypeError("contentType is required");this._contentType=b.contentType},state:function(){return this._state},errorMessage:function(){return this._errorMessage},setState:function(a){this._state=a,this.trigger("change"),this.trigger(a)},isDeletingDatasets:function(){return"datasets"===this._contentType},loadPrerequisites:function(){var a=this.setState.bind(this,"ConfirmDeletion");this.isDeletingDatasets()?(this.setState("LoadingPrerequisites"),e({howManyInParallel:5,items:this.toArray(),processItem:this._loadPrerequisitesForModel,done:a,fail:this.setState.bind(this,"LoadPrerequisitesFail")})):a()},affectedEntities:function(){return this.chain().map(function(a){return a.sharedWithEntities()}).flatten().compact().value()},affectedVisData:function(){var a=this.chain().map(function(a){var b=a.tableMetadata();return[].concat(b.get("dependent_visualizations")).concat(b.get("non_dependent_visualizations"))}).flatten().compact().value();return _.uniq(a,function(a){return a.id})},deleteItems:function(){this.setState("DeletingItems"),e({howManyInParallel:1,items:this.toArray(),processItem:this._deleteItem,done:this.setState.bind(this,"DeleteItemsDone"),fail:this._deletionFailed.bind(this)})},_deletionFailed:function(a){this._errorMessage=a,this.setState("DeleteItemsFail")},_loadPrerequisitesForModel:function(a,b){var c=a.tableMetadata();c.no_data_fetch=!0,c.fetch({wait:!0,success:function(){b()},error:function(a,c){b(c.responseText)}})},_deleteItem:function(a,b){a.destroy({wait:!0}).done(function(){b()}).fail(function(a){var c;try{c=JSON.parse(a.responseText).errors.join("; ")}catch(a){c="something failed"}b(c)})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/batch_process_items":23}],82:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../views/base_dialog/view"),g=a("../view_factory"),h=a("../view_helpers/random_quote"),i=a("../views/error_details_view");b.exports=f.extend({initialize:function(){if(this.elder("initialize"),!this.model)throw new Error("model is required (cdb.admin.Visualization)");if(!this.options.user)throw new Error("user is required");this.elder("initialize"),this._initViews(),this._initBinds(),this._duplicateMap()},render_content:function(){return this._panes.getActivePane().render().el},_initViews:function(){this._panes=new d.ui.common.TabPane({el:this.el}),this.addView(this._panes),this._panes.addTab("loading",g.createByTemplate("common/templates/loading",{title:"Duplicating your map",quote:h()})),this._panes.active("loading")},_initBinds:function(){this._panes.bind("tabEnabled",this.render,this)},_duplicateMap:function(a){var b=this,a=this.model.get("name")+" copy";this.model.copy({name:a},{success:function(a){b._redirectTo(a.viewUrl(b.options.user).edit().toString())},error:b._showError.bind(b)})},_showError:function(a){var b;try{var c=e.clone(a.attributes);b=new i({err:e.extend(c,a.attributes.get_error_text),user:this.options.user})}catch(a){b=g.createByTemplate("common/templates/fail",{msg:"Sorry, something went wrong, but we're not sure why."})}this._panes.addTab("fail",b.render()),this._panes.active("fail")},_redirectTo:function(a){window.location=a}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../view_factory":108,"../view_helpers/random_quote":112,"../views/base_dialog/view":113,"../views/error_details_view":125}],83:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,g=a("cartodb-pecan");b.exports=d.core.View.extend({_CARD_WIDTH:288,_CARD_HEIGHT:170,_TABS_PER_ROW:3,_GET_BBOX_FROM_THE_GEOM:!0,tagName:"li",className:"GalleryList-item MapsList-item js-card",events:{"click ":"_onClick"},initialize:function(){this.template=d.templates.getTemplate("common/dialogs/pecan/card")},render:function(){var a=this.options.url+"?api_key="+this.options.api_key,b=this.model.get("visualizationType").charAt(0).toUpperCase()+this.model.get("visualizationType").slice(1),c=+(this.model.get("null_ratio")*this.model.get("count")).toFixed(2),e=f.formatNumber(c);this.$el.html(this.template({column:this.model.get("column"),wizard:b,metadata:this.model.get("metadata"),null_count:e,weight:this.model.get("weight")})),"choropleth"===this.model.get("visualizationType")&&this._addHistogram();var g=this,h=new Image;return h.onerror=function(){d.log.info("error loading the image for "+g.model.get("column"))},h.onload=function(){g.$(".js-loader").hide(),g.$(".js-header").append('<img class="MapCard-preview" src="'+a+'" />'),g.$("img").show()},h.src=a,this},_onClick:function(a){this.killEvent(a),this.trigger("click",this.model,this)},_addHistogram:function(){var a=this.model.get("cat_hist").slice(0,7);a=e.sortBy(a,function(a){return a[0]});var b=g.getMethodProperties(this.model.attributes).name,c=37,h=11,i=2,j=d3.scale.ordinal().rangeRoundBands([0,c],.1),k=d3.scale.linear().range([h,0]),l=d3.svg.axis().scale(j).orient("bottom"),m=d3.select(this.$(".js-graph")[0]).append("svg").attr("width",c).attr("height",h).append("g");return j.domain(a.map(function(a){return a[0]})),k.domain([0,d3.max(a,function(a){return a[1]})]),m.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")").call(l),m.selectAll(".bar").data(a).enter().append("rect").attr("fill",function(a,c){return d.admin.color_ramps[b][7][c]}).attr("class","HistogramGraph-bar").attr("data-title",function(a){return f.formatNumber(a[1])}).attr("x",function(a){return j(a[0])}).attr("width",4).attr("y",function(a){var b=h-k(a[1]),c=k(a[1]);return b<i?h-i:c}).attr("height",function(a){var b=h-k(a[1]);return b<i?i:b}),this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"cartodb-pecan":163}],84:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=("undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,a("cartodb-pecan")),f=a("../../views/base_dialog/view"),g=a("../../view_factory"),h=a("../../view_helpers/random_quote"),i=a("./pecan_card");b.exports=f.extend({_CARD_MARGIN:20,_CARD_WIDTH:288,_CARD_HEIGHT:170,_STROKE_PX_LIMIT:.04,_TABS_PER_ROW:3,_GET_BBOX_FROM_THE_GEOM:!0,_DEFAULT_BASEMAP_TEMPLATE:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",_SUPPORTED_BASEMAPS:["light_all","dark_all","light_nolabels","dark_nolabels","base-antique","base-flatblue","toner","watercolor"],events:f.extendEvents({"click .js-goPrev":"_prevPage","click .js-goNext":"_nextPage","click .js-skip":"cancel"}),initialize:function(){if(this.elder("initialize"),!this.options.vis)throw new Error("vis is required");if(!this.options.user)throw new Error("user is required");
this.columns=this.options.collection,this.add_related_model(this.collection),this._initModels(),this._initViews(),this._initBinds()},render_content:function(){return this._panes.getActivePane().render().el},render:function(){return f.prototype.render.apply(this,arguments),this},_initModels:function(){this.model=new d.core.Model({page:1,maxPages:0})},_initViews:function(){_.bindAll(this,"_addCard","_generateThumbnail","_refreshMapList","_setWizardProperties"),this.vis=this.options.vis,this.map=this.vis.map,this.user=this.options.user,this._panes=new d.ui.common.TabPane({el:this.el}),this.addView(this._panes),this._panes.addTab("vis",g.createByTemplate("common/dialogs/pecan/template",{})),this._panes.addTab("applying",g.createByTemplate("common/templates/loading",{title:"Applying style…",quote:h()})),this._panes.addTab("loading",g.createByTemplate("common/templates/loading",{title:"Loading previews…",quote:h()})),this._getBBox(),this._sendOpenStats(),this._loadCards()},_initBinds:function(){this.model.bind("change:page",this._moveTabsNavigation,this),this._panes.bind("tabEnabled",this.render,this)},_getBBox:function(){this.columns.each(function(a){"the_geom"===a.get("column")&&(this.bbox=a.get("bbox"))},this)},_loadCards:function(){this.columns.each(this._loadCard,this)},_loadCard:function(a){var b=this;a.get("success")&&this._generateThumbnail(a,function(c,e){c?d.log.error(c):b._addCard(e,a)})},_sendAppliedStats:function(){d.god.trigger("metrics","applied_pecan",{email:window.user_data.email})},_sendOpenStats:function(){d.god.trigger("metrics","open_pecan_list",{email:window.user_data.email})},_skip:function(){var a,b=this.vis.get("active_layer_id"),c=this.vis.map.layers.where({id:b});c&&(a=c[0].table.get("name"));var d="pecan_"+this.options.user.get("username")+"_"+a;localStorage[d]=!0},_nextPage:function(){var a=this.model.get("page"),b=this.model.get("maxPages");a<b&&this.model.set("page",a+1)},_prevPage:function(){var a=this.model.get("page");a>1&&this.model.set("page",a-1)},_moveTabsNavigation:function(){var a=this.model.get("page"),b=960,c=b*(a-1);this.$(".js-map-list").css("margin-left","-"+c+"px"),this._refreshNavigation()},_refreshNavigation:function(){var a=this.model.get("page"),b=this.model.get("maxPages");this.$(".js-goPrev")[a>1?"removeClass":"addClass"]("is-disabled"),this.$(".js-goNext")[a<b?"removeClass":"addClass"]("is-disabled")},_hideNavigation:function(){this.$(".js-navigation").addClass("is-hidden")},_setupCSS:function(a,b){var c=this.options.vis.tableMetadata().get("row_count"),d=c/(this._CARD_WIDTH*this._CARD_HEIGHT),e=d>this._STROKE_PX_LIMIT;return"line"!==b&&e&&(a=a.replace("marker-line-width: 1;","marker-line-width: 0.7;"),a=a.replace("marker-width: 10;","marker-width: 7;")),a},_setupTemplate:function(){var a=this.map.getLayerAt(0).get("urlTemplate");if(a)var b=_.find(this._SUPPORTED_BASEMAPS,function(b){return a.indexOf(b)!==-1});return a&&b||(a=this._DEFAULT_BASEMAP_TEMPLATE),a},_generateLayerDefinition:function(a){var b=a.get("visualizationType"),c=a.get("sql"),e=this._setupCSS(a.get("css"),a.get("geometryType")),f=this.user.get("api_key"),g=d.config.get("maps_api_template"),h=this._setupTemplate(),i={user_name:user_data.username,maps_api_template:g,api_key:f,layers:[{type:"http",options:{urlTemplate:h,subdomains:["a","b","c"]}},{type:"cartodb",options:{sql:c,cartocss:e,cartocss_version:"2.1.1"}}]};return"torque"!==b&&"heatmap"!==b||(i.layers[1]={type:"torque",options:{sql:c,cartocss:e,cartocss_version:"2.1.1"}}),i},_generateThumbnail:function(a,b){var c=this._generateLayerDefinition(a),e=function(a,c){b&&b(a,c)};this.columns.find(function(a){return"the_geom"===a.get("column")});this.bbox&&this._GET_BBOX_FROM_THE_GEOM?d.Image(c).size(this._CARD_WIDTH,this._CARD_HEIGHT).bbox(this.bbox).getUrl(e):d.Image(c).size(this._CARD_WIDTH,this._CARD_HEIGHT).zoom(this.map.get("zoom")).center(this.map.get("center")).getUrl(e)},_addCard:function(a,b){var c=new i({url:a,urlTemplate:this.map.getLayerAt(0).get("urlTemplate"),api_key:this.user.get("api_key"),model:b});c.bind("click",this._onCardClick,this),c.render(),this._panes.active("vis"),this._getSuccessColumns().length<3&&this.$(".js-map-list").addClass("is--centered"),"heatmap"===b.get("visualizationType")||"torque"===b.get("visualizationType")?this.$(".js-map-list").prepend(c.$el):this.$(".js-map-list").append(c.$el),this._refreshMapList(c.$el),this._refreshNavigation()},_refreshMapList:function(a){var b=a.width(),c=this.$(".js-card").length;this.$(".js-map-list").width(b*c+(c-1)*this._CARD_MARGIN),this.model.set("maxPages",Math.ceil(this.$(".js-card").size()/this._TABS_PER_ROW))},_getSuccessColumns:function(){return this.columns.filter(function(a){return a.get("success")})},_bindDataLayer:function(){this.layer.wizard_properties.unbind("load",this._setWizardProperties,this),this.layer.wizard_properties.bind("load",this._setWizardProperties,this)},_getProperties:function(a){var b=a.get("column"),c=this._getWizardName(a.get("visualizationType")),d={property:b};return"category"===c?this._getCategoriesProperties(d):"choropleth"===c?this._getChoroplethProperties(d):"heatmap"===c?this._getHeatmapProperties(d):void 0},_onCardClick:function(a){this._panes.active("applying"),this.model.set("column",a),this._skip(),this.layer=this._getDataLayer(),this._sendAppliedStats();var b=this._getWizardName(a.get("visualizationType")),c=this._getProperties(a);this._bindDataLayer(),this.layer.wizard_properties.active(b,c)},_getWizardName:function(a){var b={heatmap:"torque_heat"};return b[a]||a},_getDataLayer:function(){return this.map.layers.getDataLayers()[0]},_setWizardProperties:function(){var a=this._getProperties(this.model.get("column"));this.layer.wizard_properties.unbind("load",this._setWizardProperties,this),a&&this.layer.wizard_properties.set(a),this.close()},_getChoroplethProperties:function(a){var b=this.model.get("column"),c=(b.get("column"),b.get("type"),b.get("dist_type")),d=b.get("stats");return a.qfunction=this._getQFunction(c),a.color_ramp=e.getMethodProperties(d).name,a},_getCategoriesProperties:function(a){var b=this.model.get("column");return a.metadata=b.get("metadata"),a.categories=b.get("metadata"),a},_getHeatmapProperties:function(a){return a.property="cartodb_id",a["torque-resolution"]=2,a},_getQFunction:function(a){var b="Jenks";return"L"===a||"J"==a?b="Heads/Tails":"A"===a||"U"==a?b="Jenks":"F"===a&&(b="Quantile"),b},_keydown:function(a){a.keyCode===$.ui.keyCode.LEFT?this._prevPage():a.keyCode===$.ui.keyCode.RIGHT&&this._nextPage(),f.prototype._keydown.call(this,a)},clean:function(){this.layer&&this.layer.wizard_properties.unbind("load",this._setWizardProperties,this),f.prototype.clean.call(this)},cancel:function(a){this.killEvent(a),this.model.set("disabled",!0),this._skip(),this.elder("cancel")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_factory":108,"../../view_helpers/random_quote":112,"../../views/base_dialog/view":113,"./pecan_card":83,"cartodb-pecan":163}],85:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({tagName:"li",className:"DatasetSelected-syncOptionsItem",events:{click:"_onClick"},initialize:function(){this._setupModel(),this._template=c.templates.getTemplate("common/dialogs/sync_dataset/interval_template"),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(this._template(this.model.attributes)),this},_initBinds:function(){this.model.bind("change:checked",this._onToggleChecked,this)},_setupModel:function(){this.model=this.options.model},_onClick:function(a){this.killEvent(a),this.model.get("disabled")||(this.model.set("checked",!0),this.trigger("checked",this.model,this))},_onToggleChecked:function(){this.model.get("checked")?(this.$(".js-interval").addClass("is-checked"),this.$(".js-input").addClass("is-checked")):(this.$(".js-interval").removeClass("is-checked"),this.$(".js-input").removeClass("is-checked"))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],86:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,f="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,g=a("../../views/base_dialog/view"),h=a("./interval_view"),i=a("../../view_helpers/random_quote");b.exports=g.extend({_INTERVALS:[{name:"Every hour",time:3600,type:"hourly",if_external_source:!1},{name:"Every day",time:86400,type:"daily",if_external_source:!1},{name:"Every week",time:604800,type:"weekly",if_external_source:!1},{name:"Every month",time:2592e3,type:"monthly",if_external_source:!0},{name:"Never",time:0,type:"never",if_external_source:!0}],initialize:function(){if(!this.options.table)throw new TypeError("table is required");this.elder("initialize"),this.model=new f.core.Model({option:"interval",state:"prefetching",wait:!0}),this.table=this.options.table,this._initBinds(),this.table.fetch({success:this._onFetchedTable.bind(this),error:this._setterForDefaultErrorState()})},_initBinds:function(){this.model.bind("change:state",this.render,this)},render:function(){return this.clearSubViews(),g.prototype.render.call(this),this._initIntervals(),this},render_content:function(){switch(this.model.get("state")){case"prefetching":return this._renderLoading("Checking synchronization");case"error":return this.getTemplate("common/templates/fail")({msg:""});case"saving":return this._renderLoading("Saving…");default:return this.getTemplate("common/dialogs/sync_dataset/sync_dataset")({service:this._serviceName(),url:this._serviceURL()})}},_onFetchedTable:function(){this.model.set({state:"idle",interval:this.table.synchronization.get("interval")})},_renderLoading:function(a){return this.getTemplate("common/templates/loading")({title:a,quote:i()})},_serviceURL:function(){return this.table.synchronization.get("service_name")||this.table.synchronization.get("service_item_id")?this.table.synchronization.get("service_item_id"):this.table.synchronization.get("url")},_serviceName:function(){var a=this.table.synchronization.get("service_name");if(a&&d.isString(a))return f.Utils.capitalize(a)},_initIntervals:function(){this._intervals=new e.Collection;var a=this.table.synchronization.from_external_source;d.each(this._INTERVALS,function(b){var c=a&&!b.if_external_source;this._intervals.add({name:b.name,interval:b.time,checked:this.table.synchronization.get("interval")===b.time,disabled:c})},this),this._intervals.each(function(a){var b=new h({model:a});b.bind("checked",this._onIntervalChecked,this),this.$(".js-intervals").append(b.render().$el),this.addView(b)},this)},_onIntervalChecked:function(a){this._intervals.each(function(b){a.get("interval")!==b.get("interval")&&b.set("checked",!1)},this)},_getSelectedInterval:function(){return this._intervals.find(function(a){return a.get("checked")})},_addTab:function(a,b){this._contentPane.addTab(a,b.render()),this.addView(b)},ok:function(){var a=this._getSelectedInterval();if(a){this.model.set("state","saving");var b={success:this.close.bind(this),error:this._setterForDefaultErrorState()},c=a.get("interval");c?this.table.synchronization.save({interval:c},b):this.table.synchronization.destroy(b)}else this.close()},_setterForDefaultErrorState:function(){return this.model.set.bind(this.model,"state","error")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/random_quote":112,"../../views/base_dialog/view":113,"./interval_view":85}],87:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{"click .js-start":"_startTutorial"},initialize:function(){this.template=c.templates.getTemplate("common/dialogs/video_tutorial/video_tutorial_footer_template"),this._initBinds()},render:function(){return this.$el.html(this.template({isVideoSelected:this.model.isVideoSelected()})),this},_initBinds:function(){this.model.bind("change:videoId",this.render,this)},_startTutorial:function(a){var b=this.model.get("videoId");b&&c.god.trigger("startTutorial",b,this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],88:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{"click .js-back":"_backToList"},initialize:function(){this.template=c.templates.getTemplate("common/dialogs/video_tutorial/video_tutorial_header_template"),this._initBinds()},render:function(){return this.$el.html(this.template({isVideoSelected:this.model.isVideoSelected()})),this},_initBinds:function(){this.model.bind("change:videoId",this.render,this)},_backToList:function(){this.model.unset("videoId")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],89:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({className:"VideoTutorial-item",tagName:"li",events:{"click .js-button":"_selectVideo"},initialize:function(){this.template=c.templates.getTemplate("common/dialogs/video_tutorial/video_tutorial_item_template")},render:function(){return this.$el.html(this.template({shortName:this.model.get("short_name"),shortDescription:this.model.get("short_description"),color:this.model.get("color"),icon:this.model.get("icon")||"",duration:this.model.get("duration")||"",difficulty:this.model.get("difficulty")||"",iconUrl:this.model.get("icon_url")||""})),this},_selectVideo:function(){this.trigger("selected",this.model,this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],90:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,f=("undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,a("../../map_templates")),g=a("./video_tutorial_item_view");b.exports=d.core.View.extend({className:"VideoTutorial-listWrapper",initialize:function(){this.collection=new e.Collection(f),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this.$el.append('<ul class="VideoTutorial-list js-list"></ul>'),this.collection.reset(f),this},_initBinds:function(){this.collection.bind("reset",this._renderList,this),this.add_related_model(this.collection)},_renderList:function(){this.collection.each(this._addItem,this)},_addItem:function(a){var b=new g({model:a});this.$(".js-list").append(b.render().el),b.bind("selected",this._onItemSelected,this),this.addView(b)},_onItemSelected:function(a){this.model.set("videoId",a.get("videoId")),d.god.trigger("onTemplateSelected",this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../map_templates":98,"./video_tutorial_item_view":89}],91:[function(a,b,c){(function(c){var d=("undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,"undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null),e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../../map_templates");b.exports=d.Model.extend({defaults:{videoId:""},isVideoSelected:function(){return!!this.get("videoId")},getVideoTemplate:function(){var a=this.get("videoId");if(a){var b=e.find(f,function(b){return b.videoId===a});if(!e.isEmpty(b))return b}return!1}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../map_templates":98}],92:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({className:"VideoTutorial-video",initialize:function(){this.template=c.templates.getTemplate("common/dialogs/video_tutorial/video_tutorial_preview_template"),this.localStorage=new c.admin.localStorage("VideoPlayer"),this._initBinds()},render:function(){this.clearSubViews();var a=this.model.getVideoTemplate();return a&&a.name&&(this.$el.html(this.template(a)),this._loadScript()),this},_storeVideoInfo:function(a){this.localStorage.set({currentVideo:{seconds:a}})},_storeVideoInfoWithId:function(a){var b=this.model.get("videoId");this.localStorage.set({currentVideo:{video_id:b,seconds:a}})},_loadScript:function(){var a=this;$.getScript("//f.vimeocdn.com/js/froogaloop2.min.js",function(){a._initVideoBinds()})},_initVideoBinds:function(){var a=this;this._removeVideoBinds(),this.player=$f(this.$("iframe")[0]),this.player.addEvent("ready",function(){a.player.addEvent("playProgress",function(b){a._storeVideoInfo(b.seconds)})})},_removeVideoBinds:function(){this.player&&this.player.removeEvent("ready")},_initBinds:function(){this.model.bind("change:videoId",this.render,this)},clean:function(){this._removeVideoBinds(),this.elder("clean")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],93:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../views/base_dialog/view"),f=a("./video_tutorial_model"),g=a("./video_tutorial_header_view"),h=a("./video_tutorial_footer_view"),i=a("./video_tutorial_list_view"),j=a("./video_tutorial_preview_view");b.exports=e.extend({className:"Dialog is-opening VideoTutorial",initialize:function(){this.model=new f({videoId:this.options.videoId}),this.elder("initialize"),this.template=d.templates.getTemplate("common/dialogs/video_tutorial/video_tutorial_template"),this._initBinds()},render:function(){return this.clearSubViews(),this.elder("render"),this._initViews(),this},render_content:function(){return this.template()},_initBinds:function(){this.model.bind("change:videoId",this.setContentVisibility,this),d.god.bind("startTutorial",this.close,this),this.add_related_model(d.god)},_initViews:function(){var a=new g({el:this.$(".VideoTutorial-header"),model:this.model});a.render(),this.addView(a);var b=new h({el:this.$(".VideoTutorial-footer"),model:this.model});b.render(),this.addView(b),this._videoTutorialContent=new d.ui.common.TabPane({el:this.$(".VideoTutorial-content")}),this.addView(this._videoTutorialContent),this._videoTutorialContent.addTab("list",new i({model:this.model}).render()),this._videoTutorialContent.addTab("video",new j({model:this.model}).render()),this.setContentVisibility()},setContentVisibility:function(){this._videoTutorialContent.active(this.model.isVideoSelected()?"video":"list")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../views/base_dialog/view":113,"./video_tutorial_footer_view":87,"./video_tutorial_header_view":88,"./video_tutorial_list_view":90,"./video_tutorial_model":91,"./video_tutorial_preview_view":92}],94:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;c.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof a?a.cdb.admin:null;var d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=c.core.View.extend({className:"form-view form_spinner",defaults:{max:999999999999,min:-999999999999,inc:1,width:25,pattern:/^-?[0-9]+\.?[0-9]*$/,debounce_time:200},events:{"click .plus":"_plus","click .minus":"_minus","keypress input.value":"_checkInputPress","keydown input.value":"_checkInputPress","keyup input.value":"_checkInputUp","change .value":"_checkValueChange"},initialize:function(){d.bindAll(this,"_fireChange","_checkNumber"),this.property=this.options.property,this.model.bind("change",this.render,this),this.options.pattern&&"object"==typeof this.options.pattern&&("object"!=typeof this.options.pattern||this.options.pattern.test)||delete this.options.pattern,d.defaults(this.options,this.defaults),this.options.debounce_time>0&&(this._fireChange=d.debounce(this._fireChange,this.options.debounce_time))},render:function(a){var b=this.options.initValue||this.model.get(this.property);return a&&d.isNumber(a)&&(b=a),this.$el.html('<input class="value" '+(this.options.disabled?"readonly":"")+' value="" style="width:'+this.options.width+'px!important"/><a href="#" class="plus">+</a><a href="#" class="minus">-</a>'),this.$(".value").val(b),this.options.disabled&&(this.undelegateEvents(),this.$el.addClass("disabled").find("a").bind("click",this.killEvent)),this},_fireChange:function(){this.model.change()},_changeValue:function(a){this.model.set(a,{silent:!0}),this._fireChange()},inc:function(a){var b={},c=b[this.property]=this.model.get(this.property)+a;c=b[this.property]=Math.min(this.options.max,c.toFixed?c.toFixed(1):1*c),b[this.property]=Math.max(this.options.min,c),this._changeValue(b),this.render(b[this.property])},_plus:function(a){return a&&a.preventDefault(),this.inc(this.options.inc),!1},_minus:function(a){return a&&a.preventDefault(),this.inc(-this.options.inc),!1},_checkNumber:function(a){return this.options.pattern.test(a)},_checkInputPress:function(a){var b=String.fromCharCode(a.charCode);return"-"==b||"."==b||1*b!==NaN||(a.preventDefault(),a.stopPropagation(),!1)},_checkInputUp:function(a){this.value?null:this.value=this.model.get(this.property);var b=e(a.target).val();return 13===a.keyCode?(this._saveValue(a),!1):(this._checkNumber(b)||"-"==b||""==b?"-"!=b&&""!=b&&(this.value=e(a.target).val()):this.$el.find("input.value").val(this.value),!0)},_checkValueChange:function(a){var b=e(a.target).val();return b=""==b||"-"==b?0:1*b,this._checkNumber(b)?(this._saveValue(a),this.value=e(a.target).val()):this.$el.find("input.value").val(this.value),!0},_saveValue:function(a){var b={},d=this.$el.find("input.value").val(),e=this.options.min<0&&this.options.max>0?0:this.options.min,f=""==d||"-"==d?e:1*d;this.$el.find("input.value").val(f),b[this.property]=f,this.model.set(b),c.god.trigger("closeDialogs")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],95:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,d=function(a){this.name=a||"cartodb",!localStorage.getItem(this.name)&&this.isEnabled()&&localStorage.setItem(this.name,"{}")};d.prototype.isEnabled=function(){try{return localStorage.setItem("checking","test"),localStorage.removeItem("checking"),!0}catch(a){return!1}},d.prototype.get=function(a){if(!this.isEnabled())return!1;if(void 0===a)return JSON.parse(localStorage.getItem(this.name));var b=JSON.parse(localStorage.getItem(this.name));return b[a]},d.prototype.search=function(a){if(!this.isEnabled())return null;var b=JSON.parse(localStorage.getItem(this.name));for(var c in b)if(b[c][a])return b[c][a];return null},d.prototype.set=function(a){if(!this.isEnabled())return null;var b=c.extend(this.get(),a);return localStorage.setItem(this.name,JSON.stringify(b))},d.prototype.add=function(a){return this.set(a)},d.prototype.remove=function(a){if(!this.isEnabled())return null;var b=c.omit(this.get(),a);return localStorage.setItem(this.name,JSON.stringify(b))},d.prototype.destroy=function(){delete localStorage.removeItem(this.name)},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],96:[function(a,b,c){var d=a("../views/base_dialog/view");b.exports=d.extend({className:"Dialog is-opening MamufasDialog",overrideDefaults:{template_name:"common/views/base_dialog/template",triggerDialogEvents:!1},initialize:function(){d.prototype.initialize.apply(this,arguments),this.template=cdb.templates.getTemplate("common/mamufas_import/mamufas_import_dialog")},render_content:function(){return this.template()},render:function(){return this.elder("render"),this.$(".Dialog-content").addClass("Dialog-content--expanded"),this},hide:function(){d.prototype.hide.apply(this,arguments),this.trigger("hide"),this._setBodyForDialogMode("remove")}})},{"../views/base_dialog/view":113}],97:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./mamufas_import_dialog_view");b.exports=d.core.View.extend({initialize:function(){this.user=this.options.user,this.model=new d.core.Model({visible:!1})},render:function(){return this},_createDragster:function(){this.dragster&&this._destroyDragster(),this.dragster=new Dragster(this.$el[0])},_createDropzone:function(){this.dropzone&&this._destroyDropzone(),this.dropzone=new Dropzone(this.$el[0],{url:":)",autoProcessQueue:!1,previewsContainer:!1})},_destroyDragster:function(){this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),delete this.dragster)},_destroyDropzone:function(){this.dropzone&&(this.dropzone.destroy(),delete this.dropzone)},_initBinds:function(){var a=this,b=new e({clean_on_hide:!0});this.$el.on("dragster:enter",function(a){b.appendToBody()}),this.$el.on("dragster:leave",function(a){b.hide()}),this.dropzone.on("drop",function(c){a.dragster.dragleave(c),b.hide(),a.dropzone.removeFile(c);var e=c.dataTransfer.files;e&&e.length>0&&(1===e.length&&(e=e[0]),d.god.trigger("fileDropped",e,this))})},_removeBinds:function(){this.$el.off("dragster:enter"),this.$el.off("dragster:leave")},enable:function(){this.model.get("visible")||(this._createDragster(),this._createDropzone(),this._initBinds(),this.model.set("visible",!0))},disable:function(){this.model.get("visible")&&(this._removeBinds(),this._destroyDragster(),this._destroyDropzone(),this.model.set("visible",!1))},clean:function(){this._removeBinds(),this.elder("clean")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./mamufas_import_dialog_view":96}],98:[function(a,b,c){b.exports=[{name:"Create animated maps",short_name:"Create animated maps",description:"Learn how to animate your data, by using historic United States tornado data.",short_description:"Create maps for showing events over time",icon:"snake",color:"#CB3F29",difficulty:"easy",duration:"5:01",videoId:"122308083",map:{url:"https://examples.carto.com/viz/960736aa-cd8c-11e4-a309-0e6e1df11cbf/embed_map",source:["https://examples.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20tornado_centroids&filename=tornados&format=geojson"]}},{name:"Animate the life of a cat",short_name:"Create GPS Data maps",description:"Let's take a look at one week of movements for a cat named Spencer. Using GPS collected data, we can animate Spencer over time to see his patterns of exploration in his neighborhood.",short_description:"Mapping your GPS data was never so easy!",icon:"points",color:"#AC638B",difficulty:"easy",duration:"1:53",videoId:"122308076",map:{url:"https://examples.carto.com/viz/00c8701c-c121-11e4-b828-0e4fddd5de28/embed_map",source:["https://examples.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20spencer_the_cat&filename=spencer_the_cat&format=geojson"]}},{name:"Create your own data using the CARTO Editor",short_name:"Create your own datasets",description:"Learn to create your own point, line, or polygon dataset directly in the CARTO editor.",short_description:" Add and style features in a map using the CARTO UI",icon:"notes",color:"#F2C000",difficulty:"easy",duration:"5:39",videoId:"122308073",map:{url:"https://examples.carto.com/viz/eaa226aa-cd8e-11e4-893e-0e0c41326911/embed_map"}},{name:"Map your local world",short_name:"Map your local world",description:"We will use a publically available set of buildings to map Nantucket Island. Then we will use CARTO's annotation tools to highlight our point of interest.",short_description:"Learn to create and style a map of your city",icon:"mountain",color:"#EA703D",difficulty:"easy",duration:"2:57",videoId:"122308073",map:{url:"https://examples.carto.com/viz/b8847e3e-c1f4-11e4-8c09-0e853d047bba/embed_map",source:["https://examples.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20structures_poly_197&filename=buildings_nantucket&format=geojson"]}},{name:"Create your first choropleth map using Table Join",short_name:"Join Datasets",description:"Create your first choropleth map by joining historic tornado data with United States polygons",short_description:"Build your first choropleth map by joining two datasets",icon:"rectangles",color:"#86B765",difficulty:"medium",duration:"5:17",videoId:"122308079",map:{url:"https://examples.carto.com/viz/339c7670-cd90-11e4-ab8c-0e018d66dc29/embed_map",source:["https://examples.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20tornado_centroids&filename=tornados&format=geojson","https://examples.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20tornados_in_us&filename=tornados_us&format=geojson"]}},{name:"Map your MailChimp Campaigns",short_name:"Map MailChimp Campaigns",description:"Create a map of where your subscribers are and which of them have opened any of your campaigns. Also this is a great way to learn about conditional styling.",short_description:"Map your engagement using the MailChimp Connector.",icon:"email",color:"#AC638B",difficulty:"easy",duration:"1:49",videoId:"125895396",map:{url:"https://examples.carto.com/viz/560de38c-ea88-11e4-aac4-0e5e07bb5d8a/embed_map",source:[]}}]},{}],99:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({defaults:{per_page:20,page:1},fetch:function(a){return a.trigger("fetching"),a.fetch({data:this.attributes})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null,e=d.Router.extend({navigate:function(){throw new Error("router.enableAfterMainView({ ... }) must be called before you can navigate")},enableAfterMainView:function(){this.navigate=function(a,b){d.Router.prototype.navigate.call(this,this.normalizeFragmentOrUrl(a),b)},d.history.start({pushState:!0,root:this.rootPath()+"/"})},rootPath:function(){throw new Error("implement rootPath in child router (no trailing slash)")},normalizeFragmentOrUrl:function(a){throw new Error("implement normalizeFragmentOrUrl in child router")}});e.supportTrailingSlashes=function(a){return c.reduce(a,function(a,b,c){return a[c]=b,a[c+"/"]=b,a},{})},b.exports=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],101:[function(a,b,c){(function(c){var d=a("perfect-scrollbar"),e=a("./scroll.tpl"),f=window.MutationObserver,g="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;b.exports=g.core.View.extend({tagName:"div",className:"ScrollView",initialize:function(a){if(!a.createContentView)throw new Error("A factory createContentView function is required");this.options=a||{},this._type=a.type||"vertical",this._maxScroll=0},render:function(){this.clearSubViews(),this._html();var a=this.options.createContentView.call(this);return this._contentContainer().append(a.render().el),this.addView(a),this._applyScroll(),this._updateScrollWhenExist(),this},_html:function(){this.$el.html(e({type:this._type})),"horizontal"===this._type&&this.$el.addClass("ScrollView--horizontal")},_contentContainer:function(){return this.$(".js-content")},_wrapperContainer:function(){return this.$(".js-wrapper")},_updateScrollWhenExist:function(){if(f){var a=document.body,b=this._wrapperContainer().get(0),c=function(){a.contains(b)&&(d.update(b),e.disconnect())},e=new f(c);c();var g={subtree:!0,childList:!0};e.observe(a,g)}},_applyScroll:function(){
d.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,suppressScrollX:"vertical"===this._type,suppressScrollY:"horizontal"===this._type})},destroyScroll:function(){d.destroy(this._wrapperContainer().get(0))},clean:function(){this.destroyScroll(),g.core.View.prototype.clean.call(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./scroll.tpl":102,"perfect-scrollbar":164}],102:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="ScrollView-wrapper js-wrapper js-perfect-scroll">\n  <div class="ScrollView-content js-content"></div>\n</div>\n';return __p}},{underscore:188}],103:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({_DATASOURCE_NAME:"dropbox",initialize:function(a,b){b.datasource_name&&(this._DATASOURCE_NAME=b.datasource_name)},url:function(a){var b=c.config.urlVersion("imports_service",a);return"/api/"+b+"/imports/service/"+this._DATASOURCE_NAME+"/auth_url"},parse:function(a){return a}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],104:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({_DATASOURCE_NAME:"dropbox",initialize:function(a,b){b.datasource_name&&(this._DATASOURCE_NAME=b.datasource_name)},url:function(a){var b=c.config.urlVersion("imports_service",a);return"/api/"+b+"/imports/service/"+this._DATASOURCE_NAME+"/token_valid"},parse:function(a){return a}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],105:[function(a,b,c){b.exports=cdb.core.View.extend({initialize:function(){this.user=this.options.user,this.template=cdb.templates.getTemplate("common/views/support_banner")},render:function(){return this.$el.html(this.template({userType:this._getUserType(),orgDisplayEmail:this._getOrgAdminEmail(),isViewer:this.user.isViewer()})),this},_getUserType:function(){var a=this.user.get("account_type").toLowerCase();return this.user.isOrgOwner()?"org_admin":this.user.isInsideOrg()?"org":"internal"===a||"partner"===a||"ambassador"===a?"internal":"free"!==a?"client":"regular"},_getOrgAdminEmail:function(){return this.user.isInsideOrg()?this.user.organization.display_email:null}})},{}],106:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null,e="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=c.core.Model.extend({sync:function(a,b,c){return d.sync("update",b,c)},url:function(){var a=this._configModel.get("url_prefix");return a+"/api/v3/notifications/"+this.get("key")},initialize:function(a,b){if(!b.key)throw new Error("key is required");if(!b.configModel)throw new Error("configModel is required");this._configModel=b.configModel,this.attributes=e.extend({notifications:a},{key:b.key})},getKey:function(a){var b=this.get("notifications")||{};return b[a]},setKey:function(a,b){var c=this.get("notifications")||{};c[a]=b,this.set("notifications",c)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],107:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null,e="builder_activated";b.exports=c.core.View.extend({className:"js-builderNotification",events:{"click .js-close":"_onClose"},initialize:function(){if(!this.options.notification)throw new Error("notification is required");this._notification=this.options.notification,this._template=c.templates.getTemplate("common/user_notification/user_notification"),this.render()},render:function(){return this.$el.html(this._template()),d("body").prepend(this.$el),this},_onClose:function(){this._notification.setKey(e,!0),this._notification.save(),this.clean()},clean:function(){this.constructor.__super__.clean.apply(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],108:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./views/base_dialog/view");b.exports={createDialogByTemplate:function(a,b,c){return this.createDialogByView(this.createByTemplate(a,b),c)},createByTemplate:function(a,b,c){var f=d.isString(a)?e.templates.getTemplate(a):a,g=new e.core.View(c);return g.render=function(){return this.$el.html(f(b)),this},g},createByList:function(a,b){var c=new e.core.View(b);return c.render=function(){return this.clearSubViews(),d.each(a,function(a){this.addView(a),this.$el.append(a.render().$el)},this),this},c},createDialogByView:function(a,b){var c=d.extend({clean_on_hide:!0,enter_to_confirm:!0},b);return new(f.extend({initialize:function(){this.elder("initialize"),this.addView(a)},render_content:function(){return a.render().el}}))(c)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./views/base_dialog/view":113}],109:[function(a,b,c){var d=function(a){return this instanceof d?(this.bytes=a,0==a?this.unit=0:this.unit=parseInt(Math.floor(Math.log(a)/Math.log(1024))),this):new d(a)};d.prototype.size=function(){return this.bytes/Math.pow(1024,this.unit)},d.prototype.UNIT_SUFFIXES=["B","kB","MB","GB","TB"],d.prototype.suffix=function(){return this.UNIT_SUFFIXES[this.unit]},d.prototype.toString=function(a){var b=this.size();if(a){var c=Math.pow(10,a);b=Math.floor(b*c)/c}else b=Math.floor(b);return b+this.suffix()},b.exports=d},{}],110:[function(a,b,c){(function(a){function c(a){return 2===a.which||3===a.which}function d(a){return a.metaKey}function e(a){return a.ctrlKey}var f="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=function(a){this.killEvent(a);var b=f(a.target).closest("a").attr("href");return!!b&&void(c(a)||d(a)?(e(a)||d(a))&&window.open(b,"_blank"):(this.router||this.options.router).navigate(b,{trigger:!0}))}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],111:[function(a,b,c){var d=function(a,b,c){return 2===arguments.length?d.call(this,arguments[0],arguments[0]+"s",arguments[1]):1===c?a:b};d.prefixWithCount=function(a,b,c){return d("1 "+a,c+" "+b,c)},b.exports=d},{}],112:[function(a,b,c){b.exports=function(){var a=_.template('<p class="CDB-Text CDB-Size-medium u-altTextColor">"<%= quote %>"</p><% if (author) { %><p class="CDB-Text CDB-Size-medium u-altTextColor u-tSpace"><em>– <%- author %></em></p><% } %>'),b=[{quote:"Geographers never get lost. They just do accidental field work.",author:"Nicholas Chrisman"},{quote:"Geography is just physics slowed down, with a couple of trees stuck in it.",author:"Terry Pratchett"},{quote:"Not all those who wander are lost.",author:"J. R. R. Tolkien"},{quote:"In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City.",author:"Jorge Luis Borges"},{quote:"X marks the spot",author:"Indiana Jones"},{quote:"It's turtles all the way down.",author:null},{quote:"Remember: no matter where you go, there you are.",author:null},{quote:"Without geography, you're nowhere!",author:"Jimmy Buffett"},{quote:"our earth is a globe / whose surface we probe /<br />no map can replace her / but just try to trace her",author:"Steve Waterman"},{quote:"Everything happens somewhere.",author:"Doctor Who"},{quote:"A map is the greatest of all epic poems. Its lines and colors show the realization of great dreams.",author:"Gilbert H. Grosvenor"},{quote:"Everything is related to everything else,<br />but near things are more related than distant things.",author:"Tobler's first law of geography"},{quote:"Hic Sunt Dracones",author:null},{quote:"Here be dragons",author:null},{quote:"Stand in the place where you live / Now face North /<br/>Think about direction / Wonder why you haven't before",author:"R.E.M"},{quote:"The virtue of maps, they show what can be done with limited space, they foresee that everything can happen therein.",author:"José Saramago"}],c=Math.round(Math.random()*(b.length-1));return a(b[c])}},{}],113:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null,f=c.ui.common.Dialog;b.exports=f.extend({className:"Dialog is-opening",overrideDefaults:{template_name:"common/views/base_dialog/template",triggerDialogEvents:!0},initialize:function(){d.defaults(this.options,this.overrideDefaults),this.elder("initialize"),this.bind("show",this._setBodyForDialogMode.bind(this,"add")),this.bind("hide",this._setBodyForDialogMode.bind(this,"remove"))},show:function(){f.prototype.show.apply(this,arguments),this.trigger("show"),this.options.triggerDialogEvents&&c.god.trigger("dialogOpened"),this.$el.removeClass("is-closing"),document.activeElement&&document.activeElement.blur()},render:function(){return f.prototype.render.apply(this,arguments),this.$(".content").addClass("is-newContent"),this._isSticky()&&this.$el.addClass("is-sticky"),this.show(),this},_isSticky:function(){return this.options&&this.options.sticky},close:function(){this._cancel(void 0,!0)},open:function(){f.prototype.open.apply(this,arguments),this.show()},hide:function(){f.prototype.hide.apply(this,arguments),this.trigger("hide")},_cancel:function(a,b){if(a&&this.killEvent(a),!this._isSticky()){this.$el.removeClass("is-opening").addClass("is-closing");var d=this;setTimeout(function(){d.cancel&&!b&&d.cancel(),f.prototype.hide.call(d)},80),this.trigger("hide"),this.options.triggerDialogEvents&&c.god.trigger("dialogClosed")}},_ok:function(a){this.killEvent(a),this.ok?this.ok():this.close()},_setBodyForDialogMode:function(a){e("body")[a+"Class"]("is-inDialog")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],114:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=function(a){var b="leaflet",e="tiled";a.baselayer.url?a.baselayer.urlTemplate=a.baselayer.url:(b="googlemaps",e="GMapsBase");var f=c.createVis(a.el,{version:"0.1.0",title:"default",scrollwheel:void 0!==a.scrollwheel&&a.scrollwheel,zoom:6,map_provider:b,center:[40.7127837,-74.0059413],layers:[d.extend({type:e},a.baselayer)]});return f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],115:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("../../../view_helpers/navigate_through_router");b.exports=d.admin.DropdownMenu.extend({className:"Dropdown BreadcrumbsDropdown",events:{"click a":"_navigateToLinksHref"},initialize:function(){if(this.elder("initialize"),!this.options.viewModel)throw new Error("viewModel must be provided");this.viewModel=this.options.viewModel,this.router=this.options.router},render:function(){var a=this.model.viewUrl().dashboard(),b=a.datasets(),c=a.deepInsights(),f=a.maps();return this.$el.html(this.template_base({avatarUrl:this.model.get("avatar_url"),userName:this.model.get("username"),mapsUrl:f,datasetsUrl:b,deepInsightsUrl:c,lockedDatasetsUrl:b.lockedItems(),lockedMapsUrl:f.lockedItems(),isDeepInsights:this.viewModel.isDisplayingDeepInsights(),isDatasets:this.viewModel.isDisplayingDatasets(),isMaps:this.viewModel.isDisplayingMaps(),isLocked:this.viewModel.isDisplayingLockedItems()})),d.god.bind("closeDialogs",this.hide,this),e("body").append(this.el),this},_navigateToLinksHref:function(){this.hide(),this.options.router&&f.apply(this,arguments)},clean:function(){e(this.options.target).unbind("click",this._handleClick),this.constructor.__super__.clean.apply(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../view_helpers/navigate_through_router":110}],116:[function(a,b,c){(function(c){var d=("undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,"undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,"undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null),e=a("./model"),f=a("./organization-model");b.exports=d.Collection.extend({model:function(a,b){return"org_notification"===a.type?new f(a,b):new e(a)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./model":118,"./organization-model":119}],117:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("../../../scroll/scroll-view"),f=a("../../../../common/view_factory");b.exports=d.admin.DropdownMenu.extend({className:"Dropdown",initialize:function(){d.admin.DropdownMenu.prototype.initialize.apply(this,arguments),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(this.template_base()),this._renderDropdown(),this._checkScroll(),$("body").append(this.el),this},_renderDropdown:function(){this.dropdown_content=f.createByTemplate("common/views/dashboard_header/notifications/templates/dropdown_content",{items:this.collection.toJSON(),unreadItems:this.collection.filter(function(a){return!a.get("opened")}).length}),this.addView(this.dropdown_content),this.$(".js-content").html(this.dropdown_content.render().el)},_checkScroll:function(){setTimeout(function(){if(this.$el.height()>=300){var a=new e({createContentView:function(){return this.dropdown_content}.bind(this)});this.addView(a),this.$el.addClass("Dropdown--withScroll"),this.$(".js-content").html(a.render().el)}}.bind(this),301)},_initBinds:function(){d.god.bind("closeDialogs",this.hide,this),this.add_related_model(d.god)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../../common/view_factory":108,"../../../scroll/scroll-view":101}],118:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;"undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=c.core.Model.extend({defaults:{type:"",message:"",opened:!1}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],119:[function(a,b,c){var d=a("./model");b.exports=d.extend({url:function(a){return"/api/v3/users/"+this._userId+"/notifications/"+this.id+"?api_key="+this._apiKey},initialize:function(a,b){if(!b.userId)throw new Error("user Id is required");if(!b.apiKey)throw new Error("apiKey is required");this._userId=b.userId,this._apiKey=b.apiKey},markAsRead:function(){this.save({notification:{read_at:new Date}})}})},{"./model":118}],120:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("./collection"),g=a("./dropdown_view");b.exports=d.core.View.extend({attributes:{href:"#/notifications"},tagName:"a",className:"UserNotifications",events:{click:"_openNotifications"},initialize:function(){this.user=this.options.user,this.localStorage=this.options.localStorage,this.template=d.templates.getTemplate("common/views/dashboard_header/notifications/templates/user_notifications"),this.collection=new f,this.collection.reset(this._generateCollection(),{userId:this.user.get("id"),apiKey:this.user.get("api_key"),silent:!0}),this._initBinds()},render:function(){var a=this.collection.filter(function(a){return!a.get("opened")}).length;return this.$el.html(this.template({notificationsCount:a})),this.$el.toggleClass("has--alerts",a>0),this},_initBinds:function(){this.user.bind("change",this._onUserChange,this),this.collection.bind("reset",this.render,this),this.collection.bind("remove",this.render,this),this.add_related_model(this.user),this.add_related_model(this.collection)},_onUserChange:function(){this.collection.reset(this._generateCollection(),{userId:this.user.get("id"),apiKey:this.user.get("api_key")}),this.render()},_generateCollection:function(){var a=[],b={},c=this.user.viewUrl();if(b.isInsideOrg=this.user.isInsideOrg(),b.isOrgOwner=this.user.isOrgOwner(),b.accountType=this.user.get("account_type").toLowerCase(),b.remainingQuota=this.user.get("remaining_byte_quota"),b.publicProfileUrl=c.publicProfile(),b.bytesQuota=this.user.get("quota_in_bytes"),b.userType="regular",b.upgradeUrl=window.upgrade_url||"",b.upgradeContactEmail=this.user.upgradeContactEmail(),b.trialEnd=this.user.get("trial_ends_at")&&moment(this.user.get("trial_ends_at")).format("YYYY-MM-DD"),b.userName=this.user.get("name")||this.user.get("username"),b.isInsideOrg&&!b.isOrgOwner?b.userType="org":b.isOrgOwner?b.userType="admin":"internal"!==b.accountType&&"partner"!==b.accountType&&"ambassador"!==b.accountType||(b.userType="internal"),!b.isInsideOrg&&"free"===b.accountType&&this.user.get("table_count")>0?a.push({iconFont:"CDB-IconFont-gift",severity:"NotificationsDropdown-itemIcon--positive",type:"try_trial",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/try_trial")(b),opened:this.localStorage.get("notification.try_trial")}):this.localStorage.remove("notification.try_trial"),b.remainingQuota<=0?a.push({iconFont:"CDB-IconFont-barometer",severity:"NotificationsDropdown-itemIcon--negative",type:"limits_exceeded",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/limits_exceeded")(b),opened:this.localStorage.get("notification.limits_exceeded")}):this.localStorage.remove("notification.limits_exceeded"),100*b.remainingQuota/b.bytesQuota<20?a.push({iconFont:"CDB-IconFont-barometer",severity:"NotificationsDropdown-itemIcon--alert",type:"close_limits",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/close_limits")(b),opened:this.localStorage.get("notification.close_limits")}):this.localStorage.remove("notification.close_limits"),this.user.get("show_upgraded_message")?a.push({iconFont:"CDB-IconFont-heartFill",severity:"NotificationsDropdown-itemIcon--positive",type:"upgraded_message",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/upgraded_message")(b),opened:this.localStorage.get("notification.upgraded_message")}):this.localStorage.remove("notification.upgraded_message"),this.user.get("show_trial_reminder")?a.push({iconFont:"CDB-IconFont-clock",severity:"NotificationsDropdown-itemIcon--alert",type:"trial_ends_soon",msg:d.templates.getTemplate("common/views/dashboard_header/notifications/templates/trial_ends_soon")(b),opened:this.localStorage.get("notification.trial_ends_soon")}):this.localStorage.remove("notification.trial_ends_soon"),window.organization_notifications)for(var e=0;e<window.organization_notifications.length;e++){var f=window.organization_notifications[e],g=f.icon?"CDB-IconFont-"+f.icon:"CDB-IconFont-alert";a.push({iconFont:g,severity:"NotificationsDropdown-itemIcon--alert",id:f.id,msg:f.html_body,read_at:f.read_at,type:"org_notification"})}return a},_openNotifications:function(a){if(a&&this.killEvent(a),this.notification)return this.notification.hide(),delete this.notification,this;var b=this.notification=new g({target:this.$el,collection:this.collection,horizontal_offset:5,vertical_offset:-5,template_base:"common/views/dashboard_header/notifications/templates/dropdown"});e(b.options.target).unbind("click",b._handleClick),this._closeAnyOtherOpenDialogs(),b.on("onDropdownHidden",function(){this._onDropdownHidden(b)},this),b.render(),b.open(),this.addView(b)},_onDropdownHidden:function(a){var b=this;this.collection.each(function(a){if("org_notification"===a.get("type"))a.markAsRead();else if(a.get("type")){a.set("opened",!0);var c={};c["notification."+a.get("type")]=!0,b.localStorage.set(c)}}),this.collection.reset(),a.clean(),this.removeView(a),this.$el.removeClass("has--alerts"),delete this.notification},_closeAnyOtherOpenDialogs:function(){d.god.trigger("closeDialogs")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./collection":116,"./dropdown_view":117}],121:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("../../view_helpers/bytes_to_size");b.exports=d.admin.DropdownMenu.extend({className:"Dropdown",initialize:function(){if(this.elder("initialize"),!this.model)throw new Error("model is required");this.template_base=d.templates.getTemplate("common/views/dashboard_header/settings_dropdown")},shortDisplayName:function(a){var b=a.get("account_type_display_name"),c=_.isUndefined(b)?a.get("account_type"):b;return _.isUndefined(c)?c:(c=c.toLowerCase(),"organization user"===c?"org. user":c.replace(/lump-sum/gi,"- A").replace(/academic/gi,"aca.").replace(/ - Monthly/i," - M").replace(/ - Annual/i," - A").replace(/Non-Profit/i,"NP").replace(/On-premises/i,"OP").replace(/Internal use engine/i,"engine").replace(/Lite/i,"L").replace(/Cloud Engine &/i,"C. Engine &").replace(/& Enterprise Builder/i,"& E. Builder").replace(/CARTO for /i,"").replace(/CARTO /i,""))},render:function(){var a=this.model,b=a.get("db_size_in_bytes"),c=a.get("quota_in_bytes"),g=Math.round(b/c*100),h="";g>80&&g<90?h="is--inAlert":g>89&&(h="is--inDanger");var i=this.shortDisplayName(a),j=this.model.viewUrl(),k=window.upgrade_url||d.config.get("upgrade_url")||"";return this.$el.html(this.template_base({name:a.get("name")||a.get("username"),email:a.get("email"),accountType:i,isOrgAdmin:a.isOrgAdmin(),usedDataStr:f(b).toString(2),usedDataPct:g,progressBarClass:h,availableDataStr:f(c).toString(2),showUpgradeLink:k&&(a.isOrgOwner()||!a.isInsideOrg())&&!d.config.get("cartodb_com_hosted"),upgradeUrl:k,publicProfileUrl:j.publicProfile(),apiKeysUrl:j.apiKeys(),organizationUrl:j.organization(),accountSettingsUrl:j.accountSettings(),logoutUrl:j.logout(),isViewer:a.isViewer(),isBuilder:a.isBuilder(),orgDisplayEmail:a.isInsideOrg()?a.organization.display_email:null,engineEnabled:a.get("actions").engine_enabled,mobileAppsEnabled:a.get("actions").mobile_sdk_enabled})),d.god.bind("closeDialogs",this.hide,this),e("body").append(this.el),this},clean:function(){e(this.options.target).unbind("click",this._handleClick),this.constructor.__super__.clean.apply(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/bytes_to_size":109}],122:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;"undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=c.core.View.extend({initialize:function(){this.user=this.model,this.template_base=c.templates.getTemplate("common/views/dashboard_header/user_support_template")},render:function(){return this.$el.html(this.template_base({userType:this._getUserType()})),this},_getUserType:function(){var a=this.user.get("account_type").toLowerCase();return this.user.isInsideOrg()?"org":"internal"===a||"partner"===a||"ambassador"===a?"internal":"free"!==a?"client":"regular"}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],123:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f=a("./dashboard_header/settings_dropdown_view"),g=a("./dashboard_header/breadcrumbs/dropdown_view"),h=a("./dashboard_header/notifications/view"),i=a("./dashboard_header/user_support_view");b.exports=e.core.View.extend({events:{"click .js-breadcrumb-dropdown":"_createBreadcrumbsDropdown","click .js-settings-dropdown":"_createSettingsDropdown"},initialize:function(){if(!this.options.el)throw new Error("el element is required");if(!this.options.viewModel)throw new Error("viewModel is required");this._viewModel=this.options.viewModel,this.router=this.options.router,this._initBinds()},render:function(){return this.clearSubViews(),this._renderBreadcrumbsDropdownLink(),this._renderSupportLink(),this._renderNotifications(),this._renderLogoLink(),this},_initBinds:function(){this._viewModel.bind("change",this._renderBreadcrumbsDropdownLink,this),this.router&&(this.router.model.bind("change",this._onRouterChange,this),this.add_related_model(this.router.model)),this.collection&&(this.collection.bind("reset",this._stopLogoAnimation,this),this.collection.bind("error",this._onCollectionError,this),this.add_related_model(this.collection)),this.add_related_model(this._viewModel)},_onCollectionError:function(a,b,c){(!b||b&&"abort"!==b.statusText)&&this._stopLogoAnimation()},_onRouterChange:function(a,b){b&&b.changes&&!b.changes.content_type&&this.collection.total_user_entries>0&&this._startLogoAnimation()},_startLogoAnimation:function(){this.$(".Logo").addClass("is-loading")},_stopLogoAnimation:function(){this.$(".Logo").removeClass("is-loading")},_renderBreadcrumbsDropdownLink:function(){this.$(".js-breadcrumb-dropdown").html(e.templates.getTemplate("common/views/dashboard_header/breadcrumbs/dropdown_link")({title:this._viewModel.breadcrumbTitle(),dropdownEnabled:this._viewModel.isBreadcrumbDropdownEnabled()}))},_renderNotifications:function(){var a=new h({user:this.model,localStorage:this.options.localStorage});this.$(".js-user-notifications").html(a.render().el),this.addView(a)},_renderSupportLink:function(){var a=new i({el:d(".js-user-support"),model:this.model});a.render()},_renderLogoLink:function(){var a=e.templates.getTemplate("common/views/dashboard_header/logo");this.$(".js-logo").html(a({homeUrl:this.model.viewUrl().dashboard(),googleEnabled:this.model.featureEnabled("google_maps")}))},_createSettingsDropdown:function(a){this.killEvent(a),this._setupDropdown(new f({target:d(a.target),model:this.model,horizontal_offset:18}))},_createBreadcrumbsDropdown:function(a){this._viewModel.isBreadcrumbDropdownEnabled()&&(this.killEvent(a),this._setupDropdown(new g({target:d(a.target),model:this.model,viewModel:this._viewModel,router:this.router,horizontal_offset:-110,tick:"center",template_base:"common/views/dashboard_header/breadcrumbs/dropdown"})))},_setupDropdown:function(a){this._closeAnyOtherOpenDialogs(),this.addView(a),a.on("onDropdownHidden",function(){a.clean()},this),a.render(),a.open()},_closeAnyOtherOpenDialogs:function(){e.god.trigger("closeDialogs")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./dashboard_header/breadcrumbs/dropdown_view":115,"./dashboard_header/notifications/view":120,"./dashboard_header/settings_dropdown_view":121,"./dashboard_header/user_support_view":122}],124:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var f="undefined"!=typeof window?window.moment:"undefined"!=typeof c?c.moment:null,g=a("../../forms/spinner");b.exports=d.core.View.extend({_MAX_RANGE:30,className:"DatePicker",options:{flat:!0,date:["2008-07-31","2008-07-31"],current:"2008-07-31",calendars:2,mode:"range",starts:1},events:{"click .js-dates":"_toggleCalendar","click .js-fourHours":"_setLastFourHours","click .js-oneDay":"_setLastDay","click .js-oneWeek":"_setLastWeek"},initialize:function(){this.model=new d.core.Model({fromDate:"",fromHour:0,fromMin:0,toDate:"",toHour:23,toMin:59,user_timezone:0}),this.template=this.options.template||d.templates.getTemplate("common/views/date_pickers/dates_range"),this._initBinds(),this._setToday()},render:function(){var a=this;return this.clearSubViews(),this.$el.append(this.template(e.extend(this.model.attributes,{max_days:this._MAX_RANGE}))),setTimeout(function(){a._initCalendar(),a._hideCalendar(),a._initTimers()},100),this},_initBinds:function(){e.bindAll(this,"_onDatesChange","_onDocumentClick"),this.model.bind("change",this._setValues,this),this.model.bind("change",this._onValuesChange,this),$(document).bind("click",this._onDocumentClick)},_destroyBinds:function(){$(document).unbind("click",this._onDocumentClick)},_setValues:function(a,b){var c="Choose your dates",e=this.model.attributes;e.fromDate&&e.toDate&&(c="From <strong>"+this.model.get("fromDate")+" "+(d.Utils.pad(this.model.get("fromHour"),2)+":"+d.Utils.pad(this.model.get("fromMin"),2))+"</strong> to <strong>"+this.model.get("toDate")+" "+(d.Utils.pad(this.model.get("toHour"),2)+":"+d.Utils.pad(this.model.get("toMin"),2))+'</strong><i class="CDB-IconFont CDB-IconFont-calendar DatePicker-datesIcon"></i>'),this.$(".DatePicker-dates").html(c)},_setToday:function(){var a=this.model.get("user_timezone"),b=f().utc(a),c=f().utc(a).subtract(this._MAX_RANGE-1,"days");this.options.date=[c.format("YYYY-MM-DD"),b.format("YYYY-MM-DD")],this.options.current=b.format("YYYY-MM-DD"),this._setModelFromPrevious(c)},_initCalendar:function(){var a=".DatePicker-calendar";document.body.contains(this.$(a)[0])&&(this.calendar=this.$(a).DatePicker(e.extend(this.options,{onChange:this._onDatesChange,onRender:function(a){var b=a.valueOf(),c=new Date,d=new Date;return d.setDate(c.getDate()-30),b<d||b>c?{disabled:!0}:""}})))},_onDatesChange:function(a,b){var c=f(a[0]),d=f(a[1]);Math.abs(c.diff(d,"days"))>this._MAX_RANGE&&(a[1]=f(a[0]).add("days",this._MAX_RANGE).format("YYYY-MM-DD"),this.$(".DatePicker-calendar").DatePickerSetDate([a[0],a[1]])),this.model.set({fromDate:a[0],toDate:a[1]})},_hideCalendar:function(a){a&&this.killEvent(a),this.$(".DatePicker-dropdown").hide()},_toggleCalendar:function(a){a&&this.killEvent(a),this.$(".DatePicker-dropdown").toggle()},_setLastFourHours:function(){var a=f().utc(0).subtract(4,"hours");this._setModelFromPrevious(a),this._setDatepickerFromPrevious(a),this.closeCalendar()},_setLastDay:function(){var a=f().utc(0).subtract(1,"day");this._setModelFromPrevious(a),this._setDatepickerFromPrevious(a),this.closeCalendar()},_setLastWeek:function(){var a=f().utc(0).subtract(1,"week");this._setModelFromPrevious(a),this._setDatepickerFromPrevious(a),this.closeCalendar()},_setModelFromPrevious:function(a){var b=f().utc(0);this.model.set({fromDate:a.format("YYYY-MM-DD"),fromHour:parseInt(a.format("H")),fromMin:parseInt(a.format("m")),toDate:b.format("YYYY-MM-DD"),toHour:parseInt(b.format("H")),toMin:parseInt(b.format("m"))})},_setDatepickerFromPrevious:function(a){var b=f().utc(0);this.$(".DatePicker-calendar").DatePickerSetDate([a.format("YYYY-MM-DD"),b.format("YYYY-MM-DD")])},_initTimers:function(){var a=this.$(".DatePicker-timersFrom"),b=new g({model:this.model,property:"fromHour",min:0,max:23,inc:1,width:15,pattern:/^([12]?\d{0,1}|3[01]{0,2})$/,debounce_time:0});a.find(".DatePicker-timersHour").append(b.render().el),this.addView(b);
var c=new g({model:this.model,property:"fromMin",min:0,max:59,inc:1,width:15,pattern:/^([12345]?\d{0,1})$/,debounce_time:0});a.find(".DatePicker-timersMin").append(c.render().el),this.addView(c);var d=this.$(".DatePicker-timersTo"),e=new g({model:this.model,property:"toHour",min:0,max:23,inc:1,width:15,pattern:/^([12]?\d{0,1}|3[01]{0,2})$/,debounce_time:0});d.find(".DatePicker-timersHour").append(e.render().el),this.addView(e);var f=new g({model:this.model,property:"toMin",min:0,max:59,inc:1,width:15,pattern:/^([12345]?\d{0,1})$/,debounce_time:0});d.find(".DatePicker-timersMin").append(f.render().el),this.addView(f)},_onValuesChange:function(){this.trigger("changeDate",this.model.toJSON(),this)},getDates:function(){return this.model.toJSON()},closeCalendar:function(){this.$(".DatePicker-dropdown").hide()},_onDocumentClick:function(a){var b=$(a.target);0===b.closest(".DatePicker").length&&this.closeCalendar()},clean:function(){this._destroyBinds(),this.closeCalendar(),this.$(".DatePicker-calendar").DatePickerHide(),d.core.View.prototype.clean.call(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../forms/spinner":94}],125:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({_TEMPLATES:{8001:"common/views/size_error_details_upgrade_template",8005:"common/views/layers_error_details_upgrade_template",default:"common/views/error_details"},initialize:function(){this.user=this.options.user,this.err=this.options.err},render:function(){var a=this.err.error_code&&parseInt(this.err.error_code),b=c.config.get("upgrade_url"),d=b&&!c.config.get("cartodb_com_hosted")&&(!this.user.isInsideOrg()||this.user.isOrgOwner()),e=this._TEMPLATES.default,f=this.err.original_url,g=this.err.http_response_code,h=this.err.http_response_code_message;d&&this._TEMPLATES[a]&&(e=this._TEMPLATES[a]);var i=c.templates.getTemplate(e);return this.$el.html(i({errorCode:a,title:this.err.title,text:this.err.what_about,itemQueueId:this.err.item_queue_id,originalUrl:f,httpResponseCode:g,httpResponseCodeMessage:h,userCanUpgrade:d,showTrial:this.user.canStartTrial(),upgradeUrl:b})),this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],126:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({tagName:"a",events:{click:"_toggleLike"},initialize:function(){this.template=c.templates.getTemplate("common/views/likes/template"),this.model.bind("change:likeable change:liked change:likes error",this.render,this)},render:function(){return this.$el.html(this.template({likes:this.model.get("likes"),size:this.model.get("size"),show_count:this.model.get("show_count"),show_label:this.model.get("show_label")})).attr({class:this._classNames(),href:this._hrefLocation()}),this},_hrefLocation:function(){var a="#/like";return this.model.get("likeable")||(a=window.login_url),a},_classNames:function(){var a=["LikesIndicator"];return this.model.get("likeable")&&a.push("is-likeable"),this.model.get("liked")&&a.push("is-liked"),this._animate&&(a.push("is-animated"),this.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){this._animate=!1,this.render()}.bind(this))),a.join(" ")},_toggleLike:function(a){this.model.get("likeable")&&(this.killEvent(a),this._animate=!0,this.model.toggleLiked())}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],127:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=d.core.View.extend({options:{width:300,height:170,privacy:"PUBLIC",username:"",visId:"",mapsApiResource:"",className:"",authTokens:[]},_TEMPLATES:{regular:"<%- protocol %>://<%= mapsApiResource %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>",cdn:"<%- protocol %>://<%- cdn %>/<%- username %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>"},initialize:function(){e.each(["visId","mapsApiResource","username"],function(a){this.options[a]||console.log(a+" is required for Static Map instantiation")},this)},load:function(){return this._startLoader(),this._loadFromVisId(),this},_generateImageTemplate:function(){return"tpl_"+this.options.visId.replace(/-/g,"_")},_loadFromVisId:function(){var a=this._isHTTPS()?"https":"http",b=d.config.get("cdn_url"),c=e.template(b?this._TEMPLATES.cdn:this._TEMPLATES.regular),f={protocol:a,username:this.options.username,mapsApiResource:this.options.mapsApiResource,tpl:this._generateImageTemplate(),width:this.options.width,height:this.options.height,authTokens:this._generateAuthTokensParams()};b&&(f=e.extend(f,{cdn:b[a]}));var g=c(f);this._loadImage({},g)},_generateAuthTokensParams:function(){var a=this.options.authTokens;return a&&a.length>0?"?"+e.map(a,function(a){return"auth_token="+a}).join("&"):""},_isHTTPS:function(){return 0===location.protocol.indexOf("https")},loadURL:function(a){var b=c('<img class="MapCard-preview" src="'+a+'" />');this.$el.append(b),this.options.className&&b.addClass(this.options.className),b.fadeIn(250)},showError:function(){this._onError()},_startLoader:function(){this.$el.addClass("is-loading")},_stopLoader:function(){this.$el.removeClass("is-loading")},_onSuccess:function(a){this._stopLoader(),this.loadURL(a),this.trigger("loaded",a)},_onError:function(a){this._stopLoader(),this.$el.addClass("has-error");var b=c('<div class="MapCard-error" />');this.$el.append(b),b.fadeIn(250),this.trigger("error")},_loadImage:function(a,b){var c=this,d=new Image;d.onerror=function(){c._onError(a)},d.onload=function(){c._onSuccess(b)};try{d.src=b}catch(a){this._onError(a)}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],128:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,g="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,h=a("../pagination/model"),i=a("../../view_helpers/random_quote"),j=a("../../view_factory"),k=a("../pagination/view");b.exports=d.core.View.extend({events:{"click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","keydown .js-search-input":"_onKeyDown","submit .js-search-form":"killEvent"},initialize:function(){e.each(["collection","pagedSearchModel","createListView"],function(a){if(!this.options[a])throw new Error(a+" is required")},this),this.collection=this.options.collection,this.options.noResults=this.options.noResults||{};var a=this.options.pagedSearchModel;this.paginationModel=new h({current_page:a.get("page"),total_count:this.collection.totalCount()||0,per_page:a.get("per_page")}),this.elder("initialize"),this._initBinds(),this.options.pagedSearchModel.fetch(this.collection)},render:function(){return this.clearSubViews(),this._renderContent(this.getTemplate("common/views/paged_search/paged_search")({thinFilters:this.options.thinFilters,q:this.options.pagedSearchModel.get("q")})),this._initViews(),this._$cleanSearchBtn().hide(),this._renderExtraFilters(),this},_renderExtraFilters:function(){this.options.filtersExtrasView&&this.options.filtersExtrasView&&this.$(".js-filters").append(this.options.filtersExtrasView.render().el)},_renderContent:function(a){this.options.isUsedInDialog&&(a=this.getTemplate("common/views/paged_search/paged_search_dialog_wrapper")({htmlToWrap:a})),this.$el.html(a),this.options.isUsedInDialog&&(this.$el.addClass("Dialog-expandedSubContent"),this._$tabPane().addClass("Dialog-bodyInnerExpandedWithSubFooter"))},_initBinds:function(){this.collection.bind("fetching",function(){this._toggleCleanSearchBtn(),this._activatePane("loading")},this),this.collection.bind("error",function(a){(!a||a&&"abort"!==a.statusText)&&this._activatePane("error"),this._toggleCleanSearchBtn()},this),this.collection.bind("reset",function(a){this.paginationModel.set({total_count:this.collection.totalCount(),current_page:this.options.pagedSearchModel.get("page")}),this._activatePane(this.collection.totalCount()>0?"list":"no_results"),this._toggleCleanSearchBtn()},this),this.paginationModel.bind("change:current_page",function(a,b){this.options.pagedSearchModel.set("page",b),this.options.pagedSearchModel.fetch(this.collection)},this),this.add_related_model(this.options.pagedSearchModel),this.add_related_model(this.collection),this.add_related_model(this.paginationModel)},_toggleCleanSearchBtn:function(){this._$cleanSearchBtn().toggle(!!this.options.pagedSearchModel.get("q"))},_initViews:function(){this._panes=new d.ui.common.TabPane({el:this._$tabPane()}),this.addView(this._panes),this._panes.addTab("list",j.createByList([this._createListView(),new k({className:"CDB-Text CDB-Size-medium Pagination Pagination--shareList",model:this.paginationModel})])),this._panes.addTab("error",j.createByTemplate("common/templates/fail",{msg:""})),this._panes.addTab("no_results",j.createByTemplate("common/templates/no_results",{icon:this.options.noResults.icon||"CDB-IconFont-defaultUser",title:this.options.noResults.title||"Oh! No results",msg:this.options.noResults.msg||"Unfortunately we could not find anything with these parameters"})),this._panes.addTab("loading",j.createByTemplate("common/templates/loading",{title:"Searching",quote:i()})),this.options.pagedSearchModel.get("q")&&this._focusSearchInput(),this._activatePane(this._chooseActivePaneName(this.collection.totalCount()))},_createListView:function(){var a=this.options.createListView();return a instanceof d.core.View?a:(d.log.error("createListView function must return a view"),new d.core.View)},_activatePane:function(a){this._panes&&this._panes.size()>0&&this._panes.active(a).render()},_chooseActivePaneName:function(a){return 0===a?"no_results":a>0?"list":"loading"},_focusSearchInput:function(){this._$searchInput().focus().val(this._$searchInput().val())},_onSearchClick:function(a){this.killEvent(a),this._$searchInput().focus()},_onCleanSearchClick:function(a){this.killEvent(a),this._cleanSearch()},_onKeyDown:function(a){var b=a.keyCode==f.ui.keyCode.ENTER,c=a.keyCode==f.ui.keyCode.ESCAPE;b?(this.killEvent(a),this._submitSearch()):c&&(this.killEvent(a),this.options.pagedSearchModel.get("q")&&this._cleanSearch())},_submitSearch:function(a){this._makeNewSearch(g.stripHTML(this._$searchInput().val().trim()))},_cleanSearch:function(){this._$searchInput().val(""),this._makeNewSearch()},_makeNewSearch:function(a){this.options.pagedSearchModel.set({q:a,page:1}),this.options.pagedSearchModel.fetch(this.collection)},_$searchInput:function(){return this.$(".js-search-input")},_$cleanSearchBtn:function(){return this.$(".js-clean-search")},_$tabPane:function(){return this.$(".js-tab-pane")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_factory":108,"../../view_helpers/random_quote":112,"../pagination/model":129,"../pagination/view":130}],129:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=c.core.Model.extend({defaults:{total_count:0,per_page:10,current_page:1,display_count:5,extras_display_count:1,url_to:void 0},pagesCount:function(){return Math.max(Math.ceil(this.get("total_count")/this.get("per_page")),1)},isCurrentPage:function(a){return this.get("current_page")===a},shouldBeVisible:function(){var a=this.pagesCount();return this.get("total_count")>0&&a>1&&this.get("current_page")<=a},urlTo:function(a){if(this.hasUrl())return this.get("url_to")(a)},hasUrl:function(){return"function"==typeof this.get("url_to")},pagesToDisplay:function(){var a;return a=this._inLowRange()?1:this._inHighRange()?this.get("current_page")-this._startOffset():this.pagesCount()-this.get("display_count")+1,a=Math.max(a,1),this._withExtraPages(d.range(a,this._rangeEnd(a)))},_withExtraPages:function(a){var b=this.pagesCount(),c=this.get("extras_display_count"),e=d.range(1,c+1),f=d.range(b-c+1,b+1),g=a[0]-e.slice(-1)[0];2===g?e.push(a[0]-1):g>2&&e.push(-1);var h=f[0]-a.slice(-1);return 2===h&&f.unshift(f[0]-1),h>2&&f.unshift(-2),d.union(e,a,f)},_inLowRange:function(){return this.get("current_page")<this._startOffset()},_inHighRange:function(){return this.get("current_page")<this._highBoundary()},_highBoundary:function(){return this.pagesCount()-this._startOffset()},_startOffset:function(){return Math.floor(this.get("display_count")/2)},_rangeEnd:function(a){return Math.min(a+this.get("display_count"),this.pagesCount()+1)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],130:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("../../view_helpers/navigate_through_router");b.exports=d.core.View.extend({className:"Pagination CDB-Text CDB-Size-medium",events:{"click a":"_paginate"},initialize:function(){if(this.template=d.templates.getTemplate("common/views/pagination/template"),this.router=this.options.router,this.router&&!this.model.hasUrl())throw new Error("since router is set the model must have a url method set too");this.model.bind("change",this.render,this)},render:function(){return this.model.shouldBeVisible()?(this.$el.html(this.template({m:this.model,pagesCount:this.model.pagesCount(),currentPage:this.model.get("current_page")})),this.$el.addClass(this.className),this.delegateEvents()):this.$el.html(""),this},_paginate:function(a){this.router?f.apply(this,arguments):this.model.hasUrl()||this.killEvent(a);var b=e(a.target).data("page");this.model.set("current_page",b)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/navigate_through_router":110}],131:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({_TEMPLATES:{partial_import:"common/views/partial_import_details",too_many_files:"common/views/too_many_files_details",too_many_rows_connection:"common/views/too_many_rows_connection_details"},initialize:function(){this.warnings=this.options.warnings},render:function(){var a=this.warnings,b=this._getTemplateKey(a),d=c.templates.getTemplate(this._TEMPLATES[b]);return this.$el.html(d({warnings:a})),this},_getTemplateKey:function(a){return a.user_max_layers&&a.max_tables_per_import?a.user_max_layers<a.max_tables_per_import?"partial_import":"too_many_files":a.user_max_layers?"partial_import":a.max_tables_per_import?"too_many_files":a.max_rows_per_connection?"too_many_rows_connection":void 0}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],132:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({defaults:{content_type:"",page:1,q:"",tag:"",category:"",shared:"no",locked:!1,liked:!1,library:!1,order:"updated_at",deepInsights:!1},isSearching:function(){return this.get("q")||this.get("tag")},isDatasets:function(){return"datasets"===this.get("content_type")},isMaps:function(){return"maps"===this.get("content_type")},isDeepInsights:function(){return this.isMaps()&&this.get("deepInsights")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],133:[function(a,b,c){(function(c){var d=("undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,a("../common/background_polling/background_polling_model"));b.exports=d.extend({_onImportsStateChange:function(a){if(this.importsCollection.size()-this.importsCollection.failedItems().length===1&&a.hasCompleted()&&1===a.imp.get("tables_created_count")&&"twitter_search"!==a.imp.get("service_name")){var b=a.importedVis();if(b)return void this._redirectTo(encodeURI(b.viewUrl(this.user).edit()))}a.hasCompleted()&&this.trigger("importCompleted",a,this)},_redirectTo:function(a){window.location=a}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/background_polling/background_polling_model":1}],134:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,f="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null;e.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var g=a("./filters_view"),h=a("./list_view"),i=a("./content_result_view"),j=a("./onboarding_view"),k=a("./content_footer/view"),l=a("./datasets/loading_library_view");b.exports=e.core.View.extend({initialize:function(){this.user=this.options.user,this.router=this.options.router,this.localStorage=this.options.localStorage,this._initViews(),this._initBindings()},_initBindings:function(){this.router.model.bind("change",this._onRouterChange,this),this.collection.bind("reset",this._onDataFetched,this),this.collection.bind("loading",this._onDataLoading,this),this.collection.bind("add",this._onDataChange,this),this.collection.bind("error",function(a,b,c){(!b||b&&"abort"!==b.statusText)&&this._onDataError()},this),d(window).bind("scroll",this._onWindowScroll),this.add_related_model(this.router.model),this.add_related_model(this.collection)},_initViews:function(){this.controlledViews={},this.enabledViews=[];var a=new j({user:this.user});this.controlledViews.onboarding=a,this.$el.prepend(a.render().el),this.addView(a);var b=new g({el:this.$(".Filters"),headerHeight:this.options.headerHeight,user:this.user,router:this.router,collection:this.collection,localStorage:this.localStorage});this.controlledViews.filters=b,b.render(),this.addView(b);var c=new i({className:"ContentResult no-datasets",user:this.user,router:this.router,collection:this.collection,template:"dashboard/views/content_no_datasets"});c.bind("connectDataset",function(){this.user&&this.user.canCreateDatasets()&&e.god.trigger("openCreateDialog",{type:"dataset"})},this),this.controlledViews.no_datasets=c,this.$(".NoDatasets").append(c.render().el),this.addView(c);var d=new h({user:this.user,router:this.router,collection:this.collection}),f=this;e.god.bind("onTemplateSelected",function(a){f.player&&f.player.close()}),e.god.bind("startTutorial",function(a){f._addVideoPlayer(a)}),this._addVideoPlayer(),this.controlledViews.list=d,this.$("#content-list").append(d.render().el),this.addView(d);var m=new i({router:this.router,collection:this.collection,template:"dashboard/views/content_no_results"});this.controlledViews.no_results=m,this.$el.append(m.render().el),this.addView(m);var n=new i({router:this.router,collection:this.collection,template:"dashboard/views/content_error"}),o=new l;this.controlledViews.loading_library=o,this.$el.append(o.render().el),this.addView(o),this.controlledViews.error=n,this.$el.append(n.render().el),this.addView(n);var p=new i({router:this.router,collection:this.collection,template:"dashboard/views/content_loader"});this.controlledViews.main_loader=p,this.$el.append(p.render().el),this.addView(p);var q=new k({el:this.$("#content-footer"),model:this.user,router:this.router,collection:this.collection});this.controlledViews.content_footer=q,this.$("#content-footer").appendTo(this.$el),this.addView(q)},_onRouterChange:function(a,b){var c=[];b&&b.changes&&b.changes.content_type?c=["filters","main_loader"]:(c=["filters"],this._isBlockEnabled("list")&&this.collection.total_user_entries>0?c.push("list","content_footer"):c.push("main_loader"),(this._isBlockEnabled("no_results")||this._isBlockEnabled("error"))&&(f.contains(c,"main_loader")||c.push("main_loader"))),this._hideBlocks(),this._showBlocks(c),this._scrollToTop()},_onDataLoading:function(){this.$el.removeClass("on-boarding")},_onDataFetched:function(){var a=["filters","content_footer"],b=this.router.model.get("tag"),c=this.router.model.get("q"),d=this.router.model.get("shared"),f=this.router.model.get("liked"),g=this.router.model.get("locked"),h=this.router.model.get("library");if(h&&0===this.collection.total_user_entries&&a.push("no_datasets"),0===this.collection.size())if(b||c||"no"!==d||g||f)a.push("no_results");else if("maps"===this.router.model.get("content_type")){if(this.collection.total_shared>0)return void this.router.navigate(this.user.viewUrl().dashboard().maps().urlToPath("shared"),{trigger:!0});this.$el.addClass("on-boarding"),a=["onboarding","filters"]}else if(h)a.push("loading_library"),this.controlledViews.loading_library.retrySoonAgainOrAbortIfLeavingLibrary(this.collection,this.router.model);else if(h||"datasets"!==this.router.model.get("content_type"))a.push("no_results");else{if(this.collection.total_shared>0)return void this.router.navigate(this.user.viewUrl().dashboard().datasets().urlToPath("shared"),{trigger:!0});if(this.user.hasCreateDatasetsFeature()&&e.config.get("data_library_enabled"))return void this.router.navigate(this.user.viewUrl().dashboard().datasets().dataLibrary(),{trigger:!0});a.push("no_results")}else a.push("list");this._hideBlocks(),this._showBlocks(a)},_onDataChange:function(){this.collection.fetch()},_onDataError:function(a){this._hideBlocks(),this._showBlocks(["filters","error"])},_showBlocks:function(a){var b=this;a?f.each(a,function(a){b.controlledViews[a].show(),b.enabledViews.push(a)}):(b.enabledViews=[],f.each(this.controlledViews,function(a){a.show(),b.enabledViews.push(a)}))},_hideBlocks:function(a){var b=this;a?f.each(a,function(a){b.controlledViews[a].hide(),b.enabledViews=f.without(b.enabledViews,a)}):(f.each(this.controlledViews,function(a){a.hide()}),b.enabledViews=[])},_isBlockEnabled:function(a){return!!a&&f.contains(this.enabledViews,a)},_scrollToTop:function(){d("body").animate({scrollTop:0},550)},_addVideoPlayer:function(a){var b={id:a};this.player=new e.admin.VideoPlayer(b),this.player.hasVideoData()&&this.$el.append(this.player.render().$el)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./content_footer/view":135,"./content_result_view":136,"./datasets/loading_library_view":138,"./filters_view":143,"./list_view":145,"./onboarding_view":151}],135:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../common/views/pagination/model"),f=a("../../common/views/pagination/view"),g=a("../../common/view_helpers/pluralize_string"),h=a("../../common/view_helpers/navigate_through_router"),i="filter-shortcut",j={};j["click #"+i+" a"]=h,b.exports=d.core.View.extend({events:j,initialize:function(a){if(!a.el)throw new Error("The root element must be provided from parent view");this.collection=a.collection,this.router=a.router,this.router.model.bind("change",this.render,this),this.add_related_model(this.router.model),this._createPaginationView(this.collection,this.router),this._setupFilterShortcut(this.collection,this.router)},render:function(){return this.clearSubViews(),this._renderFilterShortcut(),this._renderPaginationView(),this},_createPaginationView:function(a,b){var c=new e({current_page:b.model.get("page"),url_to:function(a){return b.currentUrl({page:a})}});a.bind("all",_.partial(this._updatePaginationModelByCollection,c,a)),b.model.bind("change",_.partial(this._updatePaginationModelByRouter,c,b.model)),this.paginationView=new f({model:c,router:this.router}),this.addView(this.paginationView)},_updatePaginationModelByCollection:function(a,b){a.set({per_page:b.options.get("per_page"),total_count:b.total_entries})},_updatePaginationModelByRouter:function(a,b){a.set("current_page",b.get("page"))},_renderFilterShortcut:function(){this.$el.append('<div id="'+i+'"></div>'),this._renderFilterShortcut=function(){var a="",b=this.router.model,c=this.router.currentDashboardUrl(),d=this.filterShortcutVis.total_entries,e={totalCount:d,pluralizedContents:this._pluralizedContentType(d),url:b.get("locked")?c:c.lockedItems()};b.get("locked")?a=this.filterShortcutNonLockedTemplate(e):d>0&&this._isLockInfoNeeded()&&(a=this.filterShortcutLockedTemplate(e)),this.$("#"+i).html(a)}},_pluralizedContentType:function(a){var b=this.router.model.get("content_type").slice(0,-1);return g(b,a)},_setupFilterShortcut:function(a,b){this.filterShortcutLockedTemplate=d.templates.getTemplate("dashboard/content_footer/filter_shortcut/locked_template"),this.filterShortcutNonLockedTemplate=d.templates.getTemplate("dashboard/content_footer/filter_shortcut/non_locked_template"),this.filterShortcutVis=new d.admin.Visualizations,a.bind("loaded",this._updateFilterShortcut,this),this.add_related_model(a)},_isLockInfoNeeded:function(){return"no"===this.router.model.get("shared")&&!this.router.model.get("library")&&!this.router.model.isSearching()},_updateFilterShortcut:function(){if(this._isLockInfoNeeded()){this.filterShortcutVis.options.set({locked:!this.router.model.get("locked"),shared:"no",page:1,per_page:1,only_liked:this.router.model.get("liked"),q:this.router.model.get("q"),tag:this.router.model.get("tags"),type:"datasets"===this.router.model.get("content_type")?"table":"derived"});var a=this;this.filterShortcutVis.fetch({success:function(b){a.render()}})}else this.render()},_renderPaginationView:function(){this.paginationView.render(),this.$el.append(this.paginationView.el)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/navigate_through_router":110,"../../common/view_helpers/pluralize_string":111,"../../common/views/pagination/model":129,"../../common/views/pagination/view":130}],136:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var e=a("../common/view_helpers/navigate_through_router"),f=a("../common/view_helpers/random_quote");b.exports=d.core.View.extend({events:{"click .js-mail-link":"_onMailClick","click .js-link":e,"click .js-connect":"_onConnectClick"},initialize:function(){this.user=this.options.user,this.router=this.options.router,this.template=d.templates.getTemplate(this.options.template),this._initBinds()},render:function(){return this.$el.html(this.template({defaultUrl:this.router.currentDashboardUrl(),page:this.router.model.get("page"),tag:this.router.model.get("tag"),q:this.router.model.get("q"),shared:this.router.model.get("shared"),liked:this.router.model.get("liked"),locked:this.router.model.get("locked"),library:this.router.model.get("library"),isSearching:this.router.model.isSearching(),quote:f(),type:this.router.model.get("content_type"),totalItems:this.collection.size(),totalEntries:this.collection.total_entries})),this},_initBinds:function(){this.router.model.bind("change",this.render,this),this.collection.bind("remove add reset",this.render,this),this.add_related_model(this.router.model),this.add_related_model(this.collection)},_onMailClick:function(a){a&&a.stopPropagation()},_onConnectClick:function(a){a&&a.preventDefault(),this.trigger("connectDataset",this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/view_helpers/navigate_through_router":110,"../common/view_helpers/random_quote":112}],137:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.moment:"undefined"!=typeof c?c.moment:null,f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,g=a("../../common/view_helpers/navigate_through_router"),h=a("../../common/view_helpers/pluralize_string"),i=a("../../common/views/likes/view"),j=a("../../dashboard/editable_fields/editable_description"),k=a("../../dashboard/editable_fields/editable_tags"),l=a("../../common/dialogs/sync_dataset/sync_dataset_view");b.exports=d.core.View.extend({tagName:"li",className:"DatasetsList-item DatasetsList-item--selectable",events:{"click .js-tag-link":g,"click .js-privacy":"_openPrivacyDialog","click .js-sync":"_openSyncDialog",click:"_selectDataset"},initialize:function(){this.user=this.options.user,this.router=this.options.router,this.template=d.templates.getTemplate("dashboard/views/datasets_item"),this._initBinds()},render:function(){this.clearSubViews();var a=this.model,b=a.tableMetadata(),c=a.get("tags")||[],d=a.viewUrl(this.user);d=this.router.model.get("liked")&&!a.permission.hasAccess(this.user)?d.public():d.edit();var g={isRaster:"raster"===a.get("kind"),geometryType:b.statsGeomColumnTypes().length>0?b.statsGeomColumnTypes()[0]:"",title:a.get("name"),datasetUrl:encodeURI(d),isOwner:a.permission.isOwner(this.user),owner:a.permission.owner.renderData(this.user),showPermissionIndicator:!a.permission.hasWriteAccess(this.user),privacy:a.get("privacy").toLowerCase(),likes:a.get("likes")||0,timeDiff:e(a.get("updated_at")).fromNow(),tags:c,tagsCount:c.length,router:this.router,maxTagsToShow:3,rowCount:void 0,datasetSize:void 0,syncStatus:void 0,syncRanAt:void 0,fromExternalSource:""},i=b.get("row_count");i>=0&&(g.rowCount=i<1e4?f.formatNumber(i):f.readizableNumber(i),g.pluralizedRows=h("Row",i)),_.isEmpty(a.get("synchronization"))||(g.fromExternalSource=a.get("synchronization").from_external_source);var j=b.get("size");return j>=0&&(g.datasetSize=f.readablizeBytes(j,!0)),_.isEmpty(a.get("synchronization"))||(g.syncRanAt=e(a.get("synchronization").ran_at||new Date).fromNow(),g.syncStatus=a.get("synchronization").state),this.$el.html(this.template(g)),this._renderDescription(),this._renderTags(),this._renderLikesIndicator(),this._renderTooltips(),this.$el[a.get("selected")?"addClass":"removeClass"]("is--selected"),this},_initBinds:function(){this.model.on("change",this.render,this)},_renderDescription:function(){var a=this.model.permission.isOwner(this.user),b=new j({el:this.$(".js-item-description"),model:this.model,editable:a&&this.user.hasCreateDatasetsFeature()});this.addView(b.render())},_renderTags:function(){var a=this.model.permission.isOwner(this.user),b=new k({el:this.$(".js-item-tags"),model:this.model,router:this.router,editable:a&&this.user.hasCreateDatasetsFeature()});this.addView(b.render())},_renderLikesIndicator:function(){var a=new i({model:this.model.like});this.$(".js-likes-indicator").replaceWith(a.render().el),this.addView(a)},_renderTooltips:function(){var a=this.model.get("synchronization");_.isEmpty(a)||this.addView(new d.common.TipsyTooltip({el:this.$(".js-syncInfo"),title:function(a){return $(this).attr("data-title")}})),this.model.permission.isOwner(this.user)||this.addView(new d.common.TipsyTooltip({el:this.$(".UserAvatar"),title:function(a){return $(this).attr("data-title")}})),!_.isEmpty(a)&&a.from_external_source&&this.addView(new d.common.TipsyTooltip({el:this.$(".js-public"),title:function(a){return $(this).attr("data-title")}}))},_openPrivacyDialog:function(a){this.killEvent(a),d.god.trigger("openPrivacyDialog",this.model)},_openSyncDialog:function(a){this.killEvent(a);var b=new l({clean_on_hide:!0,enter_to_confirm:!0,table:this.model.tableMetadata()}),c=this,d=b.ok;b.ok=function(){d.apply(b,arguments),c.model.fetch()},b.appendToBody()},_selectDataset:function(a){"A"!==a.target.tagName&&(this.killEvent(a),this.model.set("selected",!this.model.get("selected")));
}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/dialogs/sync_dataset/sync_dataset_view":86,"../../common/view_helpers/navigate_through_router":110,"../../common/view_helpers/pluralize_string":111,"../../common/views/likes/view":126,"../../dashboard/editable_fields/editable_description":140,"../../dashboard/editable_fields/editable_tags":141}],138:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({render:function(){return this.$el.html(c.templates.getTemplate("common/templates/loading")({title:"Your Data library is being stocked up",quote:"Please wait while we load the list of Datasets in the Data library for you."})),this},retrySoonAgainOrAbortIfLeavingLibrary:function(a,b){var c,d=function(){clearTimeout(c),b.unbind("all",d),a.unbind("reset",d)},e=function(){c=setTimeout(function(){a.bind("reset",d),a.fetch()},1e4)};b.bind("all",d),e()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],139:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../../dashboard/datasets/datasets_item"),f=a("../../common/view_helpers/navigate_through_router"),g=a("../../common/background_polling/models/upload_config"),h="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,i=a("../../common/view_helpers/pluralize_string");b.exports=e.extend({tagName:"li",className:"DatasetsList-item",events:{"click .js-tag-link":f,click:"_selectDataset"},initialize:function(){this.user=this.options.user,this.router=this.options.router,this.template=d.templates.getTemplate("dashboard/views/remote_datasets_item"),this.table=new d.admin.CartoDBTableMetadata(this.model.get("external_source")),this._initBinds()},render:function(){var a=this.model,b=this.table,c=a.get("tags")||[],d=a.get("description")&&h.stripHTML(markdown.toHTML(a.get("description")))||"",e=a.get("source")&&markdown.toHTML(a.get("source"))||"",f={isRaster:"raster"===a.get("kind"),geometryType:b.statsGeomColumnTypes().length>0?b.statsGeomColumnTypes()[0]:"",title:a.get("display_name")||a.get("name"),source:e,description:d,timeDiff:moment(a.get("updated_at")).fromNow(),tags:c,tagsCount:c.length,router:this.router,maxTagsToShow:3,canImportDataset:this._canImportDataset(),rowCount:void 0,datasetSize:void 0,fromExternalSource:""},g=b.get("row_count");g>=0&&(f.rowCount=g<1e4?h.formatNumber(g):h.readizableNumber(g),f.pluralizedRows=i("Row",g)),_.isEmpty(a.get("synchronization"))||(f.fromExternalSource=a.get("synchronization").from_external_source);var j=b.get("size");return j>=0&&(f.datasetSize=h.readablizeBytes(j,!(j.toString().length>9))),this.$el.html(this.template(f)),this._setItemClasses(),this._renderTooltips(),this},_renderTooltips:function(){this.addView(new d.common.TipsyTooltip({el:this.$(".DatasetsList-itemStatus"),title:function(a){return $(this).attr("data-title")}}))},_setItemClasses:function(){this.$el[this.model.get("selected")?"addClass":"removeClass"]("is--selected"),this.$el[this._canImportDataset()?"addClass":"removeClass"]("DatasetsList-item--selectable"),this.$el[this._canImportDataset()?"removeClass":"addClass"]("DatasetsList-item--banned")},_canImportDataset:function(){var a=this.table.get("size")||0;return this.user.get("remaining_byte_quota")*g.fileTimesBigger>=a&&this.user.get("limits").import_file_size>a},_selectDataset:function(a){"A"!==a.target.tagName&&this._canImportDataset()&&(this.killEvent(a),this.model.set("selected",!this.model.get("selected")))}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/background_polling/models/upload_config":13,"../../common/view_helpers/navigate_through_router":110,"../../common/view_helpers/pluralize_string":111,"../../dashboard/datasets/datasets_item":137}],140:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{"click .js-add-btn":"_edit","click .js-field-input":"killEvent","blur .js-field-input":"_cancelEditing","keydown .js-field-input":"_keyPressed"},options:{editable:!0,maxLength:200},initialize:function(){this.template=c.templates.getTemplate("dashboard/editable_fields/editable_description"),this.$el.addClass("EditableField")},render:function(){var a=c.core.sanitize.html(markdown.toHTML(this.model.get("description")||"")),b={safeHTML:a,clean:c.Utils.stripHTML(a)};return this.$el.html(this.template({value:b,editable:this.options.editable,maxLength:this.options.maxLength})),this},_edit:function(a){this.killEvent(a),this.$el.addClass("is-editing"),this.$(".js-field-input").val("").focus()},_keyPressed:function(a){var b=a.keyCode==$.ui.keyCode.ESCAPE,c=(a.metaKey||a.ctrlKey)&&a.keyCode==$.ui.keyCode.ENTER,d=a.keyCode==$.ui.keyCode.ENTER,e=this.$(".js-field-input").val();c?(a.preventDefault(),this._addNewLine()):d&&""!=e.trim()?(a.preventDefault(),this._save()):b&&this._cancelEditing()},_addNewLine:function(){var a=this.$(".js-field-input");a.val(a.val()+"\n"),a[0].scrollTop=a[0].scrollHeight},_save:function(){var a={description:this.$(".js-field-input").val()};this.model.save(a),this.$el.removeClass("is-editing"),this.render()},_cancelEditing:function(){this.$el.removeClass("is-editing")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],141:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({events:{"click .js-add-btn":"_edit","click .js-field-input":"killEvent","keydown .js-field-input":"_keyPressed","blur .js-field-input":"_cancelEditing"},initialize:function(){this.template=c.templates.getTemplate("dashboard/editable_fields/editable_tags"),this.editable=this.options.editable,this.$el.addClass("EditableField")},render:function(){var a=this.model.get("tags")||[];return this.$el.html(this.template({tags:_.compact(a),tagsCount:a.length,editable:this.editable,router:this.options.router})),this},_edit:function(a){this.killEvent(a),this.$el.addClass("is-editing"),this.$(".js-field-input").val("").focus()},_keyPressed:function(a){var b=a.keyCode==$.ui.keyCode.ENTER,c=a.keyCode==$.ui.keyCode.ESCAPE;b?this._save():c&&this._cancelEditing()},_save:function(){var a=this.$(".js-field-input").val().split(",").map(function(a){return c.Utils.stripHTML(a.trim())});a=_.chain(a).compact().uniq().value(),this.model.save({tags:a}),this.$el.removeClass("is-editing"),this.render()},_cancelEditing:function(a){this.$el.removeClass("is-editing")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],142:[function(a,b,c){(function(b){var c="undefined"!=typeof window?window.$:"undefined"!=typeof b?b.$:null,d="undefined"!=typeof window?window._:"undefined"!=typeof b?b._:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof b?b.cdb:null,f=a("./router"),g=a("./main_view"),h=a("../common/dialogs/change_privacy/change_privacy_view"),i=a("../common/dialogs/create/create_view"),j=a("../common/dialogs/create/create_dataset_model"),k=a("../common/dialogs/create/create_map_model"),l=a("../common/dialogs/video_tutorial/video_tutorial_view"),m=a("../common/user_notification/user_notification_view"),n=a("../common/user_notification/user_notification_model"),o="Untitled map";window.trackJs&&window.trackJs.configure({userId:window.user_data.username}),c(function(){e.init(function(){e.templates.namespace="cartodb/",e.config.set("url_prefix",user_data.base_url),e.config.set("default_fallback_basemap",window.default_fallback_basemap),e.config.set(window.config);var a=new e.admin.User(window.user_data);e.config.set("user",a);var b=new f({dashboardUrl:a.viewUrl().dashboard()});if(!e.config.get("cartodb_com_hosted")&&a.get("actions").builder_enabled&&a.get("show_builder_activated_message")&&d.isEmpty(window.dashboard_notifications)){var c=new n(window.dashboard_notifications,{key:"dashboard",configModel:e.config}),p=new m({notification:c});window.dashboardNotification=p}var q=new e.admin.Visualizations,r=new g({el:document.body,collection:q,user:a,config:window.config,router:b});window.dashboard=r,b.enableAfterMainView();new e.admin.Metrics;e.god.trigger("metrics","visited_dashboard",{email:window.user_data.email}),window.isJustLoggedIn&&e.god.trigger("metrics","logged_in",{email:window.user_data.email}),window.isFirstTimeViewingDashboard&&e.god.trigger("metrics","visited_dashboard_first_time",{email:window.user_data.email}),e.god.bind("openPrivacyDialog",function(b){if(b.isOwnedByUser(a)&&a.hasCreateDatasetsFeature()){var c=new h({vis:b,user:a,enter_to_confirm:!0,clean_on_hide:!0});c.appendToBody()}}),e.god.bind("openCreateDialog",function(c){var f;c=c||{},f="dataset"===c.type?new j({},{user:a}):new k({},d.extend({user:a},c));var g=new i({model:f,user:a,clean_on_hide:!0});f.bind("startTutorial",function(){g.close();var a=new l({clean_on_hide:!0,enter_to_confirm:!1});e.god.trigger("onTemplateSelected",this),a.appendToBody()}),f.bind("datasetCreated",function(c){if(b.model.isDatasets()){var d=new e.admin.Visualization({type:"table"});d.permission.owner=a,d.set("table",c.toJSON()),window.location=d.viewUrl(a).edit()}else{var d=new e.admin.Visualization({name:o});d.save({tables:[c.get("id")]},{success:function(b){window.location=d.viewUrl(a).edit()},error:function(a){g.close(),q.trigger("error")}})}},this),g.appendToBody(),f.viewsReady()})})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/dialogs/change_privacy/change_privacy_view":26,"../common/dialogs/create/create_dataset_model":39,"../common/dialogs/create/create_map_model":44,"../common/dialogs/create/create_view":45,"../common/dialogs/video_tutorial/video_tutorial_view":93,"../common/user_notification/user_notification_model":106,"../common/user_notification/user_notification_view":107,"./main_view":146,"./router":152}],143:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,g="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,h=a("../common/view_helpers/navigate_through_router"),i=a("../common/view_helpers/pluralize_string"),j=a("../common/dialogs/duplicate_vis_view"),k=a("../common/dialogs/delete_items_view"),l=a("../common/dialogs/change_lock/change_lock_view"),m=a("../common/dialogs/change_lock/change_lock_view_model"),n=a("../common/dialogs/delete_items_view_model");b.exports=d.core.View.extend({_TOOLTIPS:["js-likes","js-mapviews","js-updated_at","js-size"],events:{"submit .js-search-form":"_submitSearch","keydown .js-search-form":"_onSearchKeyDown","click .js-search-form":"killEvent","click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","click .js-deselect_all":"_unselectAll","click .js-select_all":"_selectAll","click .js-order-link":"_changeOrder","click .js-delete":"_openDeleteItemsDialog","click .js-create_map":"_createMap","click .js-import_remote":"_importRemote","click .js-new_dataset":"_connectDataset","click .js-duplicate_dataset":"_duplicateDataset","click .js-duplicate_map":"_duplicateMap","click .js-new_map":"_newMap","click .js-lock":"_openChangeLockDialog","click .js-privacy":"_openPrivacyDialog","click .js-link":h},initialize:function(){this.router=this.options.router,this.user=this.options.user,this.localStorage=this.options.localStorage,this.model=new d.core.Model,this._preRender(),this._initBinds()},_preRender:function(){var a=e("<div>").addClass("u-inner"),b=e("<div>").addClass("Filters-inner js-skip-unselect-all");this.$el.append(a.append(b))},render:function(a,b){this.clearSubViews();var c=this._selectedItems().length,e=b&&b.changes&&b.changes.content_type,g=this.router.model.get("content_type"),h=this.router.model.isDeepInsights(),j=h?"dashboard":g.slice(0,-1),k=d.templates.getTemplate(h?"dashboard/views/filters_deep_insights":"dashboard/views/filters"),l=i(j,e?0:this.collection.total_user_entries),m=i(j,c);return this.$(".Filters-inner").html(k(f.extend({canCreateDatasets:this.user.canCreateDatasets(),hasCreateMapsFeature:this.user.hasCreateMapsFeature(),hasCreateDatasetsFeature:this.user.hasCreateDatasetsFeature(),canDeleteItems:this._canDeleteSelectedItems(),order:this.localStorage.get("dashboard.order"),isInsideOrg:this.user.isInsideOrg(),isMaps:this.router.model.isMaps(),selectedItemsCount:c,isSelectedItemLibrary:this._isSelectedItemLibrary(),maxLayersByMap:this.user.getMaxLayers(),totalShared:e?0:this.collection.total_shared,totalLiked:e?0:this.collection.total_likes,totalItems:e?0:this.collection.total_user_entries,pageItems:this.collection.size(),router:this.router,currentDashboardUrl:this.router.currentDashboardUrl(),pluralizedContentType:l,pluralizedContentTypeSelected:m},this.router.model.attributes))),this._initViews(),this._checkScroll(),this._animate(),this.router.model.isSearching()&&this._focusSearchInput(),this},_initBinds:function(){this.model.on("change:isSearchEnabled",this._onChangeIsSearchEnabled,this),this.router.model.bind("change",this.render,this),this.collection.bind("loading",function(){this.$el.removeClass("is-relative")},this),this.collection.bind("add remove change reset",this.render,this),this.user.bind("change:remaining_byte_quota",this.render,this),d.god.bind("closeDialogs",this._animate,this),d.god.bind("unselectAllItems",this._unselectAll,this),f.bindAll(this,"_onWindowScroll"),this.add_related_model(this.collection),this.add_related_model(this.router.model),this.add_related_model(this.user),this.add_related_model(d.god)},_checkScroll:function(){var a=this.router.model.get("content_type"),b=this.router.model.get("shared"),c=this.router.model.get("locked"),d=this.router.model.get("liked"),e=this.router.model.isSearching(),f=this.collection.total_entries;0!==f||"maps"!==a||"no"!==b||c||d||e?(this.$el.removeClass("is-relative"),this._bindScroll()):(this.$el.addClass("is-relative"),this._unbindScroll())},_bindScroll:function(){this._unbindScroll(),e(window).bind("scroll",this._onWindowScroll)},_unbindScroll:function(){e(window).unbind("scroll",this._onWindowScroll)},_initViews:function(){var a=this;f.each(this._TOOLTIPS,function(b){a.addView(new d.common.TipsyTooltip({el:a.$("."+b),title:function(){var b=a.$el.hasClass("is-fixed");return b?"":"Order by "+e(this).attr("data-title")}}))})},_selectedItems:function(){return this.collection.where({selected:!0})},_animate:function(){this.$(".Filters-inner").toggleClass("show-second-row",this._selectedItems().length>0),this._enableSearchUI(!!this.router.model.isSearching())},_selectAll:function(a){this._select(a,!0)},_unselectAll:function(a){this._select(a,!1)},_select:function(a,b){this.killEvent(a);this.user;this.collection.each(function(a){a.set("selected",b)})},_openDeleteItemsDialog:function(a){a.preventDefault();var b=new n(this._selectedItems(),{contentType:this.router.model.get("content_type")});b.bind("DeleteItemsDone",function(){this.user.fetch(),this.collection.fetch()},this);var c=new k({viewModel:b,user:this.user,clean_on_hide:!0,enter_to_confirm:!0});c.appendToBody()},_openChangeLockDialog:function(a){a.preventDefault();var b=new m({items:this._selectedItems(),contentType:this.router.model.get("content_type")});b.bind("change:state",function(){"ProcessItemsDone"===b.get("state")&&this.collection.fetch()},this);var c=new l({model:b,clean_on_hide:!0,enter_to_confirm:!0});c.appendToBody()},_openPrivacyDialog:function(a){a.preventDefault(),d.god.trigger("openPrivacyDialog",this._selectedItems()[0])},_onSearchClick:function(a){this.killEvent(a),this.model.set("isSearchEnabled",!this.model.get("isSearchEnabled"))},_onChangeIsSearchEnabled:function(a,b){this._enableSearchUI(b),this.router.model.isSearching()?this._cleanSearch():b&&(this._$searchInput().val(""),this._focusSearchInput())},_$searchInput:function(){return this.$(".js-search-input")},_focusSearchInput:function(){this._$searchInput().select(),this._$searchInput().focus()},_enableSearchUI:function(a){this.$(".js-search-field").toggle(a),this.$(".js-links-list").toggle(!a),this.$(".js-order-list").toggle(!a)},_onSearchKeyDown:function(a){27===a.keyCode&&this._cleanSearch()},_createMap:function(a){a&&a.preventDefault(),this._openCreateDialog("map",!0)},_newMap:function(a){a&&a.preventDefault(),d.god.trigger("metrics","create_map",{email:window.user_data.email}),this._openCreateDialog("map")},_connectDataset:function(a){a&&a.preventDefault(),d.god.trigger("metrics","connect_dataset",{email:window.user_data.email}),this.user.canCreateDatasets()&&this._openCreateDialog("dataset")},_duplicateDataset:function(a){a&&this.killEvent(a);var b=this._selectedItems();if(1===b.length){var c=b[0],e=c.tableMetadata(),f=e.get("name");d.god.trigger("importByUploadData",{type:"duplication",table_name:e.getUnqualifiedName()+"_copy",value:f,create_vis:!1})}},_duplicateMap:function(a){a&&this.killEvent(a);var b=this._selectedItems();if(1===b.length){var c=b[0],d=c.tableMetadata();new j({model:c,table:d,user:this.user,clean_on_hide:!0}).appendToBody()}},_importRemote:function(a){a&&this.killEvent(a);var b=this._selectedItems();if(1===b.length){var c=b[0],e=c.get("table"),f={type:"remote",value:c.get("name"),remote_visualization_id:c.get("id"),size:e&&e.size,create_vis:!1};d.god.trigger("importByUploadData",f,this),this._select(!1)}},_openCreateDialog:function(a,b){d.god.trigger("openCreateDialog",{type:a,selectedItems:b?this._selectedItems():[]})},_onCleanSearchClick:function(a){this.killEvent(a),this._cleanSearch()},_submitSearch:function(a){this.killEvent(a),this._navigateToUrl({search:g.stripHTML(this.$(".js-search-input").val().trim(),""),page:1,liked:!1,shared:"no",library:!1,locked:!1})},_cleanSearch:function(){this._navigateToUrl({search:"",liked:!1,library:!1,shared:"no"}),this.model.set("isSearchEnabled",!1)},_navigateToUrl:function(a){this.router.navigate(this.router.currentUrl(a),{trigger:!0})},_changeOrder:function(a){a&&a.preventDefault();var b=e(a.target).closest(".js-order-link"),c="updated_at";b.hasClass("js-mapviews")&&(c="mapviews"),b.hasClass("js-likes")&&(c="likes"),b.hasClass("js-size")&&(c="size"),this.router.model.get("order")!==c&&(this.localStorage.set({"dashboard.order":c}),this.router.model.set("order",c))},_onWindowScroll:function(){var a=e(window).scrollTop(),b=this.options.headerHeight+(this.user.get("notification")?this.options.headerHeight:0);this.$el[a>b?"addClass":"removeClass"]("is-fixed with-long-separator")},_canDeleteSelectedItems:function(){var a=this;return!f.find(this._selectedItems(),function(b){return!b.permission.isOwner(a.user)||"remote"===b.get("type")})},_isSelectedItemLibrary:function(){var a=this._selectedItems();return 1===a.length&&"remote"===a[0].get("type")},clean:function(){this._unbindScroll(),d.core.View.prototype.clean.call(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/dialogs/change_lock/change_lock_view":24,"../common/dialogs/change_lock/change_lock_view_model":25,"../common/dialogs/delete_items_view":80,"../common/dialogs/delete_items_view_model":81,"../common/dialogs/duplicate_vis_view":82,"../common/view_helpers/navigate_through_router":110,"../common/view_helpers/pluralize_string":111}],144:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.Model.extend({initialize:function(a){this.router=a,this.router.model.bind("change",this.trigger.bind(this,"change"))},breadcrumbTitle:function(){var a=this.router.model.get("content_type");return this.isDisplayingLockedItems()?"Locked "+a:this.isDisplayingDeepInsights()?"Deep insights":a&&a[0].toUpperCase()+a.slice(1)},isBreadcrumbDropdownEnabled:function(){return!0},isDisplayingDatasets:function(){return"datasets"===this.router.model.get("content_type")},isDisplayingMaps:function(){return"maps"===this.router.model.get("content_type")},isDisplayingLockedItems:function(){return!!this.router.model.get("locked")},isDisplayingDeepInsights:function(){var a=this.router.model;return a.isDeepInsights()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],145:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("./datasets/datasets_item"),g=a("./maps/maps_item"),h=a("./maps/deep_insights_item"),i=a("./maps/placeholder_item_view"),j=a("./datasets/remote_datasets_item"),k=a("../common/map_templates"),l=3;b.exports=d.core.View.extend({tagName:"ul",events:{},_ITEMS:{remotes:j,datasets:f,deepInsights:h,maps:g},initialize:function(){this.router=this.options.router,this.user=this.options.user,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.attr("class",this.router.model.isDatasets()?"DatasetsList":"MapsList"),this.collection.each(this._addItem,this),this.router.model.isMaps()&&this.collection.size()>0&&this._fillEmptySlotsWithPlaceholderItems(),this},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")},_addItem:function(a){var b=this.router.model.get("content_type");"remote"===a.get("type")&&this.router.model.isDatasets()&&(b="remotes"),this.router.model.isDeepInsights()&&(b="deepInsights");var c=new this._ITEMS[b]({model:a,router:this.router,user:this.user});this.addView(c),this.$el.append(c.render().el)},_initBinds:function(){this.collection.bind("loading",this._onItemsLoading,this),this.collection.bind("reset",this.render,this),this.add_related_model(this.collection)},_onItemsLoading:function(){this.$el.addClass("is-loading")},_fillEmptySlotsWithPlaceholderItems:function(){var a=e.shuffle(k);e.times(this._emptySlotsCount(),function(b){var c=a[b];if(c){var e=new d.core.Model(c),f=new i({model:e,collection:this.collection});this.$el.append(f.render().el),this.addView(f)}},this)},_emptySlotsCount:function(){return(this.collection._ITEMS_PER_PAGE-this.collection.size())%l}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/map_templates":98,"./datasets/datasets_item":137,"./datasets/remote_datasets_item":139,"./maps/deep_insights_item":147,"./maps/maps_item":148,"./maps/placeholder_item_view":149}],146:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,e="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;e.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var f=a("../common/local_storage"),g=a("../common/views/dashboard_header_view"),h=a("../common/support_view"),i=a("../common/mamufas_import/mamufas_import_view"),j=a("../common/background_polling/background_polling_view"),k=a("./background_polling_model"),l=a("./content_controller_view"),m=a("./header_view_model");b.exports=e.core.View.extend({events:{click:"_onClick"},initialize:function(){this._initModels(),this._initViews(),this._initBindings()},_initBindings:function(){this.router.model.bind("change",this._onRouterChange,this),this.add_related_model(this.router.model)},_initModels:function(){this.user=this.options.user,this.router=this.options.router,this.localStorage=new f,this.router.model.set("order",this.localStorage.get("dashboard.order"),{silent:!0}),this.router.model.set("category",this.localStorage.get("dashboard.category"),{silent:!0})},_onRouterChange:function(a,b){this._fetchCollection(a,b),this._backgroundPollingView.createVis=this.router.model.isMaps()},_fetchCollection:function(a,b){var c=this.router.model.attributes,d=this.localStorage.get("dashboard.order")||"updated_at";"maps"===c.content_type&&"size"===d&&(d="updated_at");var e="datasets"===c.content_type?"table":"derived";c.library&&(e="remote"),(c.q||c.tag)&&"datasets"===c.content_type&&(e="table,remote"),this.collection.options.set({q:c.q,page:c.page||1,tags:c.tag,per_page:this.collection["_"+("datasets"===c.content_type?"TABLES":"ITEMS")+"_PER_PAGE"],shared:c.shared,locked:c.liked?"":c.locked,only_liked:c.liked,order:d,types:e,type:"",deepInsights:!!c.deepInsights}),this.collection.fetch()},_initViews:function(){var a=new k({showGeocodingDatasetURLButton:!0,geocodingsPolling:!0,importsPolling:!0},{user:this.user});this._backgroundPollingView=new j({model:a,createVis:this.router.model.isMaps(),user:this.user}),a.bind("importCompleted",function(){this.collection.fetch(),this.user.fetch()},this),this.$el.append(this._backgroundPollingView.render().el),this.addView(this._backgroundPollingView);var b=new i({el:this.$el,user:this.user});e.god.bind("dialogOpened",function(){b.disable(),a.stopPollings()},this),e.god.bind("dialogClosed",function(){b.enable(),a.startPollings()},this),b.render(),b.enable();var c=new g({el:this.$("#header"),model:this.user,viewModel:new m(this.router),router:this.router,collection:this.collection,localStorage:this.localStorage});c.render(),this.controllerView=new l({el:this.$("#content-controller"),headerHeight:this.$("#header").height(),user:this.user,router:this.router,collection:this.collection,localStorage:this.localStorage}),this.controllerView.render();var d=new h({el:this.$("#support-banner"),user:this.user});d.render()},_onClick:function(a){this._isEventTriggeredOutsideOf(a,".Dialog")&&(e.god.trigger("closeDialogs"),this._isEventTriggeredOutsideOf(a,".js-skip-unselect-all")&&e.god.trigger("unselectAllItems"))},_isEventTriggeredOutsideOf:function(a,b){return 0===d(a.target).closest(b).length}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/background_polling/background_polling_view":2,"../common/local_storage":95,"../common/mamufas_import/mamufas_import_view":97,"../common/support_view":105,"../common/views/dashboard_header_view":123,"./background_polling_model":133,"./content_controller_view":134,"./header_view_model":144}],147:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.moment:"undefined"!=typeof c?c.moment:null;a("../../common/view_helpers/navigate_through_router"),"undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null,b.exports=d.core.View.extend({className:"MapsList-item",tagName:"li",initialize:function(){this.router=this.options.router,this.user=this.options.user,this.template=d.templates.getTemplate("dashboard/views/deep_insights_item")},render:function(){this.clearSubViews();var a=this.model.deepInsightsUrl(this.user);return this.$el.html(this.template({url:a,title:this.model.get("title"),description:this.model.get("description"),timeDiff:e(this.model.get("updated_at")).fromNow()})),this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/navigate_through_router":110}],148:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.moment:"undefined"!=typeof c?c.moment:null,f=a("../../common/view_helpers/navigate_through_router"),g=a("../../dashboard/mapviews_graph"),h=a("../../common/views/mapcard_preview"),i=a("../../common/views/likes/view"),j=a("../../dashboard/editable_fields/editable_description"),k=a("../../dashboard/editable_fields/editable_tags");"undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null;d.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null,b.exports=d.core.View.extend({className:"MapsList-item",tagName:"li",events:{"click tag-link":f,"click .js-privacy":"_openPrivacyDialog",click:"_onCardClick"},initialize:function(){this.router=this.options.router,this.user=this.options.user,this.template=d.templates.getTemplate("dashboard/views/maps_item"),this._initBinds()},render:function(){this.clearSubViews();var a=this.model.viewUrl(this.user);return a=this.router.model.get("liked")&&!this.model.permission.hasAccess(this.user)?a.public():a.edit(),this.$el.html(this.template({url:a,name:this.model.get("name"),privacy:this.model.get("privacy").toLowerCase(),isOwner:this.model.permission.isOwner(this.user),owner:this.model.permission.owner.renderData(this.user),showPermissionIndicator:!this.model.permission.hasWriteAccess(this.user),timeDiff:e(this.model.get("updated_at")).fromNow(),likes:this.model.get("likes")||0,liked:this.model.get("liked")||!1})),this._renderDescription(),this._renderTags(),this._renderMapviewsGraph(),this._renderLikesIndicator(),this._renderMapThumbnail(),this._renderTooltips(),this._checkSelected(),this},_initBinds:function(){this.model.on("change:selected",this._checkSelected,this),this.model.on("change:privacy",this.render,this)},_renderDescription:function(){var a=this.model.permission.isOwner(this.user),b=new j({el:this.$(".js-item-description"),model:this.model,editable:a&&this.user.hasCreateMapsFeature()});this.addView(b.render())},_renderTags:function(){var a=this.model.permission.isOwner(this.user),b=new k({el:this.$(".js-item-tags"),model:this.model,router:this.router,editable:a&&this.user.hasCreateMapsFeature()});this.addView(b.render())},_renderLikesIndicator:function(){var a=new i({model:this.model.like});this.$(".js-likes-indicator").replaceWith(a.render().el),this.addView(a)},_renderMapviewsGraph:function(){var a=new g({el:this.$(".js-header-graph"),stats:this.model.get("stats")});this.addView(a.render())},_renderTooltips:function(){this.model.permission.isOwner(this.user)||this.addView(new d.common.TipsyTooltip({el:this.$(".UserAvatar"),title:function(a){return $(this).attr("data-title")}}))},_renderMapThumbnail:function(){var a=this.model.get("zoom"),b=this.model.permission.owner,c=b.get("username"),e=(a+2<=this.model.map.get("maxZoom")?a+2:a,new h({el:this.$(".js-header"),privacy:this.model.get("privacy"),mapsApiResource:d.config.getMapsResourceName(c),username:c,visId:this.model.get("id"),authTokens:this.model.get("auth_tokens")}));this.imageURL?e.loadURL(this.imageURL):e.load(),e.bind("loaded",function(a){this.imageURL=a},this),this.addView(e)},_checkSelected:function(){this.$(".MapCard")[this.model.get("selected")?"addClass":"removeClass"]("is-selected")},_openPrivacyDialog:function(a){this.killEvent(a),d.god.trigger("openPrivacyDialog",this.model)},_onCardClick:function(a){if(!$(a.target).closest("a")[0]){this.killEvent(a);var b=this.model.permission.isOwner(this.user);b&&this.model.set("selected",!this.model.get("selected"))}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/view_helpers/navigate_through_router":110,"../../common/views/likes/view":126,"../../common/views/mapcard_preview":127,"../../dashboard/editable_fields/editable_description":140,"../../dashboard/editable_fields/editable_tags":141,"../../dashboard/mapviews_graph":150}],149:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=(a("../../common/dialogs/create/create_view"),a("../../common/dialogs/video_tutorial/video_tutorial_view"));b.exports=d.core.View.extend({className:"MapsList-item",tagName:"li",events:{"click .js-open":"_openVideoTutorialDialog"},initialize:function(){this.template=d.templates.getTemplate("dashboard/maps/placeholder_item");
},render:function(){return this.clearSubViews(),this.$el.html(this.template({desc:this.model.get("short_description"),icon:this.model.get("icon")})),this},_openVideoTutorialDialog:function(){var a=new e({videoId:this.model.get("videoId"),clean_on_hide:!0,enter_to_confirm:!1});d.god.trigger("onTemplateSelected",this),a.appendToBody()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/dialogs/create/create_view":45,"../../common/dialogs/video_tutorial/video_tutorial_view":93}],150:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("../common/view_helpers/pluralize_string"),f="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null,g="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null;b.exports=d.core.View.extend({options:{stats:[],width:127,height:22},initialize:function(){this.options.stats=g.map(this.options.stats,function(a,b){return{mapviews:a,when:b,today:moment(new Date(b)).format("DD/MM/YYYY")==moment(new Date).format("DD/MM/YYYY")}})},render:function(){var a=this,b=this.options.width,c=this.options.height,g=this.options.stats,h=2,i=d3.scale.ordinal().rangeRoundBands([0,b],.1),j=d3.scale.linear().range([c,0]),k=d3.svg.axis().scale(i).orient("bottom"),l=d3.select(this.$el[0]).append("svg").attr("width",b).attr("height",c).append("g");return i.domain(g.map(function(a){return a.when})),j.domain([0,d3.max(g,function(a){return a.mapviews})]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(k),l.selectAll(".bar").data(g).enter().append("rect").attr("class","MapviewsGraph-bar").attr("data-title",function(a){return f.formatNumber(a.mapviews)+" "+e("mapview",a.mapviews)+(a.today?" today":" on "+a.when)}).attr("x",function(a){return i(a.when)}).attr("width",3).attr("y",function(a){var b=c-j(a.mapviews),d=j(a.mapviews);return b<h?c-h:d}).attr("height",function(a){var b=c-j(a.mapviews);return b<h?h:b}).on("mouseover",function(b){if(b.mapviews>0){var c=$(d3.select(this)[0]);a.addView(new d.common.TipsyTooltip({el:c,className:"MapviewsGraph-tooltip",html:!0,trigger:"manual",title:function(a){return $(this).attr("data-title")}})),c.tipsy("show")}}).on("mouseout",function(a){if(a.mapviews>0){var b=$(d3.select(this)[0]);b.tipsy("hide"),b.unbind("mouseleave mouseenter")}}),this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/view_helpers/pluralize_string":111}],151:[function(a,b,c){(function(c){"use strict";var d="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null;f.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof c?c.cdb.admin:null;var g=a("../common/views/create_default_fallback_map");b.exports=f.core.View.extend({tagName:"div",className:"OnBoarding",events:{"click .js-createMap":"_createMap"},initialize:function(){this.user=this.options.user,this.template=f.templates.getTemplate("dashboard/views/onboarding"),this._resizeMap(),this._initBindings()},render:function(){return this.$el.html(this.template({username:this.user.get("name")||this.user.get("username"),hasCreateMapsFeature:this.user.hasCreateMapsFeature()})),this},_renderMap:function(){this.map||(this.map=g({el:this.$(".js-onboarding-map"),baselayer:f.config.get("default_fallback_basemap"),scrollwheel:!1}))},_createMap:function(){f.god.trigger("openCreateDialog",{type:"map"})},_destroyMap:function(){this.map&&this.map.remove()},_initBindings:function(){e.bindAll(this,"_resizeMap"),d(window).on("resize",this._resizeMap)},_destroyBindings:function(){d(window).off("resize",this._resizeMap)},_resizeMap:function(){this.$el.height(window.innerHeight-71)},show:function(){this.$el.show(),this._renderMap()},hide:function(){this.$el.hide()},clean:function(){this._destroyMap(),this._destroyBindings(),f.core.View.prototype.clean.call(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/views/create_default_fallback_map":114}],152:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e=a("../common/router"),f=a("../common/visualizations_fetch_model"),g=a("./router/current_url_model"),h="undefined"!=typeof window?window.cdb.Utils:"undefined"!=typeof c?c.cdb.Utils:null;b.exports=e.extend({routes:{"":"_changeRouteToMaps","?:queries":"_changeRouteToMaps",dashboard:"_changeRouteToMaps","dashboard?:queries":"_changeRouteToMaps","*prefix/dashboard":"_changeRouteToMaps","*prefix/dashboard?:queries":"_changeRouteToMaps",tables:"_changeRouteToDatasets","tables/:whatever":"_changeRouteToDatasets",visualizations:"_changeRouteToMaps","visualizations/:whatever":"_changeRouteToMaps",":content_type/search/:q":"_changeRouteToSearch",":content_type/search/:q/:page":"_changeRouteToSearch",":content_type/shared/tag/:tag":"_changeRouteToTag",":content_type/shared/tag/:tag/:page":"_changeRouteToTag",":content_type/liked/tag/:tag":"_changeRouteToTag",":content_type/liked/tag/:tag/:page":"_changeRouteToTag",":content_type/locked/tag/:tag":"_changeRouteToTag",":content_type/locked/tag/:tag/:page":"_changeRouteToTag",":content_type/library/tag/:tag":"_changeRouteToTag",":content_type/library/tag/:tag/:page":"_changeRouteToTag",":content_type/tag/:tag":"_changeRouteToTag",":content_type/tag/:tag/:page":"_changeRouteToTag","datasets/liked":"_changeRouteToDatasets","datasets/liked/":"_changeRouteToDatasets","datasets/liked?:q":"_changeRouteToDatasets","datasets/liked/:page":"_changeRouteToDatasets","datasets/liked/:page?:q":"_changeRouteToDatasets","datasets/shared":"_changeRouteToDatasets","datasets/shared/":"_changeRouteToDatasets","datasets/shared?:q":"_changeRouteToDatasets","datasets/shared/:page":"_changeRouteToDatasets","datasets/shared/:page?:q":"_changeRouteToDatasets","datasets/locked":"_changeRouteToDatasets","datasets/locked/":"_changeRouteToDatasets","datasets/locked?:q":"_changeRouteToDatasets","datasets/locked/:page":"_changeRouteToDatasets","datasets/locked/:page?:q":"_changeRouteToDatasets","datasets/library":"_changeRouteToDatasets","datasets/library/":"_changeRouteToDatasets","datasets/library?:q":"_changeRouteToDatasets","datasets/library/:page":"_changeRouteToDatasets","datasets/library/:page?:q":"_changeRouteToDatasets",datasets:"_changeRouteToDatasets","datasets/":"_changeRouteToDatasets","datasets?:q":"_changeRouteToDatasets","datasets/:page":"_changeRouteToDatasets","datasets/:page?:q":"_changeRouteToDatasets","maps/shared":"_changeRouteToMaps","maps/shared/":"_changeRouteToMaps","maps/shared?:q":"_changeRouteToMaps","maps/shared/:page":"_changeRouteToMaps","maps/shared/:page?:q":"_changeRouteToMaps","maps/locked":"_changeRouteToMaps","maps/locked/":"_changeRouteToMaps","maps/locked?:q":"_changeRouteToMaps","maps/locked/:page":"_changeRouteToMaps","maps/locked/:page?:q":"_changeRouteToMaps","maps/shared/locked":"_changeRouteToMaps","maps/shared/locked/":"_changeRouteToMaps","maps/shared/locked?:q":"_changeRouteToMaps","maps/shared/locked/:page":"_changeRouteToMaps","maps/shared/locked/:page?:q":"_changeRouteToMaps","maps/liked":"_changeRouteToMaps","maps/liked/":"_changeRouteToMaps","maps/liked?:q":"_changeRouteToMaps","maps/liked/:page":"_changeRouteToMaps","maps/liked/:page?:q":"_changeRouteToMaps",maps:"_changeRouteToMaps","maps/":"_changeRouteToMaps","maps?:q":"_changeRouteToMaps","maps/:page":"_changeRouteToMaps","maps/:page?:q":"_changeRouteToMaps","deep-insights":"_changeRouteToDeepInsights","deep-insights/":"_changeRouteToDeepInsights","deep-insights?:q":"_changeRouteToDeepInsights","deep-insights/:page":"_changeRouteToDeepInsights","deep-insights/:page?:q":"_changeRouteToDeepInsights"},initialize:function(a){this._dashboardUrl=a.dashboardUrl,this._rootPath=this._dashboardUrl.pathname(),this.model=new f({}),this._currentUrl=new g({visFetchModel:this.model,dashboardUrl:this._dashboardUrl})},rootPath:function(){return this._rootPath},normalizeFragmentOrUrl:function(a){return a&&a.toString().replace(this._dashboardUrl,"")||this.currentDashboardUrl().toString()},currentDashboardUrl:function(){return this._currentUrl.forCurrentContentType()},currentUrl:function(a){return this._currentUrl.forCurrentState(a)},_changeRouteToSearch:function(a,b,c){c=this._getPage(c),this.model.set({action:"search",content_type:a,q:h.stripHTML(decodeURIComponent(b),""),tag:"",page:c,shared:"yes",locked:null,liked:null,library:null,deepInsights:!1})},_changeRouteToTag:function(a,b,c){c=this._getPage(c),this.model.set({action:"tag",content_type:a,tag:h.stripHTML(decodeURIComponent(b),""),q:"",page:c,shared:"yes",locked:null,liked:null,library:null,deepInsights:!1})},_changeRouteToDatasets:function(a){a=this._getPage(a);var b=this._doesCurrentUrlContain("datasets/shared"),c=this._doesCurrentUrlContain("datasets/locked")||this._doesCurrentUrlContain("shared/locked"),d=this._doesCurrentUrlContain("datasets/liked"),e=this._doesCurrentUrlContain("datasets/library");this.model.set({content_type:"datasets",page:a,q:"",tag:"",shared:b?"only":"no",locked:c,liked:d,library:e,deepInsights:!1})},_changeRouteToMaps:function(a){a=this._getPage(a);var b=this._doesCurrentUrlContain("maps/shared"),c=this._doesCurrentUrlContain("maps/locked")||this._doesCurrentUrlContain("shared/locked"),d=this._doesCurrentUrlContain("maps/liked");this.model.set({content_type:"maps",page:a,q:"",tag:"",shared:b?"only":"no",locked:c,liked:d,library:!1,deepInsights:!1})},_changeRouteToDeepInsights:function(a){a=this._getPage(a),this.model.set({content_type:"maps",page:a,q:"",tag:"",shared:"no",locked:!1,liked:!1,library:!1,deepInsights:!0})},_doesCurrentUrlContain:function(a){return Backbone.history.fragment.search(a)!==-1},_getPage:function(a){return a=parseInt(a),a&&d.isNumber(a)?a:1}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/router":100,"../common/visualizations_fetch_model":132,"./router/current_url_model":153}],153:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=c.core.Model.extend({defaults:{dashboardUrl:void 0,visFetchModel:void 0},initialize:function(){if(d.bindAll(this,"_appendPage","_appendSearch","_appendLocked","_appendLibrary","_appendSharedOrLiked"),!this.get("dashboardUrl"))throw new Error("dashboardUrl is required");if(!this.get("visFetchModel"))throw new Error("visFetchModel is required")},forCurrentContentType:function(){var a=this.get("visFetchModel").get("content_type")||"datasets";return this.get("dashboardUrl")[this.isDeepInsights()?"deepInsights":a]()},forCurrentState:function(a){var b=d.extend([this.forCurrentContentType()],a),e=d.compose(this._appendPage,this._appendSearch,this._appendLocked,this._appendLibrary,this._appendSharedOrLiked)(b).join("/");return new c.common.Url({base_url:e})},isSearching:function(){var a=this.get("visFetchModel");return a.get("q")||a.get("tag")},isDeepInsights:function(){var a=this.get("visFetchModel");return this.isMaps()&&a.get("deepInsights")},isDatasets:function(){return"datasets"===this.get("visFetchModel").get("content_type")},isMaps:function(){return"maps"===this.get("visFetchModel").get("content_type")},_appendPage:function(a){var b=a.page;return d.isUndefined(b)&&(b=this.get("visFetchModel").get("page")),b>1&&a.push(encodeURIComponent(b)),a},_appendSearch:function(a){var b=[],c=a.search;if(d.isUndefined(c)){var e=this.get("visFetchModel"),f=e.get("tag"),g=e.get("q");f?b=this._keyValueItems("tag",f):g&&(b=this._keyValueItems("search",g))}else 0===c.search(":")?b=this._keyValueItems("tag",c.replace(":","")):d.isEmpty(c)||(b=this._keyValueItems("search",c));return a.push.apply(a,b),a},_keyValueItems:function(a,b){return[a,encodeURIComponent(b)]},_appendLocked:function(a){var b=a.locked;return(d.isUndefined(b)&&this.get("visFetchModel").get("locked")||b)&&a.push("locked"),a},_appendLibrary:function(a){var b=a.library;return(d.isUndefined(b)&&this.get("visFetchModel").get("library")||b)&&a.push("library"),a},_appendSharedOrLiked:function(a){var b=a.shared,c=a.liked;return d.isUndefined(b)&&"only"===this.get("visFetchModel").get("shared")||"only"===b?a.push("shared"):(d.isUndefined(c)&&this.get("visFetchModel").get("liked")||c)&&a.push("liked"),a}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],154:[function(a,b,c){var d=a("./cartocss/get-geo-attr"),e=a("./cartocss/get-default-css-for-geometry-type"),f=a("./cartocss/color-ramps");b.exports={choropleth:function(a,b,c,f,g){for(var h=d(f),i="#"+b,j=e(f),k="/** choropleth visualization */\n\n"+i+" {\n  "+h+": "+g[0]+";\n"+j.join("\n")+"\n}\n",l=a.length-1;l>=0;--l)void 0!==a[l]&&null!=a[l]&&(k+="\n"+i+"["+c+" <= "+a[l]+"] {\n",k+="  "+h+":"+g[l]+";\n}");return k},categoryMetadata:function(a,b){for(var c=[],d=b&&b.ramp?b.ramp:f.category,e=b&&b.type?b.type:"string",g=0;g<a.length;g++){var h=a[g];g<10&&void 0!==h&&("string"===e&&null!=h||"string"!==e)&&c.push({title:h,title_type:e,value_type:"color",color:d[g]})}return a.length>10&&c.push({title:"Others",value_type:"color",default:!0,color:d[d.length-1]}),c},category:function(a,b,c,g,h){for(var i,j,k=d(g),l="#"+b,m=f.category,n=h&&h.type?h.type:"string",m=h&&h.ramp?h.ramp:f.category,o=e(g),p="/** category visualization */\n\n"+l+" {\n  "+k+": "+m[0]+";\n"+o.join("\n")+"\n}\n",q=0;q<a.length;q++){var r=a[q];"string"===n?(i=r.replace(/\n/g,"\\n").replace(/\"/g,'\\"'),j='"'+i+'"'):j=r,q<10&&void 0!==r&&("string"===n&&null!=r||"string"!==n)&&(p+="\n"+l+"["+c+"="+j+"] {\n",p+="  "+k+":"+m[q]+";\n}")}return a.length>10&&(p+="\n"+l+"{\n",p+="  "+k+": "+m[m.length-1]+";\n}"),p},torque:function(a,b,c){var d="#"+b,e=["/** torque visualization */","Map {","  -torque-time-attribute: "+a.column+";",'  -torque-aggregation-function: "count(cartodb_id)";',"  -torque-frame-count: "+a.steps+";","  -torque-animation-duration: 10;","  -torque-resolution: 2;","}",d+" {","  marker-width: 3;","  marker-fill-opacity: 0.8;","  marker-fill: #0F3B82; ",'  comp-op: "lighten"; ',"  [frame-offset = 1] { marker-width: 10; marker-fill-opacity: 0.05;}","  [frame-offset = 2] { marker-width: 15; marker-fill-opacity: 0.02;}","}"];return e=e.join("\n")},bubble:function(a,b,c){var d="#"+b,f="/** bubble visualization */\n\n"+d+" {\n";f+=e("point").join("\n"),f+="\nmarker-fill: #FF5C00;",f+="\n}\n\n";for(var g=10,h=30,i=[],j=10,k=0;k<j;++k){var l=k/(j-1);i.push(g+l*(h-g))}for(var k=j-1;k>=0;--k)void 0!==a[k]&&null!=a[k]&&(f+="\n#"+b+" [ "+c+" <= "+a[k]+"] {\n",f+="   marker-width: "+i[k].toFixed(1)+";\n}");return f},heatmap:function(a,b,c){var d="#"+b,e=["/** heatmap visualization */","Map {",'  -torque-time-attribute: "cartodb_id";','  -torque-aggregation-function: "count(cartodb_id)";',"  -torque-frame-count: 1;","  -torque-animation-duration: 10;","  -torque-resolution: 2;","}",d+" {","  marker-width: 10;","  marker-fill-opacity: 0.4;","  marker-fill: #0F3B82; ",'  comp-op: "lighten"; ',"  image-filters: colorize-alpha(blue, cyan, lightgreen, yellow , orange, red);","  marker-file: url(http://s3.amazonaws.com/com.cartodb.assets.static/alphamarker.png);","}"];return e=e.join("\n")}}},{"./cartocss/color-ramps":155,"./cartocss/get-default-css-for-geometry-type":156,"./cartocss/get-geo-attr":157}],155:[function(a,b,c){b.exports={bool:["#229A00","#F84F40","#DDDDDD"],green:["#EDF8FB","#D7FAF4","#CCECE6","#66C2A4","#41AE76","#238B45","#005824"],blue:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#1D91C0","#225EA8","#0C2C84"],pink:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#E7298A","#CE1256","#91003F"],black:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#737373","#525252","#252525"],red:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#B10026"],category:["#A6CEE3","#1F78B4","#B2DF8A","#33A02C","#FB9A99","#E31A1C","#FDBF6F","#FF7F00","#CAB2D6","#6A3D9A","#DDDDDD"],divergent:["#0080FF","#40A0FF","#7FBFFF","#FFF2CC","#FFA6A6","#FF7A7A","#FF4D4D"]}},{}],156:[function(a,b,c){b.exports=function(a){return"polygon"===a?["polygon-opacity: 0.7;","line-color: #FFF;","line-width: 0.5;","line-opacity: 1;"]:"line"===a?["line-width: 2;","line-opacity: 0.7;"]:["marker-fill-opacity: 0.9;","marker-line-color: #FFF;","marker-line-width: 1;","marker-line-opacity: 1;","marker-placement: point;","marker-type: ellipse;","marker-width: 10;","marker-allow-overlap: true;"]}},{}],157:[function(a,b,c){b.exports=function(a){return{line:"line-color",polygon:"polygon-fill",point:"marker-fill"}[a]}},{}],158:[function(a,b,c){var d=function(a,b){var c={};for(var e in b)if(b.hasOwnProperty(e)){var f,g=b[e];"object"==typeof a&&(f=a[e]),"object"==typeof g&&"object"==typeof f?c[e]=d(f,g):"object"!=typeof g&&void 0!==f?c[e]=f:c[e]=g}return c||{}};b.exports=d},{}],159:[function(a,b,c){var d=a("./cartocss/color-ramps.js");b.exports=function(a){var b,c=d.blue,e="blue";return["A","U"].indexOf(a.dist_type)!=-1?(b=a.jenks,a.min<0&&a.max>0&&(c=d.divergent,e="spectrum2")):"F"===a.dist_type?(b=a.equalint,c=d.red,e="red"):"J"===a.dist_type?(b=a.headtails,c=d.blue,e="blue"):(b=a.headtails,c=d.red,e="red"),{name:e,ramp:c,method:b}}},{"./cartocss/color-ramps.js":155}],160:[function(a,b,c){b.exports=function(a){return{U:.9,A:.9,L:.7,J:.7,S:.5,F:.3}[a]}},{}],161:[function(a,b,c){var d=a("./cartocss/color-ramps"),e=a("./get-weight-from-shape"),f=a("./get-method-properties"),g=a("./deep-defaults"),h=a("./cartocss");b.exports=function(a){var b=a.dependencies.underscore,c=a.tableName,i=g(a.thresholds,{number:{forBubbleMap:{minCalcWeight:.5,maxStatsCount:200},forCategoryOrBubbleMap:{minStatsWeight:.5,distinctPercentage:25,forCategory:{maxDistinctPercentage:1},forBubble:{minDistinctPercentage:1}}}}),j=a.column,k=j.geometryType,l=j.stats,m=l.column,n="choropleth",o=null,p=l.type,q=[],r=l.distinct/l.count*100;if("number"===p){var s=(l.weight+e(l.dist_type))/2;if(s>=i.number.forBubbleMap.minCalcWeight){var t=h.choropleth,u=f(l);l.count<i.number.forBubbleMap.maxStatsCount&&"point"===k&&(n="bubble",t=h.bubble),o=t(u.method,c,m,k,u.ramp)}else if(l.weight>i.number.forCategoryOrBubbleMap.minStatsWeight||r<i.number.forCategoryOrBubbleMap.maxDistinctPercentage)if(r<i.number.forCategoryOrBubbleMap.forCategory.maxDistinctPercentage){n="category";var v=l.cat_hist;v=b.sortBy(v,function(a){return a[1]}).reverse().slice(0,d.category.length),v=b.sortBy(v,function(a){return a[0]}),v=v.map(function(a){return a[0]}),o=h.category(v,c,m,k,{type:p}),q=h.categoryMetadata(v,{type:p})}else if(r>=i.number.forCategoryOrBubbleMap.forBubble.minDistinctPercentage){var t=h.choropleth;"point"===k&&(n="bubble",t=h.bubble);var u=f(l);o=t(u.method,c,m,k,u.ramp)}}else if("string"===p){n="category";var v=l.hist;v=b.sortBy(v,function(a){return a[1]}).reverse().slice(0,d.category.length),v=b.sortBy(v,function(a){return a[0]}),v=v.map(function(a){return a[0]}),o=h.category(v,c,m,k),q=h.categoryMetadata(v)}else if("date"===p)n="torque",o=h.torque(l,c);else if("boolean"===p){n="category";var w=d.bool,v=["true","false",null],x={type:p,ramp:w};o=h.category(v,c,m,k,x),q=h.categoryMetadata(v,x)}else"geom"===l.type&&(n="heatmap",o=h.heatmap(l,c,x));var u={geometryType:k,column:m,bbox:j.bbox,type:p,visualizationType:n};return o?u.css=o:(u.css=null,u.weight=-100),l&&(u.stats=l),q&&(u.metadata=q),u}},{"./cartocss":154,"./cartocss/color-ramps":155,"./deep-defaults":158,"./get-method-properties":159,"./get-weight-from-shape":160}],162:[function(a,b,c){var d=a("./get-weight-from-shape"),e=a("./deep-defaults"),f={geom:function(a){var b=a.stats;return a.isPointGeometryType&&b.cluster_rate*b.density>=a.thresholds.geom.minStatsDensity},string:function(a){return a.stats.weight>=a.thresholds.string.minWeight},number:function(a){var b=a.stats,c=b.distinct/b.count*100,e=(b.weight+d(b.dist_type))/2;return b.weight>=a.thresholds.number.minWeight&&(e>=a.thresholds.number.minCalcWeight||b.weight>a.thresholds.number.minWeightIfNoOtherApplies||c<a.thresholds.number.maxDistinctPercentage)},boolean:function(a){return a.stats.null_ratio<=a.thresholds.boolean.maxNullRatio},date:function(a){return a.isPointGeometryType&&a.stats.null_ratio<=a.thresholds.date.maxNullRatio}};b.exports=function(a){var b=!1,a=a||{};if(a.thresholds=e(a.thresholds,{geom:{minStatsDensity:.1},string:{minWeight:.8},number:{minWeight:.1,minCalcWeight:.5,maxDistinctPercentage:25,minWeightIfNoOtherApplies:.5},boolean:{maxNullRatio:.75},date:{maxNullRatio:.75}}),a&&a.stats){var c=f[a.stats.type];"function"==typeof c&&(b=c.call(this,a))}return b}},{"./deep-defaults":158,"./get-weight-from-shape":160}],163:[function(a,b,c){b.exports={hasEnoughToGuess:a("./has-enough-to-guess"),guessMap:a("./guess-map"),getWeightFromShape:a("./get-weight-from-shape"),getMethodProperties:a("./get-method-properties")}},{"./get-method-properties":159,"./get-weight-from-shape":160,"./guess-map":161,"./has-enough-to-guess":162}],164:[function(a,b,c){"use strict";b.exports=a("./src/js/main")},{"./src/js/main":170}],165:[function(a,b,c){"use strict";function d(a,b){var c=a.className.split(" ");c.indexOf(b)<0&&c.push(b),a.className=c.join(" ")}function e(a,b){var c=a.className.split(" "),d=c.indexOf(b);d>=0&&c.splice(d,1),a.className=c.join(" ")}c.add=function(a,b){a.classList?a.classList.add(b):d(a,b)},c.remove=function(a,b){a.classList?a.classList.remove(b):e(a,b)},c.list=function(a){return a.classList?Array.prototype.slice.apply(a.classList):a.className.split(" ")}},{}],166:[function(a,b,c){"use strict";function d(a,b){return window.getComputedStyle(a)[b]}function e(a,b,c){return"number"==typeof c&&(c=c.toString()+"px"),a.style[b]=c,a}function f(a,b){for(var c in b){var d=b[c];"number"==typeof d&&(d=d.toString()+"px"),a.style[c]=d}return a}var g={};g.e=function(a,b){var c=document.createElement(a);return c.className=b,c},g.appendTo=function(a,b){return b.appendChild(a),a},g.css=function(a,b,c){return"object"==typeof b?f(a,b):"undefined"==typeof c?d(a,b):e(a,b,c)},g.matches=function(a,b){return"undefined"!=typeof a.matches?a.matches(b):"undefined"!=typeof a.matchesSelector?a.matchesSelector(b):"undefined"!=typeof a.webkitMatchesSelector?a.webkitMatchesSelector(b):"undefined"!=typeof a.mozMatchesSelector?a.mozMatchesSelector(b):"undefined"!=typeof a.msMatchesSelector?a.msMatchesSelector(b):void 0},g.remove=function(a){"undefined"!=typeof a.remove?a.remove():a.parentNode&&a.parentNode.removeChild(a)},g.queryChildren=function(a,b){return Array.prototype.filter.call(a.childNodes,function(a){return g.matches(a,b)})},b.exports=g},{}],167:[function(a,b,c){"use strict";var d=function(a){this.element=a,this.events={}};d.prototype.bind=function(a,b){"undefined"==typeof this.events[a]&&(this.events[a]=[]),this.events[a].push(b),this.element.addEventListener(a,b,!1)},d.prototype.unbind=function(a,b){var c="undefined"!=typeof b;this.events[a]=this.events[a].filter(function(d){return!(!c||d===b)||(this.element.removeEventListener(a,d,!1),!1)},this)},d.prototype.unbindAll=function(){for(var a in this.events)this.unbind(a)};var e=function(){this.eventElements=[]};e.prototype.eventElement=function(a){var b=this.eventElements.filter(function(b){return b.element===a})[0];return"undefined"==typeof b&&(b=new d(a),this.eventElements.push(b)),b},e.prototype.bind=function(a,b,c){this.eventElement(a).bind(b,c)},e.prototype.unbind=function(a,b,c){this.eventElement(a).unbind(b,c)},e.prototype.unbindAll=function(){for(var a=0;a<this.eventElements.length;a++)this.eventElements[a].unbindAll()},e.prototype.once=function(a,b,c){var d=this.eventElement(a),e=function(a){d.unbind(b,e),c(a)};d.bind(b,e)},b.exports=e},{}],168:[function(a,b,c){"use strict";b.exports=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}()},{}],169:[function(a,b,c){"use strict";var d=a("./class"),e=a("./dom"),f=c.toInt=function(a){return parseInt(a,10)||0},g=c.clone=function(a){if(a){if(Array.isArray(a))return a.map(g);if("object"==typeof a){var b={};for(var c in a)b[c]=g(a[c]);return b}return a}return null};c.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}},c.extend=function(a,b){var c=g(a);for(var d in b)c[d]=g(b[d]);return c},c.isEditable=function(a){return e.matches(a,"input,[contenteditable]")||e.matches(a,"select,[contenteditable]")||e.matches(a,"textarea,[contenteditable]")||e.matches(a,"button,[contenteditable]")},c.removePsClasses=function(a){for(var b=d.list(a),c=0;c<b.length;c++){var e=b[c];0===e.indexOf("ps-")&&d.remove(a,e)}},c.outerWidth=function(a){return f(e.css(a,"width"))+f(e.css(a,"paddingLeft"))+f(e.css(a,"paddingRight"))+f(e.css(a,"borderLeftWidth"))+f(e.css(a,"borderRightWidth"))},c.startScrolling=function(a,b){d.add(a,"ps-in-scrolling"),"undefined"!=typeof b?d.add(a,"ps-"+b):(d.add(a,"ps-x"),d.add(a,"ps-y"))},c.stopScrolling=function(a,b){d.remove(a,"ps-in-scrolling"),"undefined"!=typeof b?d.remove(a,"ps-"+b):(d.remove(a,"ps-x"),d.remove(a,"ps-y"))},c.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":165,"./dom":166}],170:[function(a,b,c){"use strict";var d=a("./plugin/destroy"),e=a("./plugin/initialize"),f=a("./plugin/update");b.exports={initialize:e,update:f,destroy:d}},{"./plugin/destroy":173,"./plugin/initialize":181,"./plugin/update":186}],171:[function(a,b,c){"use strict";var d=a("./update"),e=window.MutationObserver,f=a("./instances"),g=function(a){var b=document.createEvent("Event");return b.initEvent(a,!0,!0),b};b.exports=function(a){if(null!==e&&void 0!==e){var b=f.get(a),c=function(){d(a),a.dispatchEvent(g("ps-dom-change"))};b.observer=new e(c),c();var h={childList:!0,subtree:!0};b.observer.observe(a,h)}}},{"./instances":182,"./update":186}],172:[function(a,b,c){"use strict";b.exports={handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default",autoupdate:!0}},{}],173:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/dom"),f=a("./instances");b.exports=function(a){var b=f.get(a);b&&(b.observer&&b.observer.disconnect(),b.event.unbindAll(),e.remove(b.scrollbarX),e.remove(b.scrollbarY),e.remove(b.scrollbarXRail),e.remove(b.scrollbarYRail),d.removePsClasses(a),f.remove(a))}},{"../lib/dom":166,"../lib/helper":169,"./instances":182}],174:[function(a,b,c){"use strict";function d(a,b){function c(a){return a.getBoundingClientRect()}var d=function(a){a.stopPropagation()};b.event.bind(b.scrollbarY,"click",d),b.event.bind(b.scrollbarYRail,"click",function(d){var e=d.pageY-window.pageYOffset-c(b.scrollbarYRail).top,h=e>b.scrollbarYTop?1:-1;g(a,"top",a.scrollTop+h*b.containerHeight),f(a),d.stopPropagation()}),b.event.bind(b.scrollbarX,"click",d),b.event.bind(b.scrollbarXRail,"click",function(d){var e=d.pageX-window.pageXOffset-c(b.scrollbarXRail).left,h=e>b.scrollbarXLeft?1:-1;g(a,"left",a.scrollLeft+h*b.containerWidth),f(a),d.stopPropagation()})}var e=a("../instances"),f=a("../update-geometry"),g=a("../update-scroll");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":182,"../update-geometry":184,"../update-scroll":185}],175:[function(a,b,c){"use strict";function d(a,b){function c(c){var e=d+c*b.railXRatio,g=Math.max(0,b.scrollbarXRail.getBoundingClientRect().left)+b.railXRatio*(b.railXWidth-b.scrollbarXWidth);e<0?b.scrollbarXLeft=0:e>g?b.scrollbarXLeft=g:b.scrollbarXLeft=e;var h=f.toInt(b.scrollbarXLeft*(b.contentWidth-b.containerWidth)/(b.containerWidth-b.railXRatio*b.scrollbarXWidth))-b.negativeScrollAdjustment;j(a,"left",h)}var d=null,e=null,h=function(b){c(b.pageX-e),i(a),b.stopPropagation(),b.preventDefault()},k=function(){f.stopScrolling(a,"x"),b.event.unbind(b.ownerDocument,"mousemove",h)};b.event.bind(b.scrollbarX,"mousedown",function(c){e=c.pageX,d=f.toInt(g.css(b.scrollbarX,"left"))*b.railXRatio,f.startScrolling(a,"x"),b.event.bind(b.ownerDocument,"mousemove",h),b.event.once(b.ownerDocument,"mouseup",k),c.stopPropagation(),c.preventDefault()})}function e(a,b){function c(c){var e=d+c*b.railYRatio,g=Math.max(0,b.scrollbarYRail.getBoundingClientRect().top)+b.railYRatio*(b.railYHeight-b.scrollbarYHeight);e<0?b.scrollbarYTop=0:e>g?b.scrollbarYTop=g:b.scrollbarYTop=e;var h=f.toInt(b.scrollbarYTop*(b.contentHeight-b.containerHeight)/(b.containerHeight-b.railYRatio*b.scrollbarYHeight));j(a,"top",h)}var d=null,e=null,h=function(b){c(b.pageY-e),i(a),b.stopPropagation(),b.preventDefault()},k=function(){f.stopScrolling(a,"y"),b.event.unbind(b.ownerDocument,"mousemove",h)};b.event.bind(b.scrollbarY,"mousedown",function(c){e=c.pageY,d=f.toInt(g.css(b.scrollbarY,"top"))*b.railYRatio,f.startScrolling(a,"y"),b.event.bind(b.ownerDocument,"mousemove",h),b.event.once(b.ownerDocument,"mouseup",k),c.stopPropagation(),c.preventDefault()})}var f=a("../../lib/helper"),g=a("../../lib/dom"),h=a("../instances"),i=a("../update-geometry"),j=a("../update-scroll");b.exports=function(a){var b=h.get(a);d(a,b),e(a,b)}},{"../../lib/dom":166,"../../lib/helper":169,"../instances":182,"../update-geometry":184,"../update-scroll":185}],176:[function(a,b,c){"use strict";function d(a,b){function c(c,d){var e=a.scrollTop;if(0===c){if(!b.scrollbarYActive)return!1;if(0===e&&d>0||e>=b.contentHeight-b.containerHeight&&d<0)return!b.settings.wheelPropagation}var f=a.scrollLeft;if(0===d){if(!b.scrollbarXActive)return!1;if(0===f&&c<0||f>=b.contentWidth-b.containerWidth&&c>0)return!b.settings.wheelPropagation}return!0}var d=!1;b.event.bind(a,"mouseenter",function(){d=!0}),b.event.bind(a,"mouseleave",function(){d=!1});var g=!1;b.event.bind(b.ownerDocument,"keydown",function(j){if(!(j.isDefaultPrevented&&j.isDefaultPrevented()||j.defaultPrevented)){var k=f.matches(b.scrollbarX,":focus")||f.matches(b.scrollbarY,":focus");if(d||k){var l=document.activeElement?document.activeElement:b.ownerDocument.activeElement;if(l){if("IFRAME"===l.tagName)l=l.contentDocument.activeElement;else for(;l.shadowRoot;)l=l.shadowRoot.activeElement;if(e.isEditable(l))return}var m=0,n=0;switch(j.which){case 37:m=j.metaKey?-b.contentWidth:j.altKey?-b.containerWidth:-30;break;case 38:n=j.metaKey?b.contentHeight:j.altKey?b.containerHeight:30;break;case 39:m=j.metaKey?b.contentWidth:j.altKey?b.containerWidth:30;break;case 40:n=j.metaKey?-b.contentHeight:j.altKey?-b.containerHeight:-30;break;case 33:n=90;break;case 32:n=j.shiftKey?90:-90;break;case 34:n=-90;break;case 35:n=j.ctrlKey?-b.contentHeight:-b.containerHeight;break;case 36:n=j.ctrlKey?a.scrollTop:b.containerHeight;break;default:return}i(a,"top",a.scrollTop-n),i(a,"left",a.scrollLeft+m),h(a),g=c(m,n),g&&j.preventDefault()}}})}var e=a("../../lib/helper"),f=a("../../lib/dom"),g=a("../instances"),h=a("../update-geometry"),i=a("../update-scroll");b.exports=function(a){var b=g.get(a);d(a,b)}},{"../../lib/dom":166,"../../lib/helper":169,"../instances":182,"../update-geometry":184,"../update-scroll":185}],177:[function(a,b,c){"use strict";function d(a,b){function c(c,d){var e=a.scrollTop;if(0===c){if(!b.scrollbarYActive)return!1;if(0===e&&d>0||e>=b.contentHeight-b.containerHeight&&d<0)return!b.settings.wheelPropagation}var f=a.scrollLeft;if(0===d){if(!b.scrollbarXActive)return!1;if(0===f&&c<0||f>=b.contentWidth-b.containerWidth&&c>0)return!b.settings.wheelPropagation}return!0}function d(a){var b=a.deltaX,c=-1*a.deltaY;
return"undefined"!=typeof b&&"undefined"!=typeof c||(b=-1*a.wheelDeltaX/6,c=a.wheelDeltaY/6),a.deltaMode&&1===a.deltaMode&&(b*=10,c*=10),b!==b&&c!==c&&(b=0,c=a.wheelDelta),a.shiftKey?[-c,-b]:[b,c]}function e(b,c){var d=a.querySelector("textarea:hover, select[multiple]:hover, .ps-child:hover");if(d){if(!window.getComputedStyle(d).overflow.match(/(scroll|auto)/))return!1;var e=d.scrollHeight-d.clientHeight;if(e>0&&!(0===d.scrollTop&&c>0||d.scrollTop===e&&c<0))return!0;var f=d.scrollLeft-d.clientWidth;if(f>0&&!(0===d.scrollLeft&&b<0||d.scrollLeft===f&&b>0))return!0}return!1}function h(h){var j=d(h),k=j[0],l=j[1];e(k,l)||(i=!1,b.settings.useBothWheelAxes?b.scrollbarYActive&&!b.scrollbarXActive?(l?g(a,"top",a.scrollTop-l*b.settings.wheelSpeed):g(a,"top",a.scrollTop+k*b.settings.wheelSpeed),i=!0):b.scrollbarXActive&&!b.scrollbarYActive&&(k?g(a,"left",a.scrollLeft+k*b.settings.wheelSpeed):g(a,"left",a.scrollLeft-l*b.settings.wheelSpeed),i=!0):(g(a,"top",a.scrollTop-l*b.settings.wheelSpeed),g(a,"left",a.scrollLeft+k*b.settings.wheelSpeed)),f(a),i=i||c(k,l),i&&(h.stopPropagation(),h.preventDefault()))}var i=!1;"undefined"!=typeof window.onwheel?b.event.bind(a,"wheel",h):"undefined"!=typeof window.onmousewheel&&b.event.bind(a,"mousewheel",h)}var e=a("../instances"),f=a("../update-geometry"),g=a("../update-scroll");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":182,"../update-geometry":184,"../update-scroll":185}],178:[function(a,b,c){"use strict";function d(a,b){b.event.bind(a,"scroll",function(){f(a)})}var e=a("../instances"),f=a("../update-geometry");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":182,"../update-geometry":184}],179:[function(a,b,c){"use strict";function d(a,b){function c(){var a=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===a.toString().length?null:a.getRangeAt(0).commonAncestorContainer}function d(){j||(j=setInterval(function(){return f.get(a)?(h(a,"top",a.scrollTop+k.top),h(a,"left",a.scrollLeft+k.left),void g(a)):void clearInterval(j)},50))}function i(){j&&(clearInterval(j),j=null),e.stopScrolling(a)}var j=null,k={top:0,left:0},l=!1;b.event.bind(b.ownerDocument,"selectionchange",function(){a.contains(c())?l=!0:(l=!1,i())}),b.event.bind(window,"mouseup",function(){l&&(l=!1,i())}),b.event.bind(window,"keyup",function(){l&&(l=!1,i())}),b.event.bind(window,"mousemove",function(b){if(l){var c={x:b.pageX,y:b.pageY},f={left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth,top:a.offsetTop,bottom:a.offsetTop+a.offsetHeight};c.x<f.left+3?(k.left=-5,e.startScrolling(a,"x")):c.x>f.right-3?(k.left=5,e.startScrolling(a,"x")):k.left=0,c.y<f.top+3?(f.top+3-c.y<5?k.top=-5:k.top=-20,e.startScrolling(a,"y")):c.y>f.bottom-3?(c.y-f.bottom+3<5?k.top=5:k.top=20,e.startScrolling(a,"y")):k.top=0,0===k.top&&0===k.left?i():d()}})}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){var b=f.get(a);d(a,b)}},{"../../lib/helper":169,"../instances":182,"../update-geometry":184,"../update-scroll":185}],180:[function(a,b,c){"use strict";function d(a,b,c,d){function e(c,d){var e=a.scrollTop,f=a.scrollLeft,g=Math.abs(c),h=Math.abs(d);if(h>g){if(d<0&&e===b.contentHeight-b.containerHeight||d>0&&0===e)return!b.settings.swipePropagation}else if(g>h&&(c<0&&f===b.contentWidth-b.containerWidth||c>0&&0===f))return!b.settings.swipePropagation;return!0}function i(b,c){h(a,"top",a.scrollTop-c),h(a,"left",a.scrollLeft-b),g(a)}function j(){u=!0}function k(){u=!1}function l(a){return a.targetTouches?a.targetTouches[0]:a}function m(a){return!(!a.targetTouches||1!==a.targetTouches.length)||!(!a.pointerType||"mouse"===a.pointerType||a.pointerType===a.MSPOINTER_TYPE_MOUSE)}function n(a){if(m(a)){v=!0;var b=l(a);q.pageX=b.pageX,q.pageY=b.pageY,r=(new Date).getTime(),null!==t&&clearInterval(t),a.stopPropagation()}}function o(a){var c=a.target,d=c&&c.getAttribute&&c.getAttribute("class")||"";if(!d.match(/ps-prevent-touchmove/)&&(!v&&b.settings.swipePropagation&&n(a),!u&&v&&m(a))){var f=l(a),g={pageX:f.pageX,pageY:f.pageY},h=g.pageX-q.pageX,j=g.pageY-q.pageY;i(h,j),q=g;var k=(new Date).getTime(),o=k-r;o>0&&(s.x=h/o,s.y=j/o,r=k),e(h,j)&&(a.stopPropagation(),a.preventDefault())}}function p(){!u&&v&&(v=!1,clearInterval(t),t=setInterval(function(){return f.get(a)&&(s.x||s.y)?Math.abs(s.x)<.01&&Math.abs(s.y)<.01?void clearInterval(t):(i(30*s.x,30*s.y),s.x*=.8,void(s.y*=.8)):void clearInterval(t)},10))}var q={},r=0,s={},t=null,u=!1,v=!1;c?(b.event.bind(window,"touchstart",j),b.event.bind(window,"touchend",k),b.event.bind(a,"touchstart",n),b.event.bind(a,"touchmove",o),b.event.bind(a,"touchend",p)):d&&(window.PointerEvent?(b.event.bind(window,"pointerdown",j),b.event.bind(window,"pointerup",k),b.event.bind(a,"pointerdown",n),b.event.bind(a,"pointermove",o),b.event.bind(a,"pointerup",p)):window.MSPointerEvent&&(b.event.bind(window,"MSPointerDown",j),b.event.bind(window,"MSPointerUp",k),b.event.bind(a,"MSPointerDown",n),b.event.bind(a,"MSPointerMove",o),b.event.bind(a,"MSPointerUp",p)))}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){if(e.env.supportsTouch||e.env.supportsIePointer){var b=f.get(a);d(a,b,e.env.supportsTouch,e.env.supportsIePointer)}}},{"../../lib/helper":169,"../instances":182,"../update-geometry":184,"../update-scroll":185}],181:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/class"),f=a("./instances"),g=a("./update-geometry"),h=a("./autoupdate"),i=a("./resizer"),j={"click-rail":a("./handler/click-rail"),"drag-scrollbar":a("./handler/drag-scrollbar"),keyboard:a("./handler/keyboard"),wheel:a("./handler/mouse-wheel"),touch:a("./handler/touch"),selection:a("./handler/selection")},k=a("./handler/native-scroll");b.exports=function(a,b){b="object"==typeof b?b:{},e.add(a,"ps-container");var c=f.add(a);c.settings=d.extend(c.settings,b),e.add(a,"ps-theme-"+c.settings.theme),c.settings.handlers.forEach(function(b){j[b](a)}),k(a),g(a),c.settings.autoupdate&&(h(a),i(a))}},{"../lib/class":165,"../lib/helper":169,"./autoupdate":171,"./handler/click-rail":174,"./handler/drag-scrollbar":175,"./handler/keyboard":176,"./handler/mouse-wheel":177,"./handler/native-scroll":178,"./handler/selection":179,"./handler/touch":180,"./instances":182,"./resizer":183,"./update-geometry":184}],182:[function(a,b,c){"use strict";function d(a){function b(){i.add(a,"ps-focus")}function c(){i.remove(a,"ps-focus")}var d=this;d.settings=h.clone(j),d.containerWidth=null,d.containerHeight=null,d.contentWidth=null,d.contentHeight=null,d.isRtl="rtl"===k.css(a,"direction"),d.isNegativeScroll=function(){var b=a.scrollLeft,c=null;return a.scrollLeft=-1,c=a.scrollLeft<0,a.scrollLeft=b,c}(),d.negativeScrollAdjustment=d.isNegativeScroll?a.scrollWidth-a.clientWidth:0,d.event=new l,d.ownerDocument=a.ownerDocument||document,d.scrollbarXRail=k.appendTo(k.e("div","ps-scrollbar-x-rail"),a),d.scrollbarX=k.appendTo(k.e("div","ps-scrollbar-x"),d.scrollbarXRail),d.scrollbarX.setAttribute("tabindex",0),d.event.bind(d.scrollbarX,"focus",b),d.event.bind(d.scrollbarX,"blur",c),d.scrollbarXActive=null,d.scrollbarXWidth=null,d.scrollbarXLeft=null,d.scrollbarXBottom=h.toInt(k.css(d.scrollbarXRail,"bottom")),d.isScrollbarXUsingBottom=d.scrollbarXBottom===d.scrollbarXBottom,d.scrollbarXTop=d.isScrollbarXUsingBottom?null:h.toInt(k.css(d.scrollbarXRail,"top")),d.railBorderXWidth=h.toInt(k.css(d.scrollbarXRail,"borderLeftWidth"))+h.toInt(k.css(d.scrollbarXRail,"borderRightWidth")),k.css(d.scrollbarXRail,"display","block"),d.railXMarginWidth=h.toInt(k.css(d.scrollbarXRail,"marginLeft"))+h.toInt(k.css(d.scrollbarXRail,"marginRight")),k.css(d.scrollbarXRail,"display",""),d.railXWidth=null,d.railXRatio=null,d.scrollbarYRail=k.appendTo(k.e("div","ps-scrollbar-y-rail"),a),d.scrollbarY=k.appendTo(k.e("div","ps-scrollbar-y"),d.scrollbarYRail),d.scrollbarY.setAttribute("tabindex",0),d.event.bind(d.scrollbarY,"focus",b),d.event.bind(d.scrollbarY,"blur",c),d.scrollbarYActive=null,d.scrollbarYHeight=null,d.scrollbarYTop=null,d.scrollbarYRight=h.toInt(k.css(d.scrollbarYRail,"right")),d.isScrollbarYUsingRight=d.scrollbarYRight===d.scrollbarYRight,d.scrollbarYLeft=d.isScrollbarYUsingRight?null:h.toInt(k.css(d.scrollbarYRail,"left")),d.scrollbarYOuterWidth=d.isRtl?h.outerWidth(d.scrollbarY):null,d.railBorderYWidth=h.toInt(k.css(d.scrollbarYRail,"borderTopWidth"))+h.toInt(k.css(d.scrollbarYRail,"borderBottomWidth")),k.css(d.scrollbarYRail,"display","block"),d.railYMarginHeight=h.toInt(k.css(d.scrollbarYRail,"marginTop"))+h.toInt(k.css(d.scrollbarYRail,"marginBottom")),k.css(d.scrollbarYRail,"display",""),d.railYHeight=null,d.railYRatio=null}function e(a){return a.getAttribute("data-ps-id")}function f(a,b){a.setAttribute("data-ps-id",b)}function g(a){a.removeAttribute("data-ps-id")}var h=a("../lib/helper"),i=a("../lib/class"),j=a("./default-setting"),k=a("../lib/dom"),l=a("../lib/event-manager"),m=a("../lib/guid"),n={};c.add=function(a){var b=m();return f(a,b),n[b]=new d(a),n[b]},c.remove=function(a){delete n[e(a)],g(a)},c.get=function(a){return n[e(a)]}},{"../lib/class":165,"../lib/dom":166,"../lib/event-manager":167,"../lib/guid":168,"../lib/helper":169,"./default-setting":172}],183:[function(a,b,c){"use strict";var d=a("./update"),e=a("./instances"),f=a("../lib/helper");b.exports=function(a){var b=e.get(a),c=function(){d(a)};b.event.bind(window,"resize",f.debounce(c,60))}},{"../lib/helper":169,"./instances":182,"./update":186}],184:[function(a,b,c){"use strict";function d(a,b){return a.settings.minScrollbarLength&&(b=Math.max(b,a.settings.minScrollbarLength)),a.settings.maxScrollbarLength&&(b=Math.min(b,a.settings.maxScrollbarLength)),b}function e(a,b){var c={width:b.railXWidth};b.isRtl?c.left=b.negativeScrollAdjustment+a.scrollLeft+b.containerWidth-b.contentWidth:c.left=a.scrollLeft,b.isScrollbarXUsingBottom?c.bottom=b.scrollbarXBottom-a.scrollTop:c.top=b.scrollbarXTop+a.scrollTop,h.css(b.scrollbarXRail,c);var d={top:a.scrollTop,height:b.railYHeight};b.isScrollbarYUsingRight?b.isRtl?d.right=b.contentWidth-(b.negativeScrollAdjustment+a.scrollLeft)-b.scrollbarYRight-b.scrollbarYOuterWidth:d.right=b.scrollbarYRight-a.scrollLeft:b.isRtl?d.left=b.negativeScrollAdjustment+a.scrollLeft+2*b.containerWidth-b.contentWidth-b.scrollbarYLeft-b.scrollbarYOuterWidth:d.left=b.scrollbarYLeft+a.scrollLeft,h.css(b.scrollbarYRail,d),h.css(b.scrollbarX,{left:b.scrollbarXLeft,width:b.scrollbarXWidth-b.railBorderXWidth}),h.css(b.scrollbarY,{top:b.scrollbarYTop,height:b.scrollbarYHeight-b.railBorderYWidth})}var f=a("../lib/helper"),g=a("../lib/class"),h=a("../lib/dom"),i=a("./instances"),j=a("./update-scroll");b.exports=function(a){var b=i.get(a);b.containerWidth=a.clientWidth,b.containerHeight=a.clientHeight,b.contentWidth=a.scrollWidth,b.contentHeight=a.scrollHeight;var c;a.contains(b.scrollbarXRail)||(c=h.queryChildren(a,".ps-scrollbar-x-rail"),c.length>0&&c.forEach(function(a){h.remove(a)}),h.appendTo(b.scrollbarXRail,a)),a.contains(b.scrollbarYRail)||(c=h.queryChildren(a,".ps-scrollbar-y-rail"),c.length>0&&c.forEach(function(a){h.remove(a)}),h.appendTo(b.scrollbarYRail,a)),!b.settings.suppressScrollX&&b.containerWidth+b.settings.scrollXMarginOffset<b.contentWidth?(b.scrollbarXActive=!0,b.railXWidth=b.containerWidth-b.railXMarginWidth,b.railXRatio=b.containerWidth/b.railXWidth,b.scrollbarXWidth=d(b,f.toInt(b.railXWidth*b.containerWidth/b.contentWidth)),b.scrollbarXLeft=f.toInt((b.negativeScrollAdjustment+a.scrollLeft)*(b.railXWidth-b.scrollbarXWidth)/(b.contentWidth-b.containerWidth))):b.scrollbarXActive=!1,!b.settings.suppressScrollY&&b.containerHeight+b.settings.scrollYMarginOffset<b.contentHeight?(b.scrollbarYActive=!0,b.railYHeight=b.containerHeight-b.railYMarginHeight,b.railYRatio=b.containerHeight/b.railYHeight,b.scrollbarYHeight=d(b,f.toInt(b.railYHeight*b.containerHeight/b.contentHeight)),b.scrollbarYTop=f.toInt(a.scrollTop*(b.railYHeight-b.scrollbarYHeight)/(b.contentHeight-b.containerHeight))):b.scrollbarYActive=!1,b.scrollbarXLeft>=b.railXWidth-b.scrollbarXWidth&&(b.scrollbarXLeft=b.railXWidth-b.scrollbarXWidth),b.scrollbarYTop>=b.railYHeight-b.scrollbarYHeight&&(b.scrollbarYTop=b.railYHeight-b.scrollbarYHeight),e(a,b),b.scrollbarXActive?g.add(a,"ps-active-x"):(g.remove(a,"ps-active-x"),b.scrollbarXWidth=0,b.scrollbarXLeft=0,j(a,"left",0)),b.scrollbarYActive?g.add(a,"ps-active-y"):(g.remove(a,"ps-active-y"),b.scrollbarYHeight=0,b.scrollbarYTop=0,j(a,"top",0))}},{"../lib/class":165,"../lib/dom":166,"../lib/helper":169,"./instances":182,"./update-scroll":185}],185:[function(a,b,c){"use strict";var d,e,f=a("./instances"),g=function(a){var b=document.createEvent("Event");return b.initEvent(a,!0,!0),b};b.exports=function(a,b,c){if("undefined"==typeof a)throw"You must provide an element to the update-scroll function";if("undefined"==typeof b)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof c)throw"You must provide a value to the update-scroll function";"top"===b&&c<=0&&(a.scrollTop=c=0,a.dispatchEvent(g("ps-y-reach-start"))),"left"===b&&c<=0&&(a.scrollLeft=c=0,a.dispatchEvent(g("ps-x-reach-start")));var h=f.get(a);"top"===b&&c>=h.contentHeight-h.containerHeight&&(c=h.contentHeight-h.containerHeight,c-a.scrollTop<=1?c=a.scrollTop:a.scrollTop=c,a.dispatchEvent(g("ps-y-reach-end"))),"left"===b&&c>=h.contentWidth-h.containerWidth&&(c=h.contentWidth-h.containerWidth,c-a.scrollLeft<=1?c=a.scrollLeft:a.scrollLeft=c,a.dispatchEvent(g("ps-x-reach-end"))),d||(d=a.scrollTop),e||(e=a.scrollLeft),"top"===b&&c<d&&a.dispatchEvent(g("ps-scroll-up")),"top"===b&&c>d&&a.dispatchEvent(g("ps-scroll-down")),"left"===b&&c<e&&a.dispatchEvent(g("ps-scroll-left")),"left"===b&&c>e&&a.dispatchEvent(g("ps-scroll-right")),"top"===b&&(a.scrollTop=d=c,a.dispatchEvent(g("ps-scroll-y"))),"left"===b&&(a.scrollLeft=e=c,a.dispatchEvent(g("ps-scroll-x")))}},{"./instances":182}],186:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/dom"),f=a("./instances"),g=a("./update-geometry"),h=a("./update-scroll");b.exports=function(a){var b=f.get(a);b&&(b.negativeScrollAdjustment=b.isNegativeScroll?a.scrollWidth-a.clientWidth:0,e.css(b.scrollbarXRail,"display","block"),e.css(b.scrollbarYRail,"display","block"),b.railXMarginWidth=d.toInt(e.css(b.scrollbarXRail,"marginLeft"))+d.toInt(e.css(b.scrollbarXRail,"marginRight")),b.railYMarginHeight=d.toInt(e.css(b.scrollbarYRail,"marginTop"))+d.toInt(e.css(b.scrollbarYRail,"marginBottom")),e.css(b.scrollbarXRail,"display","none"),e.css(b.scrollbarYRail,"display","none"),g(a),h(a,"top",a.scrollTop),h(a,"left",a.scrollLeft),e.css(b.scrollbarXRail,"display",""),e.css(b.scrollbarYRail,"display",""))}},{"../lib/dom":166,"../lib/helper":169,"./instances":182,"./update-geometry":184,"./update-scroll":185}],187:[function(a,b,c){!function(a,d){"object"==typeof c&&"undefined"!=typeof b?b.exports=d():"function"==typeof define&&define.amd?define("queue",d):a.queue=d()}(this,function(){"use strict";function a(){}function b(b){function c(){if(!k)for(;k=o&&p<b;){var a=q+p,c=m[a],d=c.length-1,f=c[d];c[d]=g(a),--o,++p,m[a]=f.apply(null,c)||e}}function g(a){return function(b,d){if(!m[a])throw new Error;--p,++q,m[a]=null,null==l&&(null!=b?h(b):(n[a]=d,o?c():p||i()))}}function h(a){l=a,o=NaN,i()}function i(){null!=l?r(l):s?r(null,n):r.apply(null,f.concat(n))}if(!(b>=1))throw new Error;var j,k,l,m=[],n=[],o=0,p=0,q=0,r=a,s=!0;return j={defer:function(b){if(r!==a)throw new Error;var e=d.call(arguments,1);return e.push(b),++o,m.push(e),c(),j},abort:function(){if(null==l){for(var a,b=q+p;--b>=0;)(a=m[b])&&a.abort&&a.abort();h(new Error("abort"))}return j},await:function(b){if(r!==a)throw new Error;return r=b,s=!1,o||p||i(),j},awaitAll:function(b){if(r!==a)throw new Error;return r=b,s=!0,o||p||i(),j}}}function c(a){return b(arguments.length?+a:1/0)}var d=[].slice,e={},f=[null];return c.version="1.2.1",c})},{}],188:[function(a,b,c){(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&f<g;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=v(d,f,4);var g=!C(c)&&u.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function d(a){return function(b,c,d){c=w(c,d);for(var e=B(b),f=a>0?0:e-1;f>=0&&f<e;f+=a)if(c(b[f],f,b))return f;return-1}}function e(a,b,c){return function(d,e,f){var g=0,h=B(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(m.call(d,g,h),u.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&f<h;f+=a)if(d[f]===e)return f;return-1}}function f(a,b){var c=H.length,d=a.constructor,e=u.isFunction(d)&&d.prototype||j,f="constructor";for(u.has(a,f)&&!u.contains(b,f)&&b.push(f);c--;)f=H[c],f in a&&a[f]!==e[f]&&!u.contains(b,f)&&b.push(f)}var g=this,h=g._,i=Array.prototype,j=Object.prototype,k=Function.prototype,l=i.push,m=i.slice,n=j.toString,o=j.hasOwnProperty,p=Array.isArray,q=Object.keys,r=k.bind,s=Object.create,t=function(){},u=function(a){return a instanceof u?a:this instanceof u?void(this._wrapped=a):new u(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=u),c._=u):g._=u,u.VERSION="1.8.3";var v=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},w=function(a,b,c){return null==a?u.identity:u.isFunction(a)?v(a,b,c):u.isObject(a)?u.matcher(a):u.property(a)};u.iteratee=function(a,b){return w(a,b,1/0)};var x=function(a,b){return function(c){var d=arguments.length;if(d<2||null==c)return c;for(var e=1;e<d;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;i<h;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},y=function(a){if(!u.isObject(a))return{};if(s)return s(a);t.prototype=a;var b=new t;return t.prototype=null,b},z=function(a){return function(b){return null==b?void 0:b[a]}},A=Math.pow(2,53)-1,B=z("length"),C=function(a){var b=B(a);return"number"==typeof b&&b>=0&&b<=A};u.each=u.forEach=function(a,b,c){b=v(b,c);var d,e;if(C(a))for(d=0,e=a.length;d<e;d++)b(a[d],d,a);else{var f=u.keys(a);for(d=0,e=f.length;d<e;d++)b(a[f[d]],f[d],a)}return a},u.map=u.collect=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=Array(e),g=0;g<e;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},u.reduce=u.foldl=u.inject=a(1),u.reduceRight=u.foldr=a(-1),u.find=u.detect=function(a,b,c){var d;if(d=C(a)?u.findIndex(a,b,c):u.findKey(a,b,c),void 0!==d&&d!==-1)return a[d]},u.filter=u.select=function(a,b,c){var d=[];return b=w(b,c),u.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},u.reject=function(a,b,c){return u.filter(a,u.negate(w(b)),c)},u.every=u.all=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},u.some=u.any=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},u.contains=u.includes=u.include=function(a,b,c,d){return C(a)||(a=u.values(a)),("number"!=typeof c||d)&&(c=0),u.indexOf(a,b,c)>=0},u.invoke=function(a,b){var c=m.call(arguments,2),d=u.isFunction(b);return u.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},u.pluck=function(a,b){return u.map(a,u.property(b))},u.where=function(a,b){return u.filter(a,u.matcher(b))},u.findWhere=function(a,b){return u.find(a,u.matcher(b))},u.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;h<i;h++)d=a[h],d>f&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},u.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;h<i;h++)d=a[h],d<f&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(e<g||e===1/0&&f===1/0)&&(f=a,g=e)});return f},u.shuffle=function(a){for(var b,c=C(a)?a:u.values(a),d=c.length,e=Array(d),f=0;f<d;f++)b=u.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},u.sample=function(a,b,c){return null==b||c?(C(a)||(a=u.values(a)),a[u.random(a.length-1)]):u.shuffle(a).slice(0,Math.max(0,b))},u.sortBy=function(a,b,c){return b=w(b,c),u.pluck(u.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var D=function(a){return function(b,c,d){var e={};return c=w(c,d),u.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};u.groupBy=D(function(a,b,c){u.has(a,c)?a[c].push(b):a[c]=[b]}),u.indexBy=D(function(a,b,c){a[c]=b}),u.countBy=D(function(a,b,c){u.has(a,c)?a[c]++:a[c]=1}),u.toArray=function(a){return a?u.isArray(a)?m.call(a):C(a)?u.map(a,u.identity):u.values(a):[]},u.size=function(a){return null==a?0:C(a)?a.length:u.keys(a).length},u.partition=function(a,b,c){b=w(b,c);var d=[],e=[];return u.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},u.first=u.head=u.take=function(a,b,c){if(null!=a)return null==b||c?a[0]:u.initial(a,a.length-b)},u.initial=function(a,b,c){return m.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},u.last=function(a,b,c){if(null!=a)return null==b||c?a[a.length-1]:u.rest(a,Math.max(0,a.length-b))},u.rest=u.tail=u.drop=function(a,b,c){return m.call(a,null==b||c?1:b)},u.compact=function(a){return u.filter(a,u.identity)};var E=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=B(a);g<h;g++){var i=a[g];if(C(i)&&(u.isArray(i)||u.isArguments(i))){b||(i=E(i,b,c));var j=0,k=i.length;for(e.length+=k;j<k;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};u.flatten=function(a,b){return E(a,b,!1)},u.without=function(a){return u.difference(a,m.call(arguments,1))},u.uniq=u.unique=function(a,b,c,d){u.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=w(c,d));for(var e=[],f=[],g=0,h=B(a);g<h;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?u.contains(f,j)||(f.push(j),e.push(i)):u.contains(e,i)||e.push(i)}return e},u.union=function(){return u.uniq(E(arguments,!0,!0))},u.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=B(a);d<e;d++){var f=a[d];if(!u.contains(b,f)){for(var g=1;g<c&&u.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},u.difference=function(a){var b=E(arguments,!0,!0,1);return u.filter(a,function(a){return!u.contains(b,a)})},u.zip=function(){return u.unzip(arguments)},u.unzip=function(a){for(var b=a&&u.max(a,B).length||0,c=Array(b),d=0;d<b;d++)c[d]=u.pluck(a,d);return c},u.object=function(a,b){for(var c={},d=0,e=B(a);d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},u.findIndex=d(1),u.findLastIndex=d(-1),u.sortedIndex=function(a,b,c,d){c=w(c,d,1);for(var e=c(b),f=0,g=B(a);f<g;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},u.indexOf=e(1,u.findIndex,u.sortedIndex),u.lastIndexOf=e(-1,u.findLastIndex),u.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;f<d;f++,a+=c)e[f]=a;return e};var F=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=y(a.prototype),g=a.apply(f,e);return u.isObject(g)?g:f};u.bind=function(a,b){if(r&&a.bind===r)return r.apply(a,m.call(arguments,1));if(!u.isFunction(a))throw new TypeError("Bind must be called on a function");var c=m.call(arguments,2),d=function(){return F(a,d,b,this,c.concat(m.call(arguments)))};return d},u.partial=function(a){var b=m.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;g<e;g++)f[g]=b[g]===u?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return F(a,c,this,this,f)};return c},u.bindAll=function(a){var b,c,d=arguments.length;if(d<=1)throw new Error("bindAll must be passed function names");for(b=1;b<d;b++)c=arguments[b],a[c]=u.bind(a[c],a);return a},u.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return u.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},u.delay=function(a,b){var c=m.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},u.defer=u.partial(u.delay,u,1),u.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:u.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=u.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},u.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=u.now()-g;j<b&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=u.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},u.wrap=function(a,b){return u.partial(b,a)},u.negate=function(a){return function(){return!a.apply(this,arguments)}},u.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},u.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},u.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),a<=1&&(b=null),c}},u.once=u.partial(u.before,2);var G=!{toString:null}.propertyIsEnumerable("toString"),H=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];u.keys=function(a){if(!u.isObject(a))return[];if(q)return q(a);var b=[];for(var c in a)u.has(a,c)&&b.push(c);return G&&f(a,b),b},u.allKeys=function(a){if(!u.isObject(a))return[];var b=[];for(var c in a)b.push(c);return G&&f(a,b),b},u.values=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},u.mapObject=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=e.length,g={},h=0;h<f;h++)d=e[h],g[d]=b(a[d],d,a);return g},u.pairs=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=[b[e],a[b[e]]];return d},u.invert=function(a){for(var b={},c=u.keys(a),d=0,e=c.length;d<e;d++)b[a[c[d]]]=c[d];return b},u.functions=u.methods=function(a){var b=[];for(var c in a)u.isFunction(a[c])&&b.push(c);return b.sort()},u.extend=x(u.allKeys),u.extendOwn=u.assign=x(u.keys),u.findKey=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=0,g=e.length;f<g;f++)if(d=e[f],b(a[d],d,a))return d},u.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;u.isFunction(b)?(e=u.allKeys(g),d=v(b,c)):(e=E(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;h<i;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},u.omit=function(a,b,c){if(u.isFunction(b))b=u.negate(b);else{var d=u.map(E(arguments,!1,!1,1),String);b=function(a,b){return!u.contains(d,b)}}return u.pick(a,b,c)},u.defaults=x(u.allKeys,!0),u.create=function(a,b){var c=y(a);return b&&u.extendOwn(c,b),c},u.clone=function(a){return u.isObject(a)?u.isArray(a)?a.slice():u.extend({},a):a},u.tap=function(a,b){return b(a),a},u.isMatch=function(a,b){var c=u.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;f<d;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var I=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof u&&(a=a._wrapped),b instanceof u&&(b=b._wrapped);var e=n.call(a);if(e!==n.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(u.isFunction(g)&&g instanceof g&&u.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!I(a[i],b[i],c,d))return!1}else{var j,k=u.keys(a);if(i=k.length,u.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!u.has(b,j)||!I(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};u.isEqual=function(a,b){return I(a,b)},u.isEmpty=function(a){return null==a||(C(a)&&(u.isArray(a)||u.isString(a)||u.isArguments(a))?0===a.length:0===u.keys(a).length)},u.isElement=function(a){return!(!a||1!==a.nodeType)},u.isArray=p||function(a){return"[object Array]"===n.call(a)},u.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},u.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){u["is"+a]=function(b){return n.call(b)==="[object "+a+"]"}}),u.isArguments(arguments)||(u.isArguments=function(a){return u.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(u.isFunction=function(a){return"function"==typeof a||!1}),u.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},u.isNaN=function(a){return u.isNumber(a)&&a!==+a},u.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===n.call(a)},u.isNull=function(a){return null===a},u.isUndefined=function(a){return void 0===a},u.has=function(a,b){return null!=a&&o.call(a,b)},u.noConflict=function(){return g._=h,this},u.identity=function(a){return a},u.constant=function(a){return function(){return a}},u.noop=function(){},u.property=z,u.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},u.matcher=u.matches=function(a){return a=u.extendOwn({},a),function(b){return u.isMatch(b,a)}},u.times=function(a,b,c){var d=Array(Math.max(0,a));b=v(b,c,1);for(var e=0;e<a;e++)d[e]=b(e);return d},u.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},u.now=Date.now||function(){return(new Date).getTime()};var J={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},K=u.invert(J),L=function(a){var b=function(b){return a[b]},c="(?:"+u.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};u.escape=L(J),u.unescape=L(K),u.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),u.isFunction(d)?d.call(a):d};var M=0;u.uniqueId=function(a){var b=++M+"";return a?a+b:b},u.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(a){return"\\"+O[a]};u.template=function(a,b,c){!b&&c&&(b=c),b=u.defaults({},b,u.templateSettings);var d=RegExp([(b.escape||N).source,(b.interpolate||N).source,(b.evaluate||N).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(P,Q),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(a){throw a.source=f,a}var h=function(a){return g.call(this,a,u)},i=b.variable||"obj";return h.source="function("+i+"){\n"+f+"}",h},u.chain=function(a){var b=u(a);return b._chain=!0,b};var R=function(a,b){return a._chain?u(b).chain():b};u.mixin=function(a){u.each(u.functions(a),function(b){var c=u[b]=a[b];u.prototype[b]=function(){var a=[this._wrapped];return l.apply(a,arguments),R(this,c.apply(u,a))}})},u.mixin(u),u.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=i[a];u.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],R(this,c)}}),u.each(["concat","join","slice"],function(a){var b=i[a];u.prototype[a]=function(){return R(this,b.apply(this._wrapped,arguments))}}),u.prototype.value=function(){return this._wrapped},u.prototype.valueOf=u.prototype.toJSON=u.prototype.value,u.prototype.toString=function(){return""+this._wrapped;
},"function"==typeof define&&define.amd&&define("underscore",[],function(){return u})}).call(this)},{}]},{},[142]);
//# sourceMappingURL=dashboard.js.map