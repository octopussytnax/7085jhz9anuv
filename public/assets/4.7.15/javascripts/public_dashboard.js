/*! v4.7.15 - 2017-05-30 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){function c(a){return 2===a.which||3===a.which}function d(a){return a.metaKey}function e(a){return a.ctrlKey}var f="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=function(a){this.killEvent(a);var b=f(a.target).closest("a").attr("href");return!!b&&void(c(a)||d(a)?(e(a)||d(a))&&window.open(b,"_blank"):(this.router||this.options.router).navigate(b,{trigger:!0}))}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=function(a){var b="leaflet",e="tiled";a.baselayer.url?a.baselayer.urlTemplate=a.baselayer.url:(b="googlemaps",e="GMapsBase");var f=c.createVis(a.el,{version:"0.1.0",title:"default",scrollwheel:void 0!==a.scrollwheel&&a.scrollwheel,zoom:6,map_provider:b,center:[40.7127837,-74.0059413],layers:[d.extend({type:e},a.baselayer)]});return f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({tagName:"a",events:{click:"_toggleLike"},initialize:function(){this.template=c.templates.getTemplate("common/views/likes/template"),this.model.bind("change:likeable change:liked change:likes error",this.render,this)},render:function(){return this.$el.html(this.template({likes:this.model.get("likes"),size:this.model.get("size"),show_count:this.model.get("show_count"),show_label:this.model.get("show_label")})).attr({class:this._classNames(),href:this._hrefLocation()}),this},_hrefLocation:function(){var a="#/like";return this.model.get("likeable")||(a=window.login_url),a},_classNames:function(){var a=["LikesIndicator"];return this.model.get("likeable")&&a.push("is-likeable"),this.model.get("liked")&&a.push("is-liked"),this._animate&&(a.push("is-animated"),this.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){this._animate=!1,this.render()}.bind(this))),a.join(" ")},_toggleLike:function(a){this.model.get("likeable")&&(this.killEvent(a),this._animate=!0,this.model.toggleLiked())}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=d.core.View.extend({options:{width:300,height:170,privacy:"PUBLIC",username:"",visId:"",mapsApiResource:"",className:"",authTokens:[]},_TEMPLATES:{regular:"<%- protocol %>://<%= mapsApiResource %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>",cdn:"<%- protocol %>://<%- cdn %>/<%- username %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>"},initialize:function(){e.each(["visId","mapsApiResource","username"],function(a){this.options[a]||console.log(a+" is required for Static Map instantiation")},this)},load:function(){return this._startLoader(),this._loadFromVisId(),this},_generateImageTemplate:function(){return"tpl_"+this.options.visId.replace(/-/g,"_")},_loadFromVisId:function(){var a=this._isHTTPS()?"https":"http",b=d.config.get("cdn_url"),c=e.template(b?this._TEMPLATES.cdn:this._TEMPLATES.regular),f={protocol:a,username:this.options.username,mapsApiResource:this.options.mapsApiResource,tpl:this._generateImageTemplate(),width:this.options.width,height:this.options.height,authTokens:this._generateAuthTokensParams()};b&&(f=e.extend(f,{cdn:b[a]}));var g=c(f);this._loadImage({},g)},_generateAuthTokensParams:function(){var a=this.options.authTokens;return a&&a.length>0?"?"+e.map(a,function(a){return"auth_token="+a}).join("&"):""},_isHTTPS:function(){return 0===location.protocol.indexOf("https")},loadURL:function(a){var b=c('<img class="MapCard-preview" src="'+a+'" />');this.$el.append(b),this.options.className&&b.addClass(this.options.className),b.fadeIn(250)},showError:function(){this._onError()},_startLoader:function(){this.$el.addClass("is-loading")},_stopLoader:function(){this.$el.removeClass("is-loading")},_onSuccess:function(a){this._stopLoader(),this.loadURL(a),this.trigger("loaded",a)},_onError:function(a){this._stopLoader(),this.$el.addClass("has-error");var b=c('<div class="MapCard-error" />');this.$el.append(b),b.fadeIn(250),this.trigger("error")},_loadImage:function(a,b){var c=this,d=new Image;d.onerror=function(){c._onError(a)},d.onload=function(){c._onSuccess(b)};try{d.src=b}catch(a){this._onError(a)}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;b.exports=c.core.Model.extend({defaults:{total_count:0,per_page:10,current_page:1,display_count:5,extras_display_count:1,url_to:void 0},pagesCount:function(){return Math.max(Math.ceil(this.get("total_count")/this.get("per_page")),1)},isCurrentPage:function(a){return this.get("current_page")===a},shouldBeVisible:function(){var a=this.pagesCount();return this.get("total_count")>0&&a>1&&this.get("current_page")<=a},urlTo:function(a){if(this.hasUrl())return this.get("url_to")(a)},hasUrl:function(){return"function"==typeof this.get("url_to")},pagesToDisplay:function(){var a;return a=this._inLowRange()?1:this._inHighRange()?this.get("current_page")-this._startOffset():this.pagesCount()-this.get("display_count")+1,a=Math.max(a,1),this._withExtraPages(d.range(a,this._rangeEnd(a)))},_withExtraPages:function(a){var b=this.pagesCount(),c=this.get("extras_display_count"),e=d.range(1,c+1),f=d.range(b-c+1,b+1),g=a[0]-e.slice(-1)[0];2===g?e.push(a[0]-1):g>2&&e.push(-1);var h=f[0]-a.slice(-1);return 2===h&&f.unshift(f[0]-1),h>2&&f.unshift(-2),d.union(e,a,f)},_inLowRange:function(){return this.get("current_page")<this._startOffset()},_inHighRange:function(){return this.get("current_page")<this._highBoundary()},_highBoundary:function(){return this.pagesCount()-this._startOffset()},_startOffset:function(){return Math.floor(this.get("display_count")/2)},_rangeEnd:function(a){return Math.min(a+this.get("display_count"),this.pagesCount()+1)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("../../view_helpers/navigate_through_router");b.exports=d.core.View.extend({className:"Pagination CDB-Text CDB-Size-medium",events:{"click a":"_paginate"},initialize:function(){if(this.template=d.templates.getTemplate("common/views/pagination/template"),this.router=this.options.router,this.router&&!this.model.hasUrl())throw new Error("since router is set the model must have a url method set too");this.model.bind("change",this.render,this)},render:function(){return this.model.shouldBeVisible()?(this.$el.html(this.template({m:this.model,pagesCount:this.model.pagesCount(),currentPage:this.model.get("current_page")})),this.$el.addClass(this.className),this.delegateEvents()):this.$el.html(""),this},_paginate:function(a){this.router?f.apply(this,arguments):this.model.hasUrl()||this.killEvent(a);var b=e(a.target).data("page");this.model.set("current_page",b)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../view_helpers/navigate_through_router":1}],7:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.core.View.extend({initialize:function(){_.bindAll(this,"_onWindowScroll"),this._bindScroll()},_onWindowScroll:function(){this.$el.toggleClass("is-fixed",$(window).scrollTop()>this.options.anchorPoint)},_unbindScroll:function(){$(window).unbind("scroll",this._onWindowScroll)},_bindScroll:function(){this._unbindScroll(),$(window).bind("scroll",this._onWindowScroll)},clean:function(){this._unbindScroll(),this.elder("clean")}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;c.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof a?a.cdb.admin:null;var d="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=c.admin.DropdownMenu.extend({className:"CDB-Text Dropdown Dropdown--public",initialize:function(){this.elder("initialize"),this.template_base=c.templates.getTemplate("public_common/user_industries/dropdown_template"),c.god.bind("closeDialogs",this.hide,this)},render:function(){return this.$el.html(this.template_base()),d("body").append(this.el),this},clean:function(){d(this.options.target).unbind("click",this._handleClick),this.constructor.__super__.clean.apply(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./user_industries/dropdown_view"),f="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null;b.exports=d.core.View.extend({events:{"click .js-dropdown-target":"_createDropdown"},_createDropdown:function(a){this.killEvent(a),d.god.trigger("closeDialogs");var b=new e({target:f(a.target),vertical_offset:-10,horizontal_offset:f(a.target).width()-100,horizontal_position:"left",tick:"center"});b.render(),b.on("onDropdownHidden",function(){b.clean()},this),b.open()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./user_industries/dropdown_view":8}],10:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;c.admin="undefined"!=typeof window?window.cdb.admin:"undefined"!=typeof a?a.cdb.admin:null;var d="undefined"!=typeof window?window.$:"undefined"!=typeof a?a.$:null;b.exports=c.admin.DropdownMenu.extend({className:"CDB-Text Dropdown",initialize:function(){this.elder("initialize"),this.template_base=c.templates.getTemplate("public_common/user_settings/dropdown_template"),c.god.bind("closeDialogs",this.hide,this)},render:function(){var a=this.model,b=a.viewUrl();return this.$el.html(this.template_base({name:a.get("name")||a.get("username"),email:a.get("email"),isOrgOwner:a.isOrgOwner(),dashboardUrl:b.dashboard(),publicProfileUrl:b.publicProfile(),accountSettingsUrl:b.accountSettings(),logoutUrl:b.logout()})),d("body").append(this.el),this},clean:function(){d(this.options.target).unbind("click",this._handleClick),this.constructor.__super__.clean.apply(this)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e=a("./user_settings/dropdown_view"),f="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null;b.exports=d.core.View.extend({events:{"click .js-dropdown-target":"_createDropdown"},render:function(){var a=this.model.viewUrl().dashboard(),b=a.datasets(),c=a.maps();return this.$el.html(d.templates.getTemplate("public_common/user_settings_template")({avatarUrl:this.model.get("avatar_url"),mapsUrl:c,datasetsUrl:b})),this},_createDropdown:function(a){this.killEvent(a),d.god.trigger("closeDialogs");var b=new e({target:f(a.target),model:this.model,horizontal_offset:18});b.render(),b.on("onDropdownHidden",function(){b.clean()},this),b.open()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./user_settings/dropdown_view":10}],12:[function(a,b,c){(function(b){var c="undefined"!=typeof window?window.$:"undefined"!=typeof b?b.$:null,d="undefined"!=typeof window?window.cdb:"undefined"!=typeof b?b.cdb:null,e=a("./fav_map_view"),f=a("./user_info_view"),g=a("../common/views/pagination/model"),h=a("../common/views/pagination/view"),i=a("../public_common/user_settings_view"),j=a("../public_common/user_industries_view"),k=a("../common/views/mapcard_preview"),l=a("../common/views/likes/view"),m=a("../common/views/scrollable_header");c(function(){d.init(function(){d.templates.namespace="cartodb/",d.config.set(window.config),d.config.set("url_prefix",window.base_url);new m({el:c(".js-Navmenu"),anchorPoint:350}),new j({el:c(".js-user-industries")});c(document.body).bind("click",function(){d.god.trigger("closeDialogs")});var a=new d.open.AuthenticatedUser;a.bind("change",function(){if(a.get("username")){var b=new d.admin.User(a.attributes),e=new i({el:c(".js-user-settings"),model:b});e.render(),c(".js-login").hide(),c(".js-learn").show()}});var b=new e(window.favMapViewAttrs);b.render();var n=new f({el:c(".js-user-info")});n.render();var o=new h({el:".js-content-footer",model:new g(window.paginationModelAttrs)});o.render(),c(".MapCard").each(function(){var a=c(this).data("visId");if(a){var b=c(this).data("visOwnerName"),e=new k({el:c(this).find(".js-header"),height:220,visId:c(this).data("visId"),username:b,mapsApiResource:d.config.getMapsResourceName(b)});e.load()}}),c(".js-likes").each(function(){var b=d.admin.Like.newByVisData({url:d.config.get("url_prefix")?"":c(this).attr("href"),likeable:!1,show_count:c(this).data("show-count")||!1,show_label:c(this).data("show-label")||!1,vis_id:c(this).data("vis-id"),likes:c(this).data("likes-count")});a.bind("change",function(){a.get("username")&&(b.bind("loadModelCompleted",function(){b.set("likeable",!0)}),b.fetch())});var e=new l({el:this,model:b});e.render()}),a.fetch()})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/views/likes/view":3,"../common/views/mapcard_preview":4,"../common/views/pagination/model":5,"../common/views/pagination/view":6,"../common/views/scrollable_header":7,"../public_common/user_industries_view":9,"../public_common/user_settings_view":11,"./fav_map_view":13,"./user_info_view":15}],13:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../common/views/create_default_fallback_map");b.exports=d.core.View.extend({render:function(){this.$el.removeClass("is-pre-loading").addClass("is-loading");var a;a=this.options.createVis?this._createVisMap(this.options.createVis):this._createFallbackMap();var b=this;return a.done(function(){b.$el.removeClass("is-loading"),b.$(".js-spinner").remove()}),this},_createVisMap:function(a){return d.createVis(this.el,a.url,e.defaults(a.opts,{title:!1,header:!1,description:!1,search:!1,layer_selector:!1,text:!1,image:!1,shareable:!1,annotation:!1,zoom:!1,cartodb_logo:!1,scrollwheel:!1,mobile_layout:!0,slides_controller:!1,legends:!1,time_slider:!1,loader:!1,fullscreen:!1,no_cdn:!1}))},_createFallbackMap:function(){return f({el:this.el,baselayer:this.options.fallbackBaselayer}),{done:function(a){a()}}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/views/create_default_fallback_map":2}],14:[function(a,b,c){(function(a){var c="undefined"!=typeof window?window.cdb:"undefined"!=typeof a?a.cdb:null;b.exports=c.admin.DropdownMenu.extend({className:"Dropdown",initialize:function(){this.elder("initialize"),c.god.bind("closeDialogs",this.hide,this)},render:function(){return this.$el.show(),this},clean:function(){this.$el.hide()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window.cdb:"undefined"!=typeof c?c.cdb:null,e="undefined"!=typeof window?window.$:"undefined"!=typeof c?c.$:null,f=a("./user_info/breadcrumb_dropdown_view");b.exports=d.core.View.extend({events:{"click .js-breadcrumb-dropdown-target":"_createBreadcrumbDropdown"},render:function(){return this},_createBreadcrumbDropdown:function(a){this.killEvent(a);var b=new f({target:e(".js-breadcrumb-dropdown-target"),el:e(".js-breadcrumb-dropdown-content"),horizontal_offset:3,horizontal_position:"right",tick:"right"});this.addView(b),b.on("onDropdownShown",function(){d.god.trigger("closeDialogs")},this),b.open()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./user_info/breadcrumb_dropdown_view":14}]},{},[12]);
//# sourceMappingURL=public_dashboard.js.map