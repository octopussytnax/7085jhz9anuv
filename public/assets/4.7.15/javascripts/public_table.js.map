{"version":3,"sources":["../../../../lib/assets/javascripts/cartodb/old_common/global_click.js","../../../../lib/assets/javascripts/cartodb/table/mapview.js","../../../../vendor/assets/javascripts/modernizr-min.js","../../../../vendor/assets/javascripts/jquery.tipsy.js","../../../../vendor/assets/javascripts/select2.min.js","../../../../lib/assets/javascripts/cartodb/models/table.js","../../../../lib/assets/javascripts/cartodb/models/tabledata.js","../../../../lib/assets/javascripts/cartodb/models/sqlview.js","../../../../lib/assets/javascripts/cartodb/models/cartodb_layer.js","../../../../lib/assets/javascripts/cartodb/models/map.js","../../../../lib/assets/javascripts/cartodb/models/group.js","../../../../lib/assets/javascripts/cartodb/models/user_groups.js","../../../../lib/assets/javascripts/cartodb/models/organization_groups.js","../../../../lib/assets/javascripts/cartodb/models/user.js","../../../../lib/assets/javascripts/cartodb/models/permissions.js","../../../../lib/assets/javascripts/cartodb/models/group_users.js","../../../../lib/assets/javascripts/cartodb/models/grantable.js","../../../../lib/assets/javascripts/cartodb/models/grantables.js","../../../../lib/assets/javascripts/cartodb/models/organization.js","../../../../lib/assets/javascripts/cartodb/models/like.js","../../../../lib/assets/javascripts/cartodb/models/synchronization.js","../../../../lib/assets/javascripts/cartodb/models/wkt.js","../../../../lib/assets/javascripts/cartodb/models/vis.js","../../../../lib/assets/javascripts/cdb/src/ui/common/tabpane.js","../../../../lib/assets/javascripts/cartodb/old_common/dropdown_menu.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/string_field.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/widgets.js","../../../../lib/assets/javascripts/cartodb/old_common/urls/url.js","../../../../lib/assets/javascripts/cartodb/old_common/urls/dashboard_vis_url.js","../../../../lib/assets/javascripts/cartodb/old_common/custom_scroll.js","../../../../lib/assets/javascripts/cartodb/old_common/error_stats.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/boolean_field.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/color_picker.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/date_field.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/edit_in_place.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/filters_combo.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/form.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/geometry_field.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/number_field.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/spinner_slider.js","../../../../lib/assets/javascripts/cartodb/old_common/forms/text_custom_combo.js","../../../../lib/assets/javascripts/cartodb/old_common/globalerror.js","../../../../lib/assets/javascripts/cartodb/old_common/header.js","../../../../lib/assets/javascripts/cartodb/old_common/hotkeys.js","../../../../lib/assets/javascripts/cartodb/old_common/localStorage.js","../../../../lib/assets/javascripts/cartodb/old_common/metrics.js","../../../../lib/assets/javascripts/cartodb/old_common/small_dialog.js","../../../../lib/assets/javascripts/cartodb/old_common/tabs.js","../../../../lib/assets/javascripts/cartodb/old_common/tipsy_tooltip.js","../../../../lib/assets/javascripts/cartodb/old_common/tooltip_trails.js","../../../../lib/assets/javascripts/cartodb/old_common/urls/dashboard_datasets_url.js","../../../../lib/assets/javascripts/cartodb/old_common/urls/dashboard_url.js","../../../../lib/assets/javascripts/cartodb/old_common/urls/dataset_url.js","../../../../lib/assets/javascripts/cartodb/old_common/urls/map_url.js","../../../../lib/assets/javascripts/cartodb/old_common/urls/organization_url.js","../../../../lib/assets/javascripts/cartodb/old_common/urls/user_url.js","../../../../lib/assets/javascripts/cartodb/old_common/utils.js","../../../../lib/assets/javascripts/cartodb/old_common/video_player.js","../../../../lib/assets/javascripts/cartodb/old_common/wizard_dialog.js","../../../../lib/assets/javascripts/cartodb/table/editor_small_dialog.js","../../../../lib/assets/javascripts/cartodb/table/infowindow.js","../../../../lib/assets/javascripts/cartodb/table/tooltip.js","../../../../lib/assets/javascripts/cartodb/table/row_view.js","../../../../lib/assets/javascripts/cartodb/table/header_view.js","../../../../lib/assets/javascripts/cartodb/table/tableview.js","../../../../lib/assets/javascripts/cartodb/table/header_dropdown.js","../../../../lib/assets/javascripts/cartodb/public/authenticated_user.js","../../../../lib/assets/javascripts/cartodb/public/public_dropdown.js","../../../../lib/assets/javascripts/cartodb/public/public_header.js","../../../../lib/assets/javascripts/cartodb/public/public_like.js","../../../../lib/assets/javascripts/cartodb/public/public_vis_model.js","../../../../lib/assets/javascripts/cartodb/public_table/CartoDBTableMetadata_public.js","../../../../lib/assets/javascripts/cartodb/public_table/header_public.js","../../../../lib/assets/javascripts/cartodb/public_table/header_view_public.js","../../../../lib/assets/javascripts/cartodb/public_table/infowindow_public.js","../../../../lib/assets/javascripts/cartodb/public_table/mapview_public.js","../../../../lib/assets/javascripts/cartodb/public_table/public_table.js","../../../../lib/assets/javascripts/cartodb/public_table/public_table_window.js","../../../../lib/assets/javascripts/cartodb/public_table/row_view_public.js","../../../../lib/assets/javascripts/cartodb/public_table/table_public.js","../../../../lib/assets/javascripts/cartodb/public_table/table_router_public.js","../../../../lib/assets/javascripts/cartodb/public_table/tableview_public.js"],"names":["enableClickOut","el","click","cdb","god","trigger","GrouperLayerMapView","mapViewClass","initialize","this","groupLayer","activeLayerModel","prototype","call","_removeLayers","self","_","each","map","layers","getLayersByType","layer","unbind","geo","MapView","model","_removeLayer","cid","_updateLayerDefinition","log","info","setActiveLayer","_setInteraction","disableInteraction","_clearInteraction","enableInteraction","idx","getLayerDefIndex","i","getLayerCount","setInteraction","length","remove","def","getLayerDef","setLayerDefinition","_routeErrors","errors","styleRegExp","postgresExp","generalPostgresExp","syntaxErrorExp","webMercatorErrorExp","tilerError","where","visible","type","err","match","exec","layerIndex","parseInt","_t","error","lyr","_routeSignal","signal","args","concat","arguments","apply","_addLayer","opts","get","m","CartoDBGroupLayer","extend","toLayerGroup","user_name","options","user","maps_api_template","config","no_cdn","force_cors","layer_view","silent","bind","_addLayerToMap","window","Modernizr","a","b","c","u","j","cssText","w","k","r","t","d","e","f","g","documentElement","h","createElement","style","toString","p","q","slice","s","hasOwnProperty","constructor","Function","TypeError","Object","z","toLowerCase","push","getElementsByTagName","innerHTML","insertBefore","lastChild","firstChild","elements","split","createDocumentFragment","cloneNode","shivMethods","canHaveChildren","test","appendChild","join","replace","documentShived","shivCSS","html5","childNodes","shivDocument","_version","className","document","o","shift","B","injectCss","injectJs","x","l","readyState","onload","onreadystatechange","removeChild","y","errorTimeout","data","src","width","height","onerror","splice","n","v","loader","load","A","setTimeout","createRange","compareNode","parentNode","opera","attachEvent","Array","isArray","timeout","pop","url","origUrl","prefixes","autoCallback","bypass","instead","noexec","forceCSS","forceJS","attrs","both","callback","complete","yep","nope","yepnope","addPrefix","addFilter","addEventListener","removeEventListener","executeStack","setAttribute","href","rel","$","maybeCall","thing","ctx","isElementInDOM","ele","Tipsy","element","$element","enabled","fixTitle","MOVE_OFFSET","show","title","getTitle","$tip","tip","find","html","css","top","left","visibility","display","prependTo","body","addClass","tp","pos","offset","getBoundingClientRect","actualWidth","offsetWidth","actualHeight","offsetHeight","gravity","charAt","mo","opacity","fade","stop","animate","hide","$e","attr","removeAttr","fallback","validate","enable","disable","toggleEnabled","fn","tipsy","elementOptions","enter","hoverState","delayIn","leave","delayOut","defaults","live","binder","eventIn","eventOut","revalidate","pointee","metadata","autoNS","scrollTop","autoWE","scrollLeft","autoBounds","margin","prefer","dir","ns","ew","boundTop","boundLeft","$this","jQuery","each2","context","undefined","indexOf","value","array","String","localeCompare","equal","splitVal","string","separator","val","trim","getSideBorderPadding","outerWidth","installKeyUpChangeEvent","key","removeData","installFilteredMouseMove","lastpos","lastMousePosition","pageX","pageY","target","debounce","quietMillis","clearTimeout","thunk","formula","evaluated","installDebouncedScroll","threshold","notify","killEvent","event","preventDefault","stopPropagation","killEventImmediately","stopImmediatePropagation","measureTextWidth","sizer","currentStyle","getComputedStyle","position","fontSize","fontFamily","fontStyle","fontWeight","letterSpacing","textTransform","whiteSpace","append","text","markMatch","term","markup","toUpperCase","tl","substring","ajax","requestSequence","handler","query","requestNumber","transport","traditional","page","abort","dataType","success","results","local","dataText","item","isFunction","process","filtered","datum","collection","group","children","childDatum","matcher","tags","isObject","id","checkFormatter","formatter","formatterName","Error","evaluate","countResults","count","defaultTokenizer","input","selection","selectCallback","token","index","original","dupe","createSearchChoice","tokenSeparators","clazz","SuperClass","methods","parent","Select2","KEY","AbstractSelect2","SingleSelect2","MultiSelect2","nextUid","$document","TAB","ENTER","ESC","SPACE","LEFT","UP","RIGHT","DOWN","SHIFT","CTRL","ALT","PAGE_UP","PAGE_DOWN","HOME","END","BACKSPACE","DELETE","isArrow","which","isControl","metaKey","isFunctionKey","counter","ready","closest","blur","tagName","focus","func","init","search","free_text","resultsSelector","prepareOpts","destroy","container","createContainer","containerId","containerSelector","containerCss","containerCssClass","before","dropdown","dropdownCssClass","resultsPage","initContainer","initContainerWidth","delegate","highlightUnderEvent","loadMoreIfNeeded","mousewheel","delta","deltaX","deltaY","scrollHeight","updateResults","removeClass","selectHighlighted","focusSearch","initSelection","monitorSource","is","hasClass","color","bucket","colors","admin","color_ramps","c_l","select2","select","idKey","ajaxUrl","populateResults","populate","depth","result","disabled","selectable","compound","node","label","innerContainer","formatted","formatResultCssClass","msg","color_ramp","formatResult","escapeMarkup","prevObject","more","elm","getPlaceholder","not","triggerChange","details","blurOnChange","close","opened","positionDropdown","bodyOffset","above","outerHeight","dropHeight","viewPortRight","clientWidth","viewportBottom","clientHeight","dropTop","dropLeft","enoughRoomBelow","enoughRoomAbove","dropWidth","enoughRoomOnRight","aboveNow","dropdownCss","shouldOpen","Event","isDefaultPrevented","clearDropdownAlignmentPreference","open","opening","selector","scroll","resize","parents","s2","last","detach","appendTo","ensureHighlightVisible","empty","clearSearch","child","hb","rb","highlight","moveHighlight","choices","choice","filter","countSelectableResults","below","formatLoadMore","tokenize","initial","removeTipsys","$el","postRender","render","showSearchInput","maximumSelectionSize","formatSelectionTooBig","minimumInputLength","formatInputTooShort","formatSearching","unshift","formatNoMatches","postprocessResults","cancel","activeElement","triggerHandler","highlighted","onSelect","placeholder","resolveContainerWidth","matches","class","insertAfter","isFocused","clickingInside","openOnEnter","ti","clear","allowClear","fromCharCode","setPlaceholder","selected","updateSelection","showFreeTextInput","minimumResultsForSearch","freeText","old","formatSelection","searchContainer","unselect","first","resizeSearch","clearPlaceholder","getVal","ids","addSelectedChoice","tokenizer","closeOnSelect","added","enableChoice","locked","enabledItem","disabledItem","replaceWith","fadeOut","dequeue","setVal","removed","minimumWidth","maxWidth","containerLeft","searchWidth","sideBorderPadding","unique","onSortStart","onSortEnd","values","multiple","allowedMethods","min","limit","pageNumber","util","abstract","single","multi","SQL","username","user_data","api_key","cartodb","sql_api_template","getSqlApiBaseUrl","Column","core","Model","idAttribute","method","version","urlVersion","table","base","isNew","unset","toJSON","clone","attributes","_name","name","CartoDBTableMetadata","ui","common","TableProperties","currentLoading","sqlApiClass","_TEXTS","columnDeleted","columnDeleting","columnAdded","columnAdding","hiddenColumns","bindAll","readOnly","_prepareSchema","sqlView","synchronization","TableSynchronization","linkToTable","isSync","no_data_fetch","resp","_data","notice","view","set","schema","schemaFromData","geometry_types","getGeometryTypes","retrigger","permission","Permission","parse","xhr","stats_geometry_types","setReadOnly","isReadOnly","getUnqualifiedName","tk","getUnquotedName","sortSchema","responseText","JSON","_columnType","isInSQLView","columnNames","sc","pluck","containsColumn","contains","columnNamesByType","statsGeomColumnTypes","geometryTypes","geomColumnTypes","types","geomTypes","_map","st_multipolygon","st_polygon","st_multilinestring","st_linestring","st_multipoint","st_point","uniq","addGeomColumnType","nonReservedColumnNames","isReservedColumn","columnTypes","_getColumn","columnName","getColumnType","addColumn","columnType","save","mdl","obj","fetch","wait","deleteColumn","renameColumn","newName","oldName","new_name","old_name","isTypeChangeAllowed","newType","deactivateMatrix","number","boolean","date","deactivated","isTypeChangeDestructive","destructiveMatrix","changeColumnType","saveNewColumnType","column","originalData","CartoDBTableData","bindData","bindedReset","useSQLView","modify_rows","affected_rows","dataModel","elder","when","done","old_success","fail","Row","linkToInfowindow","infowindow","containsField","removeField","addField","_hash","str","hash","charCodeAt","columns","SYSTEM_COLUMNS","has","saveFields","current_schema_key","sort","previous_schema_key","previous","restoreFields","mergeFields","removeMissingFields","embedURL","viewUrl","prefixUrl","hasTheGeom","currentSchema","fetchGeoreferenceStatus","dfd","Deferred","sqlApi","sql","execute","rows","resolve","promise","isGeoreferenced","geoColumns","any","row","hasGeometry","geometryTypeChanged","normalize","changed","geoTypes","prevGeoTypes","previousAttributes","duplicate","callbacks","table_name","getSQL","Utils","safeTableNameQuoting","table_copy","importModel","Import","changes","checkImportModel","item_queue_id","newTable","pollCheck","dependentVisualizations","chain","union","compact","createFromQuery","priority","priorities","cartodb_id","the_geom","__default__","created_at","updated_at","prioA","prioB","alterTable","alterTableData","_CREATED_EVENT","_GEOMETRY_TYPES","point","multipoint","linestring","multilinestring","polygon","multipolygon","extra_params","no_geom","without","skipfields","isGeometryGeoJSON","isGeomLoaded","geojson","column_types_WKT","WKT","coordinates","getFeatureType","getGeomType","RESERVED_COLUMNS","TableData","_ADDED_ROW_TEXT","_ADDING_ROW_TEXT","_GEOMETRY_UPDATED","models","initOptions","_fetching","pages","lastPage","newPage","Math","floor","size","gt","rows_per_page","sort_order","order_by","filter_column","filter_value","opt","hasChanged","add","changingPage","at","_coll","fields","_schemaFromQueryFields","_createUrlOptions","params","encodeURIComponent","_geometryColumnSQL","wrappedSQL","exclude","fetchGeometry","select_columns","omit","mode","sqlApiUrl","sync","query_schema","Backbone","getSqlApiUrl","setOptions","refresh","isFetchingPage","loadPageAtTop","loadPageAtBottom","currentPage","direction","Number","rowspp","max_items","addRow","create","newRow","_saved","getRow","no_add","getRowAt","deleteRow","row_id","quartiles","nslots","tmpl","template","_sqlQuery","slots","equalInterval","max","range","_quantificationMethod","functionName","distinct","simplify_fn","discreteHistogram","nbuckets","reached_limit","date_histogram","agg_array","parseFloat","buckets","hist","bounds","upper","lower","tz","span","bucket_size","histogram","jenkBins","headTails","quantileBins","categoriesForColumn","max_values","categories","geometryBounds","lon0","maxx","lat0","maxy","lon1","minx","lat1","miny","minlat","maxlat","minlon","maxlon","clampNum","_previousAttributes","fetched","_fetch","MAX_GET_LENGTH","originalTableSchema","geometryTypeFromGeoJSON","geometryTypeFromWKT","wkt","geometryTypeFromWKB","wkb","typeMap","0001","0002","0003","0004","0005","0006","bigendian","geom","geoType","SQLViewData","UNDEFINED_TYPE_COLUMN","reset","setSQL","_parseSQL","res","ext","sqlSource","sql_source","CartoDBLayer","MAX_HISTORY","MAX_HISTORY_QUERY","MAX_HISTORY_TILE_STYLE","initHistory","InfowindowModel","template_name","tooltip","wizard_properties","WizardProperties","_manageInteractivity","legend","LegendModel","bindInfowindow","bindLegend","bindTable","table_attr","isTableLoaded","layer_definition","query_wrapper","cartocss","cartocss_version","interactivity","property","localStorage","addToHistory","trimHistory","removedValue","moveHistoryPosition","newPosition","abs","getCurrentHistoryPosition","currentPosition","redoHistory","undoHistory","isHistoryAtLastPosition","isHistoryAtFirstPosition","stored","storedSize","minimumPos","map_key","kind","order","supportsInteractivity","_saving","wp","properties","stringify","contentType","syncAbort","unbindSQLView","getCurrentState","bindSQLView","errorSQLView","invalidate","force_data_fetch","applySQLView","add_to_history","updateCartoCss","tooltipColumns","getInteractivity","previousName","tileStyle","replaceRegexp","RegExp","tile_style","infowindowData","watchedFields","deferredSave","resetQuery","clearSQLView","moveToFront","dataLayers","getDataLayers","moveLayer","to","createDefaultLayerForTable","tableName","userName","CartoStyles","DEFAULT_GEOMETRY_STYLE","style_version","alternative_names","old_fields","old_template_name","maxHeight","columnsSet","addMissingFields","fieldsSet","GMapsBaseLayer","parent_id","WMSLayer","_generateClassName","urlTemplate","isNumber","PlainLayer","TileLayer","validateTemplateURL","subdomains","image","Image","random","byCustomURL","tms","attribution","maxZoom","minZoom","TorqueLayer","Layers","_DATA_LAYERS","typeClass","Tiled","CartoDB","Plain","GMapsBase","WMS","torque","Layer::Tiled","Layer::Carto","Layer::Background","tiled","carto","wms","background","gmapsbase","_isSorted","Collection","getTorqueLayers","getTiledLayers","cartodbLayers","layerDef","getTotalDataLayers","getTotalDataLegends","isLayerOnTopOfDataLayers","dataLayerOnTop","saveLayers","isEqual","movingLayer","newIndex","layerAtNewIndex","Map","urlRoot","__super__","delayedSaveSync","_fetchLayers","_layersChanged","_updateAttributions","none","_adjustZoomtoLayer","dataLayer","relatedTo","_fetchOrCreate","bounding_box_ne","bounding_box_sw","view_bounds_ne","view_bounds_sw","center","map_id","setBaseLayer","baseLayer","isBaseLayerAdded","newBaseLayer","currentBaseLayer","newBaseLayerHasLabels","_updateBaseLayer","_replaceBaseLayer","_addBaseLayer","_hasLabelsLayer","_updateLabelsLayer","_addLabelsLayer","_destroyLabelsLayer","newAttributes","labelsLayer","_labelsLayerNameFromBaseLayer","addDataLayer","addLayer","table_id","autoSave","changeProvider","provider","baselayer","_changeBaseLayer","change","isProviderGmaps","addCartodbLayerFromTable","layerReady","newLayer","active","clamp","fmod","toPrecision","latlng","lon","Group","display_name","users","GroupUsers","UserGroups","organization","OrganizationGroups","response","total_entries","groups","newGroupById","totalCount","UserLayers","custom","category","User","avatar_url","tables","email","Organization","currentUserId","isInsideOrg","isOrgOwner","owner","isOrgAdmin","isViewer","isBuilder","nameOrUsername","renderData","currentUser","fetchTables","_fetchingTables","Visualizations","hasCreateDatasetsFeature","canCreateDatasets","hasCreateMapsFeature","canAddLayerTo","getMaxLayers","max_layers","getMaxConcurrentImports","concurrent_imports","featureEnabled","featureFlags","isCloseToLimits","quota","remainingQuota","getMaxLayersPerMap","canStartTrial","canCreatePrivateDatasets","actions","private_tables","equals","otherUser","UserUrl","base_url","is_org_admin","upgradeContactEmail","usedQuotaPercentage","assignedQuotaInRoundedMb","toFixed","assignedQuotaPercentage","acl","_generateOwner","_generateAcl","aclItem","entity","_grantAccess","access","cleanPermissions","hasAccess","hasReadAccess","findRepresentableAclItem","hasWriteAccess","READ_WRITE","canChangeReadAccess","_canChangeAccess","canChangeWriteAccess","representableAclItem","isOwner","_ownAclItem","grantWriteAccess","grantReadAccess","READ_ONLY","revokeWriteAccess","revokeAccess","getUsersWithAnyPermission","_hasTypeUser","_getEntity","isSharedWithOrganization","_hasTypeOrg","overwriteAcl","otherPermission","_newAclItem","checkList","_findMostPrivilegedAclItem","fnName","_isOrganization","object","_organizationAclItem","org","_mostPrivilegedGroupAclItem","list","iteratee","isValid","ACLItem","isOwn","pick","total_user_entries","addInBatch","userIds","_batchAsyncProcessUsers","removeInBatch","deferred","reject","Grantable","_createEntity","capitalize","Grantables","reduce","grantables","memo","display_email","admin_email","collectionOpts","Users","_setOrganizationOnModel","containsUser","OrganizationUrl","_DEFAULT_EXCLUDE_CURRENT_USER","_excludeCurrentUser","comparator","excludeCurrentUser","restoreExcludeCurrentUser","Invites","users_emails","welcome_text","organizationId","Like","likeable","on","liked","likes","_onSaveError","status","statusText","toggleLiked","newByVisData","vis_id","_X","_INTERVAL","_STATES","state","run_at","ran_at","retried_times","interval","error_code","error_message","service_name","service_item_id","content_guessing","type_guessing","create_vis","remote_visualization_id","syncNow","always","request","destroyCheck","pollTimer","setInterval","clearInterval","VisualizationOrder","visualization","Visualization","bindMap","INHERIT_TABLE_ATTRIBUTES","overlays","Overlays","vis","initSlides","transition","SlideTransition","like","generateRelatedTables","_bindMap","_changeAttributes","_initBinds","slides","Slides","initializeModels","activeSlide","setActive","setMaster","master_vis","changeTo","master_visualization_id","changedAttributes","privacy","enableOverlays","_fetchOverlays","isLoaded","related_tables","getRelatedTables","force","tableMetadata","_metadata","_fetchMap","isVisualization","new_vis","changeToVisualization","copy","description","transition_options","stats","createChild","copy_overlays","source_visualization_id","publicURL","deepInsightsUrl","vizjsonURL","sharedWithEntities","toArray","privacyOptions","ALL_PRIVACY_OPTIONS","option","isOwnedByUser","userUrl","isUndefined","MapUrl","urlToPath","DatasetUrl","_canonicalViewUrl","isMap","UrlModel","_PREVIEW_TABLES_PER_PAGE","_TABLES_PER_PAGE","_PREVIEW_ITEMS_PER_PAGE","_ITEMS_PER_PAGE","default_options","tag_name","exclude_shared","per_page","_changeOptions","_checkPage","_fetchAgain","getTotalPages","ceil","total","total_shared","total_likes","visualizations","TabPane","View","tabs","activeTab","activePane","addTab","debug","addView","after","prepend","getPreviousPane","panes","_subviews","getNextPane","getPane","vid","getActivePane","clean","removeTabs","removeTab","keys","vid_old","activated","tab","DropdownMenu","Dropdown","delegateEvents","marginTop","vertical_position","duration","speedIn","openAt","horizontal_position","tick","isOpen","speedOut","StringField","autoResize","events","change textarea","keydown textarea","template_base","templates","getTemplate","valid","_setOS","undelegateEvents","_resize","ua","navigator","userAgent","so","_onChange","_onKeyDown","ctrlKey","keyCode","_triggerEvent","$textarea","eventName","forms","Color","click .image-picker","click .color-picker","image_property","extra","image_kind","image_value","_createTooltips","TipsyTooltip","_createPicker","picker_vertical_position","picker_horizontal_position","color_picker","ColorPicker","extra_colors","_destroyPicker","_bindColorPicker","_unbindColorPicker","removeView","setExtraColors","setColors","_openImagePicker","dialog","editor","ImagePickerView","appendToBody","_onImageFileChosen","_openColorPicker","ColorWizard","cartoParser","CartoParser","colorsUsed","Hidden","add_related_model","SimpleNumber","inc","pattern","debounce_time","disable_triggering","click .plus","click .minus","keypress input.value","keydown input.value","keyup input.value","change .value","noSlider","_initSlider","_fireChange","prop","initValue","classes","_changeValue","_plus","_minus","spinner_slider","SpinnerSlider","_checkNumber","_checkInputPress","ev","newChar","charCode","NaN","_checkInputUp","_saveValue","_checkValueChange","baseNumber","_showSlider","SimpleNumberWithLabel","isDisabled","Spinner","parentElement","Opacity","SimpleOpacity","OpacityPolygon","switchProperty","originalProperty","Width","Combo","change select","_onUpdate","deselect","updateData","_getOptions","_setValue","$select","plainSelect","combo_options","_formatResult","_formatSelection","_matcher","_changeSelection","Switch","_change","_onClick","TextAlign","click .align","_align","align","alignments","right","Url","byBaseUrl","pathname","_joinArgumentsWithSlashes","flatten","DashboardVisUrl","lockedItems","sharedItems","likedItems","CustomScrolls","checkScroll","height_","scroll_y","scroll_y_height","$parent","$top","$bottom","ErrorStats","people","enable_logs","_setService","BooleanField","click a.radiobutton","$radio","_setSelected","_PICKER_DELAY","_COLORS","horizontal_offset","vertical_offset","dragUpdate","click a.advanced","click .default-colors li a","keyup input.text","change input.text","submit form","off","_handleClick","fixIndicators","_setPicker","_checkColor","RGBColor","ok","toHex","_setColor","_clickedColor","_triggerColor","hex","hsv","rgb","mousePicker","mouseSlide","positionIndicators","_submitColor","_onPickerMouseMove","_onPickerMouseUp","_bindAdvancedPicker","_destroyAdvancedPicker","_openAdvanced","positionate","setHex","$target","targetPos","targetWidth","targetHeight","elementWidth","elementHeight","unBind","DateField","timezone","change input.time","keyup input.time","_splitDate","_getTimeZone","date_model","_onChangeModel","_reClean","_initViews","days","years","months","today","Date","day","getDate","month","getMonth","year","getFullYear","time","getHours","getMinutes","getSeconds","split_date_hour","split_date","substr","_toDate","_checkTime","_onKeyUp","EditInPlace","click .value","keyup input","blur input","stripHTML","_observedField","observe","_setupConfig","_updateValue","_updateMode","$input","isBlank","_close","_preventEmptyValue","_onBlur","isEmpty","escape","ColumnTypeCombo","Form","widgets","simple_opacity","opacity_polygon","simple_number","simple_number_with_label","hidden","switch","text_align","field_template","form_data","updateForm","form","_renderField","field","Class","field_name","getFieldByName","getFieldsByName","clearSubViews","GeometryField","click .switch","_chooseGeom","_loadGeom","rowNumber","_chooseEditor","updateInputs","_checkInputs","$lat","$lon","_onKeyInputUp","lat","_onKeyTextareaDown","NumberField","change input","keydown input","_setValid","_setInvalid","_stopPropagation","slider","orientation","step","slide","CustomTextCombo","actual_value","_valueAsOption","isText","GlobalError","DEFAULT_TAG","_lastType","_lastTag","warn","getTypeTemplate","showError","tag","currentPriority","_timer","listenGlobal","Header","saving","saved","edit","created","share","publish","visualize","share_privacy","ok_next","rename","readonly","_MAX_DESCRIPTION_LENGTH","click a.title","click .metadata a","click a.options","click a.share","click a.privacy","click header nav a","$body","globalError","setInfo","layerView","setEditableInfo","_setName","_setPrivacy","_setSharedCount","_openOptionsMenu","options_menu","HeaderOptionsMenu","geocoder","backgroundPollingModel","_shareVisualization","PublishView","clean_on_hide","enter_to_confirm","CreateVisFirstView","router","table_router","explanation","_showPrivacyDialog","ChangePrivacyView","_setSyncInfo","_setVisualization","_setMetadata","$share","$count","shared_users","users_perm","$metadata","sync_info","isSyncTable","SyncInfo","$title","isVisEditable","$back","is_visualization","route","_changeMetadata","dlg","EditVisMetadataView","maxLength","onShowPrivacy","onDone","_onChangeMetadata","nameChanged","navigate","_generateTableUrl","_changeTitle","destroyTipsy","setTitle","_onSetAttributes","change_confirmation","ViewFactory","createDialogByTemplate","title_dialog","EditTextDialog","initial_value","modal_class","onResponse","showAt","old_data","new_data","owner_username","current","location","_onTabClick","hotkeys","_keyMap","68","67","83","altKey","evt","localStorageWrapper","getItem","searchTerm","wholeArray","setItem","removeItem","Metrics","bindEvents","_setTrack","hubspot_token","_hsq","event_id","hubspot_ids","published_visualization","visited_dashboard","connect_dataset","create_map","export_table","export_map","select_wms","color_basemap","pattern_basemap","geocoding","visual_merge","common_data","cartocss_manually","wizard","logged_in","visited_dashboard_first_time","applied_pecan","open_pecan_list","SmallDialog","Dialog","fix","minWidth","showAtElement","extendEvents","keypress input","ok_title","render_content","_focusInput","_keyPress","_ok","EditMarkdownDialog","Tabs","activate","desactivate","getTab","disableAll","removeDisabled","_click","linkToPanel","panel","_tipsyOpenedManually","_initTipsy","showTipsy","hideTipsy","_destroyTipsy","TooltipTrails","margin-left","margin-top","move","DashboardDatasetsUrl","dataLibrary","DashboardUrl","datasets","maps","deepInsights","public","accountSettings","publicProfile","apiKeys","logout","dashboard","allowed","$0","$1","removeHTMLEvents","truncate","isURL","urlregex","encodeURLParams","urlParts","readablizeBytes","bytes","round","isNaN","pow","formatNumber","parts","rgbToHex","componentToHex","hexToRGB","genRandomPass","getRandomNum","rndNum","checkPunc","num","pass","randomLength","numI","pad","sanitizeString","readizableNumber","getFileExtension","lastIndexOf","getGetOrdinal","isValidEmail","re","VideoModel","minimized","maximized","_initLocalStorage","videoData","seconds","bottom","_onChangeProperty","_onChangeMinimized","video_id","_storeVideoID","_saveVideoData","currentVideo","clearStoredData","VideoPlayer","dblclick","click .js-toggle","click .js-close","mouseenter","mouseleave","_initModel","hasVideoData","draggable","_onStopDragging","_onInitDraggable","video","_loadScript","getScript","_initVideoBinds","player","$f","addEvent","_seekToStoredPosition","dontHide","_removeVideoBinds","removeEvent","elHeight","elWidth","windowWidth","easing","windowHeight","_mouseEnter","fadeIn","_mouseLeave","api","_onCloseAnimationFinished","_toggle","setHorizontalPosition","elLeft","setVerticalPosition","WizardDialog","SmallEditorDialog","$content","editorField","attribute","min-width","MapInfowindow","Infowindow","_NO_FIELDS_SELECTED","_NO_FIELDS_SELECTED_BUTTON","_TEMPLATE_URL","click .edit_data","click .edit_geo","click .remove","click .open_infowindow_panel","content","renderInfo","_containsCover","_createHelpDialog","helpDialog","setFeatureInfo","cache","popup_class","row_attributes","getFieldProperty","getFieldPos","render_fields","setLoading","adjustPan","_loadCover","$cover","$imageNotFound","$img","_getCoverURL","_isValidURL","getElementById","lines","radius","corners","rotate","speed","trail","shadow","hwaccel","zIndex","spinner","spin","coverWidth","coverHeight","ratio","coverRatio","calculatedHeight","_editGeom","_editData","_removeGeom","_openInfowindowPanel","_getModelTemplate","mod","TemplateMap","Tooltip","mouseover","mouseout","empty_fields","_setTemplate","_compileTemplate","_changeFields","_alternameNames","hideTimeout","fieldCount","_lock","_unlock","setFields","Template","asFunction","_move","dx","dy","L","Util","requestAnimFrame","RowView","classLabel","click      .row_header","mouseout   .row_header","cellRenderers","default","geometry","row_header","_getRowOptions","rowOptions","RowHeaderDropdown","tableView","tableData","getTableView","_onOptionsOut","$relatedTarget","relatedTarget","_onOptionsClick","setRow","valueView","colName","colType","_renderDefault","additionalClasses","cell","_renderBoolean","_renderNumber","_renderGeometry","geomDisplayValue","isNull","formatCoord","objValue","HeaderView","no_geo","NO_MENU_COLUMNS","dblclick .coloptions","click    .coloptions","click    .coltype","click    .geo","keydown  .col_name_edit","focusout input","editing_name","changing_type","colTypeOptions","colOptions","HeaderDropdown","ColumntypeDropdown","_addColumn","tableTab","col_name","col_type","read_only","noMenu","max-width","_openColOptions","setTable","_changeType","link_width","th","_openColTypeOptions","_checkEditColnameInput","_submitEdit","_finishEdit","$coltype_link","activateColumnOptions","showColumnOptions","parent_","showGeoreferenceWindow","showColumnTypeOptions","TableView","Table","click .clearview","click .sqlview .export_query","click .noRows","rowView","_editorsOpened","initializeBindings","initPaginationAndScroll","_finishPagination","_editCell","_checkEmptyTable","_onSQLView","_forceScroll","_swicthEnabled","action","_moveInfo","topReached","bottomReached","scroll_position","_scrollMagic","SCROLL_BACK_PIXELS","checkScrollTimer","pageSize","tableHeight","realPos","_startPagination","_setUpPagination","needsRender","ca","_renderHeader","thead","newColumnName","getTime","_highlightColumn","$th","centerPosition","updown","_renderSQLHeader","_renderLoading","cleanEmptyTableInfo","_renderBodyTemplate","isEmptyTable","warnMsg","addEmptySQLIfo","_clearView","_tableFromQuery","duplicate_dialog","DuplicateDatasetView","actual_scroll_position","marginLeft","_getEditor","editors","timestamp with time zone","timestamp without time zone","editorExists","closeEditor","getCell","prevRow","new_value","editError","$td","$tr","headerView","bkgPollingModel","tableIsReadOnly","canAddGeocoding","isGeocoding","GeoreferenceView","longitude","menu","addEmptyTableInfo","_renderEmpty","columnsNumber","columnsFooter","$columns","$footer","panel_opened","slideUp","addEmptyRow","rowSaving","rowSynched","rowFailed","rowDestroying","rowDestroyed","TableTab","recreate","_createTable","hasRenderedTableView","LeafletMapView","GoogleMapsMapView","MapTab","click .toggle_slides.button","click .add_overlay.button","click .canvas_setup.button","click .export_image.button","click .sqlview .clearview","keydown","no_interaction_warn","animation_time","canvas","map_enabled","georeferenced","featureHovered","activeLayerView","layerDataView","layerModel","legends","_addBindings","switchMapType","_toggleLegends","_addLegends","_addTimeline","isMapEnabled","clearMap","autoSaveBoundsTimer","mapView","exportImageView","overlaysDropdown","mapOptionsDropdown","basemapDropdown","configureCanvasDropdown","zoom","_cleanOverlays","_cleanLegends","stackedLegend","timeline","geometryEditor","layer_selector","header","_hideInfowindow","enableMap","_showGMapsDeprecationDialog","setupMap","getBaseLayer","_addMapView","clickTimeout","_bindMissingClickEvents","_addBasemapDropdown","_addInfowindow","_addTooltip","_addOverlays","_showPecan","_showScratchDialog","_addSlides","_addOverlaysDropdown","_addConfigureCanvasDropdown","_addMapOptionsDropdown","_onChangeCanvasMode","_saveLocation","div","_bindDataLayer","ConfigureCanvasDropdown","OverlaysDropdown","slidesPanel","$options","DropdownBasemap","mapview","baseLayers","setActiveBaselayer","bindGeoRefCheck","checkGeoRef","scratchDialog","pecanView","noGeoRefDialog","_showNoGeoWarning","noGeoWarningDialog","hasPecan","hasData","skipPencanDialog","PecanView","skipScratchDialog","ScratchView","_addGeometry","getLayerByCid","layerType","infowindowModel","tooltipModel","legendModel","_bindTable","_bindSQLView","featureClick","featureOut","featureOver","loadingTiles","loadTiles","setLayer","_updateSQLHeader","updateDataLayerView","_getCartoDBLayers","paste","_showDesktopCanvas","fullscreen","_positionOverlaysVertically","_showMobileCanvas","_hideOverlays","$map","onBackgroundShown","onCanvasLandscapeStretched","onCanvasPortraitStretched","_showOverlays","invalidateSize","setCenter","_enableAnimatedMap","_enableMobileLayout","mobile","Mobile","_disableMobileLayout","mTop","mLeft","curWidth","curHeight","autoWidth","autoHeight","onSecondAnimationFinished","onFirstAnimationFinished","stretchMapLandscape","_disableAnimatedMap","MapOptionsDropdown","_bindMapOptions","overlay_type","createOverlayByType","MapOverlays","headerMessageIsVisible","_shouldAddSQLViewHeader","mapToolbar","_exportImage","ExportImageView","vizjson","SlidesPanel","toggle","_addLegend","Legend","_renderStackedLengeds","steps","torqueLayer","getStep","TimeSlider","StackedLegend","_renderLegend","omit_columns","discard","GeometryEditor","hideDataLayer","showDataLayer","showModule","setFilter","editGeom","FeatureDataView","currentZoom","getZoom","DeleteRowView","createGeom","_removeSQLViewHeader","setHeaderMessageIsVisible","_addSQLViewHeader","latlon","pxPos","setCursor","isEditing","setLatLng","showInfowindow","feature","slides_enabled","exportEnabled","setOpacity","showNoGeoRefWarning","warningStorageName","_toggleSlides","isPublic","click .asc","click .desc","click .rename_column","click .change_data_type","click .georeference","click .filter_by_this_column","click .delete_column","click .add_new_column","reserved_column","in_sql_view","orderColumnsAsc","orderColumnsDesc","clearView","changeType","georeference","filterColumn","_addFilter","column_name","DeleteColumnView","AuthenticatedUser","host","_getCurrentHost","AccountDropdown","_TEMPLATE","vis_url","isMobileDevice","current_view","LikeView","_updateCounter","_highlightHeart","_unhighlightHeart","auto_fetch","$counter","$button","$icon","one","PublicVisualization","PublicCartoDBTableMetadata","PublicHeader","_SQL","click .navigation li a","_changeToVisualization","_changePrivacy","_changeDescription","_changeTags","_onSetAttribute","belong_organization","history","pushState","PublicHeaderView","_renameColumn","PublicMapInfowindow","_update","PublicMapTab","click .js-bounds","_setBoundsCheckbox","_setBounds","_changeBounds","setView","toggleClass","Vis","auth_token","https","scrollwheel","shareable","_bindBounds","easeInQuad","namespace","mobileDevice","PublicTableWindow","vizjson_obj","use_https","_onStart","table_options","TablePublic","TableRouter","root","start","_onWindowResize","_onOrientationChange","_setupMapDimensions","_showNavigationBar","DISQUS","reload","animated","mainInfoHeight","headerHeight","landscapeMode","matchMedia","map_view","invalidateMap","top_","PublicRowView","click_header","click .js-Navmenu-link--download","click .js-Navmenu-link--api","_initModels","syncMethod","_fetchData","authenticated_user","_getCurrentView","workViewTable","workViewMap","workViewMobile","slash","browser","msie","PublicTableTab","tableTabMobile","mapTab","vizjson_url","mapTabMobile","_updateTable","_exportTable","DialogView","PublicExportView","export_dialog","_apiCallTable","api_dialog","original_schema","_this","_onUserLogged","keyUp","Router","routes",":id/public/:scenario","_id","scenario","PublicTableView","import_"],"mappings":"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","file":"public_table.js","sourcesContent":["\n/**\n * enables a catch all for clicks to send singal in godbus to close all dialogs\n */\n\nfunction enableClickOut(el) {\n  el.click(function() {\n    cdb.god.trigger(\"closeDialogs\");\n  });\n}\n","/**\n * map tab shown in cartodb admin\n */\n\n/**\n * inside the UI all the cartodb layers should be shown merged.\n * the problem is that the editor needs the layers separated to work\n * with them so this class transform from multiple cartodb layers\n * and create only a view to represent all merged in a single layer group\n */\nfunction GrouperLayerMapView(mapViewClass) {\n\n  return {\n\n    initialize: function() {\n      this.groupLayer = null;\n      this.activeLayerModel = null;\n      mapViewClass.prototype.initialize.call(this);\n    },\n\n    _removeLayers: function() {\n      var self = this;\n      _.each(this.map.layers.getLayersByType('CartoDB'), function(layer) {\n        layer.unbind(null, null, self);\n      });\n      cdb.geo.MapView.prototype._removeLayers.call(this);\n\n      if(this.groupLayer) {\n        this.groupLayer.model.unbind();\n      }\n      this.groupLayer = null;\n    },\n\n    _removeLayer: function(layer) {\n      // if the layer is in layergroup\n      if(layer.cid in this.layers) {\n        if(this.layers[layer.cid] === this.groupLayer) {\n          this._updateLayerDefinition(layer);\n          layer.unbind(null, null, this);\n          delete this.layers[layer.cid];\n          this.trigger('removeLayerView', this);\n        } else {\n          this.trigger('removeLayerView', this);\n          cdb.geo.MapView.prototype._removeLayer.call(this, layer);\n        }\n      } else {\n        cdb.log.info(\"removing non existing layer\");\n      }\n    },\n\n    setActiveLayer: function(layer) {\n      this.activeLayerModel = layer;\n      this._setInteraction();\n    },\n\n    disableInteraction: function() {\n      if (this.groupLayer) {\n        this.groupLayer._clearInteraction();\n      }\n    },\n\n    enableInteraction: function() {\n      this._setInteraction();\n    },\n\n    // set interaction only for the active layer\n    _setInteraction: function() {\n      if(!this.groupLayer) return;\n      if(this.activeLayerModel) {\n        this.groupLayer._clearInteraction();\n        var idx = this.map.layers.getLayerDefIndex(this.activeLayerModel);\n        // when layer is not found idx == -1 so the interaction is\n        // disabled for all the layers\n        for(var i = 0; i < this.groupLayer.getLayerCount(); ++i) {\n          this.groupLayer.setInteraction(i, i == idx);\n        }\n      }\n    },\n\n    _updateLayerDefinition: function(layer) {\n      if(!layer) throw \"layer must be a valid layer (not null)\";\n      if(this.groupLayer) {\n        if(this.map.layers.getLayersByType('CartoDB').length === 0) {\n          this.groupLayer.remove();\n          this.groupLayer = null;\n        } else {\n          var def = this.map.layers.getLayerDef();\n          this.groupLayer.setLayerDefinition(def);\n          this._setInteraction();\n        }\n      }\n    },\n\n    /**\n     * when merged layers raises an error this function send the error to the\n     * layer that actually caused it\n     */\n    _routeErrors: function(errors) {\n      var styleRegExp = /style(\\d+)/;\n      var postgresExp = /layer(\\d+):/i;\n      var generalPostgresExp = /PSQL error/i;\n      var syntaxErrorExp = /syntax error/i;\n      var webMercatorErrorExp = /\"the_geom_webmercator\" does not exist/i;\n      var tilerError = /Error:/i;\n      var layers = this.map.layers.where({ visible: true, type: 'CartoDB' });\n      for(var i in errors) {\n        var err = errors[i];\n        // filter empty errors\n        if(err && err.length) {\n          var match = styleRegExp.exec(err);\n          if(match) {\n            var layerIndex = parseInt(match[1], 10);\n            layers[layerIndex].trigger('parseError', [err]);\n          } else {\n            var match = postgresExp.exec(err);\n            if(match) {\n              var layerIndex = parseInt(match[1], 10);\n              if (webMercatorErrorExp.exec(err)) {\n                err = _t(\"you should select the_geom_webmercator column\");\n                layers[layerIndex].trigger('sqlNoMercator', [err]);\n              } else {\n                layers[layerIndex].trigger('sqlParseError', [err]);\n              }\n            } else if(generalPostgresExp.exec(err) || syntaxErrorExp.exec(err) || tilerError.exec(err)) {\n              var error = 'sqlError';\n              if (webMercatorErrorExp.exec(err)) {\n                error = 'sqlNoMercator';\n                err = _t(\"you should select the_geom_webmercator column\");\n              }\n              _.each(layers, function(lyr) { lyr.trigger(error, err); });\n            } else {\n              _.each(layers, function(lyr) { lyr.trigger('error', err); });\n            }\n          }\n        }\n      }\n    },\n\n    _routeSignal: function(signal) {\n      var self = this;\n      return function() {\n        var layers = self.map.layers.where({ visible: true, type: 'CartoDB' });\n        var args = [signal].concat(arguments);\n        _.each(layers, function(lyr) { lyr.trigger.apply(lyr, args); });\n      }\n    },\n\n    _addLayer: function(layer, layers, opts) {\n\n      // create group layer to acumulate cartodb layers\n      if (layer.get('type') === 'CartoDB') {\n        var self = this;\n        if(!this.groupLayer) {\n          // create model\n          var m = new cdb.geo.CartoDBGroupLayer(\n            _.extend(layer.toLayerGroup(), {\n              user_name: this.options.user.get(\"username\"),\n              maps_api_template: cdb.config.get('maps_api_template'),\n              no_cdn: false,\n              force_cors: true // use CORS to control error management in a better way\n            })\n          );\n\n          var layer_view = mapViewClass.prototype._addLayer.call(this, m, layers, _.extend({}, opts, { silent: true }));\n          delete this.layers[m.cid];\n          this.layers[layer.cid] = layer_view;\n          this.groupLayer = layer_view;\n          m.bind('error', this._routeErrors, this);\n          m.bind('tileOk', this._routeSignal('tileOk'), this);\n          this.trigger('newLayerView', layer_view, layer, this);\n        } else {\n          this.layers[layer.cid] = this.groupLayer;\n          this._updateLayerDefinition(layer);\n          this.trigger('newLayerView', this.groupLayer, layer, this);\n        }\n\n        layer.bind('change:tile_style change:query change:query_wrapper change:interactivity change:visible', this._updateLayerDefinition, this);\n        this._addLayerToMap(this.groupLayer);\n        delete this.layers[this.groupLayer.model.cid];\n      } else {\n        mapViewClass.prototype._addLayer.call(this, layer, layers, opts);\n      }\n    }\n  }\n};\n\ncdb.admin.LeafletMapView = cdb.geo.LeafletMapView.extend(GrouperLayerMapView(cdb.geo.LeafletMapView));\n\nif (typeof(google) !== 'undefined') {\n  cdb.admin.GoogleMapsMapView = cdb.geo.GoogleMapsMapView.extend(GrouperLayerMapView(cdb.geo.GoogleMapsMapView));\n}\n\ncdb.admin.MapTab = cdb.core.View.extend({\n\n  events: {\n    'click .toggle_slides.button': '_toggleSlides',\n    'click .add_overlay.button':   'killEvent',\n    'click .canvas_setup.button':  'killEvent',\n    'click .export_image.button':  '_exportImage',\n    'click .sqlview .clearview':   '_clearView',\n    'click .sqlview .export_query':'_tableFromQuery',\n    'keydown':'_onKeyDown'\n  },\n\n  _TEXTS: {\n    no_interaction_warn: _t(\"Map interaction is disabled, select cartodb_id to enable it\")\n  },\n\n  className: 'map',\n  animation_time: 300,\n\n  initialize: function() {\n\n    this.template = this.getTemplate('table/views/maptab');\n\n    this.map  = this.model;\n    this.user = this.options.user;\n    this.vis  = this.options.vis;\n    this.master_vis  = this.options.master_vis;\n\n    this.canvas  = new cdb.core.Model({ mode: \"desktop\" });\n\n    this.map_enabled     = false;\n    this.georeferenced   = false;\n    this.featureHovered  = null;\n    this.activeLayerView = null;\n    this.layerDataView   = null;\n    this.layerModel      = null;\n    this.legends         = [];\n    this.overlays        = null;\n\n    this.add_related_model(this.map);\n    this.add_related_model(this.canvas);\n    this.add_related_model(this.map.layers);\n\n    this._addBindings();\n\n  },\n\n  _addBindings: function() {\n\n    // Actions triggered in the right panel\n    cdb.god.bind(\"panel_action\", function(action) {\n      this._moveInfo(action);\n    }, this);\n\n    this.add_related_model(cdb.god);\n\n    this.map.bind('change:provider',       this.switchMapType, this);\n    this.map.bind('change:legends',        this._toggleLegends, this);\n    this.map.layers.bind('change:visible', this._addLegends, this);\n    this.map.layers.bind('change:visible', this._addTimeline, this);\n    this.map.layers.bind('change:tile_style', this._addTimeline, this);\n    this.map.layers.bind('remove reset',   this._addLegends, this);\n    this.map.layers.bind('remove reset',   this._addTimeline, this);\n\n    _.bindAll(this, 'showNoGeoRefWarning', \"_exportImage\");\n\n  },\n\n  isMapEnabled: function() {\n    return this.map_enabled;\n  },\n\n  deactivated: function() {\n    if(this.map_enabled) {\n      this.clearMap();\n    }\n  },\n\n  clearMap: function() {\n\n    clearTimeout(this.autoSaveBoundsTimer);\n\n    this.mapView.clean();\n\n    if (this.exportImageView) {\n      this.exportImageView.clean();\n      this.exportImageView = null;\n    }\n\n    if (this.overlaysDropdown)        this.overlaysDropdown.clean();\n    if (this.mapOptionsDropdown)      this.mapOptionsDropdown.clean();\n    if (this.basemapDropdown)         this.basemapDropdown.clean();\n    if (this.configureCanvasDropdown) this.configureCanvasDropdown.clean();\n\n    if (this.zoom) {\n      this.zoom.clean();\n    }\n\n    if (this.infowindow) {\n      this.infowindow.clean();\n    }\n\n    if (this.overlays) {\n      this.overlays._cleanOverlays();\n    }\n\n    this._cleanLegends();\n\n    if (this.stackedLegend) {\n      this.stackedLegend.clean();\n    }\n\n    if (this.timeline) {\n      this.timeline.clean();\n      this.timeline = null;\n    }\n\n    if (this.geometryEditor) this.geometryEditor.clean();\n\n    if (this.table) {\n      this.table.unbind(null, null, this);\n    }\n\n    delete this.mapView;\n    delete this.overlaysDropdown;\n    delete this.basemapDropdown;\n    delete this.mapOptionsDropdown;\n    delete this.configureCanvasDropdown;\n\n    delete this.zoom;\n    delete this.infowindow;\n    delete this.layer_selector;\n    delete this.header;\n    delete this.share;\n    delete this.legends;\n    delete this.overlays;\n    delete this.legend;\n    delete this.stackedLegend;\n    delete this.geometryEditor;\n\n    this.map_enabled = false;\n\n    // place the map DOM object again\n    this.render();\n  },\n\n\n  /**\n   *  Hide the infowindow when a query is applied or cleared\n   */\n  _hideInfowindow: function() {\n    if(this.infowindow) {\n      this.infowindow.model.set('visibility', false);\n    }\n  },\n\n\n  /**\n   * this function is used when the map library is changed. Each map library\n   * works in different way and need to recreate all the components again\n   */\n  switchMapType: function() {\n\n    if (this.map_enabled) {\n      this.clearMap();\n      this.enableMap();\n    }\n\n  },\n\n  _showGMapsDeprecationDialog: function() {\n    var dialog = cdb.editor.ViewFactory.createDialogByTemplate('common/dialogs/confirm_gmaps_basemap_to_leaflet_conversion');\n\n    var self = this;\n    dialog.ok = function() {\n      self.map.set('provider', 'leaflet', { silent: true });\n      self.setupMap();\n      this.close && this.close();\n    };\n\n    dialog.cancel = function() {\n      if (self.user.isInsideOrg()) {\n        window.location = \"/u/\" + self.user.get(\"username\") + \"/dashboard\";\n      } else {\n        window.location = \"/dashboard\";\n      }\n    };\n\n    dialog.appendToBody();\n  },\n\n  /**\n   * map can't be loaded from the beggining, it needs the DOM to be loaded\n   * so we wait until is actually shown to create the mapview and show it\n   */\n  enableMap: function() {\n\n    this.render();\n\n    var baseLayer = this.map.getBaseLayer();\n\n    // check if this user has google maps enabled. In case not and the provider is google maps\n    // show a message\n    if ( typeof cdb.admin.GoogleMapsMapView === 'undefined') {\n      if (baseLayer && this.map.isProviderGmaps()) {\n        this._showGMapsDeprecationDialog();\n        return;\n      }\n    }\n\n    this.setupMap();\n\n  },\n\n  setupMap: function() {\n\n    this.$('.tipsy').remove();\n\n    var self = this;\n\n    if (!this.map_enabled) {\n\n      this._addMapView();\n\n      this.clickTimeout = null;\n\n      this._bindMissingClickEvents();\n\n      this.map_enabled = true;\n\n      $(\".map\")\n      .append('<div class=\"map-options\" />')\n      .append(\"<div class='mobile_bkg' />\");\n\n      this._addBasemapDropdown();\n      this._addInfowindow();\n      this._addTooltip();\n      this._addLegends();\n      this._addOverlays();\n\n      this._showPecan();\n\n      this._showScratchDialog();\n\n      if (this.user.featureEnabled('slides')) {\n        this._addSlides();\n      };\n\n      var torqueLayer;\n\n      var type = this.vis.get(\"type\");\n\n      if (type !== \"table\") {\n\n        this._addOverlaysDropdown();\n        this._addConfigureCanvasDropdown();\n        this._addMapOptionsDropdown();\n\n        this.canvas.on(\"change:mode\", this._onChangeCanvasMode, this);\n\n      }\n\n      this.master_vis.on(\"change:type\", function() {\n        if (this.master_vis.previous('type') === 'table') {\n          // reaload the map to show overlays and other visualization related stuff\n          this.switchMapType();\n        }\n      }, this);\n\n      // HACK\n      // wait a little bit to give time to the mapview\n      // to estabilize\n      this.autoSaveBoundsTimer = setTimeout(function() {\n        //self.mapView.setAutoSaveBounds();\n        self.mapView.on('dragend zoomend', function() {\n          self.mapView._saveLocation();\n        });\n      }, 1000);\n\n    }\n\n  },\n\n  _addMapView: function() {\n\n    var div = this.$('.cartodb-map');\n\n    var mapViewClass = cdb.admin.LeafletMapView;\n    if (this.map.get('provider') === 'googlemaps') {\n      var mapViewClass = cdb.admin.GoogleMapsMapView;\n    }\n\n    this.mapView = new mapViewClass({\n      el: div,\n      map: this.map,\n      user: this.user\n    });\n\n    this.mapView.bind('removeLayerView', function(layerView) {\n      if (this.layer_selector) this.layer_selector.render();\n    }, this);\n\n    this.mapView.bind('newLayerView', function(layerView, model) {\n      if(this.activeLayerView && this.activeLayerView.model.id === model.id) {\n        this._bindDataLayer(this.activeLayerView, model);\n\n        if (this.layer_selector) {\n          this.layer_selector.render();\n        }\n      }\n      this._addTimeline();\n    }, this);\n\n    if (this.activeLayerView) {\n      this._bindDataLayer(this.activeLayerView, this.activeLayerView.model);\n    }\n\n  },\n\n  _addConfigureCanvasDropdown: function() {\n    if (!this.configureCanvasDropdown) {\n      this.configureCanvasDropdown = new cdb.admin.ConfigureCanvasDropdown({\n        target: $('.canvas_setup'),\n        position: \"position\",\n        canvas: this.canvas,\n        template_base: \"table/views/canvas_setup_dropdown\",\n        tick: \"left\",\n        horizontal_position: \"left\",\n        horizontal_offset: \"40px\"\n      });\n\n      this.addView(this.configureCanvasDropdown);\n\n      this.configureCanvasDropdown.bind(\"onDropdownShown\", function(){\n        this.exportImageView && this.exportImageView.hide();\n      }, this);\n\n      cdb.god.bind(\"closeDialogs\", this.configureCanvasDropdown.hide, this.configureCanvasDropdown);\n      $(\".canvas_setup\").append(this.configureCanvasDropdown.render().el);\n    }\n  },\n\n  _addOverlaysDropdown: function() {\n\n    if (!this.overlaysDropdown) {\n\n      this.overlaysDropdown = new cdb.admin.OverlaysDropdown({\n        vis: this.master_vis,\n        canvas: this.canvas,\n        mapView: this.mapView,\n        target: $('.add_overlay'),\n        position: \"position\",\n        collection: this.vis.overlays,\n        template_base: \"table/views/widget_dropdown\",\n        tick: \"left\",\n        horizontal_position: \"left\",\n        horizontal_offset: \"40px\"\n      });\n\n      this.addView(this.overlaysDropdown);\n\n      this.overlaysDropdown.bind(\"onOverlayDropdownOpen\", function(){\n        this.slidesPanel && this.slidesPanel.hide();\n        this.exportImageView && this.exportImageView.hide();\n      }, this);\n\n\n      cdb.god.bind(\"closeDialogs\", this.overlaysDropdown.hide, this.overlaysDropdown);\n      cdb.god.bind(\"closeOverlayDropdown\", this.overlaysDropdown.hide, this.overlaysDropdown);\n\n      $(\".add_overlay\").append(this.overlaysDropdown.render().el);\n    }\n\n  },\n\n  _addBasemapDropdown: function() {\n\n    if (!this.basemapDropdown) {\n\n      if (this.vis.get(\"type\") !== \"table\") {\n        // TODO: use templates and _t for texts\n        var $options = $('<a href=\"#\" class=\"option-button dropdown basemap_dropdown\"><div class=\"thumb\"></div>Change basemap</a>');\n\n        $(\".map-options\").append($options);\n\n      }\n\n      this.basemapDropdown = new cdb.admin.DropdownBasemap({\n        target: $('.basemap_dropdown'),\n        position: \"position\",\n        template_base: \"table/views/basemap/basemap_dropdown\",\n        model: this.map,\n        mapview: this.mapView,\n        user: this.user,\n        baseLayers: this.options.baseLayers,\n        tick: \"left\",\n        vertical_offset: 40,\n        horizontal_position: \"left\",\n        vertical_position: this.vis.get(\"type\") === 'table' ? \"down\" : \"up\",\n        horizontal_offset: this.vis.get(\"type\") === 'table' ? 42 : 0\n      });\n\n      this.addView(this.basemapDropdown);\n\n      this.basemapDropdown.bind(\"onDropdownShown\", function() {\n        cdb.god.trigger(\"closeDialogs\");\n      });\n\n      cdb.god.bind(\"closeDialogs\", this.basemapDropdown.hide, this.basemapDropdown);\n\n      $(\".basemap_dropdown\").append(this.basemapDropdown.render().el);\n\n    }\n\n    // Set active base layer if it already exists\n    if (this.map.getBaseLayer()) {\n      this.basemapDropdown.setActiveBaselayer();\n    }\n\n  },\n\n  bindGeoRefCheck: function() {\n    if(!this.table.data().fetched) {\n      this.table.bind('dataLoaded', function() {\n        this.checkGeoRef();\n        if (!this.scratchDialog) {\n          this._showScratchDialog();\n        }\n        if (!this.pecanView) {\n          this._showPecan();\n        }\n      }, this);\n    } else {\n      this.checkGeoRef();\n    }\n  },\n\n  activated: function() {\n    this.checkGeoRef();\n    $(window).scrollTop(0);\n  },\n\n  checkGeoRef: function() {\n    if (this.options && this.table) {\n      this.georeferenced = this.table.isGeoreferenced();\n      if (this.noGeoRefDialog) {\n        this.noGeoRefDialog.hide();\n      }\n      if (!this.georeferenced) {\n        if (this.table.data().length > 0) {\n          this[ this.table.isSync() ? '_showNoGeoWarning' : 'showNoGeoRefWarning' ]();\n        }\n      }\n    }\n  },\n\n  // Shows a warning dialog when your current dialog doesn't have any\n  // geometry on it and it is synchronized\n  _showNoGeoWarning: function() {\n    var noGeoWarningDialog = 'noGeoWarningDialog_' + this.table.id + '_' + this.table.get('map_id');\n    if (this.noGeoWarningDialog || localStorage[noGeoWarningDialog]) {\n      return;\n    }\n\n    this.noGeoWarningDialog = cdb.editor.ViewFactory.createDialogByTemplate(\n      'table/views/no_geo_warning_template', {\n        clean_on_hide: true\n      }\n    );\n\n    this.noGeoWarningDialog.bind(\"hide\", function() {\n      localStorage[noGeoWarningDialog] = true;\n    });\n\n    this.noGeoWarningDialog.appendToBody();\n  },\n\n  _showPecan: function() {\n\n    var hasPecan     = this.user.featureEnabled('pecan_cookies');\n\n    var hasData = this.options.table && this.options.table.data() && this.options.table.data().length > 0 ? true : false;\n\n    if (hasPecan && hasData) {\n\n      var skipPencanDialog = 'pecan_' + this.options.user.get(\"username\") + \"_\" + this.options.table.id;\n\n      if (!localStorage[skipPencanDialog]) {\n\n        this.pecanView = new cdb.editor.PecanView({\n          table: this.options.table,\n          backgroundPollingModel: this.options.backgroundPollingModel\n        });\n      }\n    }\n  },\n\n  _showScratchDialog: function() {\n    if (this.options.table && this.options.table.data().fetched && this.options.table.data().length === 0) {\n\n      var skipScratchDialog = 'scratchDialog_' + this.options.table.id + '_' + this.options.table.get('map_id');\n\n      if (!localStorage[skipScratchDialog]) {\n\n        this.scratchDialog = new cdb.editor.ScratchView({\n          table: this.options.table\n        });\n\n        this.scratchDialog.appendToBody();\n\n        this.scratchDialog.bind(\"newGeometry\", function(type) {\n          this._addGeometry(type);\n        }, this);\n\n        this.scratchDialog.bind(\"skip\", function() {\n          localStorage[skipScratchDialog] = true;\n        });\n      }\n    }\n  },\n\n  /**\n   * this function binds click and dblclick events\n   * in order to not raise click when user does a dblclick\n   *\n   * it raises a missingClick when the user clicks on the map\n   * but not over a feature or ui component\n   */\n  _bindMissingClickEvents: function() {\n    var self = this;\n    this.mapView.bind('click', function(e) {\n      if(self.clickTimeout === null) {\n        self.clickTimeout = setTimeout(function() {\n          self.clickTimeout = null;\n          if(!self.featureHovered) {\n            self.trigger('missingClick');\n          }\n        }, 150);\n      }\n      //google maps does not send an event\n      if(!self.featureHovered && e.preventDefault) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    });\n\n    this.mapView.bind('dblclick', function() {\n      if(self.clickTimeout !== null) {\n        clearTimeout(self.clickTimeout);\n        self.clickTimeout = null;\n      }\n    });\n  },\n\n  setActiveLayer: function(layerView) {\n    this.activeLayerView = layerView;\n    // check if the map is rendered and the layer is in the map\n    if(this.mapView && this.mapView.getLayerByCid(layerView.model.cid)) {\n      var layerModel = layerView.model;\n      this._bindDataLayer(layerView, layerModel);\n    }\n  },\n\n  /**\n   * when the layer view is created this method is called\n   * to attach all the click events\n   */\n  _bindDataLayer: function(layerView, layer) {\n    var self = this;\n    var layerType = layer.get('type');\n\n    if (layerType === 'CartoDB' || layerType === 'torque') { // unbind previos stuff\n\n      // Set data layer bindings\n      if (self.layerDataView) {\n        self.layerDataView.unbind(null, null, this);\n      }\n\n      if (self.layerModel) {\n        self.layerModel.unbind(null, null, this);\n      }\n\n      if (self.options.geocoder) {\n        self.options.geocoder.unbind(null, null, this);\n      }\n\n      self.infowindowModel  = layer.infowindow;\n      self.tooltipModel     = layer.tooltip;\n      self.legendModel      = layer.legend;\n\n      self._bindTable(layer.table);\n      self._bindSQLView(layer.sqlView);\n      self.layerDataView = self.mapView.getLayerByCid(layer.cid);\n\n      self.mapView.setActiveLayer(layer);\n      self._addLegends();\n      self._addTimeline();\n\n      if (self.layerDataView) {\n        self.layerDataView.bind('featureClick', self.featureClick, self);\n        self.layerDataView.bind('featureOut',   self.featureOut,   self);\n        self.layerDataView.bind('featureOver',  self.featureOver,  self);\n        self.layerDataView.bind('loading',      self.loadingTiles, self);\n        self.layerDataView.bind('load',         self.loadTiles,    self);\n        self.layerDataView.bind('error',        self.loadTiles,    self);\n        self.tooltip\n          .setLayer(self.layerDataView)\n          .enable();\n\n      }\n\n      // Set layer model binding\n      if (layerView && layer) {\n        layer.unbind('startEdition',this._addGeometry, this);\n        layer.bind('startEdition', this._addGeometry, this);\n      }\n\n      if(layer) {\n        self.layerModel = layer;\n        //TODO: unbind this at some point\n        layer.bind('change:interactivity', this._updateSQLHeader, this);\n        this._updateSQLHeader();\n      }\n\n      if (self.options.geocoder) {\n        self.options.geocoder.bind('geocodingComplete geocodingError geocodingCanceled', this.updateDataLayerView, this);\n        self.add_related_model(self.options.geocoder);\n      }\n\n    }\n  },\n\n  _cleanLegends: function() {\n\n    if (this.legends) {\n      _.each(this.legends, function(legend) {\n        legend.clean();\n      });\n\n    }\n\n    this.legends = [];\n\n  },\n\n\n  _getCartoDBLayers: function() {\n\n    return this.map.layers.models.filter(function(layerModel) {\n      return layerModel.get(\"type\") === 'CartoDB'\n    });\n\n  },\n\n  _onKeyDown: function(e) {\n    if (this.overlays && e.which == 86 && (e.ctrlKey || e.metaKey)) {\n      this.overlays.paste();\n    }\n  },\n\n  _onChangeCanvasMode: function() {\n\n    var self = this;\n\n    cdb.god.trigger(\"closeDialogs\");\n\n    var mode = this.canvas.get(\"mode\");\n\n    if (mode === \"desktop\") {\n\n      this._showDesktopCanvas(mode);\n\n      if (this.overlays.loader && this.overlays.fullscreen) {\n        setTimeout(function() {\n          self.overlays && self.overlays._positionOverlaysVertically(true);\n        }, 500);\n      }\n\n    } else if (mode === \"mobile\") {\n\n      this._showMobileCanvas(mode);\n\n      setTimeout(function() {\n        self.overlays && self.overlays._positionOverlaysVertically(true);\n      }, 300);\n\n    }\n\n  },\n\n  _showMobileCanvas: function(mode) {\n\n    var self = this;\n\n    var width  = 288;\n    var height = 476;\n\n    this.overlays._hideOverlays(\"desktop\");\n\n    var $map = $(\"div.map div.cartodb-map\");\n\n    this.$el.addClass(mode);\n\n    // Animations step - 1\n    var onBackgroundShown = function() {\n\n      $map.animate(\n        { width: width, marginLeft: -Math.round(width/2) - 1, left: \"50%\" },\n        { easing: \"easeOutQuad\", duration: 200, complete: onCanvasLandscapeStretched }\n      );\n\n    };\n\n    // Animations step - 2\n    var onCanvasPortraitStretched = function() {\n\n      self.$el.find(\".mobile_bkg\").animate(\n        { opacity: 1 },\n        { duration: 250 }\n      );\n\n      self.overlays._showOverlays(mode);\n\n      // Let's set center view for mobile mode\n      var center = self.map.get('center');\n      self.mapView.invalidateSize();\n      $map.fadeOut(250);\n\n      setTimeout(function() {\n        self.mapView.map.setCenter(center);\n        $map.fadeIn(250);\n      },300);\n\n    };\n\n    // Animations step - 3\n    var onCanvasLandscapeStretched = function() {\n\n      $map.animate(\n        { height: height, marginTop: -Math.round(height/2) + 23,  top:  \"50%\" },\n        { easing: \"easeOutQuad\", duration: 200, complete: onCanvasPortraitStretched }\n      );\n\n    };\n\n    onBackgroundShown();\n\n    this._enableAnimatedMap();\n    this._enableMobileLayout();\n\n  },\n\n  _enableMobileLayout: function() {\n\n    if (!this.mobile) {\n\n      var torqueLayer;\n\n      this.mobile = new cdb.admin.overlays.Mobile({\n        mapView: this.mapView,\n        overlays: this.overlays,\n        map: this.map\n      });\n\n      this.mapView.$el.append(this.mobile.render().$el);\n\n    } else {\n      this.mobile.show();\n    }\n\n  },\n\n  _disableMobileLayout: function() {\n\n    if (this.mobile) this.mobile.hide();\n\n  },\n\n  _showDesktopCanvas: function(mode) {\n\n    var self = this;\n\n    this.overlays._hideOverlays(\"mobile\");\n\n    this.$el.removeClass(\"mobile\");\n\n    this.$el.find(\".mobile_bkg\").animate({ opacity: 0}, 250);\n\n    var\n    $map       = $(\"div.map div.cartodb-map\"),\n    top        = $map.css(\"top\"),\n    left       = $map.css(\"left\"),\n    mTop       = $map.css(\"marginTop\"),\n    mLeft      = $map.css(\"marginLeft\"),\n    curWidth   = $map.width(),\n    curHeight  = $map.height(),\n    autoWidth  = $map.css({width:  'auto', marginLeft: 0, left: \"15px\"}).width();  //temporarily change to auto and get the width.\n    autoHeight = $map.css({height: 'auto', marginTop: 0,  top: \"82px\" }).height(); //temporarily change to auto and get the width.\n\n    $map.height(curHeight);\n    $map.width(curWidth);\n\n    $map.css({ top: top, left: left, marginLeft: mLeft, marginTop: mTop, height: curHeight, width: curWidth });\n\n    var onSecondAnimationFinished = function() {\n\n      $map.css('width', 'auto');\n      self.overlays._showOverlays(mode);\n\n      // Let's set center view for desktop mode\n      var center = self.map.get('center');\n      self.mapView.invalidateSize();\n\n      setTimeout(function() {\n        self.mapView.map.setCenter(center);\n      },300);\n\n    };\n\n    var onFirstAnimationFinished = function() {\n\n      $map.css('height', 'auto');\n      $map.animate(\n        { width: autoWidth, left: \"15px\", marginLeft: \"0\"},\n        { easing: \"easeOutQuad\", duration: 200, complete: onSecondAnimationFinished }\n      );\n\n    };\n\n    var stretchMapLandscape = function() {\n      $map.animate(\n        { height: autoHeight, top: \"82\", marginTop: \"0\"},\n        { easing: \"easeOutQuad\", duration: 200, complete: onFirstAnimationFinished }\n      );\n    };\n\n    stretchMapLandscape();\n\n    this._disableAnimatedMap();\n    this._disableMobileLayout();\n\n  },\n\n  _enableAnimatedMap: function() {\n\n    var self = this;\n\n    setTimeout(function() {\n      self.$el.addClass(\"animated\");\n    }, 800)\n\n  },\n\n  _disableAnimatedMap: function() {\n    this.$el.removeClass(\"animated\");\n  },\n\n  _addMapOptionsDropdown: function() {\n\n    if (!this.mapOptionsDropdown) {\n\n      var $options = $(\"<a href='#show-options' class='option-button show-table-options'>Options</a>\");\n\n      this.$options = $options;\n\n      $(\".map-options\").append($options);\n\n      this.mapOptionsDropdown = new cdb.admin.MapOptionsDropdown({\n        target:              $('.show-table-options'),\n        template_base:       \"table/views/map_options_dropdown\",\n        table:               table,\n        model:               this.map,\n        mapview:             this.mapView,\n        collection:          this.vis.overlays,\n        user:                this.user,\n        vis:                 this.vis,\n        canvas:              this.canvas,\n        position:            \"position\",\n        tick:                \"left\",\n        vertical_position:   \"up\",\n        horizontal_position: \"left\",\n        horizontal_offset:   \"-3px\"\n      });\n\n      this._bindMapOptions();\n\n      this.addView(this.mapOptionsDropdown);\n\n      $(\".show-table-options\").append(this.mapOptionsDropdown.render().el);\n\n    }\n\n  },\n\n  _bindMapOptions: function() {\n\n    this.mapOptionsDropdown.bind(\"onDropdownShown\", function() {\n      cdb.god.trigger(\"closeDialogs\");\n      this.$options.addClass(\"open\");\n    }, this);\n\n    this.mapOptionsDropdown.bind(\"onDropdownHidden\", function() {\n      this.$options.removeClass(\"open\");\n    }, this);\n\n    this.mapOptionsDropdown.bind(\"createOverlay\", function(overlay_type, property) {\n      this.vis.overlays.createOverlayByType(overlay_type, property);\n    }, this);\n\n    cdb.god.bind(\"closeDialogs\", this.mapOptionsDropdown.hide, this.mapOptionsDropdown);\n\n  },\n\n  _addOverlays: function() {\n    this.overlays = new cdb.admin.MapOverlays({\n      headerMessageIsVisible: this._shouldAddSQLViewHeader(),\n      vis: this.vis,\n      canvas: this.canvas,\n      mapView: this.mapView,\n      master_vis: this.master_vis,\n      mapToolbar: this.$el.find(\".map_toolbar\")\n    });\n\n  },\n\n  _exportImage: function(e) {\n\n    this.killEvent(e);\n\n    if (this.exportImageView) {\n      return;\n    }\n\n    this.exportImageView = new cdb.admin.ExportImageView({\n      vizjson:  this.vis.vizjsonURL(),\n      vis:      this.vis,\n      user:     this.options.user,\n      overlays: this.overlays,\n      mapView:  this.mapView,\n      width:    this.mapView.$el.width(),\n      height:   this.mapView.$el.height(),\n      map:      this.map\n    });\n\n    this.exportImageView.bind(\"was_removed\", function() {\n      this.exportImageView = null;\n    }, this);\n\n    this.mapView.$el.append(this.exportImageView.render().$el);\n\n    cdb.god.bind(\"panel_action\", function(action) {\n      if (action !== \"hide\" && this.exportImageView) {\n        this.exportImageView.hide();\n      }\n    }, this);\n  },\n\n  _addSlides: function() {\n\n    if (!this.vis.isVisualization()) return;\n\n    this.slidesPanel = new cdb.admin.SlidesPanel({\n      user: this.user,\n      slides:  this.vis.slides,\n      toggle: this.$el.find(\".toggle_slides\")\n    });\n\n    this.slidesPanel.bind(\"onChangeVisible\", function() {\n      this.exportImageView && this.exportImageView.hide();\n    }, this);\n\n    this.$el.append(this.slidesPanel.render().el);\n\n    this.addView(this.slidesPanel);\n\n  },\n\n  _addLegends: function() {\n\n    var self = this;\n\n    this._cleanLegends();\n    \n    if (!this.map.get(\"legends\")) {\n      return;\n    }\n\n    var models = this.map.layers.models;\n\n    for (var i = models.length - 1; i >= 0; --i) {\n      var layer = models[i];\n      self._addLegend(layer);\n    }\n\n  },\n\n  _addLegend: function(layer) {\n\n    var type = layer.get('type');\n\n    if (type === 'CartoDB' || type === 'torque') {\n\n      if (this.table && this.mapView) {\n\n        if (this.legend) this.legend.clean();\n\n        if (layer.get(\"visible\")) {\n\n          var legend = new cdb.geo.ui.Legend({\n            model:   layer.legend,\n            mapView: this.mapView,\n            table:   this.table\n          });\n\n          if (this.legends) {\n            this.legends.push(legend);\n            this._renderStackedLengeds();\n          }\n\n        }\n      }\n    }\n\n  },\n  \n  _toggleLegends: function() {\n    if (this.map.get(\"legends\")) {\n      this._addLegends();\n    } else {\n      this._cleanLegends();\n    }\n  },\n\n  _addTimeline: function() {\n    if (!this.mapView) return;\n    // check if there is some torque layer\n    if(!this.map.layers.any(function(lyr) { return lyr.get('type') === 'torque' && lyr.get('visible'); })) {\n      this.timeline && this.timeline.clean();\n      this.timeline = null;\n    } else {\n      var layer = this.map.layers.getLayersByType('torque')[0];\n      var steps = layer.wizard_properties.get('torque-frame-count');\n\n      if (this.timeline) {\n        // check if the model is different\n        if (this.timeline.torqueLayer.model.cid !== layer.cid) {\n          this.timeline.clean();\n          this.timeline = null;\n        }\n      }\n\n      layerView = this.mapView.getLayerByCid(layer.cid);\n\n      if (layerView && typeof layerView.getStep !== \"undefined\" && steps > 1) {\n        if (!this.timeline) {\n          this.timeline = new cdb.geo.ui.TimeSlider({\n            layer: layerView,\n            width: \"auto\"\n          });\n\n          this.mapView.$el.append(this.timeline.render().$el);\n          this.addView(this.timeline);\n        } else {\n          this.timeline.setLayer(layerView);\n        }\n      }\n      else if (this.timeline) {\n        this.timeline.clean();\n        this.timeline = null;\n      }\n    }\n  },\n\n  _renderStackedLengeds: function() {\n\n    if (this.stackedLegend) this.stackedLegend.clean();\n    if (this.legend)        this.legend.clean();\n\n    this.stackedLegend = new cdb.geo.ui.StackedLegend({\n      legends: this.legends\n    });\n\n    this.mapView.$el.append(this.stackedLegend.render().$el);\n    this.addView(this.stackedLegend);\n\n  },\n\n  _renderLegend: function() {\n\n    if (this.legend) this.legend.clean();\n\n    this.legend = this.legends[0];\n\n    this.mapView.$el.append(this.legend.render().$el);\n\n    if (!this.legend.model.get(\"type\")) this.legend.hide();\n    else this.legend.show();\n\n    this.addView(this.legend);\n\n  },\n\n  _addTooltip: function() {\n    if(this.tooltip) this.tooltip.clean();\n    if(this.table && this.mapView) {\n      this.tooltip = new cdb.admin.Tooltip({\n        model: this.tooltipModel,\n        table: this.table,\n        mapView: this.mapView,\n        omit_columns: ['cartodb_id'] // don't show cartodb_id while hover\n      });\n      this.mapView.$el.append(this.tooltip.render().el);\n      this.tooltip.bind('editData', this._editData, this);\n      this.tooltip.bind('removeGeom', this._removeGeom, this);\n      this.tooltip.bind('editGeom', this._editGeom, this);\n      if (this.layerDataView) {\n        this.tooltip\n          .setLayer(this.layerDataView)\n          .enable();\n      }\n    }\n  },\n\n  _addInfowindow: function() {\n    if(this.infowindow) this.infowindow.clean();\n    if(this.table && this.mapView) {\n      this.infowindow = new cdb.admin.MapInfowindow({\n        model: this.infowindowModel,\n        mapView: this.mapView,\n        table: this.table\n      });\n      this.mapView.$el.append(this.infowindow.el);\n\n      // Editing geometry\n      if(this.geometryEditor) {\n        this.geometryEditor.discard();\n        this.geometryEditor.clean();\n      }\n\n      this.geometryEditor = new cdb.admin.GeometryEditor({\n        user: this.user,\n        model: this.table\n      });\n\n      this.geometryEditor.mapView = this.mapView;\n      this.mapView.$el.append(this.geometryEditor.render().el);\n      this.geometryEditor.hide();\n\n      this.geometryEditor.bind('editStart', this.hideDataLayer, this);\n      this.geometryEditor.bind('editDiscard', this.showDataLayer, this);\n      this.geometryEditor.bind('editFinish', this.showDataLayer, this);\n      this.geometryEditor.bind('editFinish', this.updateDataLayerView, this);\n      this.geometryEditor.bind('geomCreated', function(row) {\n        this.table.data().add(row);\n      }, this);\n\n      var self = this;\n\n      this.infowindow.bind('editData', this._editData, this);\n      this.infowindow.bind('removeGeom', this._removeGeom, this);\n      this.infowindow.bind('editGeom', this._editGeom, this);\n\n      this.infowindow.bind('openInfowindowPanel', function() {\n        this.activeLayerView.showModule('infowindow', 'fields');\n      }, this);\n\n      this.infowindow.bind('close', function() {\n        if (this.tooltip) {\n          this.tooltip.setFilter(null);\n        }\n      }, this);\n\n      this.table.bind('remove:row', this.updateDataLayerView, this);\n\n      this.table.bind('change:dataSource', function() {\n        if (this.geometryEditor) this.geometryEditor.discard();\n      }, this);\n\n      this.map.bind('change:provider', function() {\n        if (this.geometryEditor) this.geometryEditor.discard();\n      }, this);\n    }\n  },\n\n  _editGeom: function(row) {\n    // when provider is leaflet move the world to [-180, 180]\n    // because vector features are only rendered on that slice\n    if (this.map.get('provider') === 'leaflet') {\n      this.map.clamp();\n    }\n    this.geometryEditor.editGeom(row);\n  },\n\n  /**\n   * Shows edit data modal window\n   */\n  _editData: function(row) {\n    if (!this.table.isReadOnly()) {\n      var self = this;\n      row.fetch({ cache: false, no_geom: true, success: function() {\n        var dlg = new cdb.editor.FeatureDataView({\n          row: row,\n          provider: self.map.get('provider'),\n          baseLayer: self.map.getBaseLayer().clone(),\n          dataLayer: self.layerModel.clone(),\n          currentZoom: self.map.getZoom(),\n          enter_to_confirm: false,\n          table: self.table,\n          user: self.user,\n          clean_on_hide: true,\n          onDone: self.updateDataLayerView.bind(self) // Refreshing layer when changes have been done\n        });\n\n        dlg.appendToBody();\n      }});\n\n      return false;\n    }\n  },\n\n  /**\n   * triggers an removeGeom event when the geometry\n   * is removed from the server\n   */\n  _removeGeom: function(row) {\n    if (!this.table.isReadOnly()) {\n      var view = new cdb.editor.DeleteRowView({\n        name: 'feature',\n        table: this.table,\n        row: row,\n        clean_on_hide: true,\n        enter_to_confirm: true,\n        wait: true // to not remove from parent collection until server-side confirmed deletion\n      });\n      view.appendToBody();\n\n      return false;\n    }\n  },\n\n  _addGeometry: function(type) {\n    this.geometryEditor.createGeom(this.table.data().newRow(), type);\n  },\n\n  _bindTable: function(table) {\n    if (this.table) {\n      this.table.unbind(null, null, this);\n    }\n\n    this.table = table;\n\n    this.table.bind('change:dataSource', this._hideInfowindow, this);\n    this.table.bind('change:dataSource', this._updateSQLHeader, this);\n    this.table.bind('change:schema',     this._updateSQLHeader, this);\n\n    this.table.bind('data:saved', this.updateDataLayerView, this);\n\n    this._addInfowindow();\n\n    this._addLegends();\n    this._addTooltip();\n\n    this.bindGeoRefCheck();\n  },\n\n  _bindSQLView: function(sqlView) {\n    if(this.sqlView) {\n      this.sqlView.unbind(null, null, this);\n    }\n    this.sqlView = sqlView;\n    this.sqlView.bind('reset error', this._updateSQLHeader, this);\n    this.sqlView.bind('loading', this._renderLoading, this);\n    this._updateSQLHeader();\n  },\n\n  _renderLoading: function(opts) {\n    this._removeSQLViewHeader();\n\n    //TODO: remove this hack\n    if ($('.table_panel').length > 0) {\n      panel_opened = $('.table_panel').css(\"right\").replace(\"px\",\"\") == 0\n    }\n\n    var html = this.getTemplate('table/views/sql_view_notice_loading')({\n      panel_opened: panel_opened\n    });\n\n    if (this.overlays) {\n      this.overlays.setHeaderMessageIsVisible(true);\n    }\n\n    this.$('.cartodb-map').after(html);\n  },\n\n  _updateSQLHeader: function() {\n    if (this._shouldAddSQLViewHeader()) {\n      this._addSQLViewHeader();\n    } else {\n      this._removeSQLViewHeader();\n    }\n  },\n\n  _shouldAddSQLViewHeader: function() {\n    return this.table && this.table.isInSQLView();\n  },\n\n  loadingTiles: function() {\n    if (this.overlays.loader) this.overlays.loader.show();\n  },\n\n  loadTiles: function() {\n    if (this.overlays.loader) this.overlays.loader.hide();\n  },\n\n  featureOver: function(e, latlon, pxPos, data) {\n    if(this.infowindowModel.get('disabled')) return;\n    this.mapView.setCursor('pointer');\n    this.featureHovered = data;\n  },\n\n  featureOut: function() {\n    if(this.infowindowModel.get('disabled')) return;\n    this.mapView.setCursor('auto');\n    this.featureHovered = null;\n  },\n\n  featureClick: function(e, latlon, pxPos, data) {\n    if(this.infowindowModel.get('disabled')) return;\n    if(!this.geometryEditor.isEditing()) {\n      if(data.cartodb_id) {\n        this.infowindow\n          .setLatLng(latlon)\n          .setFeatureInfo(data.cartodb_id)\n          .showInfowindow();\n\n        this.tooltip.setFilter(function(feature) {\n          return feature.cartodb_id !== data.cartodb_id;\n        }).hide();\n      } else {\n        cdb.log.error(\"can't show infowindow, no cartodb_id on data\");\n      }\n    }\n  },\n\n  /**\n   *  Move all necessary blocks when panel is openned (normal, narrowed,...) or closed\n   */\n  _moveInfo: function(type) {\n    if (type === \"show\") {\n      this.$el\n        .removeClass('narrow')\n        .addClass('displaced');\n    } else if (type === \"hide\") {\n      this.$el.removeClass('narrow displaced');\n    } else if (type === \"narrow\") {\n      this.$el.addClass('narrow displaced');\n    }\n  },\n\n  render: function() {\n\n    this.$el.html('');\n\n    this.$el\n    .removeClass(\"mobile\")\n    .removeClass(\"derived\")\n    .removeClass(\"table\");\n\n    this.$el.addClass(this.vis.isVisualization() ? 'derived': 'table');\n    var provider = this.map.get(\"provider\");\n\n    this.$el.append(this.template({\n      slides_enabled: this.user.featureEnabled('slides'),\n      type: this.vis.get('type'),\n      exportEnabled: !this.map.isProviderGmaps()\n    }));\n\n    return this;\n\n  },\n\n  showDataLayer: function() {\n    this.mapView.enableInteraction();\n    this.layerDataView.setOpacity && this.layerDataView.setOpacity(1.0);\n  },\n\n  hideDataLayer: function() {\n    this.mapView.disableInteraction();\n    this.layerDataView.setOpacity && this.layerDataView.setOpacity(0.5);\n  },\n\n  /**\n   * reload tiles\n   */\n  updateDataLayerView: function() {\n    if(this.layerDataView) {\n      this.layerDataView.invalidate();\n    }\n  },\n  /**\n   * Paints a dialog with a warning when the user hasn't any georeferenced row\n   * @method showNoGeorefWarning\n   */\n  showNoGeoRefWarning: function() {\n    var warningStorageName = 'georefNoContentWarningShowed_' + this.table.id + '_' + this.table.get('map_id');\n\n    // if the dialog already has been shown, we don't show it again\n    if(!this.noGeoRefDialog && !this.table.isInSQLView() && (!localStorage[warningStorageName])) {\n      localStorage[warningStorageName] = true;\n\n      this.noGeoRefDialog = new cdb.editor.GeoreferenceView({\n        table: this.table,\n        user: this.user\n      });\n      this.noGeoRefDialog.appendToBody();\n    }\n\n  },\n\n  //adds the green indicator when a query is applied\n  _addSQLViewHeader: function() {\n    this.$('.sqlview').remove();\n    var total = this.table.data().size();\n    var warnMsg = null;\n    // if the layer does not suppor interactivity do not show the message\n    if (this.layerModel && !this.layerModel.get('interactivity') && this.layerModel.wizard_properties.supportsInteractivity()) {\n      warnMsg = this._TEXTS.no_interaction_warn;\n    }\n    if (this.layerModel && !this.layerModel.table.containsColumn('the_geom_webmercator')) {\n      warnMsg = _t('the_geom_webmercator column should be selected');\n    }\n    var html = this.getTemplate('table/views/sql_view_notice')({\n      empty: !total,\n        isVisualization: this.vis.isVisualization(),\n        warnMsg: warnMsg\n    });\n\n    this.$('.cartodb-map').after(html);\n\n    if (this.overlays) {\n      this.overlays.setHeaderMessageIsVisible(true);\n    }\n  },\n\n  _removeSQLViewHeader: function() {\n    this.$('.sqlview').remove();\n\n    if (this.overlays) {\n      this.overlays.setHeaderMessageIsVisible(false);\n    }\n  },\n\n  _toggleSlides: function(e) {\n    this.killEvent(e);\n    this.slidesPanel && this.slidesPanel.toggle();\n  },\n\n  _clearView: function(e) {\n    this.killEvent(e);\n    this.activeLayerView.model.clearSQLView();\n    return false;\n  },\n\n  _tableFromQuery: function(e) {\n    this.killEvent(e);\n\n    var duplicate_dialog = new cdb.editor.DuplicateDatasetView({\n      model: this.table,\n      user: this.user,\n      clean_on_hide: true\n    });\n    duplicate_dialog.appendToBody();\n  }\n\n});\n","/* Modernizr 2.5.3 (Custom Build) | MIT & BSD\n * Build: http://modernizr.com/download/#-shiv-cssclasses-load\n */\n;window.Modernizr=function(a,b,c){function u(a){j.cssText=a}function v(a,b){return u(prefixes.join(a+\";\")+(b||\"\"))}function w(a,b){return typeof a===b}function x(a,b){return!!~(\"\"+a).indexOf(b)}function y(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:w(f,\"function\")?f.bind(d||b):f}return!1}var d=\"2.5.3\",e={},f=!0,g=b.documentElement,h=\"modernizr\",i=b.createElement(h),j=i.style,k,l={}.toString,m={},n={},o={},p=[],q=p.slice,r,s={}.hasOwnProperty,t;!w(s,\"undefined\")&&!w(s.call,\"undefined\")?t=function(a,b){return s.call(a,b)}:t=function(a,b){return b in a&&w(a.constructor.prototype[b],\"undefined\")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!=\"function\")throw new TypeError;var d=q.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(q.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(q.call(arguments)))};return e});for(var z in m)t(m,z)&&(r=z.toLowerCase(),e[r]=m[z](),p.push((e[r]?\"\":\"no-\")+r));return u(\"\"),i=k=null,function(a,b){function g(a,b){var c=a.createElement(\"p\"),d=a.getElementsByTagName(\"head\")[0]||a.documentElement;return c.innerHTML=\"x<style>\"+b+\"</style>\",d.insertBefore(c.lastChild,d.firstChild)}function h(){var a=k.elements;return typeof a==\"string\"?a.split(\" \"):a}function i(a){var b={},c=a.createElement,e=a.createDocumentFragment,f=e();a.createElement=function(a){var e=(b[a]||(b[a]=c(a))).cloneNode();return k.shivMethods&&e.canHaveChildren&&!d.test(a)?f.appendChild(e):e},a.createDocumentFragment=Function(\"h,f\",\"return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&(\"+h().join().replace(/\\w+/g,function(a){return b[a]=c(a),f.createElement(a),'c(\"'+a+'\")'})+\");return n}\")(k,f)}function j(a){var b;return a.documentShived?a:(k.shivCSS&&!e&&(b=!!g(a,\"article,aside,details,figcaption,figure,footer,header,hgroup,nav,section{display:block}audio{display:none}canvas,video{display:inline-block;*display:inline;*zoom:1}[hidden]{display:none}audio[controls]{display:inline-block;*display:inline;*zoom:1}mark{background:#FF0;color:#000}\")),f||(b=!i(a)),b&&(a.documentShived=b),a)}var c=a.html5||{},d=/^<|^(?:button|form|map|select|textarea)$/i,e,f;(function(){var a=b.createElement(\"a\");a.innerHTML=\"<xyz></xyz>\",e=\"hidden\"in a,f=a.childNodes.length==1||function(){try{b.createElement(\"a\")}catch(a){return!0}var c=b.createDocumentFragment();return typeof c.cloneNode==\"undefined\"||typeof c.createDocumentFragment==\"undefined\"||typeof c.createElement==\"undefined\"}()})();var k={elements:c.elements||\"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video\",shivCSS:c.shivCSS!==!1,shivMethods:c.shivMethods!==!1,type:\"default\",shivDocument:j};a.html5=k,j(b)}(this,b),e._version=d,g.className=g.className.replace(/(^|\\s)no-js(\\s|$)/,\"$1$2\")+(f?\" js \"+p.join(\" \"):\"\"),e}(this,this.document),function(a,b,c){function d(a){return o.call(a)==\"[object Function]\"}function e(a){return typeof a==\"string\"}function f(){}function g(a){return!a||a==\"loaded\"||a==\"complete\"||a==\"uninitialized\"}function h(){var a=p.shift();q=1,a?a.t?m(function(){(a.t==\"c\"?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){a!=\"img\"&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l={},o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};y[c]===1&&(r=1,y[c]=[],l=b.createElement(a)),a==\"object\"?l.data=c:(l.src=c,l.type=a),l.width=l.height=\"0\",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),a!=\"img\"&&(r||y[c]===2?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||\"j\",e(a)?i(b==\"c\"?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),p.length==1&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName(\"script\")[0],o={}.toString,p=[],q=0,r=\"MozAppearance\"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&o.call(a.opera)==\"[object Opera]\",l=!!b.attachEvent&&!l,u=r?\"object\":l?\"script\":\"img\",v=l?\"script\":u,w=Array.isArray||function(a){return o.call(a)==\"[object Array]\"},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split(\"!\"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split(\"=\"),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,i){var j=b(a),l=j.autoCallback;j.url.split(\".\").pop().split(\"?\").shift(),j.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split(\"/\").pop().split(\"?\")[0]]||h),j.instead?j.instead(a,e,f,g,i):(y[j.url]?j.noexec=!0:y[j.url]=1,f.load(j.url,j.forceCSS||!j.forceJS&&\"css\"==j.url.split(\".\").pop().split(\"?\").shift()?\"c\":c,j.noexec,j.attrs,j.timeout),(d(e)||d(l))&&f.load(function(){k(),e&&e(j.origUrl,i,g),l&&l(j.origUrl,i,g),y[j.url]=2})))}function i(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var j,l,m=this.yepnope.loader;if(e(a))g(a,0,m,0);else if(w(a))for(j=0;j<a.length;j++)l=a[j],e(l)?g(l,0,m,0):w(l)?B(l):Object(l)===l&&i(l,m);else Object(a)===a&&i(a,m)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,b.readyState==null&&b.addEventListener&&(b.readyState=\"loading\",b.addEventListener(\"DOMContentLoaded\",A=function(){b.removeEventListener(\"DOMContentLoaded\",A,0),b.readyState=\"complete\"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement(\"script\"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement(\"link\"),j,c=i?h:c||f;e.href=a,e.rel=\"stylesheet\",e.type=\"text/css\";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};","// tipsy, facebook style tooltips for jquery with fancy fading\n// version 1.0.0a\n// (c) 2008-2010 jason frame [jason@onehackoranother.com] and modificated by Sergio Alvarez @saleiva\n// released under the MIT license\n//\n//  Changes:\n//  April 27 2016: fixed problem with element size.\n//  June 3 2013: Added the custom class before the calc of the position.\n\n(function($) {\n\n  var MOVE_OFFSET = 6;\n\n  function maybeCall(thing, ctx) {\n    return (typeof thing == 'function') ? (thing.call(ctx)) : thing;\n  };\n\n  function isElementInDOM(ele) {\n    while (ele = ele.parentNode) {\n      if (ele == document) return true;\n    }\n    return false;\n  };\n\n  function Tipsy(element, options) {\n    this.$element = $(element);\n    this.options = options;\n    this.enabled = true;\n    this.fixTitle();\n  };\n\n  Tipsy.prototype = {\n    show: function() {\n      var title = this.getTitle();\n      if (title && this.enabled) {\n        var $tip = this.tip();\n\n        $tip.find('.tipsy-inner')[this.options.html ? 'html' : 'text'](title);\n            $tip[0].className = 'tipsy'; // reset classname in case of dynamic gravity\n            $tip.remove().css({top: 0, left: 0, visibility: 'hidden', display: 'block'}).prependTo(document.body);\n\n            // Modified so we can use custom class names\n            if (this.options.className) {\n              $tip.addClass(maybeCall(this.options.className, this.$element[0]));\n            }\n\n            // Modified\n            var pos = $.extend({}, this.$element.offset(), {\n              width: this.$element[0].getBoundingClientRect().width,\n              height: this.$element[0].getBoundingClientRect().height\n            });\n\n            var actualWidth = $tip[0].offsetWidth,\n            actualHeight = $tip[0].offsetHeight,\n            gravity = maybeCall(this.options.gravity, this.$element[0]);\n\n            var tp;\n            switch (gravity.charAt(0)) {\n              case 'n':\n              tp = {top: pos.top + pos.height + this.options.offset, left: pos.left + pos.width / 2 - actualWidth / 2};\n              mo = {top: parseInt(pos.top + pos.height + this.options.offset + MOVE_OFFSET), opacity: this.options.opacity};\n              break;\n              case 's':\n              tp = {top: pos.top - actualHeight - this.options.offset, left: pos.left + pos.width / 2 - actualWidth / 2};\n              mo = {top: parseInt(pos.top - actualHeight - this.options.offset - MOVE_OFFSET), opacity: this.options.opacity};\n              break;\n              case 'e':\n              tp = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth - this.options.offset};\n              mo = {left: parseInt(pos.left - actualWidth - this.options.offset - MOVE_OFFSET), opacity: this.options.opacity};\n              break;\n              case 'w':\n              tp = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width + this.options.offset};\n              mo = {left: parseInt(pos.left + pos.width + this.options.offset + MOVE_OFFSET), opacity: this.options.opacity};\n              break;\n            }\n\n            if (gravity.length == 2) {\n              if (gravity.charAt(1) == 'w') {\n                tp.left = pos.left + pos.width / 2 - 15;\n              } else {\n                tp.left = pos.left + pos.width / 2 - actualWidth + 15;\n              }\n            }\n\n            $tip.css(tp).addClass('tipsy-' + gravity);\n            $tip.find('.tipsy-arrow')[0].className = 'tipsy-arrow tipsy-arrow-' + gravity.charAt(0);\n\n            if (this.options.fade) {\n              $tip.stop().css({opacity: 0, display: 'block', visibility: 'visible'}).animate(mo, 200);\n            } else {\n              $tip.css({visibility: 'visible', opacity: this.options.opacity});\n            }\n          }\n        },\n\n        hide: function() {\n\n          gravity = maybeCall(this.options.gravity, this.$element[0]);\n\n          switch (gravity.charAt(0)) {\n            case 'n':\n            mo = {top: parseInt(this.tip().css(\"top\")) + MOVE_OFFSET, opacity: 0};\n            break;\n            case 's':\n            mo = {top: parseInt(this.tip().css(\"top\")) - MOVE_OFFSET, opacity: 0};\n            break;\n            case 'e':\n            mo = {left: parseInt(this.tip().css(\"left\")) - MOVE_OFFSET, opacity: 0};\n            break;\n            case 'w':\n            mo = {left: parseInt(this.tip().css(\"left\")) + MOVE_OFFSET, opacity: 0};\n            break;\n          }\n\n          if (this.options.fade) {\n            this.tip().stop().animate(mo, 200, function(){$(this).remove();});\n          } else {\n            this.tip().remove();\n          }\n        },\n\n        fixTitle: function() {\n          var $e = this.$element;\n          if ($e.attr('title') || typeof($e.attr('original-title')) != 'string') {\n            $e.attr('original-title', $e.attr('title') || '').removeAttr('title');\n          }\n        },\n\n        getTitle: function() {\n          var title, $e = this.$element, o = this.options;\n          this.fixTitle();\n          var title, o = this.options;\n          if (typeof o.title == 'string') {\n            title = $e.attr(o.title == 'title' ? 'original-title' : o.title);\n          } else if (typeof o.title == 'function') {\n            title = o.title.call($e[0]);\n          }\n          title = ('' + title).replace(/(^\\s*|\\s*$)/, \"\");\n          return title || o.fallback;\n        },\n\n        tip: function() {\n          if (!this.$tip) {\n            this.$tip = $('<div class=\"tipsy\"></div>').html('<div class=\"tipsy-arrow\"></div><div class=\"tipsy-inner\"></div>');\n            this.$tip.data('tipsy-pointee', this.$element[0]);\n          }\n          return this.$tip;\n        },\n\n        validate: function() {\n          if (!this.$element[0].parentNode) {\n            this.hide();\n            this.$element = null;\n            this.options = null;\n          }\n        },\n\n        remove: function() { this.enabled = false; this.$tip && this.$tip.remove(); },\n        enable: function() { this.enabled = true; },\n        disable: function() { this.enabled = false; },\n        toggleEnabled: function() { this.enabled = !this.enabled; }\n      };\n\n      $.fn.tipsy = function(options) {\n\n        if (options === true) {\n          return this.data('tipsy');\n        } else if (typeof options == 'string') {\n          var tipsy = this.data('tipsy');\n          if (tipsy) tipsy[options]();\n          return this;\n        }\n\n        options = $.extend({}, $.fn.tipsy.defaults, options);\n\n        function get(ele) {\n          var tipsy = $.data(ele, 'tipsy');\n          if (!tipsy) {\n            tipsy = new Tipsy(ele, $.fn.tipsy.elementOptions(ele, options));\n            $.data(ele, 'tipsy', tipsy);\n          }\n          return tipsy;\n        }\n\n        function enter() {\n          var tipsy = get(this);\n          tipsy.hoverState = 'in';\n          if (options.delayIn == 0) {\n            tipsy.show();\n          } else {\n            tipsy.fixTitle();\n            setTimeout(function() { if (tipsy.hoverState == 'in') tipsy.show(); }, options.delayIn);\n          }\n        };\n\n        function leave() {\n          var tipsy = get(this);\n          tipsy.hoverState = 'out';\n          if (options.delayOut == 0) {\n            tipsy.hide();\n          } else {\n            setTimeout(function() { if (tipsy.hoverState == 'out') tipsy.hide(); }, options.delayOut);\n          }\n        };\n\n        if (!options.live) this.each(function() { get(this); });\n\n        if (options.trigger != 'manual') {\n          var binder   = options.live ? 'live' : 'bind',\n          eventIn  = options.trigger == 'hover' ? 'mouseenter' : 'focus',\n          eventOut = options.trigger == 'hover' ? 'mouseleave' : 'blur';\n          this[binder](eventIn, enter)[binder](eventOut, leave);\n        }\n\n        return this;\n\n      };\n\n      $.fn.tipsy.defaults = {\n        className: null,\n        delayIn: 0,\n        delayOut: 0,\n        fade: false,\n        fallback: '',\n        gravity: 'n',\n        html: false,\n        live: false,\n        offset: 0,\n        opacity: 0.8,\n        title: 'title',\n        trigger: 'hover'\n      };\n\n      $.fn.tipsy.revalidate = function() {\n        $('.tipsy').each(function() {\n          var pointee = $.data(this, 'tipsy-pointee');\n          if (!pointee || !isElementInDOM(pointee)) {\n            $(this).remove();\n          }\n        });\n      };\n\n    // Overwrite this method to provide options on a per-element basis.\n    // For example, you could store the gravity in a 'tipsy-gravity' attribute:\n    // return $.extend({}, options, {gravity: $(ele).attr('tipsy-gravity') || 'n' });\n    // (remember - do not modify 'options' in place!)\n    $.fn.tipsy.elementOptions = function(ele, options) {\n      return $.metadata ? $.extend({}, options, $(ele).metadata()) : options;\n    };\n\n    $.fn.tipsy.autoNS = function() {\n      return $(this).offset().top > ($(document).scrollTop() + $(window).height() / 2) ? 's' : 'n';\n    };\n\n    $.fn.tipsy.autoWE = function() {\n      return $(this).offset().left > ($(document).scrollLeft() + $(window).width() / 2) ? 'e' : 'w';\n    };\n\n    /**\n     * yields a closure of the supplied parameters, producing a function that takes\n     * no arguments and is suitable for use as an autogravity function like so:\n     *\n     * @param margin (int) - distance from the viewable region edge that an\n     *        element should be before setting its tooltip's gravity to be away\n     *        from that edge.\n     * @param prefer (string, e.g. 'n', 'sw', 'w') - the direction to prefer\n     *        if there are no viewable region edges effecting the tooltip's\n     *        gravity. It will try to vary from this minimally, for example,\n     *        if 'sw' is preferred and an element is near the right viewable\n     *        region edge, but not the top edge, it will set the gravity for\n     *        that element's tooltip to be 'se', preserving the southern\n     *        component.\n     */\n     $.fn.tipsy.autoBounds = function(margin, prefer) {\n      return function() {\n       var dir = {ns: prefer[0], ew: (prefer.length > 1 ? prefer[1] : false)},\n       boundTop = $(document).scrollTop() + margin,\n       boundLeft = $(document).scrollLeft() + margin,\n       $this = $(this);\n\n       if ($this.offset().top < boundTop) dir.ns = 'n';\n       if ($this.offset().left < boundLeft) dir.ew = 'w';\n       if ($(window).width() + $(document).scrollLeft() - $this.offset().left < margin) dir.ew = 'e';\n       if ($(window).height() + $(document).scrollTop() - $this.offset().top < margin) dir.ns = 's';\n\n       return dir.ns + (dir.ew ? dir.ew : '');\n     }\n   };\n\n })(jQuery);\n","/*\n\n------------------------------------------------------------------------------\nVersion touched for CartoDB2.0, fork here -> http://github.com/CartoDB/select2\nBranch: cartodb\n------------------------------------------------------------------------------\n\n\nDON'T REPLACE THIS LIBRARY FOR A NEW ONE UNTIL CHECK IT WORKS IN CARTODB\n\nCopyright 2012 Igor Vaynberg\n\nVersion: @@ver@@ Timestamp: @@timestamp@@\n\nThis software is licensed under the Apache License, Version 2.0 (the \"Apache License\") or the GNU\nGeneral Public License version 2 (the \"GPL License\"). You may choose either license to govern your\nuse of this software only upon the condition that you accept all of the terms of either the Apache\nLicense or the GPL License.\n\nYou may obtain a copy of the Apache License and the GPL License at:\n\n    http://www.apache.org/licenses/LICENSE-2.0\n    http://www.gnu.org/licenses/gpl-2.0.html\n\nUnless required by applicable law or agreed to in writing, software distributed under the\nApache License or the GPL Licesnse is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\nCONDITIONS OF ANY KIND, either express or implied. See the Apache License and the GPL License for\nthe specific language governing permissions and limitations under the Apache License and the GPL License.\n*/\n (function ($) {\n  if(typeof $.fn.each2 == \"undefined\"){\n    $.fn.extend({\n      /*\n      * 4-10 times faster .each replacement\n      * use it carefully, as it overrides jQuery context of element on each iteration\n      */\n      each2 : function (c) {\n        var j = $([0]), i = -1, l = this.length;\n        while (\n          ++i < l\n          && (j.context = j[0] = this[i])\n          && c.call(j[0], i, j) !== false //\"this\"=DOM, i=index, j=jQuery object\n        );\n        return this;\n      }\n    });\n  }\n})(jQuery);\n\n(function ($, undefined) {\n    \"use strict\";\n    /*global document, window, jQuery, console */\n\n    if (window.Select2 !== undefined) {\n        return;\n    }\n\n    var KEY, AbstractSelect2, SingleSelect2, MultiSelect2, nextUid, sizer,\n        lastMousePosition, $document;\n\n    KEY = {\n        TAB: 9,\n        ENTER: 13,\n        ESC: 27,\n        SPACE: 32,\n        LEFT: 37,\n        UP: 38,\n        RIGHT: 39,\n        DOWN: 40,\n        SHIFT: 16,\n        CTRL: 17,\n        ALT: 18,\n        PAGE_UP: 33,\n        PAGE_DOWN: 34,\n        HOME: 36,\n        END: 35,\n        BACKSPACE: 8,\n        DELETE: 46,\n        isArrow: function (k) {\n            k = k.which ? k.which : k;\n            switch (k) {\n            case KEY.LEFT:\n            case KEY.RIGHT:\n            case KEY.UP:\n            case KEY.DOWN:\n                return true;\n            }\n            return false;\n        },\n        isControl: function (e) {\n            var k = e.which;\n            switch (k) {\n            case KEY.SHIFT:\n            case KEY.CTRL:\n            case KEY.ALT:\n                return true;\n            }\n\n            if (e.metaKey) return true;\n\n            return false;\n        },\n        isFunctionKey: function (k) {\n            k = k.which ? k.which : k;\n            return k >= 112 && k <= 123;\n        }\n    };\n\n    $document = $(document);\n\n    nextUid=(function() { var counter=1; return function() { return counter++; }; }());\n\n    function indexOf(value, array) {\n        var i = 0, l = array.length, v;\n\n        if (typeof value === \"undefined\") {\n          return -1;\n        }\n\n        if (value.constructor === String) {\n            for (; i < l; i = i + 1) if (value.localeCompare(array[i]) === 0) return i;\n        } else {\n            for (; i < l; i = i + 1) {\n                v = array[i];\n                if (v.constructor === String) {\n                    if (v.localeCompare(value) === 0) return i;\n                } else {\n                    if (v === value) return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n    /**\n     * Compares equality of a and b taking into account that a and b may be strings, in which case localeCompare is used\n     * @param a\n     * @param b\n     */\n    function equal(a, b) {\n        if (a === b) return true;\n        if (a === undefined || b === undefined) return false;\n        if (a === null || b === null) return false;\n        if (a.constructor === String) return a.localeCompare(b) === 0;\n        if (b.constructor === String) return b.localeCompare(a) === 0;\n        return false;\n    }\n\n    /**\n     * Splits the string into an array of values, trimming each value. An empty array is returned for nulls or empty\n     * strings\n     * @param string\n     * @param separator\n     */\n    function splitVal(string, separator) {\n        var val, i, l;\n        if (string === null || string.length < 1) return [];\n        val = string.split(separator);\n        for (i = 0, l = val.length; i < l; i = i + 1) val[i] = $.trim(val[i]);\n        return val;\n    }\n\n    function getSideBorderPadding(element) {\n        return element.outerWidth(false) - element.width();\n    }\n\n    function installKeyUpChangeEvent(element) {\n        var key=\"keyup-change-value\";\n        element.bind(\"keydown\", function () {\n            if ($.data(element, key) === undefined) {\n                $.data(element, key, element.val());\n            }\n        });\n        element.bind(\"keyup\", function () {\n            var val= $.data(element, key);\n            if (val !== undefined && element.val() !== val) {\n                $.removeData(element, key);\n                element.trigger(\"keyup-change\");\n            }\n        });\n    }\n\n    $document.bind(\"mousemove\", function (e) {\n        lastMousePosition = {x: e.pageX, y: e.pageY};\n    });\n\n    /**\n     * filters mouse events so an event is fired only if the mouse moved.\n     *\n     * filters out mouse events that occur when mouse is stationary but\n     * the elements under the pointer are scrolled.\n     */\n    function installFilteredMouseMove(element) {\n      element.bind(\"mousemove\", function (e) {\n            var lastpos = lastMousePosition;\n            if (lastpos === undefined || lastpos.x !== e.pageX || lastpos.y !== e.pageY) {\n                $(e.target).trigger(\"mousemove-filtered\", e);\n            }\n        });\n    }\n\n    /**\n     * Debounces a function. Returns a function that calls the original fn function only if no invocations have been made\n     * within the last quietMillis milliseconds.\n     *\n     * @param quietMillis number of milliseconds to wait before invoking fn\n     * @param fn function to be debounced\n     * @param ctx object to be used as this reference within fn\n     * @return debounced version of fn\n     */\n    function debounce(quietMillis, fn, ctx) {\n        ctx = ctx || undefined;\n        var timeout;\n        return function () {\n            var args = arguments;\n            window.clearTimeout(timeout);\n            timeout = window.setTimeout(function() {\n                fn.apply(ctx, args);\n            }, quietMillis);\n        };\n    }\n\n    /**\n     * A simple implementation of a thunk\n     * @param formula function used to lazily initialize the thunk\n     * @return {Function}\n     */\n    function thunk(formula) {\n        var evaluated = false,\n            value;\n        return function() {\n            if (evaluated === false) { value = formula(); evaluated = true; }\n            return value;\n        };\n    };\n\n    function installDebouncedScroll(threshold, element) {\n        var notify = debounce(threshold, function (e) { element.trigger(\"scroll-debounced\", e);});\n        element.bind(\"scroll\", function (e) {\n            if (indexOf(e.target, element.get()) >= 0) notify(e);\n        });\n    }\n\n    function killEvent(event) {\n        event.preventDefault();\n        event.stopPropagation();\n    }\n    function killEventImmediately(event) {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n    }\n\n    function measureTextWidth(e) {\n        if (!sizer){\n          var style = e[0].currentStyle || window.getComputedStyle(e[0], null);\n          sizer = $(\"<div></div>\").css({\n              position: \"absolute\",\n              left: \"-10000px\",\n              top: \"-10000px\",\n              display: \"none\",\n              fontSize: style.fontSize,\n              fontFamily: style.fontFamily,\n              fontStyle: style.fontStyle,\n              fontWeight: style.fontWeight,\n              letterSpacing: style.letterSpacing,\n              textTransform: style.textTransform,\n              whiteSpace: \"nowrap\"\n          });\n          $(\"body\").append(sizer);\n        }\n        sizer.text(e.val());\n        return sizer.width();\n    }\n\n    function markMatch(text, term, markup) {\n        var match=text.toUpperCase().indexOf(term.toUpperCase()),\n            tl=term.length;\n\n        if (match<0) {\n            markup.push(text);\n            return;\n        }\n\n        markup.push(text.substring(0, match));\n        markup.push(\"<span class='select2-match'>\");\n        markup.push(text.substring(match, match + tl));\n        markup.push(\"</span>\");\n        markup.push(text.substring(match + tl, text.length));\n    }\n\n    /**\n     * Produces an ajax-based query function\n     *\n     * @param options object containing configuration paramters\n     * @param options.transport function that will be used to execute the ajax request. must be compatible with parameters supported by $.ajax\n     * @param options.url url for the data\n     * @param options.data a function(searchTerm, pageNumber, context) that should return an object containing query string parameters for the above url.\n     * @param options.dataType request data type: ajax, jsonp, other datatatypes supported by jQuery's $.ajax function or the transport function if specified\n     * @param options.traditional a boolean flag that should be true if you wish to use the traditional style of param serialization for the ajax request\n     * @param options.quietMillis (optional) milliseconds to wait before making the ajaxRequest, helps debounce the ajax function if invoked too often\n     * @param options.results a function(remoteData, pageNumber) that converts data returned form the remote request to the format expected by Select2.\n     *      The expected format is an object containing the following keys:\n     *      results array of objects that will be used as choices\n     *      more (optional) boolean indicating whether there are more results available\n     *      Example: {results:[{id:1, text:'Red'},{id:2, text:'Blue'}], more:true}\n     */\n    function ajax(options) {\n        var timeout, // current scheduled but not yet executed request\n            requestSequence = 0, // sequence used to drop out-of-order responses\n            handler = null,\n            quietMillis = options.quietMillis || 100;\n\n        return function (query) {\n            window.clearTimeout(timeout);\n            timeout = window.setTimeout(function () {\n                requestSequence += 1; // increment the sequence\n                var requestNumber = requestSequence, // this request's sequence number\n                    data = options.data, // ajax data function\n                    transport = options.transport || $.ajax,\n                    traditional = options.traditional || false,\n                    type = options.type || 'GET'; // set type of request (GET or POST)\n\n                data = data.call(this, query.term, query.page, query.context);\n\n                if( null !== handler) { handler.abort(); }\n\n                handler = transport.call(null, {\n                    url: options.url,\n                    dataType: options.dataType,\n                    data: data,\n                    type: type,\n                    traditional: traditional,\n                    success: function (data) {\n                        if (requestNumber < requestSequence) {\n                            return;\n                        }\n                        // TODO 3.0 - replace query.page with query so users have access to term, page, etc.\n                        var results = options.results(data, query.page);\n                        query.callback(results);\n                    }\n                });\n            }, quietMillis);\n        };\n    }\n\n    /**\n     * Produces a query function that works with a local array\n     *\n     * @param options object containing configuration parameters. The options parameter can either be an array or an\n     * object.\n     *\n     * If the array form is used it is assumed that it contains objects with 'id' and 'text' keys.\n     *\n     * If the object form is used ti is assumed that it contains 'data' and 'text' keys. The 'data' key should contain\n     * an array of objects that will be used as choices. These objects must contain at least an 'id' key. The 'text'\n     * key can either be a String in which case it is expected that each element in the 'data' array has a key with the\n     * value of 'text' which will be used to match choices. Alternatively, text can be a function(item) that can extract\n     * the text.\n     */\n    function local(options) {\n        var data = options, // data elements\n            dataText,\n            text = function (item) { return \"\"+item.text; }; // function used to retrieve the text portion of a data item that is matched against the search\n\n        if (!$.isArray(data)) {\n            text = data.text;\n            // if text is not a function we assume it to be a key name\n            if (!$.isFunction(text)) {\n              dataText = data.text; // we need to store this in a separate variable because in the next step data gets reset and data.text is no longer available\n              text = function (item) { return item[dataText]; };\n            }\n            data = data.results;\n        }\n\n        return function (query) {\n            var t = query.term, filtered = { results: [] }, process;\n            if (t === \"\") {\n                query.callback({results: data});\n                return;\n            }\n\n            process = function(datum, collection) {\n                var group, attr;\n                datum = datum[0];\n                if (datum.children) {\n                    group = {};\n                    for (attr in datum) {\n                        if (datum.hasOwnProperty(attr)) group[attr]=datum[attr];\n                    }\n                    group.children=[];\n                    $(datum.children).each2(function(i, childDatum) { process(childDatum, group.children); });\n                    if (group.children.length || query.matcher(t, text(group))) {\n                        collection.push(group);\n                    }\n                } else {\n                    if (query.matcher(t, text(datum))) {\n                        collection.push(datum);\n                    }\n                }\n            };\n\n            $(data).each2(function(i, datum) { process(datum, filtered.results); });\n            query.callback(filtered);\n        };\n    }\n\n    // TODO javadoc\n    function tags(data) {\n        // TODO even for a function we should probably return a wrapper that does the same object/string check as\n        // the function for arrays. otherwise only functions that return objects are supported.\n        if ($.isFunction(data)) {\n            return data;\n        }\n\n        // if not a function we assume it to be an array\n\n        return function (query) {\n            var t = query.term, filtered = {results: []};\n            $(data).each(function () {\n                var isObject = this.text !== undefined,\n                    text = isObject ? this.text : this;\n                if (t === \"\" || query.matcher(t, text)) {\n                    filtered.results.push(isObject ? this : {id: this, text: this});\n                }\n            });\n            query.callback(filtered);\n        };\n    }\n\n    /**\n     * Checks if the formatter function should be used.\n     *\n     * Throws an error if it is not a function. Returns true if it should be used,\n     * false if no formatting should be performed.\n     *\n     * @param formatter\n     */\n    function checkFormatter(formatter, formatterName) {\n        if ($.isFunction(formatter)) return true;\n        if (!formatter) return false;\n        throw new Error(\"formatterName must be a function or a falsy value\");\n    }\n\n    function evaluate(val) {\n        return $.isFunction(val) ? val() : val;\n    }\n\n    function countResults(results) {\n        var count = 0;\n        $.each(results, function(i, item) {\n            if (item.children) {\n                count += countResults(item.children);\n            } else {\n                count++;\n            }\n        });\n        return count;\n    }\n\n    /**\n     * Default tokenizer. This function uses breaks the input on substring match of any string from the\n     * opts.tokenSeparators array and uses opts.createSearchChoice to create the choice object. Both of those\n     * two options have to be defined in order for the tokenizer to work.\n     *\n     * @param input text user has typed so far or pasted into the search field\n     * @param selection currently selected choices\n     * @param selectCallback function(choice) callback tho add the choice to selection\n     * @param opts select2's opts\n     * @return undefined/null to leave the current input unchanged, or a string to change the input to the returned value\n     */\n    function defaultTokenizer(input, selection, selectCallback, opts) {\n        var original = input, // store the original so we can compare and know if we need to tell the search to update its text\n            dupe = false, // check for whether a token we extracted represents a duplicate selected choice\n            token, // token\n            index, // position at which the separator was found\n            i, l, // looping variables\n            separator; // the matched separator\n\n        if (!opts.createSearchChoice || !opts.tokenSeparators || opts.tokenSeparators.length < 1) return undefined;\n\n        while (true) {\n            index = -1;\n\n            for (i = 0, l = opts.tokenSeparators.length; i < l; i++) {\n                separator = opts.tokenSeparators[i];\n                index = input.indexOf(separator);\n                if (index >= 0) break;\n            }\n\n            if (index < 0) break; // did not find any token separator in the input string, bail\n\n            token = input.substring(0, index);\n            input = input.substring(index + separator.length);\n\n            if (token.length > 0) {\n                token = opts.createSearchChoice(token, selection);\n                if (token !== undefined && token !== null && opts.id(token) !== undefined && opts.id(token) !== null) {\n                    dupe = false;\n                    for (i = 0, l = selection.length; i < l; i++) {\n                        if (equal(opts.id(token), opts.id(selection[i]))) {\n                            dupe = true; break;\n                        }\n                    }\n\n                    if (!dupe) selectCallback(token);\n                }\n            }\n        }\n\n        if (original.localeCompare(input) != 0) return input;\n    }\n\n    /**\n     * blurs any Select2 container that has focus when an element outside them was clicked or received focus\n     *\n     * also takes care of clicks on label tags that point to the source element\n     */\n    $document.ready(function () {\n        $document.bind(\"mousedown touchend\", function (e) {\n            var target = $(e.target).closest(\"div.select2-container\").get(0), attr;\n            if (target) {\n                $document.find(\"div.select2-container-active\").each(function () {\n                    if (this !== target) $(this).data(\"select2\").blur();\n                });\n            } else {\n                target = $(e.target).closest(\"div.select2-drop\").get(0);\n                $document.find(\"div.select2-drop-active\").each(function () {\n                    if (this !== target) $(this).data(\"select2\").blur();\n                });\n            }\n\n            target=$(e.target);\n            attr = target.attr(\"for\");\n            if (\"LABEL\" === e.target.tagName && attr && attr.length > 0) {\n                attr = attr.replace(/([\\[\\].])/g,'\\\\$1'); /* escapes [, ], and . so properly selects the id */\n                target = $(\"#\"+attr);\n                target = target.data(\"select2\");\n                if (target !== undefined) { target.focus(); e.preventDefault();}\n            }\n        });\n    });\n\n    /**\n     * Creates a new class\n     *\n     * @param superClass\n     * @param methods\n     */\n    function clazz(SuperClass, methods) {\n        var constructor = function () {};\n        constructor.prototype = new SuperClass;\n        constructor.prototype.constructor = constructor;\n        constructor.prototype.parent = SuperClass.prototype;\n        constructor.prototype = $.extend(constructor.prototype, methods);\n        return constructor;\n    }\n\n    AbstractSelect2 = clazz(Object, {\n\n        // abstract\n        bind: function (func) {\n            var self = this;\n            return function () {\n                func.apply(self, arguments);\n            };\n        },\n\n        // abstract\n        init: function (opts) {\n            var results, search, free_text, resultsSelector = \".select2-results\";\n\n            // prepare options\n            this.opts = opts = this.prepareOpts(opts);\n\n            this.id=opts.id;\n\n            // destroy if called on an existing component\n            if (opts.element.data(\"select2\") !== undefined &&\n                opts.element.data(\"select2\") !== null) {\n                this.destroy();\n            }\n\n            this.enabled=true;\n            this.container = this.createContainer();\n\n            this.containerId=\"s2id_\"+(opts.element.attr(\"id\") || \"autogen\"+nextUid());\n            this.containerSelector=\"#\"+this.containerId.replace(/([;&,\\.\\+\\*\\~':\"\\!\\^#$%@\\[\\]\\(\\)=>\\|])/g, '\\\\$1');\n            this.container.attr(\"id\", this.containerId);\n\n            // cache the body so future lookups are cheap\n            this.body = thunk(function() { return opts.element.closest(\"body\"); });\n\n            if (opts.element.attr(\"class\") !== undefined) {\n                this.container.addClass(opts.element.attr(\"class\").replace(/validate\\[[\\S ]+] ?/, ''));\n            }\n\n            this.container.css(evaluate(opts.containerCss));\n            this.container.addClass(evaluate(opts.containerCssClass));\n\n            // swap container for the element\n            this.opts.element\n                .data(\"select2\", this)\n                .hide()\n                .before(this.container);\n            this.container.data(\"select2\", this);\n\n            this.dropdown = this.container.find(\".select2-drop\");\n            this.dropdown.addClass(evaluate(opts.dropdownCssClass));\n            this.dropdown.data(\"select2\", this);\n\n            this.results = results = this.container.find(resultsSelector);\n            this.search = search = this.container.find(\"input.select2-input\");\n            this.free_text = free_text = this.container.find(\"input.select2-input-free\");\n\n            search.attr(\"tabIndex\", this.opts.element.attr(\"tabIndex\"));\n\n            this.resultsPage = 0;\n            this.context = null;\n\n            // initialize the container\n            this.initContainer();\n            this.initContainerWidth();\n\n            installFilteredMouseMove(this.results);\n            this.dropdown.delegate(resultsSelector, \"mousemove-filtered\", this.bind(this.highlightUnderEvent));\n\n            installDebouncedScroll(80, this.results);\n            this.dropdown.delegate(resultsSelector, \"scroll-debounced\", this.bind(this.loadMoreIfNeeded));\n\n            // if jquery.mousewheel plugin is installed we can prevent out-of-bounds scrolling of results via mousewheel\n            if ($.fn.mousewheel) {\n                results.mousewheel(function (e, delta, deltaX, deltaY) {\n                    var top = results.scrollTop(), height;\n                    if (deltaY > 0 && top - deltaY <= 0) {\n                        results.scrollTop(0);\n                        killEvent(e);\n                    } else if (deltaY < 0 && results.get(0).scrollHeight - results.scrollTop() + deltaY <= results.height()) {\n                        results.scrollTop(results.get(0).scrollHeight - results.height());\n                        killEvent(e);\n                    }\n                });\n            }\n\n            installKeyUpChangeEvent(search);\n            search.bind(\"keyup-change\", this.bind(this.updateResults));\n            search.bind(\"focus\", function () { search.addClass(\"select2-focused\"); if (search.val() === \" \") search.val(\"\"); });\n            search.bind(\"blur\", function () { search.removeClass(\"select2-focused\");});\n\n            this.dropdown.delegate(resultsSelector, \"mouseup\", this.bind(function (e) {\n                if ($(e.target).closest(\".select2-result-selectable:not(.select2-disabled)\").length > 0) {\n                    this.highlightUnderEvent(e);\n                    this.selectHighlighted(e);\n                } else {\n                    this.focusSearch();\n                }\n                killEvent(e);\n            }));\n\n            // trap all mouse events from leaving the dropdown. sometimes there may be a modal that is listening\n            // for mouse events outside of itself so it can close itself. since the dropdown is now outside the select2's\n            // dom it will trigger the popup close, which is not what we want\n            this.dropdown.bind(\"click mouseup mousedown\", function (e) { e.stopPropagation(); });\n\n            if ($.isFunction(this.opts.initSelection)) {\n                // initialize selection based on the current value of the source element\n                this.initSelection();\n\n                // if the user has provided a function that can set selection based on the value of the source element\n                // we monitor the change event on the element and trigger it, allowing for two way synchronization\n                this.monitorSource();\n            }\n\n            if (opts.element.is(\":disabled\") || opts.element.is(\"[readonly='readonly']\")) this.disable();\n\n            // CartoDB 2.0 custom element ////////////////////////////////////////////////////////////////////////////////\n            if ($(this.container).hasClass(\"color_ramp\")) {\n              try {\n                var color = $(this.container).find(\".select2-choice\").text().replace(/ /g,\"\")\n                  , bucket = $(this.container).attr(\"class\").match(/(\\d)_buckets/)[1]\n                  , html = \"<ul>\"\n                  , colors = cdb.admin.color_ramps[color][bucket];\n\n                for (var j=0, c_l = colors.length; j<c_l; j++) {\n                  var color = colors[j];\n                  html += \"<li style='background:\" + color + \";'></li>\";\n                }\n\n                html += \"</ul>\";\n\n                $(this.container).find('.select2-choice').append(html);\n              } catch(e) {\n                cdb.log.info(\"Failing Select plugin when tries to generate a color ramp dropdown\");\n              }\n            }\n            /////////////////////////////////////////////////////////////////////////////////////////////////////////////\n        },\n\n        // abstract\n        destroy: function () {\n            var select2 = this.opts.element.data(\"select2\");\n            if (select2 !== undefined) {\n                select2.container.remove();\n                select2.dropdown.remove();\n                select2.opts.element\n                    .removeData(\"select2\")\n                    .unbind(\".select2\")\n                    .show();\n            }\n        },\n\n        // abstract\n        prepareOpts: function (opts) {\n            var element, select, idKey, ajaxUrl;\n\n            element = opts.element;\n\n            if (element.get(0).tagName.toLowerCase() === \"select\") {\n                this.select = select = opts.element;\n            }\n\n            if (select) {\n                // these options are not allowed when attached to a select because they are picked up off the element itself\n                $.each([\"id\", \"multiple\", \"ajax\", \"query\", \"createSearchChoice\", \"initSelection\", \"data\", \"tags\"], function () {\n                    if (this in opts) {\n                        throw new Error(\"Option '\" + this + \"' is not allowed for Select2 when attached to a <select> element.\");\n                    }\n                });\n            }\n\n            opts = $.extend({}, {\n                populateResults: function(container, results, query) {\n                    var populate,  data, result, children, id=this.opts.id, self=this;\n\n                    populate=function(results, container, depth) {\n\n                        var i, l, result, disabled, selectable, compound, node, label, innerContainer, formatted;\n                        for (i = 0, l = results.length; i < l; i = i + 1) {\n\n                            result=results[i];\n                            // CartoDB 2.0 custom element ////////////////////////////////////////////////////////////\n                            disabled = $(result.element).is(\":disabled\");\n                            selectable = (!disabled) && (id(result) !== undefined);\n                            //////////////////////////////////////////////////////////////////////////////////////////\n                            compound=result.children && result.children.length > 0;\n\n                            node=$(\"<li></li>\");\n                            node.addClass(\"select2-results-dept-\"+depth);\n                            node.addClass(\"select2-result\");\n                            node.addClass(selectable ? \"select2-result-selectable\" : \"select2-result-unselectable\");\n                            if (compound) { node.addClass(\"select2-result-with-children\"); }\n                            node.addClass(self.opts.formatResultCssClass(result));\n\n                            label=$(\"<div></div>\");\n                            //label.addClass(\"select2-result-label\");\n\n                            // CartoDB 2.0 custom element ////////////////////////////////////////////////////////////\n                            if (!selectable && $(result.element).data(\"message\")) {\n                              var msg = $(result.element).data(\"message\");\n                              node.tipsy({\n                                fade: true,\n                                gravity: 's',\n                                offset: -10,\n                                title: function() {\n                                  return msg\n                                }\n                              })\n                            }\n\n                            label.addClass(\"select2-result-label \" + ( color_ramp ? result.text : '' ));\n                            //////////////////////////////////////////////////////////////////////////////////////////\n\n                            formatted=opts.formatResult(result, label, query);\n                            if (formatted!==undefined) {\n                                label.html(self.opts.escapeMarkup(formatted));\n                            }\n\n                            node.append(label);\n\n                            if (compound) {\n\n                                innerContainer=$(\"<ul></ul>\");\n                                innerContainer.addClass(\"select2-result-sub\");\n                                populate(result.children, innerContainer, depth+1);\n                                node.append(innerContainer);\n                            }\n\n                            // CartoDB 2.0 custom element ////////////////////////////////////////////////////////////\n                            var color_ramp = $(container.prevObject).hasClass(\"color_ramp\");\n\n                            if (color_ramp) {\n\n                              try {\n                                label.html('');\n                                var color = result.text\n                                  , bucket = $(container.prevObject).attr(\"class\").match(/(\\d)_buckets/)[1]\n                                  , html = \"<table><tr>\"\n                                  , colors = cdb.admin.color_ramps[color][bucket];\n\n                                for (var j=0, c_l = colors.length; j<c_l; j++) {\n                                  var color = colors[j];\n                                  html += \"<td class='color' style='background:\" + color + \";'></td>\";\n                                }\n\n                                html += \"</tr></table>\";\n\n                                label.append(html);\n                              } catch(e) {\n                                cdb.log.info(\"Failing Select plugin when tries to generate a color ramp dropdown\");\n                              }\n                            }\n                            //////////////////////////////////////////////////////////////////////////////////////////\n\n                            node.data(\"select2-data\", result);\n                            container.append(node);\n                        }\n                    };\n\n                    populate(results, container, 0);\n                }\n            }, $.fn.select2.defaults, opts);\n\n            if (typeof(opts.id) !== \"function\") {\n                idKey = opts.id;\n                opts.id = function (e) { return e[idKey]; };\n            }\n\n            if (select) {\n                opts.query = this.bind(function (query) {\n                    var data = { results: [], more: false },\n                        term = query.term,\n                        children, firstChild, process;\n\n                    process=function(element, collection) {\n                        var group;\n                        if (element.is(\"option\")) {\n                            if (query.matcher(term, element.text(), element)) {\n                                collection.push({id:element.attr(\"value\"), text:element.text(), element: element.get(), css: element.attr(\"class\")});\n                            }\n                        } else if (element.is(\"optgroup\")) {\n                            group={text:element.attr(\"label\"), children:[], element: element.get(), css: element.attr(\"class\")};\n                            element.children().each2(function(i, elm) { process(elm, group.children); });\n                            if (group.children.length>0) {\n                                collection.push(group);\n                            }\n                        }\n                    };\n\n                    children=element.children();\n\n                    // ignore the placeholder option if there is one\n                    if (this.getPlaceholder() !== undefined && children.length > 0) {\n                        firstChild = children[0];\n                        if ($(firstChild).text() === \"\") {\n                            children=children.not(firstChild);\n                        }\n                    }\n\n                    children.each2(function(i, elm) { process(elm, data.results); });\n\n                    query.callback(data);\n                });\n                // this is needed because inside val() we construct choices from options and there id is hardcoded\n                opts.id=function(e) { return e.id; };\n                opts.formatResultCssClass = function(data) { return data.css; }\n            } else {\n                if (!(\"query\" in opts)) {\n                    if (\"ajax\" in opts) {\n                        ajaxUrl = opts.element.data(\"ajax-url\");\n                        if (ajaxUrl && ajaxUrl.length > 0) {\n                            opts.ajax.url = ajaxUrl;\n                        }\n                        opts.query = ajax(opts.ajax);\n                    } else if (\"data\" in opts) {\n                        opts.query = local(opts.data);\n                    } else if (\"tags\" in opts) {\n                        opts.query = tags(opts.tags);\n                        if (opts.createSearchChoice === undefined) {\n                            opts.createSearchChoice = function (term) { return {id: term, text: term}; };\n                        }\n                        opts.initSelection = function (element, callback) {\n                            var data = [];\n                            $(splitVal(element.val(), opts.separator)).each(function () {\n                                var id = this, text = this, tags=opts.tags;\n                                if ($.isFunction(tags)) tags=tags();\n                                $(tags).each(function() { if (equal(this.id, id)) { text = this.text; return false; } });\n                                data.push({id: id, text: text});\n                            });\n\n                            callback(data);\n                        };\n                    }\n                }\n            }\n            if (typeof(opts.query) !== \"function\") {\n                throw \"query function not defined for Select2 \" + opts.element.attr(\"id\");\n            }\n\n            return opts;\n        },\n\n        /**\n         * Monitor the original element for changes and update select2 accordingly\n         */\n        // abstract\n        monitorSource: function () {\n            this.opts.element.bind(\"change.select2\", this.bind(function (e) {\n                if (this.opts.element.data(\"select2-change-triggered\") !== true) {\n                    this.initSelection();\n                }\n            }));\n        },\n\n        /**\n         * Triggers the change event on the source element\n         */\n        // abstract\n        triggerChange: function (details) {\n\n            details = details || {};\n            details= $.extend({}, details, { type: \"change\", val: this.val() });\n            // prevents recursive triggering\n            this.opts.element.data(\"select2-change-triggered\", true);\n            this.opts.element.trigger(details);\n            this.opts.element.data(\"select2-change-triggered\", false);\n\n            // some validation frameworks ignore the change event and listen instead to keyup, click for selects\n            // so here we trigger the click event manually\n            this.opts.element.click();\n\n            // ValidationEngine ignorea the change event and listens instead to blur\n            // so here we trigger the blur event manually if so desired\n            if (this.opts.blurOnChange)\n                this.opts.element.blur();\n        },\n\n\n        // abstract\n        enable: function() {\n            if (this.enabled) return;\n\n            this.enabled=true;\n            this.container.removeClass(\"select2-container-disabled\");\n            this.opts.element.removeAttr(\"disabled\");\n        },\n\n        // abstract\n        disable: function() {\n            if (!this.enabled) return;\n\n            this.close();\n\n            this.enabled=false;\n            this.container.addClass(\"select2-container-disabled\");\n            this.opts.element.attr(\"disabled\", \"disabled\");\n        },\n\n        // abstract\n        opened: function () {\n            return this.container.hasClass(\"select2-dropdown-open\");\n        },\n\n        // abstract\n        positionDropdown: function() {\n            var offset = this.container.offset(),\n                height = this.container.outerHeight(false),\n                width = this.container.outerWidth(false),\n                dropHeight = this.dropdown.outerHeight(false),\n          viewPortRight = $(window).scrollLeft() + document.documentElement.clientWidth,\n                viewportBottom = $(window).scrollTop() + document.documentElement.clientHeight,\n                dropTop = offset.top + height,\n                dropLeft = offset.left,\n                enoughRoomBelow = dropTop + dropHeight <= viewportBottom,\n                enoughRoomAbove = (offset.top - dropHeight) >= this.body().scrollTop(),\n          dropWidth = this.dropdown.outerWidth(false),\n          enoughRoomOnRight = dropLeft + dropWidth <= viewPortRight,\n                aboveNow = this.dropdown.hasClass(\"select2-drop-above\"),\n                bodyOffset,\n                above,\n                css;\n\n            // console.log(\"below/ droptop:\", dropTop, \"dropHeight\", dropHeight, \"sum\", (dropTop+dropHeight)+\" viewport bottom\", viewportBottom, \"enough?\", enoughRoomBelow);\n            // console.log(\"above/ offset.top\", offset.top, \"dropHeight\", dropHeight, \"top\", (offset.top-dropHeight), \"scrollTop\", this.body().scrollTop(), \"enough?\", enoughRoomAbove);\n\n            // fix positioning when body has an offset and is not position: static\n\n            if (this.body().css('position') !== 'static') {\n                bodyOffset = this.body().offset();\n                dropTop -= bodyOffset.top;\n                dropLeft -= bodyOffset.left;\n            }\n\n            // always prefer the current above/below alignment, unless there is not enough room\n\n            if (aboveNow) {\n                above = true;\n                if (!enoughRoomAbove && enoughRoomBelow) above = false;\n            } else {\n                above = false;\n                if (!enoughRoomBelow && enoughRoomAbove) above = true;\n            }\n\n      if (!enoughRoomOnRight) {\n       dropLeft = offset.left + width - dropWidth;\n      }\n\n            if (above) {\n                dropTop = offset.top - dropHeight;\n                this.container.addClass(\"select2-drop-above\");\n                this.dropdown.addClass(\"select2-drop-above\");\n            }\n            else {\n                this.container.removeClass(\"select2-drop-above\");\n                this.dropdown.removeClass(\"select2-drop-above\");\n            }\n\n            css = $.extend({\n                top: dropTop,\n                left: dropLeft,\n                width: width\n            }, evaluate(this.opts.dropdownCss));\n\n            this.dropdown.css(css);\n        },\n\n        // abstract\n        shouldOpen: function() {\n            var event;\n\n            if (this.opened()) return false;\n\n            event = $.Event(\"open\");\n            this.opts.element.trigger(event);\n            return !event.isDefaultPrevented();\n        },\n\n        // abstract\n        clearDropdownAlignmentPreference: function() {\n            // clear the classes used to figure out the preference of where the dropdown should be opened\n            this.container.removeClass(\"select2-drop-above\");\n            this.dropdown.removeClass(\"select2-drop-above\");\n        },\n\n        /**\n         * Opens the dropdown\n         *\n         * @return {Boolean} whether or not dropdown was opened. This method will return false if, for example,\n         * the dropdown is already open, or if the 'open' event listener on the element called preventDefault().\n         */\n        // abstract\n        open: function () {\n\n            if (!this.shouldOpen()) return false;\n\n            window.setTimeout(this.bind(this.opening), 1);\n\n            return true;\n        },\n\n        /**\n         * Performs the opening of the dropdown\n         */\n        // abstract\n        opening: function() {\n            var cid = this.containerId, selector = this.containerSelector,\n                scroll = \"scroll.\" + cid, resize = \"resize.\" + cid;\n\n            this.container.parents().each(function() {\n                $(this).bind(scroll, function() {\n                    var s2 = $(selector);\n                    if (s2.length == 0) {\n                        $(this).unbind(scroll);\n                    }\n                    s2.select2(\"close\");\n                });\n            });\n\n            window.setTimeout(function() {\n                // this is done inside a timeout because IE will sometimes fire a resize event while opening\n                // the dropdown and that causes this handler to immediately close it. this way the dropdown\n                // has a chance to fully open before we start listening to resize events\n                $(window).bind(resize, function() {\n                    var s2 = $(selector);\n                    if (s2.length == 0) {\n                        $(window).unbind(resize);\n                    }\n                    s2.select2(\"close\");\n                });\n\n                $(window).bind(scroll, function() {\n                    var s2 = $(selector);\n                    if (s2.length == 0) {\n                        $(window).unbind(scroll);\n                    }\n                    s2.select2(\"close\");\n                });\n            }, 10);\n\n            this.clearDropdownAlignmentPreference();\n\n            if (this.search.val() === \" \") { this.search.val(\"\"); }\n\n            this.container.addClass(\"select2-dropdown-open\").addClass(\"select2-container-active\");\n\n            this.updateResults(true);\n\n            if(this.dropdown[0] !== this.body().children().last()[0]) {\n                this.dropdown.detach().appendTo(this.body());\n            }\n\n            this.dropdown.show();\n\n            this.positionDropdown();\n            this.dropdown.addClass(\"select2-drop-active\");\n\n            this.ensureHighlightVisible();\n\n            this.focusSearch();\n        },\n\n        // abstract\n        close: function () {\n            if (!this.opened()) return;\n\n            var self = this;\n\n            this.container.parents().each(function() {\n                $(this).unbind(\"scroll.\" + self.containerId);\n            });\n            $(window).unbind(\"resize.\" + this.containerId);\n            $(window).unbind(\"scroll.\" + this.containerId);\n\n            this.clearDropdownAlignmentPreference();\n\n            this.dropdown.hide();\n            this.container.removeClass(\"select2-dropdown-open\").removeClass(\"select2-container-active\");\n            this.results.empty();\n            this.clearSearch();\n\n            this.opts.element.trigger($.Event(\"close\"));\n        },\n\n        // abstract\n        clearSearch: function () {\n\n        },\n\n        // abstract\n        ensureHighlightVisible: function () {\n            var results = this.results, children, index, child, hb, rb, y, more;\n\n            index = this.highlight();\n\n            if (index < 0) return;\n\n            if (index == 0) {\n\n                // if the first element is highlighted scroll all the way to the top,\n                // that way any unselectable headers above it will also be scrolled\n                // into view\n\n                results.scrollTop(0);\n                return;\n            }\n\n            children = results.find(\".select2-result-selectable\");\n\n            child = $(children[index]);\n\n            hb = child.offset().top + child.outerHeight(true);\n\n            // if this is the last child lets also make sure select2-more-results is visible\n            if (index === children.length - 1) {\n                more = results.find(\"li.select2-more-results\");\n                if (more.length > 0) {\n                    hb = more.offset().top + more.outerHeight(true);\n                }\n            }\n\n            rb = results.offset().top + results.outerHeight(true);\n            if (hb > rb) {\n                results.scrollTop(results.scrollTop() + (hb - rb));\n            }\n            y = child.offset().top - results.offset().top;\n\n            // make sure the top of the element is visible\n            if (y < 0 && child.css('display') != 'none' ) {\n                results.scrollTop(results.scrollTop() + y); // y is negative\n            }\n        },\n\n        // abstract\n        moveHighlight: function (delta) {\n            var choices = this.results.find(\".select2-result-selectable\"),\n                index = this.highlight();\n\n            while (index > -1 && index < choices.length) {\n                index += delta;\n                var choice = $(choices[index]);\n                if (choice.hasClass(\"select2-result-selectable\") && !choice.hasClass(\"select2-disabled\")) {\n                    this.highlight(index);\n                    break;\n                }\n            }\n        },\n\n        // abstract\n        highlight: function (index) {\n            var choices = this.results.find(\".select2-result-selectable\").not(\".select2-disabled\");\n\n            if (arguments.length === 0) {\n                return indexOf(choices.filter(\".select2-highlighted\")[0], choices.get());\n            }\n\n            if (index >= choices.length) index = choices.length - 1;\n            if (index < 0) index = 0;\n\n            choices.removeClass(\"select2-highlighted\");\n\n            $(choices[index]).addClass(\"select2-highlighted\");\n            this.ensureHighlightVisible();\n\n        },\n\n        // abstract\n        countSelectableResults: function() {\n            return this.results.find(\".select2-result-selectable\").not(\".select2-disabled\").length;\n        },\n\n        // abstract\n        highlightUnderEvent: function (event) {\n            var el = $(event.target).closest(\".select2-result-selectable\");\n            if (el.length > 0 && !el.is(\".select2-highlighted\")) {\n            var choices = this.results.find('.select2-result-selectable');\n                this.highlight(choices.index(el));\n            } else if (el.length == 0) {\n                // if we are over an unselectable item remove al highlights\n                this.results.find(\".select2-highlighted\").removeClass(\"select2-highlighted\");\n            }\n        },\n\n        // abstract\n        loadMoreIfNeeded: function () {\n            var results = this.results,\n                more = results.find(\"li.select2-more-results\"),\n                below, // pixels the element is below the scroll fold, below==0 is when the element is starting to be visible\n                offset = -1, // index of first element without data\n                page = this.resultsPage + 1,\n                self=this,\n                term=this.search.val(),\n                context=this.context;\n\n            if (more.length === 0) return;\n            below = more.offset().top - results.offset().top - results.height();\n\n            if (below <= 0) {\n                more.addClass(\"select2-active\");\n                this.opts.query({\n                        term: term,\n                        page: page,\n                        context: context,\n                        matcher: this.opts.matcher,\n                        callback: this.bind(function (data) {\n\n                    // ignore a response if the select2 has been closed before it was received\n                    if (!self.opened()) return;\n\n\n                    self.opts.populateResults.call(this, results, data.results, {term: term, page: page, context:context});\n\n                    if (data.more===true) {\n                        more.detach().appendTo(results).text(self.opts.formatLoadMore(page+1));\n                        window.setTimeout(function() { self.loadMoreIfNeeded(); }, 10);\n                    } else {\n                        more.remove();\n                    }\n                    self.positionDropdown();\n                    self.resultsPage = page;\n                })});\n            }\n        },\n\n        /**\n         * Default tokenizer function which does nothing\n         */\n        tokenize: function() {\n\n        },\n\n        /**\n         * @param initial whether or not this is the call to this method right after the dropdown has been opened\n         */\n        // abstract\n        updateResults: function (initial) {\n            var search = this.search, results = this.results, opts = this.opts, data, self=this, input;\n\n            // if the search is currently hidden we do not alter the results\n            if (initial !== true && (this.showSearchInput === false || !this.opened())) {\n                return;\n            }\n\n            search.addClass(\"select2-active\");\n\n            ///// CartoDB 2.0 ///////////////////////////////////\n            function removeTipsys() {\n              results.find('.select2-result').each(function(i,el){\n                var $el = $(el);\n                var tipsy = $el.data('tipsy');\n                if (tipsy) {\n                  $el\n                    .tipsy('hide')\n                    .unbind('mouseleave mouseenter');\n                }\n              })\n            }\n            ///// CartoDB 2.0 ///////////////////////////////////\n\n            function postRender() {\n                results.scrollTop(0);\n                search.removeClass(\"select2-active\");\n                self.positionDropdown();\n            }\n\n            function render(html) {\n                results.html(self.opts.escapeMarkup(html));\n                postRender();\n            }\n\n            ///// CartoDB 2.0 ///////////////////////////////////\n            removeTipsys();\n            ///// CartoDB 2.0 ///////////////////////////////////\n\n            if (opts.maximumSelectionSize >=1) {\n                data = this.data();\n                if ($.isArray(data) && data.length >= opts.maximumSelectionSize && checkFormatter(opts.formatSelectionTooBig, \"formatSelectionTooBig\")) {\n                  render(\"<li class='select2-selection-limit'>\" + opts.formatSelectionTooBig(opts.maximumSelectionSize) + \"</li>\");\n                  return;\n                }\n            }\n\n            if (search.val().length < opts.minimumInputLength) {\n                if (checkFormatter(opts.formatInputTooShort, \"formatInputTooShort\")) {\n                    render(\"<li class='select2-no-results'>\" + opts.formatInputTooShort(search.val(), opts.minimumInputLength) + \"</li>\");\n                } else {\n                    render(\"\");\n                }\n                return;\n            }\n            else if (opts.formatSearching()) {\n                render(\"<li class='select2-searching'>\" + opts.formatSearching() + \"</li>\");\n            }\n\n            // give the tokenizer a chance to pre-process the input\n            input = this.tokenize();\n            if (input != undefined && input != null) {\n                search.val(input);\n            }\n\n            this.resultsPage = 1;\n            opts.query({\n                    term: search.val(),\n                    page: this.resultsPage,\n                    context: null,\n                    matcher: opts.matcher,\n                    callback: this.bind(function (data) {\n                var def; // default choice\n\n                // ignore a response if the select2 has been closed before it was received\n                if (!this.opened()) return;\n\n                // save context, if any\n                this.context = (data.context===undefined) ? null : data.context;\n\n                // create a default choice and prepend it to the list\n                if (this.opts.createSearchChoice && search.val() !== \"\") {\n                    def = this.opts.createSearchChoice.call(null, search.val(), data.results);\n                    if (def !== undefined && def !== null && self.id(def) !== undefined && self.id(def) !== null) {\n                        if ($(data.results).filter(\n                            function () {\n                                return equal(self.id(this), self.id(def));\n                            }).length === 0) {\n                            data.results.unshift(def);\n                        }\n                    }\n                }\n\n                if (data.results.length === 0 && checkFormatter(opts.formatNoMatches, \"formatNoMatches\")) {\n                    render(\"<li class='select2-no-results'>\" + opts.formatNoMatches(search.val()) + \"</li>\");\n                    return;\n                }\n\n                results.empty();\n                self.opts.populateResults.call(this, results, data.results, {term: search.val(), page: this.resultsPage, context:null});\n\n                if (data.more === true && checkFormatter(opts.formatLoadMore, \"formatLoadMore\")) {\n                    results.append(\"<li class='select2-more-results'>\" + self.opts.escapeMarkup(opts.formatLoadMore(this.resultsPage)) + \"</li>\");\n                    window.setTimeout(function() { self.loadMoreIfNeeded(); }, 10);\n                }\n\n                this.postprocessResults(data, initial);\n\n                postRender();\n            })});\n        },\n\n        // abstract\n        cancel: function () {\n            this.close();\n        },\n\n        // abstract\n        blur: function () {\n            this.close();\n            this.container.removeClass(\"select2-container-active\");\n            this.dropdown.removeClass(\"select2-drop-active\");\n            // synonymous to .is(':focus'), which is available in jquery >= 1.6\n            if (this.search[0] === document.activeElement) { this.search.blur(); }\n            this.clearSearch();\n            this.selection.find(\".select2-search-choice-focus\").removeClass(\"select2-search-choice-focus\");\n            this.opts.element.triggerHandler(\"blur\");\n        },\n\n        // abstract\n        focusSearch: function () {\n            if (this.showSearchInput) {\n                // need to do it here as well as in timeout so it works in IE\n                this.search.show();\n                this.search.focus();\n  \n                /* we do this in a timeout so that current event processing can complete before this code is executed.\n                 this makes sure the search field is focussed even if the current event would blur it */\n                window.setTimeout(this.bind(function () {\n                    // reset the value so IE places the cursor at the end of the input box\n                    this.search.show();\n                    this.search.focus();\n                    this.search.val(this.search.val());\n                }), 10);\n            }\n        },\n\n        // abstract\n        selectHighlighted: function () {\n            var index=this.highlight(),\n                highlighted=this.results.find(\".select2-highlighted\").not(\".select2-disabled\"),\n                data = highlighted.closest('.select2-result-selectable').data(\"select2-data\");\n            if (data) {\n                highlighted.addClass(\"select2-disabled\");\n                this.highlight(index);\n                this.onSelect(data);\n            }\n        },\n\n        // abstract\n        getPlaceholder: function () {\n            return this.opts.element.attr(\"placeholder\") ||\n                this.opts.element.attr(\"data-placeholder\") || // jquery 1.4 compat\n                this.opts.element.data(\"placeholder\") ||\n                this.opts.placeholder;\n        },\n\n        /**\n         * Get the desired width for the container element.  This is\n         * derived first from option `width` passed to select2, then\n         * the inline 'style' on the original element, and finally\n         * falls back to the jQuery calculated element width.\n         */\n        // abstract\n        initContainerWidth: function () {\n            function resolveContainerWidth() {\n                var style, attrs, matches, i, l;\n\n                if (this.opts.width === \"off\") {\n                    return null;\n                } else if (this.opts.width === \"element\"){\n                    return this.opts.element.outerWidth(false) === 0 ? 'auto' : this.opts.element.outerWidth(false) + 'px';\n                } else if (this.opts.width === \"copy\" || this.opts.width === \"resolve\") {\n                    // check if there is inline style on the element that contains width\n                    style = this.opts.element.attr('style');\n                    if (style !== undefined) {\n                        attrs = style.split(';');\n                        for (i = 0, l = attrs.length; i < l; i = i + 1) {\n                            matches = attrs[i].replace(/\\s/g, '')\n                                .match(/width:(([-+]?([0-9]*\\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);\n                            if (matches !== null && matches.length >= 1)\n                                return matches[1];\n                        }\n                    }\n\n                    if (this.opts.width === \"resolve\") {\n                        // next check if css('width') can resolve a width that is percent based, this is sometimes possible\n                        // when attached to input type=hidden or elements hidden via css\n                        style = this.opts.element.css('width');\n                        if (style.indexOf(\"%\") > 0) return style;\n\n                        // finally, fallback on the calculated width of the element\n                        return (this.opts.element.outerWidth(false) === 0 ? 'auto' : this.opts.element.outerWidth(false) + 'px');\n                    }\n\n                    return null;\n                } else if ($.isFunction(this.opts.width)) {\n                    return this.opts.width();\n                } else {\n                    return this.opts.width;\n               }\n            };\n\n            var width = resolveContainerWidth.call(this);\n            if (width !== null) {\n                this.container.attr(\"style\", \"width: \"+width);\n            }\n        }\n    });\n\n    SingleSelect2 = clazz(AbstractSelect2, {\n\n        // single\n\n    createContainer: function () {\n            var container = $(\"<div></div>\", {\n                \"class\": \"select2-container\"\n            }).html([\n                \"    <a href='javascript:void(0)' onclick='return false;' class='select2-choice'>\",\n                \"   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>\",\n                \"   <div><b></b></div>\" ,\n                \"</a>\",\n                \"    <div class='select2-drop select2-offscreen'>\" ,\n                \"   <div class='select2-search'>\" ,\n                \"       <input type='text' autocomplete='off' class='select2-input'/>\" ,\n                \"   </div>\" ,\n                \"   <ul class='select2-results'>\" ,\n                \"   </ul>\" ,\n                \"   <div class='select2-text'>\" ,\n                \"       <input type='text' placeholder='Free text input' class='select2-input-free'/>\" ,\n                \"       <i class='select2-icon select2-text-icon'></i>\" ,\n                \"   </div>\" ,\n                \"</div>\"].join(\"\"));\n            return container;\n        },\n\n        // single\n        opening: function () {\n            this.search.show();\n            this.parent.opening.apply(this, arguments);\n            this.dropdown.removeClass(\"select2-offscreen\");\n        },\n\n        // single\n        close: function () {\n            if (!this.opened()) return;\n            this.parent.close.apply(this, arguments);\n            this.dropdown.removeAttr(\"style\").addClass(\"select2-offscreen\").insertAfter(this.selection).show();\n        },\n\n        // single\n        focus: function () {\n            this.close();\n            this.selection.focus();\n        },\n\n        // single\n        isFocused: function () {\n            return this.selection[0] === document.activeElement;\n        },\n\n        // single\n        cancel: function () {\n            this.parent.cancel.apply(this, arguments);\n            this.selection.focus();\n        },\n\n        // single\n        initContainer: function () {\n\n            var selection,\n                container = this.container,\n                dropdown = this.dropdown,\n                clickingInside = false;\n\n            this.selection = selection = container.find(\".select2-choice\");\n\n            this.search.bind(\"keydown\", this.bind(function (e) {\n                if (!this.enabled) return;\n\n                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {\n                    // prevent the page from scrolling\n                    killEvent(e);\n                    return;\n                }\n\n                if (this.opened()) {\n                    switch (e.which) {\n                        case KEY.UP:\n                        case KEY.DOWN:\n                            this.moveHighlight((e.which === KEY.UP) ? -1 : 1);\n                            killEvent(e);\n                            return;\n                        case KEY.TAB:\n                        case KEY.ENTER:\n                            this.selectHighlighted();\n                            killEvent(e);\n                            return;\n                        case KEY.ESC:\n                            this.cancel(e);\n                            killEvent(e);\n                            return;\n                    }\n                } else {\n\n                    if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e) || e.which === KEY.ESC) {\n                        return;\n                    }\n\n                    if (this.opts.openOnEnter === false && e.which === KEY.ENTER) {\n                        return;\n                    }\n\n                    this.open();\n\n                    if (e.which === KEY.ENTER) {\n                        // do not propagate the event otherwise we open, and propagate enter which closes\n                        return;\n                    }\n                }\n            }));\n\n            this.search.bind(\"focus\", this.bind(function() {\n                this.selection.attr(\"tabIndex\", \"-1\");\n            }));\n            this.search.bind(\"blur\", this.bind(function() {\n                if (!this.opened()) this.container.removeClass(\"select2-container-active\");\n                window.setTimeout(this.bind(function() {\n                    // restore original tab index\n                    var ti=this.opts.element.attr(\"tabIndex\");\n                    if (ti) {\n                        this.selection.attr(\"tabIndex\", ti);\n                    } else {\n                        this.selection.removeAttr(\"tabIndex\");\n                    }\n                }), 10);\n            }));\n\n            this.free_text.bind(\"keydown\", this.bind(function (e) {\n                var value = $(e.target).val();\n\n                if (!this.enabled) return;\n\n                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {\n                    // prevent the page from scrolling\n                    killEvent(e);\n                    return;\n                }\n\n                if (this.opened()) {\n                    switch (e.which) {\n                        case KEY.UP:\n                        case KEY.DOWN:\n                            killEvent(e);\n                            return;\n                        case KEY.TAB:\n                            return;\n                        case KEY.ENTER:\n                            this.onSelect({ id: value, text: value });\n                            killEvent(e);\n                            return;\n                        case KEY.ESC:\n                            this.cancel(e);\n                            killEvent(e);\n                            return;\n                    }\n                }\n            }));\n\n            selection.delegate(\"abbr\", \"mousedown\", this.bind(function (e) {\n                if (!this.enabled) return;\n                this.clear();\n                killEventImmediately(e);\n                this.close();\n                this.triggerChange();\n                this.selection.focus();\n            }));\n\n            selection.bind(\"mousedown\", this.bind(function (e) {\n                clickingInside = true;\n\n                if (this.opened()) {\n                    this.close();\n                    this.selection.focus();\n                } else if (this.enabled) {\n                    this.open();\n                }\n\n                clickingInside = false;\n            }));\n\n            dropdown.bind(\"mousedown\", this.bind(function() { /*this.search.focus();*/ }));\n\n            selection.bind(\"focus\", this.bind(function() {\n                this.container.addClass(\"select2-container-active\");\n                // hide the search so the tab key does not focus on it\n                this.search.attr(\"tabIndex\", \"-1\");\n            }));\n\n            selection.bind(\"blur\", this.bind(function() {\n                if (!this.opened()) {\n                    this.container.removeClass(\"select2-container-active\");\n                }\n                window.setTimeout(this.bind(function() { this.search.attr(\"tabIndex\", this.opts.element.attr(\"tabIndex\")); }), 10);\n            }));\n\n            selection.bind(\"keydown\", this.bind(function(e) {\n                if (!this.enabled) return;\n\n                if (e.which == KEY.DOWN || e.which == KEY.UP\n                    || (e.which == KEY.ENTER && this.opts.openOnEnter)) {\n                    this.open();\n                    killEvent(e);\n                    return;\n                }\n\n                if (e.which == KEY.DELETE || e.which == KEY.BACKSPACE) {\n                    if (this.opts.allowClear) {\n                        this.clear();\n                    }\n                    killEvent(e);\n                    return;\n                }\n            }));\n            selection.bind(\"keypress\", this.bind(function(e) {\n                var key = String.fromCharCode(e.which);\n                this.search.val(key);\n                this.open();\n            }));\n\n            this.setPlaceholder();\n\n            this.search.bind(\"focus\", this.bind(function() {\n                this.container.addClass(\"select2-container-active\");\n            }));\n        },\n\n        // single\n        clear: function() {\n            this.opts.element.val(\"\");\n            this.selection.find(\"span\").empty();\n            this.selection.removeData(\"select2-data\");\n            this.setPlaceholder();\n        },\n\n        /**\n         * Sets selection based on source element's value\n         */\n        // single\n        initSelection: function () {\n            var selected;\n            if (this.opts.element.val() === \"\" && this.opts.element.text() === \"\") {\n                this.close();\n                this.setPlaceholder();\n            } else {\n                var self = this;\n                this.opts.initSelection.call(null, this.opts.element, function(selected){\n                    if (selected !== undefined && selected !== null) {\n                        self.updateSelection(selected);\n                        self.close();\n                        self.setPlaceholder();\n                    }\n                });\n            }\n        },\n\n        // single\n        prepareOpts: function () {\n            var opts = this.parent.prepareOpts.apply(this, arguments);\n\n            if (opts.element.get(0).tagName.toLowerCase() === \"select\") {\n                // install the selection initializer\n                opts.initSelection = function (element, callback) {\n                    var selected = element.find(\":selected\");\n                    // a single select box always has a value, no need to null check 'selected'\n                    if ($.isFunction(callback))\n                        callback({id: selected.attr(\"value\"), text: selected.text(), element:selected});\n                };\n            }\n\n            return opts;\n        },\n\n        // single\n        setPlaceholder: function () {\n            var placeholder = this.getPlaceholder();\n            var data = this.selection.data(\"select2-data\");\n\n            if (this.opts.element.val() === \"\" && placeholder !== undefined && ( data && !data.id && !data.text )) {\n\n                // check for a first blank option if attached to a select\n                if (this.select && this.select.find(\"option:first\").text() !== \"\") return;\n\n                this.selection.find(\"span\").html(this.opts.escapeMarkup(placeholder));\n\n                this.selection.addClass(\"select2-default\");\n\n                this.selection.find(\"abbr\").hide();\n            }\n        },\n\n        // single\n        postprocessResults: function (data, initial) {\n            var selected = 0, self = this, showSearchInput = true, showFreeTextInput = false;\n\n            // find the selected element in the result list\n\n            this.results.find(\".select2-result-selectable\").each2(function (i, elm) {\n                if (equal(self.id(elm.data(\"select2-data\")), self.opts.element.val())) {\n                    selected = i;\n                    return false;\n                }\n            });\n\n            // and highlight it\n\n            this.highlight(selected);\n\n            // hide the search box if this is the first we got the results and there are a few of them\n\n            if (initial === true) {\n                showSearchInput = this.showSearchInput = countResults(data.results) >= this.opts.minimumResultsForSearch;\n                this.dropdown.find(\".select2-search\")[showSearchInput ? \"removeClass\" : \"addClass\"](\"select2-search-hidden\");\n\n                showFreeTextInput = this.showFreeTextInput = this.opts.freeText;\n                this.dropdown.find(\".select2-text\")[showFreeTextInput ? \"removeClass\" : \"addClass\"](\"select2-search-hidden\");\n\n                //add \"select2-with-searchbox\" to the container if search box is shown\n                $(this.dropdown, this.container)[showSearchInput ? \"addClass\" : \"removeClass\"](\"select2-with-searchbox\");\n            }\n\n        },\n\n        // single\n        onSelect: function (data) {\n            var old = this.opts.element.val();\n\n            this.opts.element.val(this.id(data));\n            this.updateSelection(data);\n            this.close();\n            this.selection.focus();\n\n            if (!equal(old, this.id(data))) { this.triggerChange(); }\n        },\n\n        // single\n        updateSelection: function (data) {\n\n            var container=this.selection.find(\"span\"), formatted;\n\n            this.selection.data(\"select2-data\", data);\n\n            container.empty();\n            formatted=this.opts.formatSelection(data, container);\n            if (formatted !== undefined) {\n                container.append(this.opts.escapeMarkup(formatted));\n            }\n\n            this.selection.removeClass(\"select2-default\");\n\n            if (this.opts.allowClear && this.getPlaceholder() !== undefined) {\n                this.selection.find(\"abbr\").show();\n            }\n        },\n\n        // single\n        val: function () {\n            var val, data = null, self = this;\n\n            if (arguments.length === 0) {\n                return this.opts.element.val();\n            }\n\n            val = arguments[0];\n\n            if (this.select) {\n                this.select\n                    .val(val)\n                    .find(\":selected\").each2(function (i, elm) {\n                        data = {id: elm.attr(\"value\"), text: elm.text()};\n                        return false;\n                    });\n\n                if (!data.id && !data.text) {\n                  data = {id: val, text: val };\n                }\n\n                this.updateSelection(data);\n                this.setPlaceholder();\n            } else {\n                if (this.opts.initSelection === undefined) {\n                    throw new Error(\"cannot call val() if initSelection() is not defined\");\n                }\n                // val is an id. !val is true for [undefined,null,'']\n                if (!val) {\n                    this.clear();\n                    return;\n                }\n                this.opts.element.val(val);\n                this.opts.initSelection(this.opts.element, function(data){\n                    self.opts.element.val(!data ? \"\" : self.id(data));\n                    self.updateSelection(data);\n                    self.setPlaceholder();\n                });\n            }\n        },\n\n        // single\n        clearSearch: function () {\n            this.search.val(\"\");\n        },\n\n        // single\n        data: function(value) {\n            var data;\n\n            if (arguments.length === 0) {\n                data = this.selection.data(\"select2-data\");\n                if (data == undefined) data = null;\n                return data;\n            } else {\n                if (!value || value === \"\") {\n                    this.clear();\n                } else {\n                    this.opts.element.val(!value ? \"\" : this.id(value));\n                    this.updateSelection(value);\n                }\n            }\n        }\n    });\n\n    MultiSelect2 = clazz(AbstractSelect2, {\n\n        // multi\n        createContainer: function () {\n            var container = $(\"<div></div>\", {\n                \"class\": \"select2-container select2-container-multi\"\n            }).html([\n                \"    <ul class='select2-choices'>\",\n                //\"<li class='select2-search-choice'><span>California</span><a href=\"javascript:void(0)\" class=\"select2-search-choice-close\"></a></li>\" ,\n                \"  <li class='select2-search-field'>\" ,\n                \"    <input type='text' autocomplete='off' class='select2-input'>\" ,\n                \"  </li>\" ,\n                \"</ul>\" ,\n                \"<div class='select2-drop select2-drop-multi' style='display:none;'>\" ,\n                \"   <ul class='select2-results'>\" ,\n                \"   </ul>\" ,\n                \"</div>\"].join(\"\"));\n      return container;\n        },\n\n        // multi\n        prepareOpts: function () {\n            var opts = this.parent.prepareOpts.apply(this, arguments);\n\n            // TODO validate placeholder is a string if specified\n\n            if (opts.element.get(0).tagName.toLowerCase() === \"select\") {\n                // install sthe selection initializer\n                opts.initSelection = function (element,callback) {\n\n                    var data = [];\n                    element.find(\":selected\").each2(function (i, elm) {\n                        data.push({id: elm.attr(\"value\"), text: elm.text(), element: elm});\n                    });\n\n                    if ($.isFunction(callback))\n                        callback(data);\n                };\n            }\n\n            return opts;\n        },\n\n        // multi\n        initContainer: function () {\n\n            var selector = \".select2-choices\", selection;\n\n            this.searchContainer = this.container.find(\".select2-search-field\");\n            this.selection = selection = this.container.find(selector);\n\n            this.search.bind(\"keydown\", this.bind(function (e) {\n                if (!this.enabled) return;\n\n                if (e.which === KEY.BACKSPACE && this.search.val() === \"\") {\n                    this.close();\n\n                    var choices,\n                        selected = selection.find(\".select2-search-choice-focus\");\n                    if (selected.length > 0) {\n                        this.unselect(selected.first());\n                        this.search.width(10);\n                        killEvent(e);\n                        return;\n                    }\n\n                    choices = selection.find(\".select2-search-choice:not(.select2-locked)\");\n                    if (choices.length > 0) {\n                        choices.last().addClass(\"select2-search-choice-focus\");\n                    }\n                } else {\n                    selection.find(\".select2-search-choice-focus\").removeClass(\"select2-search-choice-focus\");\n                }\n\n                if (this.opened()) {\n                    switch (e.which) {\n                    case KEY.UP:\n                    case KEY.DOWN:\n                        this.moveHighlight((e.which === KEY.UP) ? -1 : 1);\n                        killEvent(e);\n                        return;\n                    case KEY.ENTER:\n                    case KEY.TAB:\n                        this.selectHighlighted();\n                        killEvent(e);\n                        return;\n                    case KEY.ESC:\n                        this.cancel(e);\n                        killEvent(e);\n                        return;\n                    }\n                }\n\n                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e)\n                 || e.which === KEY.BACKSPACE || e.which === KEY.ESC) {\n                    return;\n                }\n\n                if (this.opts.openOnEnter === false && e.which === KEY.ENTER) {\n                    return;\n                }\n\n                this.open();\n\n                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {\n                    // prevent the page from scrolling\n                    killEvent(e);\n                }\n            }));\n\n            this.search.bind(\"keyup\", this.bind(this.resizeSearch));\n\n            this.search.bind(\"blur\", this.bind(function(e) {\n                this.container.removeClass(\"select2-container-active\");\n                this.search.removeClass(\"select2-focused\");\n                this.clearSearch();\n                e.stopImmediatePropagation();\n            }));\n\n            this.container.delegate(selector, \"mousedown\", this.bind(function (e) {\n                if (!this.enabled) return;\n                if ($(e.target).closest(\".select2-search-choice\").length > 0) {\n                    // clicked inside a select2 search choice, do not open\n                    return;\n                }\n                this.clearPlaceholder();\n                this.open();\n                this.focusSearch();\n                e.preventDefault();\n            }));\n\n            this.container.delegate(selector, \"focus\", this.bind(function () {\n                if (!this.enabled) return;\n                this.container.addClass(\"select2-container-active\");\n                this.dropdown.addClass(\"select2-drop-active\");\n                this.clearPlaceholder();\n            }));\n\n            // set the placeholder if necessary\n            this.clearSearch();\n        },\n\n        // multi\n        enable: function() {\n            if (this.enabled) return;\n\n            this.parent.enable.apply(this, arguments);\n\n            this.search.removeAttr(\"disabled\");\n        },\n\n        // multi\n        disable: function() {\n            if (!this.enabled) return;\n\n            this.parent.disable.apply(this, arguments);\n\n            this.search.attr(\"disabled\", true);\n        },\n\n        // multi\n        initSelection: function () {\n            var data;\n            if (this.opts.element.val() === \"\" && this.opts.element.text() === \"\") {\n                this.updateSelection([]);\n                this.close();\n                // set the placeholder if necessary\n                this.clearSearch();\n            }\n            if (this.select || this.opts.element.val() !== \"\") {\n                var self = this;\n                this.opts.initSelection.call(null, this.opts.element, function(data){\n                    if (data !== undefined && data !== null) {\n                        self.updateSelection(data);\n                        self.close();\n                        // set the placeholder if necessary\n                        self.clearSearch();\n                    }\n                });\n            }\n        },\n\n        // multi\n        clearSearch: function () {\n            var placeholder = this.getPlaceholder();\n\n            if (placeholder !== undefined  && this.getVal().length === 0 && this.search.hasClass(\"select2-focused\") === false) {\n                this.search.val(placeholder).addClass(\"select2-default\");\n                // stretch the search box to full width of the container so as much of the placeholder is visible as possible\n                this.resizeSearch();\n            } else {\n                // we set this to \" \" instead of \"\" and later clear it on focus() because there is a firefox bug\n                // that does not properly render the caret when the field starts out blank\n                this.search.val(\" \").width(10);\n            }\n        },\n\n        // multi\n        clearPlaceholder: function () {\n            if (this.search.hasClass(\"select2-default\")) {\n                this.search.val(\"\").removeClass(\"select2-default\");\n            } else {\n                // work around for the space character we set to avoid firefox caret bug\n                if (this.search.val() === \" \") this.search.val(\"\");\n            }\n        },\n\n        // multi\n        opening: function () {\n            this.parent.opening.apply(this, arguments);\n\n            this.clearPlaceholder();\n      this.resizeSearch();\n            this.focusSearch();\n        },\n\n        // multi\n        close: function () {\n            if (!this.opened()) return;\n            this.parent.close.apply(this, arguments);\n        },\n\n        // multi\n        focus: function () {\n            this.close();\n            this.search.focus();\n        },\n\n        // multi\n        isFocused: function () {\n            return this.search.hasClass(\"select2-focused\");\n        },\n\n        // multi\n        updateSelection: function (data) {\n            var ids = [], filtered = [], self = this;\n\n            // filter out duplicates\n            $(data).each(function () {\n                if (indexOf(self.id(this), ids) < 0) {\n                    ids.push(self.id(this));\n                    filtered.push(this);\n                }\n            });\n            data = filtered;\n\n            this.selection.find(\".select2-search-choice\").remove();\n            $(data).each(function () {\n                self.addSelectedChoice(this);\n            });\n            self.postprocessResults();\n        },\n\n        tokenize: function() {\n            var input = this.search.val();\n            input = this.opts.tokenizer(input, this.data(), this.bind(this.onSelect), this.opts);\n            if (input != null && input != undefined) {\n                this.search.val(input);\n                if (input.length > 0) {\n                    this.open();\n                }\n            }\n\n        },\n\n        // multi\n        onSelect: function (data) {\n            this.addSelectedChoice(data);\n            if (this.select || !this.opts.closeOnSelect) this.postprocessResults();\n\n            if (this.opts.closeOnSelect) {\n                this.close();\n                this.search.width(10);\n            } else {\n                if (this.countSelectableResults()>0) {\n                    this.search.width(10);\n                    this.resizeSearch();\n                    this.positionDropdown();\n                } else {\n                    // if nothing left to select close\n                    this.close();\n                }\n            }\n\n            // since its not possible to select an element that has already been\n            // added we do not need to check if this is a new element before firing change\n            this.triggerChange({ added: data });\n\n            this.focusSearch();\n        },\n\n        // multi\n        cancel: function () {\n            this.close();\n            this.focusSearch();\n        },\n\n        addSelectedChoice: function (data) {\n            var enableChoice = !data.locked,\n                enabledItem = $(\n                    \"<li class='select2-search-choice'>\" +\n                    \"    <div></div>\" +\n                    \"    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a>\" +\n                    \"</li>\"),\n                disabledItem = $(\n                    \"<li class='select2-search-choice select2-locked'>\" +\n                    \"<div></div>\" +\n                    \"</li>\");\n            var choice = enableChoice ? enabledItem : disabledItem,\n                id = this.id(data),\n                val = this.getVal(),\n                formatted;\n\n            formatted=this.opts.formatSelection(data, choice.find(\"div\"));\n            if (formatted != undefined) {\n                choice.find(\"div\").replaceWith(\"<div>\"+this.opts.escapeMarkup(formatted)+\"</div>\");\n            }\n\n            if(enableChoice){\n              choice.find(\".select2-search-choice-close\")\n                  .bind(\"mousedown\", killEvent)\n                  .bind(\"click dblclick\", this.bind(function (e) {\n                  if (!this.enabled) return;\n\n                  $(e.target).closest(\".select2-search-choice\").fadeOut('fast', this.bind(function(){\n                      this.unselect($(e.target));\n                      this.selection.find(\".select2-search-choice-focus\").removeClass(\"select2-search-choice-focus\");\n                      this.close();\n                      this.focusSearch();\n                  })).dequeue();\n                  killEvent(e);\n              })).bind(\"focus\", this.bind(function () {\n                  if (!this.enabled) return;\n                  this.container.addClass(\"select2-container-active\");\n                  this.dropdown.addClass(\"select2-drop-active\");\n              }));\n            }\n\n            choice.data(\"select2-data\", data);\n            choice.insertBefore(this.searchContainer);\n\n            val.push(id);\n            this.setVal(val);\n        },\n\n        // multi\n        unselect: function (selected) {\n            var val = this.getVal(),\n                data,\n                index;\n\n            selected = selected.closest(\".select2-search-choice\");\n\n            if (selected.length === 0) {\n                throw \"Invalid argument: \" + selected + \". Must be .select2-search-choice\";\n            }\n\n            data = selected.data(\"select2-data\");\n\n            index = indexOf(this.id(data), val);\n\n            if (index >= 0) {\n                val.splice(index, 1);\n                this.setVal(val);\n                if (this.select) this.postprocessResults();\n            }\n            selected.remove();\n            this.triggerChange({ removed: data });\n        },\n\n        // multi\n        postprocessResults: function () {\n            var val = this.getVal(),\n                choices = this.results.find(\".select2-result-selectable\"),\n                compound = this.results.find(\".select2-result-with-children\"),\n                self = this;\n\n            choices.each2(function (i, choice) {\n                var id = self.id(choice.data(\"select2-data\"));\n                if (indexOf(id, val) >= 0) {\n                    choice.addClass(\"select2-disabled\").removeClass(\"select2-result-selectable\");\n                } else {\n                    choice.removeClass(\"select2-disabled\").addClass(\"select2-result-selectable\");\n                }\n            });\n\n            compound.each2(function(i, e) {\n                if (!e.is('.select2-result-selectable') && e.find(\".select2-result-selectable\").length==0) {  // FIX FOR HIRECHAL DATA\n                    e.addClass(\"select2-disabled\");\n                } else {\n                    e.removeClass(\"select2-disabled\");\n                }\n            });\n\n            if (this.highlight() == -1){\n                choices.each2(function (i, choice) {\n                    if (!choice.hasClass(\"select2-disabled\") && choice.hasClass(\"select2-result-selectable\")) {\n                        self.highlight(0);\n                        return false;\n                    }\n                });\n            }\n\n        },\n\n        // multi\n        resizeSearch: function () {\n\n            var minimumWidth, left, maxWidth, containerLeft, searchWidth,\n              sideBorderPadding = getSideBorderPadding(this.search);\n\n            minimumWidth = measureTextWidth(this.search) + 10;\n\n            left = this.search.offset().left;\n\n            maxWidth = this.selection.width();\n            containerLeft = this.selection.offset().left;\n\n            searchWidth = maxWidth - (left - containerLeft) - sideBorderPadding;\n            if (searchWidth < minimumWidth) {\n                searchWidth = maxWidth - sideBorderPadding;\n            }\n\n            if (searchWidth < 40) {\n                searchWidth = maxWidth - sideBorderPadding;\n            }\n            this.search.width(searchWidth);\n        },\n\n        // multi\n        getVal: function () {\n            var val;\n            if (this.select) {\n                val = this.select.val();\n                return val === null ? [] : val;\n            } else {\n                val = this.opts.element.val();\n                return splitVal(val, this.opts.separator);\n            }\n        },\n\n        // multi\n        setVal: function (val) {\n            var unique;\n            if (this.select) {\n                this.select.val(val);\n            } else {\n                unique = [];\n                // filter out duplicates\n                $(val).each(function () {\n                    if (indexOf(this, unique) < 0) unique.push(this);\n                });\n                this.opts.element.val(unique.length === 0 ? \"\" : unique.join(this.opts.separator));\n            }\n        },\n\n        // multi\n        val: function () {\n            var val, data = [], self=this;\n\n            if (arguments.length === 0) {\n                return this.getVal();\n            }\n\n            val = arguments[0];\n\n            if (!val) {\n                this.opts.element.val(\"\");\n                this.updateSelection([]);\n                this.clearSearch();\n                return;\n            }\n\n            // val is a list of ids\n            this.setVal(val);\n\n            if (this.select) {\n                this.select.find(\":selected\").each(function () {\n                    data.push({id: $(this).attr(\"value\"), text: $(this).text()});\n                });\n                this.updateSelection(data);\n            } else {\n                if (this.opts.initSelection === undefined) {\n                    throw new Error(\"val() cannot be called if initSelection() is not defined\")\n                }\n\n                this.opts.initSelection(this.opts.element, function(data){\n                    var ids=$(data).map(self.id);\n                    self.setVal(ids);\n                    self.updateSelection(data);\n                    self.clearSearch();\n                });\n            }\n            this.clearSearch();\n        },\n\n        // multi\n        onSortStart: function() {\n            if (this.select) {\n                throw new Error(\"Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.\");\n            }\n\n            // collapse search field into 0 width so its container can be collapsed as well\n            this.search.width(0);\n            // hide the container\n            this.searchContainer.hide();\n        },\n\n        // multi\n        onSortEnd:function() {\n\n            var val=[], self=this;\n\n            // show search and move it to the end of the list\n            this.searchContainer.show();\n            // make sure the search container is the last item in the list\n            this.searchContainer.appendTo(this.searchContainer.parent());\n            // since we collapsed the width in dragStarted, we resize it here\n            this.resizeSearch();\n\n            // update selection\n\n            this.selection.find(\".select2-search-choice\").each(function() {\n                val.push(self.opts.id($(this).data(\"select2-data\")));\n            });\n            this.setVal(val);\n            this.triggerChange();\n        },\n\n        // multi\n        data: function(values) {\n            var self=this, ids;\n            if (arguments.length === 0) {\n                 return this.selection\n                     .find(\".select2-search-choice\")\n                     .map(function() { return $(this).data(\"select2-data\"); })\n                     .get();\n            } else {\n                if (!values) { values = []; }\n                ids = $.map(values, function(e) { return self.opts.id(e)});\n                this.setVal(ids);\n                this.updateSelection(values);\n                this.clearSearch();\n            }\n        }\n    });\n\n    $.fn.select2 = function () {\n\n        var args = Array.prototype.slice.call(arguments, 0),\n            opts,\n            select2,\n            value, multiple, allowedMethods = [\"val\", \"destroy\", \"opened\", \"open\", \"close\", \"focus\", \"isFocused\", \"container\", \"onSortStart\", \"onSortEnd\", \"enable\", \"disable\", \"positionDropdown\", \"data\"];\n\n        this.each(function () {\n            if (args.length === 0 || typeof(args[0]) === \"object\") {\n                opts = args.length === 0 ? {} : $.extend({}, args[0]);\n                opts.element = $(this);\n\n                if (opts.element.get(0).tagName.toLowerCase() === \"select\") {\n                    multiple = opts.element.attr(\"multiple\");\n                } else {\n                    multiple = opts.multiple || false;\n                    if (\"tags\" in opts) {opts.multiple = multiple = true;}\n                }\n\n                select2 = multiple ? new MultiSelect2() : new SingleSelect2();\n                select2.init(opts);\n            } else if (typeof(args[0]) === \"string\") {\n\n                if (indexOf(args[0], allowedMethods) < 0) {\n                    throw \"Unknown method: \" + args[0];\n                }\n\n                value = undefined;\n                select2 = $(this).data(\"select2\");\n                if (select2 === undefined) return;\n                if (args[0] === \"container\") {\n                    value=select2.container;\n                } else {\n                    value = select2[args[0]].apply(select2, args.slice(1));\n                }\n                if (value !== undefined) {return false;}\n            } else {\n                throw \"Invalid arguments to select2 plugin: \" + args;\n            }\n        });\n        return (value === undefined) ? this : value;\n    };\n\n    // plugin defaults, accessible to users\n    $.fn.select2.defaults = {\n        width: \"copy\",\n        closeOnSelect: true,\n        openOnEnter: true,\n        containerCss: {},\n        dropdownCss: {},\n        containerCssClass: \"\",\n        dropdownCssClass: \"\",\n        formatResult: function(result, container, query) {\n            var markup=[];\n            markMatch(result.text, query.term, markup);\n            return markup.join(\"\");\n        },\n        formatSelection: function (data, container) {\n            return data ? data.text : undefined;\n        },\n        formatResultCssClass: function(data) {return undefined;},\n        formatNoMatches: function () { return \"No matches found\"; },\n        formatInputTooShort: function (input, min) { var n = min - input.length; return \"Please enter \" + n + \" more character\" + (n == 1? \"\" : \"s\"); },\n        formatSelectionTooBig: function (limit) { return \"You can only select \" + limit + \" item\" + (limit == 1 ? \"\" : \"s\"); },\n        formatLoadMore: function (pageNumber) { return \"Loading more results...\"; },\n        formatSearching: function () { return \"Searching...\"; },\n        minimumResultsForSearch: 0,\n        minimumInputLength: 0,\n        maximumSelectionSize: 0,\n        id: function (e) { return e.id; },\n        matcher: function(term, text) {\n            return text.toUpperCase().indexOf(term.toUpperCase()) >= 0;\n        },\n        separator: \",\",\n        tokenSeparators: [],\n        tokenizer: defaultTokenizer,\n        escapeMarkup: function (markup) {\n            if (markup && typeof(markup) === \"string\") {\n                return markup.replace(/&/g, \"&amp;\");\n            }\n            return markup;\n        },\n        blurOnChange: false\n    };\n\n    // exports\n    window.Select2 = {\n        query: {\n            ajax: ajax,\n            local: local,\n            tags: tags\n        }, util: {\n            debounce: debounce,\n            markMatch: markMatch\n        }, \"class\": {\n            \"abstract\": AbstractSelect2,\n            \"single\": SingleSelect2,\n            \"multi\": MultiSelect2\n        }\n    };\n\n}(jQuery));\n","/**\n * models for cartodb admin\n */\n\n(function() {\n\n  cdb.admin.SQL = function() {\n      var username = (this.options && this.options.user_data)? this.options.user_data.username :\n        (window.user_data? window.user_data.username : window.user_name);\n      var api_key = (this.options && this.options.user_data)? this.options.user_data.api_key :\n        (window.user_data? window.user_data.api_key : window.api_key);\n\n\n      return new cartodb.SQL({\n        user: username,\n        api_key: api_key,\n        sql_api_template: cdb.config.getSqlApiBaseUrl()\n      });\n  }\n\n  cdb.admin.Column = cdb.core.Model.extend({\n\n    idAttribute: 'name',\n\n    url: function(method) {\n      var version = cdb.config.urlVersion('column', method);\n      var table = this.table || this.collection.table;\n      if(!table) {\n        cdb.log.error(\"column has no table assigned\");\n      }\n\n      var base = '/api/' + version + '/tables/' + table.get('name') + '/columns/';\n      if (this.isNew()) {\n        return base;\n      }\n      return base + this.id;\n    },\n\n\n    initialize: function() {\n      this.table = this.get('table');\n      if(!this.table) {\n        throw \"you should specify a table model\";\n      }\n      this.unset('table', { silent: true });\n    },\n\n    toJSON: function() {\n      var c = _.clone(this.attributes);\n      // this hack is created to create new column\n      // if you set _name instead name backbone does not get\n      // it as idAttribute so launch a POST instead of a PUT\n      if(c._name) {\n        c.name = c._name;\n        delete c._name;\n      }\n      return c;\n    },\n\n  });\n\n\n  /**\n   * contains information about the table, not the data itself\n   */\n  cdb.admin.CartoDBTableMetadata = cdb.ui.common.TableProperties.extend({\n\n    currentLoading: 0, // class variable (shared). I'm still not sure if this is messy as hell or powerfull as a transformer\n    sqlApiClass: cartodb.SQL,\n\n    _TEXTS: {\n      columnDeleted: 'Your column has been deleted',\n      columnDeleting: 'Deleting your column',\n      columnAdded: 'Your column has been added',\n      columnAdding: 'Adding new column'\n    },\n\n    hiddenColumns: [\n      'the_geom',\n      'the_geom_webmercator',\n      'cartodb_georef_status',\n      'created_at',\n      'updated_at',\n      'cartodb_id'\n    ],\n\n    initialize: function() {\n      _.bindAll(this, 'notice');\n      this.readOnly = false;\n      this.bind('change:schema', this._prepareSchema, this);\n      this._prepareSchema();\n      this.sqlView = null;\n      this.synchronization = new cdb.admin.TableSynchronization();\n      this.synchronization.linkToTable(this);\n      this.synchronization.bind('change:id', function isSyncChanged() {\n        this.trigger('change:isSync', this, this.synchronization.isSync());\n      }, this);\n      if (this.get('no_data_fetch')) {\n        this.no_data_fetch = true;\n        delete this.attributes.no_data_fetch;\n      }\n      this.data();\n      this.bind('error', function(e, resp) {\n        this.error('', resp);\n      }, this);\n      this._data.bind('error', function(e, resp) {\n        this.notice('error loading rows, check your SQL query', 'error', 5000);\n      }, this);\n\n      this._data.bind('reset', function() {\n        var view = this._data;\n        this.set({\n          schema: view.schemaFromData(this.get('schema')),\n          geometry_types: view.getGeometryTypes()\n        });\n      }, this);\n\n      this.retrigger('change', this._data, 'data:changed');\n      this.retrigger('saved', this._data, 'data:saved');\n\n      this.bind('change:table_visualization', function() {\n        this.permission = new cdb.admin.Permission(this.get('table_visualization').permission);\n        this.trigger('change:permission', this, this.permission);\n      }, this);\n\n      // create permission if permission is set\n      this.permission = new cdb.admin.Permission(this.get('permission'));\n    },\n\n    url: function(method) {\n      var version = cdb.config.urlVersion('table', method);\n      var base = '/api/' + version + '/tables';\n      if (this.isNew()) {\n        return base;\n      }\n      return base + '/' + this.id;\n    },\n\n    // use the name as the id since the api works\n    // in the same way to table name and id\n    parse: function(resp, xhr) {\n      if(resp.name) {\n        resp.id = resp.name;\n      }\n      // move geometry_types to stats one\n      // geometry_types from backend are not reliable anymore and it can only be used\n      // for non editing stuff (showing icons, general checks on table list)\n      resp.stats_geometry_types = resp.geometry_types;\n      delete resp.geometry_types;\n      delete resp.schema;\n      return resp;\n    },\n\n    notice: function(msg, type, timeout) {\n      this.trigger('notice', msg, type, timeout);\n    },\n\n    setReadOnly: function(_) {\n      var trigger = false;\n      if (this.readOnly !== _) {\n        trigger = true;\n      }\n      this.readOnly = _;\n      if (trigger) {\n        this.trigger('change:readOnly', this, _);\n      }\n    },\n\n    isReadOnly: function() {\n      return this.readOnly || this.data().isReadOnly() || this.synchronization.isSync();\n    },\n\n    isSync: function() {\n      return this.synchronization.isSync();\n    },\n\n    getUnqualifiedName: function() {\n      var name = this.get('name');\n      if (!name) return null;\n      var tk = name.split('.');\n      if (tk.length == 2) {\n        return tk[1];\n      }\n      return name;\n    },\n\n    // \"user\".table -> user.table\n    getUnquotedName: function() {\n      var name = this.get('name');\n      return name && name.replace(/\"/g, '');\n    },\n\n    sortSchema: function() {\n      this.set('schema', cdb.admin.CartoDBTableMetadata.sortSchema(this.get('schema')));\n    },\n\n    error: function(msg, resp) {\n      var err =  resp && resp.responseText && JSON.parse(resp.responseText).errors[0];\n      this.trigger('notice', msg + \": \" + err, 'error');\n    },\n\n    _prepareSchema: function() {\n      var self = this;\n      this._columnType = {};\n\n      _(this.get('schema')).each(function(s) {\n        self._columnType[s[0]] = s[1];\n      });\n\n      if (!this.isInSQLView()) {\n        self.set('original_schema', self.get('schema'));\n      }\n    },\n\n    columnNames: function(sc) {\n      sc = sc || 'schema'\n      return _(this.get(sc)).pluck(0);\n    },\n\n    containsColumn: function(name) {\n      return _.contains(this.columnNames(), name);\n    },\n\n    columnNamesByType: function(type, sc) {\n      sc = sc || 'schema';\n      var t = _(this.get(sc)).filter(function(c) {\n        return c[1] == type;\n      });\n      return _(t).pluck(0);\n    },\n\n    // return geometry columns calculated backend stats\n    // use geomColumnTypes if you need something reliable (but slower and async)\n    statsGeomColumnTypes: function(geometryTypes) {\n      return this.geomColumnTypes(this.get('stats_geometry_types'))\n    },\n\n    // return the current column types in an array\n    // the values inside the array can be:\n    //  'point', 'line', 'polygon'\n    geomColumnTypes: function(geometryTypes) {\n      var types = geometryTypes || this.get('geometry_types');\n      var geomTypes = [];\n      if (!_.isArray(types)) {\n        return [];\n      }\n      var _map = {\n        'st_multipolygon': 'polygon',\n        'st_polygon': 'polygon',\n        'st_multilinestring': 'line',\n        'st_linestring': 'line',\n        'st_multipoint': 'point',\n        'st_point': 'point'\n      };\n      for(var t in types) {\n        var type = types[t];\n        // when there are rows with no geo type null is returned as geotype\n        if(type) {\n          var a = _map[type.toLowerCase()]\n          if(a) {\n            geomTypes.push(a)\n          }\n        }\n      }\n      return _.uniq(geomTypes);\n    },\n\n    /**\n     *  Adding a new geometry type to the table\n     *  @param geom type {st_polygon, st_point,...}\n     *  @param set options\n     */\n    addGeomColumnType: function(t, opts) {\n      if(!t) return;\n      var types = _.clone(this.get('geometry_types')) || [];\n      if(!_.contains(types, t)) {\n        types.push(t);\n\n        this.set({\n          'geometry_types': types\n        }, opts);\n      }\n    },\n\n    nonReservedColumnNames: function() {\n\n      var self = this;\n      return _.filter(this.columnNames(), function(c) {\n        return !self.isReservedColumn(c);\n      });\n    },\n\n    columnTypes: function() {\n      return _.clone(this._columnType);\n    },\n\n    _getColumn: function(columnName) {\n      if(this._columnType[columnName] === undefined) {\n        return\n        // throw \"the column does not exists\";\n      }\n      var c = new cdb.admin.Column({\n        table: this,\n        name: columnName,\n        type: this._columnType[columnName]\n      });\n      return c;\n    },\n\n    getColumnType: function(columnName, sc) {\n      sc = sc || 'schema';\n      var t = _(this.get(sc)).filter(function(c) {\n        return c[0] == columnName;\n      });\n      if(t.length > 0)\n        return t[0][1];\n      return;\n    },\n\n    addColumn: function(columnName, columnType, opts) {\n      var self = this;\n      var c = new cdb.admin.Column({\n        table: this,\n        _name: columnName,\n        type: columnType || 'string'\n      });\n      this.notice(self._TEXTS.columnAdding, 'load', 0);\n      c.save(null, {\n          success: function(mdl, obj) {\n            self.notice(self._TEXTS.columnAdded, 'info');\n            self.trigger('columnAdd', columnName);\n            self.data().fetch();\n            opts && opts.success && opts.success(mdl,obj);\n          },\n          error: function(e, resp) {\n            self.error('error adding column', resp);\n            opts && opts.error && opts.error(e);\n          },\n          wait: true\n      });\n    },\n\n    deleteColumn: function(columnName, opts) {\n      var self = this;\n      var c = this._getColumn(columnName);\n      if (c !== undefined) {\n        this.notice(self._TEXTS.columnDeleting, 'load', 0);\n        c.destroy({\n            success: function() {\n              self.trigger('columnDelete', columnName);\n              self.notice(self._TEXTS.columnDeleted, 'info');\n              self.data().fetch();\n              opts && opts.success && opts.success();\n            },\n            error: function(e, resp) {\n              self.error('error deleting column', resp);\n              opts && opts.error && opts.error();\n            },\n            wait: true\n        });\n      }\n    },\n\n    renameColumn: function(columnName, newName, opts) {\n      if(columnName == newName) return;\n      var self = this;\n      var c = this._getColumn(columnName);\n      var oldName = c.get('name');\n      c.set({\n        new_name: newName,\n        old_name: c.get('name')\n      });\n      this.notice('renaming column', 'load', 0);\n      c.save(null,  {\n          success: function(mdl, data) {\n            self.notice('Column has been renamed', 'info');\n            self.trigger('columnRename', newName, oldName);\n            self.data().fetch();\n            opts && opts.success && opts.success(mdl, data);\n          },\n          error: function(e, resp) {\n            cdb.log.error(\"can't rename column\");\n            self.error('error renaming column', resp);\n            opts && opts.error && opts.error(e, resp);\n          },\n          wait: true\n      });\n    },\n\n    isTypeChangeAllowed: function(columnName, newType) {\n      var deactivateMatrix = {\n        'number': ['date'],\n        'boolean': ['date'],\n        'date': ['boolean']\n      };\n      var c = this._getColumn(columnName);\n      if (!c) {\n        return true;\n      }\n      var type = c.get('type');\n      var deactivated = deactivateMatrix[type] || [];\n      deactivated = deactivated.concat([type])\n      return !_.contains(deactivated, newType);\n    },\n\n    isTypeChangeDestructive: function(columnName, newType) {\n      var columnType = this.getColumnType(columnName);\n\n      var destructiveMatrix = {\n        \"string\": {\n          \"string\": false,\n          \"number\": true,\n          \"date\": true,\n          \"boolean\": true,\n        },\n        \"number\": {\n          \"string\": false,\n          \"number\": false,\n          \"date\": true,\n          \"boolean\": true,\n        },\n        \"date\": {\n          \"string\": false,\n          \"number\": true,\n          \"date\": false,\n          \"boolean\": true,\n        },\n        \"boolean\": {\n          \"string\": false,\n          \"number\": false,\n          \"date\": true,\n          \"boolean\": false,\n        },\n      }\n      return destructiveMatrix[columnType][newType]\n    },\n\n    changeColumnType: function(columnName, newType, opts) {\n      var self = this;\n      var c = this._getColumn(columnName);\n\n      if(this.getColumnType(columnName) == newType) {\n        opts && opts.success && opts.success();\n        return;\n      }\n      this.saveNewColumnType(c, newType, opts);\n    },\n\n    saveNewColumnType: function(column, newType, opts) {\n      var self = this;\n      column.set({ type: newType});\n      this.notice('Changing column type', 'load', 0);\n      column.save(null, {\n          success: function() {\n            self.notice('Column type has been changed', 'info');\n            self.trigger('typeChanged', newType); // to make it testable\n            self.data().fetch();\n            opts && opts.success && opts.success();\n          },\n          error: function(e, resp) {\n            self.trigger('typeChangeFailed', newType, e); // to make it testable\n            self.error('error changing column type', resp);\n            opts && opts.error && opts.error(e, resp);\n          },\n          wait: true\n      });\n    },\n\n    /**\n     * returns the original data for the table not the current applied view\n     */\n    originalData: function() {\n      return this._data;\n    },\n\n    data: function() {\n      var self = this;\n      if(this._data === undefined) {\n        this._data = new cdb.admin.CartoDBTableData(null, {\n          table: this\n        });\n        this.bindData();\n      }\n      if(this.sqlView) {\n        return this.sqlView;\n      }\n      return this._data;\n    },\n\n    bindData: function(data) {\n      var self = this;\n      if(this._data && !this._data.bindedReset) {\n\n        this.retrigger('reset', this._data, 'dataLoaded');\n        this.retrigger('add', this._data, 'dataAdded');\n        this._data.bindedReset = true;\n\n      }\n      if(this.sqlView && !this.sqlView.bindedReset) {\n        this.retrigger('reset', this.sqlView, 'dataLoaded');\n        this.retrigger('add', this.sqlView, 'dataAdded');\n        this.sqlView.bindedReset = true;\n      }\n\n    },\n\n    useSQLView: function(view, options) {\n      if (!view && !this.sqlView) return;\n      options = options || {};\n      var self = this;\n      var data = this.data();\n\n      if(this.sqlView) {\n        this.sqlView.unbind(null, null, this);\n        this.sqlView.unbind(null, null, this._data);\n      }\n\n      // reset previous\n      if(!view && this.sqlView) {\n        this.sqlView.table = null;\n      }\n\n      this.sqlView = view;\n      this.bindData();\n\n      if(view) {\n        view.bind('reset', function() {\n          if(!view.modify_rows) {\n            this.set({\n              schema: view.schemaFromData(this.get('schema')),\n              geometry_types: view.getGeometryTypes()\n            });\n          }\n        }, this);\n        // listen for errors\n        view.bind('error', function(e, resp) {\n          this.notice('error loading rows, check your SQL query', 'error', 5000);\n        }, this);\n\n        view.bind('loading', function() {\n          //this.notice(_t('loading query'), 'load', 0);\n        }, this);\n\n        view.bind('reset loaded', function() {\n          if(view.modify_rows) {\n            this.notice(view.affected_rows + ' rows affected');\n            this.useSQLView(null);\n          } else {\n            this.notice(_t('loaded'));\n          }\n        }, this);\n\n        // swicth source data\n        this.dataModel = this.sqlView;\n        view.table = this;\n      } else {\n        this.dataModel = this._data;\n        // get the original schema\n        self.set({\n          'schema': self.get('original_schema')\n        });///*, { silent: true });\n        self.data().fetch();\n      }\n      this.trigger('change:dataSource', this.dataModel, this);\n    },\n\n    isInSQLView: function() {\n      return this.sqlView ? true: false;\n    },\n\n    /**\n     * replace fetch functionally to add some extra call for logging\n     * it can be used in the same way fetch is\n     */\n    fetch: function(opts) {\n      var self = this;\n      silent = opts? opts.silent : false;\n      if(!silent) {\n        this.notice('loading table', 'load', this, 0, 0);\n      }\n      var xhr = this.elder('fetch', opts)\n      $.when(xhr).done(function() {\n        opts && opts.success && opts.success.old_success && opts.success.old_success();\n        if(!silent) {\n          self.notice('loaded');\n        }\n      }).fail(function(){\n        if(!silent) {\n          self.notice('error loading the table');\n        }\n      });\n      return xhr;\n\n    },\n\n    isReservedColumn: function(c) {\n      return cdb.admin.Row.isReservedColumn(c);\n    },\n\n    /**\n     * when a table is linked to a infowindow each time a column\n     * is renamed or removed the table pings to infowindow to remove\n     * or rename the fields\n     */\n    linkToInfowindow: function(infowindow) {\n      var self = this;\n      this.bind('columnRename', function(newName, oldName) {\n        if(infowindow.containsField(oldName)) {\n          infowindow.removeField(oldName);\n          infowindow.addField(newName);\n        }\n      }, infowindow);\n      this.bind('columnDelete', function(oldName, newName) {\n        infowindow.removeField(oldName);\n      }, infowindow);\n\n      this.bind('change:schema', function() {\n        var self = this;\n        var columns = _(this.columnNames()).filter(function(c) {\n          return !_.contains(infowindow.SYSTEM_COLUMNS, c);\n        });\n\n        function _hash(str){\n            var hash = 0, c;\n            for (i = 0; i < str.length; i++) {\n                c = str.charCodeAt(i);\n                hash = c + (hash << 6) + (hash << 16) - hash;\n            }\n            return hash;\n        }\n\n        if (this.isInSQLView()) {\n          if (!infowindow.has('defaul_schema_fields')) {\n            infowindow.saveFields('defaul_schema_fields');\n          }\n          var current_schema_key = 'schema_' + _hash(self.columnNames().sort().join(''));\n          var previous_schema_key = 'schema_' + _hash(\n            _(self.previous('schema')).pluck(0).sort().join('')\n          );\n\n          if(!infowindow.has(previous_schema_key)) {\n            infowindow.saveFields(previous_schema_key);\n          }\n          if(infowindow.has(current_schema_key)) {\n            infowindow.restoreFields(null, current_schema_key);\n          }\n        } else {\n          infowindow.restoreFields(null, 'defaul_schema_fields');\n        }\n\n        if (infowindow.get('template')) {\n          // merge fields checking actual schema\n          infowindow.mergeFields(columns);\n        } else {\n          // remove fields that no longer exist\n          infowindow.removeMissingFields(columns);\n        }\n      }, this);\n\n    },\n\n    embedURL: function() {\n      return \"/tables/\" + this.get('name') + \"/embed_map\"\n    },\n\n    /**\n     * @deprecated use vis.viewUrl() or vis.viewUrl(currentUser) instead.\n     */\n    viewUrl: function() {\n      return cdb.config.prefixUrl() + \"/tables/\" + this.getUnqualifiedName()\n    },\n\n    hasTheGeom: function() {\n      var currentSchema = this.get('schema');\n      // if we have \"the_geom\" in our current schema, returnstrue\n      for(var n in currentSchema) {\n        if(currentSchema[n][0] === 'the_geom') {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Checks the server to see if the table has any georeferenced row, independently of the applyed query\n     * @return {promise}\n     */\n    fetchGeoreferenceStatus: function() {\n      var dfd = $.Deferred();\n      var username = (this.options && this.options.user_data)? this.options.user_data.username :\n        (window.user_data? window.user_data.username : window.user_name);\n      var api_key = (this.options && this.options.user_data)? this.options.user_data.api_key :\n        (window.user_data? window.user_data.api_key : window.api_key);\n\n\n      this.sqlApi = new this.sqlApiClass({\n        user: username,\n        version: 'v1',\n        api_key: api_key,\n        sql_api_template: cdb.config.getSqlApiBaseUrl()\n      });\n\n      var sql = 'SELECT the_geom FROM ' + this.get('name') + ' WHERE the_geom is not null';\n      this.sqlApi.execute(sql).done(function(data){\n        if(data.rows.length > 0) {\n          dfd.resolve(true);\n        } else {\n          dfd.resolve(false);\n        }\n      });\n\n      return dfd.promise();\n\n    },\n\n    /**\n     * Checks the current loaded records to see if they are georeferenced\n     * @return {boolean}\n     */\n    isGeoreferenced: function() {\n      var geoColumns = this.geomColumnTypes();\n      if(geoColumns && geoColumns.length > 0) {\n        return true;\n      } else {\n        if (!this.isInSQLView()) {\n          // sometimes the columns are changed in the frontend site\n          // and the geocolumns are not updated.\n          // check the columns in local\n          return this._data.any(function(row) {\n            return row.hasGeometry();\n          });\n        }\n      }\n      return false;\n    },\n\n    /**\n     * this function can only be called during change event\n     * returns true if the geometry type has changed\n     * for this method multipolygon and polygon are the same geometry type\n     */\n    geometryTypeChanged: function() {\n      if (!('geometry_types' in this.changed)) return false;\n      var geoTypes = this.get('geometry_types')\n      var prevGeoTypes = this.previousAttributes().geometry_types;\n      function normalize(e) {\n        e = e.toLowerCase();\n        if (e === 'st_multipolygon') {\n          return 'st_polygon'\n        }\n        if (e === 'st_multilinestring') {\n          return 'st_linestring'\n        }\n        if (e === 'st_multipoint') {\n          return 'st_point'\n        }\n        return e;\n      }\n\n      if(!geoTypes ||\n        geoTypes.length === 0 ||\n        !prevGeoTypes ||\n        prevGeoTypes.length === 0) {\n        return true;\n      }\n\n      var n = normalize(geoTypes[0]);\n      var o = normalize(prevGeoTypes[0]);\n      return n !== o;\n    },\n\n    /**\n     * Get necessary data create a duplicated dataset from this table.\n     *\n     * @param {Object} newName name of new dataset.\n     * @param {Object} callbacks\n     * @returns {Object}\n     */\n    duplicate: function(newName, callbacks) {\n      callbacks = callbacks || {};\n\n      // Extracted from duplicate_table_dialog\n      var data = {\n        table_name: newName\n      };\n\n      // Set correct data object, depending on if the app has a query applied or not\n      if (this.isInSQLView()) {\n        var query = this.data().getSQL();\n        data.sql = ( !query || query == \"\" ) ? 'SELECT * FROM ' + cdb.Utils.safeTableNameQuoting(this.get('name')) : query;\n      } else {\n        data.table_copy = this.get('name');\n      }\n\n      var importModel = new cdb.admin.Import();\n      importModel.save(data, {\n        error: callbacks.error,\n        success: function(model, changes) {\n          var checkImportModel = new cdb.admin.Import({\n            item_queue_id: changes.item_queue_id\n          });\n\n          checkImportModel.bind('importComplete', function() {\n            checkImportModel.unbind();\n\n            // So import is done, create new table object from the new table and fetch, callback once finished.\n            var newTable = new cdb.admin.CartoDBTableMetadata({\n              id: checkImportModel.get('table_id')\n            });\n\n            newTable.fetch({\n              success: function() {\n                callbacks.success(newTable);\n              },\n              error: callbacks.error\n            });\n          });\n\n          checkImportModel.bind('importError', function() {\n            checkImportModel.unbind();\n            callbacks.error.apply(this, arguments);\n          });\n\n          checkImportModel.pollCheck();\n        }\n      });\n    },\n\n    /**\n     * Get the visualizations that are using this table dataset.\n     * Note! a .fetch() is required to be sure the data to be available.\n     * @return {Array}\n     */\n    dependentVisualizations: function() {\n      // dependent = visualizations with a single layer\n      // non-dependant = have more than this dataset as a layer\n      return _.chain(this.get('dependent_visualizations'))\n        .union(this.get('non_dependent_visualizations'))\n        .compact()\n        .value() || [];\n    }\n\n  }, {\n    /**\n     * creates a new table from query\n     * the called is responsable of calling save to create\n     * the table in the server\n     */\n    createFromQuery: function(name, query) {\n      return new cdb.admin.CartoDBTableMetadata({\n        sql: query,\n        name: name\n      });\n    },\n\n    sortSchema: function(schema) {\n      var priorities = {\n        'cartodb_id': 1,\n        'the_geom': 2,\n        '__default__': 3,\n        'created_at': 4,\n        'updated_at': 5\n      };\n\n      function priority(v) {\n        return priorities[v] || priorities['__default__'];\n      }\n\n      return _.chain(schema)\n        .clone()\n        .sort(function(a, b) { // ..and then re-sort by priorities defined above\n          var prioA = priority(a[0]);\n          var prioB = priority(b[0]);\n          if (prioA < prioB) {\n            return -1;\n          } else if (prioA > prioB) {\n            return 1;\n          } else { //priority is the same (i.e. __default__), so compare alphabetically\n            return a[0] < b[0] ? -1 : 1;\n          }\n        })\n        .value();\n    },\n\n    /**\n     * return true if the sql query alters table schema in some way\n     */\n    alterTable: function(sql) {\n      sql = sql.trim();\n      return sql.search(/alter\\s+[\\w\\.\"]+\\s+/i) !== -1   ||\n             sql.search(/drop\\s+[\\w\\.\\\"]+/i)  !== -1  ||\n             sql.search(/^vacuum\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/^create\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/^reindex\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/^grant\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/^revoke\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/^cluster\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/^comment\\s+on\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/^explain\\s+[\\w\\.\\\"]+/i)  !== -1;\n    },\n\n    /**\n     * return true if the sql query alters table data\n     */\n    alterTableData: function(sql) {\n      return this.alterTable(sql)       ||\n             sql.search(/^refresh\\s+materialized\\s+view\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/^truncate\\s+[\\w\\.\\\"]+/i)  !== -1 ||\n             sql.search(/insert\\s+into/i) !== -1  ||\n             sql.search(/update\\s+[\\w\\.\\-\"]+\\s+.*set/i) !== -1  ||\n             sql.search(/delete\\s+from/i) !== -1;\n    }\n\n  });\n\n  cdb.admin.Row = cdb.core.Model.extend({\n\n    _CREATED_EVENT: 'created',\n    _CREATED_EVENT: 'creating',\n    sqlApiClass: cartodb.SQL,\n\n    _GEOMETRY_TYPES: {\n      'point': 'st_point',\n      'multipoint': 'st_multipoint',\n      'linestring': 'st_linestring',\n      'multilinestring': 'st_multilinestring',\n      'polygon': 'st_polygon',\n      'multipolygon': 'st_multipolygon'\n    },\n\n    url: function(method) {\n      var version = cdb.config.urlVersion('record', method);\n      var table = this.table || this.collection.table;\n      if(!table) {\n        cdb.log.error(\"row has no table assigned\");\n      }\n\n      var base = '/api/' + version + '/tables/' + table.get('name') + '/records/';\n      if (this.isNew()) {\n        return base;\n      }\n      return base + this.id;\n    },\n\n    fetch: function(opts) {\n      opts = opts || {}\n      var self = this;\n      var silent = opts && opts.silent;\n      var username = (this.options && this.options.user_data)? this.options.user_data.username :\n        (window.user_data? window.user_data.username : window.user_name);\n      var api_key = (this.options && this.options.user_data)? this.options.user_data.api_key :\n        (window.user_data? window.user_data.api_key : window.api_key);\n\n      var table = this.table || this.collection.table;\n\n      var sqlApi = new this.sqlApiClass({\n        user: username,\n        version: 'v2',\n        api_key: api_key,\n        sql_api_template: cdb.config.getSqlApiBaseUrl(),\n        extra_params: ['skipfields']\n      });\n      // this.trigger('loading')\n      var sql = null;\n      var columns = table.columnNames()\n      if (opts.no_geom) {\n        columns = _.without(columns, 'the_geom', 'the_geom_webmercator');\n      } else {\n        columns = _.without(columns, 'the_geom');\n      }\n      sql = 'SELECT ' + columns.join(',') + \" \"\n      if(table.containsColumn('the_geom') && !opts.no_geom) {\n        sql += ',ST_AsGeoJSON(the_geom, 8) as the_geom '\n      }\n      sql += ' from (' + table.data().getSQL() + ') _table_sql WHERE cartodb_id = ' + this.get('cartodb_id');\n      // Added opts to sql execute function to apply\n      // parameters ( like cache ) to the ajax request\n      if (opts.no_geom) {\n        opts.skipfields = 'the_geom,the_geom_webmercator';\n      } else {\n        opts.skipfields = 'the_geom_webmercator';\n      }\n      sqlApi.execute(sql, {}, opts).done(function(data){\n        if(self.parse(data.rows[0])) {\n          self.set(data.rows[0]);//, {silent: silent});\n          self.trigger('sync');\n        }\n      });\n\n    },\n\n    toJSON: function() {\n      var attr = _.clone(this.attributes);\n      // remove read-only attributes\n      delete attr['updated_at'];\n      delete attr['created_at'];\n      delete attr['the_geom_webmercator'];\n      if(!this.isGeometryGeoJSON()) {\n        delete attr['the_geom'];\n      }\n      return attr;\n    },\n\n    isGeomLoaded: function() {\n      var geojson = this.get('the_geom');\n      var column_types_WKT = cdb.admin.WKT.types\n      return  (geojson !== 'GeoJSON' && geojson !== -1 && !_.contains(column_types_WKT, geojson));\n    },\n\n    hasGeometry: function() {\n      var the_geom = this.get('the_geom');\n      return !!(the_geom != null && the_geom != undefined && the_geom != '')\n      // in fact, if the_geom has anything but null or '', the row is georeferenced\n\n      // if(typeof the_geom === 'string') {\n      //   // if the geom contains GeoJSON, the row has a valid geometry, but is not loaded yet\n      //   if(the_geom === 'GeoJSON')  {\n      //     return true\n      //   }\n\n      //   try {\n      //     var g = JSON.parse(the_geom);\n      //     return !!g.coordinates;\n      //   } catch(e) {\n      //     return false;\n      //   }\n      // } else {\n      //   if(the_geom) {\n      //     return !!the_geom.coordinates;\n      //   }\n      //   return false;\n      // }\n    },\n    /**\n     * Checks if the_geom contains a valid geoJson\n     */\n    isGeometryGeoJSON: function() {\n      var the_geom = this.get('the_geom');\n      if(the_geom && typeof the_geom === 'object') {\n        return !!the_geom.coordinates;\n      } else if(typeof the_geom !== 'string') {\n        return false;\n      }\n      // if the geom contains GeoJSON, the row has a valid geometry, but is not loaded yet\n      if(the_geom === 'GeoJSON')  {\n        return true\n      }\n\n      try {\n        var g = JSON.parse(the_geom);\n        return !!g.coordinates;\n      } catch(e) {\n        return false;\n      }\n\n      return false;\n\n    },\n\n    getFeatureType: function() {\n      if (this.isGeomLoaded()) {\n        // Problem geometry type from a WKB format\n        // Not possible for the moment\n        try {\n          var geojson = JSON.parse(this.get('the_geom'));\n          return geojson.type.toLowerCase();\n        } catch(e) {\n          cdb.log.info(\"Not possible to parse geometry type\");\n        }\n      }\n      return null;\n    },\n\n    getGeomType: function() {\n      try {\n        return this._GEOMETRY_TYPES[this.getFeatureType()];\n      } catch(e) {\n        cdb.log.info(\"Not possible to parse geometry type\");\n      }\n    }\n\n  }, {\n    RESERVED_COLUMNS: 'the_geom the_geom_webmercator cartodb_id created_at updated_at'.split(' '),\n    isReservedColumn: function(c) {\n      return _(cdb.admin.Row.RESERVED_COLUMNS).indexOf(c) !== -1;\n    }\n  });\n\n})();\n","cdb.admin.CartoDBTableData = cdb.ui.common.TableData.extend({\n  _ADDED_ROW_TEXT: 'Row added correctly',\n  _ADDING_ROW_TEXT: 'Adding a new row',\n  _GEOMETRY_UPDATED: 'Table geometry updated',\n\n  model: cdb.admin.Row,\n\n  initialize: function(models, options) {\n    var self = this;\n    this.table = options ? options.table: null;\n    this.model.prototype.idAttribute = 'cartodb_id';\n    this.initOptions();\n    this.filter = null;\n    this._fetching = false;\n    this.pages = [];\n    this.lastPage = false;\n    this.bind('newPage', this.newPage, this);\n    this.bind('reset', function() {\n      var pages = Math.floor(this.size()/this.options.get('rows_per_page'))\n      this.pages = [];\n\n      for(var i = 0; i < pages; ++i) {\n        this.pages.push(i);\n      }\n    }, this);\n\n    if(this.table) {\n      this.bind('add change:the_geom', function(row) {\n        var gt = this.table.get('geometry_types')\n        if(gt && gt.length > 0) return;\n        if(row.get('the_geom')) {\n          // we set it to silent because a change in geometry_types\n          // raises rendering and column feching\n          this.table.addGeomColumnType(row.getGeomType());\n        }\n      }, this);\n    }\n    this.elder('initialize');\n  },\n\n  initOptions: function() {\n    var self = this;\n    this.options = new cdb.core.Model({\n      rows_per_page:40,\n      page: 0,\n      sort_order: 'asc',\n      order_by: 'cartodb_id',\n      filter_column: '',\n      filter_value: ''\n    });\n    this.options.bind('change', function() {\n      if(self._fetching) {\n        return;\n      }\n      self._fetching = true;\n      opt = {};\n      var previous = this.options.previous('page');\n\n      if(this.options.hasChanged('page')) {\n        opt.add = true;\n        opt.changingPage = true;\n        // if user is going backwards insert new rows at the top\n        if(previous > this.options.get('page')) {\n          opt.at = 0;\n        }\n      } else {\n        if(this.options.hasChanged('mode')) {\n          this.options.set({\n            'page': 0\n          }, { silent: true });\n        }\n      }\n\n      opt.success = function(_coll, resp) {\n        self.trigger('loaded');\n        if(resp.rows && resp.rows.length !== 0) {\n          if(opt.changingPage) {\n            self.trigger('newPage', self.options.get('page'), opt.at === 0? 'up': 'down');\n          }\n        } else {\n          // no data so do not change the page\n          self.options.set({page: previous});//, { silent: true });\n        }\n        self.trigger('endLoadingRows', self.options.get('page'), opt.at === 0? 'up': 'down');\n        self._fetching = false;\n      };\n\n      opt.error = function() {\n        cdb.log.error(\"there was some problem fetching rows\");\n        self.trigger('endLoadingRows');\n        self._fetching = false;\n      };\n\n      self.trigger('loadingRows', opt.at === 0 ? 'up': 'down');\n      this.fetch(opt);\n\n    }, this);\n  },\n\n  parse: function(d) {\n    // when the query modifies the data modified flag is true\n    // TODO: change this when SQL API was able to say if a\n    // query modify some data\n    // HACK, it will fail if using returning sql statement\n    this.modify_rows = d.rows.length === 0 && _.size(d.fields) === 0;\n    this.affected_rows = d.affected_rows;\n    this.lastPage = false;\n    if(d.rows.length < this.options.get('rows_per_page')) {\n      this.lastPage = true;\n    }\n    return d.rows;\n  },\n\n  // given fields array as they come from SQL create a map name -> type\n  _schemaFromQueryFields: function(fields) {\n    var sc = {};\n    for(k in fields) {\n      sc[k] = fields[k].type;\n    }\n    return sc;\n  },\n\n  _createUrlOptions: function(filter) {\n    var attr;\n    if (filter) {\n      var a = {}\n      for (var k in this.options.attributes) {\n        if (filter(k)) {\n          a[k] = this.options.attributes[k];\n        }\n      }\n      attr = _(a);\n    } else {\n      attr = _(this.options.attributes);\n    }\n    var params = attr.map(function(v, k) {\n      return k + \"=\" + encodeURIComponent(v);\n    }).join('&');\n    params += \"&api_key=\" + cdb.config.get('api_key');\n    return params;\n  },\n\n  _geometryColumnSQL: function(c) {\n      return [\n        \"CASE\",\n        \"WHEN GeometryType(\" + c + \") = 'POINT' THEN\",\n          \"ST_AsGeoJSON(\" + c + \",8)\",\n        \"WHEN (\" + c + \" IS NULL) THEN\",\n          \"NULL\",\n        \"ELSE\",\n          \"GeometryType(\" + c + \")\",\n        \"END \" + c\n      ].join(' ');\n  },\n\n  // return wrapped SQL removing the_geom and the_geom_webmercator\n  // to avoid fetching those columns.\n  // So for a sql like\n  // select * from table the returned value is\n  // select column1, column2, column3... from table\n  wrappedSQL: function(schema, exclude, fetchGeometry) {\n    var self = this;\n    exclude = exclude || ['the_geom_webmercator'];\n    schema = _.clone(schema);\n\n    var select_columns = _.chain(schema).omit(exclude).map(function(v, k) {\n      if (v === 'geometry') {\n        if(fetchGeometry) {\n          return \"st_astext(\\\"\" + k + \"\\\") \" + \"as \" + k\n        }\n        return self._geometryColumnSQL(k);\n      }\n      return '\"' + k + '\"';\n    }).value();\n\n    select_columns = select_columns.join(',');\n\n    var mode = this.options.get('sort_order') === 'desc' ? 'desc': 'asc';\n\n    var q = \"select \" + select_columns + \" from (\" + this.getSQL() + \") __wrapped\";\n    var order_by = this.options.get('order_by');\n    if (order_by && order_by.length > 0) {\n      q += \" order by \" + order_by + \" \" + mode;\n    }\n    return q;\n\n  },\n\n  url: function() {\n    return this.sqlApiUrl();\n  },\n\n  /**\n  * we need to override sync to avoid the sql request to be sent by GET.\n  * For security reasons, we need them to be send as a PUT request.\n  * @method sync\n  * @param method {'save' || 'read' || 'delete' || 'create'}\n  * @param model {Object}\n  * @param options {Object}\n  */\n  sync: function(method, model, options) {\n    if(!options) { options = {}; }\n    options.data = this._createUrlOptions(function(d) {\n      return d !== 'sql';\n    });\n\n    if (cdb.admin.CartoDBTableMetadata.alterTableData(this.options.get('sql') || '')) {\n      options.data += \"&q=\" + encodeURIComponent(this.options.get('sql'));\n      options.type = 'POST';\n    } else {\n      // when a geometry can be lazy fetched, don't fetch it\n      var fetchGeometry = 'cartodb_id' in this.query_schema;\n      options.data += \"&q=\" + encodeURIComponent(this.wrappedSQL(this.query_schema, [], !fetchGeometry));\n\n      if (options.data.length > 2048) {\n        options.type = 'POST';\n      }\n    }\n\n    return Backbone.sync.call(this, method, this, options);\n  },\n\n  sqlApiUrl: function() {\n    return cdb.config.getSqlApiUrl();\n  },\n\n  setOptions: function(opt) {\n    this.options.set(opt);\n  },\n\n  // Refresh all table data\n  refresh: function() {\n    this.fetch();\n  },\n\n  isFetchingPage: function() {\n    return this._fetching;\n  },\n\n  loadPageAtTop: function() {\n\n    if(!this._fetching) {\n      var first = this.pages[0];\n\n      if(first > 0) {\n        this.options.set('page', first - 1);\n      }\n    }\n  },\n\n  loadPageAtBottom: function() {\n    if(!this._fetching) {\n      var last = this.pages[this.pages.length - 1];\n\n      if(!this.lastPage) {\n        this.options.set('page', last + 1);\n      }\n    }\n  },\n\n  /**\n   * called when a new page is loaded\n   * removes the models to max\n   */\n  newPage: function(currentPage, direction) {\n    if(this.pages.indexOf(currentPage) < 0) {\n      this.pages.push(currentPage);\n    };\n     this.pages.sort(function(a, b) {\n      return Number(a) > Number(b);\n     });\n     // remove blocks if there are more rows than allowed\n     var rowspp = this.options.get('rows_per_page');\n     var max_items = rowspp*4;\n     if(this.size() > max_items) {\n       if(direction == 'up') {\n         // remove page from the bottom (the user is going up)\n         this.pages.pop();\n         this.remove(this.models.slice(max_items, this.size()));\n       } else {\n         // remove page from the top (the user is going down)\n         this.pages.shift();\n         this.remove(this.models.slice(0, rowspp));\n       }\n     }\n  },\n\n  /*setPage: function(p) {\n    if(!this._fetching && p >= 0) {\n      this.setOptions({page: p});\n    }\n  },\n\n  getPage: function(p) {\n    return this.options.get('page');\n  },*/\n  addRow: function(opts) {\n    var self = this;\n    this.table.notice(self._ADDING_ROW_TEXT, 'load', 0)\n    var self = this;\n    opts = opts || {};\n    _.extend(opts, {\n      wait: true,\n      success: function() {\n        self.table.notice(self._ADDED_ROW_TEXT)\n      },\n      error: function(e, resp) {\n        //TODO: notice user\n        self.table.error(self._ADDING_ROW_TEXT, resp);\n      }\n    });\n    return this.create(null, opts);\n  },\n\n  /**\n   * creates a new row model in local, it is NOT serialized to the server\n   */\n  newRow: function(attrs) {\n    r = new cdb.admin.Row(attrs);\n    r.table = this.table;\n    r.bind('saved', function _saved() {\n      if(r.table.data().length == 0) {\n        r.table.data().fetch();\n        r.unbind('saved', _saved, r.table);\n      }\n    }, r.table);\n    return r;\n  },\n\n  /**\n   * return a model row\n   */\n  getRow: function(id, options) {\n    options = options || {};\n    var r = this.get(id);\n    if(!r) {\n      r = new cdb.admin.Row({cartodb_id: id});\n    }\n    if(!options.no_add) {\n      this.table._data.add(r);\n    }\n    r.table = this.table;\n    return r;\n  },\n\n  getRowAt: function(index) {\n    var r = this.at(index);\n    r.table = this.table;\n    return r;\n  },\n\n  deleteRow: function(row_id) {\n  },\n\n  isReadOnly: function() {\n    return false;\n  },\n\n  quartiles: function(nslots, column, callback, error) {\n    var tmpl = _.template('select quartile, max(<%= column %>) as maxamount from (select <%= column %>, ntile(<%= slots %>) over (order by <%= column %>) as quartile from (<%= sql %>) _table_sql where <%= column %> is not null) x group by quartile order by quartile');\n    this._sqlQuery(tmpl({\n      slots: nslots,\n      sql: this.getSQL(),\n      column: column\n    }),\n    function(data) {\n      callback(_(data.rows).pluck('maxamount'));\n    },\n    error);\n  },\n\n  equalInterval: function(nslots, column, callback, error) {\n    var tmpl = _.template(' \\\n      with params as (select min(a), max(a) from ( select <%= column %> as a from (<%= sql %>) _table_sql where <%= column %> is not null ) as foo ) \\\n      select (max-min)/<%= slots %> as s, min, max from params'\n    );\n    this._sqlQuery(tmpl({\n      slots: nslots,\n      sql: this.getSQL(),\n      column: column\n    }),\n    function(data) {\n      var min = data.rows[0].min;\n      var max = data.rows[0].max;\n      var range = data.rows[0].s;\n      var values = [];\n\n      for (var i = 1, l = nslots; i < l; i++) {\n        values.push((range*i) + min);\n      }\n\n      // Add last value\n      values.push(max);\n      // Callback\n      callback(values);\n    },\n    error);\n  },\n\n  _quantificationMethod: function(functionName, nslots, column, distinct, callback, error) {\n    var tmpl = _.template('select unnest(<%= functionName %>(array_agg(<%= simplify_fn %>((<%= column %>::numeric))), <%= slots %>)) as buckets from (<%= sql %>) _table_sql where <%= column %> is not null');\n    this._sqlQuery(tmpl({\n      slots: nslots,\n      sql: this.getSQL(),\n      column: column,\n      functionName: functionName,\n      simplify_fn: 'distinct'\n    }),\n    function(data) {\n      callback(_(data.rows).pluck('buckets'));\n    },\n    error);\n  },\n\n  discreteHistogram: function(nbuckets, column, callback, error) {\n\n    var query = 'SELECT DISTINCT(<%= column %>) AS bucket, count(*) AS value FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY value DESC LIMIT <%= nbuckets %> + 1';\n\n    var sql = _.template( query, {\n      column: column,\n      nbuckets: nbuckets,\n      sql: this.getSQL(),\n    });\n\n    this._sqlQuery(sql, function(data) {\n\n      var count = data.rows.length;\n      var reached_limit = false;\n\n      if (count > nbuckets) {\n        data.rows = data.rows.slice(0, nbuckets);\n        reached_limit = true;\n      }\n\n      callback({ rows: data.rows, reached_limit: reached_limit });\n\n    });\n\n  },\n\n  date_histogram: function(nbuckets, column, callback, error) {\n\n    column = \"EXTRACT(EPOCH FROM \" + column + \"::TIMESTAMP WITH TIME ZONE )\";\n\n    var tmpl = _.template(\n    'with bounds as ( ' +\n     'SELECT  ' +\n      'current_timestamp as tz, ' +\n      'min(<%= column %>) as lower,  ' +\n      'max(<%= column %>) as upper,  ' +\n      '(max(<%= column %>) - min(<%= column %>)) as span,  ' +\n      'CASE WHEN ABS((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>) <= 0 THEN 1 ELSE GREATEST(1.0, pow(10,ceil(log((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>)))) END as bucket_size ' +\n      'FROM  (<%= sql %>) _table_sql ' +\n    ')  ' +\n    'select array_agg(v) val, array_agg(bucket) buckets, tz, bounds.upper, bounds.lower, bounds.span, bounds.bucket_size from ' +\n    '( ' +\n    'select  ' +\n      'count(<%= column %>) as v,   ' +\n      'round((<%= column %> - bounds.lower)/bounds.bucket_size) as bucket  ' +\n       'from (<%= sql %>) _table_sql, bounds  ' +\n       'where <%= column %> is not null ' +\n       'group by bucket order by bucket ' +\n    ') a, bounds ' +\n     'group by ' +\n    'bounds.upper, bounds.lower, bounds.span, bounds.bucket_size, bounds.tz ');\n\n    // transform array_agg from postgres to a js array\n    function agg_array(a) {\n      return a.map(function(v) { return parseFloat(v) });\n    }\n\n    this._sqlQuery(tmpl({\n      nbuckets: nbuckets,\n      sql: this.getSQL(),\n      column: column\n    }),\n\n    function(data) {\n\n      if (!data.rows || data.rows.length === 0) {\n        callback(null, null);\n        return;\n      }\n\n      var data     = data.rows[0];\n      data.val     = agg_array(data.val);\n      data.buckets = agg_array(data.buckets);\n\n      var hist   = [];\n      var bounds = {};\n\n      // create a sorted array and normalize\n      var upper = data.upper;\n      var lower = data.lower;\n      var span  = data.span;\n      var tz    = data.tz;\n      var bucket_size = data.bucket_size\n      var max, min;\n\n      max = data.val[0];\n\n      for (var r = 0; r < data.buckets.length; ++r) {\n        var b = data.buckets[r];\n        var v = hist[b] = data.val[r];\n        max = Math.max(max, v);\n      }\n\n      //var maxBucket = _.max(data.buckets)\n      for (var i = 0; i < hist.length; ++i) {\n        if (hist[i] === undefined) {\n          hist[i] = 0;\n        } else {\n          hist[i] = hist[i]/max;\n        }\n      }\n\n      bounds.upper       = parseFloat(upper);\n      bounds.lower       = parseFloat(lower);\n      bounds.bucket_size = parseFloat(bucket_size)\n      bounds.tz          = tz;\n\n      callback(hist, bounds);\n\n    },\n\n    error);\n  },\n\n  histogram: function(nbuckets, column, callback, error) {\n\n    var tmpl = _.template(\n    'with bounds as ( ' +\n     'SELECT  ' +\n      'min(<%= column %>) as lower,  ' +\n      'max(<%= column %>) as upper,  ' +\n      '(max(<%= column %>) - min(<%= column %>)) as span,  ' +\n      'CASE WHEN ABS((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>) <= 0 THEN 1 ELSE GREATEST(1.0, pow(10,ceil(log((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>)))) END as bucket_size ' +\n      'FROM  (<%= sql %>) _table_sql  ' +\n    ')  ' +\n    'select array_agg(v) val, array_agg(bucket) buckets, bounds.upper, bounds.lower, bounds.span, bounds.bucket_size from ' +\n    '( ' +\n    'select  ' +\n      'count(<%= column %>) as v,   ' +\n      'round((<%= column %> - bounds.lower)/bounds.bucket_size) as bucket  ' +\n       'from (<%= sql %>) _table_sql, bounds  ' +\n       'where <%= column %> is not null ' +\n       'group by bucket order by bucket ' +\n    ') a, bounds ' +\n     'group by ' +\n    'bounds.upper, ' +\n    'bounds.lower, bounds.span, bounds.bucket_size ');\n\n    // transform array_agg from postgres to a js array\n    function agg_array(a) {\n      return a.map(function(v) { return parseFloat(v) });\n      //return JSON.parse(a.replace('{', '[').replace('}', ']'))\n    }\n\n    this._sqlQuery(tmpl({\n      nbuckets: nbuckets,\n      sql: this.getSQL(),\n      column: column\n    }),\n\n    function(data) {\n\n      if(!data.rows || data.rows.length === 0) {\n        callback(null, null);\n        return;\n      }\n\n      var data = data.rows[0];\n\n      data.val = agg_array(data.val);\n      data.buckets = agg_array(data.buckets);\n\n      var hist = [];\n      var bounds = {};\n\n      // create a sorted array and normalize\n      var upper = data.upper;\n      var lower = data.lower;\n      var span = data.span;\n      var bucket_size = data.bucket_size\n      var max, min;\n\n      max = data.val[0];\n\n      for(var r = 0; r < data.buckets.length; ++r) {\n        var b = data.buckets[r];\n        var v = hist[b] = data.val[r];\n        max = Math.max(max, v);\n      }\n\n\n      //var maxBucket = _.max(data.buckets)\n      for (var i = 0; i < hist.length; ++i) {\n        if (hist[i] === undefined) {\n          hist[i] = 0;\n        } else {\n          hist[i] = hist[i]/max;\n        }\n      }\n\n      bounds.upper = parseFloat(upper);\n      bounds.lower = parseFloat(lower);\n      bounds.bucket_size = parseFloat(bucket_size)\n\n      callback(hist, bounds);\n\n    },\n\n    error);\n  },\n\n  jenkBins: function(nslots, column, callback, error) {\n    this._quantificationMethod('CDB_JenksBins', nslots, column, true, callback, error);\n  },\n\n  headTails: function(nslots, column, callback, error) {\n    this._quantificationMethod('CDB_HeadsTailsBins', nslots, column, false, callback, error);\n  },\n\n  quantileBins: function(nslots, column, callback, error) {\n    this._quantificationMethod('CDB_QuantileBins', nslots, column, false, callback, error);\n  },\n\n  categoriesForColumn: function(max_values, column, callback, error) {\n\n    var tmpl = _.template('\\\n      SELECT <%= column %>, count(<%= column %>) FROM (<%= sql %>) _table_sql ' +\n      'GROUP BY <%= column %> ORDER BY count DESC LIMIT <%= max_values %> '\n    );\n\n    this._sqlQuery(tmpl({\n      sql: this.getSQL(),\n      column: column,\n      max_values: max_values + 1\n    }),\n    function(data) {\n      callback({\n        type: data.fields[column].type || 'string',\n        categories: _(data.rows).pluck(column)\n      });\n    },\n    error);\n\n  },\n\n  /**\n   * call callback with the geometry bounds\n   */\n  geometryBounds: function(callback) {\n    var tmpl = _.template('SELECT ST_XMin(ST_Extent(the_geom)) as minx,ST_YMin(ST_Extent(the_geom)) as miny, ST_XMax(ST_Extent(the_geom)) as maxx,ST_YMax(ST_Extent(the_geom)) as maxy from (<%= sql %>) _table_sql');\n    this._sqlQuery(tmpl({\n      sql: this.getSQL()\n      }),\n      function(result) {\n         var coordinates = result.rows[0];\n\n          var lon0 = coordinates.maxx;\n          var lat0 = coordinates.maxy;\n          var lon1 = coordinates.minx;\n          var lat1 = coordinates.miny;\n\n          var minlat = -85.0511;\n          var maxlat =  85.0511;\n          var minlon = -179;\n          var maxlon =  179;\n\n          var clampNum = function(x, min, max) {\n            return x < min ? min : x > max ? max : x;\n          };\n\n          lon0 = clampNum(lon0, minlon, maxlon);\n          lon1 = clampNum(lon1, minlon, maxlon);\n          lat0 = clampNum(lat0, minlat, maxlat);\n          lat1 = clampNum(lat1, minlat, maxlat);\n          callback([ [lat0, lon0], [lat1, lon1]]);\n      }\n    );\n  },\n\n  _sqlQuery: function(sql, callback, error, type) {\n    var s = encodeURIComponent(sql);\n    return $.ajax({\n      type: type || \"POST\",\n      data: \"q=\" + s + \"&api_key=\" + cdb.config.get('api_key'),\n      url: this.url(),\n      success: callback,\n      error: error\n    });\n  },\n\n  getSQL: function() {\n    // use table.id to fetch data because if always contains the real table name\n    return 'select * from ' + cdb.Utils.safeTableNameQuoting(this.table.get('id'));\n  },\n\n  fetch: function(opts) {\n    var self = this;\n    opts = opts || {};\n    if(!opts || !opts.add) {\n      this.options.attributes.page = 0;\n      this.options._previousAttributes.page = 0;\n      this.pages = [];\n    }\n   var error = opts.error;\n    opts.error = function(model, resp) {\n      self.fetched = true;\n      self.trigger('error', model, resp);\n      error && error(model, resp);\n    }\n    var success = opts.success;\n    opts.success = function(model, resp) {\n      self.fetched = true;\n      success && success.apply(self, arguments);\n    }\n    this._fetch(opts);\n  },\n\n  _fetch: function(opts) {\n    var MAX_GET_LENGTH = 1024;\n    var self = this;\n    this.trigger('loading', opts);\n\n    var sql = this.getSQL();\n    // if the query changes the database just send it\n    if (cdb.admin.CartoDBTableMetadata.alterTableData(sql)) {\n      cdb.ui.common.TableData.prototype.fetch.call(self, opts);\n      return;\n    }\n\n    // use get to fetch the schema, probably cached\n    this._sqlQuery(_.template('select * from (<%= sql %>) __wrapped limit 0')({ sql: sql }), function(data) {\n      // get schema\n      self.query_schema = self._schemaFromQueryFields(data.fields);\n      if (!self.table.isInSQLView()) {\n        if ('the_geom' in self.query_schema) {\n          delete self.query_schema['the_geom_webmercator'];\n        }\n      }\n      cdb.ui.common.TableData.prototype.fetch.call(self, opts);\n    }, function (err) {\n      self.trigger('error', self, err);\n    }, sql.length > MAX_GET_LENGTH ? \"POST\" : \"GET\");\n  },\n\n  /**\n   * with the data from the rows fetch create an schema\n   * if the schema from original table is passed the method\n   * set the column types according to it\n   * return an empty list if no data was fetch\n   */\n  schemaFromData: function(originalTableSchema) {\n    // build schema in format [ [field, type] , ...]\n    return cdb.admin.CartoDBTableMetadata.sortSchema(_(this.query_schema).map(function(v, k) {\n      return [k, v];\n    }));\n  },\n\n  geometryTypeFromGeoJSON: function(geojson) {\n    try {\n      var geo = JSON.parse(geojson);\n      return geo.type\n    } catch(e) {\n    }\n  },\n\n  geometryTypeFromWKT: function(wkt) {\n    if(!wkt) return null;\n    var types = cdb.admin.WKT.types;\n    wkt = wkt.toUpperCase();\n    for(var i = 0; i < types.length; ++i) {\n      var t = types[i];\n      if (wkt.indexOf(t) !== -1) {\n        return t;\n      }\n    }\n  },\n\n  geometryTypeFromWKB: function(wkb) {\n    if(!wkb) return null;\n\n    var typeMap = {\n      '0001': 'Point',\n      '0002': 'LineString',\n      '0003': 'Polygon',\n      '0004': 'MultiPoint',\n      '0005': 'MultiLineString',\n      '0006': 'MultiPolygon'\n    };\n\n    var bigendian = wkb[0] === '0' && wkb[1] === '0';\n    var type = wkb.substring(2, 6);\n    if(!bigendian) {\n      // swap '0100' => '0001'\n      type = type[2] + type[3] + type[0] + type[1];\n    }\n    return typeMap[type];\n\n  },\n\n\n  //\n  // guesses from the first row the geometry types involved\n  // returns an empty array where there is no rows\n  // return postgist types, like st_GEOTYPE\n  //\n  getGeometryTypes: function() {\n    var row = null;\n    var i = this.size();\n    while (i-- && !(row && row.get('the_geom'))) {\n      row = this.at(i);\n    }\n    if(!row) return [];\n    var geom = row.get('the_geom') || row.get('the_geom_webmercator');\n    var geoType = this.geometryTypeFromWKB(geom) || this.geometryTypeFromWKT(geom);\n    if(geoType) {\n      return ['ST_' + geoType[0].toUpperCase() + geoType.substring(1).toLowerCase()];\n    }\n    return [];\n  },\n\n});\n","/**\n * contains data for a sql view\n * var s = new cdb.admin.SQLViewData({ sql : \"select....\" });\n * s.fetch();\n */\ncdb.admin.SQLViewData = cdb.admin.CartoDBTableData.extend({\n\n  UNDEFINED_TYPE_COLUMN: 'undefined',\n\n  initialize: function(models, options) {\n    this.model.prototype.idAttribute = 'cartodb_id';\n    // this.elder('initialize', models, options);\n    cdb.admin.CartoDBTableData.prototype.initialize.call(this, models, options);\n\n    this.bind('error', function() {\n      this.reset([]);\n    });\n    //this.initOptions();\n    if(options && options.sql) {\n      this.setSQL(options.sql);\n    }\n  },\n\n\n  _parseSQL: function(sql) {\n    sql = sql.replace(/([^\\\\]){x}/g, '$10').replace(/\\\\{x}/g, '{x}')\n    sql = sql.replace(/([^\\\\]){y}/g, '$10').replace(/\\\\{y}/g, '{y}')\n    sql = sql.replace(/([^\\\\]){z}/g, '$10').replace(/\\\\{z}/g, '{z}')\n\n    // Substitute mapnik tokens\n    // resolution at zoom level 0\n    var res = '156543.03515625';\n    // full webmercator extent\n    var ext = 'ST_MakeEnvelope(-20037508.5,-20037508.5,20037508.5,20037508.5,3857)';\n    sql = sql.replace('!bbox!', ext)\n             .replace('!pixel_width!', res)\n             .replace('!pixel_height!', res);\n\n    return sql\n  },\n\n  sqlSource: function() {\n    return this.options.get('sql_source');\n  },\n\n  setSQL: function(sql, opts) {\n    opts = opts || {}\n    // reset options whiout changing raising a new fetchs\n    this.options.set({\n      page: 0,\n      sort_order: 'asc',\n      order_by: '',\n      filter_column: '',\n      filter_value: '',\n      sql_source: opts.sql_source || null\n    }, { silent: true } );\n\n    var silent = opts.silent;\n    opts.silent = true;\n    this.options.set({ sql : sql ? this._parseSQL(sql): '' }, opts);\n    if(!silent) {\n      this.options.trigger('change:sql', this.options, sql);\n    }\n  },\n\n  getSQL: function() {\n    return this.options.get('sql');\n  },\n\n  url: function() {\n    return this.sqlApiUrl();\n  },\n\n  isReadOnly: function() {\n    return this.sqlSource() !== 'filters';\n  },\n\n  quartiles: function(nslots, column, callback, error) {\n    var tmpl = _.template('SELECT quartile, max(<%= column %>) as maxAmount FROM (SELECT <%= column %>, ntile(<%= slots %>) over (order by <%= column %>) as quartile FROM (<%= sql %>) as _rambo WHERE <%= column %> IS NOT NULL) x GROUP BY quartile ORDER BY quartile');\n    this._sqlQuery(tmpl({\n      slots: nslots,\n      sql: this.options.get('sql'),\n      column: column\n    }),\n    function(data) {\n      callback(_(data.rows).pluck('maxamount'));\n    },\n    error);\n  },\n\n  // returns if the query contains geo data\n  isGeoreferenced: function() {\n    return this.getGeometryTypes().length > 0;\n  }\n\n  /*url: function() {\n    if(!this.sql) {\n      throw \"sql must be provided\";\n    }\n    return '/api/v1/queries?sql=' +\n      encodeURIComponent(this.sql) +\n      '&limit=20&rows_per_page=40&page=0'\n  }*/\n\n});\n","cdb.admin.CartoDBLayer = cdb.geo.CartoDBLayer.extend({\n  MAX_HISTORY: 5,\n  MAX_HISTORY_QUERY: 5,\n  MAX_HISTORY_TILE_STYLE: 5,\n\n  initialize: function() {\n    this.sync = _.debounce(this.sync, 1000);\n    this.error = false;\n\n    this.set('use_server_style', true);\n\n    this.initHistory('query');\n    this.initHistory('tile_style');\n\n    this.table = new cdb.admin.CartoDBTableMetadata({\n      id: this.get('table_name')\n    });\n\n    this.infowindow = new cdb.geo.ui.InfowindowModel({\n      template_name:  'infowindow_light'\n    });\n\n    this.tooltip = new cdb.geo.ui.InfowindowModel({\n      template_name:  'tooltip_light'\n    });\n\n    var wizard_properties = this.get('wizard_properties');\n\n    this.wizard_properties = new cdb.admin.WizardProperties(_.extend({},\n      wizard_properties, {\n        table: this.table,\n        layer: this\n      }\n    ));\n\n    //this.wizard_properties.properties(wizard_properties);\n\n    this.wizard_properties.bind('change:type', this._manageInteractivity, this);\n\n    this.legend = new cdb.geo.ui.LegendModel();\n\n    // Bindings\n    this.bind('change:table_name', function() {\n      this.table.set('id', this.get('table_name')).fetch();\n    }, this);\n\n    // schema changes should affect first to infowindow, tooltip\n    // and legend before table\n    this.bindInfowindow(this.infowindow, 'infowindow');\n    this.bindInfowindow(this.tooltip, 'tooltip');\n    this.bindLegend(this.legend);\n    this.bindTable(this.table);\n\n    this.tooltip.bind('change:fields', this._manageInteractivity, this);\n\n    if (this.get('table')) {\n      table_attr = this.get('table');\n      delete this.attributes.table;\n      this.table.set(table_attr);\n    }\n    if (!this.isTableLoaded()) {\n      this.table.fetch();\n    }\n  },\n\n  isTableLoaded: function() {\n    return this.table.get('id') && this.table.get('privacy');\n  },\n\n  toLayerGroup: function() {\n    var attr = _.clone(this.attributes);\n    attr.layer_definition = {\n      version: '1.0.1',\n      layers: []\n    };\n    if (this.get('visible')) {\n      attr.layer_definition.layers.push(this.getLayerDef());\n    }\n    attr.type = 'layergroup'\n    return attr;\n  },\n\n  getLayerDef: function() {\n    var attr = this.attributes;\n    var query = attr.query || 'select * from ' + cdb.Utils.safeTableNameQuoting(attr.table_name);\n    if(attr.query_wrapper) {\n      query = _.template(attr.query_wrapper)({ sql: query });\n    }\n    return {\n      type: 'cartodb',\n      options: {\n        sql: query,\n        cartocss: this.get('tile_style'),\n        cartocss_version: '2.1.1',\n        interactivity: this.get('interactivity')\n      }\n    }\n  },\n\n  /**\n   * Initializes the history if it doesn't exits and sets the position pointer to 0\n   * @param  {string} property\n   */\n  initHistory: function(property) {\n    if(!this.get(property+'_history')) {\n      this.set(property+'_history', []);\n    }\n    this[property+'_history_position'] = 0;\n    this[property+'_storage'] = new cdb.admin.localStorage(property+'_storage_'+this.get('table_name'));\n  },\n  /**\n   * Add a value to the property history if it's not the same than the last one\n   * @param {string} property\n   * @param {string} value\n   */\n  addToHistory: function(property, value) {\n    if(value != this.get(property+'_history')[this.get(property+'_history').length - 1]) {\n      this.get(property+'_history').push(value);\n      this.trimHistory(property);\n      this[property+'_history_position'] = this.get(property+'_history').length - 1;\n    }\n  },\n  /**\n   * Trim the history array to make sure its length isn't over MAX_HISTORY\n   * @param  {String} property [description]\n   */\n  trimHistory: function(property) {\n    var limit = this['MAX_HISTORY_'+property.toUpperCase()] ?\n      this['MAX_HISTORY_'+property.toUpperCase()] :\n      this.MAX_HISTORY;\n    while(this.get(property+'_history').length > limit) {\n      var removedValue = this.get(property+'_history').splice(0,1);\n      this[property+'_storage'].add(removedValue[0]);\n    }\n  },\n  /**\n   * Moves the history position pointer n positions and notify that the property needs to be refreshed on views\n   * @param  {String} property\n   * @param  {Integer} n\n   */\n  moveHistoryPosition: function(property, n) {\n      var newPosition = this[property+'_history_position'] + n;\n    if(newPosition >= 0 && newPosition < this.get(property+'_history').length) {\n      this[property+'_history_position'] = newPosition;\n    } else {\n      if(newPosition < 0 && Math.abs(newPosition) <= this[property+'_storage'].get().length) {\n        this[property+'_history_position'] = newPosition;\n      }\n    }\n  },\n  /**\n   * returns the value saved on the position of the current _history_position, either from memory of from localStorage\n   * @param  {String} property\n   * @return {String}\n   */\n  getCurrentHistoryPosition: function(property) {\n    var currentPosition = this[property+'_history_position'];\n    if(this[property+'_history_position'] >= 0) {\n      return this.get(property+'_history')[currentPosition];\n    } else {\n      if(Math.abs(currentPosition) <= this[property+'_storage'].get().length) {\n\n        return this[property+'_storage'].get(this[property+'_storage'].get().length - Math.abs(currentPosition));\n      } else {\n        return this.get(property+'_history')[0]\n      }\n    }\n\n  },\n  /**\n   * Advances by one the history_position and returns the value saved on that pos\n   * @param  {String} property\n   * @return {String}\n   */\n  redoHistory: function(property) {\n    this.moveHistoryPosition(property, 1);\n    return this.getCurrentHistoryPosition(property);\n  },\n  /**\n   * Reduces by one the history_position and returns the value saved on that pos\n   * @param  {String} property\n   * @return {String}\n   */\n  undoHistory: function(property) {\n    var h = this.getCurrentHistoryPosition(property);\n    this.moveHistoryPosition(property, -1);\n    return h;\n  },\n\n  isHistoryAtLastPosition: function(property) {\n    if(this.get(property+'_history').length === 0) {\n      return true;\n    }\n    return ((this.get(property+'_history').length-1) == this[property+'_history_position']);\n  },\n\n  isHistoryAtFirstPosition: function(property) {\n    if(this.get(property+'_history').length === 0) {\n      return true;\n    }\n    var stored = this[property+'_storage'].get();\n    if(stored && stored.length === 0) {\n      if(this[property+'_history_position'] === 0) {\n        return true;\n      }\n    } else {\n      var storedSize = stored ? 1*stored.length : 0;\n      var minimumPos = -1* storedSize;\n      return (minimumPos == this[property+'_history_position']);\n    }\n    return false;\n  },\n\n  clone: function() {\n    var attr = _.clone(this.attributes);\n    delete attr.id;\n    attr.table = this.table.toJSON();\n    return new cdb.admin.CartoDBLayer(attr);\n  },\n\n  toJSON: function() {\n    var c = _.clone(this.attributes);\n    // remove api key\n    if(c.extra_params) {\n      c.extra_params = _.clone(this.attributes.extra_params);\n      if(c.extra_params.api_key) {\n        delete c.extra_params.api_key;\n      }\n      if(c.extra_params.map_key) {\n        delete c.extra_params.map_key;\n      }\n    }\n\n    delete c.infowindow;\n    delete c.tooltip;\n    c.wizard_properties = this.wizard_properties.toJSON();\n    c.legend = this.legend.toJSON();\n    var d = {\n      // for some reason backend does not accept cartodb as layer type\n      kind: c.type.toLowerCase() === 'cartodb' ? 'carto': c.type,\n      options: c,\n      order: c.order,\n      infowindow: null,\n      tooltip: this.tooltip.toJSON()\n    };\n\n    // Don't send infowindow data if wizard doesn't support it\n    // It will make the tiler fails\n    if (this.wizard_properties.supportsInteractivity()) {\n      d.infowindow = this.infowindow.toJSON();\n    }\n\n    if(c.id !== undefined) {\n      d.id = c.id;\n    }\n    return d;\n  },\n\n  parse: function(data, xhr) {\n    var c = {};\n    // in case this is a response of saving the layer discard\n    // values from the server\n    if (!data || this._saving && !this.isNew()) {\n      return c;\n    }\n\n    // if api_key exist alread, set in params to not lose it\n    if(data.options.extra_params && this.attributes && this.attributes.extra_params) {\n      data.options.extra_params.map_key = this.attributes.extra_params.map_key;\n    }\n\n    var attrs = this.attributes;\n    var wp = attrs && attrs.wizard_properties;\n\n    if(wp && wp.properties && wp.properties.metadata) {\n      if (data.options.wizard_properties && data.options.wizard_properties.properties) {\n        data.options.wizard_properties.properties.metadata = wp.properties.metadata;\n      }\n    }\n\n    if (this.wizard_properties && data.options.wizard_properties) {\n      this.wizard_properties.properties(data.options.wizard_properties);\n    }\n\n    _.extend(c, data.options, {\n      id: data.id,\n      type: data.kind === 'carto' ? 'CartoDB': data.kind,\n      infowindow: data.infowindow,\n      tooltip: data.tooltip,\n      order: data.order\n    });\n\n    return c;\n  },\n\n  sync: function(method, model, options) {\n    if(method != 'read') {\n      options.data =  JSON.stringify(model.toJSON());\n    }\n    options.contentType = 'application/json';\n    options.url = model.url();\n    return Backbone.syncAbort(method, this, options);\n  },\n\n  unbindSQLView: function(sqlView) {\n    this.sqlView.unbind(null, null, this);\n    this.sqlView = null;\n  },\n\n  getCurrentState: function() {\n    if (this.error) {\n      return \"error\";\n    }\n    return \"success\";\n  },\n\n  bindSQLView: function(sqlView) {\n    var self = this;\n    this.sqlView = sqlView;\n    this.sqlView.bind('error', this.errorSQLView, this);\n\n    // on success and no modify rows save the query!\n    this.sqlView.bind('reset', function() {\n      // if the query was cleared while fetchin the data\n      if (!self.table.isInSQLView()) return;\n      self.error = false;\n      if(self.sqlView.modify_rows) {\n        self.set({ query: null });\n        self.invalidate();\n        self.table.useSQLView(null, { force_data_fetch: true });\n        self.trigger('clearSQLView');\n      } else {\n        self.save({\n          query: sqlView.getSQL(),\n          sql_source: sqlView.sqlSource()\n        });\n      }\n    }, this);\n\n    // Set sql view if query was applied\n    var sql = this.get('query');\n    if (sql) {\n      this.applySQLView(sql, { add_to_history: false });\n    } else {\n      this.table.data().fetch();\n    }\n  },\n\n  bindTable: function(table) {\n    this.table = table;\n    var self = this;\n    self.table.bind('change:name', function() {\n      if (self.get('table_name') != self.table.get('name')) {\n        self.fetch({\n          success: function() {\n            self.updateCartoCss(self.table.previous('name'), self.table.get('name'));\n          }\n        });\n      }\n    });\n\n    this.table.bind('change:schema', this._manageInteractivity, this);\n  },\n\n  _manageInteractivity: function() {\n    var interactivity = null;\n    if (this.wizard_properties.supportsInteractivity()) {\n      if(this.table.containsColumn('cartodb_id')) {\n        interactivity = ['cartodb_id'];\n      }\n      var tooltipColumns = this.tooltip.getInteractivity();\n      if (tooltipColumns.length) {\n        interactivity = (interactivity || []).concat(tooltipColumns);\n      }\n      if (interactivity) {\n        interactivity = interactivity.join(',');\n      }\n    }\n    if(this.get('interactivity') !== interactivity) {\n      if (this.isNew()) {\n        this.set({ interactivity: interactivity });\n      } else {\n        this.save({ interactivity: interactivity });\n      }\n    }\n  },\n\n  /**\n   * Updates the style chaging the table name for a new one\n   * @param  {String} previousName\n   * @param  {String} newName\n   */\n  updateCartoCss: function(previousName, newName) {\n    var tileStyle = this.get('tile_style');\n    if (!tileStyle) return;\n    var replaceRegexp = new RegExp('#'+previousName, 'g');\n    tileStyle = tileStyle.replace(replaceRegexp, '#'+newName);\n    this.save({'tile_style': tileStyle});\n  },\n\n  bindLegend: function(legend) {\n\n    var data = this.get('legend');\n\n    if (data) {\n      this.legend.set(data);\n    }\n\n    this.legend.bind('change:template change:type change:title change:show_title change:items', _.debounce(function() {\n      // call with silent so the layer is no realoded\n      // if some view needs to be changed when the legend is changed it should be\n      // subscribed to the legend model not to dataLayer\n      // (which is only a data container for the legend)\n      if (!this.isNew()) {\n        this.save(null, { silent: true });\n      }\n    }, 250), this);\n\n  },\n\n  bindInfowindow: function(infowindow, attr) {\n    attr = attr || 'infowindow';\n    var infowindowData = this.get(attr);\n    if(infowindowData) {\n      infowindow.set(infowindowData);\n    } else {\n      // assign a position from start\n      var pos = 0;\n      _(this.table.get('schema')).each(function(v) {\n        if(!_.contains(['the_geom', 'created_at', 'updated_at', 'cartodb_id'], v[0])) {\n          infowindow.addField(v[0], pos);\n          ++pos;\n        }\n      });\n    }\n\n    this.table.linkToInfowindow(infowindow);\n\n    var watchedFields = 'change:fields change:template_name change:alternative_names change:template change:disabled change:width change:maxHeight';\n    var deferredSave = _.debounce(function() {\n      // call with silent so the layer is no realoded\n      // if some view needs to be changed when infowindow is changed it should be\n      // subscribed to infowindow model not to dataLayer\n      // (which is only a data container for infowindow)\n\n      // since removeMissingFields changes fields, unbind changes temporally\n      infowindow.unbind(watchedFields, deferredSave, this);\n      // assert all the fields are where they should\n      infowindow.removeMissingFields(this.table.columnNames());\n      infowindow.bind(watchedFields, deferredSave, this);\n      if (!this.isNew()) {\n        this.save(null, { silent: true });\n      }\n    }, 250);\n\n    infowindow.bind(watchedFields, deferredSave, this);\n  },\n\n  resetQuery: function() {\n    if (this.get('query')) {\n      this.save({\n        query: undefined,\n        sql_source: null\n      });\n    }\n  },\n\n  errorSQLView: function(m, e) {\n    this.save({ query: null }, { silent: true });\n    this.trigger('errorSQLView', e);\n    this.error = true;\n  },\n\n  clearSQLView: function() {\n    // before reset query we should remove the view\n    this.table.useSQLView(null);\n    this.addToHistory(\"query\", 'SELECT * FROM ' + cdb.Utils.safeTableNameQuoting(this.table.get('name')));\n    // undo history to move backwards the history pointer\n    this.undoHistory(\"query\");\n    this.resetQuery();\n    this.trigger('clearSQLView');\n  },\n\n  applySQLView: function(sql, options) {\n    options = options || {\n      add_to_history: true,\n      sql_source: null\n    };\n    // if the sql change the table data do not save in the data layer\n    // pass though and launch the query directly to the table\n    this.table.useSQLView(this.sqlView);\n    this.sqlView.setSQL(sql, {\n      silent: true,\n      sql_source: options.sql_source || null\n    });\n    if(options.add_to_history) {\n      this.addToHistory(\"query\", sql);\n    }\n    // if there is some error the query is rollbacked\n    this.sqlView.fetch();\n    this.trigger('applySQLView', sql);\n  },\n\n  moveToFront: function(opts) {\n    var layers = this.collection;\n    var dataLayers = layers.getDataLayers();\n\n    layers.moveLayer(this, { to: dataLayers.length });\n  }\n}, {\n\n  createDefaultLayerForTable: function(tableName, userName) {\n    return new cdb.admin.CartoDBLayer({\n      user_name: userName,\n      table_name: tableName,\n      tile_style: \"#\" + tableName + cdb.admin.CartoStyles.DEFAULT_GEOMETRY_STYLE,\n      style_version: '2.1.0',\n      visible: true,\n      interactivity: 'cartodb_id',\n      maps_api_template: cdb.config.get('maps_api_template'),\n      no_cdn: true\n    });\n  }\n\n});\n","\n/*\n * extend infowindow to serialize only the data we need\n */\n_.extend(cdb.geo.ui.InfowindowModel.prototype, {\n  toJSON: function() {\n    var fields = [];\n\n    if (!this.attributes.disabled) {\n      fields = _.clone(this.attributes.fields);\n    }\n\n    return {\n      fields:             fields,\n      template_name:      this.attributes.template_name,\n      template:           this.attributes.template,\n      alternative_names:  this.attributes.alternative_names,\n      old_fields:         this.attributes.old_fields,\n      old_template_name:  this.attributes.old_template_name,\n      width:              this.attributes.width,\n      maxHeight:          this.attributes.maxHeight\n    };\n  },\n\n  removeMissingFields: function(columns) {\n    var columnsSet = {}\n    for(var i = 0; i < columns.length; ++i) {\n      var c = columns[i];\n      columnsSet[c] = true;\n    }\n    var fields = this.get('fields');\n    if (!fields) {\n      return;\n    }\n    for(var i = 0; i < fields.length; ++i) {\n      var name = fields[i].name;\n      if (! (name in columnsSet)) {\n        this.removeField(name);\n      }\n    }\n  },\n\n  addMissingFields: function(columns) {\n    var fieldsSet = {};\n    var fields = this.get('fields');\n\n    for(var i = 0; i < fields.length; ++i) {\n      var c = fields[i].name;\n      fieldsSet[c] = true;\n    }\n\n    for(var i = 0; i < columns.length; ++i) {\n      var name = columns[i];\n      if (! (name in fieldsSet)) {\n        this.addField(name);\n      }\n    }\n  },\n\n  mergeFields: function(columns) {\n    // remove fields that no longer exist\n    this.removeMissingFields(columns);\n    // add new fields that exists\n    this.addMissingFields(columns);\n  },\n\n  // return the list of columns involved in the infowindow\n  // ready to set interactivity in a cartodb layer\n  getInteractivity: function() {\n    var fields = this.get('fields') || [];\n    var columns = [];\n    for(var i = 0; i < fields.length; ++i) {\n      columns.push(fields[i].name);\n    }\n    return columns;\n  }\n});\n\n/**\n * extend gmaps layer for data serialization\n */\ncdb.admin.GMapsBaseLayer = cdb.geo.GMapsBaseLayer.extend({\n\n  clone: function() {\n    return new cdb.admin.GMapsBaseLayer(_.clone(this.attributes));\n  },\n\n  parse: function(data) {\n    var c = {};\n    _.extend(c, data.options, {\n      id: data.id,\n      type: 'GMapsBase',\n      order: data.order,\n      parent_id: data.parent_id\n    });\n    return c;\n  },\n\n  toJSON: function() {\n    var c = _.clone(this.attributes);\n\n    var d = {\n      kind:  'gmapsbase',\n      options: c,\n      order: c.order\n    };\n\n    if(c.id !== undefined) {\n      d.id = c.id;\n    }\n    return d;\n  }\n});\n\n/**\n * extend wms layer for data serialization\n */\ncdb.admin.WMSLayer = cdb.geo.WMSLayer.extend({\n\n  clone: function() {\n    return new cdb.admin.WMSLayer(_.clone(this.attributes));\n  },\n\n  /*\n  * Create className from the urlTemplate of the basemap\n  */\n  _generateClassName: function(urlTemplate) {\n    if (urlTemplate) {\n      var className = urlTemplate;\n\n      if (className && parseInt(className) && _.isNumber(parseInt(className))) {\n        className = \"w\" + className;\n      }\n\n      return className.replace(/\\s+/g, '').replace(/[^a-zA-Z_0-9 ]/g, \"\").toLowerCase();\n\n    } else return \"\";\n  },\n\n  parse: function(data) {\n\n    var self = this;\n    var c = {};\n\n    _.extend(c, data.options, {\n      id: data.id,\n      className: self._generateClassName(data.options.layers),\n      type: 'WMS',\n      order: data.order,\n      parent_id: data.parent_id\n    });\n\n    return c;\n  },\n\n  toJSON: function() {\n    var c = _.clone(this.attributes);\n\n    var d = {\n      kind:  'wms',\n      options: c,\n      order: c.order\n    };\n\n    if(c.id !== undefined) {\n      d.id = c.id;\n    }\n    return d;\n  }\n\n});\n\n/**\n * extend plain layer for data serialization\n */\ncdb.admin.PlainLayer = cdb.geo.PlainLayer.extend({\n\n  parse: function(data) {\n    var c = {};\n    _.extend(c, data.options, {\n      id: data.id,\n      type: 'Plain',\n      order: data.order,\n      parent_id: data.parent_id\n    });\n    return c;\n  },\n\n  toJSON: function() {\n    var c = _.clone(this.attributes);\n\n    var d = {\n      kind:  'background',\n      options: c,\n      order: c.order\n    };\n\n    if(c.id !== undefined) {\n      d.id = c.id;\n    }\n    return d;\n  }\n});\n\n/**\n * extend tiled layer to adapt serialization\n */\ncdb.admin.TileLayer = cdb.geo.TileLayer.extend({\n\n  clone: function() {\n    return new cdb.admin.TileLayer(_.clone(this.attributes));\n  },\n\n  /*\n  * Create className from the urlTemplate of the basemap\n  */\n  _generateClassName: function(urlTemplate) {\n    if (urlTemplate) {\n      return urlTemplate.replace(/\\s+/g, '').replace(/[^a-zA-Z_0-9 ]/g, \"\").toLowerCase();\n    } else return \"\";\n  },\n\n  parse: function(data) {\n    var self = this;\n    var c = {};\n\n    _.extend(c, data.options, {\n      id: data.id,\n      className: self._generateClassName(data.options.urlTemplate),\n      type: 'Tiled',\n      order: data.order,\n      parent_id: data.parent_id\n    });\n\n    return c;\n  },\n\n  toJSON: function() {\n    var c = _.clone(this.attributes);\n\n    var d = {\n      kind:  'tiled',\n      options: c,\n      order: c.order\n    };\n\n    if(c.id !== undefined) {\n      d.id = c.id;\n    }\n    return d;\n  },\n\n  /**\n   * validateTemplateURL - Validates current urlTemplate of layer.\n   *\n   * @param {Object} callbacks with success and error functions defined to be called depending on validation outcome.\n   */\n  validateTemplateURL: function(callbacks) {\n    var subdomains = ['a', 'b', 'c'];\n    var image = new Image();\n    image.onload = callbacks.success;\n    image.onerror = callbacks.error;\n    image.src = this.get('urlTemplate').replace(/\\{s\\}/g, function() {\n      return subdomains[Math.floor(Math.random() * 3)];\n    })\n      .replace(/\\{x\\}/g, '0')\n      .replace(/\\{y\\}/g, '0')\n      .replace(/\\{z\\}/g, '0');\n  }\n\n}, {\n\n  /**\n   * @param {String} url\n   * @param {Boolean} tms\n   * @return {cdb.admin.TileLayer}\n   */\n  byCustomURL: function(url, tms) {\n    // Minimal test for \"valid URL\" w/o having to complicate it with regex\n    if (url && url.indexOf('/') === -1) throw new TypeError('invalid URL');\n\n    // Only lowercase the placeholder variables, since the URL may contain case-sensitive data (e.g. API keys and such)\n    url = url.replace(/\\{S\\}/g, \"{s}\")\n      .replace(/\\{X\\}/g, \"{x}\")\n      .replace(/\\{Y\\}/g, \"{y}\")\n      .replace(/\\{Z\\}/g, \"{z}\");\n\n    var layer = new cdb.admin.TileLayer({\n      urlTemplate: url,\n      attribution: null,\n      maxZoom: 21,\n      minZoom: 0,\n      name: '',\n      tms: tms\n    });\n    layer.set('className', layer._generateClassName(url));\n\n    return layer;\n  }\n});\n\ncdb.admin.TorqueLayer = cdb.admin.CartoDBLayer.extend({\n\n  /*parse: function(data, options) {\n    var c = cdb.admin.CartoDBLayer.prototype.parse.call(this, data, options);\n    c.type = 'torque';\n    return c;\n  }*/\n\n});\n\ncdb.admin.Layers = cdb.geo.Layers.extend({\n\n  _DATA_LAYERS: ['CartoDB', 'torque'],\n\n  // the model class works here like a factory\n  // depending on the kind of layer creates a\n  // type of layer or other\n  model: function(attrs, options) {\n    var typeClass = {\n      'Tiled': cdb.admin.TileLayer,\n      'CartoDB': cdb.admin.CartoDBLayer,\n      'Plain': cdb.admin.PlainLayer,\n      'GMapsBase': cdb.admin.GMapsBaseLayer,\n      'WMS': cdb.admin.WMSLayer,\n      'torque': cdb.admin.CartoDBLayer\n    };\n    var typeMap = {\n      'Layer::Tiled': 'Tiled',\n      'Layer::Carto': 'CartoDB',\n      'Layer::Background': 'Plain',\n      'tiled': 'Tiled',\n      'carto': 'CartoDB',\n      'wms': 'WMS',\n      'background': 'Plain',\n      'gmapsbase': 'GMapsBase',\n      'torque': 'torque'\n    };\n\n    return new typeClass[typeMap[attrs.kind]](attrs, options);\n  },\n\n  initialize: function() {\n    this.bind('change:order', function() {\n      if (!this._isSorted()) this.sort();\n    });\n    cdb.geo.Layers.prototype.initialize.call(this);\n  },\n\n  add: function(models, options) {\n    return Backbone.Collection.prototype.add.apply(this, arguments);\n  },\n\n  getTorqueLayers: function() {\n    return this.where({ type: 'torque' });\n  },\n\n  getTiledLayers: function() {\n    return this.where({ type: 'Tiled' });\n  },\n\n  // given layer model returns the index inside the layer definition\n  getLayerDefIndex: function(layer) {\n    var cartodbLayers = this.getLayersByType('CartoDB');\n    if(!cartodbLayers.length) return -1;\n    for(var i = 0, c = 0; i < cartodbLayers.length; ++i) {\n      if(cartodbLayers[i].get('visible')) {\n        if(cartodbLayers[i].cid === layer.cid) {\n          return c;\n        }\n        ++c;\n      }\n    }\n    return -1;\n  },\n\n  getLayerDef: function() {\n    var cartodbLayers = this.getLayersByType('CartoDB');\n    var layerDef = {\n      version:'1.0.1',\n      layers: []\n    };\n\n    for(var i = 0; i < cartodbLayers.length; ++i) {\n      if(cartodbLayers[i].get('visible')) {\n        layerDef.layers.push(cartodbLayers[i].getLayerDef());\n      }\n    }\n    return layerDef;\n  },\n\n  /** return non-base layers */\n  getDataLayers: function() {\n    var self = this;\n    return this.filter(function(lyr) {\n      return _.contains(self._DATA_LAYERS, lyr.get('type'));\n    });\n  },\n\n  /** without non-base layers */\n  getTotalDataLayers: function() {\n    return this.getDataLayers().length;\n  },\n\n  /** without non-base layers */\n  getTotalDataLegends: function() {\n    var self = this;\n    return this.filter(function(lyr) {\n      return _.contains(self._DATA_LAYERS, lyr.get('type')) &&\n            lyr.get('legend') &&\n            lyr.get('legend').type &&\n            lyr.get('legend').type.toLowerCase() !== \"none\";\n    }).length;\n  },\n\n  getLayersByType: function(type) {\n    if (!type || type === '' ) {\n      cdb.log.info(\"a layer type is necessary to get layers\");\n      return 0;\n    }\n\n    return this.filter(function(lyr) {\n      return lyr.get('type') === type;\n    });\n  },\n\n  isLayerOnTopOfDataLayers: function(layer) {\n    var dataLayerOnTop = this.getDataLayers().splice(-1)[0];\n    return dataLayerOnTop.cid === layer.cid;\n  },\n\n  url: function(method) {\n    var version = cdb.config.urlVersion('layer', method);\n    return '/api/' + version + '/maps/' +  this.map.id + '/layers';\n  },\n\n  parse: function(data) {\n    return data.layers;\n  },\n\n  saveLayers: function(opts) {\n    opts = opts || {};\n    this.save(null, opts);\n  },\n\n  save: function(attrs, opts) {\n    Backbone.sync('update', this, opts);\n  },\n\n  toJSON: function(options) {\n    // We can't use the default toJSON because it uses this.map(function(){...})\n    // function within it but we override it using map containing all map stuff there.\n    // And we have to send all layers data within a variable called layers. \n    var array = _.map(this.models, function(model) {\n      return model.toJSON(options);\n    });\n\n    return { layers: array }\n  },\n\n  clone: function(layers) {\n    layers = layers || new cdb.admin.Layers();\n    this.each(function(layer) {\n      if(layer.clone) {\n        var lyr = layer.clone();\n        lyr.unset('id');\n        layers.add(lyr);\n      } else {\n        var attrs = _.clone(layer.attributes);\n        delete attrs.id;\n        layers.add(attrs);\n      }\n    });\n    return layers;\n  },\n\n  _isSorted: function() {\n    var sorted = true;\n\n    var layers = _(this.models).map(function(m) {\n      return { cid: m.cid,  order: m.get('order')}\n    });\n\n    layers.sort(function(a, b) {\n      return a.order - b.order;\n    })\n\n    return _.isEqual(\n      _(layers).map(function(m) { return m.cid; }),\n      _(this.models).map(function(m) { return m.cid; })\n    )\n  },\n\n  moveLayer: function(movingLayer, options) {\n    options = options || {};\n    var newIndex = options.to;\n    var layerAtNewIndex = this.at(newIndex);\n    movingLayer.set('order', layerAtNewIndex.get('order'), { silent: true });\n\n    // Remove and add the layer again at the new position\n    this.remove(movingLayer, { silent: true });\n    this.add(movingLayer, { at: newIndex, silent: true });\n\n    // Update the order of all layers\n    for (var i = 0; i < this.size(); i++) {\n      var layer = this.at(i);\n      layer.set('order', i);\n    }\n\n    this.trigger('reset');\n    this.saveLayers({\n      complete: options.complete,\n      error: function() {\n        throw 'Error saving layers after moving them'\n      }\n    });\n  }\n});\n\n/**\n * this is a specialization of generic map prepared to hold two layers:\n *  - a base layer\n *  - a data layer which contains the table data\n *\n * cartodb only supports one data layer per map so this will change when\n * that changes\n */\n\ncdb.admin.Map = cdb.geo.Map.extend({\n\n  urlRoot: '/api/v1/maps',\n\n  initialize: function() {\n    this.constructor.__super__.initialize.apply(this);\n    this.sync = Backbone.delayedSaveSync(Backbone.syncAbort, 500);\n    this.bind('change:id', this._fetchLayers, this);\n\n    this.layers = new cdb.admin.Layers();\n    this.layers.map = this;\n    this.layers.bind('reset add change', this._layersChanged, this);\n    this.layers.bind('reset add remove change:attribution', this._updateAttributions, this);\n  },\n\n  saveLayers: function(opts) {\n    opts = opts || {};\n    var none = function() {}\n    this.layers.saveLayers({\n      success: opts.success || none,\n      error: opts.error || none\n    });\n  },\n\n  _layersChanged: function() {\n    if(this.layers.size() >= 1) {\n      this._adjustZoomtoLayer(this.layers.at(0));\n      if(this.layers.size() >= 2) {\n        this.set({ dataLayer: this.layers.at(1) });\n      }\n    }\n  },\n\n  // fetch related layers\n  _fetchLayers: function() {\n    this.layers.fetch();\n  },\n\n  /**\n   * link to a table\n   */\n  relatedTo: function(table) {\n    this.table = table;\n    this.table.bind('change:map_id', this._fetchOrCreate, this);\n  },\n\n  parse: function(data) {\n    data.bounding_box_ne = JSON.parse(data.bounding_box_ne);\n    data.bounding_box_sw = JSON.parse(data.bounding_box_sw);\n    data.view_bounds_ne = JSON.parse(data.view_bounds_ne);\n    data.view_bounds_sw = JSON.parse(data.view_bounds_sw);\n    data.center = JSON.parse(data.center);\n    return data;\n  },\n\n  _fetchOrCreate: function() {\n    var self = this;\n    var map_id = this.table.get('map_id');\n    if(!map_id) {\n      this.create();\n    } else {\n      this.set({ id: map_id });\n      this.fetch({\n        error: function() {\n          cdb.log.info(\"creating map for table\");\n          self.create();\n        }\n      });\n    }\n  },\n\n  /**\n   * change base layer and save all the layers to preserve the order\n   */\n  setBaseLayer: function(baseLayer) {\n    this.trigger('savingLayers');\n\n    // Check if the selected base layer is already selected\n    if (this.isBaseLayerAdded(baseLayer)) {\n      this.trigger('savingLayersFinish');\n      return false;\n    }\n\n    var self = this;\n    var newBaseLayer = baseLayer;\n    var currentBaseLayer = this.layers.at(0);\n    var newBaseLayerHasLabels = newBaseLayer.get('labels') && newBaseLayer.get('labels').url;\n\n    // Sets the base layer\n    var options = {\n      success: function() {\n        if (!newBaseLayerHasLabels) {\n          self.trigger('savingLayersFinish');\n        }\n      },\n      error: function() {\n        cdb.log.error(\"error changing the basemap\");\n        self.trigger('savingLayersFinish');\n      }\n    }\n\n    if (currentBaseLayer) {\n      if (currentBaseLayer.get('type') === newBaseLayer.get('type')) {\n        this._updateBaseLayer(currentBaseLayer, newBaseLayer, options);\n      } else {\n        this._replaceBaseLayer(currentBaseLayer, newBaseLayer, options);\n      }\n    } else {\n      this._addBaseLayer(newBaseLayer, options);\n    }\n\n\n    // Adds/updates/removes layer with labels at the top\n    options.success = function() {\n      self.trigger('savingLayersFinish');\n    }\n\n    if (newBaseLayerHasLabels) {\n      if (this._hasLabelsLayer()) {\n        this._updateLabelsLayer(newBaseLayer, options);\n      } else {\n        this._addLabelsLayer(newBaseLayer, options);\n      }\n    } else {\n      if (this._hasLabelsLayer()) {\n        this._destroyLabelsLayer(options);\n      }\n    }\n\n    return newBaseLayer;\n  },\n\n  _updateBaseLayer: function(currentBaseLayer, newBaseLayer, opts) {\n    var newAttributes = _.extend(_.clone(newBaseLayer.attributes), {\n      id: currentBaseLayer.get('id'),\n      order: currentBaseLayer.get('order')\n    });\n    currentBaseLayer.clear({ silent: true });\n    currentBaseLayer.set(newAttributes);\n    currentBaseLayer.save(null, opts);\n  },\n\n  _replaceBaseLayer: function(currentBaseLayer, newBaseLayer, opts) {\n    this.layers.remove(currentBaseLayer);\n    newBaseLayer.set({\n      id: currentBaseLayer.get('id'),\n      order: currentBaseLayer.get('order')\n    });\n    this.layers.add(newBaseLayer, { at: 0 });\n    newBaseLayer.save(null, opts);\n  },\n\n  _addBaseLayer: function(newBaseLayer, opts) {\n    this.layers.add(newBaseLayer, { at: 0 });\n    newBaseLayer.save(null, opts);\n  },\n\n  _hasLabelsLayer: function() {\n    return this.layers.size() > 1 && this.layers.last().get('type') === 'Tiled';\n  },\n\n  _updateLabelsLayer: function(baseLayer, opts) {\n    var labelsLayer = this.layers.last();\n    labelsLayer.set({\n      name: this._labelsLayerNameFromBaseLayer(baseLayer),\n      urlTemplate: baseLayer.get('labels').url,\n      attribution: baseLayer.get('attribution'),\n      minZoom: baseLayer.get('minZoom'),\n      maxZoom: baseLayer.get('maxZoom'),\n      subdomains: baseLayer.get('subdomains')\n    });\n    labelsLayer.save(null, opts);\n  },\n\n  _addLabelsLayer: function(baseLayer, opts) {\n    this.layers.add({\n      name: this._labelsLayerNameFromBaseLayer(baseLayer),\n      urlTemplate: baseLayer.get('labels').url,\n      attribution: baseLayer.get('attribution'),\n      minZoom: baseLayer.get('minZoom'),\n      maxZoom: baseLayer.get('maxZoom'),\n      subdomains: baseLayer.get('subdomains'),\n      kind: \"tiled\"\n    });\n    var labelsLayer = this.layers.last();\n    labelsLayer.save(null, opts);\n  },\n\n  _destroyLabelsLayer: function(opts) {\n    this.layers.last().destroy(opts);\n  },\n\n  _labelsLayerNameFromBaseLayer: function(baseLayer) {\n    return baseLayer.get('name') + \" Labels\";\n  },\n\n  /**\n   * the first version of cartodb contains one single layer\n   * per table with information.\n   */\n  addDataLayer: function(lyr) {\n    this.addLayer(lyr);\n    this.set({ dataLayer: lyr });\n  },\n\n  /**\n   * create a new map. this is a helper to use from javascript command line\n   */\n  create: function() {\n    this.unset('id');\n    this.set({ table_id: this.table.id });\n    this.save();\n  },\n\n  /**\n   * enable save map each time the viewport changes\n   * not working\n   */\n  autoSave: function() {\n    this.bind('change:center', this.save);\n    this.bind('change:zoom', this.save);\n  },\n\n  toJSON: function() {\n    var c = _.clone(this.attributes);\n    // data layer is a helper to work in local\n    delete c.dataLayer;\n    return c;\n  },\n\n  /**\n   * change provider and optionally baselayer\n   */\n  changeProvider: function(provider, baselayer) {\n    var self = this;\n\n    if(baselayer && baselayer.get('id')) {\n      cdb.log.error(\"the baselayer should not be saved in the server\");\n      return;\n    }\n    var _changeBaseLayer = function() {\n      if(baselayer) {\n        self.setBaseLayer(baselayer);\n      }\n    }\n    if(this.get('provider') !== provider) {\n      this.save({ provider: provider }, {\n        success: function() {\n          _changeBaseLayer();\n          self.change();\n        },\n        error: function(e, resp) {\n          self.error(_t('error switching base layer'), resp);\n        },\n        silent: true\n      });\n    } else {\n      _changeBaseLayer();\n    }\n  },\n\n  isProviderGmaps: function() {\n    var provider = this.get(\"provider\");\n    return provider && provider.toLowerCase().indexOf(\"googlemaps\") !== -1\n  },\n\n  clone: function(m) {\n    m = m || new cdb.admin.Map();\n    var attrs = _.clone(this.attributes)\n    delete attrs.id;\n    m.set(attrs);\n\n    // clone lists\n    m.set({\n      center:           _.clone(this.attributes.center),\n      bounding_box_sw:  _.clone(this.attributes.bounding_box_sw),\n      bounding_box_ne:  _.clone(this.attributes.bounding_box_ne),\n      view_bounds_sw:   _.clone(this.attributes.view_bounds_sw),\n      view_bounds_ne:   _.clone(this.attributes.view_bounds_ne),\n      attribution:      _.clone(this.attributes.attribution)\n    });\n\n    // layers\n    this.layers.clone(m.layers);\n    m.layers.map = m;\n\n    return m;\n  },\n\n  notice: function(msg, type, timeout) {\n    this.trigger('notice', msg, type, timeout);\n  },\n\n  error: function(msg, resp) {\n    var err =  resp && JSON.parse(resp.responseText).errors[0];\n    this.trigger('notice', msg + \" \" + err, 'error');\n  },\n\n  addCartodbLayerFromTable: function(tableName, userName, opts) {\n    opts = opts || {};\n    /*var newLayer = cdb.admin.CartoDBLayer.createDefaultLayerForTable(tableName, userName);\n    this.layers.add(newLayer);\n    newLayer.save(null, opts);\n    */\n\n    var self = this;\n    var table = new cdb.admin.CartoDBTableMetadata({ id: tableName });\n    table.fetch({\n      success: function() {\n        // Get the layers for the map\n        var map = new cdb.admin.Map({ id: table.get('map_id') });\n        map.layers.bind('reset', function() {\n          var newLayer = map.layers.at(1).clone();\n          newLayer.unset('order');\n\n          function layerReady() {\n            newLayer.table.unbind('change:geometry_types', layerReady);\n            // when the layer is torque and there are other torque layers in the map, switch it to a\n            // simple visualization layer\n            if (newLayer.wizard_properties.get('type') === 'torque' && self.layers.getTorqueLayers().length) {\n              newLayer.wizard_properties.active('polygon');\n            }\n            // wait: true is used to make sure the layer is not added until confirmed it was added successfully\n            // pass opts for success/error callbacks to be triggered as expected\n            self.layers.create(newLayer, _.extend({ wait: true }, opts));\n          }\n\n          // Wait until the layer is totally ready in order to add it to the layers and save it\n          if (newLayer.isTableLoaded()) {\n            layerReady();\n          } else {\n            newLayer.table.bind('change:geometry_types', layerReady);\n            newLayer.table.data().fetch();\n          }\n        });\n        map.layers.fetch();\n      }\n    });\n  },\n\n  // moves the map to interval [-180, 180]\n  clamp: function() {\n    var fmod = function (a,b) { return Number((a - (Math.floor(a / b) * b)).toPrecision(8)); };\n    var latlng = this.get('center');\n    var lon = latlng[1];\n    if(lon < -180 || lon > 180) {\n      lon = fmod(180 + lon, 360) - 180;\n      this.set('center', [latlng[0], lon]);\n    }\n    return this;\n  }\n});\n","/**\n * Model representing a group.\n * Expected to be used in the context of a groups collection (e.g. cdb.admin.OrganizationGroups),\n * which defines its API endpoint path.\n */\ncdb.admin.Group = cdb.core.Model.extend({\n\n  defaults: {\n    display_name: '' // UI name, as given by\n    // name: '', // internal alphanumeric representation, converted from display_name internally\n    // organization_id: '',\n  },\n\n  initialize: function(attrs) {\n    this.parse(attrs || {}); // handle given attrs in the same way as for .fetch()\n  },\n\n  parse: function(attrs) {\n    this.users = new cdb.admin.GroupUsers(attrs.users, {\n      group: this\n    });\n    return attrs;\n  }\n\n});\n","/**\n * Collection of a User's groups.\n */\ncdb.admin.UserGroups = Backbone.Collection.extend({\n\n  model: cdb.admin.Group,\n\n  initialize: function(models, opts) {\n    this.organization = opts.organization;\n  }\n\n});\n","/**\n * A collection that holds a set of organization groups\n */\ncdb.admin.OrganizationGroups = Backbone.Collection.extend({\n\n  model: cdb.admin.Group,\n\n  url: function(method) {\n    var version = cdb.config.urlVersion('organizationGroups', method);\n    return '/api/' + version + '/organization/' + this.organization.id + '/groups';\n  },\n\n  initialize: function(models, opts) {\n    if (!opts.organization) throw new Error('organization is required');\n    this.organization = opts.organization;\n  },\n\n  parse: function(response) {\n    this.total_entries = response.total_entries;\n    return response.groups;\n  },\n\n  // @return {Object} A instance of cdb.admin.Group. If group wasn't already present a new model with id and collection\n  //  set will be returned, i.e. group.fetch() will be required to get the data or handle the err case (e.g. non-existing)\n  newGroupById: function(id) {\n    var group = this.get(id);\n    if (!group) {\n      group = new this.model({\n        id: id\n      });\n      // collection set on model, but not added to collection yet\n      group.collection = this;\n    }\n    return group;\n  },\n\n  // @return {Number, undefined} may be undefined until a first fetch is done\n  totalCount: function() {\n    return this.total_entries;\n  }\n\n});\n","\n/**\n * the user has some base layers saved\n */\ncdb.admin.UserLayers = cdb.admin.Layers.extend({\n  url: function(method) {\n    var version = cdb.config.urlVersion('layer', method);\n    return '/api/' + version + '/users/' +  this.user.id + '/layers';\n  },\n\n  custom: function() {\n    return this.where({ category: undefined });\n  }\n});\n\ncdb.admin.User = cdb.core.Model.extend({\n\n  urlRoot: '/api/v1/users',\n\n  defaults: {\n    avatar_url: 'http://cartodb.s3.amazonaws.com/static/public_dashboard_default_avatar.png',\n    username:   ''\n  },\n\n  initialize: function(attrs) {\n    attrs = attrs || {};\n    this.tables = [];\n    // Removing avatar_url attribute if it comes as null\n    // Due to a Backbone Model constructor uses _.extends\n    // instead of _.defaults\n    if (this.get(\"avatar_url\") === null) {\n      this.set(\"avatar_url\", this.defaults.avatar_url);\n    }\n\n    if (this.get(\"get_layers\")) {\n      this.layers = new cdb.admin.UserLayers();\n      this.layers.user = this;\n      this._fetchLayers();\n    }\n\n    this.email = (typeof attrs.email !== 'undefined') ? attrs.email : '';\n\n    if (this.get('organization')) {\n      this.organization = new cdb.admin.Organization(\n        this.get('organization'),\n        {\n          currentUserId: this.id\n        }\n      );\n    }\n\n    this.groups = new cdb.admin.UserGroups(attrs.groups, {\n      organization: _.result(this.collection, 'organization') || this.organization\n    });\n  },\n\n  isInsideOrg: function() {\n    if (this.organization) {\n      return this.organization.id != false || this.isOrgOwner();\n    }\n    return false;\n  },\n\n  isOrgOwner: function() {\n    if (this.organization) {\n      return this.organization.owner.get('id') === this.get('id')\n    }\n    return false;\n  },\n\n  isOrgAdmin: function () {\n    if (this.organization) {\n      return this.organization.isOrgAdmin(this);\n    }\n    return false;\n  },\n\n  isViewer: function() {\n    return this.get('viewer') == true;\n  },\n\n  isBuilder: function() {\n    return !this.isViewer();\n  },\n\n  nameOrUsername: function() {\n    return this.get('name') || this.get('username');\n  },\n\n  renderData: function(currentUser) {\n    var name = this.get('username');\n    if (currentUser && currentUser.id === this.id) {\n      name = _t('You');\n    }\n    return {\n      username: name,\n      avatar_url: this.get('avatar_url')\n    }\n\n  },\n\n  _fetchLayers: function() {\n    this.layers.fetch({ add: true });\n  },\n\n  fetchTables: function() {\n    var self = this;\n    if (this._fetchingTables)  return;\n    var tables = new cdb.admin.Visualizations();\n    tables.options.set('type', 'table')\n    tables.bind('reset', function() {\n      self.tables = tables.map(function(u) { return u.get('name'); })\n    })\n    this._fetchingTables = true;\n    tables.fetch();\n  },\n\n  hasCreateDatasetsFeature: function() {\n    return this.isBuilder();\n  },\n\n  canCreateDatasets: function() {\n    if (!this.get('remaining_byte_quota') || this.get('remaining_byte_quota') <= 0) {\n      return false\n    }\n    return this.hasCreateDatasetsFeature();\n  },\n\n  hasCreateMapsFeature: function() {\n    return this.isBuilder();\n  },\n\n  canAddLayerTo: function(map) {\n    if (!map || !map.layers || !map.layers.getDataLayers) {\n      throw new Error(\"Map model is not defined or wrong\");\n    }\n    var dataLayers = map.layers.getDataLayers();\n    return dataLayers.length < this.getMaxLayers();\n  },\n\n  getMaxLayers: function() {\n    return ( this.get('limits') && this.get('limits').max_layers ) || 5;\n  },\n\n  getMaxConcurrentImports: function() {\n    return ( this.get('limits') && this.get('limits').concurrent_imports ) || 1;\n  },\n\n  featureEnabled: function(name) {\n    var featureFlags = this.get('feature_flags');\n    if (!featureFlags || featureFlags.length === 0 || !name) {\n      return false;\n    }\n\n    return _.contains(featureFlags, name)\n  },\n\n  isCloseToLimits: function() {\n    var quota = this.get(\"quota_in_bytes\");\n    var remainingQuota = this.get(\"remaining_byte_quota\");\n    return ( (remainingQuota * 100) / quota ) < 20\n  },\n\n  getMaxLayersPerMap: function() {\n    return this.get('max_layers') || 4;\n  },\n\n  canStartTrial: function() {\n    return !this.isInsideOrg() && this.get(\"account_type\") === 'FREE' && this.get(\"table_count\") > 0\n  },\n\n  canCreatePrivateDatasets: function() {\n    var actions = this.get('actions');\n    return actions && actions.private_tables;\n  },\n\n  equals: function(otherUser) {\n    if (otherUser.get) {\n      return this.get('id') === otherUser.get('id');\n    }\n  },\n\n  viewUrl: function() {\n    return new cdb.common.UserUrl({\n      base_url: this.get('base_url'),\n      is_org_admin: this.isOrgAdmin()\n    });\n  },\n\n  upgradeContactEmail: function() {\n    if (this.isInsideOrg()) {\n      if (this.isOrgOwner()) {\n        return 'enterprise-support@carto.com';\n      } else {\n        return this.organization.owner.get('email');\n      }\n    } else {\n      return 'support@carto.com';\n    }\n  },\n\n  usedQuotaPercentage: function() {\n    return (this.get('db_size_in_bytes') * 100) / this.organization.get('available_quota_for_user');\n  },\n\n  assignedQuotaInRoundedMb: function () {\n    return Math.floor(this.get('quota_in_bytes')/1024/1024).toFixed(0);\n  },\n\n  assignedQuotaPercentage: function() {\n    return (this.get('quota_in_bytes') * 100) / this.organization.get('available_quota_for_user');\n  }\n\n});\n","\n/**\n * manages a cartodb permission object, it contains:\n * - owner: an cdb.admin.User instance\n * - acl: a collection which includes the user and their permission.\n *\n *   see https://github.com/Vizzuality/cartodb-management/wiki/multiuser-REST-API#permissions-object\n *\n *   this object is not created to work alone, it should be a member of an object like visualization\n *   table\n */\ncdb.admin.Permission = cdb.core.Model.extend({\n\n\n  urlRoot: '/api/v1/perm',\n\n  initialize: function() {\n    this.acl = new Backbone.Collection();\n    this.owner = null;\n    this._generateOwner();\n    this._generateAcl();\n    this.bind('change:owner', this._generateOwner, this);\n    this.bind('change:acl', this._generateAcl, this);\n  },\n\n  _generateOwner: function() {\n    if (!this.owner) {\n      this.owner = new cdb.admin.User();\n    }\n    this.owner.set(this.get('owner'));\n  },\n\n  _generateAcl: function() {\n    this.acl.reset([], { silent: true });\n    _.each(this.get('acl'), function(aclItem) {\n      var model;\n      switch (aclItem.type) {\n        case 'user':\n          model = new cdb.admin.User(aclItem.entity);\n          break;\n        case 'org':\n          model = new cdb.admin.Organization(aclItem.entity);\n          break;\n        case 'group':\n          model = new cdb.admin.Group(aclItem.entity);\n          break;\n        default:\n          throw new Error(\"Unknown ACL item type: \" + aclItem.type);\n      }\n      this._grantAccess(model, aclItem.access);\n    }, this);\n  },\n\n  cleanPermissions: function() {\n    this.acl.reset();\n  },\n\n  hasAccess: function(model) {\n    // Having at least read access is the same as having any access\n    return this.hasReadAccess(model);\n  },\n\n  hasReadAccess: function(model) {\n    // If there is a representable ACL item it must be one of at least READ_ONLY access\n    return !!this.findRepresentableAclItem(model);\n  },\n\n  hasWriteAccess: function(model) {\n    var access = cdb.Utils.result(this.findRepresentableAclItem(model), 'get', 'access');\n    return access === cdb.admin.Permission.READ_WRITE;\n  },\n\n  canChangeReadAccess: function(model) {\n    return this._canChangeAccess(model);\n  },\n\n  canChangeWriteAccess: function(model) {\n    return (!model.isBuilder || model.isBuilder()) && this._canChangeAccess(model, function(representableAclItem) {\n      return cdb.Utils.result(representableAclItem, 'get', 'access') !== cdb.admin.Permission.READ_WRITE;\n    })\n  },\n\n  _canChangeAccess: function(model) {\n    var representableAclItem = this.findRepresentableAclItem(model);\n    return this.isOwner(model) || !representableAclItem ||\n      representableAclItem === this._ownAclItem(model) || cdb.Utils.result(arguments, 1, representableAclItem) || false;\n  },\n\n  grantWriteAccess: function(model) {\n    this._grantAccess(model, this.constructor.READ_WRITE);\n  },\n\n  grantReadAccess: function(model) {\n    this._grantAccess(model, this.constructor.READ_ONLY);\n  },\n\n  revokeWriteAccess: function(model) {\n    // Effectively \"downgrades\" to READ_ONLY\n    this.grantReadAccess(model);\n  },\n\n  /**\n   * Revokes access to a set of items\n   * @param {Object} model A single model or an array of models\n   */\n  revokeAccess: function(model) {\n    var aclItem = this._ownAclItem(model);\n    if (aclItem) {\n      this.acl.remove(aclItem);\n    }\n  },\n\n  isOwner: function(model) {\n    return _.result(this.owner, 'id') === _.result(model, 'id');\n  },\n\n  toJSON: function() {\n    return {\n      entity: this.get('entity'),\n      acl: this.acl.toJSON()\n    };\n  },\n\n  getUsersWithAnyPermission: function() {\n    return this.acl.chain()\n      .filter(this._hasTypeUser)\n      .map(this._getEntity)\n      .value();\n  },\n\n  isSharedWithOrganization: function() {\n    return this.acl.any(this._hasTypeOrg);\n  },\n\n  clone: function() {\n    var attrs = _.clone(this.attributes);\n    delete attrs.id;\n    return new cdb.admin.Permission(attrs);\n  },\n\n  /**\n   * Overwrite this ACL list from other permission object\n   * @param otherPermission {Object} instance of cdb.admin.Permission\n   */\n  overwriteAcl: function(otherPermission) {\n    this.acl.reset(otherPermission.acl.models);\n  },\n\n  // Note that this may return an inherited ACL item\n  // use ._ownAclItem instead if only model's own is wanted (if there is any)\n  findRepresentableAclItem: function(model) {\n    if (this.isOwner(model)) {\n      return this._newAclItem(model, this.constructor.READ_WRITE);\n    } else {\n      var checkList = ['_ownAclItem', '_organizationAclItem', '_mostPrivilegedGroupAclItem'];\n      return this._findMostPrivilegedAclItem(checkList, function(fnName) {\n        return this[fnName](model);\n      });\n    }\n  },\n\n  _hasTypeUser: function(m) {\n    return m.get('type') === 'user';\n  },\n\n  _getEntity: function(m) {\n    return m.get('entity');\n  },\n\n  _hasTypeOrg: function(m) {\n    return m.get('type') === 'org';\n  },\n\n  _isOrganization: function(object) {\n    return object instanceof cdb.admin.Organization;\n  },\n\n  _ownAclItem: function(model) {\n    if (!model || !_.isFunction(model.isNew)) {\n      cdb.log.error('model is required to find an ACL item');\n    }\n    if (!model.isNew()) {\n      return this.acl.find(function(aclItem) {\n        return aclItem.get('entity').id === model.id;\n      });\n    }\n  },\n\n  _organizationAclItem: function(m) {\n    var org = _.result(m.collection, 'organization') || m.organization;\n    if (org) {\n      return this._ownAclItem(org);\n    }\n  },\n\n  _mostPrivilegedGroupAclItem: function(m) {\n    var groups = _.result(m.groups, 'models');\n    if (groups) {\n      return this._findMostPrivilegedAclItem(groups, this._ownAclItem);\n    }\n  },\n\n  /**\n   * Iterates over a items in given list using the iteratee, stops and returns when found the ACL item with best access (i.e. READ_WRITE), or the\n   * list is completed.\n   * @param {Array} list\n   * @param {Function} iteratee that takes an item from list and returns an access\n   *   iteratee is called in context of this model.\n   * @Return {String} 'r', 'rw', or undefined if there were no access for given item\n   */\n  _findMostPrivilegedAclItem: function(list, iteratee) {\n    var aclItem;\n    for (var i = 0, x = list[i]; x && cdb.Utils.result(aclItem, 'get', 'access') !== cdb.admin.Permission.READ_WRITE; x = list[++i]) {\n      // Keep last ACL item if iteratee returns nothing\n      aclItem = iteratee.call(this, x) || aclItem;\n    }\n    return aclItem;\n  },\n\n  /**\n   * Grants access to a set of items\n   * @param {Object} model\n   * @param {String} access can take the following values:\n   * - 'r': read only\n   * - 'rw': read and write permission\n   */\n  _grantAccess: function(model, access) {\n    var aclItem = this._ownAclItem(model);\n    if (aclItem) {\n      aclItem.set('access', access);\n    } else {\n      aclItem = this._newAclItem(model, access);\n      if (aclItem.isValid()) {\n        this.acl.add(aclItem);\n      } else {\n        throw new Error(access + ' is not a valid ACL access');\n      }\n    }\n  },\n\n  _newAclItem: function(model, access) {\n    var type;\n    if (model instanceof cdb.admin.User) {\n      type = 'user'\n    } else if (model instanceof cdb.admin.Group) {\n      type = 'group';\n    } else if (this._isOrganization(model)) {\n      type = 'org';\n    } else {\n      throw new Error('model not recognized as a valid ACL entity ' + model);\n    }\n\n    return new cdb.admin.ACLItem({\n      type: type,\n      entity: model,\n      access: access\n    });\n  }\n\n}, {\n\n  READ_ONLY: 'r',\n  READ_WRITE: 'rw'\n\n});\n\n//TODO: add validation\ncdb.admin.ACLItem = Backbone.Model.extend({\n  defaults: {\n    access: 'r'\n  },\n\n  isOwn: function(model) {\n    return model.id === this.get('entity').id;\n  },\n\n  validate: function(attrs, options) {\n    var p = cdb.admin.Permission;\n    if (attrs.access !== p.READ_ONLY && attrs.access !== p.READ_WRITE) {\n      return \"access can't take 'r' or 'rw' values\";\n    }\n  },\n\n  toJSON: function() {\n    var entity = _.pick(this.get('entity').toJSON(), 'id', 'username', 'avatar_url', 'name');\n    // translate name to username\n    if (!entity.username) {\n      entity.username = entity.name;\n      delete entity.name;\n    }\n    return {\n      type: this.get('type') || 'user',\n      entity: entity,\n      access: this.get('access')\n    };\n  }\n});\n","/**\n * A collection representing a set of users in a group.\n */\ncdb.admin.GroupUsers = Backbone.Collection.extend({\n\n  model: cdb.admin.User,\n\n  initialize: function(models, opts) {\n    if (!opts.group) throw new Error('group is required');\n    this.group = opts.group;\n  },\n\n  url: function() {\n    return this.group.url.apply(this.group, arguments) + '/users';\n  },\n\n  parse: function(response) {\n    this.total_entries = response.total_entries;\n    this.total_user_entries = response.total_user_entries;\n\n    return response.users;\n  },\n\n  /**\n   * Batch add users\n   * @param {Array} userIds\n   * @return {Object} a deferred jqXHR object\n   */\n  addInBatch: function(userIds) {\n    return this._batchAsyncProcessUsers('POST', userIds);\n  },\n\n  removeInBatch: function(userIds) {\n    var self = this;\n    return this._batchAsyncProcessUsers('DELETE', userIds)\n      .done(function() {\n        _.each(userIds, self.remove.bind(self));\n      });\n  },\n\n  _batchAsyncProcessUsers: function(method, ids) {\n    var self = this;\n\n    // postpone relving promise since the fetch is requries for collection to have accurate state\n    var deferred = $.Deferred();\n    $.ajax({\n      type: method,\n      url: cdb.config.prefixUrl() + this.url(),\n      data: {\n        users: ids\n      },\n      success: function() {\n        var args = arguments;\n\n        // because add/remove don't return any data, so need to fetch to get accurate state\n        self.fetch({\n          success: function() {\n            deferred.resolve.apply(deferred, args);\n          },\n          error: function() {\n            // could not update state, but resolve anyway since batch operation worked\n            // might have inconsistent state though\n            deferred.resolve.apply(deferred, args);\n          }\n        })\n      },\n      error: function() {\n        deferred.reject.apply(deferred, arguments);\n      }\n    });\n\n    return deferred;\n  },\n\n  // @return {Number, undefined} may be undefined until a first fetch is done\n  totalCount: function() {\n    return this.total_user_entries;\n  }\n\n});\n","/**\n * Model representing an entity (user, group, etc.) that may share a Visualization.\n * Actual model is wrapped with additional metadata for the grantable context.\n */\ncdb.admin.Grantable = cdb.core.Model.extend({\n\n  initialize: function() {\n    this.entity = this._createEntity();\n  },\n\n  // @return {Object} instance of the real model this grantable entitity represents\n  //   Keep in mind that this returns a new instance of that model (i.e. not a cache version)\n  _createEntity: function() {\n    var className = cdb.Utils.capitalize(this.get('type'));\n    var model = new cdb.admin[className](this.get('model'));\n    model.organization = this.collection.organization;\n    return model;\n  }\n\n});\n","/**\n * A collection of Grantable objects.\n */\ncdb.admin.Grantables = Backbone.Collection.extend({\n\n  model: cdb.admin.Grantable,\n\n  url: function(method) {\n    var version = cdb.config.urlVersion('organizationGrantables', method);\n    return '/api/' + version + '/organization/' + this.organization.id + '/grantables';\n  },\n\n  initialize: function(users, opts) {\n    if (!opts.organization) throw new Error('organization is required');\n    this.organization = opts.organization;\n    this.currentUserId = opts.currentUserId;\n    this.sync = Backbone.syncAbort; // adds abort behaviour\n  },\n\n  parse: function(response) {\n    this.total_entries = response.total_entries;\n\n    return _.reduce(response.grantables, function(memo, m) {\n      if (m.id === this.currentUserId) {\n        this.total_entries--;\n      } else {\n        memo.push(m);\n      }\n\n      return memo;\n    }, [], this);\n  },\n\n  // @return {Number, undefined} may be undefined until a first fetch is done\n  totalCount: function() {\n    return this.total_entries;\n  }\n\n});\n","/**\n * this model contains information about the organization for\n * the current user and the users who are inside the organizacion.\n *\n * Attributes:\n * - users: collection with user instances whithin the organization (see cdb.admin.Organization.Users\n */\ncdb.admin.Organization = cdb.core.Model.extend({\n\n  url: '/api/v1/org/',\n\n  initialize: function(attrs, opts) {\n    attrs = attrs || {}\n    this.owner = new cdb.admin.User(this.get('owner'));\n\n    this.display_email = (typeof attrs.admin_email != 'undefined') && attrs.admin_email != null && (attrs.admin_email == '' ? this.owner.email : attrs.admin_email);\n\n    var collectionOpts = {\n      organization: this,\n      currentUserId: opts && opts.currentUserId\n    };\n    this.users = new cdb.admin.Organization.Users(attrs.users, collectionOpts);\n    this.groups = new cdb.admin.OrganizationGroups(attrs.groups, collectionOpts);\n    this.grantables = new cdb.admin.Grantables(undefined, collectionOpts);\n\n    // make sure all the users/groups have a reference to this organization\n    this.users.each(this._setOrganizationOnModel, this);\n    this.groups.each(this._setOrganizationOnModel, this);\n  },\n\n  _setOrganizationOnModel: function(m) {\n    m.organization = this;\n  },\n\n  fetch: function() {\n    throw new Error(\"organization should not be fetch, should be static\");\n  },\n\n  containsUser: function(user) {\n    return !!this.users.find(function(u) {\n      return u.id === user.id;\n    })\n  },\n\n  isOrgAdmin: function (user) {\n    return this.owner.id === user.id || !!_.find(this.get('admins'), function (u) {\n      return u.id === user.id;\n    });\n  },\n\n  viewUrl: function() {\n    return new cdb.common.OrganizationUrl({\n      base_url: this.get('base_url')\n    })\n  }\n\n});\n\n// helper to manage organization users\ncdb.admin.Organization.Users = Backbone.Collection.extend({\n\n  model: cdb.admin.User,\n  _DEFAULT_EXCLUDE_CURRENT_USER: true,\n\n  url: function() {\n    return '/api/v1/organization/' + this.organization.id + '/users';\n  },\n\n  initialize: function(models, opts) {\n    if (!opts.organization) {\n      throw new Error('Organization is needed for fetching organization users');\n    }\n    this.elder('initialize');\n    this.organization = opts.organization;\n\n    this.currentUserId = opts.currentUserId;\n    this._excludeCurrentUser = this._DEFAULT_EXCLUDE_CURRENT_USER;\n\n    // Let's add abort behaviour\n    this.sync = Backbone.syncAbort;\n  },\n\n  comparator: function(mdl) {\n    return mdl.get('username');\n  },\n\n  excludeCurrentUser: function(exclude) {\n    exclude = !!exclude;\n    this._excludeCurrentUser = exclude;\n    if (exclude && !this.currentUserId) {\n      cdb.log.error('set excludeCurrentUser to true, but there is no current user id set to exclude!');\n    }\n  },\n\n  restoreExcludeCurrentUser: function() {\n    this.excludeCurrentUser(this._DEFAULT_EXCLUDE_CURRENT_USER);\n  },\n\n  parse: function(r) {\n    this.total_entries = r.total_entries;\n    this.total_user_entries = r.total_user_entries;\n\n    return _.reduce(r.users, function(memo, user) {\n      if (this._excludeCurrentUser && user.id === this.currentUserId) {\n        this.total_user_entries--;\n        this.total_entries--;\n      } else {\n        memo.push(user);\n      }\n      return memo;\n    }, [], this);\n  },\n\n  // @return {Number, undefined} may be undefined until a first fetch is done\n  totalCount: function() {\n    return this.total_user_entries;\n  }\n});\n\ncdb.admin.Organization.Invites = cdb.core.Model.extend({\n\n  defaults: {\n    users_emails: [],\n    welcome_text: 'I\\'d like to invite you to my CARTO organization,\\nBest regards'\n  },\n\n  url: function() {\n    return '/api/v1/organization/' + this.organizationId + '/invitations';\n  },\n\n  initialize: function(attrs, opts) {\n    if (!opts.organizationId) {\n      throw new Error('Organization id is needed for fetching organization users');\n    } else {\n      this.organizationId = opts.organizationId;\n    }\n  }\n\n});\n","cdb.admin.Like = cdb.core.Model.extend({\n\n  defaults: {\n    likeable: true\n  },\n\n  url: function(method) {\n    var version = cdb.config.urlVersion('like', method)\n    return '/api/' + version + '/viz/' + this.get(\"vis_id\") + '/like';\n  },\n\n  initialize: function() {\n\n    _.bindAll(this, \"_onSaveError\");\n\n    this.on(\"destroy\", function() {\n      this.set({ liked: false, likes: this.get(\"likes\") - 1 });\n    }, this);\n\n  },\n\n  _onSaveError: function(model, response) {\n    this.trigger(\"error\", {\n      status: response.status,\n      statusText: response.statusText\n    });\n  },\n\n  toggleLiked: function() {\n\n    if (this.get(\"liked\")) {\n      this.destroy();\n    } else {\n      this.set({ id: null }, { silent: true });\n      this.save({}, { error: this._onSaveError });\n    }\n  }\n\n}, {\n\n  newByVisData: function(opts) {\n    var d = _.defaults({\n      id: opts.liked ? opts.vis_id : null\n    }, _.omit(opts, 'url'));\n\n    var m = new cdb.admin.Like(d);\n\n    if (opts.url) {\n      m.url = opts.url;\n    }\n\n    return m;\n  }\n});\n","\n\n  /**\n   *  Synced table model\n   */\n\n  cdb.admin.TableSynchronization = cdb.core.Model.extend({\n\n    _X:         1.2,  // Multiply current interval for this number\n    _INTERVAL:  1500, // Interval time between poll checkings\n    _STATES:    ['created', 'failure', 'success', 'syncing', 'queued'],\n\n    defaults: {\n      name: '',\n      url: '',\n      state: '',\n      run_at: 0,\n      ran_at: 0,\n      retried_times: 0,\n      interval: 0,\n      error_code: 0,\n      error_message: '',\n      service_name: '',\n      service_item_id: '',\n      content_guessing: true,\n      type_guessing: true\n    },\n\n    url: function(method) {\n      var version = cdb.config.urlVersion('synchronization', method);\n\n      var base = '/api/' + version + '/synchronizations/';\n      if (this.isNew()) {\n        return base;\n      }\n      return base + this.id;\n    },\n\n    initialize: function() {\n      this.bind('destroy', function() {\n        this.unset('id');\n      });\n    },\n\n    toJSON: function() {\n      var c = _.clone(this.attributes);\n\n      var d = {\n        url:      c.url,\n        interval: c.interval,\n        content_guessing: c.content_guessing,\n        type_guessing: c.type_guessing,\n        create_vis: c.create_vis\n      };\n\n      if (c.type === \"remote\") {\n        _.extend(d, {\n          remote_visualization_id: c.remote_visualization_id,\n          create_vis: false,\n          value: c.value\n        });\n      }\n\n      if(c.id !== undefined) {\n        d.id = c.id;\n      }\n\n      // Comes from a service?\n      if(c.service_name) {\n        d.service_name = c.service_name;\n        d.service_item_id = c.service_item_id;\n      }\n\n      return d;\n    },\n\n    syncNow: function(callback) {\n      $.ajax({\n        url:  cdb.config.prefixUrl() + this.url() + '/sync_now',\n        type: 'PUT'\n      }).always(callback)\n    },\n\n    // Checks for poll to finish\n    pollCheck: function(i) {\n      var self = this;\n      var interval = this._INTERVAL;\n\n      this.pollTimer = setInterval(request , interval);\n\n      function request() {\n        self.destroyCheck();\n\n        self.fetch({\n          error: function(m, e) {\n            self.set({\n              error_message:  e.statusText || \"\",\n              state:          'failure'\n            });\n          }\n        });\n\n        interval = interval * self._X;\n\n        self.pollTimer = setInterval(request, interval);\n      }\n    },\n\n    destroyCheck: function() {\n      clearInterval(this.pollTimer);\n    },\n\n    isSync: function() {\n      return !this.isNew();\n    },\n\n    linkToTable: function(table) {\n      var self = this;\n      if (table.has('synchronization')) {\n        this.set(table.get('synchronization'));\n      }\n\n      table.bind('change:synchronization', function() {\n        self.set(table.get('synchronization'));\n      }, table);\n\n      table.bind('destroy', function destroy() {\n        self.unbind(null, null, table);\n        self.destroy();\n      }, table);\n      //TODO: manage table renaming\n    }\n\n  });\n","\ncdb.admin.WKT = {\n  types: [\n    'POINT',\n    'LINESTRING',\n    'POLYGON',\n    'MULTIPOINT',\n    'MULTILINESTRING',\n    'MULTIPOLYGON'\n  ]\n};\n","\n/*\n * this model is created to manage the visualization order. In order to simplify API\n * the order is changed using a double linked list instead of a order attribute.\n */\ncdb.admin.VisualizationOrder = cdb.core.Model.extend({\n\n  url: function(method) {\n    return this.visualization.url(method) + \"/next_id\"\n  },\n\n  initialize: function () {\n    this.visualization = this.get('visualization');\n    //set id so PUT is used\n    this.set('id', this.visualization.id);\n    this.unset('visualization');\n  }\n});\n\ncdb.admin.Visualization = cdb.core.Model.extend({\n\n  defaults: {\n    bindMap: true\n  },\n\n  url: function(method) {\n    var version = cdb.config.urlVersion('visualization', method);\n    var base = '/api/' + version + '/viz';\n    if (this.isNew()) {\n      return base;\n    }\n    return base + '/' + this.id;\n  },\n\n  INHERIT_TABLE_ATTRIBUTES: [\n    'name', 'description', 'privacy'\n  ],\n\n  initialize: function() {\n    this.map = new cdb.admin.Map();\n\n    this.permission = new cdb.admin.Permission(this.get('permission'));\n    this.overlays = new cdb.admin.Overlays([]);\n    this.overlays.vis = this;\n\n    this.initSlides();\n    this.bind('change:type', this.initSlides);\n\n    this.transition = new cdb.admin.SlideTransition(this.get('transition_options'), { parse: true });\n    this.order = new cdb.admin.VisualizationOrder({ visualization: this });\n\n    this.like = cdb.admin.Like.newByVisData({\n      vis_id: this.id,\n      liked: this.get(\"liked\"),\n      likes: this.get(\"likes\")\n    });\n\n    // Check if there are related tables and generate the collection\n    if (this.get('type') === \"derived\" && this.get('related_tables')) this.generateRelatedTables();\n\n    // Check if there are dependant visualizations and generate the collection //\n    // TODO //\n\n    if (this.get('bindMap')) this._bindMap();\n    this.on(_(this.INHERIT_TABLE_ATTRIBUTES).map(function(t) { return 'change:' + t }).join(' '),  this._changeAttributes, this);\n\n    this._initBinds();\n  },\n\n  initSlides: function() {\n    if (this.slides) return this;\n    // slides only for derived visualizations\n    // and working with map enabled\n    if (this.get('type') === 'derived' && this.get('bindMap')) {\n      this.slides = new cdb.admin.Slides(this.get('children'), { visualization: this });\n      this.slides.initializeModels();\n    } else {\n      this.slides = new cdb.admin.Slides([], { visualization: this });\n    }\n    return this;\n  },\n\n  activeSlide: function(c) {\n    if (c >= 0 && c < this.slides.length) {\n      this.slides.setActive(this.slides.at(c));\n    }\n    return this;\n  },\n\n  // set master visualization. Master manages id, name and description changes\n  setMaster: function(master_vis) {\n\n    var self = this;\n\n    master_vis.bind('change:id', function() {\n      self.changeTo(master_vis);\n      self.slides.master_visualization_id = master_vis.id;\n    }, this);\n\n    master_vis.bind('change', function() {\n      var c = master_vis.changedAttributes();\n      if (c.type) self.set('type', master_vis.get('type'));\n      self.set('description', master_vis.get('description'));\n      if (c.name) self.set('name', master_vis.get('name'));\n      if (c.privacy) self.set('privacy', master_vis.get('privacy'));\n    });\n\n  },\n\n  enableOverlays: function() {\n    this.bind('change:id', this._fetchOverlays, this);\n    if (!this.isNew()) this._fetchOverlays();\n  },\n\n  _fetchOverlays: function() {\n    this.overlays.fetch({ reset: true });\n  },\n\n  _initBinds: function() {\n    this.permission.acl.bind('reset', function() {\n      // Sync the local permission object w/ the raw data, so vis.save don't accidentally overwrites permissions changes\n      this.set('permission', this.permission.attributes, { silent: true });\n      this.trigger('change:permission', this);\n    }, this);\n\n    // Keep permission model in sync, e.g. on vis.save\n    this.bind('change:permission', function() {\n      this.permission.set(this.get('permission'));\n    }, this);\n  },\n\n  isLoaded: function() {\n    return this.has('privacy') && this.has('type');\n  },\n\n\n  generateRelatedTables: function(callback) {\n    var tables = this.get('related_tables');\n\n    if (tables.length) {\n      var collection = new Backbone.Collection([]);\n\n      for (var i = 0, l = tables.length; i < l; i++) {\n        var table = new cdb.admin.CartoDBTableMetadata(tables[i]);\n        collection.add(table);\n      }\n\n      this.related_tables = collection;\n      callback && callback.success && callback.success();\n    }\n  },\n\n  getRelatedTables: function(callback, options) {\n    options = options || {};\n    if (this.get('type') === \"derived\") {\n\n      if (!options.force && this.get('related_tables')) {\n        this.generateRelatedTables(callback);\n        return;\n      }\n\n      var self = this;\n      this.fetch({\n        success: function() {\n          self.generateRelatedTables(callback);\n        },\n        error: callback && callback.error && callback.error\n      });\n    }\n  },\n\n  /**\n   * Get table metadata related to this vis.\n   * Note that you might need to do a {metadata.fetch()} to get full data.\n   *\n   * @returns {cdb.admin.CartoDBTableMetadata} if this vis represents a table\n   * TODO: when and when isn't it required to do a fetch really?\n   */\n  tableMetadata: function() {\n    if (!this._metadata) {\n      this._metadata = new cdb.admin.CartoDBTableMetadata(this.get('table'));\n    }\n    return this._metadata;\n  },\n\n  _bindMap: function() {\n\n    this.on('change:map_id', this._fetchMap, this);\n\n    this.map.bind('change:id', function() {\n      this.set('map_id', this.map.id);\n    }, this);\n\n    this.map.set('id', this.get('map_id'));\n\n    // when the layers change we should reload related_tables\n    this.map.layers.bind('change:id remove', function() {\n      this.getRelatedTables(null, {\n        force: true\n      });\n    }, this);\n\n  },\n\n  /**\n   *  Is this model a true visualization?\n   */\n  isVisualization: function() {\n    return this.get('type') === \"derived\" || this.get('type') === 'slide';\n  },\n\n  /**\n   *  Change current visualization by new one without\n   *  creating a new instance.\n   *\n   *  When turn table visualization to derived visualization,\n   *  it needs to wait until reset layers. If not, adding a new\n   *  layer after create the new visualization won't work...\n   *\n   */\n  changeTo: function(new_vis, callbacks) {\n    this.set(new_vis.attributes, { silent: true });\n\n    this.transition.set(new_vis.transition.attributes);\n\n    var success = function() {\n      this.map.layers.unbind('reset', success);\n      this.map.layers.unbind('error', error);\n      callbacks && callbacks.success && callbacks.success(this);\n    };\n\n    var error = function() {\n      this.map.layers.unbind('reset', success);\n      this.map.layers.unbind('error', error);\n      callbacks && callbacks.error && callbacks.error();\n    }\n\n    this.map.layers.bind('reset', success, this);\n    this.map.layers.bind('error', error, this)\n    this.permission.set(new_vis.permission.attributes);\n    this.set({ map_id: new_vis.get('map_id') });\n\n    // Get related tables from the new visualization\n    this.getRelatedTables();\n  },\n\n  /**\n   *  Transform a table visualization/model to a original visualization\n   */\n  changeToVisualization: function(callback) {\n    var self = this;\n    if (!this.isVisualization()) {\n      var callbacks = {\n        success: function(new_vis) {\n          self.changeTo(new_vis, callback);\n          self.notice('', '', 1000);\n        },\n        error: function(e) {\n          var msg = 'error changing to visualization';\n          self.error(msg, e);\n          callback && callback.error(e, msg);\n        }\n      };\n      // Name is not saved in the back end, due to that\n      // we need to pass it as parameter\n      this.copy({ name: this.get('name'), description: this.get('description') }, callbacks);\n    } else {\n      self.notice('', '', 1000);\n    }\n    return this;\n  },\n\n  parse: function(data) {\n    if (this.transition && data.transition_options) {\n      this.transition.set(this.transition.parse(data.transition_options));\n    }\n\n    if (this.like) {\n      this.like.set({ vis_id: this.id, likes: this.get(\"likes\"), liked: this.get(\"liked\") })\n    }\n\n    return data;\n  },\n\n  toJSON: function() {\n    var attr = _.clone(this.attributes);\n    delete attr.bindMap;\n    delete attr.stats;\n    delete attr.related_tables;\n    delete attr.children;\n    attr.map_id = this.map.id;\n    attr.transition_options = this.transition.toJSON();\n    return attr;\n  },\n\n  /**\n   *  Create a child (slide) from current visualization. It clones layers but no overlays\n   */\n  createChild: function(attrs, options) {\n    attrs = attrs || {};\n    options = options || {};\n    var vis = new cdb.admin.Visualization(\n      _.extend({\n          copy_overlays: false,\n          type: 'slide',\n          parent_id: this.id\n        },\n        attrs\n      )\n    );\n    vis.save(null, options);\n    return vis;\n  },\n\n  /**\n   *  Create a copy of the visualization model\n   */\n  copy: function(attrs, options) {\n    attrs = attrs || {};\n    options = options || {};\n    var vis = new cdb.admin.Visualization(\n      _.extend({\n          source_visualization_id: this.id\n        },\n        attrs\n      )\n    );\n    vis.save(null, options);\n    return vis;\n  },\n\n  /**\n   *  Fetch map information\n   */\n  _fetchMap: function() {\n    this.map\n      .set('id', this.get('map_id'))\n      .fetch();\n  },\n\n  /**\n   *  Generic function to catch up new attribute changes\n   */\n  _changeAttributes: function(m, c) {\n    if (!this.isVisualization()) {\n\n      // Change table attribute if layer is CartoDB-layer\n      var self = this;\n\n      this.map.layers.each(function(layer) {\n        if (layer.get('type').toLowerCase() == \"cartodb\") {\n\n          // If there isn't any changed attribute\n          if (!self.changedAttributes()) { return false; }\n\n          var attrs = _.pick(self.changedAttributes(), self.INHERIT_TABLE_ATTRIBUTES);\n\n          if (attrs) layer.fetch();\n        }\n      })\n    }\n  },\n\n\n  // PUBLIC FUNCTIONS\n\n  publicURL: function() {\n    var url = this.permission.owner.viewUrl();\n    return url + \"/viz/\" + this.get('id') + \"/public_map\";\n  },\n\n  deepInsightsUrl: function(user) {\n    var url = user.viewUrl();\n    return url + \"/bivisualizations/\" + this.get('id') + \"/embed_map\";\n  },\n\n  embedURL: function() {\n    var url = this.permission.owner.viewUrl();\n    return url + \"/viz/\" + this.get('id') + \"/embed_map\";\n  },\n\n  vizjsonURL: function() {\n    var url = this.permission.owner.viewUrl();\n    var version = cdb.config.urlVersion('vizjson', 'read', 'v2');\n    return url + '/api/' + version + '/viz/' + this.get('id') + \"/viz.json\";\n  },\n\n  notice: function(msg, type, timeout) {\n    this.trigger('notice', msg, type, timeout);\n  },\n\n  error: function(msg, resp) {\n    this.trigger('notice', msg, 'error');\n  },\n\n  // return: Array of entities (user or organizations) this vis is shared with\n  sharedWithEntities: function() {\n    return _.map((this.permission.acl.toArray() || []), function(aclItem) {\n      return aclItem.get('entity')\n    });\n  },\n\n  privacyOptions: function() {\n    if (this.isVisualization()) {\n      return cdb.admin.Visualization.ALL_PRIVACY_OPTIONS;\n    } else {\n      return _.reject(cdb.admin.Visualization.ALL_PRIVACY_OPTIONS, function(option) {\n        return option === 'PASSWORD';\n      });\n    }\n  },\n\n  isOwnedByUser: function(user) {\n    return user.equals(this.permission.owner);\n  },\n\n  /**\n   * Get the URL for current instance.\n   * @param {Object} currentUser (Optional) Get the URL from the perspective of the current user, necessary to\n   *   correctly setup URLs to tables.\n   * @return {Object} instance of cdb.common.Url\n   */\n  viewUrl: function(currentUser) {\n    var owner = this.permission.owner;\n    var userUrl = this.permission.owner.viewUrl();\n\n    // the undefined check is required for backward compability, in some cases (e.g. dependant visualizations) the type\n    // is not available on the attrs, if so assume the old behavior (e.g. it's a visualization/derived/map).\n    if (this.isVisualization() || _.isUndefined(this.get('type'))) {\n      var id = this.get('id')\n      if (currentUser && currentUser.id !== owner.id && this.permission.hasAccess(currentUser)) {\n        userUrl = currentUser.viewUrl();\n        id = owner.get('username') + '.' + id;\n      }\n      return new cdb.common.MapUrl({\n        base_url: userUrl.urlToPath('viz', id)\n      });\n    } else {\n      if (currentUser && this.permission.hasAccess(currentUser)) {\n        userUrl = currentUser.viewUrl();\n      }\n      return new cdb.common.DatasetUrl({\n        base_url: userUrl.urlToPath('tables', this.tableMetadata().getUnquotedName())\n      });\n    }\n   },\n\n  /**\n   * Returns the URL, server-side generated\n   */\n  _canonicalViewUrl: function() {\n    var isMap = this.isVisualization() || _.isUndefined(this.get('type'));\n    var UrlModel = isMap ? cdb.common.MapUrl : cdb.common.DatasetUrl;\n    return new UrlModel({\n      base_url: this.get('url')\n    });\n  }\n\n}, {\n\n  ALL_PRIVACY_OPTIONS: [ 'PUBLIC', 'LINK', 'PRIVATE', 'PASSWORD' ]\n\n});\n\n\n\n\n\n/**\n * Visualizations endpoint available for a given user.\n *\n * Usage:\n *\n *   var visualizations = new cdb.admin.Visualizations()\n *   visualizations.fetch();\n *\n */\n\ncdb.admin.Visualizations = Backbone.Collection.extend({\n\n  model: cdb.admin.Visualization,\n\n  _PREVIEW_TABLES_PER_PAGE: 10,\n  _TABLES_PER_PAGE: 20,\n  _PREVIEW_ITEMS_PER_PAGE: 3,\n  _ITEMS_PER_PAGE: 9,\n\n  initialize: function() {\n\n    var default_options = new cdb.core.Model({\n      tag_name        : \"\",\n      q               : \"\",\n      page            : 1,\n      type            : \"derived\",\n      exclude_shared  : false,\n      per_page        : this._ITEMS_PER_PAGE\n    });\n\n    // Overrriding default sync, preventing\n    // run several request at the same time\n    this.sync = Backbone.syncAbort;\n    this.options = _.extend(default_options, this.options);\n\n    this.total_entries = 0;\n\n    this.options.bind(\"change\", this._changeOptions, this);\n    this.bind(\"reset\",          this._checkPage, this);\n    this.bind(\"update\",         this._checkPage, this);\n    this.bind(\"add\",            this._fetchAgain, this);\n\n  },\n\n  getTotalPages: function() {\n    return Math.ceil(this.total_entries / this.options.get(\"per_page\"));\n  },\n\n  _checkPage: function() {\n    var total = this.getTotalPages();\n    var page = this.options.get('page') - 1;\n\n    if (this.options.get(\"page\") > total ) {\n      this.options.set({ page: total + 1});\n    } else if (this.options.get(\"page\") < 1) {\n      this.options.set({ page: 1});\n    }\n\n  },\n\n  _createUrlOptions: function() {\n    return _.compact(_(this.options.attributes).map(\n      function(v, k) {\n        return k + \"=\" + encodeURIComponent(v)\n      }\n    )).join('&');\n  },\n\n  url: function(method) {\n    var u = '';\n\n    // TODO: remove this workaround when bi-visualizations are included as\n    // standard visualizations\n    if (this.options.get('deepInsights')) {\n      u += '/api/v1/bivisualizations';\n      u += '?page=' + this.options.get('page') + '&per_page=' + this.options.get(\"per_page\");\n    } else {\n      var version = cdb.config.urlVersion('visualizations', method);\n      u += '/api/' + version + '/viz/';\n      u += \"?\" + this._createUrlOptions();\n    }\n\n    return u;\n  },\n\n  remove: function(options) {\n    this.total_entries--;\n    this.elder('remove', options);\n  },\n\n  // add bindMap: false for all the visulizations\n  // vis model does not need map information in dashboard\n  parse: function(response) {\n    this.total_entries = response.total_entries;\n    this.slides && this.slides.reset(response.children);\n    this.total_shared = response.total_shared;\n    this.total_likes = response.total_likes;\n    this.total_user_entries = response.total_user_entries;\n    return _.map(response.visualizations, function(v) {\n      v.bindMap = false;\n      return v;\n    });\n  },\n\n  _changeOptions: function() {\n    // this.trigger('updating');\n\n    // var self = this;\n    // $.when(this.fetch()).done(function(){\n    //   self.trigger('forceReload')\n    // });\n  },\n\n  create: function(m) {\n    var dfd = $.Deferred();\n    Backbone.Collection.prototype.create.call(this,\n      m,\n      {\n        wait: true,\n        success: function() {\n          dfd.resolve();\n\n        },\n        error: function() {\n          dfd.reject();\n        }\n      }\n    );\n    return dfd.promise();\n  },\n\n\n  fetch: function(opts) {\n    var dfd = $.Deferred();\n    var self = this;\n    this.trigger(\"loading\", this);\n\n    $.when(Backbone.Collection.prototype.fetch.call(this,opts))\n    .done(function(res) {\n      self.trigger('loaded');\n      dfd.resolve();\n    }).fail(function(res) {\n      self.trigger('loadFailed');\n      dfd.reject(res);\n    });\n\n    return dfd.promise();\n  }\n});\n","/**\n * tabbed pane.\n * if contains n views inside it and shows only one at once\n *\n * usage:\n *\n * var pane = new cdb.ui.common.TabPane({\n *   el: $(\"#container\")\n * });\n *\n * pane.addTab('tab1', new OtherView());\n * pane.addTab('tab2', new OtherView2());\n * pane.addTab('tab3', new OtherView3());\n *\n * pane.active('tab1');\n *\n * pane.bind('tabEnabled', function(tabName, tabView) {\n * pane.bind('tabDisabled', function(tabName, tabView) {\n * });\n */\ncdb.ui.common.TabPane = cdb.core.View.extend({\n\n  initialize: function() {\n      this.tabs = {};\n      this.activeTab  = null;\n      this.activePane = null;\n  },\n\n  addTab: function(name, view, options) {\n    options = options || { active: true };\n    if(this.tabs[name] !== undefined) {\n      cdb.log.debug(name + \"already added\");\n    } else {\n      this.tabs[name] = view.cid;\n      this.addView(view);\n      if(options.after !== undefined) {\n        var e = this.$el.children()[options.after];\n        view.$el.insertAfter(e);\n      } else if(options.prepend) {\n        this.$el.prepend(view.el);\n      } else {\n        this.$el.append(view.el);\n      }\n      this.trigger('tabAdded', name, view);\n      if(options.active) {\n        this.active(name);\n      } else {\n        view.hide();\n      }\n    }\n  },\n\n  getPreviousPane: function() {\n    var tabs  = _.toArray(this.tabs);\n    var panes = _.toArray(this._subviews);\n\n    var i = _.indexOf(tabs, this.activePane.cid) - 1;\n    if (i < 0) i = panes.length - 1;\n\n    return panes[i];\n  },\n\n  getNextPane: function() {\n    var tabs  = _.toArray(this.tabs);\n    var panes = _.toArray(this._subviews);\n\n    var i = 1 + _.indexOf(tabs, this.activePane.cid);\n    if (i > panes.length - 1) i = 0;\n\n    return panes[i];\n  },\n\n  getPane: function(name) {\n    var vid = this.tabs[name];\n    return this._subviews[vid];\n  },\n\n  getActivePane: function() {\n    return this.activePane;\n  },\n\n  size: function() {\n    return _.size(this.tabs);\n  },\n\n  clean: function() {\n    this.removeTabs();\n    cdb.core.View.prototype.clean.call(this)\n  },\n\n  removeTab: function(name) {\n    if (this.tabs[name] !== undefined) {\n      var vid = this.tabs[name];\n      this._subviews[vid].clean();\n      delete this.tabs[name];\n\n      if (this.activeTab == name) {\n        this.activeTab = null;\n      }\n\n      if (_.size(this.tabs)) {\n        this.active(_.keys(this.tabs)[0]);\n      }\n    }\n  },\n\n  removeTabs: function() {\n    for(var name in this.tabs) {\n      var vid = this.tabs[name];\n      this._subviews[vid].clean();\n      delete this.tabs[name];\n    }\n    this.activeTab = null;\n  },\n\n  active: function(name) {\n    var\n    self = this,\n    vid  = this.tabs[name];\n\n    if (vid !== undefined) {\n\n      if (this.activeTab !== name) {\n\n        var v = this._subviews[vid];\n\n        if (this.activeTab) {\n          var vid_old  = this._subviews[this.tabs[this.activeTab]];\n\n          vid_old.hide();\n          self.trigger('tabDisabled', this.activeTab , vid_old);\n          self.trigger('tabDisabled:' + this.activeTab,  vid_old);\n          if(vid_old.deactivated) {\n            vid_old.deactivated();\n          }\n        }\n\n        v.show();\n        if(v.activated) {\n          v.activated();\n        }\n\n        this.activeTab = name;\n        this.activePane = v;\n\n        self.trigger('tabEnabled', name, v);\n        self.trigger('tabEnabled:' + name,  v);\n      }\n\n      return this.activePane;\n    }\n  },\n\n  render: function() {\n      return this;\n  },\n\n  each: function(fn) {\n    var self = this;\n    _.each(this.tabs, function(cid, tab) {\n      fn(tab, self.getPane(tab));\n    });\n  }\n\n});\n","\n\n  /**\n   * User options dropdown (extends Dropdown)\n   *\n   * It shows the content in a dropdown (or dropup) with a special effect.\n   *\n   * Usage example:\n   *\n      var user_menu = new cdb.admin.DropdownMenu({\n        target: $('a.account'),\n        model: {username: username}, // No necessary indeed\n        template_base: 'common/views/settings_item'\n      });\n   *\n   */\n\n\n  cdb.admin.DropdownMenu = cdb.ui.common.Dropdown.extend({\n\n    show: function() {\n      var dfd = $.Deferred();\n      var self = this;\n      //sometimes this dialog is child of a node that is removed\n      //for that reason we link again DOM events just in case\n      this.delegateEvents();\n      this.$el\n        .css({\n          marginTop: self.options.vertical_position == \"down\" ? \"-10px\" : \"10px\",\n          opacity:0,\n          display:\"block\"\n        })\n        .animate({\n          margin: \"0\",\n          opacity: 1\n        }, {\n          \"duration\": this.options.speedIn,\n          \"complete\": function(){\n            dfd.resolve();\n          }\n        });\n      this.trigger(\"onDropdownShown\",this.el);\n\n      return dfd.promise();\n    },\n\n    /**\n     * open the dialog at x, y\n     */\n    openAt: function(x, y) {\n      var dfd = $.Deferred();\n\n      this.$el.css({\n        top: y,\n        left: x,\n        width: this.options.width\n      })\n      .addClass(\n        (this.options.vertical_position == \"up\" ? \"vertical_top\" : \"vertical_bottom\" )\n        + \" \" +\n        (this.options.horizontal_position == \"right\" ? \"horizontal_right\" : \"horizontal_left\" )\n        + \" \" +\n        // Add tick class\n        \"tick_\" + this.options.tick\n      )\n\n      this.isOpen = true;\n\n      // Show\n      $.when(this.show()).done(function(){ dfd.resolve();})\n      // xabel: I've add the deferred to make it easily testable\n\n      return dfd.promise();\n    },\n\n\n    hide: function(done) {\n\n      // don't attempt to hide the dropdown if it's already hidden\n      if (!this.isOpen) { done && done(); return; }\n\n      var self    = this;\n      this.isOpen = false;\n\n      this.$el.animate({\n\n        marginTop: self.options.vertical_position == \"down\" ? \"10px\" : \"-10px\",\n        opacity: 0\n\n      }, this.options.speedOut, function(){\n\n        // Remove selected class\n        $(self.options.target).removeClass(\"selected\");\n\n        // And hide it\n        self.$el.hide();\n        done && done();\n\n        self.trigger(\"onDropdownHidden\", self.el);\n\n      });\n    }\n  });\n","\n  /**\n   *  String field -> Place to edit and capture string editions\n   *  - It accepts a model with {attribute: 'colum', value: 'jamón'}\n   *  var string = new cdb.admin.StringField({ model: model })\n   */\n\n  cdb.admin.StringField = cdb.core.View.extend({\n\n    tagName: 'div',\n    className: 'field string',\n\n    default_options: {\n      template_name:  'old_common/views/forms/string_field',\n      label:          false,\n      autoResize:     true,\n      readOnly:       false\n    },\n\n    events: {\n      'change textarea':    '_onChange',\n      'keydown textarea':  '_onKeyDown'\n    },\n\n    initialize: function() {\n      _.defaults(this.options, this.default_options);\n\n      _.bindAll(this, '_onChange', '_onKeyDown');\n\n      this.template_base = this.options.template_base ? _.template(this.options.template_base) : cdb.templates.getTemplate(this.options.template_name);\n\n      // Setting valid value from the beginning\n      this.valid = true;\n\n      // Get Operating System\n      this._setOS();\n    },\n\n    render: function() {\n      this.$el.html(this.template_base(_.extend(this.model.toJSON(), this.options)));\n\n      if (this.options.readOnly) {\n        this.undelegateEvents();\n      }\n\n      // Hack to resize correctly the textarea\n      if (this.options.autoResize)\n        this._resize();\n\n      return this;\n    },\n\n    _setOS: function() {\n      // Check if the SO is Mac or rest in order to use Ctrl or CMD + ENTER to save the value\n      var ua = navigator.userAgent.toLowerCase();\n\n      this.so = \"rest\";\n      if (/mac os/.test(ua)) {\n        this.so = \"mac\";\n      }\n    },\n\n    // Public function to answer if the editor is valid or not\n    isValid: function() {\n      return this.valid;\n    },\n\n    _onChange: function(e) {\n      var value = $(e.target).val();\n      this.model.set('value', value);\n    },\n\n    _onKeyDown: function(e) {\n      if (((this.so==\"mac\" && e.metaKey) || (this.so==\"rest\" && e.ctrlKey)) && e.keyCode == 13 ) {\n        e.preventDefault();\n        this._triggerEvent('ENTER');\n        return false;\n      }\n\n      var value = $(e.target).val();\n\n      this.model.set('value', value);\n\n      if (this.options.autoResize)\n        this._resize();\n    },\n\n    // Hack function to resize automatially textarea\n    _resize: function() {\n      var $textarea = this.$(\"textarea\");\n\n      // Hello hacky boy\n      if ($textarea)\n        setTimeout(function() {\n          $textarea.height(20);\n          $textarea.height($textarea[0].scrollHeight - 22);\n        });\n    },\n\n    _triggerEvent: function(eventName, values) {\n      this.trigger(eventName, values, this);\n    }\n  })\n","\n/**\n *  Color form view\n *\n *  - It is used in 'Marker fill', 'Polygon fill',...\n *\n */\n\ncdb.forms.Color = cdb.core.View.extend({\n  className: 'form-view form_color',\n\n  events: {\n    'click .image-picker' : '_openImagePicker',\n    'click .color-picker' : '_openColorPicker'\n  },\n\n  initialize: function() {\n    this.template = cdb.templates.getTemplate('old_common/views/color_form');\n    this.property = this.options.property;\n    this.model.bind('change', this.render, this);\n    this.image_property = this.options.extra ? this.options.extra.image_property: null;\n    this.image_kind = this.options.extra ? this.options.extra.image_kind: null;\n    this.image_kind = this.image_kind || 'marker';\n  },\n\n  render: function() {\n    this.$el.html(\n      this.template({\n        image_kind:     this.image_kind,\n        image_property: this.image_property,\n        image_value:    this.model.get(this.image_property),\n        color:          this.model.get(this.property)\n      })\n    );\n\n    if (this.image_property)\n      this._createTooltips();\n\n    return this;\n  },\n\n  _createTooltips: function() {\n    this.addView(new cdb.common.TipsyTooltip({\n      el: this.$(\".image-picker\"),\n      delayIn:  100\n    }));\n  },\n\n  _createPicker: function() {\n\n    var tick, vertical_position, horizontal_position;\n\n    if (this.options.extra) {\n\n      if (this.options.extra.tick) {\n        tick   = this.options.extra.tick;\n      }\n\n      if (this.options.extra.picker_vertical_position) {\n        vertical_position   = this.options.extra.picker_vertical_position;\n      }\n\n      if (this.options.extra.picker_horizontal_position) {\n        horizontal_position = this.options.extra.picker_horizontal_position;\n      }\n    }\n\n    this.color_picker = new cdb.admin.ColorPicker({\n\n      target: this.$el,\n      colors: this.options.colors,\n      extra_colors: this.options.extra_colors,\n      tick: tick,\n      vertical_position: vertical_position,\n      horizontal_position: horizontal_position\n\n    }).bind(\"colorChosen\", function(color, close) {\n\n      if (this.image_property == this.property) {\n        this.model.set(this.property, color);\n      } else {\n        this.model.unset(this.image_property, { silent: true });\n        this.model.set(this.property, color);\n      }\n\n      if (close) this._destroyPicker();\n\n    }, this);\n\n    this._bindColorPicker();\n    this.addView(this.color_picker);\n  },\n\n  _destroyPicker: function() {\n    if (this.color_picker) {\n      this._unbindColorPicker();\n      this.removeView(this.color_picker);\n      this.color_picker.hide();\n      delete this.color_picker;\n    }\n  },\n\n  _bindColorPicker: function() {\n    cdb.god.bind(\"closeDialogs\",        this._destroyPicker, this);\n    cdb.god.bind(\"closeDialogs:color\",  this._destroyPicker, this);\n  },\n\n  _unbindColorPicker: function() {\n    cdb.god.unbind(\"closeDialogs\",        this._destroyPicker, this);\n    cdb.god.unbind(\"closeDialogs:color\",  this._destroyPicker, this);\n  },\n\n  setExtraColors: function(colors) {\n    if (this.color_picker)\n      this.color_picker.setColors('extra_colors', colors);\n  },\n  setColors: function(colors) {\n    if (this.color_picker)\n      this.color_picker.setColors('colors', colors);\n  },\n\n  _openImagePicker: function(e) {\n    this.killEvent(e);\n\n    if (!this.image_property) return this;\n\n    cdb.god.trigger(\"closeDialogs:color\");\n\n    this.user = new cdb.admin.User(window.user_data);\n\n    var dialog = new cdb.editor.ImagePickerView({\n      user: this.user,\n      kind: this.image_kind\n    });\n    dialog.appendToBody();\n    dialog.bind('fileChosen', this._onImageFileChosen, this);\n  },\n\n  _onImageFileChosen: function(url) {\n    if (this.image_property) {\n      if (this.image_property !== this.property) {\n        this.model.unset(this.property, { silent: true });\n      }\n      this.model.set(this.image_property, 'url(' + url + ')');\n    }\n  },\n\n  _openColorPicker: function(e) {\n    this.killEvent(e);\n\n    if (this.color_picker) this._destroyPicker();\n\n    cdb.god.trigger(\"closeDialogs:color\");\n\n    if (!this.color_picker) {\n      this._createPicker();\n      $('body').append(this.color_picker.render().el);\n      this.color_picker.init(this.model.get(this.property));\n    }\n  }\n\n});\n\n\n/**\n *  Color widget with color picker showing\n *  all colors applied in the style.\n */\ncdb.forms.ColorWizard = cdb.forms.Color.extend({\n\n  _createPicker: function() {\n    // Get wizard applied colors\n    if (this.model.layer && this.model.layer.get('tile_style')) {\n      var style = this.model.layer.get(\"tile_style\");\n      var cartoParser = new cdb.admin.CartoParser(style);\n      this.options.extra_colors = cartoParser.colorsUsed({ mode: \"hex\" });\n    }\n\n    cdb.forms.Color.prototype._createPicker.call(this);\n  },\n\n});\n\n\n/**\n * dummy view for hidden fields\n */\ncdb.forms.Hidden = cdb.core.View.extend({\n  className: 'form-view form_hidden',\n  initialize: function() {\n    this.add_related_model(this.model);\n  }\n});\n\n\ncdb.forms.SimpleNumber = cdb.core.View.extend({\n\n  className: 'form-view form_spinner',\n\n  defaults: {\n    max: 999999999999,\n    min: -999999999999,\n    inc: 1,\n    width: 25,\n    pattern: /^-?[0-9]+\\.?[0-9]*$/,\n    debounce_time: 200,\n    disable_triggering: false\n  },\n\n  events: {\n    'click .plus': '_plus',\n    'click .minus': '_minus',\n    'keypress input.value': '_checkInputPress',\n    'keydown input.value': '_checkInputPress',\n    'keyup input.value': '_checkInputUp',\n    'change .value': '_checkValueChange',\n    'click': '_showSlider'\n  },\n\n  initialize: function() {\n    _.bindAll(this, '_fireChange', '_checkNumber');\n    this.property = this.options.property;\n    this.model.bind('change', this.render, this);\n\n    // Check pattern, if it is empty or not valid,\n    // delete the option before extending defaults\n    if (!this.options.pattern ||\n        typeof this.options.pattern !== \"object\" ||\n        (typeof this.options.pattern === \"object\" && !this.options.pattern.test)\n      )\n    {\n      delete this.options.pattern;\n    }\n\n    _.defaults(this.options, this.defaults);\n\n    // Create slider\n    if(!this.options.noSlider) {\n      this._initSlider();\n    }\n\n    if(this.options.debounce_time > 0) {\n      this._fireChange = _.debounce(this._fireChange, this.options.debounce_time);\n    }\n  },\n\n  render: function(prop) {\n    var value = this.options.initValue || this.model.get(this.property);\n\n    if (prop && _.isNumber(prop)) {\n      value = prop;\n    }\n\n    this.$el.html('<input class=\"value\" ' + (this.options.disabled ? 'readonly' : '') + ' value=\"\" style=\"width:' + (this.options.width) + 'px!important\"/><a href=\"#\" class=\"plus\">+</a><a href=\"#\" class=\"minus\">-</a>');\n    this.$('.value').val(value);\n\n    if (this.options.classes) this.$el.addClass(this.options.classes);\n\n    if (this.options.disabled) {\n      this.undelegateEvents();\n      this.$el\n      .addClass('disabled')\n      .find('a').bind('click', this.killEvent);\n    }\n\n    return this;\n  },\n\n  _fireChange: function() {\n    this.model.change();\n  },\n\n  _changeValue: function(a) {\n    this.model.set(a, { silent: true });\n    this._fireChange();\n  },\n\n  inc: function(c) {\n    var a = {};\n    var v = a[this.property] = parseFloat(this.model.get(this.property)) + c;\n    v = a[this.property] = Math.min(this.options.max, v.toFixed? v.toFixed(1): 1*v);\n    a[this.property] = Math.max(this.options.min, v);\n    this._changeValue(a);\n    // don't wait to be notified by model, render as fast as the user changes the value\n    this.render(a[this.property]);\n  },\n\n  _plus: function(e) {\n    e && e.preventDefault();\n    this.trigger(\"saved\", this);\n    this.inc(this.options.inc);\n    return false;\n  },\n\n  _minus: function(e) {\n    e && e.preventDefault();\n    this.trigger(\"saved\", this);\n    this.inc(-this.options.inc);\n    return false;\n  },\n\n  _initSlider: function() {\n    var self = this;\n\n    this.spinner_slider = new cdb.admin.SpinnerSlider({\n      target: this.$el,\n      template_base: 'old_common/views/spinner_slider'\n    }).bind(\"valueSet\", function(value) {\n      // Set new model\n      var a = {};\n      a[self.property] = value;\n      self.model.set(a);\n    }).bind(\"valueChanged\", function(value) {\n      // Set new value\n      self.$el.find(\".value\").val(value);\n    });\n    this.addView(this.spinner_slider);\n  },\n\n  _checkNumber: function(number) {\n    return this.options.pattern.test(number);\n  },\n\n  _checkInputPress: function(ev) {\n    var newChar = String.fromCharCode(ev.charCode);\n\n    if(newChar == '-' || newChar == '.' || 1*newChar !== NaN) {\n      return true;\n    } else {\n      ev.preventDefault();\n      ev.stopPropagation();\n      return false;\n    }\n  },\n\n  _checkInputUp: function(ev) {\n    this.value? null : this.value = this.model.get(this.property);\n    var number = $(ev.target).val();\n\n    if (ev.keyCode == 40) {\n      ev.preventDefault();\n      ev.stopPropagation();\n      this.inc(-this.options.inc);\n      this._saveValue(ev);\n      this.$el.find(\"input\").focus();\n      return false;\n    }\n\n    if (ev.keyCode == 38) {\n      ev.preventDefault();\n      ev.stopPropagation();\n      this.inc(this.options.inc);\n      this._saveValue(ev);\n      this.$el.find(\"input\").focus();\n      return false;\n    }\n\n    // If it is an ENTER -> saves!\n    if (ev.keyCode === 13) {\n      this._saveValue(ev, true);\n      return false;\n    }\n    // If not, check the key\n    if (!this._checkNumber(number) && number != '-' && number != '') {\n      this.$el.find(\"input.value\").val(this.value);\n      // ev.stopPropagation();\n      // ev.preventDefault();\n    } else {\n      if(number != '-' && number != '') {\n        this.value = $(ev.target).val();\n      }\n    }\n    return true;\n  },\n\n  _checkValueChange: function(ev) {\n    var number = $(ev.target).val();\n    number = (number == '' || number == '-')? 0 : 1*number\n    if (!this._checkNumber(number)) {\n      this.$el.find(\"input.value\").val(this.value);\n    } else {\n      this._saveValue(ev, true);\n      this.value = $(ev.target).val();\n    }\n    return true;\n  },\n\n  _saveValue: function(ev, close) {\n    var a = {};\n    var val = this.$el.find(\"input.value\").val()\n    var baseNumber = (this.options.min < 0 && this.options.max > 0)?\n      0:\n      this.options.min;\n\n    var number = (val == '' || val == '-') ? baseNumber : 1*val;\n\n    if (number < this.options.min) number = this.options.min;\n    if (number > this.options.max) number = this.options.max;\n\n    this.$el.find(\"input.value\").val(number);\n\n    a[this.property] = number;\n    this.model.set(a);\n\n    this.trigger(\"saved\", this);\n\n    if (close && !this.options.disable_triggering) {\n      cdb.god.trigger(\"closeDialogs\");\n    }\n  },\n\n  _showSlider: function(ev) {\n    ev.preventDefault();\n    ev.stopPropagation();\n\n    this.$el.find(\"input\").focus();\n\n  }\n});\n\ncdb.forms.SimpleNumberWithLabel = cdb.forms.SimpleNumber.extend({\n\n  className: 'form-view form_spinner with-label',\n\n  render: function(prop) {\n    var value = this.options.initValue || this.model.get(this.property);\n\n    if (prop && _.isNumber(prop)) {\n      value = prop;\n    }\n\n    this.$el.html(\n      this.getTemplate('old_common/forms/widget_simple_number_with_label')({\n        label: this.options.label,\n        isDisabled: this.options.disabled,\n        width: this.options.width\n      })\n    );\n    this.$('.value').val(value);\n\n    if (this.options.classes) this.$el.addClass(this.options.classes);\n\n    if (this.options.disabled) {\n      this.undelegateEvents();\n      this.$el\n      .addClass('disabled')\n      .find('a').bind('click', this.killEvent);\n    }\n\n    return this;\n  }\n\n});\n\ncdb.forms.Spinner = cdb.core.View.extend({\n  className: 'form-view form_spinner',\n\n  defaults: {\n    max: 999999999999,\n    min: -999999999999,\n    inc: 1,\n    width: 25,\n    pattern: /^-?[0-9]+\\.?[0-9]*$/,\n    debounce_time: 200\n  },\n\n  events: {\n    'click .plus': '_plus',\n    'click .minus': '_minus',\n    'keypress input.value': '_checkInputPress',\n    'keydown input.value': '_checkInputPress',\n    'keyup input.value': '_checkInputUp',\n    'change .value': '_checkValueChange',\n    'click': '_showSlider'\n  },\n\n  initialize: function() {\n    _.bindAll(this, '_fireChange', '_checkNumber');\n    this.property = this.options.property;\n    this.model.bind('change', this.render, this);\n\n    // Check pattern, if it is empty or not valid,\n    // delete the option before extending defaults\n    if (!this.options.pattern ||\n        typeof this.options.pattern !== \"object\" ||\n        (typeof this.options.pattern === \"object\" && !this.options.pattern.test)\n      )\n    {\n      delete this.options.pattern;\n    }\n\n    _.defaults(this.options, this.defaults);\n\n    // Create slider\n    if(!this.options.noSlider) {\n      this._initSlider();\n    }\n\n    if(this.options.debounce_time > 0) {\n      this._fireChange = _.debounce(this._fireChange, this.options.debounce_time);\n    }\n  },\n\n  render: function(prop) {\n    var value = this.options.initValue || this.model.get(this.property);\n\n    if (prop && _.isNumber(prop)) {\n      value = prop;\n    }\n\n    this.$el.html('<input class=\"value\" ' + (this.options.disabled ? 'readonly' : '') + ' value=\"\" style=\"width:' + (this.options.width) + 'px!important\"/><a href=\"#\" class=\"plus\">+</a><a href=\"#\" class=\"minus\">-</a>');\n    this.$('.value').val(value);\n\n    if (this.options.disabled) {\n      this.undelegateEvents();\n      this.$el\n      .addClass('disabled')\n      .find('a').bind('click', this.killEvent);\n    }\n\n    return this;\n  },\n\n  _fireChange: function() {\n    this.model.change();\n  },\n\n  _changeValue: function(a) {\n    this.model.set(a, { silent: true });\n    this._fireChange();\n  },\n\n  inc: function(c) {\n    var a = {};\n    var v = a[this.property] = this.model.get(this.property) + c;\n    v = a[this.property] = Math.min(this.options.max, v.toFixed? v.toFixed(1): 1*v);\n    a[this.property] = Math.max(this.options.min, v);\n    this._changeValue(a);\n    // don't wait to be notified by model, render as fast as the user changes the value\n    this.render(a[this.property]);\n  },\n\n  _plus: function(e) {\n    e && e.preventDefault();\n    this.inc(this.options.inc);\n    return false;\n  },\n\n  _minus: function(e) {\n    e && e.preventDefault();\n    this.inc(-this.options.inc);\n    return false;\n  },\n\n  _initSlider: function() {\n    var self = this;\n\n    this.spinner_slider = new cdb.admin.SpinnerSlider({\n      target: this.$el,\n      template_base: 'old_common/views/spinner_slider'\n    }).bind(\"valueSet\", function(value) {\n      // Set new model\n      var a = {};\n      a[self.property] = value;\n      self.model.set(a);\n    }).bind(\"valueChanged\", function(value) {\n      // Set new value\n      self.$el.find(\".value\").val(value);\n    });\n    this.addView(this.spinner_slider);\n  },\n\n  _checkNumber: function(number) {\n    return this.options.pattern.test(number);\n  },\n\n  _checkInputPress: function(ev) {\n    var newChar = String.fromCharCode(ev.charCode);\n\n    if(newChar == '-' || newChar == '.' || 1*newChar !== NaN) {\n      return true;\n    } else {\n      ev.preventDefault();\n      ev.stopPropagation();\n      return false;\n    }\n  },\n\n  _checkInputUp: function(ev) {\n    this.value? null : this.value = this.model.get(this.property);\n    var number = $(ev.target).val();\n\n    // If it is an ENTER -> saves!\n    if (ev.keyCode === 13) {\n      this._saveValue(ev);\n      return false;\n    }\n\n    // If not, check the key\n    if (!this._checkNumber(number) && number != '-' && number != '') {\n      this.$el.find(\"input.value\").val(this.value);\n      // ev.stopPropagation();\n      // ev.preventDefault();\n    } else {\n      if(number != '-' && number != '') {\n        this.value = $(ev.target).val();\n      }\n    }\n    return true;\n  },\n\n  _checkValueChange: function(ev) {\n    var number = $(ev.target).val();\n    number = (number == '' || number == '-')? 0 : 1*number\n    if (!this._checkNumber(number)) {\n      this.$el.find(\"input.value\").val(this.value);\n    } else {\n      this._saveValue(ev);\n      this.value = $(ev.target).val();\n    }\n    return true;\n  },\n\n  _saveValue: function(ev) {\n    var a = {};\n    var val = this.$el.find(\"input.value\").val()\n    var baseNumber = (this.options.min < 0 && this.options.max > 0)?\n      0:\n      this.options.min;\n\n    var number = (val == '' || val == '-') ? baseNumber : 1*val;\n\n    this.$el.find(\"input.value\").val(number);\n\n    a[this.property] = number;\n    this.model.set(a);\n\n    cdb.god.trigger(\"closeDialogs\");\n  },\n\n  _showSlider: function(ev) {\n    if(!this.options.noSlider) {\n      ev.stopPropagation();\n\n      cdb.god.unbind(\"closeDialogs\", this.spinner_slider.hide, this.spinner_slider);\n      cdb.god.trigger(\"closeDialogs\");\n\n      if (!this.spinner_slider.el.parentElement) {\n        $('body').append(this.spinner_slider.render().el);\n\n        this.spinner_slider.init(this.options.max, this.options.min, this.options.inc, this.$el.find(\"input.value\").val());\n\n        cdb.god.bind(\"closeDialogs\", this.spinner_slider.hide, this.spinner_slider);\n        cdb.god.bind(\"closeDialogs:color\", this.spinner_slider.hide, this.spinner_slider);\n      }\n\n      this.$el.find(\"input.value\").focus();\n    }\n  }\n});\n\ncdb.forms.Opacity = cdb.forms.Spinner.extend({\n  initialize: function() {\n    _.defaults(this.options, {\n      max: 1, min: 0, inc: 0.1\n    });\n    // Added correct class to the spinner\n    this.$el.addClass(\"opacity\");\n\n    cdb.forms.Spinner.prototype.initialize.call(this);\n  }\n});\n\ncdb.forms.SimpleOpacity = cdb.forms.SimpleNumber.extend({\n  initialize: function() {\n    _.defaults(this.options, {\n      max: 1, min: 0, inc: 0.1\n    });\n    // Added correct class to the spinner\n    this.$el.addClass(\"opacity\");\n\n    cdb.forms.Spinner.prototype.initialize.call(this);\n  }\n});\n\n// same as Opacity but manages the case when the cartocss\n// contains a polygon-pattern\ncdb.forms.OpacityPolygon = cdb.forms.Spinner.extend({\n  initialize: function() {\n    _.defaults(this.options, {\n      max: 1, min: 0, inc: 0.1\n    });\n    // Added correct class to the spinner\n    this.$el.addClass(\"opacity\");\n\n    this.model.bind('change', function() {\n      this.switchProperty();\n    }, this);\n\n    cdb.forms.Spinner.prototype.initialize.call(this);\n    //this.switchProperty();\n\n  },\n\n  switchProperty: function() {\n    if(this.model.get('polygon-pattern-file')) {\n      if(!this.originalProperty) {\n        this.originalProperty = this.property;\n        this.property = 'polygon-pattern-opacity';\n        var val = this.model.get(this.property);\n        this.model.set(this.property, val === undefined ? this.model.get(this.originalProperty): val);\n        this.model.unset(this.originalProperty);\n      }\n    } else {\n      if(this.property === 'polygon-pattern-opacity') {\n        this.property = this.originalProperty;\n        this.originalProperty = null;\n        this.model.set(this.property, this.model.get('polygon-pattern-opacity'));\n        this.model.unset('polygon-pattern-opacity');\n      }\n    }\n  }\n\n\n});\n\ncdb.forms.Width = cdb.forms.Spinner.extend({\n  initialize: function() {\n    _.defaults(this.options, {\n      max: 40, min: 0, inc: 0.5\n    });\n    cdb.forms.Spinner.prototype.initialize.call(this);\n  }\n});\n\n\ncdb.forms.Combo = cdb.core.View.extend({\n\n  className: 'form-view form_combo',\n\n  options: {\n    minimumResultsForSearch: 20,\n    placeholder: '',\n    formatResult: false,\n    formatSelection: false,\n    matcher: false,\n    dropdownCssClass: ''\n  },\n\n  events: {\n    'change select': '_changeSelection'\n  },\n\n  initialize: function() {\n\n    _.bindAll(this, \"_onUpdate\", \"_changeSelection\");\n\n    this.data        = this.options.extra;\n\n\n    if (this.model) {\n      this.add_related_model(this.model);\n      this.model.bind(\"change:\" + this.options.property, this._onUpdate, this);\n    }\n\n  },\n\n  deselect: function() {\n    this.$el.find(\"select\").val(\"\").change();\n  },\n\n  updateData: function(data) {\n\n    this.data = data;\n    this._onUpdate();\n\n  },\n\n  _onUpdate: function() {\n\n    this.render();\n\n  },\n\n  _getOptions: function() {\n\n    var options = _.map(this.data, function(option) {\n\n      if (_.isArray(option)) {\n        return '<option value=\"' + option[1] + '\">' + option[0] + '</option>';\n      } else {\n        return '<option>' + option + '</option>';\n      }\n\n    }).join(\"\");\n\n    if (this.options.placeholder) options = \"<option></option>\" + options;\n\n    return options;\n\n  },\n\n  _setValue: function(value) {\n\n    this.$select.val(value);\n\n  },\n\n  render: function() {\n\n    var self = this;\n\n    // Options\n    this.$select = $('<select>' + this._getOptions() + '</select>');\n\n    // Method\n    var method = this.model && this.model.get(\"method\") && this.model.get(\"method\").replace(/ /g,\"_\").toLowerCase();\n\n    // Attributes\n    this.$select.attr({\n      style: (this.options.width ? \"width:\" + this.options.width  : '')\n    });\n\n    this.$select.addClass(this.options.property + (method ? ' ' + method : ''));\n\n    // Disabled?\n    if (this.options.disabled) this.$select.attr(\"disabled\", '');\n\n    // Sets the value\n    this._setValue(this.model && this.model.get(this.options.property) || this.options.property);\n\n    // Append\n    this.$el.html(this.$select);\n\n    // Apply select2, but before destroy the bindings\n    if (!this.options || !this.options.plainSelect) {\n\n      var $select = this.$(\"select\");\n      $select.select2(\"destroy\");\n\n      var combo_options = {\n        minimumResultsForSearch:  this.options.minimumResultsForSearch,\n        placeholder:              this.options.placeholder,\n        dropdownCssClass:         this.options.dropdownCssClass\n      };\n\n      if (this.options.formatResult)\n        combo_options.formatResult = this._formatResult;\n\n      if (this.options.formatSelection)\n        combo_options.formatSelection = this._formatSelection;\n\n      if (this.options.matcher)\n        combo_options.matcher = this._matcher;\n\n      $select.select2(combo_options);\n    }\n\n    return this;\n  },\n\n  _changeSelection: function(e) {\n    var a = {};\n\n    var val = this.$('select').val();\n\n    a[this.options.property] = val;\n\n    if (this.model) {\n      if (val) this.model.set(a);\n      else this.model.set(a, { silent: true });\n    }\n\n    // Send trigger\n    if (val) this.trigger('change', a[this.options.property]);\n  },\n\n  _formatResult: function(data) {\n    return data.id || data.text;\n  },\n\n  _matcher: function(term, text, option) {\n    return text.toUpperCase().indexOf(term.toUpperCase())>=0;\n  },\n\n  clean: function() {\n    this.$select.select2(\"destroy\");\n    cdb.core.View.prototype.clean.call(this);\n  }\n\n});\n\ncdb.forms.Switch = cdb.core.View.extend({\n\n  events: {\n    'click': '_onClick'\n  },\n\n  tagName: 'a',\n  className: 'form-view form_switch',\n\n  initialize: function() {\n    this.property = this.options.property;\n    this.model.bind('change:' + this.property, this._change, this);\n  },\n\n  _onClick: function(e) {\n    e.preventDefault();\n\n    if (!this.$el.hasClass(\"inactive\")) {\n\n      var a = {};\n      var value = !this.model.get(this.property);\n      a[this.property] = value;\n      this.model.set(a);\n\n      this.trigger(\"switched\", this.property, value);\n    }\n\n    return false;\n  },\n\n  _change: function() {\n    if(this.model.get(this.property)) {\n      this.$el.removeClass('disabled').addClass('enabled');\n    } else {\n      this.$el.removeClass('enabled').addClass('disabled');\n    }\n  },\n\n  render: function() {\n    this.$el.append(\"<span class='handle'></span>\");\n    this._change();\n    return this;\n  }\n\n});\n\ncdb.forms.TextAlign = cdb.core.View.extend({\n\n  className: 'form-view form_align',\n\n  defaults: {\n    debounce_time: 200\n  },\n\n  events: {\n    'click .align': '_align'\n  },\n\n  initialize: function() {\n\n    _.bindAll(this, '_fireChange');\n\n    this.property = this.options.property;\n\n    this.template = cdb.templates.getTemplate('old_common/views/text_align');\n\n    this.model.bind('change', this.render, this);\n\n    // Check pattern, if it is empty or not valid,\n    // delete the option before extending defaults\n    if (!this.options.pattern ||\n        typeof this.options.pattern !== \"object\" ||\n        (typeof this.options.pattern === \"object\" && !this.options.pattern.test)\n      )\n    {\n      delete this.options.pattern;\n    }\n\n    _.defaults(this.options, this.defaults);\n\n    if(this.options.debounce_time > 0) {\n      this._fireChange = _.debounce(this._fireChange, this.options.debounce_time);\n    }\n  },\n\n  _fireChange: function() {\n    this.model.change();\n  },\n\n  _align: function(e) {\n\n    e && e.preventDefault();\n\n    var align = $(e.target).attr(\"data-align\");\n\n    var a = {};\n\n    a[this.property] = align;\n\n    this.model.set(a, { silent: true });\n    this._fireChange();\n\n  },\n\n  render: function(prop) {\n\n    var value = this.options.initValue || this.model.get(this.property);\n\n    var alignments = this.options.alignments || {};\n\n    var left   = alignments.left   === undefined ? true : alignments.left;\n    var right  = alignments.right  === undefined ? true : alignments.right;\n    var center = alignments.center === undefined ? true : alignments.center;\n\n    this.$el.html(this.template({ left: left, right: right, center: center }));\n\n    this.$el.find(\"a[data-align='\"+ value +\"']\").addClass(\"selected\");\n\n    if (this.options.disabled) {\n      this.undelegateEvents();\n      this.$el\n      .addClass('disabled')\n      .find('a').bind('click', this.killEvent);\n    }\n\n    return this;\n  },\n\n\n});\n","\n/**\n * Represents a URL.\n * Provides common semantics to manipulate a URL without having to resort to manipulating strings manually.\n * Rather don't subclass but you composition if you need to extend some functionality.\n *\n * Can safely be coerced into a string implicitly, e.g.:\n *   var myUrl = cdb.common.Url.byBasePath('http://foobar.com/some/path')\n *   alert(myUrl); // will output 'http://foobar.com/some/path'\n */\ncdb.common.Url = cdb.core.Model.extend({\n\n  initialize: function (attrs) {\n    if (!attrs.base_url) {\n      throw new Error('base_url is required')\n    }\n  },\n\n  /**\n   * Get a new URL object with new basepath.\n   * @param {String,*} path new sub path. Slashes are not necessary, e.g. 'my_path'\n   * @return {Object} instance of cdb.common.Url\n   */\n  urlToPath: function() {\n    return cdb.common.Url.byBaseUrl(this.toString.apply(this, arguments));\n  },\n\n  /**\n   * @return {String} Path of this URL, e.g. '/some/path'\n   */\n  pathname: function() {\n    return this.toString().match(/^.+\\/\\/[^\\/]+(.*)$/)[1];\n  },\n\n  toString: function() {\n    return this._joinArgumentsWithSlashes(\n      this.get('base_url'),\n      Array.prototype.slice.call(arguments, 0)\n    );\n  },\n\n  _joinArgumentsWithSlashes: function() {\n    return _.chain(arguments).flatten().compact().value().join('/');\n  }\n\n}, {\n\n  byBaseUrl: function(url) {\n    return new cdb.common.Url({ base_url: url });\n  }\n});\n","/**\n * URLs associated with the dashboard visualizations.\n */\ncdb.common.DashboardVisUrl = cdb.common.Url.extend({\n\n  lockedItems: function() {\n    return this.urlToPath('locked');\n  },\n\n  sharedItems: function() {\n    return this.urlToPath('shared');\n  },\n\n  likedItems: function() {\n    return this.urlToPath('liked');\n  }\n});\n","/**\n *  Custom scroll for blocks\n *  - el: scrollable element\n *  - parent: where to put span shadows :)\n */\n\ncdb.admin.CustomScrolls = cdb.core.View.extend({\n\n  events: {\n    'scroll': 'checkScroll'\n  },\n\n  initialize: function() {\n    var self = this;\n\n    // Render it\n    this.render();\n\n    // Hack to check scroll form the beginning :)\n    this.timeout = setTimeout(function(){\n      self.checkScroll();\n    },300)\n  },\n\n  render: function() {\n    this.options.parent.append('<span class=\"top scroll\"></span><span class=\"bottom scroll\"></span>');\n    return this;\n  },\n\n  checkScroll: function(ev) {\n    var height_ = this.$el.outerHeight()\n      , scroll_y = this.$el[0].scrollTop\n      , scroll_x = this.$el[0].scrollLeft\n      , scroll_y_height = this.$el[0].scrollHeight - height_\n      , $parent = this.options.parent\n      , $top = $parent.find('span.top')\n      , $bottom = $parent.find('span.bottom');\n\n    // Y axis for the moment\n    if (scroll_y == 0) {\n      $top.hide();\n    } else {\n      $top.show();\n    }\n\n    if (scroll_y == scroll_y_height) {\n      $bottom.hide();\n    } else {\n      $bottom.show();\n    }\n  }\n\n});\n","\n/**\n *  Class for javascript errors in CartoDB App\n *\n *  - It controls JS errors and save them into the\n *    service we set at the begining.\n */\n\ncdb.admin.ErrorStats = cdb.core.Model.extend({\n\n  defaults: {\n    name:        'trackJs',              // Name of the service\n    people:      'configure',            // Internal service function for setting people configuration\n    template:    'old_common/views/trackjs', // Template for setting people configuration\n    enable_logs: false                   // Sends the errors to the logger\n  },\n\n  initialize: function(opts) {\n    if (opts && opts.user_data) {\n      this.user_data = opts.user_data;  \n    }\n\n    if (window[this.get('name')]) {\n      this._setService();\n    }\n  },\n\n  _setService: function() {\n    // Set people?\n    if (this.get('people') && this.user_data) {\n      var template = cdb.templates.getTemplate(this.get('template'));\n      window[this.get('name')][this.get('people')](JSON.parse(template(this.user_data)));\n    }\n    // Save logs?\n    if (this.get('enable_logs')) {\n      cdb.log = window[this.get('name')];\n    }\n  }\n\n});\n","\n  /**\n   *  Boolean field -> Place to choose any boolean value\n   *  - It accepts a model with {attribute: 'colum', value: true}\n   *  var boolean = new cdb.admin.BooleanField({ model: model })\n   */\n\n  cdb.admin.BooleanField = cdb.admin.StringField.extend({\n\n    className: 'field boolean',\n\n    default_options: {\n      template_name: 'old_common/views/forms/boolean_field',\n      label:          false,\n      readOnly:       false\n    },\n\n    events: {\n      'click a.radiobutton': '_onChange'\n    },\n\n    _onChange: function(e) {\n      e.preventDefault();\n\n      var $radio = $(e.target).closest('a.radiobutton') // Always within the view!\n        , value = $radio.text().toLowerCase();\n      \n      if (this.model.get('value') != value) {\n        this.model.set('value', value);\n        this._setSelected($radio)\n      }\n    },\n\n    _setSelected: function($radio) {\n      this.$('a.selected').removeClass('selected');\n      $radio.addClass('selected');\n    },\n\n    _resize: function() {},\n\n    _triggerEvent: function(eventName, values) {\n      this.trigger(eventName, values, this);\n    }\n  })","\n  /**\n   *  Color picker dropdown (extends Dropdown)\n   *\n   *  It shows the color options with a drop(up).\n   *\n   *  Usage example:\n   *\n   *  var color_picker = new cdb.admin.ColorPicker({\n   *    target: $('a.account'),\n   *    model: {},\n   *    template_base: 'common/views/color_picker'\n   *  });\n   *\n   */\n\n\n  cdb.admin.ColorPicker = cdb.admin.DropdownMenu.extend({\n\n    className: 'CDB-Text dropdown color_picker border',\n\n    _PICKER_DELAY: 800,\n\n    _COLORS: [\n      // First file\n      \"#136400\",\"#229A00\",\"#B81609\",\"#D6301D\",\n      \"#F84F40\",\"#41006D\",\"#7B00B4\",\"#A53ED5\",\"#2E5387\",\"#3E7BB6\",\n      \"#5CA2D1\",\"#FF6600\",\"#FF9900\",\"#FFCC00\",\"#FFFFFF\",\n      // Second file\n      \"#012700\",\"#055D00\",\"#850200\",\"#B40903\",\"#F11810\",\n      \"#11002F\",\"#3B007F\",\"#6B0FB2\",\"#081B47\",\"#0F3B82\",\"#2167AB\",\n      \"#FF2900\",\"#FF5C00\",\"#FFA300\",\"#000000\"\n    ],\n\n    default_options: {\n      width: 197,\n      speedIn: 150,\n      speedOut: 300,\n      vertical_position: \"up\",\n      horizontal_position: \"right\",\n      horizontal_offset: 5,\n      vertical_offset: 0,\n      tick: \"right\",\n      dragUpdate: false,\n      template_base: 'old_common/views/color_picker'\n    },\n\n    events: {\n      'click a.advanced'          : '_openAdvanced',\n      'click .default-colors li a': '_clickedColor',\n      'keyup input.text'          : '_checkColor',\n      'change input.text'         : '_checkColor',\n      'submit form'               : '_submitColor',\n      'click'                     : 'stopPropagation'\n    },\n\n    initialize: function() {\n      cdb.admin.DropdownMenu.prototype.initialize.call(this);\n\n      // Create a model with colors and \"extra colors\"\n      this.model = new cdb.core.Model({\n        visible:      false,\n        colors:       this._COLORS,\n        extra_colors: this.options.extra_colors,\n        color:        \"\"\n      });\n\n      if (this.options.target)\n        $(this.options.target).off(\"click\", this._handleClick);\n\n      this._initBinds();\n    },\n\n    _initBinds: function() {\n      _.bindAll(this, \"open\", \"hide\", \"_handleClick\", \"_keydown\",\n        '_openAdvanced', '_setPicker', '_setColor', '_onPickerMouseMove',\n        '_onPickerMouseUp', '_submitColor');\n      this.model.bind(\"change:colors change:extra_colors change:color\", this.render, this);\n    },\n\n    render: function() {\n      // Render element\n      var d = this.model.toJSON();\n      var self = this;\n\n      if (d.extra_colors) {\n        // Filter colors already present in default list\n        d.extra_colors = _.filter(\n          _.uniq( this.options.extra_colors ),\n          function(c) {\n            return  !_.contains( self._COLORS, c.toUpperCase() )\n          }\n        );\n      }\n\n      this.$el\n        .html(this.template_base(d))\n        .css({ width: this.options.width });\n\n      // Init and render color picker\n      ColorPicker.fixIndicators(\n        this.$('.slider-indicator').get(0),\n        this.$('.picker-indicator').get(0)\n      );\n\n      this.color_picker = ColorPicker(\n        this.$('.slider').get(0),\n        this.$('.picker').get(0),\n        this._setPicker\n      );\n\n      return this;\n    },\n\n    stopPropagation: function(e) {\n      e.stopPropagation();\n    },\n\n    _checkColor: function(e) {\n      e.preventDefault();\n\n      var color = new RGBColor(this.$(\"input.text\").val());\n\n      if (color.ok) {\n        this.$(\"input.text\").removeClass(\"error\");\n        this.$(\"form > span.color\").css(\"background\", color.toHex());\n      } else {\n        this.$(\"input.text\").addClass(\"error\");\n      }\n    },\n\n    setColors: function(attr, value) {\n      if (!attr || !value) {\n        cdb.log.info('No attribute or value for color picker model');\n        return false;\n      }\n\n      this.model.set(attr, value);\n    },\n\n    init: function(color) {\n      color = color || '#FFFFFF';\n      this.model.set('color', color);\n      this._setColor(color);\n      this.open();\n    },\n\n    _clickedColor: function(e) {\n      e.preventDefault();\n      var color = $(e.target).attr(\"href\");\n      this._triggerColor(color, true);\n      this.hide();\n    },\n\n    _setPicker: function(hex, hsv, rgb, mousePicker, mouseSlide) {\n      this._setColor(hex);\n      ColorPicker.positionIndicators(\n        this.$('.slider-indicator').get(0),\n        this.$('.picker-indicator').get(0),\n        mouseSlide, mousePicker\n      );\n    },\n\n    _setColor: function(color) {\n      this.$(\"form > span.color\").css(\"background\", color);\n      this.$(\"input.text\").val(color);\n    },\n\n    _submitColor: function(e) {\n      if (e) e.preventDefault();\n      var color = new RGBColor(this.$(\"input.text\").val());\n\n      if (color.ok) {\n        this._triggerColor(color.toHex(), true);\n        this.hide();\n      }\n    },\n\n    _onPickerMouseMove: function() {\n      if (this.options.dragUpdate) {\n        var color = new RGBColor(this.$(\"input.text\").val());\n        if (color.ok) this._triggerColor(color.toHex(), false);\n      }\n    },\n\n    _onPickerMouseUp: function() {\n      var color = new RGBColor(this.$(\"input.text\").val());\n      if (color.ok) this._triggerColor(color.toHex(), false);\n    },\n\n    _bindAdvancedPicker: function() {\n      this.$('.slider').bind('mousemove', this._onPickerMouseMove);\n      this.$('.picker').bind('mousemove', this._onPickerMouseMove);\n      this.$('.picker').bind('mouseup',   this._onPickerMouseUp);\n      this.$('.slider').bind('mouseup',   this._onPickerMouseUp);\n    },\n\n    _destroyAdvancedPicker: function() {\n      this.$('.slider').unbind('mousemove', this._onPickerMouseMove);\n      this.$('.picker').unbind('mousemove', this._onPickerMouseMove);\n      this.$('.picker').unbind('mouseup',   this._onPickerMouseUp);\n      this.$('.slider').unbind('mouseup',   this._onPickerMouseUp);\n    },\n\n    _openAdvanced: function(e) {\n      if (e) e.preventDefault();\n\n      this._bindAdvancedPicker();\n\n      this.$('div.top').addClass('advanced');\n      this.positionate(e);\n      // Set color in picker\n      var color = new RGBColor(this.$(\"input.text\").val());\n      if (color.ok) this.color_picker.setHex(color.toHex())\n    },\n\n    _triggerColor: function(color, close) {\n      // It triggers the color and if the parent\n      // should close the picker or not.\n      this.trigger('colorChosen', color, close, this.el);\n    },\n\n    positionate: function(e,target) {\n      var $target = this.options.target;\n\n      // Positionate\n      var targetPos     = $target[this.options.position || 'offset']()\n        , targetWidth   = $target.outerWidth()\n        , targetHeight  = $target.outerHeight()\n        , elementWidth  = this.$el.outerWidth()\n        , elementHeight = this.$el.outerHeight();\n\n      this.$el.css({\n        top: targetPos.top + parseInt((this.options.vertical_position == \"up\") ? (- elementHeight - 10 - this.options.vertical_offset) : (targetHeight + 10 - this.options.vertical_offset)),\n        left: targetPos.left + parseInt((this.options.horizontal_position == \"left\") ? (this.options.horizontal_offset - 15) : (targetWidth - elementWidth + 15 - this.options.horizontal_offset))\n      }).addClass(\n        // Add vertical and horizontal position class\n        (this.options.vertical_position == \"up\" ? \"vertical_top\" : \"vertical_bottom\" )\n        + \" \" +\n        (this.options.horizontal_position == \"right\" ? \"horizontal_right\" : \"horizontal_left\" )\n        + \" \" +\n        // Add tick class\n        \"tick_\" + this.options.tick\n      )\n    },\n\n    open: function(e,target) {\n      // Target\n      var $target = target && $(target) || this.options.target;\n\n      this.positionate(e,target);\n\n      // Show it\n      this.show();\n\n      // Dropdown openned\n      this.model.set('visible', true);\n    },\n\n    hide: function(ev) {\n      var self = this;\n\n      this.$el.animate({\n        marginTop: self.options.vertical_position == \"down\" ? \"10px\" : \"-10px\",\n        opacity: 0\n      },this.options.speedOut, function(){\n        // Remove selected class\n        $(self.options.target).removeClass(\"selected\");\n        // And clean it ;)\n        self.clean();\n      });\n\n      // Dropdown hidden\n      this.model.set('visible', false);\n    },\n\n    clean: function() {\n      if (this.color_picker) {\n        this.color_picker.unBind();\n      }\n\n      if (this.options.target)\n        $(this.options.target).unbind(\"click\", this._handleClick);\n\n      cdb.admin.DropdownMenu.prototype.clean.call(this);\n    }\n  });\n","\n  /**\n   *  Date field -> Place to choose and edit date field\n   *  - It accepts a model with {attribute: 'colum', value: '2013-02-12T12:19:58+01:00'}\n   *  - It will create a new model to split this value into {day, month, year and time}\n   *  var date = new cdb.admin.DateField({ model: model })\n   */\n\n  cdb.admin.DateField = cdb.admin.StringField.extend({\n\n    className: 'field date',\n\n    timezone: \"00:00\",\n\n    default_options: {\n      template_name: 'old_common/views/forms/date_field',\n      label:          false,\n      readOnly:       false\n    },\n\n    events: {\n      'change input.time': '_onChange',\n      'keyup input.time':  '_onKeyUp'\n    },\n\n    initialize: function() {\n      _.defaults(this.options, this.default_options);\n\n      _.bindAll(this, '_onChange', '_onKeyUp', '_onChangeModel');\n\n      this.template_base = this.options.template_base ? _.template(this.options.template_base) : cdb.templates.getTemplate(this.options.template_name);\n\n      // Get date\n      var date = this._splitDate((this.model.get('value')));\n\n      this.timezone = this._getTimeZone(this.model.get('value'));\n\n      // Generate a new date Model (later it will be removed and destroyed)\n      this.date_model = new cdb.core.Model();\n\n      // Begins as valid\n      this.valid = true;\n\n      // Bind changes\n      this.date_model.bind('change', this._onChangeModel);\n\n      // Date model data set\n      this.date_model.set(date);\n\n      // On clean\n      this.bind('clean', this._reClean);\n    },\n\n    render: function() {\n      this.$el.html(this.template_base(_.extend(this.model.toJSON(), this.options)));\n\n      // Apply views\n      this._initViews();\n\n      // Check readOnly and unbind all events\n      if (this.options.readOnly) {\n        this.undelegateEvents();\n      }\n\n      return this;\n    },\n\n    _initViews: function() {\n\n      // Days spinner\n      var days = this.days = new cdb.forms.Spinner({\n        el: this.$el.find('div.day'),\n        model:    this.date_model,\n        disabled: this.options.readOnly,\n        property: 'day',\n        min:      1,\n        max:      31,\n        inc:      1,\n        width:    15,\n        noSlider: true,\n        pattern:  /^([12]?\\d{0,1}|3[01]{0,2})$/\n      });\n\n      this.addView(this.days);\n      this.$(\"div.day\").append(days.render());\n\n      // Year spinner\n      var years = this.years = new cdb.forms.Spinner({\n        el: this.$el.find('div.year'),\n        model:    this.date_model,\n        disabled: this.options.readOnly,\n        property: 'year',\n        min:      1900,\n        max:      2100,\n        width:    28,\n        noSlider: true,\n        pattern:  /^([0-9]{0,4})$/\n      });\n      this.addView(this.years);\n      this.$(\"div.year\").append(years.render());\n\n      // Month selector\n      var months = this.months = new cdb.forms.Combo({\n        el: this.$el.find('div.month'),\n        model:      this.date_model,\n        disabled:   this.options.readOnly,\n        property:   'month',\n        width:      '140px',\n        extra:      [['January',1], ['February',2], ['March',3], ['April',4], ['May',5], ['June',6], ['July',7], ['August',8], ['September',9], ['October',10], ['November',11], ['December',12]]\n      });\n      this.addView(this.months);\n      this.$(\"div.month\").append(months.render());\n\n      // Time input\n      this.$('input.time').val(this.date_model.get('time'));\n    },\n\n    /**\n     *  Extracts the timezone from a date\n     */\n    _getTimeZone: function(date) {\n\n      if (date) {\n        var match = date.match(/\\+(.*)$/);\n        if (match && match.length == 2) return match[1];\n      }\n\n      return this.timezone;\n\n    },\n\n    /**\n     *  Split the date string\n     */\n    _splitDate: function(str) {\n      var date = {};\n\n      // Get default date and time\n      var today = new Date();\n\n      var day   = today.getDate();\n      var month = today.getMonth() + 1;\n      var year  = today.getFullYear();\n\n      var time = today.getHours() + \":\" + today.getMinutes() + \":\" + today.getSeconds();\n\n      if (str == '') {\n        date.day   = day;\n        date.month = month;\n        date.year  = year;\n        date.time  = time;\n      } else {\n        try {\n          var split_date_hour = str.split('T');\n\n          if (split_date_hour.length > 1) {\n\n            var split_date = split_date_hour[0].split('-');\n\n            date.time  = split_date_hour[1].substr(0,8);\n            date.day   = parseInt(split_date[2]);\n            date.month = parseInt(split_date[1]);\n            date.year  = parseInt(split_date[0]);\n\n          } else {\n            date.day   = day;\n            date.month = month;\n            date.year  = year;\n            date.time  = time;\n          }\n\n        } catch (e) {\n          date.day   = day;\n          date.month = month;\n          date.year  = year;\n          date.time  = time;\n        }\n      }\n\n      return date;\n\n    },\n\n    /**\n     *  Get the date model and converts to date string\n     */\n    _toDate: function(date) {\n      return date.year + \"-\" + date.month + \"-\" + date.day + \"T\" + date.time + \"+\" + this.timezone;\n    },\n\n    /**\n     *  Check if the time is well formed or not\n     */\n    _checkTime: function(time) {\n      var pattern = /^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/;\n      if (pattern.test(time)) {\n        return true\n      } else {\n        return false\n      }\n    },\n\n\n    // Events\n    _onChange: function(e) {\n      var time = this.$('input.time').val();\n\n      if (this._checkTime(time)) {\n        this.date_model.set('time', time);\n      }\n    },\n\n    _onChangeModel: function(m) {\n      this.model.set('value', this._toDate(this.date_model.toJSON()));\n    },\n\n\n    _onKeyDown: function() {},\n\n\n    _onKeyUp: function(e) {\n      var time = $(e.target).val();\n\n      if (this._checkTime(time)) {\n\n        if (e.keyCode === 13) {\n          e.preventDefault();\n          this._triggerEvent('ENTER');\n          return false;\n        }\n\n        this.valid = true;\n        this.date_model.set('time', time);\n        $(e.target).removeClass(\"error\");\n      } else {\n        this.valid = false;\n        $(e.target).addClass(\"error\");\n      }\n    },\n\n    _reClean: function() {\n      this.date_model.unbind('change');\n      this.date_model.destroy();\n    }\n  })\n","\ncdb.admin.EditInPlace = cdb.core.View.extend({\n\n  events: {\n    \"click .value\": \"_onClick\",\n    \"keyup input\":  \"_onKeyUp\",\n    \"blur input\":   \"_onBlur\"\n  },\n\n  initialize: function() {\n\n    this.options = _.extend({\n      disabled: false,\n      stripHTML: false\n    }, this.options);\n\n    _.bindAll(this, \"_close\", \"_onKeyUp\");\n\n    this._observedField = this.options.observe;\n\n    this.disabled  = this.options.disabled;\n    this.stripHTML = this.options.stripHTML;\n\n    this.template = this.options.template_name ? this.getTemplate(this.options.template_name) : this.getTemplate('table/menu_modules/legends/views/edit_in_place');\n\n    this._setupConfig();\n\n    this.add_related_model(this.model);\n    this.model.bind(\"change:\" + this._observedField, this._updateValue, this);\n\n    this.render();\n\n  },\n\n  _setupConfig: function() {\n\n    this.config = new cdb.core.Model({\n      mode: \"view\"\n    });\n\n    this.add_related_model(this.config);\n    this.config.bind(\"change:mode\", this._updateMode, this);\n\n  },\n\n  _updateMode: function(mode) {\n\n    if (this.config.get(\"mode\") == 'edit') {\n\n      this.$el.find(\".value\").hide();\n\n      this.$input.show();\n      this.$input.focus();\n\n    } else {\n\n      this.$el.find(\".value\").show();\n      this.$input.hide();\n\n      var value = this.model.get(this._observedField);\n\n      this.$input.val(value);\n      this.$el.find(\".value span\").html(value);\n\n    }\n  },\n\n  _updateValue: function() {\n\n    var value = this.model.get(this._observedField);\n\n    if (this.stripHTML) {\n      value = cdb.Utils.stripHTML(value);\n    }\n\n    if (cdb.Utils.isBlank(value)) {\n\n      this.$input.text(\"\");\n      this.$el.find(\".value\").addClass(\"empty\");\n      this.$el.find(\".value span\").text(\"empty\");\n      this.trigger(\"change\", null, this);\n\n      return;\n    }\n\n    this.$input.text(value);\n    this.$el.find(\".value span\").html(value);\n    this.$el.find(\".value\").removeClass(\"empty\");\n\n    this.trigger(\"change\", value, this);\n\n  },\n\n  _close: function(e) {\n\n    e && e.preventDefault();\n    e && e.stopPropagation();\n\n    this.config.set(\"mode\", \"view\");\n\n    this._preventEmptyValue();\n  },\n\n  _preventEmptyValue: function() {\n\n    var value = this.model.get(this._observedField);\n\n    if (cdb.Utils.isBlank(value)) {\n      this.$el.find(\".value\").addClass(\"empty\");\n      this.$el.find(\".value span\").text(\"empty\");\n    } else {\n      this.$el.find(\".value\").removeClass(\"empty\");\n    }\n\n  },\n\n  _onBlur: function(e) {\n\n    var value = this.$el.find(\"input\").val();\n\n    if (this.stripHTML) {\n      value = cdb.Utils.stripHTML(value);\n    }\n\n    this.model.set(this._observedField, value);\n    this._close();\n  },\n\n  _onKeyUp: function(e) {\n\n    if (e.keyCode == 13) { // Enter\n\n      var value = this.$el.find(\"input\").val();\n\n      if (this.stripHTML) {\n        value = cdb.Utils.stripHTML(value);\n      }\n\n      this.model.set(this._observedField, value);\n      this._close();\n\n    } else if (e.keyCode == 27) { // Esc\n      this._close();\n    }\n\n  },\n\n  _onClick: function(e) {\n\n    e && e.preventDefault();\n    e && e.stopPropagation();\n\n    if (!this.disabled) this.config.set(\"mode\", \"edit\");\n  },\n\n  render: function() {\n\n    var isEmpty = true;\n    var value = this.model.get(this._observedField);\n\n    if (this.stripHTML) {\n      value = cdb.Utils.stripHTML(value);\n    }\n\n    if (cdb.Utils.isBlank(value)) {\n      value = \"empty\";\n      this.$el.append('<input type=\"text\" value=\"\" />');\n    } else {\n      isEmpty = false;\n      this.$el.append('<input type=\"text\" value=\"' + _.escape(value) + '\" />');\n    }\n\n    this.$el.append(this.template({ value: value }));\n    this.$el.addClass(\"edit_in_place\");\n\n    if (this.disabled) this.$el.addClass(\"disabled\");\n\n    if (isEmpty) {\n      this.$el.find(\".value\").addClass(\"empty\");\n    } else {\n      this.$el.find(\".value\").removeClass(\"empty\");\n    }\n\n    this.$input = this.$el.find(\"input\");\n\n    if (this.options.maxWidth) this.$el.find(\"span\").css(\"max-width\", this.options.maxWidth);\n\n\n  }\n\n});\n","\n  /**\n   *  Advanced combo with extra parameters\n   *\n   */\n\n\n  cdb.forms.ColumnTypeCombo = cdb.forms.Combo.extend({\n\n    options: {\n      minimumResultsForSearch: 20,\n      placeholder: '',\n      formatResult: true,\n      matcher: true,\n      dropdownCssClass: 'column-type'\n    },\n\n    _formatResult: function(data) {\n      return  '<span class=\"value\">' + data.id + '</span>' + '<span class=\"type\">' + (data.text && data.text.charAt(0)) + '</span>'\n    },\n\n    _matcher: function(term, text, option) {\n      var val = $(option).val();\n      return val.toUpperCase().indexOf(term.toUpperCase())>=0;\n    }\n\n  });\n","\n/**\n * renders a form given fields\n *\n * var form = new cdb.forms.Form({\n *  form_data: [\n      {\n         name: 'Marker Fill',\n         form: {\n           'polygon-fill': {\n                 type: 'color' ,\n                 value: '#00FF00'\n            },\n            'polygon-opacity': {\n                 type: 'opacity' ,\n                 value: 0.6\n            }\n        }\n      }\n    ]\n * });\n */\n\ncdb.forms.Form = cdb.core.View.extend({\n  tagName: 'ul',\n\n  widgets: {\n   'color': 'ColorWizard',\n   'opacity': 'Opacity',\n   'simple_opacity': 'SimpleOpacity',\n   'opacity_polygon': 'OpacityPolygon',\n   'number': 'Spinner',\n   'simple_number': 'SimpleNumber',\n   'simple_number_with_label': 'SimpleNumberWithLabel',\n   'width': 'Width',\n   'select': 'Combo',\n   'hidden': 'Hidden',\n   'switch': 'Switch',\n   'text_align': 'TextAlign'\n  },\n\n  field_template: _.template('<li <% if (className) { %>class=\"<%- className %>\"<% } %>><span><%-name %></span><span class=\"field\"></li>'),\n\n  initialize: function() {\n    var self = this;\n    this.fields = {};\n\n    this.form_data = this.options.form_data;\n\n    this.bind('clean', function() {\n      this.fields = null;\n    }, this);\n  },\n\n  updateForm: function(form) {\n    this.form_data = form;\n  },\n\n  _renderField: function(field) {\n    var self = this;\n    var e = $(this.field_template({ name: field.title || field.name, className: field.className || false }));\n    _(field.form).each(function(form, name) {\n\n      // create the class for this data type and add it to view\n      var Class = window.cdb.forms[self.widgets[form.type]];\n      if (Class) {\n        var opts = form;\n        _.extend(opts, {\n          property: name,\n          model: self.model,\n          extra: form.extra,\n          field_name: field.name\n        });\n        var v = new Class(opts);\n        e.find('.field').append(v.render().el);\n\n        v.on(\"saved\", function() {\n          self.trigger(\"saved\", self);\n        });\n\n        self.addView(v);\n      } else {\n        cdb.log.error(\"field class not found \"  + form.type);\n      }\n    });\n\n    // Render text if it exists after first form\n    // TODO: create a new type of field called text\n    if (field.text) {\n      $(\"<span class='text light'>\" + field.text + \"</span>\").insertAfter(e.find('.field div:eq(0)'));\n    }\n\n    return e;\n  },\n\n  /**\n   * return the jquery element for a field\n   * (wraps each subfield)\n   */\n  getFieldByName: function(name) {\n    return this.fields[name];\n  },\n\n  /**\n   * returns the views inside each field\n   */\n  getFieldsByName: function(name) {\n    return _.filter(this._subviews, function(v) {\n      if(v.options.field_name === name) {\n        return v;\n      }\n    });\n  },\n\n  render: function() {\n    var self = this;\n    this.clearSubViews();\n    _(this.filter).each(function(e) {\n      e.destroy();\n    });\n    this.$el.html('');\n    _(this.form_data).each(function(field) {\n      var f= self._renderField(field);\n      self.fields[field.name] = f;\n\n      self.$el.append(f);\n    });\n    return this;\n  }\n\n});\n\n","\n  /**\n   *  Geometry field -> Place to choose and edit geometry field\n   *  - It accepts a model with {attribute: 'the_geom', value: '{{ \"type\": \"Point\", \"coordinates\": [100.0, 0.0] }}'}\n   *  var geometry = new cdb.admin.GeometryField({ model: model, row: row, rowNumber: rowNumber })\n   */\n\n  cdb.admin.GeometryField = cdb.admin.StringField.extend({\n\n    className: 'field geometry',\n\n    default_options: {\n      template_name: 'old_common/views/forms/geometry_field',\n      label:          false,\n      readOnly:       false\n    },\n\n    events: {\n      'click .switch':    '_chooseEditor',\n      'keyup input':      '_onKeyInputUp',\n      'keydown textarea': '_onKeyTextareaDown',\n      'change textarea':  '_onChange'\n    },\n\n    initialize: function() {\n      _.defaults(this.options, this.default_options);\n\n      _.bindAll(this, '_chooseEditor', '_onKeyInputUp', '_onKeyTextareaDown');\n\n      this.template_base = this.options.template_base ? _.template(this.options.template_base) : cdb.templates.getTemplate(this.options.template_name);\n\n      // Set important variables\n      this.valid = true;\n      this.row = this.options.row;\n\n      // Get OS variable\n      this._setOS();\n    },\n\n    render: function() {\n      this.$el.html(this.template_base(_.extend(this.model.toJSON(), this.options)));\n\n      // Apply views\n      this._initViews();\n\n      // Check readOnly and unbind all events\n      if (this.options.readOnly) {\n        this.undelegateEvents();\n      }\n\n      return this;\n    },\n\n    _initViews: function() {\n      var geojson = this.model.get('value');\n\n      if (!this.row.isGeomLoaded()) {\n        // the_geom contents still haven't been loaded\n        this._loadGeom();\n      } else {\n        this._chooseGeom();\n      }\n    },\n\n    /**\n     *  Load geom if it is not loaded\n     */\n    _loadGeom: function() {\n      var self = this;\n      this.row.bind('change', function() {\n        self.model.set('value', self.row.get(\"the_geom\"));\n        self._chooseGeom();\n      }, this);\n      this.row.fetch({\n        rowNumber: this.options.rowNumber\n      });\n    },\n\n\n    /**\n     *  Choose scenario for the editor\n     */\n    _chooseGeom: function() {\n      var geom = null;\n\n      try {\n        geom = JSON.parse(this.model.get('value'));\n      } catch(err) {\n        // if the geom is not a valid json value\n      }\n\n      if (!this.options.readOnly) {\n        if (!geom || geom.type.toLowerCase() == \"point\") {\n          // Set status to point\n          this.status = \"point\";\n          // Remove loader\n          this.$(\".loader\").remove();\n          // Fill inputs\n          this.$(\".point\").show();\n          this.$(\".selector\").show();\n\n          if (geom) {\n            this.$(\"input.longitude\").val(geom.coordinates[0]);\n            this.$(\"input.latitude\").val(geom.coordinates[1]);\n            this.$(\"textarea\").val(JSON.stringify(geom));\n          }\n        } else {\n          // Set status to rest\n          this.status = \"rest\";\n          // Remove loader\n          this.$(\".loader\").remove();\n          // Fill textarea\n          this.$(\".rest\").show();\n          this.$(\"textarea\").val(this.model.get('value'));\n        }\n      } else {\n        this.$(\".loader\").remove();\n        this.$(\".selector\").show();\n        this.$(\"textarea\").val(this.model.get('value'));\n      }\n    },\n\n    _chooseEditor: function(ev) {\n      this.killEvent(ev);\n\n      var $el = $(ev.target).closest(\"a\");\n\n      // Change status value\n      this.status = (this.status == \"point\") ? \"rest\" : \"point\";\n\n      // Change switch\n      $el\n        .removeClass(this.status == \"rest\" ? \"disabled\" : \"enabled\")\n        .addClass(this.status == \"rest\" ? \"enabled\" : \"disabled\");\n\n      this.updateInputs();\n\n      // Change between point to geom editor\n      if (this.status == \"rest\") {\n        this.$('.point').hide();\n        this.$('.rest').show();\n        this.valid = true;\n      } else {\n        this.$('.point').show();\n        this.$('.rest').hide();\n        this.valid = this._checkInputs();\n      }\n    },\n\n    updateInputs: function() {\n      if(this.model.get('value')) {\n        try {\n          var geom = JSON.parse(this.model.get('value'));\n          this.$(\"input.longitude\").val(geom.coordinates[0]);\n          this.$(\"input.latitude\").val(geom.coordinates[1]);\n          this.$(\"textarea\").val(JSON.stringify(geom));\n        } catch(error) {\n          return false;\n        }\n      }\n    },\n\n    /**\n     *  Check if the number is well formed or not\n     */\n    _checkNumber: function(number, type) {\n      var pattern = /^-?(?:[0-9]+|[0-9]*\\.[0-9]+)$/;\n      if (pattern.test(number)) {\n\n        if (type === \"lat\") {\n          if ( number >= -90 && number <= 90 ) {\n            return true\n          } else {\n            return false\n          }\n        }\n\n        if (type === \"lon\") {\n          if ( number >= -180 && number <= 180 ) {\n            return true\n          } else {\n            return false\n          }\n        }\n\n        return true\n      } else {\n        return false\n      }\n    },\n\n\n    /**\n     *  Check latitude and longitude inputs\n     */\n    _checkInputs: function() {\n      var enable = true\n        , $lat = this.$(\"input.latitude\")\n        , $lon = this.$(\"input.longitude\");\n\n      if (this._checkNumber($lat.val(), 'lat')) {\n        $lat.removeClass(\"error\");\n      } else {\n        $lat.addClass(\"error\");\n        enable = false;\n      }\n\n      if (this._checkNumber($lon.val(), 'lon')) {\n        $lon.removeClass(\"error\");\n      } else {\n        $lon.addClass(\"error\");\n        enable = false;\n      }\n\n      return enable;\n    },\n\n    /**\n     *  When user type any number we check it if it is correct\n     */\n    _onKeyInputUp: function(e) {\n\n      if (this._checkInputs()) {\n\n        if (e.keyCode === 13) {\n          e.preventDefault();\n          this._triggerEvent('ENTER');\n          return false;\n        }\n\n        this.valid = true;\n\n        // Save model\n        var lat = parseFloat(this.$(\"input.latitude\").val())\n          , lon = parseFloat(this.$(\"input.longitude\").val());\n\n        this.model.set('value', JSON.stringify({\"type\": \"Point\", \"coordinates\": [lon,lat]}));\n\n      } else {\n        this.valid = false;\n      }\n    },\n\n    /**\n     *  Key press binding for textarea\n     */\n    _onKeyTextareaDown: function(e) {\n      if (((this.so==\"mac\" && e.metaKey) || (this.so==\"rest\" && e.ctrlKey)) && e.keyCode == 13 ) {\n        e.preventDefault();\n        this._triggerEvent('ENTER');\n        return false;\n      }\n\n      var value = $(e.target).val();\n\n      this.model.set('value', value);\n    },\n  })\n","\n  /**\n   *  Number field -> Place to edit and capture number editions\n   *  - It accepts a model with {attribute: 'colum', value: '1235'}\n   *  - It validates the number before saving it\n   *  var string = new cdb.admin.NumberField({ model: model })\n   *\n   */\n\n  cdb.admin.NumberField = cdb.admin.StringField.extend({\n\n    className: 'field number',\n\n    default_options: {\n      template_name: 'old_common/views/forms/number_field',\n      label:          false,\n      readOnly:       false\n    },\n\n    events: {\n      'change input':   '_onChange',\n      'keyup input':    '_onKeyUp',\n      'keydown input':  '_onKeyDown'\n    },\n\n    // Check if the number is well formed or not\n    _checkNumber: function(number) {\n      var pattern = /^-?(?:[0-9]+|[0-9]*\\.[0-9]+)$/;\n      if (pattern.test(number))\n        return true\n      else\n        return false\n    },\n\n    _onChange: function(e) {\n      var value = $(e.target).val();\n      if (this._checkNumber(value)) {\n        this.model.set('value', value);\n      }\n    },\n\n    _onKeyDown: function(e) {\n      var number = $(e.target).val();\n      if ((((this.so==\"mac\" && e.metaKey) || (this.so==\"rest\" && e.ctrlKey)) && e.keyCode == 13) || e.keyCode == 13) {\n        if (number === '' || this._checkNumber(number)) {\n          this._setValid(number);\n          this._triggerEvent('ENTER');\n        }\n      }\n    },\n\n    _onKeyUp: function(e) {\n      var number = $(e.target).val();\n\n      if (number === '' || this._checkNumber(number)) {\n        this._setValid(number);\n      } else {\n        this._setInvalid(number);\n      }\n    },\n\n    _setInvalid: function(number) {\n      this.valid = false;\n      this.$('input[type=\"text\"]').addClass(\"error\");\n    },\n\n    _setValid: function(number) {\n      this.valid = true;\n\n      if (number === '') {\n        number = 'null';\n      }\n\n      this.$('input[type=\"text\"]').removeClass(\"error\");\n      this.model.set('value', number);\n    },\n\n    _resize: function() {}\n\n  })\n","\n\n  /**\n   * Spinner slider (extends Dropdown)\n   *\n   * It shows the spinner slider.\n   *\n   * Usage example:\n   *\n      var spinner_slider = new cdb.admin.SpinnerSlider({\n        target: $('a.account'),\n        model: {},\n        template_base: 'common/views/spinner_slider'\n      });\n   *\n   */\n\n\n  cdb.admin.SpinnerSlider = cdb.admin.DropdownMenu.extend({\n\n    className: 'dropdown spinner_slider border',\n\n    default_options: {\n      width: 26,\n      speedIn: 150,\n      speedOut: 300,\n      vertical_position: \"up\",\n      horizontal_position: \"right\",\n      horizontal_offset: 32,\n      vertical_offset: 0,\n      tick: \"top\"\n    },\n\n    events: {\n      'click' : '_stopPropagation',\n    },\n\n    _stopPropagation: function(ev) {\n      ev.stopPropagation();\n      ev.preventDefault();\n    },\n\n    init: function(max,min,inc,value) {\n      var self = this;\n\n      this.$el.find(\"div.slider-ui\").slider({\n        orientation: \"vertical\",\n        max: max,\n        min: min,\n        step: inc,\n        value: value,\n        slide: function(ev, ui) { self.trigger(\"valueChanged\", ui.value, this.el); },\n        change: function(ev, ui) { self.trigger(\"valueSet\", ui.value, this.el); }\n      });\n\n      this.open();\n    },\n\n    hide: function(ev) {\n      var self = this;\n      this.isOpen = false;\n\n      this.$el.animate({\n        marginTop: self.options.vertical_position == \"down\" ? \"10px\" : \"-10px\",\n        opacity: 0\n      },this.options.speedOut, function(){\n        // Remove selected class\n        $(self.options.target).removeClass(\"selected\");\n        // And hide it\n        self.$el.hide();\n        self.$el.find(\"div.slider-ui\").slider(\"destroy\");\n        self.remove();\n      });\n    }\n  });\n","  \n  /**\n   *  Custom combo which it lets you to add a custom value\n   *  extended from filters combo.\n   *\n   */\n  \n\n  cdb.forms.CustomTextCombo = cdb.forms.ColumnTypeCombo.extend({\n\n    className: 'form_combo form_custom_text_combo',\n\n    options: {\n      minimumResultsForSearch: 20,\n      placeholder: '',\n      formatResult: true,\n      formatSelection: true,\n      matcher: true,\n      freeText: true,\n      dropdownCssClass: 'column-type custom_text_combo'\n    },\n\n    render: function() {    \n      var self = this;\n\n      // Options\n      this.$select = $('<select>' + this._getOptions() + '</select>');\n\n      // Method\n      var method = this.model && this.model.get(\"method\") && this.model.get(\"method\").replace(/ /g,\"_\").toLowerCase();\n\n      // Attributes\n      this.$select.attr({\n        style: (this.options.width ? \"width:\" + this.options.width  : '')\n      });\n\n      this.$select.addClass(this.options.property + (method ? ' ' + method : ''));\n\n      // Disabled?\n      if (this.options.disabled) this.$select.attr(\"disabled\", '');\n\n      // Sets the value\n      this._setValue(this.model && this.model.get(this.options.property) || this.options.property);\n\n      // Append\n      this.$el.html(this.$select);\n\n      // Apply select2, but before destroy the bindings\n      if (!this.options || !this.options.plainSelect) {\n\n        var $select = this.$(\"select\");\n        $select.select2(\"destroy\");\n\n        var combo_options = {\n          minimumResultsForSearch:  this.options.minimumResultsForSearch,\n          placeholder:              this.options.placeholder,\n          dropdownCssClass:         this.options.dropdownCssClass,\n          freeText:                 this.options.freeText\n        };\n\n        if (this.options.formatSelection)\n          combo_options.formatSelection = this._formatSelection;\n\n        if (this.options.formatResult)\n          combo_options.formatResult = this._formatResult;\n\n        if (this.options.matcher)\n          combo_options.matcher = this._matcher;\n\n        $select.select2(combo_options);\n      }\n\n      // Set value for the combo if it is not defined as an option\n      var actual_value = this.model.get(this.options.property);\n      if ( actual_value !== \"\" && !this._valueAsOption(this.model.get(this.options.property))) {\n        $select.select2('val', this.model.get(this.options.property))\n      }\n\n      return this;\n    },\n\n    // Does that value exist as an option?\n    _valueAsOption: function(value) {\n      return _.find(this.options.extra, function(opt) { return opt[1] === value }) !== undefined\n    },\n\n    _formatSelection: function(data) {\n      return data ? data.id : data.text;\n    },\n\n    _changeSelection: function(e) {\n      var val = this.$('select').val() || this.$('select').data('select2').data().id;\n      // Check if val is from text or value\n      var isText = !this._valueAsOption(val);\n\n      // Set model\n      var a = {};\n      a[this.options.property] = val;\n      a[this.options.text || 'text'] = isText ? true : false;\n\n      if (val) this.model.set(a);\n\n      // Set icon\n      this.$('.select2-choice > div')\n        .removeClass()\n        .addClass( isText ? 'free-text-icon' : 'combo-option-icon' )\n    }\n\n  });","\n/**\n * Small moving label used to show errors in operations\n */\n\ncdb.admin.GlobalError = cdb.core.View.extend({\n  \n  DEFAULT_TAG: '',\n\n  initialize: function() {\n    _.bindAll(this, 'hide');\n    this._lastType = -1;\n    this._lastTag = this.DEFAULT_TAG;\n  },\n\n  templates: {\n    'info': 'old_common/views/notifications/info',\n    'warn': 'old_common/views/notifications/info',\n    'error': 'old_common/views/notifications/info',\n    'load': 'old_common/views/notifications/loading'\n  },\n\n  priority: {\n    'error': 3,\n    'warn': 2,\n    'info': 1,\n    'load': 0\n  },\n\n  /**\n   * Returns the fetched template of the passed type\n   * @param  {String} type\n   * @return {Function}\n   */\n  getTypeTemplate: function(type) {\n    var url = this.templates[type]? this.templates[type] : this.templates[\"info\"];\n    var tmpl = this.getTemplate(url);\n    return tmpl;\n  },\n  // type can be: 'info', 'error'\n  showError: function(text, type, timeout, tag) {\n    tag = tag || this.DEFAULT_TAG;\n    timeout = timeout === undefined ? 2000: timeout;\n    type || (type = 'info')\n\n    var priority = this.priority[type] || 0;\n    var currentPriority = this.priority[this._lastType] || 0;\n    if(priority < currentPriority) {\n      return;\n    }\n    this._lastType = type;\n    this._lastTag = tag;\n\n    this.$el.html(this.getTypeTemplate(type)({text: text, type: type}));\n\n    if(this._timer) {\n      clearTimeout(this._timer);\n    }\n    if(timeout > 0) {\n      this._timer = setTimeout(this.hide, timeout);\n    }\n    this.show();\n  },\n\n  show: function() {\n    this.$el.find(\"p\").stop().animate({marginTop: 0}, 500);\n  },\n\n  hide: function(tag) {\n    tag = tag || this.DEFAULT_TAG;\n    if(this._lastTag !== tag) return;\n    this.$el.find(\"p\").stop().animate({marginTop: 40}, 500);\n    this._timer = 0;\n    this._lastType = -1;\n    this._lastTag = this.DEFAULT_TAG;\n  },\n\n  listenGlobal: function() {\n    cdb.god.bind('error', this.showError, this);\n  }\n\n});\n","\n/**\n *  Common header for vis view ( table | derived )\n *\n *  - It needs a visualization model, config and user data.\n *\n *    var header = new cdb.admin.Header({\n *      el:       this.$('header'),\n *      model:    visusalization_model,\n *      user:     user_model,\n *      config:   config,\n *      geocoder: geocoder\n *    });\n *\n */\n\ncdb.admin.Header = cdb.core.View.extend({\n\n  _TEXTS: {\n    saving:         _t('Saving...'),\n    saved:          _t('Saved'),\n    error:          _t('Something went wrong, try again later'),\n    metadata: {\n      edit:         _t('Edit metadata...'),\n      view:         _t('View metadata...')\n    },\n    visualization: {\n      loader:       _t('Changing to visualization'),\n      created:      _t('Visualization created')\n    },\n    share: {\n      publish:        _t('PUBLISH'),\n      visualize:    _t('VISUALIZE')\n    },\n    share_privacy: {\n      ok_next:      _t('Share it now!')\n    },\n    rename: {\n      readonly:     _t('It is not possible to rename<br/>the dataset in <%- mode %> mode'),\n      owner:        _t('It is not possible to rename<br/>the dataset if you are not the owner')\n    }\n  },\n\n  _MAX_DESCRIPTION_LENGTH: 200,\n\n  events: {\n    'click a.title':        '_changeTitle',\n    'click .metadata a':    '_changeMetadata',\n    'click a.options':      '_openOptionsMenu',\n    'click a.share':        '_shareVisualization',\n    'click a.privacy':      '_showPrivacyDialog',\n    'click header nav a':   '_onTabClick'\n  },\n\n  initialize: function(options) {\n\n    _.bindAll(this, '_changeTitle', '_setPrivacy');\n\n    this.$body = $('body');\n    this.dataLayer = null;\n    this.globalError = this.options.globalError;\n    this._initBinds();\n\n    // Display all the visualization info\n    this.setInfo();\n  },\n\n  // Set new dataLayer from the current layerView\n  setActiveLayer: function(layerView) {\n    // Clean before bindings\n    if (this.dataLayer) {\n      this.dataLayer.unbind('applySQLView applyFilter errorSQLView clearSQLView', this.setEditableInfo,  this);\n      this.dataLayer.table.unbind('change:isSync', this.setEditableInfo, this);\n      this.dataLayer.table.unbind('change:permission', this.setInfo, this);\n    }\n\n    // Set new datalayer\n    this.dataLayer = layerView.model;\n\n    // Apply bindings if model is not a visualization\n    if (!this.model.isVisualization()) {\n      this.dataLayer.bind('applySQLView applyFilter errorSQLView clearSQLView', this.setEditableInfo,  this);\n      this.dataLayer.table.bind('change:isSync', this.setEditableInfo, this);\n      this.dataLayer.table.bind('change:permission', this.setInfo, this);\n      this.setEditableInfo();\n    }\n\n  },\n\n  _initBinds: function() {\n    this.model.bind('change:name',        this._setName,            this);\n    this.model.bind('change:type',        this.setInfo,             this);\n    this.model.bind('change:privacy',     this._setPrivacy,      this);\n    this.model.bind('change:permission',  this._setSharedCount,  this);\n  },\n\n  _openOptionsMenu: function(e) {\n    this.killEvent(e);\n\n    var self = this;\n    var $target = $(e.target);\n\n    // Options menu\n    this.options_menu = new cdb.admin.HeaderOptionsMenu({\n      target: $(e.target),\n      model: this.model, // master_vis\n      dataLayer: this.dataLayer,\n      user: this.options.user,\n      private_tables: this.options.user.get(\"actions\").private_tables,\n      geocoder: this.options.geocoder,\n      backgroundPollingModel: this.options.backgroundPollingModel,\n      globalError: this.options.globalError,\n      template_base: 'table/header/views/options_menu'\n    }).bind(\"onDropdownShown\",function(ev) {\n      cdb.god.unbind(\"closeDialogs\", self.options_menu.hide, self.options_menu);\n      cdb.god.trigger(\"closeDialogs\");\n      cdb.god.bind(\"closeDialogs\", self.options_menu.hide, self.options_menu);\n    }).bind('onDropdownHidden', function() {\n      this.clean();\n      $target.unbind('click');\n      cdb.god.unbind(null, null, self.options_menu);\n    });\n\n    this.$body.append(this.options_menu.render().el);\n    this.options_menu.open(e);\n  },\n\n  /**\n   *  Share visualization function, it could show\n   *  the name dialog to create a new visualization\n   *  or directly the share dialog :).\n   */\n  _shareVisualization: function(e) {\n    this.killEvent(e);\n\n    var view;\n    if (this.model.isVisualization()) {\n      view = new cdb.editor.PublishView({\n        clean_on_hide: true,\n        enter_to_confirm: true,\n        user: this.options.user,\n        model: this.model // vis\n      });\n    } else {\n      view = new cdb.editor.CreateVisFirstView({\n        clean_on_hide: true,\n        enter_to_confirm: true,\n        model: this.model,\n        router: window.table_router,\n        title: 'A map is required to publish',\n        explanation: 'A map is a shareable mix of layers, styles and queries. You can view all your maps in your dashboard.'\n      });\n    }\n    view.appendToBody();\n  },\n\n  _showPrivacyDialog: function(e) {\n    if (e) this.killEvent(e);\n\n    if (this.model.isOwnedByUser(this.options.user)) {\n      var dialog = new cdb.editor.ChangePrivacyView({\n        vis: this.model, //vis\n        user: this.options.user,\n        enter_to_confirm: true,\n        clean_on_hide: true\n      });\n      dialog.appendToBody();\n    }\n  },\n\n  /**\n   *  Set visualization info\n   */\n  setInfo: function() {\n    this._setName();\n    this._setSyncInfo();\n    this._setVisualization();\n    this._setMetadata();\n  },\n\n  /**\n   *  Set editable visualization info\n   */\n  setEditableInfo: function() {\n    this._setName();\n    this._setSyncInfo();\n    this._setMetadata();\n  },\n\n  _setPrivacy: function() {\n\n    var $share  = this.$('a.privacy');\n\n    // Update shared count if it is neccessary\n    this._setSharedCount();\n\n    var privacy = this.model.get(\"privacy\").toLowerCase();\n\n    if (privacy == \"public\") {\n\n      $share\n      .removeClass(\"private\")\n      .removeClass(\"link_protected\")\n      .removeClass(\"password_protected\")\n      .removeClass(\"organization\")\n      .addClass(\"public\");\n\n    } else if (privacy == \"link\"){\n\n      $share\n      .removeClass(\"public\")\n      .removeClass(\"private\")\n      .removeClass(\"password_protected\")\n      .removeClass(\"organization\")\n      .addClass(\"link_protected\");\n\n    } else if (privacy == \"private\"){\n\n      $share\n      .removeClass(\"public\")\n      .removeClass(\"link_protected\")\n      .removeClass(\"password_protected\")\n      .removeClass(\"organization\")\n      .addClass(\"private\");\n\n    } else if (privacy == \"password\"){\n\n      $share\n      .removeClass(\"private\")\n      .removeClass(\"link_protected\")\n      .removeClass(\"public\")\n      .removeClass(\"organization\")\n      .addClass(\"password_protected\");\n\n    } else if (privacy == \"organization\"){\n\n      $share\n      .removeClass(\"private\")\n      .removeClass(\"link_protected\")\n      .removeClass(\"public\")\n      .removeClass(\"password_protected\")\n      .addClass(\"organization\");\n\n    }\n\n    // User is owner of this visualization (table or derived)?\n    var isOwner = this.model.permission.isOwner(this.options.user);\n    $share.find('i')[ isOwner ? 'removeClass' : 'addClass' ]('disabled');\n\n  },\n\n  _setSharedCount: function() {\n    var isOwner = this.model.permission.isOwner(this.options.user);\n    var $share  = this.$('a.privacy i');\n\n    $share.empty();\n\n    if (isOwner) {\n      var $count = $('<span>').addClass('shared_users');\n\n      if (this.model.permission.acl.size() > 0) {\n        // Get total shared users or if the whole organization has access\n        var shared_users = 0;\n        var users_perm = this.model.permission.getUsersWithAnyPermission();\n\n        if (this.model.permission.isSharedWithOrganization()) {\n          shared_users = 'ORG';\n        } else {\n          shared_users = users_perm.length;\n        }\n\n        $count.text( (shared_users !== 0) ? shared_users : '' );\n\n        $share.append($count);\n      }\n    }\n  },\n\n  /**\n   *  Change metadata link text\n   */\n  _setMetadata: function() {\n    var isOwner = this.model.permission.isOwner(this.options.user);\n    var $metadata = this.$('.metadata a');\n\n    var text = this._TEXTS.metadata.edit;\n    var href = \"#/edit-metadata\";\n\n    if (!isOwner) {\n      text = this._TEXTS.metadata.view;\n      href = \"#/view-metadata\";\n    }\n\n    $metadata\n      .attr('href', href)\n      .text(text);\n  },\n\n  /**\n   *  Set layer sync info if it is needed\n   */\n  _setSyncInfo: function() {\n    this.sync_info && this.sync_info.clean();\n\n    if (!this.model.isVisualization() && this.isSyncTable()) {\n      this.$el.addClass('synced');\n\n      this.sync_info = new cdb.admin.SyncInfo({\n        dataLayer: this.dataLayer,\n        user: this.options.user\n      });\n\n      this.$('.sync_status').append(this.sync_info.render().el);\n      this.addView(this.sync_info);\n\n    } else {\n      this.$el.removeClass('synced');\n    }\n  },\n\n  /**\n   *  Set name of the visualization\n   */\n  _setName: function() {\n    var $title = this.$('h1 a.title');\n\n    $title\n      [(this.isVisEditable() && !this.isSyncTable()) ? 'removeClass' : 'addClass' ]('disabled')\n      .text(this.model.get('name'))\n\n    document.title = this.model.get('name') + \" | CARTO\";\n  },\n\n\n  /**\n   *  Set visualization type and change share button\n   */\n  _setVisualization: function() {\n    // Change visualization type\n    var $back            = this.$('a.back');\n    var $share           = this.$('a.share');\n    var is_visualization = this.model.isVisualization();\n\n    if (is_visualization) {\n      $share.find(\"span\").text(this._TEXTS.share.publish);\n      this._setPrivacy();\n      var route = cdb.config.prefixUrl() + \"/dashboard/maps\";\n      $back.attr(\"href\", route );\n    } else {\n      $share.find(\"span\").text(this._TEXTS.share.visualize);\n      this._setPrivacy();\n      var route = cdb.config.prefixUrl() + \"/dashboard/datasets\";\n      $back.attr(\"href\", route );\n    }\n  },\n\n  /**\n   *  Change visualization metadata\n   */\n  _changeMetadata: function(ev) {\n    ev.preventDefault();\n\n    var dlg = new cdb.editor.EditVisMetadataView({\n      maxLength: this._MAX_DESCRIPTION_LENGTH,\n      vis: this.model,\n      dataLayer: this.dataLayer && this.dataLayer.table,\n      user: this.options.user,\n      clean_on_hide: true,\n      enter_to_confirm: false,\n      onShowPrivacy: this._showPrivacyDialog.bind(this),\n      onDone: this._onChangeMetadata.bind(this)\n    });\n\n    dlg.appendToBody();\n  },\n\n  _onChangeMetadata: function(nameChanged) {\n    // Check if attr saved is name to change url when\n    // visualization is table type\n    if (nameChanged && !this.model.isVisualization()) {\n      window.table_router.navigate(this._generateTableUrl(), {trigger: false});\n      window.table_router.addToHistory();\n    }\n  },\n\n  /**\n   *  Change visualization title\n   */\n  _changeTitle: function(e) {\n    this.killEvent(e);\n\n    var self = this;\n    var isOwner = this.model.permission.isOwner(this.options.user);\n\n    if (this.isVisEditable()) {\n      this.title_dialog && this.title_dialog.clean();\n      cdb.god.trigger(\"closeDialogs\");\n\n      var title_dialog = this.title_dialog = new cdb.admin.EditTextDialog({\n        initial_value: this.model.get('name'),\n        template_name: 'table/views/edit_name',\n        clean_on_hide: true,\n        modal_class: 'edit_name_dialog',\n        onResponse: setTitle\n      });\n\n      cdb.god.bind(\"closeDialogs\", title_dialog.hide, title_dialog);\n\n      // Set position and show\n      var pos = $(e.target).offset();\n      pos.left -= $(window).scrollLeft()\n      pos.top -= $(window).scrollTop()\n      var w = Math.max($(e.target).width() + 100, 280);\n      title_dialog.showAt(pos.left - 20, pos.top - 10, w);\n    } else {\n      var $el = $(e.target);\n      $el\n        .bind('mouseleave', destroyTipsy)\n        .tipsy({\n          fade:     true,\n          trigger:  'manual',\n          html:     true,\n          title:    function() {\n            var mode = self.isSyncTable() ? 'sync' : 'read-only';\n            return _.template(self._TEXTS.rename[ !isOwner ? 'owner' : 'readonly' ])({ mode: mode })\n          }\n        })\n        .tipsy('show')\n    }\n\n    function destroyTipsy() {\n      var $el = $(this);\n      var tipsy = $el.data('tipsy');\n      if (tipsy) {\n        $el\n          .tipsy('hide')\n          .unbind('mouseleave', destroyTipsy);\n      }\n    }\n\n    function setTitle(val) {\n      if (val !== self.model.get('name') && val != '') {\n        // Sanitize description (html and events)\n        var title = cdb.Utils.stripHTML(val,'');\n\n        if (self.model.isVisualization()) {\n          self._onSetAttributes({ name: title });\n        } else {\n          // close any prev modal if existing\n          if (self.change_confirmation) {\n            self.change_confirmation.clean();\n          }\n          self.change_confirmation = cdb.editor.ViewFactory.createDialogByTemplate('common/dialogs/confirm_rename_dataset');\n\n          // If user confirms, app set the new name\n          self.change_confirmation.ok = function() {\n            self._onSetAttributes({ name: title });\n            if (_.isFunction(this.close)) {\n              this.close();\n            }\n          };\n\n          self.change_confirmation\n            .appendToBody()\n            .open();\n        }\n      }\n    }\n  },\n\n\n\n  /**\n   *  Wait function before set new visualization attributes\n   */\n  _onSetAttributes: function(d) {\n\n    var old_data = this.model.toJSON();\n    var new_data = d;\n\n    this.model.set(d, { silent: true });\n\n    // Check if there is any difference\n    if (this.model.hasChanged()) {\n      var self = this;\n\n      this.globalError.showError(this._TEXTS.saving, 'load', -1);\n\n      this.model.save({},{\n        wait: true,\n        success: function(m) {\n          // Check if attr saved is name to change url\n          if (new_data.name !== old_data.name && !self.model.isVisualization()) {\n            window.table_router.navigate(self._generateTableUrl(), {trigger: false});\n            window.table_router.addToHistory();\n          }\n\n          self.globalError.showError(self._TEXTS.saved, 'info', 3000);\n        },\n        error: function(msg, resp) {\n          var err =  resp && JSON.parse(resp.responseText).errors[0];\n          self.globalError.showError(err, 'error', 3000);\n          self.model.set(old_data, { silent: true });\n          self.setInfo();\n        }\n      });\n    }\n\n\n  },\n\n  /**\n   *  Check if visualization/table is editable\n   *  (Checking if it is visualization and/or data layer is in sql view)\n   */\n  isVisEditable: function() {\n    if (this.model.isVisualization()) {\n      return true;\n    } else {\n      var table = this.dataLayer && this.dataLayer.table;\n\n      if (!table) {\n        return false;\n      } else if (table && (table.isReadOnly() || !table.permission.isOwner(this.options.user))) {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  },\n\n\n  isSyncTable: function() {\n    if (this.dataLayer && this.dataLayer.table) {\n      return this.dataLayer.table.isSync();\n    }\n    return false;\n  },\n\n\n  _generateTableUrl: function(e) {\n    // Let's create the url ourselves //\n    var url = '';\n\n    // Check visualization type and get table or viz id\n    if (this.model.isVisualization()) {\n      url += '/viz/' + this.model.get('id');\n    } else {\n      var isOwner = this.model.permission.isOwner(this.options.user);\n      var table = new cdb.admin.CartoDBTableMetadata(this.model.get('table'));\n\n      // Qualify table urls if user is not the owner\n      if (!isOwner) {\n        var owner_username = this.model.permission.owner.get('username');\n        url += '/tables/' + owner_username + '.' + table.getUnqualifiedName();\n      } else {\n        url += '/tables/' + table.getUnqualifiedName();\n      }\n    }\n\n    // Get scenario parameter from event or current url (table or map)\n    var current = e ? $(e.target).attr('href') : window.location.pathname;\n    if (current.search('/map') != -1) {\n      url += '/map'\n    } else {\n      url += '/table'\n    }\n\n    return url;\n  },\n\n\n  _onTabClick: function(e) {\n    e.preventDefault();\n    window.table_router.navigate(this._generateTableUrl(e), {trigger: true});\n  }\n});\n","\n/**\n * use as global hotkey watcher:\n *\n * cdb.god.bind('hotkey:s', function() ...\n */\n\ncdb.admin.hotkeys = {\n\n  _keyMap: {\n    68: 's',\n    67: 'c',\n    83: 's'\n  },\n\n  enable: function() {\n    $('body').bind('keydown', function(e) {\n      if(e.altKey && e.ctrlKey) {\n        var evt = cdb.admin.hotkeys._keyMap[e.keyCode];\n        if(evt) {\n          cdb.god.trigger('hotkey:' + evt, e);\n          e.preventDefault();\n          e.stopPropagation();\n          return false;\n        }\n      }\n    });\n  }\n};\n","(function(){\n  var localStorageWrapper = function(name) {\n    this.name = name;\n  }\n\n  localStorageWrapper.prototype.get = function(n) {\n\n    if (localStorage.getItem(this.name)) {\n\n      if (n === undefined) {\n        return JSON.parse(localStorage.getItem(this.name));\n      } else {\n        var data = JSON.parse(localStorage.getItem(this.name));\n        return data[n];\n      }\n    } else {\n      return [];\n    }\n\n  }\n\n  localStorageWrapper.prototype.search = function(searchTerm) {\n    var wholeArray = JSON.parse(localStorage.getItem(this.name));\n    for(var i in wholeArray) {\n      if(wholeArray[i][searchTerm]) {\n        return wholeArray[i][searchTerm];\n      }\n    }\n    return null;\n  }\n\n  localStorageWrapper.prototype.set = function(data) {\n\n    if (!localStorage.getItem(this.name)) {\n      localStorage.setItem(this.name, \"[]\");\n    }\n    return localStorage.setItem(this.name, JSON.stringify(data));\n  }\n\n  localStorageWrapper.prototype.add = function(obj) {\n    var data = this.get();\n    if (data) {\n      data.push(obj);\n      return this.set(data);\n    }\n  }\n\n  localStorageWrapper.prototype.remove = function(n) {\n    var data = this.get();\n    data.splice(n,n);\n    return this.set(data);\n  }\n\n  localStorageWrapper.prototype.destroy = function() {\n    localStorage.removeItem(this.name);\n  }\n\n  cdb.admin.localStorage = localStorageWrapper;\n}())\n","\n  /**\n   *  Metrics class for CartoDB\n   *\n   *  - Track user events in CartoDB.\n   *  - When an event is launched, you can use our God to\n   *  save the action (cdb.god.trigger('metrics', '{{ metric_name }}', { email: {{ email }}, data: {{ data }} });).\n   *\n   *  new cdb.admin.Metrics();\n   */\n\n  cdb.admin.Metrics = cdb.core.Model.extend({\n\n    initialize: function(opts) {\n      this.bindEvents();\n    },\n\n    bindEvents: function() {\n      cdb.god.bind(\"metrics\", this._setTrack, this);\n    },\n\n    _setTrack: function(name, obj) {\n\n      // HubSpot tracking\n      if (window.hubspot_token) {\n        window._hsq = window._hsq || [];\n        window._hsq.push(['identify', {\n          email: obj.email\n        }]);\n\n        var event_id;\n\n        switch(name) {\n          case 'published_visualization':\n            event_id = window.hubspot_ids.published_visualization\n            break;\n          case 'visited_dashboard':\n            event_id = window.hubspot_ids.visited_dashboard\n            break;\n          case 'connect_dataset':\n            event_id = window.hubspot_ids.connect_dataset\n            break;\n          case 'create_map':\n            event_id = window.hubspot_ids.create_map\n            break;\n          case 'export_table':\n            event_id = window.hubspot_ids.export_table\n            break;\n          case 'export_map':\n            event_id = window.hubspot_ids.export_map;\n            break;\n          case 'select_wms':\n            event_id = window.hubspot_ids.select_wms\n            break;\n          case 'color_basemap':\n            event_id = window.hubspot_ids.color_basemap\n            break;\n          case 'pattern_basemap':\n            event_id = window.hubspot_ids.pattern_basemap\n            break;\n          case 'geocoding':\n            event_id = window.hubspot_ids.geocoding\n            break;\n          case 'visual_merge':\n            event_id = window.hubspot_ids.visual_merge\n            break;\n          case 'common_data':\n            event_id = window.hubspot_ids.common_data\n            break;\n          case 'cartocss_manually':\n            event_id = window.hubspot_ids.cartocss_manually\n            break;\n          case 'wizard':\n            event_id = window.hubspot_ids.wizard\n            break;\n          case 'filter':\n            event_id = window.hubspot_ids.filter\n            break;\n          case 'query':\n            event_id = window.hubspot_ids.query\n            break;\n          case 'logged_in':\n            event_id = window.hubspot_ids.logged_in\n            break;\n          case 'visited_dashboard_first_time':\n            event_id = window.hubspot_ids.visited_dashboard_first_time\n            break;\n          case 'applied_pecan':\n            event_id = window.hubspot_ids.applied_pecan\n            break;\n          case 'open_pecan_list':\n            event_id = window.hubspot_ids.open_pecan_list\n            break;\n\n        }\n\n        window._hsq.push(['trackEvent', {\n          id: event_id\n        }]);\n      }\n\n    }\n\n  });\n","/**\n * base class for all small dialogs\n * inherit from this class, see EditTextDialog\n * for an example\n */\ncdb.admin.SmallDialog = cdb.ui.common.Dialog.extend({\n\n  className: 'floating',\n\n  initialize: function() {\n    _.extend(this.options, {\n              title: '',\n              description: '',\n              clean_on_hide: true\n    });\n    cdb.ui.common.Dialog.prototype.initialize.apply(this);\n    this.render();\n    $(document.body).append(this.el);\n  },\n\n  /** show at position */\n  showAt: function(x, y, width, fix) {\n    this.$el.css({\n      top: y,\n      left: x,\n      minWidth: width\n    });\n\n    if (fix) {\n      this.$el.find(\"> textarea, > input\").css({\n        minWidth: width - 22\n      })\n    }\n\n    this.show();\n  },\n\n  /**\n   * show the dialog on top of an element\n   * useful in events:\n      dlg.showAtElement(e.target);\n   */\n  showAtElement: function(el) {\n    var pos = $(el).offset();\n    this.showAt(pos.left, pos.top);\n  }\n});\n\ncdb.admin.EditTextDialog = cdb.admin.SmallDialog.extend({\n\n  events: cdb.core.View.extendEvents({\n    'keypress input': '_keyPress',\n    'click': '_stopPropagation'\n  }),\n\n  initialize: function() {\n    _.defaults(this.options, {\n      template_name: 'old_common/views/dialog_small_edit',\n      ok_title: 'Save',\n      modal_class: 'edit_text_dialog',\n      clean_on_hide: true\n    });\n    this.constructor.__super__.initialize.apply(this);\n  },\n\n  render_content: function() {\n    this._focusInput();\n    var input = '<input value=\"' + this.options.initial_value.replace(/\\\"/g,'&quot;').replace(/\\'/g,\"&#39;\") + '\" ';\n    if(this.options.maxLength) {\n      input += 'maxLength = ' + this.options.maxLength;\n    }\n    input += ' type=\"text\"/>';\n    return input;\n  },\n\n  _stopPropagation: function(e) {\n    e.stopPropagation();\n  },\n\n  _focusInput: function() {\n    var self = this;\n    setTimeout(function(){\n      var width = self.$el.outerWidth() - self.$el.find(\"a.button\").outerWidth() - 35;\n      self.$el.find(\"input\").width(width).focus();\n    },0);\n  },\n\n  _keyPress: function(e) {\n    if(e.keyCode === 13) {\n      this._ok();\n    }\n  },\n\n  ok: function() {\n    if(this.options.onResponse) {\n      this.options.onResponse(this.$('input').val());\n    }\n  }\n});\n\ncdb.admin.EditMarkdownDialog = cdb.admin.SmallDialog.extend({\n\n  events: cdb.core.View.extendEvents({\n    'keypress input': '_keyPress',\n    'click': '_stopPropagation'\n  }),\n\n  initialize: function() {\n    _.defaults(this.options, {\n      old_template_name: 'old_common/views/dialog_markdown_edit',\n      ok_title: 'Save',\n      modal_class: 'edit_name_dialog markdown',\n      clean_on_hide: true\n    });\n    this.constructor.__super__.initialize.apply(this);\n  },\n\n  render_content: function() {\n    this._focusInput();\n    var input = '<div class=\"input_field\"><input value=\"' + this.options.initial_value.replace(/\\\"/g,'&quot;').replace(/\\'/g,\"&#39;\") + '\" ';\n    if(this.options.maxLength) {\n      input += 'maxLength = ' + this.options.maxLength;\n    }\n    input += ' type=\"text\"/><div class=\"hint\"><strong>**bold**</strong> <em>*italics*</em> [link title](url)</div></div>';\n    return input;\n  },\n\n  _stopPropagation: function(e) {\n    e.stopPropagation();\n  },\n\n  _focusInput: function() {\n    var self = this;\n    setTimeout(function(){\n      var width = self.$el.outerWidth() - self.$el.find(\"a.button\").outerWidth() - 35;\n      self.$el.find(\".input_field\").width(width);\n      self.$el.find(\".input_field input\").focus();\n    },0);\n  },\n\n  _keyPress: function(e) {\n    if(e.keyCode === 13) {\n      this._ok();\n    }\n  },\n\n  ok: function() {\n    if(this.options.onResponse) {\n      this.options.onResponse(this.$('input').val());\n    }\n  }\n\n \n});","\ncdb.admin.Tabs = cdb.core.View.extend({\n\n    events: {\n      'click': '_click'\n    },\n\n    initialize: function() {\n      _.bindAll(this, 'activate');\n      this.preventDefault = false;\n    },\n\n    activate: function(name) {\n      this.$('a').removeClass('selected');\n      this.$('a[href$=\"#'+ ((this.options.slash) ? '/' : '') + name + '\"]').addClass('selected');\n    },\n\n    desactivate: function(name) {\n      this.$('a[href$=\"#' + ((this.options.slash) ? '/' : '') + name + '\"]').removeClass('selected');\n    },\n\n    disable: function(name) {\n      this.$('a[href$=\"#' + ((this.options.slash) ? '/' : '') + name + '\"]').addClass('disabled');\n    },\n\n    enable: function(name) {\n      this.$('a[href$=\"#' + ((this.options.slash) ? '/' : '') + name + '\"]').removeClass('disabled');\n    },\n\n    getTab: function(name) {\n      return this.$('a[href$=\"#' + ((this.options.slash) ? '/' : '') + name + '\"]');\n    },\n\n    disableAll: function() {\n      this.$('a').addClass('disabled');\n    },\n\n    removeDisabled: function() {\n      this.$('.disabled').parent().remove();\n    },\n\n    _click: function(e) {\n      if (e && this.preventDefault) e.preventDefault();\n\n      var\n      t    = $(e.target).closest('a'),\n      href = t.attr('href');\n\n      if (!t.hasClass('disabled') && href) {\n        var name = href.replace('#/', '#').split('#')[1];\n        this.trigger('click', name);\n      }\n    },\n\n    linkToPanel: function(panel) {\n      this.preventDefault = true;\n      panel.bind('tabEnabled', this.activate, this);\n      this.bind('click', panel.active, panel);\n    }\n\n});\n","\n  /**\n   *  Tipsy tooltip view.\n   *\n   *  - Needs an element to work.\n   *  - Inits tipsy library.\n   *  - Clean bastard tipsy bindings easily.\n   *\n   */\n\n\n  cdb.common.TipsyTooltip = cdb.core.View.extend({\n\n    options: {\n      gravity:  's',\n      fade:     true\n    },\n\n    initialize: function(opts) {\n      if (opts.el === undefined) {\n        cdb.log.info('Element is needed to have tipsy tooltip working');\n        return false;\n      }\n      this._tipsyOpenedManually = opts.trigger === 'manual';\n\n      this._initTipsy();\n    },\n\n    showTipsy: function() {\n      this.$el.tipsy('show');\n    },\n\n    hideTipsy: function() {\n      this.$el.tipsy('hide');\n    },\n\n    _initTipsy: function() {\n      this.$el.tipsy(this.options);\n      this.tipsy = this.$el.data('tipsy');\n    },\n\n    _destroyTipsy: function() {\n      if (this.tipsy) {\n        // tipsy does not return this\n        this.tipsy.hide();\n        this.$el.unbind('mouseleave mouseenter');\n      }\n      if (this._tipsyOpenedManually) {\n        this.$el.tipsy('hide');\n      }\n    },\n\n    clean: function() {\n      this._destroyTipsy();\n      cdb.core.View.prototype.clean.call(this);\n    }\n\n  });\n","\n  /**\n   *  Tooltip that follows the mouse while dragging, you have\n   *   to use jQuery UI lib to get events when dragging.\n   */\n\n  cdb.admin.TooltipTrails = cdb.core.View.extend({\n\n    className: 'tooltip-trails',\n    tagName: 'div',\n\n    options: {\n      msg: _t('Checking tooltip-trails'),\n      offset: [15,5] // X,Y\n    },\n\n    render: function() {\n      this.$el.append(this.options.msg);\n      return this;\n    },\n\n    show: function(pos) {\n      this.$el.css({\n        'margin-left': this.options.offset[0],\n        'margin-top': this.options.offset[1],\n        'left':  pos.left,\n        'top': pos.top\n      })\n\n      this.$el.show();\n    },\n\n    // Needs left and top object\n    move: function(pos) {\n      this.$el.css(pos);\n    },\n\n    hide: function() {\n      this.$el.hide();\n      this.clean();\n    }\n\n  })","/**\n * URL representing dashboard datasets\n */\ncdb.common.DashboardDatasetsUrl = cdb.common.DashboardVisUrl.extend({\n\n  dataLibrary: function() {\n    return this.urlToPath('library');\n  }\n});\n","/**\n * URLs associated with the dashboard.\n */\ncdb.common.DashboardUrl = cdb.common.Url.extend({\n\n  datasets: function() {\n    return new cdb.common.DashboardDatasetsUrl({\n      base_url: this.urlToPath('datasets')\n    });\n  },\n\n  maps: function() {\n    return new cdb.common.DashboardVisUrl({\n      base_url: this.urlToPath('maps')\n    });\n  },\n\n  deepInsights: function() {\n    return new cdb.common.DashboardVisUrl({\n      base_url: this.urlToPath('deep-insights')\n    });\n  }\n});\n","/**\n * URL for a dataset (standard vis).\n */\ncdb.common.DatasetUrl = cdb.common.Url.extend({\n\n  edit: function() {\n    return this.urlToPath();\n  },\n\n  public: function() {\n    return this.urlToPath('public');\n  }\n});\n","/**\n * URL for a map (derived vis).\n */\ncdb.common.MapUrl = cdb.common.Url.extend({\n\n  edit: function() {\n    return this.urlToPath('map');\n  },\n\n  public: function() {\n    return this.urlToPath('public_map');\n  },\n\n  deepInsights: function() {\n    return this.urlToPath('deep-insights');\n  }\n});\n","/**\n * URL for a map (derived vis).\n */\ncdb.common.OrganizationUrl = cdb.common.Url.extend({\n\n  edit: function(user) {\n    if (!user) {\n      throw new Error('User is needed to create the url');\n    }\n    return this.urlToPath(user.get('username') + '/edit');\n  },\n\n  create: function() {\n    return this.urlToPath('new');\n  },\n\n  groups: function() {\n    return this.urlToPath('groups');\n  }\n\n});\n","/**\n * URLs associated with a particular user.\n */\ncdb.common.UserUrl = cdb.common.Url.extend({\n\n  initialize: function (attrs) {\n    cdb.common.Url.prototype.initialize.apply(this, arguments);\n    if (_.isUndefined(attrs.is_org_admin)) {\n      throw new Error('is_org_admin is required')\n    }\n  },\n\n  organization: function() {\n    if (this.get('is_org_admin')) {\n      return new cdb.common.OrganizationUrl({\n        base_url: this.urlToPath('organization')\n      });\n    } else {\n      return this.urlToPath('account');\n    }\n  },\n\n  accountSettings: function() {\n    return this.urlToPath('profile');\n  },\n\n  publicProfile: function() {\n    return this.urlToPath('me');\n  },\n\n  apiKeys: function() {\n    return this.urlToPath('your_apps');\n  },\n\n  logout: function() {\n    return this.urlToPath('logout');\n  },\n\n  dashboard: function() {\n    return new cdb.common.DashboardUrl({\n      base_url: this.urlToPath('dashboard')\n    });\n  }\n});\n","\n\n  /*\n   *  Utils for CartoDB App\n   */\n\n  cdb.Utils = {};\n\n\n  /*\n   *  Strip html tags from a value.\n   *  input ->  string with input text (example: '<a href=\"#whoknows\">Jamon</a> </br> <p>Vamos</p>')\n   *  allowed -> allowed html tags in the result (example: '<a>')\n   *\n   *  return -> '<a href=\"#whoknows\">Jamon</a> Vamos'\n   */\n\n  cdb.Utils.stripHTML = function(input, allowed) {\n    allowed = (((allowed || \"\") + \"\").toLowerCase().match(/<[a-z][a-z0-9]*>/g) || []).join('');\n    var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n    if (!input || (typeof input != \"string\")) return '';\n    return input.replace(tags, function ($0, $1) {\n      return allowed.indexOf('<' + $1.toLowerCase() + '>') > -1 ? $0 : '';\n    });\n  }\n\n\n  /*\n   *  Remove events attached in html code.\n   *  input ->  string with input text (example: '<a href=\"#whoknows\" onClick=\"alert('jamon')\">Jamon</a>')\n   *\n   *  return -> '<a href=\"#whoknows\">Jamon</a>'\n   */\n\n  cdb.Utils.removeHTMLEvents = function(input) {\n    if (input) {\n      return input.replace(/ on\\w+=\"[^\"]*\"/g, '');\n    } else {\n      return '';\n    }\n  }\n\n  /*\n   *  Truncate a string\n   *  input -> string with input text\n   *  length -> length of the output string\n   *\n   *  return -> true\n   */\n\n  cdb.Utils.truncate = function(input, length) {\n    return input.substr(0, length-1) + (input.length > length ? '&hellip;' : '');\n  }\n\n\n  /*\n   *  Simple regex to check if string is an url/ftp\n   *  input ->  string with input text (example: 'https://carto.com')\n   *\n   *  return -> true\n   */\n\n  cdb.Utils.isURL = function(input) {\n    var urlregex = /^((http|https|ftp)\\:\\/\\/)/g;\n    if (input) {\n      return urlregex.test(input);\n    } else {\n      return false;\n    }\n  }\n\n\n  cdb.Utils.encodeURLParams = function(url) {\n    if (this.isURL(url)) {\n      var urlParts = url.split('?');\n      if (urlParts.length > 1) {\n        return urlParts[0] + '?' + encodeURIComponent(urlParts[1]);\n      } else {\n        return url;\n      }\n    }\n    return url;\n  }\n\n\n  /*\n   *  Transform bytes to a readable format, like MB, GB\n   *  input ->  34234244\n   *\n   *  return -> 3 MB\n   */\n\n  cdb.Utils.readablizeBytes = function(bytes, round) {\n    if (!bytes || isNaN(bytes)) {\n      return 0;\n    }\n    var s = ['bytes', 'kB', 'MB', 'GB', 'TB', 'PB'];\n    var e = Math.floor(Math.log(bytes)/Math.log(1024));\n    var value = (bytes/Math.pow(1024, Math.floor(e))).toFixed(2);\n\n    if (round) { value = parseInt(value) }\n\n    return value + \" \" + s[e];\n  }\n\n  /*\n   * isEmpty\n   *\n   */\n  cdb.Utils.isEmpty = function(str) {\n    return (!str || 0 === str.length);\n  }\n\n  /*\n   * isBlank\n   *\n   */\n  cdb.Utils.isBlank = function(str) {\n    return (!str || /^\\s*$/.test(str));\n  }\n\n  /*\n   * formatNumber: adds thousands separators\n   * @return a string\n   *\n   */\n  cdb.Utils.formatNumber = function(x) {\n    if (!x) return \"0\";\n    var parts = x.toString().split(\".\");\n    parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n    return parts.join(\".\");\n  }\n\n  /*\n   * rgbToHex\n   *\n   */\n  cdb.Utils.rgbToHex = function(r, g, b) {\n\n    function componentToHex(c) {\n      var hex = c.toString(16);\n      return hex.length == 1 ? \"0\" + hex : hex;\n    }\n\n    return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n  }\n\n  /*\n   * hexToRGB\n   *\n   */\n  cdb.Utils.hexToRGB = function(hex) {\n\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\n    return result ? {\n      r: parseInt(result[1], 16),\n      g: parseInt(result[2], 16),\n      b: parseInt(result[3], 16)\n    } : null;\n\n  }\n\n\n  /*\n   *  Generate random password\n   *\n   */\n\n  cdb.Utils.genRandomPass = function(length) {\n\n    function getRandomNum() {\n      // between 0 - 1\n      var rndNum = Math.random()\n      // rndNum from 0 - 1000\n      rndNum = parseInt(rndNum * 1000);\n      // rndNum from 33 - 127\n      rndNum = (rndNum % 94) + 33;\n      return rndNum;\n    }\n\n    function checkPunc(num) {\n      if ((num >=33) && (num <=47)) { return true; }\n      if ((num >=58) && (num <=64)) { return true; }\n      if ((num >=91) && (num <=96)) { return true; }\n      if ((num >=123) && (num <=126)) { return true; }\n      return false;\n    }\n\n    length = isNaN(length) ? \"\" : length\n    var pass = \"\";\n    var randomLength = !length ? true : false;\n\n    if (randomLength) {\n      length = Math.random();\n      length = parseInt(length * 100);\n      length = (length % 7) + 6\n    }\n\n    for (i=0; i < length; i++) {\n      numI = getRandomNum();\n      while (checkPunc(numI)) { numI = getRandomNum() }\n      pass = pass + String.fromCharCode(numI);\n    }\n\n    return pass;\n  }\n\n\n  /**\n   *  Add leading zeros to numbers\n   *\n   */\n  cdb.Utils.pad = function(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n  }\n\n\n  /**\n   *  Remove all non-common characters like\n   *  spaces, quotes, accents, etc...\n   *\n   */\n  cdb.Utils.sanitizeString = function(str) {\n    return str.replace(/[^a-z0-9\\s]/gi, '').replace(/[_\\s]/g, '-');\n  }\n\n  /**\n   *  Convert long numbers to\n   *  readizable numbers.\n   *\n   */\n  cdb.Utils.readizableNumber = function(num) {\n    if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'G';\n    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';\n    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';\n    return num;\n  }\n\n  /**\n   *  Get the extension of a string\n   *\n   */\n  cdb.Utils.getFileExtension = function(str) {\n    if (!str) return '';\n\n    return str.substr(str.lastIndexOf('.') + 1);\n  }\n\n\n  /**\n   *  Get ordinal string from a number\n   *\n   */\n  cdb.Utils.getGetOrdinal = function(n) {\n    if (!n) {\n      return '';\n    }\n    var s = [\"th\",\"st\",\"nd\",\"rd\"];\n    var v = n%100;\n    return n+(s[(v-20)%10]||s[v]||s[0]);\n  }\n\n  cdb.Utils.capitalize = function(str) {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  };\n\n  cdb.Utils.isValidEmail = function(str) {\n    var re = /^([^@]+)@([^@]+)\\.([^@\\.]+)$/i;\n    return re.test(str);\n  }\n\n  /**\n   * Similar to _.result, but also allows passing arbitrary arguments to the property if it's function.\n   * This makes code more terse  when one just wants to use a value if it's available, no if-checks required.\n   *\n   * @example Expected output\n   *   model.set('something', 'yay');\n   *   cdb.Utils.result(model, 'get', 'something') // => 'yay'\n   *   cdb.Utils.result(model, 'nonexisting', 'else') // => undefined\n   *   cdb.Utils.result(undefinedVar, 'get') // => null\n   *\n   * @example Of usage\n   *  return cdb.Utils.result(model, 'get', 'mightNotExist') === 'OK'\n   *\n   * @param {*} maybeFn\n   * @return {*} Result from called maybeFn if a function, null otherwise\n   */\n  cdb.Utils.result = function(object, property) {\n    if (object == null) return null;\n    var value = object[property];\n    return _.isFunction(value) ? value.apply(object, Array.prototype.slice.call(arguments, 2)) : value;\n  };\n\n  /*\n   * Returns a (double) quoted table name if needed (if it contains a dash, for example).\n   * Coupled to backend lib/carto/table_utils.rb#safe_table_name_quoting.\n   * Duplicated at lib/assets/javascripts/cartodb3/helpers/utils.js to make it available for older models.\n   */\n  cdb.Utils.safeTableNameQuoting = function (table_name) {\n    if (table_name === undefined || table_name.indexOf('-') === -1 || table_name[0] === '\"' || table_name[table_name.length - 1] === '\"') {\n      return table_name;\n    } else {\n      return '\"' + table_name + '\"';\n    }\n  };\n","/**\n *  Video player\n *\n */\ncdb.admin.VideoModel = cdb.core.Model.extend({\n\n  defaults: {\n    minimized: true,\n    size: {\n      minimized: {\n        width: 420,\n        height: 236\n      },\n      maximized: {\n        width : 700,\n        height: 393\n      }\n    },\n  },\n\n  initialize: function () {\n\n    this._initLocalStorage();\n\n    var minimized = this.defaults.minimized;\n\n    if (this.videoData && this.videoData.minimized !== undefined) {\n      minimized = this.videoData.minimized;\n    }\n\n    var defaults = this.defaults.size[minimized ? \"minimized\" : \"maximized\"];\n\n    this.set({\n      minimized: minimized,\n      width: defaults.width,\n      height: defaults.height,\n      seconds: this.videoData ? this.videoData.seconds : 0,\n      top: this.videoData ? this.videoData.top : null,\n      left: this.videoData ? this.videoData.left : 20,\n      bottom: this.videoData ? this.videoData.bottom : 20\n    });\n\n    this.bind('change',  this._onChangeProperty, this);\n    this.bind('change:minimized', this._onChangeMinimized, this);\n\n  },\n\n  _initLocalStorage: function() {\n\n    this.localStorage = new cdb.admin.localStorage(\"VideoPlayer\");\n\n    this.videoData = this.localStorage.get(\"currentVideo\") || {};\n\n    var video_id = this.get(\"video_id\");\n\n    if (video_id) {\n      this._storeVideoID(video_id);\n      this.videoData = this.localStorage.get(\"currentVideo\");\n    } else {\n      this.set(\"video_id\", this.videoData.video_id);\n    }\n\n  },\n\n  _onChangeMinimized: function() {\n    var defaults = this.defaults.size[this.get(\"minimized\") ? \"minimized\" : \"maximized\"];\n    this.set(\"width\", defaults.width);\n    this.set(\"height\", defaults.height);\n\n  }, \n\n  _onChangeProperty: function(m) {\n    this.videoData = m.attributes;\n    this._saveVideoData();\n  },\n\n  _saveVideoData: function() {\n    this.set(this.videoData);\n    this.localStorage.set({ currentVideo: this.videoData });\n  },\n\n  _storeVideoID: function(id) {\n    this.videoData.video_id = id;\n    this._saveVideoData();\n  },\n\n  clearStoredData: function(status) {\n    this.set(\"video_id\", null);\n    this.videoData = {};\n    this.localStorage.set({ currentVideo: null });\n  }\n\n});\n\ncdb.admin.VideoPlayer = cdb.core.View.extend({\n\n  className: 'VideoPlayer',\n\n  events: {\n    \"dblclick\": \"_toggle\",\n    \"click .js-toggle\": \"_toggle\",\n    \"click .js-close\": \"close\",\n    \"mouseenter\": \"_mouseEnter\",\n    \"mouseleave\": \"_mouseLeave\"\n  },\n\n  initialize: function(id) {\n\n    _.bindAll(this, \"_onInitDraggable\", \"_onStopDragging\", \"_onCloseAnimationFinished\");\n\n    this.template = cdb.templates.getTemplate('dashboard/views/video_player');\n\n    this._initModel();\n  },\n\n  render: function() {\n\n    var self = this;\n\n    this.clearSubViews();\n\n    if (this.hasVideoData()) {\n\n      this.$el.html(\n        this.template({\n        id: this.model.get(\"video_id\")\n      }));\n\n      this.$el.draggable({\n        stop: self._onStopDragging,\n        create: self._onInitDraggable\n      });\n\n      this.video = this.$el.find(\"iframe\");\n      this._loadScript();\n\n    }\n\n    return this;\n\n  },\n\n  _initModel: function() {\n    this.model = new cdb.admin.VideoModel({ video_id: this.options.id });\n    this.model.bind('change:minimized', this._onChangeMinimized, this);\n  },\n\n  _loadScript: function() {\n    var self = this;\n    $.getScript('//f.vimeocdn.com/js/froogaloop2.min.js', function() {\n      self._initVideoBinds();\n    });\n  },\n\n  _initVideoBinds: function() {\n    var self = this;\n\n    this.player = $f(this.video[0]);\n\n    this.player.addEvent('ready', function() {\n\n      self._seekToStoredPosition();\n\n      self.player.addEvent('pause', function(m) {\n        self.model.set(\"status\", \"stop\");\n      });\n\n      self.player.addEvent('finish', function(m) {\n        self.model.set(\"status\", \"stop\");\n        self.close(false, { dontHide: true });\n      });\n\n      self.player.addEvent('play', function(m) {\n        self.model.set(\"status\", \"play\");\n      });\n\n      self.player.addEvent('playProgress', function(m) {\n        self.model.set(\"seconds\", m.seconds);\n      });\n\n    });\n  },\n\n  _removeVideoBinds: function() {\n    if (this.player) {\n      this.player.removeEvent('ready');\n    }\n  },\n\n  _onInitDraggable: function(e, ui) {\n\n    var bottom       = this.model.get(\"bottom\");\n    var left         = this.model.get(\"left\");\n    var elHeight     = this.model.get(\"height\");\n    var elWidth      = this.model.get(\"width\");\n    var windowWidth  = $(window).width();\n\n    if ((left + elWidth) > windowWidth) {\n      left = windowWidth - elWidth - 20;\n    }\n\n    this.$el.css({\n      position: \"fixed\",\n      left: left,\n      bottom: bottom\n    });\n\n    if (bottom < 0) {\n      this.$el.animate({ bottom: 20, width: elWidth, height: elHeight }, { easing: \"easeOutQuad\", duration: 200 });\n    } else {\n      this.$el.animate({ width: elWidth, height: elHeight }, { easing: \"easeOutQuad\", duration: 200 });\n    }\n\n  },\n\n  _onStopDragging: function(e, ui) {\n\n    var windowHeight = $(window).height();\n    var top          = ui.position.top;\n    var left         = ui.position.left;\n    var bottom       = windowHeight - (top + this.$el.outerHeight(true));\n\n    this.$el.css({ bottom: \"auto\"})\n\n    this.model.set({ top: top, left: left, bottom: bottom });\n  },\n\n  _mouseEnter: function() {\n    this.$el.find(\".VideoControls\").fadeIn(150);\n  },\n\n  _mouseLeave: function() {\n    this.$el.find(\".VideoControls\").fadeOut(150);\n  },\n\n  hasVideoData: function() {\n    if (this.model.get(\"video_id\")) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n\n  _seekToStoredPosition: function() {\n\n    var self = this;\n\n    var seconds = this.model.get(\"seconds\");\n\n    if (seconds) {\n      this.player.api('seekTo', seconds);\n    }\n\n    if (this.model.get(\"status\") === \"stop\") {\n\n      setTimeout(function() {\n        self.player.api('pause');\n      }, 100);\n\n    }\n\n  },\n\n  close: function(e, opts) {\n\n    if (e) this.killEvent(e);\n\n    if (opts && opts.dontHide) {\n      this.model.clearStoredData();\n    } else {\n      this.$el.animate({ width: 0, height: 0, opacity: 0 }, { easing: \"easeInQuad\", duration: 200, complete: this._onCloseAnimationFinished });\n    }\n\n  },\n\n  _onCloseAnimationFinished: function() {\n    this.model.clearStoredData();\n    this._removeVideoBinds();\n    this.remove();\n  },\n\n  _toggle: function(e) {\n\n    if (e) this.killEvent(e);\n\n    this.model.set(\"minimized\", !!!this.model.get(\"minimized\"));\n  },\n\n  _onChangeMinimized: function() {\n\n    var self = this;\n\n    var windowWidth    = $(window).width();\n    var windowHeight   = $(window).height();\n    var documentHeight = $(document).height();\n\n    var bottom = this.model.get(\"bottom\");\n    var top    = this.model.get(\"top\");\n\n    var elTop  = this.$el.offset().top;\n    var elLeft = this.$el.position().left;\n\n    function setHorizontalPosition(w) {\n      if ((elLeft + w) > windowWidth) {\n        var right = windowWidth - elLeft - self.$el.outerWidth(true);\n        self.$el.css({ left: \"auto\", right: right });\n      }\n    }\n\n    function setVerticalPosition(h) {\n       if (top < 0 || self.$el.offset().top < 0) {\n        self.$el.animate({ top: 20 }, 100);\n       } else if (top - h < 0 || self.$el.offset().top - h < 0) {\n        self.$el.css({ bottom: \"auto\", top: top });\n      } else if (bottom < 0) {\n        self.$el.css({ top: \"auto\", bottom: 20 });\n      } else if ((top + h) > windowHeight) {\n        self.$el.css({ top: \"auto\", bottom: bottom });\n      } \n    }\n\n    var width  = this.model.get(\"width\");\n    var height = this.model.get(\"height\");\n\n    setHorizontalPosition(width);\n    setVerticalPosition(height);\n\n    this.$el.animate({ width: width, height: height }, { easing: \"easeOutQuad\", duration: 200, complete: function() {\n      var bottom = $(window).height() - ($(\".VideoPlayer\").offset().top + $(\".VideoPlayer\").outerHeight(true));\n      self.model.set(\"bottom\", bottom);\n    } });\n\n  }\n\n});\n","\n\ncdb.admin.WizardDialog = cdb.ui.common.Dialog.extend({\n});\n","  /**\n   *  Editor small dialog where cell editor will be placed on it.\n   */\n\n  cdb.admin.SmallEditorDialog = cdb.admin.SmallDialog.extend({\n\n    initialize: function() {\n      _.defaults(this.options, {\n        template_name: 'old_common/views/dialog_small_edit',\n        ok_title: 'Save',\n        modal_class: 'edit_text_dialog',\n        clean_on_hide: true\n      });\n\n      cdb.ui.common.Dialog.prototype.initialize.apply(this);\n      this.render();\n\n      // Ouch!!\n      $(document.body).find(\"div.table table\").append(this.el);\n    },\n\n    /**\n     *  Render correct editor\n     */\n    render_content: function() {\n      var $content  = $('<div>');\n      \n      if (this.options.editorField) {\n        this.editor   = new this.options.editorField({\n                        label:      false,\n                        autoResize: false,\n                        rowNumber:  this.options.rowNumber,\n                        row:        this.options.row,\n                        readOnly:   this.options.readOnly,\n                        model: new cdb.core.Model({\n                          attribute:  this.options.column,\n                          value:      this.options.value\n                        })\n                      }).bind(\"ENTER\", this._ok, this);\n\n        $content.append(this.editor.render().el);\n        this.addView(this.editor);\n      }\n\n      return $content;\n    },\n\n\n    /**\n     *  Overwriting the show function\n     */\n    showAt: function(x, y, width, fix) {\n      this.$el.css({\n        top: y,\n        left: x,\n        minWidth: width\n      });\n\n      if (fix) {\n        this.$el.find(\"textarea\").css({\n          'min-width': width - 22\n        })\n      }\n\n      this.show();\n      this.$el.find(\"textarea, input\")\n        .focus()\n        .select();\n    },\n\n\n    /**\n     *  Ok button function\n     */\n    _ok: function(ev) {\n      if(ev) ev.preventDefault();\n\n      // If the time is not ok, the dialog is not correct\n      if (!this.editor.isValid()) {\n        return false;\n      }\n\n      if (this.options.res) {\n        this.options.res(this.editor.model.get('value'));\n      }\n\n      this.hide();\n    }\n\n  });\n","/**\n * this infowindow is shown in the map when user clicks on a feature\n */\n\n(function() {\n\n  var MapInfowindow = cdb.geo.ui.Infowindow.extend({\n\n    _TEXTS: {\n      _NO_FIELDS_SELECTED:        _t(\"You haven’t selected any fields to be shown in the infowindow.\"),\n      _NO_FIELDS_SELECTED_BUTTON: _t(\"Select fields\")\n    },\n\n    _TEMPLATE_URL: 'table/views/infowindow/templates',\n\n    events: cdb.core.View.extendEvents({\n      'click .edit_data': '_editData',\n      'click .edit_geo':  '_editGeom',\n      'click .remove':    '_removeGeom',\n      'click .open_infowindow_panel': '_openInfowindowPanel'\n    }),\n\n    initialize: function() {\n      var self = this;\n      _.bindAll(this, '_removeGeom');\n      this.table = this.options.table;\n      this.model.set({ content: 'loading...' });\n      // call parent\n      this.constructor.__super__.initialize.apply(this);\n      this.model.set('offset', [28, 0]);\n      this.model.bind('change:fields', function() {\n        if (!this.hasChanged('content') && self.row) {\n          self.renderInfo();\n        }\n      });\n\n      this.table.bind('change:schema', this.render, this);\n      this.add_related_model(this.table);\n\n      // Create a help dialog for the infowindows with images\n      if (this._containsCover) this._createHelpDialog();\n\n      // Set live tipsy when geom is enabled or disabled\n      this.$(\"div.cartodb-edit-buttons a.button\").tipsy({\n        live:true,\n        fade:true,\n        gravity: 's',\n        offset: -2,\n        className: function(){\n          return $(this).closest(\".cartodb-popup\").hasClass('dark') ? 'dark' : ''\n        },\n        title: function(ev){\n          var enabled = !$(this).hasClass(\"disabled\");\n          if (enabled) {\n            return $(this).text()\n          } else {\n            return 'Not available in this mode'\n          }\n        }\n      })\n    },\n\n    _createHelpDialog: function() {\n      this.helpDialog = cdb.editor.ViewFactory.createDialogByTemplate('common/dialogs/help/infowindow_with_images', {}, { clean_on_hide: false });\n      this.addView(this.helpDialog);\n    },\n\n    setFeatureInfo: function(cartodb_id) {\n      // Set cartodb_id\n      this.cartodb_id = cartodb_id;\n\n      // render to update cartodb_id\n      this.render();\n\n      // Get row data and show the content\n      if(this.row) {\n        this.row.unbind(null, null, this);\n      }\n      this.row = this.table.data().getRow(cartodb_id, {\n        no_add: true\n      });\n\n      this.row\n        .bind('change', this.renderInfo, this)\n        .fetch({ cache: false, no_geom: true });\n\n      // trigger renderInfo now to render the actual contents\n      this.renderInfo();\n\n      return this;\n    },\n\n    /**\n     * renders the infowindows adding some editing features\n     */\n    render: function() {\n\n      var self = this;\n\n      // render original\n      cdb.geo.ui.Infowindow.prototype.render.call(this);\n\n      var fields = this.model.get('fields');\n\n      // Show no_fields state when there isn't any field\n      // and a custom template is not selected\n      if((!fields || (fields && !fields.length)) && (!this.model.get('template'))) {\n\n        // Add empty fields to the infowindow\n        this.$('.cartodb-popup').addClass(\"no_fields\");\n\n        // Check if the infowindow has header or not\n        var popup_class = '.cartodb-popup-content';\n        if (this.$('.cartodb-popup-header').length > 0) {\n          popup_class = '.cartodb-popup-header';\n        }\n\n        this.$(popup_class).html(\n          '<p class=\"italic\">' + this._TEXTS._NO_FIELDS_SELECTED + '</p>' +\n          '<p><a class=\"margin5 underline open_infowindow_panel\" href=\"#/select-fields\">' + this._TEXTS._NO_FIELDS_SELECTED_BUTTON + '</a></p>'\n        )\n      } else {\n        this.$('.cartodb-popup').removeClass(\"no_fields\");\n      }\n\n\n      // render edit and remove buttons\n      this.$('.cartodb-popup-content-wrapper')\n        .append(this.getTemplate('table/views/infowindow/infowindow_footer')({ \"cartodb_id\": this.cartodb_id }));\n\n      if (this.table.isReadOnly()) {\n        this.$('.cartodb-popup-content-wrapper').find('a.remove, a.edit_data, a.edit_geo').addClass('disabled');\n      }\n\n      if (this._containsCover()) { // bind the help link to the helpDialog\n        this.$(\".image_not_found a.help\").off(\"click\");\n        this.$(\".image_not_found a.help\").on(\"click\", function() {\n          $('body').append(self.helpDialog.render().el);\n          self.helpDialog.open();\n        });\n      }\n\n    },\n\n    renderInfo: function() {\n      var self = this;\n      var row_attributes = self.row.attributes;\n      var fields = [];\n\n      for (var property in row_attributes) {\n        if (row_attributes.hasOwnProperty(property)) {\n          if (self.model.containsField(property) && !_.contains(self.model.SYSTEM_COLUMNS, property)) {\n            var h = {\n              title: self.model.getFieldProperty(property, 'title') ? property : null,\n              value: row_attributes[property],\n              position: self.model.getFieldPos(property)\n            };\n\n            fields.push(h);\n          }\n        }\n      }\n\n      // sort\n      fields = _.compact(fields);\n      fields.sort(function(a, b) {\n        return a.position - b.position;\n      });\n\n      // filter and add index\n      var render_fields = [];\n      for(var i = 0; i < fields.length; ++i) {\n        var f = fields[i];\n        if(f) {\n          //\n          // header template use index to detect if it's the first element\n          // renderer to use special style.\n          // Mustache only matches as false a null, undefined or false value\n          // so for the first element we set index as null\n          // yes, very hacky :(\n          f.index = render_fields.length ? render_fields.length: null,\n          render_fields.push(f);\n        }\n      }\n\n      if (fields.length > 0) {\n        // Set content\n        this.model.set({ content:  { fields: render_fields } });\n      } else {\n        // Show loading due to the fact that we don't have the content yet\n        this.setLoading();\n      }\n\n      if(this.model.get('visibility')) {\n        // Just move the map if need it when fields are already added.\n        this.adjustPan();\n      }\n    },\n\n\n    /**\n     *  Attempts to load the cover URL and show it\n     */\n    _loadCover: function() {\n      var self = this;\n\n      if (!this._containsCover()) return;\n\n      var $cover = this.$(\".cover\");\n      var $imageNotFound = this.$(\".image_not_found\");\n      var $img = $cover.find(\"img\");\n      var url = this._getCoverURL();\n\n      if (!this._isValidURL(url)) {\n        $imageNotFound.fadeIn(250);\n        $img.hide();\n        return;\n      }\n\n      // configure spinner\n      var\n      target  = document.getElementById('spinner'),\n      opts    = { lines: 9, length: 4, width: 2, radius: 4, corners: 1, rotate: 0, color: '#ccc', speed: 1, trail: 60, shadow: true, hwaccel: false, zIndex: 2e9 },\n      spinner = new Spinner(opts).spin(target);\n\n      // create the image\n      $imageNotFound.hide();\n\n      $img.hide(function() {\n        this.remove();\n      });\n\n      $img = $(\"<img />\").attr(\"src\", url);\n      $cover.append($img);\n\n      $img.load(function(){\n        spinner.stop();\n\n        var w  = $img.width();\n        var h  = $img.height();\n        var coverWidth = $cover.width();\n        var coverHeight = $cover.height();\n\n        var ratio = h / w;\n        var coverRatio = coverHeight / coverWidth;\n\n        // Resize rules\n        if ( w > coverWidth && h > coverHeight) { // bigger image\n          if ( ratio < coverRatio ) $img.css({ height: coverHeight });\n          else {\n            var calculatedHeight = h / (w / coverWidth);\n            $img.css({ width: coverWidth, top: \"50%\", position: \"absolute\", \"margin-top\": -1*parseInt(calculatedHeight, 10)/2 });\n          }\n        } else {\n          var calculatedHeight = h / (w / coverWidth);\n          $img.css({ width: coverWidth, top: \"50%\", position: \"absolute\", \"margin-top\": -1*parseInt(calculatedHeight, 10)/2 });\n        }\n\n        $img.fadeIn(300);\n      })\n      .error(function(){\n        spinner.stop();\n        $imageNotFound.fadeIn(250);\n      });\n    },\n\n\n    /**\n     * triggers an editGeom event with the geometry\n     * infowindow is currently showing\n     */\n    _editGeom: function(e) {\n      this.killEvent(e);\n      if (!this.table.isReadOnly()) {\n        this.model.set(\"visibility\", false);\n        this.trigger('editGeom', this.row);\n      }\n    },\n\n    _editData: function(e) {\n      this.killEvent(e);\n      if (!this.table.isReadOnly()) {\n        this.model.set(\"visibility\", false);\n        this.trigger('editData', this.row);\n      }\n    },\n\n    _removeGeom: function(e) {\n      this.killEvent(e);\n      if (!this.table.isReadOnly()) {\n        this.model.set(\"visibility\", false);\n        this.trigger('removeGeom', this.row);\n      }\n    },\n\n    _openInfowindowPanel: function(e) {\n      this.killEvent(e);\n      this.trigger('openInfowindowPanel');\n    },\n\n    _getModelTemplate: function() {\n      var template_name = cdb.admin.mod.TemplateMap[this.model.get(\"template_name\")] || this.model.get(\"template_name\");\n      return this._TEMPLATE_URL + \"/\" + template_name;\n    }\n\n  });\n\n  // export\n  cdb.admin.MapInfowindow = MapInfowindow;\n\n})();\n","\ncdb.admin.Tooltip = cdb.geo.ui.Tooltip.extend({\n\n  _TEMPLATE_URL: 'table/views/tooltip/templates',\n\n  defaults: {\n    vertical_offset: 10,\n    horizontal_offset: 4,\n    position: 'bottom|right'\n  },\n\n  events: {\n    'mouseover': '_lock',\n    'mouseout': '_unlock'\n  },\n\n  initialize: function() {\n    this.table = this.options.table;\n    this.options.empty_fields = true; // render empty fields\n    cdb.geo.ui.Tooltip.prototype.initialize.call(this);\n    this.model.bind('change:template_name', this._setTemplate, this);\n    this.model.bind('change:template', this._compileTemplate, this);\n    this.model.bind('change:fields',this._changeFields, this);\n    this.model.bind('change:alternative_names',this._alternameNames, this);\n    this._setTemplate();\n    this._alternameNames();\n    this._changeFields();\n    if (this.model.get('template')) {\n      this._compileTemplate();\n    }\n    this.targetPos = null;\n    this.locked = false;\n    this.hideTimeout = -1;\n  },\n\n  render: function(data) {\n    if (this.model.fieldCount()) {\n      cdb.geo.ui.Tooltip.prototype.render.call(this, data);\n    } else {\n      this.el.innerHTML = '';\n    }\n\n    return this;\n  },\n\n  _lock: function(e) {\n    this.locked = true;\n    clearTimeout(this.hideTimeout);\n  },\n\n  _unlock: function(e) {\n    this.locked = false;\n  },\n\n  _changeFields: function() {\n    this.setFields(this.model.get('fields'));\n  },\n\n  _alternameNames: function() {\n    this.options.alternative_names = this.model.get('alternative_names');\n  },\n\n  /**\n   *  Compile template of the tooltip\n   */\n  _compileTemplate: function() {\n    var template = this.model.get('template') ?\n      this.model.get('template') :\n      cdb.templates.getTemplate(this._getModelTemplate());\n\n    if(typeof(template) !== 'function') {\n      this.template = new cdb.core.Template({\n        template: template,\n        type: this.model.get('template_type') || 'mustache'\n      }).asFunction()\n    } else {\n      this.template = template\n    }\n\n    this.render();\n  },\n\n  _setTemplate: function() {\n    if (this.model.get('template_name')) {\n      this.template = cdb.templates.getTemplate(this._getModelTemplate());\n      this.render();\n    }\n  },\n\n  _getModelTemplate: function() {\n    return this._TEMPLATE_URL + \"/\" + this.model.get('template_name')\n  },\n\n  _move: function() {\n    if (!this.targetPos) return;\n    var pos = this.$el.position();\n    var dx = this.targetPos.x - pos.left;\n    var dy = this.targetPos.y - pos.top;\n    pos.left += dx*0.05;\n    pos.top += dy*0.05;\n    this.$el.css(pos);\n    if (!this.locked && (Math.abs(dx) > 1 || Math.abs(dy) > 1)) {\n      L.Util.requestAnimFrame(this._move, this);\n    }\n  }\n\n});\n","\n/**\n * view used to render each row\n */\ncdb.admin.RowView = cdb.ui.common.RowView.extend({\n  classLabel: 'cdb.admin.RowView',\n  events: {\n    'click      .row_header': '_onOptionsClick',\n    'mouseout   .row_header': '_onOptionsOut'\n  },\n\n  cellRenderers: {\n    'default': '_renderDefault',\n    'boolean': '_renderBoolean',\n    'number': '_renderNumber',\n    'geometry': '_renderGeometry'\n  },\n\n  initialize: function() {\n    var self = this;\n    this.elder('initialize');\n    _.bindAll(this, '_onOptionsClick', '_onOptionsOut')\n    this.options.row_header = true;\n\n    this.retrigger('saving', this.model);\n    this.retrigger('saved', this.model);\n    this.retrigger('errorSaving', this.model);\n  },\n\n  _getRowOptions: function() {\n    if(!cdb.admin.RowView.rowOptions) {\n       var rowOptions = cdb.admin.RowView.rowOptions = new cdb.admin.RowHeaderDropdown({\n        position: 'position',\n        user: this.tableView.user,\n        template_base: \"table/views/table_row_header_options\",\n        tick: \"top\",\n        horizontal_position: \"left\",\n        tableData: this.getTableView().dataModel,\n        table: this.getTableView().model\n      });\n      rowOptions.render();\n      this.retrigger('createRow', rowOptions);\n\n    }\n    return cdb.admin.RowView.rowOptions;\n  },\n\n  _onOptionsOut: function(e) {\n    var $relatedTarget = $(e.relatedTarget)\n      , current_row_id = $relatedTarget.closest('tr').attr('id');\n\n    if ($relatedTarget.closest('.dropdown').length == 0 && $relatedTarget.closest('.row_header').length == 0) {\n      if (this.rowOptions) this.rowOptions.hide();\n    }\n  },\n\n  _onOptionsClick: function(e) {\n    var rowOptions, tableData, pos, tableOffset, left, top\n      , $target = $(e.target);\n\n    tableData = this.getTableView().dataModel;\n    if(this.table.isReadOnly()) {\n      // if data is read only do not allow\n      // to add or remove rows\n      return;\n    }\n    rowOptions = this._getRowOptions();\n    e.preventDefault();\n    $target.append(rowOptions.el);\n\n    left = 30;\n    top = 5;\n\n    // If it is the last td of the table, show the dropdown upwards\n    if ($target.closest(\"tr\").is(':last-child') && $target.closest(\"tr\").index() > 1) {\n      rowOptions.options.vertical_position = \"top\";\n      rowOptions.options.tick = \"bottom\";\n    } else {\n      rowOptions.options.vertical_position = \"down\";\n      rowOptions.options.tick = \"top\";\n    }\n\n    rowOptions.setRow(this.model);\n    rowOptions.openAt(left, top);\n    this.rowOptions = rowOptions; // to make it testable;\n    return false;\n  },\n\n  /**\n   * return each cell view\n   */\n  valueView: function(colName, value) {\n\n    this.table = this.table || this.getTableView().model;\n    var render = '_renderDefault';\n    if(colName.length) {\n      var colType = this.table.getColumnType(colName);\n      render = this.cellRenderers[colType] || render;\n    }\n\n    var obj = $(this[render](value));\n    obj.addClass('cell');\n    if(cdb.admin.Row.isReservedColumn(colName)) {\n      obj.addClass('disabled');\n    }\n\n    // It is the first cell?\n    if(colName === '' && value === '') {\n      if(this.table.isReadOnly()) {\n        // No row options button\n        obj\n          .addClass('disabled')\n          .html('');\n      } else {\n        // Add row options button\n        obj.addClass('row_header');\n      }\n    }\n    return obj;\n  },\n\n  _renderDefault: function(value, additionalClasses) {\n    additionalClasses = additionalClasses || '';\n\n    var cell;\n\n    if (value === null) {\n      additionalClasses += \" isNull\"\n      cell =  '<div class=\"'+ additionalClasses +'\">null</div>';\n    } else cell =  '<div class=\"'+ additionalClasses +'\">' + _.escape(value) + '</div>';\n\n    return cell;\n  },\n\n  _renderBoolean: function(value) {\n    return this._renderDefault(value, 'boolean');\n  },\n\n  _renderNumber: function(value) {\n    return this._renderDefault(value, 'number');\n  },\n\n  _renderGeometry: function(value) {\n    var self = this;\n    function geomDisplayValue(value) {\n      var v = _.uniq(self.table.geomColumnTypes());\n      if (!_.isNull(value) && v && v.length && v[0]) {\n        v = v[0];\n        // capitalize\n        value = v.charAt(0).toUpperCase() + v.substring(1).toLowerCase();\n      }\n      return value;\n    }\n\n    var objValue = {};\n    try {\n      objValue = JSON.parse(value);\n      function formatCoord(c) {\n        var val = \"       \";\n        if (c !== undefined) {\n          val = c.toFixed(4);\n          if (c > 0) {\n            val = \" \" + val;\n          }\n        }\n        return val;\n      }\n      if(objValue.type === 'Point') {\n        value = formatCoord(objValue.coordinates[0]) + ',' + formatCoord(objValue.coordinates[1]);\n      } else {\n        value = geomDisplayValue(value);\n      }\n    } catch (e) {\n      value = geomDisplayValue(value);\n    }\n    return this._renderDefault(value);\n  }\n\n});\n\n","\n/**\n * header cell view, manages operations on table columns\n */\n\n(function() {\n\nvar HeaderView = cdb.admin.HeaderView = cdb.core.View.extend({\n\n  _TEXTS: {\n    no_geo: {\n      title:        _t('Georeference your table'),\n      description:  _t('This funcionality is not available in the visualization view. \\\n                    Please, visit <a href=\"<%- prefix %>/tables/<%- table_name %>\">your table</a> and start georeferencing there.'),\n      ok:           _t('Ok, close')\n    }\n  },\n\n  NO_MENU_COLUMNS: ['the_geom', 'the_geom_webmercator'],\n\n  events: {\n    'dblclick .coloptions':     'renameColumn',\n    'click    .coloptions':     'showColumnOptions',\n    'click    .coltype':        'showColumnTypeOptions',\n    'click    .geo':            'showGeoreferenceWindow',\n    'keydown  .col_name_edit':  '_checkEditColnameInput',\n    'focusout input':           '_finishEdit',\n    'click':                    'activateColumnOptions'\n  },\n\n  initialize: function() {\n    var self = this;\n    this.column = this.options.column;\n    this.table = this.options.table;\n    this.vis = this.options.vis;\n    this.template = this.getTemplate('table/views/table_header_view');\n    this.editing_name = false;\n    this.changing_type = false;\n\n    this.vis.bind('change:type', function() {\n      // You can't geocode being in a visualization of type derived\n      HeaderView && HeaderView.colTypeOptions.render();\n    });\n\n    this.add_related_model(this.vis);\n\n    if (HeaderView.colOptions === undefined) {\n      HeaderView.colOptions= new cdb.admin.HeaderDropdown({\n        user: this.options.user,\n        position: 'position',\n        horizontal_position: \"right\",\n        tick: \"right\",\n        template_base: \"table/views/table_header_options\",\n        sqlView: this.options.sqlView,\n        vis: this.vis\n      });\n      HeaderView.colOptions.render();\n\n      cdb.god.bind(\"closeDialogs\", HeaderView.colOptions.hide, HeaderView.colOptions);\n    }\n\n    if (HeaderView.colTypeOptions === undefined) {\n      HeaderView.colTypeOptions= new cdb.admin.ColumntypeDropdown({\n        user: this.options.user,\n        position: 'position',\n        horizontal_position: \"right\",\n        tick: \"right\",\n        template_base: \"table/views/table_column_type_options\"\n      });\n      HeaderView.colTypeOptions.render();\n      cdb.god.bind(\"closeDialogs\", HeaderView.colTypeOptions.hide, HeaderView.colTypeOptions);\n    }\n  },\n\n  _addColumn: function(column) {\n    table.tableTab.tableView.addColumn(column);\n  },\n\n  render: function() {\n    this.$el.html('');\n\n    this.$el.append(this.template({\n      col_name:         this.column[0],\n      col_type:         this.column[1],\n      editing_name:     this.editing_name,\n      changing_type:    this.changing_type,\n      read_only:        this.table.isReadOnly(),\n      isReservedColumn: this.table.isReadOnly() || this.table.isReservedColumn(this.column[0]),\n      noMenu:           (this.NO_MENU_COLUMNS.indexOf(this.column[0]) >= 0)\n    }));\n\n    // Focus in the input if it is being edited\n    // and set the correct width\n    if (this.editing_name) {\n      // In case the element is not present in DOM or not visible the width would be 0, so fallback on a reasonable\n      // width (e.g. happens for adding a column on an empty dataset)\n      var w = this.$el.find(\"p.auto\").width() || 175;\n      this.$el.find(\"input\")\n        .css({\n          \"max-width\":  w,\n          \"width\":      w\n        })\n        .focus();\n    }\n\n    this.delegateEvents();\n\n    return this;\n  },\n\n  _openColOptions: function(e) {\n    var self = this;\n    var colOptions = HeaderView.colOptions;\n\n    // Unbind events\n    colOptions.off();\n    cdb.god.unbind('closeDialogs', HeaderView.colOptions.hide, HeaderView.colOptions);\n\n    // Close other dialogs\n    cdb.god.trigger(\"closeDialogs\");\n\n    // set data for column and table currently editing\n    colOptions.setTable(this.table, this.column[0]);\n\n    colOptions.bind('addColumn', this._addColumn, this);\n    colOptions.bind('renameColumn', this.renameColumn, this);\n    colOptions.bind('changeType', this._changeType, this);\n    colOptions.bind('clearView', function(){\n      self.trigger('clearView');\n    }, this);\n    colOptions.bind('georeference', function(column) {\n      self.trigger('georeference', column);\n    }, this);\n    colOptions.bind('applyFilter', function(column) {\n      self.trigger('applyFilter', column);\n    }, this);\n\n    // bind the stuff\n    var container = $(e.target).parent().parent();\n    container.append(colOptions.el);\n\n    var link_width  = $(e.target).width() + 26\n      , th          = container.parent();\n\n    // align to the right of the target with a little of margin\n    colOptions.openAt(link_width - colOptions.$el.width(), (th.height()/2) + 7);\n\n    // Bind again!\n    cdb.god.bind(\"closeDialogs\", HeaderView.colOptions.hide, HeaderView.colOptions);\n  },\n\n  _openColTypeOptions: function(e) {\n    if(this.table.isReadOnly()) {\n      return;\n    }\n    var colOptions = HeaderView.colTypeOptions;\n\n    // Unbind events\n    colOptions.off();\n    cdb.god.unbind('closeDialogs', HeaderView.colTypeOptions.hide, HeaderView.colTypeOptions);\n\n    // Close other dialogs\n    cdb.god.trigger(\"closeDialogs\");\n\n    // set data for column and table currently editing\n    colOptions.setTable(this.table, this.column[0]);\n\n    // bind the stuff\n    var container = $(e.target).parent().parent();\n    container.append(colOptions.el);\n\n    var link_width  = $(e.target).outerWidth() + 24\n      , th          = container.parent();\n\n    // align to the right of the target with a little of margin\n    colOptions.openAt(link_width - colOptions.$el.width(), (th.height()/2) + 25);\n\n\n    // Bind again\n    cdb.god.bind(\"closeDialogs\", HeaderView.colTypeOptions.hide, HeaderView.colTypeOptions);\n  },\n\n  _checkEditColnameInput: function(e) {\n    if(e.keyCode === 13) {\n      this._submitEdit();\n    }\n    if(e.keyCode === 27) {\n      this._finishEdit();\n    }\n\n  },\n\n  _submitEdit: function() {\n    this.table.renameColumn(this.column[0], $('.col_name_edit').val());\n    this._finishEdit();\n  },\n\n  _finishEdit: function() {\n    this.editing_name = false;\n    this.render();\n  },\n\n  renameColumn: function(ev) {\n    if (ev) {\n      this.killEvent(ev)\n    }\n\n    this.editing_name = true;\n    this.changing_type = false;\n    this.render();\n  },\n\n  _changeType: function(column) {\n    this.editing_name = false;\n    this.changing_type = true;\n\n    // Simulate click\n    var $coltype_link = this.$el.find('a.coltype');\n    $coltype_link.click();\n  },\n\n  activateColumnOptions: function(e) {\n    this.killEvent(e);\n    this.$el.find(\"a.coloptions\").click();\n  },\n\n  showColumnOptions: function(e) {\n    var self = this;\n    var colOptions = HeaderView.colOptions;\n    var columnName = this.column[0];\n\n    e.preventDefault();\n\n    // If submenu was openened before, let's close it.\n    if (colOptions.isOpen && columnName == colOptions.column) {\n      colOptions.hide();\n      return false;\n    }\n\n    // If submenu is from different column or it is closed.\n    if (this.NO_MENU_COLUMNS.indexOf(this.column[0]) < 0) {\n      colOptions.hide(function() {\n        colOptions.parent_ && colOptions.parent_.css('z-index', 0);\n        var parent_ = self.$el.find('th > div');\n        colOptions.parent_ = parent_;\n        parent_.css('z-index', '100');\n        self._openColOptions(e);\n      });\n    }\n\n    return false;\n  },\n\n  showGeoreferenceWindow: function(e) {\n    this.killEvent(e);\n    this.trigger('georeference', null);\n  },\n\n  showColumnTypeOptions: function(e) {\n    var self = this;\n    var colOptions = HeaderView.colTypeOptions;\n    var columnName = this.column[0];\n\n    if (e) e.preventDefault();\n\n    // If submenu was openened before, let's close it.\n    if (colOptions.isOpen && columnName == colOptions.column) {\n      colOptions.hide();\n      return false;\n    }\n\n    // If submenu is from different column or it is closed.\n    colOptions.hide(function() {\n      self._openColTypeOptions(e);\n    });\n\n    return false;\n  }\n\n});\n\n})();\n","\n(function() {\n\n    /**\n     * table view shown in admin\n     */\n    cdb.admin.TableView = cdb.ui.common.Table.extend({\n\n      classLabel: 'cdb.admin.TableView',\n\n      events: cdb.core.View.extendEvents({\n          'click .clearview': '_clearView',\n          'click .sqlview .export_query': '_tableFromQuery',\n          'click .noRows': 'addEmptyRow'\n      }),\n\n      rowView: cdb.admin.RowView,\n\n      initialize: function() {\n        var self = this;\n        this.elder('initialize');\n        this.options.row_header = true;\n        this.globalError = this.options.globalError;\n        this.vis = this.options.vis;\n        this.user = this.options.user;\n        this._editorsOpened = null;\n\n        this.initializeBindings();\n\n        this.initPaginationAndScroll();\n      },\n\n      /**\n       * Append all the bindings needed for this view\n       * @return undefined\n       */\n      initializeBindings: function() {\n        var self = this;\n\n        _.bindAll(this, \"render\", \"rowSaving\", \"addEmptyRow\",\n          \"_checkEmptyTable\", \"_forceScroll\", \"_scrollMagic\",\n          \"rowChanged\", \"rowSynched\", \"_startPagination\", \"_finishPagination\",\n          \"rowFailed\", \"rowDestroyed\", \"emptyTable\");\n\n        this.model.data().bind('newPage', this.newPage, this);\n\n        //this.model.data().bind('loadingRows', this._startPagination);\n        this.model.data().bind('endLoadingRows', this._finishPagination);\n\n        this.bind('cellDblClick', this._editCell, this);\n        this.bind('createRow', function() {\n          self._checkEmptyTable();\n        });\n\n\n        this.model.bind('change:dataSource', this._onSQLView, this);\n        // when model changes the header is re rendered so the notice should be added\n        //this.model.bind('change', this._onSQLView, this);\n        this.model.bind('dataLoaded', function() {\n          //self._checkEmptyTable();\n          self._forceScroll();\n        }, this);\n\n        this.model.bind('change:permission', this._checkEmptyTable, this);\n\n        this.model.bind('change:isSync', this._swicthEnabled, this);\n        this._swicthEnabled();\n\n        // Actions triggered in the right panel\n        cdb.god.bind(\"panel_action\", function(action) {\n          self._moveInfo(action);\n        }, this);\n        this.add_related_model(cdb.god);\n\n        // Geocoder binding\n        this.options.geocoder.bind('geocodingComplete geocodingError geocodingCanceled', function() {\n          this.notice(_t('loaded'));\n        }, this);\n        this.add_related_model(this.options.geocoder);\n      },\n\n      initPaginationAndScroll: function() {\n        var self = this;\n        var topReached = false;\n        var bottomReached = false;\n\n        // Initialize moving header and loaders when scrolls\n        this.scroll_position = { x:$(window).scrollLeft(), y:$(window).scrollTop(), last: 'vertical' };\n        $(window).scroll( this._scrollMagic );\n\n        // Pagination\n        var SCROLL_BACK_PIXELS = 2;\n        this.checkScrollTimer = setInterval(function() {\n          if(!self.$el.is(\":visible\") || self.model.data().isFetchingPage()) {\n            return;\n          }\n          var pos = $(this).scrollTop();\n          var d = self.model.data();\n          // do not let to fetch previous pages\n          // until the user dont scroll back a little bit\n          // see comments below\n          if(pos > SCROLL_BACK_PIXELS) {\n            topReached = false;\n          }\n          var pageSize = $(window).height() - self.$el.offset().top;\n          var tableHeight = this.$('tbody').height();\n          var realPos = pos + pageSize;\n          if(tableHeight < pageSize) {\n            return;\n          }\n          // do not let to fetch previous pages\n          // until the user dont scroll back a little bit\n          // if we dont do this when the user reach the end of the page\n          // and there are more rows than max_rows, the rows form the beggining\n          // are removed and the scroll keeps at the bottom so a new page is loaded\n          // doing this the user have to move the scroll a little bit (2 px)\n          // in order to load the page again\n          if(realPos < tableHeight - SCROLL_BACK_PIXELS) {\n            bottomReached = false;\n          }\n          if(realPos >= tableHeight) {\n            if(!bottomReached) {\n              // Simulating loadingRows event\n              if (!d.lastPage) self._startPagination('down');\n\n              setTimeout(function() {\n                d.loadPageAtBottom();\n              },600);\n            }\n            bottomReached = true;\n          } else if (pos <= 0) {\n            if(!topReached) {\n              // Simulating loadingRows event\n              if (d.pages && d.pages[0] != 0) self._startPagination('up');\n\n              setTimeout(function() {\n                d.loadPageAtTop()\n              },600);\n            }\n            topReached = true;\n          }\n\n          self._setUpPagination(d);\n        }, 300);\n        this.bind('clean', function() {\n          clearInterval(this.checkScrollTimer);\n        }, this);\n      },\n\n      needsRender: function(table) {\n        if (!table) return true;\n        var ca = table.changedAttributes();\n        if (ca.geometry_types && _.keys(ca).length === 1) {\n          return false;\n        }\n        return true;\n      },\n\n      render: function(args) {\n        if (!this.needsRender(args)) return;\n        this.elder('render', args);\n        if (this.model.isInSQLView()) {\n          this._onSQLView();\n        }\n        this._swicthEnabled();\n        this.trigger('render');\n      },\n\n      _renderHeader: function() {\n        var thead = cdb.ui.common.Table.prototype._renderHeader.apply(this);\n        // New custom shadow (better performance)\n        thead.append($('<div>').addClass('shadow'));\n        return thead;\n      },\n\n      addColumn: function(column){\n        this.newColumnName = \"column_\" + new Date().getTime();\n\n        this.model.addColumn(this.newColumnName, 'string');\n\n        this.unbind(\"render\", this._highlightColumn, this);\n        this.bind(\"render\", this._highlightColumn, this);\n      },\n\n      _highlightColumn: function() {\n\n        if (this.newColumnName) {\n\n          var $th = this.$(\"a[href='#\" + this.newColumnName + \"']\").parents(\"th\");\n          var position = $th.index();\n\n          if (position) {\n\n            setTimeout(function() {\n              var windowWidth = $(window).width();\n              if ($th && $th.position()) {\n                var centerPosition = $th.position().left - windowWidth/2 + $th.width()/2;\n                $(window).scrollLeft(centerPosition);\n              }\n              this.$(\"[data-x='\" + position + \"']\").addClass(\"is-highlighted\");\n            }, 300);\n\n            this.unbind(\"render\", this._highlightColumn, this);\n          }\n        }\n      },\n\n      /**\n       *  Take care if the table needs space at top and bottom\n       *  to show the loaders.\n       */\n      _setUpPagination: function(d) {\n        var pages = d.pages;\n\n        // Check if the table is not in the first page\n        if (pages.length > 0 && pages[0] > 0) {\n          // In that case, add the paginator-up loader and leave it ready\n          // when it is necessary\n          if (this.$el.find('tfoot.page_loader.up').length == 0) {\n            this.$el.append(this.getTemplate('table/views/table_pagination_loaders')({ direction: 'up' }));\n          }\n          // Table now needs some space at the top to show the loader\n          this.$el.parent().addClass(\"page_up\");\n        } else {\n          // Loader is not needed and table doesn't need any space at the top\n          this.$el.parent().removeClass(\"page_up\");\n        }\n\n        // Checks if we are in the last page\n        if (!d.lastPage) {\n          // If not, let's prepare the paginator-down\n          if (this.$el.find('tfoot.page_loader.down').length == 0) {\n            this.$el.append(this.getTemplate('table/views/table_pagination_loaders')({ direction: 'down' }));\n          }\n          // Let's say to the table that we have paginator-down\n          this.$el.parent().addClass(\"page_down\");\n        } else {\n          // Loader is not needed and table doesn't need any space at the bottom\n          this.$el.parent().removeClass(\"page_down\");\n        }\n      },\n\n\n      /**\n       *  What to do when a pagination starts\n       */\n      _startPagination: function(updown) {\n        // Loader... move on buddy!\n        this.$el.find(\".page_loader.\" + updown + \"\").addClass('active');\n      },\n\n      /**\n       *  What to do when a pagination finishes\n       */\n      _finishPagination: function(page, updown) {\n\n        // If we are in a different page than 0, and we are paginating up\n        // let's move a little bit the scroll to hide the loader again\n        // HACKY\n        if (page != 0 && updown == \"up\") {\n          setTimeout(function(){\n            $(window).scrollTop(180);\n          },300);\n        }\n\n        this.$el.find('.page_loader.active').removeClass('active');\n      },\n\n\n      _onSQLView: function() {\n        // bind each time we change dataSource because table unbind\n        // all the events from sqlView object each time useSQLView is called\n        this.$('.sqlview').remove();\n\n        this.options.sqlView.unbind('reset error', this._renderSQLHeader, this);\n        this.options.sqlView.unbind('loading', this._renderLoading, this);\n\n        this.options.sqlView.bind('loading', this._renderLoading, this);\n        this.options.sqlView.bind('reset', this._renderSQLHeader, this);\n        this.options.sqlView.bind('error', this._renderSQLHeader, this);\n        this._renderSQLHeader();\n      },\n\n      _renderLoading: function(opts) {\n        opts = opts || {};\n        this.cleanEmptyTableInfo();\n        if(!opts.add) {\n          this._renderBodyTemplate('table/views/sql_loading');\n        }\n      },\n\n      _renderSQLHeader: function() {\n        var self = this;\n        if(self.model.isInSQLView()) {\n          var empty = self.isEmptyTable();\n          self.$('thead').find('.sqlview').remove();\n          self.$('thead').append(\n            self.getTemplate('table/views/sql_view_notice')({\n              empty: empty,\n              isVisualization: self.vis.isVisualization(),\n              warnMsg: null\n            })\n          );\n\n          self.$('thead > tr').css('height', 64 + 42);\n          if(self.isEmptyTable()) {\n            self.addEmptySQLIfo();\n          }\n\n          self._moveInfo();\n        }\n      },\n\n      // depending if the sync is enabled add or remove a class\n      _swicthEnabled: function() {\n        // Synced?\n        this.$el[ this.model.isSync() ? 'addClass' : 'removeClass' ]('synced');\n        // Visualization?\n        this.$el[ this.vis.isVisualization() ? 'addClass' : 'removeClass' ]('vis');\n      },\n\n      _clearView: function(e) {\n        if (e) e.preventDefault();\n        this.options.layer.clearSQLView();\n        return false;\n      },\n\n      _tableFromQuery: function(e) {\n        e.preventDefault();\n\n        var duplicate_dialog = new cdb.editor.DuplicateDatasetView({\n          model: this.model,\n          user: this.user,\n          clean_on_hide: true\n        });\n        duplicate_dialog.appendToBody();\n      },\n\n\n      /**\n       *  Function to control the scroll in the table (horizontal and vertical)\n       */\n      _scrollMagic: function(ev) {\n        var actual_scroll_position = { x:$(window).scrollLeft(), y:$(window).scrollTop() };\n\n        if (this.scroll_position.x != actual_scroll_position.x) {\n          this.scroll_position.x = actual_scroll_position.x;\n          this.$el.find(\"thead\").addClass(\"horizontal\");\n\n          // If last change was vertical\n          if (this.scroll_position.last == \"vertical\") {\n            this.scroll_position.x = actual_scroll_position.x;\n\n            this.$el.find(\"thead > tr > th > div > div:not(.dropdown)\")\n              .removeAttr(\"style\")\n              .css(\"top\", actual_scroll_position.y + \"px\");\n\n            this.scroll_position.last = \"horizontal\";\n          }\n\n        } else if (this.scroll_position.y != actual_scroll_position.y) {\n          this.scroll_position.y = actual_scroll_position.y;\n          this.$el.find(\"thead\").removeClass(\"horizontal\");\n\n          // If last change was horizontal\n          if (this.scroll_position.last == \"horizontal\") {\n\n            this.$el.find(\"thead > tr > th > div > div:not(.dropdown)\")\n              .removeAttr('style')\n              .css({\"marginLeft\": \"-\" + actual_scroll_position.x + \"px\"});\n\n            this.scroll_position.last = \"vertical\";\n          }\n        }\n      },\n\n\n      /**\n       *  Move the info content if the panel is opened or hidden.\n       *  - Query info if query is applied\n       *  - Query loader if query is appliying in that moment\n       *  - Add some padding to last column of the content to show them\n       */\n      _moveInfo: function(type) {\n        if (type == \"show\") {\n          this.$el\n            .removeClass('narrow')\n            .addClass('displaced');\n        } else if (type == \"narrow\") {\n          this.$el.addClass('displaced narrow')\n        } else if (type == \"hide\") {\n          this.$el.removeClass('displaced narrow');\n        } else {\n          // Check from the beginning if the right menu is openned, isOpen from\n          // the menu is not working properly\n          if ($('.table_panel').length > 0) {\n            var opened = $('.table_panel').css(\"right\").replace(\"px\",\"\") == 0 ? true : false;\n            if (!opened) {\n              this.$el.removeClass('displaced');\n            }\n          }\n        }\n      },\n\n      _getEditor: function(columnType, opts) {\n        var editors = {\n          'string':                       cdb.admin.StringField,\n          'number':                       cdb.admin.NumberField,\n          'date':                         cdb.admin.DateField,\n          'geometry':                     cdb.admin.GeometryField,\n          'timestamp with time zone':     cdb.admin.DateField,\n          'timestamp without time zone':  cdb.admin.DateField,\n          'boolean':                      cdb.admin.BooleanField\n        };\n\n        var editorExists = _.filter(editors, function(a,i) { return i === columnType }).length > 0;\n\n        if(columnType !== \"undefined\" && editorExists) {\n          return editors[columnType];\n        } else {\n          return editors['string']\n        }\n      },\n\n\n      closeEditor: function() {\n        if (this._editorsOpened) {\n          this._editorsOpened.hide();\n          this._editorsOpened.clean();\n        }\n      },\n\n\n      _editCell: function(e, cell, x, y) {\n        var self = this;\n\n        // Clean and close previous cell editor\n        this.closeEditor();\n\n        var column = self.model.columnName(x-1);\n        var columnType = this.model.getColumnType(column);\n\n        if (this.model.isReservedColumn(column) && !this.model.isReadOnly() && columnType!='geometry') {\n          return;\n        }\n\n        var row = self.model.data().getRowAt(y);\n\n        var initial_value = '';\n        if(self.model.data().getCell(y, column) === 0 || self.model.data().getCell(y, column) === '0') {\n          initial_value = '0';\n        } else if (self.model.data().getCell(y, column) !== undefined) {\n          initial_value = self.model.data().getCell(y, column);\n        }\n\n        // dont let generic editor\n        if(column == 'the_geom') {\n          columnType = 'geometry'\n        }\n\n        var prevRow = _.clone(row.toJSON());\n\n        var dlg = this._editorsOpened = new cdb.admin.SmallEditorDialog({\n          value:        initial_value,\n          column:       column,\n          row:          row,\n          rowNumber:    y,\n          readOnly:     this.model.isReadOnly(),\n          editorField:  this._getEditor(columnType),\n          res: function(new_value) {\n            if(!_.isEqual(new_value, prevRow[column])) {\n              // do not use save error callback since it avoid model error method to be called\n              row.bind('error', function editError() {\n                row.unbind('error', editError);\n                // restore previopis on error\n                row.set(column, prevRow[column]);\n              });\n              row\n                .save(column, new_value)\n                .done(function(a){\n                  self.model.trigger('data:saved');\n                });\n            }\n          }\n        });\n\n        if(!dlg) {\n          cdb.log.error(\"editor not defined for column type \" + columnType);\n          return;\n        }\n\n        // auto add to table view\n        // Check first if the row is the first or the cell is the last :)\n        var $td = $(e.target).closest(\"td\")\n          , offset = $td.offset()\n          , $tr = $(e.target).closest(\"tr\")\n          , width = Math.min($td.outerWidth(), 278);\n\n        // Remove header spacing from top offset\n        offset.top = offset.top - this.$el.offset().top;\n\n        if ($td.parent().index() == 0) {\n          offset.top += 5;\n        } else {\n          offset.top -= 11;\n        }\n\n        if ($td.index() == ($tr.find(\"td\").size() - 1) && $tr.find(\"td\").size() < 2) {\n          offset.left -= width/2;\n        } else {\n          offset.left -= 11;\n        }\n\n        dlg.showAt(offset.left, offset.top, width, true);\n      },\n\n\n      headerView: function(column) {\n        var self = this;\n\n        if(column[1] !== 'header') {\n          var v = new cdb.admin.HeaderView({\n            column: column,\n            table: this.model,\n            sqlView: this.options.sqlView,\n            user: this.user,\n            vis: this.vis\n          })\n          .bind('clearView', this._clearView, this)\n          .bind('georeference', function(column) {\n            var dlg;\n            var bkgPollingModel = this.options.backgroundPollingModel;\n            var tableIsReadOnly = this.model.isSync();\n            var canAddGeocoding = bkgPollingModel !== \"\" ? bkgPollingModel.canAddGeocoding() : true; // With new modals\n\n            if (!this.options.geocoder.isGeocoding() && !tableIsReadOnly && canAddGeocoding) {\n              var dlg = new cdb.editor.GeoreferenceView({\n                table:  this.model,\n                user:   this.user,\n                tabs:   ['lonlat', 'city', 'admin', 'postal', 'ip', 'address'],\n                option: 'lonlat',\n                data:   { longitude: column }\n              });\n\n            } else if (this.options.geocoder.isGeocoding() || ( !canAddGeocoding && !tableIsReadOnly )) {\n              dlg = cdb.editor.ViewFactory.createDialogByTemplate('common/background_polling/views/geocodings/geocoding_in_progress');\n            } else {\n              // If table can't geocode == is synched, return!\n              return;\n            }\n\n            dlg.appendToBody();\n          }, this)\n          .bind('applyFilter', function(column) {\n            self.options.menu.show('filters_mod');\n            self.options.layer.trigger('applyFilter',column);\n          }, this)\n\n          this.addView(v);\n\n          if (this.newColumnName == column[0]) {\n            setTimeout(function() {\n              v.renameColumn();\n              self.newColumnName = null;\n            }, 300);\n          }\n\n          return v.render().el;\n        } else {\n          return '<div><div></div></div>';\n        }\n      },\n\n\n      /**\n      * Checks if the table has any rows, and if not, launch the method for showing the appropiate view elements\n      * @method _checkEmptyTable\n      */\n      _checkEmptyTable: function() {\n        if(this.isEmptyTable()) {\n          this.addEmptyTableInfo();\n        } else {\n          this.cleanEmptyTableInfo();\n        }\n      },\n\n\n      /**\n      * Force the table to be at the beginning\n      * @method _forceScroll\n      */\n      _forceScroll: function(ev){\n        $(window).scrollLeft(0);\n      },\n\n      _renderEmpty: function() {\n        this.addEmptyTableInfo();\n      },\n\n      /**\n      * Adds the view elements associated with no content in the table\n      * @method addemptyTableInfo\n      */\n      addEmptyTableInfo: function() {\n        if(this.$('.noRows').length == 0 && !this.model.isInSQLView() && this.model.get('schema')) {\n          this.elder('addEmptyTableInfo');\n\n          this.$el.hide();\n\n          // Fake empty row if the table is not readonly\n          if (!this.model.isReadOnly()) {\n            //TODO: use row view instead of custom HTML\n            var columnsNumber = this.model.get('schema').length;\n            var columns = '<tr class=\"placeholder noRows\"><td class=\"addNewRow\">+</td>';\n            for(var i = 0; i < columnsNumber; i++) {\n              columns += '<td></td>';\n            }\n            columns += '</tr>';\n            var columnsFooter = '<tr class=\"placeholder noRows decoration\"><td></td>';\n            for(var i = 0; i < columnsNumber; i++) {\n              columnsFooter += '<td></td>';\n            }\n            columnsFooter += '</tr>';\n\n            var $columns = $(columns+columnsFooter)\n            this.$el.append($columns);\n          }\n\n          this.template_base = cdb.templates.getTemplate( this.model.isReadOnly() ? 'table/views/empty_readtable_info' : 'table/views/empty_table');\n          var content = this.template_base();\n          var $footer = $('<tfoot><tr><td colspan=\"100\">' + content + '</td></tr></tfoot>');\n          this.$el.append($footer);\n\n          this.$el.fadeIn();\n        }\n      },\n\n      /**\n      * Adds the view elements associated with no content in the table when a SQL is applied\n      * @method addEmptySQLIfo\n      */\n      addEmptySQLIfo: function() {\n        if(this.model.isInSQLView()) {\n          this._renderBodyTemplate('table/views/empty_sql');\n        }\n      },\n\n      _renderBodyTemplate: function(tmpl) {\n        this.$('tbody').html('');\n        this.$('tfoot').remove();\n        this.$el.hide();\n\n        // Check if panel is opened to move the loader some bit left\n        var panel_opened = false;\n        if ($('.table_panel').length > 0) {\n          panel_opened = $('.table_panel').css(\"right\").replace(\"px\",\"\") == 0 ? true : false;\n        }\n\n        var content = cdb.templates.getTemplate(tmpl)({ panel_opened: panel_opened })\n        , $footer = $('<tfoot class=\"sql_loader\"><tr><td colspan=\"100\">' + content + '</td></tr></tfoot>');\n\n        this.$el.append($footer);\n        this.$el.fadeIn();\n      },\n\n      /**\n      * Removes from the view the no-content elements\n      * @method cleanEmptyTableInfo\n      */\n      cleanEmptyTableInfo: function() {\n        this.$('tfoot').fadeOut('fast', function() {\n          $(this).remove();\n        })\n        this.$('.noRows').slideUp('fast', function() {\n          $(this).remove();\n        })\n      },\n\n      notice: function(text, type, time) {\n        this.globalError.showError(text, type, time);\n      },\n\n      /**\n      * Add a new row and removes the empty table view elemetns\n      * @method addEmptyRow\n      * @todo: (xabel) refactor this to include a \"addRow\" method in _models[0]\n      */\n      addEmptyRow: function() {\n        this.dataModel.addRow({ at: 0});\n        this.cleanEmptyTableInfo();\n      },\n\n      /**\n      * Captures the saving event from the row and produces a notification\n      * @todo (xabel) i'm pretty sure there has to be a less convulted way of doing this, without capturing a event\n      * to throw another event in the model to be captured by some view\n      */\n      rowSaving: function() {\n        this.notice('Saving your edit', 'load', -1);\n      },\n\n      /**\n      * Captures the change event from the row and produces a notification\n      * @method rowSynched\n      * @todo (xabel) i'm pretty sure there has to be a less convulted way of doing this, without capturing a event\n      * to throw another event in the model to be captured by some view\n      */\n      rowSynched: function() {\n        this.notice('Sucessfully saved');\n      },\n\n      /**\n      * Captures the change event from the row and produces a notification\n      * @method rowSynched\n      * @todo (xabel) i'm pretty sure there has to be a less convulted way of doing this, without capturing a event\n      * to throw another event in the model to be captured by some view\n      */\n      rowFailed: function() {\n        this.notice('Oops, there has been an error saving your changes.', 'error');\n      },\n\n      /**\n      * Captures the destroy event from the row and produces a notification\n      * @method rowDestroyed\n      */\n\n      rowDestroying: function() {\n        this.notice('Deleting row', 'load', -1)\n      },\n\n      /**\n      * Captures the sync after a destroy event from the row and produces a notification\n      * @method rowDestroyed\n      */\n\n      rowDestroyed: function() {\n        this.notice('Sucessfully deleted')\n        this._checkEmptyTable();\n      }\n    });\n\n\n\n    /**\n    * table tab controller\n    */\n    cdb.admin.TableTab = cdb.core.View.extend({\n\n      className: 'table',\n\n      initialize: function() {\n        this.user = this.options.user;\n        this.sqlView = this.options.sqlView;\n        this.geocoder = this.options.geocoder;\n        this.backgroundPollingModel = this.options.backgroundPollingModel;\n        this._initBinds();\n      },\n\n      setActiveLayer: function(layerView) {\n        var recreate = !!this.tableView;\n        this.deactivated();\n        this.model = layerView.table;\n        this.layer = layerView.model;\n        this.sqlView = layerView.sqlView;\n        if(recreate) {\n          this.activated();\n        }\n      },\n\n      _initBinds: function() {\n        // Geocoder binding\n        this.geocoder.bind('geocodingComplete geocodingError geocodingCanceled', function() {\n          if (this.model.data) {\n            this.model.data().refresh()\n          }\n        }, this);\n        this.add_related_model(this.geocoder);\n      },\n\n      _createTable: function() {\n        this.tableView = new cdb.admin.TableView({\n          dataModel: this.model.data(),\n          model: this.model,\n          sqlView: this.sqlView,\n          layer: this.layer,\n          geocoder: this.options.geocoder,\n          backgroundPollingModel: this.backgroundPollingModel,\n          vis: this.options.vis,\n          menu: this.options.menu,\n          user: this.user,\n          globalError: this.options.globalError\n        });\n      },\n\n      activated: function() {\n        if(!this.tableView) {\n          this._createTable();\n          this.tableView.render();\n          this.render();\n        }\n      },\n\n      deactivated: function() {\n        if(this.tableView) {\n          this.tableView.clean();\n          this.tableView = null;\n          this.hasRenderedTableView = false;\n        }\n      },\n\n      render: function() {\n        // Since render should be idempotent (i.e. should not append the tableView twice when called multiple times)\n        if(this.tableView && !this.hasRenderedTableView) {\n          this.hasRenderedTableView = true;\n          this.$el.append(this.tableView.el);\n        }\n        return this;\n      }\n\n\n    });\n\n})();\n","\n/**\n * dropdown when user clicks on a column name\n */\ncdb.admin.HeaderDropdown = cdb.admin.DropdownMenu.extend({\n\n  className: \"dropdown border\",\n  isPublic: false,\n\n  events: {\n    'click .asc':                   'orderColumnsAsc',\n    'click .desc':                  'orderColumnsDesc',\n    'click .rename_column':         'renameColumn',\n    'click .change_data_type':      'changeType',\n    'click .georeference':          'georeference',\n    'click .clearview':             'clearView',\n    'click .filter_by_this_column': 'filterColumn',\n    'click .delete_column':         'deleteColumn',\n    'click .add_new_column':        'addColumn'\n  },\n\n  initialize: function() {\n    this.options.reserved_column = false;\n    this.options.read_only = false;\n    this.options.in_sql_view = false;\n    this.options.isPublic = this.isPublic;\n    this.elder('initialize');\n  },\n\n  render: function() {\n    cdb.admin.DropdownMenu.prototype.render.call(this);\n    // Add the class public if it is reserved column or query applied\n    this.$el[this.options.isPublic !== true || this.options.read_only ? 'addClass' : 'removeClass']('public');\n\n    return this;\n  },\n\n  setTable: function(table, column) {\n    this.table = table;\n    this.column = column;\n\n    // depending on column type (reserved, normal) some fields should not be shown\n    // so render the dropdown again\n    this.options.reserved_column = this.table.isReadOnly() || this.table.isReservedColumn(column);\n    this.options.read_only = this.table.isReadOnly();\n    this.options.in_sql_view = this.table.isInSQLView();\n    this.render();\n\n    this.$('.asc').removeClass('selected');\n    this.$('.desc').removeClass('selected');\n    //set options for ordering\n    if(table.data().options.get('order_by') === column) {\n      if(table.data().options.get('sort_order') === 'asc') {\n        this.$('.asc').addClass('selected');\n      } else {\n        this.$('.desc').addClass('selected');\n      }\n    }\n  },\n\n  orderColumnsAsc: function(e) {\n    e.preventDefault();\n    this.table.data().setOptions({\n      sort_order: 'asc',\n      order_by: this.column\n    });\n    this.hide();\n    return false;\n  },\n\n  orderColumnsDesc: function(e) {\n    e.preventDefault();\n    this.table.data().setOptions({\n      sort_order: 'desc',\n      order_by: this.column\n    });\n    this.hide();\n    return false;\n  },\n\n  renameColumn: function(e) {\n    e.preventDefault();\n    this.hide();\n    this.trigger('renameColumn');\n    return false;\n  },\n\n  clearView: function(e) {\n    if (e) e.preventDefault();\n    this.hide();\n    this.trigger('clearView');\n    return false;\n  },\n\n  changeType: function(e) {\n    e.preventDefault();\n    this.hide();\n    this.trigger('changeType', this.column);\n    return false;\n  },\n\n  georeference: function(e) {\n    e.preventDefault();\n    this.trigger('georeference', this.column);\n    this.hide();\n    return false;\n  },\n\n  filterColumn: function(e) {\n    this.killEvent(e);\n    this._addFilter(this.column);\n  },\n\n  _addFilter: function(column_name) {\n    this.trigger('applyFilter', column_name);\n    this.hide();\n  },\n\n  deleteColumn: function(e) {\n    e.preventDefault();\n    this.hide();\n\n    var view = new cdb.editor.DeleteColumnView({\n      clean_on_hide: true,\n      enter_to_confirm: true,\n      table: this.table,\n      column: this.column,\n      clean_on_hide: true\n    });\n    view.appendToBody();\n\n    return false;\n  },\n\n  addColumn: function(e) {\n    e.preventDefault();\n    this.trigger(\"addColumn\", this);\n    this.hide();\n    return false;\n  }\n});\n","\n/**\n *  Model for authenticated user endpoint\n *\n */\n\ncdb.open.AuthenticatedUser = cdb.core.Model.extend({\n\n  defaults: {\n    username: '',\n    avatar_url: ''\n  },\n\n  url: function() {\n    var host = this.get('host') ? this.get('host') : this._getCurrentHost();\n    return \"//\" + host + \"/api/v1/get_authenticated_users\";\n  },\n\n  _getCurrentHost: function() {\n    return window.location.host;\n  }\n});\n","\n/**\n *  Account dropdown within public header\n *\n */\n\n\ncdb.open.AccountDropdown = cdb.admin.DropdownMenu.extend({\n\n  _TEMPLATE: ' \\\n    <ul>\\\n      <li><a class=\"small\" href=\"<%- urls[0] %>\">View your datasets</a></li>\\\n      <li><a class=\"small\" href=\"<%- urls[0] %>/visualizations\">View your maps</a></li>\\\n      <li><a class=\"small\" href=\"<%- urls[0].replace(\"dashboard\", \"logout\") %>\">Close session</a></li>\\\n    </ul>\\\n  ',\n\n  render: function() {\n    this.$el\n      .html(_.template(this._TEMPLATE)(this.model.attributes))\n      .css({\n        width: this.options.width\n      })\n    \n    return this;\n  }\n\n});","/**\n *  Public header, dance starts!\n *\n */\ncdb.open.Header = cdb.core.View.extend({\n\n  initialize: function() {\n    this.vis = this.options.vis;\n    this.template = cdb.templates.getTemplate('public/views/public_header');\n    this._initBinds();\n  },\n\n  render: function() {\n    this.clearSubViews();\n    this.$el.html(\n      this.template(\n        _.defaults({\n          vis_url: this.vis && this.vis.viewUrl(this.model) || '',\n          isMobileDevice: this.options.isMobileDevice,\n          owner_username: this.options.owner_username,\n          current_view: this.options.current_view\n        }, this.model.attributes)\n      )\n    );\n    this._initViews();\n    return this;\n  },\n\n  _initBinds: function() {\n    this.model.bind('change', this.render, this);\n  },\n\n  _initViews: function() {\n    if (this.$('.account').length > 0) {\n      var dropdown = new cdb.open.AccountDropdown({\n        target: this.$('a.account'),\n        model: this.model,\n        vertical_offset: 20,\n        width: 166\n      });\n\n      this.addView(dropdown);\n      cdb.god.bind(\"closeDialogs\", dropdown.hide, dropdown);\n      this.add_related_model(cdb.god);\n      $('body').append(dropdown.render().el);\n    }\n  }\n\n});\n","cdb.open.LikeView = cdb.core.View.extend({\n\n  events: {\n    \"click\": \"_onClick\"\n  },\n\n  _onClick: function(e) {\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.model.toggleLiked();\n\n    var self = this;\n\n    this.model.bind(\"error\", function(response) {\n\n      if (response.status === 400) { // if the item was already liked, we \"fake\" the like\n        self.model.set({ id: self.model.get(\"vis_id\"), liked: true });\n      } else if (response.status === 403) {\n        window.top.location.href = \"https://carto.com/sessions/new\";\n      }\n    });\n\n  },\n\n  initialize: function() {\n\n    this.model.bind(\"change:likes, change:liked\", function() {\n\n      this._updateCounter();\n\n      if (this.model.get(\"liked\")) {\n\n        this._highlightHeart();\n\n      } else {\n\n        this._unhighlightHeart();\n      }\n\n    }, this);\n\n    if (this.options.auto_fetch) this.model.fetch();\n\n  },\n\n  _updateCounter: function() {\n\n    var $counter = $(\".js-like .counter\");\n    var count = this.model.get(\"likes\");\n\n    if (count > 2 || this.model.get(\"show_count\")) {\n      $counter.text(count);\n    } else {\n      $counter.text(\"\");\n    }\n\n  },\n\n  _unhighlightHeart: function() {\n\n    var $button  = $(\".js-like\");\n    var $icon    = $(\".js-like .icon\");\n\n    $icon.addClass(\"is-pulsating is-animated\");\n    $icon.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function() {\n      $(this).removeClass(\"is-pulsating is-animated\");\n      $button.removeClass(\"is-highlighted\");\n    });\n\n  },\n\n  _highlightHeart: function() {\n\n    var $button  = $(\".js-like\");\n    var $icon    = $(\".js-like .icon\");\n\n    $button.addClass(\"is-highlighted\");\n    $icon.addClass(\"is-pulsating is-animated\");\n    $icon.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function() {\n      $(this).removeClass(\"is-pulsating is-animated\");\n    });\n  }\n\n});\n\ncdb.open.Like = cdb.admin.Like.extend({\n});\n","\n  /**\n   *  Public visualization model\n   *\n   */\n\n  cdb.open.PublicVisualization = cdb.core.Model.extend({\n\n    urlRoot: '/api/v1/viz',\n\n    initialize: function() {\n\n      this.like = new cdb.open.Like({ \n        id: this.get(\"liked\") ? this.id : null,\n        vis_id: this.id\n      });\n\n    },\n\n    viewUrl: function() {\n      return cdb.config.prefixUrl() + \"/viz/\" + this.id + \"/\";\n    },\n\n    copy: function(attrs, options) {\n      attrs = attrs || {};\n      options = options || {};\n      var vis = new cdb.open.PublicVisualization(\n        _.extend({\n            source_visualization_id: this.id\n          },\n          attrs\n        )\n      );\n      vis.save(null, options);\n      return vis;\n    }\n\n  });\n","(function() {\n\n  /**\n   * contains information about the table, not the data itself\n   */\n  cdb.open.PublicCartoDBTableMetadata = cdb.admin.CartoDBTableMetadata.extend({\n\n    fetch: function() {\n      this.trigger('sync');\n      //nothing to fetch here\n    },\n\n\n    data: function() {\n      var self = this;\n      if(this._data === undefined) {\n        this._data = new cdb.admin.CartoDBTableData(null, {\n          table: this\n        });\n        this._data.fetch = function() {  };\n      }\n\n      if(this.sqlView) {\n        return this.sqlView;\n      }\n      return this._data;\n    },\n\n  });\n\n\n\n})();\n","\n/**\n *  Public header for table view\n *\n *  - It needs a table model, config and user data.\n *\n *    var header = new cdb.admin.Header({\n *      el:       this.$('header'),\n *      model:    table_model,\n *      user:     user_model,\n *      config:   config\n *    });\n *\n */\ncdb.open.PublicHeader = cdb.admin.Header.extend({\n\n  _SQL: 'SELECT * FROM ',\n\n  events: {\n    'click .navigation li a':   '_onTabClick'\n  },\n\n  initialize: function() {\n    this.$body = $('body');\n    this.setInfo();\n  },\n\n  setInfo: function() {\n    this.$('h2').text(this.model.get('name'));\n    this.$('.description p').text(this.model.get(\"description\"));\n  },\n\n  _shareVisualization: function() { /* not in public */ },\n  _changeToVisualization: function(e) { /* not in public */ },\n  _changePrivacy: function(ev) { /* not in public */ },\n  _changeDescription: function(e) { /* not in public */ },\n  _changeTitle: function(e) { /* not in public */ },\n  _changeTags: function(e) { /* not in public */ },\n  _onSetAttribute: function(e) { /* not in public */ },\n  isVisEditable: function(e) { /* not in public */ },\n\n  _onTabClick: function(e) {\n    e.preventDefault();\n\n    // Let's create the url ourselves //\n    var url = '';\n\n    // Get table id\n    if (this.options.belong_organization) {\n      url += \"/\" + this.model.getUnquotedName() + '/public';\n    } else {\n      url += \"/\" + this.model.getUnqualifiedName() + '/public';\n    }\n\n    // Get scenario parameter (table or map)\n    if ($(e.target).closest('a').attr('href').search('/map') != -1) {\n      url += '/map'\n    } else {\n      url += '/table'\n    }\n\n    if (window.history && window.history.pushState) window.table_router.navigate(url, {trigger: true});\n\n  }\n});\n","\n/**\n * header cell view, manages operations on table columns\n */\n\n(function() {\n\nHeaderView = cdb.open.PublicHeaderView = cdb.admin.HeaderView.extend({\n\n  events: {\n  },\n\n  initialize: function() {\n    var self = this;\n    this.column = this.options.column;\n    this.table = this.options.table;\n    this.template = this.getTemplate('public_table/views/public_table_header_view');\n    this.editing_name = false;\n    this.changing_type = false;\n  },\n\n  render: function() {\n    this.$el.html('');\n    this.$el.append(this.template({\n      col_name: this.column[0],\n      col_type: this.column[1],\n      editing_name: this.editing_name,\n    }));\n\n    // Focus in the input if it is being edited\n    if (this.editing_name) {\n      this.$el.find(\"input\").focus();\n    }\n\n    this.delegateEvents();\n\n    return this;\n  },\n\n  _openColOptions: function(e) {\n    var self = this;\n    var colOptions = HeaderView.colOptions;\n\n    // Unbind events\n    colOptions.off();\n    cdb.god.unbind('closeDialogs', HeaderView.colOptions.hide, HeaderView.colOptions);\n\n    // Close other dialogs\n    cdb.god.trigger(\"closeDialogs\");\n\n    // set data for column and table currently editing\n    colOptions.setTable(this.table, this.column[0]);\n\n    colOptions.bind('renameColumn', this._renameColumn, this);\n    colOptions.bind('changeType', this._changeType, this);\n    colOptions.bind('georeference', function(column) {\n        self.trigger('georeference', column);\n    }, this);\n\n    // bind the stuff\n    var container = $(e.target).parent().parent();\n    container.append(colOptions.el);\n    \n    var link_width  = $(e.target).width() + 26\n      , th          = container.parent();\n\n    // align to the right of the target with a little of margin\n    colOptions.openAt(link_width - colOptions.$el.width(), (th.height()/2) + 7);\n\n    // Bind again!\n    cdb.god.bind(\"closeDialogs\", HeaderView.colOptions.hide, HeaderView.colOptions);\n\n  },\n\n  _openColTypeOptions: function(e) {},\n\n  _checkEditColnameInput: function(e) {},\n\n  _submitEdit: function() {},\n\n  _finishEdit: function() {},\n\n  _renameColumn: function() {},\n\n  _changeType: function() {},\n\n  showColumnOptions: function(e) {\n    var self = this;\n    e.preventDefault();\n    var colOptions = HeaderView.colOptions;\n    colOptions.hide(function() {\n      self._openColOptions(e);\n    });\n    return false;\n  },\n\n  showColumnTypeOptions: function(e) {}\n\n});\n\n})();\n","/**\n * this infowindow is shown in the map when user clicks on a feature\n */\n\n(function() {\n\n  cdb.open.PublicMapInfowindow = cdb.admin.MapInfowindow.extend({\n\n    events: cdb.geo.ui.Infowindow.prototype.events,\n\n    initialize: function() {\n      var self = this;\n      this.table = this.options.table;\n      this.model.set({ content: 'loading...' });\n      // call parent\n      cdb.geo.ui.Infowindow.prototype.initialize.call(this);\n    },\n\n    render: function() {\n      this.$el.html($(this.template(_.clone(this.model.attributes))));\n      this._update();\n      return this;\n    },\n\n    /**\n     * Not in public\n     */\n    _editGeom: function(e) {\n\n    },\n\n    /**\n     * Not in public\n     */\n    _removeGeom: function(e) {\n    }\n\n\n  });\n\n\n})();\n","/**\n * map tab shown in cartodb admin\n */\n\ncdb.open.PublicMapTab = cdb.admin.MapTab.extend({\n\n  className: 'map',\n\n  events: {\n    'click .js-bounds': '_changeBounds'\n  },\n\n  initialize: function() {\n    this.template = this.getTemplate('public_table/views/maptab_public');\n    this.map_enabled = false;\n\n    this._initBinds();\n  },\n\n  _initBinds: function() {\n    this.model.bind('change:bounds', this._setBoundsCheckbox, this);\n    this.model.bind('change:map', this._setBounds, this);\n  },\n\n  _changeBounds: function() {\n    this.model.set('bounds', !this.model.get('bounds'));\n  },\n\n  _setBounds: function() {\n    if (this.vis) {\n      var map = this.model.get('map');\n      this.vis.mapView.map.setView(map.center, map.zoom);\n    }\n  },\n\n  _setBoundsCheckbox: function() {\n    this.trigger('boundsChanged', { bounds: this.model.get('bounds') });\n    this.$('.js-bounds .Checkbox-input').toggleClass('is-checked', !!this.model.get('bounds'));\n  },\n\n  /**\n   * map can't be loaded from the beggining, it needs the DOM to be loaded\n   * so we wait until is actually shown to create the mapview and show it\n   */\n  enableMap: function() {\n    if (!this.map_enabled && !this.vis) {\n      this.vis = new cdb.vis.Vis({\n        el: this.$('.cartodb-map')\n      });\n      this.vis.load(this.options.vizjson, {\n        auth_token: this.options.auth_token,\n        https: this.options.https,\n        search: false,\n        scrollwheel: false,\n        shareable: false,\n        fullscreen: true,\n        no_cdn: cdb.config.get('debug')\n      });\n    }\n\n    this._bindBounds();\n  },\n\n  /**\n   * this function binds pan and zoom events\n   * in order to change the results in the table view\n   * with the new bbox\n   */\n  _bindBounds: function() {\n    this.vis.mapView.bind('dragend zoomend', function() {\n      this.trigger('mapBoundsChanged', {\n        map: this.vis.map\n      });\n    }, this);\n  },\n\n  clearMap: function() {},\n\n  render: function() {\n    this.$el.html(this.template());\n    return this;\n  }\n});\n","/**\n *  entry point for public table view\n */\n\n\n$(function() {\n\n  // Add easeinquad animation\n  $.extend( $.easing, {\n    easeInQuad: function (x, t, b, c, d) {\n      return c*(t/=d)*t + b;\n    }\n  })\n\n  cdb.init(function() {\n    cdb.config.set(config);\n    if (api_key) cdb.config.set(\"api_key\", api_key);\n    cdb.config.set('url_prefix', window.base_url);\n    cdb.templates.namespace = 'cartodb/';\n\n    // Check if device is a mobile\n    var mobileDevice = /Android|webOS|iPad|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n\n    // Window view\n    var public_window = new cdb.open.PublicTableWindow({\n      el: window,\n      table_id: table_id, \n      table_name: table_name,\n      user_name: user_name,\n      owner_username: owner_username,\n      vizjson: vizjson_obj,\n      auth_token: auth_token,\n      https: use_https,\n      api_key: api_key,\n      schema: schema,\n      config: config,\n      isMobileDevice: mobileDevice,\n      belong_organization: belong_organization\n    });\n\n  });\n\n});","\n  /** \n   *  Public table window \"view\"\n   *\n   */\n\n  cdb.open.PublicTableWindow = cdb.core.View.extend({\n\n    initialize: function() {\n      this.$body = $(this.el.document.body);\n      this.$map = this.$body.find('#map');\n      this._initBinds();\n      this._initViews();\n      setTimeout(this._onStart, 250);\n    },\n\n    _initViews: function() {\n      // Table view\n      var table_options = _.defaults({ el: this.el.document.body, model: new cdb.core.Model({ bounds: false, map: null }) }, this.options);\n      var table = new cdb.open.TablePublic(table_options);\n\n      // Public table router\n      this.el.table_router = new cdb.open.TableRouter(table);\n\n      var pushState = true;\n      var root = '/tables/';\n\n      // Push state?\n      if (!this.el.history || !this.el.history.pushState) pushState = false;\n\n      // Organization user?\n      if (this.options.belong_organization) root = '/u/' + this.options.user_name + root;\n\n      Backbone.history.start({\n        pushState:  pushState,\n        root:       root\n      });\n    },\n\n    _initBinds: function() {\n      _.bindAll(this, '_onWindowResize', '_onOrientationChange', '_onStart');\n\n      this.$el.on('resize', this._onWindowResize);\n\n      if (!this.el.addEventListener) {\n        this.el.attachEvent('orientationchange', this._onOrientationChange, this);\n      } else {\n        this.el.addEventListener('orientationchange', this._onOrientationChange);\n      }\n    },\n\n    // On start view!\n    _onStart: function() {\n      this._setupMapDimensions();\n\n      var windowHeight = this.$el.height();\n      var top = windowHeight - this.$body.find(\".cartodb-info\").outerHeight(true) - this.$body.find(\".cartodb-public-header\").outerHeight(true);\n\n      if (this.options.isMobileDevice) {\n        var h = 120;\n\n        if (windowHeight < 670) {\n          h = 80;\n        }\n\n        top = windowHeight - this.$body.find(\".cartodb-public-header\").outerHeight(true) - h;\n      }\n\n      this._showNavigationBar(top)\n    },\n\n    _onWindowResize: function() {\n      // Resize window\n      this._setupMapDimensions();\n      // Close dialogs\n      cdb.god.trigger(\"closeDialogs\");\n    },\n\n    _onOrientationChange: function() {\n      // Reset disqus\n      DISQUS && DISQUS.reset({ reload: true });\n      // Resize window orientation\n      this._setupMapDimensions(true);\n    },\n\n    // When window is resized, let's touch some things ;)\n    _setupMapDimensions: function(animated) {\n      var windowHeight = this.$el.height();\n      var mainInfoHeight = this.$body.find('.js-Navmenu').height();\n      var headerHeight = this.$body.find('.Header').height();\n      var landscapeMode = this.el.matchMedia && this.el.matchMedia(\"(orientation: landscape)\").matches;\n      var h, height, top;\n\n      if (this.options.isMobileDevice) {\n\n        if (landscapeMode) {\n          h = headerHeight + 7;\n        } else {\n          if (windowHeight > 670) {\n            h = 220;\n          } else { // iPhone, etc.\n            h = 138;\n          }\n        }\n      } else {\n        h = 260;\n      }\n\n      height = windowHeight - h;\n      top    = windowHeight - (h - 80);\n\n      if (animated) {\n        this.$map.animate({ height: height }, { easing: \"easeInQuad\", duration: 150 });\n        this.$body.find(\".navigation\").animate({ top: top - 130 }, { easing: \"easeInQuad\", duration: 150 });\n      } else {\n        if (this.options.isMobileDevice) {\n          this.$map.css({ height: height, opacity: 1 }); \n          this.$body.find(\".navigation\").css({ top: top - 130 }, 250);\n        } else {\n          // On non mobile devices\n          this.$map.css({ height: windowHeight - ( mainInfoHeight + headerHeight), opacity: 1 });\n          this.$body.find(\".navigation\").css({ top: top - 21 }, 250);\n        }\n      }\n\n      // If landscape, let's scroll to show the map, and\n      // leave the header hidden\n      if (this.options.isMobileDevice && landscapeMode && $(window).scrollTop() < headerHeight) {\n        this.$body.animate({ scrollTop: headerHeight }, 600);\n      }\n\n      if (this.map_view) this.map_view.invalidateMap();\n    },\n\n    // Show navigation (table or map view) block\n    _showNavigationBar: function(top) {\n      var landscapeMode = this.el.matchMedia && this.el.matchMedia(\"(orientation: landscape)\").matches;\n      var windowHeight = this.$el.height();\n\n      if (this.options.isMobileDevice) {\n        var top_ = 108;\n\n        if (landscapeMode) {\n          top_ = 48;\n        }\n\n        this.$body.find(\".navigation\")\n          .css({ top: windowHeight })\n          .animate({ top: top - top_, opacity: 1 }, 250);\n      } else {\n        this.$body.find(\".navigation\")\n          .css({ top: windowHeight })\n          .animate({ top: top - 201, opacity: 1 }, 250);\n      }\n\n      if (this.map_view) this.map_view.invalidateMap();\n    }\n\n  });\n","\n/**\n * view used to render each row in public tables\n */\ncdb.open.PublicRowView = cdb.admin.RowView.extend({\n  \n  classLabel: 'cdb.open.PublicRowView',\n  \n  events: {},\n\n  initialize: function() {\n    this.options.row_header = false;\n    this.order = this.options.order;\n  },\n\n  _renderGeometry: function(value) {\n    return this._renderDefault('GeoJSON')\n  },\n\n  _getRowOptions: function() {},\n\n  click_header: function(e) {}\n});\n\n","\n  /**\n   *  Table public view\n   *\n   */\n\n  cdb.open.TablePublic = cdb.core.View.extend({\n\n    events: {\n      'click .js-Navmenu-link--download': '_exportTable',\n      'click .js-Navmenu-link--api': '_apiCallTable'\n    },\n\n    initialize: function() {\n      this._initModels();\n      this._initViews();\n      this._initBinds();\n    },\n\n    _initModels: function() {\n      var self = this;\n\n      // Table\n      this.table = new cdb.open.PublicCartoDBTableMetadata({\n        id: this.options.table_name,\n        name: this.options.table_name,\n        description: this.options.vizjson.description || ''\n      });\n\n      this.table.set({\n        user_name: this.options.user_name,\n        vizjson: this.options.vizjson,\n        schema: this.options.schema\n      });\n\n      this.columns = this.table.data();\n      this.sqlView = new cdb.admin.SQLViewData();\n      this.sqlView.syncMethod = 'read';\n\n      var query = this.query = this.table.data().getSQL()\n      this.table.useSQLView(this.sqlView);\n      this.sqlView.options.set('rows_per_page', 20, { silent: true });\n      this._fetchData(query);\n\n      // User\n      this.user = new cdb.admin.User({ username: this.options.user_name });\n\n      // Authenticated user\n      this.authenticated_user = new cdb.open.AuthenticatedUser();\n\n    },\n\n    _initViews: function() {\n      var self = this;\n\n      // Public header\n      if (this.$('.cartodb-public-header').length > 0) {\n        var header = new cdb.open.Header({\n          el: this.$('.cartodb-public-header'),\n          model: this.authenticated_user,\n          vis: this.table,\n          current_view: this._getCurrentView(),\n          owner_username: this.options.owner_username,\n          isMobileDevice: this.options.isMobileDevice\n        });\n        this.addView(header);\n\n        // Fetch authenticated user model\n        this.authenticated_user.fetch();\n      }\n\n      // Navigation\n      this.header = new cdb.open.PublicHeader({\n        el: this.$('.navigation'),\n        model: this.table,\n        user: this.user,\n        belong_organization: belong_organization,\n        config: this.options.config\n      });\n      this.addView(this.header);\n\n      // Likes\n      var like = new cdb.open.LikeView({\n        el: this.$el.find(\".extra_options .js-like\"),\n        auto_fetch: true,\n        model: new cdb.open.Like({ vis_id: this.options.vizjson.id })\n      });\n\n      // Tabpanes\n      this.workViewTable = new cdb.ui.common.TabPane({\n        el: this.$('.pane_table')\n      });\n      this.addView(this.workViewTable);\n\n      this.workViewMap = new cdb.ui.common.TabPane({\n        el: this.$('.pane_map')\n      });\n      this.addView(this.workViewMap);\n\n      this.workViewMobile = new cdb.ui.common.TabPane({\n        el: this.$('.panes_mobile')\n      });\n      this.addView(this.workViewMobile);\n\n      // Public app tabs\n      this.tabs = new cdb.admin.Tabs({\n        el: this.$('.navigation ul'),\n        slash: true\n      });\n\n      this.addView(this.tabs);\n\n      // Help tooltip\n      var tooltip = new cdb.common.TipsyTooltip({\n        el: this.$(\"span.help\"),\n        gravity: $.fn.tipsy.autoBounds(250, 's')\n      })\n      this.addView(tooltip);\n\n      // Disable comments when browser is IE7\n      if ($.browser.msie && parseInt($.browser.version) === 7 ) {\n        this.$(\".comments .content\").html(\"<p>Your browser doesn't support comments.</p>\")\n      }\n\n      // Table tab\n      this.tableTab = new cdb.open.PublicTableTab({\n        model: this.table,\n        vizjson: this.options.vizjson,\n        user_name: this.options.user_name\n      });\n\n      this.tableTabMobile = new cdb.open.PublicTableTab({\n        model: this.table,\n        vizjson: this.options.vizjson,\n        user_name: this.options.user_name\n      });\n\n      // Map tab\n      this.mapTab = new cdb.open.PublicMapTab({\n        vizjson: this.options.vizjson,\n        auth_token: this.options.auth_token,\n        https: this.options.https,\n        vizjson_url: this.options.vizjson_url,\n        model: new cdb.core.Model({\n          bounds: false\n        })\n      });\n      this.mapTab.bind('mapBoundsChanged', function(options) {\n        self.model.set('map', {\n          bounds: [\n            options.map.get('view_bounds_ne')[1],\n            options.map.get('view_bounds_ne')[0],\n            options.map.get('view_bounds_sw')[1],\n            options.map.get('view_bounds_sw')[0]\n          ],\n          center: options.map.get('center'),\n          zoom: options.map.get('zoom')\n        });\n      });\n      this.mapTab.bind('boundsChanged', function(options) {\n        self.model.set('bounds', options.bounds);\n      });\n\n      this.mapTabMobile = new cdb.open.PublicMapTab({\n        vizjson: this.options.vizjson,\n        auth_token: this.options.auth_token,\n        https: this.options.https,\n        vizjson_url: this.options.vizjson_url,\n        model: new cdb.core.Model({\n          bounds: false\n        })\n      });\n      this.mapTabMobile.bind('mapBoundsChanged', function(options) {\n        self.model.set('map', {\n          bounds: [\n            options.map.get('view_bounds_ne')[1],\n            options.map.get('view_bounds_ne')[0],\n            options.map.get('view_bounds_sw')[1],\n            options.map.get('view_bounds_sw')[0]\n          ],\n          center: options.map.get('center'),\n          zoom: options.map.get('zoom')\n        });\n      });\n      this.mapTabMobile.bind('boundsChanged', function(options) {\n        self.model.set('bounds', options.bounds);\n      });\n\n      this.workViewMobile.addTab('table', this.tableTabMobile.render());\n      this.workViewMobile.addTab('map', this.mapTabMobile.render());\n      this.workViewMobile.bind('tabEnabled:map', this.mapTabMobile.enableMap, this.mapTabMobile);\n\n      this.workViewTable.addTab('table', this.tableTab.render());\n      this.workViewMap.addTab('map', this.mapTab.render());\n\n      this.workViewMobile.bind('tabEnabled', function(mode) {\n        self.$el.removeClass(\"table\");\n        self.$el.removeClass(\"map\");\n        self.$el.addClass(mode);\n        $(window).trigger('resize');\n      }, this.mapTabMobile);\n\n      this.workViewMobile.bind('tabEnabled', this.tabs.activate);\n      this.workViewMobile.active('table');\n\n      this.workViewTable.active('table');\n      this.workViewMap.active('map');\n      this.mapTab.enableMap();\n\n      $(\".pane_table\").addClass(\"is-active\");\n    },\n\n    _updateTable: function() {\n      var sql = (this.model.get('bounds') && this.model.get('map')) ? (this.query + \" WHERE the_geom && ST_MakeEnvelope(\"+this.model.get('map')['bounds'][0]+\", \"+this.model.get('map')['bounds'][1]+\", \"+this.model.get('map')['bounds'][2]+\", \"+this.model.get('map')['bounds'][3]+\", 4326)\") : this.query;\n      this._fetchData(sql);\n    },\n\n    _fetchData: function(sql) {\n      if (sql) {\n        this.sqlView.setSQL(sql);\n      }\n\n      this.sqlView.fetch({\n        success: function() {\n          self.$('.js-spinner').remove();\n        }\n      });\n    },\n\n    _exportTable: function(e) {\n      e.preventDefault();\n\n      // If a sql is applied but it is not valid, don't let the user export it\n      if (!this.sqlView.getSQL()) return false;\n\n      var DialogView = cdb.editor.PublicExportView;\n      var export_dialog = new DialogView({\n        model: this.table,\n        config: config,\n        user_data: this.user.toJSON(),\n        bounds: this.sqlView.getSQL() !== this.query\n      });\n\n      export_dialog\n        .appendToBody()\n        .open();\n    },\n\n    _apiCallTable: function(e) {\n      e.preventDefault();\n\n      // If a sql is applied but it is not valid, don't show the dialog\n      if (!this.sqlView.getSQL()) return false;\n\n      api_dialog = cdb.editor.ViewFactory.createDialogByTemplate('common/dialogs/api_call', {\n        url: cdb.config.getSqlApiUrl(),\n        sql: this.sqlView.getSQL(),\n        schema: this.table.attributes.original_schema.slice(0, 5),\n        rows: this.table.dataModel.models\n      });\n\n      api_dialog\n        .appendToBody()\n        .open();\n    },\n\n    _initBinds: function() {\n      var _this = this;\n\n      // Global click\n      enableClickOut(this.$el);\n\n      this.model.bind('change:bounds', function() {\n        _this._setBoundsCheckbox();\n        _this._updateTable();\n      }, this);\n\n      this.model.bind('change:map', function() {\n        _this._setBounds();\n        _this._updateTable();\n      }, this);\n\n      this.authenticated_user.bind('change', this._onUserLogged, this);\n\n      this.add_related_model(this.authenticated_user);\n    },\n\n    _setBoundsCheckbox: function() {\n      this.mapTab.model.set('bounds', this.model.get('bounds'));\n      this.mapTabMobile.model.set('bounds', this.model.get('bounds'));\n    },\n\n    _setBounds: function() {\n      this.mapTab.model.set('map', this.model.get('map'));\n      this.mapTabMobile.model.set('map', this.model.get('map'));\n    },\n\n    // Get type of current view\n    // - It could be, dashboard, table or visualization\n    _getCurrentView: function() {\n      var pathname = location.pathname;\n\n      if (pathname.indexOf('/tables/') !== -1 ) {\n        return 'table';\n      }\n\n      if (pathname.indexOf('/viz/') !== -1 ) {\n        return 'visualization';\n      }\n\n      // Other case -> dashboard (datasets, visualizations,...)\n      return 'dashboard';\n    },\n\n    keyUp: function(e) {},\n\n    _onUserLogged: function() {\n      // Check if edit button should be visible\n      if (this.options.owner_username === this.authenticated_user.get('username')) {\n        this.$('.extra_options .edit').css('display', 'inline-block');\n        this.$('.extra_options .oneclick').css('display', 'none');\n      }\n\n    }\n\n  });\n","  \n  /**\n   *  New public table router \\o/\n   *\n   *  - No more /#/xxx routes\n   */\n\n  cdb.open.TableRouter = Backbone.Router.extend({\n\n    routes: {\n      ':id/public/:scenario': 'change'\n    },\n\n    initialize: function(table) {\n      this.table = table;\n    },\n\n    change: function(_id,scenario) {\n      // Check active view, if it is different, change\n      if (scenario != 'table' && scenario != 'map') scenario = 'table';\n      this.table.workViewMobile.active(scenario);\n    }\n\n  });","\n  /**\n   * public table view\n   */\n  cdb.open.PublicTableView = cdb.admin.TableView.extend({\n    \n    events: {},\n\n    rowView: cdb.open.PublicRowView,\n\n    initialize: function() {\n      var self = this;\n      this.elder('initialize');\n      this.options.row_header = true;\n      this._editorsOpened = null;\n\n      this.initializeBindings();\n      this.initPaginationAndScroll();\n    },\n\n    initializeBindings: function() {\n      var self = this;\n\n      _.bindAll(this, \"render\", \"rowSaving\", \"addEmptyRow\",\n        \"_checkEmptyTable\", \"_forceScroll\", \"_scrollMagic\",\n        \"rowChanged\", \"rowSynched\", \"_startPagination\", \"_finishPagination\",\n        \"rowFailed\", \"rowDestroyed\", \"emptyTable\");\n\n      this.model.data().bind('newPage', this.newPage, this);\n\n      //this.model.data().bind('loadingRows', this._startPagination);\n      this.model.data().bind('endLoadingRows', this._finishPagination);\n\n      this.bind('cellDblClick', this._editCell, this);\n\n      //this.model.bind('change:dataSource', this._onSQLView, this);\n      // when model changes the header is re rendered so the notice should be added\n      //this.model.bind('change', this._onSQLView, this);\n      this.model.bind('dataLoaded', function() {\n        self._checkEmptyTable();\n        self._forceScroll();\n      }, this);\n    },\n\n    headerView: function(column) {\n      var self = this;\n      if(column[1] !== 'header') {\n        var v = new cdb.open.PublicHeaderView({\n          column: column,\n          table: this.model,\n          sqlView: this.options.sqlView,\n        });\n\n        this.addView(v);\n        return v.render().el;\n      } else {\n        return '<div><div></div></div>';\n      }\n    },\n\n    _onSQLView: function() {},\n\n    _checkEmptyTable: function() {\n      if(this.isEmptyTable()) {\n        this.addEmptyTableInfo();\n      } else {\n        this.cleanEmptyTableInfo();\n        this.$('footer').remove();\n      }\n    },\n\n    _swicthEnabled: function() {\n      // this check is not needed in public table\n    },\n\n    addEmptyTableInfo: function() {\n      this.template_base = cdb.templates.getTemplate('public_table/views/empty_table_public');\n      var content = this.template_base(this.import_);\n\n      var $footer = $('<tfoot><tr><td colspan=\"100\">' + content + '</td></tr></tfoot>');\n      this.$('footer').remove();\n      this.$el.append($footer);\n    },\n\n    _scrollMagic: function() { }\n\n  });\n\n  /**\n   *  Public table tab controller\n   */\n\n  cdb.open.PublicTableTab = cdb.admin.TableTab.extend({\n\n    className: 'table public',\n\n    initialize: function() {\n      this.user = this.options.user;\n      this.sqlView = this.options.sqlView;\n    },\n\n    _createTable: function() {\n      this.tableView = new cdb.open.PublicTableView({\n        dataModel: this.model.data(),\n        model: this.model,\n        sqlView: this.sqlView\n      });\n    }\n  });\n"]}